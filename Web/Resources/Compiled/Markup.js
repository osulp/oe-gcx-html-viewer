function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var r=t.split("."),a=null,o=window,l=0,n=r.length;l<n;l++)a=r[l],l==n-1?o[a]=i:o[a]||(o[a]={}),o=o[a]}require({cache:{"Mapping/modules/Markup/MarkupModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(i.ModuleBase);t.MarkupModule=r})},"Mapping/modules/Markup/MarkupViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/SymbolUtils","geocortex/framework/observables","geocortex/infrastructure/ColorUtils","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/symbology/SymbolType","geocortex/infrastructure/tools/MapTool","geocortex/infrastructure/tools/DrawMode","geocortex/infrastructure/coordinates/CoordinatesManager","geocortex/infrastructure/accessibility/Edit","geocortex/infrastructure/GraphicUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/BrowserUtils"],function(e,t,i,r,a,o,l,n,s,p,u,c,m,d,y,h,b,g,S){"use strict";var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.markupTools={point:[],polyline:[],polygon:[],text:[]},t.editToolbar=null,t.editToolbarTool=esri.toolbars.Edit.MOVE|esri.toolbars.Edit.EDIT_VERTICES|esri.toolbars.Edit.SCALE|esri.toolbars.Edit.ROTATE,t.markupType=new a.Observable(p.SymbolType.POINT),t.currentSymbol=new a.Observable(r.defaultMarkerSymbol()),t._originalGraphic=null,t._modifiedGraphic=null,t._clearStyleViewTimeout=null,t._editToolbarMoveStartedHandle=null,t._editToolbarMoveStoppedHandle=null,t._editToolbarDeactivatedHandle=null,t._editToolbarRotateHandle=null,t._editToolbarScaleHandle=null,t._editToolbarInputMethodChangeHandle=null,t._isIE9or11=!1,t._markerSymbol=r.defaultMarkerSymbol(),t._lineSymbol=r.defaultLineSymbol(),t._polyFillSymbol=r.defaultFillSymbol(),t._polyBorderSymbol=r.defaultLineSymbol(),t._textSymbol=null,t._fontSymbol=null,t._coordinatesPointBuffer=35,t._coordinatesSmsSymbolBuffer=15,t}return __extends(t,e),t.prototype.initialize=function(e){var t=this,i=S.isIE();if(this._isIE9or11=9===i||11===i,this._textSymbol=r.defaultTextSymbol(this._isIE9or11),this._fontSymbol=this._textSymbol.font,e.markupLayerName&&b.changeGraphicsLayerIdBase(e.markupLayerName),e.defaultPointMarkup&&(e.defaultPointMarkup.pointStyle&&this._markerSymbol.setStyle(e.defaultPointMarkup.pointStyle.toLowerCase()),e.defaultPointMarkup.pointSize&&this._markerSymbol.setSize(e.defaultPointMarkup.pointSize),e.defaultPointMarkup.pointColor)){var a=o.getColorFromString(e.defaultPointMarkup.pointColor);this._markerSymbol.setColor(a),this._markerSymbol.outline.setColor(a)}g.defaultPointMarkup.set(this._markerSymbol),e.defaultLineMarkup&&(e.defaultLineMarkup.lineStyle&&this._lineSymbol.setStyle(e.defaultLineMarkup.lineStyle.toLowerCase()),e.defaultLineMarkup.lineWidth&&this._lineSymbol.setWidth(e.defaultLineMarkup.lineWidth),e.defaultLineMarkup.lineColor&&this._lineSymbol.setColor(o.getColorFromString(e.defaultLineMarkup.lineColor))),g.defaultPolylineMarkup.set(this._lineSymbol),e.defaultPolygonMarkup&&(e.defaultPolygonMarkup.polygonBorderStyle&&this._polyBorderSymbol.setStyle(e.defaultPolygonMarkup.polygonBorderStyle.toLowerCase()),e.defaultPolygonMarkup.polygonFillStyle&&this._polyFillSymbol.setStyle(e.defaultPolygonMarkup.polygonFillStyle.toLowerCase()),e.defaultPolygonMarkup.polygonBorderWidth&&this._polyBorderSymbol.setWidth(e.defaultPolygonMarkup.polygonBorderWidth),e.defaultPolygonMarkup.polygonFillColor&&this._polyFillSymbol.setColor(o.getColorFromString(e.defaultPolygonMarkup.polygonFillColor)),e.defaultPolygonMarkup.polygonBorderColor&&this._polyBorderSymbol.setColor(o.getColorFromString(e.defaultPolygonMarkup.polygonBorderColor)),this._polyFillSymbol.setOutline(this._polyBorderSymbol)),g.defaultPolygonMarkup.set(this._polyFillSymbol),e.defaultTextMarkup&&(e.defaultTextMarkup.textStyle&&this._fontSymbol.setStyle(e.defaultTextMarkup.textStyle.toLowerCase()),e.defaultTextMarkup.textWeight&&this._fontSymbol.setWeight(e.defaultTextMarkup.textWeight.toLowerCase()),e.defaultTextMarkup.textSize&&this._fontSymbol.setSize(e.defaultTextMarkup.textSize),e.defaultTextMarkup.textColor&&this._textSymbol.setColor(o.getColorFromString(e.defaultTextMarkup.textColor)),e.defaultTextMarkup.textFamily&&this._fontSymbol.setFamily(e.defaultTextMarkup.textFamily),e.defaultTextMarkup.textHaloColor&&!this._isIE9or11&&this._textSymbol.setHaloColor(o.getColorFromString(e.defaultTextMarkup.textHaloColor)),e.defaultTextMarkup.textHaloSize&&!this._isIE9or11&&this._textSymbol.setHaloSize(e.defaultTextMarkup.textHaloSize)),g.defaultTextMarkup.set(this._textSymbol),this.app.toolRegistry.registerToolTypeForCommand("EditMarkup","geocortex.essentialsHtmlViewer.mapping.infrastructure.tools.DisablingMapTool"),this.app.toolRegistry.registerToolTypeForCommand("DeleteMarkup","geocortex.essentialsHtmlViewer.mapping.infrastructure.tools.DisablingMapTool"),this.markupTools.point=this.markupTools.point.concat(e.customMarkupTools.point),this.markupTools.polyline=this.markupTools.polyline.concat(e.customMarkupTools.polyline),this.markupTools.polygon=this.markupTools.polygon.concat(e.customMarkupTools.polygon),this.markupTools.text=this.markupTools.text.concat(e.customMarkupTools.text),this.markupType.bind(this,function(e){e===p.SymbolType.MULTIPOINT&&(e=p.SymbolType.POINT),"extent"===e&&(e=p.SymbolType.POLYGON),t.app.event("MarkupTypeChangedEvent").publish(e)}),this.currentSymbol.bind(this,function(e){t.app.event("MarkupSymbolChangedEvent").publish(e)}),this.currentSymbol.set(this._markerSymbol),this.initializeCommands(),this.initializeEvents()},t.prototype.initializeCommands=function(){var e=this;this.app.command("AddMarkup").register(this,this.executeAddMarkupCommand,this.canExecuteAddMarkupCommand),this.app.command("AddMarkupFeature").register(this,this.executeAddMarkupFeatureCommand,this.canExecuteAddMarkupFeatureCommand),this.app.command("AddMarkupGeometry").register(this,this.executeAddMarkupCommand,this.canExecuteAddMarkupCommand),this.app.command("AddTextMarkup").register(this,this.executeAddTextMarkupCommand,this.canExecuteAddTextMarkupCommand),this.app.command("ClearMarkup").register(this,this.executeClearMarkupCommand,this.canExecuteClearMarkupCommand),this.app.command("ClearMarkupQuiet").register(this,this.executeClearMarkupQuietCommand,this.canExecuteClearMarkupQuietCommand),this.app.command("EditMarkup").register(this,this.executeEditMarkupCommand,this.canExecuteEditMarkupCommand),this.app.command("DeleteMarkup").register(this,this.executeDeleteMarkupCommand,this.canExecuteDeleteMarkupCommand),this.app.command("ExportMarkupLayer").register(this,this.executeExportMarkupLayerCommand,this.canExecuteExportMarkupLayerCommand),this.app.command("ExportGraphicsLayer").register(this,this.executeExportGraphicsLayerCommand),this.app.command("ChangeMarkupStyle").register(this,this.executeChangeMarkupStyleCommand,this.canExecuteChangeMarkupStyleCommand),this.app.command("CreateMarkupStyleView").register(this,this.executeCreateStyleViewCommand,this.canExecuteCreateStyleViewCommand),this.app.command("StopEditingMarkup").register(this,this.executeStopEditingCommand,this.canExecuteStopEditingCommand),this.app.command("_applySymbolToEditedMarkup").register(this,this._applySymbolToEditedMarkup,function(){return!!e.editToolbar}),this._initializeClickableGraphicCommands(),this.app.event("ProjectLoadedEvent").once(this,function(){var t=e.app.map.getLayer(b.MARKUP_LAYER_ID);t&&h.registerMarkupLayerAsClickable(t,e.app)})},t.prototype._initializeClickableGraphicCommands=function(){this.app.command("StopAndAutoEditClickableFeature").register(this,this.executeStopAndAutoEditClickableFeature,this.canExecuteAutoEditClickableFeature),this.app.command("EditClickableFeature").register(this,this.executeEditClickableFeature,y.isEditableButNotAutoEditableClickableFeature),this.app.command("StopEditingClickableFeature").register(this,this.executeStopEditingClickableFeature,this.canExecuteStopEditingClickableFeature),this.app.command("DeleteClickableFeature").register(this,this.executeDeleteClickableFeature,this.canExecuteDeleteClickableFeature),this.app.command("HighlightFeature").register(this,function(){},this._canHighlightClickableFeature),this.app.command("HighlightFeatures").register(this,function(){},this._canHighlightClickableFeature),this.app.command("ClearAndHighlightFeatures").register(this,function(){},this._canHighlightClickableFeature),this.app.command("HighlightFeatureDefault").register(this,function(){},this._canHighlightClickableFeature)},t.prototype._canHighlightClickableFeature=function(e){var t=e&&e.esriFeature?e.esriFeature.get():null;if(!t)return!0;if(y.isClickableGraphic(this.app,t)){var i=y.getClickableLayerInfo(this.app,t),r=y.getCapabilitiesForGraphic(this.app,t);if(this._hasCapability("edit",r)&&i.autoEditable)return!1}return!0},t.prototype.initializeEvents=function(){var e=this;this.app.event("ActiveToolChangedEvent").subscribe(this,function(t){e.app.command("CreateMarkupStyleView").raiseCanExecuteChanged(),e.app.command("ExportMarkupLayer").raiseCanExecuteChanged(),e.app.command("StopEditingMarkup").execute(),t.tool?(null!==e._clearStyleViewTimeout&&(clearTimeout(e._clearStyleViewTimeout),e._clearStyleViewTimeout=null),e._handleActiveToolChanged(t.tool)):e._clearStyleViewTimeout=setTimeout(function(){e.app.command("HideMarkupStyleView").execute()},250)}),this.app.event("GraphicRemovedEvent").subscribe(this,function(t){return e._onGraphicDeleted(t)})},t.prototype.canExecuteAddMarkupCommand=function(e){return!!e},t.prototype.executeAddMarkupCommand=function(e){this._addMarkup(e)},t.prototype.canExecuteAddMarkupFeatureCommand=function(e){return!!(e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry)},t.prototype.executeAddMarkupFeatureCommand=function(e){var t=e.esriFeature.get().geometry;this._addMarkup(esri.geometry.fromJson(t.toJson()))},t.prototype.canExecuteClearMarkupCommand=function(){return this._markupExists()},t.prototype.executeClearMarkupCommand=function(){this.clearMarkup()},t.prototype.canExecuteClearMarkupQuietCommand=function(){return this._markupExists()},t.prototype.executeClearMarkupQuietCommand=function(){this.clearMarkupQuiet()},t.prototype.canExecuteAddTextMarkupCommand=function(e){return!!e},t.prototype.executeAddTextMarkupCommand=function(e){this._addTextMarkup(e)},t.prototype.canExecuteDeleteMarkupCommand=function(){return this._markupExists()},t.prototype.executeDeleteMarkupCommand=function(e){this.deleteMarkup(e)},t.prototype.canExecuteExportMarkupLayerCommand=function(){return this._hasExportableMarkup()},t.prototype.executeExportMarkupLayerCommand=function(){var e=this.app.map.getLayer(b.MARKUP_LAYER_ID),t="shp",i={format:t,graphicLayer:e};this.app.command("ExportGraphicsLayer").execute(i)},t.prototype.executeExportGraphicsLayerCommand=function(e){for(var t,i,r,a,o=e.graphicLayer.graphics,p=0;p<o.length;p++)if(null!=o[p].geometry)switch(o[p].geometry.type){case"point":null!=o[p].symbol&&"textsymbol"!=o[p].symbol.type&&(null==i&&(i=new esri.tasks.FeatureSet),i.features.push(new esri.Graphic(o[p].geometry,o[p].symbol,o[p].attributes,null)));break;case"polygon":null==r&&(r=new esri.tasks.FeatureSet),r.features.push(new esri.Graphic(o[p].geometry,o[p].symbol,o[p].attributes,null));break;case"extent":null==r&&(r=new esri.tasks.FeatureSet);var u=l.envelopeToPolygon(o[p].geometry);r.features.push(new esri.Graphic(u,o[p].symbol,o[p].attributes,null));break;case"polyline":null==t&&(t=new esri.tasks.FeatureSet),t.features.push(new esri.Graphic(o[p].geometry,o[p].symbol,o[p].attributes,null));break;case"multipoint":null==a&&(a=new esri.tasks.FeatureSet),a.features.push(new esri.Graphic(o[p].geometry,o[p].symbol,o[p].attributes,null))}var c=new n.FeatureSetCollection;if(null!=i){var m=new s.FeatureSet({esriFeatureSet:i});m.displayName.set("Point"),c.featureSets.addItem(m)}if(null!=r){var d=new s.FeatureSet({esriFeatureSet:r});d.displayName.set("Polygon"),c.featureSets.addItem(d)}if(null!=t){var y=new s.FeatureSet({esriFeatureSet:t});y.displayName.set("Polyline"),c.featureSets.addItem(y)}if(null!=a){var h=new s.FeatureSet({esriFeatureSet:a});h.displayName.set("Multipoint"),c.featureSets.addItem(h)}var b={format:e.format,fsc:c};this.app.command("ExportResultsTo").execute(b)},t.prototype.canExecuteEditMarkupCommand=function(){return this._markupExists()},t.prototype.executeEditMarkupCommand=function(e){this._editMarkup(e)},t.prototype.canExecuteChangeMarkupStyleCommand=function(){return!0},t.prototype.canExecuteCreateStyleViewCommand=function(e){if(!this.markupType||!this.currentSymbol)return!1;var t=e?e.esriFeature.get():null;if(t){var i=y.getCapabilitiesForGraphic(this.app,t),r=this._hasCapability("style",i);if(!r)return!1}return!0},t.prototype.executeCreateStyleViewCommand=function(){this.app.command("_showMarkupStyleSelectorView").execute(this.currentEditedSymbol||this.currentSymbol.get())},t.prototype.canExecuteStopEditingCommand=function(){return!!this.editToolbar},t.prototype.executeStopEditingCommand=function(e){if(this.editToolbar){var t=this.editToolbar.getCurrentState().graphic||this._modifiedGraphic;this.app.event("MarkupEditingStoppedEvent").publish(t),this._deactivateToolbar(),this._originalGraphic=this._modifiedGraphic=null,this.currentEditedSymbol=null,this.app.command("ExportMarkupLayer").raiseCanExecuteChanged(),this.app.toolRegistry.getActiveTool()&&e&&"EditMarkupTool"==this.app.toolRegistry.getActiveTool().name&&this.app.command("ClearActiveTool").execute(),this.app.command("HideMarkupStyleView").execute()}},t.prototype._handleActiveToolChanged=function(e){var t=["AddMarkup","AddMarkupGeometry","AddTextMarkup"],i="";if(e instanceof u.MapTool&&t.indexOf(e.command)!=-1)switch(e.drawMode){case c.DrawMode.POINT:i="AddTextMarkup"==e.command?p.SymbolType.TEXT:p.SymbolType.POINT;break;case c.DrawMode.MULTI_POINT:i=p.SymbolType.POINT;break;case c.DrawMode.LINE:case c.DrawMode.POLYLINE:case c.DrawMode.FREEHAND_POLYLINE:i=p.SymbolType.POLYLINE;break;case c.DrawMode.POLYGON:case c.DrawMode.FREEHAND_POLYGON:case c.DrawMode.EXTENT:case c.DrawMode.ARROW:case c.DrawMode.LEFT_ARROW:case c.DrawMode.RIGHT_ARROW:case c.DrawMode.UP_ARROW:case c.DrawMode.DOWN_ARROW:case c.DrawMode.TRIANGLE:case c.DrawMode.CIRCLE:case c.DrawMode.ELLIPSE:case c.DrawMode.RECTANGLE:i=p.SymbolType.POLYGON}else $.inArray(e.name,this.markupTools.point)!=-1?i=p.SymbolType.POINT:$.inArray(e.name,this.markupTools.polyline)!=-1?i=p.SymbolType.POLYLINE:$.inArray(e.name,this.markupTools.polygon)!=-1?i=p.SymbolType.POLYGON:$.inArray(e.name,this.markupTools.text)!=-1&&(i=p.SymbolType.TEXT);i?(this.markupType.set(i),this._setCurrentSymbol(),this.app.command("_updateMarkupStyleSelectorView").execute(this.currentSymbol.get())):this.app.command("HideMarkupStyleView").execute()},t.prototype.canExecuteAutoEditClickableFeature=function(e){return!0},t.prototype.executeEditClickableFeature=function(e){this._originalGraphic&&this.app.command("StopEditingClickableFeature").execute(),this.app.command("ClearEmphasis").execute(e);var t=e.esriFeature.get();t&&this._moveToFront(t),this._editMarkupGraphic(e.esriFeature.get())},t.prototype.executeStopAndAutoEditClickableFeature=function(e){if(this.app.command("StopEditingClickableFeature").execute(),e&&e.esriFeature){var t=y.getClickableLayerInfo(this.app,e.esriFeature.get()),i=y.getCapabilitiesForGraphic(this.app,e.esriFeature.get(),t),r=this._hasCapability("edit",i),a=t&&t.autoEditable;r&&a&&(this.app.highlightManager.suppressHighlight(e.esriFeature.get()),this.executeEditClickableFeature(e))}},t.prototype.canExecuteStopEditingClickableFeature=function(){return!!this.editToolbar},t.prototype.executeStopEditingClickableFeature=function(){this.app.highlightManager.enableHighlight(this._modifiedGraphic);var e=this._modifiedGraphic?this._modifiedGraphic.getLayer():null;e&&e instanceof esri.layers.GraphicsLayer&&this._restoreDrawingOrder(e),this.app.command("StopEditingMarkup").execute(!0)},t.prototype._getSymbolForGeometryType=function(e){switch(e){case p.SymbolType.POINT:case p.SymbolType.MULTIPOINT:return this._markerSymbol;case p.SymbolType.POLYLINE:return this._lineSymbol;case p.SymbolType.POLYGON:return this._polyFillSymbol;case p.SymbolType.TEXT:var t=this._getStyleSelector(),i=this._getTemplateSelector();if(t&&t.isActive||i&&i.isActive)return this._textSymbol;var r=esri.symbol.fromJson(this._textSymbol.toJson());return r.setText(""),r;default:return null}},t.prototype._setCurrentSymbol=function(){var e=this._getSymbolForGeometryType(this.markupType.get());e&&this.currentSymbol.get()!==e&&this.currentSymbol.set(this._copySymbol(e))},t.prototype._moveToFront=function(e){var t=e?e.getShape():null;t&&"function"==typeof t.moveToFront&&t.moveToFront()},t.prototype._restoreDrawingOrder=function(e){var t=this;e.graphics.forEach(function(e){return t._moveToFront(e)})},t.prototype.canExecuteDeleteClickableFeature=function(e){if(e){var t=y.getCapabilitiesForGraphic(this.app,e.esriFeature.get());return this._hasCapability("delete",t)}return!1},t.prototype.executeDeleteClickableFeature=function(e){this.app.event("_deleteClickableFeatureStarted").publish(e),this.app.command("StopEditingClickableFeature").execute(!1);var t=e.esriFeature.get().getLayer(),i=t.remove(e.esriFeature.get());this.app.featureSetManager.updateCollectionsOnFeatureDeletion(i),this._raiseGraphicRemovedEvent(i,t)},t.prototype._raiseGraphicEditingDoneEvent=function(e){var t=(esri.geometry.fromJson(e.geometry.toJson()),{old:this._originalGraphic,"new":e});this.app.event("GraphicEditingDoneEvent").publish(t)},t.prototype._raiseGraphicRemovedEvent=function(e,t){var i={graphic:e,graphicLayer:t};this.app.event("GraphicRemovedEvent").publish(i)},t.prototype._onGraphicDeleted=function(e){var t=e.graphic,i=e.graphicLayer;i&&i.id==b.MARKUP_LAYER_ID&&(this.app.event("MarkupDeletedEvent").publish(t),this.app.command("ClearMarkup").raiseCanExecuteChanged(),this.app.command("EditMarkup").raiseCanExecuteChanged(),this.app.command("DeleteMarkup").raiseCanExecuteChanged(),this.app.command("ExportMarkupLayer").raiseCanExecuteChanged())},t.prototype._closeMapTipView=function(){var e=this.app.viewManager.getViewById("MapTipView");e&&e.isActive&&(this.app.viewManager.deactivateView(e),this.app.event("MapTipClosedEvent").publish())},t.prototype._deactivateToolbar=function(){this._editToolbarMoveStartedHandle&&(this._editToolbarMoveStartedHandle.remove(),this._editToolbarMoveStartedHandle=null),this._editToolbarMoveStoppedHandle&&(this._editToolbarMoveStoppedHandle.remove(),this._editToolbarMoveStoppedHandle=null),this._editToolbarRotateHandle&&(this._editToolbarRotateHandle.remove(),this._editToolbarRotateHandle=null),this._editToolbarScaleHandle&&(this._editToolbarScaleHandle.remove(),this._editToolbarScaleHandle=null),this._editToolbarInputMethodChangeHandle&&(this._editToolbarInputMethodChangeHandle.remove(),this._editToolbarInputMethodChangeHandle=null),this.editToolbar&&(this.editToolbar.deactivate(),this._editToolbarDeactivatedHandle&&(this._editToolbarDeactivatedHandle.remove(),this._editToolbarDeactivatedHandle=null),this.editToolbar=null)},t.prototype.clearMarkup=function(){var e=this;if(this.editToolbar&&this.app.command("StopEditingMarkup").execute(),this._markupExists()){var t=this.app.getResource(this.libraryId,"language-markup-clear-all-prompt"),i=this.app.getResource(this.libraryId,"language-markup-clear-all-prompt-title");this.app.command("Confirm").execute(t,i,function(t){t&&e.clearMarkupQuiet()})}},t.prototype.clearMarkupQuiet=function(){var e=this;if(this.editToolbar&&setTimeout(function(){e.app.command("StopEditingMarkup").execute()},0),this._markupExists()){var t=this._getGraphicsLayer(!1,b.MARKUP_LAYER_ID),i=this._getGraphicsLayer(!1,b.COORDINATES_LAYER_ID);if(i&&i.graphics&&i.graphics.length)for(;i.graphics.length;){var r=i.graphics[i.graphics.length-1];r.coordinateId&&this.app.command("DeleteCoordinates").execute(r.coordinateId),i.remove(r),this.app.event("MarkupDeletedEvent").publish(r)}if(!t)return;for(var a=t.graphics.length,o=0;o<a;o++)t.graphics[0].measurementId?this.app.event("MarkupDeletedEvent").publish(t.graphics[0]):(this.app.event("MarkupDeletedEvent").publish(t.graphics[0]),t.remove(t.graphics[0]));this._deactivateActiveToolIfNoMarkupExists(),this.app.command("ClearMarkup").raiseCanExecuteChanged(),this.app.command("EditMarkup").raiseCanExecuteChanged(),this.app.command("DeleteMarkup").raiseCanExecuteChanged(),this.app.command("ExportMarkupLayer").raiseCanExecuteChanged(),this.app.event("MarkupClearedEvent").publish()}this.app.command("LogOptimizerEvent").execute("ClearMarkupTool","ClearAllMarkup")},t.prototype.deleteMarkup=function(e){var t=this,i=[b.MARKUP_LAYER_ID,b.MEASUREMENT_LAYER_ID,b.COORDINATES_LAYER_ID],r="language-markup-delete-multiple-prompt",a="language-markup-delete-multiple-prompt-title",o=function(e){if(e&&e.length){for(var i=0;i<e.length;i++){var r=e[i];r[m.coordinateIdentifierProperty]&&t.app.command("DeleteCoordinates").execute(r[m.coordinateIdentifierProperty]),t.app.event("MarkupDeletedEvent").publish(r)}t._deactivateActiveToolIfNoMarkupExists(),t.app.command("ClearMarkup").raiseCanExecuteChanged(),t.app.command("EditMarkup").raiseCanExecuteChanged(),t.app.command("DeleteMarkup").raiseCanExecuteChanged(),t.app.command("ExportMarkupLayer").raiseCanExecuteChanged()}t.app.command("ShowMap").execute()};y.deleteMarkup(e,i,this.app,o,!1,r,a,this.libraryId)},t.prototype._deactivateActiveToolIfNoMarkupExists=function(){var e=this.app.toolRegistry.getActiveTool();!this._markupExists()&&e instanceof u.MapTool&&("EditMarkup"!==e.command&&"DeleteMarkup"!==e.command||this.app.command("ClearActiveTool").execute())},t.prototype._addMarkup=function(e){if(!e)throw new Error("geometry is null");"extent"===e.type&&(e=l.envelopeToPolygon(e));var t=this._copySymbol(this._getSymbolForGeometryType(e.type));if(t){var i=new esri.Graphic;i.setGeometry(e),i.setSymbol(t),this._addGraphic(i,b.MARKUP_LAYER_ID),this.app.event("MarkupAddedEvent").publish(i)}this.app.command("ClearMarkup").raiseCanExecuteChanged(),this.app.command("EditMarkup").raiseCanExecuteChanged(),this.app.command("DeleteMarkup").raiseCanExecuteChanged(),this.app.command("ExportMarkupLayer").raiseCanExecuteChanged()},t.prototype._addTextMarkup=function(e){var t=this;if(e){var i=this._getStyleSelector(),r=this._getTemplateSelector();if(this.currentSymbol.get().text&&(i.isActive||r.isActive))this._addTextMarkupImpl(this.currentSymbol.get().text,e);else{var a=this.app.getResource(this.libraryId,"language-markup-add-text-title"),o=this.app.getResource(this.libraryId,"language-markup-add-text");this.app.command("Prompt").execute(a,o,"",function(i){i&&t._addTextMarkupImpl(i,e),t.app.command("ShowMap").execute()})}}},t.prototype._editMarkup=function(e){var t=this._getGraphicsLayer(!1,b.COORDINATES_LAYER_ID),i=null;if(t&&(i=y.getMarkupFromGeometry(e,t,this.app,this._coordinatesSmsSymbolBuffer,this._coordinatesPointBuffer)),i&&i[i.length-1]){var r=i[i.length-1];if(r.hasOwnProperty(m.coordinateIdentifierProperty))return this.app.command("StopEditingMarkup").execute(!0),void this.app.command("EditCoordinate").execute(r[m.coordinateIdentifierProperty])}this.editToolbar&&this.app.command("StopEditingMarkup").execute(!1);var a=this._getGraphicsLayer(!1,b.MARKUP_LAYER_ID),o=null;a&&(o=y.getMarkupFromGeometry(e,a,this.app)),o&&o[o.length-1]&&this._editMarkupGraphic(o[o.length-1])},t.prototype._editMarkupGraphic=function(e){var t=this;this.editToolbar&&this.app.command("StopEditingMarkup").execute(!1),this._originalGraphic=new esri.Graphic(e.toJson()),this._modifiedGraphic=e,this.markupType.set(e.symbol instanceof esri.symbol.TextSymbol?p.SymbolType.TEXT:e.geometry.type),this.currentSymbol.set(this._copySymbol(e.symbol)),this.currentEditedSymbol=this.currentSymbol.get(),this.app.event("MarkupEditingStartedEvent").publish(e),this.app.command("ExportMarkupLayer").raiseCanExecuteChanged(),e.hasOwnProperty("measurementId")&&this.app.event("MeasurementEditingStartedEvent").publish({graphic:e}),this.editToolbar=this.app.accessibilityManager.createComponent("geocortex.accessibility.edit",this.app.map),this._editToolbarMoveStartedHandle=dojo.aspect.after(this.editToolbar,"onGraphicFirstMove",function(e){t.app.map.disableMapNavigation()},!0),this._editToolbarMoveStoppedHandle=dojo.aspect.after(this.editToolbar,"onGraphicMoveStop",function(e){t.app.map.enableMapNavigation()},!0),this.markupType.get()===p.SymbolType.TEXT&&(this._editToolbarRotateHandle=dojo.aspect.after(this.editToolbar,"onRotateStop",function(e){t.currentEditedSymbol=t._copySymbol(e.symbol),t.currentEditedSymbol&&t.app.command("_updateMarkupStyleSelectorView").execute(t.currentEditedSymbol)},!0),this._editToolbarScaleHandle=dojo.aspect.after(this.editToolbar,"onScaleStop",function(e){t.currentEditedSymbol=t._copySymbol(e.symbol),t.currentEditedSymbol&&t.app.command("_updateMarkupStyleSelectorView").execute(t.currentEditedSymbol)},!0)),this._editToolbarDeactivatedHandle=dojo.aspect.after(this.editToolbar,"onDeactivate",function(e,i,r){t._raiseGraphicEditingDoneEvent(i)},!0),this.editToolbar instanceof d.Edit&&(this._editToolbarInputMethodChangeHandle=dojo.aspect.after(this.editToolbar,"onInputMethodChange",function(e){var i=t.app.toolRegistry.getActiveTool();if(i instanceof u.MapTool&&"EditMarkup"===i.command){var r={tool:i,previousMethod:e?e.previousMethod:null,newMethod:e?e.newMethod:null};t.app.event("ToolInputMethodChangedEvent").publish(r)}},!0)),this.editToolbar.activate(this.editToolbarTool,e);var i=this.app.toolRegistry.getActiveTool();if(i){if(i instanceof u.MapTool&&"EditMarkup"===i.command)var r=this.app.event("ActiveToolChangedEvent").subscribe(this,function(e){var i=e.previousTool;if(i instanceof u.MapTool&&"EditMarkup"==i.command&&1==i.isSticky)t.app.command("StopEditingMarkup").execute(!1),t.app.event("ActiveToolChangedEvent").unsubscribe(r);else var a=t.app.map.on("click",function(e){t.app.command("StopEditingMarkup").execute(!1),t.app.event("ActiveToolChangedEvent").unsubscribe(r),a.remove()});e.tool&&t.editToolbar&&(t.app.command("StopEditingMarkup").execute(!1),t.app.event("ActiveToolChangedEvent").unsubscribe(r))})}else{var a,o;a=this.app.event("ActiveToolChangingEvent").subscribe(this,function(e){t._closeMapTipView(),a&&t.app.event("ActiveToolChangingEvent").unsubscribe(a),o&&o.remove()}),o=this.app.map.on("click",function(e){t._closeMapTipView(),a&&t.app.event("ActiveToolChangingEvent").unsubscribe(a),o&&o.remove()})}this.app.command("_updateMarkupStyleSelectorView").execute(this.currentSymbol.get())},t.prototype.executeChangeMarkupStyleCommand=function(e){if(e){var t;if(e instanceof esri.symbol.Symbol)t=e;else if(t=esri.symbol.fromJson(JSON.parse(e)),!t)return;switch(this.markupType.get()){case p.SymbolType.POINT:case p.SymbolType.MULTIPOINT:t instanceof esri.symbol.PictureMarkerSymbol?this._markerSymbol=t:t instanceof esri.symbol.SimpleMarkerSymbol&&(this._markerSymbol=t);break;case p.SymbolType.POLYLINE:t instanceof esri.symbol.SimpleLineSymbol&&(this._lineSymbol=t);break;case p.SymbolType.POLYGON:t instanceof esri.symbol.SimpleFillSymbol&&(this._polyFillSymbol=t);break;case p.SymbolType.TEXT:t instanceof esri.symbol.TextSymbol&&(this._textSymbol=t)}this.currentEditedSymbol=null,this._setCurrentSymbol(),this.editToolbar&&this._applySymbolToEditedMarkup(t)}},t.prototype._applySymbolToEditedMarkup=function(e){if(this.editToolbar&&e){if(e instanceof esri.symbol.Symbol)e=this._copySymbol(e);else if(e=esri.symbol.fromJson(JSON.parse(e)),!e)return;var t=this.editToolbar.getCurrentState().graphic;(t.symbol.type===e.type||t.symbol.type.indexOf("markersymbol")>-1&&e.type.indexOf("markersymbol")>-1)&&(t.setSymbol(e),this.currentEditedSymbol=e,this.app.event("GraphicSymbolChangedEvent").publish(t),this.editToolbar.refresh())}},t.prototype._addTextMarkupImpl=function(e,t){if(t.getExtent){var i=t.getExtent();i&&(t=i.getCenter())}var r=this._copySymbol(this._textSymbol);r.setText(e);var a=new esri.Graphic;a.geometry=t,a.symbol=r,this._addGraphic(a,b.MARKUP_LAYER_ID),this.app.event("MarkupAddedEvent").publish(a),this.app.command("ClearMarkup").raiseCanExecuteChanged(),this.app.command("EditMarkup").raiseCanExecuteChanged(),this.app.command("DeleteMarkup").raiseCanExecuteChanged()},t.prototype._addGraphic=function(e,t){if(e){var i=this._getGraphicsLayer(!0,t);i.add(e),i.visible||i.setVisibility(!0)}},t.prototype._getGraphicsLayer=function(e,t){var i=this.app.map.getLayer(t);return!i&&e&&(i=h.getInternalGraphicsLayer(b.MARKUP_LAYER_ID,this.app,h.GraphicsLayerType.Markup,!0),this.app.markupLayer.set(i)),i},t.prototype._copySymbol=function(e){return esri.symbol.fromJson(e.toJson())},t.prototype._markupExists=function(){var e=!1;if(this.app.map){var t=this._getGraphicsLayer(!1,b.MARKUP_LAYER_ID);t&&t.graphics&&t.graphics.length>0&&(e=!0),t=this._getGraphicsLayer(!1,b.COORDINATES_LAYER_ID),t&&t.graphics&&t.graphics.length>0&&(e=!0)}return e},t.prototype._hasExportableMarkup=function(){var e=!1;if(this.app.map){var t=this._getGraphicsLayer(!1,b.MARKUP_LAYER_ID);if(t&&t.graphics&&t.graphics.length>0){if(this._originalGraphic)return!1;for(var i=t.graphics,r=0;r<i.length;r++)if(null!=i[r].geometry){if("point"!=i[r].geometry.type){e=!0;break}if(null!=i[r].symbol&&"textsymbol"!=i[r].symbol.type){e=!0;break}}}}return e},t.prototype._hasCapability=function(e,t){return t&&t.some(function(t){return t==e})},t.prototype._getStyleSelector=function(){return this._styleSelector||(this._styleSelector=this.app.viewManager.getViewById("MarkupSymbolSelectorView")),this._styleSelector},t.prototype._getTemplateSelector=function(){return this._templateSelector||(this._templateSelector=this.app.viewManager.getViewById("MarkupTemplateSelectorView")),this._templateSelector},t}(i.ViewModelBase);t.MarkupViewModel=T})},"Mapping/modules/Markup/MarkupStyles/MarkupStyleView":function(){define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView","geocortex/infrastructure/SymbolUtils","./MarkupTemplateSelector/MarkupTemplateSelectorViewModel","geocortex/infrastructure/symbology/widgets/PictureSymbolWidgetViewModel","./MarkupSymbolSelector/MarkupSymbolSelectorViewModel","geocortex/infrastructure/symbology/SymbolType"],function(e,t,i,r,a,o,l,n){"use strict";var s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._availableWidgets=[],r._initialized=!1,r._lastCustomSymbol={},r._editingMarkup=!1,r.app.command("_showMarkupStyleSelectorView").register(r,r._executeShowMarkupStyleSelectorView),r.app.command("_updateMarkupStyleSelectorView").register(r,r._executeUpdateMarkupStyleSelectorView),r.app.command("HideMarkupStyleView").register(r,r._executeHideMarkupStyleSelectorView),r.app.event("ActiveToolChangedEvent").subscribe(r,function(e){r._currentTool=e.tool}),r.app.event("MarkupEditingStartedEvent").subscribe(r,function(){r._editingMarkup=!0,r._styleSelector&&(r._styleSelector.editingMarkup=!0,r._styleSelector.viewModel&&r._styleSelector.viewModel.textSymbolWidget&&(r._styleSelector.viewModel.textSymbolWidget.editingMarkup=!0)),r._templateSelector&&(r._templateSelector.editingMarkup=!0)}),r.app.event("MarkupEditingStoppedEvent").subscribe(r,function(){r._editingMarkup=!1,r._styleSelector&&(r._styleSelector.editingMarkup=!1,r._styleSelector.viewModel&&r._styleSelector.viewModel.textSymbolWidget&&(r._styleSelector.viewModel.textSymbolWidget.editingMarkup=!1)),r._templateSelector&&(r._templateSelector.editingMarkup=!1)}),r}return __extends(t,e),t.prototype.attach=function(t){var i=this;e.prototype.attach.call(this,t),
this._initialized||(this._initializeStyleSelectors(),this.app.event("MarkupTypeChangedEvent").subscribe(this,function(e){i._currentWidget&&"MarkupSymbolSelectorView"===i._currentWidget.id&&(i._lastCustomSymbol[i.viewModel.markupType.get()]=i._lastUpdateSymbol,i._styleSelector.updateSymbol(i._lastCustomSymbol[e]||i._getDefaultSymbol(e),!1)),i._currentWidget&&"MarkupTemplateSelectorView"===i._currentWidget.id&&i._templateSelector.loadCurrentLibrary(),e!==n.SymbolType.POINT&&i._currentWidget&&"MarkupImageSelectorView"===i._currentWidget.id&&(i.viewModel.currentSelector.set(i.viewModel.templateSelectorItem||i.viewModel.symbolSelectorItem),i.isActive&&i._changeMarkupSelector()),i.viewModel.markupType.set(e)}),this.app.event("MarkupSymbolChangedEvent").subscribe(this,function(e){i.viewModel.markupSymbol=e}))},t.prototype.activated=function(){this._lastUpdateSymbol&&!this.isActive&&this._executeUpdateMarkupStyleSelectorView(this._lastUpdateSymbol,!0)},t.prototype.deactivated=function(){this._lastCustomSymbol[this.viewModel.markupType.get()]=this._lastUpdateSymbol,this.app.event("_markupToggleDeactivated").publish(),this._styleSelector&&(this._styleSelector.isActive=!1),this._templateSelector&&(this._templateSelector.isActive=!1)},t.prototype._executeShowMarkupStyleSelectorView=function(e){this._initialized||this._initializeStyleSelectors(),this._originalSymbol=esri.symbol.fromJson(e.toJson()),this._executeUpdateMarkupStyleSelectorView(e),this.app.command("ActivateView").execute(this.viewModel.currentSelector.get().id)},t.prototype._executeUpdateMarkupStyleSelectorView=function(e,t){var i=this;if(void 0===t&&(t=!1),e&&(this._lastUpdateSymbol=e,this.isActive||t)){var r,a=function(t){i._imageSelector&&e instanceof esri.symbol.PictureMarkerSymbol?(r=i._imageSelector,i._imageSelector.updateSymbol(e)):i._templateSelector&&t||!i._styleSelector?(r=i._templateSelector,i._templateSelector.updateSymbol(e)):(r=i._styleSelector,i._styleSelector.updateSymbol(e));var a=i.viewModel.markupSelectors.getItems().filter(function(e){return e.id===r.id})[0];i.viewModel.currentSelector.get()&&a.id===i.viewModel.currentSelector.get().id||(i.app.command("DeactivateView").execute(i.viewModel.currentSelector.get().id),i.viewModel.currentSelector.set(a),i.app.command("ActivateView").execute(i.viewModel.currentSelector.get().id))};this._templateSelector?this._templateSelector.updateSymbol(e,!1).then(function(e){a(e)}):a(!1)}},t.prototype._executeHideMarkupStyleSelectorView=function(){this.isActive&&(this._currentWidget=null,this.app.command("DeactivateView").execute(this.id))},t.prototype._initializeStyleSelectors=function(){var e=this;if(this.viewModel.enableSymbolSelector){this._styleSelector=this.app.viewManager.createView({viewId:"MarkupSymbolSelectorView",markupResource:"Mapping/modules/Markup/MarkupStyles/MarkupSymbolSelector/MarkupSymbolSelectorView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupSymbolSelectorView",regionName:"MarkupStyleSelectorRegion",isVisible:!1,libraryId:"Mapping"}),this._styleSelector.onChange=function(t){e._lastUpdateSymbol=esri.symbol.fromJson(JSON.parse(t))};var t=new l.MarkupSymbolSelectorViewModel(this.app,"Mapping"),i=this.app.configModel.moduleConfigs.filter(function(e){return"Markup"===e.moduleName})[0],r=i.viewModelConfigs.filter(function(e){return"MarkupSymbolSelectorViewModel"===e.viewModelId})[0];t.initialize(r),this._styleSelector.attach(t),this._availableWidgets.push(this._styleSelector)}if(this.viewModel.enableImageSelector){this._imageSelector=this.app.viewManager.createView({viewId:"MarkupImageSelectorView",markupResource:"Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.PictureSymbolWidget",regionName:"MarkupStyleSelectorRegion",isVisible:!1,libraryId:"Mapping.Infrastructure"}),this._imageSelector.onChange=function(t){e.viewModel.markupSymbol&&JSON.stringify(e.viewModel.markupSymbol.toJson())===t||e.app.command("ChangeMarkupStyle").execute(t)},this._imageSelector.isMarkupView=!0;var n=new o.PictureSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),s=this.app.configModel.widgetConfigs.filter(function(e){return"PictureSymbolWidget"===e.id})[0];n.initialize(s.configuration),this._imageSelector.attach(n),this._availableWidgets.push(this._imageSelector)}if(this.viewModel.enableTemplateSelector){this._templateSelector=this.app.viewManager.createView({viewId:"MarkupTemplateSelectorView",markupResource:"Mapping/modules/Markup/MarkupStyles/MarkupTemplateSelector/MarkupTemplateSelectorView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupTemplateSelectorView",regionName:"MarkupStyleSelectorRegion",isVisible:!1,libraryId:"Mapping"});var p=new a.MarkupTemplateSelectorViewModel(this.app,"Mapping");this._templateSelector.onChange=function(t){e._lastUpdateSymbol=esri.symbol.fromJson(JSON.parse(t))};var i=this.app.configModel.moduleConfigs.filter(function(e){return"Markup"===e.moduleName})[0],r=i.viewModelConfigs.filter(function(e){return"MarkupTemplateSelectorViewModel"===e.viewModelId})[0];p.initialize(r.configuration),this._templateSelector.attach(p),this._availableWidgets.push(this._templateSelector)}this._currentWidget=this._getCurrentWidget(),this._initialized=!0},t.prototype.handleSelectorChange=function(e,t,i){this._changeMarkupSelector()},t.prototype.handleDoneButtonClick=function(e,t,i){this.app.command("DeactivateView").execute(this.id)},t.prototype.handleRevertButtonClick=function(e,t,i){this._styleSelector&&(this._lastUpdateSymbol=this._originalSymbol,this._styleSelector.updateSymbol(this._originalSymbol),this._editingMarkup?this.app.command("_applySymbolToEditedMarkup").execute(this._originalSymbol):this.app.command("ChangeMarkupStyle").execute(this._originalSymbol))},t.prototype.handleCustomizeButtonClick=function(e,t,i){this.viewModel.symbolSelectorItem&&(this._lastCustomSymbol[this.viewModel.markupType.get()]=this._lastUpdateSymbol,this.viewModel.currentSelector.set(this.viewModel.symbolSelectorItem),this._changeMarkupSelector(this._lastUpdateSymbol))},t.prototype._changeMarkupSelector=function(e){var t=this,i=e||(this._currentWidget?esri.symbol.fromJson(JSON.parse(this._currentWidget.getSymbol())):this.viewModel.markupSymbol);this._currentWidget&&"MarkupSymbolSelectorView"===this._currentWidget.id&&this._setLastCustomSymbol(i);var r=this.viewModel.currentSelector.get();this._currentWidget=this._getCurrentWidget(),"MarkupSymbolSelectorView"===r.id&&e&&this._styleSelector.updateSymbol(e),"MarkupTemplateSelectorView"===r.id&&(i instanceof esri.symbol.TextSymbol&&i.text&&this._templateSelector.viewModel.symbolText.set(i.text),this._templateSelector.viewModel.executeChangeMarkupFromId(this._templateSelector.viewModel.styleIndex),this._lastUpdateSymbol=esri.symbol.fromJson(JSON.parse(this._templateSelector.getSymbol()))),this.app.command("ActivateView").execute(r.id),this._availableWidgets.forEach(function(e){e.id!==r.id&&t.app.command("DeactivateView").execute(e.id)}),this._originalSymbol=this.viewModel.markupSymbol;var a=this._currentWidget.getSymbol();if(e||a){var o=e||esri.symbol.fromJson(JSON.parse(a));o instanceof esri.symbol.TextSymbol&&i instanceof esri.symbol.TextSymbol&&this._editingMarkup&&(o.setText(i.text),this._currentWidget.updateSymbol(o)),this._editingMarkup?this.app.command("_applySymbolToEditedMarkup").execute(e?JSON.stringify(e.toJson()):JSON.stringify(o.toJson())):this.app.command("ChangeMarkupStyle").execute(e?JSON.stringify(e.toJson()):JSON.stringify(o.toJson()))}},t.prototype._getCurrentWidget=function(){var e=this;return this._availableWidgets.filter(function(t){return t.id===e.viewModel.currentSelector.get().id})[0]},t.prototype._getDefaultSymbol=function(e){switch(e){case n.SymbolType.POINT:case n.SymbolType.MULTIPOINT:return r.defaultPointMarkup.get();case n.SymbolType.POLYLINE:return r.defaultPolylineMarkup.get();case n.SymbolType.POLYGON:return r.defaultPolygonMarkup.get();case n.SymbolType.TEXT:return r.defaultTextMarkup.get()}},t.prototype._setLastCustomSymbol=function(e){e instanceof esri.symbol.PictureMarkerSymbol||e instanceof esri.symbol.SimpleMarkerSymbol?this._lastCustomSymbol[n.SymbolType.POINT]=e:e instanceof esri.symbol.SimpleLineSymbol?this._lastCustomSymbol[n.SymbolType.POLYLINE]=e:e instanceof esri.symbol.SimpleFillSymbol?this._lastCustomSymbol[n.SymbolType.POLYGON]=e:e instanceof esri.symbol.TextSymbol&&(this._lastCustomSymbol[n.SymbolType.TEXT]=e)},t}(i.SmartPanelView);t.MarkupStyleView=s})},"Mapping/modules/Markup/MarkupStyles/MarkupStyleViewModel":function(){define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel","geocortex/framework/observables","geocortex/infrastructure/symbology/SymbolType"],function(e,t,i,r,a){"use strict";var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.enableImageSelector=!1,t.enableTemplateSelector=!1,t.enableSymbolSelector=!1,t.markupSelectors=new r.ObservableCollection([]),t.currentSelector=new r.Observable(null),t.showMarkupSelectorMenu=new r.Observable((!0)),t.markupType=new r.Observable(a.SymbolType.POINT),t.showRevertButton=new r.Observable((!0)),t.showCustomizeButton=new r.Observable((!0)),t}return __extends(t,e),t.prototype.initialize=function(t){var i=this;e.prototype.initialize.call(this,t),this.config=t,t.enableSymbolSelector||t.enableTemplateSelector||(t.enableSymbolSelector=!0),t.enableTemplateSelector&&(this.enableTemplateSelector=t.enableTemplateSelector,this.templateSelectorItem={displayName:this.app.getResource(this.libraryId,"language-markup-selector-template-displayname"),id:"MarkupTemplateSelectorView"},this.markupSelectors.addItem(this.templateSelectorItem)),t.enableImageSelector&&(this.enableImageSelector=t.enableImageSelector,this.imageSelectorItem={displayName:this.app.getResource(this.libraryId,"language-markup-selector-image-displayname"),id:"MarkupImageSelectorView"},this.markupSelectors.addItem(this.imageSelectorItem),this.markupType.bind(this,function(e){e!==a.SymbolType.POINT?i.markupSelectors.removeItem(i.imageSelectorItem):i.markupSelectors.contains(i.imageSelectorItem)||i.markupSelectors.insertItem(1,i.imageSelectorItem),i._setMenuVisibility()})),t.enableSymbolSelector&&(this.enableSymbolSelector=t.enableSymbolSelector,this.symbolSelectorItem={displayName:this.app.getResource(this.libraryId,"language-markup-selector-symbol-displayname"),id:"MarkupSymbolSelectorView"},this.markupSelectors.addItem(this.symbolSelectorItem)),this.currentSelector.bind(this,function(e){i.showRevertButton.set(i.symbolSelectorItem&&e.displayName===i.symbolSelectorItem.displayName),i.showCustomizeButton.set(i.templateSelectorItem&&e.displayName===i.templateSelectorItem.displayName)}),this.currentSelector.set(this.markupSelectors.getAt(0)),this._setMenuVisibility()},t.prototype._setMenuVisibility=function(){this.markupSelectors.getLength()<=1?this.showMarkupSelectorMenu.set(!1):this.showMarkupSelectorMenu.set(!0)},t}(i.SmartPanelViewModel);t.MarkupStyleViewModel=o})},"Mapping/modules/Markup/MarkupStyles/MarkupSymbolSelector/MarkupSymbolSelectorView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbolType","geocortex/infrastructure/symbology/widgets/SimpleSymbolWidgetViewModel","geocortex/infrastructure/symbology/widgets/TextSymbolWidgetViewModel","geocortex/infrastructure/SymbolUtils"],function(e,t,i,r,a,o,l){"use strict";var n=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.displayName=a.app.getResource(a.libraryId,"language-markup-selector-symbol-displayname"),a.markupType=r.SymbolType.POINT,a.initialized=!1,a.editingMarkup=!1,a.customSymbolCreated={},a}return __extends(t,e),t.prototype.attach=function(t){var i=this;e.prototype.attach.call(this,t),this.viewModel=t,this.initialized||(this._initializeStyleConfigurationViews(),this.app.event("MarkupTypeChangedEvent").subscribe(this,function(e){i.markupType=e,i._updateStyleConfigurationViews(e)}),this.app.event("MarkupSymbolChangedEvent").subscribe(this,function(e){i.markupSymbol=e}))},t.prototype.activated=function(){this.viewModel.textSymbolWidget&&this.markupType===r.SymbolType.TEXT?this.viewModel.textSymbolWidget.activated():this.viewModel.symbolWidget.activated()},t.prototype.updateSymbol=function(e,t){if(void 0===t&&(t=!0),"picturemarkersymbol"===e.type)return Promise.resolve(!1);var i=l.fromEsriSymbolType(e.type);return i?(i===r.SymbolType.TEXT?this.viewModel.textSymbolWidget.setFromSymbol(e,t):(this.viewModel.symbolWidget.setFromSymbol(e,t),this.customSymbolCreated[i]=!0),Promise.resolve(!0)):Promise.resolve(!1)},t.prototype.getSymbol=function(e){void 0===e&&(e=!0);var t;return this.markupType===r.SymbolType.TEXT?(e&&(this.viewModel.textSymbolWidget.activated(),this.viewModel.textSymbolWidget.applySettings()),t=this.viewModel.textSymbolWidget.getSymbol(e)):(this.customSymbolCreated[this.markupType]||(this.viewModel.symbolWidget.setFromSymbol(l.defaultMarkupSymbol(this.markupType)),this.customSymbolCreated[this.markupType]=!0),e&&this.viewModel.symbolWidget.activated(),t=this.viewModel.symbolWidget.getSymbol()),t},t.prototype._initializeStyleConfigurationViews=function(){var e=this,t=function(t){e.onChange&&e.onChange(t),e.editingMarkup?e.app.command("_applySymbolToEditedMarkup").execute(t):e.markupSymbol&&JSON.stringify(e.markupSymbol.toJson())===t||e.app.command("ChangeMarkupStyle").execute(t)};this.viewModel.symbolWidget=this.app.viewManager.createView({viewId:"MarkupSymbolWidget",markupResource:"Mapping/infrastructure/symbology/widgets/SimpleSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.SimpleSymbolWidget",regionName:"MarkupStyleConfigurationRegion",isVisible:!1,libraryId:"Mapping.Infrastructure"}),this.viewModel.symbolWidget.onChange=t.bind(this);var i=new a.SimpleSymbolWidgetViewModel(this.app,"Mapping.Infrastructure");i.parentSymbologyView=this,i.initialize(this.viewModel.config.configuration.symbologyConfig),this.viewModel.symbolWidget.attach(i),this.viewModel.textSymbolWidget=this.app.viewManager.createView({viewId:"TextMarkupSymbolWidget",markupResource:"Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.TextSymbolWidget",regionName:"MarkupStyleConfigurationRegion",isVisible:!1,libraryId:"Mapping.Infrastructure"}),this.viewModel.textSymbolWidget.onChange=t.bind(this);var r=new o.TextSymbolWidgetViewModel(this.app,"Mapping.Infrastructure");r.parentSymbologyView=this,r.initialize(this.viewModel.config.configuration.textSymbologyConfig),this.viewModel.textSymbolWidget.attach(r),this.initialized=!0},t.prototype._updateStyleConfigurationViews=function(e){e===r.SymbolType.TEXT?this.app.command("ActivateView").execute("TextMarkupSymbolWidget"):(this.viewModel.symbolWidget.setFeatureType(e),this.app.command("ActivateView").execute("MarkupSymbolWidget"))},t}(i.ViewBase);t.MarkupSymbolSelectorView=n})},"Mapping/modules/Markup/MarkupStyles/MarkupSymbolSelector/MarkupSymbolSelectorViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.config=t},t}(i.ViewModelBase);t.MarkupSymbolSelectorViewModel=r})},"Mapping/modules/Markup/MarkupStyles/MarkupTemplateSelector/MarkupTemplateSelectorView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbolType","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,i,r,a,o,l){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName=t.app.getResource(t.libraryId,"language-markup-selector-template-displayname"),t.initialized=!1,t.editingMarkup=!1,t._swatchSize=64,t}return __extends(t,e),t.prototype.attach=function(t){e.prototype.attach.call(this,t),this.viewModel.createSwatches=this.createSwatches.bind(this)},t.prototype.activated=function(){this.viewModel.loading||this.loadCurrentLibrary()},t.prototype.getSymbol=function(){return this.viewModel._getSymbol()},t.prototype.createSwatches=function(e){for(var t=$(".markup-swatch-{0}".format(e[0].type),this.root),i=0;i<t.length;i++)t[i].id="__{0}__{1}".format(e[i].type,i),t[i].onclick=dojo.hitch(this,this.handleClickStyle),this.viewModel.markupType===r.SymbolType.TEXT?a.createTextSymbolSwatch(t[i],this._swatchSize,e[i].toSymbol(),this._getMarkupLayer()):a.createSymbolSwatch(t[i],this._swatchSize,e[i].toSymbol())},t.prototype.loadTemplates=function(){this.viewModel._loadAllTemplates()},t.prototype.loadCurrentLibrary=function(){this.viewModel.loading||this.app.site.isInitialized&&this.viewModel.currentTemplates[this.viewModel.markupType].get()&&0===this.viewModel.currentTemplates[this.viewModel.markupType].getLength()&&this.viewModel.currentLibraries[this.viewModel.markupType].pulse()},t.prototype.updateSymbol=function(e,t){return void 0===t&&(t=!0),e instanceof esri.symbol.PictureMarkerSymbol?Promise.resolve(!1):(this.loadCurrentLibrary(),this.viewModel._updateSymbol(e,t))},t.prototype.handleClickStyle=function(e){this.viewModel.styleIndex=this._getIdNumber(e||window.event),this.viewModel.currentStyleIndex[this.viewModel.markupType]=this.viewModel.styleIndex,this.viewModel.executeChangeMarkupFromId(this.viewModel.styleIndex),this.onChange&&this.onChange(this.getSymbol())},t.prototype.handleTextChange=function(e){this.viewModel.executeChangeMarkupFromId(this.viewModel.styleIndex),this.onChange&&this.onChange(this.getSymbol())},t.prototype.handleLibraryChange=function(e){this.viewModel.setSymbolOnLibraryChange=!0},t.prototype._getMarkupLayer=function(){var e=l.getInternalGraphicsLayer(o.MARKUP_LAYER_ID,this.app,l.GraphicsLayerType.Markup);return this.app.markupLayer.set(e),e},t.prototype._getIdNumber=function(e){var e=e||window.event,t=e.currentTarget?e.currentTarget.id:this._getId(e.target||e.srcElement),i=parseInt(t.replace(/^\D+/g,""));return i},t.prototype._getId=function(e){return null==e?"":"BUTTON"==e.tagName&&e.id?e.id:this._getId(e.parentNode)},t}(i.ViewBase);t.MarkupTemplateSelectorView=n})},"Mapping/modules/Markup/MarkupStyles/MarkupTemplateSelector/MarkupTemplateSelectorViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/ColorUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/symbology/SymbolType","geocortex/framework-ui/LazyObservable","geocortex/essentials/utilities/UrlUtilities","geocortex/infrastructure/BrowserUtils"],function(e,t,i,r,a,o,l,n,s,p){"use strict";var u=function(e){function t(t,i){var a=e.call(this,t,i)||this;a.markupType=null,a.legacyLibraryName=a.app.getResource(a.libraryId,"language-markup-legacy-library-name"),a.esriStyleLookup={point:{circle:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,diamond:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,square:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE},polyline:{dash:esri.symbol.SimpleLineSymbol.STYLE_DASH,"dash dot":esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,"dash dot dot":esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT,dot:esri.symbol.SimpleLineSymbol.STYLE_DOT,solid:esri.symbol.SimpleLineSymbol.STYLE_SOLID},polygon:{solid:esri.symbol.SimpleFillSymbol.STYLE_SOLID,"forward diagonal":esri.symbol.SimpleFillSymbol.STYLE_FORWARD_DIAGONAL,"backward diagonal":esri.symbol.SimpleFillSymbol.STYLE_BACKWARD_DIAGONAL,cross:esri.symbol.SimpleFillSymbol.STYLE_CROSS,"diagonal cross":esri.symbol.SimpleFillSymbol.STYLE_DIAGONAL_CROSS,horizontal:esri.symbol.SimpleFillSymbol.STYLE_HORIZONTAL,vertical:esri.symbol.SimpleFillSymbol.STYLE_VERTICAL},text:{italic:esri.symbol.Font.STYLE_ITALIC,normal:esri.symbol.Font.STYLE_NORMAL,oblique:esri.symbol.Font.STYLE_OBLIQUE,bold:esri.symbol.Font.WEIGHT_BOLD,bolder:esri.symbol.Font.WEIGHT_BOLDER,lighter:esri.symbol.Font.WEIGHT_LIGHTER}},a.isPoint=new r.Observable((!1)),a.isLine=new r.Observable((!1)),a.isPolygon=new r.Observable((!1)),a.isText=new r.Observable((!1)),a.styleIndex=0,a.currentStyleIndex={},a.currentTemplate=new r.Observable(null),a.pointLibraries=new r.ObservableCollection([]),a.lineLibraries=new r.ObservableCollection([]),a.polygonLibraries=new r.ObservableCollection([]),a.textLibraries=new r.ObservableCollection([]),a.libraries={},a.currentPointLibrary=new r.Observable(""),a.currentLineLibrary=new r.Observable(""),a.currentPolygonLibrary=new r.Observable(""),a.currentTextLibrary=new r.Observable(""),a.currentLibraries={},a.currentPointTemplates=new r.ObservableCollection,a.currentLineTemplates=new r.ObservableCollection,a.currentPolygonTemplates=new r.ObservableCollection,a.currentTextTemplates=new r.ObservableCollection,a.currentTemplates={},a.pointTemplates={},a.lineTemplates={},a.polygonTemplates={},a.textTemplates={},a.templates={},a.symbolText=new r.Observable(""),a.showLibrarySwitcher=new r.Observable((!1)),a.noLibraries={},a.noPointLibraries=new r.Observable((!1)),a.noLineLibraries=new r.Observable((!1)),a.noPolygonLibraries=new r.Observable((!1)),a.noTextLibraries=new r.Observable((!1)),a.loading=!1,a.initialized=!1,a.setSymbolOnLibraryChange=!1,a._isIE9or11=!1;var o=p.isIE();return a._isIE9or11=9===o||11===o,a.app.command("ChangeMarkupStyleFromId").register(a,a.executeChangeMarkupFromId),a}return __extends(t,e),t.prototype.initialize=function(e){var t=this;this.initialized||(void 0!==e.pointLibraries&&dojo.isArray(e.pointLibraries)&&this.pointLibraries.set(e.pointLibraries),void 0!==e.lineLibraries&&dojo.isArray(e.lineLibraries)&&this.lineLibraries.set(e.lineLibraries),void 0!==e.polygonLibraries&&dojo.isArray(e.polygonLibraries)&&this.polygonLibraries.set(e.polygonLibraries),void 0!==e.textLibraries&&dojo.isArray(e.textLibraries)&&this.textLibraries.set(e.textLibraries),e.customPointStyles&&e.customPointStyles.length>0&&this.initializePointStyles(e.customPointStyles),e.customLineStyles&&e.customLineStyles.length>0&&this.initializeLineStyles(e.customLineStyles),e.customPolygonStyles&&e.customPolygonStyles.length>0&&this.initializePolygonStyles(e.customPolygonStyles),e.customTextStyles&&e.customTextStyles.length>0&&this.initializeTextStyles(e.customTextStyles),this.libraries[l.SymbolType.POINT]=this.pointLibraries,this.libraries[l.SymbolType.POLYLINE]=this.lineLibraries,this.libraries[l.SymbolType.POLYGON]=this.polygonLibraries,this.libraries[l.SymbolType.TEXT]=this.textLibraries,this.currentPointLibrary.set(this.libraries[l.SymbolType.POINT].getAt(0)),this.currentLibraries[l.SymbolType.POINT]=this.currentPointLibrary,this.currentLineLibrary.set(this.libraries[l.SymbolType.POLYLINE].getAt(0)),this.currentLibraries[l.SymbolType.POLYLINE]=this.currentLineLibrary,this.currentPolygonLibrary.set(this.libraries[l.SymbolType.POLYGON].getAt(0)),this.currentLibraries[l.SymbolType.POLYGON]=this.currentPolygonLibrary,this.currentTextLibrary.set(this.libraries[l.SymbolType.TEXT].getAt(0)),this.currentLibraries[l.SymbolType.TEXT]=this.currentTextLibrary,this.currentTemplates[l.SymbolType.POINT]=this.currentPointTemplates,this.currentTemplates[l.SymbolType.POLYLINE]=this.currentLineTemplates,this.currentTemplates[l.SymbolType.POLYGON]=this.currentPolygonTemplates,this.currentTemplates[l.SymbolType.TEXT]=this.currentTextTemplates,this.templates[l.SymbolType.POINT]=this.pointTemplates,this.templates[l.SymbolType.POLYLINE]=this.lineTemplates,this.templates[l.SymbolType.POLYGON]=this.polygonTemplates,this.templates[l.SymbolType.TEXT]=this.textTemplates,this.noLibraries[l.SymbolType.POINT]=this.noPointLibraries,this.noLibraries[l.SymbolType.POLYLINE]=this.noLineLibraries,this.noLibraries[l.SymbolType.POLYGON]=this.noPolygonLibraries,this.noLibraries[l.SymbolType.TEXT]=this.noTextLibraries,this.currentPointLibrary.bind(this,function(e){e&&t._setTemplates(t.pointTemplates,e,t.currentPointTemplates)}),this.currentLineLibrary.bind(this,function(e){e&&t._setTemplates(t.lineTemplates,e,t.currentLineTemplates)}),this.currentPolygonLibrary.bind(this,function(e){e&&t._setTemplates(t.polygonTemplates,e,t.currentPolygonTemplates)}),this.currentTextLibrary.bind(this,function(e){e&&t._setTemplates(t.textTemplates,e,t.currentTextTemplates)}),this.currentStyleIndex[l.SymbolType.POINT]=0,this.currentStyleIndex[l.SymbolType.POLYGON]=0,this.currentStyleIndex[l.SymbolType.POLYLINE]=0,this.currentStyleIndex[l.SymbolType.TEXT]=0,this.app.event("MarkupTypeChangedEvent").subscribe(this,function(e){t.markupType!==e&&(t.markupType=e,t.showLibrarySwitcher.set(t.libraries[e]&&t.libraries[e].getLength()>1),t.currentTemplate.set({name:""}),t.isPoint.set(e===l.SymbolType.POINT),t.isLine.set(e===l.SymbolType.POLYLINE),t.isPolygon.set(e===l.SymbolType.POLYGON),t.isText.set(e===l.SymbolType.TEXT),t.styleIndex=t.currentStyleIndex[e]||0)}),this.app.event("MarkupSymbolChangedEvent").subscribe(this,function(e){e instanceof esri.symbol.TextSymbol&&e.text&&!t.symbolText.get()&&t.symbolText.set(e.text),t.markupSymbol=e}),this.initialized=!0)},t.prototype.executeChangeMarkupFromId=function(e){var t=this.currentTemplates[this.markupType].getItems();if(!(e>t.length-1||e<0)&&t.length>0){for(var i=0,r=t;i<r.length;i++){var a=r[i];a.selected.set(!1)}var o=t[e];o.selected.set(!0),this.currentTemplate.set(o);var l=this._getSymbol(),n=esri.symbol.fromJson(JSON.parse(l));n instanceof esri.symbol.TextSymbol&&(n.setText(this.symbolText.get()),l=JSON.stringify(n.toJson())),this.markupSymbol&&JSON.stringify(this.markupSymbol.toJson())===l||this.app.command("ChangeMarkupStyle").execute(l)}},t.prototype._getSymbol=function(){var e;if(this.currentTemplate.get())if(this.markupType===l.SymbolType.TEXT&&this.symbolText.get()){var t=this.currentTemplate.get().toSymbol();t.setText(this.symbolText.get()),e=JSON.stringify(t.toJson())}else e=this.currentTemplate.get().toJsonString();return e},t.prototype._updateSymbol=function(e,t){var i=this;e instanceof esri.symbol.TextSymbol&&e.text&&this.symbolText.set(e.text);var r,a=new Promise(function(a,l){if(e instanceof esri.symbol.TextSymbol){r=new esri.symbol.TextSymbol(e.toJson()),r.setText("");var n=r.font;n.setFamily(r.font.family.split(",")[0]),n.setDecoration(n.decoration||esri.symbol.TextSymbol.DECORATION_NONE)}else r=e;var s=o.stringToHash(JSON.stringify(r.toJson())),p=null,u=i.libraries[i.markupType].getItems().sort(function(e,t){return e===i.currentLibraries[i.markupType].get()?1:-1}),c=function(){for(var r=0;r<u.length;r++){var o=i.templates[i.markupType][u[r]];if(o&&(p=o.filter(function(e){return e.hash.get()===s})[0]))break}return p?(i.currentLibraries[i.markupType].set(u[r]),i.styleIndex=i.currentTemplates[i.markupType].indexOf(p),i.currentStyleIndex[i.markupType]=i.styleIndex,e instanceof esri.symbol.TextSymbol&&i.symbolText.set(e.text),t&&i.executeChangeMarkupFromId(i.styleIndex),void a(!0)):void a(!1)};i.templates[i.markupType][u[0]]?c():i._loadAllTemplates().then(function(){c()})});return a},t.prototype._setTemplates=function(e,t,i){var r=this;if(e[t]){for(var a=0;a<e[t].length;a++)if(e[t][a].selected.get()){this.currentTemplate.set(e[t][a]),this.styleIndex=a,this.currentStyleIndex[this.markupType]=a;break}i.set(e[t]),this.createSwatches(e[t]),this.setSymbolOnLibraryChange&&(this.executeChangeMarkupFromId(a),this.setSymbolOnLibraryChange=!1)}else this._loadTemplates(e,t).then(function(e){e&&(r.currentTemplate.set(e[0]),r.styleIndex=0,r.currentStyleIndex[r.markupType]=0,i.set(e),r.createSwatches(e),r.setSymbolOnLibraryChange&&(r.executeChangeMarkupFromId(0),r.setSymbolOnLibraryChange=!1))})},t.prototype._loadTemplates=function(e,t){var i=this;this.loading=!0;var r=[],a=new Promise(function(a,o){var n=function(e){switch(e){case l.SymbolType.POINT:case l.SymbolType.MULTIPOINT:return"point";case l.SymbolType.POLYGON:return"polygon";case l.SymbolType.POLYLINE:return"line";case l.SymbolType.TEXT:return"text";default:return e}};if(i.app.site.getEssentialsVersion()<4.07)return i._handleInvalidLibrary(t),i.loading=!1,i.app.trace.debug("Could not load symbol library '{0}'. Essentials 4.7 or newer is required.".format(t)),void a(null);var p=/^(.*?)(\/*)$/.exec(i.app.site.originalUrl)[1],u=s.UrlUtilities.simplify(p+"/../../symbols/{1}/{0}".format(t,n(i.markupType)));esri.request({url:u,content:{f:"json"},handleAs:"json"}).then(function(o){var n=o&&o.symbols;if(!$.isArray(n))throw new Error(i.app.getResource("Mapping.Infrastructure","language-symbology-errors-malformed-library").format(t));for(var s=0;s<n.length;s++)switch(i.markupType){case l.SymbolType.POINT:case l.SymbolType.MULTIPOINT:var p=esri.symbol.fromJson(n[s]);if(p&&p instanceof esri.symbol.SimpleMarkerSymbol){var u=i._createPointTemplate(n[s].name,p.color,p.style,p.size,p.outline.color,p.outline.style,p.outline.width);u.selected.set(!s),r.push(u)}break;case l.SymbolType.POLYLINE:var c=esri.symbol.fromJson(n[s]);if(c&&c instanceof esri.symbol.SimpleLineSymbol){var m=i._createLineTemplate(n[s].name,c.color,c.style,c.width);m.selected.set(!s),r.push(m)}break;case l.SymbolType.POLYGON:var d=esri.symbol.fromJson(n[s]);if(d&&d instanceof esri.symbol.SimpleFillSymbol){var y=i._createPolygonTemplate(n[s].name,d.outline.color,d.color,d.outline.style,d.style,d.outline.width);y.selected.set(!s),r.push(y)}break;case l.SymbolType.TEXT:var h=esri.symbol.fromJson(n[s]);if(h&&h instanceof esri.symbol.TextSymbol){var b=i._createTextTemplate(n[s].name,h.color,h.font.family,h.font.style,h.font.weight,h.font.decoration,h.font.size,h.haloColor,h.haloSize);b.selected.set(!s),r.push(b)}}i.loading=!1,0===r.length?(i._handleInvalidLibrary(t),a(null)):(e[t]=r,a(e[t]))},function(e){i._handleInvalidLibrary(t),i.loading=!1,o(e)})});return a},t.prototype._loadAllTemplates=function(){var e=this,t=new Promise(function(t,i){for(var r=[],a=e.libraries[e.markupType].getItems(),o=0;o<a.length;o++){var l=a[o];e.currentTemplates[l]||r.push(e._loadTemplates(e.templates[e.markupType],l))}r.length>0?Promise.all(r).then(function(){t()}):t()});return t},t.prototype._handleInvalidLibrary=function(e){this.libraries[this.markupType].removeItem(e),1===this.libraries[this.markupType].getLength()&&this.showLibrarySwitcher.set(!1),0===this.libraries[this.markupType].getLength()&&(this.currentLibraries[this.markupType].set(null),this.showLibrarySwitcher.set(!1),this.noLibraries[this.markupType].set(!0),this.currentTemplate.set({name:""}))},t.prototype.initializePointStyles=function(e){this.pointLibraries.addItem(this.legacyLibraryName),this.pointTemplates[this.legacyLibraryName]=[];for(var t=0;t<e.length;t++)if(e[t].length<4)this.app.trace.warning("Point Style "+(t+1)+" in the style selector has an incorrect number of elements.");else{var i=this._createPointTemplate("",a.getColorFromString(e[t][1]),this.esriStyleLookup[l.SymbolType.POINT][e[t][2].toLowerCase()],e[t][3]);i.selected.set(!t),this.pointTemplates[this.legacyLibraryName].push(i)}},t.prototype.initializeLineStyles=function(e){this.lineLibraries.addItem(this.legacyLibraryName),this.lineTemplates[this.legacyLibraryName]=[];for(var t=0;t<e.length;t++)if(e[t].length<4)this.app.trace.warning("Line Style "+(t+1)+" in the style selector has an incorrect number of elements.");else{var i=this._createLineTemplate("",a.getColorFromString(e[t][1]),this.esriStyleLookup[l.SymbolType.POLYLINE][e[t][2].toLowerCase()],e[t][3]);i.selected.set(!t),this.lineTemplates[this.legacyLibraryName].push(i)}},t.prototype.initializePolygonStyles=function(e){this.polygonLibraries.addItem(this.legacyLibraryName),this.polygonTemplates[this.legacyLibraryName]=[];for(var t=0;t<e.length;t++)if(e[t].length<6)this.app.trace.warning("Polygon Style "+(t+1)+" in the style selector has an incorrect number of elements.");else{var i=this._createPolygonTemplate("",a.getColorFromString(e[t][1]),a.getColorFromString(e[t][2]),this.esriStyleLookup[l.SymbolType.POLYLINE][e[t][3].toLowerCase()],this.esriStyleLookup[l.SymbolType.POLYGON][e[t][4].toLowerCase()],e[t][5]);
i.selected.set(!t),this.polygonTemplates[this.legacyLibraryName].push(i)}},t.prototype.initializeTextStyles=function(e){this.textLibraries.addItem(this.legacyLibraryName),this.textTemplates[this.legacyLibraryName]=[];for(var t=0;t<e.length;t++)if(e[t].length<6)this.app.trace.warning("Text Style "+(t+1)+" in the style selector has an incorrect number of elements.");else{var i=this._createTextTemplate("",a.getColorFromString(e[t][1]),e[t][5],this.esriStyleLookup[l.SymbolType.TEXT][e[t][2].toLowerCase()],this.esriStyleLookup[l.SymbolType.TEXT][e[t][3].toLowerCase()],esri.symbol.TextSymbol.DECORATION_NONE,e[t][4],a.getColorFromString("#FFFFFF"),0);i.selected.set(!t),this.textTemplates[this.legacyLibraryName].push(i)}},t.prototype._createPointTemplate=function(e,t,i,a,s,p,u){var c=this,m={type:l.SymbolType.POINT,name:e,hash:new n.LazyObservable(null,function(){return o.stringToHash(m.toJsonString())},(!0)),color:t.toRgba(),style:i,size:a,selected:new r.Observable((!1)),outlineColor:s?s.toRgba():null,outlineStyle:p,outlineWidth:u,toSymbol:function(){return c._pointTemplateToSymbol(m)},toJsonString:function(){return JSON.stringify(m.toSymbol().toJson())}};return m},t.prototype._createLineTemplate=function(e,t,i,a){var s=this,p={type:l.SymbolType.POLYLINE,name:e,hash:new n.LazyObservable(null,function(){return o.stringToHash(p.toJsonString())},(!0)),color:t.toRgba(),style:i,width:a,selected:new r.Observable((!1)),toSymbol:function(){return s._lineTemplateToSymbol(p)},toJsonString:function(){return JSON.stringify(p.toSymbol().toJson())}};return p},t.prototype._createPolygonTemplate=function(e,t,i,a,s,p){var u=this,c={type:l.SymbolType.POLYGON,name:e,hash:new n.LazyObservable(null,function(){return o.stringToHash(c.toJsonString())},(!0)),borderColor:t.toRgba(),fillColor:i.toRgba(),borderStyle:a,fillStyle:s,borderWidth:p,selected:new r.Observable((!1)),toSymbol:function(){return u._polygonTemplateToSymbol(c)},toJsonString:function(){return JSON.stringify(c.toSymbol().toJson())}};return c},t.prototype._createTextTemplate=function(e,t,i,a,s,p,u,c,m){var d=this,y={type:l.SymbolType.TEXT,name:e,hash:new n.LazyObservable(null,function(){return o.stringToHash(y.toJsonString())},(!0)),textFamily:i,style:a,weight:s,decoration:p,size:u,color:t.toRgba(),haloColor:null,haloSize:null,selected:new r.Observable((!1)),toSymbol:function(){return d._textTemplateToSymbol(y)},toJsonString:function(){return JSON.stringify(y.toSymbol().toJson())}};return this._isIE9or11||(y.haloColor=c?c.toRgba():null,y.haloSize=m),y},t.prototype._pointTemplateToSymbol=function(e){var t=new esri.symbol.SimpleMarkerSymbol;return t.setStyle(e.style),t.setSize(e.size),t.setColor(new esri.Color(e.color)),t.setOutline(new esri.symbol.SimpleLineSymbol),t.outline.setWidth(e.outlineWidth||0),t.outline.setColor(new esri.Color(e.outlineColor||e.color)),t.outline.setStyle(e.outlineStyle||esri.symbol.SimpleLineSymbol.STYLE_SOLID),t},t.prototype._lineTemplateToSymbol=function(e){var t=new esri.symbol.SimpleLineSymbol;return t.setStyle(e.style),t.setWidth(e.width),t.setColor(new esri.Color(e.color)),t},t.prototype._polygonTemplateToSymbol=function(e){var t=new esri.symbol.SimpleFillSymbol,i=new esri.symbol.SimpleLineSymbol;return i.setStyle(e.borderStyle),i.setWidth(e.borderWidth),i.setColor(new esri.Color(e.borderColor)),t.setOutline(i),t.setStyle(e.fillStyle),t.setColor(new esri.Color(e.fillColor)),t},t.prototype._textTemplateToSymbol=function(e){var t=new esri.symbol.TextSymbol(""),i=new esri.symbol.Font;return i.setFamily(e.textFamily.split(",")[0]),i.setSize(e.size),i.setStyle(e.style||esri.symbol.Font.STYLE_NORMAL),i.setWeight(e.weight||esri.symbol.Font.WEIGHT_NORMAL),t.setFont(i),t.setDecoration(e.decoration||esri.symbol.TextSymbol.DECORATION_NONE),t.setColor(new esri.Color(e.color)),this._isIE9or11||(t.setHaloSize(e.haloSize),t.setHaloColor(new esri.Color(e.haloColor))),t.setAlign(esri.symbol.TextSymbol.ALIGN_START),t},t}(i.ViewModelBase);t.MarkupTemplateSelectorViewModel=u})},"Mapping/modules/Markup/ToolPalettes/TransientMarkupPaletteView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleClickDone=function(e,t,i){this.viewModel.editToggled.set(!1),this.viewModel.deleteToggled.set(!1),this.app.command("StopEditingMarkup").execute(),this.app.command("ClearActiveTool").execute()},t.prototype.handleClickEdit=function(e,t,i){var r=this;if(this.viewModel.deleteToggled.get()&&this.viewModel.deleteToggled.set(!1),this.viewModel.editToggled.get())this.app.command("ClearActiveTool").execute();else{this.app.command("SetActiveTool").execute("EditMarkupTool"),this.viewModel.editToggled.set(!0);var a=this.app.event("ActiveToolChangedEvent").subscribe(this,function(){r.viewModel.editToggled.set(!1),r.app.event("ActiveToolChangedEvent").unsubscribe(a)})}},t.prototype.handleClickDelete=function(e,t,i){var r=this;if(!this.viewModel.clearDisabled.get())if(this.viewModel.editToggled.get()&&this.viewModel.editToggled.set(!1),this.viewModel.deleteToggled.get())this.app.command("ClearActiveTool").execute();else{this.app.command("SetActiveTool").execute("DeleteMarkupTool"),this.viewModel.deleteToggled.set(!0);var a=this.app.event("ActiveToolChangedEvent").subscribe(this,function(){r.viewModel.deleteToggled.set(!1),r.app.event("ActiveToolChangedEvent").unsubscribe(a)})}},t.prototype.handleClickChangeStyle=function(){this.app.command("CreateMarkupStyleView").execute()},t.prototype.handleClickClear=function(e,t,i){this.app.command("StopEditingMarkup").execute(),this.app.command("ClearMarkup").execute()},t}(i.ViewBase);t.TransientMarkupPaletteView=r})},"Mapping/modules/Markup/ToolPalettes/TransientMarkupPaletteViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clearDisabled=new r.Observable((!0)),t.changeStyleDisabled=new r.Observable((!0)),t.markupCounter=new r.Observable(0),t.deleteToggled=new r.Observable((!1)),t.editToggled=new r.Observable((!1)),t.previousTool=null,t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.markupCounter.bind(this,this.evaluateMarkupCounter),this.registerEventsClearDisabled(),this.registerEventsChangeStyleDisabled()},t.prototype.registerEventsChangeStyleDisabled=function(){var e=this;this.app.event("ActiveToolChangedEvent").subscribe(this,function(t){var i=null,r=null;t.tool&&(i=t.tool.name),t.previousTool&&(r=t.previousTool.name),e.isMarkupTool(r)&&e.changeStyleDisabled.set(!0),e.isMarkupTool(i)&&e.changeStyleDisabled.set(!1)}),this.app.event("MarkupEditingStartedEvent").subscribe(this,function(){e.changeStyleDisabled.set(!1)}),this.app.event("MarkupEditingStoppedEvent").subscribe(this,function(){e.changeStyleDisabled.set(!0)})},t.prototype.registerEventsClearDisabled=function(){var e=this;this.app.event("MarkupAddedEvent").subscribe(this,function(){e.markupCounter.set(e.markupCounter.get()+1)}),this.app.event("MeasurementMarkupAdded").subscribe(this,function(){e.markupCounter.set(e.markupCounter.get()+1)}),this.app.event("MarkupDeletedEvent").subscribe(this,function(t){t.measurementId||e.markupCounter.set(e.markupCounter.get()-1)}),this.app.event("MeasurementMarkupDeleted").subscribe(this,function(t){t.graphic&&t.graphic.measurementId&&e.markupCounter.set(e.markupCounter.get()-1)}),this.app.event("MarkupClearedEvent").subscribe(this,function(){e.markupCounter.set(0)})},t.prototype.evaluateMarkupCounter=function(){if(this.markupCounter.get()>0)this.clearDisabled.set(!1);else{var e=this.app.toolRegistry.getActiveTool();e&&"DeleteMarkupTool"===e.name&&this.app.command("ClearActiveTool").execute(),this.clearDisabled.set(!0)}},t.prototype.isMarkupTool=function(e){var t=this.app.getFrameworkObjectById("MarkupViewModel").markupTools;return $.inArray(e,t.point)!=-1||($.inArray(e,t.polyline)!=-1||($.inArray(e,t.polygon)!=-1||$.inArray(e,t.text)!=-1))},t}(i.ViewModelBase);t.TransientMarkupPaletteViewModel=a})},"url:/Mapping/modules/Markup/MarkupStyles/MarkupStyleView.html":'<div class="markup-style panel-group-contents gcx-sticky-content has-footer">\r\n\r\n    <!-- Markup type selector -->\r\n    <div class="markup-type-selector form-item" data-binding="{@visible: showMarkupSelectorMenu}">\r\n        <label class="symbology-label" data-binding="{@text: @language-markup-select-style-type}"></label>\r\n        <select data-binding="{@source: markupSelectors}{@value: currentSelector}{@event-onchange: handleSelectorChange}" class="symbology-select">\r\n            <option data-binding="{@template-for: markupSelectors}{@text: displayName}{@attach: @context}"></option>\r\n        </select>\r\n    </div>\r\n\r\n    <!-- BEGIN: Content region -->\r\n    <div class="markup-style-selector" data-binding="{data-region-name: regionName}{data-region-adapter: regionType}{@var: scrollRegionElement}{@event-onscroll: handleScrollChange}"></div>\r\n    <!-- END: Content region -->\r\n\r\n</div>\r\n<div class="form-btns gcx-sticky-footer">\r\n    <button class="button" data-binding="{@event-click: handleDoneButtonClick}{@text: @language-common-done}"></button>\r\n    <button class="button" data-binding="{@event-click: handleCustomizeButtonClick}{@text: @language-common-customize}{@visible: showCustomizeButton}"></button>\r\n    <button class="button" data-binding="{@event-click: handleRevertButtonClick}{@text: @language-common-revert}{@visible: showRevertButton}"></button>\r\n</div>\r\n',"url:/Mapping/modules/Markup/MarkupStyles/MarkupSymbolSelector/MarkupSymbolSelectorView.html":'<!-- BEGIN: Content region -->\r\n<div class="markup-configuration-selector" data-region-name="MarkupStyleConfigurationRegion" data-region-adapter="geocortex.framework.ui.MultiDivRegionAdapter"></div>\r\n<!-- END: Content region -->',"url:/Mapping/modules/Markup/MarkupStyles/MarkupTemplateSelector/MarkupTemplateSelectorView.html":'<!-- Symbol Text -->\r\n<div class="symbology-textinput" data-binding="{@visible: isText}">\r\n    <div class="form-item" data-binding="{@hidden: noTextLibraries}">\r\n        <label class="symbology-label" data-binding="{@text: @language-common-text}"></label>\r\n        <input type="text" data-binding="{@value: symbolText}{@event-oninput: handleTextChange}{@event-onchange: handleTextChange}" />\r\n    </div>\r\n</div>\r\n\r\n<!-- Current Template Name -->\r\n<div data-binding="{@source: currentTemplate}">\r\n    <span class="symbol-name" data-binding="{@template-for: currentTemplate}{@text: name}"></span>\r\n</div>\r\n\r\n<!-- Point Templates -->\r\n<div class="style-selector markup point" data-binding="{@visible: isPoint}">\r\n\r\n    <!-- Template Selector -->\r\n    <div class="swatch-container template-container" data-binding="{@source: currentPointTemplates}{@hidden: noPointLibraries}">\r\n        <button class="markup-swatch markup-swatch-point" data-binding="{@template-for: currentPointTemplates}{@class-selected: selected}"></button>\r\n    </div>\r\n\r\n    <!-- Library Switcher -->\r\n    <span class="image-library-selector form-item inline-block" data-binding="{@visible: showLibrarySwitcher}">\r\n        <label class="symbology-label" data-binding="{@text: @language-common-library}"></label>\r\n        <select data-binding="{@source: pointLibraries}{@value: currentPointLibrary}{@event-oninput: handleLibraryChange}{@event-onchange: handleLibraryChange}">\r\n            <option data-binding="{@template-for: pointLibraries}{@text: @context}{@attach: @context}"></option>\r\n        </select>\r\n    </span>\r\n\r\n    <div class="no-symbol-library" data-binding="{@visible: noPointLibraries}">\r\n        <span data-binding="{@text: @language-markup-nolibraries}" />\r\n    </div>\r\n</div>\r\n\r\n<!-- Polyline Templates -->\r\n<div class="style-selector markup polyline" data-binding="{@visible: isLine}">\r\n\r\n    <!-- Template Selector -->\r\n    <div class="swatch-container template-container" data-binding="{@source: currentLineTemplates}{@hidden: noLineLibraries}">\r\n        <button class="markup-swatch markup-swatch-polyline" data-binding="{@template-for: currentLineTemplates}{@class-selected: selected}"></button>\r\n    </div>\r\n\r\n    <!-- Library Switcher -->\r\n    <span class="image-library-selector form-item inline-block" data-binding="{@visible: showLibrarySwitcher}">\r\n        <label class="symbology-label" data-binding="{@text: @language-common-library}"></label>\r\n        <select data-binding="{@source: lineLibraries}{@value: currentLineLibrary}{@event-oninput: handleLibraryChange}{@event-onchange: handleLibraryChange}">\r\n            <option data-binding="{@template-for: lineLibraries}{@text: @context}{@attach: @context}"></option>\r\n        </select>\r\n    </span>\r\n\r\n    <div class="no-symbol-library" data-binding="{@visible: noLineLibraries}">\r\n        <span data-binding="{@text:  @language-markup-nolibraries}" />\r\n    </div>\r\n</div>\r\n\r\n<!-- Polygon Templates -->\r\n<div class="style-selector markup polygon" data-binding="{@visible: isPolygon}">\r\n\r\n    <!-- Template Selector -->\r\n    <div class="swatch-container template-container" data-binding="{@source: currentPolygonTemplates}{@hidden: noPolygonLibraries}">\r\n        <button class="markup-swatch markup-swatch-polygon" data-binding="{@template-for: currentPolygonTemplates}{@class-selected: selected}"></button>\r\n    </div>\r\n\r\n    <!-- Library Switcher -->\r\n    <span class="image-library-selector form-item inline-block" data-binding="{@visible: showLibrarySwitcher}">\r\n        <label class="symbology-label" data-binding="{@text: @language-common-library}"></label>\r\n        <select data-binding="{@source: polygonLibraries}{@value: currentPolygonLibrary}{@event-oninput: handleLibraryChange}{@event-onchange: handleLibraryChange}">\r\n            <option data-binding="{@template-for: polygonLibraries}{@text: @context}{@attach: @context}"></option>\r\n        </select>\r\n    </span>\r\n\r\n    <div class="no-symbol-library" data-binding="{@visible: noPolygonLibraries}">\r\n        <span data-binding="{@text:  @language-markup-nolibraries}" />\r\n    </div>\r\n</div>\r\n\r\n<!-- Text Templates -->\r\n<div class="style-selector markup text" data-binding="{@visible: isText}">\r\n\r\n    <!-- Template Selector -->\r\n    <div class="swatch-container template-container" data-binding="{@source: currentTextTemplates}{@hidden: noTextLibraries}">\r\n        <button class="markup-swatch markup-swatch-text" data-binding="{@template-for: currentTextTemplates}{@class-selected: selected}"></button>\r\n    </div>\r\n\r\n    <!-- Library Switcher -->\r\n    <span class="image-library-selector form-item inline-block" data-binding="{@visible: showLibrarySwitcher}">\r\n        <label class="symbology-label" data-binding="{@text: @language-common-library}"></label>\r\n        <select data-binding="{@source: textLibraries}{@value: currentTextLibrary}{@event-oninput: handleLibraryChange}{@event-onchange: handleLibraryChange}">\r\n            <option data-binding="{@template-for: textLibraries}{@text: @context}{@attach: @context}"></option>\r\n        </select>\r\n    </span>\r\n\r\n    <div class="no-symbol-library" data-binding="{@visible: noTextLibraries}">\r\n        <span data-binding="{@text:  @language-markup-nolibraries}"/>\r\n    </div>\r\n\r\n</div>\r\n',"url:/Mapping/modules/Markup/ToolPalettes/DeletePaletteSmall.html":'<div class="toolbar-tool-mode">\r\n    <button class="tbtm-done" data-binding="{@event-onclick: handleClickDone}">\r\n        <span data-binding="{@text: @language-menu-done}"></span>\r\n    </button>\r\n    <div class="tbtm-list">\r\n        <ul class="two">\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@event-onclick: handleClickEdit}">\r\n                    <span class="icon icon-draw-edit-24"></span>\r\n                </button>\r\n                <label data-binding="{@text: @language-toolbar-markup-palette-small-edit}"></label>\r\n            </li>\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@event-onclick: handleClickClear}{@disabled: clearDisabled}">\r\n                    <span class="icon icon-clear-24"></span>\r\n                </button>\r\n                <label data-binding="{@text: @language-toolbar-clear-all}"></label>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>',"url:/Mapping/modules/Markup/ToolPalettes/EditPaletteLarge.html":'<ul class="markup-edit">\r\n    <li>\r\n        <button class="toolbar-item" data-binding="{@disabled: changeStyleDisabled}{@event-onclick: handleClickChangeStyle}{title: @language-toolbar-markup-change-markup-style-tooltip}">\r\n            <span class="icon icon-swatch-picker-24"></span>\r\n            <p data-binding="{@text: @language-toolbar-markup-palette-small-change-style}"></p>\r\n        </button>\r\n    </li>\r\n</ul>',"url:/Mapping/modules/Markup/ToolPalettes/EditPaletteSmall.html":'<div class="toolbar-tool-mode">\r\n    <button class="tbtm-done" data-binding="{@event-onclick: handleClickDone}">\r\n        <span data-binding="{@text: @language-menu-done}"></span>\r\n    </button>\r\n    <div class="tbtm-list">\r\n        <ul class="three">\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@event-onclick: handleClickChangeStyle}{@disabled: changeStyleDisabled}">\r\n                    <span class="icon icon-swatch-picker-24"></span>\r\n                </button>\r\n                <label data-binding="{@text: @language-toolbar-markup-palette-small-change-style}"></label>\r\n            </li>\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@event-onclick: handleClickDelete}{@disabled: clearDisabled}">\r\n                    <span class="icon icon-draw-edit-24"></span>\r\n                </button>\r\n                <label data-binding="{@text: @language-toolbar-markup-palette-small-delete}"></label>\r\n            </li>\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@event-onclick: handleClickClear}{@disabled: clearDisabled}">\r\n                    <span class="icon icon-clear-24"></span>\r\n                </button>\r\n                <label data-binding="{@text: @language-toolbar-clear-all}"></label>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>',"url:/Mapping/modules/Markup/ToolPalettes/MarkupPaletteSmall.html":'<div class="toolbar-tool-mode">\r\n    <div class="tbtm-done" data-binding="{@event-onclick: handleClickDone}">\r\n        <span data-binding="{@text: @language-menu-done}"></span>\r\n    </div>\r\n    <div class="tbtm-list">\r\n        <ul class="transient-element markup four">\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@disabled: changeStyleDisabled}{@event-onclick: handleClickChangeStyle}">\r\n                    <span class="icon icon-swatch-picker-24"></span>\r\n                    <p data-binding="{@text: @language-toolbar-markup-palette-small-change-style}"></p>\r\n                </button>\r\n            </li>\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@class-highlight: editToggled}{@event-onclick: handleClickEdit}">\r\n                    <span class="icon icon-draw-edit-24"></span>\r\n                    <p data-binding="{@text: @language-toolbar-markup-palette-small-edit}"></p>\r\n                </button>\r\n            </li>\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@disabled: clearDisabled}{@class-highlight: deleteToggled}{@event-onclick: handleClickDelete}">\r\n                    <span class="icon icon-erase-24"></span>\r\n                    <p data-binding="{@text: @language-toolbar-erase}"></p>\r\n                </button>\r\n            </li>\r\n            <li>\r\n                <button class="tbtm-btn" data-binding="{@disabled: clearDisabled}{@event-onclick: handleClickClear}">\r\n                    <span class="icon icon-clear-24"></span>\r\n                    <p data-binding="{@text: @language-toolbar-clear-all}"></p>\r\n                </button>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>'}}),define(["Mapping/modules/Markup/MarkupModule","Mapping/modules/Markup/MarkupViewModel","Mapping/modules/Markup/ToolPalettes/TransientMarkupPaletteView","Mapping/modules/Markup/ToolPalettes/TransientMarkupPaletteViewModel","Mapping/modules/Markup/MarkupStyles/MarkupSymbolSelector/MarkupSymbolSelectorView","Mapping/modules/Markup/MarkupStyles/MarkupSymbolSelector/MarkupSymbolSelectorViewModel","Mapping/modules/Markup/MarkupStyles/MarkupTemplateSelector/MarkupTemplateSelectorView","Mapping/modules/Markup/MarkupStyles/MarkupTemplateSelector/MarkupTemplateSelectorViewModel"],function(e,t,i,r,a,o,l,n){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupModule",e.MarkupModule),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupViewModel",t.MarkupViewModel),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.markup.toolPalettes.TransientMarkupPaletteView",i.TransientMarkupPaletteView),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.markup.toolPalettes.TransientMarkupPaletteViewModel",r.TransientMarkupPaletteViewModel),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupSymbolSelectorView",a.MarkupSymbolSelectorView),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupSymbolSelectorViewModel",o.MarkupSymbolSelectorViewModel),shim(l,"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupTemplateSelectorView",l.MarkupTemplateSelectorView),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.markup.MarkupTemplateSelectorViewModel",n.MarkupTemplateSelectorViewModel)});