!function(){function e(e,r,t){if("string"==typeof e&&(t=r,r=e),void 0!==t)for(var i=r.split("."),a=null,n=window,s=0,o=i.length;s<o;s++)a=i[s],s==o-1?n[a]=t:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+r)}var r="<div class='reorderLayers' data-binding='{@source: layerGroupsVM}'>    <div data-binding='{@template-for: layerGroupsVM}'>        <div class='panel-group no-results box-container' data-binding='{@hidden: showGroups}'>            <p data-binding='{@text: @language-layerDrawingOrder-noGroups}'></p>            <p class='description' data-binding='{@text: @language-layerDrawingOrder-noGroups-desc}'></p>        </div>        <div class='warning-label reorder-info' data-binding='{@visible: showGroups}{@text: @language-layerDrawingOrder-info}'></div>        <div class='panel-group' data-binding='{@visible: showGroups}'>            <ul class='gcx-list-menu layer-groups-list' data-binding='{@source: groups}'>                <li class='gcx-list-item reorder-list-item' data-binding='{@template-for: groups}'>                    <button class='gcx-list-button icon-right chevron-right-24 reorder-list-button' data-binding='{@event-onclick: handleClickButtonNext}{aria-label: @language-layerDrawingOrder-accessibility-reorder}'>                        <strong class='gcx-list-label' data-binding='{@text: title}'></strong>                    </button>                </li>            </ul>        </div>        <div class='form-item'>            <div class='form-btns reorder-btns'>                <button class='button' data-binding='{@event-onclick: handleClickButtonCancel}{@text: @language-layerDrawingOrder-button-cancel}'></button>            </div>        </div>    </div></div>",t="<div class='reorderLayers' data-binding='{@source: orderLayersVM}'>    <div data-binding='{@template-for: orderLayersVM}'>        <div class='panel-group no-results box-container' data-binding='{@hidden: hasLayers}'>            <p data-binding='{@text: @language-layerDrawingOrder-noLayers}'></p>            <p class='description' data-binding='{@text: @language-layerDrawingOrder-noLayers-desc}'></p>        </div>        <div class='panel-group'>            <ul class='gcx-list-menu reorder-list' data-binding='{@source: layers}{@var: sortable}'>                <li class='gcx-list-item reorder-list-item' data-binding='{@template-for: layers}{@class-selected: isSelected}{id: uniqueId}'>                    <button class = 'draggable reorder-list-dragHandle' tabindex='-1' data-binding='{@hidden: isSelected}{aria-label: @language-layerDrawingOrder-accessibility-reorder}'></button>                    <button class='gcx-list-button reorder-list-button' data-binding='{@event-onclick: handleClickButtonSelected}'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-custom-added}{@visible: isUserCreated}'></span>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-in-layer-list}{@hidden: isInLayerList}'></span>                        <div class='meta-info' data-binding='{@hidden: isVisibilityToggledOn}'>                            <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-not-visible}' src='Resources/Images/Icons/not-visible-16.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-visible}'></span>                        </div>                        <div class='meta-info' data-binding='{@hidden: isWithinScale}'>                            <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-visible}' src='Resources/Images/Icons/visibility-24.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-within-scale}'></span>                        </div>                    </button>                    <span class='reorder-arrow-btns' data-binding='{@visible: isSelected}'>                        <button class='reorder-arrow-up' aria-label='Move Layer Up' data-binding='{@event-onclick: handleClickButtonUp}{@disabled: isFirstInList}'></button>                        <button class='reorder-arrow-down' aria-label='Move Layer Down' data-binding='{@event-onclick: handleClickButtonDown}{@disabled: isLastInList}'></button>                    </span>                </li>            </ul>        </div>        <div class='form-item'>            <div class='form-btns reorder-btns'>                <button class='button' data-binding='{@event-onclick: handleClickButtonDone}{@text: @language-layerDrawingOrder-button-done}'></button>                <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@text: @language-layerDrawingOrder-button-reset}{@enabled: canReset}'></button>            </div>        </div>    </div></div>",i="<div class='reorderLayers' data-binding='{@source: orderServicesVM}'>    <div data-binding='{@template-for: orderServicesVM}'>        <div class='panel-group no-results box-container' data-binding='{@hidden: hasLayers}'>            <p data-binding='{@text: @language-layerDrawingOrder-noServices}'></p>            <p class='description' data-binding='{@text: @language-layerDrawingOrder-noServices-desc}'></p>        </div>        <div class='panel-group'>            <ul class='gcx-list-menu reorder-list' data-binding='{@source: layers}{@var: sortable}'>                <li class='gcx-list-item reorder-list-item has-action-1' data-binding='{@template-for: layers}{@class-selected: isSelected}{id: uniqueId}'>                    <button class = 'draggable reorder-list-dragHandle' tabindex='-1' data-binding='{@hidden: isSelected}{aria-label: @language-layerDrawingOrder-accessibility-reorder}'></button>                    <button class='gcx-list-button reorder-list-button' data-binding='{@event-onclick: handleClickButtonSelected}'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-custom-added}{@visible: isUserCreated}'></span>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-in-layer-list}{@hidden: isInLayerList}'></span>                        <div class='meta-info' data-binding='{@hidden: isVisibilityToggledOn}'>                            <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-not-visible}' src='Resources/Images/Icons/not-visible-16.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-visible}'></span>                        </div>                        <div class='meta-info' data-binding='{@hidden: isWithinScale}'>                              <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-visible}' src='Resources/Images/Icons/visibility-24.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-within-scale}'></span>                        </div>                    </button>                    <button class='gcx-action-button icon chevron-right-24' data-binding='{@enabled: canDrillIn}{@event-onclick: handleClickButtonNext}'></button>                    <span class='reorder-arrow-btns' data-binding='{@visible: isSelected}'>                        <button class='reorder-arrow-up' data-binding='{@event-onclick: handleClickButtonUp}{@disabled: isFirstInList}'></button>                        <button class='reorder-arrow-down' data-binding='{@event-onclick: handleClickButtonDown}{@disabled: isLastInList}'></button>                    </span>                </li>            </ul>        </div>        <div class='form-item'>            <div class='form-btns reorder-btns'>                <button class='button' data-binding='{@event-onclick: handleClickButtonDone}{@text: @language-layerDrawingOrder-button-done}'></button>                <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@text: @language-layerDrawingOrder-button-reset}{@enabled: canReset}'></button>            </div>        </div>    </div></div>";require({cache:{"Mapping/modules/LayerDrawingOrder/DrawOrderGroupItem":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){return function(e,r,t){this.count=r,this.title=e+" ("+this.count+")",this.type=t}}();r.DrawOrderGroupItem=t})},"Mapping/modules/LayerDrawingOrder/DrawOrderItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./DrawOrderItemConstants","geocortex/framework/utils/utils","geocortex/essentials/LayerType"],function(r,t,i,a,n,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(r){function t(e,t,i,o){var l=r.call(this,e,t)||this;return l.libraryId=null,l.type=null,l.displayName=null,l.isUserCreated=null,l.isInLayerList=null,l.myClass=new a.Observable("asfd"),l.app=e,l.libraryId=t,l.owner=i,l.uniqueId="drawOrderItem-{0}".format(s.alphaNumericToken()),l.serviceLayer=o.serviceLayer,l.mapService=o.mapService,l.type=o.type,l.displayName=o.displayName,l.clusterLayer=o.clusterLayer,l.canDrillIn=!1,l.layerDrawItems=new a.ObservableCollection,l.serviceLayer&&l.mapService&&l.type!==n.LAYER&&l.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&l.serviceLayer.supportsDynamicLayers&&l.serviceLayer.layerInfos.length>1&&(l.populateChildren(),l.canDrillIn=!0),l.gcxLayer=o.gcxLayer,l.parent=o.parent,l.isUserCreated=l.mapService.isUserCreated,l.isVisibilityToggledOn=new a.Observable(l.type===n.LAYER?l.gcxLayer.isVisible():l.serviceLayer.visible),l.isWithinScale=new a.Observable((l.type===n.LAYER?l.gcxLayer.withinScaleRange():l.serviceLayer.isVisibleAtScale(l.app.map.getScale()))||!l.isVisibilityToggledOn.get()),l.isInLayerList=o.isInLayerList||l.isUserCreated,l.isFirstInList=new a.Observable(!1),l.isLastInList=new a.Observable(!1),l.isSelected=new a.Observable(!1),l.mapZoomEndedEventToken=l.app.event("MapZoomEndedEvent").subscribe(l,l.onMapZoomEnded),l.type===n.LAYER?l.layerVisibilityChangedEventToken=l.app.event("LayerVisibilityChangedEvent").subscribe(l,l.onLayerVisibilityChanged):l.mapServiceVisibilityChangedEvent=l.app.event("MapServiceVisibilityChangedEvent").subscribe(l,l.onMapServiceVisibilityChanged),l}return e(t,r),t.prototype.unsubscibeFromEvents=function(){String.isNullOrEmpty(this.mapZoomEndedEventToken)||this.app.event("MapZoomEndedEvent").unsubscribe(this.mapZoomEndedEventToken),String.isNullOrEmpty(this.layerVisibilityChangedEventToken)||this.app.event("LayerVisibilityChangedEvent").unsubscribe(this.layerVisibilityChangedEventToken),String.isNullOrEmpty(this.mapServiceVisibilityChangedEvent)||this.app.event("MapServiceVisibilityChangedEvent").unsubscribe(this.mapServiceVisibilityChangedEvent)},t.prototype.populateChildren=function(){var e=this,r=this.app.map.getLayer(this.serviceLayer.id);if(r.dynamicLayerInfos&&r.dynamicLayerInfos.length){for(var i=new Array,a=r.createDynamicLayerInfosFromLayerInfos(),s=0;s<a.length;s++){for(var l=!1,d=0;d<r.dynamicLayerInfos.length;d++)if(r.dynamicLayerInfos[d].id==a[s].id){l=!0;break}l||i.push(a[s])}if(i&&i.length>0){var c=r.dynamicLayerInfos;r.setDynamicLayerInfos(i.concat(c),!0),r.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(this.mapService),!1)}}else r.setDynamicLayerInfos(r.createDynamicLayerInfosFromLayerInfos(),!0),r.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(this.mapService),!1);this.dynamicLayerInfos=r.dynamicLayerInfos.slice(),r.dynamicLayerInfos.forEach(function(r){for(var i=0;i<e.mapService.layers.length;i++)if(r.id.toString()===e.mapService.layers[i].id&&e.mapService.layers[i].type!==o.LayerType.GROUP_LAYER){var a=1==e.owner.layerListLayerItems.filter(function(r){return r.mapService.id===e.mapService.id&&r.layer.id===e.mapService.layers[i].id}).length,s={serviceLayer:e.serviceLayer,mapService:e.mapService,type:n.LAYER,displayName:e.mapService.layers[i].displayName,clusterLayer:null,gcxLayer:e.mapService.layers[i],parent:e,isInLayerList:a},l=new t(e.app,e.libraryId,e.owner,s);e.layerDrawItems.addItem(l);break}})},t.prototype.onLayerVisibilityChanged=function(e){var r=this;e.forEach(function(e){e.mapService===r.mapService&&e.layer===r.gcxLayer&&(r.isVisibilityToggledOn.set(r.gcxLayer.isVisible()),r.isWithinScale.set(r.isWithinScale.get()||!r.isVisibilityToggledOn.get()))})},t.prototype.onMapServiceVisibilityChanged=function(e,r){this.serviceLayer===e&&this.mapService===r&&(this.isVisibilityToggledOn.set(e.visible),this.isWithinScale.set(this.isWithinScale.get()||!this.isVisibilityToggledOn.get()))},t.prototype.onMapZoomEnded=function(e,r,t,i){var a=this.type===n.LAYER?this.gcxLayer.withinScaleRange(null):this.serviceLayer.isVisibleAtScale(this.app.map.getScale());this.isWithinScale.set(!this.isVisibilityToggledOn.get()||a)},t}(i.ViewModelBase);t.DrawOrderItem=l})},"Mapping/modules/LayerDrawingOrder/DrawOrderItemConstants":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SERVICE_LAYER="service_layer",r.LAYER="layer",r.GRAPHIC="graphic",r.UP=0,r.DOWN=1})},"Mapping/modules/LayerDrawingOrder/LayerDrawingOrderModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/validation/NumberValidator"],function(r,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(r){function t(e,t){return r.call(this,e,t)||this}return e(t,r),t.prototype.initialize=function(e){r.prototype.initialize.call(this,e),this._config=e},t.prototype.getStateFilter=function(){var e=new a.NumberValidator;return{graphicsLayerTransforms:{item:{layerId:!0,topLayer:!0,bottomLayer:!0,relativePosition:e}},serviceTransforms:{item:{layerId:!0,topLayer:!0,bottomLayer:!0,relativePosition:e}}}},t.prototype.applyState=function(e){var r=this;return this.app.event("ProjectLoadedEvent").once(this,function(){r.app.waitUntilApplicationReady().then(function(){r.app.command("_ApplyLayerDrawingOrderState").execute(e)})}),Promise.resolve()},t.prototype.exportState=function(){var e=this,r={graphicsLayerTransforms:[],serviceTransforms:[]};return Promise.try(function(){return e.app.command("_PopulateLayerDrawingOrderState").execute(r),r})},t}(i.ModuleBase);t.LayerDrawingOrderModule=n})},"Mapping/modules/LayerDrawingOrder/LayerDrawingOrderViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./DrawOrderItem","./Dialogs/LayerGroupsDialogViewModel","./Dialogs/OrderServicesDialogViewModel","./Dialogs/OrderLayersDialogViewModel","./DrawOrderItemConstants","geocortex/infrastructure/Dictionary","geocortex/infrastructure/layerList/LayerListItem","geocortex/framework/utils/ArrayUtils"],function(r,t,i,a,n,s,o,l,d,c,p,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(r){function t(e,t){var i=r.call(this,e,t)||this;return i.movedServices=[],i.movedGraphicsLayers=[],i.app=e,i.canUpdateLayerDrawingOrderLayers=new a.Observable(!1),i.graphicsLayerDrawItems=new a.ObservableCollection,i.serviceLayerDrawItems=new a.ObservableCollection,i.layerReference=new c.Dictionary,i.layerListGraphicsLayerItems=[],i.layerListLayerItems=[],i.layerListMapServiceItems=[],i.layerGroupsVM=new s.LayerGroupsDialogViewModel(i,i.app,i.libraryId),i.orderServicesVM=new o.OrderServicesDialogViewModel(i,i.app,i.libraryId),i.orderLayersVM=new l.OrderLayersDialogViewModel(i,i.app,i.libraryId),i}return e(t,r),t.prototype.initialize=function(){var e=this;this._subscribeEvents(),this._registerCommands(),this.app.event("LayerListInitializedEvent").once(this,function(r){e.layerList=r,e._getAllLayerListLayersAndMapServices(e.layerList.children),e.app.waitUntilApplicationReady().then(function(){e._updateLayerDrawingOrderLayers()})})},t.prototype._subscribeEvents=function(){var e=this;this.app.event("LayerAddedEvent").subscribe(this,this._recordAddedLayer),this.app.event("ClusterLayerAddedEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor),this.app.event("ClusterLayerRemovedEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor),this.app.event("SiteInitializedEvent").subscribe(this,function(){return e.canUpdateLayerDrawingOrderLayers.set(!0)}),this.app.event("SiteServiceLayersFailedEvent").subscribe(this,function(){return e.canUpdateLayerDrawingOrderLayers.set(!0)}),this.app.event("MapServiceLayersChangedWithResultEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor)},t.prototype._registerCommands=function(){this.app.command("RemoveUserAddedLayer").register(this,this._recordRemovedLayer),this.app.command("RemoveMapService").register(this,this._recordRemovedMapService),this.app.command("ClearLayerCatalogLayers").register(this,this._recordClearedLayerCatalogLayers),this.app.command("OpenLayerDrawingOrderGroups").register(this,this._updateLayerDrawingOrderLayers),this.app.command("_ApplyLayerDrawingOrderState").register(this,this._applyState),this.app.command("_PopulateLayerDrawingOrderState").register(this,this._exportState)},t.prototype._recordAddedLayer=function(e,r){r.isUserCreated&&e instanceof esri.layers.GraphicsLayer&&this._reorderUserAddedLayers(e,r),this.layerReference.containsKey(e.id)&&this.layerReference.remove(e.id),this.layerReference.set(e.id,r),this.updateLayerDrawingOrderLayersMonitor()},t.prototype._recordRemovedLayer=function(e){this.layerReference.containsKey(e.mapService.serviceLayer.id)&&this.layerReference.remove(e.mapService.serviceLayer.id),this.updateLayerDrawingOrderLayersMonitor()},t.prototype._recordRemovedMapService=function(e){this.layerReference.containsKey(e.serviceLayer.id)&&this.layerReference.remove(e.serviceLayer.id),this.updateLayerDrawingOrderLayersMonitor()},t.prototype._recordClearedLayerCatalogLayers=function(){for(var e=this.layerReference.keys,r=0;r<e.length;r++)this.layerReference.get(e[r]).catalogId&&this.layerReference.remove(e[r]);this.updateLayerDrawingOrderLayersMonitor()},t.prototype._reorderUserAddedLayers=function(e,r){var t=this.graphicsLayerDrawItems.getLength()?this.app.map.graphicsLayerIds.indexOf(this.graphicsLayerDrawItems.getAt(0).serviceLayer.id)+1:0;this.app.map.reorderLayer(e,t)},t.prototype.updateLayerDrawingOrderLayersMonitor=function(){var e=this;this.canUpdateLayerDrawingOrderLayers.get()&&(this.canUpdateLayerDrawingOrderLayers.set(!1),setTimeout(function(){e._updateLayerDrawingOrderLayers(),e.canUpdateLayerDrawingOrderLayers.set(!0)},750))},t.prototype._updateLayerDrawingOrderLayers=function(){var e=this;this.serviceLayerDrawItems.get().forEach(function(e){e.unsubscibeFromEvents()}),this.graphicsLayerDrawItems.get().forEach(function(e){e.unsubscibeFromEvents()}),this.serviceLayerDrawItems.clear(),this.graphicsLayerDrawItems.clear(),this.app.map.graphicsLayerIds.forEach(function(r){var t=e.app.map.getLayer(r);if(e.layerReference.containsKey(r)){var i=e.app.map.getLayer(t.id+"-cluster"),a=e.layerListGraphicsLayerItems.filter(function(i){return i.mapService.id==e.layerReference.get(r).id&&i.layer.id==t.layerId}),s={serviceLayer:t,mapService:e.layerReference.get(r),type:d.GRAPHIC,displayName:e.layerReference.get(r).displayName,clusterLayer:i,gcxLayer:null,parent:null,isInLayerList:1==a.length},o=new n.DrawOrderItem(e.app,e.libraryId,e,s);e.graphicsLayerDrawItems.insertItem(0,o)}}),this.graphicsLayerDrawItems.get().forEach(function(r){r.clusterLayer&&e.app.map.reorderLayer(r.clusterLayer,e.app.map.graphicsLayerIds.indexOf(r.serviceLayer.id))}),this.app.map.layerIds.forEach(function(r){var t=e.app.map.getLayer(r);if(e.layerReference.containsKey(t.id)){var i=e.layerReference.get(t.id);if(0===i.layers.length)return;var a={serviceLayer:t,mapService:i,type:d.SERVICE_LAYER,displayName:i.displayName,clusterLayer:null,gcxLayer:null,parent:null,isInLayerList:e._isInLayerList(i)},s=new n.DrawOrderItem(e.app,e.libraryId,e,a);e.serviceLayerDrawItems.insertItem(0,s)}}),this.refreshPanels()},t.prototype.refreshPanels=function(){if(this.orderLayersVM.layers.getLength()){var e=this.orderLayersVM.layers.getAt(0);if(e.type===d.GRAPHIC)this.orderLayersVM.reset(),this.orderLayersVM.populateLayers();else if(e.type===d.LAYER){this.orderLayersVM.reset();var r=this.serviceLayerDrawItems.get().filter(function(r){return r.serviceLayer.id===e.serviceLayer.id});1===r.length&&this.orderLayersVM.populateLayers(r[0])}this.orderLayersVM.layers.pulse()}this.orderServicesVM.reset(),this.orderServicesVM.populateLayers(),this.orderServicesVM.layers.pulse(),this.layerGroupsVM.reset(),this.layerGroupsVM.populateLayerGroups(),this.orderServicesVM.currentDrawOrder=this.app.map.layerIds.slice(),this.orderLayersVM.currentDrawOrder=this.app.map.graphicsLayerIds.slice(),this.app.event("LayerDrawingOrderPanelRefreshedEvent").publish()},t.prototype._isInLayerList=function(e){var r=!!y.firstOrDefault(this.layerListMapServiceItems,function(r){return r.mapService.id===e.id}),t=!!y.firstOrDefault(this.layerListLayerItems,function(r){return r.mapService.gcxMapService===e});return r||t},t.prototype._getAllLayerListLayersAndMapServices=function(e){for(var r=0;r<e.getLength();r++){var t=e.getAt(r);t.type===p.LayerListItemType.FOLDER?this._getAllLayerListLayersAndMapServices(t.children):t.type===p.LayerListItemType.LAYER?this.layerListLayerItems.push(t):t.type===p.LayerListItemType.GRAPHICSLAYER?this.layerListGraphicsLayerItems.push(t):t.type===p.LayerListItemType.MAPSERVICE&&this.layerListMapServiceItems.push(t)}},t.prototype.getDynamicMapServiceVisibleLayers=function(e){var r=e.getVisibleLayers();return 0===r.length&&r.push("-1"),r},t.prototype._exportState=function(e){e.serviceTransforms=this._createLayerTransforms(this.movedServices,this.app.map.layerIds),e.graphicsLayerTransforms=this._createLayerTransforms(this.movedGraphicsLayers,this.app.map.graphicsLayerIds)},t.prototype._createLayerTransforms=function(e,r){var t=this;return e.map(function(e){if(t.app.map.getLayer(e)){var i=r.indexOf(e),a=i/(r.length-1);return{layerId:e,topLayer:i<r.length?r[i+1]:null,bottomLayer:i>0?r[i-1]:null,relativePosition:a}}}).sort(function(e,r){return e.relativePosition<r.relativePosition?-1:e.relativePosition>r.relativePosition?1:0})},t.prototype._applyState=function(e){var r=this;this.movedServices=[],this.movedGraphicsLayers=[];var t=e.serviceTransforms.filter(function(e){return r.app.map.layerIds.indexOf(e.layerId)>-1}),i=e.graphicsLayerTransforms.filter(function(e){return r.app.map.graphicsLayerIds.indexOf(e.layerId)>-1});(t.length>0||i.length>0)&&Promise.each([function(){return r._applyLayerTransforms(t,function(){return r.app.map.layerIds},r.movedServices)},function(){return r._applyLayerTransforms(i,function(){return r.app.map.graphicsLayerIds.filter(function(e){return-1===e.indexOf("-explodedClusterLayer")})},r.movedGraphicsLayers)}],function(e){return e()}).then(function(){r.updateLayerDrawingOrderLayersMonitor();var e=r.app.map.on("update-end",function(){r.app.map.setExtent(r.app.map.extent),e.remove()})})},t.prototype._applyLayerTransforms=function(e,r,t,i,a){var n=this;void 0===i&&(i=function(e,r){n.app.map.reorderLayer(e,r)}),void 0===a&&(a=function(e){return n.app.map.getLayer(e)});var s=e.map(function(e){return e.layerId});if(0===s.length)return Promise.resolve();t&&t.push.apply(t,s);var o=function(e){var r=s.indexOf(e);r>-1&&s.splice(r,1)};return Promise.each(e,function(e){return new Promise(function(t,l){var d=r().indexOf(e.layerId),c=n.app.map.on("layer-reorder",function(){c.remove(),t()}),p=r().indexOf(e.bottomLayer),y=r().indexOf(e.topLayer);p>-1&&-1===s.indexOf(e.bottomLayer)?(o(e.layerId),d-p!=1?i(a(e.layerId),p+(d>p?1:0)):(c.remove(),t())):y>-1&&-1===s.indexOf(e.topLayer)?(o(e.layerId),y-d!=1?i(a(e.layerId),y+(d<y?-1:0)):(c.remove(),t())):(c.remove(),t())})}).then(function(){if(0!==s.length&&s.length!==e.length)return n._applyLayerTransforms(e.filter(function(e){return s.indexOf(e.layerId)>-1}),r,null,i,a);if(s.length>0){var t=(e=e.filter(function(e){return s.indexOf(e.layerId)>-1})).map(function(e){return r().indexOf(e.layerId)}).sort(function(e,r){return e-r});return Promise.each(e,function(s){return new Promise(function(o,l){var d=n.app.map.on("layer-reorder",function(){d.remove(),y&&c?(d=n.app.map.on("layer-reorder",function(){d.remove(),o()}),u()!==c?i(a(y),c):o()):o()}),c=r().indexOf(s.layerId),p=t[e.indexOf(s)],y=r()[p],u=function(){return r().indexOf(y)};c!==p?i(a(s.layerId),p):o()})})}return Promise.resolve()})},t.prototype.reset=function(){},t}(i.ViewModelBase);t.LayerDrawingOrderViewModel=u})},"Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","./../DrawOrderItemConstants"],function(r,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(r){function t(e,t){var i=r.call(this,e,t)||this;return i.libraryId=null,i.app=e,i.libraryId=t,i.registerCommands(),i}return e(t,r),t.prototype.attach=function(e){r.prototype.attach.call(this,e)},t.prototype.registerCommands=function(){var e=this;this.app.command("OpenLayerDrawingOrderGroups").register(this,this.openPanel),this.app.command("CloseLayerDrawingOrderPanel").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},t.prototype.openPanel=function(){this.viewModel.layerGroupsVM.reset(),this.viewModel.layerGroupsVM.populateLayerGroups(),this.app.command("ActivateView").execute(this.id)},t.prototype.handleClickButtonNext=function(e,r,t){t.type===a.GRAPHIC?this.app.command("OpenLayerDrawingOrderLayers").execute():this.app.command("OpenLayerDrawingOrderServices").execute()},t.prototype.handleClickButtonCancel=function(){this.app.viewManager.deactivateView(this)},t}(i.WizardFragmentView);t.LayerGroupsDialogView=n})},"Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./../DrawOrderGroupItem","./../DrawOrderItemConstants"],function(r,t,i,a,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(r){function t(e,t,i){var n=r.call(this,t,i)||this;return n.app=t,n.libraryId=i,n.owner=e,n.graphicsGroupExists=new a.Observable(!1),n.servicesGroupExists=new a.Observable(!1),n.showGroups=new a.Observable(!1),n.groups=new a.ObservableCollection,n.graphicsGroupExists.bind(n,function(){return n.showGroups.set(n.graphicsGroupExists.get()||n.servicesGroupExists.get())}),n.servicesGroupExists.bind(n,function(){return n.showGroups.set(n.graphicsGroupExists.get()||n.servicesGroupExists.get())}),n}return e(t,r),t.prototype.populateLayerGroups=function(){if(this.hasGroups(),this.graphicsGroupExists.get()){var e=new n.DrawOrderGroupItem(this.getResource("language-layerDrawingOrder-graphics-group-title"),this.owner.graphicsLayerDrawItems.getLength(),s.GRAPHIC);this.groups.addItem(e)}if(this.servicesGroupExists.get()){var r=new n.DrawOrderGroupItem(this.getResource("language-layerDrawingOrder-services-group-title"),this.owner.serviceLayerDrawItems.getLength(),s.SERVICE_LAYER);this.groups.addItem(r)}},t.prototype.hasGroups=function(){return this.graphicsGroupExists.set(this.owner.graphicsLayerDrawItems.getLength()>0),this.servicesGroupExists.set(this.owner.serviceLayerDrawItems.getLength()>0),this.graphicsGroupExists.get()||this.servicesGroupExists.get()},t.prototype.reset=function(){this.groups.clear()},t}(i.ViewModelBase);t.LayerGroupsDialogViewModel=o})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","geocortex/framework/observables","./../DrawOrderItemConstants"],function(r,t,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(r){function t(e,t){var i=r.call(this,e,t)||this;return i.libraryId=null,i.openPanelCommandName=null,i.lastSelectionArrowUsed=null,i.app=e,i.libraryId=t,i.currentlySelectedElement=new a.Observable(null),i.registerCommands(),i.subscribeEvents(),i}return e(t,r),t.prototype.attach=function(e){r.prototype.attach.call(this,e);var t={handle:"button.reorder-list-dragHandle",axis:"y",cancel:".reorder-arrow-btns button",scrollSpeed:10};$(this.sortable).sortable(t),$(this.sortable).disableSelection(),$(this.sortable).bind("sortupdate",dojo.hitch(this,this.sortUpdate))},t.prototype.registerCommands=function(){var e=this;if(null===this.openPanelCommandName||void 0===this.openPanelCommandName){var r="variable this.openPanelCommandName NOT DEFINED. A derivative class should instantiate this variable",t=new Error(r);throw this.app.trace.error(r,t),t}this.app.command(this.openPanelCommandName).register(this,function(r){e.relatedViewModel.populateLayers(r),e.app.command("ActivateView").execute(e.id)}),this.app.command("CloseLayerDrawingOrderPanel").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},t.prototype.subscribeEvents=function(){var e=this;this.app.event("LayerDrawingOrderPanelRefreshedEvent").subscribe(this,function(){e.isActive&&!e.relatedViewModel.layers.getLength()&&e.app.viewManager.deactivateView(e),e.currentlySelectedElement=new a.Observable(null),e.lastSelectionArrowUsed=null}),this.app.event("LayerDrawingOrderPanelOrderChangedEvent").subscribe(this,function(r,t){if(void 0!==r&&void 0!==t&&e.app.command("ScreenReaderNarrate").execute(r.displayName+" was moved to position "+(t+1)+" in the list"),null!==e.lastSelectionArrowUsed&&e.isActive){var i=document.querySelector("#"+e.currentlySelectedElement.get().uniqueId+" .reorder-arrow-"+(e.lastSelectionArrowUsed===n.UP?"up":"down"));null!==i?i.focus():e.app.trace.error("Could not find previously selected arrow to keyboard focus on")}})},t.prototype.sortUpdate=function(e,r){if(this.lastSelectionArrowUsed=null,!(this.relatedViewModel.layers.getLength()<2)){for(var t,i=r.item.attr("id"),a=-1,n=0;n<this.relatedViewModel.layers.getLength();n++){var s=this.relatedViewModel.layers.getAt(n);if(s.uniqueId===i){a=n,t=s;break}}if(t&&a>-1){var o=-1;r.item.parent().children().each(function(e,t){if(t===r.item.get(0))return o=e,!1}),o>-1&&this.relatedViewModel.moveElement(t,o-a)}}},t.prototype.handleClickButtonSelected=function(e,r,t){this.lastSelectionArrowUsed=null,this.currentlySelectedElement.get()&&t.uniqueId!==this.currentlySelectedElement.get().uniqueId&&this.currentlySelectedElement.get().isSelected.set(!1),t.isSelected.get()?(t.isSelected.set(!1),this.currentlySelectedElement.set(null)):(t.isSelected.set(!0),this.currentlySelectedElement.set(t))},t.prototype.handleClickButtonUp=function(e,r,t){this.lastSelectionArrowUsed=n.UP,this.relatedViewModel.moveElement(t,-1)},t.prototype.handleClickButtonDown=function(e,r,t){this.lastSelectionArrowUsed=n.DOWN,this.relatedViewModel.moveElement(t,1)},t.prototype.handleClickButtonReset=function(){this.relatedViewModel.resetDrawOrder()},t.prototype.handleClickButtonDone=function(){this.app.command("CloseLayerDrawingOrderPanel").execute()},t}(i.WizardFragmentView);t.OrderDialogView=s})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(r,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(r){function t(e,t,i){var n=r.call(this,t,i)||this;return n.app=t,n.libraryId=i,n.owner=e,n.layers=new a.ObservableCollection,n.hasLayers=new a.Observable(!1),n.layers.bind(n,function(){return n.hasLayers.set(n.layers.getLength()>0)}),n.canReset=new a.Observable(!1),n}return e(t,r),t.prototype.setFirstLastAndSelected=function(){this.layers.getLength()&&(this.layers.get().forEach(function(e){e.isFirstInList.set(!1),e.isLastInList.set(!1)}),this.layers.getAt(0).isFirstInList.set(!0),this.layers.getAt(this.layers.getLength()-1).isLastInList.set(!0))},t.prototype.reset=function(){this.layers.clear(),this.canReset.set(!1)},t}(i.ViewModelBase);t.OrderDialogViewModel=n})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","./OrderDialogView"],function(r,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(r){function t(e,t){return r.call(this,e,t)||this}return e(t,r),t.prototype.registerCommands=function(){this.openPanelCommandName="OpenLayerDrawingOrderLayers",r.prototype.registerCommands.call(this)},t.prototype.attach=function(e){r.prototype.attach.call(this,e),this.relatedViewModel=this.viewModel.orderLayersVM},t}(i.OrderDialogView);t.OrderLayersDialogView=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","./OrderDialogViewModel","./../DrawOrderItemConstants","geocortex/framework/utils/ArrayUtils","geocortex/framework/utils/utils"],function(r,t,i,a,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(r){function t(e,t,i){return r.call(this,e,t,i)||this}return e(t,r),t.prototype.populateLayers=function(e){e?this.layers.set(e.layerDrawItems.get()):this.layers.set(this.owner.graphicsLayerDrawItems.get()),this.setFirstLastAndSelected()},t.prototype.moveElement=function(e,r){if(e.type===a.GRAPHIC){t=this.moveGraphicsLayerUiElement(e,r);this.moveGraphicsLayer(e,r<0,t)}else{var t=this.moveDynamicLayerUiElement(e,r);this.moveDynamicLayer(e,r<0,t)}var i=this.getIndex(e);this.app.event("LayerDrawingOrderPanelOrderChangedEvent").publish(e,i)},t.prototype.getIndex=function(e){var r;if(e.type===a.GRAPHIC)r=this.owner.graphicsLayerDrawItems.indexOf(e);else{var t=e.parent,i=t.layerDrawItems.get().filter(function(r){return r.gcxLayer===e.gcxLayer});if(1==i.length){var n=i[0];r=t.layerDrawItems.indexOf(n)}else r=-1}return-1===r&&this.app.trace.error("LayerDrawingOrder Error: Could not find item "+e.displayName+" in collection of layers"),r},t.prototype.moveGraphicsLayerUiElement=function(e,r){var t=this.getIndex(e),i=t+r,a=this.owner.graphicsLayerDrawItems.getAt(i);return this.owner.graphicsLayerDrawItems.removeAt(t),this.owner.graphicsLayerDrawItems.insertItem(i,e),this.reset(),this.populateLayers(),a},t.prototype.moveDynamicLayerUiElement=function(e,r){var t=e.parent,i=t.layerDrawItems.get().filter(function(r){return r.gcxLayer===e.gcxLayer});if(1==i.length){i[0];var a=this.getIndex(e),n=a+r,s=t.layerDrawItems.getAt(n);return t.layerDrawItems.removeAt(a),t.layerDrawItems.insertItem(n,e),this.reset(),this.populateLayers(t),s}this.app.trace.error("LayerDrawingOrder Error: Could not find the dynamic layer "+e.displayName+" in collection of layers")},t.prototype.moveGraphicsLayer=function(e,r,t){if(this.app.map.graphicsLayerIds.indexOf(e.serviceLayer.id)>-1){var i,a=[this.app.map.graphicsLayerIds.indexOf(t.serviceLayer.id)];t.clusterLayer&&(a.push(this.app.map.graphicsLayerIds.indexOf(t.clusterLayer.id)),t.clusterLayer.isClusterExploded()&&a.push(this.app.map.graphicsLayerIds.indexOf(t.clusterLayer.singleFeatureLayer.id))),i=r?Math.max.apply(Math,a):Math.min.apply(Math,a),this.app.map.reorderLayer(e.serviceLayer,i),-1===this.owner.movedGraphicsLayers.indexOf(e.serviceLayer.id)&&this.owner.movedGraphicsLayers.push(e.serviceLayer.id),e.clusterLayer&&(r?this.app.map.reorderLayer(e.clusterLayer,i):this.app.map.reorderLayer(e.clusterLayer,i+1),-1===this.owner.movedGraphicsLayers.indexOf(e.clusterLayer.id)&&this.owner.movedGraphicsLayers.push(e.clusterLayer.id),e.clusterLayer.isClusterExploded()&&(r?this.app.map.reorderLayer(e.clusterLayer.singleFeatureLayer,i):this.app.map.reorderLayer(e.clusterLayer.singleFeatureLayer,i+1))),this.canReset.set(!0)}else console.log("LayerDrawingOrder Error: Could not find graphics layer on map.")},t.prototype.moveDynamicLayer=function(e,r,t){var i=this.app.map.layerIds.indexOf(e.serviceLayer.id);if(i>-1){var a=this.app.map.getLayer(this.app.map.layerIds[i]);a.dynamicLayerInfos&&a.dynamicLayerInfos.length||a.setDynamicLayerInfos(a.createDynamicLayerInfosFromLayerInfos(),!0);for(var n=0;n<a.dynamicLayerInfos.length;n++)if(a.dynamicLayerInfos[n].id.toString()===e.gcxLayer.id){var s=a.dynamicLayerInfos.slice(),o=s.filter(function(e){return e.id.toString()===t.gcxLayer.id})[0];if(o){var l=s.indexOf(o),d=s.splice(n,1)[0];return s.splice(l,0,d),this._moveAnnotationSublayers(s,l),this._moveGroupLayers(s,l,d.id),a.setDynamicLayerInfos(s,!0),a.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(e.mapService),!0),a.refresh(),void this.canReset.set(!0)}}}else this.app.trace.warning("LayerDrawingOrder Error: Could not find service on map.")},t.prototype.resetDrawOrder=function(){this.layers.getLength()&&(this.layers.getAt(0).type===a.GRAPHIC?this.resetGraphicsLayerDrawingOrder():this.resetDynamicLayerDrawingOrder(),this.owner.updateLayerDrawingOrderLayersMonitor())},t.prototype.resetGraphicsLayerDrawingOrder=function(){for(var e=0;e<this.currentDrawOrder.length;e++)this.app.map.reorderLayer(this.app.map.getLayer(this.currentDrawOrder[e]),e)},t.prototype.resetDynamicLayerDrawingOrder=function(){var e=this.layers.getAt(0),r=this.owner.serviceLayerDrawItems.indexOf(e.parent),t=this.owner.serviceLayerDrawItems.getAt(r),i=this.app.map.layerIds.indexOf(t.serviceLayer.id);if(i>-1){var a=this.app.map.getLayer(this.app.map.layerIds[i]);a.setDynamicLayerInfos(t.dynamicLayerInfos,!0),a.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(t.mapService),!1)}else this.app.trace.warning("LayerDrawingOrder Error: Could not find service on map.")},t.prototype._moveGroupLayers=function(e,r,t){for(var i=r;i<e.length;i++){var a=e[i];if(a.subLayerIds&&a.subLayerIds.indexOf(t)>-1){var n=e.splice(i,1)[0];e.splice(r,0,n),this._moveGroupLayers(e,r,n.id)}}},t.prototype._moveAnnotationSublayers=function(e,r){if(e[r].subLayerIds&&e[r].subLayerIds.length>0)for(var t=0,i=e[r].subLayerIds;t<i.length;t++)!function(t){var i=e.indexOf(n.firstOrDefault(e,function(e){return e.id===t}));if(!s.isNullOrUndefined(i)){var a=e.splice(i,1)[0];e.splice(r+1,0,a)}}(i[t])},t}(i.OrderDialogViewModel);t.OrderLayersDialogViewModel=o})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","./OrderDialogView"],function(r,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(r){function t(e,t){return r.call(this,e,t)||this}return e(t,r),t.prototype.registerCommands=function(){this.openPanelCommandName="OpenLayerDrawingOrderServices",r.prototype.registerCommands.call(this)},t.prototype.attach=function(e){r.prototype.attach.call(this,e),this.relatedViewModel=this.viewModel.orderServicesVM},t.prototype.handleClickButtonNext=function(e,r,t){this.app.command("OpenLayerDrawingOrderLayers").execute(t)},t}(i.OrderDialogView);t.OrderServicesDialogView=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","./OrderDialogViewModel"],function(r,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(r){function t(e,t,i){return r.call(this,e,t,i)||this}return e(t,r),t.prototype.populateLayers=function(){this.layers.set(this.owner.serviceLayerDrawItems.get()),this.setFirstLastAndSelected()},t.prototype.moveElement=function(e,r){var t=this.moveServiceUiElement(e,r);this.moveService(e,t);var i=this.getIndex(e);this.app.event("LayerDrawingOrderPanelOrderChangedEvent").publish(e,i)},t.prototype.getIndex=function(e){var r=this.owner.serviceLayerDrawItems.indexOf(e);return-1===r&&this.app.trace.error("LayerDrawingOrder Error: Could not find item "+e.displayName+" in collection of services"),r},t.prototype.moveServiceUiElement=function(e,r){var t=this.getIndex(e),i=t+r;i>=this.owner.serviceLayerDrawItems.getLength()&&(i=this.owner.serviceLayerDrawItems.getLength()-1),i<0&&(i=0);var a=this.owner.serviceLayerDrawItems.getAt(i);return this.owner.serviceLayerDrawItems.removeAt(t),this.owner.serviceLayerDrawItems.insertItem(i,e),this.reset(),this.populateLayers(),a},t.prototype.moveService=function(e,r){if(this.app.map.layerIds.indexOf(e.serviceLayer.id)>-1){var t=this.app.map.layerIds.indexOf(r.serviceLayer.id);this.app.map.reorderLayer(e.serviceLayer,t),this.canReset.set(!0),-1===this.owner.movedServices.indexOf(e.serviceLayer.id)&&this.owner.movedServices.push(e.serviceLayer.id)}else console.log("LayerDrawingOrder Error: Could not find service on map.")},t.prototype.resetDrawOrder=function(){for(var e=0;e<this.currentDrawOrder.length;e++)this.app.map.reorderLayer(this.app.map.getLayer(this.currentDrawOrder[e]),e);this.owner.updateLayerDrawingOrderLayersMonitor()},t}(i.OrderDialogViewModel);t.OrderServicesDialogViewModel=a})},"url:/Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView.html":r,"url:/Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView.html":t,"url:/Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/CSS/common.css","css","LyotLS1TVEFSVDogTGF5ZXIgR3JvdXBzIFBhbmVsLS0tKi8NCg0KLnJlb3JkZXItbGlzdCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHRvcDogMDsNCiAgICBib3R0b206IDQuNWVtOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQp9DQoNCi53YXJuaW5nLWxhYmVsLnJlb3JkZXItaW5mbyB7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNFRUVFRUU7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQoucmVvcmRlci1saXN0IC51aS1zb3J0YWJsZS1wbGFjZWhvbGRlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Y4RjhGODsNCiAgICB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7IC8qIFVzaW5nICFpbXBvcnRhbnQgdG8gb3ZlcnJpZGUganF1ZXJ5J3MgZGVmYXVsdCBvcHRpb24gZm9yIHRoZSBlbGVtZW50Ki8NCn0NCg0KLnVpLXNvcnRhYmxlLWhlbHBlciB7DQogICAgYm9yZGVyLXRvcDogc29saWQgMXB4ICNFRUVFRUU7DQp9DQoNCi5yZW9yZGVyLWxpc3QtaXRlbSB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQp9DQoNCi5yZW9yZGVyLWxpc3QtYnV0dG9uIHsNCiAgICBtaW4taGVpZ2h0OiAzZW07DQogICAgcGFkZGluZzogMWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB6LWluZGV4OjA7DQogICAgLXdlYmtpdC10cmFuc2l0aW9uOiBwYWRkaW5nIDAuMXMgZWFzZS1pbi1vdXQ7DQogICAgLW8tdHJhbnNpdGlvbjogcGFkZGluZyAwLjFzIGVhc2UtaW4tb3V0Ow0KICAgIC1tb3otdHJhbnNpdGlvbjogcGFkZGluZyAwLjFzIGVhc2UtaW4tb3V0Ow0KICAgIHRyYW5zaXRpb246IHBhZGRpbmcgMC4xcyBlYXNlLWluLW91dDsNCiAgICBwYWRkaW5nLWxlZnQ6IDIuNWVtOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2RyYWctMTYucG5nKTsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAuNzVlbSAxZW07DQp9DQoNCi5sYXllci1ncm91cHMtbGlzdCAucmVvcmRlci1saXN0LWJ1dHRvbiB7DQogICAgcGFkZGluZy1sZWZ0OiAxZW07DQp9DQoNCi5yZW9yZGVyLWxpc3QtYnV0dG9uIC5nY3gtbGlzdC1sYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQoucmVvcmRlci1saXN0LWRyYWdIYW5kbGUgew0KICAgIHBvc2l0aW9uOmFic29sdXRlOw0KICAgIGhlaWdodDoxMDAlOw0KICAgIHdpZHRoOjEyJTsNCiAgICB6LWluZGV4OiAxOw0KfQ0KDQoubWV0YS1pbmZvLWljb24gew0KICAgIGhlaWdodDogMTZweDsNCiAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgbWFyZ2luOiAwLjVlbSAwLjI1ZW0gMCAwOw0KICAgIGRpc3BsYXk6IGlubGluZTsNCn0NCg0KLm1ldGEtaW5mby10ZXh0IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgbWFyZ2luLXJpZ2h0OiA1LjVlbTsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQogICAgY29sb3I6ICM2NjY2NjY7DQp9DQoNCi5yZW9yZGVyLWFycm93LWJ0bnMgew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMy41ZW07DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBsZWZ0OiAwOw0KICAgIG9wYWNpdHk6IDA7DQogICAgYm9yZGVyLXJpZ2h0OiBzb2xpZCAxcHggI2VlZWVlZTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctdXAsDQoucmVvcmRlci1hcnJvdy1kb3duIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgaGVpZ2h0OiA1MCU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KfQ0KDQoucmVvcmRlci1hcnJvdy11cDpob3ZlciwNCi5yZW9yZGVyLWFycm93LWRvd246aG92ZXIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNERUYyRkY7DQp9DQoNCi5yZW9yZGVyLWFycm93LXVwIHsNCiAgICB0b3A6IDA7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvYXJyb3ctdXAtc21hbGwtMjQucG5nKTsNCiAgICBib3JkZXItYm90dG9tOiBzb2xpZCAxcHggI2VlZWVlZTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctZG93biB7DQogICAgYm90dG9tOiAwOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2Fycm93LWRvd24tc21hbGwtMjQucG5nKTsNCn0NCg0KLnJlb3JkZXItYnRucyB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJvdHRvbTogMDsNCiAgICByaWdodDogMDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDQuNWVtOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQoNCi8qLS0tRU5EOiBMYXllciBHcm91cHMgUGFuZWwtLS0qLw0KDQovKi0tLVNUQVJUOiBTZWxlY3RlZCBTdGF0ZSAtLS0qLw0KDQouc2VsZWN0ZWQgLnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIHBhZGRpbmctbGVmdDogNC41ZW07DQp9DQoNCi5zZWxlY3RlZCAucmVvcmRlci1hcnJvdy1idG5zIHsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KDQouc2VsZWN0ZWQgLnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7DQp9DQoNCi8qLS0tRU5EOiBTZWxlY3RlZCBTdGF0ZSAtLS0qLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/CSS/small.css","css","LnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIG1pbi1oZWlnaHQ6IDMuNDRlbTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctYnRucyB7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiA2Ljg4ZW07DQogICAgYm9yZGVyOiBub25lOw0KfQ0KDQoucmVvcmRlci1hcnJvdy11cCwNCi5yZW9yZGVyLWFycm93LWRvd24gew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMy40NGVtOw0KICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQogICAgYm9yZGVyLXJpZ2h0OiBzb2xpZCAxcHggI2VlZWVlZTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctdXAgew0KICAgIGxlZnQ6IDA7DQp9DQoNCi5yZW9yZGVyLWFycm93LWRvd24gew0KICAgIHJpZ2h0OiAwOw0KfQ0KDQouc2VsZWN0ZWQgLnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIHBhZGRpbmctbGVmdDogOGVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/LayerDrawingOrder/DrawOrderGroupItem","Mapping/modules/LayerDrawingOrder/DrawOrderItem","Mapping/modules/LayerDrawingOrder/DrawOrderItemConstants","Mapping/modules/LayerDrawingOrder/LayerDrawingOrderModule","Mapping/modules/LayerDrawingOrder/LayerDrawingOrderViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogViewModel"],function(r,t,i,a,n,s,o,l,d,c,p){e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.SERVICE_LAYER",i.SERVICE_LAYER),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LAYER",i.LAYER),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.GRAPHIC",i.GRAPHIC),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.UP",i.UP),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DOWN",i.DOWN),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DrawOrderGroupItem",r.DrawOrderGroupItem),e(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DrawOrderItem",t.DrawOrderItem),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerDrawingOrderModule",a.LayerDrawingOrderModule),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerDrawingOrderViewModel",n.LayerDrawingOrderViewModel),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerGroupsDialogView",s.LayerGroupsDialogView),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerGroupsDialogViewModel",o.LayerGroupsDialogViewModel),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderLayersDialogView",l.OrderLayersDialogView),e(d,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderLayersDialogViewModel",d.OrderLayersDialogViewModel),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderServicesDialogView",c.OrderServicesDialogView),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderServicesDialogViewModel",p.OrderServicesDialogViewModel)})}();