!function(){function e(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var a=t.split("."),i=null,n=window,s=0,o=a.length;s<o;s++)i=a[s],s==o-1?n[i]=r:n[i]||(n[i]={}),n=n[i];else console.warn("Undefined shim for: "+t)}var t="<div class='measurement-unit-switcher'>    <ul class='list-menu has-icon' data-binding='{@source: lengthUnits}{@value: selectedLengthUnits}{@visible: lengthSwitcherSelected}'>        <li class='list-menu-item' data-binding='{@template-for: lengthUnits}{@event-onclick: handleSetLengthUnits}'>            <span class='list-menu-details' data-binding='{@text: @context}'></span>        </li>    </ul>    <ul class='list-menu has-icon' data-binding='{@source: areaUnits}{@value: selectedAreaUnits}{@hidden: lengthSwitcherSelected}'>        <li class='list-menu-item' data-binding='{@template-for: areaUnits}{@event-onclick: handleSetAreaUnits}'>            <span class='list-menu-details' data-binding='{@text: @context}'></span>        </li>    </ul></div>",r="<ul class='transient-measurement'>    <li class='toolbar-item select-double'>        <select data-binding='{@source: lengthUnits}{@value: selectedLengthUnits}{disabled: measurementInProgress}{title: @language-measurement-length-select}{aria-label: @language-measurement-length-select}'>            <option data-binding='{@template-for: lengthUnits}{value: @context}{@text: @context}' />        </select>        <select data-binding='{@source: areaUnits}{@value: selectedAreaUnits}{disabled: measurementInProgress}{title: @language-measurement-area-select}{aria-label: @language-measurement-area-select}'>            <option data-binding='{@template-for: areaUnits}{value: @context}{@text: @context}' />        </select>    </li></ul>",a="<div class='toolbar-tool-mode'>    <div class='tbtm-done' data-binding='{@event-onclick: handleClickClose}'>        <span data-binding='{@text: @language-menu-done}'></span>    </div>    <div class='tbtm-list'>        <ul class='five'>            <li class='tbtm-checkbox'>                <input type='checkbox' id='tbtm-add-drawing' data-binding='{@value: addMarkupToMap}{disabled: measurementInProgress}' />                <p for='tbtm-add-drawing' data-binding='{@text: @language-measurement-add-as-drawing}'>\x3c!-- 'Add as Drawing' --\x3e</p>            </li>            <li>                <button class='tbtm-select' data-binding='{@event-onclick: handleShowLengthSwitcher}'>                    <h1 class='tbtm-units'><span data-binding='{@text: selectedLengthUnitShort}'></span><span class='icon icon-select'></span></h1>                    <p data-binding='{@text: @language-measurement-length-label}'></p>                </button>            </li>            <li>                <button class='tbtm-select' data-binding='{@event-onclick: handleShowAreaSwitcher}'>                    <h1 class='tbtm-units'><span data-binding='{@text: selectedAreaUnitShort}'></span><span class='icon icon-select'></span></h1>                    <p data-binding='{@text: @language-measurement-area-label}'></p>                </button>            </li>            <li>                <button class='tbtm-btn' data-binding='{@disabled: descriptorContainerEmpty}{@class-highlight: eraseActive}{@event-onclick: handleEraseMeasurement}'>                    <span class='icon icon-erase-24'></span>                    <p data-binding='{@text: @language-toolbar-erase}'></p>                </button>            </li>            <li>                <button class='tbtm-btn' data-binding='{@disabled: descriptorContainerEmpty}{@event-onclick: handleClearAll}'>                    <span class='icon icon-clear-24'></span>                    <p data-binding='{@text: @language-toolbar-clear-all}'></p>                </button>            </li>        </ul>    </div></div>";require({cache:{"Mapping/modules/Measurement/HighlightedMeasurementLabel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic"],function(t,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._addedGraphicsToMapLayer=[],e}return e(r,t),r.prototype.addToMapGraphicLayer=function(e){var t=this;void 0===e&&(e=!1),e&&(this._addedGraphicsToMapLayer=[]),this._addedGraphicsToMapLayer.push(this.app.map.graphics.add(this.highlightGraphic)),this.highlightIdTagGraphic&&this._addedGraphicsToMapLayer.push(this.app.map.graphics.add(this.highlightIdTagGraphic)),this.textGraphics.forEach(function(e){t._addedGraphicsToMapLayer.push(t.app.map.graphics.add(e))}),this.show()},r.prototype.getMapGraphics=function(){return this._addedGraphicsToMapLayer},r.prototype.addToMeasurementLayer=function(e){void 0===e&&(e=!0),t.prototype.addToLayer.call(this,e)},r.prototype.hide=function(){return t.prototype.hide.call(this),this._addedGraphicsToMapLayer.forEach(function(e){e.hide()}),this},r.prototype.show=function(){return t.prototype.show.call(this),this._addedGraphicsToMapLayer.forEach(function(e){e.show()}),this},r.prototype.assignMeasurementId=function(e){t.prototype.assignGraphicIdentifierKey.call(this,"measurementId",e)},r}(a.HighlightedLabelGraphic);r.HighlightedMeasurementLabel=i})},"Mapping/modules/Measurement/MeasurementMarkupManager":function(){define(["require","exports","./Descriptors/GeometryDescriptor","geocortex/framework/observables","geocortex/infrastructure/coordinates/AngleFormat","geocortex/infrastructure/coordinates/AngleDirectionSystem","./MeasurementModule","./Descriptors/LineSegmentDescriptor","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat","./Descriptors/DescriptorBase","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/GraphicsLayerUtils","./MeasurementUtils","geocortex/infrastructure/tools/DrawMode"],function(e,t,r,a,i,n,s,o,u,m,l,p,c,h,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t,r){var s=this;this.GCX_UNIT_YARDS=12345,this.GCX_UNIT_SQ_NAUTICAL_MILES="gcXSqNauticalMileConstant",this.geometryIdCounter=1,this.descriptorContainer=[],this.markupLayerId=null,this.measurementLayerId=null,this.unit={feet:null,yard:null,meter:null,kilometer:null,mile:null,nauticalMile:null,sqFeet:null,sqYard:null,sqMeter:null,sqKilometer:null,sqMile:null,sqNauticalMile:null,acre:null,hectare:null},this.measurementResultTypes=[],this.coordinateFractionalDigits=4,this.measurementFractionalDigits=2,this.degreeFormat=i.DD,this.angleDirectionSystem=n.POLAR,this.addedMapGraphics=[],this._zoomEndToken=null,this._predictiveMeasurementToken=null,this._delayedExecuteToken=null,this._mapOutToken=null,this._measurementInProgressToken=null,this._predictiveMeasurementsGraphic=null,this._measurementModule=null,this._predictiveMeasurementCount=null,this._lengthUnit=null,this._areaUnit=null,this._lengthUnitString=null,this._areaUnitString=null,this._currentLineSegmentInProcess=null,this._currentGeometryInProcess=null,this._measurementLayersCreated=null,this._toolActive=!1,this._predictiveMeasurementTextColor=null,this._predictiveMeasurementHighlightColor=null,this._predictiveMeasurementOutlineColor=null,this._predictiveMeasurementOutlineWidth=null,this._predictiveMeasurementHighlightRadius=null,this._predictiveMeasurementTextSize=null,this._featureWhichIsBeingDeleted=null,this.app=t,this.libraryId=r,this._measurementModule=e,this._predictiveMeasurementCount=0,this._measurementLayersCreated=!1,this.measurementInProgress=new a.Observable(!1),this.descriptorContainerEmpty=new a.Observable(!0),this._getUnitLanguageResources(),this._subscribeEvents(),this.descriptorContainerEmpty.bind(this,function(e){e&&s._zoomEndToken?(s._zoomEndToken.remove(),s._zoomEndToken=null,s.app.command("ClearMarkup").raiseCanExecuteChanged()):e||s._zoomEndToken||(s._zoomEndToken=s.app.map.on("zoom-end",dojo.hitch(s,s.refreshLabels)))})}return e.prototype._subscribeEvents=function(){this.app.event("MarkupEditingStartedEvent").subscribe(this,this._processMarkupEditingStarted),this.app.event("MarkupEditingStoppedEvent").subscribe(this,this._processMarkupEditingStopped),this.app.event("MarkupDeletedEvent").subscribe(this,this._processMarkupDeleted),this.app.event("MarkupClearedEvent").subscribe(this,this.destroyAllDescriptors),this.app.event("_deleteClickableFeatureStarted").subscribe(this,this._handleDeleteClickableFeatureStarted),this.app.event("GraphicRemovedEvent").subscribe(this,this._handleGraphicRemoved)},e.prototype.formatMeasurement=function(e,t){return void 0===t&&(t=2),null==e||"number"!=typeof e?"":u.formatNumber(e,m.NumberFormat.NUMBER,{fractionalDigits:t})},e.prototype.measurementCompleted=function(){var e=this;this.addedMapGraphics.forEach(function(t){t.getMapGraphics().forEach(function(t){e.app.map.graphics.remove(t)})}),this.addedMapGraphics.forEach(function(e){e.addToMeasurementLayer(e.isVisible())})},e.prototype.createDescriptor=function(e,t){var a=null;switch(e){case l.DescriptorType.LINE_SEGMENT:a=new o.LineSegmentDescriptor(t,this.app),this._currentLineSegmentInProcess=a;break;case l.DescriptorType.POLYLINE:case l.DescriptorType.POLYGON:a=new r.GeometryDescriptor(this.geometryIdCounter.toString(),e,t,this.app),this.descriptorContainer.push(a),this.geometryIdCounter++,this._currentGeometryInProcess=a;break;default:this._reportStatus("MeasurementMarkupManager: Invalid Descriptor type","error",!1)}return this.descriptorContainerEmpty.set(!1),a},e.prototype.destroyDescriptor=function(e,t,r){var a=this;void 0===t&&(t=!1),void 0===r&&(r=!0);for(var i=0;i<this.descriptorContainer.length;i++)if(t||this.descriptorContainer[i].id===e){var n=this.descriptorContainer[i];n.setInactive();for(var s=0;s<n._lineSegments.length;s++){var o=n._lineSegments[s];this._removeGraphicFromLayer(o.graphic),this._removeHighlightedLabelFromLayer(o.highlightedLabelGraphic)}if((t||!t&&r)&&this._removeGraphicFromLayer(n.graphic),n.highlightedLabelGraphic&&(this._removeGraphicFromLayer(n.highlightedLabelGraphic.highlightGraphic),n.highlightedLabelGraphic.textGraphics.forEach(function(e){a._removeGraphicFromLayer(e)}),this._removeHighlightedLabelFromLayer(n.highlightedLabelGraphic)),n.measurementData){var u=this.app.featureSetManager.getCollectionById("Measurement");u&&u.featureSets.removeItem(n.measurementData)}if(this._currentGeometryInProcess&&this._currentGeometryInProcess.id===n.id&&(this._currentGeometryInProcess=null),this.app.event("MeasurementMarkupDeleted").publish({graphic:n.graphic,measurementDescriptor:n}),!t){this.descriptorContainer.splice(i,1);break}i===this.descriptorContainer.length-1&&(this.descriptorContainer=[])}0===this.descriptorContainer.length&&this.descriptorContainerEmpty.set(!0)},e.prototype.getGeometryDescriptorById=function(e){for(var t=0;t<this.descriptorContainer.length;t++)if(this.descriptorContainer[t].id===e)return this.descriptorContainer[t];return null},e.prototype.getGeometryDescriptorByGeometry=function(e){for(var t=e,r=0;r<this.descriptorContainer.length;r++)if(t.declaredClass===this.descriptorContainer[r].geometry.declaredClass){var a=this.descriptorContainer[r].geometry;if(t===a)return this.descriptorContainer[r];var i=t.paths?t.paths.length:t.rings?t.rings.length:0;if(i===(a.paths?a.paths.length:a.rings.length))for(var n=0;n<i;n++){var s=t.paths?t.paths[n].length:t.rings[n].length;if(s===(a.paths?a.paths[n].length:a.rings[n].length))for(var o=0;o<s;o++){var u=t.getPoint(n,o),m=a.getPoint(n,o);if(u.x!==m.x||u.y!==m.y)break;if(o===s-1)return this.descriptorContainer[r]}break}}return null},e.prototype.getMeasurementResultsCollection=function(){var e=this.app.featureSetManager.getCollectionById("Measurement");return e||((e=new p.FeatureSetCollection).id="Measurement",e.sourceName="Measurement",e.displayName.set(this.getResource("language-measurement-results-collection-name")),this.app.featureSetManager.addCollection(e)),e},e.prototype.destroyAllDescriptors=function(){this.destroyDescriptor("",!0)},e.prototype.refreshLabels=function(){for(var e=0;e<this.descriptorContainer.length;e++)this.descriptorContainer[e].refreshLabelVisibilityAndPosition()},e.prototype.activatePredictiveMeasurements=function(){var e=this;if(this._measurementModule._enablePrediction){var t=!0,r={x:0,y:0};this._predictiveMeasurementToken=this.app.map.on("mouse-move",function(a){if(r.x!==a.mapPoint.x||r.y!==a.mapPoint.y){r.x=a.mapPoint.x,r.y=a.mapPoint.y;switch(t){case!1:e._predictiveMeasurementsGraphic&&e._predictiveMeasurementsGraphic.isVisible()&&e._predictiveMeasurementsGraphic.hide(),e._delayedExecuteToken&&(clearTimeout(e._delayedExecuteToken),e._delayedExecuteToken=null),t=!0;case!0:e._delayedExecuteToken=setTimeout(function(){e._predictiveMeasurementCount++,e._executePredictiveMeasurements(a.mapPoint,e._predictiveMeasurementCount)},1e3),t=!1}}})}},e.prototype.deactivatePredictiveMeasurements=function(){this._measurementModule._enablePrediction&&(this._delayedExecuteToken&&(clearTimeout(this._delayedExecuteToken),this._delayedExecuteToken=null),this._predictiveMeasurementToken&&(this._predictiveMeasurementToken.remove(),this._predictiveMeasurementToken=null),this._predictiveMeasurementCount=0,this._predictiveMeasurementsGraphic&&this._predictiveMeasurementsGraphic.hide())},e.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},e.prototype._setLayerIds=function(e,t){this.markupLayerId=e||this.markupLayerId,this.measurementLayerId=t||this.measurementLayerId},e.prototype._setMapTipPresentation=function(e,t,r,a,i,n){this._predictiveMeasurementTextColor=e,this._predictiveMeasurementHighlightColor=t,this._predictiveMeasurementOutlineColor=r,this._predictiveMeasurementOutlineWidth=a,this._predictiveMeasurementHighlightRadius=i,this._predictiveMeasurementTextSize=n},e.prototype._executePredictiveMeasurements=function(e,t){var r=this;if(this._currentGeometryInProcess&&this._currentLineSegmentInProcess&&this._currentLineSegmentInProcess.mapPointStart){if(!this._measurementLayersCreated){var a=c.getInternalGraphicsLayer(this.markupLayerId,this.app,c.GraphicsLayerType.Markup,!0),i=c.getInternalGraphicsLayer(this.measurementLayerId,this.app,c.GraphicsLayerType.Label);a&&i&&(this._measurementLayersCreated=!0)}var n=0,o=0===this._currentGeometryInProcess._lineSegments.length?this._currentLineSegmentInProcess.mapPointStart:this._currentGeometryInProcess._lineSegments[this._currentGeometryInProcess._lineSegments.length-1].mapPointEnd,u="";if(e.x!==o.x||e.y!==o.y)switch(this._currentGeometryInProcess.type){case l.DescriptorType.POLYLINE:var m=new esri.geometry.Polyline(o.spatialReference);m.addPath([o,e]),this._measurementModule._processLineSegment(m,function(a){n=r._currentGeometryInProcess.length?a.length+r._currentGeometryInProcess.length:a.length;var i=s.measurementMarkupManager.formatMeasurement(a.length,r.measurementFractionalDigits),o=s.measurementMarkupManager.formatMeasurement(n,r.measurementFractionalDigits);u=r.getResource("language-measurement-polyline-predictive-markup-label").format(i,r._lengthUnitString,o,r._lengthUnitString),t===r._predictiveMeasurementCount&&(r._predictiveMeasurementsGraphic=h.addHighlightedLabelToMap(u,e,null,r.measurementLayerId,r.app,!0,0,0,"Arial",r._predictiveMeasurementTextSize,r._predictiveMeasurementTextColor,r._predictiveMeasurementHighlightColor,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,r._predictiveMeasurementOutlineColor,r._predictiveMeasurementOutlineWidth),r._predictiveMeasurementHighlightRadius,0,!0),r.app.command("ScreenReaderNarrate").execute(u))});break;case l.DescriptorType.POLYGON:for(var p=new esri.geometry.Polygon(o.spatialReference),g=[],d=0;d<this._currentGeometryInProcess._lineSegments.length;d++)g.push(this._currentGeometryInProcess._lineSegments[d].mapPointStart),g.push(this._currentGeometryInProcess._lineSegments[d].mapPointEnd);0===g.length&&g.push(o,e),g.push(e),g.push(g[0]),p.addRing(g),this._measurementModule._processPolygon(p,function(a){var i=new esri.geometry.Polyline(o.spatialReference);i.addPath([o,e]),r._measurementModule._processLineSegment(i,function(i){var n=0===a.perimeter?2*i.length:a.perimeter,o=s.measurementMarkupManager.formatMeasurement(i.length,r.measurementFractionalDigits),m=s.measurementMarkupManager.formatMeasurement(a.area,r.measurementFractionalDigits),l=s.measurementMarkupManager.formatMeasurement(n,r.measurementFractionalDigits);u=r.getResource("language-measurement-polygon-predictive-markup-label").format(o,r._lengthUnitString,m,r._areaUnitString,l,r._lengthUnitString),t===r._predictiveMeasurementCount&&(r._predictiveMeasurementsGraphic=h.addHighlightedLabelToMap(u,e,null,r.measurementLayerId,r.app,!0,0,0,"Arial",r._predictiveMeasurementTextSize,r._predictiveMeasurementTextColor,r._predictiveMeasurementHighlightColor,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,r._predictiveMeasurementOutlineColor,r._predictiveMeasurementOutlineWidth),r._predictiveMeasurementHighlightRadius,0,!0),r.app.command("ScreenReaderNarrate").execute(u))})})}}},e.prototype._createMeasurementMarkupFromGeometry=function(e){if(e&&(e instanceof esri.geometry.Polyline||e instanceof esri.geometry.Polygon)){this.app.command("_clearMeasurementMarkup").execute("temporary",!0);var t=this.getGeometryDescriptorByGeometry(e),r=!0;if(!t){var a=null;t=this.createDescriptor(e instanceof esri.geometry.Polyline?l.DescriptorType.POLYLINE:l.DescriptorType.POLYGON,e.spatialReference),a=e instanceof esri.geometry.Polyline?new esri.geometry.Polyline(e.toJson()):new esri.geometry.Polygon(e.toJson()),t.setGeometry(a),r=!1,this.app.command("_addGeometryMarkup").execute(t)}this.narrateGeometryDescriptor(t),this._recreateMeasurementMarkup(t.graphic,r,!1)}else this._reportStatus("CreateMeasurementMarkup: Invalid geometry type. Measurement information can only be generated for Polyline or Polygon geometry types.","error",!1)},e.prototype.narrateGeometryDescriptor=function(e){this.app.command("ScreenReaderNarrate").execute(this.getResource("language-measurement-accessibility-measured").format(e.labelStr))},e.prototype._handleDeleteClickableFeatureStarted=function(e){e&&e.esriFeature&&e.esriFeature.get()&&(this._featureWhichIsBeingDeleted=e.esriFeature.get())},e.prototype._handleGraphicRemoved=function(e){e&&e.graphic&&this._featureWhichIsBeingDeleted===e.graphic&&(this._featureWhichIsBeingDeleted=null)},e.prototype._recreateMeasurementMarkup=function(e,t,r){var i=this;if(void 0===t&&(t=!0),void 0===r&&(r=!0),!this._featureWhichIsBeingDeleted||this._featureWhichIsBeingDeleted!==e){var n=function(e){i.app.command(h).execute(e,function(){i.measurementInProgress.set(!1),e.refreshMeasurementData(),i._reportStatus("Successfully computed measurement information for specified geometry/graphic.","info",!1)},o)},o=function(e){i.measurementInProgress.set(!1),s.measurementMarkupManager._reportStatus("Error recreating measurement markup: {0}","error",!1,[e])};if(e&&e.geometry&&void 0!=e.measurementId){var u=e.measurementId,m=e.geometry,p=0,c=0;new a.Observable(0);if(m.paths?p=m.paths.length:m.rings&&(p=m.rings.length),e&&m instanceof esri.geometry.Polyline||m instanceof esri.geometry.Polygon){var h=m instanceof esri.geometry.Polyline?"MeasureDistance":"MeasureArea",d=m instanceof esri.geometry.Polyline?l.DescriptorType.POLYLINE:l.DescriptorType.POLYGON,M=this.getGeometryDescriptorById(u);if(!M||M&&t){var y=null;M&&(y=M.originalZoomLevel,this.destroyDescriptor(u,!1,r)),(M=this.createDescriptor(d,m.spatialReference)).originalZoomLevel=null===y?M.originalZoomLevel:y,M.drawMode="polyline"===m.type?g.DrawMode.POLYLINE:g.DrawMode.POLYGON,e.measurementId=M.id}M.setGeometry(m),M.graphic=e;for(var _=[],f=[],S=0;S<p;S++)for(var b=m instanceof esri.geometry.Polyline?m.paths[S].length:m.rings[S].length,v=1;v<b;v++){var k=m.getPoint(S,v-1),L=m.getPoint(S,v);if(k&&L){var G=this.createDescriptor(l.DescriptorType.LINE_SEGMENT,m.spatialReference);G.id=M.id,G.setStartPt(k),G.setEndPt(L),G.mapPointStart.x===G.mapPointEnd.x&&G.mapPointStart.y===G.mapPointEnd.y||(_.push(G),f.push(G.geometry),c++)}}this.measurementInProgress.set(!0),this._measurementModule._processLineSegment(f,function(e){for(var t=e.serverResponse.lengths.length,r=e.serverResponse.lengths,a=0;a<t;a++)_[a].setMeasurementUnit(i._lengthUnit),_[a].length=r[a],i.app.command("_addLineSegmentMeasurementMarkup").execute(_[a],function(e){e.isActive=M.isActive,M.addSegment(e),a===t-1&&n(M)},o)},o)}else this._reportStatus("Could not recreate measurement markup. Incompatible geometry. Only Polyline and Polygon geometry are supported.","warning",!1)}}},e.prototype._hideMeasurementMarkup=function(e,t){if(void 0===t&&(t=!1),1!=this.measurementInProgress.get()){this._measurementInProgressToken&&(this.measurementInProgress.unbind(this._measurementInProgressToken),this._measurementInProgressToken=null);for(var r=0;r<this.descriptorContainer.length;r++)if(this.descriptorContainer[r].id===e.measurementId){for(var a=0;a<this.descriptorContainer[r]._lineSegments.length;a++){var i=this.descriptorContainer[r]._lineSegments[a];i.graphic&&i.graphic.hide(),i.highlightedLabelGraphic&&i.highlightedLabelGraphic.hide()}var n=this.descriptorContainer[r];t&&n.graphic&&n.graphic.hide(),n.highlightedLabelGraphic&&n.highlightedLabelGraphic.hide();break}}else{var s=e,o=t;this._measurementInProgressToken=this.measurementInProgress.bind(this,function(){this._hideMeasurementMarkup(s,o)})}},e.prototype._updateMeasurementUnits=function(e,t){for(var r=0;r<this.descriptorContainer.length;r++)this.descriptorContainer[r].setMeasurementUnit(e,t);this._lengthUnit=e,this._areaUnit=t,this._lengthUnitString=h.getUnitString(e),this._areaUnitString=h.getUnitString(t)},e.prototype._removeGraphicFromLayer=function(e){if(e){var t=e.getLayer();t&&t.remove(e)}},e.prototype._removeHighlightedLabelFromLayer=function(e){var t=this;e.textGraphics.forEach(function(e){t._removeGraphicFromLayer(e)}),this._removeGraphicFromLayer(e.highlightGraphic);var r=this.addedMapGraphics.indexOf(e);-1!==r&&this.addedMapGraphics.splice(r,1)},e.prototype._canExecuteMarkupIntegration=function(e){return!(!e||void 0==e.measurementId)},e.prototype._processMarkupEditingStarted=function(e){if(this._canExecuteMarkupIntegration(e)){var t=this.getGeometryDescriptorById(e.measurementId);t&&(this._hideMeasurementMarkup(e),t.editingInProgress=!0)}},e.prototype._processMarkupEditingStopped=function(e){if(this._canExecuteMarkupIntegration(e)){var t=this.getGeometryDescriptorById(e.measurementId);t&&(this._recreateMeasurementMarkup(e,!0,!1),t.editingInProgress=!1)}},e.prototype._processMarkupDeleted=function(e){this._canExecuteMarkupIntegration(e)&&this.destroyDescriptor(e.measurementId)},e.prototype._getUnitLanguageResources=function(){for(var e in this.unit)this.unit.hasOwnProperty(e)&&(this.unit[e]={shortName:this.getResource("language-measurement-unit-"+e.toLowerCase()+"-short"),longName:this.getResource("language-measurement-unit-"+e.toLowerCase()),config:e})},e.prototype._reportStatus=function(e,t,r,a){var i=this;void 0===r&&(r=!1),void 0===a&&(a=null);var n="language-measurement-"===e.substring(0,21)?this.getResource(e):e;a&&(n=n.format.apply(n,a));var s=function(){r&&i.app.command("ClearActiveTool").execute()};switch(t.toLowerCase()){case"alert":return void this.app.command("Alert").execute(n,this.getResource("language-measurement-alert-title"),function(){s()});case"info":this.app.trace.info(n);break;case"warning":this.app.trace.warning(n);break;case"error":this.app.trace.error(n)}s()},e}();t.MeasurementMarkupManager=d})},"Mapping/modules/Measurement/MeasurementModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","./MeasurementMarkupManager","geocortex/framework/application/ModuleBase","geocortex/infrastructure/validation/NumberValidator","./MeasurementUtils","./Descriptors/GeometryDescriptor","geocortex/infrastructure/Feature","geocortex/infrastructure/GeometryUtils","./Descriptors/LineSegmentDescriptor","./Descriptors/DescriptorBase","geocortex/essentials/GeometryUtilities"],function(t,r,a,i,n,s,o,u,m,l,p,c){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=function(t){function i(e,i){var s=t.call(this,e,i)||this;return s._measurementWkid=-1,s._measurementSpatialReference=null,s._currentSpatialReference=null,s._numberValidator=new n.NumberValidator,r.measurementMarkupManager=new a.MeasurementMarkupManager(s,e,i),s.app.toolRegistry.registerToolTypeForCommand("MeasureArea","geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementTool"),s.app.toolRegistry.registerToolTypeForCommand("MeasureDistance","geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementTool"),s}return e(i,t),i.prototype.initialize=function(e){this._registerCommands(),this._measurementWkid=e&&e.measurementProjectionWkid&&""!=e.measurementProjectionWkid?parseInt(e.measurementProjectionWkid,10):-1;var t=-1===this._measurementWkid?"geodesic":"planar";this._calculationType=e&&e.calculationType&&("planar"===e.calculationType||"geodesic"===e.calculationType||"preserveShape"===e.calculationType)?e.calculationType:t,this._enablePrediction=!e||void 0==e.enablePrediction||e.enablePrediction,this._measurementLengthUnits=s.getGeometryServiceUnitConstant(e.measurementLengthUnits||"feet"),this._measurementAreaUnits=s.getGeometryServiceUnitConstant(e.measurementAreaUnits||"squarefeet"),this._segmentWarningThreshold=void 0!=e.numSegmentsWarningThreshold?parseInt(e.numSegmentsWarningThreshold,10):1e3,e&&e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),r.measurementMarkupManager._updateMeasurementUnits(this._measurementLengthUnits,this._measurementAreaUnits),e&&e.measurementResultTypes&&(r.measurementMarkupManager.measurementResultTypes=e.measurementResultTypes),e&&e.coordinateFractionalDigits&&(r.measurementMarkupManager.coordinateFractionalDigits=e.coordinateFractionalDigits),e&&e.measurementFractionalDigits&&(r.measurementMarkupManager.measurementFractionalDigits=e.measurementFractionalDigits),e&&e.degreeFormat&&(r.measurementMarkupManager.degreeFormat=e.degreeFormat.toLowerCase()),e&&e.angleDirectionSystem&&(r.measurementMarkupManager.angleDirectionSystem=e.angleDirectionSystem.toLowerCase()),-1!==this._measurementWkid&&(this._measurementSpatialReference=new esri.SpatialReference(this._measurementWkid)),this.app.map&&this.app.map.loaded?this._onMapLoaded():this.app.event("MapLoadedEvent").subscribe(this,this._onMapLoaded)},i.prototype.getStateFilter=function(){return{lengthUnit:!0,areaUnit:!0,measurements:{item:this._getMeasurementShapeFilter()}}},i.prototype.exportState=function(){return Promise.try(function(){return{lengthUnit:r.measurementMarkupManager._lengthUnit,areaUnit:r.measurementMarkupManager._areaUnit,measurements:r.measurementMarkupManager.descriptorContainer.map(function(e){return e.exportState()})}})},i.prototype.applyState=function(e){var t=this;return Promise.try(function(){r.measurementMarkupManager._lengthUnit=e.lengthUnit,r.measurementMarkupManager._lengthUnitString=s.getUnitString(e.lengthUnit),r.measurementMarkupManager._areaUnit=e.areaUnit,r.measurementMarkupManager._areaUnitString=s.getUnitString(e.areaUnit),t._measurementLengthUnits=e.lengthUnit,t._measurementAreaUnits=e.areaUnit,t.app.command("_applyMeasurementUnits").execute(e.lengthUnit,e.areaUnit)}).then(function(){return t.app.waitUntilMapLoaded()}).then(function(){return Promise.map(e.measurements,function(e){var r=t.app.project.convert.toEsriSpatialReference(e.spatialReference),a=new o.GeometryDescriptor(e.id,e.type,r,t.app);return a.applyState(e),a})}).then(function(e){r.measurementMarkupManager.descriptorContainer=e,r.measurementMarkupManager.descriptorContainerEmpty.set(0===e.length)}).return()},i.prototype._getHighlightedLabelFilter=function(){return{highlightGraphic:this.app.project.filter.graphic,highlightSymbol:this.app.project.filter.simpleMarkerSymbol,textGraphics:{item:this.app.project.filter.graphic},textSymbols:{item:this.app.project.filter.textSymbol},layerId:!0,mapPoint:this.app.project.filter.point,text:!0,labelXoffset:this._numberValidator,labelYoffset:this._numberValidator,fontFamily:!0,fontSize:!0,cornerRadius:this._numberValidator,angle:this._numberValidator,anchor:!0,textColor:this.app.project.filter.color,highlightColor:this.app.project.filter.color,highlightOutlineSymbol:this.app.project.filter.simpleLineSymbol}},i.prototype._getDescriptorFilter=function(){return{id:!0,geometry:this.app.project.filter.geometry,length:this._numberValidator,type:this._numberValidator,spatialReference:this.app.project.filter.spatialReference,graphic:this.app.project.filter.graphic,feature:this.app.project.filter.feature,label:this._getHighlightedLabelFilter()}},i.prototype._getMeasurementSegmentFilter=function(){return $.extend({},this._getDescriptorFilter(),{startPoint:this.app.project.filter.point,endPoint:this.app.project.filter.point})},i.prototype._getMeasurementShapeFilter=function(){return $.extend({},this._getDescriptorFilter(),{segments:{item:this._getMeasurementSegmentFilter()},area:this._numberValidator,simplifiedGeometry:this.app.project.filter.geometry,originalZoomLevel:this._numberValidator,drawMode:!0,measurementData:this.app.project.filter.featureSet})},i.prototype._onMapLoaded=function(){this._currentSpatialReference=this.app.map.spatialReference,this._measurementSpatialReference||(this._measurementSpatialReference=this._currentSpatialReference)},i.prototype._registerCommands=function(){this.app.command("MeasureDistance").register(this,this._executeMeasurementCommand,this._canExecuteMeasureDistance),this.app.command("MeasureArea").register(this,this._executeMeasurementCommand,this._canExecuteMeasureArea),this.app.command("SetMeasurementUnits").register(this,this._setMeasurementUnits),this.app.event("GeometryChangedEvent").subscribe(this,this.handleGraphicEdited)},i.prototype.handleGraphicEdited=function(e){var t=e.graphic;t&&t.hasOwnProperty("measurementId")&&("polygon"===t.geometry.type?this._reCalculatePolygonDimensions(t):"polyline"===t.geometry.type&&this._reCalculatePolylineDimensions(t))},i.prototype._canExecuteMeasureArea=function(e){if(e instanceof u.Feature&&e.featureSet&&e.featureSet.isMeasurement)return!1;var t=this._retrieveGeometry(e),r=m.getGeometryService(this.app),a=e instanceof l.LineSegmentDescriptor;return!!t&&!!(t&&r&&(a||t instanceof esri.geometry.Polygon))},i.prototype._canExecuteMeasureDistance=function(e){if(e instanceof u.Feature&&e.featureSet&&e.featureSet.isMeasurement)return!1;var t=this._retrieveGeometry(e),r=m.getGeometryService(this.app),a=e instanceof l.LineSegmentDescriptor;return!!t&&!!(t&&r&&(a||t instanceof esri.geometry.Polyline))},i.prototype._executeMeasurementCommand=function(e,t,a){var i=this,n=function(e){i.app.command("ClearDefaultHighlights").execute(),r.measurementMarkupManager._createMeasurementMarkupFromGeometry(e)};if(e instanceof p.DescriptorBase)this._executeMeasurement(e,t,a);else{var s=this._retrieveGeometry(e);if(s){var o=function(e){for(var t=0,r=e.hasOwnProperty("rings")?e.rings:e.paths,a=0;a<r.length;a++)t+=r[a].length-1;return t}(s);o>this._segmentWarningThreshold?this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-measurement-high-line-segments-warning").format(o),null,function(e){e&&n(s)}):n(s)}}},i.prototype._retrieveGeometry=function(e){var t=null;if(e)if(e instanceof p.DescriptorBase||e instanceof esri.Graphic)t=e.geometry;else if(e instanceof esri.geometry.Geometry)t=e;else if(e instanceof u.Feature&&e.esriFeature){var r=e.esriFeature.get();r&&(t=r.geometry)}return t},i.prototype._executeMeasurement=function(e,t,a){var i=this;switch(r.measurementMarkupManager.measurementInProgress.get()||r.measurementMarkupManager.measurementInProgress.set(!0),e.type){case p.DescriptorType.LINE_SEGMENT:this._processLineSegment(e,function(e){var n=r.measurementMarkupManager.getGeometryDescriptorById(e.id);e.isActive=!!n&&n.isActive,i.app.command("_addLineSegmentMeasurementMarkup").execute(e,t,function(e){i._tryErrorCallback(a,e)})},function(e){i._tryErrorCallback(a,e)});break;case p.DescriptorType.POLYLINE:this.app.command("_addCompletedGeometryMeasurementMarkup").execute(e,t,function(e){i._tryErrorCallback(a,e)});break;case p.DescriptorType.POLYGON:this._processPolygon(e,function(e){i.app.command("_addCompletedGeometryMeasurementMarkup").execute(e,t,a)},function(e){i._tryErrorCallback(a,e)});break;default:this._tryErrorCallback(a,new Error("Invalid Descriptor Type"))}},i.prototype._processLineSegment=function(e,t,r){var a=this,i=e instanceof l.LineSegmentDescriptor?e.geometry:e;i=i instanceof Array?i:[i],this._tryProject(i,this._measurementSpatialReference,function(i){a._measurePolylineLengths(i,a._measurementLengthUnits,function(r){var i={length:r.lengths[0],serverResponse:r};e instanceof l.LineSegmentDescriptor?(e.setMeasurementUnit(a._measurementLengthUnits),e.length=i.length,t(e)):t(i)},function(e){a._tryErrorCallback(r,e)})},function(e){a._projectionError(e),a._tryErrorCallback(r,e)})},i.prototype._reCalculatePolylineDimensions=function(e){var t=this,r=e,a=function(e){t.app.trace.info("Successfully computed measurement information for specified geometry/ graphic."),r.attributes&&(r.attributes.Length=e,t._raiseGraphicAttributesChangedEvent(r))},i=function(e){var a="Error calculating measurement markup: {0}";t.app.trace.error(a.format.apply(a,[e])),r.attributes&&(r.attributes.Length=t.getResource("language-measurement-value-not-available"),t._raiseGraphicAttributesChangedEvent(r))},n=(m.getGeometryService(this.app),[e.geometry]);this._tryProject(n,this._measurementSpatialReference,function(e){t._measurePolylineLengths(e,t._measurementLengthUnits,function(e){var t={length:e.lengths[0],serverResponse:e};a(t.length)},function(e){t._tryErrorCallback(i,e)})},function(e){t._projectionError(e),t._tryErrorCallback(i,e)})},i.prototype._reCalculatePolygonDimensions=function(e){var t=this,r=e,a=function(e,a){t.app.trace.info("Successfully computed measurement information for specified geometry/ graphic."),r.attributes&&(r.attributes.Area=e,r.attributes.Length=a,t._raiseGraphicAttributesChangedEvent(r))},i=function(e){var a="Error calculating measurement markup: {0}";t.app.trace.error(a.format.apply(a,[e])),r.attributes&&(r.attributes.Area=t.getResource("language-measurement-value-not-available"),r.attributes.Length=t.getResource("language-measurement-value-not-available"),t._raiseGraphicAttributesChangedEvent(r))},n=m.getGeometryService(this.app),s=[e.geometry];n.simplify(s,function(e){t._tryProject(e,t._measurementSpatialReference,function(e){t._measurePolygonAreaAndPerimeter(e,t._measurementLengthUnits,t._measurementAreaUnits,function(e){var t={area:e.areas[0],perimeter:e.lengths[0],serverResponse:e};a(t.area,t.perimeter)},function(e){t._tryErrorCallback(i,e)})},function(e){t._projectionError(e),t._tryErrorCallback(i,e)})},function(e){t._tryErrorCallback(i,e)})},i.prototype._raiseGraphicAttributesChangedEvent=function(e){var t={graphic:e};this.app.event("GraphicAttributesChangedEvent").publish(t)},i.prototype._processPolygon=function(e,t,r){var a=this,i=function(r,i){e.area=r,e.simplifiedGeometry=i,e.unit||e.setMeasurementUnit(a._measurementLengthUnits,a._measurementAreaUnits),t(e)};if(e instanceof o.GeometryDescriptor&&2===e._lineSegments.length)i(0,null);else{var n=e instanceof o.GeometryDescriptor?e.geometry:e;n=n instanceof Array?n:[n],m.getGeometryService(this.app).simplify(n,function(n){a._tryProject(n,a._measurementSpatialReference,function(s){a._measurePolygonAreaAndPerimeter(s,a._measurementLengthUnits,a._measurementAreaUnits,function(r){var a={area:r.areas[0],perimeter:r.lengths[0],serverResponse:r};e instanceof o.GeometryDescriptor?i(a.area,n[0]):t(a)},function(e){a._tryErrorCallback(r,e)})},function(e){a._projectionError(e),a._tryErrorCallback(r,e)})},function(e){a._tryErrorCallback(r,e)})}},i.prototype._tryProject=function(e,t,r,a){var i=this;if(c.spatialRefsAreEqual(this._currentSpatialReference,t,!1))r(e);else{var n=new esri.tasks.ProjectParameters;n.geometries=e,n.outSR=t,this._calculationType="planar",m.project(n,r,function(e){i._tryErrorCallback(a,e)},this.app)}},i.prototype._measurePolylineLengths=function(e,t,a,i){var n=this,o=!1;t===r.measurementMarkupManager.GCX_UNIT_YARDS&&(t=esri.tasks.GeometryService.UNIT_FOOT,o=!0);var u=new esri.tasks.LengthsParameters;u.calculationType=this._calculationType,"preserveShape"!=this._calculationType&&(u.geodesic="planar"!=this._calculationType),u.lengthUnit=t,u.polylines=e,m.getGeometryService(this.app).lengths(u,function(e){if(o)for(var t=0;t<e.lengths.length;t++)e.lengths[t]=s.convertLength(e.lengths[t],esri.tasks.GeometryService.UNIT_FOOT,r.measurementMarkupManager.GCX_UNIT_YARDS);a(e)},function(e){n._tryErrorCallback(i,e)})},i.prototype._measurePolygonAreaAndPerimeter=function(e,t,a,i,n){var o=this,u=!1;t===r.measurementMarkupManager.GCX_UNIT_YARDS&&(t=esri.tasks.GeometryService.UNIT_FOOT,u=!0);var l=!1;a===r.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES&&(a=esri.tasks.GeometryService.UNIT_SQUARE_MILES,l=!0);var p=new esri.tasks.AreasAndLengthsParameters;p.lengthUnit=t,p.areaUnit=a,p.calculationType=this._calculationType,p.polygons=e,m.getGeometryService(this.app).areasAndLengths(p,function(e){if(u)for(var t=0;t<e.lengths.length;t++)e.lengths[t]=s.convertLength(e.lengths[t],esri.tasks.GeometryService.UNIT_FOOT,r.measurementMarkupManager.GCX_UNIT_YARDS);if(l)for(var a=0;a<e.areas.length;a++)e.areas[a]=s.convertArea(e.areas[a],esri.tasks.GeometryService.UNIT_SQUARE_MILES,r.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES);i(e)},function(e){o._tryErrorCallback(n,e)})},i.prototype._setMeasurementUnits=function(e,t){this._measurementLengthUnits=s.getGeometryServiceUnitConstant(e),this._measurementAreaUnits=s.getGeometryServiceUnitConstant(t),r.measurementMarkupManager._updateMeasurementUnits(this._measurementLengthUnits,this._measurementAreaUnits)},i.prototype._projectionError=function(e){r.measurementMarkupManager._reportStatus("language-measurement-projection-error","alert",!0,[this._measurementWkid,e])},i.prototype._tryErrorCallback=function(e,t){e&&e(t)},i}(i.ModuleBase);r.MeasurementModule=h})},"Mapping/modules/Measurement/MeasurementOperation":function(){define(["require","exports","geocortex/framework/observables","./MeasurementModule","./Descriptors/DescriptorBase"],function(e,t,r,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.pointIndex=0,this._currentGeometry=null,this._currentLineSegment=null,this._prevSegEndPt=null,this._tool=null,this._tool=e,this._lineSegmentCommandCallbackCompleted=new r.Observable(0),this._drawEndInvoked=!1,this._totalSegmentCount=0}return e.prototype.setStartPt=function(e){var t=this;t._tool.app.command("_clearMeasurementMarkup").execute("temporary",!0),function(e){t._currentGeometry="POLYLINE"===t._tool.drawMode?a.measurementMarkupManager.createDescriptor(i.DescriptorType.POLYLINE,e.mapPoint.spatialReference):a.measurementMarkupManager.createDescriptor(i.DescriptorType.POLYGON,e.mapPoint.spatialReference),t._currentLineSegment=a.measurementMarkupManager.createDescriptor(i.DescriptorType.LINE_SEGMENT,e.mapPoint.spatialReference),t._currentLineSegment.id=t._currentGeometry.id;var r=e.snappingPoint?e.snappingPoint:e.mapPoint;t._currentLineSegment.setStartPt(r),a.measurementMarkupManager.activatePredictiveMeasurements(),t.pointIndex=1}(e)},e.prototype.setEndPt=function(e){var t=this;if(this._currentLineSegment.mapPointStart.x!==e.mapPoint.x||this._currentLineSegment.mapPointStart.y!==e.mapPoint.y){if(this._prevSegEndPt){if(this._prevSegEndPt.x===e.mapPoint.x&&this._prevSegEndPt.y===e.mapPoint.y)return;this._currentLineSegment=a.measurementMarkupManager.createDescriptor(i.DescriptorType.LINE_SEGMENT,this._prevSegEndPt.spatialReference),this._currentLineSegment.id=this._currentGeometry.id,this._currentLineSegment.setStartPt(this._prevSegEndPt),this._prevSegEndPt=null}var r=e.snappingPoint?e.snappingPoint:e.mapPoint;this._currentLineSegment.setEndPt(r),this._prevSegEndPt=this._currentLineSegment.mapPointEnd,this._totalSegmentCount++,this._tool.executeToolCommand(this._currentLineSegment,function(e){t._currentGeometry.addSegment(e),t._lineSegmentCommandCallbackCompleted.set(t._lineSegmentCommandCallbackCompleted.get()+1)})}},e.prototype.plotPoint=function(e){0===this.pointIndex?this.setStartPt(e):this.setEndPt(e)},e.prototype.executeDrawEnd=function(e){var t=this;if(a.measurementMarkupManager.deactivatePredictiveMeasurements(),0===this._totalSegmentCount)return a.measurementMarkupManager._reportStatus("No geometry drawn. Cannot compute measurements","info",!1),void a.measurementMarkupManager.destroyDescriptor(this._currentGeometry.id);var r=function(){a.measurementMarkupManager.measurementInProgress.get()&&a.measurementMarkupManager.measurementInProgress.set(!1)},i=function(){t._tool.isSticky||t._tool.setActive(!1)},n=function(e){t._tool.onDrawCompleted(e,t._currentGeometry,function(e){r(),i(),e.refreshMeasurementData()},function(e){r(),i(),t._tool._onDrawCompletedError(e)})};if(this._drawEndInvoked=!0,this._currentGeometry.setGeometry(e),this._tool.app.command("_addGeometryMarkup").execute(t._currentGeometry),this._lineSegmentCommandCallbackCompleted.get()===this._totalSegmentCount)n(e);else var s=this._lineSegmentCommandCallbackCompleted.bind(this,function(r){r===t._totalSegmentCount&&(t._lineSegmentCommandCallbackCompleted.unbind(s),n(e))})},e}();t.MeasurementOperation=n})},"Mapping/modules/Measurement/MeasurementState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Measurement/MeasurementTool":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/tools/MapTool","./MeasurementModule","geocortex/infrastructure/tools/DrawMode","./MeasurementOperation","geocortex/infrastructure/accessibility/Draw","./Descriptors/DescriptorBase"],function(t,r,a,i,n,s,o,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var m=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.clickHandlerToken=null,a.drawEndHandlerToken=null,a.keyDownHandlerToken=null,a.mapMouseHoverToken=null,a._toolSuspended=!1,a.app.command("_suspendMeasurementToolIfActive").register(a,function(){i.measurementMarkupManager._toolActive?a._drawIsActive&&a._drawObject&&(a._toolSuspended=!0,a._drawObject.deactivate()):a.app.command("ClearActiveTool").execute()}),a.app.command("_resumeMeasurementToolIfSuspended").register(a,function(){a._toolSuspended&&a._drawObject&&(a._toolSuspended=!1,a._drawObject.activate(esri.toolbars.Draw[a.drawMode]))}),a}return e(r,t),r.prototype.onActivated=function(){var e=this;if(this.drawMode!==n.DrawMode.POLYLINE&&this.drawMode!==n.DrawMode.POLYGON)return t.prototype.onActivated.call(this);if(!this._drawObject){this._drawObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.draw",this.app.map,{enableEditing:!1}),this._drawObject.setFillSymbol(new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.25]))),this._drawObject.setLineSymbol(new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2)),this._drawObject.setRespectDrawingVertexOrder(!0);var r=null,a=function(t){r&&!r._drawEndInvoked||(r=new s.MeasurementOperation(e)),r.plotPoint(t)};this.clickHandlerToken&&this.drawEndHandlerToken||(this.clickHandlerToken=this.app.event("GraphicVertexAddedEvent").subscribe(this,function(t){t&&t.sender===e._drawObject&&a(t)}),this.drawEndHandlerToken=dojo.aspect.after(this._drawObject,"onDrawEnd",function(e){r.executeDrawEnd(e),r=null},!0)),this.keyDownHandlerToken||(this.keyDownHandlerToken=this.app.map.on("key-down",function(t){27!==t.which&&27!==t.keyCode||(e.isSticky?(e.onDeactivated(),e.onActivated()):e.setActive(!1))})),this._drawObject instanceof o.Draw&&!this._inputMethodChangeHandle&&(this._inputMethodChangeHandle=dojo.aspect.after(this._drawObject,"onInputMethodChange",dojo.hitch(this,"onInputMethodChange"),!0))}return this._drawIsActive&&(this._drawObject.deactivate(),this._drawIsActive=!1),this.app.map.graphics?(this.mapMouseHoverToken=this.app.event("MapMouseHoverEvent").subscribe(this,this.onMapMouseHover),this._drawObject.activate(esri.toolbars.Draw[this.drawMode]),this._drawIsActive=!0,i.measurementMarkupManager._toolActive=!0,!0):(setTimeout(function(){i.measurementMarkupManager._reportStatus("language-measurement-null-graphics-error","alert",!0)},0),!1)},r.prototype.onDeactivated=function(){t.prototype.onDeactivated.call(this),this.clickHandlerToken&&(this.app.event("GraphicVertexAddedEvent").unsubscribe(this.clickHandlerToken),this.clickHandlerToken=null),this.drawEndHandlerToken&&(this.drawEndHandlerToken.remove(),this.drawEndHandlerToken=null),this.keyDownHandlerToken&&(this.keyDownHandlerToken.remove(),this.keyDownHandlerToken=null),this._inputMethodChangeHandle&&(this._inputMethodChangeHandle.remove(),this._inputMethodChangeHandle=null),this.mapMouseHoverToken&&(this.app.event("MapMouseHoverEvent").unsubscribe(this.mapMouseHoverToken),this.mapMouseHoverToken=null),i.measurementMarkupManager.deactivatePredictiveMeasurements(),i.measurementMarkupManager.measurementInProgress.get()&&i.measurementMarkupManager.measurementInProgress.set(!1),this.isSticky?this.app.command("_clearMeasurementMarkup").execute("temporary",!0):i.measurementMarkupManager._currentGeometryInProcess&&!i.measurementMarkupManager._currentGeometryInProcess.graphic&&i.measurementMarkupManager.destroyDescriptor(i.measurementMarkupManager._currentGeometryInProcess.id),this._drawObject&&delete this._drawObject,i.measurementMarkupManager._toolActive=!1},r.prototype.executeToolCommand=function(e,t,r){if(this.command){var a=this.app.command(this.command);a.canExecute(e)?a.execute(e,function(e){t&&t(e)},function(e){i.measurementMarkupManager._reportStatus("Execute Tool Command Error - Measurement Tools: {0}","error",!1,[e]),r&&r(e)}):i.measurementMarkupManager._reportStatus("Could not invoke command '{0}' for tool '{1}'.","error",!0,[this.name,this.command])}},r.prototype._onDrawCompletedError=function(e){i.measurementMarkupManager._reportStatus("Measurement Tool - Error on Draw Complete: {0}","error",!0,[e])},r.prototype.onDrawCompleted=function(e,t,r,a){var n=this,s="Measurement Tools: onDrawCompleted - Descriptor type mismatch",o=function(e){r&&r(e)},m=function(e,t){a&&a(t?new Error(t):e)};if(e instanceof esri.geometry.Polygon)if(t.type===u.DescriptorType.POLYGON){var l=t._lineSegments,p=l[l.length-1].mapPointEnd,c=l[0].mapPointStart;if(p.x!==c.x||p.y!==c.y){var h=i.measurementMarkupManager.createDescriptor(u.DescriptorType.LINE_SEGMENT,e.spatialReference);h.id=t.id,h.setStartPt(p),h.setEndPt(c),this.executeToolCommand(h,function(e){t.addSegment(e),n.executeToolCommand(t,o,m)},m)}else this.executeToolCommand(t,o,m)}else m(null,s);else e instanceof esri.geometry.Polyline?t.type===u.DescriptorType.POLYLINE?this.executeToolCommand(t,o,m):m(null,s):m(null,"Only Polygon and Polyline geometries supported")},r}(a.MapTool);r.MeasurementTool=m})},"Mapping/modules/Measurement/MeasurementUtils":function(){define(["require","exports","./HighlightedMeasurementLabel","./MeasurementModule","geocortex/essentials/DistanceUnit","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic"],function(e,t,r,a,i,n,s,o){"use strict";function u(e){return e.split(h)}function m(e){return(h.test(e)?e.match(h).length:0)+1}Object.defineProperty(t,"__esModule",{value:!0});var l=null,p=null,c={},h=/\r\n|\r|\n/g;t.getUnitString=function(e,t){void 0===t&&(t=!1);var r="";if(!e)return r;switch(e){case esri.Units.FEET:case esri.tasks.GeometryService.UNIT_FOOT:case a.measurementMarkupManager.unit.feet.shortName:case a.measurementMarkupManager.unit.feet.longName:case a.measurementMarkupManager.unit.feet.config:r=t?a.measurementMarkupManager.unit.feet.longName:a.measurementMarkupManager.unit.feet.shortName;break;case esri.Units.YARDS:case a.measurementMarkupManager.GCX_UNIT_YARDS:case a.measurementMarkupManager.unit.yard.shortName:case a.measurementMarkupManager.unit.yard.longName:case a.measurementMarkupManager.unit.yard.config:r=t?a.measurementMarkupManager.unit.yard.longName:a.measurementMarkupManager.unit.yard.shortName;break;case esri.Units.METERS:case esri.tasks.GeometryService.UNIT_METER:case a.measurementMarkupManager.unit.meter.shortName:case a.measurementMarkupManager.unit.meter.longName:case a.measurementMarkupManager.unit.meter.config:r=t?a.measurementMarkupManager.unit.meter.longName:a.measurementMarkupManager.unit.meter.shortName;break;case esri.Units.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER:case a.measurementMarkupManager.unit.kilometer.shortName:case a.measurementMarkupManager.unit.kilometer.longName:case a.measurementMarkupManager.unit.kilometer.config:r=t?a.measurementMarkupManager.unit.kilometer.longName:a.measurementMarkupManager.unit.kilometer.shortName;break;case esri.Units.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE:case a.measurementMarkupManager.unit.mile.shortName:case a.measurementMarkupManager.unit.mile.longName:case a.measurementMarkupManager.unit.mile.config:r=t?a.measurementMarkupManager.unit.mile.longName:a.measurementMarkupManager.unit.mile.shortName;break;case esri.Units.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:case a.measurementMarkupManager.unit.nauticalMile.shortName:case a.measurementMarkupManager.unit.nauticalMile.longName:case a.measurementMarkupManager.unit.nauticalMile.config:r=t?a.measurementMarkupManager.unit.nauticalMile.longName:a.measurementMarkupManager.unit.nauticalMile.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_FEET:case esri.Units.SQUARE_FEET:case a.measurementMarkupManager.unit.sqFeet.shortName:case a.measurementMarkupManager.unit.sqFeet.longName:case a.measurementMarkupManager.unit.sqFeet.config:r=t?a.measurementMarkupManager.unit.sqFeet.longName:a.measurementMarkupManager.unit.sqFeet.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_METERS:case esri.Units.SQUARE_METERS:case a.measurementMarkupManager.unit.sqMeter.shortName:case a.measurementMarkupManager.unit.sqMeter.longName:case a.measurementMarkupManager.unit.sqMeter.config:r=t?a.measurementMarkupManager.unit.sqMeter.longName:a.measurementMarkupManager.unit.sqMeter.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS:case esri.Units.SQUARE_KILOMETERS:case a.measurementMarkupManager.unit.sqKilometer.shortName:case a.measurementMarkupManager.unit.sqKilometer.longName:case a.measurementMarkupManager.unit.sqKilometer.config:r=t?a.measurementMarkupManager.unit.sqKilometer.longName:a.measurementMarkupManager.unit.sqKilometer.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_MILES:case esri.Units.SQUARE_MILES:case a.measurementMarkupManager.unit.sqMile.shortName:case a.measurementMarkupManager.unit.sqMile.longName:case a.measurementMarkupManager.unit.sqMile.config:r=t?a.measurementMarkupManager.unit.sqMile.longName:a.measurementMarkupManager.unit.sqMile.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_YARDS:case esri.Units.SQUARE_YARDS:case a.measurementMarkupManager.unit.sqYard.shortName:case a.measurementMarkupManager.unit.sqYard.longName:case a.measurementMarkupManager.unit.sqYard.config:r=t?a.measurementMarkupManager.unit.sqYard.longName:a.measurementMarkupManager.unit.sqYard.shortName;break;case a.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES:case a.measurementMarkupManager.unit.sqNauticalMile.shortName:case a.measurementMarkupManager.unit.sqNauticalMile.longName:case a.measurementMarkupManager.unit.sqNauticalMile.config:r=t?a.measurementMarkupManager.unit.sqNauticalMile.longName:a.measurementMarkupManager.unit.sqNauticalMile.shortName;break;case esri.tasks.GeometryService.UNIT_ACRES:case esri.Units.ACRES:case a.measurementMarkupManager.unit.acre.shortName:case a.measurementMarkupManager.unit.acre.longName:case a.measurementMarkupManager.unit.acre.config:r=t?a.measurementMarkupManager.unit.acre.longName:a.measurementMarkupManager.unit.acre.shortName;break;case esri.tasks.GeometryService.UNIT_HECTARES:case esri.Units.HECTARES:case a.measurementMarkupManager.unit.hectare.shortName:case a.measurementMarkupManager.unit.hectare.longName:case a.measurementMarkupManager.unit.hectare.config:r=t?a.measurementMarkupManager.unit.hectare.longName:a.measurementMarkupManager.unit.hectare.shortName}return r},t.getGeometryServiceUnitConstant=function(e,t){if(!e)return null;var r=null;switch(e){case esri.Units.ACRES:case a.measurementMarkupManager.unit.acre.longName:case a.measurementMarkupManager.unit.acre.shortName:case a.measurementMarkupManager.unit.acre.config:case esri.tasks.GeometryService.UNIT_ACRES.toString():r=esri.tasks.GeometryService.UNIT_ACRES;break;case esri.Units.ARES:case esri.tasks.GeometryService.UNIT_ARES.toString():r=esri.tasks.GeometryService.UNIT_ARES;break;case a.measurementMarkupManager.unit.feet.longName:case a.measurementMarkupManager.unit.feet.shortName:case a.measurementMarkupManager.unit.feet.config:case i.DistanceUnitType.FEET:case esri.tasks.GeometryService.UNIT_FOOT.toString():case esri.Units.FEET:r=esri.tasks.GeometryService.UNIT_FOOT;break;case esri.Units.HECTARES:case a.measurementMarkupManager.unit.hectare.longName:case a.measurementMarkupManager.unit.hectare.shortName:case a.measurementMarkupManager.unit.hectare.config:case esri.tasks.GeometryService.UNIT_HECTARES.toString():r=esri.tasks.GeometryService.UNIT_HECTARES;break;case a.measurementMarkupManager.unit.kilometer.longName:case a.measurementMarkupManager.unit.kilometer.shortName:case a.measurementMarkupManager.unit.kilometer.config:case i.DistanceUnitType.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER.toString():case esri.Units.KILOMETERS:r=esri.tasks.GeometryService.UNIT_KILOMETER;break;case a.measurementMarkupManager.unit.meter.longName:case a.measurementMarkupManager.unit.meter.shortName:case a.measurementMarkupManager.unit.meter.config:case i.DistanceUnitType.METERS:case esri.tasks.GeometryService.UNIT_METER.toString():case esri.Units.METERS:r=esri.tasks.GeometryService.UNIT_METER;break;case a.measurementMarkupManager.unit.mile.longName:case a.measurementMarkupManager.unit.mile.shortName:case a.measurementMarkupManager.unit.mile.config:case i.DistanceUnitType.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE.toString():case esri.Units.MILES:r=esri.tasks.GeometryService.UNIT_STATUTE_MILE;break;case a.measurementMarkupManager.unit.nauticalMile.longName:case a.measurementMarkupManager.unit.nauticalMile.shortName:case a.measurementMarkupManager.unit.nauticalMile.config:case i.DistanceUnitType.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE.toString():case esri.Units.NAUTICAL_MILES:r=esri.tasks.GeometryService.UNIT_NAUTICAL_MILE;break;case a.measurementMarkupManager.unit.yard.longName:case a.measurementMarkupManager.unit.yard.shortName:case a.measurementMarkupManager.unit.yard.config:case i.DistanceUnitType.YARDS:case esri.Units.YARDS:r=a.measurementMarkupManager.GCX_UNIT_YARDS;break;case esri.Units.SQUARE_CENTIMETERS:case esri.tasks.GeometryService.UNIT_SQUARE_CENTIMETERS.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_CENTIMETERS;break;case esri.Units.SQUARE_DECIMETERS:case esri.tasks.GeometryService.UNIT_SQUARE_DECIMETERS.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_DECIMETERS;break;case a.measurementMarkupManager.unit.sqFeet.longName:case a.measurementMarkupManager.unit.sqFeet.shortName:case a.measurementMarkupManager.unit.sqFeet.config:case esri.tasks.GeometryService.UNIT_SQUARE_FEET.toString():case esri.Units.SQUARE_FEET:r=esri.tasks.GeometryService.UNIT_SQUARE_FEET;break;case esri.Units.SQUARE_INCHES:case esri.tasks.GeometryService.UNIT_SQUARE_INCHES.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_INCHES;break;case a.measurementMarkupManager.unit.sqKilometer.longName:case a.measurementMarkupManager.unit.sqKilometer.shortName:case a.measurementMarkupManager.unit.sqKilometer.config:case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS.toString():case esri.Units.SQUARE_KILOMETERS:r=esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS;break;case a.measurementMarkupManager.unit.sqMeter.longName:case a.measurementMarkupManager.unit.sqMeter.shortName:case a.measurementMarkupManager.unit.sqMeter.config:case esri.tasks.GeometryService.UNIT_SQUARE_METERS.toString():case esri.Units.SQUARE_METERS:r=esri.tasks.GeometryService.UNIT_SQUARE_METERS;break;case a.measurementMarkupManager.unit.sqMile.longName:case a.measurementMarkupManager.unit.sqMile.shortName:case a.measurementMarkupManager.unit.sqMile.config:case esri.tasks.GeometryService.UNIT_SQUARE_MILES.toString():case esri.Units.SQUARE_MILES:r=esri.tasks.GeometryService.UNIT_SQUARE_MILES;break;case a.measurementMarkupManager.unit.sqNauticalMile.longName:case a.measurementMarkupManager.unit.sqNauticalMile.shortName:case a.measurementMarkupManager.unit.sqNauticalMile.config:r=a.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES;break;case esri.Units.SQUARE_MILLIMETERS:case esri.tasks.GeometryService.UNIT_SQUARE_MILLIMETERS.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_MILLIMETERS;break;case a.measurementMarkupManager.unit.sqYard.longName:case a.measurementMarkupManager.unit.sqYard.shortName:case a.measurementMarkupManager.unit.sqYard.config:case esri.tasks.GeometryService.UNIT_SQUARE_YARDS.toString():case esri.Units.SQUARE_YARDS:r=esri.tasks.GeometryService.UNIT_SQUARE_YARDS;break;default:r=t||e}return r},t.addGraphicToLayer=function(e,t,r){return n.addGraphicToLayer(e,t,r)},t.getGraphicsLayer=function(e,t,r){return n.getInternalGraphicsLayer(e,r,n.GraphicsLayerType.Label)},t.getLabelSize=function(e,t,r,a){for(var i=!0,n=null,s=m(e),o=u(e),l=0,h=0;o&&h<o.length;h++){for(var g=e.length,d=0,M=0;M<g;M++){var y=o[h].charAt(M);y=" "===y?".":y,d+=c.hasOwnProperty(y)?c[y]:function(e){if(i){var s=document.getElementById(a+"_layer");(n=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttributeNS(null,"font-size",r),n.setAttributeNS(null,"font-family",t),n.setAttributeNS(null,"visibility","hidden"),n.textContent=e,s.appendChild(n),i=!1}else n.textContent=e;var o=n.getBBox();return p=null===p?o.height:p,c[e]=n.getComputedTextLength(),c[e]}(y)}d>l&&(l=d)}return{width:Math.ceil(l),height:Math.ceil(p*s)}},t.getRenderedLineSegmentLength=function(e){if(!e||!e.mapPointStart||!e.mapPointEnd)return null;var t=a.measurementMarkupManager.app.map.toScreen(e.mapPointStart),r=a.measurementMarkupManager.app.map.toScreen(e.mapPointEnd),i=Math.abs(r.x-t.x),n=Math.abs(r.y-t.y);return Math.sqrt(i*i+n*n)},t.plotPointOnMap=function(e,t,r,a){var i=new esri.Graphic;new dojo.Color(t);i.geometry=e,i.symbol=s.defaultMarkerSymbol(),i.symbol.setColor(new esri.Color(t)),this.addGraphicToLayer(i,r,a)},t.addHighlightedLabelToMap=function(e,t,i,n,s,u,p,c,h,g,d,M,y,_,f,S){void 0===u&&(u=!1),void 0===p&&(p=0),void 0===c&&(c=0),void 0===h&&(h="Arial"),void 0===g&&(g="12px"),void 0===d&&(d=new esri.Color("white")),void 0===M&&(M=new esri.Color("black")),void 0===y&&(y=null),void 0===_&&(_=0),void 0===f&&(f=0),void 0===S&&(S=!1);var b={};b.layerId=n,b.mapPoint=t,b.text=e,b.labelXoffset=p,b.labelYoffset=c,b.fontFamily=h,b.fontSize=g,b.cornerRadius=_,b.angle=f,b.anchor=o.HighlightedLabelAnchor.MIDDLE,b.textColor=d,b.highlightColor=M,b.highlightOutlineSymbol=y;var v,k=!1;m(e);return l?(l.textGraphics&&l.textGraphics.length>0&&l.textGraphics[0].getLayer()&&l.highlightGraphic.getLayer()&&(k=!0),l.isVisible()&&l.hide()):u&&(b.anchor=o.HighlightedLabelAnchor.BOTTOM_LEFT,l=new r.HighlightedMeasurementLabel(b,s)),u?(v=l).update(t,e):v=new r.HighlightedMeasurementLabel(b,s),!u&&i&&v.assignMeasurementId(i),(!u||u&&!k)&&(v.addToMapGraphicLayer(),u||a.measurementMarkupManager.addedMapGraphics.push(v)),S?v.show():v.hide(),v},t.getTextLines=u,t.svgRoundedRectanglePath=function(e,t,r){return"M0,0h"+(e-r)+"a"+r+","+r+" 0 0 1 "+r+","+r+"v"+(t-2*r)+"a"+r+","+r+" 0 0 1 "+-r+","+r+"h"+(r-e)+"a"+r+","+r+" 0 0 1 "+-r+","+-r+"v"+(2*r-t)+"a"+r+","+r+" 0 0 1 "+r+","+-r+"z"},t.refreshHighlightSymbolSize=function(e,t,r,a){void 0===r&&(r="Arial"),void 0===a&&(a="12px");var i=this.getLabelSize(e,r,a),n=.5*i.height,s=i.width+n,o=i.height+n;if(t){t.setStyle("STYLE_PATH");var u="M0,0h"+s+"v"+o+"h-"+s+"z";t.setPath(u)}return t},t.convertLength=function(e,t,r){var i=0;switch(t){case esri.tasks.GeometryService.UNIT_METER:i=3.280839895013*e;break;case esri.tasks.GeometryService.UNIT_KILOMETER:i=3280.839895013123*e;break;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:i=5280*e;break;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:i=6076.12*e;break;case a.measurementMarkupManager.GCX_UNIT_YARDS:i=3*e;break;default:i=e}switch(r){case esri.tasks.GeometryService.UNIT_METER:return i/3.280839895013;case esri.tasks.GeometryService.UNIT_KILOMETER:return i/3280.839895013123;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:return i/5280;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:return i/6076.12;case a.measurementMarkupManager.GCX_UNIT_YARDS:return i/3;default:return i}},t.convertArea=function(e,t,r){var i=0;switch(t){case esri.tasks.GeometryService.UNIT_SQUARE_METERS:i=10.76391041670891*e;break;case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS:i=10763910.41670972*e;break;case esri.tasks.GeometryService.UNIT_SQUARE_MILES:i=27878400*e;break;case esri.tasks.GeometryService.UNIT_SQUARE_YARDS:i=9*e;break;case esri.tasks.GeometryService.UNIT_ACRES:i=43560*e;break;case esri.tasks.GeometryService.UNIT_HECTARES:i=107639*e;break;case a.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES:i=36919234.2544*e;break;default:i=e}switch(r){case esri.tasks.GeometryService.UNIT_SQUARE_METERS:return i/10.76391041670891;case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS:return i/10763910.41670972;case esri.tasks.GeometryService.UNIT_SQUARE_MILES:return i/27878400;case a.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES:return i/36919234.2544;case esri.tasks.GeometryService.UNIT_SQUARE_YARDS:return i/9;case esri.tasks.GeometryService.UNIT_ACRES:return i/43560;case esri.tasks.GeometryService.UNIT_HECTARES:return i/107639;default:return i}}})},"Mapping/modules/Measurement/MeasurementView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.measurementSwitcherView=null,a}return e(r,t),r.prototype.attach=function(e){t.prototype.attach.call(this,e),this.measurementSwitcherView=this.app.viewManager.getViewById("MeasurementUnitSwitcherView")},r.prototype.activateUnitSwitcherView=function(){this.measurementSwitcherView&&!this.measurementSwitcherView.isActive&&this.app.command("ActivateView").execute("MeasurementUnitSwitcherView")},r.prototype.deactivateUnitSwitcherView=function(){this.measurementSwitcherView&&this.measurementSwitcherView.isActive&&this.app.command("DeactivateView").execute("MeasurementUnitSwitcherView")},r.prototype.handleClickClose=function(){this.deactivateUnitSwitcherView(),this.app.command("ClearActiveTool").execute()},r.prototype.handleShowLengthSwitcher=function(){this.viewModel.measurementInProgress.get()||(this.viewModel.lengthSwitcherSelected.set(!0),this.activateUnitSwitcherView())},r.prototype.handleShowAreaSwitcher=function(){this.viewModel.measurementInProgress.get()||(this.viewModel.lengthSwitcherSelected.set(!1),this.activateUnitSwitcherView())},r.prototype.handleSetLengthUnits=function(e,t,r){this.viewModel.selectedLengthUnits.set(r),this.deactivateUnitSwitcherView()},r.prototype.handleSetAreaUnits=function(e,t,r){this.viewModel.selectedAreaUnits.set(r),this.deactivateUnitSwitcherView()},r}(a.ViewBase);r.MeasurementView=i})},"Mapping/modules/Measurement/MeasurementViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./MeasurementModule","./MeasurementUtils","./Descriptors/DescriptorBase","geocortex/infrastructure/GraphicUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/coordinates/CoordinateUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/GraphicsLayerIds"],function(t,r,a,i,n,s,o,u,m,l,p,c){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.measurementGraphicId=0,a._lineColor=null,a._fillColor=null,a._textColor=null,a._highlightColor=null,a._outlineColor=null,a._outlineWidth=null,a._totalMeasurementTextColor=null,a._totalMeasurementHighlightColor=null,a._totalMeasurementOutlineColor=null,a._totalMeasurementOutlineWidth=null,a._lineDescriptionFormat=null,a._highlightRadius=null,a._textSize=null,a._textOffset=null,a._count=-1,a._markupLayer=null,a._measurementLayer=null,a._currentMarkupSegmentGraphics=[],a._temporaryMarkupSegmentGraphics=[],a._isRestoringState=!1,a._labelSizeAdjustmentFactor=1.25,a._defaultTextOffset=0,a._defaultOutlineWidth=0,a._defaultHighlightRadius=5,a._flipLabelThreshold=1e3,a._polylineLabelOffset=5,a._polygonFormatString=n.measurementMarkupManager.getResource("language-measurement-polygon-final-markup-label"),a._polylineFormatString=n.measurementMarkupManager.getResource("language-measurement-polyline-final-markup-label"),a}return e(r,t),r.prototype.initialize=function(e){var t=this;e=e||{},this._lineColor=e.lineColor?new esri.Color(e.lineColor):null,this._fillColor=e.fillColor?new esri.Color(e.fillColor):null,this._textColor=e.textColor?new esri.Color(e.textColor):null,this._highlightColor=e.highlightColor?new esri.Color(e.highlightColor):null,this._outlineColor=e.outlineColor?new esri.Color(e.outlineColor):null,this._outlineWidth=void 0!=e.outlineWidth?parseFloat(e.outlineWidth):this._defaultOutlineWidth,this._totalMeasurementTextColor=e.totalMeasurementTextColor?new esri.Color(e.totalMeasurementTextColor):null,this._totalMeasurementHighlightColor=e.totalMeasurementHighlightColor?new esri.Color(e.totalMeasurementHighlightColor):null,this._totalMeasurementOutlineColor=e.totalMeasurementOutlineColor?new esri.Color(e.totalMeasurementOutlineColor):null,this._totalMeasurementOutlineWidth=void 0!=e.totalMeasurementOutlineWidth?parseFloat(e.totalMeasurementOutlineWidth):this._defaultOutlineWidth,this._lineDescriptionFormat=e.lineDescriptionFormat?e.lineDescriptionFormat:"{0}",this._highlightRadius=void 0!=e.highlightRadius?parseInt(e.highlightRadius):this._defaultHighlightRadius,this._textSize=e.textSize?e.textSize:"12px",this._textOffset=void 0!=e.textOffset?parseInt(e.textOffset):this._defaultTextOffset,this._textAboveMarkup=void 0!=e.textAboveMarkup&&e.textBelowMarkup,this._flipLabelThreshold=void 0!=e.disablePolygonLabelFlipThreshold?parseInt(e.disablePolygonLabelFlipThreshold):1e3,this._polylineLabelOffset=void 0!=e.polylineLabelOffset?parseInt(e.polylineLabelOffset):this._polylineLabelOffset,this.addMarkupToMap=new i.Observable(e.addMarkupToMapByDefault||!1),n.measurementMarkupManager._setLayerIds(c.MARKUP_LAYER_ID,c.MEASUREMENT_LAYER_ID),n.measurementMarkupManager._setMapTipPresentation(this._totalMeasurementTextColor,this._totalMeasurementHighlightColor,this._totalMeasurementOutlineColor,this._totalMeasurementOutlineWidth,this._highlightRadius,this._textSize),this._textFont=new esri.symbol.Font,this._textFont.setSize(this._textSize),this._textFont.setFamily("Arial"),this.lengthUnits=new i.ObservableCollection([n.measurementMarkupManager.unit.feet.longName,n.measurementMarkupManager.unit.yard.longName,n.measurementMarkupManager.unit.meter.longName,n.measurementMarkupManager.unit.kilometer.longName,n.measurementMarkupManager.unit.mile.longName,n.measurementMarkupManager.unit.nauticalMile.longName]),this.areaUnits=new i.ObservableCollection([n.measurementMarkupManager.unit.sqFeet.longName,n.measurementMarkupManager.unit.sqYard.longName,n.measurementMarkupManager.unit.sqMeter.longName,n.measurementMarkupManager.unit.sqKilometer.longName,n.measurementMarkupManager.unit.sqMile.longName,n.measurementMarkupManager.unit.sqNauticalMile.longName,n.measurementMarkupManager.unit.acre.longName,n.measurementMarkupManager.unit.hectare.longName]),this.selectedAreaUnits=new i.Observable(s.getUnitString(n.measurementMarkupManager._areaUnitString,!0)),this.selectedAreaUnitShort=new i.Observable(s.getUnitString(n.measurementMarkupManager._areaUnitString)),this.selectedLengthUnits=new i.Observable(s.getUnitString(n.measurementMarkupManager._lengthUnitString,!0)),this.selectedLengthUnitShort=new i.Observable(s.getUnitString(n.measurementMarkupManager._lengthUnitString)),this.measurementInProgress=new i.Observable(!1),this.descriptorContainerEmpty=new i.Observable(!0),this.lengthSwitcherSelected=new i.Observable(!0),this.eraseActive=new i.Observable(!1),this.measurementInProgress.sync(n.measurementMarkupManager.measurementInProgress),this.descriptorContainerEmpty.sync(n.measurementMarkupManager.descriptorContainerEmpty),this.selectedAreaUnits.bind(this,function(e){t._isRestoringState||t.app.command("SetMeasurementUnits").execute(t.selectedLengthUnits.get(),e),t.selectedAreaUnitShort.set(s.getUnitString(n.measurementMarkupManager._areaUnitString))}),this.selectedLengthUnits.bind(this,function(e){t._isRestoringState||t.app.command("SetMeasurementUnits").execute(e,t.selectedAreaUnits.get()),t.selectedLengthUnitShort.set(s.getUnitString(n.measurementMarkupManager._lengthUnitString))}),this.addMarkupToMap.bind(this,function(e){e?(t._currentMarkupSegmentGraphics=t._temporaryMarkupSegmentGraphics.slice(0),t._temporaryMarkupSegmentGraphics=[]):(t._temporaryMarkupSegmentGraphics=t._currentMarkupSegmentGraphics.slice(0),t._currentMarkupSegmentGraphics=[])}),this._registerCommands()},r.prototype._registerCommands=function(){var e=this;this.app.command("DeleteMeasurement").register(this,this._executeDeleteMeasurementCommand,this._canExecuteDeleteMeasurementCommand),this.app.command("_addLineSegmentMeasurementMarkup").register(this,this._executeAddLineSegmentMeasurementMarkup,this._canExecuteAddMarkup),this.app.command("_addCompletedGeometryMeasurementMarkup").register(this,this._executeAddCompletedGeometryMeasurementMarkup,this._canExecuteAddMarkup),this.app.command("_addGeometryMarkup").register(this,this._executeAddGeometryMarkup,this._canExecuteAddMarkup),this.app.command("_clearMeasurementMarkup").register(this,this._executeClearMeasurementMarkup),this.app.command("_applyMeasurementUnits").register(this,function(t,r){e._isRestoringState=!0,e.selectedLengthUnits.set(s.getUnitString(t,!0)),e.selectedAreaUnits.set(s.getUnitString(r,!0)),e._isRestoringState=!1})},r.prototype._canExecuteAddMarkup=function(e){return this._markupLayer&&this._measurementLayer||(this._markupLayer=m.getInternalGraphicsLayer(c.MARKUP_LAYER_ID,this.app,m.GraphicsLayerType.Markup,!0),this._measurementLayer=m.getInternalGraphicsLayer(c.MEASUREMENT_LAYER_ID,this.app,m.GraphicsLayerType.Label),this._markupLayer&&this._measurementLayer&&(n.measurementMarkupManager._measurementLayersCreated=!0)),!!(e&&e.geometry&&this._markupLayer&&this._measurementLayer)},r.prototype._canExecuteDeleteMeasurementCommand=function(e){return!!e},r.prototype._executeAddGeometryMarkup=function(e){e.type===o.DescriptorType.POLYGON?(this._fillColor&&(e.graphicSymbol.setColor(this._fillColor),e.graphicSymbol.color.a=.4),this._lineColor&&e.graphicSymbol.outline.setColor(this._lineColor)):this._lineColor&&e.graphicSymbol.setColor(this._lineColor);var t=e.addToMap(c.MARKUP_LAYER_ID);this.app.command("EditMarkup").raiseCanExecuteChanged(),this.app.command("DeleteMarkup").raiseCanExecuteChanged(),this.app.command("ClearMarkup").raiseCanExecuteChanged(),this.app.command("ExportMarkupLayer").raiseCanExecuteChanged(),e.type===o.DescriptorType.LINE_SEGMENT?this._temporaryMarkupSegmentGraphics.push(t):this.addMarkupToMap.get()?this._currentMarkupSegmentGraphics.push(t):this._temporaryMarkupSegmentGraphics.push(t)},r.prototype._executeAddLineSegmentMeasurementMarkup=function(e,t,r){if(e&&e.geometry){if(e.isActive&&(this.addMarkupToMap.get()||n.measurementMarkupManager._currentGeometryInProcess&&n.measurementMarkupManager._currentGeometryInProcess.id===e.id)){var a=n.measurementMarkupManager.formatMeasurement(e.length,n.measurementMarkupManager.measurementFractionalDigits)+" "+e.unitStr,i=l.formatAngle(e.getAngle(),n.measurementMarkupManager.degreeFormat,this.app,n.measurementMarkupManager.coordinateFractionalDigits),o=this._lineDescriptionFormat.format(a,i,e.getQuadrantBearing());this._setLineSegmentSymbols(e);var u=e.getAngleDegree(),m=e.getLabelLocation();e.highlightedLabelGraphic=s.addHighlightedLabelToMap(o,m,null,c.MEASUREMENT_LAYER_ID,this.app,!1,this._textOffset,this._textOffset,this._textFont.family,this._textSize,this._textColor,this._highlightColor,this._outlineWidth>0?new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this._outlineColor,this._outlineWidth):null,this._highlightRadius,u),e.showLabel=e.highlightedLabelGraphic.getWidth()*this._labelSizeAdjustmentFactor<s.getRenderedLineSegmentLength(e),e.showLabel&&!e.highlightedLabelGraphic.isVisible()&&e.highlightedLabelGraphic.show(),t&&t(e)}}else this._tryErrorCallback(r,new Error("LineSegment or geometry not defined"))},r.prototype._executeAddCompletedGeometryMeasurementMarkup=function(e,t,r){var a=this,i=null;if(e&&e.isActive&&(this.addMarkupToMap.get()||n.measurementMarkupManager._currentGeometryInProcess&&n.measurementMarkupManager._currentGeometryInProcess.id===e.id)){switch(e.type){case o.DescriptorType.POLYGON:e.geometry,e._lineSegments.length;var s=e.geometry,u=s.getExtent();i=u?u.getCenter():null,!s.contains(i)&&e.simplifiedGeometry&&(i=e.simplifiedGeometry.getCentroid()||i),e.labelStr=this._polygonFormatString.format(n.measurementMarkupManager.formatMeasurement(e.area,n.measurementMarkupManager.measurementFractionalDigits),e.areaUnitStr,n.measurementMarkupManager.formatMeasurement(e.length,n.measurementMarkupManager.measurementFractionalDigits),e.unitStr),e.highlightedLabelGraphic=this._addHighlightedLabelToMap(e,i),this.app.command("LogOptimizerEvent").execute("MeasureAreaTool","MeasureArea");break;case o.DescriptorType.POLYLINE:e.labelStr=this._polylineFormatString.format(n.measurementMarkupManager.formatMeasurement(e.length,n.measurementMarkupManager.measurementFractionalDigits),e.unitStr);var m=e._lineSegments[e._lineSegments.length-1];e.highlightedLabelGraphic=this._addHighlightedLabelToMap(e,m.mapPointEnd);var l=e.highlightedLabelGraphic.getTotalWidth()/2+this._polylineLabelOffset,p=e.highlightedLabelGraphic.getTotalHeight()/2+this._polylineLabelOffset,c=esri.geometry.toScreenGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,m.mapPointStart),h=esri.geometry.toScreenGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,m.mapPointEnd),g=h.x-c.x,d=h.y-c.y,M=0,y=0,_=g<0?-1:1,f=d<0?-1:1;Math.abs(g)>Math.abs(d)?(M=l*_,y=p*(Math.abs(d)/Math.abs(g))*f):Math.abs(d)>Math.abs(g)?(M=l*(Math.abs(g)/Math.abs(d))*_,y=p*f):(M=l*_,y=p*f),e.highlightedLabelGraphic.calculateLabelPoint=function(){return a._calcLabelPoint(m.mapPointEnd,e.highlightedLabelGraphic,M,y)},e.highlightedLabelGraphic.calculateLabelPoint(),this.app.command("LogOptimizerEvent").execute("MeasureDistanceTool","MeasureDistance");break;default:this._tryErrorCallback(r,new Error("Invalid Geometry Descriptor"))}n.measurementMarkupManager.narrateGeometryDescriptor(e),n.measurementMarkupManager.measurementCompleted(),e.setInactive(),this.app.event("MeasurementMarkupAdded").publish({graphic:e.graphic,measurementDescriptor:e}),t&&t(e)}},r.prototype._calcLabelPoint=function(e,t,r,a){var i=esri.geometry.toScreenGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,e),n=esri.geometry.toMapGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,new esri.geometry.Point(i.x+r,i.y+a));t.setMapPoint(n)},r.prototype._addHighlightedLabelToMap=function(e,t){return s.addHighlightedLabelToMap(e.labelStr,t,e.id,c.MEASUREMENT_LAYER_ID,this.app,!1,this._textOffset,this._textOffset,"Arial",this._textSize,this._totalMeasurementTextColor,this._totalMeasurementHighlightColor,this._totalMeasurementOutlineWidth>0?new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this._totalMeasurementOutlineColor,this._totalMeasurementOutlineWidth):null,this._highlightRadius,0,!0)},r.prototype._executeDeleteMeasurementCommand=function(e){var t=this,r=[c.MARKUP_LAYER_ID,c.MEASUREMENT_LAYER_ID];u.deleteMarkup(e,r,this.app,function(e){if(e&&e.length)for(var r=0;r<e.length;r++)e[r].hasOwnProperty("measurementId")&&n.measurementMarkupManager.destroyDescriptor(e[r].measurementId);var a=t.app.toolRegistry.getActiveTool();n.measurementMarkupManager.descriptorContainerEmpty.get()&&a&&"DeleteMeasurementTool"===a.name&&t.app.command("ClearActiveTool").execute()},!0,"language-measurement-erase-multiple-prompt","language-measurement-erase-multiple-prompt-title",this.libraryId),this.app.command("LogOptimizerEvent").execute("DeleteMeasurementTool","DeleteMeasurement")},r.prototype._executeClearMeasurementMarkup=function(e,t){var r=this;if("all"===e){var a=this.app.getResource(this.libraryId,"language-measurement-clear-all-prompt"),i=this.app.getResource(this.libraryId,"language-measurement-clear-all-prompt-title");this.app.command("StopEditingMarkup").execute(),this.app.command("Confirm").execute(a,i,function(a){a&&r._clearMarkup(e,t)})}else this._clearMarkup(e,t)},r.prototype._clearMarkup=function(e,t){switch(void 0===e&&(e="all"),void 0===t&&(t=!1),e){case"all":n.measurementMarkupManager.destroyAllDescriptors(),this.app.command("LogOptimizerEvent").execute("ClearMeasurementTool","ClearAllMeasurements");break;case"temporary":for(r=0;r<this._temporaryMarkupSegmentGraphics.length;r++)(a=this._temporaryMarkupSegmentGraphics[r])&&a.measurementId&&n.measurementMarkupManager.destroyDescriptor(a.measurementId);break;case"current":for(var r=0;r<this._currentMarkupSegmentGraphics.length;r++){var a=this._currentMarkupSegmentGraphics[r];a&&a.measurementId&&n.measurementMarkupManager.destroyDescriptor(a.measurementId)}}n.measurementMarkupManager._currentGeometryInProcess&&!n.measurementMarkupManager._currentGeometryInProcess.graphic&&n.measurementMarkupManager.destroyDescriptor(n.measurementMarkupManager._currentGeometryInProcess.id),("temporary"===e||"all"===e||t)&&(this._temporaryMarkupSegmentGraphics=[]),("current"===e||"all"===e||t)&&(this._currentMarkupSegmentGraphics=[])},r.prototype._setLineSegmentSymbols=function(e){e.graphicSymbol||(e.graphicSymbol=p.defaultLineSymbol(),this._lineColor&&e.graphicSymbol.setColor(this._lineColor))},r.prototype._tryErrorCallback=function(e,t){e&&e(t)},r}(a.ViewModelBase);r.MeasurementViewModel=h})},"Mapping/modules/Measurement/Descriptors/DescriptorBase":function(){define(["require","exports","./../HighlightedMeasurementLabel","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic"],function(e,t,r,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.LINE_SEGMENT=0]="LINE_SEGMENT",e[e.POLYLINE=1]="POLYLINE",e[e.POLYGON=2]="POLYGON"}(t.DescriptorType||(t.DescriptorType={}));var n=function(){function e(e,t,r){this.id="",this.geometry=null,this.type=null,this.length=null,this.lengthUnit=null,this.unitStr=null,this.labelStr=null,this.spatialReference=null,this.graphic=null,this.graphicSymbol=null,this.isActive=!0,this.feature=null,this.highlightedLabelGraphic=null,this.app=r,this.type=e,this.spatialReference=t}return e.prototype.addSegment=function(e){},e.prototype.setMeasurementUnit=function(e,t){},e.prototype.setGeometry=function(e){},e.prototype.addToMap=function(e,t){var r=null;return this.isActive&&(t||this.graphic||(this.graphic=new esri.Graphic,this.graphic.geometry=this.geometry,this.graphic.symbol=this.graphicSymbol),(r=t||this.graphic).measurementId=this.id,r=a.addGraphicToLayer(r,e,this.app)?r:null),r},e.prototype.updateFeature=function(){if(this.feature||(this.feature=new esri.Graphic,this.feature.geometry=this._polygonToPolyLine(this.geometry),this.feature.symbol=this.graphicSymbol),this.feature.setAttributes(this._createAttributes()),this.graphic){this.graphic.setAttributes(this._createAttributes());var e={graphic:this.graphic};this.app.eventRegistry.event("GraphicAttributesChangedEvent").publish(e)}},e.prototype.exportState=function(){return{id:this.id,geometry:this.app.project.convert.fromEsriGeometry(this.geometry),length:this.length,type:this.type,spatialReference:this.app.project.convert.fromEsriSpatialReference(this.spatialReference),graphic:this.app.project.convert.fromEsriGraphic(this.graphic),feature:this.app.project.convert.fromEsriGraphic(this.feature),label:this.highlightedLabelGraphic?this.highlightedLabelGraphic.exportState(this.app):null}},e.prototype.applyState=function(e,t,a){var n=this,s=this.app.project.convert,o={graphic:s.toEsriGraphic(e.graphic),feature:s.toEsriGraphic(e.feature),label:i.HighlightedLabelGraphic.fromExportedState(e.label,this.app,r.HighlightedMeasurementLabel.prototype)};return Promise.props(o).then(function(r){n.id=e.id,n.geometry=s.toEsriGeometry(e.geometry),n.length=e.length,n.type=e.type,n.spatialReference=s.toEsriSpatialReference(e.spatialReference),n.graphic=r.graphic,n.feature=r.feature,n.lengthUnit=t,n.unitStr=a,n.highlightedLabelGraphic=r.label})},e.prototype._createAttributes=function(){throw new Error("DescriptorBase._createAttributes is abstract and must be overridden in derived classes.")},e.prototype._polygonToPolyLine=function(e){if(!e||"polygon"!==e.type)return e;var t=new esri.geometry.Polyline(e.rings);return t.setSpatialReference(e.spatialReference),t},e}();t.DescriptorBase=n})},"Mapping/modules/Measurement/Descriptors/GeometryDescriptor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","./DescriptorBase","./LineSegmentDescriptor","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/tools/MapTool","./../MeasurementModule","./../MeasurementUtils","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/tools/DrawMode","geocortex/infrastructure/coordinates/CoordinateUtils","geocortex/essentials/Field"],function(t,r,a,i,n,s,o,u,m,l,p,c,h){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var g=function(t){function r(e,r,i,n){var u=t.call(this,r,i,n)||this;u._lineSegments=[],u.showHighlightedLabel=!0,u.editingInProgress=!1,u.originalZoomLevel=0,u.id=e,u.length=0,u.originalZoomLevel=n.map.getZoom(),r===a.DescriptorType.POLYGON?(u.graphicSymbol=s.defaultFillSymbol(),u.area=0,u.areaUnit=null,u.areaUnitStr=null,u.simplifiedGeometry=null):u.graphicSymbol=s.defaultLineSymbol();var m=u.app.toolRegistry.getActiveTool();return m&&m instanceof o.MapTool&&(u.drawMode=m.drawMode),u}return e(r,t),r.prototype.addSegment=function(e){e.id=this.id,e.isActive=this.isActive,null==this.lengthUnit&&null!=e.lengthUnit&&(e.unitStr?(this.lengthUnit=e.lengthUnit,this.unitStr=e.unitStr):(this.setMeasurementUnit(e.lengthUnit),e.unitStr=this.unitStr)),null!=this.lengthUnit&&null!=e.lengthUnit&&this.lengthUnit!=e.lengthUnit&&u.measurementMarkupManager._reportStatus("GeometryDescriptor: Added line segment unit differs from geometry.","error",!0),e.length?this.length=this.length?this.length+e.length:e.length:u.measurementMarkupManager._reportStatus("GeometryDescriptor: Line Segment added without computing length or length 0. Total geometry length not updated.","warning",!1),e.graphicSymbol&&!this.graphicSymbol&&this.type===a.DescriptorType.POLYLINE&&(this.graphicSymbol=new esri.symbol.SimpleLineSymbol(e.graphicSymbol.toJson())),this._lineSegments.push(e)},r.prototype.setMeasurementUnit=function(e,t){var r=!1;if((null!=this.areaUnit&&this.areaUnit!=t||null==this.areaUnit&&t&&this.type===a.DescriptorType.POLYGON)&&(this.area&&null!=this.areaUnit&&(this.area=m.convertArea(this.area,this.areaUnit,t)),this.areaUnit=t,this.areaUnitStr=m.getUnitString(this.areaUnit),r=!0),null!=this.lengthUnit&&this.lengthUnit!=e||null==this.lengthUnit&&null!=e){this.length=0;for(var i=0;i<this._lineSegments.length;i++)this._lineSegments[i].setMeasurementUnit(e),this.length+=this._lineSegments[i].length;this.unitStr=m.getUnitString(e),this.lengthUnit=e,r=!0}if(r&&(this.labelStr=this.type===a.DescriptorType.POLYLINE?u.measurementMarkupManager.getResource("language-measurement-polyline-final-markup-label").format(u.measurementMarkupManager.formatMeasurement(this.length,u.measurementMarkupManager.measurementFractionalDigits),this.unitStr):u.measurementMarkupManager.getResource("language-measurement-polygon-final-markup-label").format(u.measurementMarkupManager.formatMeasurement(this.area,u.measurementMarkupManager.measurementFractionalDigits),this.areaUnitStr,u.measurementMarkupManager.formatMeasurement(this.length,u.measurementMarkupManager.measurementFractionalDigits),this.unitStr),this.highlightedLabelGraphic&&this.highlightedLabelGraphic.refresh(this.labelStr),this.measurementData)){this.updateFeature(),null!=this.measurementData.features.getAt(0)&&this.measurementData.features.getAt(0).loadAttributes(!1);for(n=1;n<this.measurementData.features.length();n++)this._lineSegments[n-1].updateFeature(),this._lineSegments[n-1].feature.attributes.Segment=n.toString(),this.measurementData.features.getAt(n).loadAttributes(!1);this._formatMeasurementData();for(var n=0;n<this.measurementData.features.length();n++)this.app.event("FeatureChangedEvent").publish(this.measurementData.features.getAt(n))}},r.prototype.setGeometry=function(e){l.spatialRefsAreEqual(e.spatialReference,this.spatialReference,!1)?this.geometry=e:u.measurementMarkupManager._reportStatus("GeometryDescriptor: setGeometry error: Invalid Spatial Reference","error",!0)},r.prototype.refreshLabelVisibilityAndPosition=function(){if(!this.editingInProgress){this.showHighlightedLabel=!1;for(var e=this.app.map.getZoom()>=this.originalZoomLevel,t=0;t<this._lineSegments.length;t++)this._lineSegments[t].refreshLabelVisibility(),this.showHighlightedLabel=this.showHighlightedLabel||e||this._lineSegments[t].showLabel;this.showHighlightedLabel?this.highlightedLabelGraphic&&this.highlightedLabelGraphic.highlightGraphic&&this.highlightedLabelGraphic.textGraphics&&this.highlightedLabelGraphic.textGraphics.length>0&&(this.highlightedLabelGraphic.calculateLabelPoint&&this.highlightedLabelGraphic.calculateLabelPoint(),this.highlightedLabelGraphic.moveToTop(),this.highlightedLabelGraphic.show()):this.highlightedLabelGraphic&&this.highlightedLabelGraphic.highlightGraphic&&this.highlightedLabelGraphic.textGraphics&&this.highlightedLabelGraphic.textGraphics.length>0&&this.highlightedLabelGraphic.hide()}},r.prototype.refreshMeasurementData=function(){var e=this.drawMode||p.DrawMode.POLYGON,t=new esri.tasks.FeatureSet;if(this.updateFeature(),t.features.push(this.feature),[p.DrawMode.CIRCLE,p.DrawMode.ELLIPSE,p.DrawMode.FREEHAND_POLYGON,p.DrawMode.FREEHAND_POLYLINE].indexOf(this.drawMode)<0)for(var r=0;r<this._lineSegments.length;r++)this._lineSegments[r].updateFeature(),this._lineSegments[r].feature.attributes.Segment=(r+1).toString(),t.features.push(this._lineSegments[r].feature);if(this.measurementData?(this.measurementData.esriFeatureSet=t,this.measurementData.loadFeatures()):(this.measurementData=new n.FeatureSet({esriFeatureSet:t}),this.measurementData.displayName.set(this._getDisplayName()),this.measurementData.isSelectedInCollection.set(!0),this.measurementData.isMeasurement=!0,this._setAttributeMetadata(this.measurementData.attributes)),this._formatMeasurementData(),u.measurementMarkupManager.measurementResultTypes.indexOf(e)>=0){var a=u.measurementMarkupManager.getMeasurementResultsCollection();a.featureSets.addItem(this.measurementData),this.app.featureSetManager.openCollection(a.id),this.app.featureSetManager.closeCollection(a.id)}},r.prototype.setInactive=function(){this.isActive=!1;for(var e=0;e<this._lineSegments.length;e++)this._lineSegments[e].isActive=!1},r.prototype.exportState=function(){var e=t.prototype.exportState.call(this);return e.area=this.area,e.simplifiedGeometry=this.app.project.convert.fromEsriGeometry(this.simplifiedGeometry),e.drawMode=this.drawMode,e.measurementData=this.app.project.convert.fromGcxFeatureSet(this.measurementData),e.originalZoomLevel=this.originalZoomLevel,e.segments=this._lineSegments.map(function(e){return e.exportState()}),e},r.prototype.applyState=function(e){var r=this,a={measurementData:this.app.project.convert.toGcxFeatureSet(e.measurementData),segments:Promise.map(e.segments,function(e){var t=new i.LineSegmentDescriptor(r.spatialReference,r.app);return t.applyState(e).return(t)})};return t.prototype.applyState.call(this,e,u.measurementMarkupManager._lengthUnit,u.measurementMarkupManager._lengthUnitString).then(function(){return Promise.props(a)}).then(function(t){r.area=e.area,r.simplifiedGeometry=r.app.project.convert.toEsriGeometry(e.simplifiedGeometry),r.drawMode=e.drawMode,r.measurementData=t.measurementData,r.originalZoomLevel=r.originalZoomLevel,r._lineSegments=t.segments,r.areaUnit=u.measurementMarkupManager._areaUnit,r.areaUnitStr=u.measurementMarkupManager._areaUnitString,r.refreshLabelVisibilityAndPosition()})},r.prototype._createAttributes=function(){var e={};return e.Segment=u.measurementMarkupManager.getResource("language-measurement-results-total"),e.X=this._lineSegments[0].mapPointStart.x,e.Y=this._lineSegments[0].mapPointStart.y,e.Length=this.length,e.Units=this.unitStr,e.Area=this.area,e["Area Units"]=this.areaUnitStr,e.Angle=0,e.Bearing="",e},r.prototype._formatMeasurementData=function(){for(var e=0;e<this.measurementData.features.length();e++){var t=this.measurementData.features.getAt(e);0==e?(t.labelFormat.set(u.measurementMarkupManager.getResource("language-measurement-results-feature-label-total").format(this.measurementData.displayName.get())),t.descriptionFormat.set(u.measurementMarkupManager.getResource("language-measurement-results-feature-description-"+this.geometry.type))):(t.labelFormat.set(u.measurementMarkupManager.getResource("language-measurement-results-feature-label-segment").format(this.measurementData.displayName.get(),e)),t.descriptionFormat.set(u.measurementMarkupManager.getResource("language-measurement-results-feature-description-segment")));for(var r=0;r<t.attributes.length();r++){var a=t.attributes.getAt(r),i=a.name.get(),n=a.value.get();0!=e||"X"!=i&&"Y"!=i&&"Angle"!=i?(e>0||"polyline"===this.geometry.type)&&"Area"===i?a.presentableValue.set(""):"X"===i||"Y"==i?a.presentableValue.set(u.measurementMarkupManager.formatMeasurement(n,u.measurementMarkupManager.coordinateFractionalDigits)):"Length"===i||"Area"===i?a.presentableValue.set(u.measurementMarkupManager.formatMeasurement(n,u.measurementMarkupManager.measurementFractionalDigits)):"Angle"===i&&a.presentableValue.set(c.formatAngle(n,u.measurementMarkupManager.degreeFormat,this.app,u.measurementMarkupManager.coordinateFractionalDigits)):a.presentableValue.set("")}this._setAttributeMetadata(t.attributes)}},r.prototype._setAttributeMetadata=function(e){for(var t=0;t<e.length();t++){var r=e.getAt(t);switch(r.name.get()){case"Segment":r.displayName.set(u.measurementMarkupManager.getResource("language-measurement-results-field-segment")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeString);break;case"X":r.displayName.set(u.measurementMarkupManager.getResource("language-measurement-results-field-x")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Y":r.displayName.set(u.measurementMarkupManager.getResource("language-measurement-results-field-y")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Length":r.displayName.set(u.measurementMarkupManager.getResource("language-common-measurement-results-field-length")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Units":r.displayName.set(u.measurementMarkupManager.getResource("language-common-measurement-results-field-units")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeString);break;case"Area":r.displayName.set(u.measurementMarkupManager.getResource("language-common-measurement-results-field-area")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Area Units":r.displayName.set(u.measurementMarkupManager.getResource("language-common-measurement-results-field-area-units")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeString);break;case"Angle":r.displayName.set(u.measurementMarkupManager.getResource("language-measurement-results-field-angle")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Bearing":r.displayName.set(u.measurementMarkupManager.getResource("language-measurement-results-field-bearing")),r.type.set(h.EssentialsFieldTypes.essentialsFieldTypeString)}}},r.prototype._getDisplayName=function(){for(var e=1,t=this.drawMode||p.DrawMode.POLYGON,r=0;r<u.measurementMarkupManager.descriptorContainer.length;r++)(u.measurementMarkupManager.descriptorContainer[r].drawMode||p.DrawMode.POLYGON)===t&&u.measurementMarkupManager.descriptorContainer[r].id!==this.id&&e++;var a=u.measurementMarkupManager.getResource("language-measurement-drawmode-"+t.toLowerCase().replace("_","-"));return u.measurementMarkupManager.getResource("language-measurement-results-feature-set-name").format(a,e)},r}(a.DescriptorBase);r.GeometryDescriptor=g})},"Mapping/modules/Measurement/Descriptors/LineSegmentDescriptor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","./DescriptorBase","./../MeasurementModule","./../MeasurementUtils","geocortex/infrastructure/coordinates/AngleDirectionSystem","geocortex/infrastructure/coordinates/CoordinateUtils"],function(t,r,a,i,n,s,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=function(t){function r(e,r){var i=t.call(this,a.DescriptorType.LINE_SEGMENT,e,r)||this;return i.mapPointStart=null,i.mapPointEnd=null,i.showLabel=!1,i.geometry=new esri.geometry.Polyline(e),i.length=0,i}return e(r,t),r.prototype.setStartPt=function(e){e?(this.mapPointStart=new esri.geometry.Point(e.toJson()),0===this.geometry.paths.length?this.geometry.addPath([this.mapPointStart]):this.geometry.insertPoint(0,0,this.mapPointStart)):i.measurementMarkupManager._reportStatus("LineSegmentDescriptor: setStartPt - Start point not specified","error",!1)},r.prototype.setEndPt=function(e){e?(this.mapPointEnd=new esri.geometry.Point(e.toJson()),1===this.geometry.paths.length?this.geometry.insertPoint(0,1,this.mapPointEnd):i.measurementMarkupManager._reportStatus("LineSegmentDescroptor: setEndPt - Please set startPt of segment before setting endPt","error",!1)):i.measurementMarkupManager._reportStatus("LineSegmentDescriptor: setEndPt - End point not specified","error",!1)},r.prototype.setMeasurementUnit=function(e,t){(null!=this.lengthUnit&&this.lengthUnit!=e||null==this.lengthUnit&&null!=e)&&(this.length&&null!=this.lengthUnit&&(this.length=n.convertLength(this.length,this.lengthUnit,e)),this.lengthUnit=e,this.unitStr=t||n.getUnitString(this.lengthUnit),this.highlightedLabelGraphic&&this.highlightedLabelGraphic.refresh(i.measurementMarkupManager.formatMeasurement(this.length,i.measurementMarkupManager.measurementFractionalDigits)+" "+this.unitStr))},r.prototype.refreshLabelVisibility=function(){if(this.highlightedLabelGraphic){var e=n.getRenderedLineSegmentLength(this);this.showLabel=this.highlightedLabelGraphic.getWidth()<e,this.showLabel?this.highlightedLabelGraphic.show():this.highlightedLabelGraphic.hide()}},r.prototype.exportState=function(){var e=t.prototype.exportState.call(this);return e.startPoint=this.app.project.convert.fromEsriGeometry(this.mapPointStart),e.endPoint=this.app.project.convert.fromEsriGeometry(this.mapPointEnd),e},r.prototype.applyState=function(e){var r=this;return t.prototype.applyState.call(this,e,i.measurementMarkupManager._lengthUnit,i.measurementMarkupManager._lengthUnitString).then(function(){r.mapPointStart=r.app.project.convert.toEsriGeometry(e.startPoint),r.mapPointEnd=r.app.project.convert.toEsriGeometry(e.endPoint)})},r.prototype._createAttributes=function(){var e={};return e.Segment=this.id,e.X=this.mapPointStart.x,e.Y=this.mapPointStart.y,e.Length=this.length,e.Units=this.unitStr,e.Area=0,e["Area Units"]="",e.Angle=this.getAngle(),e.Bearing=this.getQuadrantBearing(),e},r.prototype.getAngle=function(){return i.measurementMarkupManager.angleDirectionSystem===s.NORTH_AZIMUTH?this.getNorthAzimuth():i.measurementMarkupManager.angleDirectionSystem===s.SOUTH_AZIMUTH?this.getSouthAzimuth():this.getPolarAngle()},r.prototype.getAngleDegree=function(){var e=0;if(this.mapPointStart&&this.mapPointEnd){var t=Math.atan2(this.mapPointStart.y-this.mapPointEnd.y,this.mapPointEnd.x-this.mapPointStart.x)*(180/Math.PI);e=(t=t<0?360+t:t)>=0&&t<=180?t>90?180+t:t:t<270?t-180:t}return e},r.prototype.getPolarAngle=function(){var e=this.mapPointEnd.x-this.mapPointStart.x,t=this.mapPointEnd.y-this.mapPointStart.y;return(180*Math.atan2(t,e)/Math.PI+360)%360},r.prototype.getNorthAzimuth=function(){return(360-this.getPolarAngle()+90)%360},r.prototype.getSouthAzimuth=function(){return(360-this.getPolarAngle()+90+180)%360},r.prototype.getLabelLocation=function(){if(this.mapPointStart&&this.mapPointEnd)return new esri.geometry.Point((this.mapPointStart.x+this.mapPointEnd.x)/2,(this.mapPointStart.y+this.mapPointEnd.y)/2,this.spatialReference)},r.prototype.getQuadrantBearing=function(){return o.formatBearing(this.getNorthAzimuth(),i.measurementMarkupManager.degreeFormat,this.app,i.measurementMarkupManager.coordinateFractionalDigits)},r}(a.DescriptorBase);r.LineSegmentDescriptor=u})},"url:/Mapping/modules/Measurement/MeasurementUnitSwitcherView.html":t,"url:/Mapping/modules/Measurement/MeasurementView.html":r,"url:/Mapping/modules/Measurement/Widgets/MeasurementTransientView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/CSS/common.css","css","LyogLS0tLS0tIFNUQVJUOiBNZWFzdXJlbWVudCAtLS0tLS0gKi8NCi5pY29uLWNsZWFyLTI0IHsNCiAgICB3aWR0aDogMjRweDsNCiAgICBoZWlnaHQ6IDI0cHg7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvY2xlYXItMjQucG5nIik7DQp9DQouaWNvbi1lcmFzZS0yNCB7DQogICAgd2lkdGg6IDI0cHg7DQogICAgaGVpZ2h0OiAyNHB4Ow0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9Ub29sYmFyL2VyYXNlLTI0LnBuZyIpOw0KfQ0KLnRvb2xiYXItc21hbGwtbGF5b3V0IC5ob3Jpem9udGFsIC5pY29uLWNsZWFyLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9jbGVhci0xNi5wbmciKTsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KfQ0KLnRvb2xiYXItc21hbGwtbGF5b3V0IC5ob3Jpem9udGFsIC5pY29uLWVyYXNlLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9lcmFzZS0xNi5wbmciKTsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KfQ0KLnRvb2xiYXItaXRlbS5zZWxlY3QtZG91YmxlIHsNCiAgICB3aWR0aDogOGVtICFpbXBvcnRhbnQ7DQogICAgbWF4LXdpZHRoOiA4ZW0gIWltcG9ydGFudDsNCn0NCi50b29sYmFyLWl0ZW0uc2VsZWN0LWRvdWJsZTpob3ZlciwNCi50b29sYmFyLWl0ZW0uc2VsZWN0LWRvdWJsZTpmb2N1cyB7DQogICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsNCiAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7DQogICBjdXJzb3I6IGRlZmF1bHQ7DQp9DQoudG9vbGJhci1pdGVtLnNlbGVjdC1kb3VibGUgc2VsZWN0IHsNCiAgICBtYXJnaW4tdG9wOiAwLjI1ZW07DQp9DQoudG9vbGJhci1pdGVtLnNlbGVjdC1kb3VibGUgc2VsZWN0ICsgc2VsZWN0IHsNCiAgICBtYXJnaW4tdG9wOiAwLjVlbTsNCn0NCi50b29sYmFyLWl0ZW0uY2hlY2tib3gsDQoudG9vbGJhci1pdGVtLmNoZWNrYm94IGlucHV0LA0KLnRvb2xiYXItaXRlbS5jaGVja2JveCBsYWJlbCB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KLnRvb2xiYXItaXRlbS5jaGVja2JveCB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHBhZGRpbmctdG9wOiAwLjI1ZW07DQogICAgd2lkdGg6IDVlbTsNCn0NCi50b29sYmFyLWl0ZW0uY2hlY2tib3ggbGFiZWwgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBsaW5lLWhlaWdodDogMS4yNWVtOw0KfQ0KLnRvb2xiYXItaXRlbS5jaGVja2JveCBpbnB1dCB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luOiAwLjVlbSBhdXRvIDAuMzVlbSBhdXRvOw0KICAgIHdpZHRoOiAyNHB4OyAvKiBNYXRjaGluZyB3aWR0aCBhbmQgaGVpZ2h0IHRvIHRvb2xiYXIgaWNvbiBzaXplICovDQogICAgaGVpZ2h0OiAyNHB4Ow0KfQ0KLnRvb2xiYXItaXRlbS5tdWx0aS10b29sIHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KLnRvb2xiYXItaXRlbS5tdWx0aS10b29sLA0KLm11bHRpLXRvb2wtYnV0dG9uIHsNCiAgICB3aWR0aDogNWVtOw0KfQ0KLm5lc3RlZC1ncm91cCAubXVsdGktdG9vbC1idXR0b24gew0KICAgIGZvbnQtc2l6ZTogMC45MzczZW07DQogICAgd2lkdGg6IDUuMzc5ZW07DQogICAgcGFkZGluZy10b3A6IDA7DQogICAgcGFkZGluZy1ib3R0b206IDA7DQogICAgbWFyZ2luOiAwOw0KfQ0KLnRvb2xiYXItYm9keSAudG9vbGJhci1yZWdpb24gdWwudHJhbnNpZW50LW1lYXN1cmVtZW50IGxpIHsNCiAgICBtYXJnaW46IDAgMC4yNWVtOw0KfQ0KLnRyYW5zaWVudC1tZWFzdXJlbWVudCAudG9vbGJhci1pdGVtLmJ1dHRvbiB7DQogICAgbWFyZ2luLWJvdHRvbTogMDsNCn0NCg0KLyogLS0tLS0tIEVORDogTWVhc3VyZW1lbnQgLS0tLS0tICovDQoNCg0KLyogU1RBUlQ6IE1lYXN1cmVtZW50IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQoubWVhc3VyZW1lbnQtdG9vbGJhci12aWV3IHsNCiAgICBtYXJnaW4tdG9wOiAtMC4yNWVtOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KfQ0KLm1lYXN1cmVtZW50LXRvb2xiYXItdmlldyAudG9vbGJhci1zbWFsbC1sYXlvdXQgLnRvb2xiYXItaXRlbSB7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCg0KLm1lYXN1cmVtZW50LXRvb2xiYXItdmlldyAudG9vbGJhci1pdGVtLnNlbGVjdCBzZWxlY3Qgew0KICAgIGZvbnQtc2l6ZTogMC44ZW07DQogICAgY29sb3I6ICM2NTYxODk7DQogICAgbWFyZ2luOiAwLjdlbSAwOw0KfQ0KLnRvb2xiYXItYm9keSAubWVhc3VyZW1lbnQtdG9vbGJhci12aWV3IC50b29sYmFyLXNtYWxsLWxheW91dCAudG9vbGJhci1pdGVtLmNoZWNrYm94IHsNCiAgICBwYWRkaW5nOiAwLjdlbSAwIDAgMDsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQoJLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Oy8NCglib3gtc2l6aW5nOiBib3JkZXItYm94OyANCiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KfQ0KLnRvb2xiYXItYm9keSAubWVhc3VyZW1lbnQtdG9vbGJhci12aWV3IC50b29sYmFyLXNtYWxsLWxheW91dCAudG9vbGJhci1pdGVtLmNoZWNrYm94IGlucHV0IHsNCiAgICBsZWZ0OiAwICFpbXBvcnRhbnQ7DQogICAgdG9wOiAwLjVlbSAhaW1wb3J0YW50Ow0KICAgIGhlaWdodDogMWVtOw0KfQ0KLnRvb2xiYXItYm9keSAubWVhc3VyZW1lbnQtdG9vbGJhci12aWV3IC50b29sYmFyLXNtYWxsLWxheW91dCAudG9vbGJhci1pdGVtLmNoZWNrYm94IGxhYmVsIHsNCiAgICBwYWRkaW5nLWxlZnQ6IDEuNWVtOw0KICAgIGhlaWdodDogMS41ZW07DQp9DQouaWNvbiB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCn0NCi50Ym8tYnRuIC5pY29uIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBtYXJnaW4tcmlnaHQ6IDAuNWVtOw0KfQ0KLmljb24tY2xlYXItMTYgew0KICAgIHdpZHRoOiAxNnB4Ow0KICAgIGhlaWdodDogMTZweDsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9jbGVhci0xNi5wbmciKTsNCn0NCi5pY29uLWVyYXNlLTE2IHsNCiAgICB3aWR0aDogMTZweDsNCiAgICBoZWlnaHQ6IDE2cHg7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvZXJhc2UtMTYucG5nIik7DQp9DQouaGlnaGxpZ2h0IHsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjQzhFOUZGOw0KICAgIGJhY2tncm91bmQ6ICNGQkZERkY7DQp9DQoNCi8qIEVORDogTWVhc3VyZW1lbnQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCg0KLyogLS0tLS0tIFNUQVJUOiBDb21wYWN0IFRvb2xiYXIgLS0tLS0tICovDQouZmx5b3V0LW1lbnUtdHJhbnNpZW50LW1lYXN1cmVtZW50IC50b29sYmFyLXNtYWxsLWxheW91dCB7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgcGFkZGluZy1sZWZ0OiA5ZW0gIWltcG9ydGFudDsNCn0NCi5mbHlvdXQtbWVudS10cmFuc2llbnQtbWVhc3VyZW1lbnQgbGkgew0KICAgIG1hcmdpbjogMXB4Ow0KfQ0KLmZseW91dC1tZW51LXRyYW5zaWVudC1tZWFzdXJlbWVudCAudG9vbGJhci1pdGVtLnNlbGVjdCB7DQogICAgbGVmdDogMDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHdpZHRoOiA4ZW0gIWltcG9ydGFudDsNCiAgICBwYWRkaW5nOiAwLjVlbSAwOw0KfQ0KLmZseW91dC1tZW51LXRyYW5zaWVudC1tZWFzdXJlbWVudCAudG9vbGJhci1pdGVtLnNlbGVjdCArIC50b29sYmFyLWl0ZW0uc2VsZWN0IHsNCiAgICB0b3A6IGF1dG87DQogICAgYm90dG9tOiAwOw0KfQ0KLmZseW91dC1tZW51LXRyYW5zaWVudC1tZWFzdXJlbWVudCAudG9vbGJhci1pdGVtLmNoZWNrYm94IHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgcGFkZGluZy10b3A6IDAuMjVlbTsNCn0NCi8qIC0tLS0tLSBFTkQ6IENvbXBhY3QgVG9vbGJhciAtLS0tLS0gKi8NCi8qIC0tLS0tLSBTVEFSVDogTm8gTGFiZWwgTGF5b3V0IC0tLS0tLSAqLw0KLm5vLWxhYmVsIC50cmFuc2llbnQtdG9vbGJhci5oYXMtbmVpZ2hib3VyLXRyYW5zaWVudCB7DQogICAgcGFkZGluZy1sZWZ0OiAwOw0KCWRpc3BsYXk6IGlubGluZS1ibG9jazsNCglmbG9hdDogcmlnaHQ7DQp9DQouVGFiYmVkVG9vbGJhclZpZXcgLm5vLWxhYmVsIC50cmFuc2llbnQtdG9vbGJhciArIC50cmFuc2llbnQtbWVhc3VyZW1lbnQgewkNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgdG9wOiBhdXRvOw0KCWRpc3BsYXk6IGlubGluZS1ibG9jazsNCn0NCi5uby1sYWJlbCAudHJhbnNpZW50LW1lYXN1cmVtZW50IC50b29sYmFyLWl0ZW0uc2VsZWN0LWRvdWJsZSB7DQoJZGlzcGxheTogYmxvY2s7DQogICAgbWF4LXdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7DQoJd2lkdGg6IGF1dG8gIWltcG9ydGFudDsNCn0NCi5uby1sYWJlbCAudG9vbGJhci1pdGVtLnNlbGVjdC1kb3VibGUgc2VsZWN0IHsNCiAgICB3aWR0aDogNy41ZW07DQoJbWluLXdpZHRoOiAxZW07DQoJZGlzcGxheTogaW5saW5lLWJsb2NrOw0KCW1hcmdpbjogMC4zNzVlbSAwIDAgMDsNCn0NCi5uby1sYWJlbCAucmVnaW9uLWFjdGl2ZVtkYXRhLXJlZ2lvbi1uYW1lPSJNZWFzdXJlbWVudFRvb2xDb250cm9sUmVnaW9uIl0gew0KCWJhY2tncm91bmQtY29sb3I6ICNGOEY4Rjg7DQoJYm9yZGVyOiAxcHggc29saWQgI0RERERERDsNCglib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KCW1hcmdpbjogMC4xMjVlbSAwIDAuMmVtOw0KCW92ZXJmbG93OiBoaWRkZW47DQoJcGFkZGluZzogMDsNCglwb3NpdGlvbjogcmVsYXRpdmU7DQoJei1pbmRleDogNjAwOw0KCWhlaWdodDogMi41ZW07DQp9DQoubm8tbGFiZWwgLnJlZ2lvbi1hY3RpdmVbZGF0YS1yZWdpb24tbmFtZT0iTWVhc3VyZW1lbnRUb29sQ29udHJvbFJlZ2lvbiJdIC50cmFuc2llbnQtdG9vbGJhciB7DQoJYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7DQoJYm9yZGVyOiBub25lOw0KCW1hcmdpbjogMDsNCglwYWRkaW5nOiAwOw0KfQ0KLyogLS0tLS0tIEVORDogTm8gTGFiZWwgTGF5b3V0IC0tLS0tLSAqLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/CSS/small.css","css","DQovKiBTVEFSVDogTWVhc3VyZW1lbnQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCg0KLnRidG0tc2VsZWN0IHsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLyogRU5EOiBNZWFzdXJlbWVudCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/MeasurementUnitSwitcherView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/MeasurementView.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/Widgets/MeasurementTransientView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Measurement/HighlightedMeasurementLabel","Mapping/modules/Measurement/MeasurementMarkupManager","Mapping/modules/Measurement/MeasurementModule","Mapping/modules/Measurement/MeasurementOperation","Mapping/modules/Measurement/MeasurementTool","Mapping/modules/Measurement/MeasurementUtils","Mapping/modules/Measurement/MeasurementView","Mapping/modules/Measurement/MeasurementViewModel","Mapping/modules/Measurement/Descriptors/DescriptorBase","Mapping/modules/Measurement/Descriptors/GeometryDescriptor","Mapping/modules/Measurement/Descriptors/LineSegmentDescriptor"],function(t,r,a,i,n,s,o,u,m,l,p){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.HighlightedMeasurementLabel",t.HighlightedMeasurementLabel),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementMarkupManager",r.MeasurementMarkupManager),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementModule",a.MeasurementModule),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementOperation",i.MeasurementOperation),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementTool",n.MeasurementTool),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getUnitString",s.getUnitString),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getGeometryServiceUnitConstant",s.getGeometryServiceUnitConstant),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.addGraphicToLayer",s.addGraphicToLayer),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getGraphicsLayer",s.getGraphicsLayer),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getLabelSize",s.getLabelSize),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getRenderedLineSegmentLength",s.getRenderedLineSegmentLength),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.plotPointOnMap",s.plotPointOnMap),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.addHighlightedLabelToMap",s.addHighlightedLabelToMap),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getTextLines",s.getTextLines),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.svgRoundedRectanglePath",s.svgRoundedRectanglePath),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.refreshHighlightSymbolSize",s.refreshHighlightSymbolSize),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.convertLength",s.convertLength),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.convertArea",s.convertArea),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementView",o.MeasurementView),e(u,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementViewModel",u.MeasurementViewModel),e(m,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.DescriptorType",m.DescriptorType),e(m,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.DescriptorBase",m.DescriptorBase),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.GeometryDescriptor",l.GeometryDescriptor),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.LineSegmentDescriptor",p.LineSegmentDescriptor)})}();