!function(){function e(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var o=t.split("."),n=null,i=window,s=0,a=o.length;s<a;s++)n=o[s],s==a-1?i[n]=r:i[n]||(i[n]={}),i=i[n];else console.warn("Undefined shim for: "+t)}var t="<div class='list-reports-view'>    <div class='list-reports-header' tabindex='0'>        <p data-binding='{@text: @language-list-reports-explanation}'></p>    </div>    <ul class='list-of-reports' data-binding='{@source: availableReportListings}'>        <li data-binding='{@template-for: availableReportListings}'>            <button class='list-of-reports-link' data-binding='{@event-onclick: handleClickReport}'>                <strong class='list-of-reports-link-title' data-binding='{@text: displayName}'></strong>                <span class='list-of-reports-link-description' data-binding='{@text: description}'></span>                <span class='list-of-reports-link-details' data-binding='{@visible: isMoreThanOneFeatureSelected}{@text: details}'></span>            </button>        </li>    </ul></div>",r="<div class='run-report-view'>    \x3c!-- Report is in progress. --\x3e    <div class='run-report-progress' data-binding='{@hidden: complete}'>        \x3c!-- Sync report. --\x3e        <div data-binding='{@hidden: isAsync}'>            <h2 data-binding='{@text: @language-run-report-progress-heading-sync}'></h2>            <p data-binding='{@text: @language-run-report-progress-message-sync}'></p>        </div>        \x3c!-- Async report. --\x3e        <div data-binding='{@visible: isAsync}'>            <h2 data-binding='{@text: @language-run-report-progress-heading-async}'></h2>            <p data-binding='{@text: @language-run-report-progress-message-async}'></p>        </div>    </div>    \x3c!-- Report is complete. --\x3e    <div class='run-report-complete' data-binding='{@visible: complete}'>        \x3c!-- Sync report: direct link to download file. --\x3e        <div data-binding='{@hidden: isAsync}'>            <h2 data-binding='{@text: @language-run-report-complete-heading-sync}'></h2>            <a class='run-report-complete-link' data-binding='{@visible: downloadTag}{href: href}{@text: @language-run-report-complete-link-sync}' href='' target='_blank' download></a>            \x3c!-- Browser in GMAF cannot handle the download nor the target tahs. The download tag disables the download fir all  platforms, target breaks iOS. Therefore, in GMAF, they are removed. --\x3e            <a class='run-report-complete-link' data-binding='{@hidden: downloadTag}{href: href}{@text: @language-run-report-complete-link-sync}' href=''></a>        </div>        \x3c!-- Async report: embedded print job iframe. --\x3e        <div data-binding='{@visible: isAsync}'>            <h2 data-binding='{@text: @language-run-report-complete-heading-async}'></h2>            <a class='run-report-complete-link' data-binding='{href: href}{@text: @language-run-report-complete-link-async}' href='' target='_blank'></a>        </div>        <button class='run-report-complete-done-button' data-binding='{@text: @language-run-report-complete-done-button}{@event-onclick: handleClickDoneButton}'></button>    </div></div>";require({cache:{"Mapping/modules/Reporting/ListReportsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){function r(e,r){var o=t.call(this,e,r)||this;return o.app.command("ListReports").postExecute.subscribe(o,function(){o.app.viewManager.activateView(o)}),o.app.command("RunFeatureReport").postExecute.subscribe(o,function(){o.app.viewManager.activateView(o)}),o.app.command("RunFeaturesReport").postExecute.subscribe(o,function(){o.app.viewManager.activateView(o)}),o}return e(r,t),r.prototype.handleClickReport=function(e,t,r){this.viewModel.engageReport(r)},r}(o.ViewBase);r.ListReportsView=n})},"Mapping/modules/Reporting/ListReportsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/Reporting"],function(t,r,o,n,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.features=new n.ObservableCollection,e.availableReportListings=new n.ObservableCollection,e}return e(r,t),r.prototype.initialize=function(e){void 0===e&&(e={}),t.prototype.initialize.apply(this,arguments),this.warnUserWhenReportExcludesFeatures="warnUserWhenReportExcludesFeatures"in e&&e.warnUserWhenReportExcludesFeatures,this.app.command("ListReports").register(this,this._executeListReports,this._canExecuteListReports),this.app.command("RunFeatureReport").register(this,this._executeListReports,this._canExecuteListReports),this.app.command("RunFeaturesReport").register(this,this._executeListReports,this._canExecuteListReports)},r.prototype._executeListReports=function(e){var t=this,r=i.getAllFeaturesFromReportable(e);this.features.set(r),this.availableReportListings.set(this._getVisibleReportsFromFeatures(r).map(function(e){var o=r.filter(function(t){return!t||!t.layer||!t.layer.mapService||t.layer.mapService.id!==e.layer.mapService.id||t.layer.id!==e.layer.id}),n=t.features.get().filter(function(e){return-1===o.indexOf(e)});return{report:e,displayName:e.displayName,description:e.description,excludedFeatures:o,includedFeatures:n,details:t.getResource("language-list-reports-details").format(n.length,r.length),isMoreThanOneFeatureSelected:t.features.getLength()>1}}))},r.prototype._canExecuteListReports=function(e){var t=i.getAllFeaturesFromReportable(e);return this._getVisibleReportsFromFeatures(t).length>0},r.prototype._getVisibleReportsFromFeatures=function(e){var t=[];e.forEach(function(e){e.layer&&-1===t.indexOf(e.layer)&&t.push(e.layer)});var r=[];return t.forEach(function(e){e.reports&&e.reports.forEach(function(e){-1===r.indexOf(e)&&e.visible&&r.push(e)})}),r},r.prototype.engageReport=function(e){var t=this,r=e.report,o=e.excludedFeatures,n=e.includedFeatures,i={report:r,reportable:n};this.warnUserWhenReportExcludesFeatures&&o.length>0?this.app.command("Confirm").execute(this.getResource("language-list-reports-exclusion-warning-message").format(r.displayName,o.length,this.features.getLength(),n.length),this.getResource("language-list-reports-exclusion-warning-title"),function(e){e&&t.app.command("RunReport").execute(i)}):this.app.command("RunReport").execute(i)},r}(o.ViewModelBase);r.ListReportsViewModel=s})},"Mapping/modules/Reporting/ReportingModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(t,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r}(o.ModuleBase);r.ReportingModule=n})},"Mapping/modules/Reporting/RunReportView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/commandArgs/AddStatusArgs"],function(t,r,o,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(e,r){var o=t.call(this,e,r)||this;return o.app.command("RunReport").preExecute.subscribe(o,o._displayReportProgressUI),o.app.command("RunReportByUrl").preExecute.subscribe(o,o._displayUrlReportProgressUI),o.app.event("ReportResultEvent").subscribe(o,o._handleReportResultUI),o.app.event("ReportErrorEvent").subscribe(o,o._handleReportErrorUI),o}return e(r,t),r.prototype.handleClickDoneButton=function(){this.app.viewManager.deactivateView(this)},r.prototype._displayReportProgressUI=function(e){this._displayProgressUI(e.report.displayName||e.report.id)},r.prototype._displayUrlReportProgressUI=function(e){this._displayProgressUI("URL Report")},r.prototype._displayProgressUI=function(e){this.isBusy.set(!0),this.app.viewManager.activateView(this);var t=new n.AddStatusArgs(this.getResource("language-run-report-progress-status").format(e));t.id="RunningReport",t.imageProperties={uri:"Resources/Images/Icons/Toolbar/reports-24.png",altText:this.getResource("language-run-report-progress-image-alt")},t.showBusyIcon=!0,t.timeoutMS=0,this.app.command("AddStatus").execute(t)},r.prototype._cleanupReportProgressUI=function(){this.isBusy.set(!1),this.app.command("RemoveStatus").execute("RunningReport")},r.prototype._handleReportResultUI=function(e){this._cleanupReportProgressUI(),this.isBusy.set(!1),this.app.viewManager.activateView(this)},r.prototype._handleReportErrorUI=function(e){this.isBusy.set(!1),this.app.viewManager.deactivateView(this);var t,r=this.getResource("language-run-report-error-title");t="ReportAlreadyRunning"===e.name?this.getResource("language-run-report-error-message-already-running"):"RequestTimeoutError"===e.name?this.getResource("language-run-report-error-message-timeout"):"OfflineReportImpossible"===e.name?this.getResource("language-run-report-error-message-offline"):"PortalItemNotFoundError"===e.name?this.getResource("language-run-report-error-message-portal-item-not-found"):"PortalItemAuthorizationError"===e.name?this.getResource("language-run-report-error-message-portal-item-unauthorized"):"ServiceUnavailableError"===e.name?this.getResource("language-run-report-error-message-service-unavailable"):"ServicePortalError"===e.name?this.getResource("language-run-report-error-message-service-portal-unauthorized"):"ServiceReportFailedError"===e.name?this.getResource("language-run-report-error-message-service-report-failed"):["ServiceError","ServiceReportNotFoundError","ServiceTokenError"].filter(function(t){return t===e.name}).pop()?this.getResource("language-run-report-error-message-service-error"):/outputFormat parameter invalid/.test(e.message)?this.getResource("language-run-report-error-message-output-format-unavailable"):this.getResource("language-run-report-error-message-generic"),"ReportAlreadyRunning"!==e.name&&this._cleanupReportProgressUI(),this.app.command("Alert").execute(t,r)},r}(o.ViewBase);r.RunReportView=i})},"Mapping/modules/Reporting/RunReportViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/ReportParameters","geocortex/infrastructure/Reporting","geocortex/essentials/Report","./Reporting5Client/Reporting5GvhClient"],function(t,r,o,n,i,s,a,l){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.complete=new n.Observable(!1),e.isAsync=new n.Observable(!1),e.href=new n.Observable(""),e.downloadTag=new n.Observable(!0),e}return e(r,t),r.prototype.initialize=function(e){void 0===e&&(e={}),t.prototype.initialize.apply(this,arguments),this.app.command("RunReport").register(this,this._executeRunReport),this.app.command("RunReportByUrl").register(this,this._executeRunReportByUrl)},r.prototype._executeRunReport=function(e){var t=this;if(e)try{if(this.complete.set(!1),e.reportParameters=e.reportParameters||new i.ReportParameters,e.reportParameters.featureIds=[],e.reportParameters.outputFormat=e.reportParameters.outputFormat||"PDF",!e.report.supportedOutputFormats.some(function(t){return t.toLowerCase()===e.reportParameters.outputFormat.toLowerCase()})){var r=e.report.supportedOutputFormats.length?e.report.supportedOutputFormats[0]:null;if(!r)throw(o=new Error("Selected report has no available output formats configured.")).name="ReportHasNoSupportedOutputFormats",o;e.reportParameters.outputFormat=r}if(s.getAllFeaturesFromReportable(e.reportable).forEach(function(t){var r=t.getPrimaryKeyValue();r&&e.reportParameters.featureIds.push(r)}),this.app.isNative.get()&&(this.downloadTag.set(!1),this.app.isOffline.get())){var o=new Error("Reports cannot be run while offline.");throw o.name="OfflineReportImpossible",o}null!=e.report.layer&&null!=e.report.layer.mapService&&this.app.event("ReportStartedEvent").publish(e.report.id,e.report.layer.mapService.id,e.report.layer.id),e.report.type===a.ReportType.LAYER_URL_REPORT?l.Reporting5GVHClient.RunReport(e.report.reportUrl,this.app.site,e.reportParameters).then(function(e){t.isAsync.set(!1),t.href.set(e),t.complete.set(!0),t.app.event("ReportResultEvent").publish({isAsync:!1,href:e})}).error(function(r){console.error("Reporting5 Error: ["+r.name+"] : "+r.msg+" -> ["+e.report.reportUrl+"]"),t.app.event("ReportErrorEvent").publish(r)}).catch(function(r){console.error("Reporting5 Error: ["+r.name+"] : "+r.msg+" -> ["+e.report.reportUrl+"]"),t.app.event("ReportErrorEvent").publish(r)}):e.report.run(null,e.reportParameters,function(e){t.isAsync.set(e.isAsync),t.href.set(e.href),t.complete.set(!0),t.app.event("ReportResultEvent").publish(e)},function(e){t.app.event("ReportErrorEvent").publish(e)})}catch(o){this.app.event("ReportErrorEvent").publish(o)}},r.prototype._executeRunReportByUrl=function(e){var t=this;if(!String.isNullOrEmpty(e))try{if(this.complete.set(!1),this.app.isNative.get()&&(this.downloadTag.set(!1),this.app.isOffline.get())){var r=new Error("Reports cannot be run while offline.");throw r.name="OfflineReportImpossible",r}this.app.event("ReportStartedEvent").publish(e,"-1","-1"),l.Reporting5GVHClient.RunReport(e,this.app.site,null).then(function(e){t.isAsync.set(!0),t.href.set(e),t.complete.set(!0),t.app.event("ReportResultEvent").publish(e)}).error(function(r){console.error(r+" : ["+e+"]"),t.app.event("ReportErrorEvent").publish(r)}).catch(function(r){console.error(r+" : ["+e+"]"),t.app.event("ReportErrorEvent").publish(r)})}catch(r){this.app.event("ReportErrorEvent").publish(r)}},r}(o.ViewModelBase);r.RunReportViewModel=u})},"Mapping/modules/Reporting/Reporting5Client/Reporting5.defs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._cancelled=!1}return e.prototype.cancel=function(){this._cancelled=!0},e.prototype.isCancelled=function(){return this._cancelled},e}();t.LiteCancellationToken=r})},"Mapping/modules/Reporting/Reporting5Client/Reporting5Client":function(){var e=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,a)}l((o=o.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,i&&(s=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){l.label=r[1];break}if(6===r[0]&&l.label<s[1]){l.label=s[1],s=r;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(r);break}s[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,i,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};define(["require","exports","./Reporting5Service"],function(r,o,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function o(){}return o.RunReport=function(r,i,s,a){return e(this,void 0,void 0,function(){var e,l,u,p,c,h,d;return t(this,function(t){switch(t.label){case 0:return String.isNullOrEmpty(r)&&this._throwError("ReportUrlNullOrEmpty","reportUrl cannot be null or empty."),null===(e=this._parseReportItemUrl(r))&&this._throwError("ReportUrlNotRecognized","reportUrl format was not recognized."),this._checkCancelToken(a),l=null,[4,this._fetchPortalItem(e.portalUrl,e.itemId,i)];case 1:return(l=t.sent()).typeKeywords&&l.typeKeywords.filter(function(e){return"Geocortex Reporting"===e}).pop()||this._throwError("PortalItemInvalidError","Portal Item is not a Geocortex Report."),l.url||this._throwError("PortalItemInvalidError","Portal Item does not contain a service URL. Contact your administrator."),u=new n.Reporting5Service(l.url,e.portalUrl,i),[4,u.initialize()];case 2:return t.sent(),this._checkCancelToken(a),[4,u.runJob(e.itemId,s)];case 3:p=t.sent(),c=null,h=0,d=0,t.label=4;case 4:return c?[3,7]:[4,o._delay(this._watchSchedule[h][0])];case 5:return t.sent(),this._checkCancelToken(a),[4,u.watchJob(p)];case 6:return(c=t.sent())||(this._checkCancelToken(a),this._watchSchedule[h][1]&&(d++,this._watchSchedule[h][1]<d&&(d=0,h++))),[3,4];case 7:return[2,u.fetchResult(p,c)]}})})},o._fetchPortalItem=function(o,n,i){return e(this,void 0,void 0,function(){var e,s,a,l,u;return t(this,function(t){switch(t.label){case 0:return e=o+"/sharing/content/items/"+n+"?f=json",String.isNullOrEmpty(i)||(e+="&token="+i),s=null,r(["dojo/request"],function(t){s=t(e,{handleAs:"json",headers:{"X-Requested-With":null}}).response}),a=null,[4,s];case 1:return l=t.sent(),200===l.status?(a=l.data,(u=this._parsePortalResponseError(a))&&(403===u.code||498===u.code?this._throwError("PortalItemAuthorizationError","You are not authorized to access this report - Have you signed in?"):404===u.code||400===u.code?this._throwError("PortalItemNotFoundError","Report is inaccessible or has been deleted."):this._throwError("PortalError","Unable to fetch Portal Item - Portal Error: ["+u.code+"] "+u.msg))):this._throwError("PortalError","Unable to fetch Portal Item - Network Error ["+l.status+"] "+l.text),[2,a]}})})},o._parsePortalResponseError=function(e){if(e.error){var t=e.error.code,r=e.error.message;return!r&&e.error.details&&e.error.details.length>0&&(r=e.error.details[0]),{code:t,msg:r}}return null},o._parseReportItemUrl=function(e){var t=e.match("(http[s]?://.*?)/home/item.html.*?id=([a-f0-9]+)");return t?{portalUrl:t[1],itemId:t[2]}:null},o._delay=function(r){return e(this,void 0,void 0,function(){return t(this,function(e){return[2,new Promise(function(e){setTimeout(function(){e()},r)})]})})},o._checkCancelToken=function(e){e&&e.isCancelled()&&this._throwError("ReportJobCancelled","The Job was cancelled.")},o._throwError=function(e,t){throw{name:e,message:t}},o}();i._watchSchedule=[[250,12],[1e3,57],[3e3,void 0]],o.Reporting5Client=i})},"Mapping/modules/Reporting/Reporting5Client/Reporting5GvhClient":function(){var e=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,a)}l((o=o.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,i&&(s=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){l.label=r[1];break}if(6===r[0]&&l.label<s[1]){l.label=s[1],s=r;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(r);break}s[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,i,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};define(["require","exports","./Reporting5Client"],function(r,o,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function r(){}return r.RunReport=function(r,o,i){return e(this,void 0,void 0,function(){var e,s,a;return t(this,function(t){return String.isNullOrEmpty(r)?[2,null]:(e=o.getTokenFromPrincipal(r,esri.IdentityManagerBase),s=this._marshalReportParameters(i),a=n.Reporting5Client.RunReport(r,e,s).then(function(e){return e}).catch(function(e){throw e}).error(function(e){throw e}),[2,a])})})},r._marshalReportParameters=function(e){return e&&e.featureIds?[{name:"FeatureIds",containsMultipleValues:!0,values:e.featureIds}]:[]},r}();o.Reporting5GVHClient=i})},"Mapping/modules/Reporting/Reporting5Client/Reporting5Service":function(){var e=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,a)}l((o=o.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,i&&(s=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){l.label=r[1];break}if(6===r[0]&&l.label<s[1]){l.label=s[1],s=r;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(r);break}s[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,i,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};define(["require","exports"],function(r,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function o(e,t,r){String.isNullOrEmpty(e)&&o._throwError("NullOrEmptyServiceUrl","serviceUrl cannot be null or empty."),String.isNullOrEmpty(t)&&o._throwError("NullOrEmptyPortalUrl","portalUrl cannot be null or empty"),this.portalUrl=t,this.serviceUrl=e,this._portalToken=r}return o.prototype.initialize=function(){return e(this,void 0,void 0,function(){var e,r,n,i,s=this;return t(this,function(t){switch(t.label){case 0:return this.serviceUrl.endsWith("/")&&(this.serviceUrl=this.serviceUrl.slice(0,-1)),this.serviceUrl+="/service",[4,o._probeServiceEndpoint(this.serviceUrl)];case 1:return t.sent()||o._throwError("ServiceUnavailableError","Reporting Service Endpoint is not available. : "+this.serviceUrl),[4,o._fetchPortalSettings(this.serviceUrl)];case 2:return e=t.sent(),!(r=e.filter(function(e){return e.portalUrl===s.portalUrl}).pop())&&this.isAgolPortalUrl(this.portalUrl)&&(n=e.filter(function(e){return s.isAgolPortalUrl(e.portalUrl)&&s.isEquivalentAgolPortalUrl(e.portalUrl,s.portalUrl)}).pop())&&(this.portalUrl=n.portalUrl,r=1),r||o._throwError("ServicePortalError","Current Authentication Portal is not registered with the target Reporting Service. - Pleaes contact your Administrator"),this._serviceToken=null,this._serviceTokenExpiry=null,this._portalToken?[4,this.getJobToken(this._portalToken)]:[3,4];case 3:i=t.sent(),this._serviceToken=i.token,t.label=4;case 4:return[2]}})})},o.prototype.isAgolPortalUrl=function(e){return!String.isNullOrEmpty(e)&&(!!/^https?:\/\//i.test(e)&&(!!/www\.arcgis\.com$/i.test(e)||!!/\.maps\.arcgis\.com$/i.test(e)))},o.prototype.isEquivalentAgolPortalUrl=function(e,t){var r=e.match("(https?)://(.*?).arcgis.com"),o=r[1],n=r[2],i=t.match("(https?)://(.*?).arcgis.com"),s=i[1],a=i[2];return o===s&&("www"===n||"www"===a||n===a)},o.prototype.getJobToken=function(n){return e(this,void 0,void 0,function(){var e,n,i,s,a,l,u=this;return t(this,function(t){switch(t.label){case 0:e={"X-Requested-With":null,Accept:"application/json","Content-Type":"application/json"},n=JSON.stringify({portalUrl:this.portalUrl,accessToken:this._portalToken}),i=null,r(["dojo/request"],function(t){i=t(u.serviceUrl+"/auth/token/run",{handleAs:"json",method:"POST",headers:e,data:n}).response}),s=null,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,i];case 2:return s=t.sent().data,[3,4];case 3:return a=t.sent(),o._throwError("ServiceTokenError","Failed to fetch Run Token from Reporting Service : Network Error ["+(a.message||a.name)),[3,4];case 4:return s.error?(l=s.error,o._throwError("ServiceTokenError","Failed to fetch Run Token from Reporting Service : "+l.$type+" ["+l.code+"] "+l.message),[2]):[2,{token:s.response.token,ttl:s.response.token}]}})})},o.prototype.runJob=function(n,i){return e(this,void 0,void 0,function(){var e,s,a,l,u,p=this;return t(this,function(t){switch(t.label){case 0:e={template:{itemId:""+n,portalUrl:this.portalUrl}},i&&(e.parameters=i),s={"X-Requested-With":null,Accept:"application/json","Content-Type":"application/json"},this._serviceToken&&(s.Authorization="Bearer "+this._serviceToken),a=null,r(["dojo/request"],function(t){a=t(p.serviceUrl+"/job/run",{handleAs:"json",method:"POST",headers:s,data:JSON.stringify(e)}).response}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,a];case 2:return l=t.sent(),[2,l.data.response.ticket];case 3:return u=t.sent(),404===u.response.status?o._throwError("ServiceReportNotFoundError","Report Template not available at Service Endpoint - Contact your Administrator"):o._throwError("ServiceError","Failed to start Report Job - "+(u.response.data?u.response.data.error.message:u.message)),[3,4];case 4:return[2]}})})},o.prototype.watchJob=function(n){return e(this,void 0,void 0,function(){var e,i,s,a,l,u,p,c,h,d=this;return t(this,function(t){switch(t.label){case 0:e={"X-Requested-With":null,Accept:"application/json"},this._serviceToken&&(e.Authorization="Bearer "+this._serviceToken),i=null,r(["dojo/request"],function(t){i=t(d.serviceUrl+"/job/artifacts?ticket="+n,{handleAs:"json",method:"GET",headers:e}).response}),s=null,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,i];case 2:return a=t.sent(),s=a.data,[3,4];case 3:return l=t.sent(),o._throwError("ServiceError","Unable to request Job Watch : ["+l.response.status+"] "+l.response.text),[3,4];case 4:if(s.error)o._throwError("ServiceError","Unable to request Job Watch : ["+s.error.status+"] "+s.error.message);else{if(u=s.results.filter(function(e){return"JobResult"===e.$type}).pop())return[2,u.tag];(p=s.results.filter(function(e){return"JobQuit"===e.$type}).pop())&&((c=s.results.filter(function(e){return e.$type.endsWith("error")}).pop())?(h=c.error,o._throwError("ServiceReportFailedError","Job Error Occured : "+h.$type+" ["+h.code+"] "+h.message)):o._throwError("ServiceReportFailedError","Job Quit without Job Result"))}return[2,null]}})})},o.prototype.fetchResult=function(e,t){return String.isNullOrEmpty(e)&&Error("Ticket cannot be null or empty"),String.isNullOrEmpty(t)&&Error("Tag cannot be null or empty"),this.serviceUrl+"/job/result?ticket="+e+"&tag="+t},o._throwError=function(e,t){throw{name:e,message:t}},o._probeServiceEndpoint=function(o){return e(this,void 0,void 0,function(){var e,n,i;return t(this,function(t){switch(t.label){case 0:e=null,r(["dojo/request"],function(t){e=t(o,{handleAs:"json",method:"OPTIONS",headers:{"X-Requested-With":null}}).response}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,e];case 2:return n=t.sent(),[2,!0];case 3:return i=t.sent(),[2,!1];case 4:return[2]}})})},o._fetchPortalSettings=function(o){return e(this,void 0,void 0,function(){var e,n,i;return t(this,function(t){switch(t.label){case 0:e=null,r(["dojo/request"],function(t){e=t(o+"/auth/portals",{handleAs:"json",method:"GET",headers:{"X-Requested-With":null,Accept:"application/json"}}).response}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,e];case 2:return n=t.sent(),[2,n.data.results];case 3:return i=t.sent(),this._throwError("ServiceError","Failed to fetch portal settings from item's service endpoint."),[3,4];case 4:return[2]}})})},o}();o.Reporting5Service=n})},"url:/Mapping/modules/Reporting/ListReportsView.html":t,"url:/Mapping/modules/Reporting/RunReportView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Reporting/CSS/common.css","css","DQovKioNCiAqIFJlcG9ydHNMaXN0Vmlldw0KICovDQoNCi5saXN0LXJlcG9ydHMtdmlldyB7fQ0KLmxpc3QtcmVwb3J0cy12aWV3ICogew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQoubGlzdC1yZXBvcnRzLWhlYWRlciB7DQogICAgcGFkZGluZzogMWVtIDIwcHg7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMgew0KICAgIGxpc3Qtc3R5bGU6IG5vbmU7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNFNEU4RUM7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluayB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgd2lkdGg6IDEwMCU7DQogICAgZm9udC1zaXplOiAxLjJlbTsNCiAgICBwYWRkaW5nOiAxZW0gMjBweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgY29sb3I6ICMyRDVGQjU7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluazpob3ZlciB7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLCAxNDgsIDI1NSwgMC4xKTsNCn0NCi5saXN0LW9mLXJlcG9ydHMtbGluazphY3RpdmUgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTQ4LCAyNTUsIDAuMyk7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluay10aXRsZSB7DQogICAgZGlzcGxheTogYmxvY2s7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluay1kZXNjcmlwdGlvbiB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgZm9udC1zaXplOiAwLjhlbTsNCn0NCg0KLmxpc3Qtb2YtcmVwb3J0cy1saW5rLWRldGFpbHMgew0KICAgIGZvbnQtc2l6ZTogMC44ZW07DQogICAgb3BhY2l0eTogMC42Ow0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICBjb2xvcjogYmxhY2s7DQogICAgcGFkZGluZy1sZWZ0OiAxZW07DQp9DQoNCg0KLyoqDQogKiBSZXBvcnRSZXN1bHRWaWV3DQogKi8NCg0KLnJ1bi1yZXBvcnQtdmlldyB7DQogICAgcGFkZGluZzogMWVtIDJlbTsNCn0NCi5ydW4tcmVwb3J0LXZpZXcgKiB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5ydW4tcmVwb3J0LWNvbXBsZXRlLWxpbmsgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZvbnQtc2l6ZTogMS4yZW07DQogICAgbWFyZ2luLXRvcDogMS41ZW07DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCn0NCi5ydW4tcmVwb3J0LWNvbXBsZXRlLWxpbms6aG92ZXIgew0KICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQoucnVuLXJlcG9ydC12aWV3IGlmcmFtZSB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogMjQwcHg7DQogICAgbWFyZ2luOiAxZW0gYXV0bzsNCiAgICBib3JkZXI6IDA7DQp9DQoNCi5ydW4tcmVwb3J0LWNvbXBsZXRlLWRvbmUtYnV0dG9uIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBtYXJnaW4tdG9wOiA0ZW07DQogICAgbWFyZ2luLWxlZnQ6IGF1dG87DQogICAgcGFkZGluZzogMC41ZW0gMWVtOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsIDAuMDgpOw0KICAgIGJvcmRlci1yYWRpdXM6IDJweDsNCn0="),e.resourceManager.register("Mapping","inv","Mapping/modules/Reporting/ListReportsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Reporting/RunReportView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Reporting/ListReportsView","Mapping/modules/Reporting/ListReportsViewModel","Mapping/modules/Reporting/ReportingModule","Mapping/modules/Reporting/RunReportView","Mapping/modules/Reporting/RunReportViewModel"],function(t,r,o,n,i){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.ListReportsView",t.ListReportsView),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.ListReportsViewModel",r.ListReportsViewModel),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.ReportingModule",o.ReportingModule),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.RunReportView",n.RunReportView),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.RunReportViewModel",i.RunReportViewModel)})}();