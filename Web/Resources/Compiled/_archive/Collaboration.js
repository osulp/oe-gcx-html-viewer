!function(){function e(e,t,o){if("string"==typeof e&&(o=t,t=e),void 0!==o)for(var i=t.split("."),n=null,a=window,r=0,s=i.length;r<s;r++)n=i[r],r==s-1?a[n]=o:a[n]||(a[n]={}),a=a[n];else console.warn("Undefined shim for: "+t)}var t="<div class='event-banner-data' data-binding='{@text: bannerText}{title: bannerTitle}'></div>",o="<div class='event-data-container'>    <div class='event-data' data-binding='{@text: @language-collaboration-no-event-content}'></div></div>",i="<div class='chat-entry-container' data-binding='{@class-user-entry: isOwner}{@event-onclick: handleClick}{@class-clickable: clickable}{@class-cardIsLoading: isLoading}'>    <div class='event-metadata-container menu-enabled'>        <span class='collaboration-event-metadata event-createdby' data-binding='{@text: createdByPresentable}'></span>        <span class='name-date-separator'> ~</span>        <span class='collaboration-event-metadata event-created' data-binding='{@text: created}'></span>    </div>    <button class='event-menu-button' data-binding='{@event-onclick: toggleEventMenu}{@enabled: menuEnabled}{alt: @language-collaboration-open-event-menu}{title: @language-collaboration-open-event-menu}'></button>    <div class='event-actions-widget' data-binding='{@visible: menuVisible}{@widget: EventActionsWidget}{@widget-context: @context}{@widget-required: false}'         data-menu-id='EventActions' data-menu-template='Mapping/modules/Collaboration/Events/EventActionsMenu.html'></div>    <div class='event-data-container' data-binding='{@widget: EventContentWidget}{@widget-context: @context}{@widget-required: false}{@widget-replace: true}'></div>    <div class='event-metadata-container lower'>        <div class='room-color-swatch' data-binding='{@style-background-color: color}'></div>        <span data-binding='{@text: explainerText}'></span>    </div></div>",n="<ul class='event-actions-menu' data-binding='{@visible: visibleMenuItems}{@source: visibleMenuItems}'>    <li class='list-menu-item' data-binding='{@template-for: visibleMenuItems}'>        <button class='event-actions-button' data-binding='{@event-onclick: handleMenuItemClick}{@enabled: canExecute}'>            <img class='list-menu-icon' data-binding='{src: iconUri}{title: @language-offline-maps-delete-from-server-title}{alt: @language-offline-maps-delete-from-server-title}' />            <span class='list-menu-name' data-binding='{title: description}{@text: text}'></span>        </button>    </li></ul>",a="<div class='module'>    <span data-binding='{@text: @language-collaboration-copy-event-room-select}'></span>    <select class='copy-event-room-selector' data-binding='{@value: selectedCopyRoom}{selected: selectedCopyRoom}{aria-label: @language-collaboration-copy-event-room-select}'>        <optgroup data-binding='{@source: joinedCopyTargets}{label: @language-collaboration-copy-event-joined-rooms}'>            <option data-binding='{@template-for: joinedCopyTargets}{@text: displayName}{@attach: @context}' />        </optgroup>        <optgroup data-binding='{@source: unjoinedCopyTargets}{label: @language-collaboration-copy-event-unjoined-rooms}'>            <option data-binding='{@template-for: unjoinedCopyTargets}{@text: displayName}{@attach: @context}' />        </optgroup>    </select>    <div class='form-btns'>        <button class='button' data-binding='{@event-onclick: copyClicked}{@text: @language-collaboration-copy-event-copy}'></button>        <button class='button' data-binding='{@event-onclick: cancelClicked}{@text: @language-collaboration-copy-event-cancel}'></button>    </div></div>",r="<div class='module'>    \x3c!--<span data-binding='{@text: @language-collaboration-edit-event-message}'></span>--\x3e    <textarea data-binding='{@value: message}{maxLength: characterLimit}{aria-label: @language-collaboration-event-edit-view-label}'></textarea>    <div class='form-btns'>        <button class='button' data-binding='{@event-onclick: editClicked}{@text: @language-common-edit}{@enabled: sendEnabled}{@visible: clickableGraphicsMode}'></button>        <button class='button' data-binding='{@event-onclick: saveClicked}{@text: @language-common-save}{@enabled: sendEnabled}{@hidden: clickableGraphicsMode}'></button>        <button class='button' data-binding='{@event-onclick: cancelClicked}{@text: @language-common-cancel}'></button>    </div></div>",s="<div class='event-data-container'>    <div class='image-event-data' data-binding='{@text: text}'></div>    <form target='_blank' method='post' data-binding='{action: openUrl}{@var: formElement}'>        <div class='event-image-container'>            <button>                <img class='event-image' data-binding='{src: previewUrl}{@event-onload: onPreviewLoaded}{@class-erased: deleted}{alt: @language-collaboration-event-image}' />            </button>            <button type='submit' class='image-open-full-button' data-binding='{title: @language-collaboration-event-open-image-in-new-tab}{@event-onclick: handleOpenFullClick}'></button>        </div>        <div class='markup-meta-text' data-binding='{@text: @language-collaboration-event-image-erased}{@visible: deleted}'></div>        <input name='token' type='hidden' data-binding='{@var: formTokenElement}' />    </form></div>",l="<div class='event-data-container' data-binding='{@text: text}'></div>",c="<div class='event-data-container'>    <button class='markup' data-binding='{@text: text}{@disabled: deleted}'></button>    <div class='markup-meta-text' data-binding='{@text: @language-collaboration-event-drawing-erased}{@visible: deleted}'></div></div>",d="<div class='collaboration-create-room-panel'>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-menu-displayname}{for: roomPanelId}'></label>        <input type='text' data-gcx-action='collaboration-edit-room-displayName' class='display-name-input' data-binding='{@value: displayName}{@event-onblur: validate}{@event-oninput: delayedValidate}{id: roomPanelId}' />    </div>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-menu-color}'></label>        <div data-binding='{@widget: ColorPickerWidget}{@widget-context: colorPicker}{@widget-replace: true}'></div>    </div>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-menu-permissions}'></label>        <div data-gcx-action='collaboration-edit-room-grantEditorWidget' data-binding='{@widget: GrantEditorWidget}{@widget-context: @context}{@widget-replace: true}{@visible: isOwner}'></div>    </div>    <div class='form-validation' data-binding='{@visible: verificationError}'>        <span class='field-validation-error' data-binding='{@text: verificationError}'></span>    </div>    <div class='form-btns'>        <button class='button' data-binding='{@event-onclick: handleDeleteClicked}{@visible: roomId}{@text: @language-collaboration-room-menu-delete}'></button>        <button class='button' data-binding='{@event-onclick: handleSaveClicked}{@enabled: validated}{@text: @language-collaboration-room-menu-save}'></button>        <button class='button' data-binding='{@event-onclick: handleCancelClicked}{@text: @language-collaboration-room-menu-cancel}'></button>    </div></div>",p="<div class='collaboration-create-room-panel'>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-menu-displayname}'></label>        <div class='collaboration-room-details-field' data-binding='{@text: displayName}'></div>    </div>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-menu-color}'></label>        <div class='room-color-swatch' data-binding='{@style-background-color: color}'></div>        <div class='collaboration-room-details-field' data-binding='{@text: color}'></div>    </div>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-creator-name}'></label>        <div class='collaboration-room-details-field' data-binding='{@text: createdBy}'></div>    </div>    <div class='form-item'>        <label data-binding='{@text: @language-collaboration-room-created-time}'></label>        <div class='collaboration-room-details-field' data-binding='{@text: created}'></div>    </div>    <div class='form-item' data-binding='{@visible: joined}'>        <label>            <span data-binding='{@text: @language-collaboration-room-member-names}'></span>            <span class='active-member-count' data-binding='{@text: members}'></span>        </label>        <ul class='member-name-list' data-binding='{@source: memberNames}'>            <li data-binding='{@template-for: memberNames}'>                <span data-binding='{@text: @context}'></span>            </li>        </ul>    </div>    <div class='form-btns'>        <button class='button' data-binding='{@event-onclick: handleEditClicked}{@visible: canEdit}{@text: @language-collaboration-room-menu-edit}'></button>        <button class='button' data-binding='{@event-onclick: handleCloseClicked}{@text: @language-collaboration-room-menu-close}'></button>    </div></div>",u="<div class='fui-selector' data-binding='{@class-expanded: openState}'>    <div class='fui-selector-header' data-binding='{@visible: showSelectorHeader}'>        <button data-binding='{@event-onclick: handleClickSelector}{@text: selectorText}'></button>    </div>    <div data-binding='{@visible: openState}'>        <div class='fui-selector-body' data-binding='{@hidden:showNativeSelect}{@class-expanded: openState}'>            <ul class='fui-selector-body-sublist room-item-list' data-binding='{@source: items}{@var: customSelect}'>                <li class='fui-selector-item' data-binding='{@template-for: items}{@widget: SelectorItemWidget}{@widget-context: @context}{@widget-replace: true}' />            </ul>        </div>        <select class='fui-selector-body' data-binding='{@class-expanded: openState}{@visible: showNativeSelect}{@var: selectElement}{@source: items}{@value: _selectedItems}            {@event-onchange: handleSelectionChange}{aria-label: @language-collaboration-after-action-selector-view-label}'>            <option data-binding='{@template-for: items}{@event-onclick: handleClickItem}{@text: displayName}{@attach:@context}'></option>        </select>    </div></div>",g="\x3c!-- Room Selector--\x3e<div class='collaboration-sign-in' data-binding='{@hidden: active}'>    <span data-binding='{@visible: supported}'>        <span data-binding='{@visible: enabled}'>            <span class='collaboration-sign-in-link' data-binding='{@hidden: signedIn}{@event-onclick: handleSignInClick}{@text: @language-after-action-not-signed-in}{title: @language-user-sign-in-desc}'></span>        </span>        <span data-binding='{@hidden: enabled}{@text: @language-after-action-disabled}'></span>    </span>    <span data-binding='{@hidden: supported}{@text: @language-after-action-unsupported}'></span></div><div class='collaboration-panel' data-binding='{@visible: signedIn}'>    <div class='room-selector'>        <div data-binding='{@widget: Selector}{@widget-replace: true}{@enabled: connected}'></div>    </div>    \x3c!-- Event List--\x3e    <div class='event-list-container' data-binding='{@class-event-list-container-control-mode: contributableRooms}{@class-loadingEventCards: isLoadingEvents}'>        <div class='collaboration-select-room-prompt' data-binding='{@hidden: selectedRooms}{@text: @language-after-action-room-select-prompt}'></div>        <div class='event-feed' data-binding='{@visible: selectedRooms}{@var: eventScroll}'>            <ul class='event-list' data-binding='{@source: events}'>                <li class='event-list-item' data-binding='{@template-for: events}'>                    <div data-binding='{@widget: EventWidget}{@widget-context: @context}{@widget-replace: true}'></div>                </li>            </ul>        </div>    </div></div>",b="<div class='drawing-multi-tool-dropdown' data-binding='{@visible: flyoutVisible}'>    <ul class='drawing-tool-list' data-binding='{@source: drawingTools}'>        <li data-binding='{@template-for: drawingTools}'>            <button class='drawing-tool-item' data-binding='{@enabled: enabled}{@hidden: hidden}{@class-highlight: isActive}{@event-onclick: handleChangeToolFlyout}{title: tooltip}'>                <img data-binding='{@visible: iconUri}{src: iconUri}{alt: @language-collaboration-tooltip-icon}' src='Resources/Images/Icons/Toolbar/icon-blank-24.png' />                <span class='drawing-tool-item-label' data-binding='{@text: displayName}'></span>            </button>        </li>    </ul></div>",m="<label class='form-label' data-binding='{for: attached_controlId}{@enabled: isSupported}{@var: filePickerLabel}'>    <span class='collaboration-file-input-browser' data-binding='{@text: toolTip}'></span></label><input class='collaboration-file-input-browser' type='file' data-binding='{@var: filePickerInput}{id: attached_controlId}{@enabled: isSupported}{title: toolTip}{multiple: allowMultiple}{accept: acceptFileTypes}{@event-change: handleChange}' />",h="<div class='gcx-sticky-content has-footer'>    <div class='collaboration-markup-style-selector' data-binding='{@widget: SymbolEditor}{@hidden: textSymbolSelected}'></div></div><div class='form-btns gcx-sticky-footer'>    <button class='button' data-binding='{@event-onclick: doneClicked}{@text: @language-common-done}'></button>    <button class='button' data-binding='{@event-onclick: revertClicked}{@text: @language-common-revert}'></button></div>",v="<li class='selector-item single-select'>    <ul class='room-selector-list'>        <li class='room-selector-list-item' data-binding='{@event-onchange: handleClickItem}'>            <span data-binding='{@source: item}'>                <label class='gcx-toggle' data-binding='{@template-for: item}{@style-background-color: color}{@class-new: isNew}{title: @language-collaboration-join-room}'>                    <input class='input-checkbox' type='checkbox' data-binding='{@value: selected}' />                    <span class='input-label' data-binding='{@text: displayName}'></span>                </label>            </span>        </li>        <li class='room-selector-buttons' data-binding='{@source: item}{for: id}'>            <span data-binding='{@template-for: item}'>                <span class='member-count' data-binding='{@visible: joined}'>                    <span class='members-icon'></span><span class='members-number' data-binding='{@text: members}'></span>                </span>                <button class='room-selector-button' data-binding='{@event-onclick: handleShowDetailsClicked}{title: @language-collaboration-room-details-tooltip}'></button>            </span>        </li>    </ul></li>",C="<div class='fui-selector' data-binding='{@class-expanded: openState}'>    <div class='fui-selector-header' data-binding='{@visible: showSelectorHeader}'>        <button data-binding='{@event-onclick: handleClickSelector}{@text: selectorText}'></button>    </div>    <div data-binding='{@visible: openState}'>        <div class='fui-selector-body' data-binding='{@hidden:showNativeSelect}{@class-expanded: openState}'>            <ul class='fui-selector-body-sublist room-item-list' data-binding='{@source: items}{@var: customSelect}'>                <li class='fui-selector-item' data-binding='{@template-for: items}{@widget: SelectorItemWidget}{@widget-context: @context}{@widget-replace: true}' />            </ul>            <ul class='fui-selector-body-sublist room-selector-actions'>                <li class='fui-selector-item add-room-list-item'>                    <button class='add-room-button' data-binding='{@event-onclick: handleCreateClicked}'><span class='add-label' data-binding='{@text: @language-collaboration-select-create-label}'></span></button>                </li>            </ul>        </div>        <select class='fui-selector-body' data-binding='{@class-expanded: openState}{@visible: showNativeSelect}{@var: selectElement}{@source: items}{@value: _selectedItems}            {@event-onchange: handleSelectionChange}{aria-label: @language-collaboration-selector-view-label}'>            <option data-binding='{@template-for: items}{@event-onclick: handleClickItem}{@text: displayName}{@attach:@context}'></option>        </select>    </div></div>",y="\x3c!-- Room Selector--\x3e<div class='collaboration-sign-in' data-binding='{@hidden: active}'>    <span data-binding='{@visible: supported}'>        <span data-binding='{@visible: enabled}'>            <span data-binding='{@visible: signedIn}{@text: @language-collaboration-websocket-lost-connection}'></span>            <span class='collaboration-sign-in-link' data-binding='{@hidden: signedIn}{@event-onclick: handleSignInClick}{@text: @language-collaboration-not-signed-in}{title: @language-user-sign-in-desc}'></span>        </span>        <span data-binding='{@hidden: enabled}{@text: @language-collaboration-disabled}'></span>    </span>    <span data-binding='{@hidden: supported}{@text: @language-collaboration-unsupported}'></span></div><div class='collaboration-panel' data-binding='{@visible: active}{@class-single-room: singleRoomSelected}'>    <div class='room-selector' data-binding='{@class-new: hasNewRooms}'>        <div data-binding='{@widget: Selector}{@widget-replace: true}{@enabled: connected}'></div>        <button class='new-rooms-notification' data-binding='{@noclass-hide: hasNewRooms}{@text: numberNewRooms}{@event-onclick: handleNewRoomsNotificationClick}'></button>        <button class='notification-clear-button' data-binding='{@noclass-hide: hasNewRooms}{@event-onclick: handleClearRoomNotification}{aria-label: @language-common-clear}'></button>    </div>    \x3c!-- Event List--\x3e    <div class='event-list-container' data-binding='{@class-room-selector-open: roomSelectorVisible}{@class-minimized-mode: controlsMinimized}{@class-control-mode: contributableRooms}{@class-loading-events: isLoadingEvents}{@event-onclick: handleEventFeedClick}'>        <div class='collaboration-select-room-prompt' data-binding='{@hidden: selectedRooms}{@text: @language-collaboration-room-select-prompt}'></div>        <div class='event-feed' data-binding='{@visible: selectedRooms}{@var: eventScroll}'>            <button class='historical-events-button' data-binding='{@text: @language-collaboration-get-historical}{@event-onclick: handleGetHistoricalClicked}{@visible: hasMoreEvents}'></button>            <ul class='event-list' data-binding='{@source: events}'>                <li class='event-list-item' data-binding='{@template-for: events}'>                    <div data-binding='{@widget: EventWidget}{@widget-context: @context}{@widget-replace: true}'></div>                </li>            </ul>            <button class='collaboration-message-notification' data-binding='{@noclass-hide: unreadEventsMessage}{@text: unreadEventsMessage}{@event-onclick: handleNotificationClick}'></button>            <button class='notification-clear-button' data-binding='{@noclass-hide: unreadEventsMessage}{@event-onclick: handleClearMessageNotification}{aria-label: @language-common-clear}'></button>        </div>    </div>    \x3c!--Text Entry Controls--\x3e    <div class='chat-controls' data-binding='{@enabled: connected}{@visible: contributableRooms}{@class-minimized-mode: controlsMinimized}'>        <form class='post-type-selector'>            <ul class='selector-list' role='radiogroup' data-binding='{aria-label: @language-collaboration-radio-group-label}'>                <li class='list-item text'>                    <input type='radio' id='text-post' name='post-type' value='none' checked='checked' />                    <label for='text-post' data-binding='{@text: @language-collaboration-chat-entry-selector-label-none}'></label>                </li>                <li class='list-item markup'>                    <input type='radio' id='markup-post' name='post-type' value='markup' data-binding='{@event-onclick: handleAttachmentChange}{@value: postType}' />                    <label for='markup-post' data-binding='{@text: @language-collaboration-chat-entry-selector-label-markup}'></label>                    <button class='clear-button' data-binding='{@event-onclick: handleClearClicked}{@visible: clearEnabled}{title: @language-collaboration-draw-clear-drawing}'></button>                </li>                <li class='list-item image'>                    <input type='radio' id='image-post' name='post-type' value='image' data-binding='{@event-onclick: handleAttachmentChange}{@value: postType}' />                    <label for='image-post' data-binding='{@text: @language-collaboration-chat-entry-selector-label-image}'></label>                    <button class='clear-button' data-binding='{@event-onclick: handleClearClicked}{@visible: clearEnabled}{title: @language-collaboration-draw-clear-image}'></button>                </li>            </ul>        </form>        <div class='chat-controls-input-area'>            <div class='drawing-multi-tool' data-binding='{@visible: drawingToolsVisible}'>                <div class='drawing-multi-tool-item' data-binding='{@source: selectedDrawingTool}{@class-active: toolActive}'>                    <div data-binding='{@template-for: selectedDrawingTool}'>                        <button class='drawing-tool-item' data-binding='{@enabled: enabled}{@class-highlight: isActive}{@event-onclick: handleToolbarItemClick}{aria-label: name}'>                            \x3c!--{title: tooltip}--\x3e                            <img data-binding='{@visible: iconUri}{src: iconUri}{alt: @language-collaboration-tooltip-icon}' src='Resources/Images/Icons/Toolbar/icon-blank-24.png' />                            <span class='drawing-tool-item-label' data-binding='{@text: displayName}'></span>                        </button>                    </div>                </div>                <div class='drawing-multi-tool drawing-multi-tool-chooser'>                    <button class='open-flyout-button' data-binding='{@event-onclick: handleToggleToolFlyout}{@attach: selectedDrawingTool}{title: @language-collaboration-chat-entry-drawing-multitool-tooltip}{aria-label: @language-collaboration-chat-entry-drawing-multitool-tooltip}'></button>                </div>                <div class='collaboration-multi-tool-dropdown-container' data-binding='{@widget: ToolFlyoutWidget}{@widget-context: @context}'>                </div>                <button class='style-button button' data-binding='{@event-onclick: handleDrawSymbologyClicked}{@enabled: selectedDrawingTool}{@text: @language-collaboration-chat-entry-drawing-style}{title: @language-collaboration-chat-entry-drawing-style-tooltip}'></button>            </div>            <div class='image-upload' data-binding='{@visible: uploadToolsVisible}'>                <div class='filepicker' data-binding='{@widget: FilePickerWidget}{@visible: isVisible}{title: @language-collaboration-chat-image-upload-tooltip}'></div>                <button class='button location-button' data-binding='{@enabled: canManuallyLocate}{@text: @language-collaboration-chat-image-manually-locate}{title: @language-collaboration-chat-image-manually-locate-tooltip}{@event-onclick: handleManuallyLocateClick}{@class-active: toolActive}'></button>            </div>            <textarea class='chat-text-box' rows='3' data-binding='{@event-onfocus: handleTextBarFocus}{@value: entryText}{placeholder: textEntryPlaceholder}{maxLength: characterLimit}{@event-onkeyup: handleKeyUp}{@event-oninput: handleInput}{@class-text-post: textPost}{aria-label: @language-collaboration-chat-text-box-label}'></textarea>        </div>        <div class='post-container'>            <span class='post-desc' data-binding='{@text: typeCaption}'></span>            <select class='room-selector' data-binding='{@event-onclick: handlePostingRoomSelector}{@source: contributableRooms}{@value: postingRoom}{@style-border-color: postingRoomColor}{aria-label: typeCaption}'>                <option data-binding='{@template-for: contributableRooms}{@text: displayName}{@attach: @context}' />            </select>            <div class='room-name' data-binding='{@text: firstRoom}{@style-border-color: postingRoomColor}{title: firstRoom}'></div>            <button class='send-button button' data-binding='{@enabled: sendEnabled}{@event-onclick: handleSendPressed}{@text: @language-collaboration-send-button-label}{@style-border-color: postingRoomColor}{@style-background-color: postingRoomColor}{@style-color: postTextColor}{@class-postingEvent: isSending}'></button>        </div>    </div></div>";require({cache:{"Mapping/modules/Collaboration/CollaborationModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.ModuleBase);o.CollaborationModule=n})},"Mapping/modules/Collaboration/GraphicsManager":function(){define(["require","exports","geocortex/infrastructure/MapUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/DateFormat","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/GraphicsLayerIds"],function(e,t,o,i,n,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){var o=this;this._restHandler=null,this._app=null,this._isBuilt=!1,this._graphicBeingDeleted=!1,this.readOnly=!1,this.postedImageSymbol=new esri.symbol.PictureMarkerSymbol("Resources/Images/Pushpins/map-marker-image-24.png",24,24),this._events={},this._app=e,this._restHandler=t,this._app.waitUntilMapLoaded().then(function(){o._graphicsLayer=r.getInternalGraphicsLayer(s.COLLABORATION_LAYER_ID,o._app,r.GraphicsLayerType.Markup,!1);var e={};e.autoEditable=!0,e.displayName=o._app.getResource("Mapping","language-collaboration-clickable-graphics-label-drawing"),e.canChangeStyles=function(e){return o._canEditEventSymbology(e)},e.canDelete=function(e){return o._canEditEventGeometry(e)},e.canEdit=function(e){return o._canEditEventGeometry(e)},e.aliases={_created:o._app.getResource("Mapping","language-collaboration-event-created"),_createdBy:o._app.getResource("Mapping","language-collaboration-event-createdBy"),_message:o._app.getResource("Mapping","language-collaboration-event-message")},o._app.clickableGraphics.register(o._graphicsLayer,e)}),this._app.command("LoadCollaborationMarkupGraphics").register(this,this._executeLoadCollaborationEventGraphics),this._app.command("AddCollaborationFeatures").register(this,this._executeAddCollaborationFeatures,this._canExecuteAddCollaborationFeatures),this._app.command("RemoveCollaborationFeatures").register(this,this._executeRemoveCollaborationFeatures,this._canExecuteRemoveCollaborationFeatures),this._app.command("ClearCollaborationFeatures").register(this,this._executeClearCollaborationFeatures),this._app.command("HighlightCollaborationFeatures").register(this,this._executeHighlightCollaborationFeatures),this._app.command("EditCollaborationMarkupMessage").register(this,this._executeEditCollaborationMarkupMessage,this._canExecuteEditCollaborationMarkupMessage),this._app.event("GraphicEditingDoneEvent").subscribe(this,this._handleGraphicEditingDoneEvent),this._app.event("GraphicRemovedEvent").subscribe(this,this._handleGraphicRemovedEvent),this._app.event("_deleteClickableFeatureStarted").subscribe(this,this._handleDeleteClickableFeatureStartedEvent)}return e.prototype.buildRoomMarkupState=function(e){var t=this;return e.length?new Promise(function(o,i){t._restHandler.getLatestState({rooms:e,eventTypes:["ShareMarkupEvent","DeleteMarkupEvent","ShareImageEvent"]}).then(function(e){e.events.forEach(function(e){t._executeLoadCollaborationEventGraphics(e)}),t._isBuilt=!0,o()}).catch(function(e){t._app.trace.error("GraphicsManager failed to build the requested graphics state of the map. Error: {0}.".format(e.message)),i(e)})}):Promise.resolve()},e.prototype._executeLoadCollaborationEventGraphics=function(e){e.sourceEvent&&(this._events[e.sourceEvent]?e.roomId===this._events[e.sourceEvent].roomId&&(this._events[e.sourceEvent].deleted=!0,this._events[e.sourceEvent].editInProgress=!1,this._app.event("CollaborationMapEventDeletedEvent").publish(e.sourceEvent),this._app.command("RemoveCollaborationFeatures").execute(e.sourceEvent)):(this._events[e.sourceEvent]={event:null,deleted:!0,roomId:e.roomId},this._app.event("CollaborationMapEventDeletedEvent").publish(e.sourceEvent),this._app.command("RemoveCollaborationFeatures").execute(e.sourceEvent))),this._events[e.id]&&this._events[e.id].editInProgress&&(this._events[e.id].editInProgress=!1),this._events[e.id]&&this._events[e.id].deleted&&e.roomId===this._events[e.id].roomId?(this._app.event("CollaborationMapEventDeletedEvent").publish(e.id),this._events[e.id]={event:e,deleted:!0,roomId:e.roomId}):(this._app.command("AddCollaborationFeatures").execute(e),this._events[e.id]={event:e,deleted:!1,roomId:e.roomId})},e.prototype._executeClearCollaborationFeatures=function(){this._graphicsLayer.clear(),this._isBuilt=!1,this._events={},this._app.command("StopEditingMarkup").execute()},e.prototype._findEventGraphics=function(e){return this._graphicsLayer.graphics.filter(function(t){return t.attributes&&t.attributes._eventId===e})},e.prototype.mapHasGraphicsLoaded=function(e){return this._graphicsLayer.graphics.some(function(t){return t.attributes&&t.attributes._eventId===e})},e.prototype.eventDeleted=function(e){return this._events[e]&&this._events[e].deleted},e.prototype._canExecuteRemoveCollaborationFeatures=function(e){return this.mapHasGraphicsLoaded(e)},e.prototype._executeRemoveCollaborationFeatures=function(e){var t=this;this._findEventGraphics(e).forEach(function(e){t._graphicsLayer.remove(e),t._app.featureSetManager.updateCollectionsOnFeatureDeletion(e)})},e.prototype._loadShareImageGraphic=function(e){var t=esri.geometry.fromJson(e.data.location),o=esri.symbol.fromJson(this.postedImageSymbol.toJson());return new esri.Graphic(t,o)},e.prototype._loadShareMarkupGraphics=function(e){var t=JSON.parse(JSON.stringify(e.data.markup)),o=new esri.tasks.FeatureSet(t.points||(new esri.tasks.FeatureSet).toJson());o.features=o.features?o.features:[];var i=new esri.tasks.FeatureSet(t.polylines||(new esri.tasks.FeatureSet).toJson());i.features=i.features?i.features:[];var n=new esri.tasks.FeatureSet(t.polygons||(new esri.tasks.FeatureSet).toJson());n.features=n.features?n.features:[];var a=new esri.tasks.FeatureSet(t.rectangles||(new esri.tasks.FeatureSet).toJson());a.features=a.features?a.features:[];var r=o.features.concat(i.features).concat(n.features).concat(a.features);return r.forEach(function(e){if(e.attributes&&e.attributes.__symbol){var t=esri.symbol.fromJson(e.attributes.__symbol);e.setSymbol(t)}}),r},e.prototype._canExecuteAddCollaborationFeatures=function(e){return!this.mapHasGraphicsLoaded(e.id)},e.prototype._executeAddCollaborationFeatures=function(e){var t=this;if(!e)throw new Error("Cannot add Collaboration graphics without an event reference.");var o=[];switch(e.type){case"ShareMarkupEvent":o=this._loadShareMarkupGraphics(e);break;case"ShareImageEvent":o=[this._loadShareImageGraphic(e)]}o.forEach(function(o){t._addCollaborationGraphicAttributes(o,e),t._graphicsLayer.add(o)}),this._events[e.id]={event:e,deleted:!1,roomId:e.roomId}},e.prototype._addCollaborationGraphicAttributes=function(e,t){if(e&&t){e.attributes||(e.attributes={}),e.attributes._eventId=t.id,e.attributes._event=t,e.attributes._createdBy=t.createdBy;var o={timeZoneId:"",displayTimeZoneId:this._app.site.displayTimeZoneId};e.attributes._created=n.formatDate(new Date(Date.parse(t.created)),a.DateFormat.DEFAULT,o),t.data.message&&(e.attributes._message=t.data.message)}},e.prototype._removeCollaborationGraphicAttributes=function(e){e&&e.attributes&&(delete e.attributes._event,delete e.attributes._createdBy,delete e.attributes._created,delete e.attributes._message)},e.prototype._executeHighlightCollaborationFeatures=function(e){var t=this._findEventGraphics(e);if(t.length){var o=esri.graphicsExtent(t),i=this._app.map.extent,n=o.getHeight()*o.getWidth(),a=i.getHeight()*i.getWidth(),r=i.contains(o),s=400*n>=a||0===n;r&&s||this._app.command("ZoomToExtent").execute(o.expand(2)),t.forEach(function(e){var t=e.getNode();t&&dojo.fx.chain([dojo.fadeOut({duration:250,node:t}),dojo.fadeIn({duration:250,node:t})]).play()})}},e.prototype._canExecuteEditCollaborationMarkupMessage=function(e){return!this.readOnly&&this._app.command("EditCollaborationEvent").canExecute(e)&&!!this._events[e]&&void 0!==this._events[e].event.data.message},e.prototype._executeEditCollaborationMarkupMessage=function(e,t){this._events[e].newMessage=t},e.prototype._canEditEventGeometry=function(e){if(this.readOnly||!e||!e.attributes||e.getLayer()!==this._graphicsLayer)return!1;var t=e.attributes._eventId;return t&&this._events[t]&&this._events[t].event&&this._app.command("EditCollaborationEvent").canExecute(t)&&!this._events[t].editInProgress},e.prototype._canEditEventSymbology=function(e){return this._canEditEventGeometry(e)&&"ShareImageEvent"!==this._events[e.attributes._eventId].event.type},e.prototype._messageChanged=function(e){return this._events[e]&&this._events[e].event&&this._events[e].event.data&&void 0!==this._events[e].event.data.message&&this._events[e].event.data.message!==this._events[e].newMessage&&void 0!==this._events[e].newMessage},e.prototype._handleGraphicEditingDoneEvent=function(e){if(e&&e.new&&e.old&&e.new.attributes&&e.new.getLayer()===this._graphicsLayer&&!this._graphicBeingDeleted){var t=e.new.attributes._eventId;t&&(o.esriGeometriesEqual(e.new.geometry,e.old.geometry)&&i.esriSymbolsEqual(e.new.symbol,e.old.symbol)&&!this._messageChanged(t)||this._eventEdited(t))}},e.prototype._handleDeleteClickableFeatureStartedEvent=function(e){var t=e.esriFeature.get();t&&t.getLayer()===this._graphicsLayer&&t.attributes&&t.attributes._eventId&&(this._graphicBeingDeleted=!0)},e.prototype._handleGraphicRemovedEvent=function(e){if(e.graphic&&e.graphic.attributes&&e.graphic.getLayer()===this._graphicsLayer){var t=e.graphic.attributes._eventId;t&&(this._graphicBeingDeleted=!1,this._eventEdited(t))}},e.prototype._eventDeleted=function(e){var t=this._events[e]?this._events[e].event:null;if(t){this._events[e].editInProgress=!0,this._events[e].newMessage=void 0;var o={roomId:t.roomId,type:"DeleteMarkupEvent",data:{}};this._app.command("EditCollaborationEvent").execute(e,o)}else this._app.trace.warning("No collaboration event with id {0} has been loaded.".format(e))},e.prototype._eventEdited=function(e){var t=this;if(!(this.readOnly||this._events[e]&&this._events[e].deleted)){var o=this._events[e]?this._events[e].event:null;if(o){var i=this._findEventGraphics(o.id);if(i.length){this._events[e].editInProgress=!0;var n={type:o.type,roomId:o.roomId,data:{}};i.forEach(function(e){return t._removeCollaborationGraphicAttributes(e)});var a=o.data.message;switch(void 0!==this._events[e].newMessage&&(a=this._events[e].newMessage,this._events[e].newMessage=void 0),o.type){case"ShareMarkupEvent":i.forEach(function(e){e.symbol&&(e.attributes||(e.attributes={}),e.attributes.__symbol=e.symbol.toJson())});var r=new esri.tasks.FeatureSet;r.features=i.filter(function(e){return"point"===e.geometry.type});var s=new esri.tasks.FeatureSet;s.features=i.filter(function(e){return"polyline"===e.geometry.type});var l=new esri.tasks.FeatureSet;l.features=i.filter(function(e){return"polygon"===e.geometry.type});var c=new esri.tasks.FeatureSet;c.features=i.filter(function(e){return"rectangle"===e.geometry.type});var d={points:r.toJson(),polylines:s.toJson(),polygons:l.toJson(),rectangles:c.toJson()};n.data={markup:d,message:a},this._app.command("EditCollaborationEvent").execute(o.id,n);break;case"ShareImageEvent":n.attachmentId=o.attachmentId,n.data={location:i[0].geometry.toJson(),message:a},this._app.command("EditCollaborationEvent").execute(o.id,n)}}else this._eventDeleted(o.id)}else this._app.trace.warning("No collaboration event with id {0} has been loaded.".format(e))}},e}();t.GraphicsManager=l})},"Mapping/modules/Collaboration/MarkupManager":function(){define(["require","exports","geocortex/infrastructure/SymbolUtils","geocortex/framework/observables","geocortex/infrastructure/tools/DrawMode","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,o,i,n,a,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){var n=this;if(this._markupWorkingLayer=null,this._drawingToolNames=[],this._currentPointSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,14,new esri.symbol.SimpleLineSymbol,o.defaultSymbolColor()),this._currentPolylineSymbol=o.defaultLineSymbol(),this._currentPolygonSymbol=o.defaultFillSymbol(),this._currentTextSymbol=o.defaultTextSymbol(),this._photoLocation=null,this._hasMarkup=new i.Observable(!1),this._editInProgress=new i.Observable(!1),this.unpostedImageSymbol=new esri.symbol.PictureMarkerSymbol("Resources/Images/Pushpins/map-marker-image-24.png",24,24),this.currentSymbol=null,this.drawingToolSelectedType=new i.Observable(null),this.toolReady=new i.Observable(!1),this._app=e,!t||!this._app.toolRegistry)throw new Error("No tools were specified. Collaboration markup will be unavailable.");this._drawingToolNames=t.map(function(e){return e.name}),this._app.command("CollaborationDraw").register(this,this._executeCollaborationDraw,this._canExecuteCollaborationDraw),this._app.command("CollaborationDrawText").register(this,this._executeCollaborationDrawText,this._canExecuteCollaborationDrawText),this._app.command("SetCollaborationImageLocation").register(this,this._handleImageLocationFinished),this.drawingToolSelectedType.bind(this,this._handleSelectedToolChangedEvent),this._app.command("ClearCollaborationDrawings").register(this,this._executeClearCollaborationDrawings,this._canExecuteClearCollaborationDrawings),this._hasMarkup.bind(this,function(){return n._syncToolReady()}),this._editInProgress.bind(this,function(){return n._syncToolReady()}),this._app.waitUntilMapLoaded().then(function(){n._markupWorkingLayer=s.getInternalGraphicsLayer(r.COLLABORATION_SCRATCH_LAYER_ID,n._app,s.GraphicsLayerType.Markup,!1)}),this._photoLocation=new esri.Graphic;var a=esri.symbol.fromJson(this.unpostedImageSymbol.toJson());this._photoLocation.setSymbol(a);var l={};l.autoEditable=!0,l.displayName=this._app.getResource("Mapping","language-collaboration-clickable-graphics-label-drawing"),this._app.clickableGraphics.register(this._markupWorkingLayer,l);var c=function(e,t){e===n._markupWorkingLayer&&t()};this._app.event("GraphicRemovedEvent").subscribe(this,function(e){return c(e.graphicLayer,function(){return n._syncHasMarkup()})}),this._app.event("GraphicEditActivatedEvent").subscribe(this,function(e){return c(e.graphic.getLayer(),function(){return n._editInProgress.set(!0)})}),this._app.event("GraphicEditDeactivatedEvent").subscribe(this,function(e){return c(e.graphic.getLayer(),function(){return n._editInProgress.set(!1)})})}return e.prototype.getFeaturesFromDrawingsLayer=function(){var e={points:new esri.tasks.FeatureSet,polylines:new esri.tasks.FeatureSet,polygons:new esri.tasks.FeatureSet,rectangles:new esri.tasks.FeatureSet};return this._markupWorkingLayer.graphics.forEach(function(t){t.symbol&&(t.attributes||(t.attributes={}),t.attributes.__symbol=t.symbol.toJson()),t.geometry instanceof esri.geometry.Point?e.points.features.push(t):t.geometry instanceof esri.geometry.Polygon?e.polygons.features.push(t):t.geometry instanceof esri.geometry.Polyline?e.polylines.features.push(t):t.geometry instanceof esri.geometry.Extent&&e.rectangles.features.push(t)}),e},e.prototype.setPhotoLocation=function(e,t){var o=this;return void 0===t&&(t=!1),new Promise(function(i,n){o.removePhotoLocation(),a.projectGeometry(e,o._app.map.spatialReference,function(e){o._photoLocation.setGeometry(e),o._markupWorkingLayer.add(o._photoLocation),o._syncHasMarkup(),t&&o._app.map.centerAt(e),i(e)},function(e){n(e)},o._app)})},e.prototype.removePhotoLocation=function(){this._markupWorkingLayer.remove(this._photoLocation),this._photoLocation.setGeometry(null),this._syncHasMarkup()},e.prototype.getPhotoLocation=function(){return this._photoLocation.geometry},e.prototype._executeClearCollaborationDrawings=function(){this._markupWorkingLayer.clear(),this._syncHasMarkup()},e.prototype._handleImageLocationFinished=function(e){this.setPhotoLocation(e)},e.prototype._canExecuteCollaborationDrawText=function(e){return!!e},e.prototype._executeCollaborationDrawText=function(e){var t=this;this.currentSymbol instanceof esri.symbol.TextSymbol&&this.currentSymbol.text?this._addTextMarkup(this.currentSymbol.text,e):this._app.command("Prompt").execute(this._app.getResource("Mapping","language-collaboration-add-text-title"),this._app.getResource("Mapping","language-collaboration-add-text-description"),"",function(o){o&&t._addTextMarkup(o,e),t._app.command("ShowMap").execute()})},e.prototype._addTextMarkup=function(e,t){if(t.getExtent){var o=t.getExtent();o&&(t=o.getCenter())}var i=esri.symbol.fromJson(this._currentTextSymbol.toJson());i.setText(e);var n=new esri.Graphic(t,i,{});this._markupWorkingLayer.add(n),this._syncHasMarkup()},e.prototype._canExecuteCollaborationDraw=function(e){return!!e},e.prototype._executeCollaborationDraw=function(e){var t=null;e instanceof esri.geometry.Point?t=this.currentSymbol:e instanceof esri.geometry.Polygon?t=this.currentSymbol:e instanceof esri.geometry.Polyline?t=this.currentSymbol:e instanceof esri.geometry.Extent&&(t=this.currentSymbol);var o=new esri.Graphic(e,t,{});this._markupWorkingLayer.add(o),this._syncHasMarkup()},e.prototype._syncHasMarkup=function(){this._hasMarkup.set(!!this._markupWorkingLayer.graphics.length),this._app.command("ClearCollaborationDrawings").raiseCanExecuteChanged()},e.prototype._syncToolReady=function(){this.toolReady.set(this._hasMarkup.get()&&!this._editInProgress.get())},e.prototype._handleSelectedToolChangedEvent=function(e){if("CollaborationTextDraw"!==e.name)switch(e.drawMode){case n.DrawMode.POINT:this.currentSymbol=this._currentPointSymbol;break;case n.DrawMode.FREEHAND_POLYLINE:case n.DrawMode.LINE:case n.DrawMode.POLYLINE:this.currentSymbol=this._currentPolylineSymbol;break;case n.DrawMode.POLYGON:case n.DrawMode.FREEHAND_POLYGON:case n.DrawMode.CIRCLE:case n.DrawMode.ELLIPSE:case n.DrawMode.EXTENT:case n.DrawMode.RECTANGLE:this.currentSymbol=this._currentPolygonSymbol;break;case null:break;default:throw new Error("{0} draw mode is unhandled.".format(e.drawMode))}else this.currentSymbol=this._currentTextSymbol},e.prototype._isConfigured=function(e){return this._drawingToolNames.some(function(t){return t===e})},e.prototype.setCurrentSymbol=function(e){this.currentSymbol=esri.symbol.fromJson(JSON.parse(e)),this.currentSymbol instanceof esri.symbol.TextSymbol?this._currentTextSymbol=this.currentSymbol:this.currentSymbol instanceof esri.symbol.SimpleLineSymbol?this._currentPolylineSymbol=this.currentSymbol:this.currentSymbol instanceof esri.symbol.SimpleFillSymbol?this._currentPolygonSymbol=this.currentSymbol:this.currentSymbol instanceof esri.symbol.MarkerSymbol&&(this._currentPointSymbol=this.currentSymbol)},e.prototype._canExecuteClearCollaborationDrawings=function(){return!!this._markupWorkingLayer.graphics.length},e}();t.MarkupManager=l})},"Mapping/modules/Collaboration/RestHandler":function(){define(["require","exports","geocortex/geocortex","geocortex/essentials/utilities/UrlUtilities"],function(e,t,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.eventId=0,this.app=e,this._restEndpoint=t}return e.getCollaborationServiceUrl=function(e){var t=/^(.*?)(\/*)$/.exec(e.site.originalUrl)[1];return i.UrlUtilities.simplify(t+"/../../collaboration")},e.prototype.getEventId=function(){var e=this.eventId.toString();return this.eventId++,e},e.prototype.getRooms=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!1},r={options:JSON.stringify(e),token:t.app.site.principal.tokens.site},s={url:t._makeUrl(t._restEndpoint,"Rooms"),content:r,load:function(e){i(e)},error:function(e){n(e)}};o.request(s,a)})},e.prototype.query=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!1},r={url:t._makeUrl(t._restEndpoint,"Events/Query"),content:{options:JSON.stringify(e),token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.getLatestState=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!1},r={url:t._makeUrl(t._restEndpoint,"Events/GetLatestState"),content:{options:JSON.stringify(e),token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.addEvent=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!0},r={url:t._makeUrl(t._restEndpoint,"Room/{0}/Event/Add".format(e.roomId)),content:{clientEvent:JSON.stringify(e),token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.createRoom=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!0},r={url:t._makeUrl(t._restEndpoint,"Rooms/Create"),content:{clientRoom:JSON.stringify(e),token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.joinRoom=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!0},r={url:t._makeUrl(t._restEndpoint,"Room/{0}/Join".format(e)),content:{token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.leaveRoom=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!0},r={url:t._makeUrl(t._restEndpoint,"Room/{0}/Leave".format(e)),content:{token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.copyEvent=function(e,t){var i=this;return new Promise(function(n,a){var r={usePost:!0},s={url:i._makeUrl(i._restEndpoint,"Event/{0}/Copy/{1}".format(e,t)),content:{token:i.app.site.principal.tokens.site},load:function(e){n(e)},error:function(e){a(e)}};o.request(s,r)})},e.prototype.editRoom=function(e,t){var i=this;return new Promise(function(n,a){var r={usePost:!0},s={url:i._makeUrl(i._restEndpoint,"Room/{0}/Edit".format(e)),content:{clientRoom:JSON.stringify(t),token:i.app.site.principal.tokens.site},load:function(e){n(e)},error:function(e){a(e)}};o.request(s,r)})},e.prototype.editEvent=function(e,t){var i=this;return new Promise(function(n,a){var r={usePost:!0},s={url:i._makeUrl(i._restEndpoint,"Event/{0}/Edit".format(e)),content:{clientEvent:JSON.stringify(t),token:i.app.site.principal.tokens.site},load:function(e){n(e)},error:function(e){a(e)}};o.request(s,r)})},e.prototype.getEvent=function(e){var t=this;return new Promise(function(i,n){var a={usePost:!1},r={url:t._makeUrl(t._restEndpoint,"Event/{0}".format(e)),content:{token:t.app.site.principal.tokens.site},load:function(e){i(e)},error:function(e){n(e)}};o.request(r,a)})},e.prototype.checkRoomNameUnique=function(e,t){var i=this;return new Promise(function(n,a){var r={usePost:!1},s={url:i._makeUrl(i._restEndpoint,"Rooms/Names/CheckUniqueness"),content:{roomName:e,appId:t,token:i.app.site.principal.tokens.site},load:function(e){n(e)},error:function(e){a(e)}};o.request(s,r)})},e.prototype.pushRoom=function(e,t,i){var n=this;return new Promise(function(a,r){var s={usePost:!0},l={url:n._makeUrl(n._restEndpoint,"Room/{0}/Push/{1}".format(e,t)),content:{options:JSON.stringify(i),token:n.app.site.principal.tokens.site},load:function(e){a(e)},error:function(e){r(e)}};o.request(l,s)})},e.prototype._makeUrl=function(e,t){return e.endsWith("/")&&(e=e.substring(0,e.length-1)),"{0}/{1}".format(e,t)},e}();t.RestHandler=n})},"Mapping/modules/Collaboration/Events/BaseEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e)},o.prototype.destroy=function(){t.prototype.destroy.call(this),this.viewModel&&delete this.viewModel},o}(i.ViewBase);o.BaseEventView=n})},"Mapping/modules/Collaboration/Events/BaseEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/DateFormat"],function(t,o,i,n,a,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=new n.Observable(""),e.created=new n.Observable(""),e.createdBy=new n.Observable(""),e.createdByPresentable=new n.Observable(""),e.color=new n.Observable(""),e.roomDisplayName=new n.Observable(""),e}return e(o,t),o.prototype._formatName=function(e){return-1===e.lastIndexOf("(")?e.trim():e.slice(0,e.lastIndexOf("(")).trim()},o.prototype._formatDate=function(e){var t=new Date(Date.parse(e)),o=new Date(Date.now()),i=o.getUTCFullYear()===t.getUTCFullYear()&&o.getUTCMonth()===t.getUTCMonth()&&o.getUTCDate()===t.getUTCDate(),n={timeZoneId:"",displayTimeZoneId:this.app.site.displayTimeZoneId||""};return i?a.formatDate(t,r.DateFormat.TIME_SHORT,n):a.formatDate(t,r.DateFormat.DATE_TIME_SHORT,n)},o.prototype._updateRoom=function(e){this.room.id===e.id&&(this.room.color=e.color,this.room.displayName=e.displayName,this.color.set(this.room.color),this.roomDisplayName.set(this.room.displayName))},o.prototype.onClick=function(){},o.prototype.loadEvent=function(){this.created.set(this._formatDate(this.event.created)),this.createdBy.set(this.event.createdBy),this.createdByPresentable.set(this._formatName(this.event.createdBy)),this.type.set(this.event.type),this.color.set(this.room.color),this.roomDisplayName.set(this.room.displayName),this._roomSubscriptionToken=this.app.event("CollaborationRoomUpdatedEvent").subscribe(this,this._updateRoom)},o.prototype.unloadEvent=function(){this.app.event("CollaborationRoomUpdatedEvent").unsubscribe(this._roomSubscriptionToken)},o}(i.ViewModelBase);o.BaseEventViewModel=s})},"Mapping/modules/Collaboration/Events/EventCopyView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i._event=null,i.app.command("ActivateEventCopyView").register(i,i._handleShowCopyDialogForEvent),i}return e(o,t),o.prototype.cancelClicked=function(){this.app.viewManager.deactivateView(this),this._event=null},o.prototype.copyClicked=function(){this.app.command("CopyCollaborationEvent").execute(this._event,this.viewModel.selectedCopyRoom.get().id),this.app.viewManager.deactivateView(this)},o.prototype._handleShowCopyDialogForEvent=function(e){this._event=e,this.app.viewManager.activateView(this)},o}(i.ViewBase);o.EventCopyView=n})},"Mapping/modules/Collaboration/Events/EventEditView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i.app.command("ActivateEditCollaborationEventMessageView").register(i,i._executeEditCollaborationMessage,i._canEditCollaborationMessage),i.app.command("ActivateEditCollaborationFeatureMessageView").register(i,i._executeEditCollaborationGraphicMessage,i._canEditCollaborationGraphicMessage),i}return e(o,t),o.prototype.cancelClicked=function(){this.app.viewManager.deactivateView(this)},o.prototype.editClicked=function(){this.viewModel.editEvent(),this.app.viewManager.deactivateView(this)},o.prototype.saveClicked=function(){this.viewModel.saveEvent(),this.app.viewManager.deactivateView(this)},o.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.app.command("EditCollaborationFeatureMessage").raiseCanExecuteChanged()},o.prototype.exit=function(){this.app.viewManager.deactivateView(this)},o.prototype._canEditCollaborationMessage=function(e){return this.app.command("EditCollaborationMarkupMessage").canExecute(e.id)},o.prototype._executeEditCollaborationMessage=function(e){this.viewModel.clickableGraphicsMode.set(!1),this.viewModel.loadEvent(e),this.app.viewManager.activateView(this)},o.prototype._canEditCollaborationGraphicMessage=function(e){var t=e.esriFeature.get();if(t&&t.attributes&&t.attributes._event&&"__CollaborationGraphicsLayer"===t.getLayer().id){var o=t.attributes._event;return this.viewModel.event&&o.id!==this.viewModel.event.id&&(this.viewModel.editedMessage=void 0),this.app.command("EditCollaborationMarkupMessage").canExecute(o.id,"")&&this.app.command("ShowEditCollaborationMessageView").canExecute(o)}return!1},o.prototype._executeEditCollaborationGraphicMessage=function(e){var t=e.esriFeature.get();this.viewModel.clickableGraphicsMode.set(!0),this.viewModel.loadEvent(t.attributes._event),this.app.viewManager.activateView(this)},o}(i.ViewBase);o.EventEditView=n})},"Mapping/modules/Collaboration/Events/EventEditViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.event=null,e.message=new n.Observable(""),e.characterLimit=new n.Observable,e.sendEnabled=new n.Observable(!1),e.clickableGraphicsMode=new n.Observable(!1),e}return e(o,t),o.prototype.initialize=function(e){var o=this;t.prototype.initialize.call(this,e);this.app.configModel.moduleConfigs.filter(function(e){return"Collaboration"===e.moduleName})[0];e&&this.characterLimit.set(e.characterLimit||1e3),this.message.bind(this,function(e){o.clickableGraphicsMode.get()&&void 0!==o.editedMessage?o.sendEnabled.set(e!==o.editedMessage):o.event&&o.event.data&&o.sendEnabled.set(e!==o.event.data.message)})},o.prototype.loadEvent=function(e){void 0!==e.data.message&&(this.event=e,this.clickableGraphicsMode.get()&&void 0!==this.editedMessage?this.message.set(this.editedMessage):this.message.set(e.data.message))},o.prototype.editEvent=function(){this.editedMessage=this.message.get(),this.app.command("EditCollaborationMarkupMessage").execute(this.event.id,this.message.get())},o.prototype.saveEvent=function(){var e=this.event.data.message;if(!this.message.equals(e)){var t=JSON.parse(JSON.stringify(this.event.data));t.message=this.message.get();var o={type:this.event.type,roomId:this.event.roomId,attachmentId:this.event.attachmentId,data:t};this.app.command("EditCollaborationEvent").execute(this.event.id,o)}},o}(i.ViewModelBase);o.EventEditViewModel=a})},"Mapping/modules/Collaboration/Rooms/EditRoomView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/observables"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.deleted=new n.Observable(!1),e._validationActive=new n.Observable(!1),e._ownershipBinding="",e}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e)},o.prototype.resolveWidget=function(e,o,i){switch(t.prototype.resolveWidget.call(this,e,o),e){case"GrantEditorWidget":var n=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.documents.GrantEditorView",markupResource:"Mapping/infrastructure/documents/GrantEditorView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});return n&&n.attach(this.viewModel.grantEditorViewModel),n;default:return null}},o.prototype.loadRoom=function(e){var t=this;return this.viewModel.loadRoom(e).then(function(){t.viewModel.mode.equals("edit")&&(t._ownershipBinding=t.viewModel.isOwner.bind(t,t._handleOwnershipChange))})},o.prototype._handleOwnershipChange=function(e){e||(this.viewModel.isOwner&&this.viewModel.isOwner.unbind(this._ownershipBinding),this.app.viewManager.deactivateView(this),this.app.command("DisplayNotification").execute(this.app.getResource(this.libraryId,"language-collaboration-room-menu-lost-room-administrator-privileges")))},o.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel.isOwner.unbind(this._ownershipBinding),this._validationActive.set(!1),this.viewModel.verificationError.set(""),this.viewModel.savePromise.set(Promise.resolve())},o.prototype.handleSaveClicked=function(e,t,o){this.viewModel.saveRoom(),this.app.viewManager.deactivateView(this)},o.prototype.handleCancelClicked=function(e,t,o){var i=this;if(this.viewModel.dirty){var n=this.app.getResource(this.libraryId,"language-collaboration-room-menu-cancel-confirm"),a=this.app.getResource(this.libraryId,"language-collaboration-room-menu-cancel-confirm-title");this.app.command("Confirm").execute(n,a,function(e){e&&i.app.viewManager.deactivateView(i)})}else this.app.viewManager.deactivateView(this)},o.prototype.handleDeleteClicked=function(e,t,o){var i=this;if(this.viewModel.roomId.get()){var n={displayName:this.viewModel.displayName.get(),active:!1},a=this.app.getResource(this.libraryId,"language-collaboration-room-menu-delete-room-confirm").format(n.displayName),r=this.app.getResource(this.libraryId,"language-collaboration-room-menu-delete-room-confirm-title").format(n.displayName);this.app.command("Confirm").execute(a,r,function(e){e&&(i.app.command("EditCollaborationRoom").execute(i.viewModel.roomId.get(),n),i.deleted.set(!0),i.app.viewManager.deactivateView(i))})}},o.prototype.delayedValidate=function(){var e=this;this._validationActive.set(!0),this.viewModel.validated.set(!1),clearTimeout(this._validationTimer),this._validationTimer=setTimeout(function(){return e.validate()},500)},o.prototype.validate=function(){var e=this;if(this._validationActive.get()){if(this.viewModel.validated.set(!1),this.viewModel.verificationError.set(""),!this.viewModel.displayName.get().trim())return void this.viewModel.verificationError.set(this.app.getResource(this.libraryId,"language-collaboration-room-menu-edit-room-no-name"));if(this.viewModel.mode.equals("create")||!this.viewModel.displayName.equals(this.viewModel.originalName))return void this.app.command("VerifyRoomNameUnique").execute(this.viewModel.displayName.get(),function(t){t.unique?e.viewModel.validated.set(!0):e.viewModel.verificationError.set(e.app.getResource(e.libraryId,"language-collaboration-room-menu-edit-room-existing-name"))});this.viewModel.validated.set(!0)}},o}(i.ViewBase);o.EditRoomView=a})},"Mapping/modules/Collaboration/Rooms/EditRoomViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/documents/GrantEditorViewModel","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/ColorUtils","geocortex/framework/utils/utils"],function(t,o,i,n,a,r,s,l){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var c=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i.roomId=new n.Observable(""),i.mode=new n.Observable("create"),i.displayName=new n.Observable(""),i.isOwner=new n.Observable(!1),i.verificationError=new n.Observable(""),i.validated=new n.Observable(!1),i.savePromise=new n.Observable(Promise.resolve()),i.originalName="",i.dirty=!1,i.color=new n.Observable(new r.SymbolColor("#FFFFFF")),i.colorPicker={color:i.color},i.roomPanelId="roomPanel-".concat(l.alphaNumericToken()),i.grantEditorViewModel=new a.GrantEditorViewModel(e,"Mapping.Infrastructure"),i.grantEditorViewModel.initialize({editOwnership:!0}),i.displayName.bind(i,i.setDirty),i.color.bind(i,i.setDirty),i.grantEditorViewModel.monikers.bind(i,i.setDirty),i}return e(o,t),o.prototype.setDirty=function(){this.dirty=!0},o.prototype.loadRoom=function(e){var t=this;return e?(this.roomId.set(e.id),this.originalName=e.displayName.get(),this.mode.set("edit"),this.displayName.set(e.displayName.get()),this.color.set(new r.SymbolColor(e.color.get())),this.isOwner=e.isOwner,this.validated.set(!0)):(this.roomId.set(""),this.mode.set("create"),this.displayName.set(""),this.color.set(s.generateRandomColor()),this.validated.set(!1)),this.refresh().then(function(){t.dirty=!1})},o.prototype.saveRoom=function(){var e=this;this.roomId.get()?(this.app.command("EditCollaborationRoom").execute(this.roomId.get(),{displayName:this.displayName.get(),active:!0,color:this.color.get().toHex()}),this.savePromise.set(this._saveRoomGrants(this.roomId.get()))):this.app.command("CreateCollaborationRoom").execute({displayName:this.displayName.get(),active:!0,color:this.color.get().toHex()},function(t){var o=e.grantEditorViewModel.grants;e.savePromise.set(e.grantEditorViewModel.loadById(t.id).then(function(){e.grantEditorViewModel.document.grants=o}).then(function(){e._saveRoomGrants(t.id)})),e.app.command("AutoJoinCollaborationRoom").execute(t.id)})},o.prototype._saveRoomGrants=function(e){var t=this;return Promise.resolve(this.app.site.documentStore.updateById(e,this.grantEditorViewModel.document)).catch(function(e){t.app.trace.error("Error updating room grants: {0}".format(e.message),e)})},o.prototype.refresh=function(){return this.roomId.get()?this.grantEditorViewModel.loadById(this.roomId.get()):Promise.resolve(this.grantEditorViewModel.reset())},o}(i.ViewModelBase);o.EditRoomViewModel=c})},"Mapping/modules/Collaboration/Rooms/Room":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.displayName=new o.Observable(""),this.color=new o.Observable("#333333"),this.members=new o.Observable(0),this.memberNames=new o.ObservableCollection,this.joined=new o.Observable(!1),this.selected=new o.Observable(!1),this.isOwner=new o.Observable(!1),this.isContributor=!1,this.isNew=new o.Observable(!1),this.id=e.id,this.displayName.set(e.displayName),this.active=e.active,this.isGlobal=e.global,this.color.set(e.color),this.isOwner.set(e.isOwner),this.isContributor=e.isContributor,this.created=e.created,this.createdBy=e.createdBy,this.selected.sync(this.joined)}return e.prototype.equals=function(e){return this.id===e.id&&this.displayName.get()===e.displayName&&this.color.get()===e.color&&this.isGlobal===e.global&&this.active===e.active&&this.isContributor===e.isContributor&&this.isOwner.get()===e.isOwner&&this.created===e.created&&this.createdBy===e.createdBy},e.prototype.toRestObject=function(){return{id:this.id,displayName:this.displayName.get(),color:this.color.get(),global:this.isGlobal,active:this.active,isContributor:this.isContributor,isOwner:this.isOwner.get(),created:this.created,createdBy:this.createdBy}},e}();t.Room=i})},"Mapping/modules/Collaboration/Rooms/RoomDetailsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./EditRoomViewModel","geocortex/infrastructure/DateFormat","geocortex/infrastructure/FormatUtils"],function(t,o,i,n,a,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(e,o){var i=t.call(this,e,o)||this;i._memberNamesToken="",i.editRoomMenu=i.app.viewManager.createView({title:i.app.getResource(i.libraryId,"language-collaboration-room-menu-edit-room-title"),typeName:"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.EditRoomView",markupResource:"Mapping/modules/Collaboration/Rooms/EditRoomView.html",isVisible:!1,libraryId:i.libraryId,regionName:i.app.configuration.mobileMode?"ModalWindowRegion":"CollaborationContainerRegion"});var a=new n.EditRoomViewModel(i.app,i.libraryId);return i.editRoomMenu.attach(a),i.editRoomMenu.deleted.bind(i,function(e){e&&i.exit()}),i}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e)},o.prototype.loadRoom=function(e){var t=this;this._removeSyncs(),this.viewModel.room=e,this.viewModel.displayName.sync(this.viewModel.room.displayName),this.viewModel.color.sync(this.viewModel.room.color),this.viewModel.joined.sync(this.viewModel.room.joined),this.viewModel.createdBy.set(this.viewModel.room.createdBy);var o={timeZoneId:"",displayTimeZoneId:this.app.site.displayTimeZoneId||""};this.viewModel.created.set(r.formatDate(new Date(Date.parse(this.viewModel.room.created)),a.DateFormat.DEFAULT,o)),this.viewModel.members.sync(this.viewModel.room.members),this.viewModel.memberNames.set(this.viewModel.room.memberNames.get()),this._memberNamesToken=this.viewModel.room.memberNames.bind(this,function(e){switch(e.type){case"remove":t.viewModel.memberNames.removeRange(e.rangeStart,e.rangeEnd);break;case"clear":t.viewModel.memberNames.clear();break;default:t.viewModel.memberNames.set(t.viewModel.room.memberNames.get())}}),this.viewModel.canEdit.syncTransform(this.viewModel.room.isOwner,function(e){return!t.viewModel.readOnly.get()&&e})},o.prototype._removeSyncs=function(){this.viewModel.displayName.removeSync(),this.viewModel.color.removeSync(),this.viewModel.joined.removeSync(),this.viewModel.members.removeSync(),this.viewModel.memberNames.unbind(this._memberNamesToken),this.viewModel.canEdit.removeSync()},o.prototype.exit=function(){this._removeSyncs(),this.app.viewManager.deactivateView(this)},o.prototype.handleEditClicked=function(e,t,o){var i=this;this.editRoomMenu.loadRoom(this.viewModel.room).then(function(){return i.app.viewManager.activateView(i.editRoomMenu)})},o.prototype.handleCloseClicked=function(e,t,o){this.exit()},o}(i.ViewBase);o.RoomDetailsView=s})},"Mapping/modules/Collaboration/Rooms/RoomDetailsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.room=null,e.readOnly=new n.Observable(!1),e.canEdit=new n.Observable(!1),e.displayName=new n.Observable(""),e.color=new n.Observable(""),e.joined=new n.Observable(!1),e.createdBy=new n.Observable(""),e.created=new n.Observable(""),e.members=new n.Observable(0),e.memberNames=new n.ObservableCollection,e}return e(o,t),o}(i.ViewModelBase);o.RoomDetailsViewModel=a})},"Mapping/modules/Collaboration/Views/BaseCollaborationView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/ArrayUtils"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._currentScroll=0,e}return e(o,t),o.prototype.handleSignInClick=function(e,t,o){this.app.command("SignIn").execute(null)},o.prototype.resolveWidget=function(e,t,o){var i=this;switch(e){case"EventWidget":var a=t,r=n.firstOrDefault(this.viewModel.eventTypes,function(e){return e.name===a.event.type}).widget,s=this.app.viewManager.createView({typeName:r.typeName,markupResource:r.markup,isVisible:!0,libraryId:r.libraryId});return a.initialize(r.configuration),a.loadEvent(),s.attach(a),a.onDestroy=function(){i.app.viewManager.destroyView(s)},s;default:return null}},o}(i.ViewBase);o.BaseCollaborationView=a})},"Mapping/modules/Collaboration/Views/BaseCollaborationViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","../RestHandler","geocortex/framework/config/WidgetConfig","geocortex/framework/utils/ArrayUtils","../GraphicsManager","geocortex/infrastructure/webSocket/WebSocketConnection"],function(t,o,i,n,a,r,s,l,c){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var d=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i.eventTypes=[],i.rooms=new n.ObservableCollection([]),i.events=new n.ObservableCollection([]),i.selectedRooms=new n.ObservableCollection([]),i.autoJoinList=new n.ObservableCollection,i.active=new n.Observable(!1),i.signedIn=new n.Observable(!1),i.connected=new n.Observable(!1),i.supported=new n.Observable(!1),i.enabled=new n.Observable(!1),i.defaultEventType=null,i._config=null,i._restHandler=null,i._graphicsManager=null,i._applicationScope=null,i}return e(o,t),o.prototype.initialize=function(e){var o=this;t.prototype.initialize.call(this,e),this._config=e,this.enabled.set(e.enabled),this.app.waitUntilSiteInitialized().then(function(){return o._siteInitialized(e)}),this.events.bind(this,this._handleEventsChanged)},o.prototype._handleEventsChanged=function(e){switch(e.type){case"clear":case"remove":for(var t=this.events.getRange(e.rangeStart,e.rangeEnd),o=t.length-1;o>=0;o--)t[o].unloadEvent(),t[o].destroy()}},o.prototype.selectRooms=function(e){},o.prototype._clearEvents=function(){this.events.clear(),this.app.command("ClearCollaborationFeatures").execute()},o.prototype._siteInitialized=function(e){var t=this;if(this.supported.set(this.app.site.getEssentialsVersion()>=4.07),this.enabled.get())if(this.supported.get()||this.app.trace.warning("Warning: Your version of essentials is older than 4.7, Collaboration cannot function."),this.active.set(this.supported.get()&&this.enabled.get()),c.WebSocketConnection.hasBrowserSupport()||(this.active.set(!1),this.app.trace.warning("Warning: browser does not support WebSocket. Collaboration cannot function.")),this.supported.get()){var o=a.RestHandler.getCollaborationServiceUrl(this.app);if(!e.restEndpoint&&!o)throw this.active.set(!1),new Error("Failed to initialize: no suitable rest endpoint found.");if(this._restHandler=new a.RestHandler(this.app,e.restEndpoint||o),e.applicationId?this._applicationScope=e.applicationId:this._applicationScope=this.app.site.id,this._graphicsManager=new l.GraphicsManager(this.app,this._restHandler),e.icons.photoIcon&&e.icons.photoIcon.iconUrl){var i=new esri.symbol.PictureMarkerSymbol(e.icons.photoIcon.iconUrl,e.icons.photoIcon.width||0,e.icons.photoIcon.height||0);i.setOffset(e.icons.photoIcon.offsetX||0,e.icons.photoIcon.offsetY||0),this._graphicsManager.postedImageSymbol=i}if(!e.eventTypes||!Array.isArray(e.eventTypes))throw this.active.set(!1),new Error("No Event Types defined in configuration, Collaboration View Model can't initialize.");e.eventTypes.forEach(function(o){if(o.widgetId){var i=void 0;if(!e.eventWidgets||!Array.isArray(e.eventWidgets))throw new Error("Event Widget: "+o.widgetId+" not defined in configuration, Collaboration View Model can't initialize.");var n=s.firstOrDefault(e.eventWidgets,function(e){return o.widgetId===e.id});(i=new r.WidgetConfig(n.id,n.libraryId)).typeName=n.type||"geocortex.framework.ui.ViewBase",i.viewModelType=n.viewModelType||"geocortex.framework.ui.ViewModelBase",i.markup=n.markup||null,i.configuration=n.configuration||null;var a={name:o.name,widget:i,visible:o.visible,automatic:o.automatic};t.eventTypes.push(a),o.default&&(t.defaultEventType=a)}else t.app.trace.warning("No widgetId property found for event name: {0}".format(o.name||"no name defined"))}),this.app.site.principal.isAuthenticated?this.signedIn.set(!0):this.active.set(!1),this.active.get()&&this.app.event("CollaborationInitializedEvent").publish(),this.autoJoinList.set(e.initialRooms||[]),this.autoJoinList.bind(this,function(e){switch(e.type){case"append":case"insert":case"set":var o=[];t.autoJoinList.getRange(e.rangeStart,e.rangeEnd).forEach(function(e){t.rooms.get().forEach(function(i){i.id===e&&(t.selectedRooms.contains(i)||o.push(i),t.autoJoinList.removeItem(e))})}),o.length>0&&t.selectRooms(t.selectedRooms.get().concat(o))}})}else this.app.trace.warning("Failed to initialize Collaboration: Geocortex Essentials version 4.7 or higher is requred for Collaboration to function.")},o.prototype._addEvents=function(e,t){var o=this;void 0===t&&(t=!1);var i=[],n=[];e.forEach(function(e){var t=o._findRoom(e.roomId);if(t){var a=s.firstOrDefault(o.eventTypes,function(t){return t.name===e.type}).widget,r=o.app.instantiateFrameworkObject(a.viewModelType,a.libraryId);r.event=e,r.room={id:t.id,displayName:t.displayName.get(),color:t.color.get(),active:t.active,global:t.isGlobal,isOwner:t.isOwner.get(),isContributor:t.isContributor,created:t.created,createdBy:t.createdBy},o._findEvent(r.event.id)?n.push(r):i.push(r)}}),t?this.events.addItems(i):this.events.insertItems(0,i.reverse()),n.forEach(function(e){var t=o._findEvent(e.event.id);t.unloadEvent();var i=o.events.indexOf(t);i>-1&&(o.events.removeAt(i),o.events.insertItem(i,e))})},o.prototype._findRoom=function(e){return s.firstOrDefault(this.rooms.get(),function(t){return t.id===e})},o.prototype._findEvent=function(e){return s.firstOrDefault(this.events.get(),function(t){return t.event.id===e})},o}(i.ViewModelBase);o.BaseCollaborationViewModel=d})},"Mapping/modules/Collaboration/Events/BannerEvent/BannerEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BaseEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e)},o.prototype.handleClick=function(e,t,o){this.viewModel.onClick()},o}(i.BaseEventView);o.BannerEventView=n})},"Mapping/modules/Collaboration/Events/BannerEvent/BannerEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","../BaseEventViewModel"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.bannerText=new i.Observable(""),e.bannerTitle=new i.Observable(""),e}return e(o,t),o.prototype._formatName=function(e){return-1===e.lastIndexOf("(")?e.trim():e.slice(0,e.lastIndexOf("(")).trim()},o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.bannerText.set(this.app.getResource(this.libraryId,"language-collaboration-no-event-content")),this.bannerTitle.set(this.created.get())},o}(n.BaseEventViewModel);o.BannerEventViewModel=a})},"Mapping/modules/Collaboration/Events/CardEvent/CardEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BaseEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.toggleSync=!1,e}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e)},o.prototype.handleClick=function(e,t,o){this.viewModel.onClick()},o.prototype.resolveWidget=function(e,o,i){var n=this;switch(e){case"EventActionsWidget":return this.menuView=this.app.menuRegistry.createMenuWidget(this,o,i),this.viewModel.menuEnabled.syncTransform(this.menuView.viewModel.hasExecutableMenuItems,function(){return n._isMenuEnabled()}),this.menuView;case"EventContentWidget":return this.contentWidget=this.app.viewManager.createView({markupResource:this.viewModel.contentWidgetMarkup,libraryId:this.libraryId,isVisible:!0}),this.contentWidget.parentView=this,this.contentWidget.attach(o),this.contentWidget}return t.prototype.resolveWidget.call(this,e,o,i)},o.prototype.toggleEventMenu=function(e,t,o){var i=this;if(this.viewModel.menuVisible.get())this.viewModel.menuVisible.set(!1),this.app.event("FlyoutDeactivated").publish(this);else if(this.viewModel.menuVisible.set(!0),this.app.event("FlyoutActivated").publish(this),this.app.configuration.mobileMode){this.app.event("_closeCollaborationEventContextMenu").publish(this.id);var n=this.app.event("_closeCollaborationEventContextMenu").subscribe(this,function(e){i.id!==e&&(i.viewModel.menuVisible.set(!1),i.app.event("FlyoutDeactivated").publish(i),i.app.event("_closeCollaborationEventContextMenu").unsubscribe(n))})}else{var a={view:this.menuView,onOtherInteracted:function(e){e.srcElement!==t&&(i.viewModel.menuVisible.set(!1),i.app.event("FlyoutDeactivated").publish(i))}};this.app.command("TapToDismiss").execute(a)}},o.prototype._isMenuEnabled=function(){return this.menuView.viewModel.hasExecutableMenuItems.get()},o.prototype.destroy=function(){t.prototype.destroy.call(this),this.menuView&&(this.menuView.viewModel.destroy(),delete this.menuView.viewModel,this.app.viewManager.destroyView(this.menuView),delete this.menuView),this.contentWidget&&(delete this.contentWidget.viewModel,this.app.viewManager.destroyView(this.contentWidget),delete this.contentWidget.parentView,delete this.contentWidget)},o}(i.BaseEventView);o.CardEventView=n})},"Mapping/modules/Collaboration/Events/CardEvent/CardEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","../BaseEventViewModel"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.clickable=new i.Observable(!1),e.isLoading=new i.Observable(!1),e.isOwner=new i.Observable(!1),e.explainerText=new i.Observable(e.app.getResource(e.libraryId,"language-collaboration-default-event-explainer")),e.menuVisible=new i.Observable(!1),e.menuEnabled=new i.Observable(!1),e.contentWidgetMarkup="Mapping/modules/Collaboration/EventsCardEvent/CardEventContentView.html",e}return e(o,t),o.prototype._formatName=function(e){return this.isOwner.get()?this.app.getResource(this.libraryId,"language-collaboration-event-owner-label"):t.prototype._formatName.call(this,e)},o.prototype.loadEvent=function(){var e=this;t.prototype.loadEvent.call(this),this.isLoading.set(!0),this.isOwner.set(this.event.isOwner),this.explainerText.set(this.explainerText.get().format(this.roomDisplayName.get())),setTimeout(function(){e.isLoading.set(!1)},1e3)},o}(n.BaseEventViewModel);o.CardEventViewModel=a})},"Mapping/modules/Collaboration/Events/DeleteMarkupEvent/DeleteMarkupEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BannerEvent/BannerEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.BannerEventView);o.DeleteMarkupEventView=n})},"Mapping/modules/Collaboration/Events/DeleteMarkupEvent/DeleteMarkupEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BannerEvent/BannerEventViewModel"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.bannerText.set(this.app.getResource(this.libraryId,"language-collaboration-event-drawing-erased-notification").format(this.createdByPresentable.get(),this.roomDisplayName.get())),this.app.command("LoadCollaborationMarkupGraphics").execute(this.event)},o}(i.BannerEventViewModel);o.DeleteMarkupEventViewModel=n})},"Mapping/modules/Collaboration/Events/ImageEvent/ImageEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../MapEvent/MapEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.formElement=null,e.formTokenElement=null,e}return e(o,t),o.prototype.handleOpenFullClick=function(e,t,o){this.formTokenElement.value=this.app.site.principal.tokens.site,this.formElement.submit()},o.prototype.onPreviewLoaded=function(){this.app.event("CollaborationImageLoadedEvent").publish(this.viewModel.event)},o.prototype.destroy=function(){t.prototype.destroy.call(this),this.formElement&&delete this.formElement,this.formTokenElement&&delete this.formTokenElement},o}(i.MapEventView);o.ImageEventView=n})},"Mapping/modules/Collaboration/Events/ImageEvent/ImageEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","../MapEvent/MapEventViewModel","../../RestHandler"],function(t,o,i,n,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.previewUrl=new i.Observable(""),e.openUrl=new i.Observable(""),e._previewUrlTemplate="",e._fullUrlTemplate="",e.contentWidgetMarkup="Mapping/modules/Collaboration/Events/ImageEvent/ImageEventContentView.html",e}return e(o,t),o.prototype.initialize=function(e){t.prototype.initialize.call(this,e);var o=a.RestHandler.getCollaborationServiceUrl(this.app);e&&(this._previewUrlTemplate=e.previewUrl||"{0}/{1}".format(o,"event/{0}/preview"),this._fullUrlTemplate=e.fullUrl||"{0}/{1}".format(o,"event/{0}/open"))},o.prototype.onClick=function(){this.deleted.get()||this.app.command("HighlightCollaborationFeatures").execute(this.event.id)},o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.previewUrl.set("{0}?token={1}".format(this._previewUrlTemplate.format(this.event.id),this.app.site.principal.tokens.site)),this.openUrl.set(this._fullUrlTemplate.format(this.event.id))},o}(n.MapEventViewModel);o.ImageEventViewModel=r})},"Mapping/modules/Collaboration/Events/MapEvent/MapEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../MessageEvent/MessageEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.resolveWidget=function(e,o,i){var n=this,a=t.prototype.resolveWidget.call(this,e,o,i);switch(e){case"EventActionsWidget":this.viewModel.menuEnabled.syncTransform(this.viewModel.deleted,function(){return n._isMenuEnabled()})}return a},o.prototype._isMenuEnabled=function(){return t.prototype._isMenuEnabled.call(this)&&!this.viewModel.deleted.get()},o}(i.MessageEventView);o.MapEventView=n})},"Mapping/modules/Collaboration/Events/MapEvent/MapEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../MessageEvent/MessageEventViewModel","geocortex/framework/observables"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.deleted=new n.Observable(!1),e._deleteToken="",e}return e(o,t),o.prototype.loadEvent=function(){var e=this;t.prototype.loadEvent.call(this),this._deleteToken=this.app.event("CollaborationMapEventDeletedEvent").subscribe(this,function(t){t===e.event.id&&(e.app.event("CollaborationMapEventDeletedEvent").unsubscribe(e._deleteToken),e.onDelete())}),this.app.command("LoadCollaborationMarkupGraphics").execute(this.event)},o.prototype.unloadEvent=function(){t.prototype.unloadEvent.call(this),this.app.command("RemoveCollaborationFeatures").execute(this.event.id)},o.prototype.onDelete=function(){this.deleted.set(!0),this.clickable.set(!1)},o}(i.MessageEventViewModel);o.MapEventViewModel=a})},"Mapping/modules/Collaboration/Events/MessageEvent/MessageEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../CardEvent/CardEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.CardEventView);o.MessageEventView=n})},"Mapping/modules/Collaboration/Events/MessageEvent/MessageEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","../CardEvent/CardEventViewModel"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.text=new i.Observable(""),e.contentWidgetMarkup="Mapping/modules/Collaboration/Events/MessageEvent/MessageEventContentView.html",e}return e(o,t),o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.text.set(this.event.data.message)},o}(n.CardEventViewModel);o.MessageEventViewModel=a})},"Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../MapEvent/MapEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.MapEventView);o.ShareMarkupEventView=n})},"Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","../MapEvent/MapEventViewModel"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.contentWidgetMarkup="Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventContentView.html",e.previewIcon=new i.Observable(""),e.activeIcon="",e.deletedIcon="",e}return e(o,t),o.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&e.icons&&(this.activeIcon=e.icons.active||"Resources/Images/Icons/edit-markup-inactive-24.png",this.deletedIcon=e.icons.deleted||"Resources/Images/Icons/close-24.png")},o.prototype.onClick=function(){this.deleted.get()||this.app.command("HighlightCollaborationFeatures").execute(this.event.id)},o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.deleted.get()?this.previewIcon.set(this.deletedIcon):this.previewIcon.set(this.activeIcon)},o.prototype.onDelete=function(){t.prototype.onDelete.call(this),this.previewIcon.set(this.deletedIcon)},o}(n.MapEventViewModel);o.ShareMarkupEventViewModel=a})},"Mapping/modules/Collaboration/Events/UserJoinedEvent/UserJoinedEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BannerEvent/BannerEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.BannerEventView);o.UserJoinedEventView=n})},"Mapping/modules/Collaboration/Events/UserJoinedEvent/UserJoinedEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BannerEvent/BannerEventViewModel"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.bannerText.set(this.app.getResource(this.libraryId,"language-collaboration-event-user-joined").format(this.createdByPresentable.get(),this.roomDisplayName.get()))},o}(i.BannerEventViewModel);o.UserJoinedEventViewModel=n})},"Mapping/modules/Collaboration/Events/UserLeftEvent/UserLeftEventView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BannerEvent/BannerEventView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.BannerEventView);o.UserLeftEventView=n})},"Mapping/modules/Collaboration/Events/UserLeftEvent/UserLeftEventViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BannerEvent/BannerEventViewModel"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.loadEvent=function(){t.prototype.loadEvent.call(this),this.bannerText.set(this.app.getResource(this.libraryId,"language-collaboration-event-user-left").format(this.createdByPresentable.get(),this.roomDisplayName.get()))},o}(i.BannerEventViewModel);o.UserLeftEventViewModel=n})},"Mapping/modules/Collaboration/Views/AfterAction/AfterActionSelectorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../Collaboration/CollaborationSelectorView"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i.roomDetailsMenu.viewModel.readOnly.set(!0),i}return e(o,t),o.prototype.handleCreateClicked=function(e,t,o){},o}(i.CollaborationSelectorView);o.AfterActionSelectorView=n})},"Mapping/modules/Collaboration/Views/AfterAction/AfterActionView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework-ui/Selector/SelectorViewModel","../BaseCollaborationView"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._roomTokens={},e}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e),this.initialize()},o.prototype.initialize=function(){var e=this;this.viewModel.events.bind(this,this._scrollToBottom),this.viewModel.rooms.bind(this,this._processNewRooms),this.app.event("CollaborationImageLoadedEvent").subscribe(this,this._scrollToBottom),this.eventScroll.onscroll=function(){return e._handleEventFeedScroll()}},o.prototype.resolveWidget=function(e,o,n){var a=t.prototype.resolveWidget.call(this,e,o,n);if(a)return a;switch(e){case"Selector":return this._selectorView=this.app.viewManager.createView({viewId:"AfterActionSelectorView",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.AfterActionSelectorView",markupResource:"Mapping/modules/Collaboration/Views/AfterAction/AfterActionSelectorView.html",isVisible:!0,libraryId:this.libraryId}),this.selector=new i.SelectorViewModel(this.app,this.libraryId,!1,!1),this.selector.singleSelect=!1,this.selector.setCollection(this.viewModel.rooms,"displayName","Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorItemTemplate.html",this.libraryId),this.selector.selectorText.set(this.app.getResource(this.libraryId,"language-after-action-select-label")||this.app.getResource(this.libraryId,"language-integration-selector-text")),this.selector.noItemsText.set(this.app.getResource(this.libraryId,"language-collaboration-no-rooms")),this._selectorView.attach(this.selector),this._selectorView;default:return null}},o.prototype._handleEventFeedScroll=function(){this._currentScroll=this.eventScroll.offsetHeight+this.eventScroll.scrollTop-this.eventScroll.scrollHeight},o.prototype._scrollToBottom=function(){this._currentScroll>=-5&&(this.eventScroll.scrollTop=this.eventScroll.scrollHeight)},o.prototype._handleSelectionChange=function(e){var t=this;clearTimeout(this._selectTimer),this._selectTimer=setTimeout(function(){t.viewModel.selectRooms(t.selector.items.get().map(function(e){return e.item}).filter(function(e){return e.selected.get()}))},e?1e3:250)},o.prototype._processNewRooms=function(e){var t=this,o=this.viewModel.rooms.getRange(e.rangeStart,e.rangeEnd);-1!==["append","insert","set"].indexOf(e.type)&&o.forEach(function(e){t._roomTokens[e.id]&&e.selected.unbind(t._roomTokens[e.id]),t._roomTokens[e.id]=e.selected.bind(t,t._handleSelectionChange)})},o}(n.BaseCollaborationView);o.AfterActionView=a})},"Mapping/modules/Collaboration/Views/AfterAction/AfterActionViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","../BaseCollaborationViewModel","../../Rooms/Room"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this.app.command("OpenAfterActionPlayback").register(this,this._executeOpenAfterAction,this._canExecuteOpenAfterAction)},o.prototype._siteInitialized=function(e){var o=this;t.prototype._siteInitialized.call(this,e),this.active.get()&&(this._graphicsManager.readOnly=!0,this.app.event("MapTimeExtentChangedEvent").subscribe(this,this._handleMapTimeExtentChangedEvent),this.signedIn.get()&&this._fetchAllRooms().then(function(){o.connected.set(!0)}))},o.prototype.selectRooms=function(e){var t=this;e.sort(function(e,t){return e.id.localeCompare(t.id)});var o=this.selectedRooms.get().filter(function(t){return-1===e.indexOf(t)}).map(function(e){return e.id}),i=e.filter(function(e){return-1===t.selectedRooms.indexOf(e)}).map(function(e){return e.id});return o.length||i.length?(this.app.command("ClearCollaborationDrawings").execute(),this.selectedRooms.set(e),Promise.resolve(this._clearEvents()).then(function(){return t._open(e)}).catch(function(e){t.app.trace.error("Error during room selection: {0}.".format(e.message),e)})):Promise.resolve()},o.prototype._open=function(e){var t=this;if(!e.length)return Promise.resolve();e.forEach(function(e){return e.selected.set(!0)});var o={rooms:e.map(function(e){return e.id}),pageSize:1,activeRoomsOnly:!1,eventTypes:this.eventTypes.filter(function(e){return e.visible&&!e.automatic}).map(function(e){return e.name})};return this._restHandler.query(o).then(function(o){var i=e.slice().sort(function(e,t){return new Date(e.created).getTime()-new Date(t.created).getTime()});if(t._config.timeExtentExcludeRooms&&t._config.timeExtentExcludeRooms.forEach(function(e){var t=i.map(function(e){return e.id}).indexOf(e);t>-1&&i.splice(t,1)}),i.length){var n=i[0],a=o.events[0],r=new Date(n.created),s=t._config.timeExtentBufferRatio||.1,l=(new Date(a.created).getTime()-new Date(n.created).getTime())*s,c=new Date(r.getTime()-l),d=new Date(new Date(a.created).getTime()+l);t.app.command("SetTimeSliderProfile").execute({initialTimeExtent:{startTime:c.getTime(),endTime:r.getTime()},timeExtent:{startTime:c.getTime(),endTime:d.getTime()}})}else t.app.map.timeExtent&&t._handleMapTimeExtentChangedEvent(t.app.map.timeExtent)})},o.prototype._fetchAllRooms=function(){var e=this,t={applicationId:this._applicationScope,activeRoomsOnly:!1};return this._restHandler.getRooms(t).then(function(t){if(!(t&&t instanceof Array))return Promise.reject("Received invalid response from room query.");(t=t.filter(function(e){return e&&e.id})).forEach(function(t){var o=new n.Room(t);e.rooms.addItem(o)});var o=e.rooms.get().filter(function(t){return!!e.autoJoinList.get().some(function(e){return e===t.id})&&(e.autoJoinList.removeItem(t.id),t.selected.set(!0),!0)});return e.selectRooms(o)}).catch(function(t){e.app.trace.error("Failed to retrieve room list from REST endpoint: {0}".format(t.message),t)})},o.prototype._handleMapTimeExtentChangedEvent=function(e){var t=this;if(this.selectedRooms.get().map(function(e){return e.id}).length){var o=e.startTime,i=e.endTime,n={rooms:this.selectedRooms.get().map(function(e){return e.id}),dateRange:{start:o,end:i},eventTypes:this.eventTypes.filter(function(e){return e.visible&&!e.automatic}).map(function(e){return e.name}),pageSize:1e3};this._restHandler.query(n).then(function(e){t._clearEvents(),t._addEvents(e.events)})}},o.prototype._executeOpenAfterAction=function(){this.app.command("ActivateView").execute("AfterActionView")},o.prototype._canExecuteOpenAfterAction=function(){return this.enabled.get()},o}(i.BaseCollaborationViewModel);o.AfterActionViewModel=a})},"Mapping/modules/Collaboration/Views/Collaboration/CollaborationMarkupStyleSelectorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/infrastructure/tools/DrawMode","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbolEditorViewModel","geocortex/infrastructure/SymbolUtils"],function(t,o,i,n,a,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._markupManager=null,e._originalSymbol=null,e}return e(o,t),o.prototype.attach=function(e){var o=this;t.prototype.attach.call(this,e),this.symbolEditorWidget.onChange=function(e){o.viewModel.getMarkupManager().setCurrentSymbol(e)}},o.prototype.activated=function(){t.prototype.activated.call(this),this._originalSymbol=this.viewModel.getMarkupManager().currentSymbol,this.loadSymbol(this._originalSymbol)},o.prototype.resolveWidget=function(e,o){if("SymbolEditor"===e){this.symbolEditorWidget=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.SymbolEditorView",markupResource:"Mapping/infrastructure/symbology/SymbolEditorView.html",isVisible:!0,libraryId:"Mapping.Infrastructure"});var i=new a.SymbolEditorViewModel(this.app,"Mapping.Infrastructure");return this.symbolEditorWidget.attach(i),this.symbolEditorWidget}return t.prototype.resolveWidget.call(this,e,o)},o.prototype.loadSymbol=function(e){var t=this.viewModel.getMarkupManager().drawingToolSelectedType.get().drawMode;switch(t){case i.DrawMode.POINT:this.symbolEditorWidget.setFromSymbol(e||r.defaultMarkerSymbol());break;case i.DrawMode.FREEHAND_POLYLINE:case i.DrawMode.LINE:case i.DrawMode.POLYLINE:this.symbolEditorWidget.setFromSymbol(e||r.defaultLineSymbol());break;case i.DrawMode.POLYGON:case i.DrawMode.FREEHAND_POLYGON:case i.DrawMode.CIRCLE:case i.DrawMode.ELLIPSE:case i.DrawMode.RECTANGLE:case i.DrawMode.EXTENT:this.symbolEditorWidget.setFromSymbol(e||r.defaultFillSymbol());break;default:throw new Error("Symbol for draw mode {0} not supported by the picker.".format(t))}},o.prototype.doneClicked=function(){this.app.viewManager.deactivateView(this)},o.prototype.revertClicked=function(){this.loadSymbol(this._originalSymbol)},o}(n.ViewBase);o.CollaborationMarkupStyleSelectorView=s})},"Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework-ui/Selector/SelectorView","../../Rooms/RoomDetailsViewModel","../../Rooms/EditRoomViewModel"],function(t,o,i,n,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){function o(e,o){var i=t.call(this,e,o)||this,r=i.app.configuration.mobileMode?"ModalWindowRegion":"CollaborationContainerRegion";i.roomDetailsMenu=i.app.viewManager.createView({title:i.app.getResource(i.libraryId,"language-collaboration-room-details-menu-title"),typeName:"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.RoomDetailsView",markupResource:"Mapping/modules/Collaboration/Rooms/RoomDetailsView.html",isVisible:!1,libraryId:i.libraryId,regionName:r});var s=new n.RoomDetailsViewModel(i.app,i.libraryId);i.roomDetailsMenu.attach(s),i.createRoomMenu=i.app.viewManager.createView({title:i.app.getResource(i.libraryId,"language-collaboration-room-menu-create-room-title"),typeName:"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.EditRoomView",markupResource:"Mapping/modules/Collaboration/Rooms/EditRoomView.html",isVisible:!1,libraryId:i.libraryId,regionName:r});var l=new a.EditRoomViewModel(i.app,i.libraryId);return i.createRoomMenu.attach(l),i}return e(o,t),o.prototype.handleShowDetailsClicked=function(e,t,o){this.roomDetailsMenu.loadRoom(o),this.app.viewManager.activateView(this.roomDetailsMenu)},o.prototype.handleCreateClicked=function(e,t,o){var i=this;this.createRoomMenu.loadRoom().then(function(){return i.app.viewManager.activateView(i.createRoomMenu)})},o}(i.SelectorView);o.CollaborationSelectorView=r})},"Mapping/modules/Collaboration/Views/Collaboration/CollaborationView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","geocortex/framework-ui/Selector/SelectorViewModel","../BaseCollaborationView","geocortex/essentials/utilities/ImageUtilities"],function(t,o,i,n,a,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._unread=0,e._defaultSelectorText=e.app.getResource(e.libraryId,"language-collaboration-select-label")||e.app.getResource(e.libraryId,"language-integration-selector-text"),e._roomTokens={},e}return e(o,t),o.prototype.attach=function(e){e&&(t.prototype.attach.call(this,e),this.initialize())},o.prototype.initialize=function(){var e=this;this.viewModel.events.bind(this,this._processNewEvents),this.viewModel.rooms.bind(this,this._processNewRooms),this.viewModel.selectedDrawingTool.bind(this,this._handleToolChange),this.viewModel.flyoutVisible.bind(this,this._handleFlyoutChange),this.viewModel.postType.bind(this,this._resetFilePicker),this.app.event("CollaborationImageLoadedEvent").subscribe(this,this._scrollToBottom),this.eventScroll.onscroll=function(){return e._handleEventFeedScroll()}},o.prototype._processNewEvents=function(e){var t=this;if(!this._scrollToBottom()&&!this.viewModel.isLoadingEvents.get()&&-1!==["append","insert","set"].indexOf(e.type)){var o=this.viewModel.events.getRange(e.rangeStart,e.rangeEnd).filter(function(e){return!t.viewModel.eventTypes.some(function(t){return t.name===e.event.type&&t.automatic})&&!e.event.isOwner}).length;o&&(this._unread+=o,this._unread<1e4?1===this._unread?this.viewModel.unreadEventsMessage.set(this.app.getResource(this.libraryId,"language-collaboration-unread-events-notification-one-post")):this.viewModel.unreadEventsMessage.set(this.app.getResource(this.libraryId,"language-collaboration-unread-events-notification-numbered").format(this._unread)):this.viewModel.unreadEventsMessage.set(this.app.getResource(this.libraryId,"language-collaboration-unread-events-notification")))}},o.prototype._processNewRooms=function(e){var t=this,o=this.viewModel.rooms.getRange(e.rangeStart,e.rangeEnd);-1!==["append","insert","set"].indexOf(e.type)&&(o.forEach(function(e){t._roomTokens[e.id]&&e.selected.unbind(t._roomTokens[e.id]),t._roomTokens[e.id]=e.selected.bind(t,t._handleSelectionChange)}),o.some(function(e){return e.isNew.get()&&!e.isOwner.get()})&&(this.viewModel.hasNewRooms.set(!0),this.viewModel.newRooms+=1,1===this.viewModel.newRooms?this.viewModel.numberNewRooms.set(this.app.getResource(this.libraryId,"language-collaboration-one-new-room-notification")):this.viewModel.numberNewRooms.set(this.app.getResource(this.libraryId,"language-collaboration-new-room-notification").format(this.viewModel.newRooms.toString()))))},o.prototype.resolveWidget=function(e,o,a){var r=this,s=t.prototype.resolveWidget.call(this,e,o,a);if(s)return s;switch(e){case"Selector":return this._selectorView=this.app.viewManager.createView({viewId:"CollaborationSelectorView",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.CollaborationSelectorView",markupResource:"Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorView.html",isVisible:!0,libraryId:this.libraryId}),this.selector=new n.SelectorViewModel(this.app,this.libraryId,!1,!1),this.selector.singleSelect=!1,this.selector.setCollection(this.viewModel.rooms,"displayName","Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorItemTemplate.html",this.libraryId),this.selector.selectorText.set(this._defaultSelectorText),this.selector.noItemsText.set(this.app.getResource(this.libraryId,"language-collaboration-no-rooms")),this.selector.openState.bind(this,function(e){e?r.setControlsMinimized(!0):(r.selector.items.get().forEach(function(e){return e.item.isNew.set(!1)}),r.viewModel.hasNewRooms.set(!1),r.viewModel.newRooms=0,r.viewModel.numberNewRooms.set(""))}),this._selectorView.attach(this.selector),this._selectorView;case"FilePickerWidget":var l=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Forms.FilePickerFormItemView",markupResource:"Mapping/modules/Collaboration/Views/Collaboration/CollaborationFilePicker.html",isVisible:!0,libraryId:"Mapping.Infrastructure"});return l.parentView=this,this.viewModel.filePickerWidgetModel.acceptFileTypes=new i.Observable("image/*"),this.viewModel.filePickerWidgetModel.allowMultiple=new i.Observable(!1),this.viewModel.filePickerWidgetModel.toolTip=new i.Observable(this.app.getResource(this.libraryId,"language-collaboration-event-file-upload-tooltip")),l.attach(this.viewModel.filePickerWidgetModel),this.viewModel.filePickerWidgetModel.files.bind(this,this._refreshPreviewImage),l;case"ToolFlyoutWidget":return this._toolSelectorWidget=this.app.viewManager.createView({typeName:"geocortex.framework.ui.ViewBase",markupResource:"Mapping/modules/Collaboration/Views/Collaboration/CollaborationDrawingToolFlyoutView.html",isVisible:!0,libraryId:this.libraryId}),this._toolSelectorWidget.parentView=this,this._toolSelectorWidget.attach(this.viewModel),this._toolSelectorWidget;default:return null}},o.prototype.setControlsMinimized=function(e){this.app.configuration.mobileMode&&(!e&&this.selector.openState.get()&&this.selector.openState.set(!1),this.viewModel.controlsMinimized.set(e))},o.prototype._handleSelectionChange=function(e){var t=this;clearTimeout(this._selectTimer),this._selectTimer=setTimeout(function(){t.viewModel.selectRooms(t.selector.items.get().map(function(e){return e.item}).filter(function(e){return e.selected.get()}))},e?1e3:250)},o.prototype._calculateScroll=function(){return this.eventScroll.offsetHeight+this.eventScroll.scrollTop-this.eventScroll.scrollHeight},o.prototype._scrollToBottom=function(){return this._currentScroll>=-5&&(this.eventScroll.scrollTop=this.eventScroll.scrollHeight,!0)},o.prototype._handleEventFeedScroll=function(){if(!this.viewModel.isLoadingEvents.get()&&!this.viewModel.controlsMinimized.get()&&this.viewModel.postType.equals("none")&&!this.viewModel.sendEnabled.get()){var e=this._calculateScroll();e>this._currentScroll&&e-this._currentScroll>10?this.setControlsMinimized(!0):e<this._currentScroll&&this._currentScroll-e>20&&this.setControlsMinimized(!0)}this._currentScroll=this._calculateScroll(),this._currentScroll>=-50&&(this.viewModel.unreadEventsMessage.set(""),this._unread=0)},o.prototype.handleKeyUp=function(e,t,o){(e.which?e.which:e.keyCode)!==dojo.keys.ENTER||e.altKey||e.shiftKey||!this.viewModel.sendEnabled.get()||this._sendMessage()},o.prototype.handleSendPressed=function(e,t,o){this._sendMessage()},o.prototype._sendMessage=function(){this.viewModel.sendEnabled.get()&&this.viewModel.sendEvent()},o.prototype.handleInput=function(e,t,o){t.scrollHeight>t.clientHeight?this.viewModel.moveClearButton.set(!0):this.viewModel.moveClearButton.set(!1)},o.prototype.handlePostingRoomSelector=function(e,t,o){e.stopPropagation()},o.prototype.handleEventFeedClick=function(e,t,o){this.selector.openState.get()&&this.selector.openState.set(!1)},o.prototype.handleNewRoomsNotificationClick=function(e,t,o){this.selector.openState.set(!0)},o.prototype.handleNotificationClick=function(e,t,o){this.viewModel.unreadEventsMessage.set(""),this._unread=0,this.eventScroll.scrollTop=this.eventScroll.scrollHeight},o.prototype.handleTextBarFocus=function(e,t,o){this.setControlsMinimized(!1)},o.prototype.handleAttachmentChange=function(e,t,o){var i=this;return this.viewModel.toolReadyToSend.get()&&!this.viewModel.postType.equals("none")?(this.viewModel.postType.lock(),new Promise(function(e,t){i.app.command("Confirm").execute(i.app.getResource(i.libraryId,"language-collaboration-clear-confirm-message"),i.app.getResource(i.libraryId,"language-collaboration-clear-confirm-title"),function(t){if(t){switch(i.viewModel.postType.get()){case"markup":i.app.command("ClearCollaborationDrawings").canExecute()&&i.app.command("ClearCollaborationDrawings").execute();break;case"image":i.viewModel.filePickerWidgetModel.clear(),i._resetFilePicker()}i.viewModel.postType.set("none"),e(!0)}e(!1)})}).then(function(e){i.viewModel.postType.unlock(),e?i.viewModel.postType.equals(t.value)?(i.viewModel.postType.set("none"),t.checked=!1):(i.viewModel.postType.set(t.value),t.checked=!0):t.checked=i.viewModel.postType.equals(t.value)}),!1):(this.viewModel.postType.equals(t.value)&&this.viewModel.postType.set("none"),!0)},o.prototype.handleGetHistoricalClicked=function(e,t,o){this.viewModel.getOlderEntries()},o.prototype.handleClearRoomNotification=function(e,t,o){this.viewModel.hasNewRooms.set(!1),this.viewModel.numberNewRooms.set("")},o.prototype.handleClearMessageNotification=function(e,t,o){this.viewModel.unreadEventsMessage.set("")},o.prototype.handleClearClicked=function(e,t,o){var i=this;this.viewModel.toolReadyToSend.get()?this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-collaboration-clear-confirm-message"),this.app.getResource(this.libraryId,"language-collaboration-clear-confirm-title"),function(e){if(e){switch(i.viewModel.postType.get()){case"markup":i.app.command("ClearCollaborationDrawings").canExecute()&&i.app.command("ClearCollaborationDrawings").execute();break;case"image":i.viewModel.filePickerWidgetModel.clear(),i._resetFilePicker()}i.viewModel.postType.set("none")}}):this.viewModel.postType.set("none")},o.prototype.handleManuallyLocateClick=function(){this.viewModel.toolActive.get()?this.app.command("ClearActiveTool").execute():this.viewModel.activateImageLocator()},o.prototype.handleToolbarItemClick=function(e,t,o){this.viewModel.toolActive.get()?this.app.command("ClearActiveTool").execute():this.viewModel.activateDrawingTool(o)},o.prototype.handleChangeToolFlyout=function(e,t,o){this.app.configuration.mobileMode?(this.app.command("ClearActiveTool").execute(),this.viewModel.selectedDrawingTool.set(o)):this.viewModel.activateDrawingTool(o)},o.prototype.handleToggleToolFlyout=function(e,t,o){var i=this;if(this.viewModel.flyoutVisible.set(!this.viewModel.flyoutVisible.get()),this.viewModel.flyoutVisible.get()){var n={view:this._toolSelectorWidget,onOtherInteracted:function(e){e.srcElement!==t&&i.viewModel.flyoutVisible.set(!1)}};this.app.command("TapToDismiss").execute(n)}},o.prototype._handleToolChange=function(e){this.viewModel.flyoutVisible.set(!1)},o.prototype._handleFlyoutChange=function(e){e?this.app.event("FlyoutActivated").publish(this):this.app.event("FlyoutDeactivated").publish(this)},o.prototype.handleDrawSymbologyClicked=function(e,t,o){this.app.command("ActivateView").execute("CollaborationMarkupStyleSelectorView")},o.prototype._resetFilePicker=function(){this.filePickerInput.value="",this.viewModel.filePickerWidgetModel.files.clear(),this.filePickerLabel.style.backgroundImage=""},o.prototype._refreshPreviewImage=function(e){var t=this,o=this.viewModel.filePickerWidgetModel.files.getAt(0);o&&"clear"!==e.type?r.resizeImageToMaxDimensions(o.getDataUri(),this.filePickerLabel.clientWidth,this.filePickerLabel.clientHeight).then(function(e){t.filePickerLabel.style.backgroundImage="url("+e+")"}):this.filePickerLabel.style.backgroundImage=""},o}(a.BaseCollaborationView);o.CollaborationView=s})},"Mapping/modules/Collaboration/Views/Collaboration/CollaborationViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","../../Rooms/Room","geocortex/forms/items/FilePickerFormItem","../../MarkupManager","../../RestHandler","geocortex/infrastructure/webSocket/WebSocketConnection","geocortex/essentials/utilities/ExifUtilities","geocortex/essentials/documents/DocumentConstants","geocortex/essentials/documents/BatchRequestBuilder","../BaseCollaborationViewModel","geocortex/essentials/utilities/UrlUtilities","geocortex/framework-ui/LazyObservable","geocortex/essentials/utilities/ImageUtilities"],function(t,o,i,n,a,r,s,l,c,d,p,u,g,b,m){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var h=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.entryText=new i.Observable(null),e.contributableRooms=new i.ObservableCollection([]),e.joinedCopyTargets=new i.ObservableCollection([]),e.unjoinedCopyTargets=new i.ObservableCollection([]),e.selectedCopyRoom=new i.Observable(null),e.singleRoomSelected=new i.Observable(!1),e.firstRoom=new i.Observable(""),e.postingRoom=new i.Observable(null),e.postingRoomColor=new i.Observable("#CCCCCC"),e.postType=new v("none"),e.textPost=new i.Observable(!0),e.typeCaption=new i.Observable(e.app.getResource(e.libraryId,"language-collaboration-event-type-caption-message")),e.hasMoreEvents=new i.Observable(!1),e.symbologyToolsAvailable=new i.Observable(!1),e.drawingToolsVisible=new i.Observable(!1),e.drawingTools=new i.ObservableCollection,e.selectedDrawingTool=new i.Observable,e.tools=new i.ObservableCollection,e.flyoutVisible=new i.Observable(!1),e.uploadToolsVisible=new i.Observable(!1),e.textEntryPlaceholder=new i.Observable(e.app.getResource(e.libraryId,"language-collaboration-chat-entry-placeholder")),e.toolReadyToSend=new b.LazyObservable(!1),e.toolActive=new i.Observable(!1),e.filePickerWidgetModel=new a.FilePickerFormItem(null),e.sendEnabled=new i.Observable(!1),e.characterLimit=new i.Observable,e.clearEnabled=new i.Observable(!1),e.moveClearButton=new i.Observable(!1),e.postTextColor=new i.Observable("#000000"),e.controlsMinimized=new i.Observable(!1),e.unreadEventsMessage=new i.Observable(""),e.hasNewRooms=new i.Observable(!1),e.numberNewRooms=new i.Observable(""),e.canManuallyLocate=new i.Observable(!1),e.isLoadingEvents=new i.Observable(!1),e.isSending=new i.Observable(!1),e.newRooms=0,e._markupManager=null,e._webSocket=null,e._reconnectionState=null,e._roomOwnerCanEditEvents=!1,e}return e(o,t),o.prototype.initialize=function(e){var o=this;t.prototype.initialize.call(this,e),this.app.command("OpenCollaboration").register(this,this._executeOpenCollaboration,this._canExecuteOpenCollaboration),this.app.command("CreateCollaborationImage").register(this,this._executeCreateCollaborationImage,this._canExecuteCreateCollaborationImage),this.active.bind(this,function(e){o.app.command("CreateCollaborationImage").raiseCanExecuteChanged()})},o.prototype._siteInitialized=function(e){var o=this;if(t.prototype._siteInitialized.call(this,e),this.active.get()){if(this.active.syncTransform(this.connected,function(){return o.supported.get()&&o.enabled.get()&&o.connected.get()}),this.app.event("WebSocketConnectedEvent").subscribe(this,this._handleWebSocketConnectionChanged),this.app.event("WebSocketDisconnectedEvent").subscribe(this,this._handleWebSocketConnectionChanged),this._webSocket=new l.WebSocketConnection(this.app),this._webSocket.isConnected.bind(this,function(e){e?o.app.event("WebSocketConnectedEvent").publish(o._webSocket):o.app.event("WebSocketDisconnectedEvent").publish(o._webSocket)}),this._markupManager=new r.MarkupManager(this.app,e.markupTools),e.icons.unpostedPhotoIcon&&e.icons.unpostedPhotoIcon.iconUrl){var i=new esri.symbol.PictureMarkerSymbol(e.icons.unpostedPhotoIcon.iconUrl,e.icons.unpostedPhotoIcon.width||0,e.icons.unpostedPhotoIcon.height||0);i.setOffset(e.icons.unpostedPhotoIcon.offsetX||0,e.icons.unpostedPhotoIcon.offsetY||0),this._markupManager.unpostedImageSymbol=i}this.postType.bind(this,this._postTypeChanged),this.selectedRooms.bind(this,this._handleSelectedRoomsChanged),this.filePickerWidgetModel.files.bind(this,this._handleUploadFileChanged),this.tools.set(this.app.toolRegistry.createTools(e.tools,!0)),this.selectedDrawingTool.bind(this,function(e){o._markupManager.drawingToolSelectedType.set(e)}),this.drawingTools.set(this.app.toolRegistry.createTools(e.markupTools,!0)),this._defaultDrawingTool=this.app.toolRegistry.createTools(e.markupTools.filter(function(e){return e.default}),!1)[0]||this.drawingTools.getAt(0),this.selectedDrawingTool.set(this._defaultDrawingTool),this.characterLimit.set(e.characterLimit||1e3),this.numEventsToFetch=e.numEventsToFetch||25,this.app.event("RoomInformationUpdateEvent").subscribe(this,this._handleRoomStatusChanged),this.app.event("RoomActivityEvent").subscribe(this,this._handleRoomEventAddedEvent),this.app.event("RoomsChangedEvent").subscribe(this,this._updateRooms),this.app.event("RoomJoinedConfirmationEvent").subscribe(this,function(){}),this.app.event("RoomLeaveConfirmationEvent").subscribe(this,function(){}),this.app.event("CollaboratorRegisteredEvent").subscribe(this,this._handleCollaboratorRegisteredEvent),this.app.command("WebSocketCommand").register(this,this._executeSendWebSocketCommand),this.app.command("CopyCollaborationEvent").register(this,this._executeCopyCollaborationEvent),this.app.command("ShowCopyDialogForEvent").register(this,this._executeShowCopyDialogForEvent,this._canExecuteShowCopyDialogForEvent),this.app.command("ShowEditCollaborationMessageView").register(this,this._executeShowEditCollaborationMessageView,this._canExecuteShowEditCollaborationMessageView),this.app.command("ShowEditCollaborationGraphicMessageView").register(this,this._executeShowEditCollaborationGraphicMessageView,this._canExecuteShowEditCollaborationGraphicMessageView),this.app.command("CreateCollaborationEvent").register(this,this._executeCreateCollaborationEvent),this.app.command("GetCollaborationEvent").register(this,this._executeGetCollaborationEvent),this.app.command("EditCollaborationEvent").register(this,this._executeEditCollaborationEvent,this._canExecuteEditCollaborationEvent),this.app.command("EditCollaborationRoom").register(this,this._executeEditCollaborationRoom),this.app.command("CreateCollaborationRoom").register(this,this._executeCreateCollaborationRoom),this.app.command("VerifyRoomNameUnique").register(this,this._executeVerifyRoomNameUnique),this.app.command("EraseMarkupEvent").register(this,this._executeEraseMarkupEvent,this._canExecuteEraseMarkupEvent),this.app.command("PushCollaborationRoom").register(this,this._executePushCollaborationRoom,this._canExecutePushCollaborationRoom),this.app.command("GetCollaborationRooms").register(this,this._executeGetCollaborationRooms,this._canExecuteGetCollaborationRooms),this.app.command("AutoJoinCollaborationRoom").register(this,this._executeAutoJoinCollaborationRoom),this.app.command("OpenEventFeatureImage").register(this,this._executeOpenEventFeatureImage,this._canExecuteOpenEventFeatureImage),this.app.event("ActiveToolChanged").subscribe(this,function(e){var t=e.tool,i=e.previousTool,n=o.drawingTools.contains(i)||o.tools.contains(i),a=o.drawingTools.contains(t)||o.tools.contains(t);null===t&&n&&o.app.configuration.mobileMode&&o.app.command("OpenDataFrame").execute(),a?o.toolActive.set(!0):o.toolActive.set(!1)}),this.entryText.bind(this,this._entryTextChanged),this.toolReadyToSend.bind(this,this._updateSendingEnabled),this.postingRoom.bind(this,this._updateSendingEnabled),this.postingRoom.bind(this,function(e){e&&o.postingRoomColor.sync(e.color)}),this.postTextColor.syncTransform(this.postingRoomColor,this._transformPostTextColor),this.entryText.bind(this,this._updateClearEnabled),this.filePickerWidgetModel.files.bind(this,this._updateClearEnabled),this._markupManager.toolReady.bind(this,this._updateClearEnabled),this.contributableRooms.bind(this,function(e){o.contributableRooms.length?o.controlsMinimized.set(o.app.configuration.mobileMode):o.controlsMinimized.set(!1)});var n=e.webSocketUrl||this._getWebsocketUrl();this._webSocket.connect(n)}},o.prototype.sendEvent=function(){var e=this;return new Promise(function(t,o){var i={roomId:e.postingRoom.get().id},n=e.entryText.get();switch(e.postType.get()){case"markup":var a=e._markupManager.getFeaturesFromDrawingsLayer();i.data={markup:{points:a.points.toJson(),polylines:a.polylines.toJson(),polygons:a.polygons.toJson(),rectangles:a.rectangles.toJson()},message:n},i.type="ShareMarkupEvent",e.app.command("ClearCollaborationDrawings").execute(),e.app.command("CreateCollaborationEvent").execute(i),e.app.command("ClearActiveTool").execute(),t();break;case"image":var r=e.filePickerWidgetModel.files.getAt(0),s=e._markupManager.getPhotoLocation().toJson();e._executeCreateCollaborationImage({file:r,location:s,message:n,roomId:e.postingRoom.get().id}).then(function(){return t()}).catch(function(e){return o(e)});break;default:i.data={message:n},i.type="MessageEvent",e.app.command("CreateCollaborationEvent").execute(i),t()}e.entryText.set(null),e.postType.set("none")})},o.prototype.activateDrawingTool=function(e){this.selectedDrawingTool.set(e),this.app.command("SetActiveTool").execute(e.name),this.app.configuration.mobileMode&&this.app.command("CloseDataFrame").execute()},o.prototype.getOlderEntries=function(){var e=this,t={rooms:this.selectedRooms.get().map(function(e){return e.id}),pageSize:this.numEventsToFetch,activeRoomsOnly:!0,getBeforeId:this.events.getAt(0).event.id,eventTypes:this.eventTypes.filter(function(e){return e.visible&&!e.automatic}).map(function(e){return e.name})};this._restHandler.query(t).then(function(t){e._setLoadingEvents(!0),e._addEvents(t.events),e.hasMoreEvents.set(t.resultCount===e.numEventsToFetch)}).catch(function(t){e.app.trace.error("Failed to fetch the previous page of events: {0}.".format(t.message),t)}).finally(function(){e._setLoadingEvents(!1)})},o.prototype.getMarkupManager=function(){return this._markupManager},o.prototype.activateImageLocator=function(){this.app.command("SetActiveTool").execute("SetCollaborationImageLocation"),this.app.configuration.mobileMode&&this.app.command("CloseDataFrame").execute()},o.prototype.selectRooms=function(e){var t=this;e.sort(function(e,t){return e.id.localeCompare(t.id)});var o=this.selectedRooms.get().filter(function(t){return-1===e.indexOf(t)}).map(function(e){return e.id}),i=e.filter(function(e){return-1===t.selectedRooms.indexOf(e)}).map(function(e){return e.id});return o.length||i.length?(this.app.command("ClearCollaborationDrawings").execute(),this.selectedRooms.set(e),0===e.length&&(this.postingRoom.set(null),this.hasMoreEvents.set(!1)),this.contributableRooms.getLength()>0&&this.postingRoom.set(this.contributableRooms.getAt(0)),this._setLoadingEvents(!0),this._leaveRooms(o).then(function(){return t._clearEvents()}).then(function(){return t._joinRooms(i)}).then(function(o){return t._graphicsManager.buildRoomMarkupState(e.map(function(e){return e.id})).then(function(){return Promise.resolve(o)})}).then(function(o){return t._open(e.concat(o))}).catch(function(e){t.app.trace.error("Error during room selection: {0}.".format(e.message),e)}).finally(function(){t._setLoadingEvents(!1)})):Promise.resolve()},o.prototype._joinRooms=function(e){var t=this;if(!e.length)return Promise.resolve([]);var o=[];return e.forEach(function(e){o.push(t._restHandler.joinRoom(e))}),Promise.all(o.map(function(e){return e.reflect()})).then(function(e){var o=[];return e.forEach(function(e){if(e.isFulfilled()){var i=t._findRoom(e.value().id);i&&(o.push(i),t.app.command("WebSocketCommand").execute("JoinCollaborationRoom",{id:i.id,token:t.app.site.principal.tokens.site}),i.joined.set(!0))}else t.app.trace.error("Failed to join room: {0}".format(e.reason()))}),o})},o.prototype._leaveRooms=function(e){var t=this;if(!e.length)return Promise.resolve([]);var o=[];return e.forEach(function(e){o.push({roomId:e,promise:t._restHandler.leaveRoom(e)})}),Promise.all(o.map(function(e){return e.promise.reflect()})).then(function(e){var i=[];return o.forEach(function(e){if(e.promise.isFulfilled()){var o=t._findRoom(e.roomId);o&&(i.push(o),o.joined.set(!1))}else t.app.trace.warning("Possible permission error when leaving room: {0}".format(e.promise.reason()));t.app.command("WebSocketCommand").execute("LeaveCollaborationRoom",{id:e.roomId,token:t.app.site.principal.tokens.site})}),i})},o.prototype._open=function(e){var t=this;if(!e.length)return Promise.resolve();var o={rooms:e.map(function(e){return e.id}),pageSize:this.numEventsToFetch,activeRoomsOnly:!0,eventTypes:this.eventTypes.filter(function(e){return e.visible&&!e.automatic}).map(function(e){return e.name})};return this._restHandler.query(o).then(function(e){t._addEvents(e.events),t.hasMoreEvents.set(e.resultCount>=t.numEventsToFetch)})},o.prototype._updateRooms=function(){var e=this,t={applicationId:this._applicationScope,activeRoomsOnly:!0};return this._restHandler.getRooms(t).then(function(t){if(!(t&&t instanceof Array))return Promise.reject("Received invalid response from room query.");t=t.filter(function(e){return e&&e.id});var o=e.rooms.get().filter(function(e){return!t.some(function(t){return t.id===e.id})});o.forEach(function(t){return e.rooms.removeItem(t)});var i=[];if(t.forEach(function(t){var o=e._findRoom(t.id);if(o)o.equals(t)||(o.displayName.set(t.displayName),o.color.set(t.color),o.isGlobal=t.global,o.isContributor=t.isContributor,o.isOwner.set(t.isOwner));else{var a=new n.Room(t);a.isNew.set(!0),i.push(a),e.app.event("CollaborationRoomRetrievedEvent").publish(t)}}),e.rooms.addItems(i),o.length||i.length){var a=e.selectedRooms.get().filter(function(e){return!o.some(function(t){return t.id===e.id})});return i.forEach(function(t){e.autoJoinList.contains(t.id)&&(a.push(t),e.autoJoinList.removeItem(t.id))}),e.selectRooms(a)}e.selectedRooms.pulse(),e.contributableRooms.length()&&null===e.postingRoom.get()&&e.postingRoom.set(e.contributableRooms.getAt(0))}).catch(function(t){e.app.trace.error("Failed to retrieve room list from REST endpoint: {0}".format(t.message),t)})},o.prototype._postTypeChanged=function(e){var t=this;switch(this.controlsMinimized.set(!1),this.app.command("ClearCollaborationDrawings").execute(),this.app.command("ClearActiveTool").execute(),this.toolReadyToSend.removeSync(),this.toolReadyToSend.clear(),e){case"markup":return this.toolReadyToSend.sync(this._markupManager.toolReady),this.toolReadyToSend.delegateGetter=function(){return t._markupManager.toolReady.get()},this.drawingToolsVisible.set(!0),this.uploadToolsVisible.set(!1),this.textPost.set(!1),this.typeCaption.set(this.app.getResource(this.libraryId,"language-collaboration-event-type-caption-markup")),this.textEntryPlaceholder.set(this.app.getResource(this.libraryId,"language-collaboration-chat-entry-placeholder-optional")),this.selectedDrawingTool.set(this._defaultDrawingTool),void(this.app.configuration.mobileMode||this.app.command("SetActiveTool").execute(this.selectedDrawingTool.get().name));case"image":return this.toolReadyToSend.sync(this._markupManager.toolReady),this.toolReadyToSend.delegateGetter=function(){return t._markupManager.toolReady.get()&&!!t.filePickerWidgetModel.files.length},this.uploadToolsVisible.set(!0),this.drawingToolsVisible.set(!1),this.textPost.set(!1),this.typeCaption.set(this.app.getResource(this.libraryId,"language-collaboration-event-type-caption-image")),void this.textEntryPlaceholder.set(this.app.getResource(this.libraryId,"language-collaboration-chat-entry-placeholder-optional"));case"none":this.typeCaption.set(this.app.getResource(this.libraryId,"language-collaboration-event-type-caption-message")),this.toolReadyToSend.set(!1);break;default:this.typeCaption.set(this.app.getResource(this.libraryId,"language-collaboration-event-type-caption-default"))}this.textPost.set(!0),this.toolReadyToSend.delegateGetter=function(){return!1},this.drawingToolsVisible.set(!1),this.uploadToolsVisible.set(!1),this.textEntryPlaceholder.set(this.app.getResource(this.libraryId,"language-collaboration-chat-entry-placeholder"))},o.prototype._entryTextChanged=function(e){this._updateSendingEnabled()},o.prototype._updateSendingEnabled=function(){var e=!this.postType.equals("none"),t=this.entryText.get()&&this.entryText.get().trim();this.sendEnabled.set((t&&!e||this.toolReadyToSend.get()&&e)&&!!this.postingRoom.get())},o.prototype._updateClearEnabled=function(){this.clearEnabled.set(!!this.entryText.get()||this._markupManager.toolReady.get()||!!this.filePickerWidgetModel.files.getLength())},o.prototype._executeCopyCollaborationEvent=function(e,t){var o=this;this._restHandler.copyEvent(e.id,t).catch(function(e){o.app.trace.error("Error while copying room {0}.".format(e.message),e)})},o.prototype._canExecuteShowCopyDialogForEvent=function(e){return!e||this.rooms.get().filter(function(t){return t.isContributor&&t.id!==e.roomId}).length>0&&!this._graphicsManager.eventDeleted(e.id)},o.prototype._executeShowCopyDialogForEvent=function(e){var t=this.rooms.get().filter(function(t){return t.isContributor&&t.id!==e.roomId});this.joinedCopyTargets.set(t.filter(function(e){return e.joined.get()})),this.unjoinedCopyTargets.set(t.filter(function(e){return!e.joined.get()})),this.selectedCopyRoom.set(this.joinedCopyTargets.getAt(0)||this.unjoinedCopyTargets.getAt(0)),this.app.command("ActivateEventCopyView").execute(e)},o.prototype._executeShowEditCollaborationMessageView=function(e){this.app.command("ActivateEditCollaborationEventMessageView").execute(e)},o.prototype._canExecuteShowEditCollaborationMessageView=function(e){return this.app.command("ActivateEditCollaborationEventMessageView").canExecute(e)},o.prototype._executeShowEditCollaborationGraphicMessageView=function(e){this.app.command("ActivateEditCollaborationFeatureMessageView").execute(e)},o.prototype._canExecuteShowEditCollaborationGraphicMessageView=function(e){return this.app.command("ActivateEditCollaborationFeatureMessageView").canExecute(e)},o.prototype._executeSendWebSocketCommand=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this._webSocket.command(e).execute(t)},o.prototype._executeCreateCollaborationEvent=function(e){var t=this;this.isSending.set(!0),this._restHandler.addEvent(e),setTimeout(function(){t.isSending.set(!1)},1e3)},o.prototype._canExecuteEditCollaborationEvent=function(e){var t=this._findEvent(e).event,o=this._findRoom(t.roomId);if(!t||!o)return!1;var i=this.eventTypes.some(function(e){return e.name===t.type&&e.widget.configuration&&!!e.widget.configuration.canEdit}),n=!!t.isEditor||!!t.isOwner||this._roomOwnerCanEditEvents&&o.isOwner.get();return i&&n},o.prototype._executeEditCollaborationEvent=function(e,t,o){this._restHandler.editEvent(e,t).then(o)},o.prototype._executeGetCollaborationEvent=function(e,t){this._restHandler.getEvent(e).then(t)},o.prototype._executeEditCollaborationRoom=function(e,t,o){this._restHandler.editRoom(e,t).then(o)},o.prototype._executeCreateCollaborationRoom=function(e,t){e.applicationId=this._applicationScope,this._restHandler.createRoom(e).then(t)},o.prototype._executeAutoJoinCollaborationRoom=function(e){this.autoJoinList.addItem(e)},o.prototype._executeVerifyRoomNameUnique=function(e,t){this._restHandler.checkRoomNameUnique(e,this._applicationScope).then(t)},o.prototype._executeOpenCollaboration=function(){this.app.command("ActivateView").execute("CollaborationView")},o.prototype._canExecuteOpenCollaboration=function(){return this.enabled.get()},o.prototype._canExecuteEraseMarkupEvent=function(e){return this.app.command("EditCollaborationEvent").canExecute(e.id)&&!this._graphicsManager.eventDeleted(e.id)},o.prototype._executeEraseMarkupEvent=function(e){var t=this,o=this.app.getResource(this.libraryId,"language-collaboration-event-erase-markup-confirm-message"),i=this.app.getResource(this.libraryId,"language-collaboration-event-erase-markup-confirm-title");this.app.command("Confirm").execute(o,i,function(o){if(o){var i={roomId:e.roomId,type:"DeleteMarkupEvent",data:{}};t.app.command("EditCollaborationEvent").execute(e.id,i)}})},o.prototype._canExecuteGetCollaborationRooms=function(){return this.active.get()},o.prototype._executeGetCollaborationRooms=function(e,t){void 0===e&&(e=!0);var o={applicationId:this._applicationScope,activeRoomsOnly:e};this._restHandler.getRooms(o).then(t)},o.prototype._canExecutePushCollaborationRoom=function(){return this.active.get()},o.prototype._executePushCollaborationRoom=function(e,t,o,i){o||(o={rooms:[],eventTypes:["ShareMarkupEvent","DeleteMarkupEvent","ShareImageEvent"]}),this._restHandler.pushRoom(e,t,o).then(i)},o.prototype._canExecuteOpenEventFeatureImage=function(e){var t=e.esriFeature.get();if(t){var o=t.attributes._event;return!!o&&o.id&&o.type&&"ShareImageEvent"===o.type}return!1},o.prototype._executeOpenEventFeatureImage=function(e){var t=e.esriFeature.get().attributes._eventId,o=(this._config.restEndpoint||s.RestHandler.getCollaborationServiceUrl(this.app))+"/event/{0}/open?token={1}".format(t,this.app.site.principal.tokens.site);this.app.command("OpenWebPage").execute(o)},o.prototype._canExecuteCreateCollaborationImage=function(){return this.active.get()},o.prototype._executeCreateCollaborationImage=function(e){var t=this,o={roomId:e.roomId},i=e.file.fileDataBase64,n=e.maxWidth||this._config.imageSize&&this._config.imageSize.width,a=e.maxHeight||this._config.imageSize&&this._config.imageSize.height;return(n&&a?m.resizeImageToMaxDimensions(e.file.getDataUri(),n,a).then(function(e){i=m.getRawByteDataFromDataUri(e)}):Promise.resolve()).then(function(){return m.resizeImageToMaxDimensions(e.file.getDataUri(),t._config.thumbnailViewSize.width,t._config.thumbnailViewSize.height)}).then(function(o){var n={location:o},a={document:{contentType:d.ContentType.TEXT,fileType:e.file.fileType,thumbnail:n},blob:i},r=p.writeDocument(a);return t.app.site.documentStore.perform(r,!0)}).then(function(i){o.type="ShareImageEvent",o.attachmentId=i.document.id,o.data={location:e.location,message:e.message},t.app.command("CreateCollaborationEvent").execute(o)}).catch(function(e){throw t.app.trace.error("Failed to write image document: {0}".format(e.message),e),e})},o.prototype._handleSelectedRoomsChanged=function(e){if(e.rangeEnd+1-e.rangeStart<e.sender.value.length||"append"===e.type){this.contributableRooms.set(this.selectedRooms.get().filter(function(e){return e.isContributor}));var t=this.selectedRooms.getAt(0);this.firstRoom.set(t?t.displayName.get():"")}else this.contributableRooms.clear(),this.firstRoom.set("");this.singleRoomSelected.set(1===this.selectedRooms.getLength())},o.prototype._handleUploadFileChanged=function(e){var t=this;if(this.toolReadyToSend.get(),"clear"===e.type)this._markupManager.removePhotoLocation(),this.canManuallyLocate.set(!1);else if(this.filePickerWidgetModel.files.get()&&this.filePickerWidgetModel.files.getAt(0)){var o=this.filePickerWidgetModel.files.getAt(0);this.canManuallyLocate.set(!0);var i=null;try{i=c.ExifUtilities.getExifTagsFromImageBytes(c.ExifUtilities.base64ToArrayBuffer(o.fileDataBase64,"image/*"))}catch(e){this.app.trace.warning("Failed to fetch Exif tags from the image: {0}".format(e.message))}i&&c.ExifUtilities.getPointFromExif(i)?this._markupManager.setPhotoLocation(c.ExifUtilities.getPointFromExif(i),!0).catch(function(e){t.app.trace.error("Failed to plot the Exif location: {0}".format(e.message),e),t.activateImageLocator()}):this.app.isHttpsMode?this._performPhotoGeolocation().then(function(e){return t._markupManager.setPhotoLocation(e,!0)}).catch(function(e){t.app.trace.error("Failed to geolocate your position: {0}".format(e.message),e),t.activateImageLocator()}):this.activateImageLocator()}},o.prototype._handleWebSocketConnectionChanged=function(e){e.isConnected.get()?this.app.command("WebSocketCommand").execute("RegisterCollaborator",{token:this.app.site.principal.tokens.site,applicationId:this._applicationScope}):(this.connected.set(!1),this.selectedRooms.getLength()>0&&(this._reconnectionState=this.selectedRooms.get().map(function(e){return e.id})))},o.prototype._handleRoomEventAddedEvent=function(e){var t=this;e.data.forEach(function(e){if(t.eventTypes.some(function(t){return e.type===t.name&&t.visible})){if(t.events.getLength()){var o=Date.parse(t.events.getAt(0).event.created);if(Date.parse(e.created)<o)return}t._addEvents([e],!0)}})},o.prototype._handleRoomStatusChanged=function(e){var t=this._findRoom(e.roomId);t&&(t.members.set(e.connectedUsers),t.memberNames.set(e.connectedUserNames))},o.prototype._handleCollaboratorRegisteredEvent=function(e){var t=this;if(e&&(this._roomOwnerCanEditEvents=!!e.roomOwnerCanEditEvents),this._updateRooms().then(function(){t.rooms.get().forEach(function(e){return e.isNew.set(!1)}),t.hasNewRooms.set(!1),t.numberNewRooms.set(""),t.newRooms=0,t.rooms.pulse()}),this._reconnectionState){this._reconnectionState.forEach(function(e){t.app.command("WebSocketCommand").execute("JoinCollaborationRoom",{id:e,token:t.app.site.principal.tokens.site})});var o={rooms:this.selectedRooms.get().map(function(e){return e.id}),getAfterId:this.events.getLength()>0?this.events.getAt(this.events.getLength()-1).event.id:null,eventTypes:this.eventTypes.filter(function(e){return e.visible}).map(function(e){return e.name})};this._restHandler.query(o).then(function(e){t._setLoadingEvents(!0),e.events.reverse().forEach(function(e){t._addEvents([e],!0)})}).catch(function(e){t.app.trace.error("Error while fetching rooms list: {0}.".format(e.message),e)}).finally(function(){t._setLoadingEvents(!1)}),this._reconnectionState=null}this.connected.set(!0)},o.prototype._performPhotoGeolocation=function(){return new Promise(function(e,t){navigator.geolocation.getCurrentPosition(function(t){if(t.coords&&t.coords.latitude&&t.coords.longitude){var o=new esri.geometry.Point(t.coords.longitude,t.coords.latitude,new esri.SpatialReference(4326));e(o)}},function(e){t(e)})})},o.prototype._getWebsocketUrl=function(){var e=g.UrlUtilities.getUrlComponents(this.app.site.url),t=e.protocol.toLowerCase().indexOf("https")>-1?"wss":"ws";return"{0}://{1}/{2}".format(t,e.host,"collaboration/ws")},o.prototype._setLoadingEvents=function(e){var t=this;e?this.isLoadingEvents.set(!0):setTimeout(function(){t.isLoadingEvents.set(!1)},1e3)},o.prototype._transformPostTextColor=function(e){return"#"===e.charAt(0)&&(e=e.slice(-(e.length-1))),(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=168?"#000000":"#FFFFFF"},o}(u.BaseCollaborationViewModel);o.CollaborationViewModel=h;var v=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.locked=!1,e}return e(o,t),o.prototype.set=function(e){this.locked||t.prototype.set.call(this,e)},o.prototype.lock=function(){this.locked=!0},o.prototype.unlock=function(){this.locked=!1},o}(i.Observable);o.Lockable=v})},"url:/Mapping/modules/Collaboration/Events/BannerEvent/BannerEventView.html":t,"url:/Mapping/modules/Collaboration/Events/CardEvent/CardEventContentView.html":o,"url:/Mapping/modules/Collaboration/Events/CardEvent/CardEventView.html":i,"url:/Mapping/modules/Collaboration/Events/EventActionsMenu.html":n,"url:/Mapping/modules/Collaboration/Events/EventCopyView.html":a,"url:/Mapping/modules/Collaboration/Events/EventEditView.html":r,"url:/Mapping/modules/Collaboration/Events/ImageEvent/ImageEventContentView.html":s,"url:/Mapping/modules/Collaboration/Events/MessageEvent/MessageEventContentView.html":l,"url:/Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventContentView.html":c,"url:/Mapping/modules/Collaboration/Rooms/EditRoomView.html":d,"url:/Mapping/modules/Collaboration/Rooms/RoomDetailsView.html":p,"url:/Mapping/modules/Collaboration/Views/AfterAction/AfterActionSelectorView.html":u,"url:/Mapping/modules/Collaboration/Views/AfterAction/AfterActionView.html":g,"url:/Mapping/modules/Collaboration/Views/Collaboration/CollaborationDrawingToolFlyoutView.html":b,"url:/Mapping/modules/Collaboration/Views/Collaboration/CollaborationFilePicker.html":m,"url:/Mapping/modules/Collaboration/Views/Collaboration/CollaborationMarkupStyleSelectorView.html":h,"url:/Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorItemTemplate.html":v,"url:/Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorView.html":C,"url:/Mapping/modules/Collaboration/Views/Collaboration/CollaborationView.html":y}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/CSS/common.css","css","LmNvbGxhYm9yYXRpb24tcGFuZWwgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICB0b3A6IDA7DQogICAgYm90dG9tOiAwOw0KfQ0KDQouY29sbGFib3JhdGlvbi1zaWduLWluIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgbGVmdDogMDsNCiAgICByaWdodDogMDsNCiAgICB0b3A6IDQwJTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi5jb2xsYWJvcmF0aW9uLXNpZ24taW4tbGluayB7DQogICAgY29sb3I6ICMxQTcyQzQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouY29sbGFib3JhdGlvbi1jcmVhdGUtcm9vbS1wYW5lbCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgdG9wOiAwOw0KICAgIGJvdHRvbTogMDsNCiAgICBwYWRkaW5nOiAxZW07DQogICAgb3ZlcmZsb3c6IGF1dG87DQp9DQoNCi5jb2xsYWJvcmF0aW9uLXNlbGVjdC1yb29tLXByb21wdCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBjb2xvcjogIzMzMzMzMzsNCiAgICB0b3A6IDQwJTsNCiAgICBsZWZ0OiAwOw0KICAgIHJpZ2h0OiAwOw0KfQ0KDQouY29sbGFib3JhdGlvbi1tZXNzYWdlLW5vdGlmaWNhdGlvbiwNCi5uZXctcm9vbXMtbm90aWZpY2F0aW9uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgaGVpZ2h0OiAzMnB4Ow0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJvdHRvbTogMDsNCiAgICB6LWluZGV4OiA1Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY2YzA7DQogICAgY29sb3I6ICMzMzMzMzM7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgLXdlYmtpdC10cmFuc2l0aW9uOiBoZWlnaHQgMC4xczsNCiAgICB0cmFuc2l0aW9uOiBoZWlnaHQgMC4xczsNCn0NCg0KLnJvb20tc2VsZWN0b3IgLm5ldy1yb29tcy1ub3RpZmljYXRpb24gew0KICAgIHRvcDogM2VtOw0KfQ0KDQouY29sbGFib3JhdGlvbi1tZXNzYWdlLW5vdGlmaWNhdGlvbi5oaWRlLA0KLm5vdGlmaWNhdGlvbi1jbGVhci1idXR0b24uaGlkZSwNCi5uZXctcm9vbXMtbm90aWZpY2F0aW9uLmhpZGUgew0KICAgIGhlaWdodDogMGVtOw0KICAgIHBhZGRpbmc6IDBlbTsNCiAgICBib3JkZXI6IG5vbmU7DQp9DQoNCi8qIGNoYXQgY29udHJvbHMgKi8NCg0KLmNoYXQtY29udHJvbHMgLmZpbGVwaWNrZXIgLmZvcm0tbGFiZWwgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogNjVweDsNCiAgICBoZWlnaHQ6IDU1cHg7DQogICAgbWFyZ2luLXRvcDogMC43NWVtOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgnUmVzb3VyY2VzL0ltYWdlcy9pY29ucy90b29sYmFyL2F0dGFjaC1maWxlLXBob3RvLTI0LnBuZycpOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNDQ0NDQ0M7DQogICAgYm9yZGVyLXJhZGl1czogMC4yNWVtOw0KICAgIC13ZWJraXQtYm9yZGVyLXJhZGl1czogMC4yNWVtOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB6LWluZGV4OiAxMDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouY2hhdC1jb250cm9scyAuaW1hZ2UtdXBsb2FkIC5mb3JtLWNvbnRyb2wgew0KICAgIG1pbi13aWR0aDogMDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQp9DQoNCi5jb2xsYWJvcmF0aW9uLWZpbGUtaW5wdXQtYnJvd3NlciB7DQogICAgb3BhY2l0eTogMDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQp9DQoNCi5jaGF0LXRleHQtYm94LnRleHQtcG9zdCB7DQogICAgcGFkZGluZy1sZWZ0OiAwLjVlbTsNCn0NCg0KLmNoYXQtdGV4dC1ib3ggew0KICAgIGhlaWdodDogOGVtOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDAuNWVtIDJlbSAwLjVlbSA1LjVlbTsNCiAgICBib3JkZXItd2lkdGg6IDFweCAwIDFweCAwOw0KICAgIGJvcmRlci1zdHlsZTogc29saWQ7DQogICAgYm9yZGVyLWNvbG9yOiAjRDlEOUQ5Ow0KICAgIG92ZXJmbG93OiBhdXRvOw0KICAgIHBhZGRpbmctcmlnaHQ6IDEuNWVtOw0KfQ0KDQouY2hhdC10ZXh0LWJveC50ZXh0LXBvc3QgdGV4dGFyZWEgew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBib3JkZXI6IG5vbmU7DQp9DQoNCi5wb3N0LXR5cGUtc2VsZWN0b3Igew0KICAgIHBhZGRpbmc6IDAuMjVlbSAwIDAuMjVlbSAwOw0KICAgIGhlaWdodDogMi4zZW07DQp9DQoNCi5zZWxlY3Rvci1iYXIgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDoxMDAlOw0KfQ0KDQouc2VsZWN0b3ItbGlzdCB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5zZWxlY3Rvci1saXN0IC5saXN0LWl0ZW0gew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBtYXJnaW4tcmlnaHQ6IDFlbTsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgLmxpc3QtaXRlbS50ZXh0IHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouc2VsZWN0b3ItbGlzdCAubGlzdC1pdGVtIGxhYmVsIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAuNWVtIGNlbnRlcjsNCiAgICBwYWRkaW5nOiAwLjVlbSAwLjVlbSAwLjVlbSAyLjc1ZW07DQogICAgYm9yZGVyLXJhZGl1czogMC4yNWVtOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgLmxpc3QtaXRlbSBsYWJlbDpob3ZlciB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUVFRUVFOw0KfQ0KDQouc2VsZWN0b3ItbGlzdCAubGlzdC1pdGVtLnRleHQgbGFiZWwgIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvaWNvbnMvdGV4dC1maWVsZC1pbmFjdGl2ZS0yNC5wbmciKTsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgLmxpc3QtaXRlbS50ZXh0IGlucHV0W3R5cGU9InJhZGlvIl06Y2hlY2tlZCArIGxhYmVsIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvaWNvbnMvdGV4dC1maWVsZC0yNC5wbmciKTsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgLmxpc3QtaXRlbS5tYXJrdXAgbGFiZWwgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9pY29ucy9lZGl0LW1hcmt1cC1pbmFjdGl2ZS0yNC5wbmciKTsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgLmxpc3QtaXRlbS5tYXJrdXAgaW5wdXRbdHlwZT0icmFkaW8iXTpjaGVja2VkICsgbGFiZWwgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9pY29ucy9lZGl0LW1hcmt1cC1hY3RpdmUtMjQucG5nIik7DQp9DQoNCi5zZWxlY3Rvci1saXN0IC5saXN0LWl0ZW0uaW1hZ2UgbGFiZWwgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9pY29ucy9waG90by1pbmFjdGl2ZS0yNC5wbmciKTsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgLmxpc3QtaXRlbS5pbWFnZSBpbnB1dFt0eXBlPSJyYWRpbyJdOmNoZWNrZWQgKyBsYWJlbCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL2ljb25zL3Bob3RvLWFjdGl2ZS0yNC5wbmciKTsNCn0NCg0KLnBvc3QtdHlwZS1zZWxlY3RvciBpbnB1dFt0eXBlPSdyYWRpbyddIHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouc2VsZWN0b3ItbGlzdCBpbnB1dFt0eXBlPSJyYWRpbyJdOmNoZWNrZWQgKyBsYWJlbCB7DQogICAgcGFkZGluZzogMC41ZW0gMi41ZW0gMC41ZW0gMi43NWVtOw0KICAgIGNvbG9yOiAjRkZGRkZGOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICMxQTcyQzQ7DQogICAgb3BhY2l0eTogMTsNCn0NCg0KLnNlbGVjdG9yLWxpc3QgaW5wdXRbdHlwZT0icmFkaW8iXTpjaGVja2VkICsgbGFiZWwgKyAuY2xlYXItYnV0dG9uIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCg0KLnBvc3QtZGVzYyB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiBjYWxjKDEwMCUgLSAxNS41ZW0pOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICBjb2xvcjogIzc2NzY3NjsNCiAgICB0b3A6IDAuMjVlbTsNCiAgICByaWdodDogMC4yNWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCg0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQwMHB4KSB7DQogICAgLnBvc3QtZGVzYyB7DQogICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgfQ0KfQ0KDQoucG9zdC1jb250YWluZXIgLnJvb20tc2VsZWN0b3IsDQouY29weS1ldmVudC1yb29tLXNlbGVjdG9yIHsNCiAgICB3aWR0aDogMTBlbTsNCiAgICBwYWRkaW5nOiAwIDAgMCAwLjVlbTsNCiAgICBtYXJnaW4tbGVmdDogMC4yNWVtOw0KICAgIGhlaWdodDogMi41ZW07DQogICAgY29sb3I6ICMzMzMzMzM7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KfQ0KDQouY29weS1ldmVudC1yb29tLXNlbGVjdG9yIHsNCiAgICB3aWR0aDogMjJlbTsNCn0NCg0KLmNoYXQtY29udHJvbHMgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBib3R0b206IDA7DQogICAgbGVmdDogMDsNCiAgICByaWdodDogMDsNCiAgICBwYWRkaW5nOiAwIDAuNWVtIDAgMC41ZW07DQogICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgei1pbmRleDogMTAwOw0KfQ0KDQouY2hhdC1jb250cm9scyAucG9zdC1jb250YWluZXIgew0KICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KICAgIG1hcmdpbi10b3A6IDAuNWVtOw0KICAgIG1hcmdpbi1ib3R0b206IDAuNWVtOw0KfQ0KDQouY2hhdC1jb250cm9scyAuZm9ybS1sYWJlbCBpbnB1dCB7DQogICAgd2lkdGg6IDAuMXB4Ow0KICAgIGhlaWdodDogMC4xcHg7DQogICAgb3BhY2l0eTogMDsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB6LWluZGV4OiAtMTsNCn0NCg0KLmNoYXQtY29udHJvbHMtaW5wdXQtYXJlYSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGhlaWdodDogOGVtOw0KfQ0KDQouY2hhdC1jb250cm9scyAuY2xlYXItYnV0dG9uIHsNCiAgICBkaXNwbGF5OiBub25lOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICByaWdodDogMDsNCiAgICB0b3A6IDA7DQogICAgYm90dG9tOiAwOw0KICAgIG1hcmdpbjogYXV0bzsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvaWNvbnMvY2xlYXItYWN0aXZlLTE2LnBuZyIpIG5vLXJlcGVhdCA5MiU7DQogICAgei1pbmRleDogMTA7DQp9DQoNCi5jaGF0LWNvbnRyb2xzIC5jbGVhci1idXR0b246aG92ZXIgew0KICAgIG9wYWNpdHk6IDAuNzU7DQp9DQoNCi5wb3N0LWNvbnRhaW5lciAuc2VuZC1idXR0b24uYm91bmQtZGlzYWJsZWQ6aG92ZXIgew0KICAgIG9wYWNpdHk6IDAuNTsNCn0NCg0KLnBvc3QtY29udGFpbmVyIC5zZW5kLWJ1dHRvbjpob3ZlciB7DQogICAgb3BhY2l0eTogMC43NTsNCn0NCg0KLnBvc3QtY29udGFpbmVyIC5zZW5kLWJ1dHRvbi5ib3VuZC1kaXNhYmxlZCB7DQogICAgYm9yZGVyLWNvbG9yOiAjRDlEOUQ5ICFpbXBvcnRhbnQ7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Q5RDlEOSAhaW1wb3J0YW50Ow0KICAgIGNvbG9yOiAjNzY3Njc2ICFpbXBvcnRhbnQ7DQp9DQoNCi5jb2xsYWJvcmF0aW9uLW1hcmt1cC1zdHlsZS1zZWxlY3RvciB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQogICAgaGVpZ2h0OiBDYWxjKDEwMCUgLSAxZW0pOw0KICAgIHBhZGRpbmctYm90dG9tOiAxZW07DQp9DQoNCi5jb2xsYWJvcmF0aW9uLW1hcmt1cC1zdHlsZS1zZWxlY3RvciAuZm9ybS1idG5zIHsNCiAgICBwYWRkaW5nLXJpZ2h0OiAxZW07DQp9DQoNCi8qIEVuZCBjaGF0IGNvbnRyb2xzICovDQoNCi8qIEV2ZW50IGxpc3QgKi8NCg0KLmV2ZW50LWxpc3QtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAzZW07DQogICAgYm90dG9tOiAyLjc1ZW07DQogICAgbGVmdDogMDsNCiAgICByaWdodDogMDsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNlOGU4ZTg7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgYm94LXNoYWRvdzogaW5zZXQgMHB4IDBweCA2cHggI0RERERERDsNCn0NCg0KLmV2ZW50LWxpc3QtY29udGFpbmVyLmNvbnRyb2wtbW9kZSB7DQogICAgYm90dG9tOiAxNC4yZW07DQp9DQoNCi5yb29tLWNvbG9yLXN3YXRjaCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAwLjc1ZW07DQogICAgaGVpZ2h0OiAwLjc1ZW07DQogICAgYm9yZGVyLXJhZGl1czogMTAwJTsNCiAgICBtYXJnaW4tcmlnaHQ6IDAuMjVlbTsNCn0NCg0KLmNoYXQtZW50cnktY29udGFpbmVyIHsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIG1hcmdpbi1yaWdodDogMmVtOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgYm9yZGVyLWxlZnQ6IG5vbmU7DQogICAgYm94LXNoYWRvdzogMHB4IDNweCA2cHggI0RERERERDsNCn0NCg0KLmNoYXQtZW50cnktY29udGFpbmVyOmhvdmVyIHsNCiAgICBib3gtc2hhZG93OiAwcHggNXB4IDZweCAjREREREREOw0KICAgIHRyYW5zaXRpb246IGFsbCAwLjFzIGxpbmVhcjsgDQp9DQoNCi5jaGF0LWVudHJ5LWNvbnRhaW5lci5jbGlja2FibGUgew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KLmNoYXQtZW50cnktY29udGFpbmVyLnVzZXItZW50cnkgew0KICAgIG1hcmdpbi1yaWdodDogMDsNCiAgICBtYXJnaW4tbGVmdDogMmVtOw0KICAgIGZsb2F0OiByaWdodDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRTlGNkZGOw0KfQ0KDQouY2hhdC1lbnRyeS1jb250YWluZXI6OmFmdGVyIHsNCiAgICBjb250ZW50OiAiICI7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBsZWZ0OiAtMWVtOw0KICAgIGJvcmRlcjogMS4xNWVtIHNvbGlkOw0KICAgIGJvcmRlci1jb2xvcjogI0ZGRkZGRiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudDsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCg0KLmNoYXQtZW50cnktY29udGFpbmVyLnVzZXItZW50cnk6OmFmdGVyIHsNCiAgICByaWdodDogLTFlbTsNCiAgICB0b3A6IDA7DQogICAgbGVmdDogYXV0bzsNCiAgICBib3JkZXItY29sb3I6ICNFOUY2RkYgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQ7DQp9DQoNCi5ldmVudC1tZXRhZGF0YS1jb250YWluZXIgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBjb2xvcjogIzcwNzA3MDsNCiAgICBwYWRkaW5nOiAwLjVlbSAwLjc1ZW0gMC41ZW0gMC43NWVtOw0KICAgIHdvcmQtYnJlYWs6IGJyZWFrLXdvcmQ7DQogICAgZm9udC1zaXplOiAxMXB4Ow0KfQ0KDQouZXZlbnQtbWV0YWRhdGEtY29udGFpbmVyLm1lbnUtZW5hYmxlZCB7DQogICAgbWFyZ2luLXJpZ2h0OiAzZW07DQp9DQoNCi5jb2xsYWJvcmF0aW9uLXBhbmVsLnNpbmdsZS1yb29tIC5ldmVudC1tZXRhZGF0YS1jb250YWluZXIubG93ZXIgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5ldmVudC1jcmVhdGVkLA0KLm5hbWUtZGF0ZS1zZXBhcmF0b3IsDQouZXZlbnQtY3JlYXRlZGJ5IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi5yb29tLW5hbWUtY29udGFpbmVyIHsNCiAgICBjb2xvcjogIzk1OTM5ODsNCiAgICBmb250LXNpemU6IDExcHg7DQogICAgcGFkZGluZzogMCAwLjc1ZW0gMC41ZW0gMC43NWVtOw0KfQ0KDQouZXZlbnQtZGF0YS10eXBlIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBjb2xvcjogIzFBNzJDNDsNCn0NCg0KLmltYWdlLWV2ZW50LWRhdGEgew0KICAgIG1hcmdpbi1ib3R0b206IDAuNWVtOw0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5ldmVudC1kYXRhLWNvbnRhaW5lciB7DQogICAgcGFkZGluZy1ib3R0b206IDAuNWVtOw0KICAgIG1hcmdpbjogMCAwLjVlbSAwIDAuNWVtOw0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGZvbnQtc2l6ZTogMS4yNWVtOw0KICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsNCn0NCg0KLmV2ZW50LWRhdGEtY29udGFpbmVyIC5tYXJrdXAgew0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9pY29ucy9lZGl0LW1hcmt1cC0yNC5wbmciKSBuby1yZXBlYXQgbGVmdCB0b3A7DQogICAgY29sb3I6ICMxQTcyQzQ7DQogICAgcGFkZGluZy1sZWZ0OiAyZW07DQogICAgbWluLWhlaWdodDogMS41ZW07DQp9DQoNCi5jb2xsYWJvcmF0aW9uLXBhbmVsLnNpbmdsZS1yb29tIC5ldmVudC1kYXRhLWNvbnRhaW5lciB7DQogICAgYm9yZGVyLWJvdHRvbTogbm9uZTsNCn0NCg0KLmV2ZW50LWltYWdlLWNvbnRhaW5lciB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBtaW4td2lkdGg6IDNlbTsNCiAgICBtaW4taGVpZ2h0OiAyZW07DQp9DQoNCi5pbWFnZS1vcGVuLWZ1bGwtYnV0dG9uIHsNCiAgICB3aWR0aDogMjRweDsNCiAgICBoZWlnaHQ6IDI0cHg7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHJpZ2h0OiAwOw0KICAgIHRvcDogMDsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvaWNvbnMvbGluay1leHRlcm5hbC0yNC5wbmciKSBuby1yZXBlYXQgbGVmdCB0b3A7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICBvcGFjaXR5OiAwLjg7DQp9DQoNCi5ldmVudC1iYW5uZXItZGF0YSB7DQogICAgbWF4LXdpZHRoOiA5NSU7DQogICAgbWFyZ2luOiBhdXRvOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICB3b3JkLWJyZWFrOiBicmVhay13b3JkOw0KICAgIGNvbG9yOiAjMzMzMzMzOw0KICAgIGZvbnQtc2l6ZTogMTFweDsNCn0NCg0KLmV2ZW50LWRhdGEtY29udGFpbmVyIC5tYXJrdXAuYm91bmQtZGlzYWJsZWQgew0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9pY29ucy9lZGl0LW1hcmt1cC1pbmFjdGl2ZS0yNC5wbmciKSBuby1yZXBlYXQgbGVmdCB0b3A7IA0KICAgIGNvbG9yOiAjRDlEOUQ5Ow0KfQ0KDQouZXZlbnQtZGF0YS1jb250YWluZXIgLm1hcmt1cC1tZXRhLXRleHQgew0KICAgIG1hcmdpbi10b3A6IDAuNWVtOw0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICBmb250LXNpemU6IDExcHg7DQp9DQoNCi5Db2xsYWJvcmF0aW9uQ29udGFpbmVyVmlldyAucGFuZWwtc2Nyb2xsLWNvbnRhaW5lciB7DQogICAgb3ZlcmZsb3cteTogaGlkZGVuOw0KfQ0KDQouaGlzdG9yaWNhbC1ldmVudHMtYnV0dG9uIHsNCiAgICBjb2xvcjogIzFBNzJDNDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDAuMjVlbSAwIDAuMjVlbSAwOw0KfQ0KDQouaGlzdG9yaWNhbC1ldmVudHMtYnV0dG9uOmhvdmVyIHsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgYmFja2dyb3VuZDogIzFBNzJDNDsNCn0NCg0KLmV2ZW50LW1lbnUtYnV0dG9uIHsNCiAgICBoZWlnaHQ6IDIuMjVlbTsNCiAgICB3aWR0aDogMi43NWVtOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgcmlnaHQ6IDA7DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL21lbnUtaG9pc3RlZC0yNC5wbmciKSBjZW50ZXIgbm8tcmVwZWF0Ow0KICAgIG9wYWNpdHk6IDAuNzU7DQp9DQoNCi5ldmVudC1tZW51LWJ1dHRvbi5ib3VuZC1kaXNhYmxlZCwNCi5ldmVudC1tZW51LWJ1dHRvbi5ib3VuZC1kaXNhYmxlZDpob3ZlciB7DQogICAgb3BhY2l0eTogMC4zOw0KfQ0KDQouZXZlbnQtbWVudS1idXR0b246aG92ZXIsDQouaW1hZ2Utb3Blbi1mdWxsLWJ1dHRvbjpob3ZlciwNCi5yb29tLXNlbGVjdG9yLWJ1dHRvbjpob3ZlciwNCi5zZWxlY3Rvci1saXN0IC5saXN0LWl0ZW0gbGFiZWw6aG92ZXIsDQoubm90aWZpY2F0aW9uLWNsZWFyLWJ1dHRvbjpob3ZlciB7DQogICAgb3BhY2l0eTogMTsNCn0NCg0KLmV2ZW50LWZlZWQgew0KICAgIG92ZXJmbG93LXk6IGF1dG87DQogICAgaGVpZ2h0OiAxMDAlOw0KfQ0KDQouZXZlbnQtbGlzdCB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgcGFkZGluZy1ib3R0b206IDAuNWVtOw0KICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsNCn0NCg0KLmV2ZW50LWxpc3QtaXRlbSB7DQogICAgcGFkZGluZzogMC4yNWVtIDFlbSAwLjI1ZW0gMWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KLmV2ZW50LWxpc3QtaXRlbTphZnRlciB7DQogICAgY29udGVudDogIiAiOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMDsNCiAgICBjbGVhcjogYm90aDsNCiAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQp9DQoNCi5ldmVudC1hY3Rpb25zLXdpZGdldCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHotaW5kZXg6IDE7DQogICAgcmlnaHQ6IDA7DQogICAgdG9wOiAyLjI1ZW07DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjREREREREOw0KfQ0KDQouZXZlbnQtYWN0aW9ucy1tZW51IHsNCiAgICBwYWRkaW5nOiAwOw0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7DQogICAgbWluLXdpZHRoOiAxMGVtOw0KICAgIG1heC13aWR0aDogMTAwJTsNCn0NCg0KLmV2ZW50LWFjdGlvbnMtbWVudSAubGlzdC1tZW51LWl0ZW0gew0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5ldmVudC1hY3Rpb25zLW1lbnUgLmxpc3QtbWVudS1pdGVtOmxhc3QtY2hpbGQgew0KICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQp9DQoNCi5ldmVudC1hY3Rpb25zLW1lbnUgLmxpc3QtbWVudS1pdGVtOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5Ow0KfQ0KDQouZXZlbnQtYWN0aW9ucy1idXR0b24gew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBwYWRkaW5nOiAwLjU0ZW07DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogMi41ZW07DQp9DQoNCi5ldmVudC1hY3Rpb25zLWJ1dHRvbiAubGlzdC1tZW51LW5hbWUgew0KICAgIHBhZGRpbmctbGVmdDogMi40ZW07DQogICAgd29yZC1icmVhazogYnJlYWstd29yZDsNCiAgICBjb2xvcjogIzMzMzMzMzsNCn0NCg0KLmV2ZW50LWFjdGlvbnMtYnV0dG9uIC5saXN0LW1lbnUtaWNvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBib3R0b206IDA7DQogICAgbWFyZ2luOiBhdXRvIDA7DQp9DQoNCi8qIEVuZCBldmVudCBsaXN0ICovDQoNCi8qIFJvb20gc2VsZWN0b3IgKi8NCg0KLnJvb20tc2VsZWN0b3IgLnNlbGVjdG9yLWl0ZW0gew0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQoucm9vbS1zZWxlY3RvciAuc2VsZWN0b3ItaXRlbTpob3ZlciwgDQoucm9vbS1zZWxlY3RvciAuc2VsZWN0b3ItaXRlbTpob3ZlciAuZ2N4LXRvZ2dsZSAuaW5wdXQtbGFiZWwgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGOUY5Rjk7DQp9DQoNCi5yb29tLXNlbGVjdG9yLWxpc3Qgew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsgDQogICAgcGFkZGluZzogMC4zNWVtOw0KfQ0KDQoucm9vbS1zZWxlY3Rvci1idXR0b25zIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHJpZ2h0OiAwOw0KICAgIHRvcDogMC4xNWVtOw0KICAgIGN1cnNvcjogZGVmYXVsdDsNCn0NCg0KLnJvb20tc2VsZWN0b3ItYnV0dG9uIHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvdmVydGljYWwtZWxsaXBzaXMucG5nIikgbm8tcmVwZWF0IGNlbnRlcjsNCiAgICBoZWlnaHQ6IDIuMjVlbTsNCiAgICB3aWR0aDogMmVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsgDQogICAgZmxvYXQ6IHJpZ2h0OyANCiAgICBvcGFjaXR5OiAwLjc1Ow0KfQ0KDQoucm9vbS1zZWxlY3RvciB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGhlaWdodDogNGVtOw0KICAgIG1hcmdpbjogYXV0bzsNCn0NCg0KLmNvbGxhYm9yYXRpb24tcGFuZWwuc2luZ2xlLXJvb20gLnBvc3QtY29udGFpbmVyIC5yb29tLXNlbGVjdG9yIHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQoucG9zdC1jb250YWluZXIgLnJvb20tbmFtZSB7DQogICAgZGlzcGxheTogbm9uZTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDguMzVlbTsNCiAgICBwYWRkaW5nOiAwLjVlbSAwLjc1ZW07DQogICAgbWFyZ2luLXJpZ2h0OiAwLjI1ZW07DQogICAgY29sb3I6ICMzMzMzMzM7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgY3Vyc29yOiBkZWZhdWx0Ow0KfQ0KDQouY29sbGFib3JhdGlvbi1wYW5lbC5zaW5nbGUtcm9vbSAucG9zdC1jb250YWluZXIgLnJvb20tbmFtZSB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQoubWVtYmVyLWNvdW50IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgdG9wOiAwLjFlbTsNCiAgICBtYXJnaW4tcmlnaHQ6IDAuMjVlbTsNCn0NCg0KLm1lbWJlcnMtaWNvbiB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIGhlaWdodDogMmVtOw0KICAgIHdpZHRoOiAxLjI1ZW07DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL3VzZXItaW5hY3RpdmUtMTYucG5nIikgbm8tcmVwZWF0IGNlbnRlciBjZW50ZXI7ICAgIA0KICAgIG9wYWNpdHk6IDAuNzU7DQp9DQoNCi5tZW1iZXJzLW51bWJlciB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGJvdHRvbTogMC4yNWVtOw0KICAgIGxlZnQ6IDAuMjVlbTsNCiAgICBmb250LXNpemU6IDAuODVlbTsNCiAgICBjb2xvcjogIzhjOGM4YzsNCn0NCg0KLmZ1aS1zZWxlY3Rvci1ib2R5LXN1Ymxpc3QgLmFkZC1yb29tLWxpc3QtaXRlbSB7DQogICAgd2lkdGg6IDEwMCU7DQp9DQoNCi8qLmZ1aS1zZWxlY3Rvci1ib2R5LXN1Ymxpc3QgLmFkZC1yb29tLWxpc3QtaXRlbTpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRjsNCn0qLw0KDQouZnVpLXNlbGVjdG9yLWJvZHktc3VibGlzdCAuYWRkLXJvb20tYnV0dG9uIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouZnVpLXNlbGVjdG9yLWJvZHktc3VibGlzdCAuYWRkLXJvb20tYnV0dG9uOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiAjZjlmOWY5Ow0KfQ0KDQouZnVpLXNlbGVjdG9yLWJvZHktc3VibGlzdCAuYWRkLWxhYmVsIHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvYWRkLTE2LnBuZyIpIG5vLXJlcGVhdCBsZWZ0IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAwIDAuNWVtIDAgMS41ZW07DQogICAgY29sb3I6ICMzMzMzMzM7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQoucm9vbS1zZWxlY3RvciAuZnVpLXNlbGVjdG9yIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQoucm9vbS1zZWxlY3RvciAuZnVpLXNlbGVjdG9yLWhlYWRlciB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogMCAwLjVlbSAwIDAuNWVtOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYmFja2dyb3VuZDogI0Y4RjhGODsNCn0NCg0KLnJvb20tc2VsZWN0b3IgLmZ1aS1zZWxlY3Rvci1oZWFkZXIuYm91bmQtdmlzaWJsZS5uby1zZWxlY3Rvci1pdGVtcyB7DQogICAgbWFyZ2luOiAxLjRlbSAwIDEuNGVtIDFlbTsNCiAgICBoZWlnaHQ6IDA7DQp9DQoNCi5yb29tLXNlbGVjdG9yIC5mdWktc2VsZWN0b3ItaGVhZGVyIGJ1dHRvbiB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMmVtOw0KICAgIHBhZGRpbmctbGVmdDogMC41ZW07DQogICAgbWFyZ2luOiAwLjVlbSAwOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNBQUFBQUE7DQogICAgYm9yZGVyLXJhZGl1czogMnB4Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQp9DQoNCi5yb29tLXNlbGVjdG9yIC5mdWktc2VsZWN0b3ItYm9keSB7DQogICAgcmlnaHQ6IDAuNWVtOw0KICAgIHRvcDogMi41ZW07DQogICAgd2lkdGg6IGNhbGMoMTAwJSAtIDEuMWVtKTsNCiAgICBvdmVyZmxvdy15OiBhdXRvOw0KICAgIGJveC1zaGFkb3c6IDFweCAxcHggM3B4ICNEOUQ5RDk7DQogICAgcGFkZGluZzogMDsNCiAgICBtYXgtaGVpZ2h0OiBub25lOw0KICAgIHotaW5kZXg6IDEwMDAwOw0KfQ0KDQoucm9vbS1zZWxlY3RvciB1bC5mdWktc2VsZWN0b3ItYm9keSBsaSB7DQogICAgb3ZlcmZsb3c6IGluaXRpYWw7DQp9DQoNCi5mdWktc2VsZWN0b3ItYm9keS1zdWJsaXN0IHsNCiAgICBtYXJnaW4gOjA7DQogICAgcGFkZGluZzogMDsNCiAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7DQp9DQoNCi5mdWktc2VsZWN0b3ItYm9keS1zdWJsaXN0LnJvb20taXRlbS1saXN0IHsNCiAgICBvdmVyZmxvdzogYXV0bzsNCiAgICBtYXgtaGVpZ2h0OiAyMDBweDsNCiAgICBib3gtc2hhZG93OiAxcHggMnB4IDNweCAjRDlEOUQ5Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KLmZ1aS1zZWxlY3Rvci1ib2R5LXN1Ymxpc3Qucm9vbS1zZWxlY3Rvci1hY3Rpb25zIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBib3gtc2hhZG93OiBub25lOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGMUYxRjE7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQoucm9vbS1zZWxlY3RvciAuc2VsZWN0b3ItY2hlY2tib3ggew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5yb29tLXNlbGVjdG9yIC5zZWxlY3Rvci1pdGVtIC5yb29tLXNlbGVjdG9yLWxpc3QtaXRlbSB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7IA0KICAgIHBhZGRpbmctcmlnaHQ6IDVlbTsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQp9DQoNCi5yb29tLXNlbGVjdG9yIC5zZWxlY3Rvci1pdGVtOmhvdmVyIC5nY3gtdG9nZ2xlIC5pbnB1dC1sYWJlbDpiZWZvcmUgew0KICAgIGJveC1zaGFkb3c6IDAgMCAwIDAuNWVtICNGOUY5Rjk7DQp9DQoNCi5yb29tLXNlbGVjdG9yLWxpc3QtaXRlbSAuZ2N4LXRvZ2dsZSB7DQogICAgcGFkZGluZy1sZWZ0OiAyLjVlbTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi8qLnJvb20tc2VsZWN0b3IubmV3IC5mdWktc2VsZWN0b3ItaGVhZGVyIGJ1dHRvbiwqLw0KLnJvb20tc2VsZWN0b3ItbGlzdC1pdGVtIC5uZXcgLmlucHV0LWxhYmVsIHsNCiAgICBjb2xvcjogIzFBNzJDNDsNCn0NCg0KLnJvb20tc2VsZWN0b3ItbGlzdC1pdGVtIC5nY3gtdG9nZ2xlIC5pbnB1dC1sYWJlbDpiZWZvcmUgew0KICAgIHdpZHRoOiAyLjVlbTsNCiAgICBoZWlnaHQ6IDEuNWVtOw0KICAgIHRvcDogMC4xNWVtOw0KICAgIGJveC1zaGFkb3c6IDAgMCAwIDAuNWVtICNGRkZGRkY7DQp9DQoNCi5yb29tLXNlbGVjdG9yLWxpc3QtaXRlbSAuZ2N4LXRvZ2dsZSAuaW5wdXQtbGFiZWw6YWZ0ZXIgew0KICAgIHRvcDogMC4xNWVtOw0KICAgIHdpZHRoOiAxZW07DQogICAgaGVpZ2h0OiAxZW07DQp9DQoNCi5yb29tLXNlbGVjdG9yLWxpc3QtaXRlbSAuZ2N4LXRvZ2dsZSAuaW5wdXQtY2hlY2tib3g6Y2hlY2tlZCArIC5pbnB1dC1sYWJlbDphZnRlciB7DQogICAgbGVmdDogMWVtOw0KfQ0KDQoubm90aWZpY2F0aW9uLWNsZWFyLWJ1dHRvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAzMnB4Ow0KICAgIGhlaWdodDogMzJweDsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvcGFuZWwtY2xvc2UucG5nIikgY2VudGVyIG5vLXJlcGVhdDsNCiAgICByaWdodDogMDsNCiAgICB0b3A6IDNlbTsNCiAgICBvcGFjaXR5OiAwLjc1Ow0KICAgIHotaW5kZXg6IDEwOw0KICAgIC13ZWJraXQtdHJhbnNpdGlvbjogaGVpZ2h0IDAuMXM7DQogICAgdHJhbnNpdGlvbjogaGVpZ2h0IDAuMXM7DQp9DQoNCi5ldmVudC1mZWVkIC5ub3RpZmljYXRpb24tY2xlYXItYnV0dG9uIHsNCiAgICB0b3A6IGF1dG87DQogICAgYm90dG9tOiAwOw0KfQ0KDQoubmV3LXJvb21zLW5vdGlmaWNhdGlvbjpob3ZlciwgDQouY29sbGFib3JhdGlvbi1tZXNzYWdlLW5vdGlmaWNhdGlvbjpob3ZlciB7DQogICAgY29sb3I6ICMwMDAwMDA7DQp9DQoNCi8qIEVuZCByb29tIHNlbGVjdG9yKi8NCg0KLmV2ZW50LWRhdGEtY29udGFpbmVyIC5ldmVudC1pbWFnZSB7DQogICAgbWF4LXdpZHRoOiA4ZW07DQogICAgbWF4LWhlaWdodDogOGVtOw0KICAgIG1pbi13aWR0aDogMmVtOw0KICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQp9DQoNCi5ldmVudC1kYXRhLWNvbnRhaW5lciAuZXZlbnQtaW1hZ2UuZXJhc2VkIHsNCiAgICBjdXJzb3I6IGluaXRpYWw7DQp9DQoNCi5jb2xsYWJvcmF0aW9uLWNyZWF0ZS1yb29tLXBhbmVsIC5mb3JtLWl0ZW0gbGFiZWwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KfQ0KDQouY29sbGFib3JhdGlvbi1jcmVhdGUtcm9vbS1wYW5lbCAuZm9ybS1pdGVtIGxhYmVsLmNvbG9yLXN3YXRjaCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQouY29sb3Itc3dhdGNoZXMgZmllbGRzZXQgew0KICAgIHBhZGRpbmc6IDAuNWVtIDAgMCAwOw0KfQ0KDQouY29sbGFib3JhdGlvbi1jcmVhdGUtcm9vbS1wYW5lbCAuZ3JhbnQtZWRpdG9yLXRhYmxlIC5ncmFudC1uYW1lLWxhYmVsIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIG1hcmdpbi1sZWZ0OiAxLjc1ZW07DQogICAgcGFkZGluZy1yaWdodDogMS45ZW07DQp9DQoNCi5jb2xsYWJvcmF0aW9uLWNyZWF0ZS1yb29tLXBhbmVsIC5ncmFudC1lZGl0b3ItdGFibGUgaW1nIHsNCiAgICBoZWlnaHQ6IGF1dG87DQogICAgdG9wOiAwOw0KICAgIGJvdHRvbTogMDsNCiAgICBtYXJnaW46IGF1dG8gMDsNCn0NCg0KLmNvbGxhYm9yYXRpb24tY3JlYXRlLXJvb20tcGFuZWwgLmdyYW50LWVkaXRvci10YWJsZSAuZ3JhbnQtbmFtZS1jb2x1bW4gew0KICAgIHBhZGRpbmc6IDAuNGVtOw0KfQ0KDQouY29sbGFib3JhdGlvbi1jcmVhdGUtcm9vbS1wYW5lbCBpbnB1dDotbXMtaW5wdXQtcGxhY2Vob2xkZXIgew0KICAgIGZvbnQtc2l6ZTogMWVtOw0KfQ0KDQouY29sbGFib3JhdGlvbi1jcmVhdGUtcm9vbS1wYW5lbCAuZ3JhbnQtZWRpdG9yLXNlYXJjaC1vcHRpb25zIHsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQouY29sbGFib3JhdGlvbi1jcmVhdGUtcm9vbS1wYW5lbCAuZ3JhbnQtZWRpdG9yLXNlYXJjaC1vcHRpb25zIHNlbGVjdCB7DQogICAgcGFkZGluZzogMDsNCn0NCg0KLmNvbGxhYm9yYXRpb24tY3JlYXRlLXJvb20tcGFuZWwgLmRpc3BsYXktbmFtZS1pbnB1dCB7DQogICAgbWFyZ2luLXRvcDogMC4zZW07DQp9DQoNCi5tZW1iZXItbmFtZS1saXN0IHsNCiAgICBsaXN0LXN0eWxlOiBub25lOw0KICAgIHBhZGRpbmctbGVmdDogMDsNCiAgICBtYXJnaW46IDA7DQogICAgaGVpZ2h0OiAxNWVtOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQogICAgYm9yZGVyOiAjRDlEOUQ5IHNvbGlkIDFweDsNCn0NCg0KLmFjdGl2ZS1tZW1iZXItY291bnQ6YmVmb3JlIHsNCiAgICBjb250ZW50OiAiKCI7DQp9DQoNCi5hY3RpdmUtbWVtYmVyLWNvdW50OmFmdGVyIHsNCiAgICBjb250ZW50OiAiKSI7DQp9DQoNCg0KLm1lbWJlci1uYW1lLWxpc3QgbGkgew0KICAgIHBhZGRpbmc6IDAuMjVlbSAwLjVlbTsNCn0NCg0KLmNvbGxhYm9yYXRpb24tcm9vbS1kZXRhaWxzLWZpZWxkIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd29yZC1icmVhazogYnJlYWstYWxsOw0KfQ0KDQovKiBEcmF3aW5nIG11bHRpLXRvb2wgKi8NCg0KLm9wZW4tZmx5b3V0LWJ1dHRvbiB7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgd2lkdGg6IDIuMjVlbTsNCiAgICBoZWlnaHQ6IDIuNzVlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgYm9yZGVyLXJhZGl1czogMC4yNXJlbTsNCiAgICBib3gtc2hhZG93OiBub25lOw0KICAgIHBhZGRpbmc6IDA7DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL2ljb25zL2Fycm93LWRvd24tc21hbGwtMjQucG5nIikgbm8tcmVwZWF0IGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kLXNpemU6IDEuOTVlbTsNCiAgICBwb2ludGVyLWV2ZW50czogYXV0bzsNCn0NCg0KLm9wZW4tZmx5b3V0LWJ1dHRvbi5kaXNhYmxlZDpob3ZlciwNCi5vcGVuLWZseW91dC1idXR0b24uZGlzYWJsZWQ6Zm9jdXMsDQouZHJhd2luZy10b29sLWl0ZW0uZGlzYWJsZWQ6aG92ZXIsDQouZHJhd2luZy10b29sLWl0ZW0uZGlzYWJsZWQ6Zm9jdXMgew0KICAgIGJhY2tncm91bmQtY29sb3I6IG5vbmUgIWltcG9ydGFudDsNCiAgICBib3JkZXItY29sb3I6IG5vbmUgIWltcG9ydGFudDsNCn0NCg0KLm9wZW4tZmx5b3V0LWJ1dHRvbjpob3ZlciwNCi5vcGVuLWZseW91dC1idXR0b24uaGlnaGxpZ2h0LA0KLmRyYXdpbmctdG9vbC1pdGVtOmhvdmVyLA0KLmRyYXdpbmctdG9vbC1pdGVtLmhpZ2hsaWdodCwNCmxvY2F0aW9uLWJ1dHRvbjpob3ZlciwNCi5jaGF0LWNvbnRyb2xzIC5maWxlcGlja2VyIC5mb3JtLWxhYmVsOmhvdmVyLA0KLnN0eWxlLWJ1dHRvbjpob3ZlciwNCi5sb2NhdGlvbi1idXR0b246aG92ZXIsDQoubG9jYXRpb24tYnV0dG9uLmFjdGl2ZSwNCi5sb2NhdGlvbi1idXR0b246aG92ZXI6bm90KC5ib3VuZC1kaXNhYmxlZCkgew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjMUE3MkM0Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNFOUY2RkY7DQogICAgY29sb3I6ICMzMzMzMzM7DQp9DQoNCi5jaGF0LWNvbnRyb2xzLWlucHV0LWFyZWEgLmRyYXdpbmctbXVsdGktdG9vbC1pdGVtLmFjdGl2ZSAuZHJhd2luZy10b29sLWl0ZW0gew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjQzhFOUZGOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNFOUY2RkY7DQogICAgY29sb3I6ICMzMzMzMzM7DQp9DQoNCi5kcmF3aW5nLXRvb2wtaXRlbSB7DQogICAgbWluLXdpZHRoOiA0ZW07DQogICAgcGFkZGluZzogMDsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGJveC1zaGFkb3c6IG5vbmU7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouZHJhd2luZy10b29sLWl0ZW0gcCwNCi5kcmF3aW5nLXRvb2wtaXRlbSBsYWJlbCB7DQogICAgbWFyZ2luOiAwIDAuNWVtIDAuNWVtIDAuNWVtOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjI1ZW07DQogICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KfQ0KDQouZHJhd2luZy10b29sLWl0ZW0uc2VsZWN0ZWQgew0KICAgIGJvcmRlcjogMXB4IHNvbGlkICMxQTcyQzQ7DQogICAgYmFja2dyb3VuZDogI0U5RjZGRjsNCn0NCg0KLmRyYXdpbmctdG9vbC1pdGVtLmhpZ2hsaWdodCB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0M4RTlGRjsNCiAgICBiYWNrZ3JvdW5kOiAjRTlGNkZGOw0KfQ0KDQouZHJhd2luZy10b29sLWl0ZW0uYm91bmQtZGlzYWJsZWQgew0KICAgIG9wYWNpdHk6IDAuMzsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MzApOw0KICAgIGN1cnNvcjogZGVmYXVsdDsNCn0NCg0KLmRyYXdpbmctdG9vbC1pdGVtID4gaW1nLA0KLmRyYXdpbmctdG9vbC1pdGVtID4gc3Bhbi5pY29uIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBtYXJnaW46IDAuNWVtIGF1dG87DQogICAgd2lkdGg6IDI0cHg7DQogICAgaGVpZ2h0OiAyNHB4Ow0KfQ0KDQouZHJhd2luZy1tdWx0aS10b29sIHsNCiAgICB3aWR0aDogNWVtOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBtYXJnaW4tdG9wOiAwLjc1ZW07DQogICAgei1pbmRleDogMTA7DQp9DQoNCi5kcmF3aW5nLXRvb2wtaXRlbS1sYWJlbCB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgd2lkdGg6IDEwMCU7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIG1hcmdpbjogMDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAwLjhlbTsNCn0NCg0KLmRyYXdpbmctbXVsdGktdG9vbCAuZHJhd2luZy10b29sLWl0ZW0gew0KICAgIHdpZHRoOiA1ZW07DQp9DQoNCi5kcmF3aW5nLW11bHRpLXRvb2wtaXRlbSAuZHJhd2luZy10b29sLWl0ZW0gPiBpbWcgew0KICAgIHBhZGRpbmc6IDAuMjVlbSAyLjE1ZW0gMC41ZW0gMC41ZW07DQogICAgbWFyZ2luOiAwIGF1dG87DQp9DQoNCi5kcmF3aW5nLW11bHRpLXRvb2wtaXRlbS5tdWx0aS10b29sLWNob29zZXIgLmRyYXdpbmctdG9vbC1pdGVtIHsNCiAgICBtaW4td2lkdGg6IDA7DQp9DQoNCi5kcmF3aW5nLW11bHRpLXRvb2wtaXRlbS5tdWx0aS10b29sLWNob29zZXIgLmRyYXdpbmctdG9vbC1pdGVtID4gaW1nIHsNCiAgICBwYWRkaW5nOiAwOw0KICAgIG1hcmdpbjogMC41ZW0gYXV0bzsNCn0NCg0KLmRyYXdpbmctbXVsdGktdG9vbC1pdGVtIHsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVlbTsNCn0NCg0KLmRyYXdpbmctbXVsdGktdG9vbC1jaG9vc2VyIHsNCiAgICB3aWR0aDogMi4yNWVtOw0KICAgIHRvcDogMXB4Ow0KICAgIHJpZ2h0OiAtMXB4Ow0KICAgIG1hcmdpbjogMDsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCg0KLmRyYXdpbmctbXVsdGktdG9vbC1jaG9vc2VyIGltZyB7DQogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJvcmRlci1yaWdodDogMXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KfQ0KDQouZHJhd2luZy1tdWx0aS10b29sLWNob29zZXI6aG92ZXIgaW1nIHsNCiAgICBib3JkZXItbGVmdC1jb2xvcjogdHJhbnNwYXJlbnQ7DQp9DQoNCi50b3VjaCAuZHJhd2luZy1tdWx0aS10b29sLWNob29zZXIgLmRyYXdpbmctdG9vbC1pdGVtIGltZyB7DQogICAgcGFkZGluZzogMCAwLjc1ZW07DQp9DQoNCi5kcmF3aW5nLXRvb2wtbGlzdCB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5kcmF3aW5nLXRvb2wtbGlzdCBsaSB7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQouZHJhd2luZy10b29sLWxpc3QgPiBsaSBwIHsNCiAgICBmb250LXNpemU6IDAuOWVtOw0KfQ0KDQouZHJhd2luZy1tdWx0aS10b29sLWRyb3Bkb3duIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIHBhZGRpbmc6IDAuMTI1ZW07DQogICAgLXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMC4yNWVtOw0KICAgIC13ZWJraXQtYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMC4yNWVtOw0KICAgIC1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDogMC4yNWVtOw0KICAgIC1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0OiAwLjI1ZW07DQogICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDAuMjVlbTsNCiAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwLjI1ZW07DQogICAgbWF4LXdpZHRoOiAyMGVtOw0KICAgIHotaW5kZXg6IDYwMTsNCiAgICBib3R0b206IDQuMTVlbTsNCn0NCg0KLmNvbGxhYm9yYXRpb24tbXVsdGktdG9vbC1kcm9wZG93bi1jb250YWluZXIgew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB3aWR0aDogMjJlbTsNCn0NCg0KLnN0eWxlLWJ1dHRvbiB7DQogICAgd2lkdGg6MTAwJTsgDQogICAgdGV4dC1hbGlnbjpjZW50ZXI7DQogICAgcGFkZGluZyA6MC4yNWVtIDAuMjVlbSAwLjI1ZW0gMS41ZW07DQogICAgbWFyZ2luOiAwLjNlbSAwIDAuMjVlbSAwOw0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9pY29ucy90b29sYmFyL3N0eWxlcy0yNC5wbmciKSBuby1yZXBlYXQgMC4yNWVtIGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kLXNpemU6IDEuMjVlbTsNCn0NCg0KLmxvY2F0aW9uLWJ1dHRvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogNWVtOw0KICAgIHdpZHRoOiA2NXB4Ow0KICAgIG1hcmdpbi10b3A6IDAuNWVtOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAwOw0KICAgIHBhZGRpbmctYm90dG9tOiAwLjI1ZW07DQogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7DQogICAgei1pbmRleDogMTA7DQp9DQoNCi5sb2NhdGlvbi1idXR0b24uYm91bmQtZGlzYWJsZWQgew0KICAgIGN1cnNvcjogZGVmYXVsdDsNCiAgICBvcGFjaXR5OiAwLjM7DQp9DQoNCg0KLyogRW5kIGRyYXdpbmcgbXVsdGktdG9vbCAqLw0KDQo="),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/CSS/large.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/CSS/medium.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/CSS/small.css","css","LyogbW9iaWxlIG1vZGUgdHJhbnNpdGlvbiBhbmltYXRpb24gc3VwcG9ydCAqLw0KDQouZXZlbnQtbGlzdC1jb250YWluZXIgew0KICAgIC13ZWJraXQtdHJhbnNpdGlvbi1wcm9wZXJ0eTogdG9wIGJvdHRvbTsNCiAgICAtd2Via2l0LXRyYW5zaXRpb24tZHVyYXRpb246IDAuMnM7DQogICAgdHJhbnNpdGlvbi1wcm9wZXJ0eTogdG9wLCBib3R0b207DQogICAgdHJhbnNpdGlvbi1kdXJhdGlvbjogMC4yczsNCiAgICB0b3A6IDIuNWVtOw0KfQ0KDQouZXZlbnQtbGlzdC1jb250YWluZXIucm9vbS1zZWxlY3Rvci1vcGVuIHsNCiAgICB0b3A6IDIuNWVtOw0KfQ0KDQoucm9vbS1zZWxlY3RvciB7DQogICAgdHJhbnNpdGlvbjogaGVpZ2h0IDAuMnM7DQogICAgLXdlYmtpdC10cmFuc2l0aW9uOiBoZWlnaHQgMC4yczsNCn0NCg0KLnJvb20tc2VsZWN0b3IgLmZ1aS1zZWxlY3Rvci1oZWFkZXIgYnV0dG9uIHsNCiAgICBtYXJnaW46IDAuMjVlbSAwOw0KfQ0KDQoucm9vbS1zZWxlY3RvciAuZnVpLXNlbGVjdG9yLWhlYWRlciB7DQogICAgcGFkZGluZzogMCAwLjI1ZW07DQp9DQoNCi5yb29tLXNlbGVjdG9yIC5mdWktc2VsZWN0b3ItYm9keSB7DQogICAgd2lkdGg6IGNhbGMoMTAwJSAtIDAuNjVlbSk7DQogICAgcmlnaHQ6IDAuMjVlbTsNCiAgICB0b3A6IDIuMjVlbTsNCn0NCg0KLmNoYXQtY29udHJvbHMgew0KICAgIHRyYW5zaXRpb246IGJvdHRvbSAwLjJzOw0KICAgIC13ZWJraXQtdHJhbnNpdGlvbjogYm90dG9tIDAuMnM7DQp9DQoNCi5jaGF0LWNvbnRyb2xzLm1pbmltaXplZC1tb2RlIC5jaGF0LXRleHQtYm94IHsNCiAgICBib3JkZXItd2lkdGg6IDA7DQogICAgcGFkZGluZzogMWVtIDAuNWVtOw0KICAgIGhlaWdodDogMi41ZW07DQp9DQoNCi5jaGF0LWNvbnRyb2xzLm1pbmltaXplZC1tb2RlIC5pbWFnZS11cGxvYWQsDQouY2hhdC1jb250cm9scy5taW5pbWl6ZWQtbW9kZSAuZHJhd2luZy1tdWx0aS10b29sLA0KLmNoYXQtY29udHJvbHMubWluaW1pemVkLW1vZGUgLnBvc3QtdHlwZS1zZWxlY3RvciB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLmNoYXQtY29udHJvbHMubWluaW1pemVkLW1vZGUgew0KICAgIGJvdHRvbTogLThlbTsgICANCn0NCg0KLmV2ZW50LWxpc3QtY29udGFpbmVyLm1pbmltaXplZC1tb2RlIHsNCiAgICBib3R0b206IDMuNWVtOw0KfQ0KDQoucm9vbS1zZWxlY3RvciAubmV3LXJvb21zLW5vdGlmaWNhdGlvbiB7DQogICAgdG9wOiAyLjVlbTsNCn0NCg0KLnJvb20tc2VsZWN0b3IubmV3IC5ub3RpZmljYXRpb24tY2xlYXItYnV0dG9uIHsNCiAgICB0b3A6IDIuNWVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/BannerEvent/BannerEventView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/CardEvent/CardEventContentView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/CardEvent/CardEventView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/EventActionsMenu.html","html",n),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/EventCopyView.html","html",a),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/EventEditView.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/ImageEvent/ImageEventContentView.html","html",s),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/MessageEvent/MessageEventContentView.html","html",l),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventContentView.html","html",c),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Rooms/EditRoomView.html","html",d),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Rooms/RoomDetailsView.html","html",p),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/AfterAction/AfterActionSelectorView.html","html",u),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/AfterAction/AfterActionView.html","html",g),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/Collaboration/CollaborationDrawingToolFlyoutView.html","html",b),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/Collaboration/CollaborationFilePicker.html","html",m),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/Collaboration/CollaborationMarkupStyleSelectorView.html","html",h),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorItemTemplate.html","html",v),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorView.html","html",C),e.resourceManager.register("Mapping","inv","Mapping/modules/Collaboration/Views/Collaboration/CollaborationView.html","html",y)}),require({cache:{}}),define(["Mapping/modules/Collaboration/Views/Collaboration/CollaborationSelectorView","Mapping/modules/Collaboration/Rooms/RoomDetailsView","Mapping/modules/Collaboration/Rooms/EditRoomView","Mapping/modules/Collaboration/Events/CardEvent/CardEventView","Mapping/modules/Collaboration/Events/MessageEvent/MessageEventView","Mapping/modules/Collaboration/Events/ImageEvent/ImageEventView","Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventView","Mapping/modules/Collaboration/Events/MessageEvent/MessageEventViewModel","Mapping/modules/Collaboration/Events/ShareMarkupEvent/ShareMarkupEventViewModel","Mapping/modules/Collaboration/Events/ImageEvent/ImageEventViewModel","Mapping/modules/Collaboration/Events/UserLeftEvent/UserLeftEventView","Mapping/modules/Collaboration/Events/UserLeftEvent/UserLeftEventViewModel","Mapping/modules/Collaboration/Events/UserJoinedEvent/UserJoinedEventView","Mapping/modules/Collaboration/Events/UserJoinedEvent/UserJoinedEventViewModel","Mapping/modules/Collaboration/Events/DeleteMarkupEvent/DeleteMarkupEventView","Mapping/modules/Collaboration/Events/DeleteMarkupEvent/DeleteMarkupEventViewModel","Mapping/modules/Collaboration/Views/AfterAction/AfterActionSelectorView"],function(t,o,i,n,a,r,s,l,c,d,p,u,g,b,m,h,v){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.CollaborationSelectorView",t.CollaborationSelectorView),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.RoomDetailsView",o.RoomDetailsView),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.EditRoomView",i.EditRoomView),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.CardEventView",n.CardEventView),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.MessageEventView",a.MessageEventView),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.ImageEventView",r.ImageEventView),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.ShareMarkupEventView",s.ShareMarkupEventView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.MessageEventViewModel",l.MessageEventViewModel),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.ShareMarkupEventViewModel",c.ShareMarkupEventViewModel),e(d,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.ImageEventViewModel",d.ImageEventViewModel),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.UserLeftEventView",p.UserLeftEventView),e(u,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.UserLeftEventViewModel",u.UserLeftEventViewModel),e(g,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.UserJoinedEventView",g.UserJoinedEventView),e(b,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.UserJoinedEventViewModel",b.UserJoinedEventViewModel),e(m,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.DeleteMarkupEventView",m.DeleteMarkupEventView),e(h,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.DeleteMarkupEventViewModel",h.DeleteMarkupEventViewModel),e(v,"geocortex.essentialsHtmlViewer.mapping.modules.collaboration.AfterActionSelectorView",v.AfterActionSelectorView)})}();