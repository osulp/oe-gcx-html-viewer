!function(){function e(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var o=t.split("."),n=null,r=window,s=0,a=o.length;s<a;s++)n=o[s],s==a-1?r[n]=i:r[n]||(r[n]={}),r=r[n];else console.warn("Undefined shim for: "+t)}var t="<div class='no-item' data-binding='{@hidden: visibleMenuItems}{@text: @language-menu-no-items}'></div><ul class='list-menu has-icon' data-binding='{@visible: visibleMenuItems}{@source: visibleMenuItems}'>    <li class='list-menu-item' data-binding='{@template-for: visibleMenuItems}'>        <button class='list-menu-button' data-binding='{@event-onmouseover: getDescription}{@event-onclick: handleMenuItemClick}'>            <img class='list-menu-icon' data-binding='{src: iconUri}{@visible: iconUri}' alt=' ' />            <span class='list-menu-details'>                <strong class='list-menu-name' data-binding='{@text: text}'></strong>                <span class='list-menu-desc' data-binding='{@visible: description}{@text: description}'></span>            </span>        </button>    </li></ul>",i="<div class='project-editor'>    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: @language-common-loading}'></div>    </div>    <div class='project-editor-content' data-binding='{@hidden: isBusy}'>        <div class='form-stacked'>            <div class='form-item'>                <label class='form-label'>                    <span data-binding='{@text: @language-project-editor-name-label}'></span>                    <input type='text' data-binding='{@value: name}{title: @language-project-editor-name-title}{@event-oninput: handleInputChanged}' />                </label>            </div>            <div class='form-validation' data-binding='{@visible: inputErrorMessage}'>                <span class='field-validation-error' data-binding='{@text: inputErrorMessage}'></span>            </div>            <div class='form-item'>                <label class='form-label'>                    <span data-binding='{@text: @language-project-editor-description-label}'></span>                    <textarea type='text' data-binding='{@value: description}{title: @language-project-editor-description-title}'></textarea>                </label>            </div>            <div class='form-item' data-binding='{@visible: projectUrl}'>                <label class='form-label' data-binding='{@text: @language-project-url-label}'></label>                <input type='text' readonly data-binding='{@value: projectUrl}{aria-label: @language-project-url-title}' />            </div>            <div class='form-btns'>                <button class='button' data-binding='{title: @language-project-editor-save-button-title}{@text: @language-common-save}{@event-onclick: handleSaveButtonClick}{@disabled: inputErrorMessage}'></button>                <button class='button' data-binding='{title: @language-project-editor-cancel-button-title}{@text: @language-common-cancel}{@event-onclick: handleCancelButtonClick}'></button>            </div>        </div>    </div></div>",o="<div class='project-status'>    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: statusMessage}'></div>    </div>    <div class='project-status-complete' data-binding='{@hidden: isBusy}'>        <p data-binding='{@text: @language-project-status-saved-complete}'></p>        <p data-binding='{@text: @language-project-status-saved-description}'></p>        <div class='form-item' data-binding='{@visible: showProjectUrl}'>            <p data-binding='{@text: @language-project-status-saved-url-description}'></p>            <input type='text' title='project complete' readonly data-binding='{@value: projectUrl}{aria-label: @language-share-project-status-view-label}' />        </div>        <div class='form-btns'>            <button class='button' data-binding='{title: @language-project-status-share-button-title}{@text: @language-common-share}{@event-onclick: handleShareButtonClick}'></button>            <button class='button' data-binding='{title: @language-project-status-close-button-title}{@text: @language-common-close}{@event-click: handleCloseButtonClick}'>Close</button>        </div>    </div></div>",n="<div data-binding='{@widget: ProjectsActionsWidget}{@widget-required: false}' data-menu-id='ProjectsActions' data-menu-template='Mapping/infrastructure/menus/MenuView.html'></div><div class='projects'>    <div class='projects-options'>        <div class='panel-filter-widget' data-binding='{@widget: ProjectFilterWidget}{@widget-context: @context}{@widget-required: true}'></div>        <div class='project-selector-tools'>            <label class='form-label project-checkbox' data-binding='{@visible: isAuthenticated}'>                <input type='checkbox' data-binding='{@value: privateProjectsOnly}' />                <span data-binding='{@text: @language-projects-private-projects-label}'></span>            </label>            <span class='project-selector-dropdown'>                <select data-binding='{@source: fieldSorters}{@value: selectedFieldSorter}{aria-label: @language-projects-sort-selector-title}'>                    <option data-binding='{@template-for: fieldSorters}{@text: displayName}{@attach: @context}' />                </select>            </span>        </div>    </div>    <div class='projects-list-container'>        <div class='projects-status-message' data-binding='{@hidden: isBusy}'>            <span data-binding='{@text: @language-project-status-offline}{@visible: statusOffline}'></span>            <span data-binding='{@hidden: statusOffline}'>                <span data-binding='{@text: @language-project-status-empty}{@visible: statusEmpty}'></span>            </span>        </div>        <div class='loading-container' data-binding='{@visible: isBusy}'>            <div class='loading-img'></div>            <div class='loading-msg' data-binding='{@text: @language-common-loading}'></div>        </div>        <div class='projects-list' data-binding='{@hidden: isBusy}'>            <ul class='list-menu' data-binding='{@source: projectsPage}'>                <li class='item-list-item' data-binding='{@template-for: projectsPage}'>                    <div class='project-info'>                        <button class='list-item-button' data-binding='{@event-click: handleProjectClick}'>                            <img class='list-item-icon' data-binding='{src: thumbnail}{title: name}{alt: name}{@event-error: handleThumbnailLoadError}' />                            <div class='project-overview'>                                <span class='project-name' data-binding='{@text: name}'></span>                                <span class='project-modified' data-binding='{@text: lastModifiedBy}'></span>                                <span class='project-created' data-binding='{@text: createdBy}'></span>                            </div>                        </button>                        <div class='project-details'>                            <div class='project-description' data-binding='{@text: description}'></div>                            <a href='#' class='more-button' data-binding='{@visible: canExpand}{@event-onclick: handleProjectExpanderClick}{@text: @language-projects-description-more}'></a>                        </div>                    </div>                    <button class='list-item-button project-actions chevron-right-16' data-binding='{title: @language-project-actions-tooltip}{@event-click: handleProjectActions}'></button>                </li>            </ul>        </div>    </div>    <div data-binding='{@hidden: statusEmpty}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-replace: false}'></div></div>",r="<div class='share-project'>    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: statusMessage}'></div>    </div>    <div class='share-project-content' data-binding='{@hidden: isBusy}'>        <div class='form-stacked'>            <div data-binding='{@visible: isOwner}'>                <h2 data-binding='{@text: @language-share-project-privileges-title}'></h2>                <p data-binding='{@text: @language-share-project-privileges-description}'></p>            </div>            <div class='form-item' data-binding='{@visible: projectUrl}'>                <label class='form-label' data-binding='{@text: @language-project-url-label}'></label>                <div class='form-control'>                    <input type='text' readonly data-binding='{@value: projectUrl}{aria-label: @language-project-url-title}' />                </div>            </div>            <div data-binding='{@visible: isOwner}'>                <div class='form-item share-with'>                    <label class='form-label' data-binding='{@text: @language-share-project-share-with-label}'></label>                </div>                <div data-binding='{@widget: GrantEditorWidget}{@widget-context: @context}{@widget-replace: true}'></div>                <div class='share-project-links' data-binding='{@visible: showGuestLinks}'>                    <h2 class='share-project-links-title' data-binding='{@text: @language-share-project-links-title}'></h2>                    <p data-binding='{@text: @language-share-project-links-description}'></p>                    <div data-binding='{@source: guestLinks}'>                        <div class='form-item' data-binding='{@template-for: guestLinks}'>                            <label class='form-label' data-binding='{@text: name}'></label>                            <div class='form-control'>                                <input class='link-box' type='text' readonly data-binding='{@value: linkUrl}{aria-label: name}' />                                <div class='inline-block project-link-buttons'>                                    <button class='button add-16' data-binding='{@hidden: linkUrl}{title: @language-share-project-links-add-button-title}{@event-onclick: handleAddLinkButtonClick}'></button>                                    <button class='button clear-24' data-binding='{@visible: linkUrl}{title: @language-share-project-links-remove-button-title}{@event-onclick: handleRemoveLinkButtonClick}'></button>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>        <div class='form-btns'>            <div class='share-project-buttons' data-binding='{@visible: isOwner}'>                <button class='button' data-binding='{title: @language-share-project-clear-button-title}{@text: @language-share-project-clear-button-text}{@event-onclick: handleClearButtonClick}'></button>                <button class='button' data-binding='{title: @language-share-project-save-button-title}{@text: @language-share-project-save-button-text}{@event-onclick: handleSaveButtonClick}'></button>                <button class='button' data-binding='{title: @language-share-project-cancel-button-title}{@text: @language-common-cancel}{@event-onclick: handleCloseButtonClick}'></button>            </div>            <div data-binding='{@hidden: isOwner}'>                <button class='button' data-binding='{title: @language-share-project-close-button-title}{@text: @language-common-close}{@event-onclick: handleCloseButtonClick}'></button>            </div>        </div>    </div></div>";require({cache:{"Mapping/modules/Project/ProjectActionsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/infrastructure/menus/MenuView"],function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o._registerCommandsAndEvents(),o}return e(i,t),i.prototype.handleMenuItemClick=function(e,i,o){this.app.command("DeactivateView").execute(this.id),t.prototype.handleMenuItemClick.call(this,e,i,o)},i.prototype._registerCommandsAndEvents=function(){this.app.command("ShowProjectActions").register(this,this._executeShowProjectActions)},i.prototype._executeShowProjectActions=function(e){e&&(this.title.set(e.title),this.viewModel.menuContext.set(e),this.app.command("ActivateView").execute(this.id))},i}(o.MenuView);i.ProjectActionsView=n})},"Mapping/modules/Project/ProjectEditorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation"],function(t,i,o,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o._listenForDataFrameEvents=!0,o._validationDelayMS=300,o._keyDownTimer=null,o._registerCommandsAndEvents(),o}return e(i,t),i.prototype.attach=function(e){var i=this;t.prototype.attach.call(this,e),this._keyDownTimer=new n.TimeDelayedAction(this._validationDelayMS,function(){return i.viewModel.validateInput()},this)},i.prototype.activated=function(){t.prototype.activated.call(this),this._listenForDataFrameEvents=!1},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this._listenForDataFrameEvents=!0,this.viewModel.reset()},i.prototype.handleInputChanged=function(e,t,i){this.viewModel.handleInputChanged(),this._keyDownTimer.reset()},i.prototype.handleSaveButtonClick=function(e,t,i){this.viewModel.finishEditing()},i.prototype.handleCancelButtonClick=function(e,t,i){this.viewModel.finishEditing(!0)},i.prototype._registerCommandsAndEvents=function(){var e=this;this.app.command("ShowProjectEditor").register(this,this._executeShowProjectEditor,this._canExecuteShowProjectEditor),this.app.event("DataFrameOpenedEvent").subscribe(this,function(){return e._handleDataFrameEvent(!0)}),this.app.event("DataFrameClosedEvent").subscribe(this,function(){return e._handleDataFrameEvent(!1)})},i.prototype._executeShowProjectEditor=function(e){"object"!=typeof e||e.id?this.title.set(this.getResource("language-project-editor-title")):this.title.set(this.getResource("language-project-save-title")),this.viewModel.startEditing(e),this.app.command("ActivateView").execute(this.id)},i.prototype._canExecuteShowProjectEditor=function(e){return"string"==typeof e||!!e&&this.app.site.documentStore.isOwner(e)},i.prototype._handleDataFrameEvent=function(e){this._listenForDataFrameEvents&&(this.viewModel.dataFrameIsOpen=e)},i}(o.ViewBase);i.ProjectEditorView=r})},"Mapping/modules/Project/ProjectEditorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/essentials/documents/DocumentConstants","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/project/ProjectManager"],function(t,i,o,n,r,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a="{0}_exact".format(o.DocumentField.TITLE),c=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=new r.Observable,e.description=new r.Observable,e.projectUrl=new r.Observable,e.isBusy=new r.Observable(!1),e.inputErrorMessage=new r.Observable,e.dataFrameIsOpen=e.app.dataFrameIsOpen,e}return e(i,t),i.prototype.startEditing=function(e){var t=this;this.isBusy.set(!0),this.app.project.getProject(e,!1).then(function(e){return t.app.project.validateProjectOwnership(e)}).then(function(e){return t._updateModel(e)}).catch(function(e){t.app.trace.error("Error editing project: {0}".format(e.message),e),t.reset()}).finally(function(){return t.isBusy.set(!1)})},i.prototype.finishEditing=function(e){var t=this;void 0===e&&(e=!1);var i={existingProject:this.project,newProject:null,canceled:e};return e?(this._deactivateView(),Promise.resolve(this.app.event("ProjectEditorFinishedEvent").publish(i))):this.validateInput().then(function(){i.newProject={title:t.name.get().trim(),description:t.description.get()},t._deactivateView(),t.app.event("ProjectEditorFinishedEvent").publish(i)})},i.prototype.validateInput=function(){var e=this;if(this._validateInputPromise)return this._validateInputPromise;var t=this.name.get()?this.name.get().trim():"";return this.project&&this.project.id&&this.project.title&&this.project.title===t?Promise.resolve():this._validateInputPromise=Promise.resolve().then(function(){if(String.isNullOrEmpty(t))throw new Error(e.getResource("language-project-editor-error-name-required"))}).then(function(){return e.app.site.documentStore.query(e._buildNameQueryParams(t))}).then(function(i){if(i.total>0)throw new Error(e.getResource("language-project-editor-error-name-exists").format(t))}).catch(function(t){return e.inputErrorMessage.set(t.message),Promise.reject(t)}).finally(function(){e._validateInputPromise=null})},i.prototype.handleInputChanged=function(){this.inputErrorMessage.get()&&this.name.get()&&!String.isNullOrEmpty(this.name.get().trim())&&this.inputErrorMessage.set("")},i.prototype.reset=function(){this.project=null,this.name.set(""),this.description.set(""),this.projectUrl.set(""),this.inputErrorMessage.set("")},i.prototype._buildNameQueryParams=function(e){var t=[];return t.push(this.app.site.documentStore.userFilter),t.push({field:a,method:o.FilterMethod.VALUES,range:[{string:e}]}),t.push({field:o.DocumentField.FILE_TYPE,method:o.FilterMethod.VALUES,range:[{string:s.PROJECT_TYPE}]}),{filters:{require:t},limit:0}},i.prototype._updateModel=function(e){this.project=e,this.name.set(e.title),this.description.set(e.description),this.projectUrl.set(this.app.project.getProjectUrl(e))},i.prototype._deactivateView=function(){this.app.command("DeactivateView").execute("ProjectEditorView"),this.dataFrameIsOpen||this.app.command("CloseDataFrame").execute()},i}(n.ViewModelBase);i.ProjectEditorViewModel=c})},"Mapping/modules/Project/ProjectModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/FrameworkObject","geocortex/framework/observables","geocortex/infrastructure/FormatUtils"],function(t,i,o,n,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(e,i,o){var r=t.call(this,e,i)||this;return r.description=new n.Observable,r.canExpand=!1,r.isExpanded=new n.Observable(!1),o&&r.update(o),r.isExpanded.bind(r,r._onIsExpandedChanged),r}return e(i,t),i.prototype.update=function(e){this.project=e,this.name=e.title||"",this.projectUrl=this.app.project.getProjectUrl(e),e.thumbnail&&(e.thumbnail.location?this.thumbnail=e.thumbnail.location:e.thumbnail.text&&(this.thumbnail=e.thumbnail.text)),String.isNullOrEmpty(this.thumbnail)&&(this.thumbnail=" "),e.description&&e.description.length>100?(this.canExpand=!0,this.description.set(this._trunc(e.description,100))):(this.canExpand=!1,this.description.set(e.description||""));var t=this.getResource("language-projects-created-by-label"),i=e.author?e.author.title:this.getResource("language-projects-author-guest"),o=r.formatDateFromNow(e.timeOfCreation);this.createdBy="{0} {1} {2}".format(t,i,o);var n=this.getResource("language-projects-last-modified-by-label"),s=e.editor?e.editor.title:this.getResource("language-projects-author-guest"),a=r.formatDateFromNow(e.timeOfLastModification);this.lastModifiedBy="{0} {1} {2}".format(n,s,a)},i.prototype._onIsExpandedChanged=function(e){this.canExpand&&(e?this.description.set(this.project.description):this.description.set(this._trunc(this.project.description,100)))},i.prototype._trunc=function(e,t){return e.length>t?e.substr(0,t-1)+"...":e},i}(o.FrameworkObject);i.ProjectModel=s})},"Mapping/modules/Project/ProjectModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.initialize=function(e){var i=this;t.prototype.initialize.call(this,e),this._registerCommandsAndEvents(),this.app.waitUntilDocumentStoreInitialized().then(function(){i.app.command("SaveProject").raiseCanExecuteChanged(),i.app.command("SaveAsProject").raiseCanExecuteChanged()})},i.prototype._registerCommandsAndEvents=function(){this.app.command("SaveProject").register(this,this._executeSaveProject,this._canExecuteSaveProject),this.app.command("SaveAsProject").register(this,this._executeSaveAsProject,this._canExecuteSaveAsProject),this.app.command("LoadProject").register(this,this._executeLoadProject),this.app.command("DeleteProject").register(this,this._executeDeleteProject,this._canExecuteDeleteProject),this.app.event("ProjectEditorFinishedEvent").subscribe(this,this._handleProjectEditorFinishedEvent),this.app.event("ProjectDeletedEvent").subscribe(this,this._handleCurrentProjectUpdated),this.app.event("ProjectLoadedEvent").subscribe(this,this._handleCurrentProjectUpdated),this.app.event("ProjectSavedEvent").subscribe(this,this._handleCurrentProjectUpdated)},i.prototype._executeSaveProject=function(){var e=this;if(this.app.project.current)if(this.app.site.documentStore.isReadOnly(this.app.project.current)){var t=this.getResource("language-project-confirm-save-title"),i=this._getConfirmActionDescription(this.app.project.current,"save");this.app.command("Confirm").execute(i,t,function(t){t&&e._executeSaveAsProject()})}else this._saveProject({id:this.app.project.current.id});else{var o=this.app.project.createEmpty(null);this.app.command("ShowProjectEditor").execute(o)}},i.prototype._canExecuteSaveProject=function(){return this.app.project.current?this.app.site&&(this.app.site.documentStore.canCreate()||!this.app.site.documentStore.isReadOnly(this.app.project.current)):this.app.site&&this.app.site.documentStore.canCreate()},i.prototype._executeSaveAsProject=function(){var e=this.app.project.createEmpty(null);this.app.project.current&&(e.title=this.app.project.current.title,e.description=this.app.project.current.description),this.app.command("ShowProjectEditor").execute(e)},i.prototype._canExecuteSaveAsProject=function(){return this.app.site&&this.app.site.documentStore.canCreate()},i.prototype._executeLoadProject=function(e){var t=this,i=this.getResource("language-project-confirm-load-title"),o="{0} {1}".format(this._getConfirmActionDescription(e,"load"),this.getResource("language-project-confirm-load-overwrite"));this.app.command("Confirm").execute(o,i,function(i){i&&t._loadProject(e)})},i.prototype._executeDeleteProject=function(e){var t=this,i=this.getResource("language-project-confirm-delete-title"),o=this._getConfirmActionDescription(e,"delete");this.app.command("Confirm").execute(o,i,function(i){i&&t._deleteProject(e)})},i.prototype._canExecuteDeleteProject=function(e){return"string"==typeof e||!!e&&this.app.site.documentStore.isOwner(e)},i.prototype._getConfirmActionDescription=function(e,t){return"object"==typeof e&&e.title?this.getResource("language-project-confirm-"+t+"-description-with-title").format(e.title):this.getResource("language-project-confirm-"+t+"-description")},i.prototype._handleProjectEditorFinishedEvent=function(e){var t=this;if(!e.canceled)if(e.existingProject.id)e.newProject.id=e.existingProject.id,this._saveProject(e.newProject,!1);else{var i=dojo.mixin(e.existingProject,e.newProject);this._saveProject(i).then(function(){return t.app.project.current=i})}},i.prototype._handleCurrentProjectUpdated=function(e){this.app.command("SaveProject").raiseCanExecuteChanged()},i.prototype._deleteProject=function(e){var t=this;return this.app.project.remove(e).catch(function(e){t.app.trace.error("Error deleting project: {0}".format(e.message),e)})},i.prototype._loadProject=function(e){var t=this;return this.app.project.load(e).catch(function(e){t.app.trace.error("Error loading project: {0}".format(e.message),e)})},i.prototype._saveProject=function(e,t){var i=this;return void 0===t&&(t=!0),this.app.project.save(e,t).catch(function(e){i.app.trace.error("Error saving project: {0}".format(e.message),e)})},i}(o.ModuleBase);i.ProjectModule=n})},"Mapping/modules/Project/ProjectStatusView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o._registerCommandsAndEvents(),o}return e(i,t),i.prototype.attach=function(e){t.prototype.attach.call(this,e),this.configuration.showXButton=!1},i.prototype.handleShareButtonClick=function(e,t,i){this._deactivateView(),this.app.command("ShowShareProject").execute(this.viewModel.project)},i.prototype.handleCloseButtonClick=function(e,t,i){this._deactivateView()},i.prototype._registerCommandsAndEvents=function(){this.app.event("ProjectLoadingEvent").subscribe(this,this._handleProjectLoadingEvent),this.app.event("ProjectLoadedEvent").subscribe(this,this._handleProjectLoadedEvent),this.app.event("ProjectSavingEvent").subscribe(this,this._handleProjectSavingEvent),this.app.event("ProjectSavedEvent").subscribe(this,this._handleProjectSavedEvent),this.app.event("ProjectErrorEvent").subscribe(this,this._handleProjectErrorEvent)},i.prototype._handleProjectLoadingEvent=function(e){this.viewModel.project=e,this.viewModel.statusMessage.set(this.getResource("language-project-status-loading")),this.viewModel.isBusy.set(!0),this._activateView()},i.prototype._handleProjectLoadedEvent=function(e){this.viewModel.project=null,this._deactivateView()},i.prototype._handleProjectSavingEvent=function(e){this.viewModel.project=e,this.viewModel.statusMessage.set(this.getResource("language-project-status-saving")),this.viewModel.isBusy.set(!0),this._activateView()},i.prototype._handleProjectSavedEvent=function(e){this.viewModel.projectUrl.set(this.app.project.getProjectUrl(e)),this.viewModel.isBusy.set(!1),this.app.command("FocusOnFirstInputInView").execute(this),this.app.viewManager.notifyDimensionsChanged(this)},i.prototype._handleProjectErrorEvent=function(e){this.viewModel.project=null,this._deactivateView()},i.prototype._activateView=function(){this.isActive||this.app.command("ActivateView").execute(this.id)},i.prototype._deactivateView=function(){this.isActive&&this.app.command("DeactivateView").execute(this.id)},i}(o.ViewBase);i.ProjectStatusView=n})},"Mapping/modules/Project/ProjectStatusViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,o,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.project=null,e.isBusy=new n.Observable(!0),e.statusMessage=new n.Observable,e.projectUrl=new n.Observable,e.showProjectUrl=new n.Observable,e}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e.showUrlOnSave&&this.showProjectUrl.set(e.showUrlOnSave)},i}(o.ViewModelBase);i.ProjectStatusViewModel=r})},"Mapping/modules/Project/ProjectStatusViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Project/ProjectsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","geocortex/essentials/documents/DocumentConstants","geocortex/infrastructure/ui/components/FilterControl/FilterControlViewBase"],function(t,i,o,n,r,s,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var c=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o._keyDownTimer=null,o._registerCommandsAndEvents(),o.app.waitUntilDocumentStoreInitialized().then(function(){o.app.command("ShowProjects").raiseCanExecuteChanged()}),o}return e(i,t),i.prototype.attach=function(e){t.prototype.attach.call(this,e);var i=this.viewModel.minimumFilterDelay;this._keyDownTimer=new n.TimeDelayedAction(i,this._filterProjects,this)},i.prototype.activated=function(){t.prototype.activated.call(this),this.viewModel.activated()},i.prototype.handleClearFilterClick=function(e,t,i){this.viewModel.clearFilter(),this.app.command("FocusOnFirstInputInView").execute(this)},i.prototype.handleFilterButtonClick=function(e,t,i){this.viewModel.filterControlViewModel.filterText.pulse()},i.prototype.handleProjectClick=function(e,t,i){this.app.command("LoadProject").execute(i.project)},i.prototype.handleProjectActions=function(e,t,i){this.app.command("ShowProjectActions").execute(i.project)},i.prototype.handleProjectExpanderClick=function(e,t,i){var o=i.isExpanded.get();t.textContent=o?this.getResource("language-projects-description-more"):this.getResource("language-projects-description-less"),i.isExpanded.set(!o)},i.prototype.handleThumbnailLoadError=function(e,t,i){t.src!==this.viewModel.defaultThumbnail&&(t.src=this.viewModel.defaultThumbnail,t.src!==this.viewModel.defaultThumbnail&&(this.viewModel.defaultThumbnail=t.src))},i.prototype.resolveWidget=function(e,i,o){if(t.prototype.resolveWidget.call(this,e,i),!e)return null;switch(e){case"ProjectsActionsWidget":return this.app.menuRegistry.createMenuWidget(this,i,o);case"PagingControlsWidget":var n=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(n){var s=new r.PagingControlsViewModel(this.app,i);n.attach(s)}return n;case"ProjectFilterWidget":if(!i||!i.filterControlViewModel)return null;var c=new a.FilterControlViewBase(this.app,this.libraryId);c.handleFilterButtonClick=dojo.hitch(this,this.handleFilterButtonClick),c.handleFilterTextClear=dojo.hitch(this,this.handleClearFilterClick);var l=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/ui/components/FilterControl/FilterControlView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.FilterControl.FilterControlViewBase",isVisible:!0},c);return i.filterControlViewModel.handleFilterTextInput=dojo.hitch(this,this._filterProjects),l.attach(i.filterControlViewModel),l;default:return null}},i.prototype._registerCommandsAndEvents=function(){this.app.command("ShowProjects").register(this,this._executeShowProjects,this._canExecuteShowProjects),this.app.event("ProjectLoadedEvent").subscribe(this,this._handleProjectLoadedEvent)},i.prototype._executeShowProjects=function(){this.app.command("ActivateView").execute(this.id)},i.prototype._canExecuteShowProjects=function(){return!(!this.app.site||!this.app.site.documentStore)&&(!!this.app.site.documentStore.supported&&(!!this.app.site.documentStore.canCreate()||this.app.site.documentStore.hasPolicyGrant(function(e){return e.globalId===s.GrantID.PUBLIC&&e.kind===s.GrantKind.GLOBAL_READER})))},i.prototype._filterProjects=function(){if(this.viewModel&&this.viewModel.filterControlViewModel){var e=this.viewModel.filterControlViewModel.filterText.get();this.viewModel.updateFilter(e)}},i.prototype._handleProjectLoadedEvent=function(e){this.app.command("DeactivateView").execute(this.id)},i.prototype._isSpecialChar=function(e){switch(e){case dojo.keys.TAB:case dojo.keys.SHIFT:case dojo.keys.CTRL:case dojo.keys.ALT:case dojo.keys.PAUSE:case dojo.keys.CAPS_LOCK:case dojo.keys.ESCAPE:case dojo.keys.PAGE_UP:case dojo.keys.PAGE_DOWN:case dojo.keys.END:case dojo.keys.HOME:case dojo.keys.LEFT_ARROW:case dojo.keys.UP_ARROW:case dojo.keys.RIGHT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.NUM_LOCK:case dojo.keys.SCROLL_LOCK:case dojo.keys.INSERT:return!0}return!1},i}(o.ViewBase);i.ProjectsView=c})},"Mapping/modules/Project/ProjectsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/essentials/documents/DocumentConstants","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/documents/DocumentCollection","./ProjectModel","geocortex/framework/observables","geocortex/infrastructure/project/ProjectManager","geocortex/infrastructure/ui/components/FilterControl/FilterControlViewModelBase"],function(t,i,o,n,r,s,a,c,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var d=o.DocumentField.TIME_CREATION,p=function(t){function i(e,i){var n=t.call(this,e,i)||this;n._activated=!1,n.defaultPageSize=10,n.minimumFilterDelay=300,n.privateProjectsOnly=new a.Observable(!1),n.fieldSorters=new a.ObservableCollection,n.selectedFieldSorter=new a.Observable,n.isAuthenticated=new a.Observable(!1),n.isBusy=new a.Observable(!1),n.statusOffline=new a.Observable(!1),n.statusEmpty=new a.Observable(!1);return n.presentableResults=new r.DocumentCollection(n.app,n.libraryId,function(e){return new s.ProjectModel(n.app,n.libraryId,e.entity)}),n.projectsPage=n.presentableResults.items,n.filterControlViewModel=new l.FilterControlViewModelBase(n.app,n.libraryId),n.filterControlViewModel.filterInputPlaceholder.set(n.getResource("language-projects-filter-placeholder")),n.filterControlViewModel.filterButtonText.set(n.getResource("language-project-filter-button-text")),n._filterTextField=[o.DocumentField.TITLE,o.DocumentField.DESCRIPTION,o.DocumentField.AUTHOR_TITLE,o.DocumentField.EDITOR_TITLE].join(","),n._registerCommandsAndEvents(),n}return e(i,t),i.prototype.initialize=function(e){var i=this;t.prototype.initialize.call(this,e),e.defaultThumbnail&&(this.defaultThumbnail=e.defaultThumbnail),e.minimumFilterDelay&&(this.minimumFilterDelay=e.minimumFilterDelay),this.isBusy.sync(this.presentableResults.statusFetching),this.statusOffline.sync(this.presentableResults.statusOffline),this.statusEmpty.syncTransform(this.presentableResults.numberOfItems,function(e){return 0===e&&i.presentableResults.isInitialized}),this.privateProjectsOnly.bind(this,this._privateProjectsOnlyChanged),this.selectedFieldSorter.bind(this,this._selectedFieldSorterChanged),this._setFieldSorters()},i.prototype.activated=function(){var e=this;this._activated||(this._activated=!0,this.app.waitUntilDocumentStoreInitialized().then(function(){e.app.site.documentStore.userMonikers.length>0&&(e.isAuthenticated.set(!0),e.privateProjectsOnly.set(!0)),e.presentableResults.addFilter({field:"properties.{0}.string".format(c.SITE_ID_PROPERTY_NAME),range:[{string:e.app.site.id}]}),e.presentableResults.initialize({fileType:c.PROJECT_TYPE,queryParams:{sortDescending:[d]}})}))},i.prototype.refreshProjects=function(){this.presentableResults.refresh()},i.prototype.clearFilter=function(){this.filterControlViewModel.filterText.set(""),this.updateFilter(null)},i.prototype.updateFilter=function(e){String.isNullOrEmpty(e)?this.presentableResults.removeFilter(this._filterTextField):this.presentableResults.addFilter({field:this._filterTextField,method:o.FilterMethod.MATCHES,range:[{string:e}]})},i.prototype._registerCommandsAndEvents=function(){this.app.command("RefreshProjectsList").register(this,this.refreshProjects),this.app.event("ProjectSavedEvent").subscribe(this,this._handleProjectSavedEvent),this.app.event("ProjectDeletingEvent").subscribe(this,this._handleProjectDeletingEvent)},i.prototype._handleProjectSavedEvent=function(e){this.refreshProjects()},i.prototype._handleProjectDeletingEvent=function(e){this.isBusy.set(!0),this.presentableResults.stopFetching=!0,this._projectDeleteToken=this.app.event("ProjectDeletedEvent").once(this,this._handleProjectDeletedEvent),this._projectErrorToken=this.app.event("ProjectErrorEvent").once(this,this._handleProjectDeletedEvent)},i.prototype._handleProjectDeletedEvent=function(){this.app.event("ProjectDeletedEvent").unsubscribe(this._projectDeleteToken),this.app.event("ProjectErrorEvent").unsubscribe(this._projectErrorToken),this._projectDeleteToken=null,this._projectErrorToken=null,this.presentableResults.stopFetching=!1,this.refreshProjects()},i.prototype._privateProjectsOnlyChanged=function(e){e?this.presentableResults.addFilter(this.app.site.documentStore.userFilter):this.presentableResults.removeFilter(o.DocumentField.GRANT_TOKEN)},i.prototype._selectedFieldSorterChanged=function(e){e.fields&&this.presentableResults.sortBy(e)},i.prototype._setFieldSorters=function(){var e=[{fields:null,displayName:this.app.getResource(this.libraryId,"language-projects-sort-default-display-name")},{fields:[o.DocumentField.TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-name-display-name")},{fields:[o.DocumentField.TIME_CREATION,o.DocumentField.TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-created-display-name"),descending:!0},{fields:[o.DocumentField.TIME_LAST_MODIFICATION,o.DocumentField.TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-modified-display-name"),descending:!0},{fields:[o.DocumentField.EDITOR_TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-modifiedby-display-name")},{fields:[o.DocumentField.AUTHOR_TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-createdby-display-name")}];this.fieldSorters.set(e)},i}(n.ViewModelBase);i.ProjectsViewModel=p})},"Mapping/modules/Project/ProjectsViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Project/ShareProjectView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/documents/DocumentConstants"],function(t,i,o,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o._registerCommandsAndEvents(),o}return e(i,t),i.prototype.handleAddLinkButtonClick=function(e,t,i){this.viewModel.addGuestLink(i)},i.prototype.handleRemoveLinkButtonClick=function(e,t,i){var o=this,n=this.getResource("language-project-confirm-remove-guest-link-title"),r=this.getResource("language-project-confirm-remove-guest-link-description");this.app.command("Confirm").execute(r,n,function(e){e&&o.viewModel.removeGuestLink(i)})},i.prototype.handleClearButtonClick=function(e,t,i){var o=this,n=this.getResource("language-project-confirm-stop-sharing-title"),r="language-project-confirm-stop-sharing-{0}".format(this.viewModel.showGuestLinks.get()?"all-description":"description"),s=this.getResource(r).format(this.viewModel.project.get().title);this.app.command("Confirm").execute(s,n,function(e){e&&o.viewModel.updateProjectGrants(!0)})},i.prototype.handleSaveButtonClick=function(e,t,i){var o=this;if(this.viewModel.confirmSharedPublicly&&this._isPublic(this.viewModel.project.get())){var n=this.getResource("language-project-confirm-share-public-title"),r=this._getConfirmPublicDescription(this.viewModel.project.get());this.app.command("Confirm").execute(r,n,function(e){e&&o.viewModel.updateProjectGrants()})}else this.viewModel.updateProjectGrants()},i.prototype.handleCloseButtonClick=function(e,t,i){this._deactivateView()},i.prototype.resolveWidget=function(e,i,o){if(t.prototype.resolveWidget.call(this,e,i),!e)return null;switch(e){case"GrantEditorWidget":var n=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.documents.GrantEditorView",markupResource:"Mapping/infrastructure/documents/GrantEditorView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});return n&&n.attach(this.viewModel.grantEditorViewModel),n;default:return null}},i.prototype._registerCommandsAndEvents=function(){this.app.command("ShowShareProject").register(this,this._executeShowShareProject)},i.prototype._executeShowShareProject=function(e){this.viewModel.loadProject(e),this.app.command("ActivateView").execute(this.id)},i.prototype._deactivateView=function(){this.app.command("DeactivateView").execute(this.id)},i.prototype._isPublic=function(e){return!!this.app.site.documentStore.isPublic(e)||(!(!this.viewModel.allowPublicReadAccess||!this._hasLink(e,n.GrantKind.READER_LINK))||!(!this.viewModel.allowPublicEditAccess||!this._hasLink(e,n.GrantKind.WRITER_LINK)))},i.prototype._getConfirmPublicDescription=function(e){return this.viewModel.allowPublicEditAccess&&this._hasLink(e,n.GrantKind.WRITER_LINK)?this.getResource("language-project-confirm-share-public-edit-description").format(this.viewModel.project.get().title):this.getResource("language-project-confirm-share-public-description").format(this.viewModel.project.get().title)},i.prototype._hasLink=function(e,t){return e.grants.some(function(e){return e.kind===t&&(!1===e.revoke||!0===e.assert)})},i}(o.ViewBase);i.ShareProjectView=r})},"Mapping/modules/Project/ShareProjectViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/documents/GrantEditorViewModel","geocortex/framework/observables","geocortex/infrastructure/documents/GuestLinkModel","geocortex/essentials/documents/DocumentConstants","geocortex/essentials/documents/DocumentStore","geocortex/essentials/documents/BatchRequestBuilder"],function(t,i,o,n,r,s,a,c,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var d=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o.allowPublicReadAccess=!1,o.allowPublicEditAccess=!1,o.project=new r.Observable,o.projectUrl=new r.Observable,o.guestLinks=new r.ObservableCollection,o.showGuestLinks=new r.Observable,o.statusMessage=new r.Observable,o.isOwner=new r.Observable(!1),o.isBusy=new r.Observable(!1),o.grantEditorViewModel=new n.GrantEditorViewModel(e,"Mapping.Infrastructure"),o._setupGuestLinks(),o}return e(i,t),i.prototype.initialize=function(e){var i=this;t.prototype.initialize.call(this,e),e.showGuestLinks&&this.showGuestLinks.set(e.showGuestLinks),e.confirmSharedPublicly&&(this.confirmSharedPublicly=e.confirmSharedPublicly),this.app.waitUntilDocumentStoreInitialized().then(function(){i.allowPublicReadAccess=i.app.site.documentStore.hasPolicyGrant(function(e){return e.kind===a.GrantKind.GLOBAL_READER&&e.globalId===a.GrantID.PUBLIC}),i.allowPublicEditAccess=i.app.site.documentStore.hasPolicyGrant(function(e){return e.kind===a.GrantKind.GLOBAL_WRITER&&e.globalId===a.GrantID.PUBLIC}),i.allowPublicReadAccess&&i.guestLinks.getItems().filter(function(e){return e.kind===a.GrantKind.READER_LINK}).forEach(function(e){return e.name.set(i.getResource("language-share-project-links-public-view-label"))}),i.allowPublicEditAccess&&i.guestLinks.getItems().filter(function(e){return e.kind===a.GrantKind.WRITER_LINK}).forEach(function(e){return e.name.set(i.getResource("language-share-project-links-public-edit-label"))})})},i.prototype.loadProject=function(e){var t=this;this.statusMessage.set(this.getResource("language-common-loading")),this.isBusy.set(!0);var i=this.app.project.getProjectID(e);this.grantEditorViewModel.loadById(i).then(function(){return t._updateModel(t.grantEditorViewModel.document)}).catch(function(e){t.app.trace.error("Error loading project: {0}".format(e.message),e),t._reset()}).finally(function(){return t.isBusy.set(!1)})},i.prototype.addGuestLink=function(e){var t=e.grant;if(t&&t.globalId===e.link)t.assert=!0,t.revoke=!1;else{t&&(t.assert=!1,t.revoke=!0);var i={globalId:e.link,kind:e.kind,assert:!0,revoke:!1};e.grant=i,this.project.get().grants.push(i)}e.linkUrl.set(this._buildGuestLinkUrl(this.projectUrl.get(),e.link))},i.prototype.removeGuestLink=function(e){e.grant?(e.grant.assert=!1,e.grant.revoke=!0,e.linkUrl.set(null)):this.app.trace.error("Error removing guest link: No grant provided.")},i.prototype.updateProjectGrants=function(e){var t=this;void 0===e&&(e=!1),this.statusMessage.set(this.getResource("language-project-status-updating")),this.isBusy.set(!0);var i=this.project.get().id,o=this.project.get().grants;e&&o.forEach(function(e){e.assert=!1,e.revoke=!0});var n={id:i,grants:o};return this.app.project.write(n).then(function(){return t.grantEditorViewModel.loadById(i)}).then(function(){return t._updateModel(t.grantEditorViewModel.document)}).catch(function(e){t.app.trace.error("Error updating project grants: {0}".format(e.message),e)}).finally(function(){return t.isBusy.set(!1)})},i.prototype._buildGuestLinkUrl=function(e,t){var i=e;return i+=i.indexOf("?")>-1?"&":"?",i+="{0}={1}".format(c.LINK_QUERY_STRING_KEY,t)},i.prototype._updateModel=function(e){return e?(this.project.set(e),this.projectUrl.set(this.app.project.getProjectUrl(e)),this.isOwner.set(this.app.site.documentStore.isOwner(e)),this._updateGuestLinks(e)):Promise.resolve(this._reset())},i.prototype._updateGuestLinks=function(e){var t=this,i=this.guestLinks.getItems(),o=this.app.project.getProjectUrl(e);if(i.forEach(function(e){return e.reset()}),e.grants)for(var n=0;n<e.grants.length;n++){var r=e.grants[n];i.forEach(function(e){r.kind===e.kind&&(e.grant=r,e.linkUrl.set(t._buildGuestLinkUrl(o,r.globalId)))})}var s=l.generateLinks(this.guestLinks.length());return this.app.waitUntilSiteInitialized().then(function(){return t.app.site.documentStore.perform(s,!0)}).then(function(e){i.forEach(function(t,i){return t.link=e.links[i]})}).catch(function(e){t.app.trace.error("Error generating guest links: {0}".format(e.essage),e)})},i.prototype._reset=function(){this.project.set(null),this.projectUrl.set(null),this.isOwner.set(!1),this.guestLinks.getItems().forEach(function(e){return e.reset()})},i.prototype._setupGuestLinks=function(){this.guestLinks.addItem(new s.GuestLinkModel({name:this.getResource("language-share-project-links-view-label"),kind:a.GrantKind.READER_LINK})),this.guestLinks.addItem(new s.GuestLinkModel({name:this.getResource("language-share-project-links-edit-label"),kind:a.GrantKind.WRITER_LINK}))},i}(o.ViewModelBase);i.ShareProjectViewModel=d})},"Mapping/modules/Project/ShareProjectViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"url:/Mapping/modules/Project/ProjectActionsView.html":t,"url:/Mapping/modules/Project/ProjectEditorView.html":i,"url:/Mapping/modules/Project/ProjectStatusView.html":o,"url:/Mapping/modules/Project/ProjectsView.html":n,"url:/Mapping/modules/Project/ShareProjectView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Project/CSS/common.css","css","LnByb2plY3QtZWRpdG9yLWNvbnRlbnQgew0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBwYWRkaW5nOiAwIDFlbSAxZW0gMWVtOw0KfQ0KDQoucHJvamVjdC1lZGl0b3Itc2F2ZS1jb21wbGV0ZSB7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQovKi5wcm9qZWN0cyAucHJvamVjdC1maWx0ZXItd2lkZ2V0IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiA0ZW07DQogICAgYmFja2dyb3VuZDogI0VFRUVFRTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9Ki8NCg0KLnByb2plY3RzIC5maWx0ZXItaW5wdXQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDNweCAzMHB4IDRweCA5cHg7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQogICAgZm9udC1zaXplOiAxLjZlbTsNCiAgICBjb2xvcjogIzY1NjE2OTsNCiAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7DQogICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDApOw0KfQ0KDQovKi5wcm9qZWN0cyAuZmlsdGVyLWJ1dHRvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMXB4Ow0KICAgIHJpZ2h0OiAxcHg7DQogICAgYm90dG9tOiAxcHg7DQogICAgd2lkdGg6IDQwcHg7DQogICAgYmFja2dyb3VuZDogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2xlYXItMjQucG5nKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LWluZGVudDogLTk5OWVtOw0KfSovDQoNCi5wcm9qZWN0cy1vcHRpb25zIHsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgei1pbmRleDogMTsNCn0NCg0KLyotLS0tLS1Qcm9qZWN0IFNlbGVjdG9yIFRvb2xzLS0tLS0tKi8NCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzIHsNCiAgICBoZWlnaHQ6IDNlbTsNCn0NCg0KLnByb2plY3Qtc2VsZWN0b3ItZHJvcGRvd24gew0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBwYWRkaW5nOiAwLjc1ZW0gMC41ZW0gMC43NWVtIDAuMmVtOw0KfQ0KDQoucHJvamVjdC1zZWxlY3Rvci10b29scyBzZWxlY3Qgew0KICAgIG1pbi13aWR0aDogMTAwJTsNCn0NCg0Kc3Bhbi5wcm9qZWN0LXNlbGVjdG9yLWRyb3Bkb3duIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IDUwJTsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzOjphZnRlciB7DQogICBjb250ZW50OiAiICI7DQogICBkaXNwbGF5OiBibG9jazsgDQogICBoZWlnaHQ6IDA7IA0KICAgY2xlYXI6IGJvdGg7DQp9DQoNCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzIC5wcm9qZWN0LWNoZWNrYm94IHsNCiAgICB3aWR0aDogNTAlOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGNsZWFyOiByaWdodDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBwYWRkaW5nOiAwLjc1ZW0gMC4yZW0gMC43NWVtIDAuNWVtOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0NCg0KLnByb2plY3Qtc2VsZWN0b3ItdG9vbHMgLnByb2plY3QtY2hlY2tib3ggc3BhbiwNCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzIC5wcm9qZWN0LWNoZWNrYm94IGlucHV0IHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoucHJvamVjdHMtc3RhdHVzLW1lc3NhZ2Ugew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5saXN0LW1lbnUsDQoubGlzdC1tZW51ICogew0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLyotLS0tLS1Qcm9qZWN0IExpc3QtLS0tLS0qLw0KLnByb2plY3RzLWxpc3QgLmxpc3QtbWVudSB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbGlzdC1zdHlsZS10eXBlOiBub25lOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDdlbTsNCiAgICBib3R0b206IDZlbTsNCiAgICBvdmVyZmxvdzogYXV0bzsNCn0NCg0KLnByb2plY3RzIC5wYWdpbmctY29udHJvbCB7DQogICAgaGVpZ2h0OiA2ZW07DQp9DQoNCi8qLS0tUHJvamVjdCBMaXN0IEl0ZW0tLS0qLw0KLnByb2plY3RzLWxpc3QgLmxpc3QtbWVudSAuaXRlbS1saXN0LWl0ZW0gew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBjbGVhcjogYm90aDsNCiAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsNCiAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwOw0KfQ0KDQoucHJvamVjdHMgLmxpc3QtaXRlbS1pY29uIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBoZWlnaHQ6IDUwcHg7DQogICAgd2lkdGg6IDcwcHg7DQogICAgcGFkZGluZzogMC4zZW0gMC4yZW0gMCAwLjNlbTsNCn0NCg0KLnByb2plY3RzIC5saXN0LWl0ZW0tYnV0dG9uIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogNTBweDsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQoucHJvZmlsZS1tYW5hZ2UgLmxpc3QtaXRlbS1idXR0b24gew0KICAgIHBhZGRpbmctcmlnaHQ6IDcuNWVtOw0KfQ0KDQoubGlzdC1pdGVtLWltZyB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBsZWZ0OiAwOw0KICAgIG1heC1oZWlnaHQ6IDEwMCU7DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWNvbnRlbnQgLnNoYXJlLXdpdGgsDQouc2hhcmUtcHJvamVjdC1jb250ZW50IC5zaGFyZS13aXRoIGxhYmVsIHsNCiAgICBwYWRkaW5nLWJvdHRvbTogMDsNCn0NCg0KLmxpc3QtaXRlbS1idXR0b24ucHJvamVjdC1hY3Rpb25zIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAwOw0KICAgIHdpZHRoOiAzLjVlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KICAgIHBhZGRpbmc6IDA7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KfQ0KDQoucHJvamVjdHMtbGlzdCAubW9yZS1idXR0b24gew0KICAgIHdpZHRoOiAzLjVlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIG1hcmdpbi1ib3R0b206IDAuNDVlbTsNCn0NCg0KLyotLS0tLS1Qcm9qZWN0IExpc3QgSXRlbSBUZXh0LS0tLS0tKi8NCi5wcm9qZWN0LW92ZXJ2aWV3IHsNCiAgICBtYXJnaW46IDAgMy41ZW0gMCAwOw0KICAgIHBhZGRpbmc6IDAgMC41ZW07DQp9DQoNCi5wcm9qZWN0LW92ZXJ2aWV3IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgcGFkZGluZy10b3A6IDAuMTVlbTsNCn0NCg0KLnByb2plY3QtbmFtZSwNCi5wcm9qZWN0LWRlc2NyaXB0aW9uIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQp9DQoNCi5wcm9qZWN0LW5hbWUgew0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQoNCi5wcm9qZWN0LWRlc2NyaXB0aW9uIHsNCiAgICBjb2xvcjogIzMzMzMzMzsNCiAgICBwYWRkaW5nOiAwLjJlbSAwOw0KfQ0KDQoucHJvamVjdC1kZXNjcmlwdGlvbjplbXB0eSB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLnByb2plY3QtZGV0YWlscyB7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDAgMC41ZW07DQogICAgbWFyZ2luOiAwIDMuNWVtIDAgMDsNCiAgICBjbGVhcjogYm90aDsNCn0NCg0KLnByb2plY3QtZGV0YWlsczo6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIiOw0KICAgIGNsZWFyOiBib3RoOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMDsNCn0NCg0KLnByb2plY3QtbW9kaWZpZWQsDQoucHJvamVjdC1jcmVhdGVkIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBjb2xvcjogIzY2NjY2NjsNCiAgICBmb250LXdlaWdodDogMzAwOw0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICBmb250LXNpemU6IDAuOWVtOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjRlbTsNCn0NCg0KLnByb2plY3QtY3JlYXRlZCB7DQogICAgbWFyZ2luLWJvdHRvbTogMC4yZW07DQp9DQoNCi8qIC0tLS0tLSBTVEFSVCBCdXR0b24gU3RhdGVzIC0tLS0tLSovDQoucHJvamVjdC1pbmZvOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjREVGMkZGOw0KfQ0KDQouaXRlbS1saXN0LWl0ZW0gLmNoZXZyb24tcmlnaHQtMTY6aG92ZXIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNERUYyRkY7DQp9DQovKiAtLS0tLS0gRU5EIEJ1dHRvbiBTdGF0ZXMgLS0tLS0tKi8NCg0KLyotLS1TaGFyZSBQcm9qZWN0IFZpZXctLS0qLw0KLnNoYXJlLXByb2plY3QtY29udGVudCB7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQouc2hhcmUtcHJvamVjdC1jb250ZW50IGgyIHsNCiAgICBmb250LXNpemU6IDEuMmVtOw0KfQ0KDQouc2hhcmUtd2l0aC1sYWJlbCB7DQogICAgcGFkZGluZy1ib3R0b206IDA7DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5jbGVhci0yNCwNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5hZGQtMTYgew0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQogICAgZm9udC1zaXplOiAyZW07DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5saW5rLWJveCB7DQogICAgd2lkdGg6IDkwJTsNCiAgICBtYXJnaW46IDA7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouc2hhcmUtcHJvamVjdC1saW5rcyB7DQogICAgbWFyZ2luLXRvcDogMS41ZW07DQp9DQoNCi5wcm9qZWN0LWxpbmstYnV0dG9ucyB7DQogICAgd2lkdGg6IDglOw0KICAgIG1hcmdpbi1sZWZ0OiAyJTsNCiAgICB0ZXh0LWFsaWduOiByaWdodDsNCn0NCg0KLnNoYXJlLXByb2plY3QtbGlua3MgLmNsZWFyLTI0IHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9jbGVhci0yNC5wbmcpIGNlbnRlciBuby1yZXBlYXQ7DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5hZGQtMTYgew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvYWRkLTE2LnBuZykgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg0KLnNoYXJlLXByb2plY3QgLnNoYXJlLXByb2plY3QtYnV0dG9ucyB7DQogICAgbWFyZ2luLXRvcDogMy41ZW07DQp9"),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/CSS/medium.css","css","LmZpbHRlci1ib3ggew0KICAgIGhlaWdodDogNGVtOw0KfQ0KDQoucHJvamVjdC1zZWxlY3Rvci10b29scyB7DQogICAgaGVpZ2h0OiAzLjJlbTsNCn0NCg0KLnByb2plY3RzLWxpc3QgLmxpc3QtbWVudSB7DQogICAgdG9wOiA3LjJlbTsNCn0NCg=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/CSS/small.css","css","LmZpbHRlci1ib3gsDQoucHJvamVjdC1zZWxlY3Rvci10b29scyB7DQogICAgaGVpZ2h0OiA0ZW07DQp9DQoNCi5wcm9qZWN0cy1saXN0IC5saXN0LW1lbnUgew0KICAgIHRvcDogOGVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectActionsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectEditorView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectStatusView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectsView.html","html",n),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ShareProjectView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Project/ProjectActionsView","Mapping/modules/Project/ProjectEditorView","Mapping/modules/Project/ProjectEditorViewModel","Mapping/modules/Project/ProjectModel","Mapping/modules/Project/ProjectModule","Mapping/modules/Project/ProjectStatusView","Mapping/modules/Project/ProjectStatusViewModel","Mapping/modules/Project/ProjectsView","Mapping/modules/Project/ProjectsViewModel","Mapping/modules/Project/ShareProjectView","Mapping/modules/Project/ShareProjectViewModel"],function(t,i,o,n,r,s,a,c,l,d,p){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectActionsView",t.ProjectActionsView),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectEditorView",i.ProjectEditorView),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectEditorViewModel",o.ProjectEditorViewModel),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectModel",n.ProjectModel),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectModule",r.ProjectModule),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectStatusView",s.ProjectStatusView),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectStatusViewModel",a.ProjectStatusViewModel),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectsView",c.ProjectsView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectsViewModel",l.ProjectsViewModel),e(d,"geocortex.essentialsHtmlViewer.mapping.modules.project.ShareProjectView",d.ShareProjectView),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.project.ShareProjectViewModel",p.ShareProjectViewModel)})}();