!function(){var t="<div class='no-item' data-binding='{@hidden: visibleMenuItems}{@text: @language-menu-no-items}'></div><ul class='list-menu has-icon' data-binding='{@visible: visibleMenuItems}{@source: visibleMenuItems}'>    <li class='list-menu-item' data-binding='{@template-for: visibleMenuItems}'>        <button class='list-menu-button' data-binding='{@event-onmouseover: getDescription}{@event-onclick: handleMenuItemClick}'>            <img class='list-menu-icon' data-binding='{src: iconUri}{@visible: iconUri}' alt=' ' />            <span class='list-menu-details'>                <strong class='list-menu-name' data-binding='{@text: text}'></strong>                <span class='list-menu-desc' data-binding='{@visible: description}{@text: description}'></span>            </span>        </button>    </li></ul>",i="<div class='project-editor'>    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: @language-common-loading}'></div>    </div>    <div class='project-editor-content' data-binding='{@hidden: isBusy}'>        <div class='form-stacked'>            <div class='form-item'>                <label class='form-label'>                    <span data-binding='{@text: @language-project-editor-name-label}'></span>                    <input type='text' data-binding='{@value: name}{title: @language-project-editor-name-title}{@event-oninput: handleInputChanged}' />                </label>            </div>            <div class='form-validation' data-binding='{@visible: inputErrorMessage}'>                <span class='field-validation-error' data-binding='{@text: inputErrorMessage}'></span>            </div>            <div class='form-item'>                <label class='form-label'>                    <span data-binding='{@text: @language-project-editor-description-label}'></span>                    <textarea type='text' data-binding='{@value: description}{title: @language-project-editor-description-title}'></textarea>                </label>            </div>            <div class='form-item' data-binding='{@visible: projectUrl}'>                <label class='form-label' data-binding='{@text: @language-project-url-label}'></label>                <input type='text' readonly data-binding='{@value: projectUrl}{aria-label: @language-project-url-title}' />            </div>            <div class='form-btns'>                <button class='button' data-binding='{title: @language-project-editor-save-button-title}{@text: @language-common-save}{@event-onclick: handleSaveButtonClick}{@disabled: inputErrorMessage}'></button>                <button class='button' data-binding='{title: @language-project-editor-cancel-button-title}{@text: @language-common-cancel}{@event-onclick: handleCancelButtonClick}'></button>            </div>        </div>    </div></div>",o="<div class='project-status'>    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: statusMessage}'></div>    </div>    <div class='project-status-complete' data-binding='{@hidden: isBusy}'>        <p data-binding='{@text: @language-project-status-saved-complete}'></p>        <p data-binding='{@text: @language-project-status-saved-description}'></p>        <div class='form-item' data-binding='{@visible: showProjectUrl}'>            <p data-binding='{@text: @language-project-status-saved-url-description}'></p>            <input type='text' title='project complete' readonly data-binding='{@value: projectUrl}{aria-label: @language-share-project-status-view-label}' />        </div>        <div class='form-btns'>            <button class='button' data-binding='{title: @language-project-status-share-button-title}{@text: @language-common-share}{@event-onclick: handleShareButtonClick}'></button>            <button class='button' data-binding='{title: @language-project-status-close-button-title}{@text: @language-common-close}{@event-click: handleCloseButtonClick}'>Close</button>        </div>    </div></div>",n="<div data-binding='{@widget: ProjectsActionsWidget}{@widget-required: false}' data-menu-id='ProjectsActions' data-menu-template='Mapping/infrastructure/menus/MenuView.html'></div><div class='projects'>    <div class='projects-options'>        <div class='panel-filter-widget' data-binding='{@widget: ProjectFilterWidget}{@widget-context: @context}{@widget-required: true}'></div>        <div class='project-selector-tools'>            <label class='form-label project-checkbox' data-binding='{@visible: isAuthenticated}'>                <input type='checkbox' data-binding='{@value: privateProjectsOnly}' />                <span data-binding='{@text: @language-projects-private-projects-label}'></span>            </label>            <span class='project-selector-dropdown'>                <select data-binding='{@source: fieldSorters}{@value: selectedFieldSorter}{aria-label: @language-projects-sort-selector-title}'>                    <option data-binding='{@template-for: fieldSorters}{@text: displayName}{@attach: @context}' />                </select>            </span>        </div>    </div>    <div class='projects-list-container'>        <div class='projects-status-message' data-binding='{@hidden: isBusy}'>            <span data-binding='{@text: @language-project-status-offline}{@visible: statusOffline}'></span>            <span data-binding='{@hidden: statusOffline}'>                <span data-binding='{@text: @language-project-status-empty}{@visible: statusEmpty}'></span>            </span>        </div>        <div class='loading-container' data-binding='{@visible: isBusy}'>            <div class='loading-img'></div>            <div class='loading-msg' data-binding='{@text: @language-common-loading}'></div>        </div>        <div class='projects-list' data-binding='{@hidden: isBusy}'>            <ul class='list-menu' data-binding='{@source: projectsPage}'>                <li class='item-list-item' data-binding='{@template-for: projectsPage}'>                    <div class='project-info'>                        <button class='list-item-button' data-binding='{@event-click: handleProjectClick}'>                            <img class='list-item-icon' data-binding='{src: thumbnail}{title: name}{alt: name}{@event-error: handleThumbnailLoadError}' />                            <div class='project-overview'>                                <span class='project-name' data-binding='{@text: name}'></span>                                <span class='project-modified' data-binding='{@text: lastModifiedBy}'></span>                                <span class='project-created' data-binding='{@text: createdBy}'></span>                            </div>                        </button>                        <div class='project-details'>                            <div class='project-description' data-binding='{@text: description}'></div>                            <a href='#' class='more-button' data-binding='{@visible: canExpand}{@event-onclick: handleProjectExpanderClick}{@text: @language-projects-description-more}'></a>                        </div>                    </div>                    <button class='list-item-button project-actions chevron-right-16' data-binding='{title: @language-project-actions-tooltip}{@event-click: handleProjectActions}'></button>                </li>            </ul>        </div>    </div>    <div data-binding='{@hidden: statusEmpty}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-replace: false}'></div></div>",r="<div class='share-project'>    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: statusMessage}'></div>    </div>    <div class='share-project-content' data-binding='{@hidden: isBusy}'>        <div class='form-stacked'>            <div data-binding='{@visible: isOwner}'>                <h2 data-binding='{@text: @language-share-project-privileges-title}'></h2>                <p data-binding='{@text: @language-share-project-privileges-description}'></p>            </div>            <div class='form-item' data-binding='{@visible: projectUrl}'>                <label class='form-label' data-binding='{@text: @language-project-url-label}'></label>                <div class='form-control'>                    <input type='text' readonly data-binding='{@value: projectUrl}{aria-label: @language-project-url-title}' />                </div>            </div>            <div data-binding='{@visible: isOwner}'>                <div class='form-item share-with'>                    <label class='form-label' data-binding='{@text: @language-share-project-share-with-label}'></label>                </div>                <div data-binding='{@widget: GrantEditorWidget}{@widget-context: @context}{@widget-replace: true}'></div>                <div class='share-project-links' data-binding='{@visible: showGuestLinks}'>                    <h2 class='share-project-links-title' data-binding='{@text: @language-share-project-links-title}'></h2>                    <p data-binding='{@text: @language-share-project-links-description}'></p>                    <div data-binding='{@source: guestLinks}'>                        <div class='form-item' data-binding='{@template-for: guestLinks}'>                            <label class='form-label' data-binding='{@text: name}'></label>                            <div class='form-control'>                                <input class='link-box' type='text' readonly data-binding='{@value: linkUrl}{aria-label: name}' />                                <div class='inline-block project-link-buttons'>                                    <button class='button add-16' data-binding='{@hidden: linkUrl}{title: @language-share-project-links-add-button-title}{@event-onclick: handleAddLinkButtonClick}'></button>                                    <button class='button clear-24' data-binding='{@visible: linkUrl}{title: @language-share-project-links-remove-button-title}{@event-onclick: handleRemoveLinkButtonClick}'></button>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>        <div class='form-btns'>            <div class='share-project-buttons' data-binding='{@visible: isOwner}'>                <button class='button' data-binding='{title: @language-share-project-clear-button-title}{@text: @language-share-project-clear-button-text}{@event-onclick: handleClearButtonClick}'></button>                <button class='button' data-binding='{title: @language-share-project-save-button-title}{@text: @language-share-project-save-button-text}{@event-onclick: handleSaveButtonClick}'></button>                <button class='button' data-binding='{title: @language-share-project-cancel-button-title}{@text: @language-common-cancel}{@event-onclick: handleCloseButtonClick}'></button>            </div>            <div data-binding='{@hidden: isOwner}'>                <button class='button' data-binding='{title: @language-share-project-close-button-title}{@text: @language-common-close}{@event-onclick: handleCloseButtonClick}'></button>            </div>        </div>    </div></div>";function p(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var o=t.split("."),n=null,r=window,s=0,a=o.length;s<a;s++)n=o[s],s==a-1?r[n]=i:r[n]||(r[n]={}),r=r[n];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Project/ProjectActionsView":function(){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/menus/MenuView"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=(o=i.MenuView,s(r,o),r.prototype.handleMenuItemClick=function(e,t,i){this.app.command("DeactivateView").execute(this.id),o.prototype.handleMenuItemClick.call(this,e,t,i)},r.prototype._registerCommandsAndEvents=function(){this.app.command("ShowProjectActions").register(this,this._executeShowProjectActions)},r.prototype._executeShowProjectActions=function(e){e&&(this.title.set(e.title),this.viewModel.menuContext.set(e),this.app.command("ActivateView").execute(this.id))},r);function r(e,t){var i=o.call(this,e,t)||this;return i._registerCommandsAndEvents(),i}t.ProjectActionsView=n})},"Mapping/modules/Project/ProjectEditorView":function(){var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation"],function(e,t,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewBase,a(s,n),s.prototype.attach=function(e){var t=this;n.prototype.attach.call(this,e),this._keyDownTimer=new o.TimeDelayedAction(this._validationDelayMS,function(){return t.viewModel.validateInput()},this)},s.prototype.activated=function(){n.prototype.activated.call(this),this._listenForDataFrameEvents=!1},s.prototype.deactivated=function(){n.prototype.deactivated.call(this),this._listenForDataFrameEvents=!0,this.viewModel.reset()},s.prototype.handleInputChanged=function(e,t,i){this.viewModel.handleInputChanged(),this._keyDownTimer.reset()},s.prototype.handleSaveButtonClick=function(e,t,i){this.viewModel.finishEditing()},s.prototype.handleCancelButtonClick=function(e,t,i){this.viewModel.finishEditing(!0)},s.prototype._registerCommandsAndEvents=function(){var e=this;this.app.command("ShowProjectEditor").register(this,this._executeShowProjectEditor,this._canExecuteShowProjectEditor),this.app.event("DataFrameOpenedEvent").subscribe(this,function(){return e._handleDataFrameEvent(!0)}),this.app.event("DataFrameClosedEvent").subscribe(this,function(){return e._handleDataFrameEvent(!1)})},s.prototype._executeShowProjectEditor=function(e){"object"!=typeof e||e.id?this.title.set(this.getResource("language-project-editor-title")):this.title.set(this.getResource("language-project-save-title")),this.viewModel.startEditing(e),this.app.command("ActivateView").execute(this.id)},s.prototype._canExecuteShowProjectEditor=function(e){return"string"==typeof e||!!e&&this.app.site.documentStore.isOwner(e)},s.prototype._handleDataFrameEvent=function(e){this._listenForDataFrameEvents&&(this.viewModel.dataFrameIsOpen=e)},s);function s(e,t){var i=n.call(this,e,t)||this;return i._listenForDataFrameEvents=!0,i._validationDelayMS=300,i._keyDownTimer=null,i._registerCommandsAndEvents(),i}t.ProjectEditorView=r})},"Mapping/modules/Project/ProjectEditorViewModel":function(){var o,d=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/essentials/documents/DocumentConstants","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/project/ProjectManager"],function(e,t,i,o,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,a="{0}_exact".format(i.DocumentField.TITLE),c=(s=o.ViewModelBase,d(l,s),l.prototype.startEditing=function(e){var t=this;this.isBusy.set(!0),this.app.project.getProject(e,!1).then(function(e){return t.app.project.validateProjectOwnership(e)}).then(function(e){return t._updateModel(e)}).catch(function(e){t.app.trace.error("Error editing project: {0}".format(e.message),e),t.reset()}).finally(function(){return t.isBusy.set(!1)})},l.prototype.finishEditing=function(e){var t=this;void 0===e&&(e=!1);var i={existingProject:this.project,newProject:null,canceled:e};return e?(this._deactivateView(),Promise.resolve(this.app.event("ProjectEditorFinishedEvent").publish(i))):this.validateInput().then(function(){i.newProject={title:t.name.get().trim(),description:t.description.get()},t._deactivateView(),t.app.event("ProjectEditorFinishedEvent").publish(i)})},l.prototype.validateInput=function(){var t=this;if(this._validateInputPromise)return this._validateInputPromise;var i=this.name.get()?this.name.get().trim():"";return this.project&&this.project.id&&this.project.title&&this.project.title===i?Promise.resolve():this._validateInputPromise=Promise.resolve().then(function(){if(String.isNullOrEmpty(i))throw new Error(t.getResource("language-project-editor-error-name-required"))}).then(function(){return t.app.site.documentStore.query(t._buildNameQueryParams(i))}).then(function(e){if(0<e.total)throw new Error(t.getResource("language-project-editor-error-name-exists").format(i))}).catch(function(e){return t.inputErrorMessage.set(e.message),Promise.reject(e)}).finally(function(){t._validateInputPromise=null})},l.prototype.handleInputChanged=function(){this.inputErrorMessage.get()&&this.name.get()&&!String.isNullOrEmpty(this.name.get().trim())&&this.inputErrorMessage.set("")},l.prototype.reset=function(){this.project=null,this.name.set(""),this.description.set(""),this.projectUrl.set(""),this.inputErrorMessage.set("")},l.prototype._buildNameQueryParams=function(e){var t=[];return t.push(this.app.site.documentStore.userFilter),t.push({field:a,method:i.FilterMethod.VALUES,range:[{string:e}]}),t.push({field:i.DocumentField.FILE_TYPE,method:i.FilterMethod.VALUES,range:[{string:r.PROJECT_TYPE}]}),{filters:{require:t},limit:0}},l.prototype._updateModel=function(e){this.project=e,this.name.set(e.title),this.description.set(e.description),this.projectUrl.set(this.app.project.getProjectUrl(e))},l.prototype._deactivateView=function(){this.app.command("DeactivateView").execute("ProjectEditorView"),this.dataFrameIsOpen||this.app.command("CloseDataFrame").execute()},l);function l(){var e=null!==s&&s.apply(this,arguments)||this;return e.name=new n.Observable,e.description=new n.Observable,e.projectUrl=new n.Observable,e.isBusy=new n.Observable(!1),e.inputErrorMessage=new n.Observable,e.dataFrameIsOpen=e.app.dataFrameIsOpen,e}t.ProjectEditorViewModel=c})},"Mapping/modules/Project/ProjectModel":function(){var o,l=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/FrameworkObject","geocortex/framework/observables","geocortex/infrastructure/FormatUtils"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,c="{0} {1} {2}",o=(r=i.FrameworkObject,l(s,r),s.prototype.update=function(e){this.project=e,this.name=e.title||"",this.projectUrl=this.app.project.getProjectUrl(e),e.thumbnail&&(e.thumbnail.location?this.thumbnail=e.thumbnail.location:e.thumbnail.text&&(this.thumbnail=e.thumbnail.text)),String.isNullOrEmpty(this.thumbnail)&&(this.thumbnail=" "),e.description&&100<e.description.length?(this.canExpand=!0,this.description.set(this._trunc(e.description,100))):(this.canExpand=!1,this.description.set(e.description||""));var t=this.getResource("language-projects-created-by-label"),i=e.author?e.author.title:this.getResource("language-projects-author-guest"),o=a.formatDateFromNow(e.timeOfCreation);this.createdBy=c.format(t,i,o);var n=this.getResource("language-projects-last-modified-by-label"),r=e.editor?e.editor.title:this.getResource("language-projects-author-guest"),s=a.formatDateFromNow(e.timeOfLastModification);this.lastModifiedBy=c.format(n,r,s)},s.prototype._onIsExpandedChanged=function(e){this.canExpand&&(e?this.description.set(this.project.description):this.description.set(this._trunc(this.project.description,100)))},s.prototype._trunc=function(e,t){return e.length>t?e.substr(0,t-1)+"...":e},s);function s(e,t,i){var o=r.call(this,e,t)||this;return o.description=new n.Observable,o.canExpand=!1,o.isExpanded=new n.Observable(!1),i&&o.update(i),o.isExpanded.bind(o,o._onIsExpandedChanged),o}t.ProjectModel=o})},"Mapping/modules/Project/ProjectModule":function(){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=(o=i.ModuleBase,s(r,o),r.prototype.initialize=function(e){var t=this;o.prototype.initialize.call(this,e),this._registerCommandsAndEvents(),this.app.waitUntilDocumentStoreInitialized().then(function(){t.app.command("SaveProject").raiseCanExecuteChanged(),t.app.command("SaveAsProject").raiseCanExecuteChanged()})},r.prototype._registerCommandsAndEvents=function(){this.app.command("SaveProject").register(this,this._executeSaveProject,this._canExecuteSaveProject),this.app.command("SaveAsProject").register(this,this._executeSaveAsProject,this._canExecuteSaveAsProject),this.app.command("LoadProject").register(this,this._executeLoadProject),this.app.command("DeleteProject").register(this,this._executeDeleteProject,this._canExecuteDeleteProject),this.app.event("ProjectEditorFinishedEvent").subscribe(this,this._handleProjectEditorFinishedEvent),this.app.event("ProjectDeletedEvent").subscribe(this,this._handleCurrentProjectUpdated),this.app.event("ProjectLoadedEvent").subscribe(this,this._handleCurrentProjectUpdated),this.app.event("ProjectSavedEvent").subscribe(this,this._handleCurrentProjectUpdated)},r.prototype._executeSaveProject=function(){var t=this;if(this.app.project.current)if(this.app.site.documentStore.isReadOnly(this.app.project.current)){var e=this.getResource("language-project-confirm-save-title"),i=this._getConfirmActionDescription(this.app.project.current,"save");this.app.command("Confirm").execute(i,e,function(e){e&&t._executeSaveAsProject()})}else this._saveProject({id:this.app.project.current.id});else{var o=this.app.project.createEmpty(null);this.app.command("ShowProjectEditor").execute(o)}},r.prototype._canExecuteSaveProject=function(){return this.app.project.current?this.app.site&&(this.app.site.documentStore.canCreate()||!this.app.site.documentStore.isReadOnly(this.app.project.current)):this.app.site&&this.app.site.documentStore.canCreate()},r.prototype._executeSaveAsProject=function(){var e=this.app.project.createEmpty(null);this.app.project.current&&(e.title=this.app.project.current.title,e.description=this.app.project.current.description),this.app.command("ShowProjectEditor").execute(e)},r.prototype._canExecuteSaveAsProject=function(){return this.app.site&&this.app.site.documentStore.canCreate()},r.prototype._executeLoadProject=function(t){var i=this,e=this.getResource("language-project-confirm-load-title"),o="{0} {1}".format(this._getConfirmActionDescription(t,"load"),this.getResource("language-project-confirm-load-overwrite"));this.app.command("Confirm").execute(o,e,function(e){e&&i._loadProject(t)})},r.prototype._executeDeleteProject=function(t){var i=this,e=this.getResource("language-project-confirm-delete-title"),o=this._getConfirmActionDescription(t,"delete");this.app.command("Confirm").execute(o,e,function(e){e&&i._deleteProject(t)})},r.prototype._canExecuteDeleteProject=function(e){return"string"==typeof e||!!e&&this.app.site.documentStore.isOwner(e)},r.prototype._getConfirmActionDescription=function(e,t){return"object"==typeof e&&e.title?this.getResource("language-project-confirm-"+t+"-description-with-title").format(e.title):this.getResource("language-project-confirm-"+t+"-description")},r.prototype._handleProjectEditorFinishedEvent=function(e){var t=this;if(!e.canceled)if(e.existingProject.id)e.newProject.id=e.existingProject.id,this._saveProject(e.newProject,!1);else{var i=dojo.mixin(e.existingProject,e.newProject);this._saveProject(i).then(function(){return t.app.project.current=i})}},r.prototype._handleCurrentProjectUpdated=function(e){this.app.command("SaveProject").raiseCanExecuteChanged()},r.prototype._deleteProject=function(e){var t=this;return this.app.project.remove(e).catch(function(e){t.app.trace.error("Error deleting project: {0}".format(e.message),e)})},r.prototype._loadProject=function(e){var t=this;return this.app.project.load(e).catch(function(e){t.app.trace.error("Error loading project: {0}".format(e.message),e)})},r.prototype._saveProject=function(e,t){var i=this;return void 0===t&&(t=!0),this.app.project.save(e,t).catch(function(e){i.app.trace.error("Error saving project: {0}".format(e.message),e)})},r);function r(){return null!==o&&o.apply(this,arguments)||this}t.ProjectModule=n})},"Mapping/modules/Project/ProjectStatusView":function(){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=(o=i.ViewBase,s(r,o),r.prototype.attach=function(e){o.prototype.attach.call(this,e),this.configuration.showXButton=!1},r.prototype.handleShareButtonClick=function(e,t,i){this._deactivateView(),this.app.command("ShowShareProject").execute(this.viewModel.project)},r.prototype.handleCloseButtonClick=function(e,t,i){this._deactivateView()},r.prototype._registerCommandsAndEvents=function(){this.app.event("ProjectLoadingEvent").subscribe(this,this._handleProjectLoadingEvent),this.app.event("ProjectLoadedEvent").subscribe(this,this._handleProjectLoadedEvent),this.app.event("ProjectSavingEvent").subscribe(this,this._handleProjectSavingEvent),this.app.event("ProjectSavedEvent").subscribe(this,this._handleProjectSavedEvent),this.app.event("ProjectErrorEvent").subscribe(this,this._handleProjectErrorEvent)},r.prototype._handleProjectLoadingEvent=function(e){this.viewModel.project=e,this.viewModel.statusMessage.set(this.getResource("language-project-status-loading")),this.viewModel.isBusy.set(!0),this._activateView()},r.prototype._handleProjectLoadedEvent=function(e){this.viewModel.project=null,this._deactivateView()},r.prototype._handleProjectSavingEvent=function(e){this.viewModel.project=e,this.viewModel.statusMessage.set(this.getResource("language-project-status-saving")),this.viewModel.isBusy.set(!0),this._activateView()},r.prototype._handleProjectSavedEvent=function(e){this.viewModel.projectUrl.set(this.app.project.getProjectUrl(e)),this.viewModel.isBusy.set(!1),this.app.command("FocusOnFirstInputInView").execute(this),this.app.viewManager.notifyDimensionsChanged(this)},r.prototype._handleProjectErrorEvent=function(e){this.viewModel.project=null,this._deactivateView()},r.prototype._activateView=function(){this.isActive||this.app.command("ActivateView").execute(this.id)},r.prototype._deactivateView=function(){this.isActive&&this.app.command("DeactivateView").execute(this.id)},r);function r(e,t){var i=o.call(this,e,t)||this;return i._registerCommandsAndEvents(),i}t.ProjectStatusView=n})},"Mapping/modules/Project/ProjectStatusViewModel":function(){var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewModelBase,a(s,n),s.prototype.initialize=function(e){n.prototype.initialize.call(this,e),e.showUrlOnSave&&this.showProjectUrl.set(e.showUrlOnSave)},s);function s(){var e=null!==n&&n.apply(this,arguments)||this;return e.project=null,e.isBusy=new o.Observable(!0),e.statusMessage=new o.Observable,e.projectUrl=new o.Observable,e.showProjectUrl=new o.Observable,e}t.ProjectStatusViewModel=r})},"Mapping/modules/Project/ProjectStatusViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Project/ProjectsView":function(){var o,d=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","geocortex/essentials/documents/DocumentConstants","geocortex/infrastructure/ui/components/FilterControl/FilterControlViewBase"],function(e,t,i,o,a,n,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,r=(l=i.ViewBase,d(s,l),s.prototype.attach=function(e){l.prototype.attach.call(this,e);var t=this.viewModel.minimumFilterDelay;this._keyDownTimer=new o.TimeDelayedAction(t,this._filterProjects,this)},s.prototype.activated=function(){l.prototype.activated.call(this),this.viewModel.activated()},s.prototype.handleClearFilterClick=function(e,t,i){this.viewModel.clearFilter(),this.app.command("FocusOnFirstInputInView").execute(this)},s.prototype.handleFilterButtonClick=function(e,t,i){this.viewModel.filterControlViewModel.filterText.pulse()},s.prototype.handleProjectClick=function(e,t,i){this.app.command("LoadProject").execute(i.project)},s.prototype.handleProjectActions=function(e,t,i){this.app.command("ShowProjectActions").execute(i.project)},s.prototype.handleProjectExpanderClick=function(e,t,i){var o=i.isExpanded.get();t.textContent=o?this.getResource("language-projects-description-more"):this.getResource("language-projects-description-less"),i.isExpanded.set(!o)},s.prototype.handleThumbnailLoadError=function(e,t,i){t.src!==this.viewModel.defaultThumbnail&&(t.src=this.viewModel.defaultThumbnail,t.src!==this.viewModel.defaultThumbnail&&(this.viewModel.defaultThumbnail=t.src))},s.prototype.resolveWidget=function(e,t,i){if(l.prototype.resolveWidget.call(this,e,t),!e)return null;switch(e){case"ProjectsActionsWidget":return this.app.menuRegistry.createMenuWidget(this,t,i);case"PagingControlsWidget":var o=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(o){var n=new a.PagingControlsViewModel(this.app,t);o.attach(n)}return o;case"ProjectFilterWidget":if(!t||!t.filterControlViewModel)return null;var r=new c.FilterControlViewBase(this.app,this.libraryId);r.handleFilterButtonClick=dojo.hitch(this,this.handleFilterButtonClick),r.handleFilterTextClear=dojo.hitch(this,this.handleClearFilterClick);var s=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/ui/components/FilterControl/FilterControlView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.FilterControl.FilterControlViewBase",isVisible:!0},r);return t.filterControlViewModel.handleFilterTextInput=dojo.hitch(this,this._filterProjects),s.attach(t.filterControlViewModel),s;default:return null}},s.prototype._registerCommandsAndEvents=function(){this.app.command("ShowProjects").register(this,this._executeShowProjects,this._canExecuteShowProjects),this.app.event("ProjectLoadedEvent").subscribe(this,this._handleProjectLoadedEvent)},s.prototype._executeShowProjects=function(){this.app.command("ActivateView").execute(this.id)},s.prototype._canExecuteShowProjects=function(){return!(!this.app.site||!this.app.site.documentStore)&&!!this.app.site.documentStore.supported&&(!!this.app.site.documentStore.canCreate()||this.app.site.documentStore.hasPolicyGrant(function(e){return e.globalId===n.GrantID.PUBLIC&&e.kind===n.GrantKind.GLOBAL_READER}))},s.prototype._filterProjects=function(){if(this.viewModel&&this.viewModel.filterControlViewModel){var e=this.viewModel.filterControlViewModel.filterText.get();this.viewModel.updateFilter(e)}},s.prototype._handleProjectLoadedEvent=function(e){this.app.command("DeactivateView").execute(this.id)},s.prototype._isSpecialChar=function(e){switch(e){case dojo.keys.TAB:case dojo.keys.SHIFT:case dojo.keys.CTRL:case dojo.keys.ALT:case dojo.keys.PAUSE:case dojo.keys.CAPS_LOCK:case dojo.keys.ESCAPE:case dojo.keys.PAGE_UP:case dojo.keys.PAGE_DOWN:case dojo.keys.END:case dojo.keys.HOME:case dojo.keys.LEFT_ARROW:case dojo.keys.UP_ARROW:case dojo.keys.RIGHT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.NUM_LOCK:case dojo.keys.SCROLL_LOCK:case dojo.keys.INSERT:return!0}return!1},s);function s(e,t){var i=l.call(this,e,t)||this;return i._keyDownTimer=null,i._registerCommandsAndEvents(),i.app.waitUntilDocumentStoreInitialized().then(function(){i.app.command("ShowProjects").raiseCanExecuteChanged()}),i}t.ProjectsView=r})},"Mapping/modules/Project/ProjectsViewModel":function(){var o,g=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/essentials/documents/DocumentConstants","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/documents/DocumentCollection","./ProjectModel","geocortex/framework/observables","geocortex/infrastructure/project/ProjectManager","geocortex/infrastructure/ui/components/FilterControl/FilterControlViewModelBase"],function(e,t,o,i,n,r,s,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,d=o.DocumentField.TIME_CREATION,p=(l=i.ViewModelBase,g(u,l),u.prototype.initialize=function(e){var t=this;l.prototype.initialize.call(this,e),e.defaultThumbnail&&(this.defaultThumbnail=e.defaultThumbnail),e.minimumFilterDelay&&(this.minimumFilterDelay=e.minimumFilterDelay),this.isBusy.sync(this.presentableResults.statusFetching),this.statusOffline.sync(this.presentableResults.statusOffline),this.statusEmpty.syncTransform(this.presentableResults.numberOfItems,function(e){return 0===e&&t.presentableResults.isInitialized}),this.privateProjectsOnly.bind(this,this._privateProjectsOnlyChanged),this.selectedFieldSorter.bind(this,this._selectedFieldSorterChanged),this._setFieldSorters()},u.prototype.activated=function(){var e=this;this._activated||(this._activated=!0,this.app.waitUntilDocumentStoreInitialized().then(function(){0<e.app.site.documentStore.userMonikers.length&&(e.isAuthenticated.set(!0),e.privateProjectsOnly.set(!0)),e.presentableResults.addFilter({field:"properties.{0}.string".format(a.SITE_ID_PROPERTY_NAME),range:[{string:e.app.site.id}]}),e.presentableResults.initialize({fileType:a.PROJECT_TYPE,queryParams:{sortDescending:[d]}})}))},u.prototype.refreshProjects=function(){this.presentableResults.refresh()},u.prototype.clearFilter=function(){this.filterControlViewModel.filterText.set(""),this.updateFilter(null)},u.prototype.updateFilter=function(e){String.isNullOrEmpty(e)?this.presentableResults.removeFilter(this._filterTextField):this.presentableResults.addFilter({field:this._filterTextField,method:o.FilterMethod.MATCHES,range:[{string:e}]})},u.prototype._registerCommandsAndEvents=function(){this.app.command("RefreshProjectsList").register(this,this.refreshProjects),this.app.event("ProjectSavedEvent").subscribe(this,this._handleProjectSavedEvent),this.app.event("ProjectDeletingEvent").subscribe(this,this._handleProjectDeletingEvent)},u.prototype._handleProjectSavedEvent=function(e){this.refreshProjects()},u.prototype._handleProjectDeletingEvent=function(e){this.isBusy.set(!0),this.presentableResults.stopFetching=!0,this._projectDeleteToken=this.app.event("ProjectDeletedEvent").once(this,this._handleProjectDeletedEvent),this._projectErrorToken=this.app.event("ProjectErrorEvent").once(this,this._handleProjectDeletedEvent)},u.prototype._handleProjectDeletedEvent=function(){this.app.event("ProjectDeletedEvent").unsubscribe(this._projectDeleteToken),this.app.event("ProjectErrorEvent").unsubscribe(this._projectErrorToken),this._projectDeleteToken=null,this._projectErrorToken=null,this.presentableResults.stopFetching=!1,this.refreshProjects()},u.prototype._privateProjectsOnlyChanged=function(e){e?this.presentableResults.addFilter(this.app.site.documentStore.userFilter):this.presentableResults.removeFilter(o.DocumentField.GRANT_TOKEN)},u.prototype._selectedFieldSorterChanged=function(e){e.fields&&this.presentableResults.sortBy(e)},u.prototype._setFieldSorters=function(){var e=[{fields:null,displayName:this.app.getResource(this.libraryId,"language-projects-sort-default-display-name")},{fields:[o.DocumentField.TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-name-display-name")},{fields:[o.DocumentField.TIME_CREATION,o.DocumentField.TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-created-display-name"),descending:!0},{fields:[o.DocumentField.TIME_LAST_MODIFICATION,o.DocumentField.TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-modified-display-name"),descending:!0},{fields:[o.DocumentField.EDITOR_TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-modifiedby-display-name")},{fields:[o.DocumentField.AUTHOR_TITLE],displayName:this.app.getResource(this.libraryId,"language-projects-sort-createdby-display-name")}];this.fieldSorters.set(e)},u);function u(e,t){var i=l.call(this,e,t)||this;i._activated=!1,i.defaultPageSize=10,i.minimumFilterDelay=300,i.privateProjectsOnly=new s.Observable(!1),i.fieldSorters=new s.ObservableCollection,i.selectedFieldSorter=new s.Observable,i.isAuthenticated=new s.Observable(!1),i.isBusy=new s.Observable(!1),i.statusOffline=new s.Observable(!1),i.statusEmpty=new s.Observable(!1);return i.presentableResults=new n.DocumentCollection(i.app,i.libraryId,function(e){return new r.ProjectModel(i.app,i.libraryId,e.entity)}),i.projectsPage=i.presentableResults.items,i.filterControlViewModel=new c.FilterControlViewModelBase(i.app,i.libraryId),i.filterControlViewModel.filterInputPlaceholder.set(i.getResource("language-projects-filter-placeholder")),i.filterControlViewModel.filterButtonText.set(i.getResource("language-project-filter-button-text")),i._filterTextField=[o.DocumentField.TITLE,o.DocumentField.DESCRIPTION,o.DocumentField.AUTHOR_TITLE,o.DocumentField.EDITOR_TITLE].join(","),i._registerCommandsAndEvents(),i}t.ProjectsViewModel=p})},"Mapping/modules/Project/ProjectsViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Project/ShareProjectView":function(){var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/documents/DocumentConstants"],function(e,t,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewBase,a(s,n),s.prototype.handleAddLinkButtonClick=function(e,t,i){this.viewModel.addGuestLink(i)},s.prototype.handleRemoveLinkButtonClick=function(e,t,i){var o=this,n=this.getResource("language-project-confirm-remove-guest-link-title"),r=this.getResource("language-project-confirm-remove-guest-link-description");this.app.command("Confirm").execute(r,n,function(e){e&&o.viewModel.removeGuestLink(i)})},s.prototype.handleClearButtonClick=function(e,t,i){var o=this,n=this.getResource("language-project-confirm-stop-sharing-title"),r="language-project-confirm-stop-sharing-{0}".format(this.viewModel.showGuestLinks.get()?"all-description":"description"),s=this.getResource(r).format(this.viewModel.project.get().title);this.app.command("Confirm").execute(s,n,function(e){e&&o.viewModel.updateProjectGrants(!0)})},s.prototype.handleSaveButtonClick=function(e,t,i){var o=this;if(this.viewModel.confirmSharedPublicly&&this._isPublic(this.viewModel.project.get())){var n=this.getResource("language-project-confirm-share-public-title"),r=this._getConfirmPublicDescription(this.viewModel.project.get());this.app.command("Confirm").execute(r,n,function(e){e&&o.viewModel.updateProjectGrants()})}else this.viewModel.updateProjectGrants()},s.prototype.handleCloseButtonClick=function(e,t,i){this._deactivateView()},s.prototype.resolveWidget=function(e,t,i){if(n.prototype.resolveWidget.call(this,e,t),!e)return null;switch(e){case"GrantEditorWidget":var o=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.documents.GrantEditorView",markupResource:"Mapping/infrastructure/documents/GrantEditorView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});return o&&o.attach(this.viewModel.grantEditorViewModel),o;default:return null}},s.prototype._registerCommandsAndEvents=function(){this.app.command("ShowShareProject").register(this,this._executeShowShareProject)},s.prototype._executeShowShareProject=function(e){this.viewModel.loadProject(e),this.app.command("ActivateView").execute(this.id)},s.prototype._deactivateView=function(){this.app.command("DeactivateView").execute(this.id)},s.prototype._isPublic=function(e){return!!this.app.site.documentStore.isPublic(e)||!(!this.viewModel.allowPublicReadAccess||!this._hasLink(e,o.GrantKind.READER_LINK))||!(!this.viewModel.allowPublicEditAccess||!this._hasLink(e,o.GrantKind.WRITER_LINK))},s.prototype._getConfirmPublicDescription=function(e){return this.viewModel.allowPublicEditAccess&&this._hasLink(e,o.GrantKind.WRITER_LINK)?this.getResource("language-project-confirm-share-public-edit-description").format(this.viewModel.project.get().title):this.getResource("language-project-confirm-share-public-description").format(this.viewModel.project.get().title)},s.prototype._hasLink=function(e,t){return e.grants.some(function(e){return e.kind===t&&(!1===e.revoke||!0===e.assert)})},s);function s(e,t){var i=n.call(this,e,t)||this;return i._registerCommandsAndEvents(),i}t.ShareProjectView=r})},"Mapping/modules/Project/ShareProjectViewModel":function(){var o,u=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/documents/GrantEditorViewModel","geocortex/framework/observables","geocortex/infrastructure/documents/GuestLinkModel","geocortex/essentials/documents/DocumentConstants","geocortex/essentials/documents/DocumentStore","geocortex/essentials/documents/BatchRequestBuilder"],function(e,t,i,o,n,r,s,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,d=(l=i.ViewModelBase,u(p,l),p.prototype.initialize=function(e){var t=this;l.prototype.initialize.call(this,e),e.showGuestLinks&&this.showGuestLinks.set(e.showGuestLinks),e.confirmSharedPublicly&&(this.confirmSharedPublicly=e.confirmSharedPublicly),this.app.waitUntilDocumentStoreInitialized().then(function(){t.allowPublicReadAccess=t.app.site.documentStore.hasPolicyGrant(function(e){return e.kind===s.GrantKind.GLOBAL_READER&&e.globalId===s.GrantID.PUBLIC}),t.allowPublicEditAccess=t.app.site.documentStore.hasPolicyGrant(function(e){return e.kind===s.GrantKind.GLOBAL_WRITER&&e.globalId===s.GrantID.PUBLIC}),t.allowPublicReadAccess&&t.guestLinks.getItems().filter(function(e){return e.kind===s.GrantKind.READER_LINK}).forEach(function(e){return e.name.set(t.getResource("language-share-project-links-public-view-label"))}),t.allowPublicEditAccess&&t.guestLinks.getItems().filter(function(e){return e.kind===s.GrantKind.WRITER_LINK}).forEach(function(e){return e.name.set(t.getResource("language-share-project-links-public-edit-label"))})})},p.prototype.loadProject=function(e){var t=this;this.statusMessage.set(this.getResource("language-common-loading")),this.isBusy.set(!0);var i=this.app.project.getProjectID(e);this.grantEditorViewModel.loadById(i).then(function(){return t._updateModel(t.grantEditorViewModel.document)}).catch(function(e){t.app.trace.error("Error loading project: {0}".format(e.message),e),t._reset()}).finally(function(){return t.isBusy.set(!1)})},p.prototype.addGuestLink=function(e){var t=e.grant;if(t&&t.globalId===e.link)t.assert=!0,t.revoke=!1;else{t&&(t.assert=!1,t.revoke=!0);var i={globalId:e.link,kind:e.kind,assert:!0,revoke:!1};e.grant=i,this.project.get().grants.push(i)}e.linkUrl.set(this._buildGuestLinkUrl(this.projectUrl.get(),e.link))},p.prototype.removeGuestLink=function(e){e.grant?(e.grant.assert=!1,e.grant.revoke=!0,e.linkUrl.set(null)):this.app.trace.error("Error removing guest link: No grant provided.")},p.prototype.updateProjectGrants=function(e){var t=this;void 0===e&&(e=!1),this.statusMessage.set(this.getResource("language-project-status-updating")),this.isBusy.set(!0);var i=this.project.get().id,o=this.project.get().grants;e&&o.forEach(function(e){e.assert=!1,e.revoke=!0});var n={id:i,grants:o};return this.app.project.write(n).then(function(){return t.grantEditorViewModel.loadById(i)}).then(function(){return t._updateModel(t.grantEditorViewModel.document)}).catch(function(e){t.app.trace.error("Error updating project grants: {0}".format(e.message),e)}).finally(function(){return t.isBusy.set(!1)})},p.prototype._buildGuestLinkUrl=function(e,t){var i=e;return i+=-1<i.indexOf("?")?"&":"?",i+="{0}={1}".format(a.LINK_QUERY_STRING_KEY,t)},p.prototype._updateModel=function(e){return e?(this.project.set(e),this.projectUrl.set(this.app.project.getProjectUrl(e)),this.isOwner.set(this.app.site.documentStore.isOwner(e)),this._updateGuestLinks(e)):Promise.resolve(this._reset())},p.prototype._updateGuestLinks=function(e){var i=this,o=this.guestLinks.getItems(),n=this.app.project.getProjectUrl(e);if(o.forEach(function(e){return e.reset()}),e.grants)for(var t=function(t){o.forEach(function(e){t.kind===e.kind&&(e.grant=t,e.linkUrl.set(i._buildGuestLinkUrl(n,t.globalId)))})},r=0,s=e.grants;r<s.length;r++)t(s[r]);var a=c.generateLinks(this.guestLinks.length());return this.app.waitUntilSiteInitialized().then(function(){return i.app.site.documentStore.perform(a,!0)}).then(function(i){o.forEach(function(e,t){return e.link=i.links[t]})}).catch(function(e){i.app.trace.error("Error generating guest links: {0}".format(e.essage),e)})},p.prototype._reset=function(){this.project.set(null),this.projectUrl.set(null),this.isOwner.set(!1),this.guestLinks.getItems().forEach(function(e){return e.reset()})},p.prototype._setupGuestLinks=function(){this.guestLinks.addItem(new r.GuestLinkModel({name:this.getResource("language-share-project-links-view-label"),kind:s.GrantKind.READER_LINK})),this.guestLinks.addItem(new r.GuestLinkModel({name:this.getResource("language-share-project-links-edit-label"),kind:s.GrantKind.WRITER_LINK}))},p);function p(e,t){var i=l.call(this,e,t)||this;return i.allowPublicReadAccess=!1,i.allowPublicEditAccess=!1,i.project=new n.Observable,i.projectUrl=new n.Observable,i.guestLinks=new n.ObservableCollection,i.showGuestLinks=new n.Observable,i.statusMessage=new n.Observable,i.isOwner=new n.Observable(!1),i.isBusy=new n.Observable(!1),i.grantEditorViewModel=new o.GrantEditorViewModel(e,"Mapping.Infrastructure"),i._setupGuestLinks(),i}t.ShareProjectViewModel=d})},"Mapping/modules/Project/ShareProjectViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"url:/Mapping/modules/Project/ProjectActionsView.html":t,"url:/Mapping/modules/Project/ProjectEditorView.html":i,"url:/Mapping/modules/Project/ProjectStatusView.html":o,"url:/Mapping/modules/Project/ProjectsView.html":n,"url:/Mapping/modules/Project/ShareProjectView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Project/CSS/common.css","css","LnByb2plY3QtZWRpdG9yLWNvbnRlbnQgew0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBwYWRkaW5nOiAwIDFlbSAxZW0gMWVtOw0KfQ0KDQoucHJvamVjdC1lZGl0b3Itc2F2ZS1jb21wbGV0ZSB7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQovKi5wcm9qZWN0cyAucHJvamVjdC1maWx0ZXItd2lkZ2V0IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiA0ZW07DQogICAgYmFja2dyb3VuZDogI0VFRUVFRTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9Ki8NCg0KLnByb2plY3RzIC5maWx0ZXItaW5wdXQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHBhZGRpbmc6IDNweCAzMHB4IDRweCA5cHg7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQogICAgZm9udC1zaXplOiAxLjZlbTsNCiAgICBjb2xvcjogIzY1NjE2OTsNCiAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7DQogICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDApOw0KfQ0KDQovKi5wcm9qZWN0cyAuZmlsdGVyLWJ1dHRvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMXB4Ow0KICAgIHJpZ2h0OiAxcHg7DQogICAgYm90dG9tOiAxcHg7DQogICAgd2lkdGg6IDQwcHg7DQogICAgYmFja2dyb3VuZDogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2xlYXItMjQucG5nKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LWluZGVudDogLTk5OWVtOw0KfSovDQoNCi5wcm9qZWN0cy1vcHRpb25zIHsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgei1pbmRleDogMTsNCn0NCg0KLyotLS0tLS1Qcm9qZWN0IFNlbGVjdG9yIFRvb2xzLS0tLS0tKi8NCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzIHsNCiAgICBoZWlnaHQ6IDNlbTsNCn0NCg0KLnByb2plY3Qtc2VsZWN0b3ItZHJvcGRvd24gew0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBwYWRkaW5nOiAwLjc1ZW0gMC41ZW0gMC43NWVtIDAuMmVtOw0KfQ0KDQoucHJvamVjdC1zZWxlY3Rvci10b29scyBzZWxlY3Qgew0KICAgIG1pbi13aWR0aDogMTAwJTsNCn0NCg0Kc3Bhbi5wcm9qZWN0LXNlbGVjdG9yLWRyb3Bkb3duIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IDUwJTsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzOjphZnRlciB7DQogICBjb250ZW50OiAiICI7DQogICBkaXNwbGF5OiBibG9jazsgDQogICBoZWlnaHQ6IDA7IA0KICAgY2xlYXI6IGJvdGg7DQp9DQoNCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzIC5wcm9qZWN0LWNoZWNrYm94IHsNCiAgICB3aWR0aDogNTAlOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGNsZWFyOiByaWdodDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBwYWRkaW5nOiAwLjc1ZW0gMC4yZW0gMC43NWVtIDAuNWVtOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0NCg0KLnByb2plY3Qtc2VsZWN0b3ItdG9vbHMgLnByb2plY3QtY2hlY2tib3ggc3BhbiwNCi5wcm9qZWN0LXNlbGVjdG9yLXRvb2xzIC5wcm9qZWN0LWNoZWNrYm94IGlucHV0IHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoucHJvamVjdHMtc3RhdHVzLW1lc3NhZ2Ugew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5saXN0LW1lbnUsDQoubGlzdC1tZW51ICogew0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLyotLS0tLS1Qcm9qZWN0IExpc3QtLS0tLS0qLw0KLnByb2plY3RzLWxpc3QgLmxpc3QtbWVudSB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbGlzdC1zdHlsZS10eXBlOiBub25lOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDdlbTsNCiAgICBib3R0b206IDZlbTsNCiAgICBvdmVyZmxvdzogYXV0bzsNCn0NCg0KLnByb2plY3RzIC5wYWdpbmctY29udHJvbCB7DQogICAgaGVpZ2h0OiA2ZW07DQp9DQoNCi8qLS0tUHJvamVjdCBMaXN0IEl0ZW0tLS0qLw0KLnByb2plY3RzLWxpc3QgLmxpc3QtbWVudSAuaXRlbS1saXN0LWl0ZW0gew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBjbGVhcjogYm90aDsNCiAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsNCiAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwOw0KfQ0KDQoucHJvamVjdHMgLmxpc3QtaXRlbS1pY29uIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBoZWlnaHQ6IDUwcHg7DQogICAgd2lkdGg6IDcwcHg7DQogICAgcGFkZGluZzogMC4zZW0gMC4yZW0gMCAwLjNlbTsNCn0NCg0KLnByb2plY3RzIC5saXN0LWl0ZW0tYnV0dG9uIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogNTBweDsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQoucHJvZmlsZS1tYW5hZ2UgLmxpc3QtaXRlbS1idXR0b24gew0KICAgIHBhZGRpbmctcmlnaHQ6IDcuNWVtOw0KfQ0KDQoubGlzdC1pdGVtLWltZyB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBsZWZ0OiAwOw0KICAgIG1heC1oZWlnaHQ6IDEwMCU7DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWNvbnRlbnQgLnNoYXJlLXdpdGgsDQouc2hhcmUtcHJvamVjdC1jb250ZW50IC5zaGFyZS13aXRoIGxhYmVsIHsNCiAgICBwYWRkaW5nLWJvdHRvbTogMDsNCn0NCg0KLmxpc3QtaXRlbS1idXR0b24ucHJvamVjdC1hY3Rpb25zIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAwOw0KICAgIHdpZHRoOiAzLjVlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KICAgIHBhZGRpbmc6IDA7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KfQ0KDQoucHJvamVjdHMtbGlzdCAubW9yZS1idXR0b24gew0KICAgIHdpZHRoOiAzLjVlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIG1hcmdpbi1ib3R0b206IDAuNDVlbTsNCn0NCg0KLyotLS0tLS1Qcm9qZWN0IExpc3QgSXRlbSBUZXh0LS0tLS0tKi8NCi5wcm9qZWN0LW92ZXJ2aWV3IHsNCiAgICBtYXJnaW46IDAgMy41ZW0gMCAwOw0KICAgIHBhZGRpbmc6IDAgMC41ZW07DQp9DQoNCi5wcm9qZWN0LW92ZXJ2aWV3IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgcGFkZGluZy10b3A6IDAuMTVlbTsNCn0NCg0KLnByb2plY3QtbmFtZSwNCi5wcm9qZWN0LWRlc2NyaXB0aW9uIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQp9DQoNCi5wcm9qZWN0LW5hbWUgew0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQoNCi5wcm9qZWN0LWRlc2NyaXB0aW9uIHsNCiAgICBjb2xvcjogIzMzMzMzMzsNCiAgICBwYWRkaW5nOiAwLjJlbSAwOw0KfQ0KDQoucHJvamVjdC1kZXNjcmlwdGlvbjplbXB0eSB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLnByb2plY3QtZGV0YWlscyB7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDAgMC41ZW07DQogICAgbWFyZ2luOiAwIDMuNWVtIDAgMDsNCiAgICBjbGVhcjogYm90aDsNCn0NCg0KLnByb2plY3QtZGV0YWlsczo6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIiOw0KICAgIGNsZWFyOiBib3RoOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMDsNCn0NCg0KLnByb2plY3QtbW9kaWZpZWQsDQoucHJvamVjdC1jcmVhdGVkIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBjb2xvcjogIzY2NjY2NjsNCiAgICBmb250LXdlaWdodDogMzAwOw0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICBmb250LXNpemU6IDAuOWVtOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjRlbTsNCn0NCg0KLnByb2plY3QtY3JlYXRlZCB7DQogICAgbWFyZ2luLWJvdHRvbTogMC4yZW07DQp9DQoNCi8qIC0tLS0tLSBTVEFSVCBCdXR0b24gU3RhdGVzIC0tLS0tLSovDQoucHJvamVjdC1pbmZvOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjREVGMkZGOw0KfQ0KDQouaXRlbS1saXN0LWl0ZW0gLmNoZXZyb24tcmlnaHQtMTY6aG92ZXIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNERUYyRkY7DQp9DQovKiAtLS0tLS0gRU5EIEJ1dHRvbiBTdGF0ZXMgLS0tLS0tKi8NCg0KLyotLS1TaGFyZSBQcm9qZWN0IFZpZXctLS0qLw0KLnNoYXJlLXByb2plY3QtY29udGVudCB7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQouc2hhcmUtcHJvamVjdC1jb250ZW50IGgyIHsNCiAgICBmb250LXNpemU6IDEuMmVtOw0KfQ0KDQouc2hhcmUtd2l0aC1sYWJlbCB7DQogICAgcGFkZGluZy1ib3R0b206IDA7DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5jbGVhci0yNCwNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5hZGQtMTYgew0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQogICAgZm9udC1zaXplOiAyZW07DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5saW5rLWJveCB7DQogICAgd2lkdGg6IDkwJTsNCiAgICBtYXJnaW46IDA7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouc2hhcmUtcHJvamVjdC1saW5rcyB7DQogICAgbWFyZ2luLXRvcDogMS41ZW07DQp9DQoNCi5wcm9qZWN0LWxpbmstYnV0dG9ucyB7DQogICAgd2lkdGg6IDglOw0KICAgIG1hcmdpbi1sZWZ0OiAyJTsNCiAgICB0ZXh0LWFsaWduOiByaWdodDsNCn0NCg0KLnNoYXJlLXByb2plY3QtbGlua3MgLmNsZWFyLTI0IHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9jbGVhci0yNC5wbmcpIGNlbnRlciBuby1yZXBlYXQ7DQp9DQoNCi5zaGFyZS1wcm9qZWN0LWxpbmtzIC5hZGQtMTYgew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvYWRkLTE2LnBuZykgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg0KLnNoYXJlLXByb2plY3QgLnNoYXJlLXByb2plY3QtYnV0dG9ucyB7DQogICAgbWFyZ2luLXRvcDogMy41ZW07DQp9"),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/CSS/medium.css","css","LmZpbHRlci1ib3ggew0KICAgIGhlaWdodDogNGVtOw0KfQ0KDQoucHJvamVjdC1zZWxlY3Rvci10b29scyB7DQogICAgaGVpZ2h0OiAzLjJlbTsNCn0NCg0KLnByb2plY3RzLWxpc3QgLmxpc3QtbWVudSB7DQogICAgdG9wOiA3LjJlbTsNCn0NCg=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/CSS/small.css","css","LmZpbHRlci1ib3gsDQoucHJvamVjdC1zZWxlY3Rvci10b29scyB7DQogICAgaGVpZ2h0OiA0ZW07DQp9DQoNCi5wcm9qZWN0cy1saXN0IC5saXN0LW1lbnUgew0KICAgIHRvcDogOGVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectActionsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectEditorView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectStatusView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ProjectsView.html","html",n),e.resourceManager.register("Mapping","inv","Mapping/modules/Project/ShareProjectView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Project/ProjectActionsView","Mapping/modules/Project/ProjectEditorView","Mapping/modules/Project/ProjectEditorViewModel","Mapping/modules/Project/ProjectModel","Mapping/modules/Project/ProjectModule","Mapping/modules/Project/ProjectStatusView","Mapping/modules/Project/ProjectStatusViewModel","Mapping/modules/Project/ProjectsView","Mapping/modules/Project/ProjectsViewModel","Mapping/modules/Project/ShareProjectView","Mapping/modules/Project/ShareProjectViewModel"],function(e,t,i,o,n,r,s,a,c,l,d){p(e,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectActionsView",e.ProjectActionsView),p(t,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectEditorView",t.ProjectEditorView),p(i,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectEditorViewModel",i.ProjectEditorViewModel),p(o,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectModel",o.ProjectModel),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectModule",n.ProjectModule),p(r,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectStatusView",r.ProjectStatusView),p(s,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectStatusViewModel",s.ProjectStatusViewModel),p(a,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectsView",a.ProjectsView),p(c,"geocortex.essentialsHtmlViewer.mapping.modules.project.ProjectsViewModel",c.ProjectsViewModel),p(l,"geocortex.essentialsHtmlViewer.mapping.modules.project.ShareProjectView",l.ShareProjectView),p(d,"geocortex.essentialsHtmlViewer.mapping.modules.project.ShareProjectViewModel",d.ShareProjectViewModel)})}();