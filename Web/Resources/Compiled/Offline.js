function shim(e,t,n){if("string"==typeof e&&(n=t,t=e),"undefined"==typeof n)return void console.warn("Undefined shim for: "+t);for(var i=t.split("."),a=null,o=window,r=0,s=i.length;r<s;r++)a=i[r],r==s-1?o[a]=n:o[a]||(o[a]={}),o=o[a]}require({cache:{"Mapping/modules/Offline/Catalog":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/Offline/OfflineModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/GeometryUtils","geocortex/essentials/utilities/UrlUtilities"],function(e,t,n,i,a){"use strict";var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._nativeAppHasBeenNotified=!1,t._geocortexSessionExpiryArgs=null,t._tokenRefreshSuspended=!1,t}return __extends(t,e),t.prototype.initialize=function(t){var n=this;e.prototype.initialize.call(this,t),this.app.isOffline.bind(this,function(e){n._handleOfflineStatusChangeForTokenRefresh(e)}),this.app.nativeManager.isNative()&&this._attachTokenRefreshHooks(),this._registerCommands(),this.app.event("OfflineMapsLoadedEvent").subscribe(this,this._offlineMapsLoadedEventHandler),this.app.event("OfflineMapActivatedEvent").subscribe(this,this._offlineMapActivatedEventHandler)},t.prototype._registerCommands=function(){var e=this;this.app.command("ClearStorageForApplication").register(this,function(t){return e._clearStorage(!1,t)}),this.app.command("ClearStorageForDomain").register(this,function(t){return e._clearStorage(!0,t)}),this.app.command("ResumeOfflineTokenRefresh").register(this,this._handleResumeOfflineTokenRefresh),this.app.command("SignOut").register(this,this._tellNativeUserLoggedOut),this.app.command("SignIn").register(this,this._tellNativeUserLoggingIn),this.app.event("UserSigningOutEvent").subscribe(this,this._onUserSigningOut)},t.prototype._tellNativeUserLoggedOut=function(){this.app.nativeManager.message("SignOutNative",{fromViewer:!0})},t.prototype._tellNativeUserLoggingIn=function(){this.app.nativeManager.message("SigningInNative",{fromViewer:!0})},t.prototype._attachTokenRefreshHooks=function(){var e=this;dojo.subscribe("geocortex_sessionExpiring",function(t){e._geocortexSessionExpiryArgs=t,t.handled=!0,t.suspendRefresh(),e._tokenRefreshSuspended=!0,e.app.nativeManager.message("CanReachHost",{url:e.app.site.url}).then(function(n){n.result?t.resumeRefresh()&&(e._tokenRefreshSuspended=!1):e.app.trace.info("Principal expiring offline. Flagged for refresh the next time the user goes online.")})})},t.prototype._handleOfflineStatusChangeForTokenRefresh=function(e){this._geocortexSessionExpiryArgs&&!e&&this._tokenRefreshSuspended&&(this._geocortexSessionExpiryArgs.resumeRefresh(),this._tokenRefreshSuspended=!1)},t.prototype._handleResumeOfflineTokenRefresh=function(){this._handleOfflineStatusChangeForTokenRefresh(!1)},t.prototype._clearStorage=function(e,t){var n=this,i=e?this.app.store.clearAllData:this.app.store.clear,a=function(){i.call(n.app.store,function(){n.app.trace.info("Offline data for this application cleared."),n.app.event("ApplicationStorageClearedEvent").publish();var e=n.getResource("language-offline-data-cleared"),t=n.getResource("language-offline-data-cleared-title");n.app.command("Alert").execute(e,t)},function(e){n.app.trace.info("There was an error clearing offline data.");var t=n.getResource("language-offline-error-clearing-data").format(e);n.app.command("Alert").execute(t)})};t?this.app.command("Confirm").execute(this.getResource("language-clear-storage-confirm"),this.getResource("language-clear-storage"),function(e){e&&a()}):a()},t.prototype._offlineMapsLoadedEventHandler=function(e){var n=this;e.activeOfflineMap&&this.app.waitUntilSiteInitialized().then(function(){var i=new esri.geometry.Polygon(e.activeOfflineMap.content.geometry);n.app.site.essentialsMap.extentManager.setExtentWithPriority(i.getExtent().expand(t._zoomExtentExpandFactor),10)})},t.prototype._offlineMapActivatedEventHandler=function(e){var n=this;if(e.offlineMap&&e.userAction){var a=new esri.geometry.Polygon(e.offlineMap.content.geometry);i.intersects(this.app.map.extent.getCenter(),a).then(function(e){e||n.app.map.setExtent(a.getExtent().expand(t._zoomExtentExpandFactor))})}},t.prototype._onUserSigningOut=function(e){var t=this;this.app.nativeManager.isNative()&&this.app.offlineManager.isOfflineMapActive.get()&&(e.isCancelled=!0,this.app.nativeManager.message("CanReachHost",{url:this.app.site.url}).then(function(e){var n=e.result;if(n)t.app.offlineManager.getStoreResource(t.app.offlineManager.getActiveOfflineMap(),"__site_").then(function(e){var n=JSON.parse(e||"{}");return n.principal&&(n.principal.isAuthenticated=!1,n.principal.label="Guest",n.principal.expiry=null,n.principal.identities=[],n.principal.tokens={arcgis:{},geocortex:{},site:null}),t.app.offlineManager.setStoreResource(t.app.offlineManager.getActiveOfflineMap(),"__site_",JSON.stringify(n))}).then(function(){t.app.site.signOut()});else{var i=a.UrlUtilities.getUrlComponents(t.app.site.url).hostname;t.app.command("Alert").execute(t.getResource("language-offline-signout-offline").format(i),t.getResource("language-offline-signout-title"))}})["catch"](function(e){t.app.command("Alert").execute(t.getResource("language-offline-signout-unexpected-error").format(e.message||e),t.getResource("language-offline-signout-title"))}))},t}(n.ModuleBase);o._zoomExtentExpandFactor=1.5,t.OfflineModule=o})},"Mapping/modules/Offline/OfflineModuleConfig":function(){define(["require","exports"],function(e,t){"use strict"})}}}),define(["Mapping/modules/Offline/OfflineModule"],function(e){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.offline.OfflineModule",e.OfflineModule)});