!function(){function e(e,t,o){if("string"==typeof e&&(o=t,t=e),void 0!==o)for(var i=t.split("."),n=null,a=window,r=0,s=i.length;r<s;r++)n=i[r],r==s-1?a[n]=o:a[n]||(a[n]={}),a=a[n];else console.warn("Undefined shim for: "+t)}var t="<div class='refine-results'>    <div class='widget refine-options' data-binding='{@widget: CombineResultsOptionsWidget}{@widget-context: featureSetCollection}{@hidden: combineModeChosen}' data-menu-id='CombineResultsActions' data-menu-hoist-disabled='true'></div>    <div data-binding='{@visible: combineModeChosen}'>        <div class='panel-group no-item box-container' data-binding='{@hidden: selections}'>            <p data-binding='{@text: @language-saved-results-browse-no-items}'></p>            <p class='description' data-binding='{@text: @language-saved-results-browse-no-items-desc}'></p>        </div>        <div class='panel-group' data-binding='{@visible: selections}'>            <div class='list-refine-results-header' tabindex='0'>                <span data-binding='{@text: @language-saved-results-combine-list-explanation}'></span>            </div>            <ul class='list-menu' data-binding='{@source: resultsPage}'>                <li class='list-menu-item' data-binding='{@template-for: resultsPage}'>                    <label class='list-menu-label' data-binding='{@text: displayName}{for: id}'></label>                    <input class='list-menu-action' type='checkbox' data-binding='{id: id}{@value: isSelected}' />                </li>            </ul>            <div class='form-btns'>                <button class='button ok-button' data-binding='{@event-click: handleOkClick}{@text: @language-common-ok}'></button>                <button class='button cancel-button' data-binding='{@event-click: handleCancelClick}{@text: @language-common-cancel}'></button>            </div>        </div>        \x3c!-- BEGIN: Paging Controls --\x3e        <div data-binding='{@visible: selections}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}'></div>        \x3c!-- END: Paging Controls --\x3e    </div></div>",o="<div class='list-selections-view'>    <div class='panel-group no-item box-container' data-binding='{@hidden: selections}'>        <p data-binding='{@text: @language-saved-results-browse-no-items}'></p>        <p class='description' data-binding='{@text: @language-saved-results-browse-no-items-desc}'></p>    </div>    <div class='panel-group' data-binding='{@visible: selections}'>        <ul class='list-menu' data-binding='{@source: resultsPage}'>            <li class='list-menu-item' data-binding='{@template-for: resultsPage}'>                <button class='selection-contents' data-binding='{@disabled: disabled}{title: restoreTooltip}{@event-onclick: handleRestoreSelectionClick}'>                    <span class='list-menu-name' data-binding='{@text: displayName}'></span>                    <span class='list-menu-desc' data-binding='{@visible:disabled}{@text: @language-saved-results-item-already-open}'></span>                </button>                <button class='action-button edit-24 right' data-binding='{@event-onclick: handleRenameClick}{title: renameTooltip}'></button>                <button class='action-button trashcan-24 right' data-binding='{@event-onclick: handleDeleteClick}{title: deleteTooltip}'></button>            </li>        </ul>    </div>    \x3c!-- BEGIN: Paging Controls --\x3e    <div data-binding='{@visible: selections}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}'></div>    \x3c!-- END: Paging Controls --\x3e</div>",i="<div class='save-selection-view'>    <label for='selectionName' data-binding='{@text: @language-common-save-as}'></label>    <input type='text' id='selectionName' data-binding='{@value: name}{@event-keydown: handleKeyDown}' />    <div class='form-btns'>        <button class='button save-button' data-binding='{@event-click: handleSaveClick}{@text: @language-common-save}{@enabled: name}'></button>        <button class='button cancel-button' data-binding='{@event-click: handleCancelClick}{@text: @language-common-cancel}'></button>    </div></div>";require({cache:{"Mapping/modules/Selection/CombineResultsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/selection/CombineMode","geocortex/framework/utils/ArrayUtils"],function(t,o,i,n,a,r,s,l){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var c=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e),this._registerCommands()},o.prototype.deactivated=function(){this.viewModel.reset()},o.prototype._registerCommands=function(){this.app.command("ShowSearchOptions").register(this,this.show,this._canCombineResults),this.app.command("CombineResultsInteractive").register(this,this._executeCombineResultsInteractive)},o.prototype.resolveWidget=function(e,o,i){if("CombineResultsOptionsWidget"===e)return this.app.menuRegistry.createMenuWidget(this,o,i);if("PagingControlsWidget"===e){var a=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(a){var r=new n.PagingControlsViewModel(this.app,o);a.attach(r)}return a}return t.prototype.resolveWidget.call(this,e,o,i)},o.prototype.show=function(e){if(this.viewModel){var t;if("string"==typeof e)t=this.app.featureSetManager.getCollectionById(e);else if(e instanceof a.FeatureSet){var o=new r.FeatureSetCollection;o.featureSets.addItem(e),t=o}else t=e;t?(this.viewModel.featureSetCollection.set(t),this.app.viewManager.activateView(this)):this.app.trace.warning("Cannot save feature set collection: No feature set collection with matching ID found.")}},o.prototype.handleOkClick=function(e,t,o){var i=this,n=this.viewModel.featureSetCollection.get().displayName.get();0===n.length&&this.viewModel.featureSetCollection.get().featureSets&&(n=this.viewModel.featureSetCollection.get().featureSets.getAt(0).displayName.get());var a={nameOfCurrentResults:n,currentResults:this.viewModel.featureSetCollection.get(),collectionNames:this.viewModel.getSelectedItems().map(function(e){return e.name}),combineResponse:void 0};Promise.resolve(a).then(function(e){return i.app.viewManager.deactivateView(i),e}).then(function(e){return i._combineResults(e)}).then(function(e){return i._displayNotification(e)}).catch(function(e){return i._processError(e)})},o.prototype.handleCancelClick=function(e,t,o){this.app.viewManager.deactivateView(this)},o.prototype._executeCombineResultsInteractive=function(e){var t=this;if(this.viewModel){var o,i=s.CombineMode.REPLACE;Promise.try(function(){var n=e?e.mode:null,a=e?e.currentResults:null;o="string"==typeof a?t.app.featureSetManager.getCollectionById(a):a,t.viewModel.combineModeChosen.set(!0),t.viewModel.combineMode=n||i,o&&t.viewModel.featureSetCollection.get()&&o.id!==t.viewModel.featureSetCollection.get().id&&t.viewModel.featureSetCollection.set(o)}).then(function(){return t.viewModel.populateFromMetadata()}).catch(function(e){return t._processError(e)})}},o.prototype._combineResults=function(e){var t=this;return new Promise(function(o,i){var n={combineMode:t.viewModel.combineMode,featureSetCollectionIds:t.viewModel.getSelectedItems().map(function(e){return e.featureSetCollectionId}),currentResults:e.currentResults,successCallback:function(t){e.combineResponse=t,o(e)},errorCallback:i};t.app.command("CombineResults").execute(n)})},o.prototype._displayNotification=function(e){var t,o=e.combineResponse,i=e.collectionNames.map(function(e){return"'"+e+"'"}).join(", "),n=e.nameOfCurrentResults;switch(o.combineMode){case s.CombineMode.UNION:t=this.getResource("language-common-results-union-confirmation");break;case s.CombineMode.INTERSECT:t=this.getResource("language-common-results-intersect-confirmation");break;case s.CombineMode.SUBTRACT:t=this.getResource("language-common-results-subtract-confirmation")}return t&&(t=t.format(n,i),this.app.command("AddResultsStatus").execute(t)),e},o.prototype._processError=function(e){var t=e&&"UiError"==e.name?e.message:this.getResource("language-saved-results-error-message");return this.app.command("AddResultsStatus").execute(t),this.app.trace.error(e.message,e),e},o.prototype._canCombineResults=function(e){return"string"!=typeof e?e instanceof r.FeatureSetCollection?0!==e.featureSets.getLength()&&!!l.firstOrDefault(e.featureSets.getItems(),function(e){return e.features.getLength()>0}):e.features.getLength()>0:!!(e=this.app.featureSetManager.getCollectionById(e))&&void 0},o}(i.ViewBase);o.CombineResultsView=c})},"Mapping/modules/Selection/CombineResultsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./SelectableSelectionItem","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/selection/CombineMode"],function(t,o,i,n,a,r,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var l=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i.featureSetCollection=new n.Observable,i.combineModeChosen=new n.Observable(!1),i.isPaged=!0,i.pageSize=10,i.combineMode=s.CombineMode.REPLACE,i.selections=new n.ObservableCollection,i.presentableResults=new r.PresentableCollection(i.selections),i.resultsPage=i.presentableResults.items,i.presentableResults.items.useThrottling=!0,i}return e(o,t),o.prototype.initialize=function(e){t.prototype.initialize.call(this,e),(e=e||{}).hasOwnProperty("isPaged")&&(this.isPaged=e.isPaged),e.hasOwnProperty("pageSize")&&(this.pageSize=e.pageSize),this.presentableResults.isPaginated.set(this.isPaged),this.presentableResults.pageSize.set(this.pageSize)},o.prototype.reset=function(){this.combineModeChosen.set(!1)},o.prototype.getSelectedItems=function(){return(this.selections?this.selections.getItems():[]).filter(function(e){return e&&e.isSelected.get()})},o.prototype.populateFromMetadata=function(){var e=this;return this._fetchMetadata().then(function(e){return e.map(function(e){return new a.SelectableSelectionItem(e)})}).then(function(t){return e._excludeCurrentResultsFromList(t)}).then(function(t){return e._populatePresentableCollection(t)}).then(function(t){return e.presentableResults.currPageNumber.set(1)})},o.prototype._fetchMetadata=function(){var e=this;return new Promise(function(t,o){e.app.command("FindAllSelectionMetadata").execute({successCallback:t,errorCallback:o})})},o.prototype._excludeCurrentResultsFromList=function(e){var t=this.featureSetCollection.get();return e&&t&&"Selection"===t.sourceName?e.filter(function(e){return e.name!==t.getExtendedPropertyByName("SelectionName")}):e},o.prototype._populatePresentableCollection=function(e){return this.selections.set(e),e},o}(i.ViewModelBase);o.CombineResultsViewModel=l})},"Mapping/modules/Selection/ListSelectionsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","./SelectionItem","geocortex/framework/utils/ArrayUtils"],function(t,o,i,n,a,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e),this._registerCommands()},o.prototype.resolveWidget=function(e,o,i){if("PagingControlsWidget"===e){var a=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(a){var r=new n.PagingControlsViewModel(this.app,o);a.attach(r)}return a}return t.prototype.resolveWidget.call(this,e,o,i)},o.prototype._registerCommands=function(){this.app.command("ListSelections").register(this,this.show)},o.prototype.show=function(){var e=this;this.viewModel&&this.viewModel.findAllMetadata().then(function(t){return e._processMetadata(t)}).then(function(t){return e._disableCurrentlyOpenedCollection(t)}).then(function(t){e.viewModel.selections.set(t),e.viewModel.selections.pulse(),0===e.viewModel.selections.getLength()&&e.app.command("ScreenReaderNarrate").execute(e.getResource("language-saved-results-browse-no-items")),e.app.viewManager.activateView(e)})},o.prototype.handleRestoreSelectionClick=function(e,t,o){var i=o?o.name:null;if(!i)throw new Error("Cannot restore named selection into the results view: selection name is required.");this.app.viewManager.deactivateView(this),this.app.command("RestoreSelection").execute({name:i})},o.prototype.handleRenameClick=function(e,t,o){var i=this;this.promptForSelectionName(o).then(function(e){return i._processName(e,o)}).then(function(e){return i.viewModel.renameSelection(o,e)}).catch(function(e){return i._processError(e)})},o.prototype.handleDeleteClick=function(e,t,o){var i=this;this.confirmDelete(o).then(function(e){e&&i.viewModel.deleteSelection(o)})},o.prototype.confirmDelete=function(e){var t=this,o=this.getResource("language-saved-results-delete-prompt").format(e.name),i=this.getResource("language-saved-results-delete-prompt-title").format(e.name);return new Promise(function(e,n){return t.app.command("Confirm").execute(o,i,e)})},o.prototype.promptForSelectionName=function(e){var t=this,o=this.getResource("language-saved-results-rename-prompt-title"),i=this.getResource("language-saved-results-rename-prompt"),n=e.name;return new Promise(function(e,a){return t.app.command("Prompt").execute(o,i,n,e)})},o.prototype._processMetadata=function(e){var t=this;return e.map(function(e){var o=new a.SelectionItem(e);return t.viewModel.setTooltips(o)})},o.prototype._disableCurrentlyOpenedCollection=function(e){var t=this.viewModel.featureSetCollection.get(),o=t&&"Selection"===t.sourceName?t.displayName.get():null,i=e&&o?r.firstOrDefault(e,function(e){return e.name===o}):null;return i&&i.disabled.set(!0),e},o.prototype._processName=function(e,t){var o=this.viewModel.selections.get();if(!e)throw(i=new Error(this.getResource("language-saved-results-no-name-error").format(t.name))).name="UiError",i;if(e===t.name)return t.name;if(o.some(function(t){return t.name===e})){var i=new Error(this.getResource("language-saved-results-rename-prompt-error").format(e));throw i.name="UiError",i}return e},o.prototype._processError=function(e){var t=e&&"UiError"==e.name?e.message:this.getResource("language-saved-results-error-message");return this.app.command("AddResultsStatus").execute(t),this.app.trace.error(t,e),e},o}(i.ViewBase);o.ListSelectionsView=s})},"Mapping/modules/Selection/ListSelectionsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection"],function(t,o,i,n,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i.featureSetCollection=new n.Observable,i.isPaged=!0,i.pageSize=10,i.selections=new n.ObservableCollection,i.presentableResults=new a.PresentableCollection(i.selections),i.resultsPage=i.presentableResults.items,i.presentableResults.items.useThrottling=!0,i}return e(o,t),o.prototype.initialize=function(e){var o=this;t.prototype.initialize.call(this,e),(e=e||{}).hasOwnProperty("isPaged")&&(this.isPaged=e.isPaged),e.hasOwnProperty("pageSize")&&(this.pageSize=e.pageSize),this.presentableResults.isPaginated.set(this.isPaged),this.presentableResults.pageSize.set(this.pageSize),this.app.command("ShowResultsList").register(this,this._trackDisplayedResults),this.app.command("ShowResultsTable").register(this,this._trackDisplayedResults,function(){return!o.app.configuration.mobileMode})},o.prototype.findAllMetadata=function(){var e=this;return new Promise(function(t,o){e.app.command("FindAllSelectionMetadata").execute({successCallback:t,errorCallback:o})})},o.prototype.deleteSelection=function(e){var t=this;return new Promise(function(o,i){var n={name:e.name,successCallback:function(){t.selections.removeItem(e),o()},errorCallback:i};t.app.command("DeleteSelection").execute(n)})},o.prototype.renameSelection=function(e,t){var o=this;return new Promise(function(i,n){var a={name:e.name,newName:t,successCallback:function(){e.name=t,o.setTooltips(e),o.resultsPage.pulse(),i()},errorCallback:n};o.app.command("RenameSelection").execute(a)})},o.prototype.setTooltips=function(e){var t=this.getResource("language-saved-results-item-restore-description").format(e.name),o=this.getResource("language-saved-results-item-rename-description").format(e.name),i=this.getResource("language-saved-results-item-delete-description").format(e.name);return e.restoreTooltip=t,e.renameTooltip=o,e.deleteTooltip=i,e},o.prototype._trackDisplayedResults=function(e){var t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e;t&&t!==this.featureSetCollection.get()&&this.featureSetCollection.set(t)},o}(i.ViewModelBase);o.ListSelectionsViewModel=r})},"Mapping/modules/Selection/SaveSelectionView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/Dictionary","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection"],function(t,o,i,n,a,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._metadataCache=new n.Dictionary,e}return e(o,t),o.prototype.attach=function(e){t.prototype.attach.call(this,e),this._registerCommands()},o.prototype._registerCommands=function(){this.app.command("ShowSaveSelectionDialog").register(this,this.show,this._canShow),this.app.event("SelectionCreatedEvent").subscribe(this,this._handleSelectionCreated),this.app.event("SelectionChangedEvent").subscribe(this,this._handleSelectionChanged),this.app.event("SelectionRemovedEvent").subscribe(this,this._handleSelectionRemoved)},o.prototype.handleKeyDown=function(e,t,o){return(e.which?e.which:e.keyCode)===dojo.keys.ENTER&&(this.save(),e.preventDefault()),!0},o.prototype.handleCancelClick=function(e,t,o){this.app.viewManager.deactivateView(this)},o.prototype.handleSaveClick=function(e,t,o){this.save()},o.prototype.save=function(){var e=this,t=this.viewModel.name.get();this.viewModel.saveSelection(t).then(function(t){return e._processResults(t)}).catch(function(t){return e._processError(t)})},o.prototype.show=function(e,t){var o;if("string"==typeof e)o=this.app.featureSetManager.getCollectionById(e);else if(e instanceof a.FeatureSet){var i=new r.FeatureSetCollection;i.featureSets.addItem(e),o=i}else o=e;if(o){var n=t;n||(n="Selection"===o.sourceName?o.getExtendedPropertyByName("SelectionName"):""),this.viewModel.featureSetCollection.set(o),this.viewModel.name.set(n),this.app.viewManager.activateView(this)}else this.app.trace.warning("Cannot save feature set collection: No feature set collection with matching ID found.")},o.prototype._canShow=function(e,t){var o;if("string"==typeof e)o=this.app.featureSetManager.getCollectionById(e);else if(e instanceof a.FeatureSet){var i=new r.FeatureSetCollection;i.featureSets.addItem(e),o=i}else o=e;return!(!o||0==o.featureSets.length())&&("Selection"!==o.sourceName||o.isModified.get())},o.prototype._processResults=function(e){return e&&(this.viewModel.showConfirmationMessage(),this.app.viewManager.deactivateView(this)),e},o.prototype._processError=function(e){var t=e&&"UiError"==e.name?e.message:this.getResource("language-saved-results-error-message");return this.app.command("AddResultsStatus").execute(t),this.app.trace.error(t,e),e},o.prototype._handleSelectionCreated=function(e){var t=e?e.name:null,o=e&&e.featureSetCollection?e.featureSetCollection.id:null;this._computeCanExecute(t,o)},o.prototype._handleSelectionChanged=function(e){var t=e?e.name:null,o=e&&e.featureSetCollection?e.featureSetCollection.id:null;this._computeCanExecute(t,o)},o.prototype._handleSelectionRemoved=function(e){var t=e?e.name:null,o=e&&e.featureSetCollection?e.featureSetCollection.id:null;this._computeCanExecute(t,o)},o.prototype._computeCanExecute=function(e,t){var o=this;t&&this.viewModel.findMetadata(e,t).then(function(e){return e?o._metadataCache.set(t,e):o._metadataCache.remove(t)}).catch(function(e){return o._metadataCache.remove(t)}).lastly(function(){return o.app.command("ShowSaveSelectionDialog").raiseCanExecuteChanged()})},o}(i.ViewBase);o.SaveSelectionView=s})},"Mapping/modules/Selection/SaveSelectionViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(t,o,i,n,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=new n.Observable,e.featureSetCollection=new n.Observable,e._existingSelection=!1,e}return e(o,t),o.prototype.saveSelection=function(e){var t=this;return Promise.try(function(){return t._assertNameNotNull(e),t.selectionExists(e).then(function(o){return t._existingSelection=o,t._existingSelection?t.confirmOverwrite(e):Promise.resolve(!0)}).then(function(o){return t._existingSelection&&o?t.updateSelection(e).thenReturn(!0):t._existingSelection?Promise.resolve(!1):t.createSelection(e).thenReturn(!0)})})},o.prototype.findMetadata=function(e,t){var o=this;return new Promise(function(i,n){var a={successCallback:i,errorCallback:n};if(!e&&!t)throw new Error("The selection name or feature set collection ID must be set.");e&&(a.name=e),t&&(a.featureSetCollectionId=t),o.app.command("FindMetadataForSelection").execute(a)})},o.prototype.selectionExists=function(e){var t=this;return Promise.try(function(){return t._assertNameNotNull(e),t.findMetadata(e).then(function(e){return!a.isNullOrUndefined(e)})})},o.prototype.createSelection=function(e){var t=this;return new Promise(function(o,i){t._assertNameNotNull(e),t.app.command("CreateSelection").execute({name:e,featureSetCollection:t.featureSetCollection.get(),successCallback:o,errorCallback:i})})},o.prototype.updateSelection=function(e){var t=this;return new Promise(function(o,i){t._assertNameNotNull(e),t.app.command("UpdateSelection").execute({name:e,featureSetCollection:t.featureSetCollection.get(),successCallback:o,errorCallback:i})})},o.prototype.confirmOverwrite=function(e){var t=this,o=this.app.getResource(this.libraryId,"language-saved-results-overwrite-prompt").format(e),i=this.app.getResource(this.libraryId,"language-saved-results-overwrite-prompt-title").format(e);return new Promise(function(e,n){return t.app.command("Confirm").execute(o,i,e)})},o.prototype.showConfirmationMessage=function(){var e=this.name.get(),t=this.featureSetCollection.get().countFeatures(),o=this._existingSelection?"language-saved-results-update-confirmation":"language-saved-results-create-confirmation",i=this.getResource(o).format(e,t);this.app.command("AddResultsStatus").execute(i)},o.prototype._assertNameNotNull=function(e){if(a.isNullOrUndefined(e))throw new Error("The selection name must be set.")},o}(i.ViewModelBase);o.SaveSelectionViewModel=r})},"Mapping/modules/Selection/SelectableSelectionItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./SelectionItem","geocortex/framework/observables"],function(t,o,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(e){var o=t.call(this,e)||this;return o.isSelected=new n.Observable(!1),o}return e(o,t),o}(i.SelectionItem);o.SelectableSelectionItem=a})},"Mapping/modules/Selection/SelectionItem":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/FormatUtils","geocortex/framework-ui/LazyObservable"],function(e,t,o,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){var t=this;this.disabled=new o.Observable(!1),this.id=e.id,this.featureSetCollectionId=e.featureSetCollectionId,this.name=e.name||"",this.count=e.count||0,this.modified=e.modified||!1,this.timeCreated=e.timeCreated,this.timeModified=e.timeModified,this.timeExpiration=e.timeExpiration,this.dateCreated=i.parseUtcDate(this.timeCreated),this.dateModified=i.parseUtcDate(this.timeModified),this.dateExpiration=i.parseUtcDate(this.timeExpiration),this.displayName=new n.LazyObservable(null,function(){return t.formatDisplayName()})}return e.prototype.formatDisplayName=function(){var e=this.name||"",t=this.count||0;return e?"{0} ({1})".format(e,t):""},e.prototype.toMetaData=function(){return{id:this.id,featureSetCollectionId:this.featureSetCollectionId,name:this.name,count:this.count,modified:this.modified,timeCreated:this.timeCreated,timeModified:this.timeModified,timeExpiration:this.timeExpiration}},e}();t.SelectionItem=a})},"Mapping/modules/Selection/SelectionModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/selection/SelectionMetadataStore","geocortex/framework/observables","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/validation/NumberValidator","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/eventArgs/FeatureSetManagerEventArgs","geocortex/infrastructure/FeatureSet","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/selection/CombineMode","geocortex/infrastructure/results/ResultsUtils"],function(t,o,i,n,a,r,s,l,c,u,d,p,m){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var g=function(t){function o(e,o){var i=t.call(this,e,o)||this;return i._fscSourceName="Selection",i._extPropName="SelectionName",i._resultsListStatusRegion="DataFrameResultsStatusRegion",i._resultsTableStatusRegion="ResultsStatusRegion",i._statusView=null,i._featureSetCollection=new a.Observable,i._adhocFeatureSetCollection=new r.FeatureSetCollection,i._metadataStore=new n.SelectionMetadataStore(e),i}return e(o,t),o.prototype.initialize=function(e){t.prototype.initialize.call(this,e),(e=e||{}).hasOwnProperty("resultsListStatusRegion")&&(this._resultsListStatusRegion=e.resultsListStatusRegion),e.hasOwnProperty("resultsTableStatusRegion")&&(this._resultsTableStatusRegion=e.resultsTableStatusRegion),this.app.menuRegistry.loadMenus(e),this._statusRegionName=this._resultsListStatusRegion,this._adhocFeatureSetCollection.displayName.set(this.getResource("language-selection-default-selection-name")),this._adhocFeatureSetCollection.sourceName="Selection",this._adhocFeatureSetCollection.id=m.DEFAULT_COLLECTION_ID,this.app.featureSetManager.addCollection(this._adhocFeatureSetCollection),this._featureSetCollection.set(this._adhocFeatureSetCollection),this._registerCommands(),this._subscribeEvents()},o.prototype.getStateFilter=function(){var e=new s.NumberValidator;return{results:this.app.project.filter.featureSetCollection,selections:{item:{id:!0,name:!0,featureSetCollectionId:!0,count:e,modified:!0,timeCreated:e,timeModified:e,timeExpiration:e}}}},o.prototype.exportState=function(){var e=this;return Promise.try(function(){return{results:e.app.project.convert.fromGcxFeatureSetCollection(e._featureSetCollection.get()),selections:e._metadataStore.findAll()}})},o.prototype.applyState=function(e){var t=this;return Promise.try(function(){return t._metadataStore.clear(),t.app.project.convert.toGcxFeatureSetCollection(e.results).then(function(o){t._featureSetCollection.set(o),(e.selections||[]).forEach(function(e){t._metadataStore.add(e)}),t._notifyCanExecuteChanged()})})},o.prototype._registerCommands=function(){var e=this;this.app.command("FindAllSelectionMetadata").register(this,this._executeFindAllSelectionMetadata),this.app.command("FindMetadataForSelection").register(this,this._executeFindMetadataForSelection),this.app.command("FindSelection").register(this,this._executeFindSelection,this._canFindSelection),this.app.command("CreateSelection").register(this,this._executeCreateSelection,this._canCreateSelection),this.app.command("UpdateSelection").register(this,this._executeUpdateSelection,this._canUpdateSelection),this.app.command("RestoreSelection").register(this,this._executeRestoreSelection,this._canRestoreSelection),this.app.command("DeleteSelection").register(this,this._executeDeleteSelection,this._canDeleteSelection),this.app.command("RenameSelection").register(this,this._executeRenameSelection,this._canRenameSelection),this.app.command("AddFeatureToResults").register(this,this._executeAddFeatureToResults,this._canAddFeatureToResults),this.app.command("RemoveFeatureFromResults").register(this,this._executeRemoveFeatureFromResults,this._canRemoveFeatureFromResults),this.app.command("AddFeatureToResultsAtIndex").register(this,this._executeAddFeatureToResultsAtIndex,this._canExecuteAddFeatureToResultsAtIndex),this.app.command("_AddFeatureToResultsWhenOriginalFeatureExists").register(this,this._executeAddFeatureToResultsWhenOriginalFeatureExists,this._canAddFeatureToResults),this.app.command("CombineResults").register(this,this._executeCombineResults,this._canCombineResults),this.app.command("ResultsReplace").register(this,this._executeReplaceResults,this._canReplaceResults),this.app.command("ResultsUnion").register(this,this._executeUnionResults,this._canUnionResults),this.app.command("ResultsSubtract").register(this,this._executeSubtractResults,this._canSubtractResults),this.app.command("ResultsIntersect").register(this,this._executeIntersectResults,this._canIntersectResults),this.app.command("AddResultsStatus").register(this,this.addStatus),this.app.command("RemoveResultsStatus").register(this,this.removeStatus),this.app.command("ShowResultsList").register(this,function(t){e._showResultsViewImpl(e._resultsListStatusRegion,t)}),this.app.command("ShowResultsTable").register(this,function(t){e._showResultsViewImpl(e._resultsTableStatusRegion,t)},function(){return!e.app.configuration.mobileMode})},o.prototype._subscribeEvents=function(){this.app.event("ResultsViewCollapsedEvent").subscribe(this,this._handleResultsViewCollapsed),this.app.event("FSMCollectionRemovedEvent").subscribe(this,this._handleFsmCollectionRemovedEvent),this.app.event("FSMCollectionChangedEvent").subscribe(this,this._handleFsmCollectionChangedEvent),this.app.event("FeatureDeletedEvent").subscribe(this,this._updateMetadataForSavedSelections),this.app.event("GraphicRemovedEvent").subscribe(this,this._updateMetadataForSavedSelections),this.app.command("_updateMetadataForSavedSelections").register(this,this._updateMetadataForSavedSelections)},o.prototype.addStatus=function(e){var t;"string"==typeof e?(t=new l.AddStatusArgs(e)).timeoutMS=0:t=e,t.regionName=t.regionName||this._statusRegionName,t.id=t.id||"ResultsStatusMessageView",this.app.command("RemoveResultsStatus").execute(),this.app.command("AddStatus").execute(t)},o.prototype.removeStatus=function(){this.app.command("RemoveStatus").execute("ResultsStatusMessageView")},o.prototype._showResultsViewImpl=function(e,t){this._setStatusRegion(e);var o=null;"string"==typeof t?o=this.app.featureSetManager.getCollectionById(t):t instanceof r.FeatureSetCollection&&(o=t),o&&o!==this._featureSetCollection.get()&&this._featureSetCollection.set(o),this._notifyCanExecuteChanged()},o.prototype._handleFsmCollectionChangedEvent=function(e){this._featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this._featureSetCollection.get().id&&this._featureSetCollection.get().sourceName===this._fscSourceName&&(this._featureSetCollection.get().isModified.set(!0),this.app.command("ShowSaveSelectionDialog").raiseCanExecuteChanged())},o.prototype._handleFsmCollectionRemovedEvent=function(e){this._featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this._featureSetCollection.get().id&&(this._featureSetCollection.set(null),this.app.command("ShowSaveSelectionDialog").raiseCanExecuteChanged())},o.prototype._updateMetadataForSavedSelections=function(e){var t=this,o=null;e instanceof r.FeatureSetCollection&&(o=e),(this._metadataStore.findAll()||[]).forEach(function(e){var i=t.app.featureSetManager.getCollectionById(e.featureSetCollectionId);if(!o||o&&i===o){var n=(new Date).getTime();e.count=i.countFeatures(),e.timeModified=n,t._metadataStore.updateById(e.id,e)}})},o.prototype._setStatusRegion=function(e){this._statusRegionName=e||this._resultsListStatusRegion},o.prototype._handleResultsViewCollapsed=function(e){e&&this._statusView&&this.app.command("RemoveResultsStatus").execute()},o.prototype._copyFeatureSets=function(e,t,o){if(void 0===o&&(o=!1),e&&t&&e!=t){o&&t.clear();for(var i=0;i<e.featureSets.length();i++){var n=e.featureSets.getAt(i);if(n){var a=n.clone();t.featureSets.addItem(a)}}}},o.prototype._copyExtendedProperties=function(e,t,o){void 0===o&&(o=!1),e&&t&&e!==t&&(o&&t.extendedProperties.clear(),e.extendedProperties.getItems().forEach(function(e){return t.setExtendedProperty(e.name,e.value)}))},o.prototype._copy=function(e){var t=new r.FeatureSetCollection;return t.sourceName=e.sourceName,t.displayName.set(e.displayName.get()),t.isModified.set(e.isModified.get()),t.tag=e.tag,this._copyExtendedProperties(e,t,!0),this._copyFeatureSets(e,t,!0),this.app.featureSetManager.addCollection(t),t},o.prototype._create=function(e,t){var o=new r.FeatureSetCollection;return o.sourceName=this._fscSourceName,o.tag=t.tag,o.displayName.set(e),this._copyFeatureSets(t,o,!0),this._copyExtendedProperties(t,o,!0),o.setExtendedProperty(this._extPropName,e),this.app.featureSetManager.addCollection(o),this._createMetadata(e,o),o},o.prototype._createMetadata=function(e,t){if(!t)throw new Error("Cannot create metadata for selection: A feature set collection is required.");if(!e)throw new Error("Cannot create metadata for selection: The selection name is required.");var o=(new Date).getTime(),i={id:null,name:e,featureSetCollectionId:t.id,count:t.countFeatures(),modified:!1,timeCreated:o,timeModified:o};return this._metadataStore.add(i)},o.prototype._update=function(e,t,o){t.tag=o.tag,this._copyFeatureSets(o,t,!0),this._copyExtendedProperties(o,t,!0),t.setExtendedProperty(this._extPropName,e.name),t.isModified.set(!1),o.isModified.set(!1);var i=(new Date).getTime();e.timeModified=i,e.count=t.countFeatures(),e.modified=!1,this._metadataStore.updateById(e.id,e)},o.prototype._restore=function(e){if(!e)throw new Error("Collection is required");this.app.featureSetManager.getCollectionIds().indexOf(e.id)>-1||this.app.featureSetManager.addCollection(e),this._restoreById(e.id)},o.prototype._restoreById=function(e){this.app.featureSetManager.tryCloseCollection(e),this.app.featureSetManager.openCollection(e),this.app.featureSetManager.closeCollection(e)},o.prototype._delete=function(e,t){this.app.featureSetManager.tryCloseCollection(t.id),this.app.featureSetManager.removeCollectionById(t.id),this._metadataStore.removeById(e.id)},o.prototype._rename=function(e,t,o){var i=(new Date).getTime();t.timeModified=i,t.name=e,this._metadataStore.updateById(t.id,t),o.displayName.set(e),o.setExtendedProperty(this._extPropName,e)},o.prototype._existsInCollection=function(e,t){if(!e||!e.featureSet&&!e.layer)return!1;if(!t)throw new Error("FeatureSetCollection is required");for(var o=0;o<t.featureSets.getLength();o++){var i=t.featureSets.getAt(o),n=i.layer;if(e.featureSet&&e.featureSet.id===i.id)return i.containsFeature(e);if(e.layer){var a=e.layer===n||e.layer&&n&&e.layer.id===n.id,r=e.layer===n||e.layer&&n&&e.layer.mapService===n.mapService||e.layer&&n&&e.layer.mapService&&n.mapService&&e.layer.mapService.id===n.mapService.id;if(a&&r)return i.containsFeature(e)}}return!1},o.prototype._tryAddToCollection=function(e,t,o){if(!t||!e)return!1;if(this._existsInCollection(e,t))return!1;var i=null,n=e.featureSet?e.featureSet.id:null,a=e.layer;if(n&&(i=t.getFeatureSetById(n)),!i&&a&&(i=t.getFeatureSetByLayer(a)),!i&&!e.layer&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().getLayer()&&(i=t.getFeatureSetbyEsriLayer(e.esriFeature.get().getLayer())),i)i.addFeatureAt(e,!1,o);else{if(e.featureSet)i=e.featureSet.cloneStructure();else{var r;!e.layer&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().getLayer()&&e.esriFeature.get().getLayer().id&&(r=e.esriFeature.get().getLayer().id),i=new u.FeatureSet({app:this.app,layer:e.layer,esriFeatureSet:new esri.tasks.FeatureSet,id:r})}i.addFeatureAt(e,!1,o),t.featureSets.addItem(i)}return!0},o.prototype._tryRemoveFromCollection=function(e,t){if(!t||!e)return!1;var o=null,i=e.featureSet?e.featureSet.id:null,n=e.layer,a=!1;if(i&&(o=t.getFeatureSetById(i)),!o&&n&&(o=t.getFeatureSetByLayer(n)),!o&&!e.layer&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().getLayer()&&(o=t.getFeatureSetbyEsriLayer(e.esriFeature.get().getLayer())),o)if(1===o.features.length()&&(e.getExtendedPropertyByName("isShownInMaptip")||e.getExtendedPropertyByName("isShownInFeaturedetails"))){for(var r=0;r<t.featureSets.length();r++)if(t.featureSets.getAt(r)===o){var s=o.clone();a=o.removeFeature(e),e.featureSet=s,t.featureSets.removeItem(o)}}else a=o.removeFeature(e),0===o.features.getLength()&&(t.featureSets.removeItem(o),a=!0);return a},o.prototype._notifyCanExecuteChanged=function(){this.app.command("AddFeatureToResults").raiseCanExecuteChanged(),this.app.command("RemoveFeatureFromResults").raiseCanExecuteChanged(),this.app.command("CombineResults").raiseCanExecuteChanged(),this.app.command("ResultsReplace").raiseCanExecuteChanged(),this.app.command("ResultsUnion").raiseCanExecuteChanged(),this.app.command("ResultsSubtract").raiseCanExecuteChanged(),this.app.command("ResultsIntersect").raiseCanExecuteChanged()},o.prototype._notifyFeatureSetCollectionChanged=function(){var e=new c.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollection.get(),featureSetCollectionId:this._featureSetCollection.get().id});this.app.event("FSMCollectionChangedEvent").publish(e)},o.prototype._executeAddFeatureToResultsAtIndex=function(e){this._executeAddFeatureToResults(e.feature,e.featureSetIndex)},o.prototype._canExecuteAddFeatureToResultsAtIndex=function(e){return"number"==typeof e.featureSetIndex&&this._canAddFeatureToResults(e.feature)},o.prototype._executeAddFeatureToResultsWhenOriginalFeatureExists=function(e){this._executeAddFeatureToResults(e.feature,e.featureSetIndex,e.originalFeature)},o.prototype._executeAddFeatureToResults=function(e,t,o){0===this._featureSetCollection.get().featureSets.getLength()&&(this._adhocFeatureSetCollection.featureSets.getLength()>0&&this._adhocFeatureSetCollection.clear(),this._featureSetCollection.set(this._adhocFeatureSetCollection));var i=this._featureSetCollection.get();if(o){var n=!1;if(i&&i.featureSets&&i.featureSets.get()&&i.featureSets.get().length>0)for(var a=0;a<i.featureSets.get().length&&!n;a++){var r=i.featureSets.getAt(a);if(r&&r.features&&r.features.get()&&r.features.get().length>0)for(var s=0;s<r.features.get().length&&!n;s++)o.structurallyEquals(r.features.getAt(s))&&(n=!0)}if(!n)return}if(this._tryAddToCollection(e,i,t)){this._notifyCanExecuteChanged(),this.app.event("_featureAddedToResults").publish(e),this._notifyFeatureSetCollectionChanged();var l=this._featureSetCollection.get()?this._featureSetCollection.get().displayName.get():this.getResource("language-selection-default-selection-name"),c=this.getResource("language-common-results-added-confirmation").format(1,l);this.app.command("AddResultsStatus").execute(c)}},o.prototype._executeRemoveFeatureFromResults=function(e){var t=this._featureSetCollection.get()?this._featureSetCollection.get().displayName.get():"";if(this._tryRemoveFromCollection(e,this._featureSetCollection.get())&&(this._notifyCanExecuteChanged(),this.app.event("_featureRemovedFromResults").publish(e),this._notifyFeatureSetCollectionChanged(),!this.app.configuration.mobileMode||this._featureSetCollection.get().firstFeature())){var o=this.getResource("language-common-results-removed-confirmation").format(1,t);this.app.command("AddResultsStatus").execute(o)}},o.prototype._executeFindAllSelectionMetadata=function(e){var t=(e=e||{}).successCallback||this._noop;e.errorCallback||this._noop;t(this._metadataStore.findAll())},o.prototype._executeFindMetadataForSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.name,n=e.featureSetCollectionId;if(i||n){var a={};i&&(a.name=i),n&&(a.featureSetCollectionIds=[n]);var r=this._metadataStore.find(a);t(d.firstOrDefault(r))}else o(new Error("Cannot fetch selection metadata: A selection name or feature set collection ID is required."))},o.prototype._executeFindSelection=function(e){var t=null,o=(e=e||{}).successCallback||this._noop,i=(e.errorCallback||this._noop,e.name),n=i?this._metadataStore.findByName(i):null,a=n?this.app.featureSetManager.getCollectionById(n.featureSetCollectionId):null;a&&(t=this._copy(a)),o(t)},o.prototype._executeCreateSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.featureSetCollection,n=e.name;if(n){var a="string"==typeof i?this.app.featureSetManager.getCollectionById(i):i,r=this._copy(this._create(n,a));this._restore(r),t(),this.app.event("SelectionCreatedEvent").publish({name:n,featureSetCollection:r}),this._notifyCanExecuteChanged()}else o(new Error("Cannot create named selection: The selection name is required."))},o.prototype._executeUpdateSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.featureSetCollection,n=e.name;if(n){var a=this._metadataStore.findByName(n);if(a&&a.id){var r="string"==typeof i?this.app.featureSetManager.getCollectionById(i):i,s=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId);if(s){this._update(a,s,r);var l=this._copy(s);this._restore(l),t(),this.app.event("SelectionChangedEvent").publish({name:n,previousName:n,featureSetCollection:l}),this._notifyCanExecuteChanged()}else o(new Error("Cannot update named selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId)))}else o(new Error("Cannot update named selection: '{0}' not found.".format(n)))}else o(new Error("Cannot update named selection: The selection name is required."))},o.prototype._executeRestoreSelection=function(e){var t,o=(e=e||{}).successCallback||this._noop,i=e.errorCallback||this._noop,n=e.name;if(n){var a=this._metadataStore.findByName(n);if(a)if(t=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId)){var r=this._copy(t);this._restore(r),o(),this._notifyCanExecuteChanged()}else i(new Error("Cannot restore named selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId)));else i(new Error("Cannot restore named selection: '{0}' not found.".format(n)))}else i(new Error("Cannot restore named selection: The selection name is required."))},o.prototype._executeDeleteSelection=function(e){var t,o=(e=e||{}).successCallback||this._noop,i=e.errorCallback||this._noop,n=e.name;if(n){var a=this._metadataStore.findByName(n);a?(t=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId))?(this._delete(a,t),o(),this.app.event("SelectionRemovedEvent").publish({name:n,featureSetCollection:t})):i(new Error("Cannot delete named selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId))):i(new Error("Cannot delete named selection: '{0}' not found.".format(n)))}else i(new Error("Cannot delete named selection: The selection name is required."))},o.prototype._executeRenameSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.name,n=e.newName;if(i&&n){var a=this._metadataStore.findByName(i);if(a&&a.id){var r=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId);if(r){this._rename(n,a,r);var s=this._copy(r),l=this._featureSetCollection.get();if(l&&l.sourceName===this._fscSourceName){var c=l.getExtendedPropertyByName(this._extPropName);c&&c===i&&(l.displayName.set(n),l.setExtendedProperty(this._extPropName,n))}t(),this.app.event("SelectionChangedEvent").publish({name:n,previousName:i,featureSetCollection:s}),this._notifyCanExecuteChanged()}else o(new Error("Cannot rename selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId)))}else o(new Error("Cannot rename selection: '{0}' not found.".format(i)))}else o(new Error("Cannot rename selection: The selection name is required."))},o.prototype._getCombineResultsCommandArgs=function(e,t){var o="string"==typeof e?e:e.id;return o?{combineMode:t||p.CombineMode.REPLACE,currentResults:this._featureSetCollection.get(),featureSetCollectionIds:[o]}:null},o.prototype._executeReplaceResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.REPLACE);this._executeCombineResults(t)},o.prototype._executeUnionResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.UNION);this._executeCombineResults(t)},o.prototype._executeSubtractResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.SUBTRACT);this._executeCombineResults(t)},o.prototype._executeIntersectResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.INTERSECT);this._executeCombineResults(t)},o.prototype._executeCombineResults=function(e){var t=this;if(e&&e.featureSetCollectionIds&&0!=e.featureSetCollectionIds.length){var o,i=e.currentResults;if((o="string"==typeof i?this.app.featureSetManager.getCollectionById(i):i)||(o=this._featureSetCollection.get()),o){var n=e.featureSetCollectionIds.map(function(e){return t.app.featureSetManager.getCollectionById(e)}).filter(function(e){return null!=e}).map(function(e){return e.clone(!0)}),a=e.combineMode||p.CombineMode.REPLACE,r=e.successCallback,s=(e.errorCallback,!1);switch(a){case p.CombineMode.REPLACE:var l=n&&n.length>0?n[0]:null;l&&(o.clear(),o.featureSets.addItems(l.featureSets.getItems()));break;case p.CombineMode.UNION:s=o.unionManyInPlace(n);break;case p.CombineMode.SUBTRACT:s=o.subtractManyInPlace(n);break;case p.CombineMode.INTERSECT:s=o.intersectManyInPlace(n)}if(this._featureSetCollection.get().id!==o.id){this.app.command("HideFeatureSetResultsView").execute();for(var c=this._featureSetCollection.get().featureSets.getLength(),u=0;u<c;u++)this._featureSetCollection.get().featureSets.removeAt(0);this._featureSetCollection.get().featureSets.addItems(o.featureSets.getItems())}s&&(this._notifyCanExecuteChanged(),this._notifyFeatureSetCollectionChanged()),r&&r({updatedCollection:o,combineMode:a,modified:s})}}},o.prototype._canAddFeatureToResults=function(e){var t=this._featureSetCollection.get();return!(!t||!e)&&!this._existsInCollection(e,t)},o.prototype._canRemoveFeatureFromResults=function(e){var t=this._featureSetCollection.get();return!(!t||!e)&&this._existsInCollection(e,t)},o.prototype._canFindSelection=function(e){return!0},o.prototype._canCreateSelection=function(e){return!0},o.prototype._canUpdateSelection=function(e){return!0},o.prototype._canRestoreSelection=function(e){return!0},o.prototype._canDeleteSelection=function(e){return!0},o.prototype._canRenameSelection=function(e){return!0},o.prototype._canReplaceResults=function(e){return!0},o.prototype._canUnionResults=function(e){return!0},o.prototype._canSubtractResults=function(e){return!0},o.prototype._canIntersectResults=function(e){return!0},o.prototype._canCombineResults=function(e){return!0},o.prototype._noop=function(){},o}(i.ModuleBase);o.SelectionModule=g})},"Mapping/modules/Selection/SelectionState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"url:/Mapping/modules/Selection/CombineResultsView.html":t,"url:/Mapping/modules/Selection/ListSelectionsView.html":o,"url:/Mapping/modules/Selection/SaveSelectionView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/common.css","css","LyogU0FWRSBTRUxFQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLnNhdmUtc2VsZWN0aW9uLXZpZXcgew0KICAgIHBhZGRpbmc6IDFlbTsNCn0NCg0KLnNhdmUtc2VsZWN0aW9uLXZpZXcgLnNhdmUtYnV0dG9uLmJvdW5kLWRpc2FibGVkOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRjVGNUY1Ow0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KfQ0KDQovKiBMT0FEIFNFTEVDVElPTlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5saXN0LXNlbGVjdGlvbnMtdmlldyAubm8taXRlbSBwLmRlc2NyaXB0aW9uIHsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmxpc3QtbWVudS1pdGVtLA0KLmxpc3Qtc2VsZWN0aW9ucy12aWV3IC5saXN0LW1lbnUtaXRlbSAqIHsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCi5saXN0LXNlbGVjdGlvbnMtdmlldyAubGlzdC1tZW51LWl0ZW0gLmxpc3QtbWVudS1uYW1lIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCi5saXN0LXNlbGVjdGlvbnMtdmlldyAubGlzdC1tZW51LWRlc2Mgew0KICAgIGZsb2F0OiBsZWZ0Ow0KfQ0KLmxpc3Qtc2VsZWN0aW9ucy12aWV3IC5saXN0LW1lbnUtaXRlbTpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLnNlbGVjdGlvbi1jb250ZW50cyB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogM2VtOw0KICAgIHBhZGRpbmc6IDAuNWVtIDYuNWVtIDAuNWVtIDAuNWVtOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0NCg0KLmxpc3Qtc2VsZWN0aW9ucy12aWV3IC5hY3Rpb24tYnV0dG9uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAzZW07DQogICAgd2lkdGg6IDNlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjRUVFRUVFOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmFjdGlvbi1idXR0b24gKyAuYWN0aW9uLWJ1dHRvbiB7DQogICAgcmlnaHQ6IDA7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmxpc3QtbWVudS1pdGVtIGJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRjsgICANCn0NCg0KLyogUkVGSU5FIFJFU1VMVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoubGlzdC1yZWZpbmUtcmVzdWx0cy1oZWFkZXIgew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGNUY1RjU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogLjU0ZW07DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLmxpc3QtcmVmaW5lLXJlc3VsdHMtaGVhZGVyIHNwYW4gew0KICAgIGZsb2F0OiByaWdodDsNCn0NCi5saXN0LXJlZmluZS1yZXN1bHRzLWhlYWRlcjphZnRlciB7DQogICAgY29udGVudDogIiAiOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMDsNCiAgICBjbGVhcjogYm90aDsNCiAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQp9DQoucmVmaW5lLXJlc3VsdHMgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCg0KLnJlZmluZS1yZXN1bHRzIC5saXN0LW1lbnUtbGFiZWwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICBwYWRkaW5nOiAwLjU1ZW0gMi41ZW0gMC41NWVtIDFlbTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLnRvdWNoIC5yZWZpbmUtcmVzdWx0cyAubGlzdC1tZW51LWxhYmVsIHsNCiAgICBwYWRkaW5nOiAxZW0gMi41ZW0gMWVtIDFlbTsNCn0NCi5yZWZpbmUtcmVzdWx0cyAubGlzdC1tZW51LWFjdGlvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICByaWdodDogMDsNCiAgICBtYXJnaW46IDAuNzVlbSAxZW07DQp9DQoucmVmaW5lLXJlc3VsdHMgLmZvcm0tYnRucyB7DQogICAgcGFkZGluZzogMWVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/large.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/medium.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/small.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CombineResultsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/ListSelectionsView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/SaveSelectionView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/Selection/CombineResultsView","Mapping/modules/Selection/CombineResultsViewModel","Mapping/modules/Selection/ListSelectionsView","Mapping/modules/Selection/ListSelectionsViewModel","Mapping/modules/Selection/SaveSelectionView","Mapping/modules/Selection/SaveSelectionViewModel","Mapping/modules/Selection/SelectableSelectionItem","Mapping/modules/Selection/SelectionItem","Mapping/modules/Selection/SelectionModule"],function(t,o,i,n,a,r,s,l,c){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.selection.CombineResultsView",t.CombineResultsView),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.selection.CombineResultsViewModel",o.CombineResultsViewModel),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.selection.ListSelectionsView",i.ListSelectionsView),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.selection.ListSelectionsViewModel",n.ListSelectionsViewModel),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SaveSelectionView",a.SaveSelectionView),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SaveSelectionViewModel",r.SaveSelectionViewModel),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SelectableSelectionItem",s.SelectableSelectionItem),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SelectionItem",l.SelectionItem),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SelectionModule",c.SelectionModule)})}();