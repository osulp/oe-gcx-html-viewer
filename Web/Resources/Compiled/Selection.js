!function(){var t="<div class='refine-results'>    <div class='widget refine-options' data-binding='{@widget: CombineResultsOptionsWidget}{@widget-context: featureSetCollection}{@hidden: combineModeChosen}' data-menu-id='CombineResultsActions' data-menu-hoist-disabled='true'></div>    <div data-binding='{@visible: combineModeChosen}'>        <div class='panel-group no-item box-container' data-binding='{@hidden: selections}'>            <p data-binding='{@text: @language-saved-results-browse-no-items}'></p>            <p class='description' data-binding='{@text: @language-saved-results-browse-no-items-desc}'></p>        </div>        <div class='panel-group' data-binding='{@visible: selections}'>            <div class='list-refine-results-header' tabindex='0'>                <span data-binding='{@text: @language-saved-results-combine-list-explanation}'></span>            </div>            <ul class='list-menu' data-binding='{@source: resultsPage}'>                <li class='list-menu-item' data-binding='{@template-for: resultsPage}'>                    <label class='list-menu-label' data-binding='{@text: displayName}{for: id}'></label>                    <input class='list-menu-action' type='checkbox' data-binding='{id: id}{@value: isSelected}' />                </li>            </ul>            <div class='form-btns'>                <button class='button ok-button' data-binding='{@event-click: handleOkClick}{@text: @language-common-ok}'></button>                <button class='button cancel-button' data-binding='{@event-click: handleCancelClick}{@text: @language-common-cancel}'></button>            </div>        </div>        \x3c!-- BEGIN: Paging Controls --\x3e        <div data-binding='{@visible: selections}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}'></div>        \x3c!-- END: Paging Controls --\x3e    </div></div>",o="<div class='list-selections-view'>    <div class='panel-group no-item box-container' data-binding='{@hidden: selections}'>        <p data-binding='{@text: @language-saved-results-browse-no-items}'></p>        <p class='description' data-binding='{@text: @language-saved-results-browse-no-items-desc}'></p>    </div>    <div class='panel-group' data-binding='{@visible: selections}'>        <ul class='list-menu' data-binding='{@source: resultsPage}'>            <li class='list-menu-item' data-binding='{@template-for: resultsPage}'>                <button class='selection-contents' data-binding='{@disabled: disabled}{title: restoreTooltip}{@event-onclick: handleRestoreSelectionClick}'>                    <span class='list-menu-name' data-binding='{@text: displayName}'></span>                    <span class='list-menu-desc' data-binding='{@visible:disabled}{@text: @language-saved-results-item-already-open}'></span>                </button>                <button class='action-button edit-24 right' data-binding='{@event-onclick: handleRenameClick}{title: renameTooltip}{@enabled: canModify}'></button>                <button class='action-button trashcan-24 right' data-binding='{@event-onclick: handleDeleteClick}{title: deleteTooltip}{@enabled: canModify}'></button>            </li>        </ul>    </div>    \x3c!-- BEGIN: Paging Controls --\x3e    <div data-binding='{@visible: selections}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}'></div>    \x3c!-- END: Paging Controls --\x3e</div>",i="<div class='save-selection-view'>    <label for='selectionName' data-binding='{@text: @language-common-save-as}'></label>    <input type='text' id='selectionName' data-binding='{@value: name}{@event-keydown: handleKeyDown}' />    <div class='form-btns'>        <button class='button save-button' data-binding='{@event-click: handleSaveClick}{@text: @language-common-save}{@enabled: name}'></button>        <button class='button cancel-button' data-binding='{@event-click: handleCancelClick}{@text: @language-common-cancel}'></button>    </div></div>";function c(e,t,o){if("string"==typeof e&&(o=t,t=e),void 0!==o)for(var i=t.split("."),n=null,a=window,r=0,s=i.length;r<s;r++)n=i[r],r==s-1?a[n]=o:a[n]||(a[n]={}),a=a[n];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Selection/CombineResultsView":function(){var i,p=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/selection/CombineMode","geocortex/framework/utils/ArrayUtils","./SelectionModule"],function(e,t,o,a,i,n,r,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,u=(c=o.ViewBase,p(d,c),d.prototype.attach=function(e){c.prototype.attach.call(this,e),this._registerCommands()},d.prototype.deactivated=function(){this.viewModel.reset()},d.prototype._registerCommands=function(){this.app.command("ShowSearchOptions").register(this,this.show,this._canCombineResults),this.app.command("CombineResultsInteractive").register(this,this._executeCombineResultsInteractive)},d.prototype.resolveWidget=function(e,t,o){if("CombineResultsOptionsWidget"===e)return this.app.menuRegistry.createMenuWidget(this,t,o);if("PagingControlsWidget"!==e)return c.prototype.resolveWidget.call(this,e,t,o);var i=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(i){var n=new a.PagingControlsViewModel(this.app,t);i.attach(n)}return i},d.prototype.show=function(e){if(this.viewModel){var t;if("string"==typeof e)t=this.app.featureSetManager.getCollectionById(e);else if(e instanceof i.FeatureSet){var o=new n.FeatureSetCollection;o.featureSets.addItem(e),t=o}else t=e;t?(this.viewModel.featureSetCollection.set(t),this.app.viewManager.activateView(this)):this.app.trace.warning("Cannot save feature set collection: No feature set collection with matching ID found.")}},d.prototype.handleOkClick=function(){var t=this,e=this.viewModel.featureSetCollection.get().displayName.get();0===e.length&&this.viewModel.featureSetCollection.get().featureSets&&(e=this.viewModel.featureSetCollection.get().featureSets.getAt(0).displayName.get());var o={nameOfCurrentResults:e,currentResults:this.viewModel.featureSetCollection.get(),collectionNames:this.viewModel.getSelectedItems().map(function(e){return e.name}),combineResponse:void 0};Promise.resolve(o).then(function(e){return t.app.viewManager.deactivateView(t),e}).then(function(e){return t._combineResults(e)}).then(function(e){return t._displayNotification(e)}).catch(function(e){return t._processError(e)})},d.prototype.handleCancelClick=function(){this.app.viewManager.deactivateView(this)},d.prototype._executeCombineResultsInteractive=function(o){var i=this;if(this.viewModel){var n,a=r.CombineMode.REPLACE;Promise.try(function(){var e=o?o.mode:null,t=o?o.currentResults:null;n="string"==typeof t?i.app.featureSetManager.getCollectionById(t):t,i.viewModel.combineModeChosen.set(!0),i.viewModel.combineMode=e||a,n&&i.viewModel.featureSetCollection.get()&&n.id!==i.viewModel.featureSetCollection.get().id&&i.viewModel.featureSetCollection.set(n)}).then(function(){return i.viewModel.populateFromMetadata()}).catch(function(e){return i._processError(e)})}},d.prototype._combineResults=function(i){var n=this;return new Promise(function(t,e){var o={combineMode:n.viewModel.combineMode,featureSetCollectionIds:n.viewModel.getSelectedItems().map(function(e){return e.featureSetCollectionId}),currentResults:i.currentResults,successCallback:function(e){i.combineResponse=e,t(i)},errorCallback:e};n.app.command("CombineResults").execute(o)})},d.prototype._displayNotification=function(e){var t,o=e.combineResponse,i=e.collectionNames.map(function(e){return"'"+e+"'"}).join(", "),n=e.nameOfCurrentResults;switch(o.combineMode){case r.CombineMode.UNION:t=this.getResource("language-common-results-union-confirmation");break;case r.CombineMode.INTERSECT:t=this.getResource("language-common-results-intersect-confirmation");break;case r.CombineMode.SUBTRACT:t=this.getResource("language-common-results-subtract-confirmation")}return t&&(t=t.format(n,i),this.app.command("AddResultsStatus").execute(t)),e},d.prototype._processError=function(e){var t=e&&"UiError"===e.name?e.message:this.getResource("language-saved-results-error-message");return this.app.command("AddResultsStatus").execute(t),this.app.trace.error(e.message,e),e},d.prototype._canCombineResults=function(e){if(0<l.metadataStore.findAll().length){if("string"!=typeof e)return e instanceof n.FeatureSetCollection?0!==e.featureSets.getLength()&&!!s.firstOrDefault(e.featureSets.getItems(),function(e){return 0<e.features.getLength()}):0<e.features.getLength();if(!(e=this.app.featureSetManager.getCollectionById(e)))return!1}return!1},d);function d(){return null!==c&&c.apply(this,arguments)||this}t.CombineResultsView=u})},"Mapping/modules/Selection/CombineResultsViewModel":function(){var i,u=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./SelectableSelectionItem","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/selection/CombineMode"],function(e,t,o,i,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,l=(s=o.ViewModelBase,u(c,s),c.prototype.initialize=function(e){s.prototype.initialize.call(this,e),(e=e||{}).hasOwnProperty("isPaged")&&(this.isPaged=e.isPaged),e.hasOwnProperty("pageSize")&&(this.pageSize=e.pageSize),this.presentableResults.isPaginated.set(this.isPaged),this.presentableResults.pageSize.set(this.pageSize)},c.prototype.reset=function(){this.combineModeChosen.set(!1)},c.prototype.getSelectedItems=function(){return(this.selections?this.selections.getItems():[]).filter(function(e){return e&&e.isSelected.get()})},c.prototype.populateFromMetadata=function(){var t=this;return this._fetchMetadata().then(function(e){return e.map(function(e){return new n.SelectableSelectionItem(e)})}).then(function(e){return t._excludeCurrentResultsFromList(e)}).then(function(e){return t._populatePresentableCollection(e)}).then(function(){return t.presentableResults.currPageNumber.set(1)})},c.prototype._fetchMetadata=function(){var o=this;return new Promise(function(e,t){o.app.command("FindAllSelectionMetadata").execute({successCallback:e,errorCallback:t})})},c.prototype._excludeCurrentResultsFromList=function(e){var t=this.featureSetCollection.get();return e&&t&&"Selection"===t.sourceName?e.filter(function(e){return e.name!==t.getExtendedPropertyByName("SelectionName")}):e},c.prototype._populatePresentableCollection=function(e){return this.selections.set(e),e},c);function c(e,t){var o=s.call(this,e,t)||this;return o.featureSetCollection=new i.Observable,o.combineModeChosen=new i.Observable(!1),o.isPaged=!0,o.pageSize=10,o.combineMode=r.CombineMode.REPLACE,o.selections=new i.ObservableCollection,o.presentableResults=new a.PresentableCollection(o.selections),o.resultsPage=o.presentableResults.items,o.presentableResults.items.useThrottling=!0,o}t.CombineResultsViewModel=l})},"Mapping/modules/Selection/ListSelectionsView":function(){var i,u=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","./SelectionItem","geocortex/framework/utils/ArrayUtils","./SelectionModule"],function(e,t,o,a,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,l=(s=o.ViewBase,u(c,s),c.prototype.attach=function(e){s.prototype.attach.call(this,e),this._registerCommands()},c.prototype.resolveWidget=function(e,t,o){if("PagingControlsWidget"!==e)return s.prototype.resolveWidget.call(this,e,t,o);var i=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(i){var n=new a.PagingControlsViewModel(this.app,t);i.attach(n)}return i},c.prototype._registerCommands=function(){this.app.command("ListSelections").register(this,this.show,this._canShow)},c.prototype.show=function(){var t=this;this.viewModel&&this.viewModel.findAllMetadata().then(function(e){return t._processMetadata(e)}).then(function(e){return t._disableCurrentlyOpenedCollection(e)}).then(function(e){t.viewModel.selections.set(e),t.viewModel.selections.pulse(),0===t.viewModel.selections.getLength()&&t.app.command("ScreenReaderNarrate").execute(t.getResource("language-saved-results-browse-no-items")),t.app.viewManager.activateView(t)})},c.prototype.handleRestoreSelectionClick=function(e,t,o){var i=o?o.name:null;if(!i)throw new Error("Cannot restore named selection into the results view: selection name is required.");this.app.viewManager.deactivateView(this),this.app.command("RestoreSelection").execute({name:i})},c.prototype.handleRenameClick=function(e,t,o){var i=this;this.promptForSelectionName(o).then(function(e){return i._processName(e,o)}).then(function(e){return i.viewModel.renameSelection(o,e)}).catch(function(e){return i._processError(e)})},c.prototype.handleDeleteClick=function(e,t,o){var i=this;this.confirmDelete(o).then(function(e){e&&i.viewModel.deleteSelection(o)})},c.prototype.confirmDelete=function(e){var o=this,i=this.getResource("language-saved-results-delete-prompt").format(e.name),n=this.getResource("language-saved-results-delete-prompt-title").format(e.name);return new Promise(function(e,t){return o.app.command("Confirm").execute(i,n,e)})},c.prototype.promptForSelectionName=function(e){var o=this,i=this.getResource("language-saved-results-rename-prompt-title"),n=this.getResource("language-saved-results-rename-prompt"),a=e.name;return new Promise(function(e,t){return o.app.command("Prompt").execute(i,n,a,e)})},c.prototype._processMetadata=function(e){var o=this;return e.map(function(e){var t=new i.SelectionItem(e);return o.viewModel.setTooltips(t)})},c.prototype._disableCurrentlyOpenedCollection=function(n){var a=this;return this.app.command("_isResultsViewActive").execute(function(e){if(e){var t=a.viewModel.featureSetCollection.get(),o=t&&"Selection"===t.sourceName?t.displayName.get():null,i=n&&o?r.firstOrDefault(n,function(e){return e.name===o}):null;i&&i.disabled.set(!0)}}),n},c.prototype._processName=function(t,e){var o,i=this.viewModel.selections.get();if(!t)throw(o=new Error(this.getResource("language-saved-results-no-name-error").format(e.name))).name="UiError",o;if(t===e.name)return e.name;if(i.some(function(e){return e.name===t}))throw(o=new Error(this.getResource("language-saved-results-rename-prompt-error").format(t))).name="UiError",o;return t},c.prototype._processError=function(e){var t=e&&"UiError"===e.name?e.message:this.getResource("language-saved-results-error-message");return this.app.command("AddResultsStatus").execute(t),this.app.trace.error(t,e),e},c.prototype._canShow=function(){return 0<n.metadataStore.findAll().length},c);function c(){return null!==s&&s.apply(this,arguments)||this}t.ListSelectionsView=l})},"Mapping/modules/Selection/ListSelectionsViewModel":function(){var i,l=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection"],function(e,t,o,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=o.ViewModelBase,l(s,a),s.prototype.initialize=function(e){var t=this;a.prototype.initialize.call(this,e),(e=e||{}).hasOwnProperty("isPaged")&&(this.isPaged=e.isPaged),e.hasOwnProperty("pageSize")&&(this.pageSize=e.pageSize),this.presentableResults.isPaginated.set(this.isPaged),this.presentableResults.pageSize.set(this.pageSize),this.app.command("ShowResultsList").register(this,this._trackDisplayedResults),this.app.command("ShowResultsTable").register(this,this._trackDisplayedResults,function(){return!t.app.configuration.mobileMode})},s.prototype.findAllMetadata=function(){var o=this;return new Promise(function(e,t){o.app.command("FindAllSelectionMetadata").execute({successCallback:e,errorCallback:t})})},s.prototype.deleteSelection=function(i){var n=this;return new Promise(function(e,t){var o={name:i.name,successCallback:function(){n.selections.removeItem(i),e()},errorCallback:t};n.app.command("DeleteSelection").execute(o)})},s.prototype.renameSelection=function(i,n){var a=this;return new Promise(function(e,t){var o={name:i.name,newName:n,successCallback:function(){i.name=n,a.setTooltips(i),a.resultsPage.pulse(),e()},errorCallback:t};a.app.command("RenameSelection").execute(o)})},s.prototype.setTooltips=function(e){var t=this.getResource("language-saved-results-item-restore-description").format(e.name),o=this.getResource("language-saved-results-item-rename-description").format(e.name),i=this.getResource("language-saved-results-item-delete-description").format(e.name);return e.restoreTooltip=t,e.renameTooltip=o,e.deleteTooltip=i,e},s.prototype._trackDisplayedResults=function(e){var t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e;t&&t!==this.featureSetCollection.get()&&this.featureSetCollection.set(t)},s);function s(e,t){var o=a.call(this,e,t)||this;return o.featureSetCollection=new i.Observable,o.isPaged=!0,o.pageSize=10,o.selections=new i.ObservableCollection,o.presentableResults=new n.PresentableCollection(o.selections),o.resultsPage=o.presentableResults.items,o.presentableResults.items.useThrottling=!0,o}t.ListSelectionsViewModel=r})},"Mapping/modules/Selection/SaveSelectionView":function(){var i,c=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/Dictionary","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection"],function(e,t,o,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=o.ViewBase,c(l,n),l.prototype.attach=function(e){n.prototype.attach.call(this,e),this._registerCommands()},l.prototype._registerCommands=function(){this.app.command("ShowSaveSelectionDialog").register(this,this.show,this._canShow),this.app.event("SelectionCreatedEvent").subscribe(this,this._handleSelectionCreated),this.app.event("SelectionChangedEvent").subscribe(this,this._handleSelectionChanged),this.app.event("SelectionRemovedEvent").subscribe(this,this._handleSelectionRemoved)},l.prototype.handleKeyDown=function(e,t,o){return(e.which?e.which:e.keyCode)===dojo.keys.ENTER&&(this.save(),e.preventDefault()),!0},l.prototype.handleCancelClick=function(){this.app.viewManager.deactivateView(this)},l.prototype.handleSaveClick=function(){this.save()},l.prototype.save=function(){var t=this,e=this.viewModel.name.get();this.viewModel.saveSelection(e).then(function(e){return t._processResults(e)}).catch(function(e){return t._processError(e)})},l.prototype.show=function(e,t){var o;if("string"==typeof e)o=this.app.featureSetManager.getCollectionById(e);else if(e instanceof a.FeatureSet){var i=new r.FeatureSetCollection;i.featureSets.addItem(e),o=i}else o=e;if(o){var n=t;n=n||("Selection"===o.sourceName&&o.displayName.get()!==this.viewModel._starredSelectionName?o.getExtendedPropertyByName("SelectionName"):""),this.viewModel.featureSetCollection.set(o),this.viewModel.name.set(n),this.app.viewManager.activateView(this)}else this.app.trace.warning("Cannot save feature set collection: No feature set collection with matching ID found.")},l.prototype._canShow=function(e,t){var o;if("string"==typeof e)o=this.app.featureSetManager.getCollectionById(e);else if(e instanceof a.FeatureSet){var i=new r.FeatureSetCollection;i.featureSets.addItem(e),o=i}else o=e;return!(!o||0===o.featureSets.length())&&("Selection"!==o.sourceName||o.displayName.get()===this.viewModel._starredSelectionName||o.isModified.get())},l.prototype._processResults=function(e){return e&&(this.viewModel.showConfirmationMessage(),this.app.viewManager.deactivateView(this)),e},l.prototype._processError=function(e){var t=e&&"UiError"===e.name?e.message:this.getResource("language-saved-results-error-message");return this.app.command("AddResultsStatus").execute(t),this.app.trace.error(t,e),e},l.prototype._handleSelectionCreated=function(e){var t=e?e.name:null,o=e&&e.featureSetCollection?e.featureSetCollection.id:null;this._computeCanExecute(t,o)},l.prototype._handleSelectionChanged=function(e){var t=e?e.name:null,o=e&&e.featureSetCollection?e.featureSetCollection.id:null;this._computeCanExecute(t,o)},l.prototype._handleSelectionRemoved=function(e){var t=e?e.name:null,o=e&&e.featureSetCollection?e.featureSetCollection.id:null;this._computeCanExecute(t,o)},l.prototype._computeCanExecute=function(e,t){var o=this;t&&this.viewModel.findMetadata(e,t).then(function(e){return e?o._metadataCache.set(t,e):o._metadataCache.remove(t)}).catch(function(e){return o._metadataCache.remove(t)}).lastly(function(){return o.app.command("ShowSaveSelectionDialog").raiseCanExecuteChanged()})},l);function l(){var e=null!==n&&n.apply(this,arguments)||this;return e._metadataCache=new i.Dictionary,e}t.SaveSelectionView=s})},"Mapping/modules/Selection/SaveSelectionViewModel":function(){var i,l=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,o,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=o.ViewModelBase,l(s,a),s.prototype.saveSelection=function(o){var i=this;return Promise.try(function(){return i._assertNameNotNull(o),i.selectionExists(o).then(function(e){if(i._existingSelection=e,i._existingSelection){if(o!==i._starredSelectionName)return i.confirmOverwrite(o);var t=i.app.getResource(i.libraryId,"language-saved-results-cannot-overwrite").format(o);return i.app.command("Alert").execute(t),Promise.resolve(!1)}return Promise.resolve(!0)}).then(function(e){return i._existingSelection&&e?i.updateSelection(o).thenReturn(!0):i._existingSelection?Promise.resolve(!1):i.createSelection(o).thenReturn(!0)})})},s.prototype.findMetadata=function(i,n){var a=this;return new Promise(function(e,t){var o={successCallback:e,errorCallback:t};if(!i&&!n)throw new Error("The selection name or feature set collection ID must be set.");i&&(o.name=i),n&&(o.featureSetCollectionId=n),a.app.command("FindMetadataForSelection").execute(o)})},s.prototype.selectionExists=function(e){var t=this;return Promise.try(function(){return t._assertNameNotNull(e),t.findMetadata(e).then(function(e){return!n.isNullOrUndefined(e)})})},s.prototype.createSelection=function(o){var i=this;return new Promise(function(e,t){i._assertNameNotNull(o),i.app.command("CreateSelection").execute({name:o,featureSetCollection:i.featureSetCollection.get(),successCallback:e,errorCallback:t})})},s.prototype.updateSelection=function(o){var i=this;return new Promise(function(e,t){i._assertNameNotNull(o),i.app.command("UpdateSelection").execute({name:o,featureSetCollection:i.featureSetCollection.get(),successCallback:e,errorCallback:t})})},s.prototype.confirmOverwrite=function(e){var o=this,i=this.app.getResource(this.libraryId,"language-saved-results-overwrite-prompt").format(e),n=this.app.getResource(this.libraryId,"language-saved-results-overwrite-prompt-title").format(e);return new Promise(function(e,t){return o.app.command("Confirm").execute(i,n,e)})},s.prototype.showConfirmationMessage=function(){var e=this.name.get(),t=this.featureSetCollection.get().countFeatures(),o=this._existingSelection?"language-saved-results-update-confirmation":"language-saved-results-create-confirmation",i=this.getResource(o).format(e,t);this.app.command("AddResultsStatus").execute(i)},s.prototype._assertNameNotNull=function(e){if(n.isNullOrUndefined(e))throw new Error("The selection name must be set.")},s);function s(e,t){var o=a.call(this,e,t)||this;return o.name=new i.Observable,o.featureSetCollection=new i.Observable,o._existingSelection=!1,o._starredSelectionName=e.getResource("Mapping.Infrastructure","language-selection-starred-selection-name"),o}t.SaveSelectionViewModel=r})},"Mapping/modules/Selection/SelectableSelectionItem":function(){var i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","./SelectionItem","geocortex/framework/observables"],function(e,t,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=(n=o.SelectionItem,s(r,n),r);function r(e){var t=n.call(this,e)||this;return t.isSelected=new i.Observable(!1),t}t.SelectableSelectionItem=a})},"Mapping/modules/Selection/SelectionItem":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/FormatUtils","geocortex/framework-ui/LazyObservable","geocortex/infrastructure/selection/StarredSelection"],function(e,t,o,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.formatDisplayName=function(){var e=this.name||"",t=this.count||0;return e?"{0} ({1})".format(e,t):""},s.prototype.toMetaData=function(){return{id:this.id,featureSetCollectionId:this.featureSetCollectionId,name:this.name,count:this.count,modified:this.modified,timeCreated:this.timeCreated,timeModified:this.timeModified,timeExpiration:this.timeExpiration}},s);function s(e){var t=this;this.disabled=new o.Observable(!1),this.canModify=new o.Observable(!0),this.id=e.id,this.featureSetCollectionId=e.featureSetCollectionId,this.name=e.name||"",this.count=e.count||0,this.modified=e.modified||!1,this.timeCreated=e.timeCreated,this.timeModified=e.timeModified,this.timeExpiration=e.timeExpiration,this.dateCreated=i.parseUtcDate(this.timeCreated),this.dateModified=i.parseUtcDate(this.timeModified),this.dateExpiration=i.parseUtcDate(this.timeExpiration),this.displayName=new n.LazyObservable(null,function(){return t.formatDisplayName()}),e.name===a.fsc.displayName.get()&&this.canModify.set(!1)}t.SelectionItem=r})},"Mapping/modules/Selection/SelectionModule":function(){var i,v=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/selection/SelectionMetadataStore","geocortex/framework/observables","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/validation/NumberValidator","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/eventArgs/FeatureSetManagerEventArgs","geocortex/infrastructure/FeatureSet","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/selection/CombineMode","geocortex/infrastructure/results/ResultsUtils","geocortex/infrastructure/selection/StarredSelection","geocortex/infrastructure/ui/PanelPosition","geocortex/framework/utils/utils"],function(e,u,t,i,n,a,o,r,s,c,l,p,d,m,g,h){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var f,S=(f=t.ModuleBase,v(C,f),C.prototype.initialize=function(e){var t=this;f.prototype.initialize.call(this,e),(e=e||{}).hasOwnProperty("resultsListStatusRegion")&&(this._resultsListStatusRegion=e.resultsListStatusRegion),e.hasOwnProperty("resultsTableStatusRegion")&&(this._resultsTableStatusRegion=e.resultsTableStatusRegion),this.app.menuRegistry.loadMenus(e),this._statusRegionName=this._resultsListStatusRegion,this._adhocFeatureSetCollection.displayName.set(this.app.getResource("Mapping.Infrastructure","language-selection-default-results-name")),this._adhocFeatureSetCollection.sourceName="Selection",this._adhocFeatureSetCollection.id=d.DEFAULT_COLLECTION_ID,this.app.featureSetManager.addCollection(this._adhocFeatureSetCollection),this._featureSetCollection.set(this._adhocFeatureSetCollection),this.app.waitUntilApplicationReady().then(function(){var e=l.firstOrDefault(t.app.configModel.widgetConfigs,function(e){return"SelectionStar"===e.id});e&&(t._persistStarHighlights=!h.isNullOrUndefined(e.configuration.persistHighlights)&&e.configuration.persistHighlights)}),this._registerCommands(),this._subscribeEvents()},C.prototype.getStateFilter=function(){var e=new o.NumberValidator;return{results:this.app.project.filter.featureSetCollection,selections:{item:{id:!0,name:!0,featureSetCollectionId:!0,count:e,modified:!0,timeCreated:e,timeModified:e,timeExpiration:e}}}},C.prototype.exportState=function(){var e=this;return Promise.try(function(){return{results:e.app.project.convert.fromGcxFeatureSetCollection(e._featureSetCollection.get()),selections:u.metadataStore.findAll()}})},C.prototype.applyState=function(t){var o=this;return Promise.try(function(){return u.metadataStore.clear(),o.app.project.convert.toGcxFeatureSetCollection(t.results).then(function(e){o._featureSetCollection.set(e),(t.selections||[]).forEach(function(e){u.metadataStore.add(e)}),o._notifyCanExecuteChanged()})})},C.prototype._registerCommands=function(){var t=this;this.app.command("FindAllSelectionMetadata").register(this,this._executeFindAllSelectionMetadata),this.app.command("FindMetadataForSelection").register(this,this._executeFindMetadataForSelection),this.app.command("FindSelection").register(this,this._executeFindSelection,this._canFindSelection),this.app.command("CreateSelection").register(this,this._executeCreateSelection,this._canCreateSelection),this.app.command("UpdateSelection").register(this,this._executeUpdateSelection,this._canUpdateSelection),this.app.command("RestoreSelection").register(this,this._executeRestoreSelection,this._canRestoreSelection),this.app.command("DeleteSelection").register(this,this._executeDeleteSelection,this._canDeleteSelection),this.app.command("RenameSelection").register(this,this._executeRenameSelection,this._canRenameSelection),this.app.command("AddFeatureToStarredSelection").register(this,this._executeAddToStarredSelection,this._canAddToStarredSelection),this.app.command("RemoveFeatureFromStarredSelection").register(this,this._executeRemoveFromStarredSelection,this._canRemoveFromStarredSelection),this.app.command("AddFeatureSetToStarredSelection").register(this,this._executeAddFeatureSetToStarred,this._canAddFeatureSetToStarred),this.app.command("RemoveFeatureSetFromStarredSelection").register(this,this._executeSubtractFeatureSetFromStarred,this._canSubtractFeatureSetFromStarred),this.app.command("ClearStarredSelection").register(this,this._executeClearStarredSelection,function(){return 0<m.fsc.countFeatures()}),this.app.command("ShowStarredSelection").register(this,this._executeShowStarredSelection,function(){return 0<m.fsc.countFeatures()}),this.app.command("ShowSelection").register(this,this._executeShowSelection,this._canShowSelection),this.app.command("AddFeatureToResults").register(this,this._executeAddFeatureToResults,this._canAddFeatureToResults),this.app.command("RemoveFeatureFromResults").register(this,this._executeRemoveFeatureFromResults,this._canRemoveFeatureFromResults),this.app.command("AddFeatureToResultsAtIndex").register(this,this._executeAddFeatureToResultsAtIndex,this._canExecuteAddFeatureToResultsAtIndex),this.app.command("_AddFeatureToResultsWhenOriginalFeatureExists").register(this,this._executeAddFeatureToResultsWhenOriginalFeatureExists,this._canAddFeatureToResults),this.app.command("CombineResults").register(this,this._executeCombineResults,this._canCombineResults),this.app.command("ResultsReplace").register(this,this._executeReplaceResults,this._canReplaceResults),this.app.command("ResultsUnion").register(this,this._executeUnionResults,this._canUnionResults),this.app.command("ResultsSubtract").register(this,this._executeSubtractResults,this._canSubtractResults),this.app.command("ResultsIntersect").register(this,this._executeIntersectResults,this._canIntersectResults),this.app.command("AddResultsStatus").register(this,this.addStatus),this.app.command("RemoveResultsStatus").register(this,this.removeStatus),this.app.command("ShowResultsList").register(this,function(e){t._showResultsViewImpl(t._resultsListStatusRegion,e)}),this.app.command("ShowResultsTable").register(this,function(e){t._showResultsViewImpl(t._resultsTableStatusRegion,e)},function(){return!t.app.configuration.mobileMode})},C.prototype._subscribeEvents=function(){this.app.event("ResultsViewCollapsedEvent").subscribe(this,this._handleResultsViewCollapsed),this.app.event("FSMCollectionRemovedEvent").subscribe(this,this._handleFsmCollectionRemovedEvent),this.app.event("FSMCollectionChangedEvent").subscribe(this,this._handleFsmCollectionChangedEvent),this.app.event("FeatureDeletedEvent").subscribe(this,this._updateMetadataForSavedSelections),this.app.event("GraphicRemovedEvent").subscribe(this,this._updateMetadataForSavedSelections),this.app.command("_updateMetadataForSavedSelections").register(this,this._updateMetadataForSavedSelections)},C.prototype.addStatus=function(e){var t,o=this;"string"==typeof e?(t=new r.AddStatusArgs(e)).timeoutMS=0:t=e,t.regionName=t.regionName||this._statusRegionName,t.id=t.id||"ResultsStatusMessageView",this.app.command("RemoveResultsStatus").execute(),this.app.configuration.mobileMode&&"ResultsStatusMessageView"===t.id?this.app.command("_getCurrentBottomPanelPosition").execute(function(e){e!==g.PanelPosition.Maximized&&e!==g.PanelPosition.Partial||o.app.command("AddStatus").execute(t)}):this.app.command("AddStatus").execute(t)},C.prototype.removeStatus=function(){this.app.command("RemoveStatus").execute("ResultsStatusMessageView")},C.prototype._showResultsViewImpl=function(e,t){this._setStatusRegion(e);var o=null;"string"==typeof t?o=this.app.featureSetManager.getCollectionById(t):t instanceof a.FeatureSetCollection&&(o=t),o&&o!==this._featureSetCollection.get()&&this._featureSetCollection.set(o),this._notifyCanExecuteChanged()},C.prototype._handleFsmCollectionChangedEvent=function(e){this._featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId===this._featureSetCollection.get().id&&this._featureSetCollection.get().sourceName===this._fscSourceName&&(this._featureSetCollection.get().isModified.set(!0),this.app.command("ShowSaveSelectionDialog").raiseCanExecuteChanged())},C.prototype._handleFsmCollectionRemovedEvent=function(e){this._featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId===this._featureSetCollection.get().id&&(this._featureSetCollection.set(null),this.app.command("ShowSaveSelectionDialog").raiseCanExecuteChanged())},C.prototype._updateMetadataForSavedSelections=function(e){var i=this,n=null;e instanceof a.FeatureSetCollection&&(n=e),(u.metadataStore.findAll()||[]).forEach(function(e){var t=i.app.featureSetManager.getCollectionById(e.featureSetCollectionId);if(!n||n&&t===n){var o=(new Date).getTime();e.count=t.countFeatures(),e.timeModified=o,u.metadataStore.updateById(e.id,e)}})},C.prototype._setStatusRegion=function(e){this._statusRegionName=e||this._resultsListStatusRegion},C.prototype._handleResultsViewCollapsed=function(e){e&&this._statusView&&this.app.command("RemoveResultsStatus").execute()},C.prototype._copyFeatureSets=function(e,t,o){if(void 0===o&&(o=!1),e&&t&&e!==t){o&&t.clear();for(var i=0;i<e.featureSets.length();i++){var n=e.featureSets.getAt(i);if(n){var a=n.clone();t.featureSets.addItem(a)}}}},C.prototype._copyExtendedProperties=function(e,t,o){void 0===o&&(o=!1),e&&t&&e!==t&&(o&&t.extendedProperties.clear(),e.extendedProperties.getItems().forEach(function(e){return t.setExtendedProperty(e.name,e.value)}))},C.prototype._copy=function(e){var t=new a.FeatureSetCollection;return t.sourceName=e.sourceName,t.displayName.set(e.displayName.get()),t.isModified.set(e.isModified.get()),t.tag=e.tag,this._copyExtendedProperties(e,t,!0),this._copyFeatureSets(e,t,!0),this.app.featureSetManager.addCollection(t),t},C.prototype._create=function(e,t){var o=new a.FeatureSetCollection;return o.sourceName=this._fscSourceName,o.tag=t.tag,o.displayName.set(e),this._copyFeatureSets(t,o,!0),this._copyExtendedProperties(t,o,!0),o.setExtendedProperty(this._extPropName,e),this.app.featureSetManager.addCollection(o),this._createMetadata(e,o),o},C.prototype._createMetadata=function(e,t){if(!t)throw new Error("Cannot create metadata for selection: A feature set collection is required.");if(!e)throw new Error("Cannot create metadata for selection: The selection name is required.");var o=(new Date).getTime(),i={id:null,name:e,featureSetCollectionId:t.id,count:t.countFeatures(),modified:!1,timeCreated:o,timeModified:o};return u.metadataStore.add(i)},C.prototype._update=function(e,t,o){t.tag=o.tag,this._copyFeatureSets(o,t,!0),this._copyExtendedProperties(o,t,!0),t.setExtendedProperty(this._extPropName,e.name),t.isModified.set(!1),o.isModified.set(!1);var i=(new Date).getTime();e.timeModified=i,e.count=t.countFeatures(),e.modified=!1,u.metadataStore.updateById(e.id,e)},C.prototype._restore=function(e){if(!e)throw new Error("Collection is required");-1<this.app.featureSetManager.getCollectionIds().indexOf(e.id)||this.app.featureSetManager.addCollection(e),this._restoreById(e.id)},C.prototype._restoreById=function(e){this.app.featureSetManager.tryCloseCollection(e),this.app.featureSetManager.openCollection(e),this.app.featureSetManager.closeCollection(e)},C.prototype._delete=function(e,t){this.app.featureSetManager.tryCloseCollection(t.id),this.app.featureSetManager.removeCollectionById(t.id),u.metadataStore.removeById(e.id)},C.prototype._rename=function(e,t,o){var i=(new Date).getTime();t.timeModified=i,t.name=e,u.metadataStore.updateById(t.id,t),o.displayName.set(e),o.setExtendedProperty(this._extPropName,e)},C.prototype._existsInCollection=function(e,t){if(!e||!e.featureSet&&!e.layer)return!1;if(!t)throw new Error("FeatureSetCollection is required");for(var o=0;o<t.featureSets.getLength();o++){var i=t.featureSets.getAt(o),n=i.layer;if(e.featureSet&&e.featureSet.id===i.id)return i.containsFeature(e);if(e.layer){var a=e.layer===n||e.layer&&n&&e.layer.id===n.id,r=e.layer===n||e.layer&&n&&e.layer.mapService===n.mapService||e.layer&&n&&e.layer.mapService&&n.mapService&&e.layer.mapService.id===n.mapService.id;if(a&&r)return i.containsFeature(e)}}return!1},C.prototype._tryAddToCollection=function(e,t,o){if(!t||!e)return!1;var i=null,n=!1,a=e.featureSet?e.featureSet.id:null,r=e.layer;if(a&&(i=t.getFeatureSetById(a)),!i&&r&&(i=t.getFeatureSetByLayer(r)),!i&&!e.layer&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().getLayer()&&(i=t.getFeatureSetbyEsriLayer(e.esriFeature.get().getLayer())),!i){if(e.featureSet)i=e.featureSet.cloneStructure();else{var s=void 0;!e.layer&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().getLayer()&&e.esriFeature.get().getLayer().id&&(s=e.esriFeature.get().getLayer().id),i=new c.FeatureSet({app:this.app,layer:e.layer,esriFeatureSet:new esri.tasks.FeatureSet,id:s})}n=!0}if(i){var l=i.addFeatureAt(e,!1,o);return n&&l&&t.featureSets.addItem(i),l&&(this.app.command("AddFeatureSetToStarredSelection").raiseCanExecuteChanged(),this.app.command("RemoveFeatureSetFromStarredSelection").raiseCanExecuteChanged()),l}return!1},C.prototype._tryRemoveFromCollection=function(e,t){if(!t||!e)return!1;var o=null,i=e.featureSet?e.featureSet.id:null,n=e.layer,a=!1;if(i&&(o=t.getFeatureSetById(i)),!o&&n&&(o=t.getFeatureSetByLayer(n)),!o&&!e.layer&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().getLayer()&&(o=t.getFeatureSetbyEsriLayer(e.esriFeature.get().getLayer())),o)if(1===o.features.length()&&(e.getExtendedPropertyByName("isShownInMaptip")||e.getExtendedPropertyByName("isShownInFeaturedetails"))){for(var r=0;r<t.featureSets.length();r++)if(t.featureSets.getAt(r)===o){var s=o.clone();a=o.removeFeature(e),e.featureSet=s,t.featureSets.removeItem(o)}}else a=o.removeFeature(e),0===o.features.getLength()&&(t.featureSets.removeItem(o),a=!0);return a&&(this.app.command("AddFeatureSetToStarredSelection").raiseCanExecuteChanged(),this.app.command("RemoveFeatureSetFromStarredSelection").raiseCanExecuteChanged()),a},C.prototype._notifyCanExecuteChanged=function(){this.app.command("AddFeatureToResults").raiseCanExecuteChanged(),this.app.command("RemoveFeatureFromResults").raiseCanExecuteChanged(),this.app.command("CombineResults").raiseCanExecuteChanged(),this.app.command("ResultsReplace").raiseCanExecuteChanged(),this.app.command("ResultsUnion").raiseCanExecuteChanged(),this.app.command("ResultsSubtract").raiseCanExecuteChanged(),this.app.command("ResultsIntersect").raiseCanExecuteChanged(),this.app.command("ShowSelection").raiseCanExecuteChanged(),this.app.command("ListSelections").raiseCanExecuteChanged(),this.app.command("ShowSearchOptions").raiseCanExecuteChanged()},C.prototype._notifySelectionCanExecuteChanged=function(){var e=this;this.app.command("AddFeatureToStarredSelection").raiseCanExecuteChanged(),this.app.command("RemoveFeatureFromStarredSelection").raiseCanExecuteChanged(),this.app.command("AddFeatureSetToStarredSelection").raiseCanExecuteChanged(),this.app.command("RemoveFeatureSetFromStarredSelection").raiseCanExecuteChanged(),this.app.command("ClearStarredSelection").raiseCanExecuteChanged(),setTimeout(function(){e.app.command("ShowSelection").raiseCanExecuteChanged(),e.app.command("ShowStarredSelection").raiseCanExecuteChanged()})},C.prototype._notifyFeatureSetCollectionChanged=function(e){e=e||this._featureSetCollection.get();var t=new s.FeatureSetManagerEventArgs({sender:this,featureSetCollection:e,featureSetCollectionId:e.id});this.app.event("FSMCollectionChangedEvent").publish(t)},C.prototype._handleAddedFeature=function(e,t){t===this._featureSetCollection.get()&&(this._notifyCanExecuteChanged(),this.app.event("_featureAddedToResults").publish(e)),t===m.fsc&&this._notifySelectionCanExecuteChanged(),this._notifyFeatureSetCollectionChanged(t);var o=this.getResource("language-common-results-added-confirmation").format(1,t.displayName.get()||this.app.getResource("Mapping.Infrastructure","language-selection-default-results-name"));this.app.command("AddResultsStatus").execute(o)},C.prototype._handleRemovedFeature=function(e,t){if(t===this._featureSetCollection.get()&&(this._notifyCanExecuteChanged(),this.app.event("_featureRemovedFromResults").publish(e)),t===m.fsc&&this._notifySelectionCanExecuteChanged(),this._notifyFeatureSetCollectionChanged(t),t!==this._featureSetCollection.get()||!this.app.configuration.mobileMode||t.firstFeature()){var o=this.getResource("language-common-results-removed-confirmation").format(1,t.displayName.get()||this.getResource("language-selection-default-selection-name"));this.app.command("AddResultsStatus").execute(o)}},C.prototype._updateFeatureSelectedStatus=function(e,t,o){if(e.selected.value=t,o=o||e.featureSet,this.app.event("FeatureChangedEvent").publish(e),o)for(var i=0,n=this.app.featureSetManager.featureSetCollections.getItems();i<n.length;i++){var a=n[i],r=l.firstOrDefault(a.featureSets.getItems(),function(e){return e.id===o.id});if(r&&r!==o){var s=r.findFeatureById(e.id.get());s&&(s.selected.value=t,this.app.event("FeatureChangedEvent").publish(s))}}},C.prototype._executeShowSelection=function(){var e=u.metadataStore.findAll();1<e.length?this.app.command("ListSelections").execute():e[0]&&this.app.command("RestoreSelection").execute({name:e[0].name})},C.prototype._executeShowStarredSelection=function(){var e=this._copy(m.fsc);this._restore(e),this._notifyCanExecuteChanged()},C.prototype._executeClearStarredSelection=function(){for(var e=0,t=m.fsc.featureSets.getItems();e<t.length;e++)for(var o=0,i=t[e].features.getItems();o<i.length;o++){var n=i[o];n.selected.value=!1,this._updateFeatureSelectedStatus(n,!1)}this.app.highlightManager.redrawHighlights(),m.fsc.clear(),this.app.command("DeleteSelection").execute({name:m.fsc.displayName.get()}),this._notifySelectionCanExecuteChanged()},C.prototype._executeAddFeatureSetToStarred=function(t){for(var e=0,o=t.features.getItems();e<o.length;e++){var i=o[e];i.selected.get()||this._updateFeatureSelectedStatus(i,!0,t)}var n=l.firstOrDefault(m.fsc.featureSets.getItems(),function(e){return e.id===t.id});n?(n.unionInPlace(t),this._notifyFeatureSetCollectionChanged(m.fsc)):m.fsc.featureSets.addItem(t.clone()),this._persistStarHighlights&&this.app.highlightManager.highlightSelected(t.features.get()),0===u.metadataStore.find({name:m.fsc.displayName.get()}).length&&this.app.command("CreateSelection").execute({name:m.fsc.displayName.get(),featureSetCollection:m.fsc}),this._notifySelectionCanExecuteChanged()},C.prototype._executeSubtractFeatureSetFromStarred=function(t){for(var e=0,o=t.features.getItems();e<o.length;e++){var i=o[e];i.selected.get()&&this._updateFeatureSelectedStatus(i,!1,t)}var n=l.firstOrDefault(m.fsc.featureSets.getItems(),function(e){return e.id===t.id});n&&(n.subtractInPlace(t),0===n.features.getLength()&&m.fsc.featureSets.removeItem(n),this.app.highlightManager.redrawHighlights(),this._notifyFeatureSetCollectionChanged(m.fsc)),0===m.fsc.countFeatures()&&this.app.command("DeleteSelection").execute({name:m.fsc.displayName.get()}),this._notifySelectionCanExecuteChanged()},C.prototype._executeAddToStarredSelection=function(e){this._tryAddToCollection(e,m.fsc)&&(this._persistStarHighlights&&this.app.highlightManager.highlightSelected([e]),this._updateFeatureSelectedStatus(e,!0),this._handleAddedFeature(e,m.fsc),0===u.metadataStore.find({name:m.fsc.displayName.get()}).length&&this.app.command("CreateSelection").execute({name:m.fsc.displayName.get(),featureSetCollection:m.fsc}))},C.prototype._executeAddFeatureToResultsAtIndex=function(e){this._executeAddFeatureToResults(e.feature,e.featureSetIndex)},C.prototype._executeAddFeatureToResultsWhenOriginalFeatureExists=function(e){this._executeAddFeatureToResults(e.feature,e.featureSetIndex,e.originalFeature)},C.prototype._executeAddFeatureToResults=function(e,t,o){0===this._featureSetCollection.get().featureSets.getLength()&&(0<this._adhocFeatureSetCollection.featureSets.getLength()&&this._adhocFeatureSetCollection.clear(),this._featureSetCollection.set(this._adhocFeatureSetCollection));var i=this._featureSetCollection.get();if(o){var n=!1;if(i&&i.featureSets&&i.featureSets.get()&&0<i.featureSets.get().length)for(var a=0;a<i.featureSets.get().length&&!n;a++){var r=i.featureSets.getAt(a);if(r&&r.features&&r.features.get()&&0<r.features.get().length)for(var s=0;s<r.features.get().length&&!n;s++)o.structurallyEquals(r.features.getAt(s))&&(n=!0)}if(!n)return}this._tryAddToCollection(e,i,t)&&(i===m.fsc&&(e.selected.value=!0,this._updateFeatureSelectedStatus(e,!0)),this._handleAddedFeature(e,i))},C.prototype._executeRemoveFromStarredSelection=function(e){var t=e.featureSet;this._tryRemoveFromCollection(e,m.fsc)&&(this._updateFeatureSelectedStatus(e,!1,t),this._handleRemovedFeature(e,m.fsc),0===m.fsc.countFeatures()&&this.app.command("DeleteSelection").execute({name:m.fsc.displayName.get()}))},C.prototype._executeRemoveFeatureFromResults=function(e){this._tryRemoveFromCollection(e,this._featureSetCollection.get())&&(this._featureSetCollection.get()===m.fsc&&(e.selected.value=!1,this._updateFeatureSelectedStatus(e,!1)),this._handleRemovedFeature(e,this._featureSetCollection.get()))},C.prototype._executeFindAllSelectionMetadata=function(e){((e=e||{}).successCallback||this._noop)(u.metadataStore.findAll())},C.prototype._executeFindMetadataForSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.name,n=e.featureSetCollectionId;if(i||n){var a={};i&&(a.name=i),n&&(a.featureSetCollectionIds=[n]);var r=u.metadataStore.find(a);t(l.firstOrDefault(r))}else o(new Error("Cannot fetch selection metadata: A selection name or feature set collection ID is required."))},C.prototype._executeFindSelection=function(e){var t=null,o=(e=e||{}).successCallback||this._noop,i=e.name,n=i?u.metadataStore.findByName(i):null,a=n?this.app.featureSetManager.getCollectionById(n.featureSetCollectionId):null;a&&(t=this._copy(a)),o(t)},C.prototype._executeCreateSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.featureSetCollection,n=e.name;if(n){var a="string"==typeof i?this.app.featureSetManager.getCollectionById(i):i,r=this._copy(this._create(n,a));t(),this.app.event("SelectionCreatedEvent").publish({name:n,featureSetCollection:r}),this._notifyCanExecuteChanged()}else o(new Error("Cannot create named selection: The selection name is required."))},C.prototype._executeUpdateSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.featureSetCollection,n=e.name;if(n){var a=u.metadataStore.findByName(n);if(a&&a.id){var r="string"==typeof i?this.app.featureSetManager.getCollectionById(i):i,s=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId);if(s){this._update(a,s,r);var l=this._copy(s);t(),this.app.event("SelectionChangedEvent").publish({name:n,previousName:n,featureSetCollection:l}),this._notifyCanExecuteChanged()}else o(new Error("Cannot update named selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId)))}}else o(new Error("Cannot update named selection: The selection name is required."))},C.prototype._executeRestoreSelection=function(e){var t,o=(e=e||{}).successCallback||this._noop,i=e.errorCallback||this._noop,n=e.name;if(n){var a=u.metadataStore.findByName(n);if(a)if(t=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId)){var r=this._copy(t);this._restore(r),o(),this._notifyCanExecuteChanged()}else i(new Error("Cannot restore named selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId)));else i(new Error("Cannot restore named selection: '{0}' not found.".format(n)))}else i(new Error("Cannot restore named selection: The selection name is required."))},C.prototype._executeDeleteSelection=function(e){var t,o=(e=e||{}).successCallback||this._noop,i=e.errorCallback||this._noop,n=e.name;if(n){var a=u.metadataStore.findByName(n);a?(t=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId))?(this._delete(a,t),o(),this.app.event("SelectionRemovedEvent").publish({name:n,featureSetCollection:t}),this._notifyCanExecuteChanged()):i(new Error("Cannot delete named selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId))):i(new Error("Cannot delete named selection: '{0}' not found.".format(n)))}else i(new Error("Cannot delete named selection: The selection name is required."))},C.prototype._executeRenameSelection=function(e){var t=(e=e||{}).successCallback||this._noop,o=e.errorCallback||this._noop,i=e.name,n=e.newName;if(i&&n){var a=u.metadataStore.findByName(i);if(a&&a.id){var r=this.app.featureSetManager.getCollectionById(a.featureSetCollectionId);if(r){this._rename(n,a,r);var s=this._copy(r),l=this._featureSetCollection.get();if(l&&l.sourceName===this._fscSourceName){var c=l.getExtendedPropertyByName(this._extPropName);c&&c===i&&(l.displayName.set(n),l.setExtendedProperty(this._extPropName,n))}t(),this.app.event("SelectionChangedEvent").publish({name:n,previousName:i,featureSetCollection:s}),this._notifyCanExecuteChanged()}else o(new Error("Cannot rename selection: feature set collection '{0}' not found.".format(a.featureSetCollectionId)))}else o(new Error("Cannot rename selection: '{0}' not found.".format(i)))}else o(new Error("Cannot rename selection: The selection name is required."))},C.prototype._getCombineResultsCommandArgs=function(e,t){var o="string"==typeof e?e:e.id;return o?{combineMode:t||p.CombineMode.REPLACE,currentResults:this._featureSetCollection.get(),featureSetCollectionIds:[o]}:null},C.prototype._executeReplaceResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.REPLACE);this._executeCombineResults(t)},C.prototype._executeUnionResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.UNION);this._executeCombineResults(t)},C.prototype._executeSubtractResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.SUBTRACT);this._executeCombineResults(t)},C.prototype._executeIntersectResults=function(e){var t=this._getCombineResultsCommandArgs(e,p.CombineMode.INTERSECT);this._executeCombineResults(t)},C.prototype._executeCombineResults=function(e){var t=this;if(e&&e.featureSetCollectionIds&&0!==e.featureSetCollectionIds.length){var o,i=e.currentResults;if(o=(o="string"==typeof i?this.app.featureSetManager.getCollectionById(i):i)||this._featureSetCollection.get()){var n=e.featureSetCollectionIds.map(function(e){return t.app.featureSetManager.getCollectionById(e)}).filter(function(e){return null!=e}).map(function(e){return e.clone(!0)}),a=e.combineMode||p.CombineMode.REPLACE,r=e.successCallback,s=!1;switch(a){case p.CombineMode.REPLACE:var l=n&&0<n.length?n[0]:null;l&&(o.clear(),o.featureSets.addItems(l.featureSets.getItems()));break;case p.CombineMode.UNION:s=o.unionManyInPlace(n);break;case p.CombineMode.SUBTRACT:s=o.subtractManyInPlace(n);break;case p.CombineMode.INTERSECT:s=o.intersectManyInPlace(n)}if(this._featureSetCollection.get().featureSets!==o.featureSets){this.app.command("HideFeatureSetResultsView").execute();for(var c=this._featureSetCollection.get().featureSets.getLength(),u=o.featureSets.getItems().slice(),d=0;d<c;d++)this._featureSetCollection.get().featureSets.removeAt(0);this._featureSetCollection.get().featureSets.addItems(u)}s&&(this._notifyCanExecuteChanged(),this._notifyFeatureSetCollectionChanged()),r&&r({updatedCollection:o,combineMode:a,modified:s})}}},C.prototype._canShowSelection=function(){return 0<u.metadataStore.findAll().length},C.prototype._canExecuteAddFeatureToResultsAtIndex=function(e){return"number"==typeof e.featureSetIndex&&this._canAddFeatureToResults(e.feature)},C.prototype._canAddToStarredSelection=function(e){return!this._existsInCollection(e,m.fsc)},C.prototype._canAddFeatureToResults=function(e){var t=this._featureSetCollection.get();return!(!t||!e||this._existsInCollection(e,t))},C.prototype._canRemoveFromStarredSelection=function(e){return this._existsInCollection(e,m.fsc)},C.prototype._canRemoveFeatureFromResults=function(e){var t=this._featureSetCollection.get();return!(!t||!e)&&this._existsInCollection(e,t)},C.prototype._canSubtractFeatureSetFromStarred=function(e){return e.features.getItems().some(function(e){return e.selected.get()})},C.prototype._canAddFeatureSetToStarred=function(e){return e.features.getItems().some(function(e){return!e.selected.get()})},C.prototype._canFindSelection=function(e){return!0},C.prototype._canCreateSelection=function(e){return!0},C.prototype._canUpdateSelection=function(e){return!0},C.prototype._canRestoreSelection=function(e){return!0},C.prototype._canDeleteSelection=function(e){return!0},C.prototype._canRenameSelection=function(e){return!0},C.prototype._canReplaceResults=function(e){return!0},C.prototype._canUnionResults=function(e){return!0},C.prototype._canSubtractResults=function(e){return!0},C.prototype._canIntersectResults=function(e){return!0},C.prototype._canCombineResults=function(e){return!0},C.prototype._noop=function(){},C);function C(e,t){var o=f.call(this,e,t)||this;return o._fscSourceName="Selection",o._extPropName="SelectionName",o._resultsListStatusRegion="DataFrameResultsStatusRegion",o._resultsTableStatusRegion="ResultsStatusRegion",o._statusView=null,o._featureSetCollection=new n.Observable,o._adhocFeatureSetCollection=new a.FeatureSetCollection,o._persistStarHighlights=!1,u.metadataStore=new i.SelectionMetadataStore(e),o}u.SelectionModule=S})},"Mapping/modules/Selection/SelectionState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"url:/Mapping/modules/Selection/CombineResultsView.html":t,"url:/Mapping/modules/Selection/ListSelectionsView.html":o,"url:/Mapping/modules/Selection/SaveSelectionView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/common.css","css","LyogU0FWRSBTRUxFQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLnNhdmUtc2VsZWN0aW9uLXZpZXcgew0KICAgIHBhZGRpbmc6IDFlbTsNCn0NCg0KLnNhdmUtc2VsZWN0aW9uLXZpZXcgLnNhdmUtYnV0dG9uLmJvdW5kLWRpc2FibGVkOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRjVGNUY1Ow0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KfQ0KDQovKiBMT0FEIFNFTEVDVElPTlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5saXN0LXNlbGVjdGlvbnMtdmlldyAubm8taXRlbSBwLmRlc2NyaXB0aW9uIHsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmxpc3QtbWVudS1pdGVtLA0KLmxpc3Qtc2VsZWN0aW9ucy12aWV3IC5saXN0LW1lbnUtaXRlbSAqIHsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCi5saXN0LXNlbGVjdGlvbnMtdmlldyAubGlzdC1tZW51LWl0ZW0gLmxpc3QtbWVudS1uYW1lIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCi5saXN0LXNlbGVjdGlvbnMtdmlldyAubGlzdC1tZW51LWRlc2Mgew0KICAgIGZsb2F0OiBsZWZ0Ow0KfQ0KLmxpc3Qtc2VsZWN0aW9ucy12aWV3IC5saXN0LW1lbnUtaXRlbTpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLnNlbGVjdGlvbi1jb250ZW50cyB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogM2VtOw0KICAgIHBhZGRpbmc6IDAuNWVtIDYuNWVtIDAuNWVtIDAuNWVtOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0NCg0KLmxpc3Qtc2VsZWN0aW9ucy12aWV3IC5hY3Rpb24tYnV0dG9uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAzZW07DQogICAgd2lkdGg6IDNlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjRUVFRUVFOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmFjdGlvbi1idXR0b24gKyAuYWN0aW9uLWJ1dHRvbiB7DQogICAgcmlnaHQ6IDA7DQp9DQoubGlzdC1zZWxlY3Rpb25zLXZpZXcgLmxpc3QtbWVudS1pdGVtIGJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRjsgICANCn0NCg0KLyogUkVGSU5FIFJFU1VMVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoubGlzdC1yZWZpbmUtcmVzdWx0cy1oZWFkZXIgew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGNUY1RjU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogLjU0ZW07DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLmxpc3QtcmVmaW5lLXJlc3VsdHMtaGVhZGVyIHNwYW4gew0KICAgIGZsb2F0OiByaWdodDsNCn0NCi5saXN0LXJlZmluZS1yZXN1bHRzLWhlYWRlcjphZnRlciB7DQogICAgY29udGVudDogIiAiOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMDsNCiAgICBjbGVhcjogYm90aDsNCiAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQp9DQoucmVmaW5lLXJlc3VsdHMgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCg0KLnJlZmluZS1yZXN1bHRzIC5saXN0LW1lbnUtbGFiZWwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICBwYWRkaW5nOiAwLjU1ZW0gMi41ZW0gMC41NWVtIDFlbTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLnRvdWNoIC5yZWZpbmUtcmVzdWx0cyAubGlzdC1tZW51LWxhYmVsIHsNCiAgICBwYWRkaW5nOiAxZW0gMi41ZW0gMWVtIDFlbTsNCn0NCi5yZWZpbmUtcmVzdWx0cyAubGlzdC1tZW51LWFjdGlvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICByaWdodDogMDsNCiAgICBtYXJnaW46IDAuNzVlbSAxZW07DQp9DQoucmVmaW5lLXJlc3VsdHMgLmZvcm0tYnRucyB7DQogICAgcGFkZGluZzogMWVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/large.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/medium.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CSS/small.css","css",""),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/CombineResultsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/ListSelectionsView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Selection/SaveSelectionView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/Selection/CombineResultsView","Mapping/modules/Selection/CombineResultsViewModel","Mapping/modules/Selection/ListSelectionsView","Mapping/modules/Selection/ListSelectionsViewModel","Mapping/modules/Selection/SaveSelectionView","Mapping/modules/Selection/SaveSelectionViewModel","Mapping/modules/Selection/SelectableSelectionItem","Mapping/modules/Selection/SelectionItem","Mapping/modules/Selection/SelectionModule"],function(e,t,o,i,n,a,r,s,l){c(e,"geocortex.essentialsHtmlViewer.mapping.modules.selection.CombineResultsView",e.CombineResultsView),c(t,"geocortex.essentialsHtmlViewer.mapping.modules.selection.CombineResultsViewModel",t.CombineResultsViewModel),c(o,"geocortex.essentialsHtmlViewer.mapping.modules.selection.ListSelectionsView",o.ListSelectionsView),c(i,"geocortex.essentialsHtmlViewer.mapping.modules.selection.ListSelectionsViewModel",i.ListSelectionsViewModel),c(n,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SaveSelectionView",n.SaveSelectionView),c(a,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SaveSelectionViewModel",a.SaveSelectionViewModel),c(r,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SelectableSelectionItem",r.SelectableSelectionItem),c(s,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SelectionItem",s.SelectionItem),c(l,"geocortex.essentialsHtmlViewer.mapping.modules.selection.SelectionModule",l.SelectionModule)})}();