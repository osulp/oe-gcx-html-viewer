!function(){function e(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var r=t.split("."),o=null,n=window,a=0,s=r.length;a<s;a++)o=r[a],a==s-1?n[o]=i:n[o]||(n[o]={}),n=n[o];else console.warn("Undefined shim for: "+t)}var t="<div class='layer-addition add-layer-dialog' data-binding='{@source: searchFragment}{@class-disabled: disabled}'>    <div data-binding='{@template-for: searchFragment}'>        \x3c!-- Description for this dialog. --\x3e        <p class='add-layer-dialog-description' data-binding='{@text: @language-layer-addition-search-description}'></p>        <div>            <label for='layer-addition-search-box' data-binding='{@text: @language-layer-addition-button-search}'></label>            <input type='text' id='layer-addition-search-box' data-binding='{@value: searchText}{@var: autoCompleteInput}{@event-keydown: handleKeyDown}' tabindex='0' />        </div>        \x3c!-- Bottom buttons. --\x3e        <div class='form-btns'>            <button class='button' data-binding='{@event-onclick: handleSearchClick}{@text: @language-layer-addition-button-search}{disabled: disabled}'></button>            <button class='button' data-binding='{@text: @language-common-cancel}{@event-onclick: handleCancelClick}'></button>        </div>    </div></div>",i="<div class='layer-addition map-services-dialog' data-binding='{@source: mapServicesFragment}{@class-disabled: disabled}'>    <div data-binding='{@template-for: mapServicesFragment}'>        <div class='panel-group no-item box-container' data-binding='{@hidden: serviceResults}'>            <p data-binding='{@text: @language-common-no-results}'></p>            <p class='description' data-binding='{@text: @language-common-no-results-desc}'></p>        </div>        <div class='panel-group' data-binding='{@visible: serviceResults}'>            <ul class='gcx-list-menu' data-binding='{@source: serviceResults}'>                <li class='gcx-list-item' data-binding='{@template-for: serviceResults}{@class-has-action-1: supportsAddition}'>                    <button class='gcx-list-button icon-right chevron-right-24' data-binding='{@event-onclick: handleItemClick}{@disabled: disabled}'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                        <span class='gcx-list-desc' data-binding='{@text: url}'></span>                    </button>                    <button class='gcx-action-button icon add-24' data-binding='{@event-onclick: handleAddServiceClick}{@disabled: disabled}{@visible: supportsAddition}'></button>                </li>            </ul>        </div>    </div></div>",r="<div class='layer-addition service-connections-dialog' data-binding='{@source: serviceConnectionsFragment}{@class-disabled: disabled}'>    <div data-binding='{@template-for: serviceConnectionsFragment}'>        <div class='panel-group no-item box-container' data-binding='{@hidden: serviceConnections}'>            <p data-binding='{@text: @language-common-no-results}'></p>            <p class='description' data-binding='{@text: @language-common-no-results-desc}'></p>        </div>        <div class='panel-group' data-binding='{@visible: serviceConnections}'>            <ul class='gcx-list-menu' data-binding='{@source: serviceConnections}'>                <li class='gcx-list-item' data-binding='{@template-for: serviceConnections}'>                    <button class='gcx-list-button icon-right chevron-right-24' data-binding='{@event-onclick: handleItemClick}'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                    </button>                </li>            </ul>        </div>    </div>    \x3c!-- BEGIN: Paging Controls --\x3e    \x3c!--<div data-binding='{@visible: selections}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}'></div>--\x3e    \x3c!-- END: Paging Controls --\x3e</div>",o="<div class='layer-addition sub-layers-dialog' data-binding='{@source: subLayersFragment}{@class-disabled: disabled}'>    <div data-binding='{@template-for: subLayersFragment}'>        <div class='panel-group no-item box-container' data-binding='{@hidden: subLayers}'>            <p data-binding='{@text: @language-common-no-results}'></p>            <p class='description' data-binding='{@text: @language-layer-addition-no-layers-desc}'></p>        </div>        <div class='panel-group' data-binding='{@visible: subLayers}'>            <ul class='gcx-list-menu' data-binding='{@source: subLayers}'>                <li class='gcx-list-item has-action-1' data-binding='{@template-for: subLayers}'>                    <div class='gcx-list-content'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                        <span class='gcx-list-desc' data-binding='{@text: description}'></span>                    </div>                    <button class='gcx-action-button icon add-24' data-binding='{@event-onclick: handleAddLayerClick}'></button>                </li>            </ul>        </div>    </div>        \x3c!-- BEGIN: Paging Controls --\x3e        \x3c!--<div data-binding='{@visible: selections}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}'></div>--\x3e        \x3c!-- END: Paging Controls --\x3e</div>",n="<div class='layer-addition-properties panel-group-contents'>    <div class='layer-addition-properties-selector form-item'>        <div class='form-stacked'>            <div class='form-item'>                <label class='form-label' data-binding='{@text: @language-layer-addition-layer-name-desc}'></label>            </div>            <div class='form-item'>                <div class='form-control'>                    <label class='form-label' for='layerName' data-binding='{@text: @language-layer-addition-layer-name}'></label>                    <input id='layerName' type='text' data-binding='{@value: layerName}' />                </div>            </div>            <div class='form-item' data-binding='{@hidden: isGroupLayer}'>                <div class='form-control'>                    <label class='layer-addition-properties-item-ctrl' data-binding='{@visible: layerSupportsIdentify}'>                        <input type='checkbox' data-binding='{@value: layerIsIdentifiable}'>                        <span data-binding='{@text: @language-layer-addition-identifiable}'></span>                    </label>                    <label class='layer-addition-properties-item-ctrl'>                        <input type='checkbox' data-binding='{@value: layerIsSearchable}'>                        <span data-binding='{@text: @language-layer-addition-searchable}'></span>                    </label>                    <label class='layer-addition-properties-item-ctrl' data-binding='{@visible: layerSupportsQuery}'>                        <input type='checkbox' data-binding='{@value: layerIsQueryable}'>                        <span data-binding='{@text: @language-layer-addition-queryable}'></span>                    </label>                    <label class='layer-addition-properties-item-ctrl' data-binding='{@hidden: isHandheld}'>                        <input type='checkbox' data-binding='{@value: layerShowsMapTips}'>                        <span data-binding='{@text: @language-layer-addition-show-maptips}'></span>                    </label>                </div>            </div>            <div class='form-item'>                <div class='form-btns'>                    <button class='button' data-binding='{@event-onclick: handleClickButtonOK}{@text: @language-layer-addition-done}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCancel}{@text: @language-layer-addition-cancel}'></button>                </div>            </div>        </div>    </div></div>";require({cache:{"Mapping/modules/LayerAddition/LayerAdditionModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.exportState=function(){return t.prototype.exportState.call(this)},i.prototype.applyState=function(e){return t.prototype.applyState.call(this,e)},i.prototype.getStateFilter=function(){return null},i}(r.ModuleBase);i.LayerAddition=o})},"Mapping/modules/LayerAddition/LayerAdditionState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/LayerAddition/LayerAdditionViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","./Dialogs/AddLayerDialogViewModel","./Dialogs/ServiceConnectionsDialogViewModel","./Dialogs/MapServicesDialogViewModel","./Dialogs/SubLayersDialogViewModel","geocortex/essentials/serviceDiscovery/SiteServiceDiscoveryProvider","geocortex/essentials/KmlService","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/commandArgs/AddStatusArgs"],function(t,i,r,o,n,a,s,d,c,l,u){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ERROR_CANCELLED="LayerAdditionError/Cancelled",i.ERROR_INVALID_SERVICE_METADATA="LayerAdditionError/InvalidServiceMetadata",i.ERROR_CANNOT_ZOOM_TO_LAYER_EXTENT="LayerAdditionError/CannotZoomToLayerExtent";var p=function(t){function r(e,i){var r=t.call(this,e,i)||this;return r.initialized=!1,r.supported=!1,r.statusMessageViewId="LayerAdditionStatusMessageView",r.statusMessageRegionName="LayerListStatusMessageRegion",r.zoomToUserAddedLayers=!0,r.smartOrderUserAddedLayers=!0,r.layerDefaults={insertPosition:"top",searchable:!0,identifiable:!0,showMapTips:!0},r._wizardState={searchText:void 0,serviceConnections:void 0,selectedConnection:void 0,selectedMapServiceItem:void 0,selectedSubLayerItem:void 0,mapServices:void 0},r.searchFragment=new o.AddLayerDialogViewModel(r,e,i),r.serviceConnectionsFragment=new n.ServiceConnectionsDialogViewModel(r,e,i),r.mapServicesFragment=new a.MapServicesDialogViewModel(r,e,i),r.subLayersFragment=new s.SubLayersDialogViewModel(r,e,i),r}return e(r,t),r.prototype.initialize=function(e,i){var r=this;t.prototype.initialize.call(this,e),e=e||{},this.zoomToUserAddedLayers=void 0!=e.zoomToUserAddedLayers?e.zoomToUserAddedLayers:this.zoomToUserAddedLayers,this.smartOrderUserAddedLayers=void 0!=e.smartOrderUserAddedLayers?e.smartOrderUserAddedLayers:this.smartOrderUserAddedLayers;var o=e.layerDefaults;void 0!=o&&(this.layerDefaults.insertPosition=void 0!=o.insertPosition?o.insertPosition:this.layerDefaults.insertPosition,this.layerDefaults.searchable=void 0!=o.searchable?o.searchable:this.layerDefaults.searchable,this.layerDefaults.identifiable=void 0!=o.identifiable?o.identifiable:this.layerDefaults.identifiable,this.layerDefaults.showMapTips=void 0!=o.showMapTips?o.showMapTips:this.layerDefaults.showMapTips),this._registerCommandsAndEvents(),this._initProvider(i).then(function(e){return r.setServiceDiscoveryProvider(e),r.initialized=!0,r.supported=!0,e instanceof d.SiteServiceDiscoveryProvider&&(r.supported=e.supported),e}).lastly(function(){return r._raiseCanExecuteChanged()})},r.prototype._initProvider=function(e){var t=this;return e?Promise.resolve(e):this.app.waitUntilSiteInitialized().then(function(){var e=new d.SiteServiceDiscoveryProvider;return e.initialize(t.app.site),e})},r.prototype.getCurrentState=function(){return this._wizardState},r.prototype.getServiceDiscoveryProvider=function(){return this._serviceDiscovery},r.prototype.setServiceDiscoveryProvider=function(e){this._serviceDiscovery=e},r.prototype._registerCommandsAndEvents=function(){},r.prototype._raiseCanExecuteChanged=function(){this.app.command("AddMapLayerInteractive").raiseCanExecuteChanged()},r.prototype.reset=function(){this.searchFragment.reset(),this.serviceConnectionsFragment.reset(),this.mapServicesFragment.reset(),this.subLayersFragment.reset(),this._wizardState={searchText:void 0,serviceConnections:void 0,selectedConnection:void 0,selectedMapServiceItem:void 0,selectedSubLayerItem:void 0,mapServices:void 0}},r.prototype.canSaveProject=function(){var e=this;return new Promise(function(t){return t(e.app.command("SaveProject").canExecute())})},r.prototype.zoomTo=function(e){var t=this,r=[];if(e instanceof c.KmlService){var o=e.serviceLayer.getLayers();r.push.apply(r,o)}else r.push.apply(r,e.layers);for(var n=[],a=0,s=r;a<s.length;a++){var d=s[a];d.fullExtent&&l.isValidGeometry(d.fullExtent)&&n.push(d.fullExtent)}return l.unionGeometries(n,this.app).then(function(e){return t._convertToExtent(e)}).then(function(e){return e&&t.app.command("ZoomToExtent").execute(e)}).catch(function(e){var t=new Error(e.message);throw t.name=i.ERROR_CANNOT_ZOOM_TO_LAYER_EXTENT,t})},r.prototype._convertToExtent=function(e){switch(e?e.type:null){case"extent":return e;case"polygon":case"polyline":return e.getExtent();default:return null}},r.prototype.switchToLayerList=function(e,t){var i=this;return new Promise(function(e){return i.app.command("SwitchToLayerView").execute(),t&&i.addStatus(t),e()})},r.prototype.addStatus=function(e,t){if(e){var i=new u.AddStatusArgs(e);return i.id=t||this.statusMessageViewId,i.timeoutMS=0,this.statusMessageRegionName&&(i.regionName=this.statusMessageRegionName),this.app.command("AddStatus").execute(i),i.id}return null},r.prototype.removeStatus=function(e){this.app.command("RemoveStatus").execute(e||this.statusMessageViewId)},r.prototype.handleError=function(e){return e.name===i.ERROR_CANCELLED||(e.name===i.ERROR_INVALID_SERVICE_METADATA?this.app.command("Alert").execute(this.getResource("language-layer-addition-error-no-service-metadata-message"),this.getResource("language-layer-addition-error-no-service-metadata")):e.name===i.ERROR_CANNOT_ZOOM_TO_LAYER_EXTENT?this.app.trace.warning(this.getResource("language-layer-addition-error-cannot-zoom-to-layer")):/The ID .* is not the well-known ID of a supported coordinate system\./.test(e.message)?this.app.command("Alert").execute(this.getResource("language-layer-addition-error-unsupported-wkid-message"),this.getResource("language-layer-addition-error-unsupported-wkid")):(this.app.trace.error(e.message,e),this.app.command("Alert").execute(this.getResource("language-layer-addition-error-message"),this.getResource("language-layer-addition-error")))),Promise.reject(e)},r}(r.ViewModelBase);i.LayerAdditionViewModel=p})},"Mapping/modules/LayerAddition/LayerPropertiesView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.registerCommands(),r}return e(i,t),i.prototype.attach=function(e){t.prototype.attach.call(this,e),this.viewModel=e},i.prototype.registerCommands=function(){var e=this;this.app.command("ShowLayerPropertiesView").register(this,this.showLayerPropertiesView,this.canExecuteShowLayerPropertiesView),this.app.command("HideLayerPropertiesView").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},i.prototype.canExecuteShowLayerPropertiesView=function(e){return e&&e.isUserCreated&&String.isNullOrEmpty(e.catalogId)},i.prototype.showLayerPropertiesView=function(e){this.viewModel.obsLayer.set(e),this.title.set(this.getResource("language-layer-addition-layer-properties")),this.app.command("ActivateView").execute(this.id)},i.prototype.handleClickButtonOK=function(e,t,i){this.viewModel.applyChanges(),this.app.viewManager.deactivateView(this)},i.prototype.handleClickButtonCancel=function(e,t,i){this.app.viewManager.deactivateView(this)},i}(r.ViewBase);i.LayerPropertiesView=o})},"Mapping/modules/LayerAddition/LayerPropertiesViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,r,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.obsLayer=new o.Observable,e.layerName=new o.Observable(""),e.layerIsSearchable=new o.Observable(!1),e.layerIsIdentifiable=new o.Observable(!1),e.layerIsQueryable=new o.Observable(!1),e.layerShowsMapTips=new o.Observable(!1),e.layerSupportsIdentify=new o.Observable(!1),e.layerSupportsQuery=new o.Observable(!1),e.isGroupLayer=new o.Observable(!1),e.isHandheld=new o.Observable(!1),e}return e(i,t),i.prototype.initialize=function(e){var t=this;this.obsLayer.bind(this,function(e){t.loadLayerInformation(e)})},i.prototype.loadLayerInformation=function(e){this.layer=e,this.layerName.set(this.layer.displayName),this.layerIsIdentifiable.set(this.layer.identifiable),this.layerIsSearchable.set(this.layer.searchable),this.layerShowsMapTips.set(this.layer.showMapTips),this.layerIsQueryable.set(this.layer.queryable),this.layerSupportsQuery.set(this.layer.supportsQuery),this.layerSupportsIdentify.set(this.layer.supportsIdentify),this.isHandheld.set(this.app.configuration.mobileMode),this.isGroupLayer.set(this.layer.subLayerIds&&this.layer.subLayerIds.length>0)},i.prototype.applyChanges=function(){this.layer.displayName=this.layerName.get(),this.app.event("LayerDisplayNameChanged").publish(this.layer),this.layer.identifiable=this.layerIsIdentifiable.get(),this.layer.searchable=this.layerIsSearchable.get(),this.layer.showMapTips=this.layerShowsMapTips.get(),this.layer.queryable=this.layerIsQueryable.get();var e=this.layer.mapService;!(e.layers.length<2)||e.supportsDynamicLayers||e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer||(this.layer.mapService.displayName=this.layer.displayName),this.app.event("MapServicePropertyChangedEvent").publish(this.layer.mapService),this.app.event("MapServiceLayersChangedEvent").publish(this.layer.mapService)},i}(r.ViewModelBase);i.LayerPropertiesViewModel=n})},"Mapping/modules/LayerAddition/Dialogs/AddLayerDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.autoCompleteMinPrefixLength=3,r.autoCompleteMinPopulateDelay=300,r.autoCompleteMaxEntries=10,r.app.command("AddMapLayerInteractive").register(r,r.show,r._canExecuteAddMapLayerInteractive),r}return e(i,t),i.prototype.added=function(e){t.prototype.added.call(this,e),this._setupAutoComplete()},i.prototype.show=function(){this.viewModel&&this.viewModel.reset(),this.app.viewManager.activateView(this)},i.prototype.getSuggestions=function(e,t){var i=this;return void 0===t&&(t=this.autoCompleteMaxEntries),this.viewModel.searchFragment.getSuggestions(e).then(function(e){return t>0?i._clampResults(e,t):e}).then(function(e){return e.sort()}).catch(function(e){return[]})},i.prototype.findServices=function(e){var t=this;return this.isBusy.set(!0),this.viewModel.searchFragment.findServices(e).then(function(i){return t.saveState(e,i)}).then(function(){return t.goNext()}).catch(function(e){return t.app.trace.error("Service Discovery - Error searching for services: "+e.message),null}).finally(function(){return t.isBusy.set(!1)})},i.prototype.handleSearchClick=function(e,t,i){this._closeAutoComplete(),this.findServices(this.viewModel.searchFragment.searchText.get())},i.prototype.handleCancelClick=function(e,t,i){this.isBusy.set(!1),this.viewModel.reset(),this.app.viewManager.deactivateView(this)},i.prototype.saveState=function(e,t){var i=this.viewModel.getCurrentState();i.searchText=e,i.serviceConnections=t},i.prototype.goNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.app.command("LayerAddition_PerformSearch").execute()},i.prototype.handleKeyDown=function(e,t,i){var r=e.which?e.which:e.keyCode;return!!this._isSpecialChar(r)||(r===dojo.keys.ENTER&&(this._closeAutoComplete(),this.findServices(this.viewModel.searchFragment.searchText.get())),!0)},i.prototype._canExecuteAddMapLayerInteractive=function(){return this.viewModel&&this.viewModel.supported&&!this.app.isOffline.get()},i.prototype._setupAutoComplete=function(){var e=this,t={minLength:this.autoCompleteMinPrefixLength,delay:this.autoCompleteMinPopulateDelay,source:function(t,i){e._handleAutoCompleteSearch(t,i)},select:function(t,i){return e._handleAutoCompleteSelect(t,i),!1}};$(this.autoCompleteInput).autocomplete(t)},i.prototype._handleAutoCompleteSearch=function(e,t){this.getSuggestions(e.term,this.autoCompleteMaxEntries).then(function(e){return t(e)}).catch(function(e){return t([])})},i.prototype._handleAutoCompleteSelect=function(e,t){this.viewModel.searchFragment.searchText.set(t.item.value)},i.prototype._closeAutoComplete=function(){$(this.autoCompleteInput).autocomplete("close")},i.prototype._clampResults=function(e,t){return e&&e.length>0?e.slice(0,t):[]},i.prototype._isSpecialChar=function(e){switch(e){case dojo.keys.TAB:case dojo.keys.SHIFT:case dojo.keys.CTRL:case dojo.keys.ALT:case dojo.keys.PAUSE:case dojo.keys.CAPS_LOCK:case dojo.keys.ESCAPE:case dojo.keys.PAGE_UP:case dojo.keys.PAGE_DOWN:case dojo.keys.END:case dojo.keys.HOME:case dojo.keys.LEFT_ARROW:case dojo.keys.UP_ARROW:case dojo.keys.RIGHT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.NUM_LOCK:case dojo.keys.SCROLL_LOCK:case dojo.keys.INSERT:return!0}return!1},i}(r.WizardFragmentView);i.AddLayerDialogView=o})},"Mapping/modules/LayerAddition/Dialogs/AddLayerDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,r,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i,r){var n=t.call(this,i,r)||this;return n.disabled=new o.Observable(!1),n.searchText=new o.Observable(null),n.owner=e,n.searchText.set(""),n}return e(i,t),i.prototype.reset=function(){this.disabled.set(!1),this.searchText.set("")},i.prototype.getSuggestions=function(e){return Promise.resolve(this.owner.getServiceDiscoveryProvider().suggestHints(e))},i.prototype.findServices=function(e){return Promise.resolve(this.owner.getServiceDiscoveryProvider().findServices(e))},i}(r.ViewModelBase);i.AddLayerDialogViewModel=n})},"Mapping/modules/LayerAddition/Dialogs/MapServiceItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.originalItem=e,this.layers=t,this.serviceProviderName=e.serviceProviderName,this.url=e.url,this.setName(e.displayName),this.disabled=!1;(e.serviceType||[]).indexOf("FeatureServer")>-1?this.supportsAddition=!1:this.supportsAddition=!0}return e.prototype.setName=function(e){this.name=e,this.displayName=e+" ("+(this.layers||[]).length+")"},e}();t.MapServiceItem=i})},"Mapping/modules/LayerAddition/Dialogs/MapServicesDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","./../LayerAdditionViewModel"],function(t,i,r,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("LayerAddition_ListMapServices").register(r,r.show),r}return e(i,t),i.prototype.show=function(){this.loadState(),this.app.viewManager.activateView(this)},i.prototype.loadState=function(){var e=this.viewModel.getCurrentState().selectedConnection,t=this.viewModel.mapServicesFragment;t.reset(),t.process(e)},i.prototype.saveState=function(e){this.viewModel.getCurrentState().selectedMapServiceItem=e},i.prototype.goNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.app.command("LayerAddition_ExpandMapService").execute()},i.prototype.handleItemClick=function(e,t,i){this.saveState(i),this.goNext()},i.prototype.handleAddServiceClick=function(e,t,i){var r=this;this.saveState(i);var o=this.viewModel.mapServicesFragment;this._confirmBeforeAdding(i).then(function(e){return o.realizeMapService(e)}).then(function(e){return r._verifyMapService(e)}).then(function(e){return r._addToMap(e)}).then(function(e){return r.viewModel.switchToLayerList(e,r.getResource("language-layer-addition-success")).return(e)}).then(function(e){return r._zoomToFullExtent(e)}).catch(function(e){return r.viewModel.handleError(e)}).finally(function(){return r.finishWizard()})},i.prototype._confirmBeforeAdding=function(e){var t=this;return this.viewModel.canSaveProject().then(function(i){return e.originalItem&&e.originalItem.isWhitelisted?Promise.resolve(e):new Promise(function(r,n){var a,s=t.getResource("language-layer-addition-confirm-add-layer");a=i?t.getResource("language-layer-addition-confirm-add-layer-message"):t.getResource("language-layer-addition-confirm-add-layer-message-anonymous"),t.app.command("Confirm").execute(a,s,function(t){if(t)return r(e);var i=new Error("Layer addition process was cancelled.");return i.name=o.ERROR_CANCELLED,n(i)})})})},i.prototype._addToMap=function(e){return this.app.command("AddMapService").execute(e),e},i.prototype._zoomToFullExtent=function(e){return this.viewModel.zoomToUserAddedLayers?this.viewModel.zoomTo(e).return(e):Promise.resolve(e)},i.prototype._verifyMapService=function(e){if(!e)throw new Error("Layer Addition: could not get metadata for service.");return e},i}(r.WizardFragmentView);i.MapServicesDialogView=n})},"Mapping/modules/LayerAddition/Dialogs/MapServicesDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./MapServiceItem"],function(t,i,r,o,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i,r){var n=t.call(this,i,r)||this;return n.disabled=new o.Observable(!1),n.serviceResults=new o.ObservableCollection,n.owner=e,n}return e(i,t),i.prototype.process=function(e){for(var t=this,i=e.services,r=function(){var e=i[a];if(!e.isWhitelisted)return"continue";o.getChildren(e).then(function(i){var r=new n.MapServiceItem(e,i);i||(!0===r.supportsAddition&&(r.supportsAddition=!1),r.disabled=!0),t.serviceResults.addItem(r)})},o=this,a=0;a<i.length;a++)r()},i.prototype.getChildren=function(e){var t=this;return e.hasChildren?Promise.resolve(this.owner.getServiceDiscoveryProvider().expandService(e)).then(function(e){var t=[];return null==e?null:(e.children.length&&e.children.forEach(function(e){/\/[0-9]+$/.test(e.url)&&(e.serviceType.some(function(e){return/GroupLayer/.test(e)})?e.children.forEach(function(e){t.push(e)}):t.push(e))}),t)}).catch(function(e){return t.app.trace.error("Service Discovery - Error expanding map service: "+e.message),null}):Promise.resolve([])},i.prototype.realizeMapService=function(e){return Promise.resolve(this.owner.getServiceDiscoveryProvider().realizeMapService(e.originalItem,this.app.map.spatialReference.wkid.toString()))},i.prototype.reset=function(){this.serviceResults.clear(),this.disabled.set(!1)},i}(r.ViewModelBase);i.MapServicesDialogViewModel=a})},"Mapping/modules/LayerAddition/Dialogs/ServiceConnectionItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.services=t,this.setName(e)}return e.prototype.setName=function(e){this.name=e,this.displayName=e+" ("+(this.services||[]).length+")"},e}();t.ServiceConnectionItem=i})},"Mapping/modules/LayerAddition/Dialogs/ServiceConnectionsDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("LayerAddition_PerformSearch").register(r,r.show),r}return e(i,t),i.prototype.show=function(){this.loadState(),this.app.viewManager.activateView(this)},i.prototype.loadState=function(){var e=this.viewModel.getCurrentState().serviceConnections;this.viewModel.serviceConnectionsFragment.process(e)},i.prototype.saveState=function(e){this.viewModel.getCurrentState().selectedConnection=e},i.prototype.goNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.app.command("LayerAddition_ListMapServices").execute()},i.prototype.handleItemClick=function(e,t,i){this.saveState(i),this.goNext()},i}(r.WizardFragmentView);i.ServiceConnectionsDialogView=o})},"Mapping/modules/LayerAddition/Dialogs/ServiceConnectionsDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./ServiceConnectionItem"],function(t,i,r,o,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i,r){var n=t.call(this,i,r)||this;return n.disabled=new o.Observable(!1),n.serviceConnections=new o.ObservableCollection,n.owner=e,n}return e(i,t),i.prototype.reset=function(){this.serviceConnections.clear(),this.disabled.set(!1)},i.prototype.process=function(e){this.reset();for(var t=[],i=[],r=[],o=[],n=[],a=[],s=[],d=[],c=[],l=[],u=[],p=0,g=e;p<g.length;p++){var y=g[p];y.url,y.displayName;switch(y.discoveryProviderName){case"BingMapsDiscoveryProvider":this.findMapServices(y,t);break;case"VoyagerDiscoveryProvider":this.findMapServices(y,i);break;case"ArcGisOnlineDiscoveryProvider":this.findMapServices(y,r);break;case"ArcGisPortalDiscoveryProvider":this.findMapServices(y,o);break;case"GeoRssDiscoveryProvider":this.findMapServices(y,a);break;case"WmsDiscoveryProvider":this.findMapServices(y,s);break;case"WfsDiscoveryProvider":this.findMapServices(y,d);break;case"WmtsDiscoveryProvider":this.findMapServices(y,c);break;case"ArcGisServerDiscoveryProvider":this.findMapServices(y,l);break;case"WebTiledLayerDiscoveryProvider":this.findMapServices(y,n);break;default:this.findMapServices(y,u)}}this._addServiceConnection(t,this.getResource("language-layer-addition-bing-map-name")),this._addServiceConnection(i,this.getResource("language-layer-addition-voyager-search-name")),this._addServiceConnection(r,this.getResource("language-layer-addition-arcgis-online-name")),this._addServiceConnection(o,this.getResource("language-layer-addition-arcgis-portal-name")),this._addServiceConnection(c,this.getResource("language-layer-addition-wmts-name")),this._addServiceConnection(n,this.getResource("language-layer-addition-webtiled-name")),this._addServiceConnection(a,this.getResource("language-layer-addition-georss-name")),this._addServiceConnection(s,this.getResource("language-layer-addition-wms-name")),this._addServiceConnection(d,this.getResource("language-layer-addition-wfs-name")),this._addServiceConnection(l,this.getResource("language-layer-addition-arcgis-server-name")),this._addServiceConnection(u,this.getResource("language-layer-addition-general-name"))},i.prototype._addServiceConnection=function(e,t){if(e&&e.length>0){var i=new n.ServiceConnectionItem(t,e);this.serviceConnections.addItem(i)}},i.prototype.findMapServices=function(e,t){var i=this;e.serviceType.some(function(e){return/Catalog/.test(e)})||e.isContainerForRealResult?e.children.forEach(function(e){i.findMapServices(e,t)}):t.push(e)},i}(r.ViewModelBase);i.ServiceConnectionsDialogViewModel=a})},"Mapping/modules/LayerAddition/Dialogs/SubLayerItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.originalItem=e,this.displayName=e.displayName,this.url=e.url,this.setDescription(e.description),this.supportsAddition=!0}return e.prototype.setDescription=function(e){this.longDescription=e,this.description=this._trunc(e,100)},e.prototype._trunc=function(e,t){return e&&e.length>t?e.substr(0,t-1)+"...":e},e}();t.SubLayerItem=i})},"Mapping/modules/LayerAddition/Dialogs/SubLayersDialogView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","./../LayerAdditionViewModel"],function(t,i,r,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("LayerAddition_ExpandMapService").register(r,r.show),r}return e(i,t),i.prototype.show=function(){this.loadState(),this.app.viewManager.activateView(this)},i.prototype.loadState=function(){var e=this.viewModel.getCurrentState().selectedMapServiceItem,t=this.viewModel.subLayersFragment;t.reset(),t.process(e)},i.prototype.saveState=function(e){this.viewModel.getCurrentState().selectedSubLayerItem=e},i.prototype.goNext=function(e){this.finishWizard()},i.prototype.handleAddLayerClick=function(e,t,i){var r=this;this.saveState(i);var o=this.viewModel.subLayersFragment;this._confirmBeforeAdding(i).then(function(e){return o.realizeFeatureLayer(e)}).then(function(e){return r._verifyMapService(e)}).then(function(e){return r._addToMap(e)}).then(function(e){return r.viewModel.switchToLayerList(e,r.getResource("language-layer-addition-success")).return(e)}).then(function(e){return r._zoomToFullExtent(e)}).catch(function(e){return r.viewModel.handleError(e)}).finally(function(){return r.finishWizard()})},i.prototype._confirmBeforeAdding=function(e){var t=this;return this.viewModel.canSaveProject().then(function(i){return e.originalItem&&e.originalItem.isWhitelisted?Promise.resolve(e):new Promise(function(r,n){var a,s=t.getResource("language-layer-addition-confirm-add-layer");a=i?t.getResource("language-layer-addition-confirm-add-layer-message"):t.getResource("language-layer-addition-confirm-add-layer-message-anonymous"),t.app.command("Confirm").execute(a,s,function(t){if(t)return r(e);var i=new Error("Layer addition process was cancelled.");return i.name=o.ERROR_CANCELLED,n(i)})})})},i.prototype._addToMap=function(e){return this.app.command("AddMapService").execute(e),e},i.prototype._zoomToFullExtent=function(e){return this.viewModel.zoomToUserAddedLayers?this.viewModel.zoomTo(e).return(e):Promise.resolve(e)},i.prototype._verifyMapService=function(e){if(!e)throw new Error("Layer Addition: could not get metadata for service.");return e},i}(r.WizardFragmentView);i.SubLayersDialogView=n})},"Mapping/modules/LayerAddition/Dialogs/SubLayersDialogViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./SubLayerItem"],function(t,i,r,o,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i,r){var n=t.call(this,i,r)||this;return n.disabled=new o.Observable(!1),n.subLayers=new o.ObservableCollection,n.owner=e,n}return e(i,t),i.prototype.reset=function(){this.subLayers.clear(),this.disabled.set(!1)},i.prototype.process=function(e){var t=e.layers;if(t)for(var i=0;i<t.length;i++){var r=t[i],o=new n.SubLayerItem(r);this.subLayers.addItem(o)}},i.prototype.realizeFeatureLayer=function(e){return Promise.resolve(this.owner.getServiceDiscoveryProvider().realizeMapService(e.originalItem,this.app.map.spatialReference.wkid.toString()))},i}(r.ViewModelBase);i.SubLayersDialogViewModel=a})},"url:/Mapping/modules/LayerAddition/Dialogs/AddLayerDialogView.html":t,"url:/Mapping/modules/LayerAddition/Dialogs/MapServicesDialogView.html":i,"url:/Mapping/modules/LayerAddition/Dialogs/ServiceConnectionsDialogView.html":r,"url:/Mapping/modules/LayerAddition/Dialogs/SubLayersDialogView.html":o,"url:/Mapping/modules/LayerAddition/LayerPropertiesView.html":n}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LayerAddition/CSS/common.css","css","LyotLS1MYXllciBBZGRpdGlvbjogQ29tbW9uLS0tKi8NCi5sYXllci1hZGRpdGlvbiAuZm9ybS1idG5zLA0KLmxheWVyLWFkZGl0aW9uLmFkZC1sYXllci1kaWFsb2cgew0KICAgIHBhZGRpbmc6IDFlbTsNCn0NCi5sYXllci1hZGRpdGlvbi5hZGQtbGF5ZXItZGlhbG9nIC5mb3JtLWJ0bnMgew0KICAgIHBhZGRpbmc6IDA7DQp9DQoubGF5ZXItYWRkaXRpb24tcHJvcGVydGllcyB7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCn0NCi5sYXllci1hZGRpdGlvbi1wcm9wZXJ0aWVzLXNlbGVjdG9yew0KICAgIG1hcmdpbi1ib3R0b206IDJlbTsgDQp9DQoubGF5ZXItYWRkaXRpb24tcHJvcGVydGllcy1pdGVtLWN0cmwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KfQ0KLmxheWVyLWFkZGl0aW9uLXByb3BlcnRpZXMtaXRlbS1jdHJsIGlucHV0W3R5cGU9ImNoZWNrYm94Il0sDQoubGF5ZXItYWRkaXRpb24taXRlbS1jdHJsIGlucHV0W3R5cGU9InJhZGlvIl0gew0KICAgIG1hcmdpbjogMC4yNWVtICAwLjM3NWVtIDBlbSAwLjM3NWVtOw0KfQ0KLmxheWVyLWFkZGl0aW9uLXByb3BlcnRpZXMtc2VsZWN0b3IgLnJhZGlvLWNvbnRhaW5lciB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCn0NCg0KLmxheWVyLWFkZGl0aW9uIC5nY3gtbGlzdC1kZXNjIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgbWFyZ2luLXRvcDogMC41ZW07DQp9DQoNCi8qLS0tTGF5ZXIgQWRkaXRpb246IEFkZCBMYXllciBEaWFsb2ctLS0qLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerAddition/Dialogs/AddLayerDialogView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerAddition/Dialogs/MapServicesDialogView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerAddition/Dialogs/ServiceConnectionsDialogView.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerAddition/Dialogs/SubLayersDialogView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerAddition/LayerPropertiesView.html","html",n)}),require({cache:{}}),define(["Mapping/modules/LayerAddition/LayerAdditionModule","Mapping/modules/LayerAddition/LayerAdditionViewModel","Mapping/modules/LayerAddition/LayerPropertiesView","Mapping/modules/LayerAddition/LayerPropertiesViewModel","Mapping/modules/LayerAddition/Dialogs/AddLayerDialogView","Mapping/modules/LayerAddition/Dialogs/AddLayerDialogViewModel","Mapping/modules/LayerAddition/Dialogs/MapServiceItem","Mapping/modules/LayerAddition/Dialogs/MapServicesDialogView","Mapping/modules/LayerAddition/Dialogs/MapServicesDialogViewModel","Mapping/modules/LayerAddition/Dialogs/ServiceConnectionItem","Mapping/modules/LayerAddition/Dialogs/ServiceConnectionsDialogView","Mapping/modules/LayerAddition/Dialogs/ServiceConnectionsDialogViewModel","Mapping/modules/LayerAddition/Dialogs/SubLayerItem","Mapping/modules/LayerAddition/Dialogs/SubLayersDialogView","Mapping/modules/LayerAddition/Dialogs/SubLayersDialogViewModel"],function(t,i,r,o,n,a,s,d,c,l,u,p,g,y,v){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.LayerAddition",t.LayerAddition),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.LayerAdditionViewModel",i.LayerAdditionViewModel),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.LayerPropertiesView",r.LayerPropertiesView),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.LayerPropertiesViewModel",o.LayerPropertiesViewModel),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.AddLayerDialogView",n.AddLayerDialogView),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.AddLayerDialogViewModel",a.AddLayerDialogViewModel),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.MapServiceItem",s.MapServiceItem),e(d,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.MapServicesDialogView",d.MapServicesDialogView),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.MapServicesDialogViewModel",c.MapServicesDialogViewModel),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.ServiceConnectionItem",l.ServiceConnectionItem),e(u,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.ServiceConnectionsDialogView",u.ServiceConnectionsDialogView),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.ServiceConnectionsDialogViewModel",p.ServiceConnectionsDialogViewModel),e(g,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.SubLayerItem",g.SubLayerItem),e(y,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.SubLayersDialogView",y.SubLayersDialogView),e(v,"geocortex.essentialsHtmlViewer.mapping.modules.layerAddition.SubLayersDialogViewModel",v.SubLayersDialogViewModel)})}();