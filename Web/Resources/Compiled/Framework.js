/*
	
	Copyright (c) 2015, Latitude Geographics Group Ltd.
	All rights reserved.
	       
	Redistribution is not permitted. 
	
	Use in binary form, without modification, is permitted provided that neither 
	the name of the organization nor the names of its contributors may be used 
	to endorse or promote products derived from this software without specific 
	prior written permission.
	       
	THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDER ''AS IS'' AND ANY
	EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
	WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
	DISCLAIMED. IN NO EVENT SHALL LATITUDE GEOGRAPHICS GROUP LTD. BE LIABLE FOR ANY
	DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
	LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
	ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

var geocortex;
(function(b){(function(c){(function(c){var b=function(){function f(a,d,g,e){this.app=a;this.name=d;this.event=e;this.commands=g||[];this._wireUpEvent()}f.prototype.run=function(a){this._executeCommands(a)};f.prototype._wireUpEvent=function(){var a=this;if(this.event)this.eventToken=this.app.event(this.event).subscribe(this,function(d){a._executeCommands(d)})};f.prototype._executeCommands=function(a){for(var d=0;this.commands&&d<this.commands.length;d++)this.app.command(this.commands[d]).execute(a)};f.prototype.destroy=
function(){this.event&&this.app.event(this.event).unsubscribe(this.eventToken);this.commands=null};return f}();c.Behavior=b})(c.behaviors||(c.behaviors={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(b){var h=function(){function f(a){this.behaviors={};this.dummyBehavior=new b.Behavior(null,null,null);this.app=a}f.prototype.loadBehaviorsFromConfig=function(a,d){var g=[];if(!(a instanceof c.application.ModuleBase))return this.app.trace.warning("Attempted to add behaviors to registry outside of ModuleBase. Behaviors from "+a.id+" not added."),g;if(d&&d.behaviors)for(var e=0;e<d.behaviors.length;e++){var j=d.behaviors[e];g.push(j.name);this.addBehavior(j.name,j.commands,
j.event)}return g};f.prototype.addBehavior=function(a,d,g){d?(this.behaviors[a]&&this.app.trace.warning("Behavior "+a+" is already present in registry."),a||this.app.trace.warning("Attempted to add a nameless Behavior to the registry."),d=new b.Behavior(this.app,a,d,g),this.behaviors[a]=d):this.app.trace.debug("Behavior "+a+" does not possess an array of command IDs. Not added to registry.")};f.prototype.remove=function(a){if(!this.behaviors[a])return this.app.trace.debug("Attempted to remove behavior not in found in registry."),
false;var d=this.behaviors[a];delete this.behaviors[a];d.destroy();return true};f.prototype.behavior=function(a){var d=null;this.behaviors[a]!==void 0?d=this.behaviors[a]:(d=this.dummyBehavior,this.app.trace.debug("Could not find Behavior named "+a+" in the Behavior Registry."));return d};return f}();b.BehaviorRegistry=h})(c.behaviors||(c.behaviors={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){var b=function(){function c(f,a){this.dojoConnects=[];this.observableBindings=[];this.eventSubscriptions=[];this.commandHandlers=[];this.app=f;this.libraryId=a}c.prototype.auto=function(f,a,d){if(arguments.length===3&&typeof a==="string")this.dojoConnects.push(dojo.connect(f,a,d));else if(arguments.length===2&&a instanceof Function){var g=f.bind(f,a);this.observableBindings.push({obj:f,token:g})}else arguments.length===3&&d instanceof Function&&(g=f.bind(a,d),this.observableBindings.push({obj:f,
token:g}))};c.prototype.trackSubscription=function(f,a){this.eventSubscriptions.push({event:f,token:a})};c.prototype.trackCommandHandler=function(f,a){this.commandHandlers.push({command:f,token:a})};c.prototype.onDestroy=function(){};c.prototype.destroy=function(){for(var f=0;f<this.dojoConnects.length;++f)dojo.disconnect(this.dojoConnects[f]);this.dojoConnects=[];for(f=0;f<this.observableBindings.length;++f){var a=this.observableBindings[f].token;this.observableBindings[f].obj.unbind(a)}this.observableBindings=
[];for(f=0;f<this.eventSubscriptions.length;++f){var d=this.eventSubscriptions[f].event,a=this.eventSubscriptions[f].token;d.unsubscribe(a)}this.eventSubscriptions=[];for(f=0;f<this.commandHandlers.length;++f)d=this.commandHandlers[f].command,a=this.commandHandlers[f].token,d.unregister(a);this.commandHandlers=[];this.onDestroy()};c.prototype.getResource=function(f,a){return this.app.getResource(this.libraryId,f,a)};return c}();c.FrameworkObject=b})(b.framework||(b.framework={}))})(geocortex||(geocortex=
{}));(function(b){(function(c){(function(c){var b=function(){return function(){this.sender=null;this.type="append";this.rangeEnd=this.rangeStart=0}}();c.CollectionChangedArgs=b})(c.events||(c.events={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
if(!String.prototype.format){var dateFormats="d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|:|\\/",uberDateRegexPattern="("+dateFormats+"|[^"+dateFormats+"])",uberDateRegex=RegExp(uberDateRegexPattern,"g"),openBraceTempToken="\x00MAGIC\x00";String.prototype.format=function(){var b=arguments,c=this.replace(/{{/g,openBraceTempToken),c=c.replace(/{(\d+)(?::([^}]*))?}/g,function(c,h,f){c=b[h];if(!f||!(c instanceof Date))return c;for(var f=f.match(uberDateRegex),
h=[],a=0;a<f.length;a++){var d=f[a],g=geocortex.framework.utils.DateFormatters[d];g&&(d=g.call(this,c));h.push(d)}return h.join("")});return c.replace(RegExp(openBraceTempToken,"g"),"{").replace(/}}/g,"}")}}String.format=function(b){for(var c=[],i=1;i<arguments.length;i++)c[i-1]=arguments[i];return b.format.apply(b,c)};String.quickHashCode=function(b){var c=0,i,h;if(b.length==0)return c;for(i=0;i<b.length;i++)h=b.charCodeAt(i),c=(c<<5)-c+h,c&=c;return c};
String.escapeHtml=function(b){return b===null||b===void 0?b:b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};String.unescapeHtml=function(b){return b===null||b===void 0?b:b.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")};String.escapeHtmlEncode=function(b){var c=document.createElement("div");c.appendChild(document.createTextNode(b));return c.innerHTML};
String.isNullOrEmpty=function(b){return typeof b==="undefined"||b===null||b.length===0};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.startsWith=function(b,c){c=c||0;return this.indexOf(b,c)===c};String.prototype.endsWith=function(b,c){c=c||this.length;c-=b.length;var i=this.lastIndexOf(b);return i!==-1&&i===c};
(function(b){(function(c){(function(c){function b(a){return typeof a==="undefined"?false:true}function f(a){return a===null||!b(a)}c.base64keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.isDefined=b;c.isNullOrUndefined=f;c.makeUrlAbsolute=function(a){if(a.indexOf("http")===0)return a;var d="{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if(d.charAt(d.length-1)!="/"||d.charAt(d.length-1)!="\\")d=d.split("/"),--d.length,d=d.join("/"),
d+="/";return a=a.charAt(0)==="/"||a.charAt(0)==="\\"?window.location.protocol+"//"+window.location.host+"/"+a.substring(1):d+a};c.alphaNumericToken=function(a){for(var a=a||8,d="",g=0;g<a;g++){var e=Math.floor(Math.random()*61);d+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(e,e+1)}return d};c.base64Encode=function(a){for(var d="",g,e,j,c,f,b,i=0,a=this.utf8Encode(a);i<a.length;)g=a.charCodeAt(i++),e=a.charCodeAt(i++),j=a.charCodeAt(i++),c=g>>2,g=(g&3)<<4|e>>4,f=(e&15)<<
2|j>>6,b=j&63,isNaN(e)?f=b=64:isNaN(j)&&(b=64),d=d+this.base64keyStr.charAt(c)+this.base64keyStr.charAt(g)+this.base64keyStr.charAt(f)+this.base64keyStr.charAt(b);return d};c.base64Decode=function(a){var d="";if(!a||a==="")return d;var g,e,j,c,f,b=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(a))throw Error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do g=this.base64keyStr.indexOf(a.charAt(b++)),
e=this.base64keyStr.indexOf(a.charAt(b++)),c=this.base64keyStr.indexOf(a.charAt(b++)),f=this.base64keyStr.indexOf(a.charAt(b++)),g=g<<2|e>>4,e=(e&15)<<4|c>>2,j=(c&3)<<6|f,d+=String.fromCharCode(g),c!=64&&(d+=String.fromCharCode(e)),f!=64&&(d+=String.fromCharCode(j));while(b<a.length);return d=this.utf8Decode(d)};c.utf8Encode=function(a){for(var a=a.replace(/\r\n/g,"\n"),d="",g=0;g<a.length;g++){var e=a.charCodeAt(g);e<128?d+=String.fromCharCode(e):(e>127&&e<2048?d+=String.fromCharCode(e>>6|192):(d+=
String.fromCharCode(e>>12|224),d+=String.fromCharCode(e>>6&63|128)),d+=String.fromCharCode(e&63|128))}return d};c.utf8Decode=function(a){for(var d="",g=0,e=0,j=0,c=0;g<a.length;)e=a.charCodeAt(g),e<128?(d+=String.fromCharCode(e),g++):e>191&&e<224?(j=a.charCodeAt(g+1),d+=String.fromCharCode((e&31)<<6|j&63),g+=2):(j=a.charCodeAt(g+1),c=a.charCodeAt(g+2),d+=String.fromCharCode((e&15)<<12|(j&63)<<6|c&63),g+=3);return d};c.isUrl=function(a){if(!a||typeof a!=="string")return false;a=a.trim().toLowerCase();
return a.length>=7&&a.indexOf("http://")===0?true:a.length>=8&&a.indexOf("https://")===0?true:false};c.isPercentage=function(a){return f(a)?false:/^(\d+|\d*[.]\d+)%$/.test(a)};c.clamp=function(a,d,g){if(a<d)return d;else if(a>g)return g;return a};c.addEventListener=function(a,d,g){a.addEventListener?a.addEventListener(d,g,false):a.attachEvent&&a.attachEvent("on"+d,g)}})(c.utils||(c.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(c){var h=function(){return function(a,d){this.handler=a;this.scope=d;this.once=false}}(),f=function(){function a(d,g){this.app=null;this.isPublishing=false;this.subscriptions={};this.name=d;this.app=g}a.prototype.getSubscriptionHandlerByToken=function(d){return this.subscriptions.hasOwnProperty(d)?this.subscriptions[d].handler:null};a.prototype.subscribe=function(d,g){if(g===null||g===void 0)throw Error("Event handler cannot be null or undefined");var a;do a=b.framework.utils.alphaNumericToken();
while(this.getSubscriptionHandlerByToken[a]);var j=new h(g,d);this.subscriptions[a]=j;d&&d instanceof b.framework.FrameworkObject&&d.trackSubscription(this,a);return a};a.prototype.once=function(d,g){var a=this.subscribe(d,g);this.subscriptions[a].once=true;return a};a.prototype.unsubscribe=function(d){if(!this.subscriptions.hasOwnProperty(d))return false;delete this.subscriptions[d];return true};a.prototype.clear=function(){this.subscriptions={}};a.prototype.publish=function(){for(var d=0;d<arguments.length;d++);
this.app&&this.app.debugMode&&(d="Event '{0}' published.".format(this.name),console.debug?console.debug(d):console.log(d));this.isPublishing=true;for(var g in this.subscriptions)this.subscriptions.hasOwnProperty(g)&&(d=this.subscriptions[g],d.handler.apply(d.scope,arguments),d.once&&delete this.subscriptions[g]);this.isPublishing=false};return a}();c.Event=f})(c.events||(c.events={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
var Observable=function(){function b(c){this.bindingEvent=new geocortex.framework.events.Event("__anonymous");this._syncSource=this._syncToken=null;this.value=c}b.prototype.set=function(c){this.value=c;this.bindingEvent.publish(c)};b.prototype.get=function(){return this.value};b.prototype.equals=function(c){var b=c;c&&c.get&&typeof c.get==="function"&&(b=c.get());if(this.value instanceof Array&&b instanceof Array){if(this.value.length!==b.length)return false;for(;0<this.value.length;)return this.value[0]!==
b[0]?false:true}return this.get()===b};b.makeBindableProxy=function(c){if(!c)return null;var i=[];if(c.___clonedObject)return c.___clonedObject;var h=function(){throw Error("Can't make method calls on a bindable proxy.");},f=function(d,g,a){for(var j=0;j<i.length;++j)if(g===i[j])return i[j];i.push(g);if(!g||typeof g==="string"||typeof g==="number"||typeof g==="boolean"){var c=new b(g);(function(){c.set=function(g){a[d]=g;c.value=g;c.bindingEvent.publish(g)};c.get=function(){return a[d]}})();return c}else if(g instanceof
Array){for(var t=new ObservableCollection,j=0;j<g.length;++j){var m={},m=f(j,g[j],g);t.addItem(m)}return t}else if(g instanceof Object){if(g.isObservable)return g;m={};for(t in g)g.hasOwnProperty(t)&&(m[t]=f(t,g[t],g));return m}else return g instanceof Function?h:g},a=f("root",{root:c},c);c.___clonedObject=a.root;return c instanceof Array?a.root:new b(a.root)};b.prototype.bind=function(c,b){return this.bindingEvent.subscribe(c,b)};b.prototype.unbind=function(c){return this.bindingEvent.unsubscribe(c)};
b.prototype.once=function(c,b){var h=this,f=this.bind(c,function(){h.unbind(f);b.apply(c,arguments)});return f};b.prototype.sync=function(c){this.removeSync();if(c)this.set(c.get()),this._syncSource=c,this._syncToken=c.bindingEvent.subscribe(this,function(c){this.set(c)})};b.prototype.removeSync=function(){if(this._syncToken&&this._syncSource)this._syncSource.unbind(this._syncToken),this._syncSource=this._syncToken=null};b.prototype.syncTransform=function(c,b){if(this._syncToken&&this._syncSource)this._syncSource.unbind(this._syncToken),
this._syncSource=this._syncToken=null;if(c)this.set(b(c.get())),this._syncSource=c,this._syncToken=c.bindingEvent.subscribe(this,function(c){this.set(b(c))})};b.prototype.pulse=function(){this.set(this.get())};return b}();Observable.prototype.isObservable=true;
var ObservableCollection=function(){function b(c){this.bindingEvent=new geocortex.framework.events.Event("__anonymous");this.useThrottling=false;this._syncSource=this.throttledOperations=null;this.value=c||[]}b.prototype.isEmpty=function(){return this.value.length===0};b.prototype.length=function(){return this.value.length};b.prototype.contains=function(c){return Array.contains(this.value,c)};b.prototype.getAt=function(c){return this.value[c]};b.prototype.getRange=function(c,b){return b===void 0?
this.value.slice(c):this.value.slice(c,b+1)};b.prototype.indexOf=function(c){return this.value.indexOf(c)};b.prototype.get=function(){return this.value};b.prototype.getItems=function(){return this.value};b.prototype.getLength=function(){return this.value.length};b.prototype.addItems=function(c){if(c&&!(c.length<1)){var b=new geocortex.framework.events.CollectionChangedArgs;b.type="append";b.rangeStart=this.value.length;this.value=this.value.concat(c);b.rangeEnd=b.rangeStart+c.length-1;b.sender=this;
this.bindingEvent.publish(b)}};b.prototype.addItem=function(c){var b=new geocortex.framework.events.CollectionChangedArgs;b.type="append";b.rangeStart=this.value.length;b.rangeEnd=this.value.length;this.value.push(c);b.sender=this;this.bindingEvent.publish(b)};b.prototype.insertItems=function(c,b){if(b.length!=0)if(c>=this.value.length)this.addItems(b);else{var h=new geocortex.framework.events.CollectionChangedArgs;h.type="insert";h.rangeStart=c;h.rangeEnd=c+b.length-1;h.sender=this;for(var f=0;f<
b.length;++f)this.value.splice(c+f,0,b[f]);this.bindingEvent.publish(h)}};b.prototype.insertItem=function(c,b){if(c>=this.value.length)this.addItem(b);else{var h=new geocortex.framework.events.CollectionChangedArgs;h.type="insert";h.rangeStart=c;h.rangeEnd=c;h.sender=this;this.value.splice(c,0,b);this.bindingEvent.publish(h)}};b.prototype.removeItem=function(c){for(var b;(b=Array.pos(this.value,c))>-1;){var h=new geocortex.framework.events.CollectionChangedArgs;h.type="remove";h.rangeStart=b;h.rangeEnd=
b;h.sender=this;this.bindingEvent.publish(h);Array.remove(this.value,b,b)}};b.prototype.removeAt=function(c){if(0<=c&&c<this.getLength()){var b=new geocortex.framework.events.CollectionChangedArgs;b.type="remove";b.rangeStart=c;b.rangeEnd=c;b.sender=this;this.bindingEvent.publish(b);Array.remove(this.value,c,c)}};b.prototype.removeRange=function(c,b){if(!b&&b!==0)b=this.value.length;var h=new geocortex.framework.events.CollectionChangedArgs;h.type="remove";h.rangeStart=c;h.rangeEnd=Math.min(b,this.value.length);
h.sender=this;this.bindingEvent.publish(h);Array.remove(this.value,c,b)};b.prototype.removeWhere=function(c){if(c)for(var b=this.value.length-1;b>=0;b--)if(c(this.value[b])){var h=new geocortex.framework.events.CollectionChangedArgs;h.type="remove";h.rangeStart=b;h.rangeEnd=b;h.sender=this;this.bindingEvent.publish(h);Array.remove(this.value,b,b)}};b.prototype.clear=function(){if(this.value&&this.value.length!=0){var c=new geocortex.framework.events.CollectionChangedArgs;c.type="clear";c.rangeStart=
0;c.rangeEnd=this.value.length-1;c.sender=this;this.bindingEvent.publish(c);this.value.length=0}};b.prototype.set=function(c){this.clear();c&&this.addItems(c)};b.prototype.pulse=function(){var c=new geocortex.framework.events.CollectionChangedArgs;c.type="clear";c.rangeStart=0;c.rangeEnd=this.value.length-1;c.sender=this;this.bindingEvent.publish(c);c=new geocortex.framework.events.CollectionChangedArgs;c.type="append";c.rangeStart=0;c.rangeEnd=this.value.length-1;c.sender=this;this.bindingEvent.publish(c)};
b.prototype.bind=function(c,b){return this.bindingEvent.subscribe(c,b)};b.prototype.unbind=function(c){return this.bindingEvent.unsubscribe(c)};b.prototype.once=function(c,b){var h=this,f=h.bind(c,function(){h.unbind(f);b.apply(c,arguments)});return f};b.prototype.sync=function(b){if(b.value&&b.bindingEvent)this.clear(),this.value=b.value,b.bindingEvent.subscribe(this,function(i){this.value=b.value;var h=new geocortex.framework.events.CollectionChangedArgs;dojo.mixin(h,i);h.sender=this;this.bindingEvent.publish(h);
if(i.type==="clear")this.value=[]})};b.prototype.equals=function(b){var i=b;b&&b.isObservableCollection&&(i=b.get());if(!i.hasOwnProperty("length"))throw Error("Type mismatch");if(this.get().length!==i.length)return false;for(b=0;b<this.get().length;b++)if(this.value[b]!==i[b])return false;return true};return b}();ObservableCollection.prototype.isObservable=true;ObservableCollection.prototype.isObservableCollection=true;
(function(b){(function(b){(function(b){(function(c){c.firstOrDefault=function(b,a){var d=b?b.length:0;if((a===null||typeof a==="undefined")&&d>0)return b[0];for(var g=0;g<d;g++){var e=b[g];if(a(e,g))return e}return null};c.orderBy=function(c,a){return c?c.slice().sort(function(d,g){var e=a(d),j=a(g);return e instanceof b.Tuple?b.Tuple.compare(e,j):e===j?0:e>j?1:-1}):[]};c.orderByDescending=function(c,a){return c?c.slice().sort(function(d,g){var e=a(d),j=a(g);return e instanceof b.Tuple?b.Tuple.compare(j,
e):j===e?0:j>e?1:-1}):[]};c.groupBy=function(b,a){var d={},g=[];if(b&&a){for(var e=0;e<b.length;e++){var j=b[e],c=a(j),t=JSON.stringify(c);d.hasOwnProperty(t)?d[t].items.push(j):d[t]={key:c,items:[j]}}for(var h in d)d.hasOwnProperty(h)&&g.push(d[h])}return g};c.distinct=function(b){return b?b.filter(function(a,d,g){return a!=null&&g.indexOf(a)===d}):[]};c.remove=function(b,a,d){d=b.slice((d||a)+1||b.length);b.length=a<0?b.length+a:a;return b.push.apply(b,d)};c.removeItem=function(b,a){var d=c.pos(b,
a);return d==-1?null:c.remove(b,d,d)};c.contains=function(b,a){for(var d=b.length;d--;)if(b[d]===a)return true;return false};c.pos=function(b,a){for(var d=b.length;d--;)if(b[d]===a)return d;return-1};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b){if(this==null)throw new TypeError;var a=Object(this),d=a.length>>>0;if(d===0)return-1;var g=0;arguments.length>1&&(g=Number(arguments[1]),g!=g?g=0:g!=0&&g!=Infinity&&g!=-Infinity&&(g=+(g>0||-1)*Math.floor(Math.abs(g))));if(g>=d)return-1;
for(g=g>=0?g:Math.max(d-Math.abs(g),0);g<d;g++)if(g in a&&a[g]===b)return g;return-1};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(b){if(this==null)throw new TypeError;var a=Object(this),d=a.length>>>0;if(d===0)return-1;var g=d;arguments.length>1&&(g=Number(arguments[1]),g!=g?g=0:g!=0&&g!=1/0&&g!=-(1/0)&&(g=+(g>0||-1)*Math.floor(Math.abs(g))));for(d=g>=0?Math.min(g,d-1):d-Math.abs(g);d>=0;d--)if(d in a&&a[d]===b)return d;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=
function(b,a){var d,g;if(this==null)throw new TypeError("this is null or not defined");var e=Object(this),j=e.length>>>0;if({}.toString.call(b)!=="[object Function]")throw new TypeError(b+" is not a function");a&&(d=a);for(g=0;g<j;){var c;Object.prototype.hasOwnProperty.call(e,g)&&(c=e[g],b.call(d,c,g,e));g++}};if(!Array.prototype.every)Array.prototype.every=function(b,a){if(this==null)throw new TypeError;var d=Object(this),g=d.length>>>0;if(typeof b!="function")throw new TypeError;for(var e=0;e<
g;e++)if(e in d&&!b.call(a,d[e],e,d))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(b,a){if(this==null)throw new TypeError;var d=Object(this),g=d.length>>>0;if(typeof b!="function")throw new TypeError;for(var e=0;e<g;e++)if(e in d&&b.call(a,d[e],e,d))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=function(b,a){if(this==null)throw new TypeError;var d=Object(this),g=d.length>>>0;if(typeof b!="function")throw new TypeError;for(var e=[],j=
0;j<g;j++)if(j in d){var c=d[j];b.call(a,c,j,d)&&e.push(c)}return e};if(!Array.prototype.map)Array.prototype.map=function(b,a){var d,g,e;if(this==null)throw new TypeError(" this is null or not defined");var j=Object(this),c=j.length>>>0;if(typeof b!=="function")throw new TypeError(b+" is not a function");a&&(d=a);g=Array(c);for(e=0;e<c;){var t;e in j&&(t=j[e],t=b.call(d,t,e,j),g[e]=t);e++}return g}})(b.ArrayUtils||(b.ArrayUtils={}))})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||
(geocortex={}));Array.remove=geocortex.framework.utils.ArrayUtils.remove;Array.removeItem=geocortex.framework.utils.ArrayUtils.removeItem;Array.contains=geocortex.framework.utils.ArrayUtils.contains;Array.pos=geocortex.framework.utils.ArrayUtils.pos;
(function(b){(function(b){(function(b){var c=function(){function b(a,d,g){this.period=100;this.isActive=false;this._setTimeoutToken=null;this.period=a==void 0?0:a;this.action=d;this.cancelAction=g;var e=this;this._setTimeoutToken=setTimeout(function(){e.execute(e)},this.period)}b.prototype.cancel=function(){if(this._setTimeoutToken)clearTimeout(this._setTimeoutToken),this._setTimeoutToken=null,this.isActive=false,this.cancelAction&&this.cancelAction()};b.prototype.execute=function(a){a.isActive=true;
var d=a.action();a._setTimeoutToken!==null&&d?a._setTimeoutToken=setTimeout(function(){a.execute(a)},a.period):(a._setTimeoutToken=null,a.isActive=false)};return b}();b.ThrottledOperation=c})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=/^on/,f=function(){function a(){this.domElement=null;this.type="attr";this.target=this.attributeName=null;this.invert=false;this._dojoDomEvents=[];this.targetBindings=[];this.templateKey=this.templateMode=null;this.templateSelections={};this.parentView=null;this.boundViews=[];this.viewModel=null}a.prototype.on=function(d,g){var a=this;if(d&&g){if(!this.domElement)throw Error("Cannot bind before domElement is set.");c.test(d)&&(d=d.substring(2));require(["dojo/on"],
function(b){b=b(a.domElement,d,g);a._dojoDomEvents.push(b)})}};a.prototype.destroy=function(){if(this.templateSelections)for(var d in this.templateSelections)if(this.templateSelections.hasOwnProperty(d)){var g=this.templateSelections[d];g&&g.___domParent&&dojo.place(g,g.___domParent,"last")}this.viewModel=this.parentView=this.target=this.domElement=null;for(d=0;d<this._dojoDomEvents.length;++d)this._dojoDomEvents[d].remove();for(d=this._dojoDomEvents.length=0;d<this.targetBindings.length;++d)this.targetBindings[d].event.unsubscribe(this.targetBindings[d].token);
this.targetBindings=[];for(d=0;d<this.boundViews.length;++d)this.boundViews[d].destroyBindings();this.boundViews=[]};return a}();b.BindingExpression=f})(b.ui||(b.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(){this.parent=this.domElement=null;this.children=[];this.expressions=[];this.context=null;this.contextChange=false;this.context=this.parent=this.domElement=null}b.prototype.destroy=function(){this.context=this.parent=this.domElement=null;this.contextChange=false;for(var a=0;a<this.expressions.length;++a)this.expressions[a].destroy();this.expressions=[];for(a=0;a<this.children.length;++a)this.children[a].destroy();this.children=[]};
return b}();b.BindingNode=c})(b.ui||(b.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));var __extends=this.__extends||function(b,c){function i(){this.constructor=b}for(var h in c)c.hasOwnProperty(h)&&(b[h]=c[h]);i.prototype=c.prototype;b.prototype=new i};
(function(b){(function(c){(function(i){var h=function(f){function a(d,g){f.call(this,d,g);this.isManaged=this.isActive=false;this.isBusy=new Observable(false);this.title=new Observable("");this.description=new Observable("");this.iconUri=new Observable("");this.viewModel=this.markupResource=null;this.typeName=this.regionName="";this.parentView=this.bindingTree=this.root=null;this.childRegions=[];this.bound=false;this.disposableBindings=[];this.bindingSetupDelegates=[];this.id="View-"+b.framework.utils.alphaNumericToken()}
__extends(a,f);a.prototype.addDisposableBinding=function(d,g){this.disposableBindings.push({event:d.bindingEvent,token:g})};a.prototype.attach=function(d){if(!this.bound&&(this.viewModel=d,this.root))this.bindingTree=this.buildTree(),this.viewModel!==null&&this.viewModel!==void 0&&this.pulseAll(),this.bound=true};a.prototype.activated=function(){};a.prototype.deactivated=function(){};a.prototype.added=function(){if(!this.bound&&this.viewModel)this.bindingTree=this.buildTree(),this.bound=true,this.pulseAll()};
a.prototype.removed=function(){this.destroyBindings()};a.prototype.destroy=function(){this.destroyBindings();f.prototype.destroy.call(this)};a.prototype.destroyBindings=function(){this.isActive&&this.app.viewManager.deactivateView(this);if(this.bindingTree){this.bindingTree.destroy();for(var d=0;d<this.disposableBindings.length;++d){var g=this.disposableBindings[d];g.event.unsubscribe(g.token)}this.bound=false;this.disposableBindings=[];this.bindingSetupDelegates=[]}};a.prototype.pulseAll=function(){for(var d=
0;d<this.bindingSetupDelegates.length;++d)try{this.bindingSetupDelegates[d]()}catch(g){this.app.trace.error("Error performing initial data-bind in view '{0}' with view model '{1}': {2}".format(this.id,this.viewModel.id,g.message),g)}this.bindingSetupDelegates=[]};a.prototype.resolveWidget=function(){return null};a.prototype.buildTree=function(){function d(a,e){function f(d){var g=[];if(!d)return g;var a=d.match(/\{(.*?)\}/g);if(!a)if(this.app)return this.app.trace.warning("Invalid data-binding expression '{0}'.".format(d)),
[];else throw Error("Invalid data-binding expression '{0}'.".format(d));for(d=0;d<a.length;++d){var e=a[d].split(":");e.length==2&&g.push({directive:e[0].replace("{","").trim(),target:e[1].replace("}","").trim()})}return g}if(e&&e.children)for(var h=0;h<e.children.length;++h){var i=e.children[h],k=dojo.attr(i,"data-region-name"),n=dojo.attr(i,"data-binding");n||(n=i.___dataBindingExpressions);if(n){var p=f(n);i.___dataBindingExpressions=n;g.app.debugMode||dojo.removeAttr(i,"data-binding");if(p&&p.length!==
0){for(var r=false,v=0;v<p.length;++v)(function(){var d=a.expressions,e=a.context,s=false,h=p[v],m=h.directive,q=h.target,o=new b.framework.ui.BindingExpression;o.domElement=i;o.target=q;g.viewModel!=null?o.viewModel=g.viewModel:(o.viewModel={},o.viewModel.id="[None]");o.parentView=g.parentView?g.parentView:g;if(m.startsWith("@"))if(q=m.split("-")[1],m.startsWith("@event-"))q?(o.type="event",o.attributeName=q):(this.app.trace.warning("Binding error: Invalid event binding expression '{0}' in view '{1}'.".format(m,
g.id)),s=true);else if(m.startsWith("@var"))o.type="var";else if(m.startsWith("@text"))o.attributeName="innerHTML",o.type="text";else if(m.startsWith("@attach"))o.attributeName="___attachedValue",o.type="attachment";else if(m.startsWith("@style-"))h=m.indexOf("-"),(h=m.substring(h+1))?(o.type="style",o.attributeName=h):(this.app.trace.warning("Binding error: Invalid style binding expression '{0}' in view '{1}'.".format(m,g.id)),s=true);else if(m.startsWith("@dom"))o.type="dom",o.attributeName=q;else if(m.startsWith("@value"))o.type=
"value",o.attributeName=q;else if(m.startsWith("@widget"))o.type=m.substring(1),o.attributeName=q,o.otherExpressions=p;else if(m.startsWith("@class")||m.startsWith("@noclass")){o.type="class";if(m.startsWith("@noclass"))o.invert=true;h=m.indexOf("-");(h=m.substring(h+1))?o.attributeName=h:(this.app.trace.warning("Binding error: Invalid class binding expression '{0}' in view '{1}'.".format(m,g.id)),s=true)}else if(m==="@source"){o.type="source";o.attributeName="@source";r=true;o.templateMode="single-inline";
for(q=0;q<p.length;++q)if(m=p[q],m!==h){var n=m.directive,m=m.target;if(n==="@template"){o.templateMode="single-external";h=new c.config.ViewConfig(null,null,null);h.markupResource=m;h.libraryId=g.libraryId;var k=g.app.viewManager.createView(h);if(!k){g.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(m,this.id));break}k.app=g.app;o.templateSelections={"@default":k.root};break}else if(n==="@template-selector"){o.templateMode="inline-selected";o.templateKey=m;
o.templateSelections={};break}}if(o.templateMode!=="single-external"){h=new dojo.NodeList;for(m=0;m<i.children.length;++m)for(var q=i.children[m],n=dojo.attr(q,"data-binding"),k=f(n),w=0;w<k.length;++w)if(n=k[w],n.directive==="@template-for"||n.directive==="@template-select"){if(n.directive==="@template-for"&&n.target===o.target)h.push(q),k=dojo.clone(q),o.templateSelections["@default"]=k,k.___domParent=i;else if(n.directive==="@template-select"){h.push(q);for(var w=false,B=0;B<k.length;++B){var C=
k[B];if(C.directive==="@template"){k=new c.config.ViewConfig(null,null,null);k.markupResource=C.target;k.libraryId=g.libraryId;k=g.app.viewManager.createView(k);if(!k){this.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(C.target,this.id));break}k.app=g.app;w=dojo.clone(q);dojo.place(k.root,w,"last");o.templateSelections[n.target]=w;w=true;break}}if(!w)h.push(q),o.templateSelections[n.target]=q,q.___domParent=i}break}h.orphan()}}else if(m==="@source-remove")o.type=
"source-remove",o.attributeName=q;else if(m==="@source-add")o.type="source-add",o.attributeName=q;else if(m==="@visible"||m==="@hidden"){if(m==="@hidden")o.invert=true;o.type="visibility";o.attributeName="@visibility"}else if(m==="@disabled"||m==="@enabled"){if(m==="@disabled")o.invert=true;o.type="disabledState";o.attributeName="@disabledState"}else m.startsWith("@template")?o.type="template":m.startsWith("@halt")?r=true:(g.app.trace.warning("Unknown binding term '{0}'.".format(m)),s=true);else o.type=
"attr",o.attributeName=m;s||g.applyBinding.apply(g,[i,o,e,a])&&d.push(o)})();n=new b.framework.ui.BindingNode;n.domElement=i;n.parent=a;n.context=a.context;n.children=[];n.expressions=[];a.children.push(n);r==false&&!k&&d(n,i)}}else k||d(a,i)}}var g=this;if(this.root!=null){var a=new b.framework.ui.BindingNode;a.domElement=null;a.parent=null;a.children=[];a.context=this.viewModel;d(a,{children:[this.root]});return a}};a.prototype.getBindingTarget=function(d){if(d.target==="@context")return d.viewModel;
if(d.target.indexOf("@language-")>-1)return this.app.getResource(this.libraryId,"language-"+d.target.split("-").slice(1).join("-"));if(d.viewModel.isObservable!=true)return d.viewModel[d.target];else{var g=d.viewModel.get();return g==null?g:g[d.target]}};a.prototype.setBindingTargetValue=function(d,g){if(d.target==="@context")d.viewModel&&d.viewModel.isObservable?d.viewModel.set(g):d.viewModel=g;else if(!(d.target.indexOf("@language-")>-1))if(d.viewModel.isObservable){var a=d.viewModel.get();a&&(a[d.target]?
a[d.target].isObservable?a[d.target].set(g):a[d.target]=g:a[d.target]=new Observable(g))}else d.viewModel[d.target].isObservable?d.viewModel[d.target].set(g):d.viewModel[d.target]=g};a.prototype.resolveBindingTemplate=function(d,g){var a=null;if(d.templateMode==="single-inline"||d.templateMode==="single-external")a=dojo.clone(d.templateSelections["@default"]);else if(d.templateMode==="inline-selected"){var b=null;g[d.templateKey]&&(b=g[d.templateKey],b.isObservable&&(b=b.get()));!b&&d.templateSelections.hasOwnProperty("@null")?
a=dojo.clone(d.templateSelections["@null"]):d.templateSelections.hasOwnProperty(b)&&(a=dojo.clone(d.templateSelections[b]));!a&&d.templateSelections.hasOwnProperty("@default")&&(a=dojo.clone(d.templateSelections["@default"]),dojo.addClass(a,"empty-div"))}a||(a=dojo.create("div"));return a};a.prototype.buildSourceBinding=function(d,a,e,j){var c=this,f=c.getBindingTarget(a);if(f===null)return false;if(f===void 0)return c.app.trace.warning("Binding error: '{0}' in view model '{1}' was not bindable.".format(a.target,
a.viewModel.id)),false;var m=function(){if(f.useThrottling&&f.throttledOperations&&f.throttledOperations.length)for(var d=f.throttledOperations.length-1;d>=0;d--)f.throttledOperations[d].cancel(),f.throttledOperations.splice(d,1)},h=function(e){if(a.upToDate===true)a.upToDate=false;else{for(var h=null,i=null,k=0;k<j.expressions.length;++k){var l=j.expressions[k];if(!h&&l.type=="source-add")h=l.target;if(!i&&l.type=="source-remove")i=l.target}k=this;if(a.parentView)k=a.parentView;var u=k[h],h=k[i];
if(!(e===void 0||e===null)){if(e instanceof b.framework.events.CollectionChangedArgs)if(e===null||e.type==="clear"){m();if(h)for(l=e.rangeStart;l<=e.rangeEnd;++l)h.apply(c,[a,f.getAt(l),e,l]);for(l=0;l<a.boundViews.length;++l)this.app.viewManager.destroyView(a.boundViews[l]);a.boundViews=[];if(!h&&a.domElement!=null&&a.domElement.children!=null){k=new dojo.NodeList;for(l=0;l<a.domElement.children.length;++l)a.domElement.children[l].___collectionTemplate||k.push(a.domElement.children[l]);k.orphan()}}else{if(e.type===
"replace"){m();if(h)for(l=e.rangeStart;l<e.rangeEnd+1;++l)h.apply(c,[a,f.getAt(l),e,l]);for(l=0;l<a.boundViews.length;++l)this.app.viewManager.destroyView(a.boundViews[l]);a.boundViews=[];h||dojo.empty(a.domElement);e.type="append";e.rangeStart=0;e.rangeEnd=f.value.length-1}}else{i=e.isObservable?e.get():e;h&&h.apply(c,[a,i,e,0]);for(l=0;l<a.boundViews.length;++l)this.app.viewManager.destroyView(a.boundViews[l]);a.boundViews=[];if(!h&&(l=a.___singleSourceItem))k=new dojo.NodeList,k.push(l),k.orphan(),
a.___singleSourceItem=null;if(i)if(u)u.apply(c,[a,i,e,0]);else{k=c.resolveBindingTemplate(a,i);dojo.place(k,a.domElement,"last");l=new b.framework.ui.ViewBase(c.app);l.parentView=a.parentView;l.app=l.parentView.app;l.libraryId=c.libraryId;var x={children:[]};x.children.push(k);if(!i)i=new b.framework.ui.ViewModelBase(c.app,c.libraryId),i.app=c.app,i.libraryId=c.libraryId;i.hasOwnProperty("___boundViews");l.root=x;l.attach(i);l.root=k;a.___singleSourceItem=l.root;a.boundViews.push(l)}}if(e.type===
"append"||e.type==="insert"){var z=null;e.type==="insert"&&a.domElement.children.length>e.rangeStart&&(z=a.domElement.children[e.rangeStart]);var A=function(j,h,m){if(j>h)return false;for(m=m?m:f;j<=h;++j){var i=null;if(u!=null)u.apply(c,[a,m.isObservable?m.getAt(j):m[j],e,j]);else{var q=m.isObservable?m.getAt(j):m[j],i=c.resolveBindingTemplate(a,q);z&&e.type==="insert"?dojo.place(i,z,"before"):z&&e.type==="append"?dojo.place(i,z,"after"):dojo.place(i,a.domElement,"last");var l=new b.framework.ui.ViewBase(c.app,
c.libraryId);l.parentView=a.parentView;l.app=l.parentView.app;l.libraryId=c.libraryId;l.id+="-item"+j;var k={children:[]};k.children.push(i);if(q===null||q===void 0)q=new b.framework.ui.ViewModelBase(c.app,c.libraryId),q.app=c.app,q.libraryId=c.libraryId;q.hasOwnProperty("___boundViews");l.root=k;l.attach(q);l.root=i;a.boundViews.push(l)}}d.___populateInitialValueFunc&&(d.___populateInitialValueFunc(),delete d.___populateInitialValueFunc);return true};if(f.useThrottling){f.throttledOperations=f.throttledOperations&&
f.throttledOperations.constructor===Array?f.throttledOperations:[];var h=f.throttleDelay==void 0?0:f.throttleDelay,q=e.rangeStart,o=Math.min(q+10-1,e.rangeEnd),E=f.get().slice(0),D=function(){var d=f.throttledOperations.indexOf(w);d>-1&&f.throttledOperations.splice(d,1)},w=new b.framework.utils.ThrottledOperation(h,function(){var d=A(q,o,E);if(o>=e.rangeEnd)return D(),false;q+=10;o+=10;o=Math.min(o,e.rangeEnd);d||D();return d});f.throttledOperations.push(w)}else A(e.rangeStart,e.rangeEnd)}else if(e.type===
"remove"){m();for(i=e.rangeStart;i<=e.rangeEnd;++i)for(k=0;k<a.boundViews.length;++k)l=a.boundViews[k],l.viewModel!==null&&l.viewModel!==void 0&&l.viewModel==f.getAt(i)&&(h?h.apply(c,[a,e[i],e,i]):c.app.viewManager.destroyView(l),Array.removeItem(a.boundViews,l),--k)}}}};f.bind&&a.targetBindings.push({event:f.bindingEvent,token:f.bind(c,h)});if(f.isObservableCollection){var i=f.getLength()-1;this.bindingSetupDelegates.push(function(){var d=new b.framework.events.CollectionChangedArgs;d.type="append";
d.rangeStart=0;d.rangeEnd=i;d.sender=f;h.apply(c,[d]);f.isObservable&&f.bindingEvent.isPublishing&&(a.upToDate=true)})}else this.bindingSetupDelegates.push(function(){h.apply(c,[f]);f.isObservable&&f.bindingEvent.isPublishing&&(a.upToDate=true)})};a.prototype.buildEventBinding=function(d,a,e){var b=this;if(!this[a.target]&&a.parentView&&a.parentView[a.target])b=a.parentView;if(b[a.target])d!=a.domElement&&this.app.trace.warning("Binding error: buildEventBinding passed in el that doesn't match binding.domElement."),
a.on(a.attributeName,function(c){var f=b[a.target](c,d,e);return!f?(c.preventDefault(),c.stopPropagation(),false):f});else return this.app.trace.warning("Binding error: Event handler '{0}' was not found in view '{1}' or its parent view.".format(a.target,b.id)),false};a.prototype.buildVarBinding=function(d,a){var e=this;if(a.parentView)e=a.parentView;var b=e[a.target];b?b&&b instanceof Array?b.push(d):b&&b.isObservableCollection?b.addItem(d):e[a.target]=d:e[a.target]=d};a.prototype.buildTextBinding=
function(d,a){var e=this.getBindingTarget(a);if(e===null)return false;if(e===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;var b=function(){if(e!=null&&!e.isObservable)a.attributeName==="innerHTML"?(dojo.empty(d),d.appendChild(document.createTextNode(e))):dojo.attr(d,a.attributeName,String.escapeHtml(e));else{var b=e.get(),b=b===null||b===void 0?"":b.toString();a.attributeName==="innerHTML"?(dojo.empty(d),
d.appendChild(dojo.doc.createTextNode(b))):dojo.attr(d,a.attributeName,String.escapeHtml(b))}};e.isObservable&&a.targetBindings.push({event:e.bindingEvent,token:e.bind(this,b)});this.bindingSetupDelegates.push(function(){b.apply(this,[null])})};a.prototype.buildAttributeBinding=function(d,a,e,b){var c=this.getBindingTarget(a);if(typeof c==="undefined")return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;var f=function(){if(c===
null)return dojo.attr(d,a.attributeName,""),false;else if(c.isObservable){var e=c.get();if(e===null||e===void 0)e="";b===true?d[a.attributeName]=e:dojo.attr(d,a.attributeName,e)}else{if(c===null||c===void 0)c="";b===true?d[a.attributeName]=c:dojo.attr(d,a.attributeName,c)}};c!==null&&c.isObservable&&a.targetBindings.push({event:c.bindingEvent,token:c.bind(this,f)});this.bindingSetupDelegates.push(function(){f.apply(this,[null])})};a.prototype.buildStyleBinding=function(d,a){var e=this,b=this.getBindingTarget(a);
if(b===null)return false;if(b===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;else if(b!=null&&!b.isObservable){var c=!isNaN(b)&&b!==""?b+"px":b;dojo.style(d,a.attributeName,c)}else if(b!=null){var f=function(){var e;e=b.get();e=!isNaN(e)&&e!==""?e+"px":e;dojo.style(d,a.attributeName,e)};b.isObservable&&a.targetBindings.push({event:b.bindingEvent,token:b.bind(this,f)});this.bindingSetupDelegates.push(function(){f.apply(e,
[null])})}};a.prototype.buildDomBinding=function(d,a){var e=this;if(a.parentView)e=a.parentView;var b=e[a.target];if(b==null)return false;if(b===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;else try{if(b.isObservable){a.targetBindings.push({event:b.bindingEvent,token:b.bind(this,function(){if(!b.get())return false;a.domElement=dojo.place(b.get(),a.domElement,"replace");this.app&&this.app.viewManager.notifyDimensionsChanged(this)})});
if(!b.get())return false;dojo.place(b.get(),a.domElement,"replace")}else{if(!b)return false;dojo.place(b,a.domElement,"replace")}}catch(c){this.app.trace.warning("Binding error: An error occurred in view '{0}' while attempting to perform a DOM binding in view model '{1}'.".format(this.id,a.viewModel.id))}};a.prototype._createWidgetViewFromConfig=function(d,a){var e=d.type,j=d.id?"WidgetView-{0}-{1}".format(d.id,b.framework.utils.alphaNumericToken()):"{0}-{1}".format(b.framework.utils.alphaNumericToken(),
b.framework.utils.alphaNumericToken()),j=new c.config.ViewConfig(j,null,e||"geocortex.framework.ui.ViewBase");j.isVisible=true;j.libraryId=d.libraryId;if(d.markup)j.markupResource=d.markup;e=null;if(d.viewModelId){if(e=this.app.getFrameworkObjectById(d.viewModelId),!e)throw Error("Could not bind widget '{0}' to view model with ID '{1}': View model not found.".format(d.Id,d.viewModelId));}else if(d.viewModelType){e=this.app.instantiateFrameworkObject(d.viewModelType,d.libraryId);if(!d.id)d.id=b.framework.utils.alphaNumericToken();
e.id="WidgetViewModel-{0}-{1}".format(d.id,b.framework.utils.alphaNumericToken())}else e=a;j=this.app.viewManager.createView(j);if(!j)throw Error("Could not create widget '{0}': The widget's view could not be created.".format(d.Id));j.configuration=d.configuration;var f={children:[]};f.children.push(j.root);j.root=f;j.attach(e);j.root=f.children[0];return j};a.prototype.buildWidgetBinding=function(d,a){var e=this,c=a.target,f=this.viewModel,h=true,m=false,i=null,k=null;if(a.otherExpressions)for(var n=
0;n<a.otherExpressions.length;++n)if(k=a.otherExpressions[n],k.directive==="@widget-context"){a.target=k.target;f=this.getBindingTarget(a);if(!f)return this.app.trace.error("Error binding widget '{0}' to target '{1}': Target was not found in view model.".format(c,k.target)),false;i=f}else k.directive==="@widget-required"?h=k.target.toLowerCase()!=="false":k.directive==="@widget-replace"&&(m=k.target.toLowerCase()==="true");for(var k=f&&f.isObservable,p=this.app.configModel.widgetConfigs,r=null,n=
0;n<p.length;++n){var v=p[n];if(v.id===c){r=v;break}}var y=!r,u=function(){var d=i||null;d&&d.isObservable&&(d=d.get());d=(a.parentView||this).resolveWidget(c,d,a);if(!d){if(h)throw Error("Widget '{0}' was not found.".format(c));return false}return d},x=function(d,f){var h=null;if(a.boundViews.length>0)for(var s=0;s<a.boundViews.length;++s)e.app.viewManager.destroyView(a.boundViews[s]);dojo.empty(a.domElement);s=null;if(d){if(typeof d==="string")h=dojo.create("div"),dojo.attr(h,"innerHTML",d),dojo.addClass(h,
"empty-div"),h=h.children&&h.children.length===1?h.children[0]:h;else if(d.hasOwnProperty("nodeType")&&[1,2,3,8,9].contains(r.nodeType))h=d;else if(d instanceof b.framework.ui.ViewBase)s=d,a.boundViews.push(s),h=d.root;else if(d instanceof b.framework.config.WidgetConfig)s=e._createWidgetViewFromConfig(d,f),a.boundViews.push(s),h=s.root;else{e.app.trace.warning("Could not resolve widget '{0}': Object of unknown type provided.".format(c));return}dojo.place(h,a.domElement,m?"replace":"last");s&&(s.added(this),
s.activated())}};k&&a.targetBindings.push({event:f.bindingEvent,token:f.bind(this,function(d){if(y){var a=u();x(a,d)}else x(r,d)})});this.bindingSetupDelegates.push(function(){var d=null;f&&(d=f.isObservable?f.get():f);if(y){var a=u();x(a,d)}else x(r,d)})};a.prototype.buildClassBinding=function(d,a){var e=this.getBindingTarget(a);if(e===null)return false;if(e===void 0)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;
else{var b=function(e){e=c.isTruthy(e);a.invert===true&&(e=!e);var b=a.attributeName;e===true?(dojo.removeClass(d,b),dojo.addClass(d,b)):dojo.removeClass(d,b)},c=this;e.isObservable&&a.targetBindings.push({event:e.bindingEvent,token:e.bind(this,b)});this.bindingSetupDelegates.push(function(){b.apply(c,[e])})}};a.prototype.isTruthy=function(d){if(d)if(d instanceof b.framework.events.CollectionChangedArgs)if(d.type==="append"){if(d.rangeEnd+1-d.rangeStart>0||d.sender.value&&d.sender.value.length>0)return true}else if(d.type===
"clear")return false;else if(d.type==="insert"){if(d.rangeEnd+1-d.rangeStart>0)return true}else{if(d.type==="remove"&&d.rangeEnd+1-d.rangeStart<d.sender.value.length)return true}else return d.isObservableCollection?d.getLength()>0:d.isObservable?!!d.get():d?true:typeof d==="string"?d.length>0:false;else return false};a.prototype.buildVisibilityBinding=function(d,a){var e=this.getBindingTarget(a);if(e===null)return false;if(e===void 0)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,
a.viewModel.id)),false;else{a.initialVisibility=dojo.style(d,"display")||"block";var b=function(e){e=c.isTruthy(e);a.invert==true&&(e=!e);var b="",b=a.initialVisibility==="inline"?"bound-visible-inline":"bound-visible";e==true?(dojo.removeClass(d,"bound-invisible"),dojo.addClass(d,b)):(dojo.removeClass(d,b),dojo.addClass(d,"bound-invisible"))},c=this;e.isObservable&&a.targetBindings.push({event:e.bindingEvent,token:e.bind(this,b)});this.bindingSetupDelegates.push(function(){b.apply(c,[e])})}};a.prototype.buildDisabledBinding=
function(d,a){var e=this.getBindingTarget(a);if(e===void 0)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;else{a.initialDisabled=dojo.attr(d,"disabled");var c=function(c){var j=false;if(c){if(e)if(c instanceof b.framework.events.CollectionChangedArgs)if(c.type=="append"){if(c.rangeEnd+1-c.rangeStart>0||e.value&&e.value.length>0)j=false}else c.type=="clear"?j=true:c.type=="insert"?c.rangeEnd+1-c.rangeStart>0&&(j=
false):c.type=="remove"&&c.rangeEnd+1-c.rangeStart<e.value.length&&(j=false);else j=e.isObservableCollection?!(e.getLength()>0):e.isObservable?!e.get():typeof c==="string"?c.length==0:false}else j=true;a.invert==true&&(j=!j);j==true?(dojo.attr(d,"disabled",true),dojo.attr(d,"tabindex",-1),dojo.addClass(d,"bound-disabled")):(dojo.removeAttr(d,"disabled"),dojo.removeAttr(d,"tabindex"),dojo.removeClass(d,"bound-disabled"))},f=this;e.isObservable&&a.targetBindings.push({event:e.bindingEvent,token:e.bind(this,
c)});this.bindingSetupDelegates.push(function(){c.apply(f,[e])})}};a.prototype.buildValueBinding=function(d,a){var e=this,j=this.getBindingTarget(a);if(j===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;if(j==null)return false;var f=j.isObservable||false,h=j.isObservableCollection||false,i=d.tagName.toLowerCase(),l=dojo.attr(d,"type");if(f){var k=function(a){if(a!==dojo.attr(d,"value")){if(a===null||a===
void 0)a="";dojo.attr(d,"value",a)}},n=function(a){d.checked=a===true},p=function(a){var g=dojo.attr(d,"value");dojo.query("input[type=radio]",e.root).forEach(function(){});d.checked=a===true||g==a?true:false},r=function(a){a instanceof Date?(a=new Date(a.getTime()),a.setMinutes(a.getMinutes()-a.getTimezoneOffset()),d.valueAsDate=a):d.value=a},v=function(d){var e=d;if(e instanceof b.framework.events.CollectionChangedArgs){for(var d=e,c=d.sender,j={},f=d.rangeStart;f<=d.rangeEnd;f++){var h=c.getAt(f);
j[h.value+""]=true}if(d.type==="append"||d.type==="insert")for(d=0;d<a.domElement.options.length;++d)if(c=a.domElement.options[d],j[c.value+""]&&(c.selected=true,!dojo.attr(a.domElement,"multiple")))break}else{var s=e;if(typeof e==="number"||typeof e==="boolean")e=e.toString();f=function(d,a){return typeof d.___attachedValue!=="undefined"?d.___attachedValue===(a===void 0?s:a):d.value===(a===void 0?e:a)};if(e===null||e===void 0)for(d=0;d<a.domElement.options.length;++d)c=a.domElement.options[d],c.selected=
false;else if(dojo.isArray(e))if(a.viewModel[a.target].isObservableCollection){h=false;for(d=0;d<a.domElement.options.length;++d)if(c=a.domElement.options[d],c.selected=false,dojo.attr(a.domElement,"multiple")||!h)for(var i=0;i<e.length;++i)if(j=e[i],f(c,j)){h=c.selected=true;break}}else for(d=0;d<a.domElement.options.length;++d){if(c=a.domElement.options[d],f(c,j)){c.selected=true;break}}else for(d=0;d<a.domElement.options.length;++d)if(c=a.domElement.options[d],f(c,j)){c.selected=true;break}}};
i==="select"?(a.targetBindings.push({event:j.bindingEvent,token:j.bind(a,v)}),this.bindingSetupDelegates.push(function(){v.apply(e,[j.get()])})):l==="radio"?(a.targetBindings.push({event:j.bindingEvent,token:j.bind(a,p)}),this.bindingSetupDelegates.push(function(){p.apply(e,[j.get()])})):l==="checkbox"?(a.targetBindings.push({event:j.bindingEvent,token:j.bind(a,n)}),this.bindingSetupDelegates.push(function(){n.apply(e,[j.get()])})):l==="date"?(a.targetBindings.push({event:j.bindingEvent,token:j.bind(a,
r)}),this.bindingSetupDelegates.push(function(){r.apply(e,[j.get()])})):(a.targetBindings.push({event:j.bindingEvent,token:j.bind(a,k)}),this.bindingSetupDelegates.push(function(){k.apply(e,[j.get()])}))}var y=function(){a.on("change",function(d){if(d.currentTarget===void 0)e.app&&e.app.trace.error("Binding error: bound to change event where currentTarget is undefined");else return d=dojo.attr(d.currentTarget,"value"),f?j.set(d):e.setBindingTargetValue(a,d),true})},u=function(){a.on("change",function(d){d=
dojo.attr(d.currentTarget,"checked");f?j.set(d):e.setBindingTargetValue(a,d);return true})},x=function(){a.on("click",function(d){dojo.attr(d.currentTarget,"checked")&&(f?j.set(d.currentTarget.value):e.setBindingTargetValue(a,d.currentTarget.value));return true})},z=function(){a.on("change",function(d){var b=f?j.get():j,d=d.currentTarget.valueAsDate;d.setMinutes(d.getMinutes()+d.getTimezoneOffset());b instanceof Date&&!isNaN(b.getTime())&&(d.setHours(b.getHours()),d.setMinutes(b.getMinutes()),d.setSeconds(b.getSeconds()),
d.setMilliseconds(b.getMilliseconds()));f?j.set(d):e.setBindingTargetValue(a,d);return true})},A=function(){d.___populateInitialValueFunc=function(){v(j.isObservable?j.get():j)};a.on("change",function(){for(var b=dojo.query("option",d),i=[],m=0;m<b.length;++m){var l=b[m];if(l.selected===true){var k=l.___attachedValue;c.utils.isNullOrUndefined(k)?i.push(l.value):i.push(k)}}if(i.length===0&&b.length>0&&!d.multiple&&e.app.___uaIsiPad===true)d.selectedIndex=0,k=b[0].___attachedValue,i.push(!c.utils.isNullOrUndefined(k)?
k:b[0].value);i.length>0?h?(j.clear(),j.addItems(i)):f?j.set(i[0]):e.setBindingTargetValue(a,i):j.clear();return true})};i==="textarea"||i==="input"&&l==="text"?function(){var d=null,b=function(b){b=dojo.attr(b.currentTarget,"value");if(b!==d)return d=b,f?j.set(b):e.setBindingTargetValue(a,b),true};a.on("change",b);a.on("keyup",b);a.on("mouseup",b);a.on("input",b)}():i==="input"&&l==="checkbox"?u():i==="input"&&l==="radio"?x():i==="input"&&l==="date"?z():i==="select"?A():y()};a.prototype.applyBinding=
function(d,a,e,b){a.type==="source"?this.buildSourceBinding(d,a,e,b):a.type==="event"?this.buildEventBinding(d,a,e):a.type==="text"?this.buildTextBinding(d,a,e):a.type==="var"?this.buildVarBinding(d,a,e):a.type==="class"?this.buildClassBinding(d,a,e):a.type==="style"?this.buildStyleBinding(d,a,e):a.type==="dom"?this.buildDomBinding(d,a,e):a.type==="value"?this.buildValueBinding(d,a,e):a.type==="attr"?this.buildAttributeBinding(d,a,e):a.type==="attachment"?this.buildAttributeBinding(d,a,e,true):a.type===
"visibility"?this.buildVisibilityBinding(d,a,e):a.type==="disabledState"?this.buildDisabledBinding(d,a,e):a.type==="widget"&&this.buildWidgetBinding(d,a,e);return true};return a}(b.framework.FrameworkObject);i.ViewBase=h})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(i){var h=function(){function f(a,d){this._viewActivationTimers=[];this._viewDeactivationTimers=[];this.isActive=false;this.options=this.domElement=null;this.views=[];this.activeViews=[];this.defaultTransitionDelay=10;this.app=d;this.name=a}f.prototype.host=function(a,d){this.domElement=a;this.options=d||{};if(this.options.useTransitions){if(!this.options.transitionDelay||isNaN(this.options.transitionDelay))this.options.transitionDelay=this.defaultTransitionDelay}else this.options.useTransitions=
false};f.prototype.unhost=function(){this.options=this.domElement=null};f.prototype.activateView=function(a){this.cancelActivate(a);if(this.activeViews.length===0&&a.isActive===false)this.isActive=true,this.app.event("RegionActivatedEvent").publish(this),dojo.removeClass(this.domElement,"region-inactive"),dojo.addClass(this.domElement,"region-active");b.utils.ArrayUtils.contains(this.activeViews,a)&&b.utils.ArrayUtils.removeItem(this.activeViews,a);this.activeViews.push(a);a.activated();a.isActive=
true;this.options.useTransitions?(dojo.removeClass(a.root,"inactive"),dojo.addClass(a.root,"activating"),this._viewActivationTimers[a.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(a.root,"inactive");dojo.removeClass(a.root,"activating");dojo.addClass(a.root,"active");delete this._viewActivationTimers[a.id]}),this.options.transitionDelay)):(dojo.removeClass(a.root,"inactive"),dojo.addClass(a.root,"active"));this.app.event("ViewActivatedEvent").publish(a)};f.prototype.cancelActivate=function(a){this._viewActivationTimers[a.id]&&
(clearTimeout(this._viewActivationTimers[a.id]),delete this._viewActivationTimers[a.id],dojo.removeClass(a.root,"activating"))};f.prototype.cancelDeactivate=function(a){this._viewActivationTimers[a.id]&&(clearTimeout(this._viewActivationTimers[a.id]),delete this._viewActivationTimers[a.id],dojo.removeClass(a.root,"deactivating"))};f.prototype.deactivateView=function(a){this.cancelDeactivate(a);if(this.activeViews.length<=1&&a.isActive===true)this.isActive=false,dojo.removeClass(this.domElement,"region-active"),
dojo.addClass(this.domElement,"region-inactive"),this.app.event("RegionDeactivatedEvent").publish(this);this.cancelActivate(a);b.utils.ArrayUtils.removeItem(this.activeViews,a);a.deactivated();a.isActive=false;this.options.useTransitions?(dojo.removeClass(a.root,"active"),dojo.addClass(a.root,"deactivating"),this._viewDeactivationTimers[a.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(a.root,"active");dojo.removeClass(a.root,"deactivating");dojo.addClass(a.root,"inactive");delete this._viewDeactivationTimers[a.id]}),
this.options.transitionDelay)):(dojo.removeClass(a.root,"active"),dojo.addClass(a.root,"inactive"));this.app.event("ViewDeactivatedEvent").publish(a)};f.prototype.hostView=function(a){a.added();dojo.removeClass(a.root,"active");dojo.addClass(a.root,"inactive");this.app.event("ViewHostedEvent").publish({region:this,view:a})};f.prototype.unhostView=function(a){a.removed();dojo.removeClass(a.root,"active");dojo.addClass(a.root,"inactive");this.app.event("ViewUnhostedEvent").publish({region:this,view:a})};
return f}();i.RegionAdapterBase=h})(b.ui||(b.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(i){var h=function(f){function a(d,g){var e=this;f.call(this,d,g);this.activeView=null;this.activeViews=[];this._scrollTimer=this.overlayElement=this.contentElement=this.contentContainer=this.contentTitle=this.contentHeader=this.titleBindingToken=null;this._scrollDelay=50;if(a.instance)throw Error("PopupModalRegionAdapter is a singleton and has already been constructed once.");a.instance=this;if(this.app.modalRegionSingleton==null)this.app.modalRegionSingleton=this;
this.app.command("CloseModalRegion").register(this,function(){e.deactivate()});this.app.event("ViewActivatedEvent").subscribe(this,function(){e.activeViews.length>0&&setTimeout(function(){e.positionContent()},0)});this.app.event("ViewDimensionsChangedEvent").subscribe(this,function(){e.positionContent()})}__extends(a,f);a.getInstance=function(){return a.instance};a.prototype.activate=function(){this.activeViews.length>0&&(dojo.query(this.domElement).removeClass("inactive"),dojo.query(this.domElement).addClass("active"),
dojo.query(this.overlayElement).removeClass("inactive"),dojo.query(this.overlayElement).addClass("active"))};a.prototype.deactivate=function(){dojo.query(this.domElement).removeClass("active");dojo.query(this.domElement).addClass("inactive");dojo.query(this.overlayElement).removeClass("active");dojo.query(this.overlayElement).addClass("inactive");if(this.activeView)this.activeView=null};a.prototype.host=function(d){var a=this;f.prototype.host.call(this,d);this.domElement=d;dojo.query(this.domElement).removeClass("active");
dojo.query(this.domElement).addClass("inactive");this.contentContainer=dojo.query(".modal-container")[0];this.contentElement=dojo.query(".modal-container-inner")[0];this.overlayElement=dojo.query(".modal-overlay")[0];dojo.connect(window,"onresize",function(){a.handleScrollEvent()});dojo.connect(window,"onscroll",function(){a.handleScrollEvent()});this.app.event("WorkflowFormTextInputBlurredEvent").subscribe(this,function(){setTimeout(function(){a.positionContent()},100)})};a.prototype.handleScrollEvent=
function(){var d=this;if(this._scrollTimer!=null)clearTimeout(this._scrollTimer),this._scrollTimer=null;this._scrollTimer=setTimeout(function(){d.positionContent()},0)};a.prototype.positionContent=function(){if(this.contentContainer&&this.activeView!=null&&this.activeView.root!=null){var d=dojo.position(this.contentContainer),a=dojo.window.getBox(),e=d.w;d.w>a.w?(e=a.w,dojo.style(this.contentElement,{"max-width":e+"px"})):dojo.style(this.contentElement,{"max-width":""});var b=d.h;d.h>a.h?(b=a.h,dojo.style(this.contentElement,
{"max-height":b+"px"})):dojo.style(this.contentElement,{"max-height":""});dojo.style(this.contentContainer,{left:a.w/2-e/2+"px",top:a.h/2-b/2+"px"})}};a.prototype.showActiveView=function(d){if(d.isActive)this.activeView=d,this.hideAllViews(),d.activated(),this.activate(),this.activeView=d,dojo.removeClass(d.root,"inactive"),dojo.addClass(d.root,"active")};a.prototype.hideAllViews=function(){dojo.query("> .view",this.contentElement).removeClass("active");dojo.query("> .view",this.contentElement).addClass("inactive")};
a.prototype.activateView=function(d){c.utils.ArrayUtils.contains(this.activeViews,d)&&c.utils.ArrayUtils.removeItem(this.activeViews,d);this.activeViews.push(d);f.prototype.activateView.call(this,d);this.showActiveView(d);this._repositionOnImageLoaded(d.root)};a.prototype.deactivateView=function(d){c.utils.ArrayUtils.removeItem(this.activeViews,d);this.activeViews.length>0?(this.showActiveView(this.activeViews[this.activeViews.length-1]),this.positionContent()):this.deactivate();f.prototype.deactivateView.call(this,
d)};a.prototype.deactivateActiveView=function(){if(this.activeView){if(this.titleBindingToken!=null)this.activeView.title.unbind(this.titleBindingToken),this.titleBindingToken=null;var d=this.activeView;this.activeView=null;this.deactivateView(d);c.utils.ArrayUtils.removeItem(this.activeViews,this.activeView)}};a.prototype.hostView=function(d){this.views.push(d);if(d.root==null){var a=b.resourceManager.fetch(d.markupResource,d.libraryId);if(a==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(d.markupResource,
d.libraryId)),false;d.root=dojo.create("div",{className:"view {0}".format(d.id)});d.root.innerHTML=a;dojo.place(d.root,this.contentElement,"last");d.viewModel&&d.attach(d.viewModel);this.app.viewManager.discoverRegions(d.root,d);this.positionContent()}else dojo.place(d.root,this.contentElement,"last");f.prototype.hostView.call(this,d);return true};a.prototype.unhostView=function(a){a==this.activeView&&this.deactivateView(a);c.utils.ArrayUtils.removeItem(this.views,a);c.utils.ArrayUtils.removeItem(this.activeViews,
a);var g=new dojo.NodeList;g.push(a.root);g.orphan();f.prototype.unhostView.call(this,a)};a.prototype._repositionOnImageLoaded=function(a){var g=this;dojo.forEach(dojo.query("img",a),function(a){a.attached_ModalRegion_ImageLoadedConnection&&(dojo.disconnect(a.attached_ModalRegion_ImageLoadedConnection),delete a.attached_ModalRegion_ImageLoadedConnection);var d=dojo.connect(a,"load",g,function(a){g._imageLoaded(a)});a.attached_ModalRegion_ImageLoadedConnection=d})};a.prototype._imageLoaded=function(a){a=
a.target;a.attached_ModalRegion_ImageLoadedConnection&&(dojo.disconnect(a.attached_ModalRegion_ImageLoadedConnection),delete a.attached_ModalRegion_ImageLoadedConnection);this.positionContent()};a.instance=null;return a}(i.RegionAdapterBase);i.PopupModalRegionAdapter=h})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(){}b.createCommands=function(a){a.command("OpenWebPage").register(a,function(a){"http,https,ftp,ftps,gopher,mailto".split(",").indexOf((new dojo._Url(a)).scheme)>=0&&window.open(a,"_blank")})};return b}();b.ApplicationCommands=c})(b.application||(b.application={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(i){var h=function(){return function(a,d,g){this.impl=a;this.scope=d;this.canExecute=g}}(),f=function(){function a(a,g,e){this._entries={};this.app=null;this.name=a;this.app=g;this.isWrapper=true;this.canExecuteChanged=new c.events.Event("{0}.CanExecuteChanged".format(a));this.preExecute=new c.events.Event("{0}.PreExecute".format(a));this.postExecute=new c.events.Event("{0}.PostExecute".format(a));this.canExecuteMode=e!=null&&e!=void 0?e:"all"}a.prototype.raiseCanExecuteChanged=
function(){this.canExecuteChanged.publish()};a.prototype.canExecute=function(a){if(this.isWrapper)return false;for(var g in this._entries)if(this._entries.hasOwnProperty(g)){var e=this._entries[g];if(e.canExecute&&e.canExecute.apply(e.scope,arguments)){if(this.canExecuteMode==="any")return true}else if(this.canExecuteMode==="all")return false}return this.canExecuteMode==="any"?false:true};a.prototype.execute=function(a){var g=false;if(this._entries)for(var e in this._entries)if(this._entries.hasOwnProperty(e)){g=
true;break}if(g){if(this.canExecuteMode!=="all"||this.canExecute.apply(this,arguments)){this.app&&this.app.debugMode&&(g="Command '{0}' executed.".format(this.name),console.debug?console.debug(g):console.log(g));this.preExecute.publish.apply(this.preExecute,arguments);for(e in this._entries)this._entries.hasOwnProperty(e)&&(g=this._entries[e],(this.canExecuteMode!=="any"||g.canExecute.apply(g.scope,arguments))&&g.impl.apply(g.scope,arguments));this.postExecute.publish.apply(this.postExecute,arguments)}}else this.app.trace.debug("Command '{0}' executed but no implementation registered.".format(this.name))};
a.prototype.register=function(a,g,e){this.isWrapper=false;var c=b.framework.utils.alphaNumericToken(),g=new h(g,a,e||this.defaultCanExecuteFunction);this._entries[c]=g;a&&a instanceof b.framework.FrameworkObject&&a.trackCommandHandler(this,c);this.app.trace.debug("Registered an implementation for command '{0}'.".format(this.name));this.raiseCanExecuteChanged();return c};a.prototype.defaultCanExecuteFunction=function(){return true};a.prototype.unregister=function(a){this.isWrapper=false;if(!this._entries.hasOwnProperty(a))return false;
delete this._entries[a];this.app.trace.debug("Unregistered an implementation for command '{0}'.".format(this.name));this.raiseCanExecuteChanged();return true};a.prototype.clear=function(){this._entries={};this.raiseCanExecuteChanged();this.app.trace.debug("Cleared all implementations of command '{0}'.".format(this.name))};return a}();i.Command=f})(c.commands||(c.commands={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(c){var h=function(){function c(a){this.commands={};this.app=a}c.prototype.clear=function(){for(var a in this.commands)this.commands.hasOwnProperty(a)&&this.commands[a].clear()};c.prototype.command=function(a){var d=this.commands[a];return!d?(a=new b.framework.commands.Command(a,this.app),a.isWrapper=true,this.commands[a.name]=a):d};return c}();c.CommandRegistry=h})(c.commands||(c.commands={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(a){this._targetConfigUri=null;this.app=a}b.prototype.loadConfigurationTree=function(a,d){var g=this;this._targetConfigUri=a;this.app.fetchConfigResource({url:this._targetConfigUri,load:function(a){d!=null&&d!=void 0&&d(a)},error:function(a){return g.app.event("ConfigurationLoadFailedEvent").publish(a)}})};return b}();b.ConfigurationLoader=c})(b.config||(b.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){return function(b,a){this.locales=[];this.position=0;this.omitStyles=false;this.id=b;this.uri=a}}();b.LibraryConfig=c})(b.config||(b.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(c){var h=function(b){function a(a,g){b.call(this,a,g)}__extends(a,b);a.prototype.initialize=function(){};a.prototype.getResource=function(a,g){return this.app.getResource(this.libraryId,a,g)};return a}(b.framework.FrameworkObject);c.ViewModelBase=h})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){return function(b,a,d){this.viewId=b;this.moduleName=a;this.typeName=d}}();b.ViewConfig=c})(b.config||(b.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){return function(b,a,d){this.libraryId="";this.configuration={};this.viewModelId=b;this.moduleName=a;this.typeName=d}}();b.ViewModelConfig=c})(b.config||(b.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){return function(b,a,d,g){this.viewConfigs=[];this.viewModelConfigs=[];this.moduleName=b;this.moduleType=a;this.configuration=d;this.libraryId=g}}();b.ModuleConfig=c})(b.config||(b.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){return function(b,a){this.viewModelType=null;this.configuration={};this.markup=this.typeName="";this.id=b;this.libraryId=a}}();b.WidgetConfig=c})(b.config||(b.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(c){var h=function(){function c(a){this.application={};this.viewerId=this.version="unknown";this.defaultLibraryId="";this.globals=null;this.libraryConfigs=[];this.moduleConfigs=[];this.widgetConfigs=[];this.libraryModules={};this.externalLocaleReferences=[];this.app=a}c.prototype.parse=function(a,d){var g=typeof a==="object"?a:JSON.parse(a);g.configuration||(g.configuration={version:"1.0",viewerId:"unknown",application:{},defaultLibraryId:"",libraries:[],modules:[],
widgets:[]});var e,c,f;try{this.application=g.configuration.application||{},this.version=g.configuration.version||"1.0",this.viewerId=g.configuration.viewerId||"unknown",this.defaultLibraryId=g.configuration.defaultLibraryId||null,e=g.configuration.libraries||[],c=g.configuration.modules||[],f=g.configuration.widgets||[],this.app.trace.debug("Config version: {0}.".format(this.version))}catch(h){this.app.trace.error("Error reading configuration: {0}".format(h),h);return}if(e&&e.length>0)for(var i=
0;i<e.length;++i){var l=e[i],l=this.app.translateConfiguration(l.id,l);if(this.defaultLibraryId==null)this.defaultLibraryId=l.id;var k=new b.framework.config.LibraryConfig(l.id,l.uri);k.position=i;k.omitStyles=l.omitStyles||false;this.libraryConfigs.push(k);this.libraryModules[l.id]=[];if(l.locales)for(g=0;g<l.locales.length;++g){var n=l.locales[g];n.locale=n.locale.toLowerCase();if(n.hasOwnProperty("uri"))n.libraryId=l.id,k.locales.push(n),this.externalLocaleReferences.push(n)}}if(c&&c.length>0)for(g=
0;g<c.length;++g){e=c[g];i=e.libraryId;if(!i)i=this.defaultLibraryId;l=new b.framework.config.ModuleConfig(e.moduleName,e.moduleType,e.configuration,i);this.libraryModules[i]?this.libraryModules[i].push(l):this.app.trace.error("Unknown library '{0}'.".format(i));if(n=e.views)for(k=0;k<n.length;++k){var p=n[k],r=new b.framework.config.ViewConfig(p.id,e.moduleName,p.type||"geocortex.framework.ui.ViewBase");l.viewConfigs.push(r);r.libraryId=p.libraryId||i;r.viewModelId=p.viewModelId||null;r.markupResource=
p.markup||null;r.configuration=p.configuration||{};r.regionName=p.region||null;r.isManaged=p.isManaged||false;r.isVisible=p.visible||false;r.title=p.title||null;r.description=p.description||"";r.iconUri=p.iconUri||""}if(n=e.viewModels)for(k=0;k<n.length;++k)if(p=n[k],r=new b.framework.config.ViewModelConfig(p.id,e.moduleName,p.type),l.viewModelConfigs.push(r),r.libraryId=p.libraryId||i,p.configuration)r.configuration=p.configuration;this.moduleConfigs.push(l)}if(f&&f.length>0)for(i=0;i<f.length;++i)c=
new b.framework.config.WidgetConfig(f[i].id,f[i].libraryId||this.defaultLibraryId),dojo.safeMixin(c,f[i]),this.widgetConfigs.push(c);d&&d(this)};return c}();c.ConfigurationModel=h})(c.config||(c.config={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(c){var h=function(){function c(a){this.events={};this.app=a}c.prototype.clear=function(){for(var a in this.events)this.events.hasOwnProperty(a)&&this.events[a].clear()};c.prototype.event=function(a){var d=this.events[a];d||(d=new b.framework.events.Event(a,this.app),this.events[a]=d);return d};return c}();c.EventRegistry=h})(c.events||(c.events={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(){this.numKeys=this.sizeInChars=this.capacity=b.UNKNOWN}b.UNKNOWN=-1;return b}();b.StorageStats=c})(b.storage||(b.storage={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function c(a){this.app=a;this.keyNamespace=a.id}c.prototype.initialize=function(){};c.prototype.isSupported=function(){return false};c.prototype.isFull=function(){return false};c.prototype.getStats=function(){return new b.StorageStats};c.prototype.getScore=function(){return 0};c.prototype.clear=function(){};c.prototype.clearAllData=function(){};c.prototype.get=function(){};c.prototype.set=function(){};c.prototype.remove=function(){};return c}();
b.StorageProviderBase=c})(b.storage||(b.storage={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(c){function a(){c.apply(this,arguments);this._isInitializing=false;this._initializationErrorCallback=this._initializationSuccessCallback=null;this._defaultDesiredSize=524288E3;this._storageTypeTemporary=0;this._storageTypePersistent=1;this._error=null;this._isInitialized=this._isFull=false}__extends(a,c);a.prototype.initialize=function(a){var b=this;if(!this._isInitialized&&!this._error)if(c.prototype.initialize.call(this),this.isSupported()){if(!a&&
(this.app.configuration&&this.app.configuration.offlineStorageSpaceMb&&(a=parseInt(this.app.configuration.offlineStorageSpaceMb,10)*1048576),!a))a=this._defaultDesiredSize;var e=function(a){if(!b._isInitialized)b._isInitialized=true,b.app.trace.debug("Filesystem '{0}' initialized successfully.".format(a.name)),b._filesystem=a,b._error=null,b._initializationSuccessCallback(a)};!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?this._requestFileSystem(LocalFileSystem.PERSISTENT,a,e,function(a){a=
b._shapeError(a);b._error=a;b._initializationErrorCallback(a)}):this._requestQuota(this._storageTypePersistent,a,function(c){this._isInitialized||(b.app.trace.debug("HTML5 File API quota granted. Size: {0} bytes.".format(c)),b._requestFileSystem(window.PERSISTENT,a,e,function(a){a=b._shapeError(a);b._error=a;b._initializationErrorCallback(a)}))},function(a){a=b._shapeError(a);b._error=a;b.app.trace.error("Error requesting filesystem quota: {0}".format(a.toString()),a);b._initializationErrorCallback(a)})}else this.app.trace.warning("The HTML5 storage provider could not be initialized. The File API is not supported by this browser.")};
a.prototype.isSupported=function(){return!(!window.requestFileSystem&&!window.webkitRequestFileSystem)};a.prototype.isFull=function(){return this._isFull};a.prototype.getScore=function(){this.initialize();return 5};a.prototype.getStats=function(){this.initialize();return new b.StorageStats};a.prototype._ensureInitializedThen=function(a){var b=null;if(this._isInitialized)a.apply(this,[]);else if(this._isInitializing)b=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(b);
a.apply(e,[])});else{var e=this;this._isInitializing=true;b=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(b);a.apply(e,[])});this.initialize()}};a.prototype._silentlyEnsureInitializeThen=function(a,b){var e=this;this._isInitialized||this._isInitializing||!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?e._ensureInitializedThen(a):this._queryUsageAndQuota(this._storageTypePersistent,function(c,f){c==0&&f==0?b():e._ensureInitializedThen(a)},function(a){a=
e._shapeError(a);e.app.trace.warning("An error occurred while trying to fetch file API usage information: {0}".format(a.toString()))})};a.prototype._requestFileSystem=function(a,b,e,c){if(window.requestFileSystem)window.requestFileSystem(a,b,e,c);else if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(a,b,e,c);else throw Error("No request filesystem method found");};a.prototype._requestQuota=function(a,b,e,c){var f=navigator,h=window;switch(a){case this._storageTypeTemporary:f.webkitTemporaryStorage&&
f.webkitTemporaryStorage.requestQuota?f.webkitTemporaryStorage.requestQuota(b,e,c):h.webkitStorageInfo&&h.webkitStorageInfo.requestQuota&&h.webkitStorageInfo.requestQuota(window.TEMPORARY,b,e,c);break;case this._storageTypePersistent:f.webkitPersistentStorage&&f.webkitPersistentStorage.requestQuota?f.webkitPersistentStorage.requestQuota(b,e,c):h.webkitStorageInfo&&h.webkitStorageInfo.requestQuota&&h.webkitStorageInfo.requestQuota(window.PERSISTENT,b,e,c)}};a.prototype._queryUsageAndQuota=function(a,
b,e){var c=navigator,f=window;switch(a){case this._storageTypeTemporary:c.webkitTemporaryStorage&&c.webkitTemporaryStorage.queryUsageAndQuota?c.webkitTemporaryStorage.queryUsageAndQuota(b,e):f.webkitStorageInfo&&f.webkitStorageInfo.queryUsageAndQuota&&f.webkitStorageInfo.queryUsageAndQuota(window.TEMPORARY,b,e);break;case this._storageTypePersistent:c.webkitPersistentStorage&&c.webkitPersistentStorage.queryUsageAndQuota?c.webkitPersistentStorage.queryUsageAndQuota(b,e):f.webkitStorageInfo&&f.webkitStorageInfo.queryUsageAndQuota&&
f.webkitStorageInfo.queryUsageAndQuota(window.PERSISTENT,b,e)}};a.prototype._writeValue=function(a,b,e,c,f){function h(a){a=k._shapeError(a);c&&c(a)}function i(b){f?k._filesystem.root.getFile(a+".json",{create:true,exclusive:false},b,h):k._filesystem.root.getDirectory(n,{create:true,exclusive:false},function(){k._filesystem.root.getFile(n+"/"+a+".json",{create:true,exclusive:false},b,h)},h)}function l(a){a.createWriter(function(a){a.truncate(0)});a.createWriter(function(a){a.onwriteend=function(a){k.app.trace.debug("Wrote {0} bytes to filesystem.".format(a.total))};
a.onerror=function(a){a=k._shapeError(a);k.app.trace.debug("Write failed: {0}".format(a));c&&c(a)};var d=false;try{var f=false;typeof window.cordova!=="undefined"&&window.cordova.exec&&(a.write(b),f=true);if(!f&&typeof Blob!=="undefined")try{var i=new Blob([b],{type:"text/plain"});a.write(i);f=true}catch(s){k.app.trace.debug('Failed to create blob "'+s+'". Falling back to BlobBuilder.')}if(!f){f=null;typeof BlobBuilder!=="undefined"?f=new BlobBuilder:typeof WebKitBlobBuilder!=="undefined"?f=new WebKitBlobBuilder:
typeof MSBlobBuilder!=="undefined"&&(f=new MSBlobBuilder);if(!f)throw Error("Error writing to File API file: No BlobBuilder implementation found.");f.append(b);a.write(f.getBlob("text/plain"))}}catch(m){d=true,h(m)}d||e()})}var k=this,n=f?"":this.keyNamespace;try{i(l)}catch(p){h(p)}};a.prototype._readValue=function(a,b,e,c){function f(a){a.code&&a.code===FileError.NOT_FOUND_ERR?b(null):(a=h._shapeError(a),e&&e(a))}var h=this;h._filesystem.root.getFile((c?"":this.keyNamespace+"/")+a+".json",{},function(a){a.file(function(a){var d=
new FileReader;d.onloadend=function(){b(this.result)};try{d.readAsText(a)}catch(e){f(e)}},f)},f)};a.prototype._shapeError=function(a){var b="";if(a.hasOwnProperty("code")){switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="Quota Exceeded.";break;case FileError.NOT_FOUND_ERR:b="File not found.";break;case FileError.SECURITY_ERR:b="Security error.";break;case FileError.INVALID_MODIFICATION_ERR:b="Invalid modification.";break;case FileError.INVALID_STATE_ERR:b="Invalid state.";break;default:b="Unknown Error."}a=
Error("File error: {0}.".format(b))}return a};a.prototype.clear=function(a,b){function e(a){b&&(a=c._shapeError(a),b(a))}var c=this;this._silentlyEnsureInitializeThen(function(){c._filesystem.root.getDirectory(this.keyNamespace,{create:false},function(b){b.removeRecursively(function(){a&&a()},e)},function(b){b.code===FileError.NOT_FOUND_ERR?a():e(b)})},a)};a.prototype.clearAllData=function(a,b){var e=this;this._silentlyEnsureInitializeThen(function(){try{var c=e._filesystem.root.createReader(),f=
[],h=0,i=0,l=new dojo.Deferred,k=new dojo.Deferred,n=new dojo.DeferredList([l,k]);n.then(function(){i?b&&b(Error("{0} errors were encountered while clearing the storage provider.".format(i))):a&&a()});n.addErrback(function(a){b&&(a=e._shapeError(a),b(a))});var p=function(){var a=function(){--h;h<=0&&(l.resolve(),k.resolve())},d=function(a){a=e._shapeError(a);e.app.trace.warning("Error removing local file: {0}.".format(a.toString()));--h;++i;h<=0&&l.resolve()},b=function(b){b.remove(a,d)},g=function(a){a=
e._shapeError(a);e.app.trace.warning("Could not obtain file for removal: {0}.".format(a.toString()));k.errback(a)};h=f.length;if(h===0)l.resolve(),k.resolve();else if(f.length===0)l.resolve(),k.resolve();else for(var c=0;c<f.length;++c)try{e._filesystem.root.getFile(f[c],{},b,g)}catch(j){j=e._shapeError(j),n.errback(j)}},r=function(){},v=function(a){a=e._shapeError(a);e.app.trace.warning("Error removing local folder: {0}.".format(a.toString()));++i;k.resolve()},y=function(){c.readEntries(function(a){if(a.length){for(var d=
0;d<a.length;++d){var b=a[d];b.isDirectory?b.removeRecursively(r,v):f.push(b.fullPath)}y()}else p()},function(a){a=e._shapeError(a);b&&b(a)})};y()}catch(u){u=e._shapeError(u),b&&b(u)}},a)};a.prototype.get=function(a,b,e,c){var f=this;this._silentlyEnsureInitializeThen(function(){try{f._readValue(a,b,e,c)}catch(h){h=f._shapeError(h),e&&e(h)}},function(){b(null)})};a.prototype.set=function(a,b,e,c,f){var h=this;this._ensureInitializedThen(function(){try{h._writeValue(a,b,e,c,f)}catch(i){i=h._shapeError(i),
c&&c(i)}})};a.prototype.remove=function(a,b,e,c){var f=this,h=c?"":this.keyNamespace;this._ensureInitializedThen(function(){try{f._filesystem.root.getFile(h+"/"+a+".json",{create:false},function(a){a.remove(b,function(a){a=f._shapeError(a);e&&e(a)})},function(a){a=f._shapeError(a);f.app.trace.debug("Could not obtain file for removal: {0}.".format(a.toString()));e&&e(a)})}catch(c){c=f._shapeError(c),e&&e(c)}})};return a}(b.StorageProviderBase);b.FileStorageProvider=c})(b.storage||(b.storage={}))})(b.framework||
(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(c){function a(){c.apply(this,arguments);this._isFull=false}__extends(a,c);a.prototype.initialize=function(){c.prototype.initialize.call(this);this._localStorage=window.localStorage};a.prototype.isSupported=function(){this._localStorage||this.initialize();return!!this._localStorage};a.prototype.isFull=function(){this._localStorage||this.initialize();return this._isFull};a.prototype.getScore=function(){this._localStorage||this.initialize();return 5};
a.prototype.getStats=function(){this._localStorage||this.initialize();return new b.StorageStats};a.prototype.clear=function(d,b){this._localStorage||this.initialize();for(var e=null,c=RegExp("^"+this.keyNamespace+a._namespaceSeperator),f=0,h=this._localStorage.length;f<h;f++){var i=this._localStorage.key(f);if(c.test(i))try{this._localStorage.removeItem(i),f--,h--}catch(l){e=l}}e!=null?b&&b(e):d&&d()};a.prototype.clearAllData=function(a,b){this._localStorage||this.initialize();try{this._localStorage.clear(),
a&&a()}catch(e){b&&b(e)}};a.prototype.get=function(d,b,e,c){d=c?d:"{0}{1}{2}".format(this.keyNamespace,a._namespaceSeperator,d);this._localStorage||this.initialize();try{var f=this._localStorage.getItem(d);b&&b(f)}catch(h){e&&e(h)}};a.prototype.set=function(d,b,e,c,f){d=f?d:"{0}{1}{2}".format(this.keyNamespace,a._namespaceSeperator,d);this._localStorage||this.initialize();try{this._localStorage.setItem(d,b),e&&e()}catch(h){c&&c(h)}};a.prototype.remove=function(d,b,e,c){d=c?d:"{0}{1}{2}".format(this.keyNamespace,
a._namespaceSeperator,d);this._localStorage||this.initialize();try{this._localStorage.removeItem(d),b&&b()}catch(f){e&&e(f)}};a._namespaceSeperator="\u2192";return a}(b.StorageProviderBase);b.LocalStorageProvider=c})(b.storage||(b.storage={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function c(a,d){this.app=a;this._rootNamespace=this._sanitizeKey(d?d.toString():"framework."+this.app.id)}c.prototype.initialize=function(a){a?this._provider=a:b.HttpStorageProvider.isSupported()?this._provider=new b.HttpStorageProvider(this.app):(a=new b.FileStorageProvider(this.app),this._provider=a.isSupported()?a:new b.LocalStorageProvider(this.app));this._provider.keyNamespace=this._rootNamespace};c.prototype.hasProvider=function(){return this._provider!=
null};c.prototype._yield=function(a){return!a?function(){}:function(){var d=arguments;setTimeout(function(){a.apply(this,d)},0)}};c.prototype._yieldError=function(a){return!a?function(){}:function(){var d=arguments;setTimeout(function(){a.apply(this,d)},0)}};c.prototype._yieldGet=function(a){return!a?function(){}:function(){var d=arguments;setTimeout(function(){a.apply(this,d)},0)}};c.prototype.clear=function(a,d){this._provider&&this._provider.clear(this._yield(a),this._yieldError(d))};c.prototype.clearAllData=
function(a,d){this._provider&&this._provider.clearAllData(this._yield(a),this._yieldError(d))};c.prototype._sanitizeKey=function(a){return a.replace(RegExp("[/\\\\:,?=|]","gm"),"_")};c.prototype.set=function(a,d,b,e,c){var f=new dojo.Deferred,h=this._sanitizeKey(a);this._provider&&this._provider.set(h,d,this._yield(function(){f&&f.fired==-1&&f.resolve(d);b&&b(a,d)}),this._yieldError(function(b){f&&f.fired==-1&&f.resolve(b);e&&e(b,a,d)}),c||false);return f};c.prototype.get=function(a,d,b,e){var c=
new dojo.Deferred,f=this._sanitizeKey(a);this._provider&&this._provider.get(f,this._yieldGet(function(b){c&&c.fired==-1&&c.resolve(b);d&&d(b,a)}),this._yieldError(function(d){c&&c.fired==-1&&c.resolve(d);b&&b(d,a)}),e||false);return c};c.prototype.remove=function(a,d,b,e){var c=new dojo.Deferred,f=this._sanitizeKey(a);this._provider&&this._provider.remove(f,this._yield(function(){c&&c.fired==-1&&c.resolve(a);d&&d(a)}),this._yieldError(function(d){c&&c.fired==-1&&c.resolve(d);b&&b(d,a)}),e||false);
return c};return c}();b.Store=c})(b.storage||(b.storage={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));(function(b){(function(b){(function(b){var c=function(){return function(b,a){this.view=b;this.region=a}}();b.ViewDimensionsChangedArgs=c})(b.events||(b.events={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(i){var h=function(){return function(){}}();i.ViewManagerRegionEntry=h;var f=function(){function a(a){this._views=[];this._hostedRegions=[];this._pendingRegions=[];this.app=a;this._registerCommands()}a.prototype.shutdown=function(){for(var a=0;a<this._hostedRegions.length;++a)this.destroyRegion(this._hostedRegions[a]);for(var b=this._hostedRegions.length=0;b<this._views.length;++b)this.destroyView(this._views[b]);for(a=this._views.length=0;a<this._pendingRegions.length;++a){for(var c=
this._pendingRegions[a],b=0;b<c.views.length;++b)this.destroyView(c.views[b]);c.views=[]}this._pendingRegions.length=0};a.prototype._registerCommands=function(){this.app.commandRegistry.command("ActivateView").register(this,function(a){var b=this.getViewById(a);b?this.activateView(b):this.app.trace.warning("ActivateView: Could not find view '{0}'.".format(a))});this.app.commandRegistry.command("DeactivateView").register(this,function(a){var b=this.getViewById(a);b?this.deactivateView(b):this.app.trace.warning("DeactivateView: Could not find view '{0}'.".format(a))});
this.app.commandRegistry.command("ToggleView").register(this,function(a){var b=this.getViewById(a);b?this.toggleView(b):this.app.trace.warning("ToggleView: Could not find view '{0}'.".format(a))});this.app.commandRegistry.command("DestroyView").register(this,function(a){var b=this.getViewById(a);b?this.destroyView(b):this.app.trace.warning("DestroyView: Could not find view '{0}'.".format(a))})};a.prototype.activateView=function(a){if(!a.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to activateView."),
false;var b=this.getRegionForViewId(a.id);if(!b){if(!a.regionName)return this.app.trace.warning("Could not activate view '{0}' - view is not associated with a region.".format(a.id)),false;if(b=this.getExistingRegionByName(a.regionName))return b.hostView(a),b.activateView(a),true;else(b=this._getPendingRegionEntryByName(a.regionName))?c.utils.ArrayUtils.contains(b.views,a)?this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(a.id,a.regionName)):b.views.push(a):(b=new h,b.name=
a.regionName,b.views=[a],this._pendingRegions.push(b));return false}b.activateView(a);return true};a.prototype.deactivateView=function(a){if(!a.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to deactivateView."),false;var b=this.getRegionForViewId(a.id);if(!b)return this.app.trace.debug("Could not find region for view '{0}'.".format(a.id)),false;b.deactivateView(a);return true};a.prototype.toggleView=function(a){a.isActive?this.deactivateView(a):this.activateView(a)};
a.prototype.createView=function(a){var g=a.viewId||a.id;if(g&&this.getViewById(g))this.app.trace.error("Could not create view '{0}' - a view with that ID already exists.".format(g));else{var e=a.typeName||a.type||"geocortex.framework.ui.ViewBase",f=null;try{f=this.app.instantiateFrameworkObject(e,a.libraryId)}catch(i){return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(e),i),null}e=a.isVisible||a.visible;f.id=g==null?"View-"+
b.framework.utils.alphaNumericToken():g;f.markupResource=a.markupResource||a.markup;f.regionName=a.regionName||a.region;f.configuration=a.configuration||{};f.isManaged=a.isManaged||false;f.title.set(a.title||"");f.description.set(a.description);f.iconUri.set(a.iconUri);if(a.viewModel)f.viewModel=a.viewModel;this._views.push(f);if(f.regionName)(a=this.getExistingRegionByName(f.regionName))?(a.hostView(f),e&&a.activateView(f)):(e&&(f.___shouldActivate=true),(a=this._getPendingRegionEntryByName(f.regionName))?
c.utils.ArrayUtils.contains(a.views,f)?this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(f.id,f.regionName)):a.views.push(f):(a=new h,a.name=f.regionName,a.views=[f],this._pendingRegions.push(a)));else if(a=b.resourceManager.fetch(f.markupResource,f.libraryId),a==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(f.markupResource,f.libraryId)),null;else if(f.root=dojo.create("div"),f.root.innerHTML=a,f.root.children&&f.root.children.length===
1)f.root=f.root.children[0];return f}};a.prototype.create=function(a,c,e,f){a=new b.framework.config.ViewConfig(null,null,a);a.markupResource=e;a.regionName=f;a.configuration={};e=this.createView(a);if(e===null)return e;var h;try{h=this.app.instantiateFrameworkObject(c||"geocortex.framework.ui.ViewModelBase",null.libraryId),h.initialize({})}catch(i){return this.app.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(a.typeName,
i.message),i),null}e.attach(h);this.activateView(e);return e};a.prototype.destroyView=function(a){for(var b=this.getRegionForViewId(a.id),e=window.document.activeElement;e;){if(a.root===e){window.document.activeElement.blur();break}e=e.parentElement}b!=null&&(b.deactivateView(a),b.unhostView(a));a.destroy();if(a.childRegions!=null)for(b=0;b<a.childRegions.length;++b)this.destroyRegion(a.childRegions[b]);a.childRegions.length=0;a.root!=null&&(b=new dojo.NodeList,b.push(a.root),b.orphan());c.utils.ArrayUtils.removeItem(this._views,
a);a.onDestroy()};a.prototype.destroyRegion=function(a){if(a.views!=null)for(var b=a.views.length-1;b>=0;b--)this.destroyView(a.views[b]);c.utils.ArrayUtils.removeItem(this._hostedRegions,a);a.unhost()};a.prototype.discoverRegions=function(a,b){var c=this;a!=null&&dojo.query("[data-region-name]",a).forEach(function(a){var d=dojo.attr(a,"data-region-name");if(c.getExistingRegionByName(d))c.app.trace.error("Region '{0}' already exists.".format(d));else{var f=c._getPendingRegionEntryByName(d),h=null;
f&&c._removePendingRegionEntry(d);var i=dojo.attr(a,"data-region-adapter"),k=null;try{i||(i="geocortex.framework.ui.DivRegionAdapter"),k=dojo.getObject(i,true),h=new k(d,c.app)}catch(n){return c.app.trace.error("Could not instantiate region with type '{0}' - type was not found.".format(i),n),null}i=dojo.attr(a,"data-region-options");d={};if(i){i=i.split(",");for(k=0;k<i.length;k++){var p=i[k].split("=");d[p[0]]=p.length>1?p[1]:""}}h.host(a,d);c._hostedRegions.push(h);if(b!=null)b.childRegions.push(h),
h.ownerView=b;if(f)for(a=0;a<f.views.length;++a)d=f.views[a],c._views.push(d),h.hostView(d),d.___shouldActivate&&(delete d.___shouldActivate,h.activateView(d))}})};a.prototype.getExistingRegionByName=function(a){for(var b=0;b<this._hostedRegions.length;++b){var c=this._hostedRegions[b];if(c.name==a)return c}return null};a.prototype._getPendingRegionEntryByName=function(a){for(var b=0;b<this._pendingRegions.length;++b){var c=this._pendingRegions[b];if(c.name==a)return c}return null};a.prototype._removePendingRegionEntry=
function(a){for(var b=-1,e=0;e<this._pendingRegions.length;++e)if(this._pendingRegions[e].name==a){b=e;break}return e>-1?(c.utils.ArrayUtils.remove(this._pendingRegions,b,b),true):false};a.prototype.getRegionForViewId=function(a){for(var b=0;b<this._hostedRegions.length;++b)for(var c=this._hostedRegions[b],f=0;f<c.views.length;++f)if(c.views[f].id===a)return c;return null};a.prototype.getViewById=function(a){for(var b=0;b<this._views.length;++b){var c=this._views[b];if(c.id&&c.id===a)return c}};a.prototype.getViews=
function(){return this._views};a.prototype.notifyDimensionsChanged=function(a){var c=this.getRegionForViewId(a.id),a=new b.framework.events.ViewDimensionsChangedArgs(a,c);this.app.eventRegistry.event("ViewDimensionsChangedEvent").publish(a)};return a}();i.ViewManager=f})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(a){this.app=a}b.prototype._traceImpl=function(a,d,b){(!(a==="debug"||a==="trace")||this.app.debugMode)&&this.app&&this.app.event("TraceEvent").publish({level:a,timestamp:new Date,message:d,stack:b})};b.prototype._stackTraceFromException=function(a){return typeof a!=="undefined"?a.stack||a.backtrace||a.stacktrace:null};b.prototype.debug=function(a){this._traceImpl("debug",a)};b.prototype.trace=function(a){this._traceImpl("trace",a)};
b.prototype.info=function(a){this._traceImpl("info",a)};b.prototype.alert=function(a){this._traceImpl("alert",a)};b.prototype.warning=function(a){this._traceImpl("warning",a)};b.prototype.error=function(a,d){this._traceImpl("error",a,this._stackTraceFromException(d))};b.prototype.exception=function(a,d){this._traceImpl("error",a,this._stackTraceFromException(d))};return b}();b.Trace=c})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(i){var h=function(b){function a(a,c){b.call(this,a,c);this.behaviorNames=[];this.configuration={}}__extends(a,b);a.prototype.initialize=function(a){this.configuration=a;this.behaviorNames=this.app.behaviorRegistry.loadBehaviorsFromConfig(this,a)};a.prototype.onDestroy=function(){b.prototype.onDestroy.call(this);for(var a=0;a<this.behaviorNames.length;a++)this.app.behaviorRegistry.remove(this.behaviorNames[a]);this.behaviorNames.length=0};a.prototype.shutdown=function(){};
return a}(b.FrameworkObject);i.ModuleBase=h})(b.application||(b.application={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(a){this._modules={};this.app=a}b.prototype.shutdown=function(a){for(var d in this._modules)this._modules.hasOwnProperty(d)&&(this._modules[d].shutdown(a),this._modules[d].destroy());this._modules={}};b.prototype.instantiate=function(a,d){return a==null?null:this.app.instantiateFrameworkObject(a,d)};b.prototype.markModuleLoaded=function(a,d){this._modules[a]=d;this.app.event("ModuleInitializedEvent").publish(a)};b.prototype.moduleIsLoaded=
function(a){return this._modules[a]!=null};b.prototype.notifyModuleLoaded=function(a,d){if(this.moduleIsLoaded(a)&&d!=null)d(a);else var b=this.app.event("ModuleInitializedEvent").subscribe(this,function(c){if(c==a)try{d(c)}finally{this.app.event("ModuleInitializedEvent").unsubscribe(b)}})};return b}();b.ModuleManager=c})(b.application||(b.application={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(i){var h=function(){function f(a,d,g,e){this.version="2.5";this.allowCrossDomainConfig=false;this.configuration={};this.localServerAddress="";this.urlParameters={};this.allLibrariesLoaded=this.isHttpsMode=this.developmentMode=false;this.modalRegionSingleton=this.configPreprocessor=null;this._resourceDictionaries={};this.frameworkObjects={};this.id=g||"default";this.configTokens=e||{};this.trace=new c.utils.Trace(this);this.moduleManager=new b.framework.application.ModuleManager(this);
this.commandRegistry=new b.framework.commands.CommandRegistry(this);this.eventRegistry=new b.framework.events.EventRegistry(this);this.behaviorRegistry=new b.framework.behaviors.BehaviorRegistry(this);this.viewManager=new b.framework.ui.ViewManager(this);this.command=dojo.hitch(this.commandRegistry,this.commandRegistry.command);this.event=dojo.hitch(this.eventRegistry,this.eventRegistry.event);this.behavior=dojo.hitch(this.behaviorRegistry,this.behaviorRegistry.behavior);this.hostElement=d||dojo.body();
this.store=new b.framework.storage.Store(this,this.id);this.store.initialize();a==null?this.configModel=new c.config.ConfigurationModel(this):typeof a==="object"?(this.configObject=a,this.configUri=null):(this.configModel=null,this.configUri=a.trim());this.isOffline=new Observable(false);this.isOffline.bind(this,function(a){a?this.eventRegistry.event("ApplicationOfflineEvent").publish():this.eventRegistry.event("ApplicationOnlineEvent").publish()});this.isNative=new Observable(false);this.isNative.bind(this,
function(a){a?this.eventRegistry.event("ApplicationNativeReadyEvent").publish():this.eventRegistry.event("ApplicationNativeRemovedEvent").publish()});b.framework.application.ApplicationCommands.createCommands(this);a=document.URL;a=a.substring(a.indexOf("?")+1,a.length);this.urlParameters=dojo.queryToObject(a)||{};a=window.location.protocol;a.indexOf(":")<0&&(a+=":");d=window.location.pathname.lastIndexOf("/");g="/";d>-1&&(g=window.location.pathname.substr(0,d));g===""&&(g="/");this.host=a+"//"+window.location.host.trim()+
g.trim();this.host.charAt(this.host.length-1)!=="/"&&(this.host+="/");this.isHttpsMode=this.isHttpsUri(this.host);this.detectBrowserLocale();b.framework.registerApplication(this)}f.prototype.getLibraryOrder=function(a){if(!this.configModel.libraryConfigs)return null;for(var d=0;d<this.configModel.libraryConfigs.length;++d)if(this.configModel.libraryConfigs[d].id===a)return d;return null};f.prototype.shouldOmitStylesForLibrary=function(a){if(!this.configModel.libraryConfigs)return null;for(var d=0;d<
this.configModel.libraryConfigs.length;++d){var b=this.configModel.libraryConfigs[d];if(b.id===a)return!!b.omitStyles}return false};f.prototype.translateConfiguration=function(a,d){var b=this,c=function(d,f,h){if(typeof f==="string"){if(f.indexOf("@language")>-1){var j=f.split("-");if(j.length<2)throw Error("Invalid language key '{0}'.".format(f));f=j.join("-").replace("@","");return b.getResource(h||a,f)}return b.performTokenReplacement(f)}else if(f instanceof Array){h=[];for(j=0;j<f.length;++j)h.push(c(j,
f[j]));return h}else if(f instanceof Function)return f;else if(f instanceof Object){h={};d=f.hasOwnProperty("libraryId")?f.libraryId:void 0;for(j in f)f.hasOwnProperty(j)&&(h[j]=c(j,f[j],d));return h}else return f},f={},h;for(h in d)d.hasOwnProperty(h)&&(f[h]=c(h,d[h]));return f};f.prototype.performTokenReplacement=function(a){var d=this;return!a?a:a.replace(/{.+?}/g,function(a){var b=a.substring(1,a.length-1),a=d.configTokens.hasOwnProperty(b)?d.configTokens[b]:a;return!a&&d.configuration&&d.configuration.hasOwnProperty(b)?
d.configuration[b]:a?a:(d.trace.warning("The token syntax \\{{0}\\} was detected, but could not be matched to a valid replacement.".format(b)),"")})};f.prototype.isHttpsUri=function(a){a=a.trim();return a.indexOf("://")>-1&&a.length>=5&&a.substring(0,5)==="https"};f.prototype.makeAbsolute=function(a,d){if(!(new dojo._Url(a)).host){var b=d?d:"{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if(b.charAt(b.length-1)!="/"||b.charAt(b.length-1)!="\\")b=b.split("/"),
--b.length,b=b.join("/"),b+="/";if(a.charAt(0)=="/"||a.charAt(0)=="\\")a=window.location.protocol+"//"+window.location.host+"/"+a.substring(1);else{for(var c=b.split("/"),b=a?a.split("../"):[],f=0,h=0;h<b.length;++h)b[h]==""&&++f;c=c.slice(0,c.length-(f>0?f+1:f));b=b.slice(f>0?f-1:f);a=c.join("/")+b.join("/")}}return a};f.prototype.getHostElement=function(){return this.hostElement};f.prototype.getResource=function(a,d,b){b=b||this.locale||"inv";b=b.toLowerCase();if(!this._resourceDictionaries||!this._resourceDictionaries.inv)throw Error("The application is missing its invariant resources.");
var c=this._resourceDictionaries[b],f=this._resourceDictionaries.inv;c||(c=f);var h=c[a]||f[a];if(!h)return this.trace.warning("No resource dictionary found for library '{0}' while trying to get resource with key '{1}', using locale '{2}'.".format(a,d,b)),"@"+d;var i=null;if(h.hasOwnProperty(d))i=h[d];else if(c===f)return"@"+d;else if(h=f[a],h.hasOwnProperty(d)===false)return this.trace.warning("The resource with key '{0}' was not found in library '{1}'.".format(d,a)),"@"+d;else i=h[d];if(b==="debug")return this._getDebugLocaleString(i);
else if(b==="strings")return d;return i};f.prototype.getUri=function(a){var b=false;return(b=a.indexOf("://")<0)?(a=this.host+a,this.isHttpsUri(a)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(a)),this.proxyUri!=null&&!String.isNullOrEmpty(this.proxyUri)?this.proxyUri+encodeURIComponent(a):a):(this.isHttpsUri(a)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(a)),this.proxyUri+encodeURIComponent(a))};
f.prototype.getUrlParameter=function(a){if(this.urlParameters)for(var b in this.urlParameters)if(this.urlParameters.hasOwnProperty(b)&&!String.isNullOrEmpty(b)&&!String.isNullOrEmpty(a)&&b.toLowerCase()===a.toLowerCase())return this.urlParameters[b];return null};f.prototype.onLibrariesDownloaded=function(){};f.prototype.onConfigurationLoaded=function(){};f.prototype.notifyLibraryDownload=function(a){this.trace.info("Processing downloaded library '{0}' for application '{1}'.".format(a,this.id));this.eventRegistry.event("LibraryDownloadedEvent").publish(a);
var d=b.resourceManager.fetchAllFor(a,"json");if(d&&d.length>0)for(var c=0;c<d.length;++c){var e=d[c],f=b.resourceManager.fetch(e.name,e.library,e.locale);this.injectLibraryResources(a,f,e.locale)}this.configModel&&(d=this.configModel.libraryModules[a],d==null?this.trace.warning("No modules found for library '{0}' in application '{1}'.".format(a,this.id)):(this.initializeModules(d),this.pendingLibraryDownloads>0&&--this.pendingLibraryDownloads,this._doIfNoPendingLibraryDownloads()))};f.prototype.hasLibrary=
function(a){return b.framework.hasLibrary(a)&&!!this.configModel.libraryModules[a]&&this._resourceDictionaries.inv&&!!this._resourceDictionaries.inv[a]};f.prototype.registerFrameworkObject=function(a){if(!a.id)throw Error("Could not register framework object. Object was missing an ID.");return this.frameworkObjects[a.id]=a};f.prototype.freeAllFrameworkObjects=function(){};f.prototype.getFrameworkObjectById=function(a){for(var b in this.frameworkObjects)if(this.frameworkObjects.hasOwnProperty(b)&&
b===a)return this.frameworkObjects[b];return null};f.prototype.initialize=function(){var a=this;dojo.connect(window,"onresize",function(){a.eventRegistry.event("ApplicationResizedEvent").publish()});dojo.subscribe("ServiceTokenRefreshed",function(b){if(a.configuration&&b.serviceUrl===a.configuration.geometryServiceUrl)a.configuration.geometryServiceToken=b.token});var d=new b.framework.config.ConfigurationLoader(this),c=function(d){typeof d=="string"&&(d=JSON.parse(d));if(a.configPreprocessor)a.configPreprocessor(d),
a.configPreprocessor=null;var c=new b.framework.config.ConfigurationModel(a);a.onConfigurationLoaded(d);a.abortInitialization||c.parse(d,function(b){return a.processConfiguration(b)})};if(this.configModel!=null)throw Error("Configuration model should not be loaded already");else if(this.configObject!=null)c(this.configObject),this.configObject=null;else if(this.configUri!=null)d.loadConfigurationTree(this.configUri,function(a){return c(a)});else throw Error("No configuration method");this.viewManager.discoverRegions(this.hostElement)};
f.prototype.shutdown=function(a){this.eventRegistry.event("ApplicationShutdownEvent").publish(a);this.viewManager.shutdown();this.moduleManager.shutdown(a);this.commandRegistry.clear();this.eventRegistry.clear()};f.prototype._doIfNoPendingLibraryDownloads=function(){if(this.pendingLibraryDownloads===0)b.resourceManager&&b.resourceManager.performThemeInjection(),this.allLibrariesLoaded=true,this.eventRegistry.event("ViewerLibrariesDownloadedEvent").publish(this),this.onLibrariesDownloaded(this)};f.prototype.onInitializationComplete=
function(){this.initializationCompleteCallback!=null&&this.initializationCompleteCallback!=void 0&&this.initializationCompleteCallback(this)};f.prototype.detectBrowserLocale=function(){this.locale=navigator.language?navigator.language:navigator.userLanguage?navigator.userLanguage:navigator.browserLanguage?navigator.browserLanguage:"inv"};f.prototype.downloadLibraries=function(a){this.pendingLibraryDownloads=a.libraryConfigs.length;for(var d=0;d<a.libraryConfigs.length;++d){var c=a.libraryConfigs[d];
b.framework.hasLibrary(c.id)===true?this.notifyLibraryDownload(c.id):(b.framework.libraries[c.id]=false,this.includeScript(c.uri,function(){},function(){}))}};f.prototype.injectLibraryResources=function(a,b,c){c=c.toLowerCase();this._resourceDictionaries.hasOwnProperty(c)===false?(this._resourceDictionaries[c]={},this._resourceDictionaries[c][a]=b):this._resourceDictionaries[c].hasOwnProperty(a)===false?this._resourceDictionaries[c][a]=b:dojo.mixin(this._resourceDictionaries[c][a],b)};f.prototype.instantiateFrameworkObject=
function(a,b){for(var c=a.split("."),e=window,f=0;f<c.length&&typeof e==="object";f++)e=e[c[f]];c=null;typeof e==="function"&&(c=new e(this,b));if(!c)try{c=new (dojo.getObject(a))(this,b)}catch(h){this.trace.error("Could not instantiate object of type '{0}': '{1}'".format(a,h),h)}return c};f.prototype.includeScript=function(a,b,c){var e=this;dojo.io.script.get({url:a,preventCache:this.debugMode,load:function(c){try{b&&b(c)}catch(f){e.trace.error("Error while including script '{0}': {1}".format(a,
f),f)}},error:function(b){e.trace.error("Error while including script '{0}': {1}".format(a,b),b);e.pendingLibraryDownloads>0&&e.pendingLibraryDownloads--;e._doIfNoPendingLibraryDownloads();c&&c(b)}})};f.prototype.processConfiguration=function(a){var b=this;this.configuration=a.application||{};this.configModel=a;this.eventRegistry.event("AppConfigLoaded").publish(this.configModel);this.eventRegistry.event("ApplicationConfigLoadedEvent").publish(this.configModel);if(this.configuration&&this.configuration.locale)this.locale=
this.configuration.locale;if(this.urlParameters&&this.getUrlParameter("locale"))this.locale=this.getUrlParameter("locale");dojo.locale=this.locale;this.pendingLocaleDownloads=a.externalLocaleReferences.length;if(this.pendingLocaleDownloads==0)this.downloadLibraries(a);else for(var c=0;c<a.externalLocaleReferences.length;++c)(function(c){b.fetchConfigResource({url:c.uri,handleAs:"json",load:function(f){try{if(f)if(f.hasOwnProperty("locales"))for(var g in f)f.hasOwnProperty(g)&&b.injectLibraryResources(c.libraryId,
f[g],g);else if(c.hasOwnProperty("locale"))b.injectLibraryResources(c.libraryId,f,c.locale);else throw Error("Locale reference missing 'locale' identifier.");else b.trace.warning("Error loading locale '{0}' for library '{1}' from offline storage.".format(c.locale,c.libraryId))}catch(h){b.trace.error("Error fetching external locale resource {0}: {1}".format(c.uri,h.message),h)}finally{--b.pendingLocaleDownloads,b.pendingLocaleDownloads<1&&b.downloadLibraries(a)}},error:function(f){b.trace.error("Error fetching external locale resource {0}: {1}".format(c.uri,
f.message),f);--b.pendingLocaleDownloads;b.pendingLocaleDownloads<1&&b.downloadLibraries(a)}})})(a.externalLocaleReferences[c])};f.prototype.addNativeReadyFunction=function(a){if(typeof gcxNativeReady!=="undefined")a&&a();else{var b=gcxNativeReadyCallback;gcxNativeReadyCallback=function(){b&&b();a&&a()}}};f.prototype.initializeModules=function(a){for(var d={},c=0;c<a.length;++c){var e=a[c];if(!this.moduleManager.moduleIsLoaded(e.moduleName)){var f=this.translateConfiguration(e.libraryId,e.configuration),
h=this.moduleManager.instantiate(e.moduleType,e.libraryId);if(h===null)this.trace.error("Could not instantiate module with type '{0}' - type not found or constructor failed.".format(e.moduleType));else{if(h.initialize){this.trace.info("Initializing module '{0}'.".format(e.moduleName));try{h.initialize(f),h.id="module-{0}-{1}".format(e.libraryId,e.moduleName),this.registerFrameworkObject(h)}catch(i){this.trace.error("Error initializing module '{0}': {1}.".format(e.moduleName,i.message),i);continue}this.moduleManager.markModuleLoaded(e.moduleName,
h);this.trace.debug("Module '{0}' initialized.".format(e.moduleName))}if(e.viewModelConfigs&&e.viewModelConfigs.length>0)for(h=0;h<e.viewModelConfigs.length;++h){var m=e.viewModelConfigs[h];if(d[m.viewModelId])this.trace.error("ViewModel '{0}' already exists in module '{1}'.".format(m.viewModelId,e.moduleName));else{var l=null;try{l=this.instantiateFrameworkObject(m.typeName,m.libraryId),l.id=m.viewModelId||b.framework.utils.alphaNumericToken(),f=this.translateConfiguration(e.libraryId,m.configuration),
l.initialize(f),d[m.viewModelId]=l,this.registerFrameworkObject(l)}catch(k){this.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(m.typeName,k.message),k)}}}}}}for(c=0;c<a.length;++c)if(e=a[c],e.viewConfigs)for(h=0;h<e.viewConfigs.length;++h)if(f=e.viewConfigs[h],!this.getFrameworkObjectById(f.viewId))f=this.translateConfiguration(e.libraryId,f),m=null,f.viewModelId?(m=d[f.viewModelId])?m.libraryId=m.libraryId||e.libraryId:
this.trace.error("Could not attach view model '{0}' to view '{1}' - view model not found.".format(f.viewModelId,f.viewId)):m=new b.framework.ui.ViewModelBase(this,e.libraryId),f.viewModel=m,(m=this.viewManager.createView(f))?this.registerFrameworkObject(m):this.trace.warning("Could not instantiate view with type '{0}'.".format(f.typeName));if(this.initializationCompleteCallback)this.onInitializationComplete(),this.initializationCompleteCallback=null};f.prototype.fetchConfigResource=function(a){var d=
document.createElement("a");try{d.href=a.url;d.style.display="none";document.body.appendChild(d);var c=b._configDomains;if(!d.hostname||["protocol","hostname"].every(function(a){return d[a]===window.location[a]})||c&&c[d.protocol+"//"+d.hostname]==true)return dojo.xhrGet(a);else{var e=Error("Could not load viewer because the specified configuration file is not on the same domain as the viewer ({0}).".format(a.url));e.name="ConfigurationDomainMismatch";throw e;}}finally{document.body.removeChild(d)}};
f.prototype._getDebugLocaleString=function(a){for(var b=[9728,9983],c=[],e=0;e<a.length;++e)c.push(Math.floor(Math.random()*(b[1]-b[0]))+b[0]);return String.fromCharCode.apply(String,c)};return f}();i.Application=h})(c.application||(c.application={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(c){var h=function(){function c(){this.resources=[];this.cachedResources={};this.themesToInject=[]}c.prototype.fetch=function(a,d,c){var c=c||"inv",e="{0}-{1}-{2}".format(d,c,a);if(this.cachedResources.hasOwnProperty(e))return this.cachedResources[e];a=this.findResource(a,d,c);if(!a)return null;d=null;switch(a.format){case "css":case "html":d=b.framework.utils.base64Decode(a.data);this.cachedResources[e]=d;break;case "json":d=b.framework.utils.base64Decode(a.data);
d=JSON.parse(d);this.cachedResources[e]=d;break;default:return null}return d};c.prototype.fetchAllFor=function(a,b){for(var c=[],e=0;e<this.resources.length;++e){var f=this.resources[e];f.library==a&&!(b!=null&&f.format!=b)&&c.push(f)}return c};c.prototype.register=function(a,b,c,e,f){if(!this.findResource(c,a)){var h={};h.name=c;h.library=a;h.locale=b;h.format=e;h.data=f;this.resources.push(h)}};c.prototype.remove=function(a,b,c){var e=this.findResource(b,a,c);return e!=null?(Array.removeItem(this.resources,
e),a="{0}-{1}-{2}".format(a,c,b),this.cachedResources.hasOwnProperty(a)&&delete this.cachedResources[a],true):false};c.prototype.injectTheme=function(a){this.themesToInject.push(a)};c.prototype.performThemeInjection=function(){for(var a=dojo.query("head")[0],b=0;b<this.themesToInject.length;++b){var c=dojo.create("link",{rel:"stylesheet",href:this.themesToInject[b]});dojo.place(c,a,"last")}};c.prototype.findResource=function(a,b,c){for(var c=c||"inv",e=0;e<this.resources.length;++e){var f=this.resources[e];
if(f.name==a&&!(b!=null&&f.library!=b)&&f.locale==c)return f}return null};return c}();c.ResourceManager=h})(c.application||(c.application={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));(function(b){b.resourceManager=new b.framework.application.ResourceManager})(geocortex||(geocortex={}));
(function(b){(function(c){c.applications=[];c.libraries={};c.injectedStyleBlocks=[];c.initialized=false;c.registerApplication=function(c){b.framework.applications.push(c)};c.hasLibrary=function(c){return b.framework.libraries[c]===true};c.notifyLibraryDownload=function(c){if(!b.framework.hasLibrary(c)){b.framework.libraries[c]=true;for(var h=0,f=false,a=0;a<b.framework.applications.length;++a){var d=b.framework.applications[a],g=d.getLibraryOrder(c);d.shouldOmitStylesForLibrary(c)===false&&(f=true);
if(g){h=g+a*32;break}}if(f){(a=b.resourceManager.fetchAllFor(c,"css"))||(a=[]);f="";d=dojo.query("head")[0];for(g=0;g<a.length;++g){var e=a[g];(e=b.resourceManager.fetch(e.name,e.library))&&(f+=e+" ")}a=document.createElement("style");b.framework.injectedStyleBlocks.push(a);a.setAttribute("type","text/css");dojo.attr(a,"data-block-order",h);if(h===0)dojo.place(a,d,"first");else if(g=dojo.query("head style[data-block-order]"),g.length===0)dojo.place(a,d,"first");else{for(var d=null,e=false,j=0;j<g.length;++j){var s=
g[j];if((dojo.attr(s,"data-block-order")||0)>=h){dojo.place(a,s,"before");e=true;break}else d=s}e||dojo.place(a,d,"after")}a.styleSheet?a.styleSheet.cssText=f:(h=document.createTextNode(f),a.appendChild(h))}for(a=0;a<b.framework.applications.length;++a)d=b.framework.applications[a],d.notifyLibraryDownload(c)}};c.initialize=function(){if(!b.framework.initialized)b.utils=b.framework.utils,b.framework.initialized=true}})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));geocortex.framework.initialize();
(function(b){(function(c){(function(i){var h=function(f){function a(a,b){f.call(this,a,b)}__extends(a,f);a.prototype.unhostAllViews=function(){for(var a=0;a<this.views.length;++a)this.unhostView(this.views[a]);this.views.length=0};a.prototype.hostView=function(a){this.unhostAllViews();this.views.push(a);if(a.root==null){var c=b.resourceManager.fetch(a.markupResource,a.libraryId);if(c===null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,
a.libraryId)),false;a.root=dojo.create("div",{className:"view {0}".format(a.id)});a.root.innerHTML=c;dojo.place(a.root,this.domElement,"last");a.viewModel&&a.attach(a.viewModel);this.app.viewManager.discoverRegions(a.root,a)}else dojo.place(a.root,this.domElement,"only");f.prototype.hostView.call(this,a);return true};a.prototype.unhostView=function(a){this.deactivateView(a);c.utils.ArrayUtils.removeItem(this.views,a);var b=new dojo.NodeList;b.push(a.root);b.orphan();f.prototype.unhostView.call(this,
a)};return a}(i.RegionAdapterBase);i.DivRegionAdapter=h})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(i){var h=function(f){function a(a,b){f.call(this,a,b);this.activeViews=[];this.activateViewsInLastPosition=true}__extends(a,f);a.prototype.host=function(a,b){f.prototype.host.call(this,a,b);if(this.options.activateViewsInLastPosition==="false")this.activateViewsInLastPosition=false};a.prototype.activateView=function(a){c.utils.ArrayUtils.contains(this.activeViews,a)&&c.utils.ArrayUtils.removeItem(this.activeViews,a);this.activeViews.push(a);this.activateViewsInLastPosition&&
dojo.place(a.root,this.domElement,"last");f.prototype.activateView.call(this,a)};a.prototype.deactivateView=function(a){a.isActive=false;c.utils.ArrayUtils.removeItem(this.activeViews,a);this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1]);f.prototype.deactivateView.call(this,a)};a.prototype.hostView=function(a){this.views.push(a);if(a.root==null){var c=b.resourceManager.fetch(a.markupResource,a.libraryId);if(c==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,
a.libraryId)),false;var e=this.getHostedTagName();a.root=dojo.create(e,{className:"view {0}".format(a.id)});a.root.innerHTML=c;dojo.place(a.root,this.domElement,"last");a.viewModel&&a.attach(a.viewModel);this.app.viewManager.discoverRegions(a.root,a)}else dojo.place(a.root,this.domElement,"last");f.prototype.hostView.call(this,a);return true};a.prototype.unhostView=function(a){this.deactivateView(a);c.utils.ArrayUtils.removeItem(this.views,a);c.utils.ArrayUtils.removeItem(this.activeViews,a);var b=
new dojo.NodeList;b.push(a.root);b.orphan();f.prototype.unhostView.call(this,a)};a.prototype.getHostedTagName=function(){return!this.options||!this.options.tagName?"div":this.options.tagName};return a}(i.RegionAdapterBase);i.DivStackRegionAdapter=h})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(c){(function(i){var h=function(f){function a(){f.apply(this,arguments)}__extends(a,f);a.prototype.activateView=function(a){this.hideAllViews();if(this.activeViews.length>0){var b=this.activeViews[this.activeViews.length-1];b!==a&&(this.cancelActivate(b),b.deactivated())}f.prototype.activateView.call(this,a)};a.prototype.deactivateView=function(a,b){if(b===void 0||b===null)b=true;f.prototype.deactivateView.call(this,a);b&&this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-
1])};a.prototype.hideAllViews=function(){dojo.query("> .view",this.domElement).removeClass("active");dojo.query("> .view",this.domElement).addClass("inactive")};a.prototype.hostView=function(a){this.views.push(a);if(a.root==null){var c=b.resourceManager.fetch(a.markupResource,a.libraryId);if(c==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,a.libraryId)),false;var e=this.getHostedTagName();a.root=dojo.create(e,{className:"view {0}".format(a.id)});
a.root.innerHTML=c;dojo.place(a.root,this.domElement,"last");a.viewModel&&a.attach(a.viewModel);this.app.viewManager.discoverRegions(a.root,a)}else dojo.place(a.root,this.domElement,"last");f.prototype.hostView.call(this,a);return true};a.prototype.getHostedTagName=function(){return!this.options||!this.options.tagName?"div":this.options.tagName};a.prototype.unhostView=function(a){this.deactivateView(a);c.utils.ArrayUtils.removeItem(this.views,a);c.utils.ArrayUtils.removeItem(this.activeViews,a);var b=
new dojo.NodeList;b.push(a.root);b.orphan();f.prototype.unhostView.call(this,a)};return a}(i.RegionAdapterBase);i.MultiViewRegionAdapter=h})(c.ui||(c.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(b){function a(){b.apply(this,arguments)}__extends(a,b);a.prototype.getHostedTagName=function(){return"div"};return a}(b.MultiViewRegionAdapter);b.MultiDivRegionAdapter=c})(b.ui||(b.ui={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){(function(b){function c(){d===null&&(d=(new Date).getTimezoneOffset());return d}var a=/(Z|([+-][012]\d(:?\d\d)?))\s*$/;b.containsTimezone=function(b){return a.test(b)};var d=null,g=null;b.getTimezoneOffset=c;b.getTimezoneString=function(){if(g==null){var a=c(),b=Math.floor(a/60),a=Math.floor(a-b*60);if(b==0&&a==0)return"Z";b<0?(b*=-1,g="+"):g="-";g+=b==0?"00":b<10?"0"+b:b;g+=a==0?":00":a<10?":0"+a:":"+a}return g};(function(){var a=new Date("2011-06-02T09:34:29+02:00");
Date.fromISO=!a||+a!==1307000069E3?function(a){var b,d=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/.exec(a)||[];if(d[1]){a=d[1].split(/\D/);b=0;for(var c=a.length;b<c;b++)a[b]=parseInt(a[b],10)||0;a[1]-=1;a=new Date(Date.UTC.apply(Date,a));if(!a.getDate())return NaN;d[5]&&(b=parseInt(d[5],10)*60,d[6]&&(b+=parseInt(d[6],10)),d[4]=="+"&&(b*=-1),b&&a.setUTCMinutes(a.getUTCMinutes()+b));return a}return NaN}:function(a){return new Date(a)}})();Date.prototype.toISOString||function(){function a(b){b=
String(b);b.length===1&&(b="0"+b);return b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}()})(b.DateUtils||(b.DateUtils={}))})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(a,d,c){this.delayMS=0;this.func=null;this.delayMS=a;this.func=c?function(){d.apply(c)}:d}b.prototype.start=function(){this._timerHandle=setTimeout(this.func,this.delayMS)};b.prototype.stop=function(){clearTimeout(this._timerHandle)};b.prototype.reset=function(){this.stop();this.start()};return b}();b.TimeDelayedAction=c})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(b){function a(a){b.call(this,a);this.fileStorageEndpoint="/filesystem";this._initialized=false;this.localServerAddress=this.app.localServerAddress?this.app.localServerAddress:"http://127.0.0.1:8181"}__extends(a,b);a.prototype.initialize=function(){if(!this._initialized){!window.require.has("esri-cors")&&window.Modernizr.cors&&(delete window.require.has.cache["esri-cors"],window.require.has.add("esri-cors",function(){return true}));var a=this.localServerAddress.replace("http://",
"");window.esri.config.defaults.io.corsEnabledServers.push(a);this._initialized=true}};a.isSupported=function(){var a=document.URL;return a.substring(a.indexOf("?")+1,a.length).indexOf("forceHttpStorage=true")>-1?true:(a=navigator.userAgent.match(/GeocortexApp[^\/]*\/(\d+.\d+)/))&&parseFloat(a[1])>=1.1?true:false};a.prototype.fileStorageRequest=function(a,b,c,f,h){this.initialize();b={url:this.localServerAddress+this.fileStorageEndpoint+"/"+b,load:function(a){c(a)},error:function(a){a&&a.status&&
a.status===404?c(null):f(a)},failOk:true};if(h)b.putData=h;dojo.xhr(a,b)};a.prototype.clear=function(a,b){this.fileStorageRequest("DELETE",this.keyNamespace+"/",a,b)};a.prototype.clearAllData=function(a,b){this.fileStorageRequest("DELETE","",a,b)};a.prototype.get=function(a,b,c,f){this.fileStorageRequest("GET",f?"0/"+a:this.keyNamespace+"/"+a,b,c)};a.prototype.set=function(a,b,c,f,h){this.fileStorageRequest("PUT",h?"0/"+a:this.keyNamespace+"/"+a,c,f,b)};a.prototype.remove=function(a,b,c,f){this.fileStorageRequest("DELETE",
f?"0/"+a:this.keyNamespace+"/"+a,b,c)};return a}(b.StorageProviderBase);b.HttpStorageProvider=c})(b.storage||(b.storage={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){b.DateFormatters={d:function(a){return a.getDate()+""},dd:function(a){return c(a.getDate(),2)},f:function(a){return f(a.getMilliseconds()/1E3,1,false)},ff:function(a){return f(a.getMilliseconds()/1E3,2,false)},fff:function(a){return f(a.getMilliseconds()/1E3,3,false)},ffff:function(a){return f(a.getMilliseconds()/1E3,4,false)},fffff:function(a){return f(a.getMilliseconds()/1E3,5,false)},ffffff:function(a){return f(a.getMilliseconds()/1E3,6,false)},fffffff:function(a){return f(a.getMilliseconds()/
1E3,7,false)},F:function(a){return f(a.getMilliseconds()/1E3,1,true)},FF:function(a){return f(a.getMilliseconds()/1E3,2,true)},FFF:function(a){return f(a.getMilliseconds()/1E3,3,true)},FFFF:function(a){return f(a.getMilliseconds()/1E3,4,true)},FFFFF:function(a){return f(a.getMilliseconds()/1E3,5,true)},FFFFFF:function(a){return f(a.getMilliseconds()/1E3,6,true)},FFFFFFF:function(a){return f(a.getMilliseconds()/1E3,7,true)},h:function(a){a=a.getHours();a>12&&(a-=12);return c(a,1)},hh:function(a){a=
a.getHours();a>12&&(a-=12);return c(a,2)},H:function(a){return c(a.getHours(),1)},HH:function(a){return c(a.getHours(),2)},m:function(a){return c(a.getMinutes(),1)},mm:function(a){return c(a.getMinutes(),2)},M:function(a){return c(a.getMonth()+1,1)},MM:function(a){return c(a.getMonth()+1,2)},s:function(a){return c(a.getSeconds(),1)},ss:function(a){return c(a.getSeconds(),2)},y:function(a){return c(a.getFullYear(),1)},yy:function(a){return c(a.getFullYear(),2)},yyy:function(a){return c(a.getFullYear(),
3)},yyyy:function(a){return c(a.getFullYear(),4)},yyyyy:function(a){return c(a.getFullYear(),5)}};var c=function(a,b){a+="";for(var c=b-a.length,e=[];e.length<c;)e.push("0");return e.join("")+a},f=function(a,b,f){a=Math.floor(a*Math.pow(10,b));b=c(a,b);f?(f=b,f+="",f=f.replace(/0*$/g,"")):f=b;return f}})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var c=function(){function b(a,c,f,e,h){this.item5=this.item4=this.item3=this.item2=this.item1=null;this.item1=a;this.item2=c;if(f!=null&&typeof f!=="undefined")this.item3=f;if(e!=null&&typeof e!=="undefined")this.item4=e;if(h!=null&&typeof h!=="undefined")this.item5=h}b.equals=function(a,b){return a===null?b===null:a.item1!==b.item1?false:a.item2!==b.item2?false:a.item3!==b.item3?false:a.item4!==b.item4?false:a.item5!==b.item5?false:true};b.compare=function(a,
b){var c=function(a,b){return a===null?b===null?0:-1:a===b?0:a>b?1:-1};return c(a.item1,b.item1)||c(a.item2,b.item2)||c(a.item3,b.item3)||c(a.item4,b.item4)||c(a.item5,b.item5)};return b}();b.Tuple=c})(b.utils||(b.utils={}))})(b.framework||(b.framework={}))})(geocortex||(geocortex={}));
