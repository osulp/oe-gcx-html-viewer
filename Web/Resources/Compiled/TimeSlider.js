function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var a=t.split("."),n=null,r=window,l=0,s=a.length;l<s;l++)n=a[l],l==s-1?r[n]=i:r[n]||(r[n]={}),r=r[n]}require({cache:{"Mapping/modules/TimeSlider/TimeSliderModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,i){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getStateFilter=function(){return{isActive:!0,showActionsContainer:!0,selectedSliderId:!0,sliderMode:!0,timeIntervalOverride:!0,timeIntervalUnitOverride:!0,sliderCurrentStartDate:!0,sliderCurrentEndDate:!0,timeSliderViewActive:!0,playbackDelaySeconds:!0,loopPlayback:!0,timeSliderSettingsViewActive:!0}},t.prototype.exportState=function(){var e=this,t={isActive:!1,showActionsContainer:!1,selectedSliderId:null,sliderMode:null,timeIntervalOverride:0,timeIntervalUnitOverride:null,sliderCurrentStartDate:0,sliderCurrentEndDate:0,playbackDelaySeconds:0,loopPlayback:!1,timeSliderViewActive:!1,timeSliderSettingsViewActive:!1};return Promise["try"](function(){return e.app.command("_ExportTimeSliderState").execute(t),t})},t.prototype.applyState=function(e){var t=this,i={state:e,completePromise:null};return this.app.waitUntilAllLibrariesLoaded().then(function(){return t.app.command("_ApplyTimeSliderState").execute(i),i.completePromise})},t}(i.ModuleBase);t.TimeSliderModule=a})},"Mapping/modules/TimeSlider/TimeSliderSettingsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var a=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.registerCommands(),a}return __extends(t,e),t.prototype.registerCommands=function(){var e=this;this.app.command("ShowTimeSliderSettings").register(this,function(){return e.app.command("ActivateView").execute(e.id)}),this.app.command("HideTimeSliderSettings").register(this,function(){return e.isActive&&e.app.command("DeactivateView").execute(e.id)}),this.app.command("_ExportTimeSliderState").register(this,this._exportState)},t.prototype._exportState=function(e){e.timeSliderSettingsViewActive=this.isActive},t}(i.ViewBase);t.TimeSliderSettingsView=a})},"Mapping/modules/TimeSlider/TimeSliderState":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/TimeSlider/TimeSliderView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/TimeSliderMode"],function(e,t,i,a){"use strict";var n=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a._sliderView=null,a._appResizeToken=null,a._viewModelEnabledToken=null,a.registerCommands(),a}return __extends(t,e),t.prototype.registerCommands=function(){var e=this;this.app.command("ToggleTimeSliderActions").register(this,function(){return e.viewModel&&e.viewModel.showActionsContainer.set(!e.viewModel.showActionsContainer.get())}),this.app.command("HideTimeSlider").register(this,function(){return e.app.command("DeactivateView").execute(e.id)}),this.app.command("_ExportTimeSliderState").register(this,this._exportState)},t.prototype.subscribeEvents=function(){this._appResizeToken||(this._appResizeToken=this.app.event("ApplicationResizedEvent").subscribe(this,this._handleApplicationResizedEvent))},t.prototype.attach=function(t){t&&(t.selectedSliderMode.bind(this,this._handleSliderModeChanged),this._viewModelEnabledToken=t.isEnabled.bind(this,this._onViewModelEnabled),this._onViewModelEnabled(this.viewModel.isEnabled.get()),e.prototype.attach.call(this,t))},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this._appResizeToken&&(this.app.event("ApplicationResizedEvent").unsubscribe(this._appResizeToken),this._appResizeToken=null)},t.prototype.resolveWidget=function(e,t,i){if(t)switch(e){case"TimeSliderElement":var a=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/ui/components/Slider/SliderView.html",libraryId:"Mapping.Infrastructure",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Slider.SliderViewBase",isVisible:!0});return a&&a.attach(t),this._sliderView=a,a;default:return}},t.prototype.handleToggleActionsContainer=function(e,t,i){this.viewModel.isEnabled.get()&&(this._handleSliderModeChanged(this.viewModel.selectedSliderMode.get()),this.app.command("ToggleTimeSliderActions").execute())},t.prototype.handlePlayTimelineClick=function(e,t,i){this.viewModel.isEnabled.get()&&(this.viewModel.isPlayingBack.get()?this.viewModel.stopPlayTimeline():this.viewModel.playTimeline())},t.prototype.handleStepBackClick=function(e,t,i){this.viewModel.isEnabled.get()&&(this.viewModel.stepBack(),this._refreshSliderLabelPositions())},t.prototype.handleStepForwardClick=function(e,t,i){this.viewModel.isEnabled.get()&&(this.viewModel.stepForward(),this._refreshSliderLabelPositions())},t.prototype.handleMoreActionsClick=function(e,t,i){this.viewModel.isEnabled.get()&&this.app.behavior("TimeSliderMoreSettingsActionInvokedBehavior").run()},t.prototype.handleCloseClick=function(e,t,i){this.viewModel.stopPlayTimeline(),this.app.behavior("TimeSliderCloseTimelineActionInvokedBehavior").run()},t.prototype._onViewModelEnabled=function(e){e&&(this._viewModelEnabledToken&&(this.viewModel.isEnabled.unbind(this._viewModelEnabledToken),this._viewModelEnabledToken=null),this.viewModel.isActive.bind(this,this._onTimeSliderActivated),this.subscribeEvents(),this._onTimeSliderActivated(this.viewModel.isActive.get()))},t.prototype._onTimeSliderActivated=function(e){e?(this.app.viewManager.activateView(this),this._refreshSliderLabelPositions()):(this.viewModel.stopPlayTimeline(),this.app.behavior("TimeSliderCloseTimelineActionInvokedBehavior").run(),this.app.viewManager.deactivateView(this))},t.prototype._handleApplicationResizedEvent=function(){this.viewModel.isEnabled.get()&&(this._refreshSliderLabelPositions(),this.isActive&&($(".slider-start-date-picker .hasDatepicker.gcxDatepicker",this.root).datepicker("hide"),$(".slider-end-date-picker .hasDatepicker.gcxDatepicker",this.root).datepicker("hide")))},t.prototype._refreshSliderLabelPositions=function(){this._sliderView&&this._sliderView.refreshLabelPositions()},t.prototype._handleSliderModeChanged=function(e){var t=this;if("string"!=typeof e){var i=function(e){e?$(".slider-start-date-picker",t.root).addClass("disable-date-picker"):$(".slider-start-date-picker",t.root).removeClass("disable-date-picker"),$(".slider-start-date-picker :input",t.root).prop("disabled",e),$(".slider-start-date-picker .hasDatepicker.gcxDatepicker",t.root).prop("disabled",e),$(".slider-start-date-picker .ui-datepicker-trigger",t.root).prop("disabled",e)},n=function(e){e?$(".slider-end-date-picker",t.root).addClass("disable-date-picker"):$(".slider-end-date-picker",t.root).removeClass("disable-date-picker"),$(".slider-end-date-picker :input",t.root).prop("disabled",e),$(".slider-end-date-picker .hasDatepicker.gcxDatepicker",t.root).prop("disabled",e),$(".slider-end-date-picker .ui-datepicker-trigger",t.root).prop("disabled",e)};e===a.TimeSliderMode.Instant?(i(!1),n(!0)):e===a.TimeSliderMode.Cumulative?(i(!0),n(!1)):(i(!1),n(!1))}},t.prototype._exportState=function(e){e.timeSliderViewActive=this.isActive},t}(i.ViewBase);t.TimeSliderView=n})},"Mapping/modules/TimeSlider/TimeSliderViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/ui/components/Slider/SliderViewModelBase","geocortex/forms/items/DatePickerFormItem","geocortex/infrastructure/DateFormat","geocortex/essentials/TimeSliderMode","geocortex/essentials/TimeUnits","geocortex/forms/items/TimePickerFormItem","geocortex/infrastructure/TimeSliderUtils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/TimeZoneUtils"],function(e,t,i,a,n,r,l,s,d,o,m,c,p){"use strict";var u=function(e){function t(t,i){var s=e.call(this,t,i)||this;return s.isEnabled=new a.Observable((!1)),s.isActive=new a.Observable((!1)),s.showActionsContainer=new a.Observable((!1)),s.timeSliders=new a.ObservableCollection([]),s.selectedSliderId=new a.Observable(""),s.selectedTimeSlider=new a.Observable(null),s.sliderViewModel=new a.Observable(null),s.startDateViewModel=new a.Observable(null),s.endDateViewModel=new a.Observable(null),s.currentProfile=new a.Observable(""),s.infoMessage=new a.Observable(""),s.datePickerErrorMessage=new a.Observable(""),s.sliderSettingsInfoMessage=new a.Observable(""),s.sliderSettingsTimeIntervalError=new a.Observable(""),s.sliderSettingsPlaybackDelayError=new a.Observable(""),s.displayFormat=new a.Observable(l.DateFormat.DEFAULT),s.sliderModes=new a.ObservableCollection([]),s.selectedSliderMode=new a.Observable(null),s.timeInterval=new a.Observable(1),s.timeIntervalUnits=new a.ObservableCollection([]),s.selectedTimeIntervalUnit=new a.Observable(null),s.loopPlayback=new a.Observable((!0)),s.playbackDelaySeconds=new a.Observable(1),s.isPlayingBack=new a.Observable((!1)),s.labelGenerator=null,s._animateSlider=!0,s._invalidDateString="Invalid Date",s._sliderViewModelOnHandle=null,s._enabledInConfig=!0,s._playbackDelaySeconds=1,s._activateSliderOnStartup=!0,s._mapTimeExtentSetTimeoutToken=null,s._mapTimeExtentSetDelayMs=300,s._startupDelay=300,s._maxSignificantTimeExtentDisplayUnits=3,s._playTimelineTimeoutToken=null,s._noOfflineSupportStatusMsgSecs=10,s._notificationDisplayId="TimeSliderNotificationView",s.labelGenerator=s._defaultSliderLabelGenerator,s.startDateViewModel.set(new r.DatePickerFormItem(null,null)),s.endDateViewModel.set(new r.DatePickerFormItem(null,null)),s.sliderViewModel.set(new n.SliderViewModelBase(s.app,s.libraryId)),s._populateAvailableSliderModes(),s._populateAvailableTimeIntervalUnits(),s.registerCommands(),s}return __extends(t,e),t.prototype.initialize=function(e){var t=this;e&&(this._enabledInConfig=void 0===e.enabled||null===e.enabled||!!e.enabled,this._animateSlider=void 0===e.animateSlider||null===e.animateSlider||!!e.animateSlider,this._activateSliderOnStartup=void 0===e.activateOnStartup||null===e.activateOnStartup||!!e.activateOnStartup,this._maxSignificantTimeExtentDisplayUnits=void 0!==e.maxTimeExtentDisplayUnits&&null!==e.maxTimeExtentDisplayUnits?parseInt(e.maxTimeExtentDisplayUnits)||3:3,this._noOfflineSupportStatusMsgSecs=void 0!==e.noOfflineSupportStatusMsgTimeoutSecs&&null!==e.noOfflineSupportStatusMsgTimeoutSecs?parseInt(e.noOfflineSupportStatusMsgTimeoutSecs)||10:10),this.app.site&&this.app.site.serviceLayersLoaded?this._onSiteServiceLayersLoaded(e):this.app.event("SiteServiceLayersLoadedEvent").once(this,function(){return t._onSiteServiceLayersLoaded(e)}),this.app.event("ProjectLoadingEvent").subscribe(this,function(){return t.app.command("DeactivateTimeSlider").execute()})},t.prototype.registerCommands=function(){this.app.command("ActivateTimeSlider").register(this,this._activateTimeSliderCommandImpl,this._canExecuteActivateTimeSlider),this.app.command("DeactivateTimeSlider").register(this,this._deactivateTimeSliderCommandImpl,this._canExecuteDeactivateTimeSlider),this.app.command("SetTimeSliderProfile").register(this,this._setTimeSliderProfileCommandImpl,this._canExecuteSetTimeSliderProfile),this.app.command("_ExportTimeSliderState").register(this,this._exportState),this.app.command("_ApplyTimeSliderState").register(this,this._applyState)},t.prototype.handleSliderItemSlide=function(e,t){var i=this;this.sliderViewModel.get()||this.app.trace.error("TimeSliderViewModel: Failed to set time extent for the Time Slider. Slider ViewModel undefined.");var a=this.sliderViewModel.get().sliderMinHandleCurrentItem.get(),n=a?a.value:null;if(null===n||isNaN(parseInt(n,10)))return void this.app.trace.error("TimeSliderViewModel: Failed to set time extent for the Time Slider. Minimum time not defined.");var r=this.sliderViewModel.get().sliderMaxHandleCurrentItem.get(),l=r?r.value:null,s=this._applyTimezoneOffset(new Date(n)),d=null===l?null:this._applyTimezoneOffset(new Date(l));0===t?this.startDateViewModel.get()&&this.startDateViewModel.get().date.set(s):this.sliderViewModel.get().range&&null!==d&&this.endDateViewModel.get()&&this.endDateViewModel.get().date.set(d),this._updateCurrentlyDisplayedTimeExtent(n,l),this._mapTimeExtentSetTimeoutToken&&clearTimeout(this._mapTimeExtentSetTimeoutToken),this._mapTimeExtentSetTimeoutToken=setTimeout(function(){var e=new esri.TimeExtent(s,i.sliderViewModel.get().range?d:s);i.app.map.setTimeExtent(e)},this._mapTimeExtentSetDelayMs)},t.prototype.stepForward=function(){if(!this.sliderViewModel.get())return this.app.trace.error("TimeSliderViewModel: Could not step forward in time. Slider ViewModel not defined."),!1;if(this.sliderViewModel.get().range){if(this.sliderViewModel.get().setNextSliderItem(1)){if(this.selectedSliderMode.get()===s.TimeSliderMode.Extent)return this.sliderViewModel.get().setNextSliderItem(0);if(this.selectedSliderMode.get()===s.TimeSliderMode.Cumulative)return!0}return!1}return this.sliderViewModel.get().setNextSliderItem(0)},t.prototype.stepBack=function(){return this.sliderViewModel.get()?this.sliderViewModel.get().range?this.selectedSliderMode.get()===s.TimeSliderMode.Cumulative?this.sliderViewModel.get().setPreviousSliderItem(1):this.selectedSliderMode.get()===s.TimeSliderMode.Extent&&(!!this.sliderViewModel.get().setPreviousSliderItem(0)&&this.sliderViewModel.get().setPreviousSliderItem(1)):this.sliderViewModel.get().setPreviousSliderItem(0):(this.app.trace.error("TimeSliderViewModel: Could not step back in time. Slider ViewModel not defined."),!1)},t.prototype.playTimeline=function(){var e=this,t=this.sliderViewModel.get();if(!t)return void this.app.trace.error("TimeSliderViewModel: Could not play timeline. Slider ViewModel not defined.");if(!this.isPlayingBack.get()){this.isPlayingBack.set(!0),this.app.event("TimeSliderPlayTimelineStartedEvent").publish(this.selectedTimeSlider.get());var i=!0,a=null,n=function(){if(i=e.stepForward(),t.range&&(a=null!==a?a:t.getRawSliderValueForItem(t.sliderMaxHandleCurrentItem.get())-t.getRawSliderValueForItem(t.sliderMinHandleCurrentItem.get())),!i&&e.loopPlayback.get()){var r=t.isNumeric?t.numericSliderMinVal:0,l=t.getSliderItemByRawSliderValue(r);if(t.range){var d=e.selectedSliderMode.get()===s.TimeSliderMode.Cumulative?t.getNextActiveSliderItem(l):t.getSliderItemByRawSliderValue(a+r);e.selectedSliderMode.get()===s.TimeSliderMode.Extent&&t.setSelectedSliderItem(0,l),t.setSelectedSliderItem(1,d)}else t.setSelectedSliderItem(0,l);i=!0}e.isPlayingBack.get()&&i?e._playTimelineTimeoutToken=setTimeout(n,1e3*e._playbackDelaySeconds):e.stopPlayTimeline()};setTimeout(n,1e3*this._playbackDelaySeconds)}},t.prototype.stopPlayTimeline=function(){null!==this._playTimelineTimeoutToken&&(clearTimeout(this._playTimelineTimeoutToken),this._playTimelineTimeoutToken=null),this.isPlayingBack.set(!1),this.app.event("TimeSliderPlayTimelineStoppedEvent").publish(this.selectedTimeSlider.get())},t.prototype._activateTimeSliderCommandImpl=function(){this._activateTimeSlider()},t.prototype._canExecuteActivateTimeSlider=function(){return this.isEnabled.get()&&!this.app.isOffline.get()},t.prototype._deactivateTimeSliderCommandImpl=function(){this._deactivateTimeSlider()},t.prototype._canExecuteDeactivateTimeSlider=function(){return!0},t.prototype._setTimeSliderProfileCommandImpl=function(e){this._setTimeSliderProfile(e)},t.prototype._canExecuteSetTimeSliderProfile=function(e){return!!this.isEnabled.get()&&this._validateProfile(e)},t.prototype._onSiteServiceLayersLoaded=function(e){var t=this;this.isEnabled.set(this._enabledInConfig&&this._populateTimeSliderProfiles()),this.isEnabled.get()&&this.app.map&&(this._setupBindings(),this._initializeDatePickerViewModels(),this.app.map.on("time-extent-change",function(e){return t._handleMapTimeExtentChanged(e.timeExtent)}),this._activateSliderOnStartup&&setTimeout(function(){return t._activateTimeSlider()},this._startupDelay))},t.prototype._activateTimeSlider=function(){if(this.isEnabled.get()&&!this.app.isOffline.get()){if(this.isActive.get())return void this.isActive.pulse();var e=this.selectedTimeSlider.get()||this.timeSliders.getAt(0);this.selectedTimeSlider.set(e),this.isActive.set(!0)}},t.prototype._deactivateTimeSlider=function(){var e=this;if(!this.isActive.get())return void this.isActive.pulse();if(this.app.map&&this.app.map.timeExtent)if(!this.app.isOffline.get()||this.app.isOffline.get()&&!this.app.map.updating)this.app.map.setTimeExtent(null);else var t=this.app.map.on("update-end",function(){t.remove(),e.app.map.setTimeExtent(null)});this.isActive.set(!1)},t.prototype._setupBindings=function(){var e=this;this.selectedTimeSlider.bind(this,this._setTimeSliderProfile),this.selectedSliderId.bind(this,this.handleSliderIdChange),this.displayFormat.bind(this,function(t){return e.startDateViewModel.get().dateFormat.set(t)}),this.displayFormat.bind(this,function(t){return e.endDateViewModel.get().dateFormat.set(t)}),this.startDateViewModel.get().date.bind(this,this._handleDatePickerStartDateChanged),this.endDateViewModel.get().date.bind(this,this._handleDatePickerEndDateChanged),this.selectedSliderMode.bind(this,this._handleSliderModeChanged),this.selectedTimeIntervalUnit.bind(this,this._handleTimeIntervalUnitChanged),this.timeInterval.bind(this,this._handleTimeIntervalChanged),this.playbackDelaySeconds.bind(this,this._handlePlaybackDelayChanged),this.app.isOffline.bind(this,this._handleIsOffline)},t.prototype._initializeDatePickerViewModels=function(){this._setupDatePickerViewModel(this.startDateViewModel.get()),this._setupDatePickerViewModel(this.endDateViewModel.get()),this.startDateViewModel.pulse(),this.endDateViewModel.pulse()},t.prototype._setupDatePickerViewModel=function(e){e.timePickerItem=new o.TimePickerFormItem(null,null),e.timePickerItem.jQueryPickerTimeAsInfoMsg.set(!0),e.includeTimePicker.set(!0),e.isRequired.set(!1),e.nullable.set(!1)},t.prototype._configureSliderViewModel=function(e,t,i,a){var n,r,l,d,o=this,c=null!==t&&void 0!==t?t:e.mode;if(n=e.timeExtent.startTime.getTime(),r=e.timeExtent.endTime.getTime(),l=e.initialTimeExtent.startTime.getTime(),d=e.initialTimeExtent.endTime.getTime(),c===s.TimeSliderMode.Cumulative&&l!==n&&(l=n),c===s.TimeSliderMode.Instant&&d!==l&&(d=l),!this._validateSliderTimes(n,r,l,d))return!1;var p=null!==i&&void 0!==i?i:e.timeInterval,u=a?a:e.timeIntervalUnit;this._sliderViewModelOnHandle&&this._sliderViewModelOnHandle.remove();var g={};g.range=c!==s.TimeSliderMode.Instant,g.animate=this._animateSlider,g.disableSnappingForNumericValues=!e.snapToTimeIntervals,g.lockMinSliderHandleAtMinVal=c===s.TimeSliderMode.Cumulative,g.sliderMinHandleAriaLabel=this.getResource("language-timeslider-range-mode-min-handle-aria-label"),g.sliderMaxHandleAriaLabel=this.getResource("language-timeslider-range-mode-max-handle-aria-label"),g.sliderSingleHandleAriaLabel=this.getResource("language-timeslider-instant-mode-single-handle-aria-label");var h=m.computeTimeIntervalInMs(p,u);h=isNaN(h)?1:h,h>=r-n?this.sliderSettingsInfoMessage.set(this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-exceeds-time-extent")):this.sliderSettingsInfoMessage.set("");var v=this.sliderViewModel.get();return this._sliderViewModelOnHandle=dojo.aspect.after(v,"sliderHandleSlide",function(e,t){return o.handleSliderItemSlide(e,t)},!0),v.initialize(g),v.setupDateSlider(n,r,p,u,function(e,t){return o.labelGenerator(e,t)},null,[l,d]),!0},t.prototype._populateTimeSliderProfiles=function(){var e=this;if(!this.app.site.hasTimeSliders||!this.app.site.timeSliders||!this.app.site.timeSliders.length)return!1;var t=this.app.site.timeSliders.filter(function(t){return e._validateProfile(t)});return 0!==t.length&&(this.timeSliders.set(t),!0)},t.prototype._setTimeSliderProfile=function(e,t,i,a){if(this.stopPlayTimeline(),void 0===t&&void 0===i&&void 0===a&&this._nullOverridableObservables(),this.selectedTimeSlider.get()!==e)return void this.selectedTimeSlider.set(e);var n=null!==t&&void 0!==t?t:e.mode;if(this.selectedSliderMode.get()!==n)return void this.selectedSliderMode.set(n);var r=null!==i&&void 0!==i?i:e.timeInterval;if(this.timeInterval.get()!==r)return void this.timeInterval.set(r);var l=a?a:e.timeIntervalUnit;if(this.selectedTimeIntervalUnit.get()!==l)return void this.selectedTimeIntervalUnit.set(l);if(this.selectedSliderId.get()!==e.id&&this.selectedSliderId.set(e.id),this.displayFormat.set(e.displayFormat),this._configureSliderViewModel(e,this.selectedSliderMode.get(),this.timeInterval.get(),this.selectedTimeIntervalUnit.get())){this.currentProfile.set(e.displayName);var s=jQuery.extend({},e);s.mode=this.selectedSliderMode.get(),s.timeInterval=this.timeInterval.get(),s.timeIntervalUnit=this.selectedTimeIntervalUnit.get(),this.app.event("TimeSliderProfileChangedEvent").publish(s)}else this.app.trace.error("TimeSliderViewModel: Could not set slider profile with name: {0}.".format(e.displayName))},t.prototype._updateCurrentlyDisplayedTimeExtent=function(e,t){this.infoMessage.set(""),null===e||void 0===e||null===t||void 0===t||isNaN(e)||isNaN(t)||this.infoMessage.set(this._formatMilliSecondsAsString(e,t,this._maxSignificantTimeExtentDisplayUnits))},t.prototype._defaultSliderLabelGenerator=function(e,t){var i=this._applyTimezoneOffset(new Date(e));return isNaN(e)||isNaN(i.getTime())?this._invalidDateString:c.formatDate(i,this.displayFormat.get())},t.prototype._applyTimezoneOffset=function(e,t){void 0===t&&(t=!1);var i=p.UTC_ZONE_ID,a=this.app.site.displayTimeZoneId||i;return t?p.correctDatesToSubmitInDatabaseTime(e,i,a):p.correctDatesForDisplayInDisplayTimeZone(e,i,a)},t.prototype._validateSliderTimes=function(e,t,i,a){if(isNaN(parseInt(e,10))||isNaN(parseInt(t,10))||isNaN(parseInt(i,10))||isNaN(parseInt(a,10)))return!1;var n=!0;return n=n&&e<=t,n=n&&i<=a,n=n&&i>=e&&i<=t&&a>=e&&a<=t},t.prototype._validateTimeSliderAdditionalSettings=function(){var e=parseFloat(+this.timeInterval.get()),t=parseFloat(+this.playbackDelaySeconds.get()),i=isNaN(e)||e%1!==0||e<1,a=isNaN(t)||t%1!==0||t<1;this.sliderSettingsTimeIntervalError.set(i?this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-error"):""),this.sliderSettingsPlaybackDelayError.set(a?this.app.getResource(this.libraryId,"language-timeslider-settings-playback-delay-error"):"");var n=!i&&!a;return this.sliderSettingsInfoMessage.set(n?"":this.app.getResource(this.libraryId,"language-timeslider-settings-contains-errors")),n},t.prototype.handleSliderIdChange=function(e){if(!this.selectedTimeSlider.get()||this.selectedTimeSlider.get().id!==e){var t=this.timeSliders.get().filter(function(t){return t.id===e})[0];t&&this.selectedTimeSlider.set(t)}},t.prototype._handleDatePickerStartDateChanged=function(e){this._handleDatePickerDateChanged(!0,e)},t.prototype._handleDatePickerEndDateChanged=function(e){this._handleDatePickerDateChanged(!1,e)},t.prototype._handleDatePickerDateChanged=function(e,t){var i=this._applyTimezoneOffset(t,!0).getTime(),a=this.sliderViewModel.get();if(!a)return void this.app.trace.error("TimeSliderViewModel: Could not handle datepicker date change. Slider view model not defined.");this.datePickerErrorMessage.set("");var n=a.sliderMinHandleCurrentItem.get()&&a.sliderMinHandleCurrentItem.get().value,r=a.sliderMaxHandleCurrentItem.get()&&a.sliderMaxHandleCurrentItem.get().value;this.selectedSliderMode.get()===s.TimeSliderMode.Instant?r=a.numericSliderMaxVal:this.selectedSliderMode.get()===s.TimeSliderMode.Cumulative&&(n=a.numericSliderMinVal);var l=e?n:r;if(null===l||void 0===l||l!==i){var d=a.numericSliderMinVal,o=a.numericSliderMaxVal;return this._validateSliderTimes(d,o,e?i:n,e?r:i)?void a.setSelectedSliderItem(e?0:1,a.getSliderItemByItemValue(i)):void this.datePickerErrorMessage.set(this.app.getResource(this.libraryId,"language-timeslider-datepicker-range-error"))}},t.prototype._handleSliderModeChanged=function(e){if(null!==e)return this.stopPlayTimeline(),"string"==typeof e?void this.selectedSliderMode.set(parseInt(e,10)):void(this.selectedTimeSlider.get()&&null!==e&&void 0!==e&&this._setTimeSliderProfile(this.selectedTimeSlider.get(),e,this.timeInterval.get(),this.selectedTimeIntervalUnit.get()))},t.prototype._handlePlaybackDelayChanged=function(e){null!==e&&this._validateTimeSliderAdditionalSettings()&&(this._playbackDelaySeconds=e)},t.prototype._handleTimeIntervalChanged=function(e){if(null!==e&&this._validateTimeSliderAdditionalSettings())return this.stopPlayTimeline(),"string"==typeof e?void this.timeInterval.set(parseInt(e,10)):void(this.selectedTimeSlider.get()&&null!==e&&void 0!==e&&this._setTimeSliderProfile(this.selectedTimeSlider.get(),this.selectedSliderMode.get(),e,this.selectedTimeIntervalUnit.get()))},t.prototype._handleTimeIntervalUnitChanged=function(e){null!==e&&(this.stopPlayTimeline(),this.selectedTimeSlider.get()&&e&&this._setTimeSliderProfile(this.selectedTimeSlider.get(),this.selectedSliderMode.get(),this.timeInterval.get(),e))},t.prototype._handleMapTimeExtentChanged=function(e){var t=this;if(this.app.map&&this.isActive.get()){var i=!e||!e.startTime&&!e.endTime,a=this.app.map.graphicsLayerIds.map(function(e){return t.app.map.getLayer(e)}).filter(function(e){return e instanceof esri.layers.FeatureLayer&&e.timeInfo&&(e._collection===!0||!e.url)});if(a.length){var n=function(e,t){e&&e.visible!==t&&(t?e.show():e.hide())};a.forEach(function(a){for(var r=0;r<a.graphics.length;r++){var l=a.graphics[r];if(l&&l.attributes)if(i)n(l,!0);else{var s=l.attributes[a.timeInfo.startTimeField],d=l.attributes[a.timeInfo.endTimeField];if(d=d?d:s,s&&d){s=t._applyTimezoneOffset(new Date(s)).getTime(),d=t._applyTimezoneOffset(new Date(d)).getTime();var o=e.startTime.getTime(),m=e.endTime?e.endTime.getTime():o;s>=o&&s<=m&&d>=o&&d<=m?n(l,!0):n(l,!1)}}}})}}},t.prototype._handleIsOffline=function(e){if(e&&this.isActive.get()){this.app.command("DeactivateTimeSlider").execute();var t=this.getResource("language-timeslider-not-supported-offline"),i={id:this._notificationDisplayId,text:t,closeButton:{}};this.app.command("DisplayNotification").execute(i),this.app.trace.info(t)}this.app.command("ActivateTimeSlider").raiseCanExecuteChanged()},t.prototype._nullOverridableObservables=function(){this.selectedSliderMode.set(null),this.timeInterval.set(null),this.selectedTimeIntervalUnit.set(null)},t.prototype._populateAvailableSliderModes=function(){this.sliderModes.clear();var e=[];e.push(this._getTimeSliderModeDataContract(s.TimeSliderMode.Cumulative)),e.push(this._getTimeSliderModeDataContract(s.TimeSliderMode.Extent)),e.push(this._getTimeSliderModeDataContract(s.TimeSliderMode.Instant)),this.sliderModes.addItems(e)},t.prototype._populateAvailableTimeIntervalUnits=function(){this.timeIntervalUnits.clear();var e=[];e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_MILLISECONDS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_SECONDS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_MINUTES)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_HOURS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_DAYS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_WEEKS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_MONTHS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_YEARS)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_DECADES)),e.push(this._getTimeIntervalUnitDataContract(d.TimeUnits.UNIT_CENTURIES)),this.timeIntervalUnits.addItems(e)},t.prototype._getTimeSliderModeDataContract=function(e){var t={};switch(t.mode=e.toString(),e){case s.TimeSliderMode.Instant:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-timeslider-mode-instant");break;case s.TimeSliderMode.Cumulative:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-timeslider-mode-cumulative");break;case s.TimeSliderMode.Extent:default:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-timeslider-mode-extent")}return t},t.prototype._validateProfile=function(e){if(!e||null===e.mode||void 0===e.mode||!e.timeExtent||!e.initialTimeExtent)return!1;var t,i,a,n,r=e.mode;return t=e.timeExtent.startTime.getTime(),i=e.timeExtent.endTime.getTime(),a=e.initialTimeExtent.startTime.getTime(),n=e.initialTimeExtent.endTime.getTime(),r===s.TimeSliderMode.Cumulative&&a!==t&&(a=t),r===s.TimeSliderMode.Instant&&n!==a&&(n=a),!!this._validateSliderTimes(t,i,a,n)},t.prototype._getTimeIntervalUnitDataContract=function(e){var t={};switch(t.timeIntervalUnit=e.toString(),e){case d.TimeUnits.UNIT_CENTURIES:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-century");break;case d.TimeUnits.UNIT_DAYS:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-day");break;case d.TimeUnits.UNIT_DECADES:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-decade");break;case d.TimeUnits.UNIT_HOURS:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-hour");break;case d.TimeUnits.UNIT_MILLISECONDS:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-millisecond");break;case d.TimeUnits.UNIT_MINUTES:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-minute");break;case d.TimeUnits.UNIT_MONTHS:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-month");break;case d.TimeUnits.UNIT_SECONDS:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-second");break;case d.TimeUnits.UNIT_WEEKS:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-week");break;case d.TimeUnits.UNIT_YEARS:default:t.displayName=this.app.getResource(this.libraryId,"language-timeslider-settings-time-interval-unit-year")}return t},t.prototype._formatMilliSecondsAsString=function(e,t,i){var a=this,n=parseInt(t-e,10);if(isNaN(n)||n<=0)return null;var r=1970,l=new Date(n),s="",d=" ",o=0,m=null,c=null,p=null,u=null,g=null,h=null,v=function(){var e=a.sliderViewModel.get(),t=l.getUTCMonth(),i=e.sliderMinHandleCurrentItem.get()&&new Date(e.sliderMinHandleCurrentItem.get().value),n=e.sliderMaxHandleCurrentItem.get()&&new Date(e.sliderMaxHandleCurrentItem.get().value);if(!isNaN(i.getTime())&&!isNaN(n.getTime()))return i.getUTCDate()===n.getUTCDate()&&i.getUTCHours()===n.getUTCHours()&&i.getUTCMinutes()===n.getUTCMinutes()&&(l.getUTCDate()>=28&&(t+=1),12==t&&(m=l.getUTCFullYear()-r+1,t=0),c=0,p=0,u=0,g=0,h=0),t},S=function(e,t){o>=i||0===o&&0===t||(s+=t+a.getResource(e)+d,o++)},T=v();return S("language-timeslider-current-time-extent-info-year-abbr",null===m?l.getUTCFullYear()-r:m),S("language-timeslider-current-time-extent-info-month-abbr",T),S("language-timeslider-current-time-extent-info-day-abbr",null===c?l.getUTCDate()-1:c),S("language-timeslider-current-time-extent-info-hour-abbr",null===p?l.getUTCHours():p),S("language-timeslider-current-time-extent-info-minute-abbr",null===u?l.getUTCMinutes():u),S("language-timeslider-current-time-extent-info-second-abbr",null===g?l.getUTCSeconds():g),S("language-timeslider-current-time-extent-info-millisecond-abbr",null===h?l.getMilliseconds():h),s.trim()?this.getResource("language-timeslider-current-time-extent-info").format(s.trim()):null},t.prototype._exportState=function(e){this.stopPlayTimeline(),e.isActive=this.isActive.get(),e.selectedSliderId=this.selectedSliderId.get(),e.showActionsContainer=this.showActionsContainer.get(),e.sliderCurrentStartDate=this.sliderViewModel.get().sliderMinHandleCurrentItem.get().value,e.sliderCurrentEndDate=this.sliderViewModel.get().sliderMaxHandleCurrentItem.get()&&this.sliderViewModel.get().sliderMaxHandleCurrentItem.get().value,e.sliderMode=this.selectedSliderMode.get().toString(),
e.timeIntervalOverride=this.sliderViewModel.get().dateModeTimeInterval,e.timeIntervalUnitOverride=this.sliderViewModel.get().dateModeTimeIntervalUnit,e.playbackDelaySeconds=this.playbackDelaySeconds.get(),e.loopPlayback=this.loopPlayback.get()},t.prototype._applyState=function(e){var t=e.state,i=this.timeSliders.get().filter(function(e){return e.id===t.selectedSliderId})[0];if(!this.isEnabled.get())return this.app.trace.info("Saved Project: Time Slider state could not be applied. Time Slider not enabled or no time slider profiles defined."),void(e.completePromise=Promise.resolve());i||(this.app.trace.info("Saved Project: Time Slider profile with id {0} not found. Applying first available profile."),i=this.timeSliders.getAt(0)),this.app.command("ActivateTimeSlider").execute(),this.selectedTimeSlider.get()!==i&&this.selectedTimeSlider.set(i),this.selectedSliderMode.set(t.sliderMode),this.timeInterval.get()!==t.timeIntervalOverride&&this.timeInterval.set(t.timeIntervalOverride),this.selectedTimeIntervalUnit.set(t.timeIntervalUnitOverride),this.showActionsContainer.set(t.showActionsContainer),this.playbackDelaySeconds.set(t.playbackDelaySeconds),this.loopPlayback.set(t.loopPlayback);var a=this._applyTimezoneOffset(new Date(t.sliderCurrentStartDate)),n=this._applyTimezoneOffset(new Date(t.sliderCurrentEndDate));this.sliderViewModel.get().range||isNaN(a.getTime())?!this.sliderViewModel.get().range||isNaN(a.getTime())||isNaN(n.getTime())||(this.startDateViewModel.get()&&this.startDateViewModel.get().date.set(a),this.endDateViewModel.get()&&this.endDateViewModel.get().date.set(n)):this.startDateViewModel.get()&&this.startDateViewModel.get().date.set(a),t.timeSliderViewActive||this.app.command("HideTimeSlider").execute(),t.timeSliderSettingsViewActive?this.app.command("ShowTimeSliderSettings").execute():this.app.command("HideTimeSliderSettings").execute(),t.isActive||this.app.command("DeactivateTimeSlider").execute(),e.completePromise=Promise.resolve()},t}(i.ViewModelBase);t.TimeSliderViewModel=u})},"url:/Mapping/modules/TimeSlider/TimeSliderSettingsView.html":'<div class="timeslider-settings">\r\n        <span class="info-message" data-binding="{@visible: sliderSettingsInfoMessage}{@text: sliderSettingsInfoMessage}{title: sliderSettingsInfoMessage}"></span>\r\n    <div class="form-item">\r\n        <label class="form-label">\r\n            <span data-binding="{@text: @language-timeslider-settings-timeslider-profiles}"></span>\r\n            <select data-binding="{@source: timeSliders}{@value: selectedSliderId}{title: @language-timeslider-profile-select-title}">\r\n                <option data-binding="{@template-for: timeSliders}{value: id}{@text: displayName}" />\r\n            </select>\r\n        </label>\r\n    </div>\r\n    <div class="form-item">\r\n        <label class="form-label">\r\n            <span data-binding="{@text: @language-timeslider-settings-timeslider-mode}"></span>\r\n            <select data-binding="{@source: sliderModes}{@value: selectedSliderMode}{title: @language-timeslider-mode-select-title}">\r\n                <option data-binding="{@template-for: sliderModes}{value: mode}{@text: displayName}" />\r\n            </select>\r\n        </label>\r\n    </div>\r\n    <div class="form-item">\r\n        <label class="form-label">\r\n            <span data-binding="{@text: @language-timeslider-settings-time-interval}{title: @language-timeslider-time-interval-title}"></span>\r\n            <input type="number" min="1" data-binding="{@value: timeInterval}" />\r\n        </label>\r\n\t\t<span class="time-settings-error-message" data-binding="{@visible: sliderSettingsTimeIntervalError}{@text: sliderSettingsTimeIntervalError}"></span>\r\n    </div>\r\n    <div class="form-item">\r\n        <label class="form-label">\r\n            <span data-binding="{@text: @language-timeslider-settings-time-interval-unit}"></span>\r\n            <select data-binding="{@source: timeIntervalUnits}{@value: selectedTimeIntervalUnit}{title: @language-timeslider-time-interval-unit-title}">\r\n                <option data-binding="{@template-for: timeIntervalUnits}{value: timeIntervalUnit}{@text: displayName}" />\r\n            </select>\r\n        </label>\r\n    </div>\r\n    <div class="form-item">\r\n        <label class="form-label">\r\n            <span data-binding="{@text: @language-timeslider-settings-playback-delay}{title: @language-timeslider-playback-delay-title}"></span>\r\n            <input type="number" min="1" data-binding="{@value: playbackDelaySeconds}" />\r\n        </label>\r\n\t\t<span class="time-settings-error-message" data-binding="{@visible: sliderSettingsPlaybackDelayError}{@text: sliderSettingsPlaybackDelayError}"></span>\r\n    </div>\r\n    <div class="form-item">\r\n        <label class="form-label">\r\n            <input class="checkbox" type="checkbox" data-binding="{@value: loopPlayback}" />\r\n            <span class="checkbox-label" data-binding="{@text: @language-timeslider-loop-playback-checkbox}"></span>\r\n        </label>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/modules/TimeSlider/TimeSliderView.html":'<div class="timeslider-container">\r\n    <div class="current-profile-title" data-binding="{@visible: currentProfile}{@text: currentProfile}{title: currentProfile}"></div>\r\n    <div class="main-row">\r\n        <div class="slider-widget" data-binding="{@widget: TimeSliderElement}{@widget-context: sliderViewModel}{@widget-required: false}{@widget-replace: true}" tabindex="0"></div>\r\n        <div class="slider-actions-toggle item-actions">\r\n            <button data-binding="{@noclass-chevron-down-24: showActionsContainer}{@class-chevron-up-24: showActionsContainer}{title: @language-timeslider-show-actions-tooltip}{@event-click: handleToggleActionsContainer}"></button>\r\n        </div>\r\n    </div>\r\n    <div class="actions-container" data-binding="{@visible: showActionsContainer}">\r\n        <div class="info-message" data-binding="{@visible: infoMessage}{@text: infoMessage}{title: infoMessage}"></div>\r\n        <div class="slider-date-pickers">\r\n            <div class="slider-start-date-picker" data-binding="{@widget: DatePickerFormItem}{@widget-context: startDateViewModel}{title: @language-timeslider-start-time-select-tooltip}"></div>\r\n            <div class="slider-start-to-end-date-label" data-binding="{@text: @language-timeslider-start-to-end-date-label}"></div>\r\n            <div class="slider-end-date-picker" data-binding="{@widget: DatePickerFormItem}{@widget-context: endDateViewModel}{title: @language-timeslider-end-time-select-tooltip}"></div>\r\n        </div>\r\n        <div class="gcx-error-message" data-binding="{@visible: datePickerErrorMessage}">\r\n            <span data-binding="{@text: datePickerErrorMessage}{title: datePickerErrorMessage}"></span>\r\n        </div>\r\n        <ul class="slider-actions">\r\n            <li class="list-menu-item">\r\n                <button class="slider-actions-button" data-binding="{@class-stop-timeline-24: isPlayingBack}{@noclass-play-timeline-24: isPlayingBack}{title: @language-timeslider-play-timeline-tooltip}{@event-click: handlePlayTimelineClick}">\r\n                        <img src="Resources/Images/Icons/playback-play-24.png" data-binding="{@hidden: isPlayingBack}" />\r\n                        <img src="Resources/Images/Icons/playback-stop-24.png" data-binding="{@visible: isPlayingBack}" />\r\n                        <span class="action-label" data-binding="{@hidden: isPlayingBack}{@text: @language-timeslider-play-timeline-button-label}"></span>\r\n                        <span class="action-label" data-binding="{@visible: isPlayingBack}{@text: @language-timeslider-stop-timeline-button-label}"></span>\r\n                </button>\r\n            </li>\r\n            <li class="list-menu-item">\r\n                <button class="slider-actions-button" data-binding="{title: @language-timeslider-step-back-tooltip}{@event-click: handleStepBackClick}">\r\n                        <img src="Resources/Images/Icons/playback-previous-24.png" />\r\n                        <span class="action-label" data-binding="{@text: @language-timeslider-step-back-button-label}"></span>\r\n                </button>\r\n            </li>\r\n            <li class="list-menu-item">\r\n                <button class="slider-actions-button" data-binding="{title: @language-timeslider-step-forward-tooltip}{@event-click: handleStepForwardClick}">\r\n                        <img src="Resources/Images/Icons/playback-next-24.png" />\r\n                        <span class="action-label" data-binding="{@text: @language-timeslider-step-forward-button-label}"></span>\r\n                </button>\r\n            </li>\r\n            <li class="list-menu-item">\r\n                <button class="slider-actions-button" data-binding="{title: @language-timeslider-more-settings-tooltip}{@event-click: handleMoreActionsClick}">\r\n                        <img src="Resources/Images/Icons/Toolbar/more-24.png" />\r\n                        <span class="action-label" data-binding="{@text: @language-timeslider-more-settings-button-label}"></span>\r\n                </button>\r\n            </li>\r\n            <li class="list-menu-item">\r\n                <button class="slider-actions-button" data-binding="{title: @language-timeslider-close-timeline-tooltip}{@event-click: handleCloseClick}">\r\n                        <img src="Resources/Images/Icons/close-24.png" />\r\n                        <span class="action-label" data-binding="{@text: @language-timeslider-close-timeline-button-label}"></span>\r\n                </button>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n</div>\r\n'}}),define(["Mapping/modules/TimeSlider/TimeSliderModule","Mapping/modules/TimeSlider/TimeSliderSettingsView","Mapping/modules/TimeSlider/TimeSliderView","Mapping/modules/TimeSlider/TimeSliderViewModel"],function(e,t,i,a){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.timeSlider.TimeSliderModule",e.TimeSliderModule),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.timeSlider.TimeSliderSettingsView",t.TimeSliderSettingsView),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.timeSlider.TimeSliderView",i.TimeSliderView),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.timeSlider.TimeSliderViewModel",a.TimeSliderViewModel)});