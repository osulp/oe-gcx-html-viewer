!function(){var t="<video autoplay data-binding='{@var: videoElement}{@event-keydown: handleKeyDown}'></video><canvas data-binding='{@var: canvasElement}' style='display: block;' id='qr-canvas'></canvas><ul class='camera-controls'>    <li>        <button class='button' data-binding='{@text: @language-common-cancel}{@event-onclick: handleBackClick}'></button>    </li>    <li>        <button class='button' data-binding='{@text: @language-barcode-scanner-switch}{@visible: showSourceSwitcher}{@event-onclick: handleSwitchSource}'></button>    </li></ul>";function o(e,t,n){if("string"==typeof e&&(n=t,t=e),void 0!==n)for(var o=t.split("."),a=null,r=window,i=0,s=o.length;i<s;i++)a=o[i],i==s-1?r[a]=n:r[a]||(r[a]={}),r=r[a];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/BarcodeScanner/BarcodeScannerModule":function(){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=(o=n.ModuleBase,i(r,o),r.prototype.initialize=function(e){this._config=e,this.app.command("LaunchBarcodeScannerWithCallback").register(this,this._executeLaunchBarcodeScanner),this.app.event("NativeMessageEvent").subscribe(this,this._handleNativeMessageEvent),this.app.event("_HtmlBarcodeScannerResult").subscribe(this,this._handleHtmlBarcodeScanner)},r.prototype._executeLaunchBarcodeScanner=function(e){var n=this;this.lastCallback=e,this.app.nativeManager.hasNativeCapability("barcodeScanner").then(function(e){var t=n.app.nativeManager.isNative();e&&!1!==n._config.allowNativeScanner&&t?n.app.nativeManager.message("LaunchBarcodeScanner",{}):!1!==n._config.allowHtmlScanner&&Modernizr.getusermedia&&Modernizr.webworkers?n.app.command("ActivateView").execute(n._config.htmlScannerView):(n.app.trace.warning("Could not launch a QR scanner."),alert(n.getResource("language-barcode-scanner-unavailable")))})},r.prototype._handleNativeMessageEvent=function(e){"BarcodeScanResult"===e.type&&this.lastCallback&&(this.lastCallback(e.parameters),this.lastCallback=null)},r.prototype._handleHtmlBarcodeScanner=function(e){this.lastCallback&&(this.lastCallback({status:"Success",content:e.value}),this.lastCallback=null)},r);function r(){return null!==o&&o.apply(this,arguments)||this}t.BarcodeScannerModule=a})},"Mapping/modules/BarcodeScanner/BarcodeScannerModuleConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/BarcodeScanner/BarcodeScannerView":function(){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,a=(o=n.ViewBase,i(r,o),r.prototype.activated=function(){o.prototype.activated.call(this),this._getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,this._getUserMedia?Worker?(this._startJsqrcodeWorker(),this._startJobWorker(),this._startVideo()):this.app.trace.error(this.id+" shown but web workers aren't available.  Barcode and QR code scanning won't work."):this.app.trace.error(this.id+" shown but getUserMedia isn't available.  Barcode and QR code scanning won't work.")},r.prototype.deactivated=function(){o.prototype.deactivated.call(this),this._stopVideo()},r.prototype._startJsqrcodeWorker=function(){var t=this;this._jsqrcodeWorker||(this.configuration.jsqrcodeSource?(this._jsqrcodeWorker=new Worker(this.configuration.jsqrcodeSource),this._jsqrcodeWorker.onmessage=function(e){t._outstandingWorkCount--,e.data.success&&(t.app.command("DeactivateView").execute(t.id),t.app.event("_HtmlBarcodeScannerResult").publish({format:"QR",value:e.data.result}))},this._jsqrcodeWorker.onerror=function(e){t.app.trace.error("Error scanning barcode. "+e.message)}):this.app.trace.error(this.id+" shown but jsqrcodeSource is not configured.  QR code scanning won't work."))},r.prototype._startJobWorker=function(){var t=this;this._jobWorker||(this.configuration.jobDecoderWorkerSource?(this._jobWorker=new Worker(this.configuration.jobDecoderWorkerSource),this._jobWorker.onmessage=function(e){"boolean"==typeof e.data.success&&t._outstandingWorkCount--,!0===e.data.success&&0<e.data.result.length&&(t.app.command("DeactivateView").execute(t.id),t.app.event("_HtmlBarcodeScannerResult").publish({format:e.data.result[0].Format,value:e.data.result[0].Value}))},this._jobWorker.onerror=function(e){t.app.trace.error("Error scanning barcode. "+e.message)}):this.app.trace.error(this.id+" shown but jobDecoderWorkerSource is not configured.  Barcode scanning won't work."))},r.prototype._startVideo=function(){var n=this;this._attachedVideoEventListeners||(this._attachVideoEventListeners(),this._attachedVideoEventListeners=!0),this._lastSourceInfo?this._startVideoWithSourceInfo(this._lastSourceInfo):MediaStreamTrack&&MediaStreamTrack.getSources?MediaStreamTrack.getSources(function(e){if(0!==(e=e.filter(function(e){return"video"===e.kind})).length)if(1!==e.length){var t=e.filter(function(e){return"environment"===e.facing});0<t.length?n._startVideoWithSourceInfo(t[0]):(n._sourceInfos=e,n.viewModel.showSourceSwitcher.set(!0),n._startVideoWithSourceInfo(e[0]))}else n._startVideoWithSourceInfo(e[0]);else n._startVideoWithConstraints({video:!0,audio:!1})}):this._startVideoWithConstraints({video:!0,audio:!1})},r.prototype._attachVideoEventListeners=function(){function e(){n=n||setInterval(function(){0<o._outstandingWorkCount?++a%5==0&&o.app.trace.warning(o.id+" skipped processing "+a+" frames in a row."):(o._outstandingWorkCount<0&&(o.app.trace.error(o.id+" outstanding work count is negative. Work dispatching and results have gone out of sync."),o._outstandingWorkCount=0),a=0,o._scan())},o.configuration.scanInterval||750)}function t(){n&&(clearInterval(n),n=null)}var n,o=this,a=0;this.videoElement.addEventListener("play",e),this.videoElement.addEventListener("playing",e),this.videoElement.addEventListener("abort",t),this.videoElement.addEventListener("ended",t),this.videoElement.addEventListener("pause",t),this.videoElement.addEventListener("waiting",t)},r.prototype._startVideoWithSourceInfo=function(e){this._lastSourceInfo=e,this._startVideoWithConstraints({video:{optional:[{sourceId:e.id}]},audio:!1})},r.prototype._startVideoWithConstraints=function(e){var n=this;this._stopVideo(),this._getUserMedia.call(navigator,e,function(e){n._mediaStream=e;var t=window.URL||window.webkitURL;n.videoElement.src=t?t.createObjectURL(e):e,n.videoElement.play(),n.videoElement.focus()},function(e){n.app.trace.error("Error getting user media. "+e.message)})},r.prototype._stopVideo=function(){this.videoElement.pause(),this.videoElement.src="",this._mediaStream&&((this._mediaStream.getTracks()||[]).forEach(function(e){return e.stop()}),this._mediaStream=null)},r.prototype._scan=function(){if(!this.videoElement.paused&&!this.videoElement.ended){this._canvasContext||(this._canvasContext=this.canvasElement.getContext("2d")),this._canvasContext.drawImage(this.videoElement,0,0);var e=this.canvasElement.clientWidth,t=this.canvasElement.clientHeight;this.canvasElement.width===e&&this.canvasElement.height===t||(this.canvasElement.width=e,this.canvasElement.height=t);var n=this._canvasContext.getImageData(0,0,e,t);n&&(this._jsqrcodeWorker&&(this._jsqrcodeWorker.postMessage({imageData:n,width:e,height:t}),this._outstandingWorkCount++),this._jobWorker&&(this._jobWorker.postMessage({scan:n.data,scanWidth:e,scanHeight:t}),this._outstandingWorkCount++))}},r.prototype.handleKeyDown=function(e,t,n){(e.which?e.which:e.keyCode)===dojo.keys.ESCAPE&&this.app.command("DeactivateView").execute(this.id)},r.prototype.handleBackClick=function(e,t,n){this.app.command("DeactivateView").execute(this.id)},r.prototype.handleSwitchSource=function(e,t,n){if(this._sourceInfos){var o=this._sourceInfos.indexOf(this._lastSourceInfo),a=o+1<this._sourceInfos.length?o+1:0;this._startVideoWithSourceInfo(this._sourceInfos[a])}else this.app.trace.error(this.id+" handleSwitchSource called but source switching is not available.")},r);function r(){var e=null!==o&&o.apply(this,arguments)||this;return e._outstandingWorkCount=0,e._attachedVideoEventListeners=!1,e}t.BarcodeScannerView=a})},"Mapping/modules/BarcodeScanner/BarcodeScannerViewConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/BarcodeScanner/BarcodeScannerViewModel":function(){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=(a=n.ViewModelBase,s(i,a),i);function i(){var e=null!==a&&a.apply(this,arguments)||this;return e.showSourceSwitcher=new o.Observable(!1),e}t.BarcodeScannerViewModel=r})},"url:/Mapping/modules/BarcodeScanner/BarcodeScannerView.html":t}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/BarcodeScanner/CSS/common.css","css","LkJhcmNvZGVTY2FubmVyVmlldywNCi5CYXJjb2RlU2Nhbm5lclZpZXcgdmlkZW8sDQouc3BsYXNoLWJsdXJyZWQsDQouQmFyY29kZVNjYW5uZXJWaWV3IGNhbnZhcyB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIG1hcmdpbjogMDsNCn0NCg0KLkJhcmNvZGVTY2FubmVyVmlldyB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouQmFyY29kZVNjYW5uZXJWaWV3IHZpZGVvIHsNCiAgICBvYmplY3QtZml0OiBjb3ZlcjsNCn0NCg0KLkJhcmNvZGVTY2FubmVyVmlldyAuY2FtZXJhLWNvbnRyb2xzLA0KLkJhcmNvZGVTY2FubmVyVmlldyAuY2FtZXJhLWNvbnRyb2xzIGxpIHsNCiAgICBwYWRkaW5nOiAwOw0KICAgIG1hcmdpbjogMDsNCiAgICBsaXN0LXN0eWxlOiBub25lOw0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCi5CYXJjb2RlU2Nhbm5lclZpZXcgLmNhbWVyYS1jb250cm9scyB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogNGVtOw0KICAgIGxlZnQ6IDA7DQogICAgYm90dG9tOiAwOw0KICAgIHpvb206IDE7DQoJZmlsdGVyOiBhbHBoYShvcGFjaXR5PTg1KTsNCglvcGFjaXR5OiAwLjg1Ow0KfQ0KLkJhcmNvZGVTY2FubmVyVmlldyAuY2FtZXJhLWNvbnRyb2xzIGxpIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IDUwJTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCn0NCi5CYXJjb2RlU2Nhbm5lclZpZXcgLmNhbWVyYS1jb250cm9scyBsaTpmaXJzdC1jaGlsZCB7DQogICAgdGV4dC1hbGlnbjogcmlnaHQ7DQp9DQouQmFyY29kZVNjYW5uZXJWaWV3IC5jYW1lcmEtY29udHJvbHMgbGk6bGFzdC1jaGlsZCB7DQogICAgbWFyZ2luLWxlZnQ6IC00cHg7DQp9DQouQmFyY29kZVNjYW5uZXJWaWV3IC5jYW1lcmEtY29udHJvbHMgLmJ1dHRvbiB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogM2VtOw0KICAgIG1heC13aWR0aDogMTBlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgYm9yZGVyOiAxcHggc29saWQ7DQp9"),e.resourceManager.register("Mapping","inv","Mapping/modules/BarcodeScanner/BarcodeScannerView.html","html",t)}),require({cache:{}}),define(["Mapping/modules/BarcodeScanner/BarcodeScannerModule","Mapping/modules/BarcodeScanner/BarcodeScannerView","Mapping/modules/BarcodeScanner/BarcodeScannerViewModel"],function(e,t,n){o(e,"geocortex.essentialsHtmlViewer.mapping.modules.barcodescanner.BarcodeScannerModule",e.BarcodeScannerModule),o(t,"geocortex.essentialsHtmlViewer.mapping.modules.barcodescanner.BarcodeScannerView",t.BarcodeScannerView),o(n,"geocortex.essentialsHtmlViewer.mapping.modules.barcodescanner.BarcodeScannerViewModel",n.BarcodeScannerViewModel)})}();