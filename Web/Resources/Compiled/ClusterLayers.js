function shim(e,t,r){if("string"==typeof e&&(r=t,t=e),"undefined"==typeof r)return void console.warn("Undefined shim for: "+t);for(var a=t.split("."),s=null,i=window,n=0,l=a.length;n<l;n++)s=a[n],n==l-1?i[s]=r:i[s]||(i[s]={}),i=i[s]}require({cache:{"Mapping/modules/ClusterLayers/ClusterLayerModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/framework/observables","geocortex/infrastructure/ClusterLayer","geocortex/essentials/LayerType"],function(e,t,r,a,s,i){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clusterLayers=new a.ObservableCollection(null),t.hideClusters=new a.Observable(s.ClusterHidingOptions.none),t}return __extends(t,e),t.prototype.initialize=function(e){var t=this;if(e.hasOwnProperty("hideClusters")&&null!=e.hideClusters){var r=e.hideClusters;void 0===s.ClusterHidingOptions[r]||null===s.ClusterHidingOptions[r]?this.app.trace.warning('Invalid clustering option "'+r+'" given.'):this.hideClusters.set(s.ClusterHidingOptions[r])}this.app.command("AddClusterLayer").register(this,this._addClusterLayer,this._canExecuteAddClusterLayer),this.app.command("RemoveClusterLayer").register(this,this._removeClusterLayer,this._canExecuteRemoveClusterLayer),this.app.map&&this.app.map.loaded?this._checkIfClustersAreEnabledByDefault():this.app.event("MapLoadedEvent").once(this,function(e){t._checkIfClustersAreEnabledByDefault()}),this.app.event("MapServiceRemovedEvent").subscribe(this,function(e){e.featureClustering&&e.featureClustering.enabled&&t.app.command("RemoveClusterLayer").execute({gcxLayer:e.layers[0]})})},t.prototype._addClusterLayer=function(e){var t=this._returnGeocortexLayer(e);if(t.type!==i.LayerType.FEATURE_LAYER)return void this.app.trace.info("Can only create a cluster layer from a feature layer.");this.app.command("RemoveVisualization").execute({gcxLayer:t});var r=new s.ClusterLayer(t,this.app);t.mapService.featureClustering.enabled=!0,r.hideClusters.set(this.hideClusters.get());var a;for(a=0;a<this.app.map.graphicsLayerIds.length&&this.app.map.graphicsLayerIds[a]!==t.mapService.id;a++);this.app.map.addLayer(r,a+1),this.clusterLayers.addItem(r),this.app.command("AddClusterLayer").raiseCanExecuteChanged(),this.app.command("RemoveClusterLayer").raiseCanExecuteChanged(),this.app.event("ClusterLayerAddedEvent").publish(r),this.app.event("LayerVisualizationChangedEvent").publish(t)},t.prototype._canExecuteAddClusterLayer=function(e){var t=this._returnGeocortexLayer(e);return!!(t&&t.mapService&&t.mapService.featureClustering)&&!t.mapService.featureClustering.enabled},t.prototype._removeClusterLayer=function(e){var t=this._returnGeocortexLayer(e);if(t){for(var r=0;r<this.clusterLayers.getLength();r++){var a=this.clusterLayers.getAt(r);a.id===t.mapService.id+"-cluster"&&(this.clusterLayers.removeItem(a),this.app.event("ClusterLayerRemovedEvent").publish(a),this.app.event("LayerVisualizationChangedEvent").publish(t))}t.mapService.featureClustering.enabled=!1,this.app.command("AddClusterLayer").raiseCanExecuteChanged(),this.app.command("RemoveClusterLayer").raiseCanExecuteChanged()}},t.prototype._canExecuteRemoveClusterLayer=function(e){var t=this._returnGeocortexLayer(e);return!!(t&&t.mapService&&t.mapService.featureClustering)&&t.mapService.featureClustering.enabled},t.prototype._canExecuteSetActiveClusterLayer=function(e){var t=this._returnGeocortexLayer(e);return!(!t||this.clusterLayers.getLength()<=0)},t.prototype._checkIfClustersAreEnabledByDefault=function(){var e=this.app.site;if(e&&e.essentialsMap)for(var t=0;t<e.essentialsMap.mapServices.length;t++){var r=e.essentialsMap.mapServices[t];if(r.featureClustering&&r.featureClustering.enabled)for(var a=0;a<r.layers.length;a++)this._addClusterLayer({gcxLayer:r.layers[a]})}},t.prototype._returnGeocortexLayer=function(e){if("string"==typeof e){if(!this.app.site||!this.app.site.essentialsMap)return null;var t=this.app.site.essentialsMap.allLayers();return t.filter(function(t){return e===t.mapService.id})[0]}return e.gcxLayer},t}(r.ModuleBase);t.ClusterLayerModule=n})},"Mapping/modules/ClusterLayers/ClusterLayerView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(r.ViewBase);t.ClusterLayerView=a})},"Mapping/modules/ClusterLayers/ClusterLayerViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,r,a){"use strict";var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clusterLayers=new a.ObservableCollection(null),t.selectedClusterLayer=new a.Observable(null),t.selectedGeocortexLayer=new a.Observable(null),t}return __extends(t,e),t.prototype.initialize=function(t){var r=this;e.prototype.initialize.call(this,t),this.app.event("ClusterLayerAddedEvent").subscribe(this,function(e){r.clusterLayers.addItem(e)}),this.app.event("ClusterLayerRemovedEvent").subscribe(this,function(e){r.clusterLayers.removeItem(e),r.selectedClusterLayer.get()===e&&r.selectedClusterLayer.set(null)}),this.app.event("VisualizationViewActivatedEvent").subscribe(this,function(e){r.selectedGeocortexLayer.set(e);var t=r.clusterLayers.get().filter(function(t){return t.gcxLayer===e});t.length>0&&r.selectedClusterLayer.set(t[0])}),this.app.event("LayerVisualizationChangedEvent").subscribe(this,function(e){var t=r.clusterLayers.get().filter(function(t){return t.gcxLayer===e});t.length>0&&r.selectedClusterLayer.set(t[0])}),this.app.event("ClusterLayerOptionsChangedEvent").subscribe(this,function(){r.selectedClusterLayer.get().recluster()})},t}(r.ViewModelBase);t.ClusterLayerViewModel=s})},"Mapping/modules/ClusterLayers/ClusterLayerVisualizationProvider":function(){define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase"],function(e,t,r){"use strict";var a=function(e){function t(t,r){var a=e.call(this,t,r)||this;a.displayName=a.app.getResource(r,"language-clustering-name");var s={provider:a,name:a.displayName,id:a.displayName};return a.visualizations.push(s),a.enabledVisualization=s,a}return __extends(t,e),t.prototype.canSupport=function(e){return!(!e||!e.mapService)&&(e.mapService.featureClustering&&e.mapService.featureClustering.userCanToggle)},t.prototype.handleCurrentLayerChanged=function(e){e.mapService&&e.mapService.featureClustering?(this.isEnabled.set(e.mapService.featureClustering.enabled),this.isSupported.set(e.mapService.featureClustering.userCanToggle),this.app.event("LayerVisualizationChangedEvent").publish(e)):(this.isEnabled.set(!1),this.isSupported.set(!1)),this.isEnabled.get()&&(this.enabledVisualization=this.visualizations[0])},t.prototype.handleActivate=function(){this.app.command("AddClusterLayer").execute({gcxLayer:this.currentLayer.get()})},t.prototype.handleApply=function(){this.app.event("ClusterLayerOptionsChangedEvent").publish()},t}(r.VisualizationProviderBase);t.ClusterLayerVisualizationProvider=a})},"url:/Mapping/modules/ClusterLayers/ClusterLayerView.html":'<div class="clusters" data-binding="{@source: selectedClusterLayer}">\r\n    <div class="form-stacked" data-binding="{@template-for: selectedClusterLayer}">\r\n        <h4 class="visualization-title" data-binding="{@text: @language-clustering-title}"></h4>\r\n        <div class="form-item">\r\n            <label class="form-label" data-binding="{@text: @language-clustering-radius}"></label>\r\n            <div class="form-control">\r\n                <input type="number" data-binding="{@value: clusterRadius}{title: @language-clustering-radius}" />\r\n            </div>\r\n        </div>\r\n        <div class="form-item">\r\n            <label class="form-label" data-binding="{@text: @language-clustering-maximum-features}"></label>\r\n            <div class="form-control">\r\n                <input type="number" min="0" data-binding="{@value: maxFeaturesInCluster}{title: @language-clustering-maximum-features}" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}}),define(["Mapping/modules/ClusterLayers/ClusterLayerModule","Mapping/modules/ClusterLayers/ClusterLayerView","Mapping/modules/ClusterLayers/ClusterLayerViewModel","Mapping/modules/ClusterLayers/ClusterLayerVisualizationProvider"],function(e,t,r,a){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.clusterLayers.ClusterLayerModule",e.ClusterLayerModule),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.clusterLayers.ClusterLayerView",t.ClusterLayerView),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.clusterLayers.ClusterLayerViewModel",r.ClusterLayerViewModel),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.clusterLayers.ClusterLayerVisualizationProvider",a.ClusterLayerVisualizationProvider)});