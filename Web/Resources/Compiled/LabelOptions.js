!function(){function e(e,i,t){if("string"==typeof e&&(t=i,i=e),void 0!==t)for(var s=i.split("."),l=null,o=window,a=0,n=s.length;a<n;a++)l=s[a],a==n-1?o[l]=t:o[l]||(o[l]={}),o=o[l];else console.warn("Undefined shim for: "+i)}var i="<div class='labelOptions panel-group-contents'>    <div class='labelOptions-selector form-item'>        <div class='form-stacked'>            \x3c!--Show Labels--\x3e            <div class='form-item' data-binding='{@visible: showLabelsIsVisible}'>                <div class='form-control'>                    <label class='labelOptions-item-ctrl'>                        <input class='checkbox' type='checkbox' data-binding='{@value: showLabels}'>                        <span class='checkbox-label' data-binding='{@text: @language-labelOptions-show-labels}'></span>                    </label>                </div>            </div>            \x3c!--Field--\x3e            <div class='form-item' data-binding='{@visible: fieldIsVisible}'>                <div class='symbology-form-control'>                    <label class='form-label'>                        <span data-binding='{@text: @language-labelOptions-field}'></span>                        <select class='symbology-select' data-binding='{@enabled: showLabels}{@source: layerFields}{@value: selectedFieldName}'>                            <option data-binding='{@template-for: layerFields}{value: name}{@text: displayName}'></option>                        </select>                    </label>                </div>            </div>            <div data-binding='{@widget: LabelOptionsTextWidget}{@widget-replace: true}'></div>            \x3c!--Label Placement--\x3e            <div class='form-item' data-binding='{@visible: labelPlacementIsVisible}'>                <label class='form-label' data-binding='{@text: @language-labelOptions-label-placement}'></label>                <div class='form-control'>                    <select class='attribute-value' data-binding='{@enabled: showLabels}{@source: labelPlacements}{@value: selectedPlacement}'>                        <option data-binding='{@template-for: labelPlacements}{value: config}{@text: displayName}'></option>                    </select>                </div>            </div>            \x3c!--Warning--\x3e            <div class='warning-label' data-binding='{@hidden: hasDrawingInfo}{@text: tailoredWarning}'></div>            \x3c!--Action Buttons--\x3e            <div class='form-item'>                <div class='form-btns'>                    <button class='button' data-binding='{@event-onclick: handleClickButtonApply}{@text: @language-labelOptions-apply}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonOK}{@text: @language-labelOptions-done}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@enabled: isLabelCustom}{@text: @language-labelOptions-reset}{@visible: warningAcknowledged}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCustomize}{@text: @language-labelOptions-customize}{@hidden: warningAcknowledged}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCancel}{@text: @language-labelOptions-cancel}'></button>                </div>            </div>        </div>    </div>    <div class='labelOptions-cover'></div></div>";require({cache:{"Mapping/modules/LabelOptions/LabelConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t=function(){return function(e,i,t){this.labelClass=t,this.showLabels=i,this.layer=e}}();i.LabelConfig=t})},"Mapping/modules/LabelOptions/LabelOptionsModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function s(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(i,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(i){function t(e,t){return i.call(this,e,t)||this}return e(t,i),t.prototype.initialize=function(e){i.prototype.initialize.call(this,e),this._config=e},t}(s.ModuleBase);t.LabelOptionsModule=l})},"Mapping/modules/LabelOptions/LabelOptionsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function s(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/widgets/TextSymbolWidgetViewModel"],function(i,t,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(i){function t(e,t){var s=i.call(this,e,t)||this;return s.registerCommands(),s}return e(t,i),t.prototype.attach=function(e){i.prototype.attach.call(this,e)},t.prototype.activated=function(){var e=this;this.viewModel.textSymbolWidget&&setTimeout(function(){e.viewModel.textSymbolWidget.activated()},0)},t.prototype.registerCommands=function(){var e=this;this.app.commandRegistry.command("ShowLabelOptionsView").register(this,this.showLabelOptionsView,this.canExecuteShowLabelOptionsView),this.app.command("HideLabelOptionsView").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},t.prototype.canExecuteShowLabelOptionsView=function(e){var i=this;if(null!=e&&null!=e.mapService&&"None"!=e.featureType&&e.mapService.supportsDynamicLayers&&e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=e.mapService.serviceLayer;if(!t.layerDrawingOptions){for(var s=t.layerInfos[0].id,l=1;l<t.layerInfos.length;l++)t.layerInfos[l].id>s&&(s=t.layerInfos[l].id);t.setLayerDrawingOptions(new Array(s)),t.layerInfos.forEach(function(e){t.layerDrawingOptions[e.id]=new esri.layers.LayerDrawingOptions,t.layerDrawingOptions[e.id].showLabels=!0,i.viewModel.showLabels.set(!0)}),t.refresh()}return!0}return!1},t.prototype.showLabelOptionsView=function(e){this.viewModel.obsLayer.set(e),this.title.set(e.displayName),this.app.command("ActivateView").execute(this.id)},t.prototype.resolveWidget=function(e,t,s){if(i.prototype.resolveWidget.call(this,e,t),"LabelOptionsTextWidget"===e){return this.viewModel.textSymbolWidget=this.app.viewManager.createView({viewId:"LabelOptionsTextWidget",markupResource:"Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.TextSymbolWidget",isVisible:!0,libraryId:"Mapping.Infrastructure"}),this.viewModel.widgetViewModel=new l.TextSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),this.viewModel.widgetViewModel.initialize({fontSize:this.viewModel.viewConfig.fontSize,fontFamilies:this.viewModel.viewConfig.fontFamilies}),this.viewModel.textSymbolWidget.attach(this.viewModel.widgetViewModel),this.viewModel.widgetViewModel.showFontColor.sync(this.viewModel.fontColorIsVisible),this.viewModel.widgetViewModel.showFontFamilies.sync(this.viewModel.fontFamiliesIsVisible),this.viewModel.widgetViewModel.showFontSize.sync(this.viewModel.fontSizeIsVisible),this.viewModel.widgetViewModel.showFontStyle.sync(this.viewModel.fontStyleIsVisible),this.viewModel.widgetViewModel.showHaloColor.sync(this.viewModel.haloColorIsVisible),this.viewModel.widgetViewModel.showHaloSize.sync(this.viewModel.haloSizeIsVisible),this.viewModel.widgetViewModel.fontFamilies.sync(this.viewModel.fontFamilies),this.viewModel.fontIsBold.sync(this.viewModel.widgetViewModel.fontIsBold),this.viewModel.fontIsItalic.sync(this.viewModel.widgetViewModel.fontIsItalic),this.viewModel.fontIsUnderline.sync(this.viewModel.widgetViewModel.fontIsUnderline),this.viewModel.fontSize.sync(this.viewModel.widgetViewModel.fontSize),this.viewModel.haloSize.sync(this.viewModel.widgetViewModel.haloSize),this.viewModel.selectedFont.sync(this.viewModel.widgetViewModel.fontFamily),this.viewModel.selectedFontColor.sync(this.viewModel.widgetViewModel.fontColor.color),this.viewModel.selectedHaloColor.sync(this.viewModel.widgetViewModel.fontHalo.color),this.viewModel.widgetViewModel.showText.set(!1),this.viewModel.widgetViewModel.showTextAngle.set(!1),this.viewModel.textSymbolWidget}},t.prototype.handleClickButtonOK=function(e,i,t){this.viewModel.applyLabelOptions(),this.app.viewManager.deactivateView(this)},t.prototype.handleClickButtonCancel=function(e,i,t){this.app.viewManager.deactivateView(this)},t.prototype.handleClickButtonApply=function(e,i,t){this.viewModel.applyLabelOptions()},t.prototype.handleClickButtonReset=function(e,i,t){this.viewModel.warningAcknowledged.set(!1),this.viewModel.resetLabelOptions()},t.prototype.handleClickButtonCustomize=function(e,i,t){this.viewModel.warningAcknowledged.set(!0)},t}(s.ViewBase);t.LabelOptionsView=o})},"Mapping/modules/LabelOptions/LabelOptionsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function s(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./LabelConfig","geocortex/geocortex","geocortex/infrastructure/ArrayUtils","geocortex/essentials/utilities/DecomposedUri","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/BrowserUtils"],function(i,t,s,l,o,a,n,r,b,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(i){function t(e,t){var s=i.call(this,e,t)||this;s.obsLayer=new l.Observable,s.labelClassOriginal=[],s.labelClassConfigured=[],s.showLabels=new l.Observable(!0),s.layerName=new l.Observable(""),s.layerFields=new l.ObservableCollection,s.fontFamilies=new l.ObservableCollection,s.fontSize=new l.Observable,s.fontIsBold=new l.Observable(!1),s.fontIsItalic=new l.Observable(!1),s.fontIsUnderline=new l.Observable(!1),s.haloSize=new l.Observable,s.isLayerFeatureTypePoint=new l.Observable(!1),s.isLayerFeatureTypePolygon=new l.Observable(!1),s.pointLabelPlacements=[],s.lineLabelPlacements=[],s.labelPlacements=new l.ObservableCollection,s.selectedFieldName=new l.Observable(""),s.selectedFont=new l.Observable(""),s.selectedFontColor=new l.Observable(new b.SymbolColor("#000000")),s.selectedHaloColor=new l.Observable(new b.SymbolColor("#FFFFFF")),s.selectedPlacement=new l.Observable(""),s.selectedFontSizeChoice=new l.Observable(""),s.isIE9or11=!1,s.showLabelsIsVisible=new l.Observable(!0),s.haloSizeIsVisible=new l.Observable(!0),s.haloColorIsVisible=new l.Observable(!0),s.fontStyleIsVisible=new l.Observable(!0),s.fontSizeIsVisible=new l.Observable(!0),s.fontColorIsVisible=new l.Observable(!0),s.fontFamiliesIsVisible=new l.Observable(!0),s.fieldIsVisible=new l.Observable(!0),s.labelPlacementIsVisible=new l.Observable(!0),s.tailoredWarning=new l.Observable(""),s.warningAcknowledged=new l.Observable(!1),s.hasDrawingInfo=new l.Observable(!1),s.defaultColor="#000000",s.defaultFontSize=16,s.isLabelCustom=new l.Observable(!1),s.toggledOnly=new l.Observable(!0);var o=g.isIE();return s.isIE9or11=9===o||11===o,s.haloColorIsVisible.set(!s.isIE9or11),s.haloColorIsVisible.set(!s.isIE9or11),s}return e(t,i),t.prototype.initialize=function(e){var t=this;i.prototype.initialize.call(this,e),this.viewConfig=e,this.fontSize.set(this.defaultFontSize),this.warningAcknowledged.bind(this,function(){t.haloSizeIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.haloSizeIsVisible&&!t.isIE9or11),t.haloColorIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.haloColorIsVisible&&!t.isIE9or11),t.fontStyleIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontStyleIsVisible),t.fontSizeIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontSizeIsVisible),t.fontColorIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontColorIsVisible),t.fontFamiliesIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontFamiliesIsVisible),t.fieldIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fieldIsVisible),t.labelPlacementIsVisible.set(t.warningAcknowledged.get()&&!t.isLayerFeatureTypePolygon.get()&&t.viewConfig.labelPlacementIsVisible)}),this.isLayerFeatureTypePolygon.bind(this,function(){t.labelPlacementIsVisible.set(!t.isLayerFeatureTypePolygon.get()&&t.warningAcknowledged.get()&&t.viewConfig.labelPlacementIsVisible)}),this._registerCommands()},t.prototype._registerCommands=function(){var e=this;this.obsLayer.bind(this,function(i){e.populateLabelOptionsView(i)}),this.app.commandRegistry.command("ToggleDynamicLabels").register(this,this.toggleDynamicLabels,this.canExecuteToggleDynamicLabels)},t.prototype.populateLabelOptionsView=function(e){var i=this;this.layer=e,this.tailoredWarning.set(this.getResource("language-labelOptions-unknown-label-warning").format(this.layer.displayName)),this.loadLabelPlacements(),this.loadLayerInformation(),this.loadFonts();var t=e.mapService.serviceLayer,s=t.layerDrawingOptions,l=s[e.id];this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new o.LabelConfig(e,l.showLabels,l.labelingInfo));var a=this.getLabelClass(this.labelClassOriginal).labelClass,n=!!a&&a.length;if(this.isLabelClassStored(this.labelClassConfigured))return n?this.hasDrawingInfo.set(!0):this.hasDrawingInfo.set(!1),this.warningAcknowledged.set(!0),void this.loadConfiguration();if(n)return this.hasDrawingInfo.set(!0),this.warningAcknowledged.set(!0),void this.loadOriginalValues();var b=r.DecomposedUri.appendToPath(t.url,"/"+this.layer.id),g=[];this.requestLabelInfo(b).then(function(e){e&&g.push(e)}).then(function(){if(g.length)return i.setLabelClass(g,i.labelClassOriginal),l.labelingInfo=g,s[e.id]=l,t.setLayerDrawingOptions(s),t.refresh(),void i.populateLabelOptionsView(i.layer);i.hasDrawingInfo.set(!1),i.warningAcknowledged.set(!1),i.loadDefaultConfiguration()}).catch(function(){i.hasDrawingInfo.set(!1),i.warningAcknowledged.set(!1),i.loadDefaultConfiguration()})},t.prototype.requestLabelInfo=function(e){var i=this;return new Promise(function(t,s){var l=new r.DecomposedUri(e);l.query.f="json";var o={url:l.recompose()};a.request(o).then(function(e){e||t(null);var i=e,s=i?i.drawingInfo:null,l=s?s.labelingInfo:null;if(l&&l.length>0){var o=new esri.layers.LabelClass(l[0]);t(o)}else t(null)},function(e){i.app.trace.error("LabelOptions - Error requesting labels: "+e.message),s(e)})})},t.prototype.loadLayerInformation=function(){this.layerName.set(this.layer.displayName),this.layerFields.clear();var e=this.layer.fields.filter(function(e){return e.visible&&!!e.dataType&&!/Object/i.test(e.dataType)&&!/GUID/i.test(e.dataType)});switch(this.layerFields.set(n.ArrayUtils.sortBy(e,function(e){return e.displayName})),this.layerFields.getLength()?(this.selectedFieldName.set(this.layerFields.getAt(0).name),this.fieldIsVisible.set(!0)):this.fieldIsVisible.set(!1),this.layer.featureType){case"Point":case"Multipoint":this.isLayerFeatureTypePoint.set(!0),this.isLayerFeatureTypePolygon.set(!1);break;case d.Polygon.toString():this.isLayerFeatureTypePolygon.set(!0);break;default:this.isLayerFeatureTypePoint.set(!1),this.isLayerFeatureTypePolygon.set(!1)}this.isLayerFeatureTypePoint.get()?this.labelPlacements.set(this.pointLabelPlacements):this.labelPlacements.set(this.lineLabelPlacements),this.selectedPlacement.set(this.labelPlacements.getAt(0).config)},t.prototype.loadFonts=function(){this.widgetViewModel.fontFamilies.clear(),this.viewConfig.fontFamilies.length>0?this.widgetViewModel.fontFamilies.set(this.viewConfig.fontFamilies):this.fontFamiliesIsVisible.set(!1)},t.prototype.loadLabelPlacements=function(){this.pointLabelPlacements=[{config:"above-center",displayName:this.getResource("language-labelOptions-above-center")},{config:"above-left",displayName:this.getResource("language-labelOptions-above-left")},{config:"above-right",displayName:this.getResource("language-labelOptions-above-right")},{config:"center-center",displayName:this.getResource("language-labelOptions-center-center")},{config:"center-left",displayName:this.getResource("language-labelOptions-center-left")},{config:"center-right",displayName:this.getResource("language-labelOptions-center-right")},{config:"below-center",displayName:this.getResource("language-labelOptions-below-center")},{config:"below-left",displayName:this.getResource("language-labelOptions-below-left")},{config:"below-right",displayName:this.getResource("language-labelOptions-below-right")}],this.lineLabelPlacements=[{config:"above-after",displayName:this.getResource("language-labelOptions-above-after")},{config:"above-along",displayName:this.getResource("language-labelOptions-above-along")},{config:"above-before",displayName:this.getResource("language-labelOptions-above-before")},{config:"above-start",displayName:this.getResource("language-labelOptions-above-start")},{config:"above-end",displayName:this.getResource("language-labelOptions-above-end")},{config:"below-after",displayName:this.getResource("language-labelOptions-below-after")},{config:"below-along",displayName:this.getResource("language-labelOptions-below-along")},{config:"below-before",displayName:this.getResource("language-labelOptions-below-before")},{config:"below-start",displayName:this.getResource("language-labelOptions-below-start")},{config:"below-end",displayName:this.getResource("language-labelOptions-below-end")},{config:"center-after",displayName:this.getResource("language-labelOptions-center-after")},{config:"center-along",displayName:this.getResource("language-labelOptions-center-along")},{config:"center-before",displayName:this.getResource("language-labelOptions-center-before")},{config:"center-start",displayName:this.getResource("language-labelOptions-center-start")},{config:"center-end",displayName:this.getResource("language-labelOptions-center-end")}]},t.prototype.loadDefaultConfiguration=function(){this.showLabels.get()&&this.showLabels.set(this.viewConfig.showLabels),this.widgetViewModel.fontIsBold.set(this.viewConfig.fontIsBold),this.widgetViewModel.fontIsItalic.set(this.viewConfig.fontIsItalic),this.widgetViewModel.fontIsUnderline.set(this.viewConfig.fontIsUnderline),this.widgetViewModel.fontColor.color.set(new b.SymbolColor(this.viewConfig.fontColor)),this.widgetViewModel.haloSize.set(this.viewConfig.haloSize),this.widgetViewModel.fontHalo.color.set(new b.SymbolColor(this.viewConfig.haloColor)),this.app.event("LabelsResetEvent").publish(),this.setIsVisibles(),this.fieldIsVisible.get()&&this.fieldIsVisible.set(this.viewConfig.fieldIsVisible),this.fontFamiliesIsVisible.get()&&this.fontFamiliesIsVisible.set(this.viewConfig.fontFamiliesIsVisible),this.warningAcknowledged.pulse()},t.prototype.loadConfiguration=function(){var e=this.getLabelClass(this.labelClassConfigured),i=e.labelClass[0].symbol;this.originalSymbol=new esri.symbol.TextSymbol(JSON.stringify(i.toJson()));var t=this.layer,s=t.mapService.serviceLayer.layerDrawingOptions[t.id];this.showLabels.set(s.showLabels),this.selectedFieldName.set(e.labelClass[0].labelExpression.replace("[","").replace("]","")),this.textSymbolWidget.setFromSymbol(i),this.selectedPlacement.set(e.labelClass[0].labelPlacement);var l=new esri.Color(i.haloColor);this.selectedHaloColor.set(new b.SymbolColor(l)),this.app.event("LabelsResetEvent").publish(),this.haloSize.set(i.haloSize),this.isLabelCustom.set(!0)},t.prototype.loadOriginalValues=function(){var e=this.layer,i=e.mapService.serviceLayer.layerDrawingOptions[e.id];this.showLabels.set(i.showLabels);var t=i.labelingInfo;if(this.selectedPlacement.set(t[0].labelPlacement),this.textSymbolWidget.setFromSymbol(t[0].symbol),this.app.event("LabelsResetEvent").publish(),this.setIsVisibles(),this.fieldIsVisible.get()){this.fieldIsVisible.set(this.viewConfig.fieldIsVisible);for(var s=t[0].labelExpression.replace("[","").replace("]",""),l=0;l<this.layerFields.getLength();l++)if(s===this.layerFields.getAt(l).displayName){s=this.layerFields.getAt(l).name;break}this.selectedFieldName.set(s)}this.fontFamiliesIsVisible.get()&&(this.fontFamiliesIsVisible.set(this.viewConfig.fontFamiliesIsVisible),this.selectedFont.set(t[0].symbol.font.family)),this.warningAcknowledged.pulse(),this.isLabelCustom.set(!1)},t.prototype.setIsVisibles=function(){this.showLabelsIsVisible.set(this.viewConfig.showLabelsIsVisible),this.fontSizeIsVisible.set(this.viewConfig.fontSizeIsVisible),this.fontStyleIsVisible.set(this.viewConfig.fontStyleIsVisible),this.fontColorIsVisible.set(this.viewConfig.fontColorIsVisible),this.haloSizeIsVisible.set(this.viewConfig.haloSizeIsVisible&&!this.isIE9or11),this.haloColorIsVisible.set(this.viewConfig.haloColorIsVisible&&!this.isIE9or11)},t.prototype.applyLabelOptions=function(){var e,i=this.layer,t=i.mapService.serviceLayer,s=t.layerDrawingOptions,l=s[i.id];if(l.labelingInfo&&l.labelingInfo.length&&(e=l.labelingInfo[0]),this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new o.LabelConfig(i,l.showLabels,l.labelingInfo)),l.showLabels=this.showLabelsIsVisible.get()||null==e?this.showLabels.get():l.showLabels,!this.warningAcknowledged.get())return s[i.id]=l,t.setLayerDrawingOptions(s),void t.refresh();var a=this.fieldIsVisible.get()||null==e?this.selectedFieldName.get():e.labelExpression.replace("[","").replace("]",""),n=new esri.symbol.Font;n.setFamily(this.fontFamiliesIsVisible.get()||null==e?this.selectedFont.get():e.symbol.font.family),n.setSize((this.fontSizeIsVisible.get()||null==e?this.fontSize.get():e.symbol.font.size)+"pt"),this.fontStyleIsVisible.get()||null==e?(this.fontIsBold.get()?n.setWeight("bold"):n.setWeight("normal"),this.fontIsItalic.get()?n.setStyle("italic"):n.setStyle("normal"),this.fontIsUnderline.get()?n.setDecoration("underline"):n.setDecoration("normal")):(n.setWeight(e.symbol.font.weight),n.setStyle(e.symbol.font.style),n.setDecoration(e.symbol.font.decoration));var r,b=this.fontColorIsVisible.get()||null==e?this.selectedFontColor.get().toEsriColor():e.symbol.color;this.labelPlacementIsVisible.get()||null==e?(r="always-horizontal","Polygon"!=i.featureType&&(r=this.selectedPlacement.get())):r=e.labelPlacement;var g=this.textSymbolWidget.getSymbol(),c=esri.symbol.fromJson(JSON.parse(g));c.haloColor&&(c.haloColor.a=1),c.setFont(n),c.setColor(b);var d=new esri.layers.LabelClass;d.labelExpression=String.format("[{0}]",a),d.useCodedValues=!1,d.symbol=c,d.labelPlacement=r,l.labelingInfo=[d],s[i.id]=l,t.setLayerDrawingOptions(s),t.refresh(),this.isLabelCustom.set(!0),this.toggledOnly.set(!1),this.setLabelClass([d],this.labelClassConfigured),this.app.eventRegistry.event("LabelOptionsChanged").publish()},t.prototype.resetLabelOptions=function(){this.textSymbolWidget.setFromSymbol(this.originalSymbol),this.app.event("LabelsResetEvent").publish();var e=this.layer,i=e.mapService.serviceLayer,t=i.layerDrawingOptions,s=t[e.id],l=this.getLabelClass(this.labelClassOriginal);s.labelingInfo=l.labelClass,s.showLabels=l.showLabels,t[e.id]=s,i.setLayerDrawingOptions(t),i.refresh(),this.removeConfiguredLabelClass(),this.showLabels.set(l.showLabels),this.populateLabelOptionsView(e),this.isLabelCustom.set(!1),this.toggledOnly.set(!0)},t.prototype.canExecuteToggleDynamicLabels=function(e){var i=this;if(null!=e&&null!=e.mapService&&"None"!=e.featureType&&e.mapService.supportsDynamicLayers&&e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=e.mapService.serviceLayer;if(!t.layerDrawingOptions){for(var s=t.layerInfos[0].id,l=1;l<t.layerInfos.length;l++)t.layerInfos[l].id>s&&(s=t.layerInfos[l].id);t.setLayerDrawingOptions(new Array(s)),t.layerInfos.forEach(function(e){t.layerDrawingOptions[e.id]=new esri.layers.LayerDrawingOptions,t.layerDrawingOptions[e.id].showLabels=!0,i.showLabels.set(!0)}),t.refresh()}return this.layer=e,!0}return!1},t.prototype.toggleDynamicLabels=function(e){var i=e.mapService.serviceLayer,t=i.layerDrawingOptions,s=t[e.id];this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new o.LabelConfig(e,s.showLabels,s.labelingInfo)),s.showLabels?(s.showLabels=!1,this.showLabels.set(!1)):(s.showLabels=!0,this.showLabels.set(!0)),this.labelClassOriginal[0].showLabels!=this.showLabels.get()?this.isLabelCustom.set(!0):this.toggledOnly.get()&&this.isLabelCustom.set(!1),t[e.id]=s,i.setLayerDrawingOptions(t),i.refresh()},t.prototype.isLabelClassStored=function(e){for(var i=!1,t=0;t<e.length;t++)if(this.layer===e[t].layer){i=!0;break}return i},t.prototype.getLabelClass=function(e){for(var i=null,t=0;t<e.length;t++)if(this.layer===e[t].layer){i=e[t];break}return i},t.prototype.setLabelClass=function(e,i){for(var t=!1,s=0;s<i.length;s++)if(this.layer===i[s].layer)return i[s].labelClass=e,void(t=!0);t||i.push(new o.LabelConfig(this.layer,this.showLabels.get(),e))},t.prototype.removeConfiguredLabelClass=function(){var e,i=!1;for(e=0;e<this.labelClassConfigured.length;e++)if(this.layer===this.labelClassConfigured[e].layer){i=!0;break}i&&this.labelClassConfigured.splice(e,1)},t}(s.ViewModelBase);t.LabelOptionsViewModel=c;var d;!function(e){e[e.Polygon="Polygon"]="Polygon"}(d||(d={}))})},"Mapping/modules/LabelOptions/ViewConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"url:/Mapping/modules/LabelOptions/LabelOptionsView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LabelOptions/CSS/common.css","css","LmxhYmVsT3B0aW9ucy1zZWxlY3RvciB7DQogICAgbWFyZ2luLWJvdHRvbTogMmVtOyANCn0NCg0KLmxhYmVsT3B0aW9uc3sNCiAgICBmb250LXdlaWdodDogbm9ybWFsOw0KfQ0KDQoubGFiZWxPcHRpb25zIC5mb3JtLWJ0bnMgew0KICAgIG1hcmdpbi10b3A6IDJlbTsNCn0NCg0KLmxhYmVsT3B0aW9ucy1pdGVtLWN0cmwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KfQ0KDQoubGFiZWxPcHRpb25zLWl0ZW0tY3RybC5mb250LWN0cmwtbGFiZWwgew0KICAgIHBhZGRpbmctYm90dG9tOiAwLjVlbTsNCn0NCg0KLmxhYmVsT3B0aW9ucy1zZWxlY3RvciAucmFkaW8tY29udGFpbmVyIHsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoud2FybmluZy1sYWJlbCB7DQogICAgcGFkZGluZzogMC41ZW0gMC4xZW0gMC41ZW0gMHB4Ow0KICAgIGNvbG9yOiAjNzc3Nzc3Ow0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCn0NCg0KLmxhYmVsT3B0aW9ucyAuZm9ybS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LabelOptions/LabelOptionsView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/LabelOptions/LabelConfig","Mapping/modules/LabelOptions/LabelOptionsModule","Mapping/modules/LabelOptions/LabelOptionsView","Mapping/modules/LabelOptions/LabelOptionsViewModel"],function(i,t,s,l){e(i,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelConfig",i.LabelConfig),e(t,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsModule",t.LabelOptionsModule),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsView",s.LabelOptionsView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsViewModel",l.LabelOptionsViewModel)})}();