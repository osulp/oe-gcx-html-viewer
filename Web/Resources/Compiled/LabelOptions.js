!function(){var i="<div class='labelOptions panel-group-contents'>    <div class='labelOptions-selector form-item'>        <div class='form-stacked'>            \x3c!--Show Labels--\x3e            <div class='form-item' data-binding='{@visible: showLabelsIsVisible}'>                <div class='form-control'>                    <label class='labelOptions-item-ctrl'>                        <input class='checkbox' type='checkbox' data-binding='{@value: showLabels}'>                        <span class='checkbox-label' data-binding='{@text: @language-labelOptions-show-labels}'></span>                    </label>                </div>            </div>            \x3c!--Field--\x3e            <div class='form-item' data-binding='{@visible: fieldIsVisible}'>                <div class='symbology-form-control'>                    <label class='form-label'>                        <span data-binding='{@text: @language-labelOptions-field}'></span>                        <select class='symbology-select' data-binding='{@enabled: showLabels}{@source: layerFields}{@value: selectedFieldName}'>                            <option data-binding='{@template-for: layerFields}{value: name}{@text: displayName}'></option>                        </select>                    </label>                </div>            </div>            <div data-binding='{@widget: LabelOptionsTextWidget}{@widget-replace: true}'></div>            \x3c!--Label Placement--\x3e            <div class='form-item' data-binding='{@visible: labelPlacementIsVisible}'>                <label class='form-label' for='labelPlacement' data-binding='{@text: @language-labelOptions-label-placement}'></label>                <div class='form-control'>                    <select class='attribute-value' id='labelPlacement' data-binding='{@enabled: showLabels}{@source: labelPlacements}{@value: selectedPlacement}'>                        <option data-binding='{@template-for: labelPlacements}{value: config}{@text: displayName}'></option>                    </select>                </div>            </div>            \x3c!--Warning--\x3e            <div class='warning-label' data-binding='{@hidden: hasDrawingInfo}{@text: tailoredWarning}'></div>            \x3c!--Action Buttons--\x3e            <div class='form-item'>                <div class='form-btns'>                    <button class='button' data-binding='{@event-onclick: handleClickButtonApply}{@text: @language-labelOptions-apply}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonOK}{@text: @language-labelOptions-done}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@enabled: isLabelCustom}{@text: @language-labelOptions-reset}{@visible: warningAcknowledged}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCustomize}{@text: @language-labelOptions-customize}{@hidden: warningAcknowledged}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCancel}{@text: @language-labelOptions-cancel}'></button>                </div>            </div>        </div>    </div>    <div class='labelOptions-cover'></div></div>";function l(e,i,t){if("string"==typeof e&&(t=i,i=e),void 0!==t)for(var s=i.split("."),l=null,a=window,o=0,n=s.length;o<n;o++)l=s[o],o==n-1?a[l]=t:a[l]||(a[l]={}),a=a[l];else console.warn("Undefined shim for: "+i)}require({cache:{"Mapping/modules/LabelOptions/LabelConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});function t(e,i,t){this.labelClass=t,this.showLabels=i,this.layer=e}i.LabelConfig=t})},"Mapping/modules/LabelOptions/LabelOptionsModule":function(){var s,o=this&&this.__extends||(s=function(e,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}s(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s,l=(s=t.ModuleBase,o(a,s),a.prototype.initialize=function(e){s.prototype.initialize.call(this,e),this._config=e},a);function a(e,i){return s.call(this,e,i)||this}i.LabelOptionsModule=l})},"Mapping/modules/LabelOptions/LabelOptionsView":function(){var s,r=this&&this.__extends||(s=function(e,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}s(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/widgets/TextSymbolWidgetViewModel","geocortex/essentials/LayerType"],function(e,i,t,s,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a,o=(a=t.ViewBase,r(n,a),n.prototype.attach=function(e){a.prototype.attach.call(this,e)},n.prototype.activated=function(){var e=this;this.viewModel.textSymbolWidget&&setTimeout(function(){e.viewModel.textSymbolWidget.activated()},0)},n.prototype.registerCommands=function(){var e=this;this.app.commandRegistry.command("ShowLabelOptionsView").register(this,this.showLabelOptionsView,this.canExecuteShowLabelOptionsView),this.app.command("HideLabelOptionsView").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},n.prototype.canExecuteShowLabelOptionsView=function(e){if(!e||!e.mapService||"None"===e.featureType)return!1;if(e.mapService.supportsDynamicLayers&&e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&e.type===l.LayerType.FEATURE_LAYER){var i=e.mapService.serviceLayer;return i.layerDrawingOptions||this.viewModel._setDefaultLayerDrawingOptions(i),!0}return!!(this.app.map._labels&&e.mapService.serviceLayer instanceof esri.layers.FeatureLayer)&&!!e.mapService.serviceLayer.labelingInfo},n.prototype.showLabelOptionsView=function(e){this.viewModel.obsLayer.set(e),this.title.set(e.displayName),this.app.command("ActivateView").execute(this.id)},n.prototype.resolveWidget=function(e,i,t){if(a.prototype.resolveWidget.call(this,e,i),"LabelOptionsTextWidget"===e)return this.viewModel.textSymbolWidget=this.app.viewManager.createView({viewId:"LabelOptionsTextWidget",markupResource:"Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.TextSymbolWidget",isVisible:!0,libraryId:"Mapping.Infrastructure"}),this.viewModel.widgetViewModel=new s.TextSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),this.viewModel.widgetViewModel.initialize({fontSize:this.viewModel.viewConfig.fontSize,fontFamilies:this.viewModel.viewConfig.fontFamilies}),this.viewModel.textSymbolWidget.attach(this.viewModel.widgetViewModel),this.viewModel.widgetViewModel.showFontColor.sync(this.viewModel.fontColorIsVisible),this.viewModel.widgetViewModel.showFontFamilies.sync(this.viewModel.fontFamiliesIsVisible),this.viewModel.widgetViewModel.showFontSize.sync(this.viewModel.fontSizeIsVisible),this.viewModel.widgetViewModel.showFontStyle.sync(this.viewModel.fontStyleIsVisible),this.viewModel.widgetViewModel.showHaloColor.sync(this.viewModel.haloColorIsVisible),this.viewModel.widgetViewModel.showHaloSize.sync(this.viewModel.haloSizeIsVisible),this.viewModel.widgetViewModel.fontFamilies.sync(this.viewModel.fontFamilies),this.viewModel.fontIsBold.sync(this.viewModel.widgetViewModel.fontIsBold),this.viewModel.fontIsItalic.sync(this.viewModel.widgetViewModel.fontIsItalic),this.viewModel.fontIsUnderline.sync(this.viewModel.widgetViewModel.fontIsUnderline),this.viewModel.fontSize.sync(this.viewModel.widgetViewModel.fontSize),this.viewModel.haloSize.sync(this.viewModel.widgetViewModel.haloSize),this.viewModel.selectedFont.sync(this.viewModel.widgetViewModel.fontFamily),this.viewModel.selectedFontColor.sync(this.viewModel.widgetViewModel.fontColor.color),this.viewModel.selectedHaloColor.sync(this.viewModel.widgetViewModel.fontHalo.color),this.viewModel.widgetViewModel.showText.set(!1),this.viewModel.widgetViewModel.showTextAngle.set(!1),this.viewModel.textSymbolWidget},n.prototype.handleClickButtonOK=function(e,i,t){this.viewModel.applyLabelOptions(),this.app.viewManager.deactivateView(this)},n.prototype.handleClickButtonCancel=function(e,i,t){this.app.viewManager.deactivateView(this)},n.prototype.handleClickButtonApply=function(e,i,t){this.viewModel.applyLabelOptions()},n.prototype.handleClickButtonReset=function(e,i,t){this.viewModel.warningAcknowledged.set(!1),this.viewModel.resetLabelOptions()},n.prototype.handleClickButtonCustomize=function(e,i,t){this.viewModel.warningAcknowledged.set(!0)},n);function n(e,i){var t=a.call(this,e,i)||this;return t.registerCommands(),t}i.LabelOptionsView=o})},"Mapping/modules/LabelOptions/LabelOptionsViewModel":function(){var s,y=this&&this.__extends||(s=function(e,i){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}s(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./LabelConfig","geocortex/geocortex","geocortex/infrastructure/ArrayUtils","geocortex/essentials/utilities/DecomposedUri","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/BrowserUtils","geocortex/infrastructure/SymbolUtils","geocortex/essentials/LayerType"],function(e,i,t,l,h,o,s,b,n,a,r,c){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var g,d,p,f=(g=t.ViewModelBase,y(w,g),w.prototype.initialize=function(e){var i=this;g.prototype.initialize.call(this,e),this.viewConfig=e,this.fontSize.set(this.defaultFontSize),this.warningAcknowledged.bind(this,function(){i.haloSizeIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.haloSizeIsVisible&&!i.isIE9or11),i.haloColorIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.haloColorIsVisible&&!i.isIE9or11),i.fontStyleIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.fontStyleIsVisible),i.fontSizeIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.fontSizeIsVisible),i.fontColorIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.fontColorIsVisible),i.fontFamiliesIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.fontFamiliesIsVisible),i.fieldIsVisible.set(i.warningAcknowledged.get()&&i.viewConfig.fieldIsVisible),i.labelPlacementIsVisible.set(i.warningAcknowledged.get()&&!i.isLayerFeatureTypePolygon.get()&&i.viewConfig.labelPlacementIsVisible)}),this.isLayerFeatureTypePolygon.bind(this,function(){i.labelPlacementIsVisible.set(!i.isLayerFeatureTypePolygon.get()&&i.warningAcknowledged.get()&&i.viewConfig.labelPlacementIsVisible)}),this._registerCommands()},w.prototype._registerCommands=function(){var i=this;this.obsLayer.bind(this,function(e){i.populateLabelOptionsView(e)}),this.app.commandRegistry.command("ToggleDynamicLabels").register(this,this.toggleLabels,this.canExecuteToggleLabels)},w.prototype.populateLabelOptionsView=function(e){this.layer=e,this.tailoredWarning.set(this.getResource("language-labelOptions-unknown-label-warning").format(this.layer.displayName)),this.loadLabelPlacements(),this.loadLayerInformation(),this.loadFonts(),e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer?this._populateFromDynamicServiceLayer(e):e.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&this._populateFromFeatureLayer(e)},w.prototype._populateFromFeatureLayer=function(e){var i=e.mapService.serviceLayer.labelingInfo;this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new h.LabelConfig(e,e.showLabels,i));var t=this.getLabelClass(this.labelClassOriginal).labelClass,s=!!t&&0<t.length;return this.isLabelClassStored(this.labelClassConfigured)?(this.hasDrawingInfo.set(s),this.warningAcknowledged.set(!0),void this.loadConfiguration()):s?(this.hasDrawingInfo.set(!0),this.warningAcknowledged.set(!0),void this.loadOriginalValues()):void 0},w.prototype._populateFromDynamicServiceLayer=function(e){var i=this,t=e.mapService.serviceLayer,s=t.layerDrawingOptions,l=s[e.id];this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new h.LabelConfig(e,l.showLabels,l.labelingInfo));var a=this.getLabelClass(this.labelClassOriginal).labelClass,o=!!a&&0<a.length;if(this.isLabelClassStored(this.labelClassConfigured))return this.hasDrawingInfo.set(o),this.warningAcknowledged.set(!0),void this.loadConfiguration();if(o)return this.hasDrawingInfo.set(!0),this.warningAcknowledged.set(!0),void this.loadOriginalValues();var n=b.DecomposedUri.appendToPath(t.url,"/"+this.layer.id),r=[];this.requestLabelInfo(n).then(function(e){e&&r.push(e)}).then(function(){if(r.length)return i.setLabelClass(r,i.labelClassOriginal),l.labelingInfo=r,s[e.id]=l,t.setLayerDrawingOptions(s),t.refresh(),void i.populateLabelOptionsView(i.layer);i.hasDrawingInfo.set(!1),i.warningAcknowledged.set(!1),i.loadDefaultConfiguration()}).catch(function(){i.hasDrawingInfo.set(!1),i.warningAcknowledged.set(!1),i.loadDefaultConfiguration()})},w.prototype.requestLabelInfo=function(s){var a=this;return new Promise(function(l,i){var e=new b.DecomposedUri(s);e.query.f="json";var t={url:e.recompose()};o.request(t).then(function(e){e||l(null);var i=e?e.drawingInfo:null,t=i?i.labelingInfo:null;if(t&&0<t.length){var s=new esri.layers.LabelClass(t[0]);l(s)}else l(null)},function(e){a.app.trace.error("LabelOptions - Error requesting labels: "+e.message),i(e)})})},w.prototype.loadLayerInformation=function(){this.layerName.set(this.layer.displayName),this.layerFields.clear();var e=this.layer.fields.filter(function(e){return e.visible&&!!e.dataType&&!/Object/i.test(e.dataType)&&!/GUID/i.test(e.dataType)});switch(this.layerFields.set(s.ArrayUtils.sortBy(e,function(e){return e.displayName})),this.layerFields.getLength()?(this.selectedFieldName.set(this.layerFields.getAt(0).name),this.fieldIsVisible.set(!0)):this.fieldIsVisible.set(!1),this.layer.featureType){case"Point":case"Multipoint":this.isLayerFeatureTypePoint.set(!0),this.isLayerFeatureTypePolygon.set(!1);break;case d.Polygon.toString():this.isLayerFeatureTypePolygon.set(!0);break;default:this.isLayerFeatureTypePoint.set(!1),this.isLayerFeatureTypePolygon.set(!1)}this.isLayerFeatureTypePoint.get()?this.labelPlacements.set(this.pointLabelPlacements):this.labelPlacements.set(this.lineLabelPlacements),this.selectedPlacement.set(this.labelPlacements.getAt(0).config)},w.prototype.loadFonts=function(){this.widgetViewModel.fontFamilies.clear(),0<this.viewConfig.fontFamilies.length?this.widgetViewModel.fontFamilies.set(this.viewConfig.fontFamilies):this.fontFamiliesIsVisible.set(!1)},w.prototype.loadLabelPlacements=function(){this.pointLabelPlacements=[{config:"above-center",displayName:this.getResource("language-labelOptions-above-center")},{config:"above-left",displayName:this.getResource("language-labelOptions-above-left")},{config:"above-right",displayName:this.getResource("language-labelOptions-above-right")},{config:"center-center",displayName:this.getResource("language-labelOptions-center-center")},{config:"center-left",displayName:this.getResource("language-labelOptions-center-left")},{config:"center-right",displayName:this.getResource("language-labelOptions-center-right")},{config:"below-center",displayName:this.getResource("language-labelOptions-below-center")},{config:"below-left",displayName:this.getResource("language-labelOptions-below-left")},{config:"below-right",displayName:this.getResource("language-labelOptions-below-right")}],this.lineLabelPlacements=[{config:"above-after",displayName:this.getResource("language-labelOptions-above-after")},{config:"above-along",displayName:this.getResource("language-labelOptions-above-along")},{config:"above-before",displayName:this.getResource("language-labelOptions-above-before")},{config:"above-start",displayName:this.getResource("language-labelOptions-above-start")},{config:"above-end",displayName:this.getResource("language-labelOptions-above-end")},{config:"below-after",displayName:this.getResource("language-labelOptions-below-after")},{config:"below-along",displayName:this.getResource("language-labelOptions-below-along")},{config:"below-before",displayName:this.getResource("language-labelOptions-below-before")},{config:"below-start",displayName:this.getResource("language-labelOptions-below-start")},{config:"below-end",displayName:this.getResource("language-labelOptions-below-end")},{config:"center-after",displayName:this.getResource("language-labelOptions-center-after")},{config:"center-along",displayName:this.getResource("language-labelOptions-center-along")},{config:"center-before",displayName:this.getResource("language-labelOptions-center-before")},{config:"center-start",displayName:this.getResource("language-labelOptions-center-start")},{config:"center-end",displayName:this.getResource("language-labelOptions-center-end")}]},w.prototype.loadDefaultConfiguration=function(){this.showLabels.get()&&this.showLabels.set(this.viewConfig.showLabels),this.widgetViewModel.fontIsBold.set(this.viewConfig.fontIsBold),this.widgetViewModel.fontIsItalic.set(this.viewConfig.fontIsItalic),this.widgetViewModel.fontIsUnderline.set(this.viewConfig.fontIsUnderline),this.widgetViewModel.fontColor.color.set(new n.SymbolColor(this.viewConfig.fontColor)),this.widgetViewModel.haloSize.set(this.viewConfig.haloSize),this.widgetViewModel.fontHalo.color.set(new n.SymbolColor(this.viewConfig.haloColor)),this.app.event("LabelsResetEvent").publish(),this.setIsVisibles(),this.fieldIsVisible.get()&&this.fieldIsVisible.set(this.viewConfig.fieldIsVisible),this.fontFamiliesIsVisible.get()&&this.fontFamiliesIsVisible.set(this.viewConfig.fontFamiliesIsVisible),this.warningAcknowledged.pulse()},w.prototype.loadConfiguration=function(){var e=this.getLabelClass(this.labelClassConfigured),i=e.labelClass[0].symbol;this.originalSymbol=new esri.symbol.TextSymbol(JSON.stringify(i.toJson()));var t=this.layer;if(t.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var s=t.mapService.serviceLayer.layerDrawingOptions[t.id];this.showLabels.set(s.showLabels)}if(t.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var l=t.mapService.serviceLayer;this.showLabels.set(l.showLabels)}this.selectedFieldName.set(e.labelClass[0].labelExpression.replace("[","").replace("]","")),this.textSymbolWidget.setFromSymbol(i),this.selectedPlacement.set(e.labelClass[0].labelPlacement);var a=new esri.Color(i.haloColor);this.selectedHaloColor.set(new n.SymbolColor(a)),this.app.event("LabelsResetEvent").publish(),this.haloSize.set(i.haloSize),this.isLabelCustom.set(!0)},w.prototype.loadOriginalValues=function(){var e,i=this.layer;if(i.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=i.mapService.serviceLayer.layerDrawingOptions[i.id];this.showLabels.set(t.showLabels),e=t.labelingInfo}if(i.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var s=i.mapService.serviceLayer;e=s.labelingInfo,this.showLabels.set(s.showLabels)}if(this.selectedPlacement.set(e[0].labelPlacement),this.textSymbolWidget.setFromSymbol(e[0].symbol),this.app.event("LabelsResetEvent").publish(),this.setIsVisibles(),this.fieldIsVisible.get()){this.fieldIsVisible.set(this.viewConfig.fieldIsVisible);var l=void 0;e[0].labelExpression?l=e[0].labelExpression.replace("[","").replace("]",""):e[0].labelExpressionInfo&&e[0].labelExpressionInfo.value&&(l=e[0].labelExpressionInfo.value.replace("{","").replace("}",""));for(var a=0;a<this.layerFields.getLength();a++)if(l===this.layerFields.getAt(a).displayName){l=this.layerFields.getAt(a).name;break}this.selectedFieldName.set(l)}this.fontFamiliesIsVisible.get()&&(this.fontFamiliesIsVisible.set(this.viewConfig.fontFamiliesIsVisible),this.selectedFont.set(e[0].symbol.font.family)),this.warningAcknowledged.pulse(),this.isLabelCustom.set(!1)},w.prototype.setIsVisibles=function(){this.showLabelsIsVisible.set(this.viewConfig.showLabelsIsVisible),this.fontSizeIsVisible.set(this.viewConfig.fontSizeIsVisible),this.fontStyleIsVisible.set(this.viewConfig.fontStyleIsVisible),this.fontColorIsVisible.set(this.viewConfig.fontColorIsVisible),this.haloSizeIsVisible.set(this.viewConfig.haloSizeIsVisible&&!this.isIE9or11),this.haloColorIsVisible.set(this.viewConfig.haloColorIsVisible&&!this.isIE9or11)},w.prototype.applyLabelOptions=function(){var e,i=this.layer;if(i.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&((c=(b=(r=i.mapService.serviceLayer).layerDrawingOptions)[i.id]).labelingInfo&&0<c.labelingInfo.length&&(e=c.labelingInfo[0]),this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new h.LabelConfig(i,c.showLabels,c.labelingInfo)),c.showLabels=this.showLabelsIsVisible.get()||null==e?this.showLabels.get():c.showLabels,!this.warningAcknowledged.get()))return b[i.id]=c,r.setLayerDrawingOptions(b),void r.refresh();if(i.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&((g=i.mapService.serviceLayer).labelingInfo&&0<g.labelingInfo.length&&(e=g.labelingInfo[0]),this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new h.LabelConfig(i,g.showLabels,g.labelingInfo)),g.showLabels=this.showLabelsIsVisible.get()||null==e?this.showLabels.get():g.showLabels,!this.warningAcknowledged.get()))g.refresh();else{var t=this.fieldIsVisible.get()||null==e?this.selectedFieldName.get():e.labelExpression.replace("[","").replace("]",""),s=new esri.symbol.Font;s.setFamily(this.fontFamiliesIsVisible.get()||null==e?this.selectedFont.get():e.symbol.font.family),s.setSize((this.fontSizeIsVisible.get()||null==e?this.fontSize.get():e.symbol.font.size)+"pt"),this.fontStyleIsVisible.get()||null==e?(this.fontIsBold.get()?s.setWeight("bold"):s.setWeight("normal"),this.fontIsItalic.get()?s.setStyle("italic"):s.setStyle("normal"),this.fontIsUnderline.get()?s.setDecoration("underline"):s.setDecoration("normal")):(s.setWeight(e.symbol.font.weight),s.setStyle(e.symbol.font.style),s.setDecoration(e.symbol.font.decoration));var l,a=this.fontColorIsVisible.get()||null==e?this.selectedFontColor.get().toEsriColor():e.symbol.color;this.labelPlacementIsVisible.get()||null==e?(l="always-horizontal","Polygon"!==i.featureType&&(l=this.selectedPlacement.get())):l=e.labelPlacement;var o=this.textSymbolWidget.getSymbol(),n=esri.symbol.fromJson(JSON.parse(o));n.haloColor&&(n.haloColor.a=1),n.setFont(s),n.setColor(a);var r,b,c,g,d=new esri.layers.LabelClass;d.labelExpression=String.format("[{0}]",t),d.useCodedValues=!0,d.symbol=n,d.labelPlacement=l,i.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&((c=(b=(r=i.mapService.serviceLayer).layerDrawingOptions)[i.id]).labelingInfo=[d],b[i.id]=c,r.setLayerDrawingOptions(b),r.refresh()),i.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&((g=i.mapService.serviceLayer).setLabelingInfo([d]),g.refresh()),this.isLabelCustom.set(!0),this.toggledOnly.set(!1),this.setLabelClass([d],this.labelClassConfigured),this.app.eventRegistry.event("LabelOptionsChanged").publish()}},w.prototype.resetLabelOptions=function(){this.textSymbolWidget.setFromSymbol(this.originalSymbol),this.app.event("LabelsResetEvent").publish();var e=this.layer,i=this.getLabelClass(this.labelClassOriginal);if(e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=e.mapService.serviceLayer,s=t.layerDrawingOptions,l=s[e.id];l.labelingInfo=i.labelClass,l.showLabels=i.showLabels,s[e.id]=l,t.setLayerDrawingOptions(s),t.refresh()}if(e.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var a=e.mapService.serviceLayer;a.setLabelingInfo(i.labelClass),a.showLabels=i.showLabels,a.refresh()}this.removeConfiguredLabelClass(),this.showLabels.set(i.showLabels),this.populateLabelOptionsView(e),this.isLabelCustom.set(!1),this.toggledOnly.set(!0)},w.prototype.canExecuteToggleLabels=function(e){if(!e||!e.mapService||"None"===e.featureType)return!1;if(e.mapService.supportsDynamicLayers&&e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&e.type===c.LayerType.FEATURE_LAYER){var i=e.mapService.serviceLayer;return i.layerDrawingOptions||this._setDefaultLayerDrawingOptions(i),this.layer=e,!0}return!!(this.app.map._labels&&e.mapService.serviceLayer instanceof esri.layers.FeatureLayer)&&!!e.mapService.serviceLayer.labelingInfo&&(this.layer=e,!0)},w.prototype.toggleLabels=function(e){e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&this._toggleDynamicLabels(e),e.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&this._toggleFeatureLayerLabels(e)},w.prototype._toggleDynamicLabels=function(e){var i=e.mapService.serviceLayer,t=i.layerDrawingOptions,s=t[e.id];this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new h.LabelConfig(e,s.showLabels,s.labelingInfo)),s.showLabels?(s.showLabels=!1,this.showLabels.set(!1)):(s.showLabels=!0,this.showLabels.set(!0)),this.labelClassOriginal[0].showLabels!==this.showLabels.get()?this.isLabelCustom.set(!0):this.toggledOnly.get()&&this.isLabelCustom.set(!1),t[e.id]=s,i.setLayerDrawingOptions(t),i.refresh()},w.prototype._toggleFeatureLayerLabels=function(e){var i=e.mapService.serviceLayer;i.showLabels=!i.showLabels,this.showLabels.set(i.showLabels),i.refresh()},w.prototype._setDefaultLayerDrawingOptions=function(i){for(var t=this,e=i.layerInfos[0].id,s=1;s<i.layerInfos.length;s++)i.layerInfos[s].id>e&&(e=i.layerInfos[s].id);i.setLayerDrawingOptions(new Array(e)),i.layerInfos.forEach(function(e){i.layerDrawingOptions[e.id]=new esri.layers.LayerDrawingOptions,i.layerDrawingOptions[e.id].showLabels=!0,t.showLabels.set(!0)}),i.refresh()},w.prototype._setDefaultLabelingInfo=function(e,i){var t={labelExpressionInfo:{value:"{"+i+"}"}},s=new esri.layers.LabelClass(t);s.symbol=esri.symbol.fromJson(r.defaultTextMarkup.toJson()),s.symbol.font.setSize(16),e.setLabelingInfo([s]),e.showLabels=!1},w.prototype.isLabelClassStored=function(e){for(var i=!1,t=0,s=e;t<s.length;t++){var l=s[t];if(this.layer===l.layer){i=!0;break}}return i},w.prototype.getLabelClass=function(e){for(var i=null,t=0,s=e;t<s.length;t++){var l=s[t];if(this.layer===l.layer){i=l;break}}return i},w.prototype.setLabelClass=function(e,i){for(var t=!1,s=0,l=i;s<l.length;s++){var a=l[s];if(this.layer===a.layer)return a.labelClass=e,void(t=!0)}t||i.push(new h.LabelConfig(this.layer,this.showLabels.get(),e))},w.prototype.removeConfiguredLabelClass=function(){var e,i=!1;for(e=0;e<this.labelClassConfigured.length;e++)if(this.layer===this.labelClassConfigured[e].layer){i=!0;break}i&&this.labelClassConfigured.splice(e,1)},w);function w(e,i){var t=g.call(this,e,i)||this;t.obsLayer=new l.Observable,t.labelClassOriginal=[],t.labelClassConfigured=[],t.showLabels=new l.Observable(!0),t.layerName=new l.Observable(""),t.layerFields=new l.ObservableCollection,t.fontFamilies=new l.ObservableCollection,t.fontSize=new l.Observable,t.fontIsBold=new l.Observable(!1),t.fontIsItalic=new l.Observable(!1),t.fontIsUnderline=new l.Observable(!1),t.haloSize=new l.Observable,t.isLayerFeatureTypePoint=new l.Observable(!1),t.isLayerFeatureTypePolygon=new l.Observable(!1),t.pointLabelPlacements=[],t.lineLabelPlacements=[],t.labelPlacements=new l.ObservableCollection,t.selectedFieldName=new l.Observable(""),t.selectedFont=new l.Observable(""),t.selectedFontColor=new l.Observable(new n.SymbolColor("#000000")),t.selectedHaloColor=new l.Observable(new n.SymbolColor("#FFFFFF")),t.selectedPlacement=new l.Observable(""),t.selectedFontSizeChoice=new l.Observable(""),t.isIE9or11=!1,t.showLabelsIsVisible=new l.Observable(!0),t.haloSizeIsVisible=new l.Observable(!0),t.haloColorIsVisible=new l.Observable(!0),t.fontStyleIsVisible=new l.Observable(!0),t.fontSizeIsVisible=new l.Observable(!0),t.fontColorIsVisible=new l.Observable(!0),t.fontFamiliesIsVisible=new l.Observable(!0),t.fieldIsVisible=new l.Observable(!0),t.labelPlacementIsVisible=new l.Observable(!0),t.tailoredWarning=new l.Observable(""),t.warningAcknowledged=new l.Observable(!1),t.hasDrawingInfo=new l.Observable(!1),t.defaultColor="#000000",t.defaultFontSize=16,t.isLabelCustom=new l.Observable(!1),t.toggledOnly=new l.Observable(!0);var s=a.isIE();return t.isIE9or11=9===s||11===s,t.haloColorIsVisible.set(!t.isIE9or11),t.haloColorIsVisible.set(!t.isIE9or11),t}i.LabelOptionsViewModel=f,(p=d=d||{})[p.Polygon="Polygon"]="Polygon"})},"Mapping/modules/LabelOptions/ViewConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"url:/Mapping/modules/LabelOptions/LabelOptionsView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LabelOptions/CSS/common.css","css","LmxhYmVsT3B0aW9ucy1zZWxlY3RvciB7DQogICAgbWFyZ2luLWJvdHRvbTogMmVtOyANCn0NCg0KLmxhYmVsT3B0aW9uc3sNCiAgICBmb250LXdlaWdodDogbm9ybWFsOw0KfQ0KDQoubGFiZWxPcHRpb25zIC5mb3JtLWJ0bnMgew0KICAgIG1hcmdpbi10b3A6IDJlbTsNCn0NCg0KLmxhYmVsT3B0aW9ucy1pdGVtLWN0cmwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KfQ0KDQoubGFiZWxPcHRpb25zLWl0ZW0tY3RybC5mb250LWN0cmwtbGFiZWwgew0KICAgIHBhZGRpbmctYm90dG9tOiAwLjVlbTsNCn0NCg0KLmxhYmVsT3B0aW9ucy1zZWxlY3RvciAucmFkaW8tY29udGFpbmVyIHsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoud2FybmluZy1sYWJlbCB7DQogICAgcGFkZGluZzogMC41ZW0gMC4xZW0gMC41ZW0gMHB4Ow0KICAgIGNvbG9yOiAjNzc3Nzc3Ow0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCn0NCg0KLmxhYmVsT3B0aW9ucyAuZm9ybS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LabelOptions/LabelOptionsView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/LabelOptions/LabelConfig","Mapping/modules/LabelOptions/LabelOptionsModule","Mapping/modules/LabelOptions/LabelOptionsView","Mapping/modules/LabelOptions/LabelOptionsViewModel"],function(e,i,t,s){l(e,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelConfig",e.LabelConfig),l(i,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsModule",i.LabelOptionsModule),l(t,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsView",t.LabelOptionsView),l(s,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsViewModel",s.LabelOptionsViewModel)})}();