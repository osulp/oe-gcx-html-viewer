!function(){function e(e,i,t){if("string"==typeof e&&(t=i,i=e),void 0!==t)for(var s=i.split("."),l=null,a=window,o=0,n=s.length;o<n;o++)l=s[o],o==n-1?a[l]=t:a[l]||(a[l]={}),a=a[l];else console.warn("Undefined shim for: "+i)}var i="<div class='labelOptions panel-group-contents'>    <div class='labelOptions-selector form-item'>        <div class='form-stacked'>            \x3c!--Show Labels--\x3e            <div class='form-item' data-binding='{@visible: showLabelsIsVisible}'>                <div class='form-control'>                    <label class='labelOptions-item-ctrl'>                        <input class='checkbox' type='checkbox' data-binding='{@value: showLabels}'>                        <span class='checkbox-label' data-binding='{@text: @language-labelOptions-show-labels}'></span>                    </label>                </div>            </div>            \x3c!--Field--\x3e            <div class='form-item' data-binding='{@visible: fieldIsVisible}'>                <div class='symbology-form-control'>                    <label class='form-label'>                        <span data-binding='{@text: @language-labelOptions-field}'></span>                        <select class='symbology-select' data-binding='{@enabled: showLabels}{@source: layerFields}{@value: selectedFieldName}'>                            <option data-binding='{@template-for: layerFields}{value: name}{@text: displayName}'></option>                        </select>                    </label>                </div>            </div>            <div data-binding='{@widget: LabelOptionsTextWidget}{@widget-replace: true}'></div>            \x3c!--Label Placement--\x3e            <div class='form-item' data-binding='{@visible: labelPlacementIsVisible}'>                <label class='form-label' for='labelPlacement' data-binding='{@text: @language-labelOptions-label-placement}'></label>                <div class='form-control'>                    <select class='attribute-value' id='labelPlacement' data-binding='{@enabled: showLabels}{@source: labelPlacements}{@value: selectedPlacement}'>                        <option data-binding='{@template-for: labelPlacements}{value: config}{@text: displayName}'></option>                    </select>                </div>            </div>            \x3c!--Warning--\x3e            <div class='warning-label' data-binding='{@hidden: hasDrawingInfo}{@text: tailoredWarning}'></div>            \x3c!--Action Buttons--\x3e            <div class='form-item'>                <div class='form-btns'>                    <button class='button' data-binding='{@event-onclick: handleClickButtonApply}{@text: @language-labelOptions-apply}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonOK}{@text: @language-labelOptions-done}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@enabled: isLabelCustom}{@text: @language-labelOptions-reset}{@visible: warningAcknowledged}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCustomize}{@text: @language-labelOptions-customize}{@hidden: warningAcknowledged}'></button>                    <button class='button' data-binding='{@event-onclick: handleClickButtonCancel}{@text: @language-labelOptions-cancel}'></button>                </div>            </div>        </div>    </div>    <div class='labelOptions-cover'></div></div>";require({cache:{"Mapping/modules/LabelOptions/LabelConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t=function(){return function(e,i,t){this.labelClass=t,this.showLabels=i,this.layer=e}}();i.LabelConfig=t})},"Mapping/modules/LabelOptions/LabelOptionsModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function s(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(i,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(i){function t(e,t){return i.call(this,e,t)||this}return e(t,i),t.prototype.initialize=function(e){i.prototype.initialize.call(this,e),this._config=e},t}(s.ModuleBase);t.LabelOptionsModule=l})},"Mapping/modules/LabelOptions/LabelOptionsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function s(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/widgets/TextSymbolWidgetViewModel","geocortex/essentials/LayerType"],function(i,t,s,l,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(i){function t(e,t){var s=i.call(this,e,t)||this;return s.registerCommands(),s}return e(t,i),t.prototype.attach=function(e){i.prototype.attach.call(this,e)},t.prototype.activated=function(){var e=this;this.viewModel.textSymbolWidget&&setTimeout(function(){e.viewModel.textSymbolWidget.activated()},0)},t.prototype.registerCommands=function(){var e=this;this.app.commandRegistry.command("ShowLabelOptionsView").register(this,this.showLabelOptionsView,this.canExecuteShowLabelOptionsView),this.app.command("HideLabelOptionsView").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},t.prototype.canExecuteShowLabelOptionsView=function(e){if(!e||!e.mapService||"None"===e.featureType)return!1;if(e.mapService.supportsDynamicLayers&&e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&e.type===a.LayerType.FEATURE_LAYER){var i=e.mapService.serviceLayer;return i.layerDrawingOptions||this.viewModel._setDefaultLayerDrawingOptions(i),!0}return!!(this.app.map._labels&&e.mapService.serviceLayer instanceof esri.layers.FeatureLayer)&&!!e.mapService.serviceLayer.labelingInfo},t.prototype.showLabelOptionsView=function(e){this.viewModel.obsLayer.set(e),this.title.set(e.displayName),this.app.command("ActivateView").execute(this.id)},t.prototype.resolveWidget=function(e,t,s){if(i.prototype.resolveWidget.call(this,e,t),"LabelOptionsTextWidget"===e){return this.viewModel.textSymbolWidget=this.app.viewManager.createView({viewId:"LabelOptionsTextWidget",markupResource:"Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.TextSymbolWidget",isVisible:!0,libraryId:"Mapping.Infrastructure"}),this.viewModel.widgetViewModel=new l.TextSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),this.viewModel.widgetViewModel.initialize({fontSize:this.viewModel.viewConfig.fontSize,fontFamilies:this.viewModel.viewConfig.fontFamilies}),this.viewModel.textSymbolWidget.attach(this.viewModel.widgetViewModel),this.viewModel.widgetViewModel.showFontColor.sync(this.viewModel.fontColorIsVisible),this.viewModel.widgetViewModel.showFontFamilies.sync(this.viewModel.fontFamiliesIsVisible),this.viewModel.widgetViewModel.showFontSize.sync(this.viewModel.fontSizeIsVisible),this.viewModel.widgetViewModel.showFontStyle.sync(this.viewModel.fontStyleIsVisible),this.viewModel.widgetViewModel.showHaloColor.sync(this.viewModel.haloColorIsVisible),this.viewModel.widgetViewModel.showHaloSize.sync(this.viewModel.haloSizeIsVisible),this.viewModel.widgetViewModel.fontFamilies.sync(this.viewModel.fontFamilies),this.viewModel.fontIsBold.sync(this.viewModel.widgetViewModel.fontIsBold),this.viewModel.fontIsItalic.sync(this.viewModel.widgetViewModel.fontIsItalic),this.viewModel.fontIsUnderline.sync(this.viewModel.widgetViewModel.fontIsUnderline),this.viewModel.fontSize.sync(this.viewModel.widgetViewModel.fontSize),this.viewModel.haloSize.sync(this.viewModel.widgetViewModel.haloSize),this.viewModel.selectedFont.sync(this.viewModel.widgetViewModel.fontFamily),this.viewModel.selectedFontColor.sync(this.viewModel.widgetViewModel.fontColor.color),this.viewModel.selectedHaloColor.sync(this.viewModel.widgetViewModel.fontHalo.color),this.viewModel.widgetViewModel.showText.set(!1),this.viewModel.widgetViewModel.showTextAngle.set(!1),this.viewModel.textSymbolWidget}},t.prototype.handleClickButtonOK=function(e,i,t){this.viewModel.applyLabelOptions(),this.app.viewManager.deactivateView(this)},t.prototype.handleClickButtonCancel=function(e,i,t){this.app.viewManager.deactivateView(this)},t.prototype.handleClickButtonApply=function(e,i,t){this.viewModel.applyLabelOptions()},t.prototype.handleClickButtonReset=function(e,i,t){this.viewModel.warningAcknowledged.set(!1),this.viewModel.resetLabelOptions()},t.prototype.handleClickButtonCustomize=function(e,i,t){this.viewModel.warningAcknowledged.set(!0)},t}(s.ViewBase);t.LabelOptionsView=o})},"Mapping/modules/LabelOptions/LabelOptionsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function s(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./LabelConfig","geocortex/geocortex","geocortex/infrastructure/ArrayUtils","geocortex/essentials/utilities/DecomposedUri","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/BrowserUtils","geocortex/infrastructure/SymbolUtils","geocortex/essentials/LayerType"],function(i,t,s,l,a,o,n,r,b,c,g,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(i){function t(e,t){var s=i.call(this,e,t)||this;s.obsLayer=new l.Observable,s.labelClassOriginal=[],s.labelClassConfigured=[],s.showLabels=new l.Observable(!0),s.layerName=new l.Observable(""),s.layerFields=new l.ObservableCollection,s.fontFamilies=new l.ObservableCollection,s.fontSize=new l.Observable,s.fontIsBold=new l.Observable(!1),s.fontIsItalic=new l.Observable(!1),s.fontIsUnderline=new l.Observable(!1),s.haloSize=new l.Observable,s.isLayerFeatureTypePoint=new l.Observable(!1),s.isLayerFeatureTypePolygon=new l.Observable(!1),s.pointLabelPlacements=[],s.lineLabelPlacements=[],s.labelPlacements=new l.ObservableCollection,s.selectedFieldName=new l.Observable(""),s.selectedFont=new l.Observable(""),s.selectedFontColor=new l.Observable(new b.SymbolColor("#000000")),s.selectedHaloColor=new l.Observable(new b.SymbolColor("#FFFFFF")),s.selectedPlacement=new l.Observable(""),s.selectedFontSizeChoice=new l.Observable(""),s.isIE9or11=!1,s.showLabelsIsVisible=new l.Observable(!0),s.haloSizeIsVisible=new l.Observable(!0),s.haloColorIsVisible=new l.Observable(!0),s.fontStyleIsVisible=new l.Observable(!0),s.fontSizeIsVisible=new l.Observable(!0),s.fontColorIsVisible=new l.Observable(!0),s.fontFamiliesIsVisible=new l.Observable(!0),s.fieldIsVisible=new l.Observable(!0),s.labelPlacementIsVisible=new l.Observable(!0),s.tailoredWarning=new l.Observable(""),s.warningAcknowledged=new l.Observable(!1),s.hasDrawingInfo=new l.Observable(!1),s.defaultColor="#000000",s.defaultFontSize=16,s.isLabelCustom=new l.Observable(!1),s.toggledOnly=new l.Observable(!0);var a=c.isIE();return s.isIE9or11=9===a||11===a,s.haloColorIsVisible.set(!s.isIE9or11),s.haloColorIsVisible.set(!s.isIE9or11),s}return e(t,i),t.prototype.initialize=function(e){var t=this;i.prototype.initialize.call(this,e),this.viewConfig=e,this.fontSize.set(this.defaultFontSize),this.warningAcknowledged.bind(this,function(){t.haloSizeIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.haloSizeIsVisible&&!t.isIE9or11),t.haloColorIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.haloColorIsVisible&&!t.isIE9or11),t.fontStyleIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontStyleIsVisible),t.fontSizeIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontSizeIsVisible),t.fontColorIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontColorIsVisible),t.fontFamiliesIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fontFamiliesIsVisible),t.fieldIsVisible.set(t.warningAcknowledged.get()&&t.viewConfig.fieldIsVisible),t.labelPlacementIsVisible.set(t.warningAcknowledged.get()&&!t.isLayerFeatureTypePolygon.get()&&t.viewConfig.labelPlacementIsVisible)}),this.isLayerFeatureTypePolygon.bind(this,function(){t.labelPlacementIsVisible.set(!t.isLayerFeatureTypePolygon.get()&&t.warningAcknowledged.get()&&t.viewConfig.labelPlacementIsVisible)}),this._registerCommands()},t.prototype._registerCommands=function(){var e=this;this.obsLayer.bind(this,function(i){e.populateLabelOptionsView(i)}),this.app.commandRegistry.command("ToggleDynamicLabels").register(this,this.toggleLabels,this.canExecuteToggleLabels)},t.prototype.populateLabelOptionsView=function(e){this.layer=e,this.tailoredWarning.set(this.getResource("language-labelOptions-unknown-label-warning").format(this.layer.displayName)),this.loadLabelPlacements(),this.loadLayerInformation(),this.loadFonts(),e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer?this._populateFromDynamicServiceLayer(e):e.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&this._populateFromFeatureLayer(e)},t.prototype._populateFromFeatureLayer=function(e){var i=e.mapService.serviceLayer.labelingInfo;this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new a.LabelConfig(e,e.showLabels,i));var t=this.getLabelClass(this.labelClassOriginal).labelClass,s=!!t&&t.length>0;return this.isLabelClassStored(this.labelClassConfigured)?(this.hasDrawingInfo.set(s),this.warningAcknowledged.set(!0),void this.loadConfiguration()):s?(this.hasDrawingInfo.set(!0),this.warningAcknowledged.set(!0),void this.loadOriginalValues()):void 0},t.prototype._populateFromDynamicServiceLayer=function(e){var i=this,t=e.mapService.serviceLayer,s=t.layerDrawingOptions,l=s[e.id];this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new a.LabelConfig(e,l.showLabels,l.labelingInfo));var o=this.getLabelClass(this.labelClassOriginal).labelClass,n=!!o&&o.length>0;if(this.isLabelClassStored(this.labelClassConfigured))return this.hasDrawingInfo.set(n),this.warningAcknowledged.set(!0),void this.loadConfiguration();if(n)return this.hasDrawingInfo.set(!0),this.warningAcknowledged.set(!0),void this.loadOriginalValues();var b=r.DecomposedUri.appendToPath(t.url,"/"+this.layer.id),c=[];this.requestLabelInfo(b).then(function(e){e&&c.push(e)}).then(function(){if(c.length)return i.setLabelClass(c,i.labelClassOriginal),l.labelingInfo=c,s[e.id]=l,t.setLayerDrawingOptions(s),t.refresh(),void i.populateLabelOptionsView(i.layer);i.hasDrawingInfo.set(!1),i.warningAcknowledged.set(!1),i.loadDefaultConfiguration()}).catch(function(){i.hasDrawingInfo.set(!1),i.warningAcknowledged.set(!1),i.loadDefaultConfiguration()})},t.prototype.requestLabelInfo=function(e){var i=this;return new Promise(function(t,s){var l=new r.DecomposedUri(e);l.query.f="json";var a={url:l.recompose()};o.request(a).then(function(e){e||t(null);var i=e,s=i?i.drawingInfo:null,l=s?s.labelingInfo:null;if(l&&l.length>0){var a=new esri.layers.LabelClass(l[0]);t(a)}else t(null)},function(e){i.app.trace.error("LabelOptions - Error requesting labels: "+e.message),s(e)})})},t.prototype.loadLayerInformation=function(){this.layerName.set(this.layer.displayName),this.layerFields.clear();var e=this.layer.fields.filter(function(e){return e.visible&&!!e.dataType&&!/Object/i.test(e.dataType)&&!/GUID/i.test(e.dataType)});switch(this.layerFields.set(n.ArrayUtils.sortBy(e,function(e){return e.displayName})),this.layerFields.getLength()?(this.selectedFieldName.set(this.layerFields.getAt(0).name),this.fieldIsVisible.set(!0)):this.fieldIsVisible.set(!1),this.layer.featureType){case"Point":case"Multipoint":this.isLayerFeatureTypePoint.set(!0),this.isLayerFeatureTypePolygon.set(!1);break;case p.Polygon.toString():this.isLayerFeatureTypePolygon.set(!0);break;default:this.isLayerFeatureTypePoint.set(!1),this.isLayerFeatureTypePolygon.set(!1)}this.isLayerFeatureTypePoint.get()?this.labelPlacements.set(this.pointLabelPlacements):this.labelPlacements.set(this.lineLabelPlacements),this.selectedPlacement.set(this.labelPlacements.getAt(0).config)},t.prototype.loadFonts=function(){this.widgetViewModel.fontFamilies.clear(),this.viewConfig.fontFamilies.length>0?this.widgetViewModel.fontFamilies.set(this.viewConfig.fontFamilies):this.fontFamiliesIsVisible.set(!1)},t.prototype.loadLabelPlacements=function(){this.pointLabelPlacements=[{config:"above-center",displayName:this.getResource("language-labelOptions-above-center")},{config:"above-left",displayName:this.getResource("language-labelOptions-above-left")},{config:"above-right",displayName:this.getResource("language-labelOptions-above-right")},{config:"center-center",displayName:this.getResource("language-labelOptions-center-center")},{config:"center-left",displayName:this.getResource("language-labelOptions-center-left")},{config:"center-right",displayName:this.getResource("language-labelOptions-center-right")},{config:"below-center",displayName:this.getResource("language-labelOptions-below-center")},{config:"below-left",displayName:this.getResource("language-labelOptions-below-left")},{config:"below-right",displayName:this.getResource("language-labelOptions-below-right")}],this.lineLabelPlacements=[{config:"above-after",displayName:this.getResource("language-labelOptions-above-after")},{config:"above-along",displayName:this.getResource("language-labelOptions-above-along")},{config:"above-before",displayName:this.getResource("language-labelOptions-above-before")},{config:"above-start",displayName:this.getResource("language-labelOptions-above-start")},{config:"above-end",displayName:this.getResource("language-labelOptions-above-end")},{config:"below-after",displayName:this.getResource("language-labelOptions-below-after")},{config:"below-along",displayName:this.getResource("language-labelOptions-below-along")},{config:"below-before",displayName:this.getResource("language-labelOptions-below-before")},{config:"below-start",displayName:this.getResource("language-labelOptions-below-start")},{config:"below-end",displayName:this.getResource("language-labelOptions-below-end")},{config:"center-after",displayName:this.getResource("language-labelOptions-center-after")},{config:"center-along",displayName:this.getResource("language-labelOptions-center-along")},{config:"center-before",displayName:this.getResource("language-labelOptions-center-before")},{config:"center-start",displayName:this.getResource("language-labelOptions-center-start")},{config:"center-end",displayName:this.getResource("language-labelOptions-center-end")}]},t.prototype.loadDefaultConfiguration=function(){this.showLabels.get()&&this.showLabels.set(this.viewConfig.showLabels),this.widgetViewModel.fontIsBold.set(this.viewConfig.fontIsBold),this.widgetViewModel.fontIsItalic.set(this.viewConfig.fontIsItalic),this.widgetViewModel.fontIsUnderline.set(this.viewConfig.fontIsUnderline),this.widgetViewModel.fontColor.color.set(new b.SymbolColor(this.viewConfig.fontColor)),this.widgetViewModel.haloSize.set(this.viewConfig.haloSize),this.widgetViewModel.fontHalo.color.set(new b.SymbolColor(this.viewConfig.haloColor)),this.app.event("LabelsResetEvent").publish(),this.setIsVisibles(),this.fieldIsVisible.get()&&this.fieldIsVisible.set(this.viewConfig.fieldIsVisible),this.fontFamiliesIsVisible.get()&&this.fontFamiliesIsVisible.set(this.viewConfig.fontFamiliesIsVisible),this.warningAcknowledged.pulse()},t.prototype.loadConfiguration=function(){var e=this.getLabelClass(this.labelClassConfigured),i=e.labelClass[0].symbol;this.originalSymbol=new esri.symbol.TextSymbol(JSON.stringify(i.toJson()));var t=this.layer;if(t.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var s=t.mapService.serviceLayer.layerDrawingOptions[t.id];this.showLabels.set(s.showLabels)}if(t.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var l=t.mapService.serviceLayer;this.showLabels.set(l.showLabels)}this.selectedFieldName.set(e.labelClass[0].labelExpression.replace("[","").replace("]","")),this.textSymbolWidget.setFromSymbol(i),this.selectedPlacement.set(e.labelClass[0].labelPlacement);var a=new esri.Color(i.haloColor);this.selectedHaloColor.set(new b.SymbolColor(a)),this.app.event("LabelsResetEvent").publish(),this.haloSize.set(i.haloSize),this.isLabelCustom.set(!0)},t.prototype.loadOriginalValues=function(){var e,i=this.layer;if(i.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=i.mapService.serviceLayer.layerDrawingOptions[i.id];this.showLabels.set(t.showLabels),e=t.labelingInfo}if(i.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var s=i.mapService.serviceLayer;e=s.labelingInfo,this.showLabels.set(s.showLabels)}if(this.selectedPlacement.set(e[0].labelPlacement),this.textSymbolWidget.setFromSymbol(e[0].symbol),this.app.event("LabelsResetEvent").publish(),this.setIsVisibles(),this.fieldIsVisible.get()){this.fieldIsVisible.set(this.viewConfig.fieldIsVisible);var l=void 0;e[0].labelExpression?l=e[0].labelExpression.replace("[","").replace("]",""):e[0].labelExpressionInfo&&(l=e[0].labelExpressionInfo.value.replace("{","").replace("}",""));for(var a=0;a<this.layerFields.getLength();a++)if(l===this.layerFields.getAt(a).displayName){l=this.layerFields.getAt(a).name;break}this.selectedFieldName.set(l)}this.fontFamiliesIsVisible.get()&&(this.fontFamiliesIsVisible.set(this.viewConfig.fontFamiliesIsVisible),this.selectedFont.set(e[0].symbol.font.family)),this.warningAcknowledged.pulse(),this.isLabelCustom.set(!1)},t.prototype.setIsVisibles=function(){this.showLabelsIsVisible.set(this.viewConfig.showLabelsIsVisible),this.fontSizeIsVisible.set(this.viewConfig.fontSizeIsVisible),this.fontStyleIsVisible.set(this.viewConfig.fontStyleIsVisible),this.fontColorIsVisible.set(this.viewConfig.fontColorIsVisible),this.haloSizeIsVisible.set(this.viewConfig.haloSizeIsVisible&&!this.isIE9or11),this.haloColorIsVisible.set(this.viewConfig.haloColorIsVisible&&!this.isIE9or11)},t.prototype.applyLabelOptions=function(){var e,i=this.layer;if(i.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&((d=(g=(c=i.mapService.serviceLayer).layerDrawingOptions)[i.id]).labelingInfo&&d.labelingInfo.length>0&&(e=d.labelingInfo[0]),this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new a.LabelConfig(i,d.showLabels,d.labelingInfo)),d.showLabels=this.showLabelsIsVisible.get()||null==e?this.showLabels.get():d.showLabels,!this.warningAcknowledged.get()))return g[i.id]=d,c.setLayerDrawingOptions(g),void c.refresh();if(i.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&((h=i.mapService.serviceLayer).labelingInfo&&h.labelingInfo.length>0&&(e=h.labelingInfo[0]),this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new a.LabelConfig(i,h.showLabels,h.labelingInfo)),h.showLabels=this.showLabelsIsVisible.get()||null==e?this.showLabels.get():h.showLabels,!this.warningAcknowledged.get()))h.refresh();else{var t=this.fieldIsVisible.get()||null==e?this.selectedFieldName.get():e.labelExpression.replace("[","").replace("]",""),s=new esri.symbol.Font;s.setFamily(this.fontFamiliesIsVisible.get()||null==e?this.selectedFont.get():e.symbol.font.family),s.setSize((this.fontSizeIsVisible.get()||null==e?this.fontSize.get():e.symbol.font.size)+"pt"),this.fontStyleIsVisible.get()||null==e?(this.fontIsBold.get()?s.setWeight("bold"):s.setWeight("normal"),this.fontIsItalic.get()?s.setStyle("italic"):s.setStyle("normal"),this.fontIsUnderline.get()?s.setDecoration("underline"):s.setDecoration("normal")):(s.setWeight(e.symbol.font.weight),s.setStyle(e.symbol.font.style),s.setDecoration(e.symbol.font.decoration));var l,o=this.fontColorIsVisible.get()||null==e?this.selectedFontColor.get().toEsriColor():e.symbol.color;this.labelPlacementIsVisible.get()||null==e?(l="always-horizontal","Polygon"!==i.featureType&&(l=this.selectedPlacement.get())):l=e.labelPlacement;var n=this.textSymbolWidget.getSymbol(),r=esri.symbol.fromJson(JSON.parse(n));r.haloColor&&(r.haloColor.a=1),r.setFont(s),r.setColor(o);var b=new esri.layers.LabelClass;if(b.labelExpression=String.format("[{0}]",t),b.useCodedValues=!1,b.symbol=r,b.labelPlacement=l,i.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var c=i.mapService.serviceLayer,g=c.layerDrawingOptions,d=g[i.id];d.labelingInfo=[b],g[i.id]=d,c.setLayerDrawingOptions(g),c.refresh()}if(i.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var h=i.mapService.serviceLayer;h.setLabelingInfo([b]),h.refresh()}this.isLabelCustom.set(!0),this.toggledOnly.set(!1),this.setLabelClass([b],this.labelClassConfigured),this.app.eventRegistry.event("LabelOptionsChanged").publish()}},t.prototype.resetLabelOptions=function(){this.textSymbolWidget.setFromSymbol(this.originalSymbol),this.app.event("LabelsResetEvent").publish();var e=this.layer,i=this.getLabelClass(this.labelClassOriginal);if(e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=e.mapService.serviceLayer,s=t.layerDrawingOptions,l=s[e.id];l.labelingInfo=i.labelClass,l.showLabels=i.showLabels,s[e.id]=l,t.setLayerDrawingOptions(s),t.refresh()}if(e.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var a=e.mapService.serviceLayer;a.setLabelingInfo(i.labelClass),a.showLabels=i.showLabels,a.refresh()}this.removeConfiguredLabelClass(),this.showLabels.set(i.showLabels),this.populateLabelOptionsView(e),this.isLabelCustom.set(!1),this.toggledOnly.set(!0)},t.prototype.canExecuteToggleLabels=function(e){if(!e||!e.mapService||"None"===e.featureType)return!1;if(e.mapService.supportsDynamicLayers&&e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&e.type===d.LayerType.FEATURE_LAYER){var i=e.mapService.serviceLayer;return i.layerDrawingOptions||this._setDefaultLayerDrawingOptions(i),this.layer=e,!0}return!!(this.app.map._labels&&e.mapService.serviceLayer instanceof esri.layers.FeatureLayer)&&(!!e.mapService.serviceLayer.labelingInfo&&(this.layer=e,!0))},t.prototype.toggleLabels=function(e){e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&this._toggleDynamicLabels(e),e.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&this._toggleFeatureLayerLabels(e)},t.prototype._toggleDynamicLabels=function(e){var i=e.mapService.serviceLayer,t=i.layerDrawingOptions,s=t[e.id];this.isLabelClassStored(this.labelClassOriginal)||this.labelClassOriginal.push(new a.LabelConfig(e,s.showLabels,s.labelingInfo)),s.showLabels?(s.showLabels=!1,this.showLabels.set(!1)):(s.showLabels=!0,this.showLabels.set(!0)),this.labelClassOriginal[0].showLabels!==this.showLabels.get()?this.isLabelCustom.set(!0):this.toggledOnly.get()&&this.isLabelCustom.set(!1),t[e.id]=s,i.setLayerDrawingOptions(t),i.refresh()},t.prototype._toggleFeatureLayerLabels=function(e){var i=e.mapService.serviceLayer;i.showLabels=!i.showLabels,this.showLabels.set(i.showLabels),i.refresh()},t.prototype._setDefaultLayerDrawingOptions=function(e){for(var i=this,t=e.layerInfos[0].id,s=1;s<e.layerInfos.length;s++)e.layerInfos[s].id>t&&(t=e.layerInfos[s].id);e.setLayerDrawingOptions(new Array(t)),e.layerInfos.forEach(function(t){e.layerDrawingOptions[t.id]=new esri.layers.LayerDrawingOptions,e.layerDrawingOptions[t.id].showLabels=!0,i.showLabels.set(!0)}),e.refresh()},t.prototype._setDefaultLabelingInfo=function(e,i){var t={labelExpressionInfo:{value:"{"+i+"}"}},s=new esri.layers.LabelClass(t);s.symbol=esri.symbol.fromJson(g.defaultTextMarkup.toJson()),s.symbol.font.setSize(16),e.setLabelingInfo([s]),e.showLabels=!1},t.prototype.isLabelClassStored=function(e){for(var i=!1,t=0,s=e;t<s.length;t++){var l=s[t];if(this.layer===l.layer){i=!0;break}}return i},t.prototype.getLabelClass=function(e){for(var i=null,t=0;t<e.length;t++)if(this.layer===e[t].layer){i=e[t];break}return i},t.prototype.setLabelClass=function(e,i){for(var t=!1,s=0,l=i;s<l.length;s++){var o=l[s];if(this.layer===o.layer)return o.labelClass=e,void(t=!0)}t||i.push(new a.LabelConfig(this.layer,this.showLabels.get(),e))},t.prototype.removeConfiguredLabelClass=function(){var e,i=!1;for(e=0;e<this.labelClassConfigured.length;e++)if(this.layer===this.labelClassConfigured[e].layer){i=!0;break}i&&this.labelClassConfigured.splice(e,1)},t}(s.ViewModelBase);t.LabelOptionsViewModel=h;var p;!function(e){e[e.Polygon="Polygon"]="Polygon"}(p||(p={}))})},"Mapping/modules/LabelOptions/ViewConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"url:/Mapping/modules/LabelOptions/LabelOptionsView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LabelOptions/CSS/common.css","css","LmxhYmVsT3B0aW9ucy1zZWxlY3RvciB7DQogICAgbWFyZ2luLWJvdHRvbTogMmVtOyANCn0NCg0KLmxhYmVsT3B0aW9uc3sNCiAgICBmb250LXdlaWdodDogbm9ybWFsOw0KfQ0KDQoubGFiZWxPcHRpb25zIC5mb3JtLWJ0bnMgew0KICAgIG1hcmdpbi10b3A6IDJlbTsNCn0NCg0KLmxhYmVsT3B0aW9ucy1pdGVtLWN0cmwgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KfQ0KDQoubGFiZWxPcHRpb25zLWl0ZW0tY3RybC5mb250LWN0cmwtbGFiZWwgew0KICAgIHBhZGRpbmctYm90dG9tOiAwLjVlbTsNCn0NCg0KLmxhYmVsT3B0aW9ucy1zZWxlY3RvciAucmFkaW8tY29udGFpbmVyIHsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoud2FybmluZy1sYWJlbCB7DQogICAgcGFkZGluZzogMC41ZW0gMC4xZW0gMC41ZW0gMHB4Ow0KICAgIGNvbG9yOiAjNzc3Nzc3Ow0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCn0NCg0KLmxhYmVsT3B0aW9ucyAuZm9ybS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LabelOptions/LabelOptionsView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/LabelOptions/LabelConfig","Mapping/modules/LabelOptions/LabelOptionsModule","Mapping/modules/LabelOptions/LabelOptionsView","Mapping/modules/LabelOptions/LabelOptionsViewModel"],function(i,t,s,l){e(i,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelConfig",i.LabelConfig),e(t,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsModule",t.LabelOptionsModule),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsView",s.LabelOptionsView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.labelOptions.LabelOptionsViewModel",l.LabelOptionsViewModel)})}();