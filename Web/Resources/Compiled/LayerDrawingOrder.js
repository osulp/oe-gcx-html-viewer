!function(){var r="<div class='reorderLayers' data-binding='{@source: layerGroupsVM}'>    <div data-binding='{@template-for: layerGroupsVM}'>        <div class='panel-group no-results box-container' data-binding='{@hidden: showGroups}'>            <p data-binding='{@text: @language-layerDrawingOrder-noGroups}'></p>            <p class='description' data-binding='{@text: @language-layerDrawingOrder-noGroups-desc}'></p>        </div>        <div class='warning-label reorder-info' data-binding='{@visible: showGroups}{@text: @language-layerDrawingOrder-info}'></div>        <div class='panel-group' data-binding='{@visible: showGroups}'>            <ul class='gcx-list-menu layer-groups-list' data-binding='{@source: groups}'>                <li class='gcx-list-item reorder-list-item' data-binding='{@template-for: groups}'>                    <button class='gcx-list-button icon-right chevron-right-24 reorder-list-button' data-binding='{@event-onclick: handleClickButtonNext}{aria-label: @language-layerDrawingOrder-accessibility-reorder}'>                        <strong class='gcx-list-label' data-binding='{@text: title}'></strong>                    </button>                </li>            </ul>        </div>        <div class='form-item'>            <div class='form-btns reorder-btns'>                <button class='button' data-binding='{@event-onclick: handleClickButtonCancel}{@text: @language-layerDrawingOrder-button-cancel}'></button>            </div>        </div>    </div></div>",t="<div class='reorderLayers' data-binding='{@source: orderLayersVM}'>    <div data-binding='{@template-for: orderLayersVM}'>        <div class='panel-group no-results box-container' data-binding='{@hidden: hasLayers}'>            <p data-binding='{@text: @language-layerDrawingOrder-noLayers}'></p>            <p class='description' data-binding='{@text: @language-layerDrawingOrder-noLayers-desc}'></p>        </div>        <div class='panel-group'>            <ul class='gcx-list-menu reorder-list' data-binding='{@source: layers}{@var: sortable}'>                <li class='gcx-list-item reorder-list-item' data-binding='{@template-for: layers}{@class-selected: isSelected}{id: uniqueId}'>                    <button class = 'draggable reorder-list-dragHandle' tabindex='-1' data-binding='{@hidden: isSelected}{aria-label: @language-layerDrawingOrder-accessibility-reorder}'></button>                    <button class='gcx-list-button reorder-list-button' data-binding='{@event-onclick: handleClickButtonSelected}'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-custom-added}{@visible: isUserCreated}'></span>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-in-layer-list}{@hidden: isInLayerList}'></span>                        <div class='meta-info' data-binding='{@hidden: isVisibilityToggledOn}'>                            <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-not-visible}' src='Resources/Images/Icons/not-visible-16.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-visible}'></span>                        </div>                        <div class='meta-info' data-binding='{@hidden: isWithinScale}'>                            <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-visible}' src='Resources/Images/Icons/visibility-24.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-within-scale}'></span>                        </div>                    </button>                    <span class='reorder-arrow-btns' data-binding='{@visible: isSelected}'>                        <button class='reorder-arrow-up' aria-label='Move Layer Up' data-binding='{@event-onclick: handleClickButtonUp}{@disabled: isFirstInList}'></button>                        <button class='reorder-arrow-down' aria-label='Move Layer Down' data-binding='{@event-onclick: handleClickButtonDown}{@disabled: isLastInList}'></button>                    </span>                </li>            </ul>        </div>        <div class='form-item'>            <div class='form-btns reorder-btns'>                <button class='button' data-binding='{@event-onclick: handleClickButtonDone}{@text: @language-layerDrawingOrder-button-done}'></button>                <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@text: @language-layerDrawingOrder-button-reset}{@enabled: canReset}'></button>            </div>        </div>    </div></div>",i="<div class='reorderLayers' data-binding='{@source: orderServicesVM}'>    <div data-binding='{@template-for: orderServicesVM}'>        <div class='panel-group no-results box-container' data-binding='{@hidden: hasLayers}'>            <p data-binding='{@text: @language-layerDrawingOrder-noServices}'></p>            <p class='description' data-binding='{@text: @language-layerDrawingOrder-noServices-desc}'></p>        </div>        <div class='panel-group'>            <ul class='gcx-list-menu reorder-list' data-binding='{@source: layers}{@var: sortable}'>                <li class='gcx-list-item reorder-list-item has-action-1' data-binding='{@template-for: layers}{@class-selected: isSelected}{id: uniqueId}'>                    <button class = 'draggable reorder-list-dragHandle' tabindex='-1' data-binding='{@hidden: isSelected}{aria-label: @language-layerDrawingOrder-accessibility-reorder}'></button>                    <button class='gcx-list-button reorder-list-button' data-binding='{@event-onclick: handleClickButtonSelected}'>                        <strong class='gcx-list-label' data-binding='{@text: displayName}'></strong>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-custom-added}{@visible: isUserCreated}'></span>                        <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-in-layer-list}{@hidden: isInLayerList}'></span>                        <div class='meta-info' data-binding='{@hidden: isVisibilityToggledOn}'>                            <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-not-visible}' src='Resources/Images/Icons/not-visible-16.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-visible}'></span>                        </div>                        <div class='meta-info' data-binding='{@hidden: isWithinScale}'>                              <img class='meta-info-icon' tabindex='-1' data-binding='{alt: @language-layerDrawingOrder-meta-visible}' src='Resources/Images/Icons/visibility-24.png' />                            <span class='meta-info-text' data-binding='{@text: @language-layerDrawingOrder-not-within-scale}'></span>                        </div>                    </button>                    <button class='gcx-action-button icon chevron-right-24' data-binding='{@enabled: canDrillIn}{@event-onclick: handleClickButtonNext}'></button>                    <span class='reorder-arrow-btns' data-binding='{@visible: isSelected}'>                        <button class='reorder-arrow-up' data-binding='{@event-onclick: handleClickButtonUp}{@disabled: isFirstInList}'></button>                        <button class='reorder-arrow-down' data-binding='{@event-onclick: handleClickButtonDown}{@disabled: isLastInList}'></button>                    </span>                </li>            </ul>        </div>        <div class='form-item'>            <div class='form-btns reorder-btns'>                <button class='button' data-binding='{@event-onclick: handleClickButtonDone}{@text: @language-layerDrawingOrder-button-done}'></button>                <button class='button' data-binding='{@event-onclick: handleClickButtonReset}{@text: @language-layerDrawingOrder-button-reset}{@enabled: canReset}'></button>            </div>        </div>    </div></div>";function p(e,r,t){if("string"==typeof e&&(t=r,r=e),void 0!==t)for(var i=r.split("."),a=null,n=window,s=0,o=i.length;s<o;s++)a=i[s],s==o-1?n[a]=t:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+r)}require({cache:{"Mapping/modules/LayerDrawingOrder/DrawOrderGroupItem":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function t(e,r,t){this.count=r,this.title=e+" ("+this.count+")",this.type=t}r.DrawOrderGroupItem=t})},"Mapping/modules/LayerDrawingOrder/DrawOrderItem":function(){var i,a=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./DrawOrderItemConstants","geocortex/framework/utils/utils","geocortex/essentials/LayerType"],function(e,r,t,n,l,s,d){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o,i=(o=t.ViewModelBase,a(c,o),c.prototype.unsubscibeFromEvents=function(){String.isNullOrEmpty(this.mapZoomEndedEventToken)||this.app.event("MapZoomEndedEvent").unsubscribe(this.mapZoomEndedEventToken),String.isNullOrEmpty(this.layerVisibilityChangedEventToken)||this.app.event("LayerVisibilityChangedEvent").unsubscribe(this.layerVisibilityChangedEventToken),String.isNullOrEmpty(this.mapServiceVisibilityChangedEvent)||this.app.event("MapServiceVisibilityChangedEvent").unsubscribe(this.mapServiceVisibilityChangedEvent)},c.prototype.populateChildren=function(){var n=this,e=this.app.map.getLayer(this.serviceLayer.id);if(e.dynamicLayerInfos&&e.dynamicLayerInfos.length){for(var r=new Array,t=e.createDynamicLayerInfosFromLayerInfos(),i=0;i<t.length;i++){for(var a=!1,s=0;s<e.dynamicLayerInfos.length;s++)if(e.dynamicLayerInfos[s].id==t[i].id){a=!0;break}a||r.push(t[i])}if(r&&0<r.length){var o=e.dynamicLayerInfos;e.setDynamicLayerInfos(r.concat(o),!0),e.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(this.mapService),!1)}}else e.setDynamicLayerInfos(e.createDynamicLayerInfosFromLayerInfos(),!0),e.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(this.mapService),!1);this.dynamicLayerInfos=e.dynamicLayerInfos.slice(),e.dynamicLayerInfos.forEach(function(e){for(var r=0;r<n.mapService.layers.length;r++)if(e.id.toString()===n.mapService.layers[r].id&&n.mapService.layers[r].type!==d.LayerType.GROUP_LAYER){var t=1==n.owner.layerListLayerItems.filter(function(e){return e.mapService.id===n.mapService.id&&e.layer.id===n.mapService.layers[r].id}).length,i={serviceLayer:n.serviceLayer,mapService:n.mapService,type:l.LAYER,displayName:n.mapService.layers[r].displayName,clusterLayer:null,gcxLayer:n.mapService.layers[r],parent:n,isInLayerList:t},a=new c(n.app,n.libraryId,n.owner,i);n.layerDrawItems.addItem(a);break}})},c.prototype.onLayerVisibilityChanged=function(e){var r=this;e.forEach(function(e){e.mapService===r.mapService&&e.layer===r.gcxLayer&&(r.isVisibilityToggledOn.set(r.gcxLayer.isVisible()),r.isWithinScale.set(r.isWithinScale.get()||!r.isVisibilityToggledOn.get()))})},c.prototype.onMapServiceVisibilityChanged=function(e,r){this.serviceLayer===e&&this.mapService===r&&(this.isVisibilityToggledOn.set(e.visible),this.isWithinScale.set(this.isWithinScale.get()||!this.isVisibilityToggledOn.get()))},c.prototype.onMapZoomEnded=function(e,r,t,i){var a=this.type===l.LAYER?this.gcxLayer.withinScaleRange(null):this.serviceLayer.isVisibleAtScale(this.app.map.getScale());this.isWithinScale.set(!this.isVisibilityToggledOn.get()||a)},c);function c(e,r,t,i){var a=o.call(this,e,r)||this;return a.libraryId=null,a.type=null,a.displayName=null,a.isUserCreated=null,a.isInLayerList=null,a.myClass=new n.Observable("asfd"),a.app=e,a.libraryId=r,a.owner=t,a.uniqueId="drawOrderItem-{0}".format(s.alphaNumericToken()),a.serviceLayer=i.serviceLayer,a.mapService=i.mapService,a.type=i.type,a.displayName=i.displayName,a.clusterLayer=i.clusterLayer,a.canDrillIn=!1,a.layerDrawItems=new n.ObservableCollection,a.serviceLayer&&a.mapService&&a.type!==l.LAYER&&a.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&a.serviceLayer.supportsDynamicLayers&&1<a.serviceLayer.layerInfos.length&&(a.populateChildren(),a.canDrillIn=!0),a.gcxLayer=i.gcxLayer,a.parent=i.parent,a.isUserCreated=a.mapService.isUserCreated,a.isVisibilityToggledOn=new n.Observable(a.type===l.LAYER?a.gcxLayer.isVisible():a.serviceLayer.visible),a.isWithinScale=new n.Observable((a.type===l.LAYER?a.gcxLayer.withinScaleRange():a.serviceLayer.isVisibleAtScale(a.app.map.getScale()))||!a.isVisibilityToggledOn.get()),a.isInLayerList=i.isInLayerList||a.isUserCreated,a.isFirstInList=new n.Observable(!1),a.isLastInList=new n.Observable(!1),a.isSelected=new n.Observable(!1),a.mapZoomEndedEventToken=a.app.event("MapZoomEndedEvent").subscribe(a,a.onMapZoomEnded),a.type===l.LAYER?a.layerVisibilityChangedEventToken=a.app.event("LayerVisibilityChangedEvent").subscribe(a,a.onLayerVisibilityChanged):a.mapServiceVisibilityChangedEvent=a.app.event("MapServiceVisibilityChangedEvent").subscribe(a,a.onMapServiceVisibilityChanged),a}r.DrawOrderItem=i})},"Mapping/modules/LayerDrawingOrder/DrawOrderItemConstants":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SERVICE_LAYER="service_layer",r.LAYER="layer",r.GRAPHIC="graphic",r.UP=0,r.DOWN=1})},"Mapping/modules/LayerDrawingOrder/LayerDrawingOrderModule":function(){var i,o=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/validation/NumberValidator"],function(e,r,t,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a,n=(a=t.ModuleBase,o(s,a),s.prototype.initialize=function(e){a.prototype.initialize.call(this,e),this._config=e},s.prototype.getStateFilter=function(){var e=new i.NumberValidator;return{graphicsLayerTransforms:{item:{layerId:!0,topLayer:!0,bottomLayer:!0,relativePosition:e}},serviceTransforms:{item:{layerId:!0,topLayer:!0,bottomLayer:!0,relativePosition:e}}}},s.prototype.applyState=function(e){var r=this;return this.app.event("ProjectLoadedEvent").once(this,function(){r.app.waitUntilApplicationReady().then(function(){r.app.command("_ApplyLayerDrawingOrderState").execute(e)})}),Promise.resolve()},s.prototype.exportState=function(){var e=this,r={graphicsLayerTransforms:[],serviceTransforms:[]};return Promise.try(function(){return e.app.command("_PopulateLayerDrawingOrderState").execute(r),r})},s);function s(e,r){return a.call(this,e,r)||this}r.LayerDrawingOrderModule=n})},"Mapping/modules/LayerDrawingOrder/LayerDrawingOrderViewModel":function(){var i,h=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./DrawOrderItem","./Dialogs/LayerGroupsDialogViewModel","./Dialogs/OrderServicesDialogViewModel","./Dialogs/OrderLayersDialogViewModel","./DrawOrderItemConstants","geocortex/infrastructure/Dictionary","geocortex/infrastructure/layerList/LayerListItem","geocortex/framework/utils/ArrayUtils"],function(e,r,t,i,o,a,n,s,l,d,c,p){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var y,g=(y=t.ViewModelBase,h(u,y),u.prototype.initialize=function(){var r=this;this._subscribeEvents(),this._registerCommands(),this.app.event("LayerListInitializedEvent").once(this,function(e){r.layerList=e,r._getAllLayerListLayersAndMapServices(r.layerList.children),r.app.waitUntilApplicationReady().then(function(){r._updateLayerDrawingOrderLayers()})})},u.prototype._subscribeEvents=function(){var e=this;this.app.event("LayerAddedEvent").subscribe(this,this._recordAddedLayer),this.app.event("ClusterLayerAddedEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor),this.app.event("ClusterLayerRemovedEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor),this.app.event("SiteInitializingEvent").subscribe(this,function(){return e.canUpdateLayerDrawingOrderLayers.set(!0)}),this.app.event("SiteServiceLayersFailedEvent").subscribe(this,function(){return e.canUpdateLayerDrawingOrderLayers.set(!0)}),this.app.event("MapServiceLayersChangedWithResultEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor)},u.prototype._registerCommands=function(){this.app.command("RemoveUserAddedLayer").register(this,this._recordRemovedLayer),this.app.command("RemoveMapService").register(this,this._recordRemovedMapService),this.app.command("ClearLayerCatalogLayers").register(this,this._recordClearedLayerCatalogLayers),this.app.command("OpenLayerDrawingOrderGroups").register(this,this._updateLayerDrawingOrderLayers),this.app.command("_ApplyLayerDrawingOrderState").register(this,this._applyState),this.app.command("_PopulateLayerDrawingOrderState").register(this,this._exportState)},u.prototype._recordAddedLayer=function(e,r){r.isUserCreated&&e instanceof esri.layers.GraphicsLayer&&this._reorderUserAddedLayers(e,r),this.layerReference.containsKey(e.id)&&this.layerReference.remove(e.id),this.layerReference.set(e.id,r),this.updateLayerDrawingOrderLayersMonitor()},u.prototype._recordRemovedLayer=function(e){this.layerReference.containsKey(e.mapService.serviceLayer.id)&&this.layerReference.remove(e.mapService.serviceLayer.id),this.updateLayerDrawingOrderLayersMonitor()},u.prototype._recordRemovedMapService=function(e){this.layerReference.containsKey(e.serviceLayer.id)&&this.layerReference.remove(e.serviceLayer.id),this.updateLayerDrawingOrderLayersMonitor()},u.prototype._recordClearedLayerCatalogLayers=function(){for(var e=0,r=this.layerReference.keys();e<r.length;e++){var t=r[e];this.layerReference.get(t).catalogId&&this.layerReference.remove(t)}this.updateLayerDrawingOrderLayersMonitor()},u.prototype._reorderUserAddedLayers=function(e,r){var t=this.graphicsLayerDrawItems.getLength()?this.app.map.graphicsLayerIds.indexOf(this.graphicsLayerDrawItems.getAt(0).serviceLayer.id)+1:0;this.app.map.reorderLayer(e,t)},u.prototype.updateLayerDrawingOrderLayersMonitor=function(){var e=this;this.canUpdateLayerDrawingOrderLayers.get()&&(this.canUpdateLayerDrawingOrderLayers.set(!1),setTimeout(function(){e._updateLayerDrawingOrderLayers(),e.canUpdateLayerDrawingOrderLayers.set(!0)},750))},u.prototype._updateLayerDrawingOrderLayers=function(){var s=this;this.serviceLayerDrawItems.get().forEach(function(e){e.unsubscibeFromEvents()}),this.graphicsLayerDrawItems.get().forEach(function(e){e.unsubscibeFromEvents()}),this.serviceLayerDrawItems.clear(),this.graphicsLayerDrawItems.clear(),this.app.map.graphicsLayerIds.forEach(function(r){var t=s.app.map.getLayer(r);if(s.layerReference.containsKey(r)){var e=s.app.map.getLayer(t.id+"-cluster"),i=s.layerListGraphicsLayerItems.filter(function(e){return e.mapService.id===s.layerReference.get(r).id&&e.layer.id===t.layerId}),a={serviceLayer:t,mapService:s.layerReference.get(r),type:l.GRAPHIC,displayName:s.layerReference.get(r).displayName,clusterLayer:e,gcxLayer:null,parent:null,isInLayerList:1===i.length},n=new o.DrawOrderItem(s.app,s.libraryId,s,a);s.graphicsLayerDrawItems.insertItem(0,n)}}),this.graphicsLayerDrawItems.get().forEach(function(e){e.clusterLayer&&s.app.map.reorderLayer(e.clusterLayer,s.app.map.graphicsLayerIds.indexOf(e.serviceLayer.id))}),this.app.map.layerIds.forEach(function(e){var r=s.app.map.getLayer(e);if(s.layerReference.containsKey(r.id)){var t=s.layerReference.get(r.id);if(0===t.layers.length)return;var i={serviceLayer:r,mapService:t,type:l.SERVICE_LAYER,displayName:t.displayName,clusterLayer:null,gcxLayer:null,parent:null,isInLayerList:s._isInLayerList(t)},a=new o.DrawOrderItem(s.app,s.libraryId,s,i);s.serviceLayerDrawItems.insertItem(0,a)}}),this.refreshPanels()},u.prototype.refreshPanels=function(){if(this.orderLayersVM.layers.getLength()){var r=this.orderLayersVM.layers.getAt(0);if(r.type===l.GRAPHIC)this.orderLayersVM.reset(),this.orderLayersVM.populateLayers();else if(r.type===l.LAYER){this.orderLayersVM.reset();var e=this.serviceLayerDrawItems.get().filter(function(e){return e.serviceLayer.id===r.serviceLayer.id});1===e.length&&this.orderLayersVM.populateLayers(e[0])}this.orderLayersVM.layers.pulse()}this.orderServicesVM.reset(),this.orderServicesVM.populateLayers(),this.orderServicesVM.layers.pulse(),this.layerGroupsVM.reset(),this.layerGroupsVM.populateLayerGroups(),this.orderServicesVM.currentDrawOrder=this.app.map.layerIds.slice(),this.orderLayersVM.currentDrawOrder=this.app.map.graphicsLayerIds.slice(),this.app.event("LayerDrawingOrderPanelRefreshedEvent").publish()},u.prototype._isInLayerList=function(r){var e=!!p.firstOrDefault(this.layerListMapServiceItems,function(e){return e.mapService.id===r.id}),t=!!p.firstOrDefault(this.layerListLayerItems,function(e){return e.mapService.gcxMapService===r});return e||t},u.prototype._getAllLayerListLayersAndMapServices=function(e){for(var r=0;r<e.getLength();r++){var t=e.getAt(r);t.type===c.LayerListItemType.FOLDER?this._getAllLayerListLayersAndMapServices(t.children):t.type===c.LayerListItemType.LAYER?this.layerListLayerItems.push(t):t.type===c.LayerListItemType.GRAPHICSLAYER?this.layerListGraphicsLayerItems.push(t):t.type===c.LayerListItemType.MAPSERVICE&&this.layerListMapServiceItems.push(t)}},u.prototype.getDynamicMapServiceVisibleLayers=function(e){var r=e.getVisibleLayers();return 0===r.length&&r.push("-1"),r},u.prototype._exportState=function(e){e.serviceTransforms=this._createLayerTransforms(this.movedServices,this.app.map.layerIds),e.graphicsLayerTransforms=this._createLayerTransforms(this.movedGraphicsLayers,this.app.map.graphicsLayerIds)},u.prototype._createLayerTransforms=function(e,i){var a=this;return e.map(function(e){if(a.app.map.getLayer(e)){var r=i.indexOf(e),t=r/(i.length-1);return{layerId:e,topLayer:r<i.length?i[r+1]:null,bottomLayer:0<r?i[r-1]:null,relativePosition:t}}}).sort(function(e,r){return e.relativePosition<r.relativePosition?-1:e.relativePosition>r.relativePosition?1:0})},u.prototype._applyState=function(e){var r=this;this.movedServices=[],this.movedGraphicsLayers=[];var t=e.serviceTransforms.filter(function(e){return-1<r.app.map.layerIds.indexOf(e.layerId)}),i=e.graphicsLayerTransforms.filter(function(e){return-1<r.app.map.graphicsLayerIds.indexOf(e.layerId)});(0<t.length||0<i.length)&&Promise.each([function(){return r._applyLayerTransforms(t,function(){return r.app.map.layerIds},r.movedServices)},function(){return r._applyLayerTransforms(i,function(){return r.app.map.graphicsLayerIds.filter(function(e){return-1===e.indexOf("-explodedClusterLayer")})},r.movedGraphicsLayers)}],function(e){return e()}).then(function(){r.updateLayerDrawingOrderLayersMonitor();var e=r.app.map.on("update-end",function(){r.app.map.setExtent(r.app.map.extent),e.remove()})})},u.prototype._applyLayerTransforms=function(d,c,e,p,y){var g=this;void 0===p&&(p=function(e,r){g.app.map.reorderLayer(e,r)}),void 0===y&&(y=function(e){return g.app.map.getLayer(e)});var o=d.map(function(e){return e.layerId});if(0===o.length)return Promise.resolve();function l(e){var r=o.indexOf(e);-1<r&&o.splice(r,1)}return e&&e.push.apply(e,o),Promise.each(d,function(s){return new Promise(function(e,r){var t=c().indexOf(s.layerId),i=g.app.map.on("layer-reorder",function(){i.remove(),e()}),a=c().indexOf(s.bottomLayer),n=c().indexOf(s.topLayer);-1<a&&-1===o.indexOf(s.bottomLayer)?(l(s.layerId),t-a!=1?p(y(s.layerId),a+(a<t?1:0)):(i.remove(),e())):-1<n&&-1===o.indexOf(s.topLayer)?(l(s.layerId),n-t!=1?p(y(s.layerId),n+(t<n?-1:0)):(i.remove(),e())):(i.remove(),e())})}).then(function(){if(0!==o.length&&o.length!==d.length)return g._applyLayerTransforms(d.filter(function(e){return-1<o.indexOf(e.layerId)}),c,null,p,y);if(0<o.length){var l=(d=d.filter(function(e){return-1<o.indexOf(e.layerId)})).map(function(e){return c().indexOf(e.layerId)}).sort(function(e,r){return e-r});return Promise.each(d,function(o){return new Promise(function(e,r){var t=g.app.map.on("layer-reorder",function(){t.remove(),n&&i?(t=g.app.map.on("layer-reorder",function(){t.remove(),e()}),s()!==i?p(y(n),i):e()):e()}),i=c().indexOf(o.layerId),a=l[d.indexOf(o)],n=c()[a],s=function(){return c().indexOf(n)};i!==a?p(y(o.layerId),a):e()})})}return Promise.resolve()})},u.prototype.reset=function(){},u);function u(e,r){var t=y.call(this,e,r)||this;return t.movedServices=[],t.movedGraphicsLayers=[],t.app=e,t.canUpdateLayerDrawingOrderLayers=new i.Observable(!1),t.graphicsLayerDrawItems=new i.ObservableCollection,t.serviceLayerDrawItems=new i.ObservableCollection,t.layerReference=new d.Dictionary,t.layerListGraphicsLayerItems=[],t.layerListLayerItems=[],t.layerListMapServiceItems=[],t.layerGroupsVM=new a.LayerGroupsDialogViewModel(t,t.app,t.libraryId),t.orderServicesVM=new n.OrderServicesDialogViewModel(t,t.app,t.libraryId),t.orderLayersVM=new s.OrderLayersDialogViewModel(t,t.app,t.libraryId),t}r.LayerDrawingOrderViewModel=g})},"Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView":function(){var i,o=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","./../DrawOrderItemConstants"],function(e,r,t,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a,n=(a=t.WizardFragmentView,o(s,a),s.prototype.attach=function(e){a.prototype.attach.call(this,e)},s.prototype.registerCommands=function(){var e=this;this.app.command("OpenLayerDrawingOrderGroups").register(this,this.openPanel),this.app.command("CloseLayerDrawingOrderPanel").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},s.prototype.openPanel=function(){this.viewModel.layerGroupsVM.reset(),this.viewModel.layerGroupsVM.populateLayerGroups(),this.app.command("ActivateView").execute(this.id)},s.prototype.handleClickButtonNext=function(e,r,t){t.type===i.GRAPHIC?this.app.command("OpenLayerDrawingOrderLayers").execute():this.app.command("OpenLayerDrawingOrderServices").execute()},s.prototype.handleClickButtonCancel=function(){this.app.viewManager.deactivateView(this)},s);function s(e,r){var t=a.call(this,e,r)||this;return t.libraryId=null,t.app=e,t.libraryId=r,t.registerCommands(),t}r.LayerGroupsDialogView=n})},"Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogViewModel":function(){var i,d=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./../DrawOrderGroupItem","./../DrawOrderItemConstants"],function(e,r,t,a,i,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s,o=(s=t.ViewModelBase,d(l,s),l.prototype.populateLayerGroups=function(){if(this.hasGroups(),this.graphicsGroupExists.get()){var e=new i.DrawOrderGroupItem(this.getResource("language-layerDrawingOrder-graphics-group-title"),this.owner.graphicsLayerDrawItems.getLength(),n.GRAPHIC);this.groups.addItem(e)}if(this.servicesGroupExists.get()){var r=new i.DrawOrderGroupItem(this.getResource("language-layerDrawingOrder-services-group-title"),this.owner.serviceLayerDrawItems.getLength(),n.SERVICE_LAYER);this.groups.addItem(r)}},l.prototype.hasGroups=function(){return this.graphicsGroupExists.set(0<this.owner.graphicsLayerDrawItems.getLength()),this.servicesGroupExists.set(0<this.owner.serviceLayerDrawItems.getLength()),this.graphicsGroupExists.get()||this.servicesGroupExists.get()},l.prototype.reset=function(){this.groups.clear()},l);function l(e,r,t){var i=s.call(this,r,t)||this;return i.app=r,i.libraryId=t,i.owner=e,i.graphicsGroupExists=new a.Observable(!1),i.servicesGroupExists=new a.Observable(!1),i.showGroups=new a.Observable(!1),i.groups=new a.ObservableCollection,i.graphicsGroupExists.bind(i,function(){return i.showGroups.set(i.graphicsGroupExists.get()||i.servicesGroupExists.get())}),i.servicesGroupExists.bind(i,function(){return i.showGroups.set(i.graphicsGroupExists.get()||i.servicesGroupExists.get())}),i}r.LayerGroupsDialogViewModel=o})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderDialogView":function(){var i,l=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","geocortex/framework/observables","./../DrawOrderItemConstants"],function(e,r,t,a,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,s=(i=t.WizardFragmentView,l(o,i),o.prototype.attach=function(e){var r=this;i.prototype.attach.call(this,e),this.app.waitUntilApplicationReady().then(function(){$(r.sortable).sortable({handle:"button.reorder-list-dragHandle",axis:"y",cancel:".reorder-arrow-btns button",scrollSpeed:10}),$(r.sortable).disableSelection(),$(r.sortable).bind("sortupdate",dojo.hitch(r,r.sortUpdate))})},o.prototype.registerCommands=function(){var r=this;if(null===this.openPanelCommandName||void 0===this.openPanelCommandName){var e="variable this.openPanelCommandName NOT DEFINED. A derivative class should instantiate this variable",t=new Error(e);throw this.app.trace.error(e,t),t}this.app.command(this.openPanelCommandName).register(this,function(e){r.relatedViewModel.populateLayers(e),r.app.command("ActivateView").execute(r.id)}),this.app.command("CloseLayerDrawingOrderPanel").register(this,function(){r.isActive&&r.app.viewManager.deactivateView(r)})},o.prototype.subscribeEvents=function(){var i=this;this.app.event("LayerDrawingOrderPanelRefreshedEvent").subscribe(this,function(){i.isActive&&!i.relatedViewModel.layers.getLength()&&i.app.viewManager.deactivateView(i),i.currentlySelectedElement=new a.Observable(null),i.lastSelectionArrowUsed=null}),this.app.event("LayerDrawingOrderPanelOrderChangedEvent").subscribe(this,function(e,r){if(void 0!==e&&void 0!==r&&i.app.command("ScreenReaderNarrate").execute(e.displayName+" was moved to position "+(r+1)+" in the list"),null!==i.lastSelectionArrowUsed&&i.isActive){var t=document.querySelector("#"+i.currentlySelectedElement.get().uniqueId+" .reorder-arrow-"+(i.lastSelectionArrowUsed===n.UP?"up":"down"));null!==t?t.focus():i.app.trace.error("Could not find previously selected arrow to keyboard focus on")}})},o.prototype.sortUpdate=function(e,t){if(this.lastSelectionArrowUsed=null,!(this.relatedViewModel.layers.getLength()<2)){for(var r,i=t.item.attr("id"),a=-1,n=0;n<this.relatedViewModel.layers.getLength();n++){var s=this.relatedViewModel.layers.getAt(n);if(s.uniqueId===i){a=n,r=s;break}}if(r&&-1<a){var o=-1;t.item.parent().children().each(function(e,r){if(r===t.item.get(0))return o=e,!1}),-1<o&&this.relatedViewModel.moveElement(r,o-a)}}},o.prototype.handleClickButtonSelected=function(e,r,t){this.lastSelectionArrowUsed=null,this.currentlySelectedElement.get()&&t.uniqueId!==this.currentlySelectedElement.get().uniqueId&&this.currentlySelectedElement.get().isSelected.set(!1),t.isSelected.get()?(t.isSelected.set(!1),this.currentlySelectedElement.set(null)):(t.isSelected.set(!0),this.currentlySelectedElement.set(t))},o.prototype.handleClickButtonUp=function(e,r,t){this.lastSelectionArrowUsed=n.UP,this.relatedViewModel.moveElement(t,-1)},o.prototype.handleClickButtonDown=function(e,r,t){this.lastSelectionArrowUsed=n.DOWN,this.relatedViewModel.moveElement(t,1)},o.prototype.handleClickButtonReset=function(){this.relatedViewModel.resetDrawOrder()},o.prototype.handleClickButtonDone=function(){this.app.command("CloseLayerDrawingOrderPanel").execute()},o);function o(e,r){var t=i.call(this,e,r)||this;return t.libraryId=null,t.openPanelCommandName=null,t.lastSelectionArrowUsed=null,t.app=e,t.libraryId=r,t.currentlySelectedElement=new a.Observable(null),t.registerCommands(),t.subscribeEvents(),t}r.OrderDialogView=s})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderDialogViewModel":function(){var i,o=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,r,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=(n=t.ViewModelBase,o(s,n),s.prototype.setFirstLastAndSelected=function(){this.layers.getLength()&&(this.layers.get().forEach(function(e){e.isFirstInList.set(!1),e.isLastInList.set(!1)}),this.layers.getAt(0).isFirstInList.set(!0),this.layers.getAt(this.layers.getLength()-1).isLastInList.set(!0))},s.prototype.reset=function(){this.layers.clear(),this.canReset.set(!1)},s);function s(e,r,t){var i=n.call(this,r,t)||this;return i.app=r,i.libraryId=t,i.owner=e,i.layers=new a.ObservableCollection,i.hasLayers=new a.Observable(!1),i.layers.bind(i,function(){return i.hasLayers.set(0<i.layers.getLength())}),i.canReset=new a.Observable(!1),i}r.OrderDialogViewModel=i})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView":function(){var i,s=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","./OrderDialogView"],function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a=(i=t.OrderDialogView,s(n,i),n.prototype.registerCommands=function(){this.openPanelCommandName="OpenLayerDrawingOrderLayers",i.prototype.registerCommands.call(this)},n.prototype.attach=function(e){i.prototype.attach.call(this,e),this.relatedViewModel=this.viewModel.orderLayersVM},n);function n(e,r){return i.call(this,e,r)||this}r.OrderLayersDialogView=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogViewModel":function(){var i,d=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","./OrderDialogViewModel","./../DrawOrderItemConstants","geocortex/framework/utils/ArrayUtils","geocortex/framework/utils/utils"],function(e,r,t,n,s,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a=(i=t.OrderDialogViewModel,d(l,i),l.prototype.populateLayers=function(e){e?this.layers.set(e.layerDrawItems.get()):this.layers.set(this.owner.graphicsLayerDrawItems.get()),this.setFirstLastAndSelected()},l.prototype.moveElement=function(e,r){if(e.type===n.GRAPHIC){var t=this.moveGraphicsLayerUiElement(e,r);this.moveGraphicsLayer(e,r<0,t)}else t=this.moveDynamicLayerUiElement(e,r),this.moveDynamicLayer(e,r<0,t);var i=this.getIndex(e);this.app.event("LayerDrawingOrderPanelOrderChangedEvent").publish(e,i)},l.prototype.getIndex=function(r){var e;if(r.type===n.GRAPHIC)e=this.owner.graphicsLayerDrawItems.indexOf(r);else{var t=r.parent,i=t.layerDrawItems.get().filter(function(e){return e.gcxLayer===r.gcxLayer});if(1==i.length){var a=i[0];e=t.layerDrawItems.indexOf(a)}else e=-1}return-1===e&&this.app.trace.error("LayerDrawingOrder Error: Could not find item "+r.displayName+" in collection of layers"),e},l.prototype.moveGraphicsLayerUiElement=function(e,r){var t=this.getIndex(e),i=t+r,a=this.owner.graphicsLayerDrawItems.getAt(i);return this.owner.graphicsLayerDrawItems.removeAt(t),this.owner.graphicsLayerDrawItems.insertItem(i,e),this.reset(),this.populateLayers(),a},l.prototype.moveDynamicLayerUiElement=function(r,e){var t=r.parent,i=t.layerDrawItems.get().filter(function(e){return e.gcxLayer===r.gcxLayer});if(1==i.length){i[0];var a=this.getIndex(r),n=a+e,s=t.layerDrawItems.getAt(n);return t.layerDrawItems.removeAt(a),t.layerDrawItems.insertItem(n,r),this.reset(),this.populateLayers(t),s}this.app.trace.error("LayerDrawingOrder Error: Could not find the dynamic layer "+r.displayName+" in collection of layers")},l.prototype.moveGraphicsLayer=function(e,r,t){if(-1<this.app.map.graphicsLayerIds.indexOf(e.serviceLayer.id)){var i,a=[this.app.map.graphicsLayerIds.indexOf(t.serviceLayer.id)];t.clusterLayer&&(a.push(this.app.map.graphicsLayerIds.indexOf(t.clusterLayer.id)),t.clusterLayer.isClusterExploded()&&a.push(this.app.map.graphicsLayerIds.indexOf(t.clusterLayer.singleFeatureLayer.id))),i=r?Math.max.apply(Math,a):Math.min.apply(Math,a),this.app.map.reorderLayer(e.serviceLayer,i),-1===this.owner.movedGraphicsLayers.indexOf(e.serviceLayer.id)&&this.owner.movedGraphicsLayers.push(e.serviceLayer.id),e.clusterLayer&&(r?this.app.map.reorderLayer(e.clusterLayer,i):this.app.map.reorderLayer(e.clusterLayer,i+1),-1===this.owner.movedGraphicsLayers.indexOf(e.clusterLayer.id)&&this.owner.movedGraphicsLayers.push(e.clusterLayer.id),e.clusterLayer.isClusterExploded()&&(r?this.app.map.reorderLayer(e.clusterLayer.singleFeatureLayer,i):this.app.map.reorderLayer(e.clusterLayer.singleFeatureLayer,i+1))),this.canReset.set(!0)}else console.log("LayerDrawingOrder Error: Could not find graphics layer on map.")},l.prototype.moveDynamicLayer=function(e,r,t){var i=this.app.map.layerIds.indexOf(e.serviceLayer.id);if(-1<i){var a=this.app.map.getLayer(this.app.map.layerIds[i]);a.dynamicLayerInfos&&a.dynamicLayerInfos.length||a.setDynamicLayerInfos(a.createDynamicLayerInfosFromLayerInfos(),!0);for(var n=0;n<a.dynamicLayerInfos.length;n++)if(a.dynamicLayerInfos[n].id.toString()===e.gcxLayer.id){var s=a.dynamicLayerInfos.slice(),o=s.filter(function(e){return e.id.toString()===t.gcxLayer.id})[0];if(o){var l=s.indexOf(o),d=s.splice(n,1)[0];return s.splice(l,0,d),this._moveAnnotationSublayers(s,l),this._moveGroupLayers(s,l,d.id),a.setDynamicLayerInfos(s,!0),a.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(e.mapService),!0),a.refresh(),void this.canReset.set(!0)}}}else this.app.trace.warning("LayerDrawingOrder Error: Could not find service on map.")},l.prototype.resetDrawOrder=function(){this.layers.getLength()&&(this.layers.getAt(0).type===n.GRAPHIC?this.resetGraphicsLayerDrawingOrder():this.resetDynamicLayerDrawingOrder(),this.owner.updateLayerDrawingOrderLayersMonitor())},l.prototype.resetGraphicsLayerDrawingOrder=function(){for(var e=0;e<this.currentDrawOrder.length;e++)this.app.map.reorderLayer(this.app.map.getLayer(this.currentDrawOrder[e]),e)},l.prototype.resetDynamicLayerDrawingOrder=function(){var e=this.layers.getAt(0),r=this.owner.serviceLayerDrawItems.indexOf(e.parent),t=this.owner.serviceLayerDrawItems.getAt(r),i=this.app.map.layerIds.indexOf(t.serviceLayer.id);if(-1<i){var a=this.app.map.getLayer(this.app.map.layerIds[i]);a.setDynamicLayerInfos(t.dynamicLayerInfos,!0),a.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(t.mapService),!1)}else this.app.trace.warning("LayerDrawingOrder Error: Could not find service on map.")},l.prototype._moveGroupLayers=function(e,r,t){for(var i=r;i<e.length;i++){var a=e[i];if(a.subLayerIds&&-1<a.subLayerIds.indexOf(t)){var n=e.splice(i,1)[0];e.splice(r,0,n),this._moveGroupLayers(e,r,n.id)}}},l.prototype._moveAnnotationSublayers=function(i,a){if(i[a].subLayerIds&&0<i[a].subLayerIds.length)for(var e=function(r){var e=i.indexOf(s.firstOrDefault(i,function(e){return e.id===r}));if(!o.isNullOrUndefined(e)){var t=i.splice(e,1)[0];i.splice(a+1,0,t)}},r=0,t=i[a].subLayerIds;r<t.length;r++)e(t[r])},l);function l(e,r,t){return i.call(this,e,r,t)||this}r.OrderLayersDialogViewModel=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView":function(){var i,s=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","./OrderDialogView"],function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a=(i=t.OrderDialogView,s(n,i),n.prototype.registerCommands=function(){this.openPanelCommandName="OpenLayerDrawingOrderServices",i.prototype.registerCommands.call(this)},n.prototype.attach=function(e){i.prototype.attach.call(this,e),this.relatedViewModel=this.viewModel.orderServicesVM},n.prototype.handleClickButtonNext=function(e,r,t){this.app.command("OpenLayerDrawingOrderLayers").execute(t)},n);function n(e,r){return i.call(this,e,r)||this}r.OrderServicesDialogView=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogViewModel":function(){var i,s=this&&this.__extends||(i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)},function(e,r){function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)});define(["require","exports","./OrderDialogViewModel"],function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i,a=(i=t.OrderDialogViewModel,s(n,i),n.prototype.populateLayers=function(){this.layers.set(this.owner.serviceLayerDrawItems.get()),this.setFirstLastAndSelected()},n.prototype.moveElement=function(e,r){var t=this.moveServiceUiElement(e,r);this.moveService(e,t);var i=this.getIndex(e);this.app.event("LayerDrawingOrderPanelOrderChangedEvent").publish(e,i)},n.prototype.getIndex=function(e){var r=this.owner.serviceLayerDrawItems.indexOf(e);return-1===r&&this.app.trace.error("LayerDrawingOrder Error: Could not find item "+e.displayName+" in collection of services"),r},n.prototype.moveServiceUiElement=function(e,r){var t=this.getIndex(e),i=t+r;i>=this.owner.serviceLayerDrawItems.getLength()&&(i=this.owner.serviceLayerDrawItems.getLength()-1),i<0&&(i=0);var a=this.owner.serviceLayerDrawItems.getAt(i);return this.owner.serviceLayerDrawItems.removeAt(t),this.owner.serviceLayerDrawItems.insertItem(i,e),this.reset(),this.populateLayers(),a},n.prototype.moveService=function(e,r){if(-1<this.app.map.layerIds.indexOf(e.serviceLayer.id)){var t=this.app.map.layerIds.indexOf(r.serviceLayer.id);this.app.map.reorderLayer(e.serviceLayer,t),this.canReset.set(!0),-1===this.owner.movedServices.indexOf(e.serviceLayer.id)&&this.owner.movedServices.push(e.serviceLayer.id)}else console.log("LayerDrawingOrder Error: Could not find service on map.")},n.prototype.resetDrawOrder=function(){for(var e=0;e<this.currentDrawOrder.length;e++)this.app.map.reorderLayer(this.app.map.getLayer(this.currentDrawOrder[e]),e);this.owner.updateLayerDrawingOrderLayersMonitor()},n);function n(e,r,t){return i.call(this,e,r,t)||this}r.OrderServicesDialogViewModel=a})},"url:/Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView.html":r,"url:/Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView.html":t,"url:/Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/CSS/common.css","css","LyotLS1TVEFSVDogTGF5ZXIgR3JvdXBzIFBhbmVsLS0tKi8NCg0KLnJlb3JkZXItbGlzdCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHRvcDogMDsNCiAgICBib3R0b206IDQuNWVtOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQp9DQoNCi53YXJuaW5nLWxhYmVsLnJlb3JkZXItaW5mbyB7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNFRUVFRUU7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQoucmVvcmRlci1saXN0IC51aS1zb3J0YWJsZS1wbGFjZWhvbGRlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Y4RjhGODsNCiAgICB2aXNpYmlsaXR5OiB2aXNpYmxlICFpbXBvcnRhbnQ7IC8qIFVzaW5nICFpbXBvcnRhbnQgdG8gb3ZlcnJpZGUganF1ZXJ5J3MgZGVmYXVsdCBvcHRpb24gZm9yIHRoZSBlbGVtZW50Ki8NCn0NCg0KLnVpLXNvcnRhYmxlLWhlbHBlciB7DQogICAgYm9yZGVyLXRvcDogc29saWQgMXB4ICNFRUVFRUU7DQp9DQoNCi5yZW9yZGVyLWxpc3QtaXRlbSB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQp9DQoNCi5yZW9yZGVyLWxpc3QtYnV0dG9uIHsNCiAgICBtaW4taGVpZ2h0OiAzZW07DQogICAgcGFkZGluZzogMWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB6LWluZGV4OjA7DQogICAgLXdlYmtpdC10cmFuc2l0aW9uOiBwYWRkaW5nIDAuMXMgZWFzZS1pbi1vdXQ7DQogICAgLW8tdHJhbnNpdGlvbjogcGFkZGluZyAwLjFzIGVhc2UtaW4tb3V0Ow0KICAgIC1tb3otdHJhbnNpdGlvbjogcGFkZGluZyAwLjFzIGVhc2UtaW4tb3V0Ow0KICAgIHRyYW5zaXRpb246IHBhZGRpbmcgMC4xcyBlYXNlLWluLW91dDsNCiAgICBwYWRkaW5nLWxlZnQ6IDIuNWVtOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2RyYWctMTYucG5nKTsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAuNzVlbSAxZW07DQp9DQoNCi5sYXllci1ncm91cHMtbGlzdCAucmVvcmRlci1saXN0LWJ1dHRvbiB7DQogICAgcGFkZGluZy1sZWZ0OiAxZW07DQp9DQoNCi5yZW9yZGVyLWxpc3QtYnV0dG9uIC5nY3gtbGlzdC1sYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQoucmVvcmRlci1saXN0LWRyYWdIYW5kbGUgew0KICAgIHBvc2l0aW9uOmFic29sdXRlOw0KICAgIGhlaWdodDoxMDAlOw0KICAgIHdpZHRoOjEyJTsNCiAgICB6LWluZGV4OiAxOw0KfQ0KDQoubWV0YS1pbmZvLWljb24gew0KICAgIGhlaWdodDogMTZweDsNCiAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgbWFyZ2luOiAwLjVlbSAwLjI1ZW0gMCAwOw0KICAgIGRpc3BsYXk6IGlubGluZTsNCn0NCg0KLm1ldGEtaW5mby10ZXh0IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgbWFyZ2luLXJpZ2h0OiA1LjVlbTsNCiAgICBmb250LXN0eWxlOiBpdGFsaWM7DQogICAgY29sb3I6ICM2NjY2NjY7DQp9DQoNCi5yZW9yZGVyLWFycm93LWJ0bnMgew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMy41ZW07DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBsZWZ0OiAwOw0KICAgIG9wYWNpdHk6IDA7DQogICAgYm9yZGVyLXJpZ2h0OiBzb2xpZCAxcHggI2VlZWVlZTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctdXAsDQoucmVvcmRlci1hcnJvdy1kb3duIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgaGVpZ2h0OiA1MCU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KfQ0KDQoucmVvcmRlci1hcnJvdy11cDpob3ZlciwNCi5yZW9yZGVyLWFycm93LWRvd246aG92ZXIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNERUYyRkY7DQp9DQoNCi5yZW9yZGVyLWFycm93LXVwIHsNCiAgICB0b3A6IDA7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvYXJyb3ctdXAtc21hbGwtMjQucG5nKTsNCiAgICBib3JkZXItYm90dG9tOiBzb2xpZCAxcHggI2VlZWVlZTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctZG93biB7DQogICAgYm90dG9tOiAwOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2Fycm93LWRvd24tc21hbGwtMjQucG5nKTsNCn0NCg0KLnJlb3JkZXItYnRucyB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJvdHRvbTogMDsNCiAgICByaWdodDogMDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDQuNWVtOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQoNCi8qLS0tRU5EOiBMYXllciBHcm91cHMgUGFuZWwtLS0qLw0KDQovKi0tLVNUQVJUOiBTZWxlY3RlZCBTdGF0ZSAtLS0qLw0KDQouc2VsZWN0ZWQgLnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIHBhZGRpbmctbGVmdDogNC41ZW07DQp9DQoNCi5zZWxlY3RlZCAucmVvcmRlci1hcnJvdy1idG5zIHsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KDQouc2VsZWN0ZWQgLnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7DQp9DQoNCi8qLS0tRU5EOiBTZWxlY3RlZCBTdGF0ZSAtLS0qLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/CSS/small.css","css","LnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIG1pbi1oZWlnaHQ6IDMuNDRlbTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctYnRucyB7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiA2Ljg4ZW07DQogICAgYm9yZGVyOiBub25lOw0KfQ0KDQoucmVvcmRlci1hcnJvdy11cCwNCi5yZW9yZGVyLWFycm93LWRvd24gew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMy40NGVtOw0KICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQogICAgYm9yZGVyLXJpZ2h0OiBzb2xpZCAxcHggI2VlZWVlZTsNCn0NCg0KLnJlb3JkZXItYXJyb3ctdXAgew0KICAgIGxlZnQ6IDA7DQp9DQoNCi5yZW9yZGVyLWFycm93LWRvd24gew0KICAgIHJpZ2h0OiAwOw0KfQ0KDQouc2VsZWN0ZWQgLnJlb3JkZXItbGlzdC1idXR0b24gew0KICAgIHBhZGRpbmctbGVmdDogOGVtOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/LayerDrawingOrder/DrawOrderGroupItem","Mapping/modules/LayerDrawingOrder/DrawOrderItem","Mapping/modules/LayerDrawingOrder/DrawOrderItemConstants","Mapping/modules/LayerDrawingOrder/LayerDrawingOrderModule","Mapping/modules/LayerDrawingOrder/LayerDrawingOrderViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogViewModel"],function(e,r,t,i,a,n,s,o,l,d,c){p(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.SERVICE_LAYER",t.SERVICE_LAYER),p(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LAYER",t.LAYER),p(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.GRAPHIC",t.GRAPHIC),p(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.UP",t.UP),p(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DOWN",t.DOWN),p(e,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DrawOrderGroupItem",e.DrawOrderGroupItem),p(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DrawOrderItem",r.DrawOrderItem),p(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerDrawingOrderModule",i.LayerDrawingOrderModule),p(a,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerDrawingOrderViewModel",a.LayerDrawingOrderViewModel),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerGroupsDialogView",n.LayerGroupsDialogView),p(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerGroupsDialogViewModel",s.LayerGroupsDialogViewModel),p(o,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderLayersDialogView",o.OrderLayersDialogView),p(l,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderLayersDialogViewModel",l.OrderLayersDialogViewModel),p(d,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderServicesDialogView",d.OrderServicesDialogView),p(c,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderServicesDialogViewModel",c.OrderServicesDialogViewModel)})}();