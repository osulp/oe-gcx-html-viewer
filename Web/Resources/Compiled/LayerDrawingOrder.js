function shim(e,r,t){if("string"==typeof e&&(t=r,r=e),"undefined"==typeof t)return void console.warn("Undefined shim for: "+r);for(var i=r.split("."),a=null,n=window,s=0,o=i.length;s<o;s++)a=i[s],s==o-1?n[a]=t:n[a]||(n[a]={}),n=n[a]}require({cache:{"Mapping/modules/LayerDrawingOrder/DrawOrderGroupItem":function(){define(["require","exports"],function(e,r){"use strict";var t=function(){function e(e,r,t){this.count=r,this.title=e+" ("+this.count+")",this.type=t}return e}();r.DrawOrderGroupItem=t})},"Mapping/modules/LayerDrawingOrder/DrawOrderItem":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./DrawOrderItemConstants","geocortex/framework/utils/utils","geocortex/essentials/LayerType"],function(e,r,t,i,a,n,s){"use strict";var o=function(e){function r(r,t,s,o){var l=e.call(this,r,t)||this;return l.libraryId=null,l.type=null,l.displayName=null,l.isUserCreated=null,l.isInLayerList=null,l.myClass=new i.Observable("asfd"),l.app=r,l.libraryId=t,l.owner=s,l.uniqueId="drawOrderItem-{0}".format(n.alphaNumericToken()),l.serviceLayer=o.serviceLayer,l.mapService=o.mapService,l.type=o.type,l.displayName=o.displayName,l.clusterLayer=o.clusterLayer,l.canDrillIn=!1,l.layerDrawItems=new i.ObservableCollection,l.serviceLayer&&l.mapService&&l.type!==a.LAYER&&l.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&l.serviceLayer.supportsDynamicLayers&&l.serviceLayer.layerInfos.length>1&&(l.populateChildren(),l.canDrillIn=!0),l.gcxLayer=o.gcxLayer,l.parent=o.parent,l.isUserCreated=l.mapService.isUserCreated,l.isVisibilityToggledOn=new i.Observable(l.type===a.LAYER?l.gcxLayer.isVisible():l.serviceLayer.visible),l.isWithinScale=new i.Observable((l.type===a.LAYER?l.gcxLayer.withinScaleRange():l.serviceLayer.isVisibleAtScale(l.app.map.getScale()))||!l.isVisibilityToggledOn.get()),l.isInLayerList=o.isInLayerList||l.isUserCreated,l.isFirstInList=new i.Observable((!1)),l.isLastInList=new i.Observable((!1)),l.isSelected=new i.Observable((!1)),l.mapZoomEndedEventToken=l.app.event("MapZoomEndedEvent").subscribe(l,l.onMapZoomEnded),l.type===a.LAYER?l.layerVisibilityChangedEventToken=l.app.event("LayerVisibilityChangedEvent").subscribe(l,l.onLayerVisibilityChanged):l.mapServiceVisibilityChangedEvent=l.app.event("MapServiceVisibilityChangedEvent").subscribe(l,l.onMapServiceVisibilityChanged),l}return __extends(r,e),r.prototype.unsubscibeFromEvents=function(){String.isNullOrEmpty(this.mapZoomEndedEventToken)||this.app.event("MapZoomEndedEvent").unsubscribe(this.mapZoomEndedEventToken),String.isNullOrEmpty(this.layerVisibilityChangedEventToken)||this.app.event("LayerVisibilityChangedEvent").unsubscribe(this.layerVisibilityChangedEventToken),String.isNullOrEmpty(this.mapServiceVisibilityChangedEvent)||this.app.event("MapServiceVisibilityChangedEvent").unsubscribe(this.mapServiceVisibilityChangedEvent)},r.prototype.populateChildren=function(){var e=this,t=this.app.map.getLayer(this.serviceLayer.id);t.dynamicLayerInfos&&t.dynamicLayerInfos.length||(t.setDynamicLayerInfos(t.createDynamicLayerInfosFromLayerInfos(),!0),t.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(this.mapService),!1)),this.dynamicLayerInfos=t.dynamicLayerInfos.slice(),t.dynamicLayerInfos.forEach(function(t){for(var i=0;i<e.mapService.layers.length;i++)if(t.id.toString()===e.mapService.layers[i].id&&e.mapService.layers[i].type!==s.LayerType.GROUP_LAYER){var n=1==e.owner.layerListLayerItems.filter(function(r){return r.mapService.id===e.mapService.id&&r.layer.id===e.mapService.layers[i].id}).length,o={serviceLayer:e.serviceLayer,mapService:e.mapService,type:a.LAYER,displayName:e.mapService.layers[i].displayName,clusterLayer:null,gcxLayer:e.mapService.layers[i],parent:e,isInLayerList:n},l=new r(e.app,e.libraryId,e.owner,o);e.layerDrawItems.addItem(l);break}})},r.prototype.onLayerVisibilityChanged=function(e){var r=this;e.forEach(function(e){e.mapService===r.mapService&&e.layer===r.gcxLayer&&(r.isVisibilityToggledOn.set(r.gcxLayer.isVisible()),r.isWithinScale.set(r.isWithinScale.get()||!r.isVisibilityToggledOn.get()))})},r.prototype.onMapServiceVisibilityChanged=function(e,r){this.serviceLayer===e&&this.mapService===r&&(this.isVisibilityToggledOn.set(e.visible),this.isWithinScale.set(this.isWithinScale.get()||!this.isVisibilityToggledOn.get()))},r.prototype.onMapZoomEnded=function(e,r,t,i){var n=this.type===a.LAYER?this.gcxLayer.withinScaleRange(null):this.serviceLayer.isVisibleAtScale(this.app.map.getScale());this.isWithinScale.set(!this.isVisibilityToggledOn.get()||n)},r}(t.ViewModelBase);r.DrawOrderItem=o})},"Mapping/modules/LayerDrawingOrder/DrawOrderItemConstants":function(){define(["require","exports"],function(e,r){"use strict";r.SERVICE_LAYER="service_layer",r.LAYER="layer",r.GRAPHIC="graphic",r.UP=0,r.DOWN=1})},"Mapping/modules/LayerDrawingOrder/LayerDrawingOrderModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/validation/NumberValidator"],function(e,r,t,i){"use strict";var a=function(e){function r(r,t){return e.call(this,r,t)||this}return __extends(r,e),r.prototype.initialize=function(r){e.prototype.initialize.call(this,r),this._config=r},r.prototype.getStateFilter=function(){var e=new i.NumberValidator;return{graphicsLayerTransforms:{item:{layerId:!0,topLayer:!0,bottomLayer:!0,relativePosition:e}},serviceTransforms:{item:{layerId:!0,topLayer:!0,bottomLayer:!0,relativePosition:e}}}},r.prototype.applyState=function(e){var r=this;return this.app.event("ProjectLoadedEvent").once(this,function(){r.app.command("_ApplyLayerDrawingOrderState").execute(e)}),Promise.resolve()},r.prototype.exportState=function(){var e=this,r={graphicsLayerTransforms:[],serviceTransforms:[]};return Promise["try"](function(){return e.app.command("_PopulateLayerDrawingOrderState").execute(r),r})},r}(t.ModuleBase);r.LayerDrawingOrderModule=a})},"Mapping/modules/LayerDrawingOrder/LayerDrawingOrderViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./DrawOrderItem","./Dialogs/LayerGroupsDialogViewModel","./Dialogs/OrderServicesDialogViewModel","./Dialogs/OrderLayersDialogViewModel","./DrawOrderItemConstants","geocortex/infrastructure/Dictionary","geocortex/infrastructure/layerList/LayerListItem","geocortex/essentials/LayerType","geocortex/essentials/MapServiceConstants"],function(e,r,t,i,a,n,s,o,l,d,p,c,y){"use strict";var u=function(e){function r(r,t){var a=e.call(this,r,t)||this;return a.movedServices=[],a.movedGraphicsLayers=[],a.app=r,a.canUpdateLayerDrawingOrderLayers=new i.Observable((!1)),a.graphicsLayerDrawItems=new i.ObservableCollection,a.serviceLayerDrawItems=new i.ObservableCollection,a.layerReference=new d.Dictionary,a.layerListGraphicsLayerItems=[],a.layerListLayerItems=[],a.layerListMapServiceItems=[],a.layerGroupsVM=new n.LayerGroupsDialogViewModel(a,a.app,a.libraryId),a.orderServicesVM=new s.OrderServicesDialogViewModel(a,a.app,a.libraryId),a.orderLayersVM=new o.OrderLayersDialogViewModel(a,a.app,a.libraryId),a}return __extends(r,e),r.prototype.initialize=function(){var e=this;this._subscribeEvents(),this._registerCommands(),this.app.event("LayerListInitializedEvent").once(this,function(r){e.layerList=r,e._getAllLayerListLayersAndMapServices(e.layerList.children)})},r.prototype._subscribeEvents=function(){var e=this;this.app.event("LayerAddedEvent").subscribe(this,this._recordAddedLayer),this.app.event("ClusterLayerAddedEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor),this.app.event("ClusterLayerRemovedEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor),this.app.event("SiteInitializedEvent").subscribe(this,function(){return e.canUpdateLayerDrawingOrderLayers.set(!0)}),this.app.event("SiteServiceLayersFailedEvent").subscribe(this,function(){return e.canUpdateLayerDrawingOrderLayers.set(!0)}),this.app.event("MapServiceLayersChangedWithResultEvent").subscribe(this,this.updateLayerDrawingOrderLayersMonitor)},r.prototype._registerCommands=function(){this.app.command("RemoveUserAddedLayer").register(this,this._recordRemovedLayer),this.app.command("RemoveMapService").register(this,this._recordRemovedMapService),this.app.command("ClearLayerCatalogLayers").register(this,this._recordClearedLayerCatalogLayers),this.app.command("OpenLayerDrawingOrderGroups").register(this,this._updateLayerDrawingOrderLayers),this.app.command("_ApplyLayerDrawingOrderState").register(this,this._applyState),this.app.command("_PopulateLayerDrawingOrderState").register(this,this._exportState)},r.prototype._recordAddedLayer=function(e,r){r.isUserCreated&&e instanceof esri.layers.GraphicsLayer&&this._reorderUserAddedLayers(e,r),this.layerReference.containsKey(e.id)&&this.layerReference.remove(e.id),this.layerReference.set(e.id,r),this.updateLayerDrawingOrderLayersMonitor()},r.prototype._recordRemovedLayer=function(e){this.layerReference.containsKey(e.mapService.serviceLayer.id)&&this.layerReference.remove(e.mapService.serviceLayer.id),this.updateLayerDrawingOrderLayersMonitor()},r.prototype._recordRemovedMapService=function(e){this.layerReference.containsKey(e.serviceLayer.id)&&this.layerReference.remove(e.serviceLayer.id),this.updateLayerDrawingOrderLayersMonitor()},r.prototype._recordClearedLayerCatalogLayers=function(){for(var e=this.layerReference.keys,r=0;r<e.length;r++)this.layerReference.get(e[r]).catalogId&&this.layerReference.remove(e[r]);this.updateLayerDrawingOrderLayersMonitor()},r.prototype._reorderUserAddedLayers=function(e,r){var t=this.graphicsLayerDrawItems.getLength()?this.app.map.graphicsLayerIds.indexOf(this.graphicsLayerDrawItems.getAt(0).serviceLayer.id)+1:0;this.app.map.reorderLayer(e,t)},r.prototype.updateLayerDrawingOrderLayersMonitor=function(){var e=this;this.canUpdateLayerDrawingOrderLayers.get()&&(this.canUpdateLayerDrawingOrderLayers.set(!1),setTimeout(function(){e._updateLayerDrawingOrderLayers(),e.canUpdateLayerDrawingOrderLayers.set(!0)},750))},r.prototype._updateLayerDrawingOrderLayers=function(){var e=this;this.serviceLayerDrawItems.get().forEach(function(e){e.unsubscibeFromEvents()}),this.graphicsLayerDrawItems.get().forEach(function(e){e.unsubscibeFromEvents()}),this.serviceLayerDrawItems.clear(),this.graphicsLayerDrawItems.clear(),this.app.map.graphicsLayerIds.forEach(function(r){var t=e.app.map.getLayer(r);if(e.layerReference.containsKey(r)){var i=e.app.map.getLayer(t.id+"-cluster"),n=e.layerListGraphicsLayerItems.filter(function(i){return i.mapService.id==e.layerReference.get(r).id&&i.layer.id==t.layerId}),s={serviceLayer:t,mapService:e.layerReference.get(r),type:l.GRAPHIC,displayName:e.layerReference.get(r).displayName,clusterLayer:i,gcxLayer:null,parent:null,isInLayerList:1==n.length},o=new a.DrawOrderItem(e.app,e.libraryId,e,s);e.graphicsLayerDrawItems.insertItem(0,o)}}),this.graphicsLayerDrawItems.get().forEach(function(r){r.clusterLayer&&e.app.map.reorderLayer(r.clusterLayer,e.app.map.graphicsLayerIds.indexOf(r.serviceLayer.id))}),this.app.map.layerIds.forEach(function(r){var t=e.app.map.getLayer(r);if(e.layerReference.containsKey(t.id)){var i=e.layerReference.get(t.id);if(i.mapServiceFunction!==y.MapServiceFunction.BASE||i.isUserCreated){var n={serviceLayer:t,mapService:i,type:l.SERVICE_LAYER,displayName:i.displayName,clusterLayer:null,gcxLayer:null,parent:null,isInLayerList:1==e.layerListMapServiceItems.filter(function(e){return e.mapService.id===i.id}).length},s=new a.DrawOrderItem(e.app,e.libraryId,e,n);e.serviceLayerDrawItems.insertItem(0,s)}}}),this.refreshPanels()},r.prototype.refreshPanels=function(){if(this.orderLayersVM.layers.getLength()){var e=this.orderLayersVM.layers.getAt(0);if(e.type===l.GRAPHIC)this.orderLayersVM.reset(),this.orderLayersVM.populateLayers();else if(e.type===l.LAYER){this.orderLayersVM.reset();var r=this.serviceLayerDrawItems.get().filter(function(r){return r.serviceLayer.id===e.serviceLayer.id});1==r.length&&this.orderLayersVM.populateLayers(r[0])}this.orderLayersVM.layers.pulse()}this.orderServicesVM.reset(),this.orderServicesVM.populateLayers(),this.orderServicesVM.layers.pulse(),this.layerGroupsVM.reset(),this.layerGroupsVM.populateLayerGroups(),this.orderServicesVM.currentDrawOrder=this.app.map.layerIds.slice(),this.orderLayersVM.currentDrawOrder=this.app.map.graphicsLayerIds.slice(),this.app.event("LayerDrawingOrderPanelRefreshedEvent").publish()},r.prototype._getAllLayerListLayersAndMapServices=function(e){for(var r=0;r<e.getLength();r++){var t=e.getAt(r);t.type===p.LayerListItemType.FOLDER?this._getAllLayerListLayersAndMapServices(t.children):t.type===p.LayerListItemType.LAYER?this.layerListLayerItems.push(t):t.type===p.LayerListItemType.GRAPHICSLAYER?this.layerListGraphicsLayerItems.push(t):t.type===p.LayerListItemType.MAPSERVICE&&this.layerListMapServiceItems.push(t)}},r.prototype.getDynamicMapServiceVisibleLayers=function(e){var r=[];return e.layers.forEach(function(e){e.isVisible()&&e.type!==c.LayerType.GROUP_LAYER&&r.push(e.id)}),r.length||r.push("-1"),r},r.prototype._exportState=function(e){e.serviceTransforms=this._createLayerTransforms(this.movedServices,this.app.map.layerIds),e.graphicsLayerTransforms=this._createLayerTransforms(this.movedGraphicsLayers,this.app.map.graphicsLayerIds)},r.prototype._createLayerTransforms=function(e,r){var t=this;return e.map(function(e){var i=t.app.map.getLayer(e);if(i){var a=r.indexOf(e),n=a/(r.length-1),s=a<r.length?r[a+1]:null,o=a>0?r[a-1]:null;return{layerId:e,topLayer:s,bottomLayer:o,relativePosition:n}}}).sort(function(e,r){return e.relativePosition<r.relativePosition?-1:e.relativePosition>r.relativePosition?1:0})},r.prototype._applyState=function(e){var r=this;this.movedServices=[],this.movedGraphicsLayers=[];var t=e.serviceTransforms.filter(function(e){return r.app.map.layerIds.indexOf(e.layerId)>-1}),i=e.graphicsLayerTransforms.filter(function(e){return r.app.map.graphicsLayerIds.indexOf(e.layerId)>-1});(t.length>0||i.length>0)&&Promise.each([function(){return r._applyLayerTransforms(t,function(){return r.app.map.layerIds},r.movedServices)},function(){return r._applyLayerTransforms(i,function(){return r.app.map.graphicsLayerIds.filter(function(e){return e.indexOf("-explodedClusterLayer")===-1})},r.movedGraphicsLayers)}],function(e){return e()}).then(function(){r.updateLayerDrawingOrderLayersMonitor();var e=r.app.map.on("update-end",function(){r.app.map.setExtent(r.app.map.extent),e.remove()})})},r.prototype._applyLayerTransforms=function(e,r,t,i,a){var n=this;void 0===i&&(i=function(e,r){n.app.map.reorderLayer(e,r)}),void 0===a&&(a=function(e){return n.app.map.getLayer(e)});var s=e.map(function(e){return e.layerId});if(0===s.length)return Promise.resolve();t&&t.push.apply(t,s);var o=function(e){var r=s.indexOf(e);r>-1&&s.splice(r,1)};return Promise.each(e,function(e){return new Promise(function(t,l){var d=r().indexOf(e.layerId),p=n.app.map.on("layer-reorder",function(){p.remove(),t()}),c=r().indexOf(e.bottomLayer),y=r().indexOf(e.topLayer);c>-1&&s.indexOf(e.bottomLayer)===-1?(o(e.layerId),d-c!==1?i(a(e.layerId),c+(d>c?1:0)):(p.remove(),t())):y>-1&&s.indexOf(e.topLayer)===-1?(o(e.layerId),y-d!==1?i(a(e.layerId),y+(d<y?-1:0)):(p.remove(),t())):(p.remove(),t())})}).then(function(){if(0!==s.length&&s.length!==e.length)return n._applyLayerTransforms(e.filter(function(e){return s.indexOf(e.layerId)>-1}),r,null,i,a);if(s.length>0){e=e.filter(function(e){return s.indexOf(e.layerId)>-1});var t=e.map(function(e){return r().indexOf(e.layerId)}).sort(function(e,r){return e-r});return Promise.each(e,function(s){return new Promise(function(o,l){var d=n.app.map.on("layer-reorder",function(){d.remove(),y&&p?(d=n.app.map.on("layer-reorder",function(){d.remove(),o()}),u()!==p?i(a(y),p):o()):o()}),p=r().indexOf(s.layerId),c=t[e.indexOf(s)],y=r()[c],u=function(){return r().indexOf(y)};p!==c?i(a(s.layerId),c):o()})})}return Promise.resolve()})},r.prototype.reset=function(){},r}(t.ViewModelBase);r.LayerDrawingOrderViewModel=u})},"Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView":function(){define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","./../DrawOrderItemConstants"],function(e,r,t,i){"use strict";var a=function(e){function r(r,t){var i=e.call(this,r,t)||this;return i.libraryId=null,i.app=r,i.libraryId=t,i.registerCommands(),i}return __extends(r,e),r.prototype.attach=function(r){e.prototype.attach.call(this,r)},r.prototype.registerCommands=function(){var e=this;this.app.command("OpenLayerDrawingOrderGroups").register(this,this.openPanel),this.app.command("CloseLayerDrawingOrderPanel").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},r.prototype.openPanel=function(){this.viewModel.layerGroupsVM.reset(),this.viewModel.layerGroupsVM.populateLayerGroups(),this.app.command("ActivateView").execute(this.id)},r.prototype.handleClickButtonNext=function(e,r,t){t.type===i.GRAPHIC?this.app.command("OpenLayerDrawingOrderLayers").execute():this.app.command("OpenLayerDrawingOrderServices").execute()},r.prototype.handleClickButtonCancel=function(){this.app.viewManager.deactivateView(this)},r}(t.WizardFragmentView);r.LayerGroupsDialogView=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./../DrawOrderGroupItem","./../DrawOrderItemConstants"],function(e,r,t,i,a,n){"use strict";var s=function(e){function r(r,t,a){var n=e.call(this,t,a)||this;return n.app=t,n.libraryId=a,n.owner=r,n.graphicsGroupExists=new i.Observable((!1)),n.servicesGroupExists=new i.Observable((!1)),n.showGroups=new i.Observable((!1)),n.groups=new i.ObservableCollection,n.graphicsGroupExists.bind(n,function(){return n.showGroups.set(n.graphicsGroupExists.get()||n.servicesGroupExists.get())}),n.servicesGroupExists.bind(n,function(){return n.showGroups.set(n.graphicsGroupExists.get()||n.servicesGroupExists.get())}),n}return __extends(r,e),r.prototype.populateLayerGroups=function(){if(this.hasGroups(),this.graphicsGroupExists.get()){var e=new a.DrawOrderGroupItem(this.getResource("language-layerDrawingOrder-graphics-group-title"),this.owner.graphicsLayerDrawItems.getLength(),n.GRAPHIC);this.groups.addItem(e)}if(this.servicesGroupExists.get()){var r=new a.DrawOrderGroupItem(this.getResource("language-layerDrawingOrder-services-group-title"),this.owner.serviceLayerDrawItems.getLength(),n.SERVICE_LAYER);this.groups.addItem(r)}},r.prototype.hasGroups=function(){return this.graphicsGroupExists.set(this.owner.graphicsLayerDrawItems.getLength()>0),this.servicesGroupExists.set(this.owner.serviceLayerDrawItems.getLength()>0),this.graphicsGroupExists.get()||this.servicesGroupExists.get()},r.prototype.reset=function(){this.groups.clear()},r}(t.ViewModelBase);r.LayerGroupsDialogViewModel=s})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderDialogView":function(){define(["require","exports","geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView","geocortex/framework/observables","./../DrawOrderItemConstants"],function(e,r,t,i,a){"use strict";var n=function(e){function r(r,t){var a=e.call(this,r,t)||this;return a.libraryId=null,a.openPanelCommandName=null,a.lastSelectionArrowUsed=null,a.app=r,a.libraryId=t,a.currentlySelectedElement=new i.Observable(null),a.registerCommands(),a.subscribeEvents(),a}return __extends(r,e),r.prototype.attach=function(r){e.prototype.attach.call(this,r);var t={handle:"button.reorder-list-dragHandle",axis:"y",cancel:".reorder-arrow-btns button",scrollSpeed:10};$(this.sortable).sortable(t),$(this.sortable).disableSelection(),$(this.sortable).bind("sortupdate",dojo.hitch(this,this.sortUpdate))},r.prototype.registerCommands=function(){var e=this;if(null===this.openPanelCommandName||void 0===this.openPanelCommandName){var r="this.openPanelCommandName",t="variable "+r+" NOT DEFINED. A derivative class should instantiate this variable",i=new Error(t);throw this.app.trace.error(t,i),i}this.app.command(this.openPanelCommandName).register(this,function(r){e.relatedViewModel.populateLayers(r),e.app.command("ActivateView").execute(e.id)}),this.app.command("CloseLayerDrawingOrderPanel").register(this,function(){e.isActive&&e.app.viewManager.deactivateView(e)})},r.prototype.subscribeEvents=function(){var e=this;this.app.event("LayerDrawingOrderPanelRefreshedEvent").subscribe(this,function(){e.isActive&&!e.relatedViewModel.layers.getLength()&&e.app.viewManager.deactivateView(e),e.currentlySelectedElement=new i.Observable(null),e.lastSelectionArrowUsed=null}),this.app.event("LayerDrawingOrderPanelOrderChangedEvent").subscribe(this,function(r,t){if(void 0!==r&&void 0!==t&&e.app.command("ScreenReaderNarrate").execute(r.displayName+" was moved to position "+(t+1)+" in the list"),null!==e.lastSelectionArrowUsed&&e.isActive){var i=document.querySelector("#"+e.currentlySelectedElement.get().uniqueId+" .reorder-arrow-"+(e.lastSelectionArrowUsed===a.UP?"up":"down"));null!==i?i.focus():e.app.trace.error("Could not find previously selected arrow to keyboard focus on")}})},r.prototype.sortUpdate=function(e,r){if(this.lastSelectionArrowUsed=null,!(this.relatedViewModel.layers.getLength()<2)){for(var t,i=r.item.attr("id"),a=-1,n=0;n<this.relatedViewModel.layers.getLength();n++){var s=this.relatedViewModel.layers.getAt(n);if(s.uniqueId===i){a=n,t=s;break}}if(t&&a>-1){var o=-1;r.item.parent().children().each(function(e,t){if(t===r.item.get(0))return o=e,!1}),o>-1&&this.relatedViewModel.moveElement(t,o-a)}}},r.prototype.handleClickButtonSelected=function(e,r,t){this.lastSelectionArrowUsed=null,this.currentlySelectedElement.get()&&t.uniqueId!==this.currentlySelectedElement.get().uniqueId&&this.currentlySelectedElement.get().isSelected.set(!1),t.isSelected.get()?(t.isSelected.set(!1),this.currentlySelectedElement.set(null)):(t.isSelected.set(!0),this.currentlySelectedElement.set(t))},r.prototype.handleClickButtonUp=function(e,r,t){this.lastSelectionArrowUsed=a.UP,this.relatedViewModel.moveElement(t,-1)},r.prototype.handleClickButtonDown=function(e,r,t){this.lastSelectionArrowUsed=a.DOWN,this.relatedViewModel.moveElement(t,1)},r.prototype.handleClickButtonReset=function(){this.relatedViewModel.resetDrawOrder()},r.prototype.handleClickButtonDone=function(){this.app.command("CloseLayerDrawingOrderPanel").execute()},r}(t.WizardFragmentView);r.OrderDialogView=n})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderDialogViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,r,t,i){"use strict";var a=function(e){function r(r,t,a){var n=e.call(this,t,a)||this;return n.app=t,n.libraryId=a,n.owner=r,n.layers=new i.ObservableCollection,n.hasLayers=new i.Observable((!1)),n.layers.bind(n,function(){return n.hasLayers.set(n.layers.getLength()>0)}),n.canReset=new i.Observable((!1)),n}return __extends(r,e),r.prototype.setFirstLastAndSelected=function(){this.layers.getLength()&&(this.layers.get().forEach(function(e){e.isFirstInList.set(!1),e.isLastInList.set(!1)}),this.layers.getAt(0).isFirstInList.set(!0),this.layers.getAt(this.layers.getLength()-1).isLastInList.set(!0))},r.prototype.reset=function(){this.layers.clear(),this.canReset.set(!1)},r}(t.ViewModelBase);r.OrderDialogViewModel=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView":function(){define(["require","exports","./OrderDialogView"],function(e,r,t){"use strict";var i=function(e){function r(r,t){return e.call(this,r,t)||this}return __extends(r,e),r.prototype.registerCommands=function(){this.openPanelCommandName="OpenLayerDrawingOrderLayers",e.prototype.registerCommands.call(this)},r.prototype.attach=function(r){e.prototype.attach.call(this,r),this.relatedViewModel=this.viewModel.orderLayersVM},r}(t.OrderDialogView);r.OrderLayersDialogView=i})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogViewModel":function(){define(["require","exports","./OrderDialogViewModel","./../DrawOrderItemConstants"],function(e,r,t,i){"use strict";var a=function(e){function r(r,t,i){return e.call(this,r,t,i)||this}return __extends(r,e),r.prototype.populateLayers=function(e){e?this.layers.set(e.layerDrawItems.get()):this.layers.set(this.owner.graphicsLayerDrawItems.get()),this.setFirstLastAndSelected()},r.prototype.moveElement=function(e,r){if(e.type===i.GRAPHIC){var t=this.moveGraphicsLayerUiElement(e,r);this.moveGraphicsLayer(e,r<0,t)}else{var t=this.moveDynamicLayerUiElement(e,r);this.moveDynamicLayer(e,r<0,t)}var a=this.getIndex(e);this.app.event("LayerDrawingOrderPanelOrderChangedEvent").publish(e,a)},r.prototype.getIndex=function(e){var r;if(e.type===i.GRAPHIC)r=this.owner.graphicsLayerDrawItems.indexOf(e);else{var t=e.parent,a=t.layerDrawItems.get().filter(function(r){return r.gcxLayer===e.gcxLayer});if(1==a.length){var n=a[0];r=t.layerDrawItems.indexOf(n)}else r=-1}return r===-1&&this.app.trace.error("LayerDrawingOrder Error: Could not find item "+e.displayName+" in collection of layers"),r},r.prototype.moveGraphicsLayerUiElement=function(e,r){var t=this.getIndex(e),i=t+r,a=this.owner.graphicsLayerDrawItems.getAt(i);return this.owner.graphicsLayerDrawItems.removeAt(t),this.owner.graphicsLayerDrawItems.insertItem(i,e),this.reset(),this.populateLayers(),a},r.prototype.moveDynamicLayerUiElement=function(e,r){var t=e.parent,i=t.layerDrawItems.get().filter(function(r){return r.gcxLayer===e.gcxLayer});if(1==i.length){var a=(i[0],this.getIndex(e)),n=a+r,s=t.layerDrawItems.getAt(n);return t.layerDrawItems.removeAt(a),t.layerDrawItems.insertItem(n,e),this.reset(),this.populateLayers(t),s}this.app.trace.error("LayerDrawingOrder Error: Could not find the dynamic layer "+e.displayName+" in collection of layers")},r.prototype.moveGraphicsLayer=function(e,r,t){var i=this.app.map.graphicsLayerIds.indexOf(e.serviceLayer.id);if(i>-1){var a,n=[this.app.map.graphicsLayerIds.indexOf(t.serviceLayer.id)];t.clusterLayer&&(n.push(this.app.map.graphicsLayerIds.indexOf(t.clusterLayer.id)),t.clusterLayer.isClusterExploded()&&n.push(this.app.map.graphicsLayerIds.indexOf(t.clusterLayer.singleFeatureLayer.id))),a=r?Math.max.apply(Math,n):Math.min.apply(Math,n),this.app.map.reorderLayer(e.serviceLayer,a),this.owner.movedGraphicsLayers.indexOf(e.serviceLayer.id)===-1&&this.owner.movedGraphicsLayers.push(e.serviceLayer.id),e.clusterLayer&&(r?this.app.map.reorderLayer(e.clusterLayer,a):this.app.map.reorderLayer(e.clusterLayer,a+1),this.owner.movedGraphicsLayers.indexOf(e.clusterLayer.id)===-1&&this.owner.movedGraphicsLayers.push(e.clusterLayer.id),e.clusterLayer.isClusterExploded()&&(r?this.app.map.reorderLayer(e.clusterLayer.singleFeatureLayer,a):this.app.map.reorderLayer(e.clusterLayer.singleFeatureLayer,a+1))),this.canReset.set(!0)}else console.log("LayerDrawingOrder Error: Could not find graphics layer on map.")},r.prototype.moveDynamicLayer=function(e,r,t){var i=this.app.map.layerIds.indexOf(e.serviceLayer.id);if(i>-1){var a=this.app.map.getLayer(this.app.map.layerIds[i]);a.dynamicLayerInfos&&a.dynamicLayerInfos.length||a.setDynamicLayerInfos(a.createDynamicLayerInfosFromLayerInfos(),!0);for(var n=0;n<a.dynamicLayerInfos.length;n++)if(a.dynamicLayerInfos[n].id.toString()===e.gcxLayer.id){var s=a.dynamicLayerInfos,o=s.filter(function(e){return e.id.toString()===t.gcxLayer.id});if(1==o.length){var l=s.indexOf(o[0]),d=s.splice(n,1);return s.splice(l,0,d[0]),a.setDynamicLayerInfos(s,!0),a.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(e.mapService),!0),a.refresh(),void this.canReset.set(!0)}}}else console.log("LayerDrawingOrder Error: Could not find service on map.")},r.prototype.resetDrawOrder=function(){this.layers.getLength()&&(this.layers.getAt(0).type===i.GRAPHIC?this.resetGraphicsLayerDrawingOrder():this.resetDynamicLayerDrawingOrder(),this.owner.updateLayerDrawingOrderLayersMonitor())},r.prototype.resetGraphicsLayerDrawingOrder=function(){for(var e=0;e<this.currentDrawOrder.length;e++)this.app.map.reorderLayer(this.app.map.getLayer(this.currentDrawOrder[e]),e)},r.prototype.resetDynamicLayerDrawingOrder=function(){var e=this.layers.getAt(0),r=this.owner.serviceLayerDrawItems.indexOf(e.parent),t=this.owner.serviceLayerDrawItems.getAt(r),i=this.app.map.layerIds.indexOf(t.serviceLayer.id);if(i>-1){var a=this.app.map.getLayer(this.app.map.layerIds[i]);a.setDynamicLayerInfos(t.dynamicLayerInfos,!0),a.setVisibleLayers(this.owner.getDynamicMapServiceVisibleLayers(t.mapService),!1)}else console.log("LayerDrawingOrder Error: Could not find service on map.")},r}(t.OrderDialogViewModel);r.OrderLayersDialogViewModel=a})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView":function(){define(["require","exports","./OrderDialogView"],function(e,r,t){"use strict";var i=function(e){function r(r,t){return e.call(this,r,t)||this}return __extends(r,e),r.prototype.registerCommands=function(){this.openPanelCommandName="OpenLayerDrawingOrderServices",e.prototype.registerCommands.call(this)},r.prototype.attach=function(r){e.prototype.attach.call(this,r),this.relatedViewModel=this.viewModel.orderServicesVM},r.prototype.handleClickButtonNext=function(e,r,t){this.app.command("OpenLayerDrawingOrderLayers").execute(t)},r}(t.OrderDialogView);r.OrderServicesDialogView=i})},"Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogViewModel":function(){define(["require","exports","./OrderDialogViewModel"],function(e,r,t){"use strict";var i=function(e){function r(r,t,i){return e.call(this,r,t,i)||this}return __extends(r,e),r.prototype.populateLayers=function(){this.layers.set(this.owner.serviceLayerDrawItems.get()),this.setFirstLastAndSelected()},r.prototype.moveElement=function(e,r){var t=this.moveServiceUiElement(e,r);this.moveService(e,t);var i=this.getIndex(e);this.app.event("LayerDrawingOrderPanelOrderChangedEvent").publish(e,i)},r.prototype.getIndex=function(e){var r=this.owner.serviceLayerDrawItems.indexOf(e);return r===-1&&this.app.trace.error("LayerDrawingOrder Error: Could not find item "+e.displayName+" in collection of services"),r},r.prototype.moveServiceUiElement=function(e,r){var t=this.getIndex(e),i=t+r;i>=this.owner.serviceLayerDrawItems.getLength()&&(i=this.owner.serviceLayerDrawItems.getLength()-1),i<0&&(i=0);var a=this.owner.serviceLayerDrawItems.getAt(i);return this.owner.serviceLayerDrawItems.removeAt(t),this.owner.serviceLayerDrawItems.insertItem(i,e),this.reset(),this.populateLayers(),a},r.prototype.moveService=function(e,r){var t=this.app.map.layerIds.indexOf(e.serviceLayer.id);if(t>-1){var i=this.app.map.layerIds.indexOf(r.serviceLayer.id);this.app.map.reorderLayer(e.serviceLayer,i),this.canReset.set(!0),this.owner.movedServices.indexOf(e.serviceLayer.id)===-1&&this.owner.movedServices.push(e.serviceLayer.id)}else console.log("LayerDrawingOrder Error: Could not find service on map.")},r.prototype.resetDrawOrder=function(){for(var e=0;e<this.currentDrawOrder.length;e++)this.app.map.reorderLayer(this.app.map.getLayer(this.currentDrawOrder[e]),e);this.owner.updateLayerDrawingOrderLayersMonitor()},r}(t.OrderDialogViewModel);r.OrderServicesDialogViewModel=i})},"url:/Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView.html":'<div class="reorderLayers" data-binding="{@source: layerGroupsVM}">\r\n    <div data-binding="{@template-for: layerGroupsVM}">\r\n        <div class="panel-group no-results box-container" data-binding="{@hidden: showGroups}">\r\n            <p data-binding="{@text: @language-layerDrawingOrder-noGroups}"></p>\r\n            <p class="description" data-binding="{@text: @language-layerDrawingOrder-noGroups-desc}"></p>\r\n        </div>\r\n        <div class="warning-label reorder-info" data-binding="{@visible: showGroups}{@text: @language-layerDrawingOrder-info}"></div>\r\n        <div class="panel-group" data-binding="{@visible: showGroups}">\r\n            <ul class="gcx-list-menu layer-groups-list" data-binding="{@source: groups}">\r\n                <li class="gcx-list-item reorder-list-item" data-binding="{@template-for: groups}">\r\n                    <button class="gcx-list-button icon-right chevron-right-24 reorder-list-button" data-binding="{@event-onclick: handleClickButtonNext}">\r\n                        <strong class="gcx-list-label" data-binding="{@text: title}"></strong>\r\n                    </button>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="form-item">\r\n            <div class="form-btns reorder-btns">\r\n                <button class="button" data-binding="{@event-onclick: handleClickButtonCancel}{@text: @language-layerDrawingOrder-button-cancel}"></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',
"url:/Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView.html":'<div class="reorderLayers" data-binding="{@source: orderLayersVM}">\r\n    <div data-binding="{@template-for: orderLayersVM}">\r\n        <div class="panel-group no-results box-container" data-binding="{@hidden: hasLayers}">\r\n            <p data-binding="{@text: @language-layerDrawingOrder-noLayers}"></p>\r\n            <p class="description" data-binding="{@text: @language-layerDrawingOrder-noLayers-desc}"></p>\r\n        </div>\r\n        <div class="panel-group">\r\n            <ul class="gcx-list-menu reorder-list" data-binding="{@source: layers}{@var: sortable}">\r\n                <li class="gcx-list-item reorder-list-item" data-binding="{@template-for: layers}{@class-selected: isSelected}{id: uniqueId}">\r\n                    <button class = "draggable reorder-list-dragHandle" tabindex="-1" data-binding="{@hidden: isSelected}"></button>\r\n                    <button class="gcx-list-button reorder-list-button" data-binding="{@event-onclick: handleClickButtonSelected}">\r\n                        <strong class="gcx-list-label" data-binding="{@text: displayName}"></strong>\r\n                        <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-custom-added}{@visible: isUserCreated}"></span>\r\n                        <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-not-in-layer-list}{@hidden: isInLayerList}"></span>\r\n                        <div class="meta-info" data-binding="{@hidden: isVisibilityToggledOn}">\r\n                            <img class="meta-info-icon" tabindex="-1" alt="" src="Resources/Images/Icons/not-visible-16.png" />\r\n                            <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-not-visible}"></span>\r\n                        </div>\r\n                        <div class="meta-info" data-binding="{@hidden: isWithinScale}">\r\n                            <img class="meta-info-icon" tabindex="-1" alt="" src="Resources/Images/Icons/visibility-24.png" />\r\n                            <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-not-within-scale}"></span>\r\n                        </div>\r\n                    </button>\r\n                    <span class="reorder-arrow-btns" data-binding="{@visible: isSelected}">\r\n                        <button class="reorder-arrow-up" aria-label="Move Layer Up" data-binding="{@event-onclick: handleClickButtonUp}{@disabled: isFirstInList}"></button>\r\n                        <button class="reorder-arrow-down" aria-label="Move Layer Down" data-binding="{@event-onclick: handleClickButtonDown}{@disabled: isLastInList}"></button>\r\n                    </span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="form-item">\r\n            <div class="form-btns reorder-btns">\r\n                <button class="button" data-binding="{@event-onclick: handleClickButtonDone}{@text: @language-layerDrawingOrder-button-done}"></button>\r\n                <button class="button" data-binding="{@event-onclick: handleClickButtonReset}{@text: @language-layerDrawingOrder-button-reset}{@enabled: canReset}"></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"url:/Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView.html":'<div class="reorderLayers" data-binding="{@source: orderServicesVM}">\r\n    <div data-binding="{@template-for: orderServicesVM}">\r\n        <div class="panel-group no-results box-container" data-binding="{@hidden: hasLayers}">\r\n            <p data-binding="{@text: @language-layerDrawingOrder-noServices}"></p>\r\n            <p class="description" data-binding="{@text: @language-layerDrawingOrder-noServices-desc}"></p>\r\n        </div>\r\n        <div class="panel-group">\r\n            <ul class="gcx-list-menu reorder-list" data-binding="{@source: layers}{@var: sortable}">\r\n                <li class="gcx-list-item reorder-list-item has-action-1" data-binding="{@template-for: layers}{@class-selected: isSelected}{id: uniqueId}">\r\n                    <button class = "draggable reorder-list-dragHandle" tabindex="-1" data-binding="{@hidden: isSelected}"></button>\r\n                    <button class="gcx-list-button reorder-list-button" data-binding="{@event-onclick: handleClickButtonSelected}">\r\n                        <strong class="gcx-list-label" data-binding="{@text: displayName}"></strong>\r\n                        <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-custom-added}{@visible: isUserCreated}"></span>\r\n                        <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-not-in-layer-list}{@hidden: isInLayerList}"></span>\r\n                        <div class="meta-info" data-binding="{@hidden: isVisibilityToggledOn}">\r\n                            <img class="meta-info-icon" tabindex="-1" alt="" src="Resources/Images/Icons/not-visible-16.png" />\r\n                            <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-not-visible}"></span>\r\n                        </div>\r\n                        <div class="meta-info" data-binding="{@hidden: isWithinScale}">\r\n  \r\n                            <img class="meta-info-icon" tabindex="-1" alt="" src="Resources/Images/Icons/visibility-24.png" />\r\n                            <span class="meta-info-text" data-binding="{@text: @language-layerDrawingOrder-not-within-scale}"></span>\r\n                        </div>\r\n                    </button>\r\n                    <button class="gcx-action-button icon chevron-right-24" data-binding="{@enabled: canDrillIn}{@event-onclick: handleClickButtonNext}"></button>\r\n                    <span class="reorder-arrow-btns" data-binding="{@visible: isSelected}">\r\n                        <button class="reorder-arrow-up" data-binding="{@event-onclick: handleClickButtonUp}{@disabled: isFirstInList}"></button>\r\n                        <button class="reorder-arrow-down" data-binding="{@event-onclick: handleClickButtonDown}{@disabled: isLastInList}"></button>\r\n                    </span>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="form-item">\r\n            <div class="form-btns reorder-btns">\r\n                <button class="button" data-binding="{@event-onclick: handleClickButtonDone}{@text: @language-layerDrawingOrder-button-done}"></button>\r\n                <button class="button" data-binding="{@event-onclick: handleClickButtonReset}{@text: @language-layerDrawingOrder-button-reset}{@enabled: canReset}"></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}}),define(["Mapping/modules/LayerDrawingOrder/DrawOrderGroupItem","Mapping/modules/LayerDrawingOrder/DrawOrderItem","Mapping/modules/LayerDrawingOrder/DrawOrderItemConstants","Mapping/modules/LayerDrawingOrder/LayerDrawingOrderModule","Mapping/modules/LayerDrawingOrder/LayerDrawingOrderViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/LayerGroupsDialogViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/OrderLayersDialogViewModel","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogView","Mapping/modules/LayerDrawingOrder/Dialogs/OrderServicesDialogViewModel"],function(e,r,t,i,a,n,s,o,l,d,p){shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.SERVICE_LAYER",t.SERVICE_LAYER),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LAYER",t.LAYER),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.GRAPHIC",t.GRAPHIC),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.UP",t.UP),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DOWN",t.DOWN),shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DrawOrderGroupItem",e.DrawOrderGroupItem),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.DrawOrderItem",r.DrawOrderItem),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerDrawingOrderModule",i.LayerDrawingOrderModule),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerDrawingOrderViewModel",a.LayerDrawingOrderViewModel),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerGroupsDialogView",n.LayerGroupsDialogView),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.LayerGroupsDialogViewModel",s.LayerGroupsDialogViewModel),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderLayersDialogView",o.OrderLayersDialogView),shim(l,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderLayersDialogViewModel",l.OrderLayersDialogViewModel),shim(d,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderServicesDialogView",d.OrderServicesDialogView),shim(p,"geocortex.essentialsHtmlViewer.mapping.modules.layerDrawingOrder.OrderServicesDialogViewModel",p.OrderServicesDialogViewModel)});