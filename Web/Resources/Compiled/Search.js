function shim(e,t,r){if("string"==typeof e&&(r=t,t=e),"undefined"==typeof r)return void console.warn("Undefined shim for: "+t);for(var a=t.split("."),i=null,s=window,n=0,o=a.length;n<o;n++)i=a[n],n==o-1?s[i]=r:s[i]||(s[i]={}),s=s[i]}require({cache:{"Mapping/modules/Search/ArcGisGeocodeSearchProvider":function(){define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/Feature","geocortex/essentials/RestHelperHTTPService"],function(e,t,r,a,i,s,n,o,c){"use strict";var h=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.SEARCH_TYPE="ArcGISGeocode",a.DEFAULT_ICONURI="Resources/Images/Icons/pin-blue-32.png",a.iconUri=null,a.locatorUrl=null,a.token=null,a.minimumScore=70,a.defaultZoomScale=8e3,a.singleLineField=null,a.parameters=[],a.globalSearchKey=null,a.intSearchUniqueId=0,a.currentSearchId=null,a._searchCancelState={},a._geocoder=null,a._offlineSwitchToken=null,a.name="ArcGIS Geocode",a.description="Search provider for the ArcGIS Geocode Service.",a.isEnabled=!0,a}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&t.url&&(this.locatorUrl=t.url),t&&t.iconUri&&(this.iconUri=t.iconUri),t&&t.defaultZoomScale&&(this.defaultZoomScale=t.defaultZoomScale),t&&t.singleLineField&&(this.singleLineField=t.singleLineField),t&&t.minimumScore&&(this.minimumScore=t.minimumScore),!this.singleLineField&&this.locatorUrl&&(this.app.site&&this.app.site.isInitialized?this._loadGeocodeDefinition():this.app.event("SiteInitializedEvent").once(this,this._loadGeocodeDefinition))},t.prototype._loadGeocodeDefinition=function(){var e=this;if(this.app.isOffline.get())return void(this._offlineSwitchToken=this.app.event("ApplicationOnlineEvent").subscribe(this,function(){e.app.event("ApplicationOnlineEvent").unsubscribe(e._offlineSwitchToken),e._loadGeocodeDefinition()}));if(!this.singleLineField&&this.locatorUrl){var t=this.locatorUrl+"?f=json"+(this.token?"&token="+encodeURIComponent(this.token):""),r=esri.request({url:t});r.then(function(t){t&&t.singleLineAddressField&&t.singleLineAddressField.name?e.singleLineField=t.singleLineAddressField.name:e.app.trace.error("ArcGIS geocode server does not support single address line query: '"+e.locatorUrl+"'.")},function(t){e.app.trace.error("Unable to retrieve geocode server information at: '"+e.locatorUrl+"': "+t.message)})}},t.prototype._getGeocoder=function(){if(!this._geocoder){var e=this.locatorUrl;this.token&&(e=c.RestHelperHTTPService.appendTokenToUrl(e,this.token)),this._geocoder=new esri.tasks.Locator(e),this.app&&this.app.map&&(this._geocoder.outSpatialReference=this.app.map.spatialReference)}return this._geocoder},t.prototype.updateToken=function(e){this.token=e,this._geocoder=null},t.prototype.search=function(e,t){var r=this,c=this.intSearchUniqueId++;this.currentSearchId=c,this._searchCancelState[c]=!1;var h=new a.SearchProgressEventArgs;h.results=e,h.error=null,h.searchType=this.SEARCH_TYPE,h.query=t,h.endpointUrl=this.locatorUrl;var u=function(){r.status=i.Status.IDLE};if(!e)return void this.app.trace.error("ArcGIS Geocode Search Provider: Cannot perform search without a feature set collection.");if(!t)return void this.app.trace.error("ArcGIS Geocode Search Provider: Cannot perform search without search text.");this.status=i.Status.SEARCHING,h.status=this.status,this.app.event("SearchProgress").publish(h),this.app.event("SearchProgressEvent").publish(h);var l,p=this._getGeocoder();if(this.globalSearchKey===this.singleLineField){var d={};d[this.singleLineField]=t,l={address:d}}else l={address:this._getMultiLineFields(t)};var g=parseInt(this.minimumScore);!isNaN(g)&&(g<0||g>100)&&(g=null),p.addressToLocations(l).then(function(t){if(!r._searchCancelState[c]&&t.length>0){var a=new esri.tasks.FeatureSet;a.displayFieldName="address",a.geometryType="esriGeometryPoint",t[0].spatialReference&&(a.spatialReference=t[0].spatialReference);var i=new s.FeatureSet({app:r.app,esriFeatureSet:a});i.iconUri.set(r.iconUri?r.iconUri:r.DEFAULT_ICONURI),i.attributes.addItem(new n.FeatureAttribute("","address","address",r.app.getResource(r.libraryId,"language-search-arcgis-address"))),i.attributes.addItem(new n.FeatureAttribute("","score","score",r.app.getResource(r.libraryId,"language-search-arcgis-score"))),i.displayName.set(r.name),dojo.forEach(t,function(e){if(isNaN(g)||e.score>=g){var t={address:e.address,score:e.score},s=new esri.Graphic(e.location,null,t),n=new o.Feature({graphic:s});n.label.set(e.address),n.zoomScale.set(r.defaultZoomScale),n.description.set(r.app.getResource(r.libraryId,"language-search-geocoding-score-description")+e.score),a.features.push(s),i.addFeature(n,!0)}}),i.features.length()>0&&e.featureSets.addItem(i)}u(),r._searchCancelState[c]||(h.status=r.status,r.app.event("SearchProgress").publish(h),r.app.event("SearchProgressEvent").publish(h))},function(e){u(),r._searchCancelState[c]||(h.status=i.Status.ERROR,h.error=e,h.message=e.message,r.app.event("SearchProgress").publish(h),r.app.event("SearchProgressEvent").publish(h))})},t.prototype._getMultiLineFields=function(e){var t={};for(var r in this.parameters)this.parameters[r].name===this.globalSearchKey?t[this.parameters[r].name]=e:t[this.parameters[r].name]=this.parameters[r].value;return t},t.prototype.cancelSearch=function(){this.status===i.Status.SEARCHING&&(this._searchCancelState[this.currentSearchId]=!0)},t}(r.SearchProviderBase);t.ArcGisGeocodeSearchProvider=h})},"Mapping/modules/Search/BingGeocodeSearchProvider":function(){define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/Feature"],function(e,t,r,a,i,s,n,o){"use strict";var c=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.SEARCH_TYPE="BingGeocode",a.DEFAULT_ICONURI="Resources/Images/Icons/pin-red-32.png",a.iconUri=null,a.bingMapsKey=null,a.culture=null,a.libraryId=void 0,a.intSearchUniqueId=0,a.currentSearchId=null,a._searchCancelState={},a._bingGeocoder=null,a.name="Bing Geocode",a.description="Search provider for the Bing Geocode Service.",a.isEnabled=!0,a}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&t.bingMapsKey&&(this.bingMapsKey=t.bingMapsKey),t&&t.culture?this.culture=t.culture:!this.culture&&this.app.locale?this.culture=this.app.locale:this.culture="en-US",t&&t.iconUri&&(this.iconUri=t.iconUri)},t.prototype._getGeocoder=function(){return this._bingGeocoder||(this._bingGeocoder=new esri.virtualearth.VEGeocoder({bingMapsKey:this.bingMapsKey,culture:this.culture})),this._bingGeocoder},t.prototype.search=function(e,t){var r=this,c=this.intSearchUniqueId++;this.currentSearchId=c,this._searchCancelState[c]=!1;var h=new a.SearchProgressEventArgs;h.results=e,h.error=null,h.message="",h.searchType=this.SEARCH_TYPE,h.query=t;var u=function(){r.status=i.Status.IDLE};if(!e)return void this.app.trace.error("Bing Geocode Search Provider: Cannot perform search without a feature set collection.");if(!t)return void this.app.trace.error("Bing Geocode Search Provider: Cannot perform search without search text.");this.status=i.Status.SEARCHING;var l=this._getGeocoder();l.addressToLocations(t).then(function(t){if(!r._searchCancelState[c]&&t.length>0){var a=new esri.tasks.FeatureSet;a.displayFieldName="formattedAddress",a.geometryType="esriGeometryPoint",t[0].spatialReference&&(a.spatialReference=t[0].spatialReference);var i=new s.FeatureSet({app:r.app,esriFeatureSet:a});i.iconUri.set(r.iconUri?r.iconUri:r.DEFAULT_ICONURI),i.attributes.addItem(new n.FeatureAttribute("","addressLine","addressLine",r.app.getResource(r.libraryId,"language-search-bing-address"))),i.attributes.addItem(new n.FeatureAttribute("","adminDistrict","adminDistrict",r.app.getResource(r.libraryId,"language-search-bing-admin-district"))),i.attributes.addItem(new n.FeatureAttribute("","countryRegion","countryRegion",r.app.getResource(r.libraryId,"language-search-bing-country"))),i.attributes.addItem(new n.FeatureAttribute("","district","district",r.app.getResource(r.libraryId,"language-search-bing-district"))),i.attributes.addItem(new n.FeatureAttribute("","formattedAddress","formattedAddress",r.app.getResource(r.libraryId,"language-search-bing-formatted"))),i.attributes.addItem(new n.FeatureAttribute("","locality","locality",r.app.getResource(r.libraryId,"language-search-bing-locality"))),i.attributes.addItem(new n.FeatureAttribute("","postalCode","postalCode",r.app.getResource(r.libraryId,"language-search-bing-postal-code"))),i.attributes.addItem(new n.FeatureAttribute("","postalTown","postalTown",r.app.getResource(r.libraryId,"language-search-bing-postal-town"))),i.displayName.set(r.name),dojo.forEach(t,function(e){var t=JSON.parse(JSON.stringify(e.address));delete t.declaredClass;var s=new esri.Graphic(esri.geometry.geographicToWebMercator(e.location),null,t),n=new o.Feature({graphic:s});n.label.set(e.address.formattedAddress),n.description.set(r.app.getResource(r.libraryId,"language-search-geocoding-score-description")+e.confidence),n.zoomExtent.set(esri.geometry.geographicToWebMercator(e.bestView)),a.features.push(s),i.addFeature(n,!0)}),e.featureSets.addItem(i)}u(),r._searchCancelState[c]||(h.status=r.status,r.app.event("SearchProgress").publish(h),r.app.event("SearchProgressEvent").publish(h))},function(e){if(u(),!r._searchCancelState[c]){var t="Bing Geocode error: "+e.message;h.status=i.Status.ERROR,h.error=e,h.message=t,r.app.trace.error(t),r.app.event("SearchProgress").publish(h),r.app.event("SearchProgressEvent").publish(h)}})},t.prototype.cancelSearch=function(){this.status===i.Status.SEARCHING&&(this._searchCancelState[this.currentSearchId]=!0)},t}(r.SearchProviderBase);t.BingGeocodeSearchProvider=c})},"Mapping/modules/Search/InstantSearchProvider":function(){define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/FormatUtils","geocortex/essentials/SearchQuery","geocortex/infrastructure/search/SearchHintItem","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature"],function(e,t,r,a,i,s,n,o,c,h,u,l){"use strict";var p=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.SEARCH_TYPE="InstantSearch",a.SEARCH_TYPE_HINTS="InstantSearchHints",a._canExecute=!1,a._cancelled=!1,a._intSearchUniqueID=0,a._fscSourceName="Search",a.enableSearchHints=!0,a.precedenceToNearbyResults=!0,a.maxResults=50,a.maxHints=5,a.name=a.app.getResource("Mapping","language-search-instant-provider-name"),a.description=a.app.getResource("Mapping","language-search-instant-provider-description"),a.isEnabled=!0,a.supportsHints=!0,a}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(t.hasOwnProperty("enableSearchHints")&&(this.enableSearchHints=t.enableSearchHints),t.hasOwnProperty("maxResults")&&(this.maxResults=parseInt(t.maxResults)),t.hasOwnProperty("maxHints")&&(this.maxHints=parseInt(t.maxHints)),t.hasOwnProperty("precedenceToNearbyResults")&&(this.precedenceToNearbyResults=t.precedenceToNearbyResults)),this.app.site&&this.app.site.isInitialized?this._onSiteInitialized(this.app.site):this.app.event("SiteInitializedEvent").once(this,this._onSiteInitialized)},t.prototype.canExecute=function(){return!!this._canExecute||(this.isEnabled=!1,!1)},t.prototype.cancelSearch=function(){if(!this._cancelled){this._cancelled=!0,this.status=a.Status.IDLE;var e=new i.SearchProgressEventArgs;e.status=a.Status.IDLE,e.message=this.app.getResource("Mapping","language-search-instant-provider-search-cancelled"),e.results=null,this._updateProgress(e)}},t.prototype.search=function(e,t){var r=this;if(this.canExecute()!==!1){this._cancelled=!1,t=t||"";var i=[n.NumberFormat.ACCOUNTING,n.NumberFormat.CURRENCY,n.NumberFormat.FIXED_POINT,n.NumberFormat.NUMBER,n.NumberFormat.PERCENT,n.NumberFormat.ROUND_TRIP],s=t.split(/\s+/).map(function(e){var t=o.parseNumber(e,i);return isNaN(t)?e:o.formatNumber(t,n.NumberFormat.ROUND_TRIP)});t=s.join(" ");var h=new c.SearchQuery;if(h.searchText=t,h.maxResults=this.maxResults,h.searchLayers=this._getSearchableLayers(),h.returnIdsOnly=!1,h.returnCountOnly=!1,h.returnHighlights=!1,h.returnGeometry=!0,h.contains=!0,h.outSpatialReference=this.app.map?this.app.map.spatialReference:null,0==h.searchLayers.length)return void this._onSearchError(new Error("No layers to search. Make sure you mark some layers as searchable in your site."),e,h);this.precedenceToNearbyResults&&this.app.map?h.extent=this.app.map.extent:h.extent=null,this.status=a.Status.SEARCHING,this.app.site.search(h,function(t){return r._onSearchBegin(t,e)},function(t){return r._onSearchCompleted(t,e,h)},function(t){return r._onSearchError(t,e,h)})}},t.prototype.getSearchHints=function(e,t){var r=this;if(this.canExecute()!==!1&&t&&""!=t.replace(/ /g,"")&&this.enableSearchHints){var a=++this._intSearchUniqueID,i=new c.SearchQuery;i.searchText=t,i.maxResults=this.maxHints,i.searchLayers=this._getSearchableLayers(),i.returnIdsOnly=!1,i.returnCountOnly=!1,i.returnGeometry=!1,i.returnHighlights=!0,i.contains=!0,i.outSpatialReference=this.app.map?this.app.map.spatialReference:null,this.precedenceToNearbyResults&&this.app.map?i.extent=this.app.map.extent:i.extent=null,this.app.site.search(i,function(e){r._onGetSearchHintsBegin(e,a)},function(t){r._onGetSearchHintsCompleted(t,e,i,a)},function(t){r._onGetSearchHintsError(t,e,i,a)})}},t.prototype._onSiteInitialized=function(e){this._checkCanExecute(e)},t.prototype._checkCanExecute=function(e){e&&e.getEssentialsVersion()>=4?this._canExecute=this._hasSearchableMapServices(e):(this._canExecute=!1,this.app.trace.warning(this.app.getResource("Mapping","language-search-instant-provider-not-available")))},t.prototype._hasSearchableMapServices=function(e){for(var t=0;t<e.essentialsMap.mapServices.length;t++)if(e.essentialsMap.mapServices[t].instantSearch)return!0;return!1},t.prototype._getSearchableLayers=function(){for(var e=this.app.site.essentialsMap.allLayersAndTables(),t=[],r=0;r<e.length;r++)e[r].searchable&&e[r].mapService&&e[r].mapService.instantSearch&&t.push(e[r]);return t},t.prototype._onSearchBegin=function(e,t){if(!this._cancelled){var r=new i.SearchProgressEventArgs;r.status=a.Status.SEARCHING,r.message=this.app.getResource("Mapping","language-search-instant-provider-search-started"),r.searchType=this.SEARCH_TYPE,r.query=e.searchText,this._updateProgress(r)}},t.prototype._onSearchCompleted=function(e,t,r){if(!this._cancelled&&(this.status=a.Status.IDLE,!e.error)){for(var s=this._createFeatureSetArray(e),n=0;n<s.length;n++)this._addFsToFsc(s[n],t);var o=new i.SearchProgressEventArgs;o.status=a.Status.IDLE,o.message=this.app.getResource("Mapping","language-search-instant-provider-search-completed"),o.results=t,o.searchType=this.SEARCH_TYPE,o.query=r.searchText,this._updateProgress(o)}},t.prototype._onSearchError=function(e,t,r){if(!this._cancelled){this.status=a.Status.IDLE;var s=new i.SearchProgressEventArgs;s.status=a.Status.ERROR,s.message=this.app.getResource("Mapping","language-search-error").format(e.message),s.results=t,s.searchType=this.SEARCH_TYPE,s.query=r.searchText,this._updateProgress(s)}},t.prototype._onGetSearchHintsBegin=function(e,t){var r=new i.SearchProgressEventArgs;r.status=a.Status.SEARCHING,r.message=this.app.getResource("Mapping","language-search-instant-provider-search-started"),r.searchType=this.SEARCH_TYPE_HINTS,r.query=e.searchText,this._updateProgress(r)},t.prototype._onGetSearchHintsCompleted=function(e,t,r,n){var o=this._createFeatureSetArray(e);if(n&&n===this._intSearchUniqueID){for(var c=[],u=!1,l=0;!u&&l<o.length;l++){var p=o[l];if(p)for(var d=0;!u&&d<p.features.getLength();d++){var g=p.features.getAt(d);if(g){var S=g.getExtendedPropertyByName("highlights");if(S)for(var f in S)if(S.hasOwnProperty(f)){var v=(S[f]+"").trim();u=c.length>=this.maxHints,u||c.indexOf(v)!=-1||c.push(v)}}}}t.addItems(c.map(function(e){return new h.SearchHintItem(e)}))}for(var m=new s.FeatureSetCollection,l=0;l<o.length;l++)this._addFsToFsc(o[l],m);var y=new i.SearchProgressEventArgs;y.status=a.Status.IDLE,y.message=this.app.getResource("Mapping","language-search-instant-provider-search-completed"),y.results=m,y.searchType=this.SEARCH_TYPE_HINTS,y.query=r.searchText,this._updateProgress(y)},t.prototype._onGetSearchHintsError=function(e,t,r,s){this.app.trace.warning("InstantSearchProvider: could not retrieve search hints.");var n=new i.SearchProgressEventArgs;n.status=a.Status.ERROR,n.message=this.app.getResource("Mapping","language-search-error").format(e.message),n.searchType=this.SEARCH_TYPE_HINTS,n.query=r.searchText,this._updateProgress(n)},t.prototype._updateProgress=function(e){this.app.event("SearchProgressEvent").publish(e)},t.prototype._createFeatureSetArray=function(e){var t=[];if(e&&!e.error)for(var r=0;r<e.results.length;r++){var a=e.results[r],i=new u.FeatureSet({esriFeatureSet:new esri.tasks.FeatureSet,layer:a.layer,app:this.app});dojo.forEach(a.features,function(e){var t=new l.Feature({graphic:e.esriFeature,layer:a.layer,resolveLayerFields:!0});e.highlights&&t.setExtendedProperty("highlights",e.highlights),i.addFeature(t,!0)}),t.push(i)}return t},t.prototype._addFsToFsc=function(e,t){var r=this;e&&e.esriFeatureSet&&0!=e.esriFeatureSet.features.length&&(e.resolveDataLinks(function(e){r.app.event("FeatureChangedEvent").publish(e)}),t.featureSets.addItem(e))},t}(r.SearchProviderBase);t.InstantSearchProvider=p})},"Mapping/modules/Search/LayerQuerySearchProvider":function(){define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/gis/LayerInfo","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/LayerIntegrationUtils","geocortex/infrastructure/FeatureSet","geocortex/essentials/MapServiceConstants"],function(e,t,r,a,i,s,n,o,c,h){"use strict";var u=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.SEARCH_TYPE="ArcGIS",a._cancelFunction=null,a.name="Query",a.description="Search provider for querying map servers or feature servers.",a.isEnabled=!0,a.supportsOffline=!0,a}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t)},t.prototype.search=function(e,t){var r=this;if(t=t.trim(),!e)return void this._handleError(new Error("Cannot perform search without a feature set collection."),e);if(!t)return void this._handleError(new Error("Cannot perform search without search text."),e);if(!this.app.site||!this.app.site.isInitialized)return void this._handleError(new Error("The site needs to be initialized before a search is performed."),e);this._cancelFunction&&this._cancelFunction();for(var c=!1,h=0;h<this.app.site.essentialsMap.mapServices.length;h++)if(this.app.site.essentialsMap.mapServices[h].instantSearch){c=!0;break}var u=this._getSearchableLayers();if(0==u.length)return void(c||this._handleWarning(new Error("No layers to search. Make sure you mark some layers as searchable in your site."),e,t));this.status=a.Status.SEARCHING;var l=!1,p=0,d=new i.SearchProgressEventArgs;d.results=e,d.error=null,d.message="",d.searchType=this.SEARCH_TYPE,d.query=t,d.status=this.status,this.app.event("SearchProgress").publish(d),this.app.event("SearchProgressEvent").publish(d);var g=function(t,i){l||(t.features.length>0&&r._addFsToFsc(t,i,e),p++,p===u.length?r.status=a.Status.IDLE:r.status=a.Status.SEARCHING,d.status=r.status,r.app.event("SearchProgress").publish(d),r.app.event("SearchProgressEvent").publish(d))},S=function(t,i){l||(p++,p===u.length&&(r.status=a.Status.IDLE),r._handleError(t,e,i.displayName))};this._cancelFunction=function(){l||(l=!0,r._cancelFunction=null,r.status=a.Status.IDLE)},u.forEach(function(e){var a=s.LayerInfo.fromGcxLayer(e);a.getFields().then(function(a){var i=n.getSearchTextWhereClause(e,a,t,r.app.trace);return i?void(e instanceof o.LocalLayer?r._searchLocalLayer(t,e,g,S):r._searchLayer(e,i,g,S)):void p++},function(t){S(t,e)})})},t.prototype._getSearchableLayers=function(){for(var e=this.app.site.essentialsMap.allLayersAndTables(),t=[],r=0;r<e.length;r++)e[r].mapService&&!e[r].mapService.instantSearch&&e[r].searchable&&this._layerTypeSupported(e[r])&&t.push(e[r]);return t},t.prototype._searchLayer=function(e,t,r,a){var i=new esri.tasks.Query;i.where=t,i.outFields=["*"],i.outSpatialReference=this.app.map.spatialReference,i.returnGeometry=!0;var s=n.getQueryTask(e);s.execute(i,function(t){r(t,e)},function(t){a(t,e)})},t.prototype._searchLocalLayer=function(e,t,r,a){try{var i=e.split(" ").map(function(e){return e.trim()}).filter(function(e){return!!e}).map(function(e){return new RegExp("\\b"+e+"\\b","i")}),s=t.mapService.serviceLayer,n=new esri.tasks.FeatureSet;e:for(var o=0;o<s.graphics.length;o++)for(var c=s.graphics[o],h=0,u=Object.keys(c.attributes);h<u.length;h++){var l=u[h],p=c.attributes[l];if(i.map(function(e){return e.test(p)}).every(function(e){return!!e})){n.features.push(c);continue e}}r(n,t)}catch(d){a(d,t)}},t.prototype._addFsToFsc=function(e,t,r){var a=this;if(e&&e.features&&e.features.length>0)for(var i=0;i<e.features.length;i++)t.mapService&&t.mapService.serviceLayer&&(e.features[i]._graphicsLayer=t.mapService.serviceLayer);var s=new c.FeatureSet({esriFeatureSet:e,layer:t,app:this.app});s.resolveDataLinks(function(e){a.app.event("FeatureChangedEvent").publish(e)}),r.featureSets.addItem(s)},t.prototype.cancelSearch=function(){this._cancelFunction&&this._cancelFunction()},t.prototype._layerTypeSupported=function(e){return!(!e||!e.mapService)&&(e.mapService.mapServiceType===h.MapServiceType.DYNAMIC||(e.mapService.mapServiceType===h.MapServiceType.TILED||(e.mapService.mapServiceType===h.MapServiceType.FEATURE||e.mapService.mapServiceType===h.MapServiceType.WMS)))},t.prototype._handleWarning=function(e,t,r,s){var n="Layer Search Provider"+(r?" ("+r+"): ":": ")+e.message,o=new i.SearchProgressEventArgs;o.results=t,o.status=a.Status.ERROR,o.error=e,o.message=n,o.searchType=this.SEARCH_TYPE,o.query=s,this.app.trace.warning(n),this.app.event("SearchProgress").publish(o),this.app.event("SearchProgressEvent").publish(o)},t.prototype._handleError=function(e,t,r,s){var n="Layer Search Provider"+(r?" ("+r+"): ":": ")+e.message,o=new i.SearchProgressEventArgs;o.results=t,o.status=a.Status.ERROR,o.error=e,o.message=n,o.searchType=this.SEARCH_TYPE,o.query=s,this.app.trace.error(n),this.app.event("SearchProgress").publish(o),this.app.event("SearchProgressEvent").publish(o)},t}(r.SearchProviderBase);t.LayerQuerySearchProvider=u})},"Mapping/modules/Search/SearchHintsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FocusUtils"],function(e,t,r,a){"use strict";var i=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.app.command("FocusOnSearchHint").register(i,function(e){e===dojo.keys.DOWN_ARROW||e===dojo.keys.NUMPAD_2?a.focus($(i.hintsList).find(".list-menu-button")[0]):e!==dojo.keys.UP_ARROW&&e!=dojo.keys.NUMPAD_8||a.focus($(i.hintsList).find(".list-menu-button")[$(i.hintsList).find(".list-menu-button").length-1])}),i}return __extends(t,e),t.prototype.attach=function(t){var r=this;e.prototype.attach.call(this,t),this.viewModel&&this.viewModel.expanded.bind(this,function(e){var t=e?"ActivateView":"DeactivateView";if(r.app.command(t).execute(r.id),e){r.app.event("FlyoutActivated").publish(r);var a={view:r,onOtherInteracted:function(e){return r._onOtherInteracted(e)}};r.app.command("TapToDismiss").execute(a)}else r.app.event("FlyoutDeactivated").publish(r)})},t.prototype.handleHintClick=function(e,t,r){r&&r.plainText.get()&&(this._hideAutoComplete(),this.viewModel.searchText.set(r.plainText.get()),this.app.command("GlobalSearch").execute(r.plainText.get()),this.app.event("SearchHintClickedEvent").publish(r))},t.prototype.handleRefineSearchClick=function(e,t,r){r&&r.plainText.get()&&(this._showAutoComplete(),this.viewModel.searchText.set(r.plainText.get()),this.viewModel.updateSearchHints(r.plainText.get()))},t.prototype.handleKeyDown=function(e,t,r){if($(document.activeElement).parent(".hints-list")&&[dojo.keys.DOWN_ARROW,dojo.keys.UP_ARROW,dojo.keys.NUMPAD_2,dojo.keys.NUMPAD_8].indexOf(e.keyCode)>-1){var i=$(this.hintsList).find(".list-menu-button"),s=0;for(s=0;s<i.length;s++){var n=i[s];if(n===document.activeElement)break}if(e.keyCode===dojo.keys.DOWN_ARROW||e.keyCode===dojo.keys.NUMPAD_2)return a.focus(i[++s]),!1;if(e.keyCode===dojo.keys.UP_ARROW||e.keyCode==dojo.keys.NUMPAD_8)return a.focus(i[--s]),!1}return!0},t.prototype._showAutoComplete=function(){this.viewModel.expanded.set(!0)},t.prototype._onOtherInteracted=function(e){this.viewModel.expanded.set(!1)},t.prototype._hideAutoComplete=function(){this.viewModel.expanded.set(!1)},t}(r.ViewBase);t.SearchHintsView=i})},"Mapping/modules/Search/SearchModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/essentials/GeocodingEndpoint","./BingGeocodeSearchProvider","geocortex/essentials/RestHelper","./ArcGisGeocodeSearchProvider"],function(e,t,r,a,i,s,n){"use strict";var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.autoLoadSiteGeocoders=!0,t}return __extends(t,e),t.prototype.initialize=function(e){e&&e.searchProviders&&this._loadProviders(e.searchProviders),e&&e.hasOwnProperty("autoLoadSiteGeocoders")&&0==e.autoLoadSiteGeocoders&&(this.autoLoadSiteGeocoders=!1),this.autoLoadSiteGeocoders&&(this.app.site&&this.app.site.isInitialized?this._loadGeocoders():this.app.event("SiteInitializedEvent").once(this,this._loadGeocoders))},t.prototype._loadProviders=function(e){for(var t=0;t<e.length;t++){var r=e[t];r&&(r.libraryId&&!this.app.allLibrariesLoaded?this._loadProviderWhenLibrariesDownloaded(r):this._loadProvider(r))}},t.prototype._loadProviderWhenLibrariesDownloaded=function(e){var t=this,r=this.app.event("ViewerLibrariesDownloadedEvent").subscribe(this,function(){t.app.event("ViewerLibrariesDownloadedEvent").unsubscribe(r),t._loadProvider(e)})},t.prototype._loadProvider=function(e){var t=e.type,r=dojo.getObject(t);if(r){var a=new r(this.app,e.libraryId||this.libraryId);a.initialize(e.configuration),e.hasOwnProperty("enable")&&(a.isEnabled=e.enable),e.hasOwnProperty("name")&&(a.name=e.name),e.hasOwnProperty("description")&&(a.description=e.description),this.app.command("RegisterSearchProvider").execute(a)}},t.prototype._loadGeocoders=function(){if(this.app.site&&this.app.site.isInitialized&&this.app.site.geocodingEndpoints&&this.app.site.geocodingEndpoints.length>0)for(var e=0;e<this.app.site.geocodingEndpoints.length;e++){var t=this.app.site.geocodingEndpoints[e];if(t.includeInGlobalSearch)if(t.geocoderType==a.GeocodingEndpointType.BING_GEOCODER){var r=new i.BingGeocodeSearchProvider(this.app,this.libraryId);r.libraryId=this.libraryId,r.name=t.displayName,r.iconUri=s.RestHelper.processClientSideTokens(this.app.site,t.iconUri),r.initialize({}),r.bingMapsKey=t.bingProperties.bingMapsKey,t.bingProperties.culture&&(r.culture=t.bingProperties.culture),this.app.command("RegisterSearchProvider").execute(r)}else if(t.geocoderType==a.GeocodingEndpointType.ARCGIS_GEOCODER){var o=new n.ArcGisGeocodeSearchProvider(this.app,this.libraryId);o.libraryId=this.libraryId,o.locatorUrl=t.geocoderUrl,o.token=t.geocoderToken,o.name=t.displayName,o.iconUri=s.RestHelper.processClientSideTokens(this.app.site,t.iconUri),t.featureZoomScale&&(o.defaultZoomScale=t.featureZoomScale),o.parameters=t.parameters,o.globalSearchKey=t.globalSearchKey,o.minimumScore=70,o.initialize({}),this.app.command("RegisterSearchProvider").execute(o),t.geocoderToken&&dojo.subscribe("ServiceTokenRefreshed",function(e){e.serviceUrl==o.locatorUrl&&o.updateToken(e.token)})}}},t}(r.ModuleBase);t.SearchModule=o})},"Mapping/modules/Search/SearchTableSearchProvider":function(){define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet"],function(e,t,r,a,i,s){"use strict";var n=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.SEARCH_TYPE="SearchTable",a._cancelFunction=null,a.name="Search Table",a.description="Search provider for Search Tables.",a.isEnabled=!0,a}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t)},t.prototype.search=function(e,t){var r=this,s=!1,n=0,o=new a.SearchProgressEventArgs;if(o.results=e,o.error=null,o.searchType=this.SEARCH_TYPE,o.query=t,this.status=i.Status.IDLE,o.status=this.status,!e)return void this.app.trace.error("Search Table Search Provider: Cannot perform search without a feature set collection.");if(!t)return void this.app.trace.error("Search Table Search Provider: Cannot perform search without search text.");var c=this._getSearchableTables();if(0==c.length)return void this.app.event("SearchProgressEvent").publish(o);this.status=i.Status.SEARCHING,o.status=this.status,this.app.event("SearchProgressEvent").publish(o);var h=function(t,a){s||(t.features.length>0&&r._addFsToFsc(t,a,e),n++,n===c.length?r.status=i.Status.IDLE:r.status=i.Status.SEARCHING,o.status=r.status,r.app.event("SearchProgressEvent").publish(o))},u=function(t,a){s||(n++,n===c.length&&(r.status=i.Status.IDLE),r._handleError(t,e,a.displayName))};c.forEach(function(e){for(var r={},a=0,i=e.parameters.length;a<i;a++){var s=e.parameters[a];r[s.name]=t}e.performSearch(r,function(t){return h(t,e)},function(t){return u(t,e)})}),this._cancelFunction=function(){s||(s=!0,r._cancelFunction=null,r.status=i.Status.IDLE)}},t.prototype._getSearchableTables=function(){for(var e=[],t=0,r=this.app.site.searchTables.length;t<r;t++){var a=this.app.site.searchTables[t];a.includeInGlobalSearch&&e.push(a)}return e},t.prototype._addFsToFsc=function(e,t,r){var a=new s.FeatureSet({esriFeatureSet:e,app:this.app});a.displayName.set(t.displayName),a.features.getItems().forEach(function(e){e.descriptionFormat.set(t.featureDescription),e.longDescriptionFormat.set(t.featureLongDescription),e.labelFormat.set(t.featureLabel),e.iconUri.set(t.iconUri),e.setExtendedProperty("SearchTableId",t.id)}),r.featureSets.addItem(a)},t.prototype.cancelSearch=function(){this._cancelFunction&&this._cancelFunction()},t.prototype._handleError=function(e,t,r,s){var n="Search Table Search Provider"+(r?" ("+r+"): ":": ")+e.message,o=new a.SearchProgressEventArgs;o.results=t,o.status=i.Status.ERROR,o.error=e,o.message=n,o.searchType=this.SEARCH_TYPE,o.query=s,this.app.trace.error(n),this.app.event("SearchProgressEvent").publish(o)},t}(r.SearchProviderBase);t.SearchTableSearchProvider=n})},"Mapping/modules/Search/SearchView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation","geocortex/infrastructure/FocusUtils"],function(e,t,r,a,i){"use strict";var s=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a._keyDownTimer=null,a}return __extends(t,e),t.prototype.attach=function(t){var r=this;if(e.prototype.attach.call(this,t),this.viewModel){var i=this.viewModel.minimumPopulateDelay;this._keyDownTimer=new a.TimeDelayedAction(i,this._requestSearchHints,this),this.app.event("FSMCollectionClosedEvent").subscribe(this,function(e){"SearchResultsCollection"===e.featureSetCollectionId&&($(r.inputElement).prop("disabled",!1),r.viewModel.searchDisabled=!1)}),this.app.event("SearchHintClickedEvent").subscribe(this,function(e){
return r._delayConsecutiveSearches()})}},t.prototype.handleKeyDown=function(e,t,r){var a=e.which?e.which:e.keyCode;if(this._isUpOrDownKey(a)&&0!==this.viewModel.searchHints.length()&&this.app.command("FocusOnSearchHint").execute(a),this._isSpecialChar(a))return!0;if(this._resetKeyDownTimer(a),a===dojo.keys.ENTER){if(this.viewModel.searchDisabled)return!0;this._hideAutoComplete(),this.app.command("GlobalSearch").execute(t.value),this._delayConsecutiveSearches(),e.preventDefault()}return!0},t.prototype.handleSearchClick=function(e,t,r){this._hideAutoComplete();var a=this.viewModel.searchText.get();a&&!this.viewModel.searchDisabled&&(this.app.command("GlobalSearch").execute(a),this._delayConsecutiveSearches())},t.prototype._delayConsecutiveSearches=function(){var e=this;this.viewModel.delayConsecutiveSearches&&($(this.inputElement).prop("disabled",!0),this.viewModel.searchDisabled=!0,setTimeout(function(){$(e.inputElement).prop("disabled",!1),e.viewModel.searchDisabled=!1},this.viewModel.consecutiveSearchDelay))},t.prototype.handleDoubleClick=function(){this._hideAutoComplete()},t.prototype._isSpecialChar=function(e){switch(e){case dojo.keys.TAB:case dojo.keys.SHIFT:case dojo.keys.CTRL:case dojo.keys.ALT:case dojo.keys.PAUSE:case dojo.keys.CAPS_LOCK:case dojo.keys.ESCAPE:case dojo.keys.PAGE_UP:case dojo.keys.PAGE_DOWN:case dojo.keys.END:case dojo.keys.HOME:case dojo.keys.LEFT_ARROW:case dojo.keys.UP_ARROW:case dojo.keys.RIGHT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.NUM_LOCK:case dojo.keys.SCROLL_LOCK:return!0}return!1},t.prototype._isUpOrDownKey=function(e){switch(e){case dojo.keys.UP_ARROW:case dojo.keys.DOWN_ARROW:return!0}return!1},t.prototype._resetKeyDownTimer=function(e){this._keyDownTimer.stop(),e!==dojo.keys.ENTER&&this._keyDownTimer.start()},t.prototype._requestSearchHints=function(){var e=this.viewModel,t=e.searchText.get();null===t||t.length<e.minimumPrefixLength||""==t.replace(/ /g,"")?(this._hideAutoComplete(),e.clearSearchHints()):(this._showAutoComplete(),e.updateSearchHints(t))},t.prototype._showAutoComplete=function(){this.viewModel.expanded.set(!0),i.focus(this.inputElement)},t.prototype._hideAutoComplete=function(){this.viewModel.expanded.set(!1)},t}(r.ViewBase);t.SearchView=s})},"Mapping/modules/Search/SearchViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,r,a){"use strict";var i=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.enableSearchRefinement=new a.Observable((!0)),i.minimumPopulateDelay=300,i.consecutiveSearchDelay=1e4,i.delayConsecutiveSearches=!1,i.minimumPrefixLength=3,i.searchText=new a.Observable(""),i.enableUI=new a.Observable((!1)),i.expanded=new a.Observable((!1)),i.searchDisabled=!1,i.searchHints=new a.ObservableCollection,i.app.site&&i.app.site.isInitialized?i._onSiteInitialized(i.app.site):i.app.event("SiteInitializedEvent").once(i,i._onSiteInitialized),i}return __extends(t,e),t.prototype.initialize=function(e){e&&e.hasOwnProperty("enableSearchRefinement")&&this.enableSearchRefinement.set(e.enableSearchRefinement),e&&e.hasOwnProperty("minimumPopulateDelay")&&(this.minimumPopulateDelay=parseInt(e.minimumPopulateDelay)),e&&e.hasOwnProperty("minimumPrefixLength")&&(this.minimumPrefixLength=parseInt(e.minimumPrefixLength)),e&&e.hasOwnProperty("consecutiveSearchDelay")&&(this.consecutiveSearchDelay=parseInt(e.consecutiveSearchDelay)),e&&e.hasOwnProperty("delayConsecutiveSearches")&&(this.delayConsecutiveSearches=e.delayConsecutiveSearches),this.app.command("EnableSearchRefinement").register(this,this._executeEnableSearchRefinementCommand)},t.prototype.clearSearchHints=function(){this.searchHints.clear()},t.prototype.updateSearchHints=function(e){this.clearSearchHints(),this.app.searchManager.getSearchHints(this.searchHints,e)},t.prototype._onSiteInitialized=function(e){this.enableUI.set(!0)},t.prototype._executeEnableSearchRefinementCommand=function(e){this.enableSearchRefinement.set(e||!1)},t}(r.ViewModelBase);t.SearchViewModel=i})},"url:/Mapping/modules/Search/SearchHintsView.html":'<div class="hints-list" data-binding="{@visible: searchHints}{@var: hintsList}{@event-keydown: handleKeyDown}">\r\n    <ul class="list-menu has-icon" data-binding="{@source: searchHints}{@noclass-refine-disabled: enableSearchRefinement}">\r\n        <li class="list-menu-item" data-binding="{@template-for: searchHints}">\r\n            <button class="content list-menu-button" data-binding="{@event-onclick: handleHintClick}">\r\n                <img class="list-menu-icon" data-binding="{@visible: iconUri}{src: iconUri}{alt: plainText}" src="Resources/Images/Icons/IconPlaceholder24x24.png" />\r\n                <span class="list-menu-details" data-binding="{innerHTML: safeText}{title: plainText}"></span>\r\n            </button>\r\n            <div class="refine-container">\r\n                <button class="refine-btn" data-binding="{@visible: searchHints}{@event-onclick: handleRefineSearchClick}{title: @language-search-refine}"></button>\r\n            </div>\r\n        </li>\r\n    </ul>\r\n</div>\r\n',"url:/Mapping/modules/Search/SearchView.html":'<div class="global-search" data-binding="{@visible: enableUI}">\r\n    <div class="search-box">\r\n        <!-- The id "gcx_search" is used to prevent a long press in the search box from bringing up the log view (GVH-3271) -->\r\n        <input type="text" id="gcx_search" data-binding="{@var: inputElement}{@value: searchText}{@event-keydown: handleKeyDown}{@event-dblclick: handleDoubleClick}{placeholder: @language-search-placeholder}{title: @language-search-search-prompt}" tabindex="0" />\r\n        <button class="search-button" data-binding="{@event-click: handleSearchClick}" tabindex="0"><span data-binding="{@text: @language-search-perform-global-search}" ></span></button>\r\n    </div>\r\n    <div class="region search-hints-region" data-region-name="SearchHintsRegion"></div>\r\n</div>\r\n'}}),define(["Mapping/modules/Search/ArcGisGeocodeSearchProvider","Mapping/modules/Search/BingGeocodeSearchProvider","Mapping/modules/Search/InstantSearchProvider","Mapping/modules/Search/LayerQuerySearchProvider","Mapping/modules/Search/SearchHintsView","Mapping/modules/Search/SearchModule","Mapping/modules/Search/SearchTableSearchProvider","Mapping/modules/Search/SearchView","Mapping/modules/Search/SearchViewModel"],function(e,t,r,a,i,s,n,o,c){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.search.ArcGisGeocodeSearchProvider",e.ArcGisGeocodeSearchProvider),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.search.BingGeocodeSearchProvider",t.BingGeocodeSearchProvider),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.search.InstantSearchProvider",r.InstantSearchProvider),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.search.LayerQuerySearchProvider",a.LayerQuerySearchProvider),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchHintsView",i.SearchHintsView),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchModule",s.SearchModule),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchTableSearchProvider",n.SearchTableSearchProvider),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchView",o.SearchView),shim(c,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchViewModel",c.SearchViewModel)});