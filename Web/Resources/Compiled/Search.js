!function(){function e(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var a=t.split("."),s=null,i=window,n=0,o=a.length;n<o;n++)s=a[n],n==o-1?i[s]=r:i[s]||(i[s]={}),i=i[s];else console.warn("Undefined shim for: "+t)}var t="<div class='hints-list' data-binding='{@visible: searchHints}{@var: hintsList}{@event-keydown: handleKeyDown}'>    <ul class='list-menu has-icon' data-binding='{@source: searchHints}{@noclass-refine-disabled: enableSearchRefinement}'>        <li class='list-menu-item' data-binding='{@template-for: searchHints}'>            <button class='content list-menu-button' data-binding='{@event-onclick: handleHintClick}'>                <img class='list-menu-icon' data-binding='{@visible: iconUri}{src: iconUri}{alt: plainText}' src='Resources/Images/Icons/IconPlaceholder24x24.png' />                <span class='list-menu-details' data-binding='{innerHTML: safeText}{title: plainText}'></span>            </button>            <div class='refine-container'>                <button class='refine-btn' data-binding='{@visible: searchHints}{@event-onclick: handleRefineSearchClick}{title: @language-search-refine}'></button>            </div>        </li>    </ul></div>",r="<div class='global-search' data-binding='{@visible: enableUI}'>    <div class='search-box'>        \x3c!-- The id 'gcx_search' is used to prevent a long press in the search box from bringing up the log view (GVH-3271) --\x3e        <input type='text' id='gcx_search' data-binding='{@var: inputElement}{@value: searchText}{@event-keydown: handleKeyDown}{@event-dblclick: handleDoubleClick}{placeholder: @language-search-placeholder}{title: @language-search-search-prompt}{aria-label: @language-search-search-prompt}' tabindex='0' />        <button class='search-button' data-binding='{@event-click: handleSearchClick}' tabindex='0'><span data-binding='{@text: @language-search-perform-global-search}' ></span></button>    </div>    <div class='region search-hints-region' data-region-name='SearchHintsRegion'></div></div>";require({cache:{"Mapping/modules/Search/ArcGisGeocodeSearchProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/Feature","geocortex/essentials/RestHelperHTTPService"],function(t,r,a,s,i,n,o,c,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.SEARCH_TYPE="ArcGISGeocode",a.DEFAULT_ICONURI="Resources/Images/Icons/pin-blue-32.png",a.iconUri=null,a.locatorUrl=null,a.token=null,a.minimumScore=70,a.defaultZoomScale=8e3,a.singleLineField=null,a.parameters=[],a.globalSearchKey=null,a.intSearchUniqueId=0,a.currentSearchId=null,a._searchCancelState={},a._geocoder=null,a._offlineSwitchToken=null,a.name="ArcGIS Geocode",a.description="Search provider for the ArcGIS Geocode Service.",a.isEnabled=!0,a}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&e.url&&(this.locatorUrl=e.url),e&&e.iconUri&&(this.iconUri=e.iconUri),e&&e.defaultZoomScale&&(this.defaultZoomScale=e.defaultZoomScale),e&&e.singleLineField&&(this.singleLineField=e.singleLineField),e&&e.minimumScore&&(this.minimumScore=e.minimumScore),!this.singleLineField&&this.locatorUrl&&(this.app.site&&this.app.site.isInitialized?this._loadGeocodeDefinition():this.app.event("SiteInitializedEvent").once(this,this._loadGeocodeDefinition))},r.prototype._loadGeocodeDefinition=function(){var e=this;if(this.app.isOffline.get())this._offlineSwitchToken=this.app.event("ApplicationOnlineEvent").subscribe(this,function(){e.app.event("ApplicationOnlineEvent").unsubscribe(e._offlineSwitchToken),e._loadGeocodeDefinition()});else if(!this.singleLineField&&this.locatorUrl){var t=this.locatorUrl+"?f=json"+(this.token?"&token="+encodeURIComponent(this.token):"");esri.request({url:t}).then(function(t){t&&t.singleLineAddressField&&t.singleLineAddressField.name?e.singleLineField=t.singleLineAddressField.name:e.app.trace.error("ArcGIS geocode server does not support single address line query: '"+e.locatorUrl+"'.")},function(t){e.app.trace.error("Unable to retrieve geocode server information at: '"+e.locatorUrl+"': "+t.message)})}},r.prototype._getGeocoder=function(){if(!this._geocoder){var e=this.locatorUrl;this.token&&(e=u.RestHelperHTTPService.appendTokenToUrl(e,this.token)),this._geocoder=new esri.tasks.Locator(e),this.app&&this.app.map&&(this._geocoder.outSpatialReference=this.app.map.spatialReference)}return this._geocoder},r.prototype.updateToken=function(e){this.token=e,this._geocoder=null},r.prototype.search=function(e,t){var r=this,a=this.intSearchUniqueId++;this.currentSearchId=a,this._searchCancelState[a]=!1;var u=new s.SearchProgressEventArgs;u.results=e,u.error=null,u.searchType=this.SEARCH_TYPE,u.query=t,u.endpointUrl=this.locatorUrl;var l=function(){r.status=i.Status.IDLE};if(e)if(t){this.status=i.Status.SEARCHING,u.status=this.status,this.app.event("SearchProgress").publish(u),this.app.event("SearchProgressEvent").publish(u);var p,h=this._getGeocoder();if(this.globalSearchKey===this.singleLineField){var d={};d[this.singleLineField]=t,p={address:d}}else p={address:this._getMultiLineFields(t)};var g=parseInt(this.minimumScore);!isNaN(g)&&(g<0||g>100)&&(g=null),h.addressToLocations(p).then(function(t){if(!r._searchCancelState[a]&&t.length>0){var s=new esri.tasks.FeatureSet;s.displayFieldName="address",s.geometryType="esriGeometryPoint",t[0].spatialReference&&(s.spatialReference=t[0].spatialReference);var i=new n.FeatureSet({app:r.app,esriFeatureSet:s});i.iconUri.set(r.iconUri?r.iconUri:r.DEFAULT_ICONURI),i.attributes.addItem(new o.FeatureAttribute("","address","address",r.app.getResource(r.libraryId,"language-search-arcgis-address"))),i.attributes.addItem(new o.FeatureAttribute("","score","score",r.app.getResource(r.libraryId,"language-search-arcgis-score"))),i.displayName.set(r.name),dojo.forEach(t,function(e){if(isNaN(g)||e.score>=g){var t={address:e.address,score:e.score},a=new esri.Graphic(e.location,null,t),s=new c.Feature({graphic:a});s.label.set(e.address),s.zoomScale.set(r.defaultZoomScale),s.description.set(r.app.getResource(r.libraryId,"language-search-geocoding-score-description")+e.score),i.addFeature(s,!0)}}),i.features.length()>0&&e.featureSets.addItem(i)}l(),r._searchCancelState[a]||(u.status=r.status,r.app.event("SearchProgress").publish(u),r.app.event("SearchProgressEvent").publish(u))},function(e){l(),r._searchCancelState[a]||(u.status=i.Status.ERROR,u.error=e,u.message=e.message,r.app.event("SearchProgress").publish(u),r.app.event("SearchProgressEvent").publish(u))})}else this.app.trace.error("ArcGIS Geocode Search Provider: Cannot perform search without search text.");else this.app.trace.error("ArcGIS Geocode Search Provider: Cannot perform search without a feature set collection.")},r.prototype._getMultiLineFields=function(e){var t={};for(var r in this.parameters)this.parameters[r].name===this.globalSearchKey?t[this.parameters[r].name]=e:t[this.parameters[r].name]=this.parameters[r].value;return t},r.prototype.cancelSearch=function(){this.status===i.Status.SEARCHING&&(this._searchCancelState[this.currentSearchId]=!0)},r}(a.SearchProviderBase);r.ArcGisGeocodeSearchProvider=l})},"Mapping/modules/Search/BingGeocodeSearchProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/Feature"],function(t,r,a,s,i,n,o,c){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.SEARCH_TYPE="BingGeocode",a.DEFAULT_ICONURI="Resources/Images/Icons/pin-red-32.png",a.iconUri=null,a.bingMapsKey=null,a.culture=null,a.libraryId=void 0,a.intSearchUniqueId=0,a.currentSearchId=null,a._searchCancelState={},a._bingGeocoder=null,a.name="Bing Geocode",a.description="Search provider for the Bing Geocode Service.",a.isEnabled=!0,a}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&e.bingMapsKey&&(this.bingMapsKey=e.bingMapsKey),e&&e.culture?this.culture=e.culture:!this.culture&&this.app.locale?this.culture=this.app.locale:this.culture="en-US",e&&e.iconUri&&(this.iconUri=e.iconUri)},r.prototype._getGeocoder=function(){return this._bingGeocoder||(this._bingGeocoder=new esri.virtualearth.VEGeocoder({bingMapsKey:this.bingMapsKey,culture:this.culture})),this._bingGeocoder},r.prototype.search=function(e,t){var r=this,a=this.intSearchUniqueId++;this.currentSearchId=a,this._searchCancelState[a]=!1;var u=new s.SearchProgressEventArgs;u.results=e,u.error=null,u.message="",u.searchType=this.SEARCH_TYPE,u.query=t;var l=function(){r.status=i.Status.IDLE};e?t?(this.status=i.Status.SEARCHING,this._getGeocoder().addressToLocations(t).then(function(t){if(!r._searchCancelState[a]&&t.length>0){var s=new esri.tasks.FeatureSet;s.displayFieldName="formattedAddress",s.geometryType="esriGeometryPoint",t[0].spatialReference&&(s.spatialReference=t[0].spatialReference);var i=new n.FeatureSet({app:r.app,esriFeatureSet:s});i.iconUri.set(r.iconUri?r.iconUri:r.DEFAULT_ICONURI),i.attributes.addItem(new o.FeatureAttribute("","addressLine","addressLine",r.app.getResource(r.libraryId,"language-search-bing-address"))),i.attributes.addItem(new o.FeatureAttribute("","adminDistrict","adminDistrict",r.app.getResource(r.libraryId,"language-search-bing-admin-district"))),i.attributes.addItem(new o.FeatureAttribute("","countryRegion","countryRegion",r.app.getResource(r.libraryId,"language-search-bing-country"))),i.attributes.addItem(new o.FeatureAttribute("","district","district",r.app.getResource(r.libraryId,"language-search-bing-district"))),i.attributes.addItem(new o.FeatureAttribute("","formattedAddress","formattedAddress",r.app.getResource(r.libraryId,"language-search-bing-formatted"))),i.attributes.addItem(new o.FeatureAttribute("","locality","locality",r.app.getResource(r.libraryId,"language-search-bing-locality"))),i.attributes.addItem(new o.FeatureAttribute("","postalCode","postalCode",r.app.getResource(r.libraryId,"language-search-bing-postal-code"))),i.attributes.addItem(new o.FeatureAttribute("","postalTown","postalTown",r.app.getResource(r.libraryId,"language-search-bing-postal-town"))),i.displayName.set(r.name),dojo.forEach(t,function(e){var t=JSON.parse(JSON.stringify(e.address));delete t.declaredClass;var a=new esri.Graphic(esri.geometry.geographicToWebMercator(e.location),null,t),s=new c.Feature({graphic:a});s.label.set(e.address.formattedAddress),s.description.set(r.app.getResource(r.libraryId,"language-search-geocoding-score-description")+e.confidence),s.zoomExtent.set(esri.geometry.geographicToWebMercator(e.bestView)),i.addFeature(s,!0)}),e.featureSets.addItem(i)}l(),r._searchCancelState[a]||(u.status=r.status,r.app.event("SearchProgress").publish(u),r.app.event("SearchProgressEvent").publish(u))},function(e){if(l(),!r._searchCancelState[a]){var t="Bing Geocode error: "+e.message;u.status=i.Status.ERROR,u.error=e,u.message=t,r.app.trace.error(t),r.app.event("SearchProgress").publish(u),r.app.event("SearchProgressEvent").publish(u)}})):this.app.trace.error("Bing Geocode Search Provider: Cannot perform search without search text."):this.app.trace.error("Bing Geocode Search Provider: Cannot perform search without a feature set collection.")},r.prototype.cancelSearch=function(){this.status===i.Status.SEARCHING&&(this._searchCancelState[this.currentSearchId]=!0)},r}(a.SearchProviderBase);r.BingGeocodeSearchProvider=u})},"Mapping/modules/Search/InstantSearchProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/FormatUtils","geocortex/essentials/SearchQuery","geocortex/infrastructure/search/SearchHintItem","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature"],function(t,r,a,s,i,n,o,c,u,l,p,h){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var d=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.SEARCH_TYPE="InstantSearch",a.SEARCH_TYPE_HINTS="InstantSearchHints",a._canExecute=!1,a._cancelled=!1,a._intSearchUniqueID=0,a._fscSourceName="Search",a.enableSearchHints=!0,a.precedenceToNearbyResults=!0,a.maxResults=50,a.maxHints=5,a.name=a.app.getResource("Mapping","language-search-instant-provider-name"),a.description=a.app.getResource("Mapping","language-search-instant-provider-description"),a.isEnabled=!0,a.supportsHints=!0,a}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&(e.hasOwnProperty("enableSearchHints")&&(this.enableSearchHints=e.enableSearchHints),e.hasOwnProperty("maxResults")&&(this.maxResults=parseInt(e.maxResults)),e.hasOwnProperty("maxHints")&&(this.maxHints=parseInt(e.maxHints)),e.hasOwnProperty("precedenceToNearbyResults")&&(this.precedenceToNearbyResults=e.precedenceToNearbyResults)),this.app.site&&this.app.site.isInitialized?this._onSiteInitialized(this.app.site):this.app.event("SiteInitializedEvent").once(this,this._onSiteInitialized)},r.prototype.canExecute=function(){return!!this._canExecute||(this.isEnabled=!1,!1)},r.prototype.cancelSearch=function(){if(!this._cancelled){this._cancelled=!0,this.status=s.Status.IDLE;var e=new i.SearchProgressEventArgs;e.status=s.Status.IDLE,e.message=this.app.getResource("Mapping","language-search-instant-provider-search-cancelled"),e.results=null,this._updateProgress(e)}},r.prototype.search=function(e,t){var r=this;if(!1!==this.canExecute()){this._cancelled=!1,t=t||"";var a=[o.NumberFormat.ACCOUNTING,o.NumberFormat.CURRENCY,o.NumberFormat.FIXED_POINT,o.NumberFormat.NUMBER,o.NumberFormat.PERCENT,o.NumberFormat.ROUND_TRIP];t=t.split(/\s+/).map(function(e){var t=c.parseNumber(e,a);return isNaN(t)?e:c.formatNumber(t,o.NumberFormat.ROUND_TRIP)}).join(" ");var i=new u.SearchQuery;i.searchText=t,i.maxResults=this.maxResults,i.searchLayers=this._getSearchableLayers(),i.returnIdsOnly=!1,i.returnCountOnly=!1,i.returnHighlights=!1,i.returnGeometry=!0,i.contains=!0,i.outSpatialReference=this.app.map?this.app.map.spatialReference:null,0!=i.searchLayers.length?(this.precedenceToNearbyResults&&this.app.map?i.extent=this.app.map.extent:i.extent=null,this.status=s.Status.SEARCHING,this.app.site.search(i,function(t){return r._onSearchBegin(t,e)},function(t){return r._onSearchCompleted(t,e,i)},function(t){return r._onSearchError(t,e,i)})):this._onSearchError(new Error("No layers to search. Make sure you mark some layers as searchable in your site."),e,i)}},r.prototype.getSearchHints=function(e,t){var r=this;if(!1!==this.canExecute()&&t&&""!=t.replace(/ /g,"")&&this.enableSearchHints){var a=++this._intSearchUniqueID,s=new u.SearchQuery;s.searchText=t,s.maxResults=this.maxHints,s.searchLayers=this._getSearchableLayers(),s.returnIdsOnly=!1,s.returnCountOnly=!1,s.returnGeometry=!1,s.returnHighlights=!0,s.contains=!0,s.outSpatialReference=this.app.map?this.app.map.spatialReference:null,this.precedenceToNearbyResults&&this.app.map?s.extent=this.app.map.extent:s.extent=null,this.app.site.search(s,function(e){r._onGetSearchHintsBegin(e,a)},function(t){r._onGetSearchHintsCompleted(t,e,s,a)},function(t){r._onGetSearchHintsError(t,e,s,a)})}},r.prototype._onSiteInitialized=function(e){this._checkCanExecute(e)},r.prototype._checkCanExecute=function(e){e&&e.getEssentialsVersion()>=4?this._canExecute=this._hasSearchableMapServices(e):(this._canExecute=!1,this.app.trace.warning(this.app.getResource("Mapping","language-search-instant-provider-not-available")))},r.prototype._hasSearchableMapServices=function(e){for(var t=0;t<e.essentialsMap.mapServices.length;t++)if(e.essentialsMap.mapServices[t].instantSearch)return!0;return!1},r.prototype._getSearchableLayers=function(){for(var e=this.app.site.essentialsMap.allLayersAndTables(),t=[],r=0;r<e.length;r++)e[r].searchable&&e[r].mapService&&e[r].mapService.instantSearch&&t.push(e[r]);return t},r.prototype._onSearchBegin=function(e,t){if(!this._cancelled){var r=new i.SearchProgressEventArgs;r.status=s.Status.SEARCHING,r.message=this.app.getResource("Mapping","language-search-instant-provider-search-started"),r.searchType=this.SEARCH_TYPE,r.query=e.searchText,this._updateProgress(r)}},r.prototype._onSearchCompleted=function(e,t,r){if(!this._cancelled&&(this.status=s.Status.IDLE,!e.error)){for(var a=this._createFeatureSetArray(e),n=0;n<a.length;n++)this._addFsToFsc(a[n],t);var o=new i.SearchProgressEventArgs;o.status=s.Status.IDLE,o.message=this.app.getResource("Mapping","language-search-instant-provider-search-completed"),o.results=t,o.searchType=this.SEARCH_TYPE,o.query=r.searchText,this._updateProgress(o)}},r.prototype._onSearchError=function(e,t,r){if(!this._cancelled){this.status=s.Status.IDLE;var a=new i.SearchProgressEventArgs;a.status=s.Status.ERROR,a.message=this.app.getResource("Mapping","language-search-error").format(e.message),a.results=t,a.searchType=this.SEARCH_TYPE,a.query=r.searchText,this._updateProgress(a)}},r.prototype._onGetSearchHintsBegin=function(e,t){var r=new i.SearchProgressEventArgs;r.status=s.Status.SEARCHING,r.message=this.app.getResource("Mapping","language-search-instant-provider-search-started"),r.searchType=this.SEARCH_TYPE_HINTS,r.query=e.searchText,this._updateProgress(r)},r.prototype._onGetSearchHintsCompleted=function(e,t,r,a){var o=this._createFeatureSetArray(e);if(a&&a===this._intSearchUniqueID){for(var c=[],u=!1,p=0;!u&&p<o.length;p++){var h=o[p];if(h)for(var d=0;!u&&d<h.features.getLength();d++){var g=h.features.getAt(d);if(g){var m=g.getExtendedPropertyByName("highlights");if(m)for(var f in m)if(m.hasOwnProperty(f)){var b=(m[f]+"").trim();(u=c.length>=this.maxHints)||-1!=c.indexOf(b)||c.push(b)}}}}t.addItems(c.map(function(e){return new l.SearchHintItem(e)}))}for(var S=new n.FeatureSetCollection,p=0;p<o.length;p++)this._addFsToFsc(o[p],S);var v=new i.SearchProgressEventArgs;v.status=s.Status.IDLE,v.message=this.app.getResource("Mapping","language-search-instant-provider-search-completed"),v.results=S,v.searchType=this.SEARCH_TYPE_HINTS,v.query=r.searchText,this._updateProgress(v)},r.prototype._onGetSearchHintsError=function(e,t,r,a){this.app.trace.warning("InstantSearchProvider: could not retrieve search hints.");var n=new i.SearchProgressEventArgs;n.status=s.Status.ERROR,n.message=this.app.getResource("Mapping","language-search-error").format(e.message),n.searchType=this.SEARCH_TYPE_HINTS,n.query=r.searchText,this._updateProgress(n)},r.prototype._updateProgress=function(e){this.app.event("SearchProgressEvent").publish(e)},r.prototype._createFeatureSetArray=function(e){var t=[];if(e&&!e.error)for(var r=0;r<e.results.length;r++){var a=e.results[r],s=new p.FeatureSet({esriFeatureSet:new esri.tasks.FeatureSet,layer:a.layer,app:this.app});dojo.forEach(a.features,function(e){var t=new h.Feature({graphic:e.esriFeature,layer:a.layer,resolveLayerFields:!0});e.highlights&&t.setExtendedProperty("highlights",e.highlights),s.addFeature(t,!0)}),t.push(s)}return t},r.prototype._addFsToFsc=function(e,t){var r=this;e&&e.esriFeatureSet&&0!=e.esriFeatureSet.features.length&&(e.resolveDataLinks(function(e){r.app.event("FeatureChangedEvent").publish(e)}),t.featureSets.addItem(e))},r}(a.SearchProviderBase);r.InstantSearchProvider=d})},"Mapping/modules/Search/LayerQuerySearchProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/gis/LayerInfo","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/LayerIntegrationUtils","geocortex/infrastructure/FeatureSet","geocortex/essentials/MapServiceConstants"],function(t,r,a,s,i,n,o,c,u,l){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var p=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.SEARCH_TYPE="ArcGIS",a._cancelFunction=null,a._hasAddedToFsc=!1,a._fscAddsToProcess=[],a.name="Query",a.description="Search provider for querying map servers or feature servers.",a.isEnabled=!0,a.supportsOffline=!0,a}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e)},r.prototype.search=function(e,t){var r=this;if(t=t.trim(),e)if(t)if(this.app.site&&this.app.site.isInitialized){this._cancelFunction&&this._cancelFunction();for(var a=!1,u=0,l=this.app.site.essentialsMap.mapServices;u<l.length;u++)if(l[u].instantSearch){a=!0;break}var p=this._getSearchableLayers();if(0!==p.length){this.status=s.Status.SEARCHING;var h=!1,d=0,g=new i.SearchProgressEventArgs;g.results=e,g.error=null,g.message="",g.searchType=this.SEARCH_TYPE,g.query=t,g.status=this.status,this.app.event("SearchProgress").publish(g),this.app.event("SearchProgressEvent").publish(g);var m=function(t,a){h||a.getFeatureLayer().then(function(i){t.features.length>0&&r._addFsToFsc(t,a,i,e),++d===p.length?r.status=s.Status.IDLE:r.status=s.Status.SEARCHING,g.status=r.status,r.app.event("SearchProgress").publish(g),r.app.event("SearchProgressEvent").publish(g)})},f=function(t,a){h||(++d===p.length&&(r.status=s.Status.IDLE),r._handleError(t,e,a.displayName))};this._cancelFunction=function(){h||(h=!0,r._cancelFunction=null,r.status=s.Status.IDLE)},p.forEach(function(e){n.LayerInfo.fromGcxLayer(e).getFields().then(function(a){var s=o.getSearchTextWhereClause(e,a,t,r.app.trace);s?e instanceof c.LocalLayer?r._searchLocalLayer(t,e,m,f):r._searchLayer(e,s,m,f):d++},function(t){f(t,e)})})}else a||this._handleWarning(new Error("No layers to search. Make sure you mark some layers as searchable in your site."),e,t)}else this._handleError(new Error("The site needs to be initialized before a search is performed."),e);else this._handleError(new Error("Cannot perform search without search text."),e);else this._handleError(new Error("Cannot perform search without a feature set collection."),e)},r.prototype._getSearchableLayers=function(){for(var e=[],t=0,r=this.app.site.essentialsMap.allLayersAndTables();t<r.length;t++){var a=r[t];a.mapService&&!a.mapService.instantSearch&&(a.searchable&&a.inActiveTheme&&this._layerTypeSupported(a)&&e.push(a))}return e},r.prototype._searchLayer=function(e,t,r,a){var s=new esri.tasks.Query;s.where=t,s.outFields=["*"],s.outSpatialReference=this.app.map.spatialReference,s.returnGeometry=!0,o.getQueryTask(e).execute(s,function(t){r(t,e)},function(t){a(t,e)})},r.prototype._searchLocalLayer=function(e,t,r,a){try{var s=e.split(" ").map(function(e){return e.trim()}).filter(function(e){return!!e}).map(function(e){return new RegExp("\\b"+e+"\\b","i")}),i=t.mapService.serviceLayer,n=new esri.tasks.FeatureSet;e:for(var o=0;o<i.graphics.length;o++)for(var c=i.graphics[o],u=0,l=Object.keys(c.attributes);u<l.length;u++)switch(function(e){var t=c.attributes[e];if(s.map(function(e){return e.test(t)}).every(function(e){return!!e}))return n.features.push(c),"continue-featureLoop"}(l[u])){case"continue-featureLoop":continue e}r(n,t)}catch(e){a(e,t)}},r.prototype.cancelSearch=function(){this._cancelFunction&&this._cancelFunction(),this._fscAddHandle&&clearInterval(this._fscAddHandle),this._fscAddsToProcess=[]},r.prototype._addFsToFsc=function(e,t,r,a){var s=this;if(this._hasAddedToFsc)return this._fscAddsToProcess.push(function(){return s._addFsToFsc(e,t,r,a)}),void(this._fscAddHandle||(this._fscAddHandle=setInterval(function(){return s._doAsyncAdds()})));if(e&&e.features&&e.features.length>0)for(var i=0,n=e.features;i<n.length;i++){var o=n[i];t.mapService&&t.mapService.serviceLayer&&(o._graphicsLayer=t.mapService.serviceLayer)}var c=new u.FeatureSet({esriFeatureSet:e,layer:t,featureLayer:r,app:this.app});c.resolveDataLinks(function(e){s.app.event("FeatureChangedEvent").publish(e)}),a.featureSets.addItem(c),this._hasAddedToFsc=!0},r.prototype._doAsyncAdds=function(){if(0===this._fscAddsToProcess.length)return clearInterval(this._fscAddHandle),this._fscAddHandle=null,void(this._hasAddedToFsc=!1);this._hasAddedToFsc?this._hasAddedToFsc=!1:(this._fscAddsToProcess.shift()(),this._hasAddedToFsc=!1)},r.prototype._layerTypeSupported=function(e){return!(!e||!e.mapService)&&(e.mapService.mapServiceType===l.MapServiceType.DYNAMIC||(e.mapService.mapServiceType===l.MapServiceType.TILED||(e.mapService.mapServiceType===l.MapServiceType.FEATURE||e.mapService.mapServiceType===l.MapServiceType.WMS)))},r.prototype._handleWarning=function(e,t,r,a){var n="Layer Search Provider"+(r?" ("+r+"): ":": ")+e.message,o=new i.SearchProgressEventArgs;o.results=t,o.status=s.Status.ERROR,o.error=e,o.message=n,o.searchType=this.SEARCH_TYPE,o.query=a,this.app.trace.warning(n),this.app.event("SearchProgress").publish(o),this.app.event("SearchProgressEvent").publish(o)},r.prototype._handleError=function(e,t,r,a){var n="Layer Search Provider"+(r?" ("+r+"): ":": ")+e.message,o=new i.SearchProgressEventArgs;o.results=t,o.status=s.Status.ERROR,o.error=e,o.message=n,o.searchType=this.SEARCH_TYPE,o.query=a,this.app.trace.error(n),this.app.event("SearchProgress").publish(o),this.app.event("SearchProgressEvent").publish(o)},r}(a.SearchProviderBase);r.LayerQuerySearchProvider=p})},"Mapping/modules/Search/SearchHintsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FocusUtils"],function(t,r,a,s){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.app.command("FocusOnSearchHint").register(a,function(e){e===dojo.keys.DOWN_ARROW||e===dojo.keys.NUMPAD_2?s.focus($(a.hintsList).find(".list-menu-button")[0]):e!==dojo.keys.UP_ARROW&&e!=dojo.keys.NUMPAD_8||s.focus($(a.hintsList).find(".list-menu-button")[$(a.hintsList).find(".list-menu-button").length-1])}),a}return e(r,t),r.prototype.attach=function(e){var r=this;t.prototype.attach.call(this,e),this.viewModel&&this.viewModel.expanded.bind(this,function(e){var t=e?"ActivateView":"DeactivateView";if(r.app.command(t).execute(r.id),e){r.app.event("FlyoutActivated").publish(r);var a={view:r,onOtherInteracted:function(e){return r._onOtherInteracted(e)}};r.app.command("TapToDismiss").execute(a)}else r.app.event("FlyoutDeactivated").publish(r)})},r.prototype.handleHintClick=function(e,t,r){r&&r.plainText.get()&&(this._hideAutoComplete(),this.viewModel.searchText.set(r.plainText.get()),this.app.command("GlobalSearch").execute(r.plainText.get()),this.app.event("SearchHintClickedEvent").publish(r))},r.prototype.handleRefineSearchClick=function(e,t,r){r&&r.plainText.get()&&(this._showAutoComplete(),this.viewModel.searchText.set(r.plainText.get()),this.viewModel.updateSearchHints(r.plainText.get()))},r.prototype.handleKeyDown=function(e,t,r){if($(document.activeElement).parent(".hints-list")&&[dojo.keys.DOWN_ARROW,dojo.keys.UP_ARROW,dojo.keys.NUMPAD_2,dojo.keys.NUMPAD_8].indexOf(e.keyCode)>-1){var a=$(this.hintsList).find(".list-menu-button"),i=0;for(i=0;i<a.length&&a[i]!==document.activeElement;i++);if(e.keyCode===dojo.keys.DOWN_ARROW||e.keyCode===dojo.keys.NUMPAD_2)return s.focus(a[++i]),!1;if(e.keyCode===dojo.keys.UP_ARROW||e.keyCode==dojo.keys.NUMPAD_8)return s.focus(a[--i]),!1}return!0},r.prototype._showAutoComplete=function(){this.viewModel.expanded.set(!0)},r.prototype._onOtherInteracted=function(e){this.viewModel.expanded.set(!1)},r.prototype._hideAutoComplete=function(){this.viewModel.expanded.set(!1)},r}(a.ViewBase);r.SearchHintsView=i})},"Mapping/modules/Search/SearchModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/essentials/GeocodingEndpoint","./BingGeocodeSearchProvider","geocortex/essentials/RestHelper","./ArcGisGeocodeSearchProvider"],function(t,r,a,s,i,n,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.autoLoadSiteGeocoders=!0,e}return e(r,t),r.prototype.initialize=function(e){e&&e.searchProviders&&this._loadProviders(e.searchProviders),e&&e.hasOwnProperty("autoLoadSiteGeocoders")&&0==e.autoLoadSiteGeocoders&&(this.autoLoadSiteGeocoders=!1),this.autoLoadSiteGeocoders&&(this.app.site&&this.app.site.isInitialized?this._loadGeocoders():this.app.event("SiteInitializedEvent").once(this,this._loadGeocoders))},r.prototype._loadProviders=function(e){for(var t=0;t<e.length;t++){var r=e[t];r&&(r.libraryId&&!this.app.allLibrariesLoaded?this._loadProviderWhenLibrariesDownloaded(r):this._loadProvider(r))}},r.prototype._loadProviderWhenLibrariesDownloaded=function(e){var t=this,r=this.app.event("ViewerLibrariesDownloadedEvent").subscribe(this,function(){t.app.event("ViewerLibrariesDownloadedEvent").unsubscribe(r),t._loadProvider(e)})},r.prototype._loadProvider=function(e){var t=e.type,r=dojo.getObject(t);if(r){var a=new r(this.app,e.libraryId||this.libraryId);a.initialize(e.configuration),e.hasOwnProperty("enable")&&(a.isEnabled=e.enable),e.hasOwnProperty("name")&&(a.name=e.name),e.hasOwnProperty("description")&&(a.description=e.description),this.app.command("RegisterSearchProvider").execute(a)}},r.prototype._loadGeocoders=function(){if(this.app.site&&this.app.site.isInitialized&&this.app.site.geocodingEndpoints&&this.app.site.geocodingEndpoints.length>0)for(var e=0;e<this.app.site.geocodingEndpoints.length;e++){var t=this.app.site.geocodingEndpoints[e];if(t.includeInGlobalSearch)if(t.geocoderType==s.GeocodingEndpointType.BING_GEOCODER){var r=new i.BingGeocodeSearchProvider(this.app,this.libraryId);r.libraryId=this.libraryId,r.name=t.displayName,r.iconUri=n.RestHelper.processClientSideTokens(this.app.site,t.iconUri),r.initialize({}),r.bingMapsKey=t.bingProperties.bingMapsKey,t.bingProperties.culture&&(r.culture=t.bingProperties.culture),this.app.command("RegisterSearchProvider").execute(r)}else if(t.geocoderType==s.GeocodingEndpointType.ARCGIS_GEOCODER){var a=new o.ArcGisGeocodeSearchProvider(this.app,this.libraryId);a.libraryId=this.libraryId,a.locatorUrl=t.geocoderUrl,a.token=t.geocoderToken,a.name=t.displayName,a.iconUri=n.RestHelper.processClientSideTokens(this.app.site,t.iconUri),t.featureZoomScale&&(a.defaultZoomScale=t.featureZoomScale),a.parameters=t.parameters,a.globalSearchKey=t.globalSearchKey,a.minimumScore=70,a.initialize({}),this.app.command("RegisterSearchProvider").execute(a),t.geocoderToken&&dojo.subscribe("ServiceTokenRefreshed",function(e){e.serviceUrl==a.locatorUrl&&a.updateToken(e.token)})}}},r}(a.ModuleBase);r.SearchModule=c})},"Mapping/modules/Search/SearchTableSearchProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/framework/utils/ArrayUtils","geocortex/framework/utils/utils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/DateFormat","geocortex/essentials/Field"],function(t,r,a,s,i,n,o,c,u,l,p){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.SEARCH_TYPE="SearchTable",a._cancelFunction=null,a._dotNetDateRegex=/^\/Date\(([-]?[0-9]+)\)\/$/,a.name="Search Table",a.description="Search provider for Search Tables.",a.isEnabled=!0,a}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e)},r.prototype.search=function(e,t){var r=this,a=!1,n=0,o=new s.SearchProgressEventArgs;if(o.results=e,o.error=null,o.searchType=this.SEARCH_TYPE,o.query=t,this.status=i.Status.IDLE,o.status=this.status,e)if(t){var c=this._getSearchableTables();if(0!=c.length){this.status=i.Status.SEARCHING,o.status=this.status,this.app.event("SearchProgressEvent").publish(o);var u=function(t,s){a||(t.features.length>0&&r._addFsToFsc(t,s,e),++n===c.length?r.status=i.Status.IDLE:r.status=i.Status.SEARCHING,o.status=r.status,r.app.event("SearchProgressEvent").publish(o))},l=function(t,s){a||(++n===c.length&&(r.status=i.Status.IDLE),r._handleError(t,e,s.displayName))};c.forEach(function(e){for(var r={},a=0,s=e.parameters.length;a<s;a++)r[e.parameters[a].name]=t;e.performSearch(r,function(t){return u(t,e)},function(t){return l(t,e)})}),this._cancelFunction=function(){a||(a=!0,r._cancelFunction=null,r.status=i.Status.IDLE)}}else this.app.event("SearchProgressEvent").publish(o)}else this.app.trace.error("Search Table Search Provider: Cannot perform search without search text.");else this.app.trace.error("Search Table Search Provider: Cannot perform search without a feature set collection.")},r.prototype._getSearchableTables=function(){for(var e=[],t=0,r=this.app.site.searchTables.length;t<r;t++){var a=this.app.site.searchTables[t];a.includeInGlobalSearch&&e.push(a)}return e},r.prototype._addFsToFsc=function(e,t,r){var a=new n.FeatureSet({esriFeatureSet:e,app:this.app,id:t.displayName||t.id});a.displayName.set(t.displayName),a.features.getItems().forEach(function(e){e.descriptionFormat.set(t.featureDescription),e.longDescriptionFormat.set(t.featureLongDescription),e.labelFormat.set(t.featureLabel),e.iconUri.set(t.iconUri),e.setExtendedProperty("SearchTableId",t.id)});for(var s=this,i=0,h=a.attributes.getItems();i<h.length;i++)!function(e){for(var t=[],r=[],i=0,n=a.features.getItems();i<n.length;i++){g=n[i];if(v=o.firstOrDefault(g.attributes.getItems(),function(t){return t.name.get()===e.name.get()})){m=v.value.get();if(c.isNullOrUndefined(m)||""===m){r.push(g);continue}if(f=s._dotNetDateRegex.exec(m)){t.push(g);continue}}break}if(t.length>0&&t.length+r.length===a.features.getLength()){e.type.set(p.EssentialsFieldTypes.essentialsFieldTypeDate);for(var h=0,d=t;h<d.length;h++){var g=d[h],m=(v=o.firstOrDefault(g.attributes.getItems(),function(t){return t.name.get()===e.name.get()})).value.get(),f=s._dotNetDateRegex.exec(m);f&&(v.value.set(f[1]),v.presentableValue.set(u.formatDate(u.parseDate(f[1]),l.DateFormat.DEFAULT)),v.type.set(p.EssentialsFieldTypes.essentialsFieldTypeDate))}for(var b=0,S=r;b<S.length;b++){var g=S[b],v=o.firstOrDefault(g.attributes.getItems(),function(t){return t.name.get()===e.name.get()});v.type.set(p.EssentialsFieldTypes.essentialsFieldTypeDate)}}}(h[i]);r.featureSets.addItem(a)},r.prototype.cancelSearch=function(){this._cancelFunction&&this._cancelFunction()},r.prototype._handleError=function(e,t,r,a){var n="Search Table Search Provider"+(r?" ("+r+"): ":": ")+e.message,o=new s.SearchProgressEventArgs;o.results=t,o.status=i.Status.ERROR,o.error=e,o.message=n,o.searchType=this.SEARCH_TYPE,o.query=a,this.app.trace.error(n),this.app.event("SearchProgressEvent").publish(o)},r}(a.SearchProviderBase);r.SearchTableSearchProvider=h})},"Mapping/modules/Search/SearchView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation","geocortex/infrastructure/FocusUtils"],function(t,r,a,s,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a._keyDownTimer=null,a}return e(r,t),r.prototype.attach=function(e){var r=this;if(t.prototype.attach.call(this,e),this.viewModel){var a=this.viewModel.minimumPopulateDelay;this._keyDownTimer=new s.TimeDelayedAction(a,this._requestSearchHints,this),this.app.event("FSMCollectionClosedEvent").subscribe(this,function(e){"SearchResultsCollection"===e.featureSetCollectionId&&($(r.inputElement).prop("disabled",!1),r.viewModel.searchDisabled=!1)}),this.app.event("SearchHintClickedEvent").subscribe(this,function(e){return r._delayConsecutiveSearches()}),this.app.command("FocusSearch").register(this,this._executeFocusSearch)}},r.prototype._executeFocusSearch=function(){this.app.command("FocusOnFirstInputInView").execute(this)},r.prototype.handleKeyDown=function(e,t,r){var a=e.which?e.which:e.keyCode;if(this._isUpOrDownKey(a)&&0!==this.viewModel.searchHints.length()&&this.app.command("FocusOnSearchHint").execute(a),this._isSpecialChar(a))return!0;if(this._resetKeyDownTimer(a),a===dojo.keys.ENTER){if(this.viewModel.searchDisabled)return!0;this._hideAutoComplete(),this.app.command("GlobalSearch").execute(t.value),this._delayConsecutiveSearches(),e.preventDefault()}return!0},r.prototype.handleSearchClick=function(e,t,r){this._hideAutoComplete();var a=this.viewModel.searchText.get();a&&!this.viewModel.searchDisabled&&(this.app.command("GlobalSearch").execute(a),this._delayConsecutiveSearches())},r.prototype._delayConsecutiveSearches=function(){var e=this;this.viewModel.delayConsecutiveSearches&&($(this.inputElement).prop("disabled",!0),this.viewModel.searchDisabled=!0,setTimeout(function(){$(e.inputElement).prop("disabled",!1),e.viewModel.searchDisabled=!1},this.viewModel.consecutiveSearchDelay))},r.prototype.handleDoubleClick=function(){this._hideAutoComplete()},r.prototype._isSpecialChar=function(e){switch(e){case dojo.keys.TAB:case dojo.keys.SHIFT:case dojo.keys.CTRL:case dojo.keys.ALT:case dojo.keys.PAUSE:case dojo.keys.CAPS_LOCK:case dojo.keys.ESCAPE:case dojo.keys.PAGE_UP:case dojo.keys.PAGE_DOWN:case dojo.keys.END:case dojo.keys.HOME:case dojo.keys.LEFT_ARROW:case dojo.keys.UP_ARROW:case dojo.keys.RIGHT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.NUM_LOCK:case dojo.keys.SCROLL_LOCK:return!0}return!1},r.prototype._isUpOrDownKey=function(e){switch(e){case dojo.keys.UP_ARROW:case dojo.keys.DOWN_ARROW:return!0}return!1},r.prototype._resetKeyDownTimer=function(e){this._keyDownTimer.stop(),e!==dojo.keys.ENTER&&this._keyDownTimer.start()},r.prototype._requestSearchHints=function(){var e=this.viewModel,t=e.searchText.get();null===t||t.length<e.minimumPrefixLength||""==t.replace(/ /g,"")?(this._hideAutoComplete(),e.clearSearchHints()):(this._showAutoComplete(),e.updateSearchHints(t))},r.prototype._showAutoComplete=function(){this.viewModel.expanded.set(!0),i.focus(this.inputElement)},r.prototype._hideAutoComplete=function(){this.viewModel.expanded.set(!1)},r}(a.ViewBase);r.SearchView=n})},"Mapping/modules/Search/SearchViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,r,a,s){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a.enableSearchRefinement=new s.Observable(!0),a.minimumPopulateDelay=300,a.consecutiveSearchDelay=1e4,a.delayConsecutiveSearches=!1,a.minimumPrefixLength=3,a.searchText=new s.Observable(""),a.enableUI=new s.Observable(!1),a.expanded=new s.Observable(!1),a.searchDisabled=!1,a.searchHints=new s.ObservableCollection,a.app.site&&a.app.site.isInitialized?a._onSiteInitialized(a.app.site):a.app.event("SiteInitializedEvent").once(a,a._onSiteInitialized),a}return e(r,t),r.prototype.initialize=function(e){e&&e.hasOwnProperty("enableSearchRefinement")&&this.enableSearchRefinement.set(e.enableSearchRefinement),e&&e.hasOwnProperty("minimumPopulateDelay")&&(this.minimumPopulateDelay=parseInt(e.minimumPopulateDelay)),e&&e.hasOwnProperty("minimumPrefixLength")&&(this.minimumPrefixLength=parseInt(e.minimumPrefixLength)),e&&e.hasOwnProperty("consecutiveSearchDelay")&&(this.consecutiveSearchDelay=parseInt(e.consecutiveSearchDelay)),e&&e.hasOwnProperty("delayConsecutiveSearches")&&(this.delayConsecutiveSearches=e.delayConsecutiveSearches),this.app.command("EnableSearchRefinement").register(this,this._executeEnableSearchRefinementCommand)},r.prototype.clearSearchHints=function(){this.searchHints.clear()},r.prototype.updateSearchHints=function(e){this.clearSearchHints(),this.app.searchManager.getSearchHints(this.searchHints,e)},r.prototype._onSiteInitialized=function(e){this.enableUI.set(!0)},r.prototype._executeEnableSearchRefinementCommand=function(e){this.enableSearchRefinement.set(e||!1)},r}(a.ViewModelBase);r.SearchViewModel=i})},"url:/Mapping/modules/Search/SearchHintsView.html":t,"url:/Mapping/modules/Search/SearchView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/common.css","css","Lmdsb2JhbC1zZWFyY2ggaW5wdXRbdHlwZT0idGV4dCJdIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiAzcHggMzBweCA0cHggOXB4Ow0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGZvbnQtc2l6ZTogMS42ZW07DQogICAgY29sb3I6ICM0NDQ0NDQ7DQogICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOw0KICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwKTsNCiAgICBmb250LXdlaWdodDogbGlnaHRlcjsNCn0NCg0KLmdsb2JhbC1zZWFyY2ggaW5wdXQ6Zm9jdXMgew0KICAgIC13ZWJraXQtdXNlci1tb2RpZnk6IHJlYWQtd3JpdGUtcGxhaW50ZXh0LW9ubHk7IC8qIEFuZHJvaWQgMy4wKyBmaXggKi8NCn0NCg0KLmhpbnRzLWxpc3Qgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0JCQkJCQjsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pY29uIHsNCiAgICBmb250LXNpemU6IDEuMjVlbTsNCiAgICB3aWR0aDogMWVtOw0KICAgIGhlaWdodDogMWVtOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBhZGRpbmc6IDA7DQp9DQouaGludHMtbGlzdCAucmVmaW5lLWRpc2FibGVkIC5saXN0LW1lbnUtaXRlbSAuY29udGVudCB7DQogICAgbWFyZ2luLXJpZ2h0OiAwOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50IHsNCiAgICBtYXJnaW4tcmlnaHQ6IDJlbTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmhpbnRzLWxpc3QgLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbWFyZ2luLWxlZnQ6IDA7DQogICAgcGFkZGluZy1sZWZ0OiAwLjVlbTsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBtYXgtd2lkdGg6IDI3ZW07DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmxpc3QtbWVudSBsaTpsYXN0LWNoaWxkIHsNCiAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMC4yNXJlbTsNCiAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwLjI1cmVtOw0KfQ0KLmxpc3QtbWVudS1idXR0b24gew0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KLnJlZmluZS1kaXNhYmxlZCAucmVmaW5lLWNvbnRhaW5lciB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCi5yZWZpbmUtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAwOw0KICAgIHdpZHRoOiAyLjVlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNFRUVFRUU7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNFRUVFRUU7DQp9DQoucmVmaW5lLWJ0biB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9zZWFyY2gtcmVmaW5lLTE2LnBuZyIpOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQouZ2xvYmFsLXNlYXJjaCAuc2VhcmNoLWJ1dHRvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMXB4Ow0KICAgIHJpZ2h0OiAxcHg7DQogICAgYm90dG9tOjFweDsNCiAgICB3aWR0aDogNDBweDsNCiAgICAvKmhlaWdodDogMTAwJTsqLw0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvc2VhcmNoLTI0LnBuZykgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1pbmRlbnQ6IC05OTllbTsNCn0NCg0KLlNlYXJjaEhpbnRzVmlldyBlbSB7DQogICAgZm9udC1zdHlsZTogbm9ybWFsOw0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/large.css","css","DQovKiBHTE9CQUwgU0VBUkNIIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5TZWFyY2hWaWV3LCAuU2VhcmNoVmlldy5hY3RpdmUgew0KICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgbWFyZ2luLXJpZ2h0OiAwLjVlbTsNCiAgICB3aWR0aDogMjBlbTsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5nbG9iYWwtc2VhcmNoIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgei1pbmRleDogMDsNCn0NCg0KLmdsb2JhbC1zZWFyY2ggLnNlYXJjaC1ib3ggew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLnNlYXJjaC1oaW50cy1yZWdpb24gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICB6LWluZGV4OiAyMDA7DQp9DQoNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtaXRlbSAuY29udGVudDpob3ZlciwNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtaXRlbSAubGlzdC1tZW51LWJ1dHRvbjpmb2N1cyB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Y3RjdGNzsNCn0NCg0KLmhpbnRzLWxpc3QgLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbWF4LXdpZHRoOiAxNWVtOw0KfQ0KDQouaGludHMtbGlzdCAuaGFzLWljb24ucmVmaW5lLWRpc2FibGVkIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5yZWZpbmUtZGlzYWJsZWQgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBtYXgtd2lkdGg6IDE4ZW07DQp9DQoNCi5yZWZpbmUtYnRuIHsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9NTApOw0KICAgIG9wYWNpdHk6IDAuNTA7DQp9DQoNCi5yZWZpbmUtYnRuOmhvdmVyIHsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MTAwKTsNCiAgICBvcGFjaXR5OiAxOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/medium.css","css","DQovKiBHTE9CQUwgU0VBUkNIIChNRURJVU0pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KDQouU2VhcmNoVmlldywgLlNlYXJjaFZpZXcuYWN0aXZlIHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgIG1hcmdpbi1yaWdodDogMC41ZW07DQogICAgd2lkdGg6IDE4ZW07DQogICAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQouZ2xvYmFsLXNlYXJjaCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouZ2xvYmFsLXNlYXJjaCAuc2VhcmNoLWJveCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouc2VhcmNoLWhpbnRzLXJlZ2lvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHotaW5kZXg6IDIwMDsNCn0NCi5oaW50cy1saXN0IHsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50IHsNCiAgICBtYXJnaW4tcmlnaHQ6IDMuMjVlbTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KfQ0KDQouaGludHMtbGlzdCAubGlzdC1tZW51LWljb24gew0KICAgIGZvbnQtc2l6ZTogMS44NzVlbTsNCn0NCg0KLmhpbnRzLWxpc3QgLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbGluZS1oZWlnaHQ6IDEuODc1ZW07DQogICAgbWF4LXdpZHRoOiAxMmVtOw0KfQ0KDQouaGludHMtbGlzdCAuaGFzLWljb24ucmVmaW5lLWRpc2FibGVkIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5yZWZpbmUtZGlzYWJsZWQgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBtYXgtd2lkdGg6IDE2ZW07DQp9DQoNCi5yZWZpbmUtY29udGFpbmVyIHsNCiAgICB3aWR0aDogNGVtOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/small.css","css","DQovKiBHTE9CQUwgU0VBUkNIIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5nbG9iYWwtc2VhcmNoIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQp9DQouZ2xvYmFsLXNlYXJjaCAuc2VhcmNoLWJveCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KLnNlYXJjaC1oaW50cy1yZWdpb24gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICB6LWluZGV4OiAzMDA7DQp9DQouc2VhcmNoLWhpbnRzLXJlZ2lvbiAuU2VhcmNoSGludHNWaWV3IHsNCiAgICByaWdodDogLTMuM2VtOw0KICAgIGxlZnQ6IC05LjNlbTsNCn0NCi5zaGVsbC1zbWFsbCAucmVnaW9uLmhlYWRlci1yZWdpb24gLnZpZXcuU2VhcmNoSGludHNWaWV3LmluYWN0aXZlIHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50OmhvdmVyLA0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5saXN0LW1lbnUtYnV0dG9uOmZvY3VzIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRjdGN0Y3Ow0KfQ0KLnJlZmluZS1idG4gew0KICAgIGZpbHRlcjogYWxwaGEob3BhY2l0eT01MCk7DQogICAgb3BhY2l0eTogMC41MDsNCn0NCi5yZWZpbmUtYnRuOmhvdmVyIHsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MTAwKTsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KLmhpbnRzLWxpc3Qgew0KICAgIGJvcmRlci1yYWRpdXM6IDA7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50IHsNCiAgICBtYXJnaW4tcmlnaHQ6IDRlbTsNCiAgICBwYWRkaW5nOiAuNGVtOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pY29uIHsNCiAgICBmb250LXNpemU6IDIuNWVtOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBsaW5lLWhlaWdodDogMi41ZW07DQp9DQoucmVmaW5lLWNvbnRhaW5lciB7DQogICAgd2lkdGg6IDMuMmVtOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/small.css","css","DQouc21hbGwgLmdsb2JhbC1zZWFyY2gNCnsNCiAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG1hcmdpbjogOHB4Ow0KICAgIHBhZGRpbmc6IDVweCAzMHB4IDVweCA1cHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouc21hbGwgLmdsb2JhbC1zZWFyY2ggaW5wdXQNCnsNCiAgICBmb250LXNpemU6IDEuMmVtOw0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBtYXJnaW46IDAgMzBweCAwIDA7DQogICAgb3V0bGluZTogbm9uZTsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLnNtYWxsIC5nbG9iYWwtc2VhcmNoIGJ1dHRvbg0Kew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvc2VhcmNoLTI0LnBuZykgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICByaWdodDogMDsNCiAgICB0b3A6IDA7DQogICAgd2lkdGg6IDMwcHg7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQp9DQoNCkBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDgwMHB4KQ0Kew0KICAgIC5zbWFsbCAuZ2xvYmFsLXNlYXJjaA0KICAgIHsNCiAgICAgICAgd2lkdGg6IGF1dG87DQogICAgfQ0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/SearchHintsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/SearchView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Search/ArcGisGeocodeSearchProvider","Mapping/modules/Search/BingGeocodeSearchProvider","Mapping/modules/Search/InstantSearchProvider","Mapping/modules/Search/LayerQuerySearchProvider","Mapping/modules/Search/SearchHintsView","Mapping/modules/Search/SearchModule","Mapping/modules/Search/SearchTableSearchProvider","Mapping/modules/Search/SearchView","Mapping/modules/Search/SearchViewModel"],function(t,r,a,s,i,n,o,c,u){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.search.ArcGisGeocodeSearchProvider",t.ArcGisGeocodeSearchProvider),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.search.BingGeocodeSearchProvider",r.BingGeocodeSearchProvider),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.search.InstantSearchProvider",a.InstantSearchProvider),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.search.LayerQuerySearchProvider",s.LayerQuerySearchProvider),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchHintsView",i.SearchHintsView),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchModule",n.SearchModule),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchTableSearchProvider",o.SearchTableSearchProvider),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchView",c.SearchView),e(u,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchViewModel",u.SearchViewModel)})}();