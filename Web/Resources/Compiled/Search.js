!function(){var t="<div class='hints-list' data-binding='{@visible: searchHints}{@var: hintsList}{@event-keydown: handleKeyDown}'>    <ul class='list-menu has-icon' data-binding='{@source: searchHints}{@noclass-refine-disabled: enableSearchRefinement}'>        <li class='list-menu-item' data-binding='{@template-for: searchHints}'>            <button class='content list-menu-button' data-binding='{@event-onclick: handleHintClick}'>                <img class='list-menu-icon' data-binding='{@visible: iconUri}{src: iconUri}{alt: plainText}' src='Resources/Images/Icons/IconPlaceholder24x24.png' />                <span class='list-menu-details' data-binding='{innerHTML: safeText}{title: plainText}'></span>            </button>            <div class='refine-container'>                <button class='refine-btn' data-binding='{@visible: searchHints}{@event-onclick: handleRefineSearchClick}{title: @language-search-refine}'></button>            </div>        </li>    </ul></div>",r="<div class='global-search' data-binding='{@visible: enableUI}'>    <div class='search-box'>        \x3c!-- The id 'gcx_search' is used to prevent a long press in the search box from bringing up the log view (GVH-3271) --\x3e        <input type='text' id='gcx_search' data-binding='{@var: inputElement}{@value: searchText}{@event-keydown: handleKeyDown}{@event-dblclick: handleDoubleClick}{placeholder: @language-search-placeholder}{title: @language-search-search-prompt}{aria-label: @language-search-search-prompt}' tabindex='0' />        <button class='search-button' data-binding='{@event-click: handleSearchClick}' tabindex='0'><span data-binding='{@text: @language-search-perform-global-search}' ></span></button>    </div>    <div class='region search-hints-region' data-region-name='SearchHintsRegion'></div></div>";function u(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var a=t.split("."),s=null,i=window,n=0,o=a.length;n<o;n++)s=a[n],n==o-1?i[s]=r:i[s]||(i[s]={}),i=i[s];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Search/ArcGisGeocodeSearchProvider":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/Feature","geocortex/essentials/RestHelperHTTPService"],function(e,t,r,l,p,h,d,g,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=(s=r.SearchProviderBase,o(n,s),n.prototype.initialize=function(e){s.prototype.initialize.call(this,e),e&&e.url&&(this.locatorUrl=e.url),e&&e.iconUri&&(this.iconUri=e.iconUri),e&&e.defaultZoomScale&&(this.defaultZoomScale=e.defaultZoomScale),e&&e.singleLineField&&(this.singleLineField=e.singleLineField),e&&e.minimumScore&&(this.minimumScore=e.minimumScore),!this.singleLineField&&this.locatorUrl&&(this.app.site&&this.app.site.isInitialized?this._loadGeocodeDefinition():this.app.event("SiteInitializingEvent").once(this,this._loadGeocodeDefinition))},n.prototype._loadGeocodeDefinition=function(){var t=this;if(this.app.isOffline.get())this._offlineSwitchToken=this.app.event("ApplicationOnlineEvent").subscribe(this,function(){t.app.event("ApplicationOnlineEvent").unsubscribe(t._offlineSwitchToken),t._loadGeocodeDefinition()});else if(!this.singleLineField&&this.locatorUrl){var e=this.locatorUrl+"?f=json"+(this.token?"&token="+encodeURIComponent(this.token):"");esri.request({url:e}).then(function(e){e&&e.singleLineAddressField&&e.singleLineAddressField.name?t.singleLineField=e.singleLineAddressField.name:t.app.trace.error("ArcGIS geocode server does not support single address line query: '"+t.locatorUrl+"'.")},function(e){t.app.trace.error("Unable to retrieve geocode server information at: '"+t.locatorUrl+"': "+e.message)})}},n.prototype._getGeocoder=function(){if(!this._geocoder){var e=this.locatorUrl;this.token&&(e=a.RestHelperHTTPService.appendTokenToUrl(e,this.token)),this._geocoder=new esri.tasks.Locator(e),this.app&&this.app.map&&(this._geocoder.outSpatialReference=this.app.map.spatialReference)}return this._geocoder},n.prototype.updateToken=function(e){this.token=e,this._geocoder=null},n.prototype.search=function(r,e){var i=this,a=this.intSearchUniqueId++;this.currentSearchId=a,this._searchCancelState[a]=!1;var n=new l.SearchProgressEventArgs;function o(){i.status=p.Status.IDLE}if(n.results=r,n.error=null,n.searchType=this.SEARCH_TYPE,n.query=e,n.endpointUrl=this.locatorUrl,r)if(e){this.status=p.Status.SEARCHING,n.status=this.status,this.app.event("SearchProgress").publish(n),this.app.event("SearchProgressEvent").publish(n);var t,s=this._getGeocoder();if(this.globalSearchKey===this.singleLineField){var c={};c[this.singleLineField]=e,t={address:c}}else t={address:this._getMultiLineFields(e)};var u=parseInt(this.minimumScore,10);!isNaN(u)&&(u<0||100<u)&&(u=null),s.addressToLocations(t).then(function(e){if(!i._searchCancelState[a]&&0<e.length){var t=new esri.tasks.FeatureSet;t.displayFieldName="address",t.geometryType="esriGeometryPoint",e[0].spatialReference&&(t.spatialReference=e[0].spatialReference);var s=new h.FeatureSet({app:i.app,esriFeatureSet:t});s.iconUri.set(i.iconUri?i.iconUri:i.DEFAULT_ICONURI),s.attributes.addItem(new d.FeatureAttribute("","address","address",i.app.getResource(i.libraryId,"language-search-arcgis-address"))),s.attributes.addItem(new d.FeatureAttribute("","score","score",i.app.getResource(i.libraryId,"language-search-arcgis-score"))),s.displayName.set(i.name),dojo.forEach(e,function(e){if(isNaN(u)||e.score>=u){var t={address:e.address,score:e.score},r=new esri.Graphic(e.location,null,t),a=new g.Feature({graphic:r});a.label.set(e.address),a.zoomScale.set(i.defaultZoomScale),a.description.set(i.app.getResource(i.libraryId,"language-search-geocoding-score-description")+e.score),s.addFeature(a,!0)}}),0<s.features.length()&&r.featureSets.addItem(s)}o(),i._searchCancelState[a]||(n.status=i.status,i.app.event("SearchProgress").publish(n),i.app.event("SearchProgressEvent").publish(n))},function(e){o(),i._searchCancelState[a]||(n.status=p.Status.ERROR,n.error=e,n.message=e.message,i.app.event("SearchProgress").publish(n),i.app.event("SearchProgressEvent").publish(n))})}else this.app.trace.error("ArcGIS Geocode Search Provider: Cannot perform search without search text.");else this.app.trace.error("ArcGIS Geocode Search Provider: Cannot perform search without a feature set collection.")},n.prototype._getMultiLineFields=function(e){var t={};for(var r in this.parameters)this.parameters[r].name===this.globalSearchKey?t[this.parameters[r].name]=e:t[this.parameters[r].name]=this.parameters[r].value;return t},n.prototype.cancelSearch=function(){this.status===p.Status.SEARCHING&&(this._searchCancelState[this.currentSearchId]=!0)},n);function n(e,t){var r=s.call(this,e,t)||this;return r.SEARCH_TYPE="ArcGISGeocode",r.DEFAULT_ICONURI="Resources/Images/Icons/pin-blue-32.png",r.iconUri=null,r.locatorUrl=null,r.token=null,r.minimumScore=70,r.defaultZoomScale=8e3,r.singleLineField=null,r.parameters=[],r.globalSearchKey=null,r.intSearchUniqueId=0,r.currentSearchId=null,r._searchCancelState={},r._geocoder=null,r._offlineSwitchToken=null,r.name="ArcGIS Geocode",r.description="Search provider for the ArcGIS Geocode Service.",r.isEnabled=!0,r}t.ArcGisGeocodeSearchProvider=i})},"Mapping/modules/Search/BingGeocodeSearchProvider":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/Feature"],function(e,t,r,s,c,u,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=(a=r.SearchProviderBase,o(n,a),n.prototype.initialize=function(e){a.prototype.initialize.call(this,e),e&&e.bingMapsKey&&(this.bingMapsKey=e.bingMapsKey),e&&e.culture?this.culture=e.culture:!this.culture&&this.app.locale?this.culture=this.app.locale:this.culture="en-US",e&&e.iconUri&&(this.iconUri=e.iconUri)},n.prototype._getGeocoder=function(){return this._bingGeocoder||(this._bingGeocoder=new esri.virtualearth.VEGeocoder({bingMapsKey:this.bingMapsKey,culture:this.culture})),this._bingGeocoder},n.prototype.search=function(r,e){var i=this,a=this.intSearchUniqueId++;this.currentSearchId=a,this._searchCancelState[a]=!1;var n=new s.SearchProgressEventArgs;function o(){i.status=c.Status.IDLE}n.results=r,n.error=null,n.message="",n.searchType=this.SEARCH_TYPE,n.query=e,r?e?(this.status=c.Status.SEARCHING,this._getGeocoder().addressToLocations(e).then(function(e){if(!i._searchCancelState[a]&&0<e.length){var t=new esri.tasks.FeatureSet;t.displayFieldName="formattedAddress",t.geometryType="esriGeometryPoint",e[0].spatialReference&&(t.spatialReference=e[0].spatialReference);var s=new u.FeatureSet({app:i.app,esriFeatureSet:t});s.iconUri.set(i.iconUri?i.iconUri:i.DEFAULT_ICONURI),s.attributes.addItem(new l.FeatureAttribute("","addressLine","addressLine",i.app.getResource(i.libraryId,"language-search-bing-address"))),s.attributes.addItem(new l.FeatureAttribute("","adminDistrict","adminDistrict",i.app.getResource(i.libraryId,"language-search-bing-admin-district"))),s.attributes.addItem(new l.FeatureAttribute("","countryRegion","countryRegion",i.app.getResource(i.libraryId,"language-search-bing-country"))),s.attributes.addItem(new l.FeatureAttribute("","district","district",i.app.getResource(i.libraryId,"language-search-bing-district"))),s.attributes.addItem(new l.FeatureAttribute("","formattedAddress","formattedAddress",i.app.getResource(i.libraryId,"language-search-bing-formatted"))),s.attributes.addItem(new l.FeatureAttribute("","locality","locality",i.app.getResource(i.libraryId,"language-search-bing-locality"))),s.attributes.addItem(new l.FeatureAttribute("","postalCode","postalCode",i.app.getResource(i.libraryId,"language-search-bing-postal-code"))),s.attributes.addItem(new l.FeatureAttribute("","postalTown","postalTown",i.app.getResource(i.libraryId,"language-search-bing-postal-town"))),s.displayName.set(i.name),dojo.forEach(e,function(e){var t=JSON.parse(JSON.stringify(e.address));delete t.declaredClass;var r=new esri.Graphic(esri.geometry.geographicToWebMercator(e.location),null,t),a=new p.Feature({graphic:r});a.label.set(e.address.formattedAddress),a.description.set(i.app.getResource(i.libraryId,"language-search-geocoding-score-description")+e.confidence),a.zoomExtent.set(esri.geometry.geographicToWebMercator(e.bestView)),s.addFeature(a,!0)}),r.featureSets.addItem(s)}o(),i._searchCancelState[a]||(n.status=i.status,i.app.event("SearchProgress").publish(n),i.app.event("SearchProgressEvent").publish(n))},function(e){if(o(),!i._searchCancelState[a]){var t="Bing Geocode error: "+e.message;n.status=c.Status.ERROR,n.error=e,n.message=t,i.app.trace.error(t),i.app.event("SearchProgress").publish(n),i.app.event("SearchProgressEvent").publish(n)}})):this.app.trace.error("Bing Geocode Search Provider: Cannot perform search without search text."):this.app.trace.error("Bing Geocode Search Provider: Cannot perform search without a feature set collection.")},n.prototype.cancelSearch=function(){this.status===c.Status.SEARCHING&&(this._searchCancelState[this.currentSearchId]=!0)},n);function n(e,t){var r=a.call(this,e,t)||this;return r.SEARCH_TYPE="BingGeocode",r.DEFAULT_ICONURI="Resources/Images/Icons/pin-red-32.png",r.iconUri=null,r.bingMapsKey=null,r.culture=null,r.libraryId=void 0,r.intSearchUniqueId=0,r.currentSearchId=null,r._searchCancelState={},r._bingGeocoder=null,r.name="Bing Geocode",r.description="Search provider for the Bing Geocode Service.",r.isEnabled=!0,r}t.BingGeocodeSearchProvider=i})},"Mapping/modules/Search/InstantSearchProvider":function(){var a,p=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/FormatUtils","geocortex/essentials/SearchQuery","geocortex/infrastructure/search/SearchHintItem","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature"],function(e,t,r,y,v,I,i,n,o,C,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=(a=r.SearchProviderBase,p(l,a),l.prototype.initialize=function(e){var t=this;a.prototype.initialize.call(this,e),e&&(e.hasOwnProperty("enableSearchHints")&&(this.enableSearchHints=e.enableSearchHints),e.hasOwnProperty("maxResults")&&(this.maxResults=parseInt(e.maxResults,10)),e.hasOwnProperty("maxHints")&&(this.maxHints=parseInt(e.maxHints,10)),e.hasOwnProperty("precedenceToNearbyResults")&&(this.precedenceToNearbyResults=e.precedenceToNearbyResults)),this.app.waitUntilSiteInitialized().then(function(){t._onSiteInitialized(t.app.site)})},l.prototype.canExecute=function(){return!!this._canExecute||(this.isEnabled=!1)},l.prototype.cancelSearch=function(){if(!this._cancelled){this._cancelled=!0,this.status=y.Status.IDLE;var e=new v.SearchProgressEventArgs;e.status=y.Status.IDLE,e.message=this.app.getResource("Mapping","language-search-instant-provider-search-cancelled"),e.results=null,this._updateProgress(e)}},l.prototype.search=function(t,e){var r=this;if(!1!==this.canExecute()){this._cancelled=!1,e=e||"";var a=[i.NumberFormat.ACCOUNTING,i.NumberFormat.CURRENCY,i.NumberFormat.FIXED_POINT,i.NumberFormat.NUMBER,i.NumberFormat.PERCENT,i.NumberFormat.ROUND_TRIP];e=e.split(/\s+/).map(function(e){var t=n.parseNumber(e,a);return isNaN(t)?e:n.formatNumber(t,i.NumberFormat.ROUND_TRIP)}).join(" ");var s=new o.SearchQuery;s.searchText=e,s.maxResults=this.maxResults,s.searchLayers=this._getSearchableLayers(),s.returnIdsOnly=!1,s.returnCountOnly=!1,s.returnHighlights=!1,s.returnGeometry=!0,s.contains=!0,s.outSpatialReference=this.app.map?this.app.map.spatialReference:null,0!==s.searchLayers.length?(this.precedenceToNearbyResults&&this.app.map?s.extent=this.app.map.extent:s.extent=null,this.status=y.Status.SEARCHING,this.app.site.search(s,function(e){return r._onSearchBegin(e,t)},function(e){return r._onSearchCompleted(e,t,s)},function(e){return r._onSearchError(e,t,s)})):this._onSearchError(new Error("No layers to search. Make sure you mark some layers as searchable in your site."),t,s)}},l.prototype.getSearchHints=function(t,e){var r=this;if(!1!==this.canExecute()&&e&&""!==e.replace(/ /g,"")&&this.enableSearchHints){var a=++this._intSearchUniqueID,s=new o.SearchQuery;s.searchText=e,s.maxResults=this.maxHints,s.searchLayers=this._getSearchableLayers(),s.returnIdsOnly=!1,s.returnCountOnly=!1,s.returnGeometry=!1,s.returnHighlights=!0,s.contains=!0,s.outSpatialReference=this.app.map?this.app.map.spatialReference:null,this.precedenceToNearbyResults&&this.app.map?s.extent=this.app.map.extent:s.extent=null,this.app.site.search(s,function(e){r._onGetSearchHintsBegin(e,a)},function(e){r._onGetSearchHintsCompleted(e,t,s,a)},function(e){r._onGetSearchHintsError(e,t,s,a)})}},l.prototype._onSiteInitialized=function(e){this._checkCanExecute(e)},l.prototype._checkCanExecute=function(e){e&&4<=e.getEssentialsVersion()?this._canExecute=this._hasSearchableMapServices(e):(this._canExecute=!1,this.app.trace.warning(this.app.getResource("Mapping","language-search-instant-provider-not-available")))},l.prototype._hasSearchableMapServices=function(e){for(var t=0,r=e.essentialsMap.mapServices;t<r.length;t++)if(r[t].instantSearch)return!0;return!1},l.prototype._getSearchableLayers=function(){for(var e=[],t=0,r=this.app.site.essentialsMap.allLayersAndTables();t<r.length;t++){var a=r[t];a.searchable&&a.mapService&&a.mapService.instantSearch&&e.push(a)}return e},l.prototype._onSearchBegin=function(e,t){if(!this._cancelled){var r=new v.SearchProgressEventArgs;r.status=y.Status.SEARCHING,r.message=this.app.getResource("Mapping","language-search-instant-provider-search-started"),r.searchType=this.SEARCH_TYPE,r.query=e.searchText,this._updateProgress(r)}},l.prototype._onSearchCompleted=function(e,t,r){if(!this._cancelled&&(this.status=y.Status.IDLE,!e.error)){for(var a=0,s=this._createFeatureSetArray(e);a<s.length;a++){var i=s[a];this._addFsToFsc(i,t)}var n=new v.SearchProgressEventArgs;n.status=y.Status.IDLE,n.message=this.app.getResource("Mapping","language-search-instant-provider-search-completed"),n.results=t,n.searchType=this.SEARCH_TYPE,n.query=r.searchText,this._updateProgress(n)}},l.prototype._onSearchError=function(e,t,r){if(!this._cancelled){this.status=y.Status.IDLE;var a=new v.SearchProgressEventArgs;a.status=y.Status.ERROR,a.message=this.app.getResource("Mapping","language-search-error").format(e.message),a.results=t,a.searchType=this.SEARCH_TYPE,a.query=r.searchText,this._updateProgress(a)}},l.prototype._onGetSearchHintsBegin=function(e,t){var r=new v.SearchProgressEventArgs;r.status=y.Status.SEARCHING,r.message=this.app.getResource("Mapping","language-search-instant-provider-search-started"),r.searchType=this.SEARCH_TYPE_HINTS,r.query=e.searchText,this._updateProgress(r)},l.prototype._onGetSearchHintsCompleted=function(e,t,r,a){var s=this._createFeatureSetArray(e);if(a&&a===this._intSearchUniqueID){for(var i=[],n=!1,o=0;!n&&o<s.length;o++){var c=s[o];if(c)for(var u=0;!n&&u<c.features.getLength();u++){var l=c.features.getAt(u);if(l){var p=l.getExtendedPropertyByName("highlights");if(p)for(var h in p)if(p.hasOwnProperty(h)){var d=(p[h]+"").trim();(n=i.length>=this.maxHints)||-1!==i.indexOf(d)||i.push(d)}}}}t.addItems(i.map(function(e){return new C.SearchHintItem(e)}))}for(var g=new I.FeatureSetCollection,m=0,f=s;m<f.length;m++){var S=f[m];this._addFsToFsc(S,g)}var b=new v.SearchProgressEventArgs;b.status=y.Status.IDLE,b.message=this.app.getResource("Mapping","language-search-instant-provider-search-completed"),b.results=g,b.searchType=this.SEARCH_TYPE_HINTS,b.query=r.searchText,this._updateProgress(b)},l.prototype._onGetSearchHintsError=function(e,t,r,a){this.app.trace.warning("InstantSearchProvider: could not retrieve search hints.");var s=new v.SearchProgressEventArgs;s.status=y.Status.ERROR,s.message=this.app.getResource("Mapping","language-search-error").format(e.message),s.searchType=this.SEARCH_TYPE_HINTS,s.query=r.searchText,this._updateProgress(s)},l.prototype._updateProgress=function(e){this.app.event("SearchProgressEvent").publish(e)},l.prototype._createFeatureSetArray=function(e){var t=[];if(e&&!e.error)for(var r=function(r){var a=new c.FeatureSet({esriFeatureSet:new esri.tasks.FeatureSet,layer:r.layer,app:s.app});dojo.forEach(r.features,function(e){var t=new u.Feature({graphic:e.esriFeature,layer:r.layer,resolveLayerFields:!0});e.highlights&&t.setExtendedProperty("highlights",e.highlights),a.addFeature(t,!0)}),t.push(a)},s=this,a=0,i=e.results;a<i.length;a++)r(i[a]);return t},l.prototype._addFsToFsc=function(e,t){var r=this;e&&e.esriFeatureSet&&0!==e.esriFeatureSet.features.length&&(e.resolveDataLinks(function(e){r.app.event("FeatureChangedEvent").publish(e)}),t.featureSets.addItem(e))},l);function l(e,t){var r=a.call(this,e,t)||this;return r.SEARCH_TYPE="InstantSearch",r.SEARCH_TYPE_HINTS="InstantSearchHints",r._canExecute=!1,r._cancelled=!1,r._intSearchUniqueID=0,r.enableSearchHints=!0,r.precedenceToNearbyResults=!0,r.maxResults=50,r.maxHints=5,r.name=r.app.getResource("Mapping","language-search-instant-provider-name"),r.description=r.app.getResource("Mapping","language-search-instant-provider-description"),r.isEnabled=!0,r.supportsHints=!0,r}t.InstantSearchProvider=s})},"Mapping/modules/Search/LayerQuerySearchProvider":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/gis/LayerInfo","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/LayerIntegrationUtils","geocortex/infrastructure/FeatureSet","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/MapUtils"],function(e,t,r,h,d,g,m,f,u,a,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=(s=r.SearchProviderBase,o(n,s),n.prototype.initialize=function(e){s.prototype.initialize.call(this,e)},n.prototype.search=function(a,s){var i=this;if(s=s.trim(),a)if(s)if(this.app.site&&this.app.site.isInitialized){this._cancelFunction&&this._cancelFunction();for(var e=!1,t=0,r=this.app.site.essentialsMap.mapServices;t<r.length;t++)if(r[t].instantSearch){e=!0;break}var n=this._getSearchableLayers();if(0!==n.length){this.status=h.Status.SEARCHING;var o=!1,c=0,u=new d.SearchProgressEventArgs;u.results=a,u.error=null,u.message="",u.searchType=this.SEARCH_TYPE,u.query=s,u.status=this.status,this.app.event("SearchProgress").publish(u),this.app.event("SearchProgressEvent").publish(u);var l=function(t,r){o||r.getFeatureLayer().then(function(e){0<t.features.length&&(r.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&(t.features=t.features.map(function(e){return S.findFeatureInMap(e,i.app.site,r.mapService.serviceLayer)||e})),i._addFsToFsc(t,r,e,a)),++c===n.length?i.status=h.Status.IDLE:i.status=h.Status.SEARCHING,u.status=i.status,i.app.event("SearchProgress").publish(u),i.app.event("SearchProgressEvent").publish(u)})},p=function(e,t){o||(++c===n.length&&(i.status=h.Status.IDLE),i._handleError(e,a,t.displayName))};this._cancelFunction=function(){o||(o=!0,i._cancelFunction=null,i.status=h.Status.IDLE)},n.forEach(function(r){g.LayerInfo.fromGcxLayer(r).getFields().then(function(e){var t=m.getSearchTextWhereClause(r,e,s,i.app.trace);t?r instanceof f.LocalLayer?i._searchLocalLayer(s,r,l,p):i._searchLayer(r,t,l,p):c++},function(e){p(e,r)})})}else e||this._handleWarning(new Error("No layers to search. Make sure you mark some layers as searchable in your site."),a,s)}else this._handleError(new Error("The site needs to be initialized before a search is performed."),a);else this._handleError(new Error("Cannot perform search without search text."),a);else this._handleError(new Error("Cannot perform search without a feature set collection."),a)},n.prototype._getSearchableLayers=function(){for(var e=[],t=0,r=this.app.site.essentialsMap.allLayersAndTables();t<r.length;t++){var a=r[t];a.mapService&&!a.mapService.instantSearch&&a.searchable&&a.inActiveTheme&&this._layerTypeSupported(a)&&e.push(a)}return e},n.prototype._searchLayer=function(t,e,r,a){var s=new esri.tasks.Query;s.where=e,s.outFields=["*"],s.outSpatialReference=this.app.map.spatialReference,s.returnGeometry=!0,m.getQueryTask(t).execute(s,function(e){r(e,t)},function(e){a(e,t)})},n.prototype._searchLocalLayer=function(e,t,r,a){try{var s=e.split(" ").map(function(e){return e.trim()}).filter(function(e){return!!e}).map(function(e){return new RegExp("\\b"+e+"\\b","i")}),i=t.mapService.serviceLayer,n=new esri.tasks.FeatureSet;e:for(var o=0;o<i.graphics.length;o++)for(var c=i.graphics[o],u=function(e){var t=c.attributes[e];if(s.map(function(e){return e.test(t)}).every(function(e){return!!e}))return n.features.push(c),"continue-featureLoop"},l=0,p=Object.keys(c.attributes);l<p.length;l++)switch(u(p[l])){case"continue-featureLoop":continue e}r(n,t)}catch(e){a(e,t)}},n.prototype.cancelSearch=function(){this._cancelFunction&&this._cancelFunction(),this._fscAddHandle&&(clearInterval(this._fscAddHandle),this._fscAddHandle=null),this._fscAddsToProcess=[]},n.prototype._addFsToFsc=function(e,t,r,a){var s=this;if(this._hasAddedToFsc)return this._fscAddsToProcess.push(function(){return s._addFsToFsc(e,t,r,a)}),void(this._fscAddHandle||(this._fscAddHandle=setInterval(function(){return s._doAsyncAdds()})));if(e&&e.features&&0<e.features.length)for(var i=0,n=e.features;i<n.length;i++){var o=n[i];t.mapService&&t.mapService.serviceLayer&&(o._graphicsLayer=t.mapService.serviceLayer)}var c=new u.FeatureSet({esriFeatureSet:e,layer:t,featureLayer:r,app:this.app});c.resolveDataLinks(function(e){s.app.event("FeatureChangedEvent").publish(e)}),a.featureSets.addItem(c),this._hasAddedToFsc=!0},n.prototype._doAsyncAdds=function(){if(0===this._fscAddsToProcess.length)return clearInterval(this._fscAddHandle),this._fscAddHandle=null,void(this._hasAddedToFsc=!1);this._hasAddedToFsc||this._fscAddsToProcess.shift()(),this._hasAddedToFsc=!1},n.prototype._layerTypeSupported=function(e){return!(!e||!e.mapService||e.mapService.mapServiceType!==a.MapServiceType.DYNAMIC&&e.mapService.mapServiceType!==a.MapServiceType.TILED&&e.mapService.mapServiceType!==a.MapServiceType.FEATURE&&e.mapService.mapServiceType!==a.MapServiceType.WMS)},n.prototype._handleWarning=function(e,t,r,a){var s="Layer Search Provider"+(r?" ("+r+"): ":": ")+e.message,i=new d.SearchProgressEventArgs;i.results=t,i.status=h.Status.ERROR,i.error=e,i.message=s,i.searchType=this.SEARCH_TYPE,i.query=a,this.app.trace.warning(s),this.app.event("SearchProgress").publish(i),this.app.event("SearchProgressEvent").publish(i)},n.prototype._handleError=function(e,t,r,a){var s="Layer Search Provider"+(r?" ("+r+"): ":": ")+e.message,i=new d.SearchProgressEventArgs;i.results=t,i.status=h.Status.ERROR,i.error=e,i.message=s,i.searchType=this.SEARCH_TYPE,i.query=a,this.app.trace.error(s),this.app.event("SearchProgress").publish(i),this.app.event("SearchProgressEvent").publish(i)},n);function n(e,t){var r=s.call(this,e,t)||this;return r.SEARCH_TYPE="ArcGIS",r._cancelFunction=null,r._hasAddedToFsc=!1,r._fscAddsToProcess=[],r.name="Query",r.description="Search provider for querying map servers or feature servers.",r.isEnabled=!0,r.supportsOffline=!0,r}t.LayerQuerySearchProvider=i})},"Mapping/modules/Search/SearchHintsView":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FocusUtils"],function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,a=(s=r.ViewBase,o(n,s),n.prototype.attach=function(e){var a=this;s.prototype.attach.call(this,e),this.viewModel&&this.viewModel.expanded.bind(this,function(e){var t=e?"ActivateView":"DeactivateView";if(a.app.command(t).execute(a.id),e){a.app.event("FlyoutActivated").publish(a);var r={view:a,onOtherInteracted:function(e){return a._onOtherInteracted(e)}};a.app.command("TapToDismiss").execute(r)}else a.app.event("FlyoutDeactivated").publish(a)})},n.prototype.handleHintClick=function(e,t,r){r&&r.plainText.get()&&(this._hideAutoComplete(),this.viewModel.searchText.set(r.plainText.get()),this.app.command("GlobalSearch").execute(r.plainText.get()),this.app.event("SearchHintClickedEvent").publish(r))},n.prototype.handleRefineSearchClick=function(e,t,r){r&&r.plainText.get()&&(this._showAutoComplete(),this.viewModel.searchText.set(r.plainText.get()),this.viewModel.updateSearchHints(r.plainText.get()))},n.prototype.handleKeyDown=function(e,t,r){if($(document.activeElement).parent(".hints-list")&&-1<[dojo.keys.DOWN_ARROW,dojo.keys.UP_ARROW,dojo.keys.NUMPAD_2,dojo.keys.NUMPAD_8].indexOf(e.keyCode)){var a=$(this.hintsList).find(".list-menu-button"),s=0;for(s=0;s<a.length&&a[s]!==document.activeElement;s++);if(e.keyCode===dojo.keys.DOWN_ARROW||e.keyCode===dojo.keys.NUMPAD_2)return i.focus(a[++s]),!1;if(e.keyCode===dojo.keys.UP_ARROW||e.keyCode==dojo.keys.NUMPAD_8)return i.focus(a[--s]),!1}return!0},n.prototype._showAutoComplete=function(){this.viewModel.expanded.set(!0)},n.prototype._onOtherInteracted=function(e){this.viewModel.expanded.set(!1)},n.prototype._hideAutoComplete=function(){this.viewModel.expanded.set(!1)},n);function n(e,t){var r=s.call(this,e,t)||this;return r.app.command("FocusOnSearchHint").register(r,function(e){e===dojo.keys.DOWN_ARROW||e===dojo.keys.NUMPAD_2?i.focus($(r.hintsList).find(".list-menu-button")[0]):e!==dojo.keys.UP_ARROW&&e!=dojo.keys.NUMPAD_8||i.focus($(r.hintsList).find(".list-menu-button")[$(r.hintsList).find(".list-menu-button").length-1])}),r}t.SearchHintsView=a})},"Mapping/modules/Search/SearchModule":function(){var a,l=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/essentials/GeocodingEndpoint","./BingGeocodeSearchProvider","geocortex/essentials/RestHelper","./ArcGisGeocodeSearchProvider"],function(e,t,r,s,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,c=(a=r.ModuleBase,l(u,a),u.prototype.initialize=function(e){var t=this;e&&e.searchProviders&&this.app.waitUntilApplicationReady().then(function(){t._loadProviders(e.searchProviders)}),e&&e.hasOwnProperty("autoLoadSiteGeocoders")&&!1===e.autoLoadSiteGeocoders&&(this.autoLoadSiteGeocoders=!1),this.autoLoadSiteGeocoders&&this.app.waitUntilApplicationReady().then(function(){t._loadGeocoders()})},u.prototype._loadProviders=function(e){for(var t=0,r=e;t<r.length;t++){var a=r[t];a&&this._loadProvider(a)}},u.prototype._loadProvider=function(e){var t=e.type,r=dojo.getObject(t);if(r){var a=new r(this.app,e.libraryId||this.libraryId);a.initialize(e.configuration),e.hasOwnProperty("enable")&&(a.isEnabled=e.enable),e.hasOwnProperty("name")&&(a.name=e.name),e.hasOwnProperty("description")&&(a.description=e.description),this.app.command("RegisterSearchProvider").execute(a)}},u.prototype._loadGeocoders=function(){if(this.app.site&&this.app.site.isInitialized&&this.app.site.geocodingEndpoints&&0<this.app.site.geocodingEndpoints.length)for(var e=function(e){if(!e.includeInGlobalSearch)return"continue";if(e.geocoderType===s.GeocodingEndpointType.BING_GEOCODER){var t=new i.BingGeocodeSearchProvider(a.app,a.libraryId);t.libraryId=a.libraryId,t.name=e.displayName,t.iconUri=n.RestHelper.processClientSideTokens(a.app.site,e.iconUri),t.initialize({}),t.bingMapsKey=e.bingProperties.bingMapsKey,e.bingProperties.culture&&(t.culture=e.bingProperties.culture),a.app.command("RegisterSearchProvider").execute(t)}else if(e.geocoderType===s.GeocodingEndpointType.ARCGIS_GEOCODER){var r=new o.ArcGisGeocodeSearchProvider(a.app,a.libraryId);r.libraryId=a.libraryId,r.locatorUrl=e.geocoderUrl,r.token=e.geocoderToken,r.name=e.displayName,r.iconUri=n.RestHelper.processClientSideTokens(a.app.site,e.iconUri),e.featureZoomScale&&(r.defaultZoomScale=e.featureZoomScale),r.parameters=e.parameters,r.globalSearchKey=e.globalSearchKey,r.minimumScore=70,r.initialize({}),a.app.command("RegisterSearchProvider").execute(r),e.geocoderToken&&dojo.subscribe("ServiceTokenRefreshed",function(e){e.serviceUrl===r.locatorUrl&&r.updateToken(e.token)})}},a=this,t=0,r=this.app.site.geocodingEndpoints;t<r.length;t++)e(r[t])},u);function u(){var e=null!==a&&a.apply(this,arguments)||this;return e.autoLoadSiteGeocoders=!0,e}t.SearchModule=c})},"Mapping/modules/Search/SearchTableSearchProvider":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/search/SearchProviderBase","geocortex/infrastructure/eventArgs/SearchProgressEventArgs","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/FeatureSet","geocortex/framework/utils/ArrayUtils","geocortex/framework/utils/utils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/DateFormat","geocortex/essentials/Field"],function(e,t,r,p,h,n,m,f,S,b,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=(a=r.SearchProviderBase,o(i,a),i.prototype.initialize=function(e){a.prototype.initialize.call(this,e)},i.prototype.search=function(s,i){var n=this,o=!1,c=0,u=new p.SearchProgressEventArgs;if(u.results=s,u.error=null,u.searchType=this.SEARCH_TYPE,u.query=i,this.status=h.Status.IDLE,u.status=this.status,s)if(i){var l=this._getSearchableTables();0!==l.length?(this.status=h.Status.SEARCHING,u.status=this.status,this.app.event("SearchProgressEvent").publish(u),l.forEach(function(t){for(var e={},r=0,a=t.parameters.length;r<a;r++)e[t.parameters[r].name]=i;t.performSearch(e,function(e){return function(e,t){o||(0<e.features.length&&n._addFsToFsc(e,t,s),++c===l.length?n.status=h.Status.IDLE:n.status=h.Status.SEARCHING,u.status=n.status,n.app.event("SearchProgressEvent").publish(u))}(e,t)},function(e){return function(e,t){o||(++c===l.length&&(n.status=h.Status.IDLE),n._handleError(e,s,t.displayName))}(e,t)})}),this._cancelFunction=function(){o||(o=!0,n._cancelFunction=null,n.status=h.Status.IDLE)}):setTimeout(function(){return n.app.event("SearchProgressEvent").publish(u)})}else this.app.trace.error("Search Table Search Provider: Cannot perform search without search text.");else this.app.trace.error("Search Table Search Provider: Cannot perform search without a feature set collection.")},i.prototype._getSearchableTables=function(){for(var e=[],t=0,r=this.app.site.searchTables.length;t<r;t++){var a=this.app.site.searchTables[t];a.includeInGlobalSearch&&e.push(a)}return e},i.prototype._addFsToFsc=function(e,t,r){var d=new n.FeatureSet({esriFeatureSet:e,app:this.app,id:t.displayName||t.id});d.displayName.set(t.displayName),d.features.getItems().forEach(function(e){e.descriptionFormat.set(t.featureDescription),e.longDescriptionFormat.set(t.featureLongDescription),e.labelFormat.set(t.featureLabel),e.iconUri.set(t.iconUri),e.setExtendedProperty("SearchTableId",t.id)});for(var a=function(t){for(var e=[],r=[],a=0,s=d.features.getItems();a<s.length;a++){var i=s[a];if(h=m.firstOrDefault(i.attributes.getItems(),function(e){return e.name.get()===t.name.get()})){var n=h.value.get();if(f.isNullOrUndefined(n)||""===n){r.push(i);continue}if(u=g._dotNetDateRegex.exec(n)){e.push(i);continue}}break}if(0<e.length&&e.length+r.length===d.features.getLength()){t.type.set(y.EssentialsFieldTypes.essentialsFieldTypeDate);for(var o=0,c=e;o<c.length;o++){var u;i=c[o],n=(h=m.firstOrDefault(i.attributes.getItems(),function(e){return e.name.get()===t.name.get()})).value.get(),(u=g._dotNetDateRegex.exec(n))&&(h.value.set(u[1]),h.presentableValue.set(S.formatDate(S.parseDate(u[1]),b.DateFormat.DEFAULT)),h.type.set(y.EssentialsFieldTypes.essentialsFieldTypeDate))}for(var l=0,p=r;l<p.length;l++){var h;i=p[l],(h=m.firstOrDefault(i.attributes.getItems(),function(e){return e.name.get()===t.name.get()})).type.set(y.EssentialsFieldTypes.essentialsFieldTypeDate)}}},g=this,s=0,i=d.attributes.getItems();s<i.length;s++)a(i[s]);r.featureSets.addItem(d)},i.prototype.cancelSearch=function(){this._cancelFunction&&this._cancelFunction()},i.prototype._handleError=function(e,t,r,a){var s="Search Table Search Provider"+(r?" ("+r+"): ":": ")+e.message,i=new p.SearchProgressEventArgs;i.results=t,i.status=h.Status.ERROR,i.error=e,i.message=s,i.searchType=this.SEARCH_TYPE,i.query=a,this.app.trace.error(s),this.app.event("SearchProgressEvent").publish(i)},i);function i(e,t){var r=a.call(this,e,t)||this;return r.SEARCH_TYPE="SearchTable",r._cancelFunction=null,r._dotNetDateRegex=/^\/Date\(([-]?[0-9]+)\)\/$/,r.name="Search Table",r.description="Search provider for Search Tables.",r.isEnabled=!0,r}t.SearchTableSearchProvider=s})},"Mapping/modules/Search/SearchView":function(){var a,c=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/TimeDelayedOperation","geocortex/infrastructure/FocusUtils"],function(e,t,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=r.ViewBase,c(o,i),o.prototype.attach=function(e){var t=this;if(i.prototype.attach.call(this,e),this.viewModel){var r=this.viewModel.minimumPopulateDelay;this._keyDownTimer=new a.TimeDelayedAction(r,this._requestSearchHints,this),this.app.event("FSMCollectionClosedEvent").subscribe(this,function(e){"SearchResultsCollection"===e.featureSetCollectionId&&($(t.inputElement).prop("disabled",!1),t.viewModel.searchDisabled=!1)}),this.app.event("SearchHintClickedEvent").subscribe(this,function(e){return t._delayConsecutiveSearches()}),this.app.command("FocusSearch").register(this,this._executeFocusSearch)}},o.prototype._executeFocusSearch=function(){this.app.command("FocusOnFirstInputInView").execute(this)},o.prototype.handleKeyDown=function(e,t,r){var a=e.which?e.which:e.keyCode;if(this._isUpOrDownKey(a)&&0!==this.viewModel.searchHints.length()&&this.app.command("FocusOnSearchHint").execute(a),this._isSpecialChar(a))return!0;if(this._resetKeyDownTimer(a),a===dojo.keys.ENTER){if(this.viewModel.searchDisabled)return!0;this._hideAutoComplete(),this.app.command("GlobalSearch").execute(t.value),this._delayConsecutiveSearches(),e.preventDefault()}return!0},o.prototype.handleSearchClick=function(e,t,r){this._hideAutoComplete();var a=this.viewModel.searchText.get();a&&!this.viewModel.searchDisabled&&(this.app.command("GlobalSearch").execute(a),this._delayConsecutiveSearches())},o.prototype._delayConsecutiveSearches=function(){var e=this;this.viewModel.delayConsecutiveSearches&&($(this.inputElement).prop("disabled",!0),this.viewModel.searchDisabled=!0,setTimeout(function(){$(e.inputElement).prop("disabled",!1),e.viewModel.searchDisabled=!1},this.viewModel.consecutiveSearchDelay))},o.prototype.handleDoubleClick=function(){this._hideAutoComplete()},o.prototype._isSpecialChar=function(e){switch(e){case dojo.keys.TAB:case dojo.keys.SHIFT:case dojo.keys.CTRL:case dojo.keys.ALT:case dojo.keys.PAUSE:case dojo.keys.CAPS_LOCK:case dojo.keys.ESCAPE:case dojo.keys.PAGE_UP:case dojo.keys.PAGE_DOWN:case dojo.keys.END:case dojo.keys.HOME:case dojo.keys.LEFT_ARROW:case dojo.keys.UP_ARROW:case dojo.keys.RIGHT_ARROW:case dojo.keys.DOWN_ARROW:case dojo.keys.NUM_LOCK:case dojo.keys.SCROLL_LOCK:return!0}return!1},o.prototype._isUpOrDownKey=function(e){switch(e){case dojo.keys.UP_ARROW:case dojo.keys.DOWN_ARROW:return!0}return!1},o.prototype._resetKeyDownTimer=function(e){this._keyDownTimer.stop(),e!==dojo.keys.ENTER&&this._keyDownTimer.start()},o.prototype._requestSearchHints=function(){var e=this.viewModel,t=e.searchText.get();null===t||t.length<e.minimumPrefixLength||""==t.replace(/ /g,"")?(this._hideAutoComplete(),e.clearSearchHints()):(this._showAutoComplete(),e.updateSearchHints(t))},o.prototype._showAutoComplete=function(){this.viewModel.expanded.set(!0),s.focus(this.inputElement)},o.prototype._hideAutoComplete=function(){this.viewModel.expanded.set(!1)},o);function o(e,t){var r=i.call(this,e,t)||this;return r._keyDownTimer=null,r}t.SearchView=n})},"Mapping/modules/Search/SearchViewModel":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=(s=r.ViewModelBase,o(n,s),n.prototype.initialize=function(e){e&&e.hasOwnProperty("enableSearchRefinement")&&this.enableSearchRefinement.set(e.enableSearchRefinement),e&&e.hasOwnProperty("minimumPopulateDelay")&&(this.minimumPopulateDelay=parseInt(e.minimumPopulateDelay)),e&&e.hasOwnProperty("minimumPrefixLength")&&(this.minimumPrefixLength=parseInt(e.minimumPrefixLength)),e&&e.hasOwnProperty("consecutiveSearchDelay")&&(this.consecutiveSearchDelay=parseInt(e.consecutiveSearchDelay)),e&&e.hasOwnProperty("delayConsecutiveSearches")&&(this.delayConsecutiveSearches=e.delayConsecutiveSearches),this.app.command("EnableSearchRefinement").register(this,this._executeEnableSearchRefinementCommand)},n.prototype.clearSearchHints=function(){this.searchHints.clear()},n.prototype.updateSearchHints=function(e){this.clearSearchHints(),this.app.searchManager.getSearchHints(this.searchHints,e)},n.prototype._onSiteInitialized=function(e){this.enableUI.set(!0)},n.prototype._executeEnableSearchRefinementCommand=function(e){this.enableSearchRefinement.set(e||!1)},n);function n(e,t){var r=s.call(this,e,t)||this;return r.enableSearchRefinement=new a.Observable(!0),r.minimumPopulateDelay=300,r.consecutiveSearchDelay=1e4,r.delayConsecutiveSearches=!1,r.minimumPrefixLength=3,r.searchText=new a.Observable(""),r.enableUI=new a.Observable(!1),r.expanded=new a.Observable(!1),r.searchDisabled=!1,r.searchHints=new a.ObservableCollection,r.app.site&&r.app.site.isInitialized?r._onSiteInitialized(r.app.site):r.app.event("SiteInitializingEvent").once(r,r._onSiteInitialized),r}t.SearchViewModel=i})},"url:/Mapping/modules/Search/SearchHintsView.html":t,"url:/Mapping/modules/Search/SearchView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/common.css","css","Lmdsb2JhbC1zZWFyY2ggaW5wdXRbdHlwZT0idGV4dCJdIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiAzcHggMzBweCA0cHggOXB4Ow0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGZvbnQtc2l6ZTogMS42ZW07DQogICAgY29sb3I6ICM0NDQ0NDQ7DQogICAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOw0KICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwKTsNCiAgICBmb250LXdlaWdodDogbGlnaHRlcjsNCn0NCg0KLmdsb2JhbC1zZWFyY2ggaW5wdXQ6Zm9jdXMgew0KICAgIC13ZWJraXQtdXNlci1tb2RpZnk6IHJlYWQtd3JpdGUtcGxhaW50ZXh0LW9ubHk7IC8qIEFuZHJvaWQgMy4wKyBmaXggKi8NCn0NCg0KLmhpbnRzLWxpc3Qgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0JCQkJCQjsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pY29uIHsNCiAgICBmb250LXNpemU6IDEuMjVlbTsNCiAgICB3aWR0aDogMWVtOw0KICAgIGhlaWdodDogMWVtOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBhZGRpbmc6IDA7DQp9DQouaGludHMtbGlzdCAucmVmaW5lLWRpc2FibGVkIC5saXN0LW1lbnUtaXRlbSAuY29udGVudCB7DQogICAgbWFyZ2luLXJpZ2h0OiAwOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50IHsNCiAgICBtYXJnaW4tcmlnaHQ6IDJlbTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmhpbnRzLWxpc3QgLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbWFyZ2luLWxlZnQ6IDA7DQogICAgcGFkZGluZy1sZWZ0OiAwLjVlbTsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBtYXgtd2lkdGg6IDI3ZW07DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmxpc3QtbWVudSBsaTpsYXN0LWNoaWxkIHsNCiAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMC4yNXJlbTsNCiAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwLjI1cmVtOw0KfQ0KLmxpc3QtbWVudS1idXR0b24gew0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KLnJlZmluZS1kaXNhYmxlZCAucmVmaW5lLWNvbnRhaW5lciB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCi5yZWZpbmUtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAwOw0KICAgIHdpZHRoOiAyLjVlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNFRUVFRUU7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNFRUVFRUU7DQp9DQoucmVmaW5lLWJ0biB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9zZWFyY2gtcmVmaW5lLTE2LnBuZyIpOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQouZ2xvYmFsLXNlYXJjaCAuc2VhcmNoLWJ1dHRvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMXB4Ow0KICAgIHJpZ2h0OiAxcHg7DQogICAgYm90dG9tOjFweDsNCiAgICB3aWR0aDogNDBweDsNCiAgICAvKmhlaWdodDogMTAwJTsqLw0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvc2VhcmNoLTI0LnBuZykgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1pbmRlbnQ6IC05OTllbTsNCn0NCg0KLlNlYXJjaEhpbnRzVmlldyBlbSB7DQogICAgZm9udC1zdHlsZTogbm9ybWFsOw0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/large.css","css","DQovKiBHTE9CQUwgU0VBUkNIIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5TZWFyY2hWaWV3LCAuU2VhcmNoVmlldy5hY3RpdmUgew0KICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgbWFyZ2luLXJpZ2h0OiAwLjVlbTsNCiAgICB3aWR0aDogMjBlbTsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5nbG9iYWwtc2VhcmNoIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgei1pbmRleDogMDsNCn0NCg0KLmdsb2JhbC1zZWFyY2ggLnNlYXJjaC1ib3ggew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLnNlYXJjaC1oaW50cy1yZWdpb24gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICB6LWluZGV4OiAyMDA7DQp9DQoNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtaXRlbSAuY29udGVudDpob3ZlciwNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtaXRlbSAubGlzdC1tZW51LWJ1dHRvbjpmb2N1cyB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Y3RjdGNzsNCn0NCg0KLmhpbnRzLWxpc3QgLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbWF4LXdpZHRoOiAxNWVtOw0KfQ0KDQouaGludHMtbGlzdCAuaGFzLWljb24ucmVmaW5lLWRpc2FibGVkIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5yZWZpbmUtZGlzYWJsZWQgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBtYXgtd2lkdGg6IDE4ZW07DQp9DQoNCi5yZWZpbmUtYnRuIHsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9NTApOw0KICAgIG9wYWNpdHk6IDAuNTA7DQp9DQoNCi5yZWZpbmUtYnRuOmhvdmVyIHsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MTAwKTsNCiAgICBvcGFjaXR5OiAxOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/medium.css","css","DQovKiBHTE9CQUwgU0VBUkNIIChNRURJVU0pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KDQouU2VhcmNoVmlldywgLlNlYXJjaFZpZXcuYWN0aXZlIHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgIG1hcmdpbi1yaWdodDogMC41ZW07DQogICAgd2lkdGg6IDE4ZW07DQogICAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQouZ2xvYmFsLXNlYXJjaCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouZ2xvYmFsLXNlYXJjaCAuc2VhcmNoLWJveCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouc2VhcmNoLWhpbnRzLXJlZ2lvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIHotaW5kZXg6IDIwMDsNCn0NCi5oaW50cy1saXN0IHsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50IHsNCiAgICBtYXJnaW4tcmlnaHQ6IDMuMjVlbTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KfQ0KDQouaGludHMtbGlzdCAubGlzdC1tZW51LWljb24gew0KICAgIGZvbnQtc2l6ZTogMS44NzVlbTsNCn0NCg0KLmhpbnRzLWxpc3QgLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbGluZS1oZWlnaHQ6IDEuODc1ZW07DQogICAgbWF4LXdpZHRoOiAxMmVtOw0KfQ0KDQouaGludHMtbGlzdCAuaGFzLWljb24ucmVmaW5lLWRpc2FibGVkIC5saXN0LW1lbnUtZGV0YWlscywNCi5oaW50cy1saXN0IC5yZWZpbmUtZGlzYWJsZWQgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBtYXgtd2lkdGg6IDE2ZW07DQp9DQoNCi5yZWZpbmUtY29udGFpbmVyIHsNCiAgICB3aWR0aDogNGVtOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/CSS/small.css","css","DQovKiBHTE9CQUwgU0VBUkNIIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5nbG9iYWwtc2VhcmNoIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQp9DQouZ2xvYmFsLXNlYXJjaCAuc2VhcmNoLWJveCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KLnNlYXJjaC1oaW50cy1yZWdpb24gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICB6LWluZGV4OiAzMDA7DQp9DQouc2VhcmNoLWhpbnRzLXJlZ2lvbiAuU2VhcmNoSGludHNWaWV3IHsNCiAgICByaWdodDogLTMuM2VtOw0KICAgIGxlZnQ6IC05LjNlbTsNCn0NCi5zaGVsbC1zbWFsbCAucmVnaW9uLmhlYWRlci1yZWdpb24gLnZpZXcuU2VhcmNoSGludHNWaWV3LmluYWN0aXZlIHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50OmhvdmVyLA0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5saXN0LW1lbnUtYnV0dG9uOmZvY3VzIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRjdGN0Y3Ow0KfQ0KLnJlZmluZS1idG4gew0KICAgIGZpbHRlcjogYWxwaGEob3BhY2l0eT01MCk7DQogICAgb3BhY2l0eTogMC41MDsNCn0NCi5yZWZpbmUtYnRuOmhvdmVyIHsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MTAwKTsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KLmhpbnRzLWxpc3Qgew0KICAgIGJvcmRlci1yYWRpdXM6IDA7DQogICAgYm9yZGVyOiBub25lOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pdGVtIC5jb250ZW50IHsNCiAgICBtYXJnaW4tcmlnaHQ6IDRlbTsNCiAgICBwYWRkaW5nOiAuNGVtOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1pY29uIHsNCiAgICBmb250LXNpemU6IDIuNWVtOw0KfQ0KLmhpbnRzLWxpc3QgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBsaW5lLWhlaWdodDogMi41ZW07DQp9DQoucmVmaW5lLWNvbnRhaW5lciB7DQogICAgd2lkdGg6IDMuMmVtOw0KfQ0K"),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/small.css","css","DQouc21hbGwgLmdsb2JhbC1zZWFyY2gNCnsNCiAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIG1hcmdpbjogOHB4Ow0KICAgIHBhZGRpbmc6IDVweCAzMHB4IDVweCA1cHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouc21hbGwgLmdsb2JhbC1zZWFyY2ggaW5wdXQNCnsNCiAgICBmb250LXNpemU6IDEuMmVtOw0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBtYXJnaW46IDAgMzBweCAwIDA7DQogICAgb3V0bGluZTogbm9uZTsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLnNtYWxsIC5nbG9iYWwtc2VhcmNoIGJ1dHRvbg0Kew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvc2VhcmNoLTI0LnBuZykgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICByaWdodDogMDsNCiAgICB0b3A6IDA7DQogICAgd2lkdGg6IDMwcHg7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQp9DQoNCkBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDgwMHB4KQ0Kew0KICAgIC5zbWFsbCAuZ2xvYmFsLXNlYXJjaA0KICAgIHsNCiAgICAgICAgd2lkdGg6IGF1dG87DQogICAgfQ0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/SearchHintsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Search/SearchView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Search/ArcGisGeocodeSearchProvider","Mapping/modules/Search/BingGeocodeSearchProvider","Mapping/modules/Search/InstantSearchProvider","Mapping/modules/Search/LayerQuerySearchProvider","Mapping/modules/Search/SearchHintsView","Mapping/modules/Search/SearchModule","Mapping/modules/Search/SearchTableSearchProvider","Mapping/modules/Search/SearchView","Mapping/modules/Search/SearchViewModel"],function(e,t,r,a,s,i,n,o,c){u(e,"geocortex.essentialsHtmlViewer.mapping.modules.search.ArcGisGeocodeSearchProvider",e.ArcGisGeocodeSearchProvider),u(t,"geocortex.essentialsHtmlViewer.mapping.modules.search.BingGeocodeSearchProvider",t.BingGeocodeSearchProvider),u(r,"geocortex.essentialsHtmlViewer.mapping.modules.search.InstantSearchProvider",r.InstantSearchProvider),u(a,"geocortex.essentialsHtmlViewer.mapping.modules.search.LayerQuerySearchProvider",a.LayerQuerySearchProvider),u(s,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchHintsView",s.SearchHintsView),u(i,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchModule",i.SearchModule),u(n,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchTableSearchProvider",n.SearchTableSearchProvider),u(o,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchView",o.SearchView),u(c,"geocortex.essentialsHtmlViewer.mapping.modules.search.SearchViewModel",c.SearchViewModel)})}();