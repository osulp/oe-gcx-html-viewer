!function(){function e(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var r=t.split("."),a=null,n=window,o=0,s=r.length;o<s;o++)a=r[o],o==s-1?n[a]=i:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+t)}var t="<div class='view-feature-create-or-edit content-container'>    <p class='description-text' data-binding='{@text: @language-feature-editing-create-edit-no-features-found}'></p>    <ul class='action-btns'>        <li>            <button class='button button-action-icon create-new-feature' data-binding='{@event-onclick: handleClickCreateNewFeature}'><img src='Resources/Images/Icons/Toolbar/feature-create-24.png' data-binding='{alt: @language-feature-editing-create-edit-new-feature}{title: @language-feature-editing-create-edit-new-feature}'><span data-binding='{@text: @language-feature-editing-create-edit-new-feature}'></span></button>        </li>        <li>            <button class='button button-action-icon existing-feature' data-binding='{@event-onclick: handleClickSelectExistingFeature}'><img src='Resources/Images/Icons/Toolbar/feature-location-24.png' data-binding='{alt: @language-feature-editing-create-edit-select-existing-feature}{title: @language-feature-editing-create-edit-select-existing-feature}'><span data-binding='{@text: @language-feature-editing-create-edit-select-existing-feature}'></span></button>        </li>    </ul></div>",i="<div class='editor'>    \x3c!-- APPLY EDITS --\x3e    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: @language-feature-editing-applying}'></div>    </div>    \x3c!-- ADD/EDIT FORM --\x3e    <div class='add-or-edit-feature' data-binding='{@hidden: isBusy}'>        <div class='panel-content'>           \x3c!-- has geometry -- >           \x3c!-- <div class='panel-notification' data-binding='{@visible: hasGeometry}'>                        <span data-binding='{@text: @language-feature-editing-has-geometry}'></span>                    </div>--\x3e            <div data-binding='{@source: form}'>                <div data-binding='{@template-for: form}'>                                        \x3c!-- 'This feature has no editable fields.' --\x3e                    <div class='panel-notification' data-binding='{@hidden: fields}'>                        <span data-binding='{@text: @language-feature-editing-invalid-layer}'></span>                    </div>                    <div class='panel-group' data-binding='{@visible: fields}'>                        <h3 data-binding='{@text: @language-feature-editing-feature-attributes}'></h3>                        <div class='panel-group-contents'>                            <div class='form label-stacked'>                                <div class='form-container' data-binding='{@source: fields}{@template-selector: renderType}'>                                    \x3c!-- DATE PICKER --\x3e                                    <div class='form-item' data-binding='{@template-select: esriFieldTypeDate}{@visible: editable}'>                                        <label class='form-label'>                                            <span data-binding='{@text: displayName}'></span>                                        </label>                                        <div class='form-control-date-picker' data-binding='{@widget: DatePickerFormItem}{@widget-context: datePickerViewModel}'>                                        </div>                                    </div>                                    \x3c!-- CODED DOMAIN VALUE TEMPLATE --\x3e                                    <div class='form-item' data-binding='{@template-select: codedDomainValue}{@visible: editable}'>                                        <div class='combobox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <select data-binding='{@source: valueOptions}{@value: value}{@disabled: readOnly}'>                                                    <option data-binding='{@template-for: valueOptions}{@text: name}{value: code}'></option>                                                </select>                                            </div>                                        </div>                                    </div>                                    \x3c!-- SUBCLASS TEMPLATE --\x3e                                    <div class='form-item' data-binding='{@template-select: typeField}{@visible: editable}'>                                        <div class='combobox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <select data-binding='{@source: valueOptions}{@value: value}{@event-onchange: handleTypeFieldChange}{@disabled: readOnly}'>                                                    <option data-binding='{@template-for: valueOptions}{@text: name}{value: code}'></option>                                                </select>                                            </div>                                        </div>                                    </div>                                    \x3c!-- LARGE TEXT FIELDS --\x3e                                    <div class='form-item' data-binding='{@template-select: textArea}{@visible: editable}'>                                        <div class='textbox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <textarea type='text' data-binding='{@value: presentableValue}{@disabled: readOnly}{@event-onblur: handleInputBlur}{@event-onfocus: handleInputFocus}'></textarea>                                            </div>                                        </div>                                    </div>                                    \x3c!-- FIELDS --\x3e                                    <div class='form-item' data-binding='{@template-for: fields}{@visible: editable}'>                                        <div class='textbox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <input type='text' data-binding='{@value: presentableValue}{@disabled: readOnly}{@event-onblur: handleInputBlur}{@event-onfocus: handleInputFocus}' />                                            </div>                                        </div>                                    </div>                                </div>                                \x3c!-- VALIDATION --\x3e                                <ul class='form-validation' data-binding='{@source: validationMessages}{@visible: validationMessages}'>                                    <li data-binding='{@template-for: validationMessages}'>                                        <span data-binding='{@text: @context}'></span>                                    </li>                                </ul>                            </div>                        </div>                    </div>                </div>            </div>            \x3c!-- BUTTONS --\x3e            <div class='panel-group-contents form-btns'>                <button class='button' data-binding='{@event-onclick: handleClickEditGeometry}{@visible: showEditGeometryButton}{@text: @language-feature-editing-edit-geometry-caption}'></button>                <button class='button' data-binding='{@event-onclick: handleClickEditGeometry}{@visible: showStopEditingGeometryButton}{@text: @language-feature-editing-stop-editing-geometry-caption}'></button>                <button class='button' data-binding='{@event-onclick: handleClickDeleteFeature}{@visible: canDeleteFeature}{@text: @language-common-delete}'></button>                <button class='button' data-binding='{@event-onclick: handleClickSave}{@text: @language-common-save}'></button>                <button class='button' data-binding='{@event-onclick: handleClickCancel}{@text: @language-common-cancel}'></button>            </div>        </div>    </div></div>",r="<div class='feature-template has-icon' data-binding='{@event-onclick: handleFeatureTemplateClick}'>    <img class='list-menu-icon' data-binding='{@visible: symbolUri}{src: symbolUri}' alt=' '/>    <div class='list-menu-icon' data-binding='{@hidden: symbolUri}{innerHTML: swatchElement}'></div>    <button class='list-menu-details'>        <strong class='list-menu-name' data-binding='{@text: name}'></strong>        <span class='list-menu-desc' data-binding='{@text: description}{@visible: description}'></span>    </button></div>",a="<div class='feature-template-picker'>    \x3c!-- TEMPLATES --\x3e    <div class='panel-group no-item' data-binding='{@hidden: layerTemplates}{@text: @language-feature-editing-no-templates}'></div>    <div class='panel-group' data-binding='{@source: layerTemplates}'>        <div data-binding='{@template-for: layerTemplates}{@visible: layerIsEditable}'>            <h3 data-binding='{@text: displayName}'></h3>            <div data-binding='{@hidden: notAvailableReason}'>                <div class='no-results' data-binding='{@hidden: templates}'>                    <span data-binding='{@text: @language-feature-editing-no-templates}'></span>                    <div class='form-button-container'>                        <div class='form-button-align'>                            <div class='form-item form-btns'>                                <button class='button' data-binding='{@text: @language-feature-editing-add-feature-button}{@event-onclick: handleFeatureTemplateClick}'></button>                            </div>                        </div>                    </div>                </div>                <ul class='list-menu' data-binding='{@visible: templates}{@source: templates}{@template-selector: foo}'>                    <li class='list-menu-item' data-binding='{@template-select: @null}{@template: Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html}'></li>                </ul>            </div>            <div data-binding='{@visible: notAvailableReason}'>                <div class='no-results'>                    <span data-binding='{@text: notAvailableReason}'></span>                </div>            </div>        </div>    </div></div>";require({cache:{"Mapping/modules/Editing/BinTool":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.decodeArrayBuffer=function(e){var t=Math.ceil(3*e.length/4),i=new ArrayBuffer(t);return this.decode(e,i),i},e.decode=function(e,t){var i=this._keyStr.indexOf(e.charAt(e.length-1)),r=this._keyStr.indexOf(e.charAt(e.length-1)),a=Math.ceil(3*e.length/4);64==i&&a--,64==r&&a--;var n,o,s,l,d,u,p,c=0,h=0;for(n=t?new Uint8Array(t):new Uint8Array(a),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),c=0;c<a;c+=3)o=this._keyStr.indexOf(e.charAt(h++))<<2|(d=this._keyStr.indexOf(e.charAt(h++)))>>4,s=(15&d)<<4|(u=this._keyStr.indexOf(e.charAt(h++)))>>2,l=(3&u)<<6|(p=this._keyStr.indexOf(e.charAt(h++))),n[c]=o,64!=u&&(n[c+1]=s),64!=p&&(n[c+2]=l);return n},e}();i._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.BinTool=i})},"Mapping/modules/Editing/CoreEditCommands":function(){define(["require","exports","geocortex/essentials/MapService","geocortex/essentials/RestHelperHTTPService","geocortex/framework/utils/utils","./BinTool"],function(e,t,i,r,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.registerCommands=function(){this.app.commandRegistry.command("CreateFeature").register(this,this._executeCreateFeature),this.app.commandRegistry.command("UpdateFeature").register(this,this._executeUpdateFeature),this.app.commandRegistry.command("DeleteFeature").register(this,this._executeDeleteFeature),this.app.commandRegistry.command("CreateRelatedRecord").register(this,this._executeCreateRelatedRecord),this.app.commandRegistry.command("UpdateRelatedRecord").register(this,this._executeUpdateRelatedRecord),this.app.commandRegistry.command("DeleteRelatedRecord").register(this,this._executeDeleteRelatedRecord),this.app.commandRegistry.command("CreateAttachment").register(this,this._executeCreateAttachment),this.app.commandRegistry.command("DeleteAttachments").register(this,this._executeDeleteAttachments)},e.prototype._executeCreateFeature=function(e){var t=this._getMapService(e.mapService);t?e.feature&&this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[e.feature],updates:[],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._executeUpdateFeature=function(e){var t=this._getMapService(e.mapService);t?this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[],updates:[e.feature],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._getMapService=function(e){return"string"==typeof e?this.app.site.essentialsMap.findMapServiceById(e):e},e.prototype._executeDeleteFeature=function(e){var t=this._getMapService(e.mapService);t?e.feature&&this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[],updates:[],deletions:[e.feature],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._executeCreateRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[e.feature],updates:[],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback})},e.prototype._executeUpdateRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[],updates:[e.feature],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback})},e.prototype._executeDeleteRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[],updates:[],deletions:[e.feature],successCallback:e.successCallback,errorCallback:e.errorCallback})},e.prototype._applyFeatureLayerEdits=function(e){if(e){var t=e.mapService,r=e.layer;if(t)r=t.serviceLayer;else{if(!r)return void this.app.trace.warning("Cannot apply edits: Missing map service and/or layer in edit descriptor.");(t=new i.MapService(r.url)).serviceLayer=r}var a=e.additions||[],n=e.updates||[],o=e.deletions||[],s=e.successCallback||function(){},l=e.errorCallback||function(){};r.applyEdits(a,n,o).then(function(e,t,i){var n=null;if(t&&t.length>0)for(d=0;d<t.length;++d){var o=t[d];if(!o.success){n=o.error;break}}if(e&&e.length>0)for(var d=0;d<e.length;++d){var u=e[d];if(!u.success){n=u.error;break}u.GID&&r.globalIdField&&(a[d].attributes[r.globalIdField]=u.GID)}n?l((n||{message:"Editing operation was not successful"}).message):s&&s()},function(e){l(e)})}},e.prototype._executeCreateAttachment=function(e){var t=this._getFeatureUrl(e.layer,e.feature);e.featureUrl=t,this._syncAttachmentToServer(e.featureUrl,e.filename,e.contentType,e.payload,e.callback)},e.prototype._executeDeleteAttachments=function(e){this._getFeatureUrl(e.layer,e.feature);var t=e.feature.attributes[e.layer.objectIdField];e.layer.deleteAttachments(t,e.attachmentIds,e.callback,e.errback)},e.prototype._getFeatureUrl=function(e,t){var i=t.attributes[e.objectIdField],r=e.url;return r.indexOf("?")>-1?r.replace("?","/{0}?".format(i)):"{0}/{1}".format(r,i)},e.prototype._syncAttachmentToServer=function(e,t,i,o,s){this.app.trace.debug("--- _syncAttachmentToServer called");try{for(var l=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),r=0,a=e.length;r<a;r++)i[r]=e.charCodeAt(r)%255;return i},d=e.lastIndexOf("/"),u=e.substring(0,d),p=this.app.map.graphicsLayerIds,c=null,h=0;h<p.length;h++){var g=p[h],f=this.app.map.getLayer(g);if(f.url){var m=f.url.match(/^(.[^?]*)/);if(m&&m[0]===u){c=f;break}}}c||(c=new esri.layers.FeatureLayer(e.replace(/\/\d$/g,""))),e.indexOf("?")>-1?e=e.replace("?","/addattachment?"):e+="/addAttachment",this.app.isOffline.get()&&this.app.command("RewriteUrlForOffline").execute(e,function(t){e=t});var y=null;if(c.credential&&c.credential.token)y=c.credential.token;else{var v=c.url.match(/token=([^\?&$]*)/);v&&(y=v[1])}if(y&&-1===e.indexOf(y)&&(e=r.RestHelperHTTPService.appendTokenToUrl(e,y)),this.app.configuration.proxyUri){var b=a.makeUrlAbsolute(this.app.configuration.proxyUri);e=b+e}this.app.trace.debug("--- Creating XHR");var E=new XMLHttpRequest;E.open("POST",e,!0),E.setRequestHeader("Content-Type","multipart/form-data; boundary=---------------------------L4717uD3G30"),E.responseType="",E.onload=s,this.app.trace.debug("--- Creating request preamble");var F="-----------------------------L4717uD3G30\r\n"+'Content-Disposition: form-data; name="attachment"; filename="{0}";\r\n'.format(t)+"Content-Type: {0}".format(i)+"\r\n\r\n";this.app.trace.debug("--- Encoding request preamble");var _=l(F);this.app.trace.debug("--- Encoding request payload");var w=n.BinTool.decode(o);this.app.trace.debug("--- Creating request suffix");this.app.trace.debug("--- Encoding request suffix");var C=l('\r\n-----------------------------L4717uD3G30\r\nContent-Disposition: form-data; name="gdbVersion"\r\n\r\n\r\n-----------------------------L4717uD3G30\r\nContent-Disposition: form-data; name="f"\r\n\r\njson\r\n-----------------------------L4717uD3G30--\r\n');this.app.trace.debug("--- Creating payload buffer");var I=new ArrayBuffer(_.length+w.length+C.length),G=new Uint8Array(I),S=0;for(this.app.trace.debug("--- Merging output buffers"),h=0;h<_.length;h++,S++)G[S]=255&_[h];for(h=0;h<w.length;h++,S++)G[S]=255&w[h];for(h=0;h<C.length;h++,S++)G[S]=255&C[h];this.app.trace.debug("--- Sending request"),E.send(G.buffer)}catch(e){this.app.trace.error("--- ERROR: {0}".format(e.toString())),s&&s(e)}},e}();t.CoreEditCommands=o})},"Mapping/modules/Editing/DisplayResultPickerFeature":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/Feature","geocortex/framework/observables"],function(t,i,r,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i}(r.Feature);i.DisplayResultPickerFeature=n,i.generateDisplayResultPickerFeaturefromFeature=function(e){return e.isSelected=new a.Observable(!1),e.cssClass=new a.Observable(""),e.isFiltered=new a.Observable(!1),e.showIcon=!0,e.showCheckbox=!0,e}})},"Mapping/modules/Editing/EditingModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/application/ModuleBase","./CoreEditCommands","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GeometryUtils","./Undoable/Add","./Undoable/Update","./Undoable/Delete","./Undoable/AddAndUpdate","./Undoable/DeleteAndUpdate","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(t,i,r,a,n,o,s,l,d,u,p,c,h,g){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var f;!function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Delete=2]="Delete",e[e.Cut=3]="Cut",e[e.Explode=4]="Explode",e[e.Union=5]="Union"}(f=i.EditGraphicType||(i.EditGraphicType={}));var m=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._hasGeometry=!1,e._editorDeactivatedHandle=null,e._isEditingGeometry=!1,e}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this._registerCommands(),this._registerEvents()},i.prototype._registerCommands=function(){this.app.command("SetEditorFeatureGeometry").register(this,this._executeSetEditorFeatureGeometry,this._canExecuteSetEditorFeatureGeometry),this.app.command("StartEditingGraphicGeometry").register(this,this._executeStartEditingGeometry,this._canExecuteStartEditingGeometry),this.app.command("StopEditingGraphicGeometry").register(this,this._executeStopEditingGeometry,this._canExecuteStopEditingGeometry),new a.CoreEditCommands(this.app,this.libraryId).registerCommands(),this.app.command("StopFeaturePlacementState").register(this,this._executeStopFeaturePlacementState,this._canExecuteStopFeaturePlacementState),this.app.command("CreateGraphicsInMemory").register(this,this._executeCreateGraphicsInMemory),this.app.command("UpdateGraphicsInMemory").register(this,this._executeUpdateGraphicsInMemory),this.app.command("DeleteGraphicsInMemory").register(this,this._executeDeleteGraphicsInMemory),this.app.command("CutGraphicsInMemory").register(this,this._executeCutGraphicsInMemory),this.app.command("ExplodeGraphicsInMemory").register(this,this._executeExplodeGraphicsInMemory),this.app.command("UnionGraphicsInMemory").register(this,this._executeUnionGraphicsInMemory)},i.prototype._registerEvents=function(){var e=this,t=null;this.app.event("StartFeaturePlacementEvent").subscribe(this,function(){t=e.app.event("ViewDeactivatedEvent").subscribe(e,function(t){"TemplatePickerView"===t.id&&e.app.event("StopFeaturePlacementEvent").publish()})}),this.app.event("StopFeaturePlacementEvent").subscribe(this,function(){e.app.event("ViewDeactivatedEvent").unsubscribe(t),e.app.command("ClearActiveTool").execute();var i=e.app.viewManager.getViewById("TemplatePickerView");i&&i.isActive&&e.app.command("DeactivateView").execute("TemplatePickerView")}),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChangedEvent)},i.prototype._executeStopFeaturePlacementState=function(){this.app.event("StopFeaturePlacementEvent").publish()},i.prototype._canExecuteStopFeaturePlacementState=function(){return!0},i.prototype._canExecuteSetEditorFeatureGeometry=function(e){return!0},i.prototype._executeSetEditorFeatureGeometry=function(e){this._executeStopEditingGeometry();var t=this._feature;t&&("extent"===e.type&&(e=n.envelopeToPolygon(e)),this._geometry=e,this._hasGeometry=!!e,this._graphic.setGeometry(e),this.app.event("GeometryEditCompletedEvent").publish({originalGraphic:this._feature,editedGraphic:this._graphic,cancelled:!1}),this._destroyEditingLayer(),this.app.event("FeatureGeometryEditedEvent").publish(t))},i.prototype._canExecuteStartAddingFeatureGeometry=function(e){return!0},i.prototype._executeStartAddingFeatureGeometry=function(e){},i.prototype._canExecuteStartEditingGeometry=function(e,t){return!0},i.prototype._executeStartEditingGeometry=function(e,t){var i=this;this._isEditingGeometry=!0,this._editObject&&this._editObject.deactivate(),this._feature=e,e.symbol||t.renderer||e.setSymbol(this._getMoveSymbol(e,t)),this._graphic=new esri.Graphic(e.geometry,e.symbol,e.attributes,e.infoTemplate),this._hasGeometry=!!this._graphic.geometry;var r=t||this._feature.getLayer();if(this._featureLayer=r,this._createEditingLayer(),this._hideOriginalFeature(),this._graphic.symbol=this._getMoveSymbol(e,r),this._editingLayer.add(this._graphic),this._layerUpdateEndToken&&dojo.disconnect(this._layerUpdateEndToken),this._layerUpdateEndToken=dojo.connect(this._graphic._graphicsLayer,"onUpdateEnd",dojo.hitch(this,this._handleLayerUpdateEnd)),this._hasGeometry){var a=null;if(null===e)throw new Error("Can't edit geometry of null feature");if(!esri.toolbars.Edit){var n=this.app.getResource(this.libraryId,"language-feature-editing-package-required"),o=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return void this.app.command("Alert").execute(n,o)}a=this._getConfiguredEditMode();var s={allowAddVertices:!0,allowDeleteVertices:!0};this._editObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.edit",this.app.map,s);var l=dojo.aspect.after(this._editObject,"onGraphicFirstMove",function(e){i.app.map.disableMapNavigation()},!0),d=dojo.aspect.after(this._editObject,"onGraphicMoveStop",function(e){i.app.map.enableMapNavigation()},!0);this._editorDeactivatedHandle&&(this._editorDeactivatedHandle.remove(),this._editorDeactivatedHandle=null),this._editorDeactivatedHandle=dojo.aspect.after(this._editObject,"onDeactivate",function(e,t,r){l&&(l.remove(),l=null),d&&(d.remove(),d=null),null!=i._editingGeometryMapClickHandle&&(dojo.disconnect(i._editingGeometryMapClickHandle),i._editingGeometryMapClickHandle=null),i._layerUpdateEndToken&&(dojo.disconnect(i._layerUpdateEndToken),i._layerUpdateEndToken=null),i._editorDeactivatedHandle&&(i._editorDeactivatedHandle.remove(),i._editorDeactivatedHandle=null),i._editObject&&(i._editObject=null),i._destroyEditingLayer(),i._indicateGeometryEditing(!1),i.app.event("GeometryEditCompletedEvent").publish({originalGraphic:i._feature,editedGraphic:i._graphic,cancelled:r.cancelled})},!0),this._editingGeometryMapClickHandle=dojo.connect(this.app.map,"onClick",function(){i._executeStopEditingGeometry(!1)}),this._indicateGeometryEditing(!0),this._editObject.activate(a,this._graphic,s),this.app.event("GeometryEditInvokedEvent").publish(this._feature)}else this._currentToolName=this._getToolNameByGeometryType(r.geometryType),this.app.command("SetActiveTool").execute(this._currentToolName),this._indicateGeometryEditing(!0)},i.prototype._createEditingLayer=function(){this._editingLayer=g.getInternalGraphicsLayer(h.EDITING_LAYER_ID,this.app,g.GraphicsLayerType.Markup)},i.prototype._destroyEditingLayer=function(){g.removeInternalGraphicsLayer(h.EDITING_LAYER_ID,this.app,g.GraphicsLayerType.Markup),this._editingLayer=null},i.prototype._handleLayerVisualizationChangedEvent=function(e){var t=this;if(this._feature&&this._graphic&&this._featureLayer&&this._editingLayer&&e&&e.mapService&&e.mapService.serviceLayer&&e.mapService.serviceLayer.id===this._featureLayer.id){if(this._featureLayer.renderer)this._graphic.setSymbol(this._featureLayer.renderer.getSymbol(this._feature));else{var i=this.app.map.graphicsLayerIds.filter(function(e){return e===t._featureLayer.id+"-cluster"});if(i.length>0){var r=this.app.map.getLayer(i[0]);r&&r.featureLayerRenderer&&this._graphic.setSymbol(r.featureLayerRenderer.getSymbol(this._feature))}}this._editingLayer.redraw(),this._editObject.refresh()}},i.prototype._handleLayerUpdateEnd=function(){this._hideOriginalFeature()},i.prototype._hideOriginalFeature=function(){if(this._feature){var e=o.findFeatureInMap(this._feature,this.app.site);e&&e.hide()}},i.prototype._getMoveSymbol=function(e,t){i=null;if(t.renderer)var i=e.symbol?e.symbol:t.renderer.getSymbol(e);else{var r=this.app.map.graphicsLayerIds.filter(function(e){return e===t.id+"-cluster"});if(r.length>0){var a=this.app.map.getLayer(r[0]);i=a.featureLayerRenderer.getSymbol(e)}}var n=!1,o=function(e){return n||(i=new e(i.toJson()),n=!0),i};if(i instanceof esri.symbol.SimpleMarkerSymbol){var s=i;s.size<10&&o(esri.symbol.SimpleMarkerSymbol).setSize(10),s.color.a<.5&&(!s.outline||s.outline.color.a<.5)&&(o(esri.symbol.SimpleMarkerSymbol).color.a=.5)}return i},i.prototype._canExecuteStopEditingGeometry=function(){return!0},i.prototype._executeStopEditingGeometry=function(e){void 0===e&&(e=!1),this._isEditingGeometry&&(this.app.command("ClearActiveTool").execute(),this._editObject&&(this._editObject._cancelled=e,this._editObject.deactivate(),this._editObject=null),null!=this._editingGeometryMapClickHandle&&(dojo.disconnect(this._editingGeometryMapClickHandle),this._editingGeometryMapClickHandle=null),this._layerUpdateEndToken&&(dojo.disconnect(this._layerUpdateEndToken),this._layerUpdateEndToken=null),this._editorDeactivatedHandle&&(this._editorDeactivatedHandle.remove(),this._editorDeactivatedHandle=null),this._indicateGeometryEditing(!1))},i.prototype._indicateGeometryEditing=function(e){var t=this;if(this._feature&&this._feature.geometry){if(e){var i=this._feature.geometry.type,r=s.getEsriGeometryType(i,esri.toolbars.Draw.POINT),a={id:"geometryEditingStatus",text:this.getEditingGeometryStatusMessage(this.app,this.libraryId,r),closeButton:{callback:function(){t._executeStopEditingGeometry(!0)}}};this.app.command("DisplayNotification").execute(a),this.app.command("ShowMap").execute()}else this.app.command("RemoveNotification").execute("geometryEditingStatus")}},i.prototype.getEditingGeometryStatusMessage=function(e,t,i){var r=Modernizr&&!!Modernizr.touch;switch(i){case esri.toolbars.Draw.POINT:return e.getResource(t,"language-feature-editing-geometry-point");case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYLINE:return a=r?e.getResource(t,"language-feature-editing-geometry-polyline-touch"):e.getResource(t,"language-feature-editing-geometry-polyline");case esri.toolbars.Draw.CIRCLE:case esri.toolbars.Draw.ELLIPSE:case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.FREEHAND_POLYGON:var a=r?e.getResource(t,"language-feature-editing-geometry-polygon-touch"):e.getResource(t,"language-feature-editing-geometry-polygon");return a;case esri.toolbars.Draw.EXTENT:return e.getResource(t,"language-feature-editing-geometry-rectangle")}return e.getResource(t,"language-feature-editing-geometry-default")},i.prototype._getToolNameByDrawType=function(e){return e||(e="Polygon"),"Editing{0}Tool".format(e)},i.prototype._getToolNameByGeometryType=function(e){var t=e.slice("esriGeometry".length);return"Editing{0}Tool".format(t)},i.prototype._getConfiguredEditMode=function(){var e=this,t=0,i=this.app.site.essentialsMap.mapServices.filter(function(t){return t.id===e._featureLayer.id});if(0==i.length)t=esri.toolbars.Edit.MOVE|esri.toolbars.Edit.EDIT_VERTICES|esri.toolbars.Edit.SCALE|esri.toolbars.Edit.ROTATE;else{var r=i[0];r.rotateEnabled&&(t|=esri.toolbars.Edit.ROTATE),r.scaleEnabled&&(t|=esri.toolbars.Edit.SCALE),r.moveEnabled&&(t|=esri.toolbars.Edit.MOVE),r.editVerticesEnabled&&(t|=esri.toolbars.Edit.EDIT_VERTICES)}return t},i.prototype._executeCreateGraphicsInMemory=function(e){var t=this;this._validateEditInMemoryArgs(e,f.Create)&&(e.graphics.map(function(i){e.graphicsLayer.add(i),t.app.event("MarkupAddedEvent").publish(i)}),e.successCallback(e.graphics,[],[]).then(function(){var i=t.app.getResource(t.libraryId,"language-feature-editing-undoable-add"),r={app:t.app,addedGraphics:e.graphics,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new l.Add(i,r))}))},i.prototype._executeUpdateGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,f.Update))if(e.geometries&&e.geometries.length===e.graphics.length){for(var i=[],r=0;r<e.graphics.length;r++)i[r]=new esri.Graphic(e.graphics[r].toJson()),e.graphics[r].setGeometry(e.geometries[r]),this.app.event("MarkupUpdatedEvent").publish(e.graphics[r]);e.successCallback([],e.graphics,[]).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-update"),a={app:t.app,preUpdatedGraphics:i,updatedGraphics:e.graphics,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new d.Update(r,a))})}else e.errorCallback(new Error("Could not update graphics: the graphic count does not match the updated geometry count."))},i.prototype._executeDeleteGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,f.Delete)){for(var i=[],r=0;r<e.graphics.length;r++)e.graphicsLayer.remove(e.graphics[r])&&(i.push(e.graphics[r]),this.app.event("MarkupDeletedEvent").publish(e.graphics[r]));0===i.length&&e.errorCallback(new Error("Could not delete graphics: the provided graphics are not on the graphics layer.")),e.successCallback([],[],i).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-delete"),a={app:t.app,deletedGraphics:i,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new u.Delete(r,a))})}},i.prototype._executeCutGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,f.Cut))if(e.polyline){var i=e.graphics.map(function(e){return e.geometry});s.cutGeometries(i,e.polyline,this.app).then(function(i){for(var r=0;r<i.length;r++)if(i[r].length<2)return void e.errorCallback(new Error("Could not cut graphics: the provided polyline does not cut a graphic."));var a=e.graphics.map(function(e){return new esri.Graphic(e.toJson())}),n=e.graphics,o=t._splitGraphics(n,i);n.map(function(e){return t.app.event("MarkupUpdatedEvent").publish(e)}),o.map(function(i){e.graphicsLayer.add(i),t.app.event("MarkupAddedEvent").publish(i)}),e.successCallback(o,n,[]).then(function(){var i=t.app.getResource(t.libraryId,"language-feature-editing-undoable-cut"),r={app:t.app,addedGraphics:o,preUpdatedGraphics:a,updatedGraphics:n,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new p.AddAndUpdate(i,r))})},function(t){e.errorCallback(t)})}else e.errorCallback(new Error("Could not cut graphics: required polyline was not supplied."))},i.prototype._executeExplodeGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,f.Explode)){for(var i=e.graphics,r=[],a=0;a<i.length;a++)if(r[a]=s.explodeGeometry(i[a].geometry),!r[a])return void e.errorCallback(new Error("Could not explode graphics: invalid geometry."));var n=i.map(function(e){return new esri.Graphic(e.toJson())}),o=this._splitGraphics(i,r);i.map(function(e){return t.app.event("MarkupUpdatedEvent").publish(e)}),o.map(function(i){e.graphicsLayer.add(i),t.app.event("MarkupAddedEvent").publish(i)}),e.successCallback(o,i,[]).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-explode"),a={app:t.app,addedGraphics:o,preUpdatedGraphics:n,updatedGraphics:i,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new p.AddAndUpdate(r,a))})}},i.prototype._executeUnionGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,f.Union)){var i=e.graphics[0],r=e.graphics.map(function(e){return e.geometry});s.unionGeometries(r).then(function(r){var a=new esri.Graphic(i.toJson());i.setGeometry(r),t.app.event("MarkupUpdatedEvent").publish(i);for(var n=e.graphics.slice(1),o=0;o<n.length;o++)e.graphicsLayer.remove(n[o]),t.app.event("MarkupDeletedEvent").publish(n[o]);e.successCallback([],[i],n).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-union"),o={app:t.app,deletedGraphics:n,preUpdatedGraphics:[a],updatedGraphics:[i],graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new c.DeleteAndUpdate(r,o))})},function(t){e.errorCallback(t)})}},i.prototype._validateEditInMemoryArgs=function(e,t){if(e.successCallback=e.successCallback||function(){return Promise.resolve()},e.errorCallback=e.errorCallback||function(){},!(e.graphicsLayer&&e.graphicsLayer instanceof esri.layers.GraphicsLayer))return e.errorCallback(new Error("Could not edit graphics: required graphics layer was not supplied.")),!1;if(!e.graphics||0===e.graphics.length)return e.errorCallback(new Error("Could not edit graphics: required graphics were not supplied.")),!1;if(t===f.Cut||t===f.Explode||t===f.Union)for(var i=0;i<e.graphics.length;i++){var r=e.graphics[i];if(r.getLayer().id!==e.graphicsLayer.id)return e.errorCallback(new Error("Could not edit graphics: graphic is not on the supplied graphics layer.")),!1;if(t===f.Union){if(r.geometry.type!==e.graphics[0].geometry.type)return e.errorCallback(new Error("Could not edit graphics: graphics are not of the same type.")),!1;if(!r.geometry.spatialReference.equals(e.graphics[0].geometry.spatialReference))return e.errorCallback(new Error("Could not edit graphics: graphics are not of the same spatial reference.")),!1}}return!0},i.prototype._splitGraphics=function(e,t){for(var i=[],r=0;r<t.length;r++){var a=e[r];a.setGeometry(t[r][0]);for(var n=1;n<t[r].length;n++)i.push(new esri.Graphic(t[r][n],a.symbol,a.attributes,a.infoTemplate))}return i},i}(r.ModuleBase);i.EditingModule=m})},"Mapping/modules/Editing/FeatureUtilities":function(){define(["require","exports","geocortex/geocortex"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getRelatedFeatures=function(e,t,r){var a=new dojo.Deferred;if(!e){n=new Error("getRelatedFeatures: mapService cannot be null.");return i.deferredReject(a,n),a}if(isNaN(t)){n=new Error("getRelatedFeatures: relationshipId cannot be null.");return i.deferredReject(a,n),a}if(!r){var n=new Error("getRelatedFeatures: objectId cannot be null.");return i.deferredReject(a,n),a}var o=new esri.tasks.RelationshipQuery;return o.outFields=["*"],o.relationshipId=t,o.objectIds=[r],e&&e.serviceLayer&&e.serviceLayer.queryRelatedFeatures?e.serviceLayer.queryRelatedFeatures(o).then(function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r))for(var n=0;n<e[r].features.length;n++)t.push(e[r].features[n]);i.deferredResolve(a,t)},function(e){i.deferredReject(a,e)}):i.deferredResolve(a,[]),a},e}();t.FeatureUtilities=r})},"Mapping/modules/Editing/RelatedLayerEntry":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Utils":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.findFeatureInLayer=function(e,t){if(!e||!t)return null;var i=t.objectIdField;e.attributes[i]&&e.attributes[i];var r=t.graphics;if(r.length<1)return null;var a=["timestamp"];if(t.editFieldsInfo)for(var n in t.editFieldsInfo)t.editFieldsInfo.hasOwnProperty(n)&&a.push(t.editFieldsInfo[n]);var o=function(e){return Array.contains(a,e)},s=function(e){var t=0;for(var i in e)!o(i)&&e.hasOwnProperty(i)&&++t;return t},l=r[0].attributes;if(s(l)!==s(e.attributes))return null;var d=0,u=[],p=[];for(var c in l){var h=o(c);if(!(h||l.hasOwnProperty(c)&&e.attributes.hasOwnProperty(c)))return null;h||(u.push(c),p.push(c),++d)}for(var g=0;g<d;++g)if(u[g]!==p[g])return null;for(var f=0;f<r.length;f++)r[f];return null},e}();t.EditingUtils=i})},"Mapping/modules/Editing/CreateOrEdit/CreateOrEditView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("HideCreateEditView").register(r,function(){r.isActive&&r.app.viewManager.deactivateView(r)}),r}return e(i,t),i.prototype.handleClickCreateNewFeature=function(e,t,i){this.viewModel.initiateCreateNewFeature()},i.prototype.handleClickSelectExistingFeature=function(e,t,i){this.viewModel.selectGeometry()},i}(r.ViewBase);i.CreateOrEditView=a})},"Mapping/modules/Editing/CreateOrEdit/CreateOrEditViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/FeatureSetCollection","geocortex/framework/observables","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/identify/MapIdentifyTask","geocortex/infrastructure/GeometryUtils"],function(t,i,r,a,n,o,s,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var d=function(){return function(e,t){this.featureServiceId=e.featureServiceId,this.where="{0} = '{1}'".format(e.scanResultFieldName,t.replace("'","''")),this.template={},this.template[e.scanResultFieldName]=t}}();i.CreateOrEditFeatureDescriptor=d;var u=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.geolocationEnabled=new n.Observable,r.searchRadius=new n.Observable(100),r}return e(i,t),i.prototype.initialize=function(e){e&&e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),e&&e.searchRadiusMeters&&this.searchRadius.set(e.searchRadiusMeters),this.app.command("CreateOrEditFeatureFromBarcodeScan").register(this,this._executeCreateOrEditFeatureFromBarcodeScan),this.app.command("CreateOrEditFeature").register(this,this._executeCreateOrEditFeature),this.app.command("SelectFeatureForEditing").register(this,this._findExistingFeature),this.app.event("Internal.EditorFormSetupEvent").subscribe(this,this._fillTemplateDataInForm),this.geolocationEnabled.set(navigator&&void 0!==navigator.geolocation)},i.prototype._executeCreateOrEditFeatureFromBarcodeScan=function(e){var t=this;this.app.command("LaunchBarcodeScannerWithCallback").execute(function(i){if("Success"==i.status){var r=i.content;t.app.command("CreateOrEditFeature").execute([new d(e,r)])}})},i.prototype._executeCreateOrEditFeature=function(e){var t=this;this.resultsFSC=new a.FeatureSetCollection,this.inputFeatureDescriptors=e||[],this.currentFeatureServiceDescriptor=null;for(var i=0;i<this.inputFeatureDescriptors.length;i++){var r=this.inputFeatureDescriptors[i],n=this.app.site.essentialsMap.findMapServiceById(r.featureServiceId),o=new esri.tasks.Query;o.outFields=["*"],o.where=r.where,n.queryFeatures(o,function(e,i){return function(r){t._collectSearchResults(e,i,r)}}(n,r),function(e){t.app.trace.error("Error querying for feature data: {0}".format(e.toString()))})}},i.prototype._fillTemplateDataInForm=function(e,t){if(this.currentFeatureServiceDescriptor)for(var i=e.get(),r=0;r<i.fields.length();r++){var a=i.fields.getAt(r),n=this.currentFeatureServiceDescriptor.template;for(var o in n)n.hasOwnProperty(o)&&a.name.get()===o&&a.value.set(n[o])}},i.prototype._collectSearchResults=function(e,t,i){var r=this;this.currentFeatureLayer=e.layers[0];var a=new o.FeatureSet({esriFeatureSet:i,layer:this.currentFeatureLayer});if(this.resultsFSC.featureSets.addItem(a),this.resultsFSC.featureSets.length()==this.inputFeatureDescriptors.length)if(1==this.resultsFSC.countFeatures()){this.app.trace.debug("Found one feature, start editing it.");var n=this.resultsFSC.firstFeature();this._startEditingFeature(n)}else if(this.resultsFSC.countFeatures()>1)this.app.trace.debug("Multiple features found, select one to edit."),this.app.command("ShowSelectionListOfFeaturesWithCallback").execute(a,this._startEditingFeature);else{this.app.trace.debug("Creating a new feature."),this.currentFeatureServiceDescriptor=t,this.app.command("ActivateView").execute("CreateOrEditView");var s=this.app.event("ViewDeactivatedEvent").subscribe(this,function(e){"CreateOrEditView"===e.id&&(r.currentFeatureServiceDescriptor=null,r.app.event("ViewDeactivatedEvent").unsubscribe(s))})}},i.prototype.initiateCreateNewFeature=function(){this.app.command("ShowFeatureTemplatePicker").execute(this.currentFeatureLayer)},i.prototype.selectGeometry=function(){var e=this.app.toolRegistry.tool("SelectFeaturesForEditingTool");e&&e.setActive(!0)},i.prototype._findExistingFeature=function(e,t){var i=this,r=new s.MapIdentifyTask(this.app.map,this.app);r.layerRestriction=function(e){return e===i.currentFeatureLayer};var a=!1,n=function(e,t,r){if(t&&t.length>0){a=!0;var n=new esri.tasks.FeatureSet;n.features=t.map(function(e){return e.feature});var s=new o.FeatureSet({esriFeatureSet:n,layer:r.layers[0]});i.app.command("ShowSelectionListOfFeaturesWithCallback").execute(s,i._startEditingFeature)}},d=dojo.hitch(this,function(e){a&&this._setSelectionToolActive(!1)}),u=function(e,t,r){i.app.trace.warning("Failed to find features: {0}".format(t.message))};if("point"===e.type){var p=new esri.SpatialReference({wkid:102100}),c=this.searchRadius.get();c=t&&t>c?t:c;var h=l.createCircle(p,e,c,60);r.execute(h,n,d,u)}else r.execute(e,n,d,u)},i.prototype._startEditingFeature=function(e){this.app.command("HideCreateEditView").execute(),this.app.command("HideMultiFeatureSelectorView").execute(),this.app.command("ZoomToFeature").execute(e),this.app.command("StartEditingFeature").execute(e,!1)},i.prototype._setSelectionToolActive=function(e){var t=this.app.toolRegistry.tool("SelectFeaturesForEditingTool");t&&(void 0!=e?t.setActive(e):t.setActive(!0))},i}(r.ViewModelBase);i.CreateOrEditViewModel=u})},"Mapping/modules/Editing/Editor/EditorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./EditorViewModel","geocortex/infrastructure/Feature"],function(t,i,r,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.attach=function(e){var i=this;t.prototype.attach.call(this,e),this.isBusy.sync(e.isBusy),this.title.syncTransform(e.headerText,function(e){return String.unescapeHtml(e)}),this.app.event("ApplicationOfflineEvent").subscribe(this,this.cancelEditing),this.app.event("ApplicationOnlineEvent").subscribe(this,this.cancelEditing),this.app.event("FeatureDeletedEvent").subscribe(this,this._onFeatureDeletedEvent),this.app.event("RelatedRecordDeletedEvent").subscribe(this,this._onRelatedRecordDeletedEvent),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._onGeometryEditCompletedEvent),this.app.command("ShowFeatureAttributeEditor").register(this,function(){i._activateView()}),this.app.command("HideFeatureAttributeEditor").register(this,function(){return i.isActive&&i._deactivateView(),!1}),this.app.command("_CancelEditing").register(this,this._executeCancelEditing,this._canExecuteCancelEditing)},i.prototype._executeCancelEditing=function(){this.cancelEditing()},i.prototype._canExecuteCancelEditing=function(){return this.viewModel.editingInProgress()},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel.cancelEditing()},i.prototype.handleTypeFieldChange=function(e,t,i){this.viewModel.handleTypeFieldSelected(i)},i.prototype.handleClickEditGeometry=function(e,t,i){return this.viewModel.handleClickEditGeometry()},i.prototype.handleClickDeleteFeature=function(e,t,i){return this.viewModel.state===a.EditorState.EditingGeometry&&this.viewModel.stopEditingGeometry(),this.viewModel.confirmDelete(),!1},i.prototype.handleClickSave=function(e,t,i){var r=this;return this.viewModel.state===a.EditorState.EditingGeometry&&this.viewModel.stopEditingGeometry(),this.isBusy.set(!0),this.viewModel.save(function(){return r.saveSuccessCallback()},function(e){return r.saveErrorCallback(e)}),!1},i.prototype.saveSuccessCallback=function(){this._deactivateView()},i.prototype.saveErrorCallback=function(e){},i.prototype.cancelEditing=function(){this.viewModel.cancelEditing(),this.isActive&&this._deactivateView()},i.prototype._activateView=function(){this.app.command("ActivateView").execute(this.id)},i.prototype._deactivateView=function(e){void 0===e&&(e=!0),this.app.command("DeactivateView").execute(this.id),this.app.event("_internalEvent.EditorViewDeactivated").publish(this.viewModel.currentFeatureEsriClone)},i.prototype._onFeatureDeletedEvent=function(e){this.viewModel&&this.viewModel.currentFeatureEsri&&this.viewModel.currentFeatureEsri===e&&(this._deactivateView(!1),this.viewModel.currentFeatureEsriClone.hide())},i.prototype._onRelatedRecordDeletedEvent=function(){this._deactivateView()},i.prototype._onGeometryEditCompletedEvent=function(e){var t=null;t=e.cancelled?new n.Feature({graphic:e.editedGraphic}):new n.Feature({graphic:e.originalGraphic}),this.app.behavior("EditorFeatureSelectedBehavior").run(t)},i.prototype.handleClickCancel=function(e,t,i){return this.cancelEditing(),!1},i.prototype.handleInputFocus=function(e,t,i){i.showActualValue()},i.prototype.handleInputBlur=function(e,t,i){i.showFormattedValue()},i}(r.ViewBase);i.EditorView=o})},"Mapping/modules/Editing/Editor/EditorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./Form/EditingFormViewModel","geocortex/infrastructure/Feature","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/TaskUtils","./../FeatureUtilities","geocortex/geocortex","geocortex/infrastructure/tools/MapTool","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/MapUtils","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/TimeZoneUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/HighlightManager"],function(t,i,r,a,n,o,s,l,d,u,p,c,h,g,f,m,y,v,b){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var E;!function(e){e[e.Idle=0]="Idle",e[e.Paused=1]="Paused",e[e.CantEdit=2]="CantEdit",e[e.EditingAttributes=3]="EditingAttributes",e[e.EditingGeometry=4]="EditingGeometry",e[e.Saving=5]="Saving"}(E=i.EditorState||(i.EditorState={}));var F=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.state=E.Idle,r.isBusy=new a.Observable(!1),r.title=new a.Observable(""),r.headerText=new a.Observable(""),r.form=new a.Observable,r.isEditingGeometry=new a.Observable(!1),r.isEditingNewFeature=new a.Observable(!1),r.isEditingLogEntry=new a.Observable(!1),r.isEditingRelatedFeature=new a.Observable(!1),r.isEditingRelatedFeatureNotInSite=new a.Observable(!1),r.currentFeatureRelationships=new a.ObservableCollection,r.hasRelatedLayers=new a.Observable(!1),r.showRelatedLayers=new a.Observable(!1),r.canDeleteFeature=new a.Observable(!0),r.canEditGeometry=new a.Observable(!1),r.showEditGeometryButton=new a.Observable(!1),r.showStopEditingGeometryButton=new a.Observable(!1),r.geometryHasBeenEdited=new a.Observable(!1),r.validateGeometry=!1,r.configAllowsEditGeometry=!0,r.layerUpdateEndToken=null,r.textareaThreshold=80,r.canEditOffline=!1,r.doNotAdjustTime=!1,r._registerCommands(),r._subscribeToEvents(),r.isEditingNewFeature.bind(r,r._calculateCanDeleteFeature),r.auto(r.hasRelatedLayers,r,r._hideOrShowRelateds),r.auto(r.isEditingRelatedFeatureNotInSite,r,r._hideOrShowRelateds),r}return e(i,t),i.prototype.initialize=function(e){var t=this;e&&(e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),this.validateGeometry=!!e.validateGeometry,this.configAllowsEditGeometry=void 0!==e.editGeometry?!!e.editGeometry:this.configAllowsEditGeometry,this.textareaThreshold=void 0!==e.textareaThreshold?parseInt(e.textareaThreshold):this.textareaThreshold,this.doNotAdjustTime=void 0!==e.doNotAdjustTime?!!e.doNotAdjustTime:this.doNotAdjustTime),this.app.nativeManager.hasNativeCapability("editing").then(function(e){t.canEditOffline=e})},i.prototype._registerCommands=function(){var e=this;this.app.command("StartEditingFeature").register(this,this._executeStartEditingFeature,this._canExecuteStartEditingFeature),this.app.command("StartEditingNewFeature").register(this,this._executeStartEditingNewFeature,this._canExecuteStartEditingNewFeature),this.app.command("StartEditingEditLogEntry").register(this,this._executeStartEditingEditLogEntry,this._canExecuteStartEditingEditLogEntry),this.app.command("StartEditingNewRelatedRecord").register(this,this._executeStartEditingRelatedRecord),this.app.command("StartEditingGraphicGeometry").postExecute.subscribe(this,this._onStartEditingGraphicGeometry),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._onGeometryEditCompletedEvent),this.app.command("StartAddingFeatureGeometry").register(this,this._executeStartAddingFeatureGeometry,this._canExecuteStartEditingNewFeature),this.app.command("Internal.CancelEditingIfNotIdle").register(this,function(){e.state!==E.Idle&&e.cancelEditing()}),this.app.command("StartEditingAttributesAndGeometryFeature").register(this,this._executeStartEditingAttributesAndGeometryFeature,this._canExecuteStartEditingFeature)},i.prototype._executeStartAddingFeatureGeometry=function(e,t){this.app.command("StartEditingNewFeature").execute(e,t)},i.prototype._subscribeToEvents=function(){this.app.event("GeometryEditInvokedEvent").subscribe(this,this._handleGeometryEditInvokedEvent),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._handleGeometryEditCompletedEvent),this.app.event("GeolocatedEvent").subscribe(this,this._handleGeolocation),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChangedEvent)},i.prototype.performValidation=function(){var e=!0;return this.form.get().clearValidationMessages(),e=this.performFormValidation()&&e,this.validateGeometry&&(e=this.performGeometryValidation()&&e),e},i.prototype.performFormValidation=function(){for(var e=!0,t=this.form.get(),i=0;i<t.fields.getLength();++i){var r=t.fields.getAt(i);try{if(r.validationFunc){var a=r.validationFunc(r.value.get(),r,t);a&&(e=!1,t.addValidationMessage(a))}}catch(e){this.app.trace.warning("Error validating field {0}: {1}".format(r.displayName,e))}}return e},i.prototype.performGeometryValidation=function(){var e=!0,t=this.form.get(),i=this.currentFeatureEsriClone;return i.geometry&&"polygon"===i.geometry.type&&s.isSelfIntersectingPolygon(i.geometry)&&(t.addValidationMessage(this.app.getResource(this.libraryId,"language-feature-editing-self-intersecting-polygon-need-fixing")),e=!1),e},i.prototype.confirmDelete=function(){var e=this;this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-feature-editing-delete-confirmation"),this.app.getResource(this.libraryId,"language-feature-editing-module-title"),function(t){if(t){var i=!1;e._preventDeleteForRelOrigin(e.currentFeatureRelationships,function(){e.app.command("Alert").execute(e.app.getResource(e.libraryId,"language-feature-editing-delete-with-relation-forbidden"),e.app.getResource(e.libraryId,"language-feature-editing-module-title")),i=!0},function(){i||(e.stopEditingGeometry(),e.deleteCurrentFeature())})}})},i.prototype.deleteCurrentFeature=function(e,t){var i=this,r=this.currentFeatureEsri,a=r.getLayer()||this._sourceLayer,n=this._getMapServiceByLayer(a);if(!n){var o,s=this._relatedFeature,l=this._editingRelationshipOrigin,d=this._editingRelationshipDestination;return o={mapService:this.currentMapService,layer:a,feature:r,relatedFeature:s,relationshipOrigin:l,relationshipDestination:d,successCallback:function(){i._deleteFeatureSuccessCallback(r,a,e)},errorCallback:function(e){i._deleteFeatureErrorCallback(e,a,t)}},this.isBusy.set(!0),this.app.command("DeleteRelatedRecord").execute(o),void this.app.event("RelatedRecordDeletedEvent").publish()}var u={mapService:n,layer:a,feature:r,successCallback:function(){i._deleteFeatureSuccessCallback(r,a,e)},errorCallback:function(e){i._deleteFeatureErrorCallback(e,a,t)}};this.isBusy.set(!0),this.app.command("DeleteFeature").execute(u)},i.prototype._deleteFeatureErrorCallback=function(e,t,i){var r=this.app.getResource(this.libraryId,"language-feature-editing-error-feature-edits").format(e),a=this.app.getResource(this.libraryId,"language-feature-editing-error-title");this.app.command("Alert").execute(r,a),this.app.trace.error(r),this.isBusy.set(!1)},i.prototype._deleteFeatureSuccessCallback=function(e,t,i){this._handleDeletedFeature(e),this.app.event("FeatureDeletedEvent").publish(e),t&&t.remove&&t.remove(e),this.app.command("ShowMap").execute(),this.currentFeatureEsriClone.hide(),this._destroyEditingLayer(),this._sourceLayer.refresh&&this._sourceLayer.refresh(),this.app.command("ShowFeatureParentDetails").execute(),i&&i(),this.isBusy.set(!1)},i.prototype._buildFeatureRelationships=function(){this.currentFeatureRelationships.clear();for(var e=this.currentFeatureEsri,t=this._sourceLayer,i=this.currentMapService,r=0;r<t.relationships.length;++r){var a=t.relationships[r];if(i){var n=i._getRelation(a.id);if(n&&!n.visible)continue}var o=!0;if(a.role){if("esriRelRoleOrigin"!==a.role)continue}else o=!1;var s=a.name;void 0!==n&&(s=n.displayName);var l=this.app.getResource(this.libraryId,"language-feature-editing-create-related-feature").format(s),d={id:a.id,text:l,editable:o,relatedFeature:e,relationship:a};this.currentFeatureRelationships.addItem(d)}this.hasRelatedLayers.set(this.currentFeatureRelationships.getLength()>0)},i.prototype._preventDeleteForRelOrigin=function(e,t,i){var r=this,a=this.currentFeatureEsri,n=this._sourceLayer,o=null,s=!1;if(a&&n&&e&&e.length()>0&&(o=e.length(),n))for(var u=0;u<e.length();u++){var p=function(){--o<=0&&i&&i()},c=e.getAt(u);c.relationship&&"esriRelRoleOrigin"===c.relationship.role&&0==c.relationship.composite?function(e){var i=parseInt(e.id),o=e.relatedTableId?e.relatedTableId.get():e.relationship.relatedTableId,u=n.url||n._essentialsMetadata.serviceUrl,c=r._getMapServiceByLayer(n),h=new esri.tasks.RelationshipQuery;h.objectIds=[a.attributes[n.objectIdField]],h.outFields=["*"],h.relationshipId=i;l.getQueryTask(n,c);d.FeatureUtilities.getRelatedFeatures(r._getMapServiceByLayer(n),i,h.objectIds[0]).then(function(e){var i=!1;for(var a in e)if(e.hasOwnProperty(a)){i=!0;break}i?r._getRelatedFeatureLayer(o,u,function(i){if(!s){var r=[];for(var a in e)if(e.hasOwnProperty(a)){var n=e[a].features||e[a];if(n)if(n.length)for(var o=0;o<n.length;o++){var l=n[o];r.push(l)}else r.push(n)}r.length>0&&t&&(t(r),s=!0),p()}},function(e){p()}):p()},function(e){p()})}(c):c.relationship.composite&&p()}(!o||o<=0)&&i&&i()},i.prototype._getMapServiceByLayer=function(e){var t=e.url,i=t.indexOf("?token=");-1!=i&&(t=t.substring(0,i));for(var r=0;r<this.app.site.essentialsMap.mapServices.length;++r){var a=this.app.site.essentialsMap.mapServices[r];if(a.serviceUrl.split("?")[0]===t)return a}return null},i.prototype._getRelatedFeatureLayer=function(e,t,i,r){var a=new dojo.Deferred,n=t.match(/token=.[^&]*/g),o=t.substring(0,t.lastIndexOf("/")+1)+e;n&&(o+="?"+n);var s=new esri.layers.FeatureLayer(o,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});return dojo.connect(s,"onLoad",dojo.hitch(this,function(e){u.deferredResolve(a,e),"function"==typeof i&&i(e)})),dojo.connect(s,"onError",dojo.hitch(this,function(e){u.deferredReject(a,e),"function"==typeof r&&r(e)})),a},i.prototype._getMapServiceForRelatedRecord=function(e){e.relatedFeature;for(var t=this.app.site.getFeatureServices(),i=0;i<t.length;i++){for(var r=t[i].serviceLayer,a=0;a<r.relationships.length;a++)if(r.relationships[a]==e.relationship)return this._sourceLayer=r,void this._calculateCanDeleteFeature();if(r.layerId==e.relationship.relatedTableId)for(i=0;i<r.fields.length;i++)r.fields[i].name==e.relationship.keyField&&(this._sourceLayer=r)}this._sourceLayer||this.app.trace.warning("Could not find a proper source layer.");var n=this._getMapServiceByLayer(this._sourceLayer);return n||this.app.trace.warning("Could not edit related feature. No map service for layer '{0}' was found.".format(this._sourceLayer.url)),n},i.prototype._getRelatedKeyFieldForRelatedRecords=function(e,t){if(e.relationship.keyField){for(var i=null,r=0;r<t.relationships.length;++r){var a=t.relationships[r];if(a.id===e.relationship.id){this._editingRelationshipDestination=a,i=a.keyField;break}}return i||void this.app.trace.error(this.app.getResource(this.libraryId,"language-feature-editing-relationships-key-field-missing"))}this.app.trace.error(this.app.getResource(this.libraryId,"language-feature-editing-relationships-require-arcgis-version"))},i.prototype._setupViewForRelatedRecordCreationAndEditing=function(e,t,i){this._editingRelationshipOrigin=e.relationship,this.canEditGeometry.set(this.configAllowsEditGeometry&&!!t.geometryType),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.showStopEditingGeometryButton.set(!1),this.currentFeatureEsri=i,this.currentFeatureEsriClone=this._cloneEsriFeature(this.currentFeatureEsri),this.originalFeatureClone=null,this.form.set(new n.EditingFormViewModel(this.app,this.libraryId,i,t,{textareaThreshold:this.textareaThreshold,doNotAdjustTime:this.doNotAdjustTime,timeZoneId:e.timeZoneId,displayTimeZoneId:e.displayTimeZoneId})),this.app.event("Internal.EditorFormSetupForRelatedFeatureEvent").publish(this.form,i)},i.prototype._renderRelatedRecordEditingTable=function(e,t,i){for(var r=!1,a=0;a<this.form.get().fields.getLength();++a){var n=this.form.get().fields.getAt(a);if(n.name.get()===t){if("objectid"!==t.toLowerCase()&&"globalid"!==t.toLowerCase()){e.feature?(n.value.set(e.feature.attributes[t]),e.relationship.keyField in i.attributes&&(i.attributes[e.relationship.keyField]=e.feature.attributes[e.relationship.keyField]||e.feature.attributes[t])):e.relatedFeature&&(n.value.set(e.relatedFeature.attributes[e.relationship.keyField]),e.relationship.keyField in i.attributes&&(i.attributes[e.relationship.keyField]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t]));continue}n.editable.set(!1)}}!0===this.isEditingNewFeature.get()&&(t in i.attributes&&(i.attributes[t]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t],r=!0),0!==this.form.get().fields.getLength()&&0!=r||(i.attributes[t]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t]))},i.prototype._executeStartEditingRelatedRecord=function(e,t){var i=this;this.isEditingNewFeature.set(t),this.isEditingRelatedFeature.set(!0),this._relatedFeature=e.relatedFeature;var r=null;if(this.app.map.getLayersVisibleAtScale().forEach(function(t){var i=t;i.layerId&&i.layerId==e.relationship.relatedTableId&&i.fields[e.relationship.keyField]&&(r=i)}),r){this.isEditingRelatedFeatureNotInSite.set(!1);var a=this._getMapServiceByLayer(r);this.currentMapService=a,this._refreshRelatedRecord(e,r)}else{if(this.isEditingRelatedFeatureNotInSite.set(!0),e.essentialsRelatedFeature){if(e.essentialsRelatedFeature.layer.getRelatedFeatureLayer)return void e.essentialsRelatedFeature.layer.getRelatedFeatureLayer(e.relationship.id,function(t){i._refreshRelatedRecord(e,t)},function(e){i.app.trace.error("Error in getting related feature layer: "+e)});var n=this._getMapServiceForRelatedRecord(e);return this.currentMapService=n,void this._refreshRelatedRecord(e,n.serviceLayer)}r=this.currentFeatureGeocortex.featureLayer,this.currentMapService=null,this._refreshRelatedRecord(e,r)}},i.prototype._refreshRelatedRecord=function(e,t){var i=this;e.feature?this._refreshEsriGraphic(e.feature,t).then(function(r){null!=r&&r.features&&r.features.length>0?e.feature=r.features[0]:i.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),i._displayEditorForRelatedFeatures(e,t)}).caught(function(r){i.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),i._displayEditorForRelatedFeatures(e,t)}):this._displayEditorForRelatedFeatures(e,t)},i.prototype._displayEditorForRelatedFeatures=function(e,t){e.text?this.headerText.set(e.text):this.headerText.set(this.app.getResource(this.libraryId,"language-feature-editing-new-related-feature-default")),this.state!==E.Idle&&this.cancelEditing(),this._sourceLayer=t,this._calculateCanDeleteFeature();var i={};t.fields.forEach(function(e){var t=e.name;i[t]=null});var r=null;this.isEditingNewFeature.get()?(r=this._createNewEsriFeature(null,i,null,null)).setGeometry(null):r=e.feature,this._setupViewForRelatedRecordCreationAndEditing(e,t,r);var a=this._getRelatedKeyFieldForRelatedRecords(e,t);if(this._renderRelatedRecordEditingTable(e,a,r),this.isEditingNewFeature.get()&&"Table"!=this._sourceLayer.type){for(var n=this.app.site.getFeatureServices(),o=void 0,s=0;s<n.length;s++)for(var l=n[s],d=0;d<l.layers.length;d++){var u=l.layers[d];if(u.id==e.relationship.relatedTableId.toString()&&u.name==e.relationship.name){o=u;break}}this.app.command("ShowFeatureTemplatePicker").execute(o,r)}else this._activateEditingView()},i.prototype.startEditingGeometry=function(){if(!this.currentFeatureEsri)throw new Error("Could not edit geometry - no feature selected.");this.app.command("StartEditingGraphicGeometry").execute(this.currentFeatureEsriClone,this._sourceLayer)},i.prototype.stopEditingGeometry=function(e){void 0===e&&(e=!1),this.app.command("StopEditingGraphicGeometry").execute(e)},i.prototype._onStartEditingGraphicGeometry=function(e,t){this.state==E.Idle||!e||e!==this.currentFeatureEsri&&e!==this.currentFeatureEsriClone||this.currentFeatureEsriClone.hide();var i=this.app.toolRegistry.getActiveTool();i instanceof p.MapTool&&"EditingPointTool"===i.name&&(this.app.event("GeometryEditPointActivatedEvent").publish(),this.app.command("OpenToolbar").execute())},i.prototype._onGeometryEditCompletedEvent=function(e){if(this.state!=E.Idle&&this.currentFeatureEsriClone&&(this.currentFeatureEsri===e.originalGraphic||this.currentFeatureEsriClone===e.originalGraphic)){e.cancelled||this.currentFeatureEsri!==e.originalGraphic||this.currentFeatureEsriClone.setGeometry(e.editedGraphic.geometry),this.app.command("HideFeatureTemplatePicker").execute(),this.app.command("HideCreateEditView").execute(),this.app.command("ShowFeatureAttributeEditor").execute(),this.currentFeatureEsriClone.show();var t=new o.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(t)}},i.prototype._handleGeolocation=function(e){var t=this,i=function(){t.currentFeatureEsriClone.setGeometry(e.projectedMapPoint),t.app.event("GeometryEditCompletedEvent").publish({editedGraphic:t.currentFeatureEsriClone,originalGraphic:t.currentFeatureEsri,cancelled:!1}),setTimeout(function(){return t.app.command("GeolocateStop").execute()},0),t.app.command("StopEditingGraphicGeometry").execute();var i=new o.Feature({graphic:t.currentFeatureEsriClone});t.app.behavior("EditorFeatureSelectedBehavior").run(i)},r=this.app.toolRegistry.getActiveTool(),a=this.isEditingNewFeature.get()&&"esriGeometryPoint"===this._sourceLayer.geometryType&&r&&"EditingPointTool"===r.name,n=e&&"single"===e.typeOfGeolocation&&e.location;a&&n&&(e.location.coords.accuracy<=e.accuracyThreshold?i():this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-feature-editing-confirm-low-accuracy-geolocation").format(c.formatNumber(e.location.coords.accuracy,h.NumberFormat.DEFAULT,{fractionalDigits:0}),this.getResource("language-common-ok")||"'OK'",this.getResource("language-common-cancel")||"'Cancel'"),this.app.getResource(this.libraryId,"language-feature-editing-confirm-low-accuracy-geolocation-title"),function(e){e?i():setTimeout(function(){return t.app.command("GeolocateStop").execute()},0)}))},i.prototype._createEditingLayer=function(){return this._destroyEditingLayer(),this._editingLayer=v.getInternalGraphicsLayer(y.EDITOR_CLONE_LAYER_ID,this.app,v.GraphicsLayerType.Markup,!1),this._sourceLayer&&this._editingLayer.setRenderer(this._sourceLayer.renderer),this._editingLayer},i.prototype._destroyEditingLayer=function(){this.currentFeatureEsriClone&&(this.currentFeatureEsriClone.hide(),this._editingLayer&&this._editingLayer.remove(this.currentFeatureEsriClone)),this._editingLayer&&(this._editingLayer.clear(),v.removeInternalGraphicsLayer(y.EDITOR_CLONE_LAYER_ID,this.app,v.GraphicsLayerType.Markup),this._editingLayer=null)},i.prototype._createNewEsriFeature=function(e,t,i,r){var a=new esri.Graphic(null);return a.attributes=t||{},a.geometry=e||new esri.geometry.Point(NaN,NaN),a.symbol=i||null,a.infoTemplate=r||null,a},i.prototype._handleLayerVisualizationChangedEvent=function(e){if(e.mapService&&e.mapService.serviceLayer&&this._sourceLayer&&e.mapService.serviceLayer.id===this._sourceLayer.id&&e.mapService.serviceLayer.renderer){var t=e.mapService.serviceLayer.renderer;this.currentFeatureEsriClone&&this.currentFeatureEsriClone.setSymbol(t.getSymbol(this.currentFeatureEsri)),this._editingLayer&&this._editingLayer.setRenderer(t)}},i.prototype.save=function(e,t){var i=this;this.stopEditingGeometry();var r=this.performValidation();if(this.isBusy.set(!1),r){this.state=E.Saving,this.isBusy.set(!0);var a;a=this.currentFeatureEsri?this._cloneEsriFeature(this.currentFeatureEsri):new esri.Graphic(null);for(var n in a.attributes)a.attributes.hasOwnProperty(n)&&(n||delete a.attributes[n]);var o=this.currentFeatureEsri,s=this._sourceLayer;try{var l,d=this.form.get().getAttributeValues(),u=null;if(this.isEditingNewFeature.get()){u=d;for(l in o.attributes)o.attributes.hasOwnProperty(l)&&(u.hasOwnProperty(l)||null==o.attributes[l]||(u[l]=o.attributes[l]))}else{u={};for(l in d)d.hasOwnProperty(l)&&o.attributes[l]!==d[l]&&(u[l]=d[l]);var p=s.objectIdField,c=s.globalIdField;o.attributes.hasOwnProperty(p)&&(u[p]=o.attributes[p]),o.attributes.hasOwnProperty(c)&&(u[c]=o.attributes[c])}var h=!0;if(s.relationships){s.relationships;for(var g=[],f=[],m=0;m<s.relationships.length;m++){var y=s.relationships[m];if(g[m]={key:y.keyField,value:d[y.keyField]},"esriRelCardinalityOneToOne"===y.cardinality||"esriRelCardinalityOneToMany"===y.cardinality&&"esriRelRoleOrigin"===y.role){var v=null,b=new esri.tasks.Query;if(!d.hasOwnProperty(y.keyField)||null===d[y.keyField])continue;b.where=y.keyField+" = '"+d[y.keyField]+"'",v=Promise.resolve(s.queryFeatures(b,function(e){e.features&&(i.isEditingNewFeature.get()&&e.features.length>=1?h=!1:!i.isEditingNewFeature.get()&&e.features.length>1&&(h=!1))},function(e){i.app.trace.warning("Unable to query layer for cardinality check: "+e)}))}f.push(v)}}Promise.all(f).then(function(e){if(!1===h){for(var t="",r="",a=0;a<g.length;a++){var n=g[a];$.each(e,function(i){var a=e[i];a.features&&a.features.length>0&&a.features[0].attributes[n.key]===n.value&&(t=n.key,r=n.value)})}return i.app.command("Alert").execute(i.app.getResource(i.libraryId,"language-feature-editing-cardinality-violation").format(r,t),i.app.getResource(i.libraryId,"language-feature-editing-error-dialogue")),i.state=E.Idle,void i.isBusy.set(!1)}}).lastly(function(){if(!1!==h){var r=new esri.Graphic(i.currentFeatureEsriClone.toJson());r.attributes=u,i.geometryHasBeenEdited.get();var a=null;if(!i.isEditingRelatedFeatureNotInSite.get()&&!(a=i._getMapServiceByLayer(s)))throw new Error("Could not find map service for feature layer while saving.");i.isBusy.set(!0);var n={mapService:a,layer:s,feature:r,successCallback:function(){i.isBusy.set(!1),i._handleSaveSuccess(r,s,e,t)},errorCallback:function(e){i.isBusy.set(!1),i._handleSaveError(e,t)}};try{i.app.event("Internal.EditorFormPreSaveEvent").publish(i.form,n)}catch(e){return}if(i.isEditingRelatedFeature.get()){var o=n;o.relatedFeature=i._relatedFeature,o.relationshipOrigin=i._editingRelationshipOrigin,o.relationshipDestination=i._editingRelationshipDestination,i.isEditingNewFeature.get()?(o.successCallback=function(t){i.app.event("RelatedRecordCreatedEvent").publish(r),i.isBusy.set(!1),e()},i.app.command("CreateRelatedRecord").execute(o)):(o.successCallback=function(t){i.app.event("RelatedRecordEditedEvent").publish(r),i.isBusy.set(!1),e()},i.app.command("UpdateRelatedRecord").execute(o))}else i.isEditingNewFeature.get()?(i.app.event("EditorPreCreateFeatureEvent").publish(r),i.app.command("CreateFeature").execute(n)):(i.app.event("EditorPreUpdateFeatureEvent").publish(r),i.app.command("UpdateFeature").execute(n));i.state=E.Saving}})}catch(e){this.state=E.Idle,this.isBusy.set(!1),this.app.trace.error("Error applying edits: {0}".format(e))}}},i.prototype._handleSaveError=function(e,t){this.isBusy.set(!1),this.state=E.Idle;var i=this.app.getResource(this.libraryId,"language-feature-editing-error-feature-edits").format(e),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");this.app.command("Alert").execute(i,r),this.app.trace.error(i),t&&t(e)},i.prototype._handleSaveSuccess=function(e,t,i,r){this.currentFeatureEsri;this.layerUpdateEndToken&&(dojo.disconnect(this.layerUpdateEndToken),this.layerUpdateEndToken=null);var a=g.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer);if(a){var n=e.attributes;e.attributes=null,a.attributes={},dojo.mixin(a.attributes,this.originalFeatureClone.attributes),dojo.mixin(a.attributes,n),a.show()}if(this._destroyEditingLayer(),this.originalFeatureClone&&a){var s={originalFeature:this.originalFeatureClone,editedFeature:a};this._handleEditedFeature(s),this.app.event("FeatureEditedEvent").publish(s)}else this.originalFeatureClone&&this.isEditingNewFeature.get()&&this.app.event("FeatureCreatedEvent").publish(e);if(this.isEditingNewFeature.set(!1),this.state=E.Idle,t&&t.refresh(),this.isEditingRelatedFeatureNotInSite.get()){var l=this.findGeocortexLayerForUrl(t.url),d=new o.Feature({graphic:e,layer:l});this.headerText.set(d.plainLabel.get())}this.cancelEditing(),i&&i()},i.prototype._cloneEsriFeature=function(e){return new esri.Graphic(e.toJson())},i.prototype._handleGeometryEditInvokedEvent=function(e){this.isEditingGeometry.set(!0),this.showEditGeometryButton.set(!1),this.showStopEditingGeometryButton.set(this.canEditGeometry.get()),this.geometryHasBeenEdited.set(!0)},i.prototype._handleGeometryEditCompletedEvent=function(e){this.isEditingGeometry.set(!1),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.showStopEditingGeometryButton.set(!1),this.currentFeatureEsriClone&&this.currentFeatureEsriClone===e.originalGraphic&&(this.currentFeatureEsriClone.setGeometry(e.editedGraphic.geometry),this.currentFeatureEsriClone.show(),this._swapOriginalFeatureForClone()),this.isEditingNewFeature.get()&&this.isEditingRelatedFeature.get()&&this._activateEditingView()},i.prototype._handleLayerUpdateEnd=function(){this._swapOriginalFeatureForClone()},i.prototype._handleDeletedFeature=function(e){var t=e instanceof esri.Graphic?e:e.originalFeature;t&&t instanceof esri.Graphic?this.app.featureSetManager.updateCollectionsOnFeatureDeletion(t):this.app.trace.warning("EditorViewModel: Could not update feature set collections on feature deletion. Original feature not provided.")},i.prototype._handleEditedFeature=function(e){if(e.originalFeature&&e.editedFeature){var t=this.app.featureSetManager.findFeaturesByEsriFeature(e.editedFeature||e.originalFeature);e.editedFeature&&e.originalFeature&&e.editedFeature!==e.originalFeature&&t.concat(this.app.featureSetManager.findFeaturesByEsriFeature(e.originalFeature)),(t=f.distinct(t))&&t.length&&t.forEach(function(t){return t.esriFeature.set(e.editedFeature)})}else this.app.trace.warning("EditorViewModel: Could not update feature set collections on feature edit. Original or edited feature not provided.")},i.prototype._swapOriginalFeatureForClone=function(){if(this.currentFeatureEsri){var e=g.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer);e&&(e.hide(),!this.isEditingGeometry.get()&&this.currentFeatureEsriClone.getLayer()&&this.currentFeatureEsriClone.show())}},i.prototype._restoreOriginalFeature=function(){if(this.currentFeatureEsri){var e=null;(e=this.currentFeatureGeocortex&&this.currentFeatureGeocortex.featureLayer&&"Table"==this.currentFeatureGeocortex.featureLayer.type?g.findFeatureInLayer(this.currentFeatureEsri,this._sourceLayer):g.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer))&&e.show()}},i.prototype.cancelEditing=function(){this.stopEditingGeometry(!0),this.geometryHasBeenEdited.set(!1),this._restoreOriginalFeature(),this._destroyEditingLayer(),this.form.get()&&this.form.get().clear(),this._sourceLayer&&this._sourceLayer.refresh(),this.isEditingGeometry.set(!1),this.isEditingLogEntry.set(!1),this.isEditingNewFeature.set(!1),this.isEditingRelatedFeature.set(!1),this.isEditingRelatedFeatureNotInSite.set(!1),this.layerUpdateEndToken&&dojo.disconnect(this.layerUpdateEndToken),this.app.behavior("EditorRemoveFeatureSelectedBehavior").run(),this.app.event("EditorClosedEvent").publish(),this.state=E.Idle},i.prototype._canExecuteStartEditingFeature=function(e){if(!e)return!1;if(this.app.offlineManager.isOfflineMapActive.get()&&!this.canEditOffline)return!1;if(e.layer){var t=e.layer;if(t.mapService&&t.mapService.serviceLayer){if(!t.mapService.serviceLayer.isEditable)return!1;if(!t.mapService.serviceLayer.isEditable())return!1;if(this.app.offlineManager.isOfflineMapActive.get()&&!(r=this.app.offlineManager.syncInfo.findLayerOrTable(e.layer.mapService.serviceLayer.url)).canEdit)return!1}var i=e.esriFeature.get();if(i)return!!i.getLayer()||(t.mapService&&t.mapService.serviceLayer&&(i._graphicsLayer=i._layer=t.mapService.serviceLayer),!!g.findFeatureInMap(i,this.app.site))}else if(e.featureLayer){if(this.app.offlineManager.isOfflineMapActive.get()){var r=this.app.offlineManager.syncInfo.findLayerOrTable(e.featureLayer.url);return r.canEdit}return e.featureLayer.isEditable()}return!1},i.prototype.handleClickEditGeometry=function(){if(this.isEditingGeometry.get()){this.stopEditingGeometry();var e=new o.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(e)}else this.startEditingGeometry(),this.app.behavior("EditorRemoveFeatureSelectedBehavior").run();return!1},i.prototype._executeStartEditingAttributesAndGeometryFeature=function(e,t){var i=this;void 0===t&&(t=!1),this._executeStartEditingFeature(e,t).then(function(e){i.canEditGeometry.get()&&i.handleClickEditGeometry()})},i.prototype._executeStartEditingFeature=function(e,t){var i=this;return void 0===t&&(t=!1),new Promise(function(r,a){var n=!0;i.isEditingNewFeature.set(t),i.geometryHasBeenEdited.set(!1);var s;try{if(e&&e instanceof o.Feature){var l=e;l.layer&&l.layer.mapService&&(i.currentMapService=l.layer.mapService),l.featureLayer&&"Table"==l.featureLayer.type&&(n=!1),i.currentFeatureGeocortex=e,i.headerText.set(l.plainLabel.get()),s=l.esriFeature.get()}else s=e;i.app.map&&i.app.site&&i.app.site.isInitialized?i.isEditingNewFeature.get()?(i._executeStartEditingFeatureImpl(s,t,n),r()):i._refreshEsriGraphic(s).then(function(e){null!=e&&e.features&&e.features.length>0&&e.features[0].attributes?(s.attributes={},dojo.mixin(s.attributes,e.features[0].attributes)):i.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),i._executeStartEditingFeatureImpl(s,t,n),r()}).caught(function(e){i.app.trace.info("Error retrieving most recent version of feature for editing. Falling back to currently loaded version."),i._executeStartEditingFeatureImpl(s,t,n),a(e)}):i.app.event("SiteInitializedEvent").once(i,function(){i._executeStartEditingFeatureImpl(s,t,n),r()})}catch(e){i.app.trace.error("Could not start editing: {0}".format(e)),i.cancelEditing(),a(e)}})},i.prototype._refreshEsriGraphic=function(e,t){var i=this,r=null;t||(t=e.getLayer()),r=this._getMapServiceByLayer(t);var a=e[b.HIGHLIGHT_ID_PROPERTY],n=t.objectIdField;!n&&r.serviceLayer instanceof esri.layers.FeatureLayer&&(n=r.serviceLayer.objectIdField);var o=new esri.tasks.Query;o.objectIds=[e.attributes[n]],o.returnGeometry=!0,o.outFields=["*"],o.outSpatialReference=this.app.map.spatialReference;var s=l.getQueryTask(t,r);return new Promise(function(e,r){s.execute(o,function(r){r&&r.features&&r.features.length&&(r.features[0]._layer=t,i.app.highlightManager.updateHighlightId(r.features[0],a)),e(r)},r)})},i.prototype._executeStartEditingFeatureImpl=function(e,t,i){void 0===t&&(t=!1),this.state!==E.Idle&&(this.cancelEditing(),this.isEditingNewFeature.set(t));var r=null;if(i){var a=t?e:g.findFeatureInMap(e,this.app.site);if(this.originalFeatureClone=this._cloneEsriFeature(a),r=t?this._sourceLayer:a.getLayer()){if(r instanceof esri.layers.GraphicsLayer&&!(r instanceof esri.layers.FeatureLayer)){var o=r;if(o.id){var s=o.id.replace("-explodedClusterLayer",""),l=this.app.map.getLayer(s);l instanceof esri.layers.FeatureLayer&&(r=l)}o.renderer&&e.setSymbol(o.renderer.getSymbol(e))}t&&(r.objectIdField&&(e.attributes[r.objectIdField]=0),r.globalIdField&&(e.attributes[r.globalIdField]="")),this._sourceLayer=r,this._calculateCanDeleteFeature(),this.layerUpdateEndToken=dojo.connect(r,"onUpdateEnd",dojo.hitch(this,this._handleLayerUpdateEnd)),this.state=E.EditingAttributes,this.isEditingRelatedFeatureNotInSite.set(!1),this.canEditGeometry.set(this.configAllowsEditGeometry&&!!r.geometryType&&r.allowGeometryUpdates),this.showStopEditingGeometryButton.set(!1),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.currentFeatureEsri=a,this.currentFeatureEsriClone=this._cloneEsriFeature(a),a.hasOwnProperty("_drawType")&&(this.currentFeatureEsriClone._drawType=a._drawType),this._createEditingLayer(),this._editingLayer.add(this.currentFeatureEsriClone);var d={textareaThreshold:this.textareaThreshold,doNotAdjustTime:this.doNotAdjustTime};if(this.currentFeatureGeocortex&&this.currentFeatureGeocortex.layer){var u=[];this.currentFeatureGeocortex.layer.fields.forEach(function(e){u.push(e.name)}),d.fieldOrder=u}if(this.form.set(new n.EditingFormViewModel(this.app,this.libraryId,e,r,d)),this.app.event("Internal.EditorFormSetupEvent").publish(this.form,a),null!=this._sourceLayer.typeIdField)for(var p=this.form.get(),c=0;c<p.fields.getLength();c++){var h=p.fields.getAt(c);if(h.name.get()===this._sourceLayer.typeIdField){this.handleTypeFieldSelected(h);break}}try{this._buildFeatureRelationships()}catch(e){this.app.trace.warning("Could not set up related records for editing.")}this.isBusy.set(!1),t||this._activateEditingView()}else this.app.trace.error("Error - could not find layer for feature.")}else this._editAsTable(e)},i.prototype._canExecuteStartEditingNewFeature=function(e){return!(this.app.offlineManager.isOfflineMapActive.get()&&!this.canEditOffline)},i.prototype._editAsTable=function(e){for(var t=this,i=this.app.site.getFeatureServices(),r=null,a=null,n=0;n<i.length;n++){var o=i[n];o.serviceLayer.relationships.forEach(function(i){var n=t.currentFeatureGeocortex.featureLayer;if(i.relatedTableId!=n.layerId);else{a=n,r=i;var s=null,l=null,d=t.app.site&&t.app.site.essentialsMap?t.app.site.essentialsMap.findLayerFromMatchingEsriFeatureLayer(a):null;d?(s=m.getTimeZoneFromLayer(d),l=m.getDisplayTimeZoneFromMapService(d.mapService)):(s=m.getTimeZoneFromMapService(o),l=m.getDisplayTimeZoneFromMapService(o));var u={id:a.layerId,text:"Editing "+e.attributes.OBJECTID,relatedFeature:null,essentialsRelatedFeature:null,feature:e,editable:a.isEditable(),relationship:r,timeZoneId:s,displayTimeZoneId:l};t._executeStartEditingRelatedRecord(u,!1)}})}},i.prototype._executeStartEditingNewFeature=function(e,t,i){void 0===i&&(i=!0),this.currentFeatureEsri=e,this._sourceLayer=t,this._calculateCanDeleteFeature(),this.currentFeatureGeocortex=null;var r=this.app.getResource(this.libraryId,"language-common-feature-editing");this.headerText.set(r),this._executeStartEditingFeature(e,!0),i?t.geometryType&&t.allowGeometryUpdates?this.startEditingGeometry():this._activateEditingView():(this._activateEditingView(),this.currentFeatureEsriClone.show())},i.prototype._canExecuteStartEditingEditLogEntry=function(e){return!0},i.prototype._executeStartEditingEditLogEntry=function(e){return!0},i.prototype.handleTypeFieldSelected=function(e){if(e){var t=e.value.get();if(null!=t)for(var i=0;i<e.valueOptions.getLength();i++){var r=e.valueOptions.getAt(i);if(null!=r.id&&r.id.toString()===t.toString()){this._loadCodedDomainsForType(r.domains,e.name.get());break}}}},i.prototype._loadCodedDomainsForType=function(e,t){if(e){var i=this.form.get();for(var r in e)if(r!==t&&e.hasOwnProperty(r)&&e[r].type)for(var a=0;a<i.fields.getLength();a++){var n=i.fields.getAt(a),o=!0;if(n.name.get()===r){var s=[];if("inherited"!==e[r].type)s=e[r].codedValues;else{for(var l=0;l<this._sourceLayer.fields.length;++l){var d=this._sourceLayer.fields[l];if(d.name===n.name.get()){var u=d.domain;if(u){u.codedValues?s=u.codedValues:o=!1;break}}}if(!o)continue}var p={viewModel:n,typeName:"codedDomainValue",collectionName:"codedDomainValues",valueCollection:s,nullable:n.nullable.get(),nullOption:{name:"",code:null}};this._addValueCollection(p),n.value.pulse()}}}},i.prototype._addValueCollection=function(e){function t(e){return null===e||void 0===e?"":e.toString()}if(e){var i=e.viewModel.valueOptions;i||(i=e.viewModel.valueOptions=new a.ObservableCollection([])),i.clear(),i.addItems(e.valueCollection),e.nullable&&i.insertItem(0,e.nullOption);var r=t(e.viewModel.value.get());if(!i.get().some(function(e){return t(e.code)===r})){var n=i.get().filter(function(t){return t!==e.nullOption})[0];e.viewModel.value.set(n?n.code:e.nullOption.code)}}},i.prototype._activateEditingView=function(){this.app.command("HideFeatureTemplatePicker").execute(),this.app.command("ActivateView").execute("EditorView");var e=new o.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(e)},i.prototype._getEditingToolMessage=function(e){var t=Modernizr&&!!Modernizr.touch;switch(e){case esri.toolbars.Draw.POINT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-point");case esri.toolbars.Draw.MULTI_POINT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-multi-point");case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYLINE:return i=t?this.app.getResource(this.libraryId,"language-feature-editing-geometry-polyline-touch"):this.app.getResource(this.libraryId,"language-feature-editing-geometry-polyline");case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.FREEHAND_POLYGON:var i=t?this.app.getResource(this.libraryId,"language-feature-editing-geometry-polygon-touch"):this.app.getResource(this.libraryId,"language-feature-editing-geometry-polygon");return i;case esri.toolbars.Draw.EXTENT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-rectangle")}return this.app.getResource(this.libraryId,"language-feature-editing-geometry-default")},i.prototype.findGeocortexLayerForUrl=function(e){for(var t=this.app.site,i=0;i<t.essentialsMap.mapServices.length;i++){var r=t.essentialsMap.mapServices[i];if(r.serviceUrl===e&&r.layers.length>0)return r.layers[0]}return null},i.prototype._findServiceLayerForUrl=function(e){for(var t=this.app.site,i=0;i<t.essentialsMap.mapServices.length;i++){var r=t.essentialsMap.mapServices[i];if(r.url===e)return r.serviceLayer}return null},i.prototype._hideOrShowRelateds=function(){this.showRelatedLayers.set(this.hasRelatedLayers.get()&&!this.isEditingRelatedFeatureNotInSite.get()&&!this.isEditingNewFeature.get())},i.prototype._calculateCanDeleteFeature=function(){this.canDeleteFeature.set(!this.isEditingNewFeature.get()&&this._sourceLayer&&/Delete/.test(this._sourceLayer.capabilities))},i.prototype.editingInProgress=function(){return!!this._editingLayer},i}(r.ViewModelBase);i.EditorViewModel=F})},"Mapping/modules/Editing/MultiFeatureSelector/MultiFeatureSelectorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FeatureDescriptionPresenterView","geocortex/infrastructure/HtmlUtils"],function(t,i,r,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("HideMultiFeatureSelectorView").register(r,function(){r.isActive&&r.app.viewManager.deactivateView(r)}),r.app.event("ViewActivatedEvent").subscribe(r,r.setDisplayResultPickerListOffset),r}return e(i,t),i.prototype.setDisplayResultPickerListOffset=function(e){var t=this;this.id===e.id&&n.pollUntil(function(){return 0!==$(t.root).width()},50,5e3).finally(function(){if(t.topContainer){var e=t.topContainer.clientHeight;t.viewModel.topOffset.set(e)}if(t.bottomContainer){var i=t.bottomContainer.clientHeight;t.viewModel.bottomOffset.set(i)}})},i.prototype.handleClickButton=function(e,t,i){this.viewModel.selectedFeatures.get().length>0?this.viewModel.submitResults():this.viewModel.showError()},i.prototype.handleClick=function(e,t,i){return this._firstEvent&&this._cancelLongPress&&(this._firstEvent=null,this._cancelLongPress()),"A"===e.target.tagName||(this.viewModel.featureClicked(i),!0)},i.prototype.handleClearTextBox=function(e,t,i){this.viewModel.clearTextBox()},i.prototype.handleSelectAll=function(e,t,i){this.viewModel.selectAll()},i.prototype.handleSelectNone=function(e,t,i){this.viewModel.selectNone()},i.prototype.resolveWidget=function(e,i){t.prototype.resolveWidget.call(this,e,i);var r;return"GetLabel"===e?(r=new a.FeatureDescriptionPresenterView(this.app,this.libraryId),r.contentField="label",r.root=dojo.create("div"),r.root.className="feature-label",r.attach(i),r):"GetDescription"===e?(r=new a.FeatureDescriptionPresenterView(this.app,this.libraryId),r.root=dojo.create("div"),r.root.className="feature-description",r.attach(i),r):"RenderComplexResultTemplate"===e&&"complex"===this.viewModel.resultTemplateComplexity?(r=this.app.viewManager.createView({markupResource:"Mapping/modules/Workflow/Templates/DisplayResultPickerComplexResultTemplateView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.workflow.templates.DisplayResultPickerResultTemplateView"}),r.app=this.app,r.libraryId=this.libraryId,r.parentView=this,r.attach(i),r):"RenderSimpleResultTemplate"===e&&"simple"===this.viewModel.resultTemplateComplexity?(r=this.app.viewManager.createView({markupResource:"Mapping/modules/Workflow/Templates/DisplayResultPickerSimpleResultTemplateView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.workflow.templates.DisplayResultPickerResultTemplateView"}),r.app=this.app,r.libraryId=this.libraryId,r.parentView=this,r.attach(i),r):void 0},i}(r.ViewBase);i.MultiFeatureSelectorView=o})},"Mapping/modules/Editing/MultiFeatureSelector/MultiFeatureSelectorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","../DisplayResultPickerFeature","geocortex/forms/FormButton"],function(t,i,r,a,n,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.buttons=null,e.filterSectionVisible=new a.Observable(!0),e.showFilterTextBox=new a.Observable(!1),e.isSingleSelectionMode=new a.Observable(!0),e.filterText=new a.Observable(""),e.disabledLinkCssClass=new a.Observable(""),e.topOffset=new a.Observable("0px"),e.bottomOffset=new a.Observable("0px"),e.message=null,e}return e(i,t),i.prototype.initialize=function(e){this.app.command("ShowSelectionListOfFeaturesWithCallback").register(this,this._showSelectionListOfFeatures),this.featureSet=null,this.features=new a.ObservableCollection([]),this.selectedFeatures=new a.ObservableCollection([]),this.resultsList=new a.ObservableCollection([]),this.cssClass=new a.Observable("display-result-picker-list");var t=e.displayResultPickerTemplateComplexity;this.resultTemplateComplexity=void 0===t||"complex"!=t&&"simple"!=t?"complex":t.toLowerCase(),this.message=new a.Observable(this.app.getResource(this.libraryId,"language-feature-editing-multi-feature-selector-message")),this.requiredValueErrorMessage=new a.Observable("");var i=[];i.push(new o.FormButton("Done","Done",!0,!0)),this.buttons=a.Observable.makeBindableProxy(i)},i.prototype._showSelectionListOfFeatures=function(e,t){this.callback=t,this.featureSet=e,this.features.clear();for(var i=0;i<e.features.length();i++){var r=n.generateDisplayResultPickerFeaturefromFeature(e.features.getAt(i));r.showCheckbox=!1,this.features.addItem(r)}this.selectedFeatures.set([]),this.resultsList.set(this.features.get()),this.requiredValueErrorMessage.set(""),this.cssClass.set("display-result-picker-list"),this.app.command("ActivateView").execute("MultiFeatureSelectorView")},i.prototype.featureClicked=function(e){this.clearSelection(),this.addFeatureToSelection(e,!0)},i.prototype.featureChecked=function(e){this.clearSelection(),this.addFeatureToSelection(e,!0)},i.prototype.addFeatureToSelection=function(e,t){if(void 0!=e.isFiltered.get()&&!e.isFiltered.get()){e.isSelected.set(!0),e.cssClass.set("selected");for(var i=!1,r=0;r<this.selectedFeatures.getItems().length;r++)if(this.selectedFeatures.getItems()[r]===e){i=!0;break}i||this.selectedFeatures.addItem(e);this.features.indexOf(e)}},i.prototype.clearSelection=function(){if(this.selectedFeatures.length()){for(var e=0;e<this.selectedFeatures.length();e++)this.selectedFeatures.getAt(e).isSelected.set(!1),this.selectedFeatures.getAt(e).cssClass.set("");this.selectedFeatures.clear()}},i.prototype.clearTextBox=function(){this.filterText.set("")},i.prototype.selectAll=function(){this.addFeatureToSelection(this.features.getAt(0),!0);for(var e=1;e<this.features.get().length;e++)this.addFeatureToSelection(this.features.getAt(e),!1)},i.prototype.selectNone=function(){this.clearSelection()},i.prototype.submitResults=function(){this.callback&&this.callback(this.selectedFeatures.getAt(0))},i.prototype.showError=function(){this.requiredValueErrorMessage.set(this.app.getResource(this.libraryId,"language-feature-editing-multi-feature-selector-error-message")),this.cssClass.set("display-result-picker-list error")},i}(r.ViewModelBase);i.MultiFeatureSelectorViewModel=s})},"Mapping/modules/Editing/TemplatePicker/FeatureTemplateViewModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.name=new i.Observable(""),this.description=new i.Observable,this.proto={},this.drawingTool=new i.Observable,this.symbolUri=new i.Observable,this.symbolStyle=new i.Observable(""),this.swatchElement=null}}();t.FeatureTemplate=r})},"Mapping/modules/Editing/TemplatePicker/TemplateFeatureLayerModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/TemplatePicker/TemplatePickerView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/Layer"],function(t,i,r,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("ShowFeatureTemplatePicker").register(r,r._onShowFeatureTemplatePicker,r._canShowFeatureTemplatePicker),r.app.command("HideFeatureTemplatePicker").register(r,function(){r.isActive&&r.app.viewManager.deactivateView(r)}),r}return e(i,t),i.prototype._onShowFeatureTemplatePicker=function(e,t){if(this.app.command("_CancelEditing").execute(),this.app.command("ActivateView").execute(this.id),this.viewModel){if(this.app.command("Internal.CancelEditingIfNotIdle").execute(),!e&&!t)return void this.viewModel.loadLayerTemplates();this.viewModel.filteredLayers&&(this.viewModel.filteredLayers.length=0,this.viewModel.filteredLayers=null),this._loadTemplate(e,t)}},i.prototype._canShowFeatureTemplatePicker=function(e,t){return!(this.viewModel&&this.app.isOffline.get()&&!this.viewModel.canEditOffline)&&(!((e||t)&&(e||!t))||!!("object"==typeof e&&e instanceof a.Layer&&e.mapService&&e.mapService.serviceLayer&&e.mapService.serviceLayer.isEditable&&/Create/.test(e.mapService.serviceLayer.capabilities))&&e.mapService.serviceLayer.isEditable())},i.prototype._loadTemplate=function(e,t){e?this.viewModel.loadTemplatesForCurrentLayer(e,t):this.viewModel.loadLayerTemplates(t)},i.prototype.handleFeatureTemplateClick=function(e,t,i){var r=this;this.app.command("Internal.CancelEditingIfNotIdle").execute();var a;if(i.proto&&i.proto.toJson&&!i.relatedFeature)a=new esri.Graphic(i.proto.toJson());else if(i.relatedFeature){if(i.proto&&i.proto.toJson){a=i.relatedFeature;for(var n in i.proto.attributes){var o=i.proto.attributes[n];null!=o&&(a.attributes[n]=o)}}}else a=new esri.Graphic(null),i.proto&&i.proto.attributes&&(a.attributes=i.proto.attributes);var s=null;if(i.drawingTool&&i.drawingTool.get())switch(i.drawingTool.get()){case"esriFeatureEditToolPoint":s="MapPoint";break;case"esriFeatureEditToolLine":s="Polyline";break;case"esriFeatureEditToolFreehand":"esriGeometryPolyline"===i.layer.geometryType?s="FreehandPolyline":"esriGeometryPolygon"===i.layer.geometryType&&(s="FreehandPolygon");break;case"esriFeatureEditToolAutoCompletePolygon":case"esriFeatureEditToolPolygon":s="Polygon";break;case"esriFeatureEditToolEllipse":s="Ellipse";break;case"esriFeatureEditToolCircle":s="Circle";break;case"esriFeatureEditToolRectangle":s="Rectangle";break;default:s="Polygon"}if(!s)switch(i.layer.geometryType){case"esriGeometryPoint":s="MapPoint";break;default:s=i.layer.geometryType.replace("esriGeometry","")}a._drawType=s,this.app.configuration.mobileMode?(this.app.command("DisableMapClick").execute(),this.app.command("ShowMap").execute(),this.app.command("CloseDataFrame").execute(),this.app.event("DataFrameClosedEvent").once(this,function(){setTimeout(function(){r.app.command("EnableMapClick").execute(),r.app.event("StartFeaturePlacementEvent").publish(),r.app.command("StartEditingNewFeature").execute(a,i.layer)},225)})):(this.app.command("ShowMap").execute(),this.app.event("StartFeaturePlacementEvent").publish(),this.app.command("StartEditingNewFeature").execute(a,i.layer))},i}(r.ViewBase);i.TemplatePickerView=n})},"Mapping/modules/Editing/TemplatePicker/TemplatePickerViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./FeatureTemplateViewModel"],function(t,i,r,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.layerIsEditable=new a.Observable(!1),e.layerTemplates=new a.ObservableCollection,e.canEditOffline=!1,e}return e(i,t),i.prototype.initialize=function(e){var t=this;this.app.site&&this.app.site.serviceLayersLoaded?this.loadLayerTemplates():this.app.event("SiteServiceLayersLoadedEvent").subscribe(this,function(){return t.loadLayerTemplates()}),this.app.nativeManager.hasNativeCapability("editing").then(function(e){t.canEditOffline=e})},i.prototype._layerIsValidForEditing=function(e){if(!e)return!1;var t=!0;if(this.filteredLayers){t=!1;for(var i=0;i<this.filteredLayers.length;i++)if(this.filteredLayers[i]===e){t=!0;break}}return t},i.prototype.loadTemplatesForCurrentLayer=function(e,t){if(e&&e.mapService){this.layerTemplates.clear();var i=this._getFeatureLayerModel(e.mapService,t);i&&this.layerTemplates.addItem(i)}},i.prototype.loadLayerTemplates=function(e){var t=this.app.site;if(t&&t.essentialsMap&&t.isInitialized){var i=t.getFeatureServices();this.layerTemplates.clear();for(var r=[],a=0;a<i.length;a++){var n=i[a],o=this._getFeatureLayerModel(n,e);o&&!o.notAvailableReason.get()&&r.push(o)}this.layerTemplates.addItems(r)}},i.prototype._getFeatureLayerModel=function(e,t){var i=e.serviceLayer;if(!this._layerIsValidForEditing(e.id))return null;var r=null;if(this.app.offlineManager.isOfflineMapActive.get()){var n=this.app.offlineManager.syncInfo.findLayerOrTable(i.url);n&&n.canEdit||(this.app.trace.warning("Layer "+i.url+" not available offline. Make sure the layer is included in your offline map if you want to edit it offline."),r=this.getResource("language-feature-editing-not-available-offline"))}i.isEditable&&i.isEditable()||(r=this.getResource("language-feature-editing-not-editable"));var o=e.displayName;e&&e.layers&&e.layers.length>0&&(o=e.layers[0].displayName);var s=new a.ObservableCollection;if(!r){var l=this._loadFeatureTemplates(e.serviceLayer,t);l&&l.length>0&&s.addItems(l)}return{displayName:new a.Observable(o),mapServiceId:new a.Observable(e.id),layer:e.serviceLayer,templates:s,proto:null,notAvailableReason:new a.Observable(r)}},i.prototype.createTemplate=function(e,t,i){var r=new n.FeatureTemplate,a=null;if(!e.renderer){var o=this.app.map.graphicsLayerIds.filter(function(t){return t===e.id+"-cluster"});o.length>0&&(a=this.app.map.getLayer(o[0]))}if(t){var s=t.name;if(r.name.set(s),r.description.set(t.description),r.drawingTool.set(t.drawingTool),r.proto=t.prototype,i&&i.attributes&&(r.relatedFeature=i),e.renderer||a){var l=e.renderer||a.featureLayerRenderer;if(l instanceof esri.renderer.HeatmapRenderer){var d=this.app.site.essentialsMap.mapServices.filter(function(t){return t.serviceLayer.id===e.id})[0];d.heatMap&&d.heatMap.defaultRenderer&&(l=d.heatMap.defaultRenderer)}var u=this._getTemplateSymbol(t,l);if(u)switch(u.type){case"picturemarkersymbol":r.symbolUri.set(u.url),r.swatchElement=null;break;case"simplelinesymbol":var p=String.escapeHtml(u.color.toCss());r.swatchElement="<div class='simple-swatch line' style='color: "+p+"'></div>";break;case"simplefillsymbol":var c=String.escapeHtml(u.color.toCss());r.swatchElement="<div class='simple-swatch square' style='background-color: "+c+"'></div>";break;default:var h=String.escapeHtml(u.color.toCss());r.swatchElement="<div class='simple-swatch square' style='background-color: "+h+"'></div>"}}}return r.layer=e,r},i.prototype._consumeTemplate=function(e,t,i){return this.createTemplate(e,t,i)},i.prototype._getTemplateSymbol=function(e,t){var i=new esri.Graphic(null);return i.attributes={},e.prototype.attributes&&dojo.mixin(i.attributes,e.prototype.attributes),t.getSymbol(i)||t.defaultSymbol},i.prototype._loadFeatureTemplates=function(e,t){if(!e||!e.templates)return null;var i=[];if(e.templates.length>0)for(r=0;r<e.templates.length;++r)i.push(this._consumeTemplate(e,e.templates[r],t));else if(e.types&&e.types.length>0)for(var r=0;r<e.types.length;++r){var a=e.types[r];if(a.templates)for(var n=0;n<a.templates.length;++n)i.push(this._consumeTemplate(e,a.templates[n],t))}return i},i}(r.ViewModelBase);i.TemplatePickerViewModel=o})},"Mapping/modules/Editing/Undoable/Add":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){if(void 0===t&&(t={}),!t.graphicsLayer)throw new Error("Add Operation: Initialization failed. Graphics layer is not provided.");if(!t.addedGraphics)throw new Error("Add Operation: Initialization failed. Added graphics are not provided.");this.state=t,this.displayName=e}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)})})},e}();t.Add=i})},"Mapping/modules/Editing/Undoable/AddAndUpdate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Add/Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.addedGraphics)throw new Error("Add/Update Operation: Initialization failed. Added graphics are not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Add/Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e}();t.AddAndUpdate=i})},"Mapping/modules/Editing/Undoable/AddAndUpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/AddState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/Delete":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){if(void 0===t&&(t={}),!t.graphicsLayer)throw new Error("Delete Operation: Initialization failed. Graphics layer is not provided.");if(!t.deletedGraphics)throw new Error("Delete Operation: Initialization failed. Deleted graphics are not provided.");this.state=t,this.displayName=e}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)})})},e}();t.Delete=i})},"Mapping/modules/Editing/Undoable/DeleteAndUpdate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Delete/Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.deletedGraphics)throw new Error("Delete/Update Operation: Initialization failed. Deleted graphics are not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Delete/Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e}();t.DeleteAndUpdate=i})},"Mapping/modules/Editing/Undoable/DeleteAndUpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/DeleteState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/Update":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t={});var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e}();t.Update=i})},"Mapping/modules/Editing/Undoable/UpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/EditingFormButton":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/EditingFormField":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.other=13]="other"}(r=t.esriFieldTypeEnum||(t.esriFieldTypeEnum={}));var a=function(){function e(){var e=this;this.type=r.esriFieldTypeString,this._isSettingPresentableValue=!1,this._isSettingValue=!1,this.name=new i.Observable,this.displayName=new i.Observable,this.editable=new i.Observable(!0),this.readOnly=new i.Observable(!1),this.required=new i.Observable(!1),this.nullable=new i.Observable(!1),this.cssClass=new i.Observable,this.showIndicator=new i.Observable(!1),this.value=new i.Observable(null),this.presentableValue=new i.Observable,this.formatFunc=function(e){return null===e||void 0===e?"":e.toString()},this.value.bind(this,function(t){e._isSettingValue||(e._isSettingPresentableValue=!0,e.presentableValue.set(e.formatFunc(e.value.get())),e._isSettingPresentableValue=!1)}),this.presentableValue.bind(this,function(t){e._isSettingPresentableValue||(e._isSettingValue=!0,e.value.set(t),e._isSettingValue=!1)})}return e.prototype.showFormattedValue=function(){this._isSettingPresentableValue=!0,this.presentableValue.set(this.formatFunc(this.value.get())),this._isSettingPresentableValue=!1},e.prototype.showActualValue=function(){this._isSettingPresentableValue=!0,this.presentableValue.set(this.value.get()),this._isSettingPresentableValue=!1},e}();t.EditingFormField=a})},"Mapping/modules/Editing/Editor/Form/EditingFormViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./EditingFormField","geocortex/infrastructure/gis/FieldInfo","geocortex/forms/items/DatePickerFormItem","geocortex/forms/items/TimePickerFormItem","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/TimeZoneUtils","./ValidationFunctionFactory"],function(t,i,r,a,n,o,s,l,d,u,p){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var c=function(t){function i(e,i,r,n,o){var s=t.call(this,e,i)||this;s.textareaThreshold=80,s.doNotAdjustTime=!1,s.id="EditingFormViewModel",s.fields=new a.ObservableCollection,s.validationMessages=new a.ObservableCollection,s.buttons=new a.ObservableCollection,s.currentFeature=new a.Observable,s.featureIsNew=new a.Observable(!1);var l=null;return o&&(o.textareaThreshold&&(s.textareaThreshold=o.textareaThreshold),o.fieldOrder&&(l=o.fieldOrder),o.doNotAdjustTime&&(s.doNotAdjustTime=o.doNotAdjustTime),o.timeZoneId&&(s.fallbackTimeZoneId=o.timeZoneId),o.displayTimeZoneId&&(s.fallbackDisplayTimeZoneId=o.displayTimeZoneId)),r&&s.setup(r,n||null,l),s}return e(i,t),i.prototype.addValidationMessage=function(e){this.validationMessages.addItem(e)},i.prototype.clearValidationMessages=function(){this.validationMessages.clear()},i.prototype._fieldHasSubTypeDomainValues=function(e,t){for(var i=0;i<t.types.length;++i){var r=t.types[i];if(r.domains&&e.name in r.domains)return!0}return!1},i.prototype.setup=function(e,t,i){var r=this;this.clear();var a=[];if(!t)throw new Error("Attempted to edit a feature with no layer attached!");for(var c=null,h=this.app.site.getFeatureServices(),g=null,f=0;f<h.length;++f){var m=h[f];if(m.serviceLayer===t){g=m.layers[0];break}}var y=[],v=t._outFields;if(v&&v.length>0)for(var b=0;b<v.length;++b){var E=v[b];if(0===b&&"*"===E){y=t.fields;break}for(var F=0;F<t.fields.length;++F){var _=t.fields[F];if(_.name===E){y.push(_);break}}}else y=t.fields;if(i){var w=y.slice(),C=[];i.forEach(function(e){for(var t=w.length-1;t>-1;--t){var i=w[t];i.name===e&&(C.push(i),w.splice(t,1))}}),C.concat(w),y=C}for(var I=function(e,t){for(var i=0;i<t.length;i++){var r=t[i].prototype.attributes;if(e.name&&r.hasOwnProperty(e.name))return e.nullable=null===r[e.name],!0}return!1},G=0;G<y.length;++G){var S=y[G];if(S&&S.editable){var x=function(e){if(!g)return null;for(var t=0;t<g.fields.length;++t){var i=g.fields[t];if(i.name===e)return i}return null}(S.name);if(!x||x.visible){var T=o.FieldInfo.fromEsriField(S,t,x);if(void 0===S.nullable||null===S.nullable)if(t&&t.templates&&t.templates.length)I(S,t.templates);else if(t&&t.types&&t.types.length)for(var M=0;M<t.types.length&&!(t.types[M].templates&&t.types[M].templates.length&&I(S,t.types[M].templates));M++);var O=!0===S.nullable,L=!!x&&!x.editable,R=!1===O&&!L,k=null;this.featureIsNew.get()&&S.name!==t.typeIdField||e.attributes&&(k=e.attributes[S.name]);var A=new n.EditingFormField;if(A.name.set(S.name),A.readOnly.set(L),A.nullable.set(O),A.required.set(R),A.showIndicator.set(A.required.get()),A.type=n.esriFieldTypeEnum[S.type],A.renderType=S.type,function(e){!e.timeZoneId&&r.fallbackTimeZoneId&&(e.timeZoneId=r.fallbackTimeZoneId),!e.displayTimeZoneId&&r.fallbackDisplayTimeZoneId&&(e.displayTimeZoneId=r.fallbackDisplayTimeZoneId),A.formatFunc=function(t){return e.formatValue(t)}}(T),A.value.set(k),A.length=S.length,A.editable.set(S.editable),x?A.displayName.set(x.displayName):A.displayName.set(null!=S.alias?S.alias:S.name),"esriFieldTypeDate"===S.type){var D=new s.DatePickerFormItem(null,null);D.timePickerItem=new l.TimePickerFormItem(null,null);var V;if(e&&e.attributes[S.name]?(V=d.parseDate(e.attributes[S.name]),V=T.displayTimeZoneId?u.correctDatesForDisplayInDisplayTimeZone(V,T.timeZoneId,T.displayTimeZoneId):u.correctDatesForDisplayInLocalTime(V,T.timeZoneId)):V=A.nullable.get()?null:new Date,D.includeTimePicker.set(!0),D.initialDate.set(V),D.date.set(V),D.isRequired.set(A.required.get()),D.nullable.set(A.nullable.get()),T.format){var N=T.format.match(/\{0:([^}]*)\}/);N&&2==N.length&&D.dateFormat.set(N[1])}!function(e){D.date.bind(r,function(t){r.doNotAdjustTime||(t=u.correctDatesToSubmitInDatabaseTime(t,T.timeZoneId,T.displayTimeZoneId)),e.value.set(t)})}(A),A.datePickerViewModel=D}else if(S.name===t.typeIdField){var U={valueCollection:t.types,nullable:!R,nullOption:{name:"",code:null}};A.renderType="typeField",this._applyFieldConfiguration(U,A),c=k}else if(T.isCodedValueDomain()||T.hasSubtypeCodedValueDomains()){var P=S.domain;if(P)A.domain=P;else for(var B=0;B<t.types.length;++B){var j=t.types[B];if(j.domains&&S.name in j.domains){A.domain=j.domains[S.name];break}}if("codedValue"===A.domain.type){var Z={valueCollection:A.domain.codedValues,nullable:!R,nullOption:{name:"",code:null}};A.renderType="codedDomainValue",this._applyFieldConfiguration(Z,A)}}else A.type!==n.esriFieldTypeEnum.esriFieldTypeDouble&&A.type!==n.esriFieldTypeEnum.esriFieldTypeInteger&&A.type!==n.esriFieldTypeEnum.esriFieldTypeOID&&A.type!==n.esriFieldTypeEnum.esriFieldTypeSingle&&A.type!==n.esriFieldTypeEnum.esriFieldTypeSmallInteger||A.value.set(d.formatNumber(d.parseNumber(k),"#.####################")),A.type===n.esriFieldTypeEnum.esriFieldTypeString&&A.length>this.textareaThreshold?A.renderType="textArea":A.renderType=this._getRenderTypeForField(A);this.app.urlParameters.hasOwnProperty("noval")?A.validationFunc=function(){return null}:A.validationFunc=p.ValidationFunctionFactory.createValidationFunction(this.app,this.libraryId,A,this),a.push(A)}}}if(this.fields.addItems(a),null!==c)for(B=0;B<t.types.length;B++){var H=t.types[B];null!==H.id&&H.id.toString()===c.toString()&&this._applyCodedDomains(H.domains)}},i.prototype.getRawFieldValue=function(e){for(var t=0;t<this.fields.getLength();++t){var i=this.fields.getAt(t);if(i.name.get()===e)return i.value.get()}return null},i.prototype.getAttributeValues=function(){for(var e={},t=0;t<this.fields.getLength();++t){var i=this.fields.getAt(t),r=i.value.get(),a=null;i.type===n.esriFieldTypeEnum.esriFieldTypeDate?a=null===(r=i.value.get())?null:d.parseDate(r).getTime():i.type===n.esriFieldTypeEnum.esriFieldTypeDouble||i.type===n.esriFieldTypeEnum.esriFieldTypeInteger||i.type===n.esriFieldTypeEnum.esriFieldTypeOID||i.type===n.esriFieldTypeEnum.esriFieldTypeSingle||i.type===n.esriFieldTypeEnum.esriFieldTypeSmallInteger?(a=d.parseNumber(r),isNaN(a)&&(a=null)):a=r,""===r&&i.type!==n.esriFieldTypeEnum.esriFieldTypeString&&(a=null),e[i.name.get()]=a}return e},i.prototype._getRenderTypeForField=function(e){return"text"},i.prototype._applyCodedDomains=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&"codedValue"===e[t].type)for(var i=0;i<this.fields.getLength();i++){var r=this.fields.getAt(i);if(r.name.get()===t){var a={valueCollection:e[t].codedValues,nullable:r.nullable.get(),nullOption:{name:"",code:null}};r.renderType="codedDomainValue",this._applyFieldConfiguration(a,r);break}}},i.prototype._applyFieldConfiguration=function(e,t){t.valueOptions?t.valueOptions.clear():t.valueOptions=new a.ObservableCollection([]),t.valueOptions.addItems(e.valueCollection),e.nullable&&t.valueOptions.insertItem(0,e.nullOption);for(var i=0;i<t.valueOptions.getLength();++i){var r=t.valueOptions.getAt(i);void 0===r.code&&r.hasOwnProperty("id")&&(r.code=r.id)}},i.prototype.clear=function(){this.fields.clear(),this.clearValidationMessages()},i}(r.ViewModelBase);i.EditingFormViewModel=c})},"Mapping/modules/Editing/Editor/Form/EditingValidatorDelegate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/ValidationFunctionFactory":function(){define(["require","exports","./EditingFormField","geocortex/infrastructure/FormatUtils"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.createValidationFunction=function(t,r,a,n){var o=i.esriFieldTypeEnum[a.type],s=function(e){return!1===e.editable.get()||!1!==e.nullable.get()&&!0!==e.required.get()?null:t.getResource(r,"language-feature-editing-requires-value").format(e.displayName.get())};if(a.domain){var l=function(i,n,o,l){var d=t.getResource(r,"language-feature-editing-invalid-number").format(n,o,l);return i?e.isValidNumber(a,i)?i<o||i>l?d:null:d:s(a)};if("codedValue"===a.domain.type)return function(e){return!a.required.get()||null!==e&&void 0!==e?null:t.getResource(r,"language-feature-editing-requires-value").format(a.displayName.get())};if("range"===a.domain.type){var d=a.domain;return a.domain.hasOwnProperty("range")?("function"==typeof d.replace&&(d=d.replace("[","").replace("]","").split(",")),function(e){return l(e,a.displayName.get(),d[0],d[1])}):function(e){return l(e,a.displayName.get(),d.minValue,d.maxValue)}}return function(e){return null}}switch(o){case"esriFieldTypeDate":return function(e){return e?null:s(a)};case"esriFieldTypeString":case"esriFieldTypeGUID":return function(e){return e?a.length&&e.toString().length>a.length?t.getResource(r,"language-feature-editing-value-too-long").format(a.displayName.get(),a.length):null:s(a)};case"esriFieldTypeSingle":case"esriFieldTypeDouble":return function(i){return i||0===i?e.isValidNumber(a,i)?e.isWithinNumericTypeRange(a,i)?null:t.getResource(r,"language-feature-editing-invalid-numeric-range").format(a.displayName.get()):t.getResource(r,"language-feature-editing-invalid-decimal").format(a.displayName.get()):s(a)};case"esriFieldTypeSmallInteger":case"esriFieldTypeInteger":return function(i){return i||0===i?e.isValidNumber(a,i)?e.isWithinNumericTypeRange(a,i)?null:t.getResource(r,"language-feature-editing-invalid-numeric-range").format(a.displayName.get()):t.getResource(r,"language-feature-editing-invalid-integer").format(a.displayName.get()):s(a)};default:return function(e){return null}}},e.isWithinNumericTypeRange=function(e,t){var a=r.parseNumber(t);if(isNaN(a))return!1;var n=!0;if(e.type===i.esriFieldTypeEnum.esriFieldTypeSingle){var o=3.402823*Math.pow(10,38);n=a>=-o&&a<=o}else if(e.type===i.esriFieldTypeEnum.esriFieldTypeSmallInteger){n=a>=-32768&&a<=32767}else if(e.type===i.esriFieldTypeEnum.esriFieldTypeInteger){n=a>=-2147483648&&a<=2147483647}return n},e.isValidNumber=function(e,t){return!isNaN(r.parseNumber(t))},e}();t.ValidationFunctionFactory=a})},"url:/Mapping/modules/Editing/CreateOrEdit/CreateOrEditView.html":t,"url:/Mapping/modules/Editing/Editor/EditorView.html":i,"url:/Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html":r,"url:/Mapping/modules/Editing/TemplatePicker/TemplatePickerView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/CSS/common.css","css","LmNvbnRlbnQtY29udGFpbmVyIHsNCiAgICBwYWRkaW5nOiAxLjVlbTsNCn0NCi5idXR0b24tYWN0aW9uLWljb24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgbWluLWhlaWdodDogOGVtOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjI1ZW07DQp9DQouYnV0dG9uLWFjdGlvbi1pY29uIGltZyB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luOiAwIGF1dG8gMWVtIGF1dG87DQp9DQouYWN0aW9uLWJ0bnMsDQouYWN0aW9uLWJ0bnMgbGkgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGxpc3Qtc3R5bGU6IG5vbmU7DQp9DQouYWN0aW9uLWJ0bnMgbGkgew0KICAgIHdpZHRoOiA1MCU7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgcGFkZGluZzogMCAxZW07DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KDQp9DQouYWN0aW9uLWJ0bnMgbGk6bnRoLWNoaWxkKG9kZCkgew0KICAgIHBhZGRpbmctbGVmdDogMDsNCn0NCi5hY3Rpb24tYnRucyBsaTpudGgtY2hpbGQoZXZlbikgew0KICAgIHBhZGRpbmctcmlnaHQ6IDA7DQp9DQouYWN0aW9uLWJ0bnM6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBjbGVhcjogYm90aDsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBoZWlnaHQ6IDA7DQogICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KfQ0KDQoNCi8qIEZFQVRVUkUgRURJVElORyAoQ09NTU9OKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLw0KLmVkaXRvciAuZm9ybS1jb250cm9sDQp7DQogICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQouZWRpdG9yIC5mb3JtLWxhYmVsLA0KLmVkaXRvciAuZm9ybS1jb250cm9sDQp7DQogICAgd2lkdGg6IGF1dG87DQp9DQoNCi5lZGl0b3Igc2VsZWN0IHsNCiAgICBtYXgtd2lkdGg6IDMwMHB4Ow0KfQ0KDQouZWRpdG9yIC5mb3JtLWNvbnRyb2wNCnsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCiAgICAuZWRpdG9yIC5mb3JtLWNvbnRyb2wgdGV4dGFyZWENCiAgICB7DQogICAgICAgIGhlaWdodDogMjAwcHg7DQogICAgfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIgLmxpc3QtbWVudS1pdGVtDQp7DQogICAgcGFkZGluZzogMDsNCn0NCg0KLmZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIC5saXN0LW1lbnUtbmFtZQ0Kew0KICAgIG1hcmdpbi1sZWZ0OiAwLjc1ZW07DQp9DQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAuZmVhdHVyZS10ZW1wbGF0ZQ0Kew0KICAgIHBhZGRpbmc6IDFlbTsNCn0NCg0KLmZlYXR1cmUtdGVtcGxhdGU6YWZ0ZXINCnsNCiAgICBjb250ZW50OiAiICI7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgaGVpZ2h0OiAwOw0KICAgIGNsZWFyOiBib3RoOw0KICAgIHZpc2liaWxpdHk6IGhpZGRlbjsNCn0NCg0KLnZpZXctZmVhdHVyZS1nZW9tZXRyeS1zZWxlY3RvciwNCi52aWV3LWZlYXR1cmUtY3JlYXRlLW9yLWVkaXQNCnsNCiAgICBwYWRkaW5nOiA4cHg7DQp9DQoNCi5jcmVhdGUtZWRpdC1idG5zIC5idXR0b24sDQoubG9jYXRpb24tYnRucyAuYnV0dG9uDQp7DQogICAgbWFyZ2luLXRvcDogNHB4Ow0KICAgIG1hcmdpbi1yaWdodDogNHB4Ow0KfQ0KDQoNCi8gRklYIEZPUiBERVNLVE9QIENPTlRFWFQgTUVOVSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KDQovKiBGZWF0dXJlIFRlbXBsYXRlIFBpY2tlciBSdWxlcyAtIEdWSC02MjIyICovDQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAuZmVhdHVyZS10ZW1wbGF0ZTo6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIiOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGNsZWFyOiBib3RoOw0KfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIgLmZlYXR1cmUtdGVtcGxhdGUgew0KICAgIHBhZGRpbmc6IDFlbTsNCn0NCg0KLmZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIC5mZWF0dXJlLXRlbXBsYXRlLmhhcy1pY29uIC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbWFyZ2luLWxlZnQ6IDIuNWVtOw0KICAgIHBhZGRpbmctbGVmdDogMDsNCn0NCg0KDQouZGlqaXRQb3B1cA0Kew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICBib3gtc2hhZG93OiAycHggMnB4IDJweCAjNDQ0NDQ0Ow0KICAgIC13ZWJraXQtYm94LXNoYWRvdzogMnB4IDJweCAycHggIzQ0NDQ0NDsNCn0NCg0KICAgIC5kaWppdFBvcHVwIGlmcmFtZQ0KICAgIHsNCiAgICAgICAgZGlzcGxheTogbm9uZTsNCiAgICB9DQoNCiAgICAuZGlqaXRQb3B1cCB0YWJsZQ0KICAgIHsNCiAgICAgICAgbWFyZ2luOiAuMjVlbSAhaW1wb3J0YW50Ow0KICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgfQ0KDQouZGlqaXRNZW51SXRlbUljb25DZWxsDQp7DQogICAgcGFkZGluZy1yaWdodDogLjQ1ZW07DQp9DQo="),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/CreateOrEdit/CreateOrEditView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/Editor/EditorView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/TemplatePicker/TemplatePickerView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Editing/BinTool","Mapping/modules/Editing/CoreEditCommands","Mapping/modules/Editing/EditingModule","Mapping/modules/Editing/FeatureUtilities","Mapping/modules/Editing/Utils","Mapping/modules/Editing/CreateOrEdit/CreateOrEditView","Mapping/modules/Editing/Editor/EditorView","Mapping/modules/Editing/Editor/EditorViewModel","Mapping/modules/Editing/TemplatePicker/FeatureTemplateViewModel","Mapping/modules/Editing/TemplatePicker/TemplatePickerView","Mapping/modules/Editing/TemplatePicker/TemplatePickerViewModel","Mapping/modules/Editing/MultiFeatureSelector/MultiFeatureSelectorView","Mapping/modules/Editing/Undoable/Add","Mapping/modules/Editing/Undoable/AddAndUpdate","Mapping/modules/Editing/Undoable/Delete","Mapping/modules/Editing/Undoable/DeleteAndUpdate","Mapping/modules/Editing/Undoable/Update","Mapping/modules/Editing/Editor/Form/EditingFormField","Mapping/modules/Editing/Editor/Form/EditingFormViewModel","Mapping/modules/Editing/Editor/Form/ValidationFunctionFactory"],function(t,i,r,a,n,o,s,l,d,u,p,c,h,g,f,m,y,v,b,E){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.editing.BinTool",t.BinTool),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.editing.CoreEditCommands",i.CoreEditCommands),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditGraphicType",r.EditGraphicType),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingModule",r.EditingModule),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.editing.FeatureUtilities",a.FeatureUtilities),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingUtils",n.EditingUtils),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.editing.CreateOrEditView",o.CreateOrEditView),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorView",s.EditorView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorState",l.EditorState),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorViewModel",l.EditorViewModel),e(d,"geocortex.essentialsHtmlViewer.mapping.modules.editing.FeatureTemplate",d.FeatureTemplate),e(u,"geocortex.essentialsHtmlViewer.mapping.modules.editing.TemplatePickerView",u.TemplatePickerView),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.editing.TemplatePickerViewModel",p.TemplatePickerViewModel),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.editing.MultiFeatureSelectorView",c.MultiFeatureSelectorView),e(h,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Add",h.Add),e(g,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.AddAndUpdate",g.AddAndUpdate),e(f,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Delete",f.Delete),e(m,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.DeleteAndUpdate",m.DeleteAndUpdate),e(y,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Update",y.Update),e(v,"geocortex.essentialsHtmlViewer.mapping.modules.editing.esriFieldTypeEnum",v.esriFieldTypeEnum),e(v,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingFormField",v.EditingFormField),e(b,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingFormViewModel",b.EditingFormViewModel),e(E,"geocortex.essentialsHtmlViewer.mapping.modules.editing.ValidationFunctionFactory",E.ValidationFunctionFactory)})}();