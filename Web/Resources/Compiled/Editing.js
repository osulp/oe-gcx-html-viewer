!function(){var t="<div class='view-feature-create-or-edit content-container'>    <p class='description-text' data-binding='{@text: @language-feature-editing-create-edit-no-features-found}'></p>    <ul class='action-btns'>        <li>            <button class='button button-action-icon create-new-feature' data-binding='{@event-onclick: handleClickCreateNewFeature}'><img src='Resources/Images/Icons/Toolbar/feature-create-24.png' data-binding='{alt: @language-feature-editing-create-edit-new-feature}{title: @language-feature-editing-create-edit-new-feature}'><span data-binding='{@text: @language-feature-editing-create-edit-new-feature}'></span></button>        </li>        <li>            <button class='button button-action-icon existing-feature' data-binding='{@event-onclick: handleClickSelectExistingFeature}'><img src='Resources/Images/Icons/Toolbar/feature-location-24.png' data-binding='{alt: @language-feature-editing-create-edit-select-existing-feature}{title: @language-feature-editing-create-edit-select-existing-feature}'><span data-binding='{@text: @language-feature-editing-create-edit-select-existing-feature}'></span></button>        </li>    </ul></div>",i="<div class='editor'>    \x3c!-- APPLY EDITS --\x3e    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: busyText}'></div>    </div>    \x3c!-- ADD/EDIT FORM --\x3e    <div class='add-or-edit-feature' data-binding='{@hidden: isBusy}'>        <div class='panel-content'>           \x3c!-- has geometry -- >           \x3c!-- <div class='panel-notification' data-binding='{@visible: hasGeometry}'>                        <span data-binding='{@text: @language-feature-editing-has-geometry}'></span>                    </div>--\x3e            <div data-binding='{@source: form}'>                <div data-binding='{@template-for: form}'>                                        \x3c!-- 'This feature has no editable fields.' --\x3e                    <div class='panel-notification' data-binding='{@hidden: fields}'>                        <span data-binding='{@text: @language-feature-editing-invalid-layer}'></span>                    </div>                    <div class='panel-group' data-binding='{@visible: fields}'>                        <h3 data-binding='{@text: @language-feature-editing-feature-attributes}'></h3>                        <div class='panel-group-contents'>                            <div class='form label-stacked'>                                <div class='form-container' data-binding='{@source: fields}{@template-selector: renderType}'>                                    \x3c!-- DATE PICKER --\x3e                                    <div class='form-item' data-binding='{@template-select: esriFieldTypeDate}{@visible: editable}'>                                        <label class='form-label'>                                            <span data-binding='{@text: displayName}'></span>                                        </label>                                        <div class='form-control-date-picker' data-binding='{@widget: DatePickerFormItem}{@widget-context: datePickerViewModel}'>                                        </div>                                    </div>                                    \x3c!-- CODED DOMAIN VALUE TEMPLATE --\x3e                                    <div class='form-item' data-binding='{@template-select: codedDomainValue}{@visible: editable}'>                                        <div class='combobox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <select data-binding='{@source: valueOptions}{@value: value}{@disabled: readOnly}'>                                                    <option data-binding='{@template-for: valueOptions}{@text: name}{value: code}'></option>                                                </select>                                            </div>                                        </div>                                    </div>                                    \x3c!-- SUBCLASS TEMPLATE --\x3e                                    <div class='form-item' data-binding='{@template-select: typeField}{@visible: editable}'>                                        <div class='combobox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <select data-binding='{@source: valueOptions}{@value: value}{@event-onchange: handleTypeFieldChange}{@disabled: readOnly}'>                                                    <option data-binding='{@template-for: valueOptions}{@text: name}{value: code}'></option>                                                </select>                                            </div>                                        </div>                                    </div>                                    \x3c!-- LARGE TEXT FIELDS --\x3e                                    <div class='form-item' data-binding='{@template-select: textArea}{@visible: editable}'>                                        <div class='textbox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <textarea type='text' data-binding='{@value: presentableValue}{@disabled: readOnly}{@event-onblur: handleInputBlur}{@event-onfocus: handleInputFocus}'></textarea>                                            </div>                                        </div>                                    </div>                                    \x3c!-- FIELDS --\x3e                                    <div class='form-item' data-binding='{@template-for: fields}{@visible: editable}'>                                        <div class='textbox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <input type='text' data-binding='{@value: presentableValue}{@disabled: readOnly}{@event-onblur: handleInputBlur}{@event-onfocus: handleInputFocus}' />                                            </div>                                        </div>                                    </div>                                </div>                                \x3c!-- VALIDATION --\x3e                                <ul class='form-validation' data-binding='{@source: validationMessages}{@visible: validationMessages}'>                                    <li data-binding='{@template-for: validationMessages}'>                                        <span data-binding='{@text: @context}'></span>                                    </li>                                </ul>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div>    \x3c!-- ATTACHMENTS --\x3e    <div data-binding='{@hidden: isBusy}'>        <div class='attach-photo panel-group panel-content' data-binding='{@visible: hasEditableAttachments}'>            <h3 data-binding='{@text: @language-feature-editing-manage-attachments}'></h3>                <div class='no-item' data-binding='{@hidden: isAttachmentInfosInitialized}{@text: @language-feature-attachments-checking}'></div>            <div class='no-item' data-binding='{@visible: noAttachments}{@text: @language-feature-attachments-no-attachments}'></div>            <div class='no-item' data-binding='{@visible: isOffline}{@text: @language-feature-attachments-no-attachments-offline}'></div>            <div class='panel-group' data-binding='{@visible: attachmentInfos}'>                <ul class='list-menu active has-icon' data-binding='{@source: attachmentInfos}'>                    <li class='attachment list-menu-item has-delete-button' data-binding='{@template-for: attachmentInfos}'>                        <a class='list-menu-details' data-binding='{href: url}{@event-onclick: attachment_click}{target: target}{@enabled: enabled}'>                            <img class='list-menu-icon' src='Resources/Images/Icons/Toolbar/attach-24.png' data-binding='{alt: @language-feature-attachments}' />                            <strong class='list-menu-name' data-binding='{@text: name}'></strong>                            <span class='list-menu-desc' data-binding='{@text: size}'></span>                        </a>                        <button class='list-item-button icon icon-delete-16' data-binding='{@event-click: handleDeleteClick}{title: @language-feature-attachments-delete}{@text: @language-feature-attachments-delete}'></button>                    </li>                </ul>            </div>                <div class='panel-content panel-group-contents' data-binding='{@hidden: browserFileAPISupported}'>                <p><button class='button' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoCamera}{@text: @language-native-photo-from-camera}'></button></p>                <p><button class='button' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoGallery}{@text: @language-native-photo-from-gallery}'></button></p>            </div>                    <div class='panel-content panel-group-contents file-upload' data-binding='{@visible: browserFileAPISupported}'>                <label class='file-button' role='button' tabindex='0' data-binding='{@event-onkeypress: handleFileKeypress}'>                    <img class='list-menu-icon' src='Resources/Images/Icons/add-16.png' alt=' '>                    <input type='file' multiple class='hidden-file-input' tabindex='-1' data-binding='{@var: fileInputElement}{aria-label: @language-native-file-select-heading}{@event-onchange: handleFileSelect}' />                    <span data-binding='{@text: @language-feature-editing-add-attachments}'></span>                </label>                <p class='loading'><span data-binding='{@visible: isUploadingAttachment}{@text: @language-native-file-uploading}'></span></p>            </div>        </div>    </div>    \x3c!-- BUTTONS --\x3e    <div class='panel-group-contents form-btns' data-binding='{@hidden: isBusy}'>        <button class='button' data-binding='{@event-onclick: handleClickEditGeometry}{@visible: showEditGeometryButton}{@text: @language-feature-editing-edit-geometry-caption}'></button>        <button class='button' data-binding='{@event-onclick: handleClickEditGeometry}{@visible: showStopEditingGeometryButton}{@text: @language-feature-editing-stop-editing-geometry-caption}'></button>        <button class='button' data-binding='{@event-onclick: handleClickDeleteFeature}{@visible: canDeleteFeature}{@text: @language-common-delete}'></button>        <button class='button' data-binding='{@event-onclick: handleClickSave}{@text: @language-common-save}'></button>        <button class='button' data-binding='{@event-onclick: handleClickCancel}{@text: @language-common-cancel}'></button>    </div></div>",r="<div class='feature-template has-icon' data-binding='{@event-onclick: handleFeatureTemplateClick}'>    <button class='list-menu-details'>        <img class='list-menu-icon' data-binding='{@visible: symbolUri}{src: symbolUri}' alt=' ' />        <span class='list-menu-icon' data-binding='{@hidden: symbolUri}{innerHTML: swatchElement}'></span>        <strong class='list-menu-name' data-binding='{@text: name}'></strong>        <span class='list-menu-desc' data-binding='{@text: description}{@visible: description}'></span>    </button></div>",a="<div class='feature-template-picker'>    \x3c!-- TEMPLATES --\x3e    <div class='panel-group no-item' data-binding='{@hidden: layerTemplates}{@text: @language-feature-editing-no-templates}'></div>    <div class='panel-group' data-binding='{@source: layerTemplates}'>        <div data-binding='{@template-for: layerTemplates}'>            <h3 data-binding='{@text: displayName}'></h3>            <div data-binding='{@hidden: notAvailableReason}'>                <div class='no-results' data-binding='{@hidden: templates}'>                    <span data-binding='{@text: @language-feature-editing-no-templates}'></span>                    <div class='form-button-container'>                        <div class='form-button-align'>                            <div class='form-item form-btns'>                                <button class='button' data-binding='{@text: @language-feature-editing-add-feature-button}{@event-onclick: handleFeatureTemplateClick}'></button>                            </div>                        </div>                    </div>                </div>                <ul class='list-menu' data-binding='{@visible: templates}{@source: templates}{@template-selector: foo}'>                    <li class='list-menu-item' data-binding='{@template-select: @null}{@template: Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html}'></li>                </ul>            </div>            <div data-binding='{@visible: notAvailableReason}'>                <div class='no-results'>                    <span data-binding='{@text: notAvailableReason}'></span>                </div>            </div>        </div>    </div></div>";function v(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var r=t.split("."),a=null,n=window,s=0,o=r.length;s<o;s++)a=r[s],s==o-1?n[a]=i:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Editing/BinTool":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.decodeArrayBuffer=function(e){var t=Math.ceil(3*e.length/4),i=new ArrayBuffer(t);return this.decode(e,i),i},r.decode=function(e,t){var i,r,a,n,s,o,l,u=this._keyStr.indexOf(e.charAt(e.length-1)),d=this._keyStr.indexOf(e.charAt(e.length-1)),c=Math.ceil(3*e.length/4);64==u&&c--,64==d&&c--;var p=0,h=0;for(i=t?new Uint8Array(t):new Uint8Array(c),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<c;p+=3)r=this._keyStr.indexOf(e.charAt(h++))<<2|(s=this._keyStr.indexOf(e.charAt(h++)))>>4,a=(15&s)<<4|(o=this._keyStr.indexOf(e.charAt(h++)))>>2,n=(3&o)<<6|(l=this._keyStr.indexOf(e.charAt(h++))),i[p]=r,64!=o&&(i[p+1]=a),64!=l&&(i[p+2]=n);return i},r._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r);function r(){}t.BinTool=i})},"Mapping/modules/Editing/CoreEditCommands":function(){define(["require","exports","geocortex/essentials/MapService","geocortex/essentials/RestHelperHTTPService","geocortex/framework/utils/utils","./BinTool"],function(e,t,a,x,S,G){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.registerCommands=function(){this.app.commandRegistry.command("CreateFeature").register(this,this._executeCreateFeature),this.app.commandRegistry.command("UpdateFeature").register(this,this._executeUpdateFeature),this.app.commandRegistry.command("DeleteFeature").register(this,this._executeDeleteFeature),this.app.commandRegistry.command("ApplyEdits").register(this,this._executeApplyEdits,this._canExecuteApplyEdits),this.app.commandRegistry.command("CreateRelatedRecord").register(this,this._executeCreateRelatedRecord),this.app.commandRegistry.command("UpdateRelatedRecord").register(this,this._executeUpdateRelatedRecord),this.app.commandRegistry.command("DeleteRelatedRecord").register(this,this._executeDeleteRelatedRecord),this.app.commandRegistry.command("CreateAttachment").register(this,this._executeCreateAttachment),this.app.commandRegistry.command("DeleteAttachments").register(this,this._executeDeleteAttachments)},r.prototype._executeApplyEdits=function(e){var t=this._getMapService(e.mapService);t?this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:e.addedFeatures?e.addedFeatures:[],updates:e.updatedFeatures?e.updatedFeatures:[],deletions:e.deletedFeatures?e.deletedFeatures:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},r.prototype._canExecuteApplyEdits=function(e){return!(!e||!e.layer&&!e.mapService||!(e.addedFeatures&&0===e.addedFeatures.length||e.updatedFeatures&&0===e.updatedFeatures.length||e.deletedFeatures&&0===e.deletedFeatures.length))},r.prototype._executeCreateFeature=function(e){var t=this._getMapService(e.mapService);t?e.feature&&this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[e.feature],updates:[],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},r.prototype._executeUpdateFeature=function(e){var t=this._getMapService(e.mapService);t?this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[],updates:[e.feature],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},r.prototype._getMapService=function(e){return"string"==typeof e?this.app.site.essentialsMap.findMapServiceById(e):e},r.prototype._executeDeleteFeature=function(e){var t=this._getMapService(e.mapService);t?e.feature&&this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[],updates:[],deletions:[e.feature],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},r.prototype._executeCreateRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[e.feature],updates:[],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback})},r.prototype._executeUpdateRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[],updates:[e.feature],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback})},r.prototype._executeDeleteRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[],updates:[],deletions:[e.feature],successCallback:e.successCallback,errorCallback:e.errorCallback})},r.prototype._applyFeatureLayerEdits=function(e){if(e){var t=e.mapService,u=e.layer;if(t)u=t.serviceLayer;else{if(!u)return void this.app.trace.warning("Cannot apply edits: Missing map service and/or layer in edit descriptor.");(t=new a.MapService(u.url)).serviceLayer=u}var d=e.additions||[],i=e.updates||[],r=e.deletions||[],c=e.successCallback||function(){},p=e.errorCallback||function(){};u.applyEdits(d,i,r).then(function(e,t,i){var r=null;if(t&&0<t.length)for(var a=0,n=t;a<n.length;a++){var s=n[a];if(!s.success){r=s.error;break}}if(e&&0<e.length)for(var o=0;o<e.length;++o){var l=e[o];if(!l.success){r=l.error;break}l.GID&&u.globalIdField&&(d[o].attributes[u.globalIdField]=l.GID)}r?p((r||{message:"Editing operation was not successful"}).message):c&&c()},function(e){p(e)})}},r.prototype._executeCreateAttachment=function(e){var t=this._getFeatureUrl(e.layer,e.feature);e.featureUrl=t,this._syncAttachmentToServer(e.featureUrl,e.filename,e.contentType,e.payload,e.callback)},r.prototype._executeDeleteAttachments=function(e){var t=e.feature.attributes[e.layer.objectIdField];e.layer.deleteAttachments(t,e.attachmentIds,e.callback,e.errback)},r.prototype._getFeatureUrl=function(e,t){var i=t.attributes[e.objectIdField],r=e.url;return-1<r.indexOf("?")?r.replace("?","/{0}?".format(i)):"{0}/{1}".format(r,i)},r.prototype._syncAttachmentToServer=function(t,e,i,r,a){this.app.trace.debug("--- _syncAttachmentToServer called");try{for(var n=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),r=0,a=e.length;r<a;r++)i[r]=e.charCodeAt(r)%255;return i},s=t.lastIndexOf("/"),o=t.substring(0,s),l=this.app.map.graphicsLayerIds,u=null,d=0,c=l;d<c.length;d++){var p=c[d],h=this.app.map.getLayer(p);if(h.url){var g=h.url.match(/^(.[^?]*)/);if(g&&g[0]===o){u=h;break}}}u=u||new esri.layers.FeatureLayer(t.replace(/\/\d$/g,"")),-1<t.indexOf("?")?t=t.replace("?","/addattachment?"):t+="/addAttachment",this.app.isOffline.get()&&this.app.command("RewriteUrlForOffline").execute(t,function(e){t=e});var m=null;if(u.credential&&u.credential.token)m=u.credential.token;else{var f=u.url.match(/token=([^\?&$]*)/);f&&(m=f[1])}if(m&&-1===t.indexOf(m)&&(t=x.RestHelperHTTPService.appendTokenToUrl(t,m)),this.app.configuration.proxyUri){var y=S.makeUrlAbsolute(this.app.configuration.proxyUri);t=y+t}this.app.trace.debug("--- Creating XHR");var v=new XMLHttpRequest;v.open("POST",t,!0),v.setRequestHeader("Content-Type","multipart/form-data; boundary=---------------------------L4717uD3G30"),v.responseType="",v.onload=a,this.app.trace.debug("--- Creating request preamble");var b="-----------------------------L4717uD3G30\r\n"+'Content-Disposition: form-data; name="attachment"; filename="{0}";\r\n'.format(e)+"Content-Type: {0}".format(i)+"\r\n\r\n";this.app.trace.debug("--- Encoding request preamble");var E=n(b);this.app.trace.debug("--- Encoding request payload");var _=G.BinTool.decode(r);this.app.trace.debug("--- Creating request suffix"),this.app.trace.debug("--- Encoding request suffix");var F=n('\r\n-----------------------------L4717uD3G30\r\nContent-Disposition: form-data; name="gdbVersion"\r\n\r\n\r\n-----------------------------L4717uD3G30\r\nContent-Disposition: form-data; name="f"\r\n\r\njson\r\n-----------------------------L4717uD3G30--\r\n');this.app.trace.debug("--- Creating payload buffer");var w=new ArrayBuffer(E.length+_.length+F.length),C=new Uint8Array(w),I=0;this.app.trace.debug("--- Merging output buffers");for(var T=0;T<E.length;T++,I++)C[I]=255&E[T];for(T=0;T<_.length;T++,I++)C[I]=255&_[T];for(T=0;T<F.length;T++,I++)C[I]=255&F[T];this.app.trace.debug("--- Sending request"),v.send(C.buffer)}catch(e){this.app.trace.error("--- ERROR: {0}".format(e.toString())),a&&a(e)}},r);function r(e,t){this.app=e,this.libraryId=t}t.CoreEditCommands=i})},"Mapping/modules/Editing/EditingModule":function(){var r,w=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/application/ModuleBase","./CoreEditCommands","./CutUnion/CutInteractive","./CutUnion/UnionInteractive","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/BrowserUtils","./Undoable/Add","./Undoable/Update","./Undoable/Delete","./Undoable/AddAndUpdate","./Undoable/DeleteAndUpdate","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/framework/utils/ArrayUtils"],function(e,t,i,r,a,n,s,o,u,l,d,c,p,h,g,m,f,y){"use strict";var v,b;Object.defineProperty(t,"__esModule",{value:!0}),(b=v=t.EditGraphicType||(t.EditGraphicType={}))[b.Create=0]="Create",b[b.Update=1]="Update",b[b.Delete=2]="Delete",b[b.Cut=3]="Cut",b[b.Explode=4]="Explode",b[b.Union=5]="Union";var E,_=(E=i.ModuleBase,w(F,E),F.prototype.initialize=function(e){E.prototype.initialize.call(this,e),this._registerCommands(),this._registerEvents(),new a.CutInteractive(this.app,this.libraryId,e.cutLimit),new n.UnionInteractive(this.app,this.libraryId,e.unionLimit,e.unionCheckCardinality),l.isSafari()&&this._setupSafariCacheHandler()},F.prototype._registerCommands=function(){this.app.command("SetEditorFeatureGeometry").register(this,this._executeSetEditorFeatureGeometry,this._canExecuteSetEditorFeatureGeometry),this.app.command("StartEditingGraphicGeometry").register(this,this._executeStartEditingGeometry,this._canExecuteStartEditingGeometry),this.app.command("StopEditingGraphicGeometry").register(this,this._executeStopEditingGeometry,this._canExecuteStopEditingGeometry),new r.CoreEditCommands(this.app,this.libraryId).registerCommands(),this.app.command("StopFeaturePlacementState").register(this,this._executeStopFeaturePlacementState,this._canExecuteStopFeaturePlacementState),this.app.command("CreateGraphicsInMemory").register(this,this._executeCreateGraphicsInMemory),this.app.command("UpdateGraphicsInMemory").register(this,this._executeUpdateGraphicsInMemory),this.app.command("DeleteGraphicsInMemory").register(this,this._executeDeleteGraphicsInMemory),this.app.command("CutGraphicsInMemory").register(this,this._executeCutGraphicsInMemory),this.app.command("ExplodeGraphicsInMemory").register(this,this._executeExplodeGraphicsInMemory),this.app.command("UnionGraphicsInMemory").register(this,this._executeUnionGraphicsInMemory)},F.prototype._registerEvents=function(){var t=this,i=null;this.app.event("StartFeaturePlacementEvent").subscribe(this,function(){i=t.app.event("ViewDeactivatedEvent").subscribe(t,function(e){"TemplatePickerView"===e.id&&t.app.event("StopFeaturePlacementEvent").publish()})}),this.app.event("StopFeaturePlacementEvent").subscribe(this,function(){t.app.event("ViewDeactivatedEvent").unsubscribe(i),t.app.command("ClearActiveTool").execute();var e=t.app.viewManager.getViewById("TemplatePickerView");e&&e.isActive&&t.app.command("DeactivateView").execute("TemplatePickerView")}),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChangedEvent)},F.prototype._setupSafariCacheHandler=function(){var r=this;esri.request.setRequestPreCallback(function(t){if(t&&t.url&&(!r.app.offlineManager.isOfflineMapActive||!r.app.offlineManager.isOfflineMapActive.get())){var e=y.firstOrDefault(r.app.site.getFeatureServices(),function(e){return e.serviceUrl&&t.url.startsWith(e.serviceUrl)}),i=e?e.serviceLayer:null;i&&i.geometryType&&i.allowGeometryUpdates&&(t.content.lastEdit=r._lastEdited[i.id])}return t}),this.app.waitUntilSiteServiceLayersLoaded().then(function(){r.app.site.getFeatureServices().forEach(function(e){var t=e.serviceLayer;t&&t.geometryType&&t.allowGeometryUpdates&&t.on("edits-complete",function(e){r._lastEdited[e.target.id]=Date.now()})})})},F.prototype._executeStopFeaturePlacementState=function(){this.app.event("StopFeaturePlacementEvent").publish()},F.prototype._canExecuteStopFeaturePlacementState=function(){return!0},F.prototype._canExecuteSetEditorFeatureGeometry=function(e){return!0},F.prototype._executeSetEditorFeatureGeometry=function(e){this._executeStopEditingGeometry();var t=this._feature;t&&("extent"===e.type&&(e=s.envelopeToPolygon(e)),this._geometry=e,this._hasGeometry=!!e,this._graphic.setGeometry(e),this.app.event("GeometryEditCompletedEvent").publish({originalGraphic:this._feature,editedGraphic:this._graphic,cancelled:!1}),this._destroyEditingLayer(),this.app.event("FeatureGeometryEditedEvent").publish(t))},F.prototype._canExecuteStartAddingFeatureGeometry=function(e){return!0},F.prototype._executeStartAddingFeatureGeometry=function(e){},F.prototype._canExecuteStartEditingGeometry=function(e,t){return!0},F.prototype._executeStartEditingGeometry=function(e,t){var r=this;this._isEditingGeometry=!0,this._editObject&&this._editObject.deactivate(),(this._feature=e).symbol||t.renderer||e.setSymbol(this._getMoveSymbol(e,t)),this._graphic=new esri.Graphic(e.geometry,e.symbol,e.attributes,e.infoTemplate),this._hasGeometry=!!this._graphic.geometry;var i=t||this._feature.getLayer();if(this._featureLayer=i,this._createEditingLayer(),this._hideOriginalFeature(),this._graphic.symbol=this._getMoveSymbol(e,i),this._editingLayer.add(this._graphic),this._layerUpdateEndToken&&dojo.disconnect(this._layerUpdateEndToken),this._layerUpdateEndToken=dojo.connect(this._graphic._graphicsLayer,"onUpdateEnd",dojo.hitch(this,this._handleLayerUpdateEnd)),this._hasGeometry){var a=null;if(null===e)throw new Error("Can't edit geometry of null feature");if(!esri.toolbars.Edit){var n=this.app.getResource(this.libraryId,"language-feature-editing-package-required"),s=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return void this.app.command("Alert").execute(n,s)}a=this._getConfiguredEditMode();var o={allowAddVertices:!0,allowDeleteVertices:!0};this._editObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.edit",this.app.map,o);var l=dojo.aspect.after(this._editObject,"onGraphicFirstMove",function(e){r.app.map.disableMapNavigation()},!0),u=dojo.aspect.after(this._editObject,"onGraphicMoveStop",function(e){r.app.map.enableMapNavigation()},!0);this._editorDeactivatedHandle&&(this._editorDeactivatedHandle.remove(),this._editorDeactivatedHandle=null),this._editorDeactivatedHandle=dojo.aspect.after(this._editObject,"onDeactivate",function(e,t,i){l&&(l.remove(),l=null),u&&(u.remove(),u=null),null!=r._editingGeometryMapClickHandle&&(dojo.disconnect(r._editingGeometryMapClickHandle),r._editingGeometryMapClickHandle=null),r._layerUpdateEndToken&&(dojo.disconnect(r._layerUpdateEndToken),r._layerUpdateEndToken=null),r._editorDeactivatedHandle&&(r._editorDeactivatedHandle.remove(),r._editorDeactivatedHandle=null),r._editObject&&(r._editObject=null),r._destroyEditingLayer(),r._indicateGeometryEditing(!1),r.app.event("GeometryEditCompletedEvent").publish({originalGraphic:r._feature,editedGraphic:r._graphic,cancelled:i.cancelled})},!0),this._editingGeometryMapClickHandle=dojo.connect(this.app.map,"onClick",function(){r._executeStopEditingGeometry(!1)}),this._indicateGeometryEditing(!0),this._editObject.activate(a,this._graphic,o),this.app.event("GeometryEditInvokedEvent").publish(this._feature)}else this._currentToolName=this._getToolNameByDrawType(e._drawType),this._currentToolName||(this._currentToolName=this._getToolNameByGeometryType(i.geometryType)),this.app.command("SetActiveTool").execute(this._currentToolName),this._indicateGeometryEditing(!0)},F.prototype._createEditingLayer=function(){this._editingLayer=f.getInternalGraphicsLayer(m.EDITING_LAYER_ID,this.app,f.GraphicsLayerType.Markup)},F.prototype._destroyEditingLayer=function(){f.removeInternalGraphicsLayer(m.EDITING_LAYER_ID,this.app,f.GraphicsLayerType.Markup),this._editingLayer=null},F.prototype._handleLayerVisualizationChangedEvent=function(e){var t=this;if(this._feature&&this._graphic&&this._featureLayer&&this._editingLayer&&e&&e.mapService&&e.mapService.serviceLayer&&e.mapService.serviceLayer.id===this._featureLayer.id){if(this._featureLayer.renderer)this._graphic.setSymbol(this._featureLayer.renderer.getSymbol(this._feature));else{var i=this.app.map.graphicsLayerIds.filter(function(e){return e===t._featureLayer.id+"-cluster"});if(0<i.length){var r=this.app.map.getLayer(i[0]);r&&r.featureLayerRenderer&&this._graphic.setSymbol(r.featureLayerRenderer.getSymbol(this._feature))}}this._editingLayer.redraw(),this._editObject.refresh()}},F.prototype._handleLayerUpdateEnd=function(){this._hideOriginalFeature()},F.prototype._hideOriginalFeature=function(){if(this._feature){var e=o.findFeatureInMap(this._feature,this.app.site);e&&e.hide()}},F.prototype._getMoveSymbol=function(e,t){var i=null;if(t.renderer)i=e.symbol?e.symbol:t.renderer.getSymbol(e);else{var r=this.app.map.graphicsLayerIds.filter(function(e){return e===t.id+"-cluster"});if(0<r.length){var a=this.app.map.getLayer(r[0]);i=a.featureLayerRenderer.getSymbol(e)}}function n(e){return s||(i=new e(i.toJson()),s=!0),i}var s=!1;if(i instanceof esri.symbol.SimpleMarkerSymbol){var o=i;o.size<10&&n(esri.symbol.SimpleMarkerSymbol).setSize(10),o.color.a<.5&&(!o.outline||o.outline.color.a<.5)&&(n(esri.symbol.SimpleMarkerSymbol).color.a=.5)}return i},F.prototype._canExecuteStopEditingGeometry=function(){return!0},F.prototype._executeStopEditingGeometry=function(e){void 0===e&&(e=!1),this._isEditingGeometry&&(this.app.command("ClearActiveTool").execute(),this._editObject&&(this._editObject._cancelled=e,this._editObject.deactivate(),this._editObject=null),null!=this._editingGeometryMapClickHandle&&(dojo.disconnect(this._editingGeometryMapClickHandle),this._editingGeometryMapClickHandle=null),this._layerUpdateEndToken&&(dojo.disconnect(this._layerUpdateEndToken),this._layerUpdateEndToken=null),this._editorDeactivatedHandle&&(this._editorDeactivatedHandle.remove(),this._editorDeactivatedHandle=null),this._indicateGeometryEditing(!1))},F.prototype._indicateGeometryEditing=function(e){var t=this;if(this._feature&&this._feature.geometry){var i="geometryEditingStatus";if(e){var r=this._feature.geometry.type,a=u.getEsriGeometryType(r,esri.toolbars.Draw.POINT),n={id:i,text:this.getEditingGeometryStatusMessage(this.app,this.libraryId,a),closeButton:{callback:function(){t._executeStopEditingGeometry(!0)}}};this.app.command("DisplayNotification").execute(n),this.app.command("ShowMap").execute()}else this.app.command("RemoveNotification").execute(i)}},F.prototype.getEditingGeometryStatusMessage=function(e,t,i){var r=Modernizr&&!!Modernizr.touch;switch(i){case esri.toolbars.Draw.POINT:return e.getResource(t,"language-feature-editing-geometry-point");case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYLINE:return r?e.getResource(t,"language-feature-editing-geometry-polyline-touch"):e.getResource(t,"language-feature-editing-geometry-polyline");case esri.toolbars.Draw.CIRCLE:case esri.toolbars.Draw.ELLIPSE:case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.FREEHAND_POLYGON:return r?e.getResource(t,"language-feature-editing-geometry-polygon-touch"):e.getResource(t,"language-feature-editing-geometry-polygon");case esri.toolbars.Draw.EXTENT:return e.getResource(t,"language-feature-editing-geometry-rectangle")}return e.getResource(t,"language-feature-editing-geometry-default")},F.prototype._getToolNameByDrawType=function(e){return e?"Editing{0}Tool".format(e.replace("Map","")):""},F.prototype._getToolNameByGeometryType=function(e){var t=e.slice("esriGeometry".length);return"Editing{0}Tool".format(t)},F.prototype._getConfiguredEditMode=function(){var t=this,e=0,i=this.app.site.essentialsMap.mapServices.filter(function(e){return e.id===t._featureLayer.id});if(0===i.length)e=esri.toolbars.Edit.MOVE|esri.toolbars.Edit.EDIT_VERTICES|esri.toolbars.Edit.SCALE|esri.toolbars.Edit.ROTATE;else{var r=i[0];r.rotateEnabled&&(e|=esri.toolbars.Edit.ROTATE),r.scaleEnabled&&(e|=esri.toolbars.Edit.SCALE),r.moveEnabled&&(e|=esri.toolbars.Edit.MOVE),r.editVerticesEnabled&&(e|=esri.toolbars.Edit.EDIT_VERTICES)}return e},F.prototype._executeCreateGraphicsInMemory=function(i){var r=this;this._validateEditInMemoryArgs(i,v.Create)&&(i.graphics.map(function(e){i.graphicsLayer.add(e),r.app.event("MarkupAddedEvent").publish(e)}),i.successCallback(i.graphics,[],[]).then(function(){var e=r.app.getResource(r.libraryId,"language-feature-editing-undoable-add");if(!i.skipUndoManager){var t={app:r.app,addedGraphics:i.graphics,graphicsLayer:i.graphicsLayer};r.app.undoManager.add(new d.Add(e,t))}}))},F.prototype._executeUpdateGraphicsInMemory=function(i){var r=this;if(this._validateEditInMemoryArgs(i,v.Update))if(i.geometries&&i.geometries.length===i.graphics.length){for(var a=[],e=0;e<i.graphics.length;e++)a[e]=new esri.Graphic(i.graphics[e].toJson()),i.graphics[e].setGeometry(i.geometries[e]),this.app.event("MarkupUpdatedEvent").publish(i.graphics[e]);i.successCallback([],i.graphics,[]).then(function(){var e=r.app.getResource(r.libraryId,"language-feature-editing-undoable-update"),t={app:r.app,preUpdatedGraphics:a,updatedGraphics:i.graphics,graphicsLayer:i.graphicsLayer};r.app.undoManager.add(new c.Update(e,t))})}else i.errorCallback(new Error("Could not update graphics: the graphic count does not match the updated geometry count."))},F.prototype._executeDeleteGraphicsInMemory=function(i){var r=this;if(this._validateEditInMemoryArgs(i,v.Delete)){for(var a=[],e=0,t=i.graphics;e<t.length;e++){var n=t[e];i.graphicsLayer.remove(n)&&(a.push(n),this.app.event("MarkupDeletedEvent").publish(n))}0===a.length&&i.errorCallback(new Error("Could not delete graphics: the provided graphics are not on the graphics layer.")),i.successCallback([],[],a).then(function(){var e=r.app.getResource(r.libraryId,"language-feature-editing-undoable-delete");if(!i.skipUndoManager){var t={app:r.app,deletedGraphics:a,graphicsLayer:i.graphicsLayer};r.app.undoManager.add(new p.Delete(e,t))}})}},F.prototype._executeCutGraphicsInMemory=function(s){var o=this;if(this._validateEditInMemoryArgs(s,v.Cut))if(s.polyline){var e=s.graphics.map(function(e){return e.geometry});u.cutGeometries(e,s.polyline,this.app).then(function(e){for(var t=0,i=e;t<i.length;t++)if(i[t].length<2)return void s.errorCallback(new Error("Could not cut graphics: the provided polyline does not cut a graphic."));var r=s.graphics.map(function(e){return new esri.Graphic(e.toJson())}),a=s.graphics,n=o._splitGraphics(a,e);a.map(function(e){return o.app.event("MarkupUpdatedEvent").publish(e)}),n.map(function(e){s.graphicsLayer.add(e),o.app.event("MarkupAddedEvent").publish(e)}),s.successCallback(n,a,[]).then(function(){var e=o.app.getResource(o.libraryId,"language-feature-editing-undoable-cut"),t={app:o.app,addedGraphics:n,preUpdatedGraphics:r,updatedGraphics:a,graphicsLayer:s.graphicsLayer};o.app.undoManager.add(new h.AddAndUpdate(e,t))})},function(e){s.errorCallback(e)})}else s.errorCallback(new Error("Could not cut graphics: required polyline was not supplied."))},F.prototype._executeExplodeGraphicsInMemory=function(i){var r=this;if(this._validateEditInMemoryArgs(i,v.Explode)){for(var a=i.graphics,e=[],t=0;t<a.length;t++)if(e[t]=u.explodeGeometry(a[t].geometry),!e[t])return void i.errorCallback(new Error("Could not explode graphics: invalid geometry."));var n=a.map(function(e){return new esri.Graphic(e.toJson())}),s=this._splitGraphics(a,e);a.map(function(e){return r.app.event("MarkupUpdatedEvent").publish(e)}),s.map(function(e){i.graphicsLayer.add(e),r.app.event("MarkupAddedEvent").publish(e)}),i.successCallback(s,a,[]).then(function(){var e=r.app.getResource(r.libraryId,"language-feature-editing-undoable-explode");if(!i.skipUndoManager){var t={app:r.app,addedGraphics:s,preUpdatedGraphics:n,updatedGraphics:a,graphicsLayer:i.graphicsLayer};r.app.undoManager.add(new h.AddAndUpdate(e,t))}})}},F.prototype._executeUnionGraphicsInMemory=function(s){var o=this;if(this._validateEditInMemoryArgs(s,v.Union)){var l=s.graphics[0],e=s.graphics.map(function(e){return e.geometry});u.unionGeometries(e,this.app).then(function(e){var i=new esri.Graphic(l.toJson());l.setGeometry(e),o.app.event("MarkupUpdatedEvent").publish(l);for(var r=s.graphics.slice(1),t=0,a=r;t<a.length;t++){var n=a[t];s.graphicsLayer.remove(n),o.app.event("MarkupDeletedEvent").publish(n)}s.successCallback([],[l],r).then(function(){var e=o.app.getResource(o.libraryId,"language-feature-editing-undoable-union");if(!s.skipUndoManager){var t={app:o.app,deletedGraphics:r,preUpdatedGraphics:[i],updatedGraphics:[l],graphicsLayer:s.graphicsLayer};o.app.undoManager.add(new g.DeleteAndUpdate(e,t))}})},function(e){s.errorCallback(e)})}},F.prototype._validateEditInMemoryArgs=function(e,t){if(e.successCallback=e.successCallback||function(){return Promise.resolve()},e.errorCallback=e.errorCallback||function(){},!(e.graphicsLayer&&e.graphicsLayer instanceof esri.layers.GraphicsLayer))return e.errorCallback(new Error("Could not edit graphics: required graphics layer was not supplied.")),!1;if(!e.graphics||0===e.graphics.length)return e.errorCallback(new Error("Could not edit graphics: required graphics were not supplied.")),!1;if(t===v.Cut||t===v.Explode||t===v.Union)for(var i=0,r=e.graphics;i<r.length;i++){var a=r[i];if(a.getLayer().id!==e.graphicsLayer.id)return e.errorCallback(new Error("Could not edit graphics: graphic is not on the supplied graphics layer.")),!1;if(t===v.Union){if(a.geometry.type!==e.graphics[0].geometry.type)return e.errorCallback(new Error("Could not edit graphics: graphics are not of the same type.")),!1;if(!a.geometry.spatialReference.equals(e.graphics[0].geometry.spatialReference))return e.errorCallback(new Error("Could not edit graphics: graphics are not of the same spatial reference.")),!1}}return!0},F.prototype._splitGraphics=function(e,t){for(var i=[],r=0;r<t.length;r++){var a=e[r];a.setGeometry(t[r][0]);for(var n=1;n<t[r].length;n++)i.push(new esri.Graphic(t[r][n],a.symbol,a.attributes,a.infoTemplate))}return i},F);function F(){var e=null!==E&&E.apply(this,arguments)||this;return e._hasGeometry=!1,e._editorDeactivatedHandle=null,e._isEditingGeometry=!1,e._lastEdited={},e}t.EditingModule=_})},"Mapping/modules/Editing/FeatureUtilities":function(){define(["require","exports","geocortex/geocortex"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.getRelatedFeatures=function(e,t,i){var s=new dojo.Deferred;if(!e){var r=new Error("getRelatedFeatures: mapService cannot be null.");return o.deferredReject(s,r),s}if(isNaN(t))return r=new Error("getRelatedFeatures: relationshipId cannot be null."),o.deferredReject(s,r),s;if(!i)return r=new Error("getRelatedFeatures: objectId cannot be null."),o.deferredReject(s,r),s;var a=new esri.tasks.RelationshipQuery;return a.outFields=["*"],a.relationshipId=t,a.objectIds=[i],e&&e.serviceLayer&&e.serviceLayer.queryRelatedFeatures?e.serviceLayer.queryRelatedFeatures(a).then(function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i))for(var r=0,a=e[i].features;r<a.length;r++){var n=a[r];t.push(n)}o.deferredResolve(s,t)},function(e){o.deferredReject(s,e)}):o.deferredResolve(s,[]),s},r.getFeatureLayer=function(e){return e?e.esriFeature.get().getLayer()||e.featureLayer:null},r);function r(){}t.FeatureUtilities=i})},"Mapping/modules/Editing/RelatedLayerEntry":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Utils":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.findFeatureInLayer=function(e,t){if(!e||!t)return null;var i=t.objectIdField;e.attributes[i]&&e.attributes[i];var r=t.graphics;if(r.length<1)return null;var a=["timestamp"];if(t.editFieldsInfo)for(var n in t.editFieldsInfo)t.editFieldsInfo.hasOwnProperty(n)&&a.push(t.editFieldsInfo[n]);function s(e){return Array.contains(a,e)}function o(e){var t=0;for(var i in e)!s(i)&&e.hasOwnProperty(i)&&++t;return t}var l=r[0].attributes;if(o(l)!==o(e.attributes))return null;var u=0,d=[],c=[];for(var p in l){var h=s(p);if(!(h||l.hasOwnProperty(p)&&e.attributes.hasOwnProperty(p)))return null;h||(d.push(p),c.push(p),++u)}for(var g=0;g<u;++g)if(d[g]!==c[g])return null;for(var m=0;m<r.length;m++)r[m];return null},r);function r(){}t.EditingUtils=i})},"Mapping/modules/Editing/CreateOrEdit/CreateOrEditView":function(){var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=(r=i.ViewBase,s(n,r),n.prototype.handleClickCreateNewFeature=function(e,t,i){this.viewModel.initiateCreateNewFeature()},n.prototype.handleClickSelectExistingFeature=function(e,t,i){this.viewModel.selectGeometry()},n);function n(e,t){var i=r.call(this,e,t)||this;return i.app.command("HideCreateEditView").register(i,function(){i.isActive&&i.app.viewManager.deactivateView(i)}),i}t.CreateOrEditView=a})},"Mapping/modules/Editing/CreateOrEdit/CreateOrEditViewModel":function(){var r,d=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/FeatureSetCollection","geocortex/framework/observables","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/identify/MapIdentifyTask","geocortex/infrastructure/GeometryUtils","geocortex/framework/utils/utils"],function(e,t,i,o,r,c,p,h,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){this.featureServiceId=e.featureServiceId,this.where="{0} = '{1}'".format(e.scanResultFieldName,t.replace("'","''")),this.template={},this.template[e.scanResultFieldName]=t};t.CreateOrEditFeatureDescriptor=n;var s,l=(s=i.ViewModelBase,d(u,s),u.prototype.initialize=function(e){e&&e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),e&&e.searchRadiusMeters&&this.searchRadius.set(e.searchRadiusMeters),this.app.command("CreateOrEditFeatureFromBarcodeScan").register(this,this._executeCreateOrEditFeatureFromBarcodeScan),this.app.command("CreateOrEditFeature").register(this,this._executeCreateOrEditFeature),this.app.command("SelectFeatureForEditing").register(this,this._findExistingFeature),this.app.event("Internal.EditorFormSetupEvent").subscribe(this,this._fillTemplateDataInForm),this.geolocationEnabled.set(navigator&&void 0!==navigator.geolocation)},u.prototype._executeCreateOrEditFeatureFromBarcodeScan=function(i){var r=this;this.app.command("LaunchBarcodeScannerWithCallback").execute(function(e){if("Success"===e.status){var t=e.content;r.app.command("CreateOrEditFeature").execute([new n(i,t)])}})},u.prototype._executeCreateOrEditFeature=function(e){var r=this;this.resultsFSC=new o.FeatureSetCollection,this.inputFeatureDescriptors=e||[],this.currentFeatureServiceDescriptor=null;for(var t=0,i=this.inputFeatureDescriptors;t<i.length;t++){var a=i[t],n=this.app.site.essentialsMap.findMapServiceById(a.featureServiceId),s=new esri.tasks.Query;s.outFields=["*"],s.where=a.where,n.queryFeatures(s,function(t,i){return function(e){r._collectSearchResults(t,i,e)}}(n,a),function(e){r.app.trace.error("Error querying for feature data: {0}".format(e.toString()))})}},u.prototype._fillTemplateDataInForm=function(e,t){if(this.currentFeatureServiceDescriptor){for(var i=e.get(),r=this.currentFeatureServiceDescriptor.template,a=0;a<i.fields.length();a++){var n=i.fields.getAt(a);for(var s in r)r.hasOwnProperty(s)&&n.name.get()===s&&n.value.set(r[s])}this.currentFeatureServiceDescriptor=null}},u.prototype._collectSearchResults=function(e,t,i){this.currentFeatureLayer=e.layers[0];var r=new c.FeatureSet({esriFeatureSet:i,layer:this.currentFeatureLayer});if(this.resultsFSC.featureSets.addItem(r),this.resultsFSC.featureSets.length()===this.inputFeatureDescriptors.length)if(1===this.resultsFSC.countFeatures()){this.app.trace.debug("Found one feature, start editing it.");var a=this.resultsFSC.firstFeature();this._startEditingFeature(a)}else 1<this.resultsFSC.countFeatures()?(this.app.trace.debug("Multiple features found, select one to edit."),this.app.command("ShowSelectionListOfFeaturesWithCallback").execute(r,this._startEditingFeature)):(this.currentFeatureServiceDescriptor=t,this.app.trace.debug("Creating a new feature."),this.app.command("ActivateView").execute("CreateOrEditView"))},u.prototype.initiateCreateNewFeature=function(){this.app.command("ShowFeatureTemplatePicker").execute(this.currentFeatureLayer)},u.prototype.selectGeometry=function(){var e=this.app.toolRegistry.tool("SelectFeaturesForEditingTool");e&&e.setActive(!0)},u.prototype._findExistingFeature=function(e,t){function i(e,t,i){if(t&&0<t.length){s=!0;var r=new esri.tasks.FeatureSet;r.features=t.map(function(e){return e.feature});var a=new c.FeatureSet({esriFeatureSet:r,layer:i.layers[0]});n.app.command("ShowSelectionListOfFeaturesWithCallback").execute(a,n._startEditingFeature)}}function r(e,t,i){n.app.trace.warning("Failed to find features: {0}".format(t.message))}var n=this,a=new p.MapIdentifyTask(this.app.map,this.app),s=!(a.layerRestriction=function(e){return e===n.currentFeatureLayer}),o=dojo.hitch(this,function(){s&&n._setSelectionToolActive(!1)});if("point"===e.type){var l=new esri.SpatialReference({wkid:102100}),u=this.searchRadius.get();u=t&&u<t?t:u;var d=h.createCircle(l,e,u,60);a.execute(d,i,o,r)}else a.execute(e,i,o,r)},u.prototype._startEditingFeature=function(e){Array.isArray(e)&&(e=e[0]),this.app.command("HideCreateEditView").execute(),this.app.command("HideMultiFeatureSelectorView").execute(),this.app.command("ZoomToFeature").execute(e),this.app.command("StartEditingFeature").execute(e,!1)},u.prototype._setSelectionToolActive=function(e){var t=this.app.toolRegistry.tool("SelectFeaturesForEditingTool");t&&(a.isNullOrUndefined(e)?t.setActive(!0):t.setActive(e))},u);function u(e,t){var i=s.call(this,e,t)||this;return i.geolocationEnabled=new r.Observable,i.searchRadius=new r.Observable(100),i}t.CreateOrEditViewModel=l})},"Mapping/modules/Editing/CutUnion/CutInteractive":function(){define(["require","exports","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/tools/DrawMode","geocortex/infrastructure/ui/components/FeatureSelector/FeatureSelectorViewModel","../MultiFeatureSelector/MultiFeatureSelectorViewModel","./../FeatureUtilities"],function(e,t,l,a,i,n,s,u,r,o,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(h.prototype.registerCommands=function(){this.app.command(this.INTERNAL_CUT_LINE_DRAW_COMPLETED_COMMAND).register(this,this._executecutLineDrawCompleted,this._canExecuteCutLineDrawCompleted),this.app.command("CutFeatureInteractive").register(this,this._executeCutFeatureInteractive,this._canExecuteCutFeatureInteractive)},h.prototype._registerCutPolylineTool=function(){var e=this;if(!this._cutPolylineTool){var t={command:this.INTERNAL_CUT_LINE_DRAW_COMPLETED_COMMAND,name:this.INTERNAL_CUT_POLYLINE_TOOL_NAME,statusText:this.app.getResource(this.libraryId,"language-feature-editing-cut-polyline-tool-status"),drawMode:r.DrawMode.POLYLINE,isSticky:!0},i=this.app.toolRegistry.createTools([t],!0);this._cutPolylineTool=i[0]||null,this._cutPolylineTool&&dojo.aspect.after(this._cutPolylineTool,"onDeactivated",function(){return e.app.command("HideFeatureSelector").execute()})}},h.prototype._activateCutPolylineTool=function(){this.app.toolRegistry.setActiveTool(this.INTERNAL_CUT_POLYLINE_TOOL_NAME),this.app.event("CutFeatureToolActivatedEvent").publish()},h.prototype._deactiveCutPolylineTool=function(){this.app.toolRegistry.getActiveTool()&&this.app.toolRegistry.getActiveTool().name===this.INTERNAL_CUT_POLYLINE_TOOL_NAME&&(this.app.toolRegistry.clearActiveTool(),this.app.event("CutFeatureToolDeactivatedEvent").publish()),this._originalFeature&&this.app.command("ClearFeatureFocus").execute(this._originalFeature)},h.prototype._performPreCutOperations=function(){this.app.command("HideFeatureDetails").execute(),this.app.command("RemoveResultsStatus").execute(),this.app.command("ZoomToFeature").execute(this._originalFeature),this.app.command("FocusFeature").execute(this._originalFeature)},h.prototype._executeCutFeatureInteractive=function(e){var t=this;this._originalFeature=e,this._originalFeatureClone=new esri.Graphic(this._originalFeature.esriFeature.get().toJson()),this._originalFeature.featureSet&&this._originalFeature.featureSet.features&&(this._indexOffeatureTobeCutInOriginalFeatureSet=this._originalFeature.featureSet.features.indexOf(this._originalFeature)),this._performPreCutOperations();var i={featureSet:new a.FeatureSet({app:this.app,esriFeatureSet:new esri.tasks.FeatureSet}),callback:function(){return t._cleanup()},onFeatureSelectorViewActivated:function(){return t.app.command("FocusFeature").execute(t._originalFeature)},onFeatureSelectorViewDeactivated:function(){return t._cleanup(!1,!1)},viewMessage:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-msg"),viewTitle:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-title"),noResultsTextHeader:this.app.getResource(this.libraryId,"language-feature-editing-cut-tool-message-header"),noResultsTextDescription:this.app.getResource(this.libraryId,"language-feature-editing-cut-tool-message-description"),buttons:[{value:d.SELECTOR_BUTTON_VALUE.CANCEL,label:this.app.getResource(this.libraryId,"language-common-cancel"),causesValidation:!1,isDefault:!0}],selectionMode:o.FEATURE_SELECTOR_MODE.SINGLE,showFilterTextBox:!1};this.app.command("ShowFeatureSelector").execute(i),this._activateCutPolylineTool(),this._monitorToolActivations()},h.prototype._canExecuteCutFeatureInteractive=function(e){if(this.app.isOffline&&this.app.isOffline.get())return!1;if(e instanceof l.Feature&&e.esriFeature&&e.esriFeature.get()){var t=e.esriFeature.get();if(t.geometry&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)){var i=e.layer.mapService.serviceLayer;if(i instanceof esri.layers.FeatureLayer&&i.isEditable&&i.isEditable()){if(!i.capabilities)return!0;var r=i.getEditCapabilities();if(r.canCreate&&r.canUpdate)return!0}}return!1}return!1},h.prototype._executecutLineDrawCompleted=function(e){var r=this;i.cutGeometry(this._originalFeature.esriFeature.get().geometry,e).then(function(e){r._showCutPreview(e)},function(e){var t=e.message,i=r.app.getResource(r.libraryId,"language-feature-editing-error-title");r.app.command("Alert").execute(t,i),r.app.trace.error(t)})},h.prototype._canExecuteCutLineDrawCompleted=function(e){return!!(e&&e instanceof esri.geometry.Polyline)},h.prototype._showCutPreview=function(e){var t=this;if(e.length<2){var i=this.app.getResource(this.libraryId,"language-feature-editing-cut-non-intersecting-polyline"),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return this.app.command("Alert").execute(i,r),void this.app.trace.error(i)}if(0!==this._cutLimit&&e.length>this._cutLimit)return i=this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-limit-error").format(this._cutLimit),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title"),this.app.command("Alert").execute(i,r),void this.app.trace.error(i);this._deactiveCutPolylineTool(),this._cloneGraphicsLayer=s.getInternalGraphicsLayer(n.EDITOR_CLONE_LAYER_ID,this.app,s.GraphicsLayerType.Markup,!1),this._cloneGraphicsLayer.setRenderer(this._originalFeature.layer.mapService.serviceLayer.renderer),e.forEach(function(e){t._cloneGraphicsLayer.add(new esri.Graphic(e,t._originalFeature.esriFeature.get().symbol,t._originalFeature.esriFeature.get().attributes,t._originalFeature.esriFeature.get().infoTemplate))}),this._originalFeature.esriFeature.get().hide(),this._originalFeature.selected.get()&&(this.app.highlightManager.suppressHighlight(this._originalFeature.esriFeature.get()),this.app.highlightManager.highlightSelected(this._cloneGraphicsLayer.graphics)),this._showResultPickerToChooseMaster(this._cloneGraphicsLayer.graphics)},h.prototype._showResultPickerToChooseMaster=function(e){var r=this,t=new a.FeatureSet({app:this.app,esriFeatureSet:new esri.tasks.FeatureSet});e.forEach(function(e){return t.addFeature(new l.Feature({graphic:e,layer:r._originalFeature.layer}),!0)});var i={featureSet:t,callback:function(e,t,i){switch(i.value.get()){case d.SELECTOR_BUTTON_VALUE.OK:r._applyEdits(e[0]);break;default:r._cleanup()}},onFeatureSelectorViewDeactivated:function(){return r._cleanup(!1)},viewMessage:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-choose-master"),viewTitle:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-title"),errorMessage:this.app.getResource(this.libraryId,"language-feature-editing-multi-feature-selector-error-message-or-cancel"),buttons:[{value:d.SELECTOR_BUTTON_VALUE.OK,label:this.app.getResource(this.libraryId,"language-common-ok"),causesValidation:!0,isDefault:!0},{value:d.SELECTOR_BUTTON_VALUE.CANCEL,label:this.app.getResource(this.libraryId,"language-common-cancel"),causesValidation:!1,isDefault:!1}],selectionMode:o.FEATURE_SELECTOR_MODE.SINGLE,showFilterTextBox:!1};this.app.command("ShowFeatureSelector").execute(i)},h.prototype._applyEdits=function(a){var n=this,r=esri.geometry.fromJson(this._originalFeature.esriFeature.get().geometry.toJson());this._originalFeature.esriFeature.get().setGeometry(esri.geometry.fromJson(a.esriFeature.get().geometry.toJson()));var s=[this._originalFeature.esriFeature.get()],e=this._cloneGraphicsLayer.graphics.filter(function(e){return e!==a.esriFeature.get()}),o=[];e.forEach(function(e){o.push(new esri.Graphic(e.toJson()))});var t={};t.addedFeatures=o,t.updatedFeatures=s,t.deletedFeatures=[],t.layer=c.FeatureUtilities.getFeatureLayer(this._originalFeature),t.mapService=this._originalFeature.layer.mapService,t.successCallback=function(){n.app.command("_clearSavedGeometryEditHighlightId").execute();var i=a.selected.get();n.app.highlightManager.updateHighlightId(s[0]);var r,e={originalFeature:n._originalFeatureClone,editedFeature:s[0]};n.app.event("FeatureEditedEvent").publish(e),"number"==typeof n._indexOffeatureTobeCutInOriginalFeatureSet&&(r=n._indexOffeatureTobeCutInOriginalFeatureSet+1),o.forEach(function(e){var t={};t.feature=new l.Feature({graphic:e,layer:n._originalFeature.layer}),i&&(t.feature.selected.set(!0),n.app.highlightManager.persistStarHighlights&&n.app.highlightManager.highlightSelected([t.feature])),t.originalFeature=n._originalFeature,r?(t.featureSetIndex=r,n.app.command("_AddFeatureToResultsWhenOriginalFeatureExists").execute(t),r++):(t.featureSetIndex=0,n.app.command("_AddFeatureToResultsWhenParentExists").execute(t)),n.app.event("FeatureCreatedEvent").publish(t.feature.esriFeature.get())}),n._cleanup();var t=n.app.getResource(n.libraryId,"language-feature-editing-save-success");n.app.command("AddResultsStatus").execute(t),n.app.command("ScreenReaderNarrate").execute(t)},t.errorCallback=function(e){var t=n.app.getResource(n.libraryId,"language-feature-editing-error-feature-edits").format(e.message),i=n.app.getResource(n.libraryId,"language-feature-editing-error-title");n.app.command("Alert").execute(t,i),n.app.trace.error(t),n._originalFeature.esriFeature.get().setGeometry(esri.geometry.fromJson(r.toJson())),n._cleanup()};var i=new u.AddStatusArgs(this.app.getResource(this.libraryId,"language-feature-editing-applying"),null,null,this.STATUS_MESSAGE_ID,this.CUT_SAVE_STATUS_MESSAGE_TIMEOUT,!0);this.app.command("AddStatus").execute(i),this.app.command("ApplyEdits").execute(t)},h.prototype._unsubscribeFromActiveToolChangedEvent=function(){this._subscriptionToken&&(this.app.event("ActiveToolChanged").unsubscribe(this._subscriptionToken),this._subscriptionToken=null)},h.prototype._monitorToolActivations=function(){var t=this;this._unsubscribeFromActiveToolChangedEvent(),this._subscriptionToken=this.app.event("ActiveToolChanged").subscribe(this,function(e){e&&e.tool&&e.tool.name&&"cutPolylineTool"!==e.tool.name&&t._cleanup()})},h.prototype._cleanup=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!0),this._unsubscribeFromActiveToolChangedEvent(),this._cutPolylineTool&&this._cutPolylineTool.isActive&&this._deactiveCutPolylineTool(),this.app.command("RemoveStatus").execute(this.STATUS_MESSAGE_ID),t&&(this._indexOffeatureTobeCutInOriginalFeatureSet=null,this._cloneGraphicsLayer&&(s.removeInternalGraphicsLayer(n.EDITOR_CLONE_LAYER_ID,this.app,s.GraphicsLayerType.Markup),this._cloneGraphicsLayer=null,this.app.highlightManager.clearHighlights("Editor",!0)),this._originalFeature)){this.app.highlightManager.enableHighlight(this._originalFeature.esriFeature.get());var i=c.FeatureUtilities.getFeatureLayer(this._originalFeature);i&&i.refresh(),this._originalFeature=null}e&&this.app.command("HideFeatureSelector").execute()},h);function h(e,t,i){this.INTERNAL_CUT_POLYLINE_TOOL_NAME="cutPolylineTool",this.INTERNAL_CUT_LINE_DRAW_COMPLETED_COMMAND="_cutLineDrawCompleted",this.STATUS_MESSAGE_ID="cutInteractive",this._cutLimit=10,this._cutPolylineTool=null,this._subscriptionToken=null,this.app=e,this.libraryId=t,null!=i&&void 0!==i&&(this._cutLimit=i),this._registerCutPolylineTool(),this.registerCommands()}t.CutInteractive=p})},"Mapping/modules/Editing/CutUnion/UnionInteractive":function(){define(["require","exports","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/ui/components/FeatureSelector/FeatureSelectorViewModel","../MultiFeatureSelector/MultiFeatureSelectorViewModel","./../FeatureUtilities"],function(e,t,u,s,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.registerCommands=function(){this.app.command("UnionFeaturesInteractive").register(this,this._executeUnionFeaturesInteractive,this._canExecuteUnionFeaturesInteractive)},r.prototype.subscribeEvents=function(){var e=this;this.app.event("_featureRemovedFromResults").subscribe(this,function(){e.app.command("UnionFeaturesInteractive").raiseCanExecuteChanged()}),this.app.event("_featureAddedToResults").subscribe(this,function(){e.app.command("UnionFeaturesInteractive").raiseCanExecuteChanged()})},r.prototype._returnCallbackToApplyUnionEdits=function(s,o){var l=this;return function(e){l._masterFeature=e[0];var r=new esri.Graphic(l._masterFeature.esriFeature.get().toJson()),i=l._masterFeature.esriFeature.get();i.geometry=esri.geometry.fromJson(o.toJson());var a=s.features.get().map(function(e){return e.esriFeature.get()}).filter(function(e){return e!==i}),t={};t.mapService=s.layer.mapService,t.layer=s.layer.mapService.serviceLayer,t.addedFeatures=[],t.updatedFeatures=[i],t.deletedFeatures=a,t.successCallback=function(){l.app.command("_clearSavedGeometryEditHighlightId").execute(),l.app.highlightManager.updateHighlightId(i),l.app.command("ZoomToFeature").execute(l._masterFeature),a.forEach(function(e){l.app.featureSetManager.updateCollectionsOnFeatureDeletion(e),l.app.event("FeatureDeletedEvent").publish(e)}),s.layer.mapService.serviceLayer.refresh();var e={originalFeature:r,editedFeature:l._masterFeature.esriFeature.get()};l.app.event("FeatureEditedEvent").publish(e),l.app.command("UnionFeaturesInteractive").raiseCanExecuteChanged(),l._cleanup();var t=l.app.getResource(l.libraryId,"language-feature-editing-save-success");l.app.command("AddResultsStatus").execute(t),l.app.command("ScreenReaderNarrate").execute(t)},t.errorCallback=function(e){var t=l.app.getResource(l.libraryId,"language-feature-editing-error-feature-edits").format(e.message),i=l.app.getResource(l.libraryId,"language-feature-editing-error-title");l.app.command("Alert").execute(t,i),l.app.trace.error(t),l._masterFeature.esriFeature.get().setGeometry(esri.geometry.fromJson(r.geometry.toJson())),l._cleanup(null)};var n=new u.AddStatusArgs(l.app.getResource(l.libraryId,"language-feature-editing-applying"),null,null,l.STATUS_MESSAGE_ID,l.UNION_SAVE_STATUS_MESSAGE_TIMEOUT,!0);l.app.command("AddStatus").execute(n),l.app.command("ApplyEdits").execute(t)}},r.prototype._returnUnionGraphicsInMemorySuccessCallback=function(a){var n=this;return function(e,r,t){return new Promise(function(e,t){n._cloneGraphicsLayer=null,n.app.command("ZoomToFeatures").execute(a);var i={featureSet:a,callback:function(e,t,i){switch(i.value.get()){case o.SELECTOR_BUTTON_VALUE.OK:n._returnCallbackToApplyUnionEdits(a,r[0].geometry)(e);break;default:n._cleanup()}},onFeatureSelectorViewDeactivated:function(){return n._cleanup(!1)},viewTitle:n.app.getResource(n.libraryId,"language-feature-editing-union-pick-list-title"),viewMessage:n.app.getResource(n.libraryId,"language-feature-editing-union-pick-list-instructional-message"),errorMessage:n.app.getResource(n.libraryId,"language-feature-editing-multi-feature-selector-error-message-or-cancel"),buttons:[{value:o.SELECTOR_BUTTON_VALUE.OK,label:n.app.getResource(n.libraryId,"language-common-ok"),causesValidation:!0,isDefault:!0},{value:o.SELECTOR_BUTTON_VALUE.CANCEL,label:n.app.getResource(n.libraryId,"language-common-cancel"),causesValidation:!1,isDefault:!1}],selectionMode:s.FEATURE_SELECTOR_MODE.SINGLE,showFilterTextBox:!1};n.app.command("ShowFeatureSelector").execute(i),e()})}},r.prototype._shouldShowCardinalityWarning=function(e){if(e&&e.features.length){var t=n.FeatureUtilities.getFeatureLayer(e.features.get()[0]);if(t&&t.relationships&&0<t.relationships.length)for(var i=0,r=t.relationships;i<r.length;i++){var a=r[i];switch(a.cardinality){case"esriRelCardinalityManyToMany":return!0;case"esriRelCardinalityOneToOne":case"esriRelCardinalityOneToMany":if("esriRelRoleOrigin"===a.role)return!0}}}return!1},r.prototype._executeUnionFeaturesInteractive=function(t){function e(e){e&&i._unionFeatures(t)}var i=this;this._checkCardinality&&this._shouldShowCardinalityWarning(t)?setTimeout(function(){i.app.command("Confirm").execute(i.app.getResource(i.libraryId,"language-feature-editing-union-cardinality-warning"),i.app.getResource(i.libraryId,"language-feature-editing-union-text"),e)}):this._unionFeatures(t)},r.prototype._unionFeatures=function(e){var i=this;if(this._unsubscribeFromActiveToolChangedEvent(),this._subscriptionToken=this.app.event("ActiveToolChanged").subscribe(this,this._cleanup),this.app.command("RemoveResultsStatus").execute(),0!==this._unionLimit&&e.features.get().length>this._unionLimit){var t=this.app.getResource(this.libraryId,"language-feature-editing-union-pick-list-limit-error").format(this._unionLimit),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return this.app.command("Alert").execute(t,r),void this.app.trace.error(t)}this._originalFeatures=e.clone(),this._cloneGraphicsLayer=new esri.layers.GraphicsLayer,e.esriFeatureSet.features.forEach(function(e){var t=new esri.Graphic(e.toJson());i._cloneGraphicsLayer.add(t)});var a={};a.successCallback=this._returnUnionGraphicsInMemorySuccessCallback(e),a.graphicsLayer=this._cloneGraphicsLayer,a.graphics=this._cloneGraphicsLayer.graphics,a.errorCallback=function(e){i._cloneGraphicsLayer=null;var t=i.app.getResource(i.libraryId,"language-feature-editing-error-title");i.app.command("Alert").execute(e.message,t),i.app.trace.error(e.message)},a.skipUndoManager=!0,this.app.command("UnionGraphicsInMemory").execute(a)},r.prototype._canExecuteUnionFeaturesInteractive=function(e){if(this.app.isOffline&&this.app.isOffline.get())return!1;if(e&&e.features&&e.features.get()&&1<e.features.get().length){var t=e.esriFeatureSet.features;if(0===t.length)return!1;var i=e.layer.mapService.serviceLayer;if(i&&i instanceof esri.layers.FeatureLayer&&i.isEditable&&i.isEditable()){if(i.capabilities){var r=i.getEditCapabilities();if(!r.canDelete||!r.canUpdate)return!1}var a=t[0];if(!a)return!1;if(a.geometry&&"polygon"!==a.geometry.type&&"polyline"!==a.geometry.type)return!1;for(var n=1;n<t.length;n++)if(a.geometry.type!==t[n].geometry.type||!a.geometry.spatialReference.equals(t[n].geometry.spatialReference))return!1;return!0}}return!1},r.prototype._unsubscribeFromActiveToolChangedEvent=function(){this._subscriptionToken&&(this.app.event("ActiveToolChanged").unsubscribe(this._subscriptionToken),this._subscriptionToken=null)},r.prototype._cleanup=function(e){void 0===e&&(e=!0),this._unsubscribeFromActiveToolChangedEvent(),this._cloneGraphicsLayer=null,this.app.command("RemoveStatus").execute(this.STATUS_MESSAGE_ID),this.app.highlightManager.clearHighlights("Editor",!0);var t=!!this._masterFeature&&this._masterFeature.selected.get();this._originalFeatures&&this.app.highlightManager.clearSelected(this._originalFeatures.features.getItems().filter(function(e){return e.selected.get()})),this._masterFeature&&this.app.highlightManager.persistStarHighlights&&t&&(this.app.highlightManager.highlightSelected([this._masterFeature]),this._masterFeature.selected.set(!0)),this._originalFeatures=null,this._masterFeature=null,e&&this.app.command("HideFeatureSelector").execute()},r);function r(e,t,i,r){this.STATUS_MESSAGE_ID="unionInteractive",this._unionLimit=10,this._subscriptionToken=null,this._checkCardinality=!0,this.app=e,this.libraryId=t,null!=i&&(this._unionLimit=i),null!=r&&(this._checkCardinality=r),this.registerCommands(),this.subscribeEvents()}t.UnionInteractive=i})},"Mapping/modules/Editing/Editor/EditorView":function(){var r,c=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","./EditorViewModel","geocortex/infrastructure/Feature","geocortex/infrastructure/BrowserUtils","geocortex/framework/observables","geocortex/infrastructure/FormatUtils"],function(e,t,i,a,r,n,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,u=(l=i.ViewBase,c(d,l),d.prototype.attach=function(e){var t=this;l.prototype.attach.call(this,e),this.isBusy.sync(e.isBusy),this.title.syncTransform(e.headerText,function(e){return String.unescapeHtml(e)}),this.app.event("ApplicationOfflineEvent").subscribe(this,this.cancelEditing),this.app.event("ApplicationOnlineEvent").subscribe(this,this.cancelEditing),this.app.event("FeatureDeletedEvent").subscribe(this,this._onFeatureDeletedEvent),this.app.event("RelatedRecordDeletedEvent").subscribe(this,this._onRelatedRecordDeletedEvent),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._onGeometryEditCompletedEvent),this.app.command("ShowFeatureAttributeEditor").register(this,function(){t._activateView()}),this.app.command("HideFeatureAttributeEditor").register(this,function(){return t.isActive&&t._deactivateView(),!1}),this.app.command("_CancelEditing").register(this,this._executeCancelEditing,this._canExecuteCancelEditing)},d.prototype._executeCancelEditing=function(){this.cancelEditing()},d.prototype._canExecuteCancelEditing=function(){return this.viewModel.editingInProgress()},d.prototype.deactivated=function(){l.prototype.deactivated.call(this),this.viewModel.isEditingGeometry.get()&&this.cancelEditing()},d.prototype.handleTakeNativePhotoCamera=function(){n.handleTakeNativePhotoCamera(this.viewModel.handleFileFromBrowser.bind(this.viewModel))},d.prototype.handleTakeNativePhotoGallery=function(){n.handleTakeNativePhotoGallery(this.viewModel.handleFileFromBrowser.bind(this.viewModel))},d.prototype.handleTypeFieldChange=function(e,t,i){this.viewModel.handleTypeFieldSelected(i)},d.prototype.handleClickEditGeometry=function(e,t,i){return this.viewModel.handleClickEditGeometry()},d.prototype.handleClickDeleteFeature=function(e,t,i){return this.viewModel.state===a.EditorState.EditingGeometry&&this.viewModel.stopEditingGeometry(),this.viewModel.confirmDelete(),!1},d.prototype.handleClickSave=function(e,t,i){var r=this;return this.viewModel.state===a.EditorState.EditingGeometry&&this.viewModel.stopEditingGeometry(),this.isBusy.set(!0),this.viewModel.save(function(){return r.saveSuccessCallback()},function(e){return r.saveErrorCallback(e)}),!1},d.prototype.handleFileSelect=function(e){var r=this;if(e.target.files&&window.FileReader){var a=this.app.nativeManager.isNative()?null:"_blank",t=e.target.files;Array.prototype.slice.call(t).forEach(function(i){var e=new FileReader;e.onload=function(e){var t={name:new s.Observable(i.name),url:new s.Observable(e.target.result),canEditAttachments:!0,size:o.formatBytes(i.size),target:a,type:i.type};r.viewModel.attachmentInfos.addItem(t),r.viewModel.attachmentsToAdd.addItem(t),r.viewModel.noAttachments.set(!1),r.fileInputElement.value=null},e.readAsDataURL(i)})}},d.prototype.handleDeleteClick=function(e,t,i){i.attachmentId?(this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-feature-editing-attachment-warning")),this.viewModel.attachmentsToRemove.addItem(i)):this.viewModel.attachmentsToAdd.removeItem(i),this.viewModel.attachmentInfos.removeItem(i),0===this.viewModel.attachmentInfos.getLength()&&this.viewModel.noAttachments.set(!0)},d.prototype.handleFileKeypress=function(e){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.fileInputElement.click())},d.prototype.attachment_click=function(e,t,i){var r=this;if(!(512<4*Math.ceil(i.url.get().length/3)/1e3))return this.app.isOffline.get()?(this.app.command("RewriteUrlForOffline").execute(i.url.get(),function(e){if(e)return r.app.command("OpenWebPage").execute({url:e,element:t});r.app.command("Alert").execute(r.getResource("language-feature-details-attachment-not-available-offline"))}),!1):this.app.followNavigationLink({url:i.url.get(),element:t})},d.prototype.saveSuccessCallback=function(){this._deactivateView()},d.prototype.saveErrorCallback=function(e){},d.prototype.cancelEditing=function(){this.viewModel.cancelEditing(),this.isActive&&this._deactivateView()},d.prototype._activateView=function(){this.app.command("ActivateView").execute(this.id)},d.prototype._deactivateView=function(e){void 0===e&&(e=!0),this.app.command("DeactivateView").execute(this.id),this.app.event("_internalEvent.EditorViewDeactivated").publish(this.viewModel.currentFeatureEsriClone)},d.prototype._onFeatureDeletedEvent=function(e){this.viewModel&&this.viewModel.currentFeatureEsri&&this.viewModel.currentFeatureEsri===e&&(this._deactivateView(!1),this.viewModel.currentFeatureEsriClone.hide())},d.prototype._onRelatedRecordDeletedEvent=function(){this._deactivateView()},d.prototype._onGeometryEditCompletedEvent=function(e){var t=null;t=e.cancelled?new r.Feature({graphic:e.editedGraphic}):new r.Feature({graphic:e.originalGraphic}),this.app.behavior("EditorFeatureSelectedBehavior").run(t)},d.prototype.handleClickCancel=function(e,t,i){return this.cancelEditing(),!1},d.prototype.handleInputFocus=function(e,t,i){i.showActualValue()},d.prototype.handleInputBlur=function(e,t,i){i.showFormattedValue()},d);function d(){var e=null!==l&&l.apply(this,arguments)||this;return e._attachmentWarningViewed=!1,e}t.EditorView=u})},"Mapping/modules/Editing/Editor/EditorViewModel":function(){var r,S=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./Form/EditingFormViewModel","geocortex/infrastructure/Feature","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/EditingUtils","./../FeatureUtilities","geocortex/geocortex","geocortex/infrastructure/tools/MapTool","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/MapUtils","geocortex/framework/utils/ArrayUtils","geocortex/essentials/utilities/TimeZoneUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/HighlightManager","geocortex/infrastructure/EditingUtils","geocortex/framework/utils/utils","geocortex/infrastructure/BrowserUtils"],function(e,t,i,n,y,u,r,p,h,g,l,a,s,o,v,d,c,m,f,b,E,_,F){"use strict";var w,C;Object.defineProperty(t,"__esModule",{value:!0}),(C=w=t.EditorState||(t.EditorState={}))[C.Idle=0]="Idle",C[C.Paused=1]="Paused",C[C.CantEdit=2]="CantEdit",C[C.EditingAttributes=3]="EditingAttributes",C[C.EditingGeometry=4]="EditingGeometry",C[C.Saving=5]="Saving";var I,T=(I=i.ViewModelBase,S(x,I),x.prototype.initialize=function(e){var t=this;e&&(e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),this.validateGeometry=!!e.validateGeometry,this.configAllowsEditGeometry=void 0!==e.editGeometry?!!e.editGeometry:this.configAllowsEditGeometry,this.textareaThreshold=void 0!==e.textareaThreshold?parseInt(e.textareaThreshold,10):this.textareaThreshold,this.doNotAdjustTime=void 0!==e.doNotAdjustTime?!!e.doNotAdjustTime:this.doNotAdjustTime),this.app.nativeManager.hasNativeCapability("editing").then(function(e){t.canEditOffline=e})},x.prototype._registerCommands=function(){var e=this;this.app.command("StartEditingFeature").register(this,this._executeStartEditingFeature,this._canExecuteStartEditingFeature),this.app.command("StartEditingNewFeature").register(this,this._executeStartEditingNewFeature,this._canExecuteStartEditingNewFeature),this.app.command("StartEditingEditLogEntry").register(this,this._executeStartEditingEditLogEntry,this._canExecuteStartEditingEditLogEntry),this.app.command("StartEditingNewRelatedRecord").register(this,this._executeStartEditingRelatedRecord),this.app.command("StartEditingGraphicGeometry").postExecute.subscribe(this,this._onStartEditingGraphicGeometry),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._onGeometryEditCompletedEvent),this.app.command("StartAddingFeatureGeometry").register(this,this._executeStartAddingFeatureGeometry,this._canExecuteStartEditingNewFeature),this.app.command("Internal.CancelEditingIfNotIdle").register(this,function(){e.state!==w.Idle&&e.cancelEditing()}),this.app.command("StartEditingAttributesAndGeometryFeature").register(this,this._executeStartEditingAttributesAndGeometryFeature,this._canExecuteStartEditingFeature)},x.prototype._executeStartAddingFeatureGeometry=function(e,t){this.app.command("StartEditingNewFeature").execute(e,t)},x.prototype._subscribeToEvents=function(){this.app.event("GeometryEditInvokedEvent").subscribe(this,this._handleGeometryEditInvokedEvent),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._handleGeometryEditCompletedEvent),this.app.event("GeolocatedEvent").subscribe(this,this._handleGeolocation),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChangedEvent)},x.prototype.performValidation=function(){var e=!0;return this.form.get().clearValidationMessages(),e=this.performFormValidation()&&e,this.validateGeometry&&(e=this.performGeometryValidation()&&e),e},x.prototype.performFormValidation=function(){for(var e=!0,t=this.form.get(),i=0;i<t.fields.getLength();++i){var r=t.fields.getAt(i);try{if(r.validationFunc){var a=r.validationFunc(r.value.get());a&&(e=!1,t.addValidationMessage(a))}}catch(e){this.app.trace.warning("Error validating field {0}: {1}".format(r.displayName,e))}}return e},x.prototype.performGeometryValidation=function(){var e=!0,t=this.form.get(),i=this.currentFeatureEsriClone;return i.geometry&&"polygon"===i.geometry.type&&r.isSelfIntersectingPolygon(i.geometry)&&(t.addValidationMessage(this.app.getResource(this.libraryId,"language-feature-editing-self-intersecting-polygon-need-fixing")),e=!1),e},x.prototype.confirmDelete=function(){var i=this;this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-feature-editing-delete-confirmation"),this.app.getResource(this.libraryId,"language-feature-editing-module-title"),function(e){if(e){var t=!1;i._preventDeleteForRelOrigin(i.currentFeatureRelationships,function(){i.app.command("Alert").execute(i.app.getResource(i.libraryId,"language-feature-editing-delete-with-relation-forbidden"),i.app.getResource(i.libraryId,"language-feature-editing-module-title")),t=!0},function(){t||(i.stopEditingGeometry(),i.deleteCurrentFeature())})}})},x.prototype.deleteCurrentFeature=function(e,t){var i=this,r=this.currentFeatureEsri,a=this.currentFeatureGeocortex,n=r.getLayer()||this._sourceLayer,s=this._getMapServiceByLayer(n);if(!s){var o,l=this._relatedFeature,u=this._editingRelationshipOrigin,d=this._editingRelationshipDestination;return o={mapService:this.currentMapService,layer:n,feature:r,relatedFeature:l,relationshipOrigin:u,relationshipDestination:d,successCallback:function(){i._deleteFeatureSuccessCallback(r,n,e)},errorCallback:function(e){i._deleteFeatureErrorCallback(e,n,t)}},this.isBusy.set(!0),this.busyText.set(this.applyingEditText),this.app.command("DeleteRelatedRecord").execute(o),void this.app.event("RelatedRecordDeletedEvent").publish()}var c={mapService:s,layer:n,feature:r,successCallback:function(){a.selected.get()&&(a.selected.set(!1),i.app.highlightManager.clearSelected([c.feature])),i.app.highlightManager.clearAllHighlight([c.feature]),i._deleteFeatureSuccessCallback(r,n,e)},errorCallback:function(e){i._deleteFeatureErrorCallback(e,n,t)}};this.isBusy.set(!0),this.busyText.set(this.applyingEditText),this.app.command("DeleteFeature").execute(c)},x.prototype.handleFileFromBrowser=function(e){},x.prototype._deleteFeatureErrorCallback=function(e,t,i){var r=this.app.getResource(this.libraryId,"language-feature-editing-error-feature-edits").format(e),a=this.app.getResource(this.libraryId,"language-feature-editing-error-title");this.app.command("Alert").execute(r,a),this.app.trace.error(r),this.isBusy.set(!1),this.busyText.set("")},x.prototype._deleteFeatureSuccessCallback=function(e,t,i){this._handleDeletedFeature(e),this.app.event("FeatureDeletedEvent").publish(e),t&&t.remove&&t.remove(e),this.app.command("ShowMap").execute(),this.currentFeatureEsriClone.hide(),this._destroyEditingLayer(),this._sourceLayer.refresh&&this._sourceLayer.refresh(),this.app.command("ShowFeatureParentDetails").execute(),i&&i(),this.isBusy.set(!1),this.busyText.set("")},x.prototype._buildFeatureRelationships=function(){this.currentFeatureRelationships.clear();for(var e,t=this.currentFeatureEsri,i=this._sourceLayer,r=this.currentMapService,a=0,n=i.relationships;a<n.length;a++){var s=n[a];if(!r||!(e=r._getRelation(s.id))||e.visible){var o=!0;if(s.role){if("esriRelRoleOrigin"!==s.role)continue}else o=!1;var l=s.name;_.isNullOrUndefined(e)||(l=e.displayName);var u=this.app.getResource(this.libraryId,"language-feature-editing-create-related-feature").format(l),d={id:s.id,text:u,editable:o,relatedFeature:t,relationship:s};this.currentFeatureRelationships.addItem(d)}}this.hasRelatedLayers.set(0<this.currentFeatureRelationships.getLength())},x.prototype._preventDeleteForRelOrigin=function(e,l,t){var i,r,s=this,o=this.currentFeatureEsri,u=this._sourceLayer,a=null,d=!1;if(o&&u&&e&&0<e.length()&&(a=e.length(),u))for(var n=0;n<e.length();n++)i=n,(r=e.getAt(i)).relationship&&"esriRelRoleOrigin"===r.relationship.role&&!1===r.relationship.composite?function(e){var t=parseInt(e.id,10),i=e.relatedTableId?e.relatedTableId.get():e.relationship.relatedTableId,r=u.url||u._essentialsMetadata.serviceUrl,a=s._getMapServiceByLayer(u),n=new esri.tasks.RelationshipQuery;n.objectIds=[o.attributes[u.objectIdField]],n.outFields=["*"],n.relationshipId=t,p.getQueryTask(u,a),g.FeatureUtilities.getRelatedFeatures(s._getMapServiceByLayer(u),t,n.objectIds[0]).then(function(o){var e=!1;for(var t in o)if(o.hasOwnProperty(t)){e=!0;break}e?s._getRelatedFeatureLayer(i,r,function(e){if(!d){var t=[];for(var i in o)if(o.hasOwnProperty(i)){var r=o[i].features||o[i];if(r)if(r.length)for(var a=0,n=r;a<n.length;a++){var s=n[a];t.push(s)}else t.push(r)}0<t.length&&l&&(l(t),d=!0),c()}},function(e){c()}):c()},function(e){c()})}(r):r.relationship.composite&&c();function c(){--a<=0&&t&&t()}(!a||a<=0)&&t&&t()},x.prototype._getMapServiceByLayer=function(e){if(!e)return null;var t=e.url;if(!t)return null;var i=t.indexOf("?token=");-1!==i&&(t=t.substring(0,i));for(var r=0,a=this.app.site.essentialsMap.mapServices;r<a.length;r++){var n=a[r];if(n.serviceUrl.split("?")[0]===t)return n}return null},x.prototype._getRelatedFeatureLayer=function(e,t,i,r){var a=new dojo.Deferred,n=t.match(/token=.[^&]*/g),s=t.substring(0,t.lastIndexOf("/")+1)+e;n&&(s+="?"+n);var o=new esri.layers.FeatureLayer(s,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});return dojo.connect(o,"onLoad",dojo.hitch(this,function(e){l.deferredResolve(a,e),"function"==typeof i&&i(e)})),dojo.connect(o,"onError",dojo.hitch(this,function(e){l.deferredReject(a,e),"function"==typeof r&&r(e)})),a},x.prototype._getMapServiceForRelatedRecord=function(e){for(var t=0,i=this.app.site.getFeatureServices();t<i.length;t++){for(var r=i[t].serviceLayer,a=0,n=r.relationships;a<n.length;a++)if(n[a]===e.relationship)return this._sourceLayer=r,void this._calculateCanDeleteFeature();if(r.layerId===e.relationship.relatedTableId)for(var s=0,o=r.fields;s<o.length;s++)o[s].name===e.relationship.keyField&&(this._sourceLayer=r)}this._sourceLayer||this.app.trace.warning("Could not find a proper source layer.");var l=this._getMapServiceByLayer(this._sourceLayer);return l||this.app.trace.warning("Could not edit related feature. No map service for layer '{0}' was found.".format(this._sourceLayer.url)),l},x.prototype._getRelatedKeyFieldForRelatedRecords=function(e,t){if(e.relationship.keyField){for(var i=null,r=0,a=t.relationships;r<a.length;r++){var n=a[r];if(n.id===e.relationship.id){i=(this._editingRelationshipDestination=n).keyField;break}}return i||void this.app.trace.error(this.app.getResource(this.libraryId,"language-feature-editing-relationships-key-field-missing"))}this.app.trace.error(this.app.getResource(this.libraryId,"language-feature-editing-relationships-require-arcgis-version"))},x.prototype._setupViewForRelatedRecordCreationAndEditing=function(e,t,i){this._editingRelationshipOrigin=e.relationship,this.canEditGeometry.set(this.configAllowsEditGeometry&&!!t.geometryType),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.showStopEditingGeometryButton.set(!1),this.currentFeatureEsri=i,this.currentFeatureEsriClone=this._cloneEsriFeature(this.currentFeatureEsri),this.form.set(new y.EditingFormViewModel(this.app,this.libraryId,i,t,{textareaThreshold:this.textareaThreshold,doNotAdjustTime:this.doNotAdjustTime,timeZoneId:e.timeZoneId,displayTimeZoneId:e.displayTimeZoneId})),this.app.event("Internal.EditorFormSetupForRelatedFeatureEvent").publish(this.form,i)},x.prototype._renderRelatedRecordEditingTable=function(e,t,i){for(var r=!1,a=0;a<this.form.get().fields.getLength();++a){var n=this.form.get().fields.getAt(a);if(n.name.get()===t){if("objectid"!==t.toLowerCase()&&"globalid"!==t.toLowerCase()){e.feature?(n.value.set(e.feature.attributes[t]),e.relationship.keyField in i.attributes&&(i.attributes[e.relationship.keyField]=e.feature.attributes[e.relationship.keyField]||e.feature.attributes[t])):e.relatedFeature&&(n.value.set(e.relatedFeature.attributes[e.relationship.keyField]),e.relationship.keyField in i.attributes&&(i.attributes[e.relationship.keyField]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t]));continue}n.editable.set(!1)}}!0===this.isEditingNewFeature.get()&&(t in i.attributes&&(i.attributes[t]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t],r=!0),0!==this.form.get().fields.getLength()&&!1!==r||(i.attributes[t]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t]))},x.prototype._executeStartEditingRelatedRecord=function(i,e){var t=this;this.isEditingNewFeature.set(e),this.isEditingRelatedFeature.set(!0),this._relatedFeature=i.relatedFeature;var r=null;if(this.app.map.getLayersVisibleAtScale().forEach(function(e){var t=e;t.layerId&&t.layerId===i.relationship.relatedTableId&&t.fields[i.relationship.keyField]&&(r=t)}),r){this.isEditingRelatedFeatureNotInSite.set(!1);var a=this._getMapServiceByLayer(r);this.currentMapService=a,this._refreshRelatedRecord(i,r)}else{if(this.isEditingRelatedFeatureNotInSite.set(!0),i.essentialsRelatedFeature){if(i.essentialsRelatedFeature.layer.getRelatedFeatureLayer)return void i.essentialsRelatedFeature.layer.getRelatedFeatureLayer(i.relationship.id,function(e){t._refreshRelatedRecord(i,e)},function(e){t.app.trace.error("Error in getting related feature layer: "+e)});var n=this._getMapServiceForRelatedRecord(i);return this.currentMapService=n,void this._refreshRelatedRecord(i,n.serviceLayer)}r=this.currentFeatureGeocortex.featureLayer,this.currentMapService=null,this._refreshRelatedRecord(i,r)}},x.prototype._refreshRelatedRecord=function(t,i){var r=this;t.feature?this._refreshEsriGraphic(t.feature,i).then(function(e){null!=e&&e.features&&0<e.features.length?t.feature=e.features[0]:r.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),r._displayEditorForRelatedFeatures(t,i)}).caught(function(e){r.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),r._displayEditorForRelatedFeatures(t,i)}):this._displayEditorForRelatedFeatures(t,i)},x.prototype._displayEditorForRelatedFeatures=function(e,t){e.text?this.headerText.set(e.text):this.headerText.set(this.app.getResource(this.libraryId,"language-feature-editing-new-related-feature-default")),this.state!==w.Idle&&this.cancelEditing(),this._sourceLayer=t,this._calculateCanDeleteFeature();var i={};t.fields.forEach(function(e){var t=e.name;i[t]=null});var r=null;this.isEditingNewFeature.get()?(r=this._createNewEsriFeature(null,i,null,null)).setGeometry(null):r=e.feature,this._setupViewForRelatedRecordCreationAndEditing(e,t,r);var a=this._getRelatedKeyFieldForRelatedRecords(e,t);if(this._renderRelatedRecordEditingTable(e,a,r),this.isEditingNewFeature.get()&&"Table"!==this._sourceLayer.type){for(var n=void 0,s=0,o=this.app.site.getFeatureServices();s<o.length;s++)for(var l=0,u=o[s].layers;l<u.length;l++){var d=u[l];if(d.id===e.relationship.relatedTableId.toString()&&d.name===e.relationship.name){n=d;break}}this.app.command("ShowFeatureTemplatePicker").execute(n,r)}else this._activateEditingView()},x.prototype.startEditingGeometry=function(){if(!this.currentFeatureEsri)throw new Error("Could not edit geometry - no feature selected.");this.app.command("StartEditingGraphicGeometry").execute(this.currentFeatureEsriClone,this._sourceLayer)},x.prototype.stopEditingGeometry=function(e){void 0===e&&(e=!1),this.app.command("StopEditingGraphicGeometry").execute(e)},x.prototype._onStartEditingGraphicGeometry=function(e,t){this.state===w.Idle||!e||e!==this.currentFeatureEsri&&e!==this.currentFeatureEsriClone||this.currentFeatureEsriClone.hide();var i=this.app.toolRegistry.getActiveTool();i instanceof a.MapTool&&"EditingPointTool"===i.name&&this.app.event("GeometryEditPointActivatedEvent").publish()},x.prototype._onGeometryEditCompletedEvent=function(e){if(this.state!==w.Idle&&this.currentFeatureEsriClone&&(this.currentFeatureEsri===e.originalGraphic||this.currentFeatureEsriClone===e.originalGraphic)){e.cancelled||this.currentFeatureEsri!==e.originalGraphic||this.currentFeatureEsriClone.setGeometry(e.editedGraphic.geometry),this.app.command("HideFeatureTemplatePicker").execute(),this.app.command("HideCreateEditView").execute(),this.app.command("ShowFeatureAttributeEditor").execute(),this.currentFeatureEsriClone.show();var t=new u.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(t)}},x.prototype._handleGeolocation=function(t){function i(){r.currentFeatureEsriClone.setGeometry(t.projectedMapPoint),r.app.event("GeometryEditCompletedEvent").publish({editedGraphic:r.currentFeatureEsriClone,originalGraphic:r.currentFeatureEsri,cancelled:!1}),setTimeout(function(){return r.app.command("GeolocateStop").execute()},0),r.app.command("StopEditingGraphicGeometry").execute();var e=new u.Feature({graphic:r.currentFeatureEsriClone});r.app.behavior("EditorFeatureSelectedBehavior").run(e)}var r=this,e=this.app.toolRegistry.getActiveTool(),a=this.isEditingNewFeature.get()&&"esriGeometryPoint"===this._sourceLayer.geometryType&&e&&"EditingPointTool"===e.name,n=t&&"single"===t.typeOfGeolocation&&t.location;a&&n&&(t.location.coords.accuracy<=t.accuracyThreshold?i():this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-feature-editing-confirm-low-accuracy-geolocation").format(s.formatNumber(t.location.coords.accuracy,o.NumberFormat.DEFAULT,{fractionalDigits:0}),this.getResource("language-common-ok")||"'OK'",this.getResource("language-common-cancel")||"'Cancel'"),this.app.getResource(this.libraryId,"language-feature-editing-confirm-low-accuracy-geolocation-title"),function(e){e?i():setTimeout(function(){return r.app.command("GeolocateStop").execute()},0)}))},x.prototype._createEditingLayer=function(){return this._destroyEditingLayer(),this._editingLayer=f.getInternalGraphicsLayer(m.EDITOR_CLONE_LAYER_ID,this.app,f.GraphicsLayerType.Markup,!1),this._sourceLayer&&this._editingLayer.setRenderer(this._sourceLayer.renderer),this._editingLayer},x.prototype._destroyEditingLayer=function(){this.currentFeatureEsriClone&&(this.currentFeatureEsriClone.hide(),this._editingLayer&&this._editingLayer.remove(this.currentFeatureEsriClone)),this._editingLayer&&(this._editingLayer.clear(),f.removeInternalGraphicsLayer(m.EDITOR_CLONE_LAYER_ID,this.app,f.GraphicsLayerType.Markup),this._editingLayer=null)},x.prototype._createNewEsriFeature=function(e,t,i,r){var a=new esri.Graphic(null);return a.attributes=t||{},a.geometry=e||new esri.geometry.Point(NaN,NaN),a.symbol=i||null,a.infoTemplate=r||null,a},x.prototype._handleLayerVisualizationChangedEvent=function(e){if(e.mapService&&e.mapService.serviceLayer&&this._sourceLayer&&e.mapService.serviceLayer.id===this._sourceLayer.id&&e.mapService.serviceLayer.renderer){var t=e.mapService.serviceLayer.renderer;this.currentFeatureEsriClone&&this.currentFeatureEsriClone.setSymbol(t.getSymbol(this.currentFeatureEsri)),this._editingLayer&&this._editingLayer.setRenderer(t)}},x.prototype.save=function(a,n){var s=this;this.stopEditingGeometry();var e=this.performValidation();if(this.isBusy.set(!1),this.busyText.set(""),e){this.state=w.Saving,this.isBusy.set(!0),this.busyText.set(this.applyingEditText);var t=this.currentFeatureEsri,o=this._sourceLayer,l=new esri.Graphic(this.currentFeatureEsriClone.toJson());try{var i=this.form.get().getAttributeValues(),u=null,r=void 0;if(this.isEditingNewFeature.get())for(r in u=i,t.attributes)t.attributes.hasOwnProperty(r)&&(u.hasOwnProperty(r)||null==t.attributes[r]||(u[r]=t.attributes[r]));else{for(r in u={},i)i.hasOwnProperty(r)&&t.attributes[r]!==i[r]&&(u[r]=i[r]);var d=o.objectIdField,c=o.globalIdField;t.attributes.hasOwnProperty(d)&&(u[d]=t.attributes[d]),t.attributes.hasOwnProperty(c)&&(u[c]=t.attributes[c])}h.findCardinalityConflict(this.app,o,u).then(function(e){if(e)return s.app.command("Alert").execute(s.app.getResource(s.libraryId,"language-feature-editing-cardinality-violation").format(e.value,e.key),s.app.getResource(s.libraryId,"language-feature-editing-error-dialogue")),s.state=w.Idle,s.isBusy.set(!1),void s.busyText.set("");l.attributes=u,s.geometryHasBeenEdited.get();var t=null;if(!s.isEditingRelatedFeatureNotInSite.get()&&!(t=s._getMapServiceByLayer(o)))throw new Error("Could not find map service for feature layer while saving.");s.isBusy.set(!0),s.busyText.set(0<Object.keys(u).length?s.applyingEditText:"");var i={mapService:t,layer:o,feature:l,successCallback:function(){s._handleSaveAttachments(l,o).then(function(){s._handleSaveSuccess(l,o,a,n)})},errorCallback:function(e){s.isBusy.set(!1),s.busyText.set(""),s._handleSaveError(e,n)}};try{s.app.event("Internal.EditorFormPreSaveEvent").publish(s.form,i)}catch(e){return}if(s.isEditingRelatedFeature.get()){var r=i;r.relatedFeature=s._relatedFeature,r.relationshipOrigin=s._editingRelationshipOrigin,r.relationshipDestination=s._editingRelationshipDestination,s.isEditingNewFeature.get()?(r.successCallback=function(){s._handleSaveAttachments(l,o).then(function(){s.app.event("RelatedRecordCreatedEvent").publish(l),s._handleSaveSuccess(l,o,a,n)})},s.app.command("CreateRelatedRecord").execute(r)):(r.successCallback=function(){s._handleSaveAttachments(l,o).then(function(){s.app.event("RelatedRecordCreatedEvent").publish(l),s._handleSaveSuccess(l,o,a,n)})},s.app.command("UpdateRelatedRecord").execute(r))}else s.isEditingNewFeature.get()?(s.app.event("EditorPreCreateFeatureEvent").publish(l),s.app.command("CreateFeature").execute(i)):(s.app.event("EditorPreUpdateFeatureEvent").publish(l),s.app.command("UpdateFeature").execute(i));s.state=w.Saving}).catch(function(e){throw new Error(e)})}catch(e){this.state=w.Idle,this.isBusy.set(!1),this.busyText.set(""),this.app.trace.error("Error applying edits: {0}".format(e))}}},x.prototype._handleSaveError=function(e,t){var i;this.isBusy.set(!1),this.busyText.set(""),this.state=w.Idle,"string"==typeof e?i=e:"string"==typeof e.message&&e.message?i=e.message:Array.isArray(e.details)&&"string"==typeof e.details[0]&&(i=e.details[0]);var r=this.app.getResource(this.libraryId,"language-feature-editing-error-feature-edits").format(i),a=this.app.getResource(this.libraryId,"language-feature-editing-error-title");this.app.command("Alert").execute(r,a),this.app.trace.error(r),t&&t(e)},x.prototype._handleSaveAttachments=function(e,t){var i=this;return this._handleAddAttachments(e,t).then(function(){return i._handleDeleteAttachments(e,t)})},x.prototype._handleSaveSuccess=function(e,t,i,r){this.isBusy.set(!1),this.busyText.set(""),this.layerUpdateEndToken&&(dojo.disconnect(this.layerUpdateEndToken),this.layerUpdateEndToken=null);var a=v.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer);if(a&&this.originalFeatureClone){var n=e.attributes;a.attributes={},dojo.mixin(a.attributes,this.originalFeatureClone.attributes),dojo.mixin(a.attributes,n),dojo.mixin(e.attributes,a.attributes),a.show()}if(this._editingLayer&&this._destroyEditingLayer(),this.originalFeatureClone&&a){var s={originalFeature:this.originalFeatureClone,editedFeature:a};this._handleEditedFeature(s),this.app.event("FeatureEditedEvent").publish(s)}else this.originalFeatureClone&&this.isEditingNewFeature.get()&&this.app.event("FeatureCreatedEvent").publish(e);if(this.isEditingNewFeature.set(!1),this.state=w.Idle,t&&t.refresh(),this.isEditingRelatedFeatureNotInSite.get()){var o=this.findGeocortexLayerForUrl(t.url),l=new u.Feature({graphic:e,layer:o});this.headerText.set(l.plainLabel.get())}this.cancelEditing(),i&&i()},x.prototype._handleAddAttachments=function(r,a){for(var n=this,t=[],e=function(e){var i={data:decodeURIComponent(e.url.get().substring(e.url.get().indexOf("base64,")+7)),fileName:e.name.get(),fileType:e.type};t.push(new Promise(function(t){n.busyText.set(n.uploadingAttachmentText),E.createAttachmentFromFileData(i,null,r,a,function(){},function(e){n._handleAddAttachmentCallback(e),t()},n.app)}))},i=0,s=this.attachmentsToAdd.getItems();i<s.length;i++)e(s[i]);return Promise.all(t)},x.prototype._handleDeleteAttachments=function(t,i){var a=this,e=[],n=this.attachmentsToRemove.getItems().map(function(e){return e.attachmentId});return 0<n.length&&e.push(new Promise(function(r){a.busyText.set(a.deletingAttachmentText);var e={feature:t,layer:i,attachmentIds:n,callback:function(e){if(e[0]&&e[0].error){var t=a.getResource("language-feature-attachments-delete-prompt-title"),i=e[0].error.message||a.getResource("language-feature-attachments-delete-prompt-error-unknown");a.app.command("Alert").execute(i,t)}else a.currentFeatureGeocortex&&(a.currentFeatureGeocortex.resetAttachmentInfos(),setTimeout(function(){return a.app.event("FeatureAttachmentAddedEvent").publish(a.currentFeatureGeocortex)},300)),r()},errback:function(e){var t=a.getResource("language-feature-attachments-delete-prompt-title");a.app.command("Alert").execute(e.message||e,t),r()}};a.app.command("DeleteAttachments").execute(e)})),Promise.all(e)},x.prototype._handleAddAttachmentCallback=function(t){var e=this,i={};try{i=JSON.parse(t.currentTarget.response).error}catch(e){t.currentTarget&&t.currentTarget.statusText?i.message=t.currentTarget.statusText:i.message=this.app.getResource(this.libraryId,"language-native-internal-server-error")}if(i&&i.message){var r=this.getResource("language-native-file-upload-failed");this.app.command("Alert").execute(i.message,r)}else this.currentFeatureGeocortex&&(this.currentFeatureGeocortex.resetAttachmentInfos(),setTimeout(function(){return e.app.event("FeatureAttachmentAddedEvent").publish(e.currentFeatureGeocortex)},300))},x.prototype._cloneEsriFeature=function(e){return new esri.Graphic(e.toJson())},x.prototype._handleGeometryEditInvokedEvent=function(e){this.isEditingGeometry.set(!0),this.showEditGeometryButton.set(!1),this.showStopEditingGeometryButton.set(this.canEditGeometry.get()),this.geometryHasBeenEdited.set(!0)},x.prototype._handleGeometryEditCompletedEvent=function(e){this.isEditingGeometry.set(!1),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.showStopEditingGeometryButton.set(!1),this.currentFeatureEsriClone&&this.currentFeatureEsriClone===e.originalGraphic&&(this.currentFeatureEsriClone.setGeometry(e.editedGraphic.geometry),this.currentFeatureEsriClone.show(),this._swapOriginalFeatureForClone()),this.isEditingNewFeature.get()&&this.isEditingRelatedFeature.get()&&this._activateEditingView()},x.prototype._handleLayerUpdateEnd=function(){this._swapOriginalFeatureForClone()},x.prototype._handleDeletedFeature=function(e){var t=e instanceof esri.Graphic?e:e.originalFeature;t&&t instanceof esri.Graphic?this.app.featureSetManager.updateCollectionsOnFeatureDeletion(t):this.app.trace.warning("EditorViewModel: Could not update feature set collections on feature deletion. Original feature not provided.")},x.prototype._handleEditedFeature=function(e){if(e.originalFeature&&e.editedFeature){var t=this.app.featureSetManager.findFeaturesByEsriFeature(e.editedFeature||e.originalFeature);e.editedFeature&&e.originalFeature&&e.editedFeature!==e.originalFeature&&t.concat(this.app.featureSetManager.findFeaturesByEsriFeature(e.originalFeature)),(t=d.distinct(t))&&t.length&&E.updateFeatures(t,e.editedFeature)}else this.app.trace.warning("EditorViewModel: Could not update feature set collections on feature edit. Original or edited feature not provided.")},x.prototype._swapOriginalFeatureForClone=function(){if(this.currentFeatureEsri){var e=v.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer);e&&(e.hide(),!this.isEditingGeometry.get()&&this.currentFeatureEsriClone.getLayer()&&this.currentFeatureEsriClone.show())}},x.prototype._restoreOriginalFeature=function(){if(this.currentFeatureEsri){var e=null;(e=this.currentFeatureGeocortex&&this.currentFeatureGeocortex.featureLayer&&"Table"===this.currentFeatureGeocortex.featureLayer.type?v.findFeatureInLayer(this.currentFeatureEsri,this._sourceLayer):v.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer))&&e.show()}},x.prototype.cancelEditing=function(){this.stopEditingGeometry(!0),this.geometryHasBeenEdited.set(!1),this._restoreOriginalFeature(),this._destroyEditingLayer(),this.form.get()&&this.form.get().clear(),this._sourceLayer&&this._sourceLayer.refresh(),this.isEditingGeometry.set(!1),this.isEditingLogEntry.set(!1),this.isEditingNewFeature.set(!1),this.isEditingRelatedFeature.set(!1),this.isEditingRelatedFeatureNotInSite.set(!1),this.layerUpdateEndToken&&dojo.disconnect(this.layerUpdateEndToken),this.app.behavior("EditorRemoveFeatureSelectedBehavior").run(),this.app.event("EditorClosedEvent").publish(),this._refreshEsriGraphic(this.currentFeatureEsri),this.state=w.Idle},x.prototype._canExecuteStartEditingFeature=function(e){if(!e)return!1;if(this.app.offlineManager.isOfflineMapActive.get()&&!this.canEditOffline)return!1;if(e.layer){var t=e.layer;if(t.mapService&&t.mapService.serviceLayer){if(!t.mapService.serviceLayer.isEditable)return!1;if(!t.mapService.serviceLayer.isEditable())return!1;if(this.app.offlineManager.isOfflineMapActive.get()&&!this.app.offlineManager.syncInfo.findLayerOrTable(e.layer.mapService.serviceLayer.url).canEdit)return!1}var i=e.esriFeature.get();if(i)return!!i.getLayer()||(t.mapService&&t.mapService.serviceLayer&&(i._graphicsLayer=i._layer=t.mapService.serviceLayer),!!v.findFeatureInMap(i,this.app.site))}else if(e.featureLayer)return this.app.offlineManager.isOfflineMapActive.get()?this.app.offlineManager.syncInfo.findLayerOrTable(e.featureLayer.url).canEdit:e.featureLayer.isEditable();return!1},x.prototype.handleClickEditGeometry=function(){if(this.isEditingGeometry.get()){this.stopEditingGeometry();var e=new u.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(e)}else this.startEditingGeometry(),this.app.behavior("EditorRemoveFeatureSelectedBehavior").run();return!1},x.prototype._executeStartEditingAttributesAndGeometryFeature=function(e,t){var i=this;void 0===t&&(t=!1),this._executeStartEditingFeature(e,t).then(function(e){i.canEditGeometry.get()&&i.handleClickEditGeometry()})},x.prototype._executeStartEditingFeature=function(n,s){var o=this;return void 0===s&&(s=!1),new Promise(function(t,i){var r,a=!0;o.isEditingNewFeature.set(s),o.geometryHasBeenEdited.set(!1),o.attachmentInfos.clear(),o.noAttachments.set(!1),o.hasEditableAttachments.set(!1);try{if(n&&n instanceof u.Feature){var e=n;e.layer&&e.layer.mapService&&(o.currentMapService=e.layer.mapService),e.featureLayer&&"Table"===e.featureLayer.type&&(a=!1),o.currentFeatureGeocortex=n,o.headerText.set(e.plainLabel.get()),r=e.esriFeature.get()}else r=n;o.app.map&&o.app.site&&o.app.site.isInitialized?o.isEditingNewFeature.get()?(o._executeStartEditingFeatureImpl(r,s,a),t()):o._refreshEsriGraphic(r).then(function(e){null!=e&&e.features&&0<e.features.length&&e.features[0].attributes?(r.attributes={},dojo.mixin(r.attributes,e.features[0].attributes)):o.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),o._executeStartEditingFeatureImpl(r,s,a),t()}).caught(function(e){o.app.trace.info("Error retrieving most recent version of feature for editing. Falling back to currently loaded version."),o._executeStartEditingFeatureImpl(r,s,a),i(e)}):o.app.event("SiteInitializingEvent").once(o,function(){o._executeStartEditingFeatureImpl(r,s,a),t()})}catch(e){o.app.trace.error("Could not start editing: {0}".format(e)),o.cancelEditing(),i(e)}})},x.prototype._refreshEsriGraphic=function(e,i){var t,r=this;if(!(i=i||e.getLayer()))return Promise.resolve();t=this._getMapServiceByLayer(i);var a=e[b.HIGHLIGHT_ID_PROPERTY],n=i.objectIdField;!n&&t&&t.serviceLayer instanceof esri.layers.FeatureLayer&&(n=t.serviceLayer.objectIdField);var s=new esri.tasks.Query;s.objectIds=[e.attributes[n]],s.returnGeometry=!0,s.outFields=["*"],s.outSpatialReference=this.app.map.spatialReference;var o=p.getQueryTask(i,t);return new Promise(function(t,e){o.execute(s,function(e){e&&e.features&&e.features.length&&(e.features[0]._layer=i,!r.app.highlightManager.updateHighlightId(e.features[0],a)&&r.currentFeatureEsriClone&&r.app.highlightManager.updateHighlightId(e.features[0],r.currentFeatureEsriClone[b.HIGHLIGHT_ID_PROPERTY])),t(e)},e)})},x.prototype._executeStartEditingFeatureImpl=function(e,t,i){void 0===t&&(t=!1),this.state!==w.Idle&&(this.cancelEditing(),this.isEditingNewFeature.set(t));var r=null,a=t?e:v.findFeatureInMap(e,this.app.site);if(this.originalFeatureClone=this._cloneEsriFeature(a),r=t?this._sourceLayer:a.getLayer()){if(!i)return this.canEditGeometry.set(!1),void this._editAsTable(e);if(r instanceof esri.layers.GraphicsLayer&&!(r instanceof esri.layers.FeatureLayer)){var n=r;if(n.id){var s=n.id.replace("-explodedClusterLayer",""),o=this.app.map.getLayer(s);o instanceof esri.layers.FeatureLayer&&(r=o)}n.renderer&&e.setSymbol(n.renderer.getSymbol(e))}t&&(r.objectIdField&&(e.attributes[r.objectIdField]=0),r.globalIdField&&(e.attributes[r.globalIdField]="")),this._sourceLayer=r,this._calculateCanDeleteFeature(),this.layerUpdateEndToken=dojo.connect(r,"onUpdateEnd",dojo.hitch(this,this._handleLayerUpdateEnd)),this.state=w.EditingAttributes,this.isEditingRelatedFeatureNotInSite.set(!1),this.canEditGeometry.set(this.configAllowsEditGeometry&&!!r.geometryType&&r.allowGeometryUpdates),this.showStopEditingGeometryButton.set(!1),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.currentFeatureEsri=a,this.currentFeatureEsriClone=this._cloneEsriFeature(a),a.hasOwnProperty("_drawType")&&(this.currentFeatureEsriClone._drawType=a._drawType),this._createEditingLayer(),this._editingLayer.add(this.currentFeatureEsriClone);var l,u={textareaThreshold:this.textareaThreshold,doNotAdjustTime:this.doNotAdjustTime};if(this.currentFeatureGeocortex&&this.currentFeatureGeocortex.layer)l=this.currentFeatureGeocortex.layer;else for(var d=0,c=this.app.site.getFeatureServices();d<c.length;d++){var p=c[d];if(p.serviceLayer===r){l=p.layers[0];break}}if(l){var h=[];l.fields.forEach(function(e){h.push(e.name)}),u.fieldOrder=h}if(this.form.set(new y.EditingFormViewModel(this.app,this.libraryId,e,r,u)),this.app.event("Internal.EditorFormSetupEvent").publish(this.form,a),null!=this._sourceLayer.typeIdField)for(var g=this.form.get(),m=0;m<g.fields.getLength();m++){var f=g.fields.getAt(m);if(f.name.get()===this._sourceLayer.typeIdField){this.handleTypeFieldSelected(f);break}}try{this._buildFeatureRelationships()}catch(e){this.app.trace.warning("Could not set up related records for editing.")}this._initializeAttachmentForm(),this.isBusy.set(!1),this.busyText.set(""),t||this._activateEditingView()}else this.app.trace.error("Error - could not find layer for feature.")},x.prototype._initializeAttachmentForm=function(){var t=this;if(this.attachmentsToAdd.clear(),this.attachmentsToRemove.clear(),this.hasEditableAttachments.set(this._sourceLayer.hasAttachments),this.hasEditableAttachments.get()&&this.currentFeatureGeocortex){var i=function(){t._setAttachmentInfos(t.currentFeatureGeocortex.attachmentInfos),0===t.attachmentInfos.length()&&(t.isOffline.set(t.app.isOffline.get()),t.noAttachments.set(!t.app.isOffline.get())),t.isAttachmentInfosInitialized.set(!0)};if(this.currentFeatureGeocortex.attachmentInfosInitialized.get())i();else{var r=this.currentFeatureGeocortex.attachmentInfosInitialized.bind(this,function(e){i(),t.currentFeatureGeocortex.attachmentInfosInitialized.unbind(r)});this.currentFeatureGeocortex.attachmentInfos.get()}}else this.isOffline.set(this.app.isOffline.get()),this.noAttachments.set(!this.app.isOffline.get()),this.isAttachmentInfosInitialized.set(!0)},x.prototype._setAttachmentInfos=function(e){if(this.attachmentInfos.clear(),e)for(var t=e.getLength(),i=0;i<t;i++){var r=e.getAt(i),a=this.app.nativeManager.isNative()?null:"_blank";this.attachmentInfos.addItem({name:r.name,url:r.url,canEditAttachments:!0,size:s.formatBytes(r.size.get()),attachmentId:r.id.get(),target:a})}},x.prototype._canExecuteStartEditingNewFeature=function(e){return!(this.app.offlineManager.isOfflineMapActive.get()&&!this.canEditOffline)},x.prototype._editAsTable=function(o){for(var l=this,e=this.app.site.getFeatureServices(),u=null,d=null,t=function(s){s.serviceLayer.relationships.forEach(function(e){var t=l.currentFeatureGeocortex.featureLayer;if(e.relatedTableId!==t.layerId);else{l._sourceLayer=t,d=t,u=e;var i=null,r=null,a=l.app.site&&l.app.site.essentialsMap?l.app.site.essentialsMap.findLayerFromMatchingEsriFeatureLayer(d):null;r=a?(i=c.getTimeZoneFromLayer(a),c.getDisplayTimeZoneFromMapService(a.mapService)):(i=c.getTimeZoneFromMapService(s),c.getDisplayTimeZoneFromMapService(s)),l._initializeAttachmentForm();var n={id:d.layerId,text:"Editing "+o.attributes.OBJECTID,relatedFeature:null,essentialsRelatedFeature:null,feature:o,editable:d.isEditable(),relationship:u,timeZoneId:i,displayTimeZoneId:r};l._executeStartEditingRelatedRecord(n,!1)}})},i=0,r=e;i<r.length;i++)t(r[i])},x.prototype._executeStartEditingNewFeature=function(e,t,i){void 0===i&&(i=!0),this.currentFeatureEsri=e,this._sourceLayer=t,this._calculateCanDeleteFeature(),this.currentFeatureGeocortex=null;var r=this.app.getResource(this.libraryId,"language-common-feature-editing");this.headerText.set(r),this._executeStartEditingFeature(e,!0),i?t.geometryType&&t.allowGeometryUpdates?this.startEditingGeometry():this._activateEditingView():(this._activateEditingView(),this.currentFeatureEsriClone.show())},x.prototype._canExecuteStartEditingEditLogEntry=function(e){return!0},x.prototype._executeStartEditingEditLogEntry=function(e){return!0},x.prototype.handleTypeFieldSelected=function(e){if(e){var t=e.value.get();if(null!=t)for(var i=0;i<e.valueOptions.getLength();i++){var r=e.valueOptions.getAt(i);if(null!=r.id&&r.id.toString()===t.toString()){this._loadCodedDomainsForType(r.domains);break}}}},x.prototype._loadCodedDomainsForType=function(e){if(e){var t=this.form.get();for(var i in e)if(e.hasOwnProperty(i)&&e[i].type)for(var r=0;r<t.fields.getLength();r++){var a=t.fields.getAt(r),n=!0;if(a.name.get()===i){var s=[];if("inherited"!==e[i].type)s=e[i].codedValues;else{for(var o=0,l=this._sourceLayer.fields;o<l.length;o++){var u=l[o];if(u.name===a.name.get()){var d=u.domain;if(d){d.codedValues?s=d.codedValues:n=!1;break}}}if(!n)continue}var c={viewModel:a,typeName:"codedDomainValue",collectionName:"codedDomainValues",valueCollection:s,nullable:a.nullable.get(),nullOption:{name:"",code:null}};this._addValueCollection(c),a.value.pulse()}}}},x.prototype._addValueCollection=function(t){if(t){var e=t.viewModel.valueOptions;(e=e||(t.viewModel.valueOptions=new n.ObservableCollection([]))).clear(),e.addItems(t.valueCollection),t.nullable&&e.insertItem(0,t.nullOption);var i=function(e){return null==e?"":e.toString()},r=i(t.viewModel.value.get());if(!e.get().some(function(e){return i(e.code)===r})){var a=e.get().filter(function(e){return e!==t.nullOption})[0];t.viewModel.value.set(a?a.code:t.nullOption.code)}}},x.prototype._activateEditingView=function(){var e=this;this.app.command("HideFeatureTemplatePicker").execute(),this.app.command("ActivateView").execute("EditorView");var t=new u.Feature({graphic:this.currentFeatureEsriClone});setTimeout(function(){return e.app.behavior("EditorFeatureSelectedBehavior").run(t)},300)},x.prototype._getEditingToolMessage=function(e){var t=Modernizr&&!!Modernizr.touch;switch(e){case esri.toolbars.Draw.POINT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-point");case esri.toolbars.Draw.MULTI_POINT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-multi-point");case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYLINE:return t?this.app.getResource(this.libraryId,"language-feature-editing-geometry-polyline-touch"):this.app.getResource(this.libraryId,"language-feature-editing-geometry-polyline");case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.FREEHAND_POLYGON:return t?this.app.getResource(this.libraryId,"language-feature-editing-geometry-polygon-touch"):this.app.getResource(this.libraryId,"language-feature-editing-geometry-polygon");case esri.toolbars.Draw.EXTENT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-rectangle")}return this.app.getResource(this.libraryId,"language-feature-editing-geometry-default")},x.prototype.findGeocortexLayerForUrl=function(e){for(var t=0,i=this.app.site.essentialsMap.mapServices;t<i.length;t++){var r=i[t];if(r.serviceUrl===e&&0<r.layers.length)return r.layers[0]}return null},x.prototype._findServiceLayerForUrl=function(e){for(var t=0,i=this.app.site.essentialsMap.mapServices;t<i.length;t++){var r=i[t];if(r.url===e)return r.serviceLayer}return null},x.prototype._hideOrShowRelateds=function(){this.showRelatedLayers.set(this.hasRelatedLayers.get()&&!this.isEditingRelatedFeatureNotInSite.get()&&!this.isEditingNewFeature.get())},x.prototype._calculateCanDeleteFeature=function(){this.canDeleteFeature.set(!this.isEditingNewFeature.get()&&this._sourceLayer&&/Delete/.test(this._sourceLayer.capabilities))},x.prototype.editingInProgress=function(){return!!this._editingLayer},x);function x(e,t){var i=I.call(this,e,t)||this;return i.state=w.Idle,i.isBusy=new n.Observable(!1),i.title=new n.Observable(""),i.headerText=new n.Observable(""),i.busyText=new n.Observable(""),i.form=new n.Observable,i.isEditingGeometry=new n.Observable(!1),i.isEditingNewFeature=new n.Observable(!1),i.isEditingLogEntry=new n.Observable(!1),i.isEditingRelatedFeature=new n.Observable(!1),i.isEditingRelatedFeatureNotInSite=new n.Observable(!1),i.isUploadingAttachment=new n.Observable(!1),i.currentFeatureRelationships=new n.ObservableCollection,i.hasRelatedLayers=new n.Observable(!1),i.hasEditableAttachments=new n.Observable(!1),i.attachmentInfos=new n.ObservableCollection,i.attachmentsToAdd=new n.ObservableCollection,i.attachmentsToRemove=new n.ObservableCollection,i.isAttachmentInfosInitialized=new n.Observable(!1),i.noAttachments=new n.Observable(!1),i.isOffline=new n.Observable(!1),i.browserFileAPISupported=new n.Observable(!1),i.showRelatedLayers=new n.Observable(!1),i.canDeleteFeature=new n.Observable(!0),i.canEditGeometry=new n.Observable(!1),i.showEditGeometryButton=new n.Observable(!1),i.showStopEditingGeometryButton=new n.Observable(!1),i.geometryHasBeenEdited=new n.Observable(!1),i.validateGeometry=!1,i.configAllowsEditGeometry=!0,i.layerUpdateEndToken=null,i.textareaThreshold=80,i.canEditOffline=!1,i.doNotAdjustTime=!1,i._registerCommands(),i._subscribeToEvents(),i.isEditingNewFeature.bind(i,i._calculateCanDeleteFeature),i.auto(i.hasRelatedLayers,i,i._hideOrShowRelateds),i.auto(i.isEditingRelatedFeatureNotInSite,i,i._hideOrShowRelateds),i.browserFileAPISupported.set(F.isFileApiSupported()),i.applyingEditText=i.app.getResource(i.libraryId,"language-feature-editing-applying"),i.uploadingAttachmentText=i.app.getResource(i.libraryId,"language-feature-editing-upload-attachment"),i.deletingAttachmentText=i.app.getResource(i.libraryId,"language-feature-editing-delete-attachment"),i}t.EditorViewModel=T})},"Mapping/modules/Editing/MultiFeatureSelector/MultiFeatureSelectorViewModel":function(){var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/ui/components/FeatureSelector/FeatureSelectorViewModel"],function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SELECTOR_BUTTON_VALUE={OK:"ok",CANCEL:"cancel",DONE:"done"};var n,t=(n=a.FeatureSelectorViewModel,s(i,n),i.prototype.initialize=function(e){var t=e.displayResultPickerTemplateComplexity;t!==a.FEATURE_SELECTOR_TEMPLATE_TYPE.SIMPLE&&t!==a.FEATURE_SELECTOR_TEMPLATE_TYPE.COMPLEX||(this.complexity=t)},i.prototype.registerCommands=function(){var r=this;this.app.command("ShowFeatureSelector").register(this,this.showFeatureSelector),this.app.command("HideFeatureSelector").register(this,this.hideFeatureSelector),this.app.command("HideMultiFeatureSelectorView").register(this,this.hideFeatureSelector),this.app.command("ShowSelectionListOfFeaturesWithCallback").register(this,function(e,t){var i={featureSet:e,callback:t,viewTitle:r.app.getResource(r.libraryId,"language-feature-editing-multi-feature-selector"),viewMessage:r.app.getResource(r.libraryId,"language-feature-editing-multi-feature-selector-message"),errorMessage:r.app.getResource(r.libraryId,"language-feature-editing-multi-feature-selector-error-message"),buttons:[r.standardButton],selectionMode:a.FEATURE_SELECTOR_MODE.SINGLE,simpleResultTemplate:r.complexity===a.FEATURE_SELECTOR_TEMPLATE_TYPE.SIMPLE,showFilterTextBox:!1};r.showFeatureSelector(i)})},i);function i(e,t){var i=n.call(this,e,t)||this;return i.complexity=a.FEATURE_SELECTOR_TEMPLATE_TYPE.COMPLEX,i.standardButton=null,i.standardButton={label:i.app.getResource(i.libraryId,"language-common-done"),value:r.SELECTOR_BUTTON_VALUE.DONE,causesValidation:!0,isDefault:!0},i.registerCommands(),i}r.MultiFeatureSelectorViewModel=t})},"Mapping/modules/Editing/TemplatePicker/FeatureTemplateViewModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function r(){this.name=new i.Observable(""),this.description=new i.Observable,this.proto={},this.drawingTool=new i.Observable,this.symbolUri=new i.Observable,this.symbolStyle=new i.Observable(""),this.swatchElement=null}t.FeatureTemplate=r})},"Mapping/modules/Editing/TemplatePicker/TemplateFeatureLayerModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/TemplatePicker/TemplatePickerView":function(){var r,s=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/utils/utils","geocortex/infrastructure/LayerIntegrationUtils"],function(e,t,i,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=(r=i.ViewBase,s(n,r),n.prototype._onShowFeatureTemplatePicker=function(e,t){var i=l.getGeocortexLayer(e,this.app);if(this.app.command("_CancelEditing").execute(),this.app.command("ActivateView").execute(this.id),this.viewModel){if(this.app.command("Internal.CancelEditingIfNotIdle").execute(),!i&&!t)return void this.viewModel.loadLayerTemplates();this.viewModel.filteredLayers&&(this.viewModel.filteredLayers.length=0,this.viewModel.filteredLayers=null),this._loadTemplate(i,t)}},n.prototype._canShowFeatureTemplatePicker=function(e,t){if(this.viewModel&&this.app.isOffline.get()&&!this.viewModel.canEditOffline)return!1;if(!e&&!t||!e&&t)return!0;var i=l.getGeocortexLayer(e,this.app);if(!i)return!1;var r=o.getProp(i,["mapService","serviceLayer"]);if(!r)return!1;if(r.templates)return!(!r.isEditable||!/Create/.test(r.capabilities))&&r.isEditable();if(r.types){for(var a=0,n=r.types;a<n.length;a++){var s=n[a];if(s.templates&&0<s.templates.length)return!0}return!1}return!1},n.prototype._loadTemplate=function(e,t){e?this.viewModel.loadTemplatesForCurrentLayer(e,t):this.viewModel.loadLayerTemplates(t)},n.prototype.handleFeatureTemplateClick=function(e,t,i){var r,a=this;if(this.app.command("Internal.CancelEditingIfNotIdle").execute(),i.proto&&i.proto.toJson&&!i.relatedFeature)r=new esri.Graphic(i.proto.toJson());else if(i.relatedFeature){if(i.proto&&i.proto.toJson)for(var n in r=i.relatedFeature,i.proto.attributes)if(i.proto.attributes.hasOwnProperty(n)){var s=i.proto.attributes[n];null!=s&&(r.attributes[n]=s)}}else r=new esri.Graphic(null),i.proto&&i.proto.attributes&&(r.attributes=i.proto.attributes);var o=null;if(i.drawingTool&&i.drawingTool.get())switch(i.drawingTool.get()){case"esriFeatureEditToolPoint":o="MapPoint";break;case"esriFeatureEditToolLine":o="Polyline";break;case"esriFeatureEditToolFreehand":"esriGeometryPolyline"===i.layer.geometryType?o="FreehandPolyline":"esriGeometryPolygon"===i.layer.geometryType&&(o="FreehandPolygon");break;case"esriFeatureEditToolAutoCompletePolygon":case"esriFeatureEditToolPolygon":o="Polygon";break;case"esriFeatureEditToolEllipse":o="Ellipse";break;case"esriFeatureEditToolCircle":o="Circle";break;case"esriFeatureEditToolRectangle":o="Rectangle"}if(!o)switch(i.layer.geometryType){case"esriGeometryPoint":o="MapPoint";break;default:o=i.layer.geometryType.replace("esriGeometry","")}r._drawType=o,this.app.configuration.mobileMode?(this.app.command("DisableMapClick").execute(),this.app.command("ShowMap").execute(),this.app.command("CloseDataFrame").execute(),this.app.event("DataFrameClosedEvent").once(this,function(){setTimeout(function(){a.app.command("EnableMapClick").execute(),a.app.event("StartFeaturePlacementEvent").publish(),a.app.command("StartEditingNewFeature").execute(r,i.layer)},225)})):(this.app.command("ShowMap").execute(),this.app.event("StartFeaturePlacementEvent").publish(),this.app.command("StartEditingNewFeature").execute(r,i.layer))},n);function n(e,t){var i=r.call(this,e,t)||this;return i.app.command("ShowFeatureTemplatePicker").register(i,i._onShowFeatureTemplatePicker,i._canShowFeatureTemplatePicker),i.app.command("HideFeatureTemplatePicker").register(i,function(){i.isActive&&i.app.viewManager.deactivateView(i)}),i}t.TemplatePickerView=a})},"Mapping/modules/Editing/TemplatePicker/TemplatePickerViewModel":function(){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./FeatureTemplateViewModel","geocortex/framework-ui/FilterableCollection","geocortex/framework/utils/utils"],function(e,t,i,l,h,r,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=(a=i.ViewModelBase,o(s,a),s.prototype.initialize=function(e){var t=this;this.app.waitUntilSiteServiceLayersLoaded().then(function(){t.loadLayerTemplates()}),this.app.nativeManager.hasNativeCapability("editing").then(function(e){t.canEditOffline=e})},s.prototype._layerIsValidForEditing=function(e){if(!e)return!1;if(e.serviceLayer&&e.serviceLayer.capabilities&&10.1<=e.serviceLayer.version&&!/create/.test(e.serviceLayer.capabilities.toLowerCase()))return!1;var t=!0;if(this.filteredLayers){t=!1;for(var i=0,r=this.filteredLayers;i<r.length;i++)if(r[i]===e.id){t=!0;break}}return t},s.prototype.loadTemplatesForCurrentLayer=function(e,t){if(e&&e.mapService){this._layerTemplates.clear();var i=this._getFeatureLayerModel(e.mapService,t);i&&this._layerTemplates.addItem(i)}},s.prototype.loadLayerTemplates=function(e){var r=this,t=this.app.site;if(t&&t.essentialsMap&&t.isInitialized){var i=t.getFeatureServices();this._layerTemplates.clear();for(var a=[],n=0,s=i;n<s.length;n++){var o=s[n],l=this._getFeatureLayerModel(o,e);l&&!l.notAvailableReason.get()&&a.push(l)}this._layerTemplates.addItems(a),this.layerTemplates.setSource(this._layerTemplates),this.layerTemplates.setFilter(function(e){var t=r.app.site.essentialsMap.findLayerFromMatchingEsriFeatureLayer(e.layer),i=r.app.site.essentialsMap.layerThemesInfo.activeTheme;return!(i&&t&&!u.isNullOrUndefined(i.id)&&!t.isUserCreated&&!t.getLayerThemeSettings(r.app.site.essentialsMap.layerThemesInfo.activeTheme))}),this.app.event("LayerThemeChangedEvent").subscribe(this,function(){return r.layerTemplates.refresh()}),this.app.event("MapServiceAddedEvent").subscribe(this,function(){return r.layerTemplates.refresh()})}},s.prototype._getFeatureLayerModel=function(e,t){var i=e.serviceLayer;if(!this._layerIsValidForEditing(e))return null;var r=null;if(this.app.offlineManager.isOfflineMapActive.get()){var a=this.app.offlineManager.syncInfo.findLayerOrTable(i.url);a&&a.canEdit||(this.app.trace.warning("Layer "+i.url+" not available offline. Make sure the layer is included in your offline map if you want to edit it offline."),r=this.getResource("language-feature-editing-not-available-offline"))}i.isEditable&&i.isEditable()||(r=this.getResource("language-feature-editing-not-editable"));var n=e.displayName;e&&e.layers&&0<e.layers.length&&(n=e.layers[0].displayName);var s=new l.ObservableCollection;if(!r){var o=this._loadFeatureTemplates(e.serviceLayer,t);o&&0<o.length&&s.addItems(o)}return{displayName:new l.Observable(n),mapServiceId:new l.Observable(e.id),layer:e.serviceLayer,templates:s,proto:null,notAvailableReason:new l.Observable(r)}},s.prototype.createTemplate=function(t,e,i){var r=new h.FeatureTemplate,a=null;if(!t.renderer){var n=this.app.map.graphicsLayerIds.filter(function(e){return e===t.id+"-cluster"});0<n.length&&(a=this.app.map.getLayer(n[0]))}if(e){var s=e.name;if(r.name.set(s),r.description.set(e.description),r.drawingTool.set(e.drawingTool),r.proto=e.prototype,i&&i.attributes&&(r.relatedFeature=i),t.renderer||a){var o=t.renderer||a.featureLayerRenderer;if(o instanceof esri.renderer.HeatmapRenderer){var l=this.app.site.essentialsMap.mapServices.filter(function(e){return e.serviceLayer.id===t.id})[0];l.heatMap&&l.heatMap.defaultRenderer&&(o=l.heatMap.defaultRenderer)}var u=this._getTemplateSymbol(e,o);if(!u)return null;switch(u.type){case"picturemarkersymbol":r.symbolUri.set(u.url),r.swatchElement=null;break;case"simplelinesymbol":var d=u.color?String.escapeHtml(u.color.toCss()):"rgba(0, 0, 0, 0)";r.swatchElement="<div class='simple-swatch line' style='color: "+d+"'></div>";break;case"simplefillsymbol":var c=u.color?String.escapeHtml(u.color.toCss()):"rgba(0, 0, 0, 0)";r.swatchElement="<div class='simple-swatch square' style='background-color: "+c+"'></div>";break;default:var p=u.color?String.escapeHtml(u.color.toCss()):"rgba(0, 0, 0, 0)";r.swatchElement="<div class='simple-swatch square' style='background-color: "+p+"'></div>"}}}return r.layer=t,r},s.prototype._consumeTemplate=function(e,t,i){return this.createTemplate(e,t,i)},s.prototype._getTemplateSymbol=function(e,t){var i=new esri.Graphic(null);return i.attributes={},e.prototype.attributes&&dojo.mixin(i.attributes,e.prototype.attributes),t.getSymbol(i)||t.defaultSymbol},s.prototype._loadFeatureTemplates=function(e,t){if(!e||!e.templates)return null;var i=[];if(0<e.templates.length)for(var r=0,a=e.templates;r<a.length;r++){var n=a[r];i.push(this._consumeTemplate(e,n,t))}else if(e.types&&0<e.types.length)for(var s=0,o=e.types;s<o.length;s++){var l=o[s];if(l.templates)for(var u=0,d=l.templates;u<d.length;u++)n=d[u],i.push(this._consumeTemplate(e,n,t))}return i},s);function s(){var e=null!==a&&a.apply(this,arguments)||this;return e.layerTemplates=new r.FilterableCollection,e.canEditOffline=!1,e._layerTemplates=new l.ObservableCollection,e}t.TemplatePickerViewModel=n})},"Mapping/modules/Editing/Undoable/Add":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)})})},r.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)})})},r);function r(e,t){if(void 0===t&&(t={}),!t.graphicsLayer)throw new Error("Add Operation: Initialization failed. Graphics layer is not provided.");if(!t.addedGraphics)throw new Error("Add Operation: Initialization failed. Added graphics are not provided.");this.state=t,this.displayName=e}t.Add=i})},"Mapping/modules/Editing/Undoable/AddAndUpdate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},r.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},r);function r(e,t){var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Add/Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.addedGraphics)throw new Error("Add/Update Operation: Initialization failed. Added graphics are not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Add/Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}t.AddAndUpdate=i})},"Mapping/modules/Editing/Undoable/AddAndUpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/AddState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/Delete":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)})})},r.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)})})},r);function r(e,t){if(void 0===t&&(t={}),!t.graphicsLayer)throw new Error("Delete Operation: Initialization failed. Graphics layer is not provided.");if(!t.deletedGraphics)throw new Error("Delete Operation: Initialization failed. Deleted graphics are not provided.");this.state=t,this.displayName=e}t.Delete=i})},"Mapping/modules/Editing/Undoable/DeleteAndUpdate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},r.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},r);function r(e,t){var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Delete/Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.deletedGraphics)throw new Error("Delete/Update Operation: Initialization failed. Deleted graphics are not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Delete/Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}t.DeleteAndUpdate=i})},"Mapping/modules/Editing/Undoable/DeleteAndUpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/DeleteState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/Update":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(r.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},r.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},r);function r(e,t){var i=this;if(void 0===t&&(t={}),this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}t.Update=i})},"Mapping/modules/Editing/Undoable/UpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/EditingFormButton":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/EditingFormField":function(){define(["require","exports","geocortex/framework/observables","geocortex/essentials/Field"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(n.prototype.showFormattedValue=function(){this._isSettingPresentableValue=!0,this.presentableValue.set(this.formatFunc(this.value.get())),this._isSettingPresentableValue=!1},n.prototype.showActualValue=function(){this._isSettingPresentableValue=!0,this.presentableValue.set(this.value.get()),this._isSettingPresentableValue=!1},n);function n(){var t=this;this.type=r.EsriFieldTypes.esriFieldTypeString,this._isSettingPresentableValue=!1,this._isSettingValue=!1,this.name=new i.Observable,this.displayName=new i.Observable,this.editable=new i.Observable(!0),this.readOnly=new i.Observable(!1),this.required=new i.Observable(!1),this.nullable=new i.Observable(!1),this.cssClass=new i.Observable,this.showIndicator=new i.Observable(!1),this.value=new i.Observable(null),this.presentableValue=new i.Observable,this.formatFunc=function(e){return null==e?"":e.toString()},this.value.bind(this,function(e){t._isSettingValue||(t._isSettingPresentableValue=!0,t.presentableValue.set(t.formatFunc(t.value.get())),t._isSettingPresentableValue=!1)}),this.presentableValue.bind(this,function(e){t._isSettingPresentableValue||(t._isSettingValue=!0,t.value.set(e),t._isSettingValue=!1)})}t.EditingFormField=a})},"Mapping/modules/Editing/Editor/Form/EditingFormViewModel":function(){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./EditingFormField","geocortex/infrastructure/gis/FieldInfo","geocortex/forms/items/DatePickerFormItem","geocortex/forms/items/TimePickerFormItem","geocortex/infrastructure/FormatUtils","geocortex/essentials/utilities/TimeZoneUtils","geocortex/infrastructure/validation/ValidationFunctionFactory","geocortex/essentials/Field"],function(e,t,i,o,A,L,M,R,O,k,D,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,r=(l=i.ViewModelBase,n(a,l),a.prototype.addValidationMessage=function(e){this.validationMessages.addItem(e)},a.prototype.clearValidationMessages=function(){this.validationMessages.clear()},a.prototype._fieldHasSubTypeDomainValues=function(e,t){for(var i=0,r=t.types;i<r.length;i++){var a=r[i];if(a.domains&&e.name in a.domains)return!0}return!1},a.prototype.setup=function(F,w,e){var C=this;this.clear();var I=[];if(!w)throw new Error("Attempted to edit a feature with no layer attached!");for(var T=null,t=this.app.site.getFeatureServices(),x=null,i=0,r=t;i<r.length;i++){var a=r[i];if(a.serviceLayer===w){x=a.layers[0];break}}var n=[],s=w._outFields;if(s&&0<s.length)for(var o=0;o<s.length;++o){var l=s[o];if(0===o&&"*"===l){n=w.fields;break}for(var u=0,d=w.fields;u<d.length;u++){var c=d[u];if(c.name===l){n.push(c);break}}}else n=w.fields;if(e){var p=n.slice(),h=[];e.forEach(function(e){for(var t=p.length-1;-1<t;--t){var i=p[t];i.name===e&&(h.push(i),p.splice(t,1))}}),h.concat(p),n=h}for(var S=function(e,t){for(var i=0,r=t;i<r.length;i++){var a=r[i].prototype.attributes;if(e.name&&a.hasOwnProperty(e.name))return e.nullable=null===a[e.name],!0}return!1},g=function(e){if(!e)return"continue";if(!e.editable)return"continue";var t=function(e){if(!x)return null;for(var t=0,i=x.fields;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null}(e.name);if(t&&!t.visible)return"continue";var i=L.FieldInfo.fromEsriField(e,w,t);if(void 0===e.nullable||null===e.nullable)if(w&&w.templates&&w.templates.length)S(e,w.templates);else if(w&&w.types&&w.types.length)for(var r=0,a=w.types;r<a.length&&!((b=a[r]).templates&&b.templates.length&&S(e,b.templates));r++);var n=!0===e.nullable,s=!!t&&!t.editable,o=0==n&&!s,l=null;G.featureIsNew.get()&&e.name!==w.typeIdField||F.attributes&&(l=F.attributes[e.name]);var u,d,c=new A.EditingFormField;if(c.name.set(e.name),c.readOnly.set(s),c.nullable.set(n),c.required.set(o),c.showIndicator.set(c.required.get()),c.type=e.type,c.renderType=e.type,!(u=i).timeZoneId&&C.fallbackTimeZoneId&&(u.timeZoneId=C.fallbackTimeZoneId),!u.displayTimeZoneId&&C.fallbackDisplayTimeZoneId&&(u.displayTimeZoneId=C.fallbackDisplayTimeZoneId),c.formatFunc=function(e){return u.formatValue(e)},c.value.set(l),c.length=e.length,c.editable.set(e.editable),t?c.displayName.set(t.displayName):c.displayName.set(null!=e.alias?e.alias:e.name),"esriFieldTypeDate"===e.type){var p=new M.DatePickerFormItem(null,null);p.timePickerItem=new R.TimePickerFormItem(null,null);var h=void 0;if(h=F&&F.attributes[e.name]?(h=O.parseDate(F.attributes[e.name]),i.displayTimeZoneId?k.correctDatesForDisplayInDisplayTimeZone(h,i.timeZoneId,i.displayTimeZoneId):k.correctDatesForDisplayInLocalTime(h,i.timeZoneId)):c.nullable.get()?null:new Date,p.includeTimePicker.set(!0),p.initialDate.set(h),p.date.set(h),p.isRequired.set(c.required.get()),p.nullable.set(c.nullable.get()),p.readOnly.set(c.readOnly.get()),i.format){var g=i.format.match(/\{0:([^}]*)\}/);g&&2===g.length&&p.dateFormat.set(g[1])}d=c,p.date.bind(C,function(e){C.doNotAdjustTime||(e=k.correctDatesToSubmitInDatabaseTime(e,i.timeZoneId,i.displayTimeZoneId)),d.value.set(e)}),c.datePickerViewModel=p}else if(e.name===w.typeIdField){var m={valueCollection:w.types,nullable:!o,nullOption:{name:"",code:null}};c.renderType="typeField",G._applyFieldConfiguration(m,c),T=l}else if(i.isCodedValueDomain()||i.hasSubtypeCodedValueDomains()){var f=e.domain;if(f)c.domain=f;else for(var y=0,v=w.types;y<v.length;y++){var b;if((b=v[y]).domains&&e.name in b.domains){c.domain=b.domains[e.name];break}}if("codedValue"===c.domain.type){var E={valueCollection:c.domain.codedValues,nullable:!o,nullOption:{name:"",code:null}};c.renderType="codedDomainValue",G._applyFieldConfiguration(E,c)}}else c.type!==U.EsriFieldTypes.esriFieldTypeDouble&&c.type!==U.EsriFieldTypes.esriFieldTypeInteger&&c.type!==U.EsriFieldTypes.esriFieldTypeOID&&c.type!==U.EsriFieldTypes.esriFieldTypeSingle&&c.type!==U.EsriFieldTypes.esriFieldTypeSmallInteger||c.value.set(O.formatNumber(O.parseNumber(l),"#.####################")),c.type===U.EsriFieldTypes.esriFieldTypeString&&c.length>G.textareaThreshold?c.renderType="textArea":c.renderType=G._getRenderTypeForField(c);if(G.app.urlParameters.hasOwnProperty("noval"))c.validationFunc=function(){return null};else{var _={displayName:c.displayName.get(),type:c.type,domain:c.domain,length:c.length,required:c.required.get(),editable:c.editable.get(),nullable:c.nullable.get()};c.validationFunc=D.ValidationFunctionFactory.createValidationFunction(G.app,_)}I.push(c)},G=this,m=0,f=n;m<f.length;m++)g(f[m]);if(this.fields.addItems(I),null!==T)for(var y=0,v=w.types;y<v.length;y++){var b=v[y];null!==b.id&&b.id.toString()===T.toString()&&this._applyCodedDomains(b.domains)}},a.prototype.getRawFieldValue=function(e){for(var t=0;t<this.fields.getLength();++t){var i=this.fields.getAt(t);if(i.name.get()===e)return i.value.get()}return null},a.prototype.getAttributeValues=function(){for(var a={},e=function(e){var t=n.fields.getAt(e),i=t.value.get(),r=null;t.type===U.EsriFieldTypes.esriFieldTypeDate?(i=t.value.get(),r=null===i?null:O.parseDate(i).getTime()):t.type===U.EsriFieldTypes.esriFieldTypeDouble||t.type===U.EsriFieldTypes.esriFieldTypeInteger||t.type===U.EsriFieldTypes.esriFieldTypeOID||t.type===U.EsriFieldTypes.esriFieldTypeSingle||t.type===U.EsriFieldTypes.esriFieldTypeSmallInteger?(r=O.parseNumber(i),isNaN(r)&&(r=null)):r=i,t.domain&&"codedValue"===t.domain.type&&!t.valueOptions.get().some(function(e){return e.code===r})?r=t.valueOptions.getAt(0).code:""===i&&t.type!==U.EsriFieldTypes.esriFieldTypeString&&(r=null),a[t.name.get()]=r},n=this,t=0;t<this.fields.getLength();++t)e(t);return a},a.prototype._getRenderTypeForField=function(e){return"text"},a.prototype._applyCodedDomains=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&"codedValue"===e[t].type)for(var i=0;i<this.fields.getLength();i++){var r=this.fields.getAt(i);if(r.name.get()===t){var a={valueCollection:e[t].codedValues,nullable:r.nullable.get(),nullOption:{name:"",code:null}};r.renderType="codedDomainValue",this._applyFieldConfiguration(a,r);break}}},a.prototype._applyFieldConfiguration=function(e,t){t.valueOptions?t.valueOptions.clear():t.valueOptions=new o.ObservableCollection([]),t.valueOptions.addItems(e.valueCollection),e.nullable&&t.valueOptions.insertItem(0,e.nullOption);for(var i=0;i<t.valueOptions.getLength();++i){var r=t.valueOptions.getAt(i);void 0===r.code&&r.hasOwnProperty("id")&&(r.code=r.id)}},a.prototype.clear=function(){this.fields.clear(),this.clearValidationMessages()},a);function a(e,t,i,r,a){var n=l.call(this,e,t)||this;n.textareaThreshold=80,n.doNotAdjustTime=!1,n.id="EditingFormViewModel",n.fields=new o.ObservableCollection,n.validationMessages=new o.ObservableCollection,n.buttons=new o.ObservableCollection,n.currentFeature=new o.Observable,n.featureIsNew=new o.Observable(!1);var s=null;return a&&(a.textareaThreshold&&(n.textareaThreshold=a.textareaThreshold),a.fieldOrder&&(s=a.fieldOrder),a.doNotAdjustTime&&(n.doNotAdjustTime=a.doNotAdjustTime),a.timeZoneId&&(n.fallbackTimeZoneId=a.timeZoneId),a.displayTimeZoneId&&(n.fallbackDisplayTimeZoneId=a.displayTimeZoneId)),i&&n.setup(i,r||null,s),n}t.EditingFormViewModel=r})},"url:/Mapping/modules/Editing/CreateOrEdit/CreateOrEditView.html":t,"url:/Mapping/modules/Editing/Editor/EditorView.html":i,"url:/Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html":r,"url:/Mapping/modules/Editing/TemplatePicker/TemplatePickerView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/CSS/common.css","css","LmNvbnRlbnQtY29udGFpbmVyIHsNCiAgICBwYWRkaW5nOiAxLjVlbTsNCn0NCi5idXR0b24tYWN0aW9uLWljb24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgbWluLWhlaWdodDogOGVtOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjI1ZW07DQp9DQouYnV0dG9uLWFjdGlvbi1pY29uIGltZyB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luOiAwIGF1dG8gMWVtIGF1dG87DQp9DQouYWN0aW9uLWJ0bnMsDQouYWN0aW9uLWJ0bnMgbGkgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGxpc3Qtc3R5bGU6IG5vbmU7DQp9DQouYWN0aW9uLWJ0bnMgbGkgew0KICAgIHdpZHRoOiA1MCU7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgcGFkZGluZzogMCAxZW07DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KDQp9DQouYWN0aW9uLWJ0bnMgbGk6bnRoLWNoaWxkKG9kZCkgew0KICAgIHBhZGRpbmctbGVmdDogMDsNCn0NCi5hY3Rpb24tYnRucyBsaTpudGgtY2hpbGQoZXZlbikgew0KICAgIHBhZGRpbmctcmlnaHQ6IDA7DQp9DQouYWN0aW9uLWJ0bnM6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBjbGVhcjogYm90aDsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBoZWlnaHQ6IDA7DQogICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KfQ0KLmhpZGRlbi1maWxlLWlucHV0IHsNCiAgICB3aWR0aDogMC4xcHg7DQoJaGVpZ2h0OiAwLjFweDsNCglvcGFjaXR5OiAwOw0KCW92ZXJmbG93OiBoaWRkZW47DQoJcG9zaXRpb246IGFic29sdXRlOw0KCXotaW5kZXg6IC0xOw0KfQ0KLmZpbGUtYnV0dG9uIHsNCiAgICBwYWRkaW5nOiAuNWVtOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgd2lkdGg6IDEwMCU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Y3RjdGNzsNCiAgICBib3JkZXI6IDFweDsNCiAgICBib3JkZXItc3R5bGU6IHNvbGlkOw0KICAgIGJvcmRlci1jb2xvcjogI0RERERERDsNCn0NCi5maWxlLWJ1dHRvbiAqIHsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCi5maWxlLWJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRg0KfQ0KLmZpbGUtYnV0dG9uIHNwYW4gew0KICAgIHBhZGRpbmctbGVmdDogMWVtOw0KfQ0KLmF0dGFjaC1waG90byBkaXYuZmlsZS11cGxvYWQgew0KICAgIHBhZGRpbmc6IDBlbTsNCiAgICBwYWRkaW5nLWJvdHRvbTogNGVtOw0KICAgIG1hcmdpbi10b3A6IC0xLjU1ZW07DQp9DQoNCg0KLyogRkVBVFVSRSBFRElUSU5HIChDT01NT04pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vDQouZWRpdG9yIC5mb3JtLWNvbnRyb2wNCnsNCiAgICB0ZXh0LWFsaWduOiByaWdodDsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5lZGl0b3IgLmZvcm0tbGFiZWwsDQouZWRpdG9yIC5mb3JtLWNvbnRyb2wNCnsNCiAgICB3aWR0aDogYXV0bzsNCn0NCg0KLmVkaXRvciBzZWxlY3Qgew0KICAgIG1heC13aWR0aDogMzAwcHg7DQp9DQoNCi5lZGl0b3IgLmZvcm0tY29udHJvbA0Kew0KICAgIGZsb2F0OiByaWdodDsNCn0NCg0KICAgIC5lZGl0b3IgLmZvcm0tY29udHJvbCB0ZXh0YXJlYQ0KICAgIHsNCiAgICAgICAgaGVpZ2h0OiAyMDBweDsNCiAgICB9DQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAubGlzdC1tZW51LWl0ZW0NCnsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIgLmxpc3QtbWVudS1uYW1lDQp7DQogICAgbWFyZ2luLWxlZnQ6IDAuNzVlbTsNCn0NCg0KLmZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIC5mZWF0dXJlLXRlbXBsYXRlDQp7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZTphZnRlcg0Kew0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBoZWlnaHQ6IDA7DQogICAgY2xlYXI6IGJvdGg7DQogICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KfQ0KDQoudmlldy1mZWF0dXJlLWdlb21ldHJ5LXNlbGVjdG9yLA0KLnZpZXctZmVhdHVyZS1jcmVhdGUtb3ItZWRpdA0Kew0KICAgIHBhZGRpbmc6IDhweDsNCn0NCg0KLmNyZWF0ZS1lZGl0LWJ0bnMgLmJ1dHRvbiwNCi5sb2NhdGlvbi1idG5zIC5idXR0b24NCnsNCiAgICBtYXJnaW4tdG9wOiA0cHg7DQogICAgbWFyZ2luLXJpZ2h0OiA0cHg7DQp9DQoNCg0KLyBGSVggRk9SIERFU0tUT1AgQ09OVEVYVCBNRU5VIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoNCi8qIEZlYXR1cmUgVGVtcGxhdGUgUGlja2VyIFJ1bGVzIC0gR1ZILTYyMjIgKi8NCg0KLmZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIC5mZWF0dXJlLXRlbXBsYXRlOjphZnRlciB7DQogICAgY29udGVudDogIiI7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgY2xlYXI6IGJvdGg7DQp9DQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAubGlzdC1tZW51LWl0ZW0gew0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAubGlzdC1tZW51LWljb24gew0KICAgIG1heC1oZWlnaHQ6IDJlbTsNCn0NCg0KLmRpaml0UG9wdXANCnsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgYm94LXNoYWRvdzogMnB4IDJweCAycHggIzQ0NDQ0NDsNCiAgICAtd2Via2l0LWJveC1zaGFkb3c6IDJweCAycHggMnB4ICM0NDQ0NDQ7DQp9DQoNCiAgICAuZGlqaXRQb3B1cCBpZnJhbWUNCiAgICB7DQogICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgfQ0KDQogICAgLmRpaml0UG9wdXAgdGFibGUNCiAgICB7DQogICAgICAgIG1hcmdpbjogLjI1ZW0gIWltcG9ydGFudDsNCiAgICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIH0NCg0KLmRpaml0TWVudUl0ZW1JY29uQ2VsbA0Kew0KICAgIHBhZGRpbmctcmlnaHQ6IC40NWVtOw0KfQ0KDQouYWRkLW9yLWVkaXQtZmVhdHVyZSBmaWVsZHNldC5uby1wYWRkaW5new0KICAgIHdpZHRoOiAxMDAlOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/CreateOrEdit/CreateOrEditView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/Editor/EditorView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/TemplatePicker/TemplatePickerView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Editing/BinTool","Mapping/modules/Editing/CoreEditCommands","Mapping/modules/Editing/EditingModule","Mapping/modules/Editing/FeatureUtilities","Mapping/modules/Editing/Utils","Mapping/modules/Editing/CreateOrEdit/CreateOrEditView","Mapping/modules/Editing/Editor/EditorView","Mapping/modules/Editing/Editor/EditorViewModel","Mapping/modules/Editing/TemplatePicker/FeatureTemplateViewModel","Mapping/modules/Editing/TemplatePicker/TemplatePickerView","Mapping/modules/Editing/TemplatePicker/TemplatePickerViewModel","Mapping/modules/Editing/Undoable/Add","Mapping/modules/Editing/Undoable/AddAndUpdate","Mapping/modules/Editing/Undoable/Delete","Mapping/modules/Editing/Undoable/DeleteAndUpdate","Mapping/modules/Editing/Undoable/Update","Mapping/modules/Editing/Editor/Form/EditingFormField","Mapping/modules/Editing/Editor/Form/EditingFormViewModel"],function(e,t,i,r,a,n,s,o,l,u,d,c,p,h,g,m,f,y){v(e,"geocortex.essentialsHtmlViewer.mapping.modules.editing.BinTool",e.BinTool),v(t,"geocortex.essentialsHtmlViewer.mapping.modules.editing.CoreEditCommands",t.CoreEditCommands),v(i,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditGraphicType",i.EditGraphicType),v(i,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingModule",i.EditingModule),v(r,"geocortex.essentialsHtmlViewer.mapping.modules.editing.FeatureUtilities",r.FeatureUtilities),v(a,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingUtils",a.EditingUtils),v(n,"geocortex.essentialsHtmlViewer.mapping.modules.editing.CreateOrEditView",n.CreateOrEditView),v(s,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorView",s.EditorView),v(o,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorState",o.EditorState),v(o,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorViewModel",o.EditorViewModel),v(l,"geocortex.essentialsHtmlViewer.mapping.modules.editing.FeatureTemplate",l.FeatureTemplate),v(u,"geocortex.essentialsHtmlViewer.mapping.modules.editing.TemplatePickerView",u.TemplatePickerView),v(d,"geocortex.essentialsHtmlViewer.mapping.modules.editing.TemplatePickerViewModel",d.TemplatePickerViewModel),v(c,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Add",c.Add),v(p,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.AddAndUpdate",p.AddAndUpdate),v(h,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Delete",h.Delete),v(g,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.DeleteAndUpdate",g.DeleteAndUpdate),v(m,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Update",m.Update),v(f,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingFormField",f.EditingFormField),v(y,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingFormViewModel",y.EditingFormViewModel)})}();