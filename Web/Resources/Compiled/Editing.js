!function(){function e(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var r=t.split("."),a=null,n=window,s=0,o=r.length;s<o;s++)a=r[s],s==o-1?n[a]=i:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+t)}var t="<div class='view-feature-create-or-edit content-container'>    <p class='description-text' data-binding='{@text: @language-feature-editing-create-edit-no-features-found}'></p>    <ul class='action-btns'>        <li>            <button class='button button-action-icon create-new-feature' data-binding='{@event-onclick: handleClickCreateNewFeature}'><img src='Resources/Images/Icons/Toolbar/feature-create-24.png' data-binding='{alt: @language-feature-editing-create-edit-new-feature}{title: @language-feature-editing-create-edit-new-feature}'><span data-binding='{@text: @language-feature-editing-create-edit-new-feature}'></span></button>        </li>        <li>            <button class='button button-action-icon existing-feature' data-binding='{@event-onclick: handleClickSelectExistingFeature}'><img src='Resources/Images/Icons/Toolbar/feature-location-24.png' data-binding='{alt: @language-feature-editing-create-edit-select-existing-feature}{title: @language-feature-editing-create-edit-select-existing-feature}'><span data-binding='{@text: @language-feature-editing-create-edit-select-existing-feature}'></span></button>        </li>    </ul></div>",i="<div class='editor'>    \x3c!-- APPLY EDITS --\x3e    <div class='loading-container' data-binding='{@visible: isBusy}'>        <div class='loading-img'></div>        <div class='loading-msg' data-binding='{@text: busyText}'></div>    </div>    \x3c!-- ADD/EDIT FORM --\x3e    <div class='add-or-edit-feature' data-binding='{@hidden: isBusy}'>        <div class='panel-content'>           \x3c!-- has geometry -- >           \x3c!-- <div class='panel-notification' data-binding='{@visible: hasGeometry}'>                        <span data-binding='{@text: @language-feature-editing-has-geometry}'></span>                    </div>--\x3e            <div data-binding='{@source: form}'>                <div data-binding='{@template-for: form}'>                                        \x3c!-- 'This feature has no editable fields.' --\x3e                    <div class='panel-notification' data-binding='{@hidden: fields}'>                        <span data-binding='{@text: @language-feature-editing-invalid-layer}'></span>                    </div>                    <div class='panel-group' data-binding='{@visible: fields}'>                        <h3 data-binding='{@text: @language-feature-editing-feature-attributes}'></h3>                        <div class='panel-group-contents'>                            <div class='form label-stacked'>                                <div class='form-container' data-binding='{@source: fields}{@template-selector: renderType}'>                                    \x3c!-- DATE PICKER --\x3e                                    <div class='form-item' data-binding='{@template-select: esriFieldTypeDate}{@visible: editable}'>                                        <label class='form-label'>                                            <span data-binding='{@text: displayName}'></span>                                        </label>                                        <div class='form-control-date-picker' data-binding='{@widget: DatePickerFormItem}{@widget-context: datePickerViewModel}'>                                        </div>                                    </div>                                    \x3c!-- CODED DOMAIN VALUE TEMPLATE --\x3e                                    <div class='form-item' data-binding='{@template-select: codedDomainValue}{@visible: editable}'>                                        <div class='combobox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <select data-binding='{@source: valueOptions}{@value: value}{@disabled: readOnly}'>                                                    <option data-binding='{@template-for: valueOptions}{@text: name}{value: code}'></option>                                                </select>                                            </div>                                        </div>                                    </div>                                    \x3c!-- SUBCLASS TEMPLATE --\x3e                                    <div class='form-item' data-binding='{@template-select: typeField}{@visible: editable}'>                                        <div class='combobox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <select data-binding='{@source: valueOptions}{@value: value}{@event-onchange: handleTypeFieldChange}{@disabled: readOnly}'>                                                    <option data-binding='{@template-for: valueOptions}{@text: name}{value: code}'></option>                                                </select>                                            </div>                                        </div>                                    </div>                                    \x3c!-- LARGE TEXT FIELDS --\x3e                                    <div class='form-item' data-binding='{@template-select: textArea}{@visible: editable}'>                                        <div class='textbox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <textarea type='text' data-binding='{@value: presentableValue}{@disabled: readOnly}{@event-onblur: handleInputBlur}{@event-onfocus: handleInputFocus}'></textarea>                                            </div>                                        </div>                                    </div>                                    \x3c!-- FIELDS --\x3e                                    <div class='form-item' data-binding='{@template-for: fields}{@visible: editable}'>                                        <div class='textbox'>                                            <label class='form-label'>                                                <span data-binding='{@text: displayName}'></span>                                                <span class='indicator' data-binding='{@visible: showIndicator}'>*</span>                                            </label>                                            <div class='form-control'>                                                <input type='text' data-binding='{@value: presentableValue}{@disabled: readOnly}{@event-onblur: handleInputBlur}{@event-onfocus: handleInputFocus}' />                                            </div>                                        </div>                                    </div>                                </div>                                \x3c!-- VALIDATION --\x3e                                <ul class='form-validation' data-binding='{@source: validationMessages}{@visible: validationMessages}'>                                    <li data-binding='{@template-for: validationMessages}'>                                        <span data-binding='{@text: @context}'></span>                                    </li>                                </ul>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div>    \x3c!-- ATTACHMENTS --\x3e    <div data-binding='{@hidden: isBusy}'>        <div class='attach-photo panel-group panel-content' data-binding='{@visible: hasEditableAttachments}'>            <h3 data-binding='{@text: @language-feature-editing-manage-attachments}'></h3>                <div class='no-item' data-binding='{@hidden: isAttachmentInfosInitialized}{@text: @language-feature-attachments-checking}'></div>            <div class='no-item' data-binding='{@visible: noAttachments}{@text: @language-feature-attachments-no-attachments}'></div>            <div class='no-item' data-binding='{@visible: isOffline}{@text: @language-feature-attachments-no-attachments-offline}'></div>            <div class='panel-group' data-binding='{@visible: attachmentInfos}'>                <ul class='list-menu active has-icon' data-binding='{@source: attachmentInfos}'>                    <li class='attachment list-menu-item has-delete-button' data-binding='{@template-for: attachmentInfos}'>                        <a class='list-menu-details' data-binding='{href: url}{@event-onclick: attachment_click}{target: target}{@enabled: enabled}'>                            <img class='list-menu-icon' src='Resources/Images/Icons/Toolbar/attach-24.png' data-binding='{alt: @language-feature-attachments}' />                            <strong class='list-menu-name' data-binding='{@text: name}'></strong>                            <span class='list-menu-desc' data-binding='{@text: size}'></span>                        </a>                        <button class='list-item-button icon icon-delete-16' data-binding='{@event-click: handleDeleteClick}{title: @language-feature-attachments-delete}{@text: @language-feature-attachments-delete}'></button>                    </li>                </ul>            </div>                <div class='panel-content panel-group-contents' data-binding='{@hidden: browserFileAPISupported}'>                <p><button class='button' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoCamera}{@text: @language-native-photo-from-camera}'></button></p>                <p><button class='button' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoGallery}{@text: @language-native-photo-from-gallery}'></button></p>            </div>                    <div class='panel-content panel-group-contents file-upload' data-binding='{@visible: browserFileAPISupported}'>                <label class='file-button' role='button' tabindex='0' data-binding='{@event-onkeypress: handleFileKeypress}'>                    <img class='list-menu-icon' src='Resources/Images/Icons/add-16.png' alt=' '>                    <input type='file' multiple class='hidden-file-input' tabindex='-1' data-binding='{@var: fileInputElement}{aria-label: @language-native-file-select-heading}{@event-onchange: handleFileSelect}' />                    <span data-binding='{@text: @language-feature-editing-add-attachments}'></span>                </label>                <p class='loading'><span data-binding='{@visible: isUploadingAttachment}{@text: @language-native-file-uploading}'></span></p>            </div>        </div>    </div>    \x3c!-- BUTTONS --\x3e    <div class='panel-group-contents form-btns' data-binding='{@hidden: isBusy}'>        <button class='button' data-binding='{@event-onclick: handleClickEditGeometry}{@visible: showEditGeometryButton}{@text: @language-feature-editing-edit-geometry-caption}'></button>        <button class='button' data-binding='{@event-onclick: handleClickEditGeometry}{@visible: showStopEditingGeometryButton}{@text: @language-feature-editing-stop-editing-geometry-caption}'></button>        <button class='button' data-binding='{@event-onclick: handleClickDeleteFeature}{@visible: canDeleteFeature}{@text: @language-common-delete}'></button>        <button class='button' data-binding='{@event-onclick: handleClickSave}{@text: @language-common-save}'></button>        <button class='button' data-binding='{@event-onclick: handleClickCancel}{@text: @language-common-cancel}'></button>    </div></div>",r="<div class='feature-template has-icon' data-binding='{@event-onclick: handleFeatureTemplateClick}'>    <button class='list-menu-details'>        <img class='list-menu-icon' data-binding='{@visible: symbolUri}{src: symbolUri}' alt=' ' />        <span class='list-menu-icon' data-binding='{@hidden: symbolUri}{innerHTML: swatchElement}'></span>        <strong class='list-menu-name' data-binding='{@text: name}'></strong>        <span class='list-menu-desc' data-binding='{@text: description}{@visible: description}'></span>    </button></div>",a="<div class='feature-template-picker'>    \x3c!-- TEMPLATES --\x3e    <div class='panel-group no-item' data-binding='{@hidden: layerTemplates}{@text: @language-feature-editing-no-templates}'></div>    <div class='panel-group' data-binding='{@source: layerTemplates}'>        <div data-binding='{@template-for: layerTemplates}{@visible: layerIsEditable}'>            <h3 data-binding='{@text: displayName}'></h3>            <div data-binding='{@hidden: notAvailableReason}'>                <div class='no-results' data-binding='{@hidden: templates}'>                    <span data-binding='{@text: @language-feature-editing-no-templates}'></span>                    <div class='form-button-container'>                        <div class='form-button-align'>                            <div class='form-item form-btns'>                                <button class='button' data-binding='{@text: @language-feature-editing-add-feature-button}{@event-onclick: handleFeatureTemplateClick}'></button>                            </div>                        </div>                    </div>                </div>                <ul class='list-menu' data-binding='{@visible: templates}{@source: templates}{@template-selector: foo}'>                    <li class='list-menu-item' data-binding='{@template-select: @null}{@template: Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html}'></li>                </ul>            </div>            <div data-binding='{@visible: notAvailableReason}'>                <div class='no-results'>                    <span data-binding='{@text: notAvailableReason}'></span>                </div>            </div>        </div>    </div></div>";require({cache:{"Mapping/modules/Editing/BinTool":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.decodeArrayBuffer=function(e){var t=Math.ceil(3*e.length/4),i=new ArrayBuffer(t);return this.decode(e,i),i},e.decode=function(e,t){var i=this._keyStr.indexOf(e.charAt(e.length-1)),r=this._keyStr.indexOf(e.charAt(e.length-1)),a=Math.ceil(3*e.length/4);64==i&&a--,64==r&&a--;var n,s,o,l,u,d,c,p=0,h=0;for(n=t?new Uint8Array(t):new Uint8Array(a),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<a;p+=3)s=this._keyStr.indexOf(e.charAt(h++))<<2|(u=this._keyStr.indexOf(e.charAt(h++)))>>4,o=(15&u)<<4|(d=this._keyStr.indexOf(e.charAt(h++)))>>2,l=(3&d)<<6|(c=this._keyStr.indexOf(e.charAt(h++))),n[p]=s,64!=d&&(n[p+1]=o),64!=c&&(n[p+2]=l);return n},e}();i._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.BinTool=i})},"Mapping/modules/Editing/CoreEditCommands":function(){define(["require","exports","geocortex/essentials/MapService","geocortex/essentials/RestHelperHTTPService","geocortex/framework/utils/utils","./BinTool"],function(e,t,i,r,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.registerCommands=function(){this.app.commandRegistry.command("CreateFeature").register(this,this._executeCreateFeature),this.app.commandRegistry.command("UpdateFeature").register(this,this._executeUpdateFeature),this.app.commandRegistry.command("DeleteFeature").register(this,this._executeDeleteFeature),this.app.commandRegistry.command("ApplyEdits").register(this,this._executeApplyEdits,this._canExecuteApplyEdits),this.app.commandRegistry.command("CreateRelatedRecord").register(this,this._executeCreateRelatedRecord),this.app.commandRegistry.command("UpdateRelatedRecord").register(this,this._executeUpdateRelatedRecord),this.app.commandRegistry.command("DeleteRelatedRecord").register(this,this._executeDeleteRelatedRecord),this.app.commandRegistry.command("CreateAttachment").register(this,this._executeCreateAttachment),this.app.commandRegistry.command("DeleteAttachments").register(this,this._executeDeleteAttachments)},e.prototype._executeApplyEdits=function(e){var t=this._getMapService(e.mapService);t?this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:e.addedFeatures?e.addedFeatures:[],updates:e.updatedFeatures?e.updatedFeatures:[],deletions:e.deletedFeatures?e.deletedFeatures:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._canExecuteApplyEdits=function(e){return!(!e||!e.layer&&!e.mapService)&&!!(e.addedFeatures&&0===e.addedFeatures.length||e.updatedFeatures&&0===e.updatedFeatures.length||e.deletedFeatures&&0===e.deletedFeatures.length)},e.prototype._executeCreateFeature=function(e){var t=this._getMapService(e.mapService);t?e.feature&&this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[e.feature],updates:[],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._executeUpdateFeature=function(e){var t=this._getMapService(e.mapService);t?this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[],updates:[e.feature],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._getMapService=function(e){return"string"==typeof e?this.app.site.essentialsMap.findMapServiceById(e):e},e.prototype._executeDeleteFeature=function(e){var t=this._getMapService(e.mapService);t?e.feature&&this._applyFeatureLayerEdits({mapService:t,layer:e.layer,additions:[],updates:[],deletions:[e.feature],successCallback:e.successCallback,errorCallback:e.errorCallback}):e.errorCallback&&e.errorCallback(new Error(this.app.getResource(this.libraryId,"language-feature-editing-error-no-mapservice")))},e.prototype._executeCreateRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[e.feature],updates:[],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback})},e.prototype._executeUpdateRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[],updates:[e.feature],deletions:[],successCallback:e.successCallback,errorCallback:e.errorCallback})},e.prototype._executeDeleteRelatedRecord=function(e){e.feature&&this._applyFeatureLayerEdits({mapService:null,layer:e.layer,additions:[],updates:[],deletions:[e.feature],successCallback:e.successCallback,errorCallback:e.errorCallback})},e.prototype._applyFeatureLayerEdits=function(e){if(e){var t=e.mapService,r=e.layer;if(t)r=t.serviceLayer;else{if(!r)return void this.app.trace.warning("Cannot apply edits: Missing map service and/or layer in edit descriptor.");(t=new i.MapService(r.url)).serviceLayer=r}var a=e.additions||[],n=e.updates||[],s=e.deletions||[],o=e.successCallback||function(){},l=e.errorCallback||function(){};r.applyEdits(a,n,s).then(function(e,t,i){var n=null;if(t&&t.length>0)for(var s=0,u=t;s<u.length;s++){var d=u[s];if(!d.success){n=d.error;break}}if(e&&e.length>0)for(var c=0;c<e.length;++c){var p=e[c];if(!p.success){n=p.error;break}p.GID&&r.globalIdField&&(a[c].attributes[r.globalIdField]=p.GID)}n?l((n||{message:"Editing operation was not successful"}).message):o&&o()},function(e){l(e)})}},e.prototype._executeCreateAttachment=function(e){var t=this._getFeatureUrl(e.layer,e.feature);e.featureUrl=t,this._syncAttachmentToServer(e.featureUrl,e.filename,e.contentType,e.payload,e.callback)},e.prototype._executeDeleteAttachments=function(e){var t=e.feature.attributes[e.layer.objectIdField];e.layer.deleteAttachments(t,e.attachmentIds,e.callback,e.errback)},e.prototype._getFeatureUrl=function(e,t){var i=t.attributes[e.objectIdField],r=e.url;return r.indexOf("?")>-1?r.replace("?","/{0}?".format(i)):"{0}/{1}".format(r,i)},e.prototype._syncAttachmentToServer=function(e,t,i,s,o){this.app.trace.debug("--- _syncAttachmentToServer called");try{for(var l=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),r=0,a=e.length;r<a;r++)i[r]=e.charCodeAt(r)%255;return i},u=e.lastIndexOf("/"),d=e.substring(0,u),c=null,p=0,h=this.app.map.graphicsLayerIds;p<h.length;p++){var g=h[p],m=this.app.map.getLayer(g);if(m.url){var f=m.url.match(/^(.[^?]*)/);if(f&&f[0]===d){c=m;break}}}c||(c=new esri.layers.FeatureLayer(e.replace(/\/\d$/g,""))),e.indexOf("?")>-1?e=e.replace("?","/addattachment?"):e+="/addAttachment",this.app.isOffline.get()&&this.app.command("RewriteUrlForOffline").execute(e,function(t){e=t});var y=null;if(c.credential&&c.credential.token)y=c.credential.token;else{var v=c.url.match(/token=([^\?&$]*)/);v&&(y=v[1])}if(y&&-1===e.indexOf(y)&&(e=r.RestHelperHTTPService.appendTokenToUrl(e,y)),this.app.configuration.proxyUri){var b=a.makeUrlAbsolute(this.app.configuration.proxyUri);e=b+e}this.app.trace.debug("--- Creating XHR");var E=new XMLHttpRequest;E.open("POST",e,!0),E.setRequestHeader("Content-Type","multipart/form-data; boundary=---------------------------L4717uD3G30"),E.responseType="",E.onload=o,this.app.trace.debug("--- Creating request preamble");var _="-----------------------------L4717uD3G30\r\n"+'Content-Disposition: form-data; name="attachment"; filename="{0}";\r\n'.format(t)+"Content-Type: {0}".format(i)+"\r\n\r\n";this.app.trace.debug("--- Encoding request preamble");var F=l(_);this.app.trace.debug("--- Encoding request payload");var w=n.BinTool.decode(s);this.app.trace.debug("--- Creating request suffix");this.app.trace.debug("--- Encoding request suffix");var C=l('\r\n-----------------------------L4717uD3G30\r\nContent-Disposition: form-data; name="gdbVersion"\r\n\r\n\r\n-----------------------------L4717uD3G30\r\nContent-Disposition: form-data; name="f"\r\n\r\njson\r\n-----------------------------L4717uD3G30--\r\n');this.app.trace.debug("--- Creating payload buffer");var I=new ArrayBuffer(F.length+w.length+C.length),T=new Uint8Array(I),x=0;this.app.trace.debug("--- Merging output buffers");for(S=0;S<F.length;S++,x++)T[x]=255&F[S];for(S=0;S<w.length;S++,x++)T[x]=255&w[S];for(var S=0;S<C.length;S++,x++)T[x]=255&C[S];this.app.trace.debug("--- Sending request"),E.send(T.buffer)}catch(e){this.app.trace.error("--- ERROR: {0}".format(e.toString())),o&&o(e)}},e}();t.CoreEditCommands=s})},"Mapping/modules/Editing/EditingModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/application/ModuleBase","./CoreEditCommands","./CutUnion/CutInteractive","./CutUnion/UnionInteractive","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/BrowserUtils","./Undoable/Add","./Undoable/Update","./Undoable/Delete","./Undoable/AddAndUpdate","./Undoable/DeleteAndUpdate","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/framework/utils/ArrayUtils"],function(t,i,r,a,n,s,o,l,u,d,c,p,h,g,m,f,y,v){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var b;!function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Delete=2]="Delete",e[e.Cut=3]="Cut",e[e.Explode=4]="Explode",e[e.Union=5]="Union"}(b=i.EditGraphicType||(i.EditGraphicType={}));var E=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._hasGeometry=!1,e._editorDeactivatedHandle=null,e._isEditingGeometry=!1,e._lastEdited={},e}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this._registerCommands(),this._registerEvents();new n.CutInteractive(this.app,this.libraryId,e.cutLimit),new s.UnionInteractive(this.app,this.libraryId,e.unionLimit,e.unionCheckCardinality);d.isSafari()&&this._setupSafariCacheHandler()},i.prototype._registerCommands=function(){this.app.command("SetEditorFeatureGeometry").register(this,this._executeSetEditorFeatureGeometry,this._canExecuteSetEditorFeatureGeometry),this.app.command("StartEditingGraphicGeometry").register(this,this._executeStartEditingGeometry,this._canExecuteStartEditingGeometry),this.app.command("StopEditingGraphicGeometry").register(this,this._executeStopEditingGeometry,this._canExecuteStopEditingGeometry),new a.CoreEditCommands(this.app,this.libraryId).registerCommands(),this.app.command("StopFeaturePlacementState").register(this,this._executeStopFeaturePlacementState,this._canExecuteStopFeaturePlacementState),this.app.command("CreateGraphicsInMemory").register(this,this._executeCreateGraphicsInMemory),this.app.command("UpdateGraphicsInMemory").register(this,this._executeUpdateGraphicsInMemory),this.app.command("DeleteGraphicsInMemory").register(this,this._executeDeleteGraphicsInMemory),this.app.command("CutGraphicsInMemory").register(this,this._executeCutGraphicsInMemory),this.app.command("ExplodeGraphicsInMemory").register(this,this._executeExplodeGraphicsInMemory),this.app.command("UnionGraphicsInMemory").register(this,this._executeUnionGraphicsInMemory)},i.prototype._registerEvents=function(){var e=this,t=null;this.app.event("StartFeaturePlacementEvent").subscribe(this,function(){t=e.app.event("ViewDeactivatedEvent").subscribe(e,function(t){"TemplatePickerView"===t.id&&e.app.event("StopFeaturePlacementEvent").publish()})}),this.app.event("StopFeaturePlacementEvent").subscribe(this,function(){e.app.event("ViewDeactivatedEvent").unsubscribe(t),e.app.command("ClearActiveTool").execute();var i=e.app.viewManager.getViewById("TemplatePickerView");i&&i.isActive&&e.app.command("DeactivateView").execute("TemplatePickerView")}),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChangedEvent)},i.prototype._setupSafariCacheHandler=function(){var e=this;esri.request.setRequestPreCallback(function(t){if(t&&t.url&&!(e.app.offlineManager.isOfflineMapActive&&e.app.offlineManager.isOfflineMapActive.get())){var i=v.firstOrDefault(e.app.site.getFeatureServices(),function(e){return e.serviceUrl&&t.url.startsWith(e.serviceUrl)}),r=i?i.serviceLayer:null;r&&r.geometryType&&r.allowGeometryUpdates&&(t.content.lastEdit=e._lastEdited[r.id])}return t}),this.app.waitUntilSiteServiceLayersLoaded().then(function(){e.app.site.getFeatureServices().forEach(function(t){var i=t.serviceLayer;i&&i.geometryType&&i.allowGeometryUpdates&&i.on("edits-complete",function(t){e._lastEdited[t.target.id]=Date.now()})})})},i.prototype._executeStopFeaturePlacementState=function(){this.app.event("StopFeaturePlacementEvent").publish()},i.prototype._canExecuteStopFeaturePlacementState=function(){return!0},i.prototype._canExecuteSetEditorFeatureGeometry=function(e){return!0},i.prototype._executeSetEditorFeatureGeometry=function(e){this._executeStopEditingGeometry();var t=this._feature;t&&("extent"===e.type&&(e=o.envelopeToPolygon(e)),this._geometry=e,this._hasGeometry=!!e,this._graphic.setGeometry(e),this.app.event("GeometryEditCompletedEvent").publish({originalGraphic:this._feature,editedGraphic:this._graphic,cancelled:!1}),this._destroyEditingLayer(),this.app.event("FeatureGeometryEditedEvent").publish(t))},i.prototype._canExecuteStartAddingFeatureGeometry=function(e){return!0},i.prototype._executeStartAddingFeatureGeometry=function(e){},i.prototype._canExecuteStartEditingGeometry=function(e,t){return!0},i.prototype._executeStartEditingGeometry=function(e,t){var i=this;this._isEditingGeometry=!0,this._editObject&&this._editObject.deactivate(),this._feature=e,e.symbol||t.renderer||e.setSymbol(this._getMoveSymbol(e,t)),this._graphic=new esri.Graphic(e.geometry,e.symbol,e.attributes,e.infoTemplate),this._hasGeometry=!!this._graphic.geometry;var r=t||this._feature.getLayer();if(this._featureLayer=r,this._createEditingLayer(),this._hideOriginalFeature(),this._graphic.symbol=this._getMoveSymbol(e,r),this._editingLayer.add(this._graphic),this._layerUpdateEndToken&&dojo.disconnect(this._layerUpdateEndToken),this._layerUpdateEndToken=dojo.connect(this._graphic._graphicsLayer,"onUpdateEnd",dojo.hitch(this,this._handleLayerUpdateEnd)),this._hasGeometry){var a=null;if(null===e)throw new Error("Can't edit geometry of null feature");if(!esri.toolbars.Edit){var n=this.app.getResource(this.libraryId,"language-feature-editing-package-required"),s=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return void this.app.command("Alert").execute(n,s)}a=this._getConfiguredEditMode();var o={allowAddVertices:!0,allowDeleteVertices:!0};this._editObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.edit",this.app.map,o);var l=dojo.aspect.after(this._editObject,"onGraphicFirstMove",function(e){i.app.map.disableMapNavigation()},!0),u=dojo.aspect.after(this._editObject,"onGraphicMoveStop",function(e){i.app.map.enableMapNavigation()},!0);this._editorDeactivatedHandle&&(this._editorDeactivatedHandle.remove(),this._editorDeactivatedHandle=null),this._editorDeactivatedHandle=dojo.aspect.after(this._editObject,"onDeactivate",function(e,t,r){l&&(l.remove(),l=null),u&&(u.remove(),u=null),null!=i._editingGeometryMapClickHandle&&(dojo.disconnect(i._editingGeometryMapClickHandle),i._editingGeometryMapClickHandle=null),i._layerUpdateEndToken&&(dojo.disconnect(i._layerUpdateEndToken),i._layerUpdateEndToken=null),i._editorDeactivatedHandle&&(i._editorDeactivatedHandle.remove(),i._editorDeactivatedHandle=null),i._editObject&&(i._editObject=null),i._destroyEditingLayer(),i._indicateGeometryEditing(!1),i.app.event("GeometryEditCompletedEvent").publish({originalGraphic:i._feature,editedGraphic:i._graphic,cancelled:r.cancelled})},!0),this._editingGeometryMapClickHandle=dojo.connect(this.app.map,"onClick",function(){i._executeStopEditingGeometry(!1)}),this._indicateGeometryEditing(!0),this._editObject.activate(a,this._graphic,o),this.app.event("GeometryEditInvokedEvent").publish(this._feature)}else this._currentToolName=this._getToolNameByDrawType(e._drawType),this._currentToolName||(this._currentToolName=this._getToolNameByGeometryType(r.geometryType)),this.app.command("SetActiveTool").execute(this._currentToolName),this._indicateGeometryEditing(!0)},i.prototype._createEditingLayer=function(){this._editingLayer=y.getInternalGraphicsLayer(f.EDITING_LAYER_ID,this.app,y.GraphicsLayerType.Markup)},i.prototype._destroyEditingLayer=function(){y.removeInternalGraphicsLayer(f.EDITING_LAYER_ID,this.app,y.GraphicsLayerType.Markup),this._editingLayer=null},i.prototype._handleLayerVisualizationChangedEvent=function(e){var t=this;if(this._feature&&this._graphic&&this._featureLayer&&this._editingLayer&&e&&e.mapService&&e.mapService.serviceLayer&&e.mapService.serviceLayer.id===this._featureLayer.id){if(this._featureLayer.renderer)this._graphic.setSymbol(this._featureLayer.renderer.getSymbol(this._feature));else{var i=this.app.map.graphicsLayerIds.filter(function(e){return e===t._featureLayer.id+"-cluster"});if(i.length>0){var r=this.app.map.getLayer(i[0]);r&&r.featureLayerRenderer&&this._graphic.setSymbol(r.featureLayerRenderer.getSymbol(this._feature))}}this._editingLayer.redraw(),this._editObject.refresh()}},i.prototype._handleLayerUpdateEnd=function(){this._hideOriginalFeature()},i.prototype._hideOriginalFeature=function(){if(this._feature){var e=l.findFeatureInMap(this._feature,this.app.site);e&&e.hide()}},i.prototype._getMoveSymbol=function(e,t){var i=null;if(t.renderer)i=e.symbol?e.symbol:t.renderer.getSymbol(e);else{var r=this.app.map.graphicsLayerIds.filter(function(e){return e===t.id+"-cluster"});if(r.length>0){var a=this.app.map.getLayer(r[0]);i=a.featureLayerRenderer.getSymbol(e)}}var n=!1,s=function(e){return n||(i=new e(i.toJson()),n=!0),i};if(i instanceof esri.symbol.SimpleMarkerSymbol){var o=i;o.size<10&&s(esri.symbol.SimpleMarkerSymbol).setSize(10),o.color.a<.5&&(!o.outline||o.outline.color.a<.5)&&(s(esri.symbol.SimpleMarkerSymbol).color.a=.5)}return i},i.prototype._canExecuteStopEditingGeometry=function(){return!0},i.prototype._executeStopEditingGeometry=function(e){void 0===e&&(e=!1),this._isEditingGeometry&&(this.app.command("ClearActiveTool").execute(),this._editObject&&(this._editObject._cancelled=e,this._editObject.deactivate(),this._editObject=null),null!=this._editingGeometryMapClickHandle&&(dojo.disconnect(this._editingGeometryMapClickHandle),this._editingGeometryMapClickHandle=null),this._layerUpdateEndToken&&(dojo.disconnect(this._layerUpdateEndToken),this._layerUpdateEndToken=null),this._editorDeactivatedHandle&&(this._editorDeactivatedHandle.remove(),this._editorDeactivatedHandle=null),this._indicateGeometryEditing(!1))},i.prototype._indicateGeometryEditing=function(e){var t=this;if(this._feature&&this._feature.geometry){if(e){var i=this._feature.geometry.type,r=u.getEsriGeometryType(i,esri.toolbars.Draw.POINT),a={id:"geometryEditingStatus",text:this.getEditingGeometryStatusMessage(this.app,this.libraryId,r),closeButton:{callback:function(){t._executeStopEditingGeometry(!0)}}};this.app.command("DisplayNotification").execute(a),this.app.command("ShowMap").execute()}else this.app.command("RemoveNotification").execute("geometryEditingStatus")}},i.prototype.getEditingGeometryStatusMessage=function(e,t,i){var r=Modernizr&&!!Modernizr.touch;switch(i){case esri.toolbars.Draw.POINT:return e.getResource(t,"language-feature-editing-geometry-point");case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYLINE:return r?e.getResource(t,"language-feature-editing-geometry-polyline-touch"):e.getResource(t,"language-feature-editing-geometry-polyline");case esri.toolbars.Draw.CIRCLE:case esri.toolbars.Draw.ELLIPSE:case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.FREEHAND_POLYGON:return r?e.getResource(t,"language-feature-editing-geometry-polygon-touch"):e.getResource(t,"language-feature-editing-geometry-polygon");case esri.toolbars.Draw.EXTENT:return e.getResource(t,"language-feature-editing-geometry-rectangle")}return e.getResource(t,"language-feature-editing-geometry-default")},i.prototype._getToolNameByDrawType=function(e){return e?"Editing{0}Tool".format(e.replace("Map","")):""},i.prototype._getToolNameByGeometryType=function(e){var t=e.slice("esriGeometry".length);return"Editing{0}Tool".format(t)},i.prototype._getConfiguredEditMode=function(){var e=this,t=0,i=this.app.site.essentialsMap.mapServices.filter(function(t){return t.id===e._featureLayer.id});if(0===i.length)t=esri.toolbars.Edit.MOVE|esri.toolbars.Edit.EDIT_VERTICES|esri.toolbars.Edit.SCALE|esri.toolbars.Edit.ROTATE;else{var r=i[0];r.rotateEnabled&&(t|=esri.toolbars.Edit.ROTATE),r.scaleEnabled&&(t|=esri.toolbars.Edit.SCALE),r.moveEnabled&&(t|=esri.toolbars.Edit.MOVE),r.editVerticesEnabled&&(t|=esri.toolbars.Edit.EDIT_VERTICES)}return t},i.prototype._executeCreateGraphicsInMemory=function(e){var t=this;this._validateEditInMemoryArgs(e,b.Create)&&(e.graphics.map(function(i){e.graphicsLayer.add(i),t.app.event("MarkupAddedEvent").publish(i)}),e.successCallback(e.graphics,[],[]).then(function(){var i=t.app.getResource(t.libraryId,"language-feature-editing-undoable-add");if(!e.skipUndoManager){var r={app:t.app,addedGraphics:e.graphics,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new c.Add(i,r))}}))},i.prototype._executeUpdateGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,b.Update))if(e.geometries&&e.geometries.length===e.graphics.length){for(var i=[],r=0;r<e.graphics.length;r++)i[r]=new esri.Graphic(e.graphics[r].toJson()),e.graphics[r].setGeometry(e.geometries[r]),this.app.event("MarkupUpdatedEvent").publish(e.graphics[r]);e.successCallback([],e.graphics,[]).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-update"),a={app:t.app,preUpdatedGraphics:i,updatedGraphics:e.graphics,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new p.Update(r,a))})}else e.errorCallback(new Error("Could not update graphics: the graphic count does not match the updated geometry count."))},i.prototype._executeDeleteGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,b.Delete)){for(var i=[],r=0,a=e.graphics;r<a.length;r++){var n=a[r];e.graphicsLayer.remove(n)&&(i.push(n),this.app.event("MarkupDeletedEvent").publish(n))}0===i.length&&e.errorCallback(new Error("Could not delete graphics: the provided graphics are not on the graphics layer.")),e.successCallback([],[],i).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-delete");if(!e.skipUndoManager){var a={app:t.app,deletedGraphics:i,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new h.Delete(r,a))}})}},i.prototype._executeCutGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,b.Cut))if(e.polyline){var i=e.graphics.map(function(e){return e.geometry});u.cutGeometries(i,e.polyline,this.app).then(function(i){for(var r=0,a=i;r<a.length;r++)if(a[r].length<2)return void e.errorCallback(new Error("Could not cut graphics: the provided polyline does not cut a graphic."));var n=e.graphics.map(function(e){return new esri.Graphic(e.toJson())}),s=e.graphics,o=t._splitGraphics(s,i);s.map(function(e){return t.app.event("MarkupUpdatedEvent").publish(e)}),o.map(function(i){e.graphicsLayer.add(i),t.app.event("MarkupAddedEvent").publish(i)}),e.successCallback(o,s,[]).then(function(){var i=t.app.getResource(t.libraryId,"language-feature-editing-undoable-cut"),r={app:t.app,addedGraphics:o,preUpdatedGraphics:n,updatedGraphics:s,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new g.AddAndUpdate(i,r))})},function(t){e.errorCallback(t)})}else e.errorCallback(new Error("Could not cut graphics: required polyline was not supplied."))},i.prototype._executeExplodeGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,b.Explode)){for(var i=e.graphics,r=[],a=0;a<i.length;a++)if(r[a]=u.explodeGeometry(i[a].geometry),!r[a])return void e.errorCallback(new Error("Could not explode graphics: invalid geometry."));var n=i.map(function(e){return new esri.Graphic(e.toJson())}),s=this._splitGraphics(i,r);i.map(function(e){return t.app.event("MarkupUpdatedEvent").publish(e)}),s.map(function(i){e.graphicsLayer.add(i),t.app.event("MarkupAddedEvent").publish(i)}),e.successCallback(s,i,[]).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-explode");if(!e.skipUndoManager){var a={app:t.app,addedGraphics:s,preUpdatedGraphics:n,updatedGraphics:i,graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new g.AddAndUpdate(r,a))}})}},i.prototype._executeUnionGraphicsInMemory=function(e){var t=this;if(this._validateEditInMemoryArgs(e,b.Union)){var i=e.graphics[0],r=e.graphics.map(function(e){return e.geometry});u.unionGeometries(r,this.app).then(function(r){var a=new esri.Graphic(i.toJson());i.setGeometry(r),t.app.event("MarkupUpdatedEvent").publish(i);for(var n=e.graphics.slice(1),s=0,o=n;s<o.length;s++){var l=o[s];e.graphicsLayer.remove(l),t.app.event("MarkupDeletedEvent").publish(l)}e.successCallback([],[i],n).then(function(){var r=t.app.getResource(t.libraryId,"language-feature-editing-undoable-union");if(!e.skipUndoManager){var s={app:t.app,deletedGraphics:n,preUpdatedGraphics:[a],updatedGraphics:[i],graphicsLayer:e.graphicsLayer};t.app.undoManager.add(new m.DeleteAndUpdate(r,s))}})},function(t){e.errorCallback(t)})}},i.prototype._validateEditInMemoryArgs=function(e,t){if(e.successCallback=e.successCallback||function(){return Promise.resolve()},e.errorCallback=e.errorCallback||function(){},!(e.graphicsLayer&&e.graphicsLayer instanceof esri.layers.GraphicsLayer))return e.errorCallback(new Error("Could not edit graphics: required graphics layer was not supplied.")),!1;if(!e.graphics||0===e.graphics.length)return e.errorCallback(new Error("Could not edit graphics: required graphics were not supplied.")),!1;if(t===b.Cut||t===b.Explode||t===b.Union)for(var i=0,r=e.graphics;i<r.length;i++){var a=r[i];if(a.getLayer().id!==e.graphicsLayer.id)return e.errorCallback(new Error("Could not edit graphics: graphic is not on the supplied graphics layer.")),!1;if(t===b.Union){if(a.geometry.type!==e.graphics[0].geometry.type)return e.errorCallback(new Error("Could not edit graphics: graphics are not of the same type.")),!1;if(!a.geometry.spatialReference.equals(e.graphics[0].geometry.spatialReference))return e.errorCallback(new Error("Could not edit graphics: graphics are not of the same spatial reference.")),!1}}return!0},i.prototype._splitGraphics=function(e,t){for(var i=[],r=0;r<t.length;r++){var a=e[r];a.setGeometry(t[r][0]);for(var n=1;n<t[r].length;n++)i.push(new esri.Graphic(t[r][n],a.symbol,a.attributes,a.infoTemplate))}return i},i}(r.ModuleBase);i.EditingModule=E})},"Mapping/modules/Editing/FeatureUtilities":function(){define(["require","exports","geocortex/geocortex"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getRelatedFeatures=function(e,t,r){var a=new dojo.Deferred;if(!e){n=new Error("getRelatedFeatures: mapService cannot be null.");return i.deferredReject(a,n),a}if(isNaN(t)){n=new Error("getRelatedFeatures: relationshipId cannot be null.");return i.deferredReject(a,n),a}if(!r){var n=new Error("getRelatedFeatures: objectId cannot be null.");return i.deferredReject(a,n),a}var s=new esri.tasks.RelationshipQuery;return s.outFields=["*"],s.relationshipId=t,s.objectIds=[r],e&&e.serviceLayer&&e.serviceLayer.queryRelatedFeatures?e.serviceLayer.queryRelatedFeatures(s).then(function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r))for(var n=0;n<e[r].features.length;n++)t.push(e[r].features[n]);i.deferredResolve(a,t)},function(e){i.deferredReject(a,e)}):i.deferredResolve(a,[]),a},e.getFeatureLayer=function(e){return e?e.esriFeature.get().getLayer()||e.featureLayer:null},e}();t.FeatureUtilities=r})},"Mapping/modules/Editing/RelatedLayerEntry":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Utils":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.findFeatureInLayer=function(e,t){if(!e||!t)return null;var i=t.objectIdField;e.attributes[i]&&e.attributes[i];var r=t.graphics;if(r.length<1)return null;var a=["timestamp"];if(t.editFieldsInfo)for(var n in t.editFieldsInfo)t.editFieldsInfo.hasOwnProperty(n)&&a.push(t.editFieldsInfo[n]);var s=function(e){return Array.contains(a,e)},o=function(e){var t=0;for(var i in e)!s(i)&&e.hasOwnProperty(i)&&++t;return t},l=r[0].attributes;if(o(l)!==o(e.attributes))return null;var u=0,d=[],c=[];for(var p in l){var h=s(p);if(!(h||l.hasOwnProperty(p)&&e.attributes.hasOwnProperty(p)))return null;h||(d.push(p),c.push(p),++u)}for(var g=0;g<u;++g)if(d[g]!==c[g])return null;for(var m=0;m<r.length;m++)r[m];return null},e}();t.EditingUtils=i})},"Mapping/modules/Editing/CreateOrEdit/CreateOrEditView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("HideCreateEditView").register(r,function(){r.isActive&&r.app.viewManager.deactivateView(r)}),r}return e(i,t),i.prototype.handleClickCreateNewFeature=function(e,t,i){this.viewModel.initiateCreateNewFeature()},i.prototype.handleClickSelectExistingFeature=function(e,t,i){this.viewModel.selectGeometry()},i}(r.ViewBase);i.CreateOrEditView=a})},"Mapping/modules/Editing/CreateOrEdit/CreateOrEditViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/FeatureSetCollection","geocortex/framework/observables","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/identify/MapIdentifyTask","geocortex/infrastructure/GeometryUtils","geocortex/framework/utils/utils"],function(t,i,r,a,n,s,o,l,u){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var d=function(){return function(e,t){this.featureServiceId=e.featureServiceId,this.where="{0} = '{1}'".format(e.scanResultFieldName,t.replace("'","''")),this.template={},this.template[e.scanResultFieldName]=t}}();i.CreateOrEditFeatureDescriptor=d;var c=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.geolocationEnabled=new n.Observable,r.searchRadius=new n.Observable(100),r}return e(i,t),i.prototype.initialize=function(e){e&&e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),e&&e.searchRadiusMeters&&this.searchRadius.set(e.searchRadiusMeters),this.app.command("CreateOrEditFeatureFromBarcodeScan").register(this,this._executeCreateOrEditFeatureFromBarcodeScan),this.app.command("CreateOrEditFeature").register(this,this._executeCreateOrEditFeature),this.app.command("SelectFeatureForEditing").register(this,this._findExistingFeature),this.app.event("Internal.EditorFormSetupEvent").subscribe(this,this._fillTemplateDataInForm),this.geolocationEnabled.set(navigator&&void 0!==navigator.geolocation)},i.prototype._executeCreateOrEditFeatureFromBarcodeScan=function(e){var t=this;this.app.command("LaunchBarcodeScannerWithCallback").execute(function(i){if("Success"===i.status){var r=i.content;t.app.command("CreateOrEditFeature").execute([new d(e,r)])}})},i.prototype._executeCreateOrEditFeature=function(e){var t=this;this.resultsFSC=new a.FeatureSetCollection,this.inputFeatureDescriptors=e||[],this.currentFeatureServiceDescriptor=null;for(var i=0,r=this.inputFeatureDescriptors;i<r.length;i++){var n=r[i],s=this.app.site.essentialsMap.findMapServiceById(n.featureServiceId),o=new esri.tasks.Query;o.outFields=["*"],o.where=n.where,s.queryFeatures(o,function(e,i){return function(r){t._collectSearchResults(e,i,r)}}(s,n),function(e){t.app.trace.error("Error querying for feature data: {0}".format(e.toString()))})}},i.prototype._fillTemplateDataInForm=function(e,t){if(this.currentFeatureServiceDescriptor){for(var i=e.get(),r=this.currentFeatureServiceDescriptor.template,a=0;a<i.fields.length();a++){var n=i.fields.getAt(a);for(var s in r)r.hasOwnProperty(s)&&n.name.get()===s&&n.value.set(r[s])}this.currentFeatureServiceDescriptor=null}},i.prototype._collectSearchResults=function(e,t,i){this.currentFeatureLayer=e.layers[0];var r=new s.FeatureSet({esriFeatureSet:i,layer:this.currentFeatureLayer});if(this.resultsFSC.featureSets.addItem(r),this.resultsFSC.featureSets.length()===this.inputFeatureDescriptors.length)if(1===this.resultsFSC.countFeatures()){this.app.trace.debug("Found one feature, start editing it.");var a=this.resultsFSC.firstFeature();this._startEditingFeature(a)}else this.resultsFSC.countFeatures()>1?(this.app.trace.debug("Multiple features found, select one to edit."),this.app.command("ShowSelectionListOfFeaturesWithCallback").execute(r,this._startEditingFeature)):(this.currentFeatureServiceDescriptor=t,this.app.trace.debug("Creating a new feature."),this.app.command("ActivateView").execute("CreateOrEditView"))},i.prototype.initiateCreateNewFeature=function(){this.app.command("ShowFeatureTemplatePicker").execute(this.currentFeatureLayer)},i.prototype.selectGeometry=function(){var e=this.app.toolRegistry.tool("SelectFeaturesForEditingTool");e&&e.setActive(!0)},i.prototype._findExistingFeature=function(e,t){var i=this,r=new o.MapIdentifyTask(this.app.map,this.app);r.layerRestriction=function(e){return e===i.currentFeatureLayer};var a=!1,n=function(e,t,r){if(t&&t.length>0){a=!0;var n=new esri.tasks.FeatureSet;n.features=t.map(function(e){return e.feature});var o=new s.FeatureSet({esriFeatureSet:n,layer:r.layers[0]});i.app.command("ShowSelectionListOfFeaturesWithCallback").execute(o,i._startEditingFeature)}},u=dojo.hitch(this,function(){a&&i._setSelectionToolActive(!1)}),d=function(e,t,r){i.app.trace.warning("Failed to find features: {0}".format(t.message))};if("point"===e.type){var c=new esri.SpatialReference({wkid:102100}),p=this.searchRadius.get();p=t&&t>p?t:p;var h=l.createCircle(c,e,p,60);r.execute(h,n,u,d)}else r.execute(e,n,u,d)},i.prototype._startEditingFeature=function(e){Array.isArray(e)&&(e=e[0]),this.app.command("HideCreateEditView").execute(),this.app.command("HideMultiFeatureSelectorView").execute(),this.app.command("ZoomToFeature").execute(e),this.app.command("StartEditingFeature").execute(e,!1)},i.prototype._setSelectionToolActive=function(e){var t=this.app.toolRegistry.tool("SelectFeaturesForEditingTool");t&&(u.isNullOrUndefined(e)?t.setActive(!0):t.setActive(e))},i}(r.ViewModelBase);i.CreateOrEditViewModel=c})},"Mapping/modules/Editing/CutUnion/CutInteractive":function(){define(["require","exports","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/tools/DrawMode","geocortex/infrastructure/ui/components/FeatureSelector/FeatureSelectorViewModel","../MultiFeatureSelector/MultiFeatureSelectorViewModel","./../FeatureUtilities"],function(e,t,i,r,a,n,s,o,l,u,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(e,t,i){this.INTERNAL_CUT_POLYLINE_TOOL_NAME="cutPolylineTool",this.INTERNAL_CUT_LINE_DRAW_COMPLETED_COMMAND="_cutLineDrawCompleted",this.STATUS_MESSAGE_ID="cutInteractive",this._cutLimit=10,this._cutPolylineTool=null,this._subscriptionToken=null,this.app=e,this.libraryId=t,null!=i&&void 0!==i&&(this._cutLimit=i),this._registerCutPolylineTool(),this.registerCommands()}return e.prototype.registerCommands=function(){this.app.command(this.INTERNAL_CUT_LINE_DRAW_COMPLETED_COMMAND).register(this,this._executecutLineDrawCompleted,this._canExecuteCutLineDrawCompleted),this.app.command("CutFeatureInteractive").register(this,this._executeCutFeatureInteractive,this._canExecuteCutFeatureInteractive)},e.prototype._registerCutPolylineTool=function(){var e=this;if(!this._cutPolylineTool){var t={command:this.INTERNAL_CUT_LINE_DRAW_COMPLETED_COMMAND,name:this.INTERNAL_CUT_POLYLINE_TOOL_NAME,statusText:this.app.getResource(this.libraryId,"language-feature-editing-cut-polyline-tool-status"),drawMode:l.DrawMode.POLYLINE,isSticky:!0},i=this.app.toolRegistry.createTools([t],!0);this._cutPolylineTool=i[0]||null,this._cutPolylineTool&&dojo.aspect.after(this._cutPolylineTool,"onDeactivated",function(){return e.app.command("HideFeatureSelector").execute()})}},e.prototype._activateCutPolylineTool=function(){this.app.toolRegistry.setActiveTool(this.INTERNAL_CUT_POLYLINE_TOOL_NAME),this.app.event("CutFeatureToolActivatedEvent").publish()},e.prototype._deactiveCutPolylineTool=function(){this.app.toolRegistry.getActiveTool()&&this.app.toolRegistry.getActiveTool().name===this.INTERNAL_CUT_POLYLINE_TOOL_NAME&&(this.app.toolRegistry.clearActiveTool(),this.app.event("CutFeatureToolDeactivatedEvent").publish()),this._originalFeature&&this.app.command("ClearFeatureFocus").execute(this._originalFeature)},e.prototype._performPreCutOperations=function(){this.app.command("HideFeatureDetails").execute(),this.app.command("RemoveResultsStatus").execute(),this.app.command("ZoomToFeature").execute(this._originalFeature),this.app.command("FocusFeature").execute(this._originalFeature)},e.prototype._executeCutFeatureInteractive=function(e){var t=this;this._originalFeature=e,this._originalFeatureClone=new esri.Graphic(this._originalFeature.esriFeature.get().toJson()),this._originalFeature.featureSet&&this._originalFeature.featureSet.features&&(this._indexOffeatureTobeCutInOriginalFeatureSet=this._originalFeature.featureSet.features.indexOf(this._originalFeature)),this._performPreCutOperations();var i={featureSet:new r.FeatureSet({app:this.app,esriFeatureSet:new esri.tasks.FeatureSet}),callback:function(){return t._cleanup()},onFeatureSelectorViewActivated:function(){return t.app.command("FocusFeature").execute(t._originalFeature)},onFeatureSelectorViewDeactivated:function(){return t._cleanup(!1,!1)},viewMessage:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-msg"),viewTitle:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-title"),noResultsTextHeader:this.app.getResource(this.libraryId,"language-feature-editing-cut-tool-message-header"),noResultsTextDescription:this.app.getResource(this.libraryId,"language-feature-editing-cut-tool-message-description"),buttons:[{value:d.SELECTOR_BUTTON_VALUE.CANCEL,label:this.app.getResource(this.libraryId,"language-common-cancel"),causesValidation:!1,isDefault:!0}],selectionMode:u.FEATURE_SELECTOR_MODE.SINGLE,showFilterTextBox:!1};this.app.command("ShowFeatureSelector").execute(i),this._activateCutPolylineTool(),this._monitorToolActivations()},e.prototype._canExecuteCutFeatureInteractive=function(e){if(this.app.isOffline&&this.app.isOffline.get())return!1;if(e instanceof i.Feature&&e.esriFeature&&e.esriFeature.get()){var t=e.esriFeature.get();if(t.geometry&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)){var r=e.layer.mapService.serviceLayer;if(r instanceof esri.layers.FeatureLayer&&r.isEditable&&r.isEditable()){if(!r.capabilities)return!0;var a=r.getEditCapabilities();if(a.canCreate&&a.canUpdate)return!0}}return!1}return!1},e.prototype._executecutLineDrawCompleted=function(e){var t=this;a.cutGeometry(this._originalFeature.esriFeature.get().geometry,e).then(function(e){t._showCutPreview(e)},function(e){var i=e.message,r=t.app.getResource(t.libraryId,"language-feature-editing-error-title");t.app.command("Alert").execute(i,r),t.app.trace.error(i)})},e.prototype._canExecuteCutLineDrawCompleted=function(e){return!!(e&&e instanceof esri.geometry.Polyline)},e.prototype._showCutPreview=function(e){var t=this;if(e.length<2){var i=this.app.getResource(this.libraryId,"language-feature-editing-cut-non-intersecting-polyline"),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return this.app.command("Alert").execute(i,r),void this.app.trace.error(i)}if(0!==this._cutLimit&&e.length>this._cutLimit){var i=this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-limit-error").format(this._cutLimit),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return this.app.command("Alert").execute(i,r),void this.app.trace.error(i)}this._deactiveCutPolylineTool(),this._cloneGraphicsLayer=s.getInternalGraphicsLayer(n.EDITOR_CLONE_LAYER_ID,this.app,s.GraphicsLayerType.Markup,!1),this._cloneGraphicsLayer.setRenderer(this._originalFeature.layer.mapService.serviceLayer.renderer),e.forEach(function(e){t._cloneGraphicsLayer.add(new esri.Graphic(e,t._originalFeature.esriFeature.get().symbol,t._originalFeature.esriFeature.get().attributes,t._originalFeature.esriFeature.get().infoTemplate))}),this._originalFeature.esriFeature.get().hide(),this._originalFeature.selected.get()&&(this.app.highlightManager.suppressHighlight(this._originalFeature.esriFeature.get()),this.app.highlightManager.highlightSelected(this._cloneGraphicsLayer.graphics)),this._showResultPickerToChooseMaster(this._cloneGraphicsLayer.graphics)},e.prototype._showResultPickerToChooseMaster=function(e){var t=this,a=new r.FeatureSet({app:this.app,esriFeatureSet:new esri.tasks.FeatureSet});e.forEach(function(e){return a.addFeature(new i.Feature({graphic:e,layer:t._originalFeature.layer}),!0)});var n={featureSet:a,callback:function(e,i,r){switch(r.value.get()){case d.SELECTOR_BUTTON_VALUE.OK:t._applyEdits(e[0]);break;default:t._cleanup()}},onFeatureSelectorViewDeactivated:function(){return t._cleanup(!1)},viewMessage:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-choose-master"),viewTitle:this.app.getResource(this.libraryId,"language-feature-editing-cut-pick-list-title"),errorMessage:this.app.getResource(this.libraryId,"language-feature-editing-multi-feature-selector-error-message-or-cancel"),buttons:[{value:d.SELECTOR_BUTTON_VALUE.OK,label:this.app.getResource(this.libraryId,"language-common-ok"),causesValidation:!0,isDefault:!0},{value:d.SELECTOR_BUTTON_VALUE.CANCEL,label:this.app.getResource(this.libraryId,"language-common-cancel"),causesValidation:!1,isDefault:!1}],selectionMode:u.FEATURE_SELECTOR_MODE.SINGLE,showFilterTextBox:!1};this.app.command("ShowFeatureSelector").execute(n)},e.prototype._applyEdits=function(e){var t=this,r=esri.geometry.fromJson(this._originalFeature.esriFeature.get().geometry.toJson());this._originalFeature.esriFeature.get().setGeometry(esri.geometry.fromJson(e.esriFeature.get().geometry.toJson()));var a=[this._originalFeature.esriFeature.get()],n=[];this._cloneGraphicsLayer.graphics.filter(function(t){return t!==e.esriFeature.get()}).forEach(function(e){n.push(new esri.Graphic(e.toJson()))});var s={};s.addedFeatures=n,s.updatedFeatures=a,s.deletedFeatures=[],s.layer=c.FeatureUtilities.getFeatureLayer(this._originalFeature),s.mapService=this._originalFeature.layer.mapService,s.successCallback=function(){t.app.command("_clearSavedGeometryEditHighlightId").execute();var r=e.selected.get();t.app.highlightManager.updateHighlightId(a[0]);var s={originalFeature:t._originalFeatureClone,editedFeature:a[0]};t.app.event("FeatureEditedEvent").publish(s);var o;"number"==typeof t._indexOffeatureTobeCutInOriginalFeatureSet&&(o=t._indexOffeatureTobeCutInOriginalFeatureSet+1),n.forEach(function(e){var a={};a.feature=new i.Feature({graphic:e,layer:t._originalFeature.layer}),r&&(a.feature.selected.set(!0),t.app.highlightManager.persistStarHighlights&&t.app.highlightManager.highlightSelected([a.feature])),a.originalFeature=t._originalFeature,o?(a.featureSetIndex=o,t.app.command("_AddFeatureToResultsWhenOriginalFeatureExists").execute(a),o++):(a.featureSetIndex=0,t.app.command("_AddFeatureToResultsWhenParentExists").execute(a)),t.app.event("FeatureCreatedEvent").publish(a.feature.esriFeature.get())}),t._cleanup();var l=t.app.getResource(t.libraryId,"language-feature-editing-save-success");t.app.command("AddResultsStatus").execute(l),t.app.command("ScreenReaderNarrate").execute(l)},s.errorCallback=function(e){var i=t.app.getResource(t.libraryId,"language-feature-editing-error-feature-edits").format(e.message),a=t.app.getResource(t.libraryId,"language-feature-editing-error-title");t.app.command("Alert").execute(i,a),t.app.trace.error(i),t._originalFeature.esriFeature.get().setGeometry(esri.geometry.fromJson(r.toJson())),t._cleanup()};var l=new o.AddStatusArgs(this.app.getResource(this.libraryId,"language-feature-editing-applying"),null,null,this.STATUS_MESSAGE_ID,this.CUT_SAVE_STATUS_MESSAGE_TIMEOUT,!0);this.app.command("AddStatus").execute(l),this.app.command("ApplyEdits").execute(s)},e.prototype._unsubscribeFromActiveToolChangedEvent=function(){this._subscriptionToken&&(this.app.event("ActiveToolChanged").unsubscribe(this._subscriptionToken),this._subscriptionToken=null)},e.prototype._monitorToolActivations=function(){var e=this;this._unsubscribeFromActiveToolChangedEvent(),this._subscriptionToken=this.app.event("ActiveToolChanged").subscribe(this,function(t){t&&t.tool&&t.tool.name&&"cutPolylineTool"!==t.tool.name&&e._cleanup()})},e.prototype._cleanup=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!0),this._unsubscribeFromActiveToolChangedEvent(),this._cutPolylineTool&&this._cutPolylineTool.isActive&&this._deactiveCutPolylineTool(),this.app.command("RemoveStatus").execute(this.STATUS_MESSAGE_ID),t&&(this._indexOffeatureTobeCutInOriginalFeatureSet=null,this._cloneGraphicsLayer&&(s.removeInternalGraphicsLayer(n.EDITOR_CLONE_LAYER_ID,this.app,s.GraphicsLayerType.Markup),this._cloneGraphicsLayer=null,this.app.highlightManager.clearHighlights("Editor",!0)),this._originalFeature)){this.app.highlightManager.enableHighlight(this._originalFeature.esriFeature.get());var i=c.FeatureUtilities.getFeatureLayer(this._originalFeature);i&&i.refresh(),this._originalFeature=null}e&&this.app.command("HideFeatureSelector").execute()},e}();t.CutInteractive=p})},"Mapping/modules/Editing/CutUnion/UnionInteractive":function(){define(["require","exports","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/ui/components/FeatureSelector/FeatureSelectorViewModel","../MultiFeatureSelector/MultiFeatureSelectorViewModel","./../FeatureUtilities"],function(e,t,i,r,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,i,r){this.STATUS_MESSAGE_ID="unionInteractive",this._unionLimit=10,this._subscriptionToken=null,this._checkCardinality=!0,this.app=e,this.libraryId=t,null!=i&&(this._unionLimit=i),null!=r&&(this._checkCardinality=r),this.registerCommands(),this.subscribeEvents()}return e.prototype.registerCommands=function(){this.app.command("UnionFeaturesInteractive").register(this,this._executeUnionFeaturesInteractive,this._canExecuteUnionFeaturesInteractive)},e.prototype.subscribeEvents=function(){var e=this;this.app.event("_featureRemovedFromResults").subscribe(this,function(){e.app.command("UnionFeaturesInteractive").raiseCanExecuteChanged()}),this.app.event("_featureAddedToResults").subscribe(this,function(){e.app.command("UnionFeaturesInteractive").raiseCanExecuteChanged()})},e.prototype._returnCallbackToApplyUnionEdits=function(e,t){var r=this;return function(a){r._masterFeature=a[0];var n=new esri.Graphic(r._masterFeature.esriFeature.get().toJson()),s=r._masterFeature.esriFeature.get();s.geometry=esri.geometry.fromJson(t.toJson());var o=e.features.get().map(function(e){return e.esriFeature.get()}).filter(function(e){return e!==s}),l={};l.mapService=e.layer.mapService,l.layer=e.layer.mapService.serviceLayer,l.addedFeatures=[],l.updatedFeatures=[s],l.deletedFeatures=o,l.successCallback=function(){r.app.command("_clearSavedGeometryEditHighlightId").execute(),r.app.highlightManager.updateHighlightId(s),r.app.command("ZoomToFeature").execute(r._masterFeature),o.forEach(function(e){r.app.featureSetManager.updateCollectionsOnFeatureDeletion(e),r.app.event("FeatureDeletedEvent").publish(e)}),e.layer.mapService.serviceLayer.refresh();var t={originalFeature:n,editedFeature:r._masterFeature.esriFeature.get()};r.app.event("FeatureEditedEvent").publish(t),r.app.command("UnionFeaturesInteractive").raiseCanExecuteChanged(),r._cleanup();var i=r.app.getResource(r.libraryId,"language-feature-editing-save-success");r.app.command("AddResultsStatus").execute(i),r.app.command("ScreenReaderNarrate").execute(i)},l.errorCallback=function(e){var t=r.app.getResource(r.libraryId,"language-feature-editing-error-feature-edits").format(e.message),i=r.app.getResource(r.libraryId,"language-feature-editing-error-title");r.app.command("Alert").execute(t,i),r.app.trace.error(t),r._masterFeature.esriFeature.get().setGeometry(esri.geometry.fromJson(n.geometry.toJson())),r._cleanup(null)};var u=new i.AddStatusArgs(r.app.getResource(r.libraryId,"language-feature-editing-applying"),null,null,r.STATUS_MESSAGE_ID,r.UNION_SAVE_STATUS_MESSAGE_TIMEOUT,!0);r.app.command("AddStatus").execute(u),r.app.command("ApplyEdits").execute(l)}},e.prototype._returnUnionGraphicsInMemorySuccessCallback=function(e){var t=this;return function(i,n,s){return new Promise(function(i,s){t._cloneGraphicsLayer=null,t.app.command("ZoomToFeatures").execute(e);var o={featureSet:e,callback:function(i,r,s){switch(s.value.get()){case a.SELECTOR_BUTTON_VALUE.OK:t._returnCallbackToApplyUnionEdits(e,n[0].geometry)(i);break;default:t._cleanup()}},onFeatureSelectorViewDeactivated:function(){return t._cleanup(!1)},viewTitle:t.app.getResource(t.libraryId,"language-feature-editing-union-pick-list-title"),viewMessage:t.app.getResource(t.libraryId,"language-feature-editing-union-pick-list-instructional-message"),errorMessage:t.app.getResource(t.libraryId,"language-feature-editing-multi-feature-selector-error-message-or-cancel"),buttons:[{value:a.SELECTOR_BUTTON_VALUE.OK,label:t.app.getResource(t.libraryId,"language-common-ok"),causesValidation:!0,isDefault:!0},{value:a.SELECTOR_BUTTON_VALUE.CANCEL,label:t.app.getResource(t.libraryId,"language-common-cancel"),causesValidation:!1,isDefault:!1}],selectionMode:r.FEATURE_SELECTOR_MODE.SINGLE,showFilterTextBox:!1};t.app.command("ShowFeatureSelector").execute(o),i()})}},e.prototype._shouldShowCardinalityWarning=function(e){if(e&&e.features.length){var t=n.FeatureUtilities.getFeatureLayer(e.features.get()[0]);if(t&&t.relationships&&t.relationships.length>0)for(var i=0,r=t.relationships;i<r.length;i++){var a=r[i];switch(a.cardinality){case"esriRelCardinalityManyToMany":return!0;case"esriRelCardinalityOneToOne":case"esriRelCardinalityOneToMany":if("esriRelRoleOrigin"===a.role)return!0}}}return!1},e.prototype._executeUnionFeaturesInteractive=function(e){var t=this,i=function(i){i&&t._unionFeatures(e)};this._checkCardinality&&this._shouldShowCardinalityWarning(e)?setTimeout(function(){t.app.command("Confirm").execute(t.app.getResource(t.libraryId,"language-feature-editing-union-cardinality-warning"),t.app.getResource(t.libraryId,"language-feature-editing-union-text"),i)}):this._unionFeatures(e)},e.prototype._unionFeatures=function(e){var t=this;if(this._unsubscribeFromActiveToolChangedEvent(),this._subscriptionToken=this.app.event("ActiveToolChanged").subscribe(this,this._cleanup),this.app.command("RemoveResultsStatus").execute(),0!==this._unionLimit&&e.features.get().length>this._unionLimit){var i=this.app.getResource(this.libraryId,"language-feature-editing-union-pick-list-limit-error").format(this._unionLimit),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");return this.app.command("Alert").execute(i,r),void this.app.trace.error(i)}this._originalFeatures=e.clone(),this._cloneGraphicsLayer=new esri.layers.GraphicsLayer,e.esriFeatureSet.features.forEach(function(e){var i=new esri.Graphic(e.toJson());t._cloneGraphicsLayer.add(i)});var a={};a.successCallback=this._returnUnionGraphicsInMemorySuccessCallback(e),a.graphicsLayer=this._cloneGraphicsLayer,a.graphics=this._cloneGraphicsLayer.graphics,a.errorCallback=function(e){t._cloneGraphicsLayer=null;var i=t.app.getResource(t.libraryId,"language-feature-editing-error-title");t.app.command("Alert").execute(e.message,i),t.app.trace.error(e.message)},a.skipUndoManager=!0,this.app.command("UnionGraphicsInMemory").execute(a)},e.prototype._canExecuteUnionFeaturesInteractive=function(e){if(this.app.isOffline&&this.app.isOffline.get())return!1;if(e&&e.features&&e.features.get()&&e.features.get().length>1){var t=e.esriFeatureSet.features;if(0===t.length)return!1;var i=e.layer.mapService.serviceLayer;if(i&&i instanceof esri.layers.FeatureLayer&&i.isEditable&&i.isEditable()){if(i.capabilities){var r=i.getEditCapabilities();if(!r.canDelete||!r.canUpdate)return!1}var a=t[0];if(!a)return!1;if(a.geometry&&"polygon"!==a.geometry.type&&"polyline"!==a.geometry.type)return!1;for(var n=1;n<t.length;n++)if(a.geometry.type!==t[n].geometry.type||!a.geometry.spatialReference.equals(t[n].geometry.spatialReference))return!1;return!0}}return!1},e.prototype._unsubscribeFromActiveToolChangedEvent=function(){this._subscriptionToken&&(this.app.event("ActiveToolChanged").unsubscribe(this._subscriptionToken),this._subscriptionToken=null)},e.prototype._cleanup=function(e){void 0===e&&(e=!0),this._unsubscribeFromActiveToolChangedEvent(),this._cloneGraphicsLayer=null,this.app.command("RemoveStatus").execute(this.STATUS_MESSAGE_ID),this.app.highlightManager.clearHighlights("Editor",!0);var t=!!this._masterFeature&&this._masterFeature.selected.get();this._originalFeatures&&this.app.highlightManager.clearSelected(this._originalFeatures.features.getItems().filter(function(e){return e.selected.get()})),this._masterFeature&&this.app.highlightManager.persistStarHighlights&&t&&(this.app.highlightManager.highlightSelected([this._masterFeature]),this._masterFeature.selected.set(!0)),this._originalFeatures=null,this._masterFeature=null,e&&this.app.command("HideFeatureSelector").execute()},e}();t.UnionInteractive=s})},"Mapping/modules/Editing/Editor/EditorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./EditorViewModel","geocortex/infrastructure/Feature","geocortex/infrastructure/BrowserUtils","geocortex/framework/observables","geocortex/infrastructure/FormatUtils"],function(t,i,r,a,n,s,o,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var u=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._attachmentWarningViewed=!1,e}return e(i,t),i.prototype.attach=function(e){var i=this;t.prototype.attach.call(this,e),this.isBusy.sync(e.isBusy),this.title.syncTransform(e.headerText,function(e){return String.unescapeHtml(e)}),this.app.event("ApplicationOfflineEvent").subscribe(this,this.cancelEditing),this.app.event("ApplicationOnlineEvent").subscribe(this,this.cancelEditing),this.app.event("FeatureDeletedEvent").subscribe(this,this._onFeatureDeletedEvent),this.app.event("RelatedRecordDeletedEvent").subscribe(this,this._onRelatedRecordDeletedEvent),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._onGeometryEditCompletedEvent),this.app.command("ShowFeatureAttributeEditor").register(this,function(){i._activateView()}),this.app.command("HideFeatureAttributeEditor").register(this,function(){return i.isActive&&i._deactivateView(),!1}),this.app.command("_CancelEditing").register(this,this._executeCancelEditing,this._canExecuteCancelEditing)},i.prototype._executeCancelEditing=function(){this.cancelEditing()},i.prototype._canExecuteCancelEditing=function(){return this.viewModel.editingInProgress()},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel.isEditingGeometry.get()&&this.cancelEditing()},i.prototype.handleTakeNativePhotoCamera=function(){s.handleTakeNativePhotoCamera(this.viewModel.handleFileFromBrowser.bind(this.viewModel))},i.prototype.handleTakeNativePhotoGallery=function(){s.handleTakeNativePhotoGallery(this.viewModel.handleFileFromBrowser.bind(this.viewModel))},i.prototype.handleTypeFieldChange=function(e,t,i){this.viewModel.handleTypeFieldSelected(i)},i.prototype.handleClickEditGeometry=function(e,t,i){return this.viewModel.handleClickEditGeometry()},i.prototype.handleClickDeleteFeature=function(e,t,i){return this.viewModel.state===a.EditorState.EditingGeometry&&this.viewModel.stopEditingGeometry(),this.viewModel.confirmDelete(),!1},i.prototype.handleClickSave=function(e,t,i){var r=this;return this.viewModel.state===a.EditorState.EditingGeometry&&this.viewModel.stopEditingGeometry(),this.isBusy.set(!0),this.viewModel.save(function(){return r.saveSuccessCallback()},function(e){return r.saveErrorCallback(e)}),!1},i.prototype.handleFileSelect=function(e){var t=this;if(e.target.files&&window.FileReader){var i=this.app.nativeManager.isNative()?null:"_blank",r=e.target.files;Array.prototype.slice.call(r).forEach(function(e){var r=new FileReader;r.onload=function(r){var a={name:new o.Observable(e.name),url:new o.Observable(r.target.result),canEditAttachments:!0,size:l.formatBytes(e.size),target:i,type:e.type};t.viewModel.attachmentInfos.addItem(a),t.viewModel.attachmentsToAdd.addItem(a),t.viewModel.noAttachments.set(!1),t.fileInputElement.value=null},r.readAsDataURL(e)})}},i.prototype.handleDeleteClick=function(e,t,i){i.attachmentId?(this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-feature-editing-attachment-warning")),this.viewModel.attachmentsToRemove.addItem(i)):this.viewModel.attachmentsToAdd.removeItem(i),this.viewModel.attachmentInfos.removeItem(i),0===this.viewModel.attachmentInfos.getLength()&&this.viewModel.noAttachments.set(!0)},i.prototype.handleFileKeypress=function(e){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.fileInputElement.click())},i.prototype.attachment_click=function(e,t,i){var r=this;if(!(4*Math.ceil(i.url.get().length/3)/1e3>512))return this.app.isOffline.get()?(this.app.command("RewriteUrlForOffline").execute(i.url.get(),function(e){if(e)return r.app.command("OpenWebPage").execute({url:e,element:t});r.app.command("Alert").execute(r.getResource("language-feature-details-attachment-not-available-offline"))}),!1):this.app.followNavigationLink({url:i.url.get(),element:t})},i.prototype.saveSuccessCallback=function(){this._deactivateView()},i.prototype.saveErrorCallback=function(e){},i.prototype.cancelEditing=function(){this.viewModel.cancelEditing(),this.isActive&&this._deactivateView()},i.prototype._activateView=function(){this.app.command("ActivateView").execute(this.id)},i.prototype._deactivateView=function(e){void 0===e&&(e=!0),this.app.command("DeactivateView").execute(this.id),this.app.event("_internalEvent.EditorViewDeactivated").publish(this.viewModel.currentFeatureEsriClone)},i.prototype._onFeatureDeletedEvent=function(e){this.viewModel&&this.viewModel.currentFeatureEsri&&this.viewModel.currentFeatureEsri===e&&(this._deactivateView(!1),this.viewModel.currentFeatureEsriClone.hide())},i.prototype._onRelatedRecordDeletedEvent=function(){this._deactivateView()},i.prototype._onGeometryEditCompletedEvent=function(e){var t=null;t=e.cancelled?new n.Feature({graphic:e.editedGraphic}):new n.Feature({graphic:e.originalGraphic}),this.app.behavior("EditorFeatureSelectedBehavior").run(t)},i.prototype.handleClickCancel=function(e,t,i){return this.cancelEditing(),!1},i.prototype.handleInputFocus=function(e,t,i){i.showActualValue()},i.prototype.handleInputBlur=function(e,t,i){i.showFormattedValue()},i}(r.ViewBase);i.EditorView=u})},"Mapping/modules/Editing/Editor/EditorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./Form/EditingFormViewModel","geocortex/infrastructure/Feature","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/EditingUtils","./../FeatureUtilities","geocortex/geocortex","geocortex/infrastructure/tools/MapTool","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/MapUtils","geocortex/framework/utils/ArrayUtils","geocortex/essentials/utilities/TimeZoneUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/HighlightManager","geocortex/infrastructure/EditingUtils","geocortex/framework/utils/utils","geocortex/infrastructure/BrowserUtils"],function(t,i,r,a,n,s,o,l,u,d,c,p,h,g,m,f,y,v,b,E,_,F,w){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var C;!function(e){e[e.Idle=0]="Idle",e[e.Paused=1]="Paused",e[e.CantEdit=2]="CantEdit",e[e.EditingAttributes=3]="EditingAttributes",e[e.EditingGeometry=4]="EditingGeometry",e[e.Saving=5]="Saving"}(C=i.EditorState||(i.EditorState={}));var I=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.state=C.Idle,r.isBusy=new a.Observable(!1),r.title=new a.Observable(""),r.headerText=new a.Observable(""),r.busyText=new a.Observable(""),r.form=new a.Observable,r.isEditingGeometry=new a.Observable(!1),r.isEditingNewFeature=new a.Observable(!1),r.isEditingLogEntry=new a.Observable(!1),r.isEditingRelatedFeature=new a.Observable(!1),r.isEditingRelatedFeatureNotInSite=new a.Observable(!1),r.isUploadingAttachment=new a.Observable(!1),r.currentFeatureRelationships=new a.ObservableCollection,r.hasRelatedLayers=new a.Observable(!1),r.hasEditableAttachments=new a.Observable(!1),r.attachmentInfos=new a.ObservableCollection,r.attachmentsToAdd=new a.ObservableCollection,r.attachmentsToRemove=new a.ObservableCollection,r.isAttachmentInfosInitialized=new a.Observable(!1),r.noAttachments=new a.Observable(!1),r.isOffline=new a.Observable(!1),r.browserFileAPISupported=new a.Observable(!1),r.showRelatedLayers=new a.Observable(!1),r.canDeleteFeature=new a.Observable(!0),r.canEditGeometry=new a.Observable(!1),r.showEditGeometryButton=new a.Observable(!1),r.showStopEditingGeometryButton=new a.Observable(!1),r.geometryHasBeenEdited=new a.Observable(!1),r.validateGeometry=!1,r.configAllowsEditGeometry=!0,r.layerUpdateEndToken=null,r.textareaThreshold=80,r.canEditOffline=!1,r.doNotAdjustTime=!1,r._registerCommands(),r._subscribeToEvents(),r.isEditingNewFeature.bind(r,r._calculateCanDeleteFeature),r.auto(r.hasRelatedLayers,r,r._hideOrShowRelateds),r.auto(r.isEditingRelatedFeatureNotInSite,r,r._hideOrShowRelateds),r.browserFileAPISupported.set(w.isFileApiSupported()),r.applyingEditText=r.app.getResource(r.libraryId,"language-feature-editing-applying"),r.uploadingAttachmentText=r.app.getResource(r.libraryId,"language-feature-editing-upload-attachment"),r.deletingAttachmentText=r.app.getResource(r.libraryId,"language-feature-editing-delete-attachment"),r}return e(i,t),i.prototype.initialize=function(e){var t=this;e&&(e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),this.validateGeometry=!!e.validateGeometry,this.configAllowsEditGeometry=void 0!==e.editGeometry?!!e.editGeometry:this.configAllowsEditGeometry,this.textareaThreshold=void 0!==e.textareaThreshold?parseInt(e.textareaThreshold,10):this.textareaThreshold,this.doNotAdjustTime=void 0!==e.doNotAdjustTime?!!e.doNotAdjustTime:this.doNotAdjustTime),this.app.nativeManager.hasNativeCapability("editing").then(function(e){t.canEditOffline=e})},i.prototype._registerCommands=function(){var e=this;this.app.command("StartEditingFeature").register(this,this._executeStartEditingFeature,this._canExecuteStartEditingFeature),this.app.command("StartEditingNewFeature").register(this,this._executeStartEditingNewFeature,this._canExecuteStartEditingNewFeature),this.app.command("StartEditingEditLogEntry").register(this,this._executeStartEditingEditLogEntry,this._canExecuteStartEditingEditLogEntry),this.app.command("StartEditingNewRelatedRecord").register(this,this._executeStartEditingRelatedRecord),this.app.command("StartEditingGraphicGeometry").postExecute.subscribe(this,this._onStartEditingGraphicGeometry),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._onGeometryEditCompletedEvent),this.app.command("StartAddingFeatureGeometry").register(this,this._executeStartAddingFeatureGeometry,this._canExecuteStartEditingNewFeature),this.app.command("Internal.CancelEditingIfNotIdle").register(this,function(){e.state!==C.Idle&&e.cancelEditing()}),this.app.command("StartEditingAttributesAndGeometryFeature").register(this,this._executeStartEditingAttributesAndGeometryFeature,this._canExecuteStartEditingFeature)},i.prototype._executeStartAddingFeatureGeometry=function(e,t){this.app.command("StartEditingNewFeature").execute(e,t)},i.prototype._subscribeToEvents=function(){this.app.event("GeometryEditInvokedEvent").subscribe(this,this._handleGeometryEditInvokedEvent),this.app.event("GeometryEditCompletedEvent").subscribe(this,this._handleGeometryEditCompletedEvent),this.app.event("GeolocatedEvent").subscribe(this,this._handleGeolocation),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChangedEvent)},i.prototype.performValidation=function(){var e=!0;return this.form.get().clearValidationMessages(),e=this.performFormValidation()&&e,this.validateGeometry&&(e=this.performGeometryValidation()&&e),e},i.prototype.performFormValidation=function(){for(var e=!0,t=this.form.get(),i=0;i<t.fields.getLength();++i){var r=t.fields.getAt(i);try{if(r.validationFunc){var a=r.validationFunc(r.value.get());a&&(e=!1,t.addValidationMessage(a))}}catch(e){this.app.trace.warning("Error validating field {0}: {1}".format(r.displayName,e))}}return e},i.prototype.performGeometryValidation=function(){var e=!0,t=this.form.get(),i=this.currentFeatureEsriClone;return i.geometry&&"polygon"===i.geometry.type&&o.isSelfIntersectingPolygon(i.geometry)&&(t.addValidationMessage(this.app.getResource(this.libraryId,"language-feature-editing-self-intersecting-polygon-need-fixing")),e=!1),e},i.prototype.confirmDelete=function(){var e=this;this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-feature-editing-delete-confirmation"),this.app.getResource(this.libraryId,"language-feature-editing-module-title"),function(t){if(t){var i=!1;e._preventDeleteForRelOrigin(e.currentFeatureRelationships,function(){e.app.command("Alert").execute(e.app.getResource(e.libraryId,"language-feature-editing-delete-with-relation-forbidden"),e.app.getResource(e.libraryId,"language-feature-editing-module-title")),i=!0},function(){i||(e.stopEditingGeometry(),e.deleteCurrentFeature())})}})},i.prototype.deleteCurrentFeature=function(e,t){var i=this,r=this.currentFeatureEsri,a=this.currentFeatureGeocortex,n=r.getLayer()||this._sourceLayer,s=this._getMapServiceByLayer(n);if(!s){var o=void 0,l=this._relatedFeature,u=this._editingRelationshipOrigin,d=this._editingRelationshipDestination;return o={mapService:this.currentMapService,layer:n,feature:r,relatedFeature:l,relationshipOrigin:u,relationshipDestination:d,successCallback:function(){i._deleteFeatureSuccessCallback(r,n,e)},errorCallback:function(e){i._deleteFeatureErrorCallback(e,n,t)}},this.isBusy.set(!0),this.busyText.set(this.applyingEditText),this.app.command("DeleteRelatedRecord").execute(o),void this.app.event("RelatedRecordDeletedEvent").publish()}var c={mapService:s,layer:n,feature:r,successCallback:function(){a.selected.get()&&(a.selected.set(!1),i.app.highlightManager.clearSelected([c.feature])),i.app.highlightManager.clearAllHighlight([c.feature]),i._deleteFeatureSuccessCallback(r,n,e)},errorCallback:function(e){i._deleteFeatureErrorCallback(e,n,t)}};this.isBusy.set(!0),this.busyText.set(this.applyingEditText),this.app.command("DeleteFeature").execute(c)},i.prototype.handleFileFromBrowser=function(e){},i.prototype._deleteFeatureErrorCallback=function(e,t,i){var r=this.app.getResource(this.libraryId,"language-feature-editing-error-feature-edits").format(e),a=this.app.getResource(this.libraryId,"language-feature-editing-error-title");this.app.command("Alert").execute(r,a),this.app.trace.error(r),this.isBusy.set(!1),this.busyText.set("")},i.prototype._deleteFeatureSuccessCallback=function(e,t,i){this._handleDeletedFeature(e),this.app.event("FeatureDeletedEvent").publish(e),t&&t.remove&&t.remove(e),this.app.command("ShowMap").execute(),this.currentFeatureEsriClone.hide(),this._destroyEditingLayer(),this._sourceLayer.refresh&&this._sourceLayer.refresh(),this.app.command("ShowFeatureParentDetails").execute(),i&&i(),this.isBusy.set(!1),this.busyText.set("")},i.prototype._buildFeatureRelationships=function(){this.currentFeatureRelationships.clear();for(var e,t=this.currentFeatureEsri,i=this._sourceLayer,r=this.currentMapService,a=0,n=i.relationships;a<n.length;a++){var s=n[a];if(!r||!(e=r._getRelation(s.id))||e.visible){var o=!0;if(s.role){if("esriRelRoleOrigin"!==s.role)continue}else o=!1;var l=s.name;F.isNullOrUndefined(e)||(l=e.displayName);var u=this.app.getResource(this.libraryId,"language-feature-editing-create-related-feature").format(l),d={id:s.id,text:u,editable:o,relatedFeature:t,relationship:s};this.currentFeatureRelationships.addItem(d)}}this.hasRelatedLayers.set(this.currentFeatureRelationships.getLength()>0)},i.prototype._preventDeleteForRelOrigin=function(e,t,i){var r=this,a=this.currentFeatureEsri,n=this._sourceLayer,s=null,o=!1;if(a&&n&&e&&e.length()>0&&(s=e.length(),n))for(var u=0;u<e.length();u++)!function(u){var c=function(){--s<=0&&i&&i()},p=e.getAt(u);p.relationship&&"esriRelRoleOrigin"===p.relationship.role&&!1===p.relationship.composite?function(e){var i=parseInt(e.id,10),s=e.relatedTableId?e.relatedTableId.get():e.relationship.relatedTableId,u=n.url||n._essentialsMetadata.serviceUrl,p=r._getMapServiceByLayer(n),h=new esri.tasks.RelationshipQuery;h.objectIds=[a.attributes[n.objectIdField]],h.outFields=["*"],h.relationshipId=i;l.getQueryTask(n,p);d.FeatureUtilities.getRelatedFeatures(r._getMapServiceByLayer(n),i,h.objectIds[0]).then(function(e){var i=!1;for(var a in e)if(e.hasOwnProperty(a)){i=!0;break}i?r._getRelatedFeatureLayer(s,u,function(i){if(!o){var r=[];for(var a in e)if(e.hasOwnProperty(a)){var n=e[a].features||e[a];if(n)if(n.length)for(var s=0,l=n;s<l.length;s++){var u=l[s];r.push(u)}else r.push(n)}r.length>0&&t&&(t(r),o=!0),c()}},function(e){c()}):c()},function(e){c()})}(p):p.relationship.composite&&c()}(u);(!s||s<=0)&&i&&i()},i.prototype._getMapServiceByLayer=function(e){var t=e.url,i=t.indexOf("?token=");-1!==i&&(t=t.substring(0,i));for(var r=0,a=this.app.site.essentialsMap.mapServices;r<a.length;r++){var n=a[r];if(n.serviceUrl.split("?")[0]===t)return n}return null},i.prototype._getRelatedFeatureLayer=function(e,t,i,r){var a=new dojo.Deferred,n=t.match(/token=.[^&]*/g),s=t.substring(0,t.lastIndexOf("/")+1)+e;n&&(s+="?"+n);var o=new esri.layers.FeatureLayer(s,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});return dojo.connect(o,"onLoad",dojo.hitch(this,function(e){c.deferredResolve(a,e),"function"==typeof i&&i(e)})),dojo.connect(o,"onError",dojo.hitch(this,function(e){c.deferredReject(a,e),"function"==typeof r&&r(e)})),a},i.prototype._getMapServiceForRelatedRecord=function(e){for(var t=0,i=this.app.site.getFeatureServices();t<i.length;t++){for(var r=i[t].serviceLayer,a=0,n=r.relationships;a<n.length;a++)if(n[a]===e.relationship)return this._sourceLayer=r,void this._calculateCanDeleteFeature();if(r.layerId===e.relationship.relatedTableId)for(var s=0,o=r.fields;s<o.length;s++)o[s].name===e.relationship.keyField&&(this._sourceLayer=r)}this._sourceLayer||this.app.trace.warning("Could not find a proper source layer.");var l=this._getMapServiceByLayer(this._sourceLayer);return l||this.app.trace.warning("Could not edit related feature. No map service for layer '{0}' was found.".format(this._sourceLayer.url)),l},i.prototype._getRelatedKeyFieldForRelatedRecords=function(e,t){if(e.relationship.keyField){for(var i=null,r=0,a=t.relationships;r<a.length;r++){var n=a[r];if(n.id===e.relationship.id){this._editingRelationshipDestination=n,i=n.keyField;break}}return i||void this.app.trace.error(this.app.getResource(this.libraryId,"language-feature-editing-relationships-key-field-missing"))}this.app.trace.error(this.app.getResource(this.libraryId,"language-feature-editing-relationships-require-arcgis-version"))},i.prototype._setupViewForRelatedRecordCreationAndEditing=function(e,t,i){this._editingRelationshipOrigin=e.relationship,this.canEditGeometry.set(this.configAllowsEditGeometry&&!!t.geometryType),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.showStopEditingGeometryButton.set(!1),this.currentFeatureEsri=i,this.currentFeatureEsriClone=this._cloneEsriFeature(this.currentFeatureEsri),this.form.set(new n.EditingFormViewModel(this.app,this.libraryId,i,t,{textareaThreshold:this.textareaThreshold,doNotAdjustTime:this.doNotAdjustTime,timeZoneId:e.timeZoneId,displayTimeZoneId:e.displayTimeZoneId})),this.app.event("Internal.EditorFormSetupForRelatedFeatureEvent").publish(this.form,i)},i.prototype._renderRelatedRecordEditingTable=function(e,t,i){for(var r=!1,a=0;a<this.form.get().fields.getLength();++a){var n=this.form.get().fields.getAt(a);if(n.name.get()===t){if("objectid"!==t.toLowerCase()&&"globalid"!==t.toLowerCase()){e.feature?(n.value.set(e.feature.attributes[t]),e.relationship.keyField in i.attributes&&(i.attributes[e.relationship.keyField]=e.feature.attributes[e.relationship.keyField]||e.feature.attributes[t])):e.relatedFeature&&(n.value.set(e.relatedFeature.attributes[e.relationship.keyField]),e.relationship.keyField in i.attributes&&(i.attributes[e.relationship.keyField]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t]));continue}n.editable.set(!1)}}!0===this.isEditingNewFeature.get()&&(t in i.attributes&&(i.attributes[t]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t],r=!0),0!==this.form.get().fields.getLength()&&!1!==r||(i.attributes[t]=e.relatedFeature.attributes[e.relationship.keyField]||e.relatedFeature.attributes[t]))},i.prototype._executeStartEditingRelatedRecord=function(e,t){var i=this;this.isEditingNewFeature.set(t),this.isEditingRelatedFeature.set(!0),this._relatedFeature=e.relatedFeature;var r=null;if(this.app.map.getLayersVisibleAtScale().forEach(function(t){var i=t;i.layerId&&i.layerId===e.relationship.relatedTableId&&i.fields[e.relationship.keyField]&&(r=i)}),r){this.isEditingRelatedFeatureNotInSite.set(!1);var a=this._getMapServiceByLayer(r);this.currentMapService=a,this._refreshRelatedRecord(e,r)}else{if(this.isEditingRelatedFeatureNotInSite.set(!0),e.essentialsRelatedFeature){if(e.essentialsRelatedFeature.layer.getRelatedFeatureLayer)return void e.essentialsRelatedFeature.layer.getRelatedFeatureLayer(e.relationship.id,function(t){i._refreshRelatedRecord(e,t)},function(e){i.app.trace.error("Error in getting related feature layer: "+e)});var n=this._getMapServiceForRelatedRecord(e);return this.currentMapService=n,void this._refreshRelatedRecord(e,n.serviceLayer)}r=this.currentFeatureGeocortex.featureLayer,this.currentMapService=null,this._refreshRelatedRecord(e,r)}},i.prototype._refreshRelatedRecord=function(e,t){var i=this;e.feature?this._refreshEsriGraphic(e.feature,t).then(function(r){null!=r&&r.features&&r.features.length>0?e.feature=r.features[0]:i.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),i._displayEditorForRelatedFeatures(e,t)}).caught(function(r){i.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),i._displayEditorForRelatedFeatures(e,t)}):this._displayEditorForRelatedFeatures(e,t)},i.prototype._displayEditorForRelatedFeatures=function(e,t){e.text?this.headerText.set(e.text):this.headerText.set(this.app.getResource(this.libraryId,"language-feature-editing-new-related-feature-default")),this.state!==C.Idle&&this.cancelEditing(),this._sourceLayer=t,this._calculateCanDeleteFeature();var i={};t.fields.forEach(function(e){var t=e.name;i[t]=null});var r=null;this.isEditingNewFeature.get()?(r=this._createNewEsriFeature(null,i,null,null)).setGeometry(null):r=e.feature,this._setupViewForRelatedRecordCreationAndEditing(e,t,r);var a=this._getRelatedKeyFieldForRelatedRecords(e,t);if(this._renderRelatedRecordEditingTable(e,a,r),this.isEditingNewFeature.get()&&"Table"!==this._sourceLayer.type){for(var n=void 0,s=0,o=this.app.site.getFeatureServices();s<o.length;s++)for(var l=0,u=o[s].layers;l<u.length;l++){var d=u[l];if(d.id===e.relationship.relatedTableId.toString()&&d.name===e.relationship.name){n=d;break}}this.app.command("ShowFeatureTemplatePicker").execute(n,r)}else this._activateEditingView()},i.prototype.startEditingGeometry=function(){if(!this.currentFeatureEsri)throw new Error("Could not edit geometry - no feature selected.");this.app.command("StartEditingGraphicGeometry").execute(this.currentFeatureEsriClone,this._sourceLayer)},i.prototype.stopEditingGeometry=function(e){void 0===e&&(e=!1),this.app.command("StopEditingGraphicGeometry").execute(e)},i.prototype._onStartEditingGraphicGeometry=function(e,t){this.state===C.Idle||!e||e!==this.currentFeatureEsri&&e!==this.currentFeatureEsriClone||this.currentFeatureEsriClone.hide();var i=this.app.toolRegistry.getActiveTool();i instanceof p.MapTool&&"EditingPointTool"===i.name&&this.app.event("GeometryEditPointActivatedEvent").publish()},i.prototype._onGeometryEditCompletedEvent=function(e){if(this.state!==C.Idle&&this.currentFeatureEsriClone&&(this.currentFeatureEsri===e.originalGraphic||this.currentFeatureEsriClone===e.originalGraphic)){e.cancelled||this.currentFeatureEsri!==e.originalGraphic||this.currentFeatureEsriClone.setGeometry(e.editedGraphic.geometry),this.app.command("HideFeatureTemplatePicker").execute(),this.app.command("HideCreateEditView").execute(),this.app.command("ShowFeatureAttributeEditor").execute(),this.currentFeatureEsriClone.show();var t=new s.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(t)}},i.prototype._handleGeolocation=function(e){var t=this,i=function(){t.currentFeatureEsriClone.setGeometry(e.projectedMapPoint),t.app.event("GeometryEditCompletedEvent").publish({editedGraphic:t.currentFeatureEsriClone,originalGraphic:t.currentFeatureEsri,cancelled:!1}),setTimeout(function(){return t.app.command("GeolocateStop").execute()},0),t.app.command("StopEditingGraphicGeometry").execute();var i=new s.Feature({graphic:t.currentFeatureEsriClone});t.app.behavior("EditorFeatureSelectedBehavior").run(i)},r=this.app.toolRegistry.getActiveTool(),a=this.isEditingNewFeature.get()&&"esriGeometryPoint"===this._sourceLayer.geometryType&&r&&"EditingPointTool"===r.name,n=e&&"single"===e.typeOfGeolocation&&e.location;a&&n&&(e.location.coords.accuracy<=e.accuracyThreshold?i():this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-feature-editing-confirm-low-accuracy-geolocation").format(h.formatNumber(e.location.coords.accuracy,g.NumberFormat.DEFAULT,{fractionalDigits:0}),this.getResource("language-common-ok")||"'OK'",this.getResource("language-common-cancel")||"'Cancel'"),this.app.getResource(this.libraryId,"language-feature-editing-confirm-low-accuracy-geolocation-title"),function(e){e?i():setTimeout(function(){return t.app.command("GeolocateStop").execute()},0)}))},i.prototype._createEditingLayer=function(){return this._destroyEditingLayer(),this._editingLayer=b.getInternalGraphicsLayer(v.EDITOR_CLONE_LAYER_ID,this.app,b.GraphicsLayerType.Markup,!1),this._sourceLayer&&this._editingLayer.setRenderer(this._sourceLayer.renderer),this._editingLayer},i.prototype._destroyEditingLayer=function(){this.currentFeatureEsriClone&&(this.currentFeatureEsriClone.hide(),this._editingLayer&&this._editingLayer.remove(this.currentFeatureEsriClone)),this._editingLayer&&(this._editingLayer.clear(),b.removeInternalGraphicsLayer(v.EDITOR_CLONE_LAYER_ID,this.app,b.GraphicsLayerType.Markup),this._editingLayer=null)},i.prototype._createNewEsriFeature=function(e,t,i,r){var a=new esri.Graphic(null);return a.attributes=t||{},a.geometry=e||new esri.geometry.Point(NaN,NaN),a.symbol=i||null,a.infoTemplate=r||null,a},i.prototype._handleLayerVisualizationChangedEvent=function(e){if(e.mapService&&e.mapService.serviceLayer&&this._sourceLayer&&e.mapService.serviceLayer.id===this._sourceLayer.id&&e.mapService.serviceLayer.renderer){var t=e.mapService.serviceLayer.renderer;this.currentFeatureEsriClone&&this.currentFeatureEsriClone.setSymbol(t.getSymbol(this.currentFeatureEsri)),this._editingLayer&&this._editingLayer.setRenderer(t)}},i.prototype.save=function(e,t){var i=this;this.stopEditingGeometry();var r=this.performValidation();if(this.isBusy.set(!1),this.busyText.set(""),r){this.state=C.Saving,this.isBusy.set(!0),this.busyText.set(this.applyingEditText);var a=this.currentFeatureEsri,n=this._sourceLayer,s=new esri.Graphic(this.currentFeatureEsriClone.toJson());try{var o=this.form.get().getAttributeValues(),l=null,d=void 0;if(this.isEditingNewFeature.get()){l=o;for(d in a.attributes)a.attributes.hasOwnProperty(d)&&(l.hasOwnProperty(d)||null==a.attributes[d]||(l[d]=a.attributes[d]))}else{l={};for(d in o)o.hasOwnProperty(d)&&a.attributes[d]!==o[d]&&(l[d]=o[d]);var c=n.objectIdField,p=n.globalIdField;a.attributes.hasOwnProperty(c)&&(l[c]=a.attributes[c]),a.attributes.hasOwnProperty(p)&&(l[p]=a.attributes[p])}u.findCardinalityConflict(this.app,n,l).then(function(r){if(r)return i.app.command("Alert").execute(i.app.getResource(i.libraryId,"language-feature-editing-cardinality-violation").format(r.value,r.key),i.app.getResource(i.libraryId,"language-feature-editing-error-dialogue")),i.state=C.Idle,i.isBusy.set(!1),void i.busyText.set("");s.attributes=l,i.geometryHasBeenEdited.get();var a=null;if(!i.isEditingRelatedFeatureNotInSite.get()&&!(a=i._getMapServiceByLayer(n)))throw new Error("Could not find map service for feature layer while saving.");i.isBusy.set(!0),i.busyText.set(Object.keys(l).length>0?i.applyingEditText:"");var o={mapService:a,layer:n,feature:s,successCallback:function(){i._handleSaveAttachments(s,n).then(function(){i._handleSaveSuccess(s,n,e,t)})},errorCallback:function(e){i.isBusy.set(!1),i.busyText.set(""),i._handleSaveError(e,t)}};try{i.app.event("Internal.EditorFormPreSaveEvent").publish(i.form,o)}catch(e){return}if(i.isEditingRelatedFeature.get()){var u=o;u.relatedFeature=i._relatedFeature,u.relationshipOrigin=i._editingRelationshipOrigin,u.relationshipDestination=i._editingRelationshipDestination,i.isEditingNewFeature.get()?(u.successCallback=function(){i._handleSaveAttachments(s,n).then(function(){i.app.event("RelatedRecordCreatedEvent").publish(s),i._handleSaveSuccess(s,n,e,t)})},i.app.command("CreateRelatedRecord").execute(u)):(u.successCallback=function(){i._handleSaveAttachments(s,n).then(function(){i.app.event("RelatedRecordCreatedEvent").publish(s),i._handleSaveSuccess(s,n,e,t)})},i.app.command("UpdateRelatedRecord").execute(u))}else i.isEditingNewFeature.get()?(i.app.event("EditorPreCreateFeatureEvent").publish(s),i.app.command("CreateFeature").execute(o)):(i.app.event("EditorPreUpdateFeatureEvent").publish(s),i.app.command("UpdateFeature").execute(o));i.state=C.Saving}).catch(function(e){throw new Error(e)})}catch(e){this.state=C.Idle,this.isBusy.set(!1),this.busyText.set(""),this.app.trace.error("Error applying edits: {0}".format(e))}}},i.prototype._handleSaveError=function(e,t){this.isBusy.set(!1),this.busyText.set(""),this.state=C.Idle;var i=this.app.getResource(this.libraryId,"language-feature-editing-error-feature-edits").format(e),r=this.app.getResource(this.libraryId,"language-feature-editing-error-title");this.app.command("Alert").execute(i,r),this.app.trace.error(i),t&&t(e)},i.prototype._handleSaveAttachments=function(e,t){var i=this;return this._handleAddAttachments(e,t).then(function(){return i._handleDeleteAttachments(e,t)})},i.prototype._handleSaveSuccess=function(e,t,i,r){this.isBusy.set(!1),this.busyText.set(""),this.layerUpdateEndToken&&(dojo.disconnect(this.layerUpdateEndToken),this.layerUpdateEndToken=null);var a=m.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer);if(a&&this.originalFeatureClone){var n=e.attributes;a.attributes={},dojo.mixin(a.attributes,this.originalFeatureClone.attributes),dojo.mixin(a.attributes,n),dojo.mixin(e.attributes,a.attributes),a.show()}if(this._editingLayer&&this._destroyEditingLayer(),this.originalFeatureClone&&a){var o={originalFeature:this.originalFeatureClone,editedFeature:a};this._handleEditedFeature(o),this.app.event("FeatureEditedEvent").publish(o)}else this.originalFeatureClone&&this.isEditingNewFeature.get()&&this.app.event("FeatureCreatedEvent").publish(e);if(this.isEditingNewFeature.set(!1),this.state=C.Idle,t&&t.refresh(),this.isEditingRelatedFeatureNotInSite.get()){var l=this.findGeocortexLayerForUrl(t.url),u=new s.Feature({graphic:e,layer:l});this.headerText.set(u.plainLabel.get())}this.cancelEditing(),i&&i()},i.prototype._handleAddAttachments=function(e,t){for(var i=this,r=[],a=0,n=this.attachmentsToAdd.getItems();a<n.length;a++)!function(a){var n={data:decodeURIComponent(a.url.get().substring(a.url.get().indexOf("base64,")+7)),fileName:a.name.get(),fileType:a.type};r.push(new Promise(function(r){i.busyText.set(i.uploadingAttachmentText),_.createAttachmentFromFileData(n,null,e,t,function(){},function(e){i._handleAddAttachmentCallback(e),r()},i.app)}))}(n[a]);return Promise.all(r)},i.prototype._handleDeleteAttachments=function(e,t){var i=this,r=[],a=this.attachmentsToRemove.getItems().map(function(e){return e.attachmentId});return a.length>0&&r.push(new Promise(function(r){i.busyText.set(i.deletingAttachmentText);var n={feature:e,layer:t,attachmentIds:a,callback:function(e){if(e[0]&&e[0].error){var t=i.getResource("language-feature-attachments-delete-prompt-title"),a=e[0].error.message||i.getResource("language-feature-attachments-delete-prompt-error-unknown");i.app.command("Alert").execute(a,t)}else i.currentFeatureGeocortex&&(i.currentFeatureGeocortex.resetAttachmentInfos(),setTimeout(function(){return i.app.event("FeatureAttachmentAddedEvent").publish(i.currentFeatureGeocortex)},300)),r()},errback:function(e){var t=i.getResource("language-feature-attachments-delete-prompt-title");i.app.command("Alert").execute(e.message||e,t),r()}};i.app.command("DeleteAttachments").execute(n)})),Promise.all(r)},i.prototype._handleAddAttachmentCallback=function(e){var t=this,i={};try{i=JSON.parse(e.currentTarget.response).error}catch(t){e.currentTarget&&e.currentTarget.statusText?i.message=e.currentTarget.statusText:i.message=this.app.getResource(this.libraryId,"language-native-internal-server-error")}if(i&&i.message){var r=this.getResource("language-native-file-upload-failed");this.app.command("Alert").execute(i.message,r)}else this.currentFeatureGeocortex&&(this.currentFeatureGeocortex.resetAttachmentInfos(),setTimeout(function(){return t.app.event("FeatureAttachmentAddedEvent").publish(t.currentFeatureGeocortex)},300))},i.prototype._cloneEsriFeature=function(e){return new esri.Graphic(e.toJson())},i.prototype._handleGeometryEditInvokedEvent=function(e){this.isEditingGeometry.set(!0),this.showEditGeometryButton.set(!1),this.showStopEditingGeometryButton.set(this.canEditGeometry.get()),this.geometryHasBeenEdited.set(!0)},i.prototype._handleGeometryEditCompletedEvent=function(e){this.isEditingGeometry.set(!1),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.showStopEditingGeometryButton.set(!1),this.currentFeatureEsriClone&&this.currentFeatureEsriClone===e.originalGraphic&&(this.currentFeatureEsriClone.setGeometry(e.editedGraphic.geometry),this.currentFeatureEsriClone.show(),this._swapOriginalFeatureForClone()),this.isEditingNewFeature.get()&&this.isEditingRelatedFeature.get()&&this._activateEditingView()},i.prototype._handleLayerUpdateEnd=function(){this._swapOriginalFeatureForClone()},i.prototype._handleDeletedFeature=function(e){var t=e instanceof esri.Graphic?e:e.originalFeature;t&&t instanceof esri.Graphic?this.app.featureSetManager.updateCollectionsOnFeatureDeletion(t):this.app.trace.warning("EditorViewModel: Could not update feature set collections on feature deletion. Original feature not provided.")},i.prototype._handleEditedFeature=function(e){if(e.originalFeature&&e.editedFeature){var t=this.app.featureSetManager.findFeaturesByEsriFeature(e.editedFeature||e.originalFeature);e.editedFeature&&e.originalFeature&&e.editedFeature!==e.originalFeature&&t.concat(this.app.featureSetManager.findFeaturesByEsriFeature(e.originalFeature)),(t=f.distinct(t))&&t.length&&_.updateFeatures(t,e.editedFeature)}else this.app.trace.warning("EditorViewModel: Could not update feature set collections on feature edit. Original or edited feature not provided.")},i.prototype._swapOriginalFeatureForClone=function(){if(this.currentFeatureEsri){var e=m.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer);e&&(e.hide(),!this.isEditingGeometry.get()&&this.currentFeatureEsriClone.getLayer()&&this.currentFeatureEsriClone.show())}},i.prototype._restoreOriginalFeature=function(){if(this.currentFeatureEsri){var e=null;(e=this.currentFeatureGeocortex&&this.currentFeatureGeocortex.featureLayer&&"Table"===this.currentFeatureGeocortex.featureLayer.type?m.findFeatureInLayer(this.currentFeatureEsri,this._sourceLayer):m.findFeatureInMap(this.currentFeatureEsri,this.app.site,this._sourceLayer))&&e.show()}},i.prototype.cancelEditing=function(){this.stopEditingGeometry(!0),this.geometryHasBeenEdited.set(!1),this._restoreOriginalFeature(),this._destroyEditingLayer(),this.form.get()&&this.form.get().clear(),this._sourceLayer&&this._sourceLayer.refresh(),this.isEditingGeometry.set(!1),this.isEditingLogEntry.set(!1),this.isEditingNewFeature.set(!1),this.isEditingRelatedFeature.set(!1),this.isEditingRelatedFeatureNotInSite.set(!1),this.layerUpdateEndToken&&dojo.disconnect(this.layerUpdateEndToken),this.app.behavior("EditorRemoveFeatureSelectedBehavior").run(),this.app.event("EditorClosedEvent").publish(),this.state=C.Idle},i.prototype._canExecuteStartEditingFeature=function(e){if(!e)return!1;if(this.app.offlineManager.isOfflineMapActive.get()&&!this.canEditOffline)return!1;if(e.layer){var t=e.layer;if(t.mapService&&t.mapService.serviceLayer){if(!t.mapService.serviceLayer.isEditable)return!1;if(!t.mapService.serviceLayer.isEditable())return!1;if(this.app.offlineManager.isOfflineMapActive.get()&&!(r=this.app.offlineManager.syncInfo.findLayerOrTable(e.layer.mapService.serviceLayer.url)).canEdit)return!1}var i=e.esriFeature.get();if(i)return!!i.getLayer()||(t.mapService&&t.mapService.serviceLayer&&(i._graphicsLayer=i._layer=t.mapService.serviceLayer),!!m.findFeatureInMap(i,this.app.site))}else if(e.featureLayer){if(this.app.offlineManager.isOfflineMapActive.get()){var r=this.app.offlineManager.syncInfo.findLayerOrTable(e.featureLayer.url);return r.canEdit}return e.featureLayer.isEditable()}return!1},i.prototype.handleClickEditGeometry=function(){if(this.isEditingGeometry.get()){this.stopEditingGeometry();var e=new s.Feature({graphic:this.currentFeatureEsriClone});this.app.behavior("EditorFeatureSelectedBehavior").run(e)}else this.startEditingGeometry(),this.app.behavior("EditorRemoveFeatureSelectedBehavior").run();return!1},i.prototype._executeStartEditingAttributesAndGeometryFeature=function(e,t){var i=this;void 0===t&&(t=!1),this._executeStartEditingFeature(e,t).then(function(e){i.canEditGeometry.get()&&i.handleClickEditGeometry()})},i.prototype._executeStartEditingFeature=function(e,t){var i=this;return void 0===t&&(t=!1),new Promise(function(r,a){var n=!0;i.isEditingNewFeature.set(t),i.geometryHasBeenEdited.set(!1),i.attachmentInfos.clear(),i.noAttachments.set(!1),i.hasEditableAttachments.set(!1);var o;try{if(e&&e instanceof s.Feature){var l=e;l.layer&&l.layer.mapService&&(i.currentMapService=l.layer.mapService),l.featureLayer&&"Table"===l.featureLayer.type&&(n=!1),i.currentFeatureGeocortex=e,i.headerText.set(l.plainLabel.get()),o=l.esriFeature.get()}else o=e;i.app.map&&i.app.site&&i.app.site.isInitialized?i.isEditingNewFeature.get()?(i._executeStartEditingFeatureImpl(o,t,n),r()):i._refreshEsriGraphic(o).then(function(e){null!=e&&e.features&&e.features.length>0&&e.features[0].attributes?(o.attributes={},dojo.mixin(o.attributes,e.features[0].attributes)):i.app.trace.info("Error retrieving most recent version of related record. Falling back to currently loaded version."),i._executeStartEditingFeatureImpl(o,t,n),r()}).caught(function(e){i.app.trace.info("Error retrieving most recent version of feature for editing. Falling back to currently loaded version."),i._executeStartEditingFeatureImpl(o,t,n),a(e)}):i.app.event("SiteInitializedEvent").once(i,function(){i._executeStartEditingFeatureImpl(o,t,n),r()})}catch(e){i.app.trace.error("Could not start editing: {0}".format(e)),i.cancelEditing(),a(e)}})},i.prototype._refreshEsriGraphic=function(e,t){var i=this,r=null;t||(t=e.getLayer()),r=this._getMapServiceByLayer(t);var a=e[E.HIGHLIGHT_ID_PROPERTY],n=t.objectIdField;!n&&r.serviceLayer instanceof esri.layers.FeatureLayer&&(n=r.serviceLayer.objectIdField);var s=new esri.tasks.Query;s.objectIds=[e.attributes[n]],s.returnGeometry=!0,s.outFields=["*"],s.outSpatialReference=this.app.map.spatialReference;var o=l.getQueryTask(t,r);return new Promise(function(e,r){o.execute(s,function(r){r&&r.features&&r.features.length&&(r.features[0]._layer=t,i.app.highlightManager.updateHighlightId(r.features[0],a)),e(r)},r)})},i.prototype._executeStartEditingFeatureImpl=function(e,t,i){void 0===t&&(t=!1),this.state!==C.Idle&&(this.cancelEditing(),this.isEditingNewFeature.set(t));var r=null,a=t?e:m.findFeatureInMap(e,this.app.site);if(this.originalFeatureClone=this._cloneEsriFeature(a),r=t?this._sourceLayer:a.getLayer()){if(!i)return this.canEditGeometry.set(!1),void this._editAsTable(e);if(r instanceof esri.layers.GraphicsLayer&&!(r instanceof esri.layers.FeatureLayer)){var s=r;if(s.id){var o=s.id.replace("-explodedClusterLayer",""),l=this.app.map.getLayer(o);l instanceof esri.layers.FeatureLayer&&(r=l)}s.renderer&&e.setSymbol(s.renderer.getSymbol(e))}t&&(r.objectIdField&&(e.attributes[r.objectIdField]=0),r.globalIdField&&(e.attributes[r.globalIdField]="")),this._sourceLayer=r,this._calculateCanDeleteFeature(),this.layerUpdateEndToken=dojo.connect(r,"onUpdateEnd",dojo.hitch(this,this._handleLayerUpdateEnd)),this.state=C.EditingAttributes,this.isEditingRelatedFeatureNotInSite.set(!1),this.canEditGeometry.set(this.configAllowsEditGeometry&&!!r.geometryType&&r.allowGeometryUpdates),this.showStopEditingGeometryButton.set(!1),this.showEditGeometryButton.set(this.canEditGeometry.get()),this.currentFeatureEsri=a,this.currentFeatureEsriClone=this._cloneEsriFeature(a),a.hasOwnProperty("_drawType")&&(this.currentFeatureEsriClone._drawType=a._drawType),this._createEditingLayer(),this._editingLayer.add(this.currentFeatureEsriClone);var u={textareaThreshold:this.textareaThreshold,doNotAdjustTime:this.doNotAdjustTime};if(this.currentFeatureGeocortex&&this.currentFeatureGeocortex.layer){var d=[];this.currentFeatureGeocortex.layer.fields.forEach(function(e){d.push(e.name)}),u.fieldOrder=d}if(this.form.set(new n.EditingFormViewModel(this.app,this.libraryId,e,r,u)),this.app.event("Internal.EditorFormSetupEvent").publish(this.form,a),null!=this._sourceLayer.typeIdField)for(var c=this.form.get(),p=0;p<c.fields.getLength();p++){var h=c.fields.getAt(p);if(h.name.get()===this._sourceLayer.typeIdField){this.handleTypeFieldSelected(h);break}}try{this._buildFeatureRelationships()}catch(e){this.app.trace.warning("Could not set up related records for editing.")}this._initializeAttachmentForm(),this.isBusy.set(!1),this.busyText.set(""),t||this._activateEditingView()}else this.app.trace.error("Error - could not find layer for feature.")},i.prototype._initializeAttachmentForm=function(){var e=this;if(this.attachmentsToAdd.clear(),this.attachmentsToRemove.clear(),this.hasEditableAttachments.set(this._sourceLayer.hasAttachments),this.hasEditableAttachments.get()&&this.currentFeatureGeocortex){var t=function(){e._setAttachmentInfos(e.currentFeatureGeocortex.attachmentInfos),0===e.attachmentInfos.length()&&(e.isOffline.set(e.app.isOffline.get()),e.noAttachments.set(!e.app.isOffline.get())),e.isAttachmentInfosInitialized.set(!0)};if(this.currentFeatureGeocortex.attachmentInfosInitialized.get())t();else{var i=this.currentFeatureGeocortex.attachmentInfosInitialized.bind(this,function(r){t(),e.currentFeatureGeocortex.attachmentInfosInitialized.unbind(i)});this.currentFeatureGeocortex.attachmentInfos.get()}}else this.isOffline.set(this.app.isOffline.get()),this.noAttachments.set(!this.app.isOffline.get()),this.isAttachmentInfosInitialized.set(!0)},i.prototype._setAttachmentInfos=function(e){if(this.attachmentInfos.clear(),e)for(var t=e.getLength(),i=0;i<t;i++){var r=e.getAt(i),a=this.app.nativeManager.isNative()?null:"_blank";this.attachmentInfos.addItem({name:r.name,url:r.url,canEditAttachments:!0,size:h.formatBytes(r.size.get()),attachmentId:r.id.get(),target:a})}},i.prototype._canExecuteStartEditingNewFeature=function(e){return!(this.app.offlineManager.isOfflineMapActive.get()&&!this.canEditOffline)},i.prototype._editAsTable=function(e){for(var t=this,i=null,r=null,a=0,n=this.app.site.getFeatureServices();a<n.length;a++)!function(a){a.serviceLayer.relationships.forEach(function(n){var s=t.currentFeatureGeocortex.featureLayer;if(n.relatedTableId!==s.layerId);else{t._sourceLayer=s,r=s,i=n;var o=null,l=null,u=t.app.site&&t.app.site.essentialsMap?t.app.site.essentialsMap.findLayerFromMatchingEsriFeatureLayer(r):null;u?(o=y.getTimeZoneFromLayer(u),l=y.getDisplayTimeZoneFromMapService(u.mapService)):(o=y.getTimeZoneFromMapService(a),l=y.getDisplayTimeZoneFromMapService(a)),t._initializeAttachmentForm();var d={id:r.layerId,text:"Editing "+e.attributes.OBJECTID,relatedFeature:null,essentialsRelatedFeature:null,feature:e,editable:r.isEditable(),relationship:i,timeZoneId:o,displayTimeZoneId:l};t._executeStartEditingRelatedRecord(d,!1)}})}(n[a])},i.prototype._executeStartEditingNewFeature=function(e,t,i){void 0===i&&(i=!0),this.currentFeatureEsri=e,this._sourceLayer=t,this._calculateCanDeleteFeature(),this.currentFeatureGeocortex=null;var r=this.app.getResource(this.libraryId,"language-common-feature-editing");this.headerText.set(r),this._executeStartEditingFeature(e,!0),i?t.geometryType&&t.allowGeometryUpdates?this.startEditingGeometry():this._activateEditingView():(this._activateEditingView(),this.currentFeatureEsriClone.show())},i.prototype._canExecuteStartEditingEditLogEntry=function(e){return!0},i.prototype._executeStartEditingEditLogEntry=function(e){return!0},i.prototype.handleTypeFieldSelected=function(e){if(e){var t=e.value.get();if(null!=t)for(var i=0;i<e.valueOptions.getLength();i++){var r=e.valueOptions.getAt(i);if(null!=r.id&&r.id.toString()===t.toString()){this._loadCodedDomainsForType(r.domains);break}}}},i.prototype._loadCodedDomainsForType=function(e){if(e){var t=this.form.get();for(var i in e)if(e.hasOwnProperty(i)&&e[i].type)for(var r=0;r<t.fields.getLength();r++){var a=t.fields.getAt(r),n=!0;if(a.name.get()===i){var s=[];if("inherited"!==e[i].type)s=e[i].codedValues;else{for(var o=0,l=this._sourceLayer.fields;o<l.length;o++){var u=l[o];if(u.name===a.name.get()){var d=u.domain;if(d){d.codedValues?s=d.codedValues:n=!1;break}}}if(!n)continue}var c={viewModel:a,typeName:"codedDomainValue",collectionName:"codedDomainValues",valueCollection:s,nullable:a.nullable.get(),nullOption:{name:"",code:null}};this._addValueCollection(c),a.value.pulse()}}}},i.prototype._addValueCollection=function(e){if(e){var t=e.viewModel.valueOptions;t||(t=e.viewModel.valueOptions=new a.ObservableCollection([])),t.clear(),t.addItems(e.valueCollection),e.nullable&&t.insertItem(0,e.nullOption);var i=function(e){return null===e||void 0===e?"":e.toString()},r=i(e.viewModel.value.get());if(!t.get().some(function(e){return i(e.code)===r})){var n=t.get().filter(function(t){return t!==e.nullOption})[0];e.viewModel.value.set(n?n.code:e.nullOption.code)}}},i.prototype._activateEditingView=function(){var e=this;this.app.command("HideFeatureTemplatePicker").execute(),this.app.command("ActivateView").execute("EditorView");var t=new s.Feature({graphic:this.currentFeatureEsriClone});setTimeout(function(){return e.app.behavior("EditorFeatureSelectedBehavior").run(t)},300)},i.prototype._getEditingToolMessage=function(e){var t=Modernizr&&!!Modernizr.touch;switch(e){case esri.toolbars.Draw.POINT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-point");case esri.toolbars.Draw.MULTI_POINT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-multi-point");case esri.toolbars.Draw.POLYLINE:case esri.toolbars.Draw.FREEHAND_POLYLINE:return t?this.app.getResource(this.libraryId,"language-feature-editing-geometry-polyline-touch"):this.app.getResource(this.libraryId,"language-feature-editing-geometry-polyline");case esri.toolbars.Draw.POLYGON:case esri.toolbars.Draw.FREEHAND_POLYGON:return t?this.app.getResource(this.libraryId,"language-feature-editing-geometry-polygon-touch"):this.app.getResource(this.libraryId,"language-feature-editing-geometry-polygon");case esri.toolbars.Draw.EXTENT:return this.app.getResource(this.libraryId,"language-feature-editing-geometry-rectangle")}return this.app.getResource(this.libraryId,"language-feature-editing-geometry-default")},i.prototype.findGeocortexLayerForUrl=function(e){for(var t=0,i=this.app.site.essentialsMap.mapServices;t<i.length;t++){var r=i[t];if(r.serviceUrl===e&&r.layers.length>0)return r.layers[0]}return null},i.prototype._findServiceLayerForUrl=function(e){for(var t=0,i=this.app.site.essentialsMap.mapServices;t<i.length;t++){var r=i[t];if(r.url===e)return r.serviceLayer}return null},i.prototype._hideOrShowRelateds=function(){this.showRelatedLayers.set(this.hasRelatedLayers.get()&&!this.isEditingRelatedFeatureNotInSite.get()&&!this.isEditingNewFeature.get())},i.prototype._calculateCanDeleteFeature=function(){this.canDeleteFeature.set(!this.isEditingNewFeature.get()&&this._sourceLayer&&/Delete/.test(this._sourceLayer.capabilities))},i.prototype.editingInProgress=function(){return!!this._editingLayer},i}(r.ViewModelBase);i.EditorViewModel=I})},"Mapping/modules/Editing/MultiFeatureSelector/MultiFeatureSelectorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/ui/components/FeatureSelector/FeatureSelectorViewModel"],function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SELECTOR_BUTTON_VALUE={OK:"ok",CANCEL:"cancel",DONE:"done"};var a=function(t){function a(e,a){var n=t.call(this,e,a)||this;return n.complexity=r.FEATURE_SELECTOR_TEMPLATE_TYPE.COMPLEX,n.standardButton=null,n.standardButton={label:n.app.getResource(n.libraryId,"language-common-done"),value:i.SELECTOR_BUTTON_VALUE.DONE,causesValidation:!0,isDefault:!0},n.registerCommands(),n}return e(a,t),a.prototype.initialize=function(e){var t=e.displayResultPickerTemplateComplexity;t!==r.FEATURE_SELECTOR_TEMPLATE_TYPE.SIMPLE&&t!==r.FEATURE_SELECTOR_TEMPLATE_TYPE.COMPLEX||(this.complexity=t)},a.prototype.registerCommands=function(){var e=this;this.app.command("ShowFeatureSelector").register(this,this.showFeatureSelector),this.app.command("HideFeatureSelector").register(this,this.hideFeatureSelector),this.app.command("HideMultiFeatureSelectorView").register(this,this.hideFeatureSelector),this.app.command("ShowSelectionListOfFeaturesWithCallback").register(this,function(t,i){var a={featureSet:t,callback:i,viewTitle:e.app.getResource(e.libraryId,"language-feature-editing-multi-feature-selector"),viewMessage:e.app.getResource(e.libraryId,"language-feature-editing-multi-feature-selector-message"),errorMessage:e.app.getResource(e.libraryId,"language-feature-editing-multi-feature-selector-error-message"),buttons:[e.standardButton],selectionMode:r.FEATURE_SELECTOR_MODE.SINGLE,simpleResultTemplate:e.complexity===r.FEATURE_SELECTOR_TEMPLATE_TYPE.SIMPLE,showFilterTextBox:!1};e.showFeatureSelector(a)})},a}(r.FeatureSelectorViewModel);i.MultiFeatureSelectorViewModel=a})},"Mapping/modules/Editing/TemplatePicker/FeatureTemplateViewModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.name=new i.Observable(""),this.description=new i.Observable,this.proto={},this.drawingTool=new i.Observable,this.symbolUri=new i.Observable,this.symbolStyle=new i.Observable(""),this.swatchElement=null}}();t.FeatureTemplate=r})},"Mapping/modules/Editing/TemplatePicker/TemplateFeatureLayerModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/TemplatePicker/TemplatePickerView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/Layer"],function(t,i,r,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.app.command("ShowFeatureTemplatePicker").register(r,r._onShowFeatureTemplatePicker,r._canShowFeatureTemplatePicker),r.app.command("HideFeatureTemplatePicker").register(r,function(){r.isActive&&r.app.viewManager.deactivateView(r)}),r}return e(i,t),i.prototype._onShowFeatureTemplatePicker=function(e,t){if(this.app.command("_CancelEditing").execute(),this.app.command("ActivateView").execute(this.id),this.viewModel){if(this.app.command("Internal.CancelEditingIfNotIdle").execute(),!e&&!t)return void this.viewModel.loadLayerTemplates();this.viewModel.filteredLayers&&(this.viewModel.filteredLayers.length=0,this.viewModel.filteredLayers=null),this._loadTemplate(e,t)}},i.prototype._canShowFeatureTemplatePicker=function(e,t){return!(this.viewModel&&this.app.isOffline.get()&&!this.viewModel.canEditOffline)&&(!((e||t)&&(e||!t))||!!("object"==typeof e&&e instanceof a.Layer&&e.mapService&&e.mapService.serviceLayer&&e.mapService.serviceLayer.isEditable&&/Create/.test(e.mapService.serviceLayer.capabilities))&&e.mapService.serviceLayer.isEditable())},i.prototype._loadTemplate=function(e,t){e?this.viewModel.loadTemplatesForCurrentLayer(e,t):this.viewModel.loadLayerTemplates(t)},i.prototype.handleFeatureTemplateClick=function(e,t,i){var r=this;this.app.command("Internal.CancelEditingIfNotIdle").execute();var a;if(i.proto&&i.proto.toJson&&!i.relatedFeature)a=new esri.Graphic(i.proto.toJson());else if(i.relatedFeature){if(i.proto&&i.proto.toJson){a=i.relatedFeature;for(var n in i.proto.attributes){var s=i.proto.attributes[n];null!=s&&(a.attributes[n]=s)}}}else a=new esri.Graphic(null),i.proto&&i.proto.attributes&&(a.attributes=i.proto.attributes);var o=null;if(i.drawingTool&&i.drawingTool.get())switch(i.drawingTool.get()){case"esriFeatureEditToolPoint":o="MapPoint";break;case"esriFeatureEditToolLine":o="Polyline";break;case"esriFeatureEditToolFreehand":"esriGeometryPolyline"===i.layer.geometryType?o="FreehandPolyline":"esriGeometryPolygon"===i.layer.geometryType&&(o="FreehandPolygon");break;case"esriFeatureEditToolAutoCompletePolygon":case"esriFeatureEditToolPolygon":o="Polygon";break;case"esriFeatureEditToolEllipse":o="Ellipse";break;case"esriFeatureEditToolCircle":o="Circle";break;case"esriFeatureEditToolRectangle":o="Rectangle";break;default:o="Polygon"}if(!o)switch(i.layer.geometryType){case"esriGeometryPoint":o="MapPoint";break;default:o=i.layer.geometryType.replace("esriGeometry","")}a._drawType=o,this.app.configuration.mobileMode?(this.app.command("DisableMapClick").execute(),this.app.command("ShowMap").execute(),this.app.command("CloseDataFrame").execute(),this.app.event("DataFrameClosedEvent").once(this,function(){setTimeout(function(){r.app.command("EnableMapClick").execute(),r.app.event("StartFeaturePlacementEvent").publish(),r.app.command("StartEditingNewFeature").execute(a,i.layer)},225)})):(this.app.command("ShowMap").execute(),this.app.event("StartFeaturePlacementEvent").publish(),this.app.command("StartEditingNewFeature").execute(a,i.layer))},i}(r.ViewBase);i.TemplatePickerView=n})},"Mapping/modules/Editing/TemplatePicker/TemplatePickerViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./FeatureTemplateViewModel"],function(t,i,r,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.layerIsEditable=new a.Observable(!1),e.layerTemplates=new a.ObservableCollection,e.canEditOffline=!1,e}return e(i,t),i.prototype.initialize=function(e){var t=this;this.app.site&&this.app.site.serviceLayersLoaded?this.loadLayerTemplates():this.app.event("SiteServiceLayersLoadedEvent").subscribe(this,function(){return t.loadLayerTemplates()}),this.app.nativeManager.hasNativeCapability("editing").then(function(e){t.canEditOffline=e})},i.prototype._layerIsValidForEditing=function(e){if(!e)return!1;if(e.serviceLayer&&e.serviceLayer.capabilities&&e.serviceLayer.version>=10.1&&!/create/.test(e.serviceLayer.capabilities.toLowerCase()))return!1;var t=!0;if(this.filteredLayers){t=!1;for(var i=0;i<this.filteredLayers.length;i++)if(this.filteredLayers[i]===e.id){t=!0;break}}return t},i.prototype.loadTemplatesForCurrentLayer=function(e,t){if(e&&e.mapService){this.layerTemplates.clear();var i=this._getFeatureLayerModel(e.mapService,t);i&&this.layerTemplates.addItem(i)}},i.prototype.loadLayerTemplates=function(e){var t=this.app.site;if(t&&t.essentialsMap&&t.isInitialized){var i=t.getFeatureServices();this.layerTemplates.clear();for(var r=[],a=0;a<i.length;a++){var n=i[a],s=this._getFeatureLayerModel(n,e);s&&!s.notAvailableReason.get()&&r.push(s)}this.layerTemplates.addItems(r)}},i.prototype._getFeatureLayerModel=function(e,t){var i=e.serviceLayer;if(!this._layerIsValidForEditing(e))return null;var r=null;if(this.app.offlineManager.isOfflineMapActive.get()){var n=this.app.offlineManager.syncInfo.findLayerOrTable(i.url);n&&n.canEdit||(this.app.trace.warning("Layer "+i.url+" not available offline. Make sure the layer is included in your offline map if you want to edit it offline."),r=this.getResource("language-feature-editing-not-available-offline"))}i.isEditable&&i.isEditable()||(r=this.getResource("language-feature-editing-not-editable"));var s=e.displayName;e&&e.layers&&e.layers.length>0&&(s=e.layers[0].displayName);var o=new a.ObservableCollection;if(!r){var l=this._loadFeatureTemplates(e.serviceLayer,t);l&&l.length>0&&o.addItems(l)}return{displayName:new a.Observable(s),mapServiceId:new a.Observable(e.id),layer:e.serviceLayer,templates:o,proto:null,notAvailableReason:new a.Observable(r)}},i.prototype.createTemplate=function(e,t,i){var r=new n.FeatureTemplate,a=null;if(!e.renderer){var s=this.app.map.graphicsLayerIds.filter(function(t){return t===e.id+"-cluster"});s.length>0&&(a=this.app.map.getLayer(s[0]))}if(t){var o=t.name;if(r.name.set(o),r.description.set(t.description),r.drawingTool.set(t.drawingTool),r.proto=t.prototype,i&&i.attributes&&(r.relatedFeature=i),e.renderer||a){var l=e.renderer||a.featureLayerRenderer;if(l instanceof esri.renderer.HeatmapRenderer){var u=this.app.site.essentialsMap.mapServices.filter(function(t){return t.serviceLayer.id===e.id})[0];u.heatMap&&u.heatMap.defaultRenderer&&(l=u.heatMap.defaultRenderer)}var d=this._getTemplateSymbol(t,l);if(d)switch(d.type){case"picturemarkersymbol":r.symbolUri.set(d.url),r.swatchElement=null;break;case"simplelinesymbol":var c=String.escapeHtml(d.color.toCss());r.swatchElement="<div class='simple-swatch line' style='color: "+c+"'></div>";break;case"simplefillsymbol":var p=String.escapeHtml(d.color.toCss());r.swatchElement="<div class='simple-swatch square' style='background-color: "+p+"'></div>";break;default:var h=String.escapeHtml(d.color.toCss());r.swatchElement="<div class='simple-swatch square' style='background-color: "+h+"'></div>"}}}return r.layer=e,r},i.prototype._consumeTemplate=function(e,t,i){return this.createTemplate(e,t,i)},i.prototype._getTemplateSymbol=function(e,t){var i=new esri.Graphic(null);return i.attributes={},e.prototype.attributes&&dojo.mixin(i.attributes,e.prototype.attributes),t.getSymbol(i)||t.defaultSymbol},i.prototype._loadFeatureTemplates=function(e,t){if(!e||!e.templates)return null;var i=[];if(e.templates.length>0)for(r=0;r<e.templates.length;++r)i.push(this._consumeTemplate(e,e.templates[r],t));else if(e.types&&e.types.length>0)for(var r=0;r<e.types.length;++r){var a=e.types[r];if(a.templates)for(var n=0;n<a.templates.length;++n)i.push(this._consumeTemplate(e,a.templates[n],t))}return i},i}(r.ViewModelBase);i.TemplatePickerViewModel=s})},"Mapping/modules/Editing/Undoable/Add":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){if(void 0===t&&(t={}),!t.graphicsLayer)throw new Error("Add Operation: Initialization failed. Graphics layer is not provided.");if(!t.addedGraphics)throw new Error("Add Operation: Initialization failed. Added graphics are not provided.");this.state=t,this.displayName=e}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)})})},e}();t.Add=i})},"Mapping/modules/Editing/Undoable/AddAndUpdate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Add/Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.addedGraphics)throw new Error("Add/Update Operation: Initialization failed. Added graphics are not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Add/Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.addedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e}();t.AddAndUpdate=i})},"Mapping/modules/Editing/Undoable/AddAndUpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/AddState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/Delete":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){if(void 0===t&&(t={}),!t.graphicsLayer)throw new Error("Delete Operation: Initialization failed. Graphics layer is not provided.");if(!t.deletedGraphics)throw new Error("Delete Operation: Initialization failed. Deleted graphics are not provided.");this.state=t,this.displayName=e}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)})})},e}();t.Delete=i})},"Mapping/modules/Editing/Undoable/DeleteAndUpdate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Delete/Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.deletedGraphics)throw new Error("Delete/Update Operation: Initialization failed. Deleted graphics are not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Delete/Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.remove(e),i.state.app.event("MarkupDeletedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.deletedGraphics.map(function(e){i.state.graphicsLayer.add(e),i.state.app.event("MarkupAddedEvent").publish(e)}),i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e}();t.DeleteAndUpdate=i})},"Mapping/modules/Editing/Undoable/DeleteAndUpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/DeleteState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Undoable/Update":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t={});var i=this;if(this._preUpdatedGraphicsGeometries=[],this._preUpdatedGraphicsAttributes=[],this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],!t.graphicsLayer)throw new Error("Update Operation: Initialization failed. Graphics layer is not provided.");if(!t.preUpdatedGraphics||!t.updatedGraphics)throw new Error("Update Operation: Initialization failed. Pre/Post updated graphics are not provided.");this.state=t,this.displayName=e,t.preUpdatedGraphics.map(function(e,t){i._preUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._preUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})}),t.updatedGraphics.map(function(e,t){i._postUpdatedGraphicsGeometries[t]=e.geometry.toJson(),i._postUpdatedGraphicsAttributes[t]=JSON.stringify(e.attributes||{})})}return e.prototype.performRedo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._postUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._postUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e.prototype.performUndo=function(e,t){var i=this;return Promise.resolve().then(function(){i.state.updatedGraphics.map(function(e,t){e.setGeometry(esri.geometry.fromJson(i._preUpdatedGraphicsGeometries[t])),e.setAttributes(JSON.parse(i._preUpdatedGraphicsAttributes[t])),i.state.app.event("MarkupUpdatedEvent").publish(e)})})},e}();t.Update=i})},"Mapping/modules/Editing/Undoable/UpdateState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/EditingFormButton":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Editing/Editor/Form/EditingFormField":function(){define(["require","exports","geocortex/framework/observables","geocortex/essentials/Field"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){var e=this;this.type=r.EsriFieldTypes.esriFieldTypeString,this._isSettingPresentableValue=!1,this._isSettingValue=!1,this.name=new i.Observable,this.displayName=new i.Observable,this.editable=new i.Observable(!0),this.readOnly=new i.Observable(!1),this.required=new i.Observable(!1),this.nullable=new i.Observable(!1),this.cssClass=new i.Observable,this.showIndicator=new i.Observable(!1),this.value=new i.Observable(null),this.presentableValue=new i.Observable,this.formatFunc=function(e){return null===e||void 0===e?"":e.toString()},this.value.bind(this,function(t){e._isSettingValue||(e._isSettingPresentableValue=!0,e.presentableValue.set(e.formatFunc(e.value.get())),e._isSettingPresentableValue=!1)}),this.presentableValue.bind(this,function(t){e._isSettingPresentableValue||(e._isSettingValue=!0,e.value.set(t),e._isSettingValue=!1)})}return e.prototype.showFormattedValue=function(){this._isSettingPresentableValue=!0,this.presentableValue.set(this.formatFunc(this.value.get())),this._isSettingPresentableValue=!1},e.prototype.showActualValue=function(){this._isSettingPresentableValue=!0,this.presentableValue.set(this.value.get()),this._isSettingPresentableValue=!1},e}();t.EditingFormField=a})},"Mapping/modules/Editing/Editor/Form/EditingFormViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./EditingFormField","geocortex/infrastructure/gis/FieldInfo","geocortex/forms/items/DatePickerFormItem","geocortex/forms/items/TimePickerFormItem","geocortex/infrastructure/FormatUtils","geocortex/essentials/utilities/TimeZoneUtils","geocortex/infrastructure/validation/ValidationFunctionFactory","geocortex/essentials/Field"],function(t,i,r,a,n,s,o,l,u,d,c,p){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var h=function(t){function i(e,i,r,n,s){var o=t.call(this,e,i)||this;o.textareaThreshold=80,o.doNotAdjustTime=!1,o.id="EditingFormViewModel",o.fields=new a.ObservableCollection,o.validationMessages=new a.ObservableCollection,o.buttons=new a.ObservableCollection,o.currentFeature=new a.Observable,o.featureIsNew=new a.Observable(!1);var l=null;return s&&(s.textareaThreshold&&(o.textareaThreshold=s.textareaThreshold),s.fieldOrder&&(l=s.fieldOrder),s.doNotAdjustTime&&(o.doNotAdjustTime=s.doNotAdjustTime),s.timeZoneId&&(o.fallbackTimeZoneId=s.timeZoneId),s.displayTimeZoneId&&(o.fallbackDisplayTimeZoneId=s.displayTimeZoneId)),r&&o.setup(r,n||null,l),o}return e(i,t),i.prototype.addValidationMessage=function(e){this.validationMessages.addItem(e)},i.prototype.clearValidationMessages=function(){this.validationMessages.clear()},i.prototype._fieldHasSubTypeDomainValues=function(e,t){for(var i=0;i<t.types.length;++i){var r=t.types[i];if(r.domains&&e.name in r.domains)return!0}return!1},i.prototype.setup=function(e,t,i){var r=this;this.clear();var a=[];if(!t)throw new Error("Attempted to edit a feature with no layer attached!");for(var h=null,g=this.app.site.getFeatureServices(),m=null,f=0;f<g.length;++f){var y=g[f];if(y.serviceLayer===t){m=y.layers[0];break}}var v=[],b=t._outFields;if(b&&b.length>0)for(var E=0;E<b.length;++E){var _=b[E];if(0===E&&"*"===_){v=t.fields;break}for(var F=0;F<t.fields.length;++F){var w=t.fields[F];if(w.name===_){v.push(w);break}}}else v=t.fields;if(i){var C=v.slice(),I=[];i.forEach(function(e){for(var t=C.length-1;t>-1;--t){var i=C[t];i.name===e&&(I.push(i),C.splice(t,1))}}),I.concat(C),v=I}for(var T=function(e,t){for(var i=0;i<t.length;i++){var r=t[i].prototype.attributes;if(e.name&&r.hasOwnProperty(e.name))return e.nullable=null===r[e.name],!0}return!1},x=0;x<v.length;++x){var S=v[x];if(S&&S.editable){var G=function(e){if(!m)return null;for(var t=0;t<m.fields.length;++t){var i=m.fields[t];if(i.name===e)return i}return null}(S.name);if(!G||G.visible){var A=s.FieldInfo.fromEsriField(S,t,G);if(void 0===S.nullable||null===S.nullable)if(t&&t.templates&&t.templates.length)T(S,t.templates);else if(t&&t.types&&t.types.length)for(var L=0;L<t.types.length&&!(t.types[L].templates&&t.types[L].templates.length&&T(S,t.types[L].templates));L++);var M=!0===S.nullable,R=!!G&&!G.editable,O=!1===M&&!R,k=null;this.featureIsNew.get()&&S.name!==t.typeIdField||e.attributes&&(k=e.attributes[S.name]);var D=new n.EditingFormField;if(D.name.set(S.name),D.readOnly.set(R),D.nullable.set(M),D.required.set(O),D.showIndicator.set(D.required.get()),D.type=S.type,D.renderType=S.type,function(e){!e.timeZoneId&&r.fallbackTimeZoneId&&(e.timeZoneId=r.fallbackTimeZoneId),!e.displayTimeZoneId&&r.fallbackDisplayTimeZoneId&&(e.displayTimeZoneId=r.fallbackDisplayTimeZoneId),D.formatFunc=function(t){return e.formatValue(t)}}(A),D.value.set(k),D.length=S.length,D.editable.set(S.editable),G?D.displayName.set(G.displayName):D.displayName.set(null!=S.alias?S.alias:S.name),"esriFieldTypeDate"===S.type){var U=new o.DatePickerFormItem(null,null);U.timePickerItem=new l.TimePickerFormItem(null,null);var N;if(e&&e.attributes[S.name]?(N=u.parseDate(e.attributes[S.name]),N=A.displayTimeZoneId?d.correctDatesForDisplayInDisplayTimeZone(N,A.timeZoneId,A.displayTimeZoneId):d.correctDatesForDisplayInLocalTime(N,A.timeZoneId)):N=D.nullable.get()?null:new Date,U.includeTimePicker.set(!0),U.initialDate.set(N),U.date.set(N),U.isRequired.set(D.required.get()),U.nullable.set(D.nullable.get()),U.readOnly.set(D.readOnly.get()),A.format){var V=A.format.match(/\{0:([^}]*)\}/);V&&2==V.length&&U.dateFormat.set(V[1])}!function(e){U.date.bind(r,function(t){r.doNotAdjustTime||(t=d.correctDatesToSubmitInDatabaseTime(t,A.timeZoneId,A.displayTimeZoneId)),e.value.set(t)})}(D),D.datePickerViewModel=U}else if(S.name===t.typeIdField){var P={valueCollection:t.types,nullable:!O,nullOption:{name:"",code:null}};D.renderType="typeField",this._applyFieldConfiguration(P,D),h=k}else if(A.isCodedValueDomain()||A.hasSubtypeCodedValueDomains()){var B=S.domain;if(B)D.domain=B;else for(var j=0;j<t.types.length;++j){var Z=t.types[j];if(Z.domains&&S.name in Z.domains){D.domain=Z.domains[S.name];break}}if("codedValue"===D.domain.type){var H={valueCollection:D.domain.codedValues,nullable:!O,nullOption:{name:"",code:null}};D.renderType="codedDomainValue",this._applyFieldConfiguration(H,D)}}else D.type!==p.EsriFieldTypes.esriFieldTypeDouble&&D.type!==p.EsriFieldTypes.esriFieldTypeInteger&&D.type!==p.EsriFieldTypes.esriFieldTypeOID&&D.type!==p.EsriFieldTypes.esriFieldTypeSingle&&D.type!==p.EsriFieldTypes.esriFieldTypeSmallInteger||D.value.set(u.formatNumber(u.parseNumber(k),"#.####################")),D.type===p.EsriFieldTypes.esriFieldTypeString&&D.length>this.textareaThreshold?D.renderType="textArea":D.renderType=this._getRenderTypeForField(D);if(this.app.urlParameters.hasOwnProperty("noval"))D.validationFunc=function(){return null};else{var W={displayName:D.displayName.get(),type:D.type,domain:D.domain,length:D.length,required:D.required.get(),editable:D.editable.get(),nullable:D.nullable.get()};D.validationFunc=c.ValidationFunctionFactory.createValidationFunction(this.app,W)}a.push(D)}}}if(this.fields.addItems(a),null!==h)for(j=0;j<t.types.length;j++){var Q=t.types[j];null!==Q.id&&Q.id.toString()===h.toString()&&this._applyCodedDomains(Q.domains)}},i.prototype.getRawFieldValue=function(e){for(var t=0;t<this.fields.getLength();++t){var i=this.fields.getAt(t);if(i.name.get()===e)return i.value.get()}return null},i.prototype.getAttributeValues=function(){for(var e={},t=0;t<this.fields.getLength();++t){var i=this.fields.getAt(t),r=i.value.get(),a=null;i.type===p.EsriFieldTypes.esriFieldTypeDate?(r=i.value.get(),a=null===r?null:u.parseDate(r).getTime()):i.type===p.EsriFieldTypes.esriFieldTypeDouble||i.type===p.EsriFieldTypes.esriFieldTypeInteger||i.type===p.EsriFieldTypes.esriFieldTypeOID||i.type===p.EsriFieldTypes.esriFieldTypeSingle||i.type===p.EsriFieldTypes.esriFieldTypeSmallInteger?(a=u.parseNumber(r),isNaN(a)&&(a=null)):a=r,i.domain&&"codedValue"===i.domain.type&&!i.valueOptions.get().some(function(e){return e.code===a})?a=i.valueOptions.getAt(0).code:""===r&&i.type!==p.EsriFieldTypes.esriFieldTypeString&&(a=null),e[i.name.get()]=a}return e},i.prototype._getRenderTypeForField=function(e){return"text"},i.prototype._applyCodedDomains=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&"codedValue"===e[t].type)for(var i=0;i<this.fields.getLength();i++){var r=this.fields.getAt(i);if(r.name.get()===t){var a={valueCollection:e[t].codedValues,nullable:r.nullable.get(),nullOption:{name:"",code:null}};r.renderType="codedDomainValue",this._applyFieldConfiguration(a,r);break}}},i.prototype._applyFieldConfiguration=function(e,t){t.valueOptions?t.valueOptions.clear():t.valueOptions=new a.ObservableCollection([]),t.valueOptions.addItems(e.valueCollection),e.nullable&&t.valueOptions.insertItem(0,e.nullOption);for(var i=0;i<t.valueOptions.getLength();++i){var r=t.valueOptions.getAt(i);void 0===r.code&&r.hasOwnProperty("id")&&(r.code=r.id)}},i.prototype.clear=function(){this.fields.clear(),this.clearValidationMessages()},i}(r.ViewModelBase);i.EditingFormViewModel=h})},"url:/Mapping/modules/Editing/CreateOrEdit/CreateOrEditView.html":t,"url:/Mapping/modules/Editing/Editor/EditorView.html":i,"url:/Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html":r,"url:/Mapping/modules/Editing/TemplatePicker/TemplatePickerView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/CSS/common.css","css","LmNvbnRlbnQtY29udGFpbmVyIHsNCiAgICBwYWRkaW5nOiAxLjVlbTsNCn0NCi5idXR0b24tYWN0aW9uLWljb24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgbWluLWhlaWdodDogOGVtOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjI1ZW07DQp9DQouYnV0dG9uLWFjdGlvbi1pY29uIGltZyB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luOiAwIGF1dG8gMWVtIGF1dG87DQp9DQouYWN0aW9uLWJ0bnMsDQouYWN0aW9uLWJ0bnMgbGkgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGxpc3Qtc3R5bGU6IG5vbmU7DQp9DQouYWN0aW9uLWJ0bnMgbGkgew0KICAgIHdpZHRoOiA1MCU7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgcGFkZGluZzogMCAxZW07DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KDQp9DQouYWN0aW9uLWJ0bnMgbGk6bnRoLWNoaWxkKG9kZCkgew0KICAgIHBhZGRpbmctbGVmdDogMDsNCn0NCi5hY3Rpb24tYnRucyBsaTpudGgtY2hpbGQoZXZlbikgew0KICAgIHBhZGRpbmctcmlnaHQ6IDA7DQp9DQouYWN0aW9uLWJ0bnM6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBjbGVhcjogYm90aDsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBoZWlnaHQ6IDA7DQogICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KfQ0KLmhpZGRlbi1maWxlLWlucHV0IHsNCiAgICB3aWR0aDogMC4xcHg7DQoJaGVpZ2h0OiAwLjFweDsNCglvcGFjaXR5OiAwOw0KCW92ZXJmbG93OiBoaWRkZW47DQoJcG9zaXRpb246IGFic29sdXRlOw0KCXotaW5kZXg6IC0xOw0KfQ0KLmZpbGUtYnV0dG9uIHsNCiAgICBwYWRkaW5nOiAuNWVtOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgd2lkdGg6IDEwMCU7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0Y3RjdGNzsNCiAgICBib3JkZXI6IDFweDsNCiAgICBib3JkZXItc3R5bGU6IHNvbGlkOw0KICAgIGJvcmRlci1jb2xvcjogI0RERERERDsNCn0NCi5maWxlLWJ1dHRvbiAqIHsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCi5maWxlLWJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRg0KfQ0KLmZpbGUtYnV0dG9uIHNwYW4gew0KICAgIHBhZGRpbmctbGVmdDogMWVtOw0KfQ0KLmF0dGFjaC1waG90byBkaXYuZmlsZS11cGxvYWQgew0KICAgIHBhZGRpbmc6IDBlbTsNCiAgICBwYWRkaW5nLWJvdHRvbTogNGVtOw0KICAgIG1hcmdpbi10b3A6IC0xLjU1ZW07DQp9DQoNCg0KLyogRkVBVFVSRSBFRElUSU5HIChDT01NT04pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vDQouZWRpdG9yIC5mb3JtLWNvbnRyb2wNCnsNCiAgICB0ZXh0LWFsaWduOiByaWdodDsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5lZGl0b3IgLmZvcm0tbGFiZWwsDQouZWRpdG9yIC5mb3JtLWNvbnRyb2wNCnsNCiAgICB3aWR0aDogYXV0bzsNCn0NCg0KLmVkaXRvciBzZWxlY3Qgew0KICAgIG1heC13aWR0aDogMzAwcHg7DQp9DQoNCi5lZGl0b3IgLmZvcm0tY29udHJvbA0Kew0KICAgIGZsb2F0OiByaWdodDsNCn0NCg0KICAgIC5lZGl0b3IgLmZvcm0tY29udHJvbCB0ZXh0YXJlYQ0KICAgIHsNCiAgICAgICAgaGVpZ2h0OiAyMDBweDsNCiAgICB9DQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAubGlzdC1tZW51LWl0ZW0NCnsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIgLmxpc3QtbWVudS1uYW1lDQp7DQogICAgbWFyZ2luLWxlZnQ6IDAuNzVlbTsNCn0NCg0KLmZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIC5mZWF0dXJlLXRlbXBsYXRlDQp7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQouZmVhdHVyZS10ZW1wbGF0ZTphZnRlcg0Kew0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBoZWlnaHQ6IDA7DQogICAgY2xlYXI6IGJvdGg7DQogICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KfQ0KDQoudmlldy1mZWF0dXJlLWdlb21ldHJ5LXNlbGVjdG9yLA0KLnZpZXctZmVhdHVyZS1jcmVhdGUtb3ItZWRpdA0Kew0KICAgIHBhZGRpbmc6IDhweDsNCn0NCg0KLmNyZWF0ZS1lZGl0LWJ0bnMgLmJ1dHRvbiwNCi5sb2NhdGlvbi1idG5zIC5idXR0b24NCnsNCiAgICBtYXJnaW4tdG9wOiA0cHg7DQogICAgbWFyZ2luLXJpZ2h0OiA0cHg7DQp9DQoNCg0KLyBGSVggRk9SIERFU0tUT1AgQ09OVEVYVCBNRU5VIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoNCi8qIEZlYXR1cmUgVGVtcGxhdGUgUGlja2VyIFJ1bGVzIC0gR1ZILTYyMjIgKi8NCg0KLmZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIC5mZWF0dXJlLXRlbXBsYXRlOjphZnRlciB7DQogICAgY29udGVudDogIiI7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgY2xlYXI6IGJvdGg7DQp9DQoNCi5mZWF0dXJlLXRlbXBsYXRlLXBpY2tlciAubGlzdC1tZW51LWl0ZW0gew0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5kaWppdFBvcHVwDQp7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgIGJveC1zaGFkb3c6IDJweCAycHggMnB4ICM0NDQ0NDQ7DQogICAgLXdlYmtpdC1ib3gtc2hhZG93OiAycHggMnB4IDJweCAjNDQ0NDQ0Ow0KfQ0KDQogICAgLmRpaml0UG9wdXAgaWZyYW1lDQogICAgew0KICAgICAgICBkaXNwbGF5OiBub25lOw0KICAgIH0NCg0KICAgIC5kaWppdFBvcHVwIHRhYmxlDQogICAgew0KICAgICAgICBtYXJnaW46IC4yNWVtICFpbXBvcnRhbnQ7DQogICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB9DQoNCi5kaWppdE1lbnVJdGVtSWNvbkNlbGwNCnsNCiAgICBwYWRkaW5nLXJpZ2h0OiAuNDVlbTsNCn0NCg0KLmFkZC1vci1lZGl0LWZlYXR1cmUgZmllbGRzZXQubm8tcGFkZGluZ3sNCiAgICB3aWR0aDogMTAwJTsNCn0="),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/CreateOrEdit/CreateOrEditView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/Editor/EditorView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/TemplatePicker/FeatureTemplate.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Editing/TemplatePicker/TemplatePickerView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Editing/BinTool","Mapping/modules/Editing/CoreEditCommands","Mapping/modules/Editing/EditingModule","Mapping/modules/Editing/FeatureUtilities","Mapping/modules/Editing/Utils","Mapping/modules/Editing/CreateOrEdit/CreateOrEditView","Mapping/modules/Editing/Editor/EditorView","Mapping/modules/Editing/Editor/EditorViewModel","Mapping/modules/Editing/TemplatePicker/FeatureTemplateViewModel","Mapping/modules/Editing/TemplatePicker/TemplatePickerView","Mapping/modules/Editing/TemplatePicker/TemplatePickerViewModel","Mapping/modules/Editing/Undoable/Add","Mapping/modules/Editing/Undoable/AddAndUpdate","Mapping/modules/Editing/Undoable/Delete","Mapping/modules/Editing/Undoable/DeleteAndUpdate","Mapping/modules/Editing/Undoable/Update","Mapping/modules/Editing/Editor/Form/EditingFormField","Mapping/modules/Editing/Editor/Form/EditingFormViewModel"],function(t,i,r,a,n,s,o,l,u,d,c,p,h,g,m,f,y,v){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.editing.BinTool",t.BinTool),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.editing.CoreEditCommands",i.CoreEditCommands),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditGraphicType",r.EditGraphicType),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingModule",r.EditingModule),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.editing.FeatureUtilities",a.FeatureUtilities),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingUtils",n.EditingUtils),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.editing.CreateOrEditView",s.CreateOrEditView),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorView",o.EditorView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorState",l.EditorState),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditorViewModel",l.EditorViewModel),e(u,"geocortex.essentialsHtmlViewer.mapping.modules.editing.FeatureTemplate",u.FeatureTemplate),e(d,"geocortex.essentialsHtmlViewer.mapping.modules.editing.TemplatePickerView",d.TemplatePickerView),e(c,"geocortex.essentialsHtmlViewer.mapping.modules.editing.TemplatePickerViewModel",c.TemplatePickerViewModel),e(p,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Add",p.Add),e(h,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.AddAndUpdate",h.AddAndUpdate),e(g,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Delete",g.Delete),e(m,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.DeleteAndUpdate",m.DeleteAndUpdate),e(f,"geocortex.essentialsHtmlViewer.mapping.modules.editing.undoable.Update",f.Update),e(y,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingFormField",y.EditingFormField),e(v,"geocortex.essentialsHtmlViewer.mapping.modules.editing.EditingFormViewModel",v.EditingFormViewModel)})}();