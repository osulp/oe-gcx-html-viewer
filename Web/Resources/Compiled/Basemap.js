function shim(e,i,t){if("string"==typeof e&&(t=i,i=e),"undefined"==typeof t)return void console.warn("Undefined shim for: "+i);for(var s=i.split("."),a=null,r=window,n=0,l=s.length;n<l;n++)a=s[n],n==l-1?r[a]=t:r[a]||(r[a]={}),r=r[a]}require({cache:{"Mapping/modules/Basemap/BasemapModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,i,t){"use strict";var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.initialize=function(e){},i}(t.ModuleBase);i.BasemapModule=s})},"Mapping/modules/Basemap/BasemapServiceViewModel":function(){define(["require","exports"],function(e,i){"use strict";var t=function(){function e(e,i){if(this.mapService=null,this.relatedLayerListItem=null,!e)throw new Error("Map service is required.");this.mapService=e,this.relatedLayerListItem=i}return e.prototype.isVisible=function(){return this.mapService.isVisible()},e.prototype.displayName=function(){return this.mapService.shortDisplayName||this.mapService.displayName},e.prototype.setVisibility=function(e){this.relatedLayerListItem?this.relatedLayerListItem.setVisibility(e,!0):this.mapService.setVisibility(e)},e}();i.BasemapServiceViewModel=t})},"Mapping/modules/Basemap/BasemapSliderView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework/observables"],function(e,i,t,s){"use strict";var a=.1,r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.basemapSlider=new s.Observable,i.sliderElement=null,i.sliderLabelElement=null,i}return __extends(i,e),i.prototype.attach=function(i){e.prototype.attach.call(this,i),i.selectedBasemap.bind(this,this._onSwitcherBasemapChanged)},i.prototype.added=function(i){e.prototype.added.call(this,i),this._setupJQuerySlider()},i.prototype.toggleExpanded=function(){this.viewModel.sliderIsExpanded.set(!this.viewModel.sliderIsExpanded.get())},i.prototype._onSwitcherBasemapChanged=function(e){var i=this;this.basemapSlider.get()&&this.basemapSlider.get().selectedIndex.unbind(this.selectedIndexBindingToken),e&&e.slider&&e.slider.services.length>1?(this.isActive||this.app.viewManager.activateView(this),this.basemapSlider.set(e.slider),this.selectedIndexBindingToken=this.basemapSlider.get().selectedIndex.bind(this,function(){return i._updateSlider()}),this._updateSlider(),this._updateSelection(this.basemapSlider.get().selectedIndex.get())):(!this.isActive||this.app.viewManager.deactivateView(this),this.basemapSlider.set(null))},i.prototype._setupJQuerySlider=function(){var e=this,i={animate:!1,min:0,max:1,step:a,orientation:"horizontal",value:0,slide:function(i,t){return e._handleSliderValueChanged(i,t)}};$(this.sliderElement).slider(i),$(".ui-slider-handle",this.sliderElement).unbind("keydown"),$(".ui-slider-handle",this.sliderElement).keydown(function(i){if(e.basemapSlider.get()){var t=e.basemapSlider.get().allowTransition?a:1,s=e.basemapSlider.get().selectedIndex.get(),r=null;switch(i.which){case 38:case 39:r=Math.min(e.basemapSlider.get().services.length-1,s+t);break;case 37:case 40:r=Math.max(0,s-t);break;case 33:r=Math.min(e.basemapSlider.get().services.length-1,Math.floor(s+1));break;case 34:r=Math.max(0,Math.ceil(s-1));break;case 36:r=0;break;case 35:r=e.basemapSlider.get().services.length-1}null!=r&&(e._updateSelection(r),i.preventDefault(),i.stopPropagation())}})},i.prototype._handleSliderValueChanged=function(e,i){i&&void 0!=i.value&&this._updateSelection(i.value)},i.prototype._updateSlider=function(){if(this.basemapSlider.get()){var e=$(this.sliderElement);e.slider("option","max",this.basemapSlider.get().services.length-1),e.slider("option","step",this.basemapSlider.get().allowTransition?a:1),e.slider("value",this.basemapSlider.get().selectedIndex.get());var i=$(".ui-slider-handle",this.sliderElement);i.attr("aria-label",this.basemapSlider.get().selectedLabel.get()),i.attr("title",this.getResource("language-basemap-slider-tooltip")),i.text(this.getResource("language-basemap-slider-handle"))}},i.prototype._updateSelection=function(e){this.basemapSlider.get().setSelection(e);var i=$(this.sliderLabelElement).width(),t=$(this.sliderElement).width(),s=$(".ui-slider-handle",this.sliderElement).position().left-.5*i;s=Math.max(-parseFloat($(this.sliderElement).css("marginLeft")),s),s=Math.min(t-i+parseFloat($(this.sliderElement).css("marginRight")),s),this.sliderLabelElement.style.left=s+"px"},i}(t.ViewBase);i.BasemapSliderView=r})},"Mapping/modules/Basemap/BasemapSliderViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,i,t,s){"use strict";var a=function(e){function i(i,t,a,r){var n=e.call(this,i,r)||this;return n.services=[],n.selectedIndex=new s.Observable,n.allowTransition=!0,n.selectedLabel=new s.Observable(""),n.minLabel=new s.Observable(""),n.maxLabel=new s.Observable(""),n.visible=new s.Observable((!1)),n._settingSelection=!1,n._visibilityChangeHandles=[],n._opacityChangeHandles=[],n.allowTransition="undefined"==typeof a||a,n.setMapServices(t),n}return __extends(i,e),i.prototype.setMapServices=function(e){var i=this;if(!e||e.length<2)throw new Error("A basemap slider must contain at least two map services.");this._visibilityChangeHandles.forEach(function(e){return e.remove()}),this._opacityChangeHandles.forEach(function(e){return e.remove()}),this._visibilityChangeHandles=[],this._opacityChangeHandles=[],this.services=e,this.selectedIndex.set(e.length-1);for(var t=0;t<this.services.length;t++){var s=this.services[t];s.isVisible&&this.selectedIndex.set(t),s.mapService.serviceLayer&&(this._visibilityChangeHandles.push(s.mapService.serviceLayer.on("visibility-change",function(){return i._onChildVisibilityChange()})),this._opacityChangeHandles.push(s.mapService.serviceLayer.on("opacity-change",function(){return i._onChildVisibilityChange()})))}this._onChildVisibilityChange(),this._refreshSelectedLabel(),this.minLabel.set(this.services[0].displayName()),this.maxLabel.set(this.services[this.services.length-1].displayName())},i.prototype.setVisibility=function(e){if(e){var i=this.selectedIndex.get();(i<0||i>=this.services.length)&&(i=this.services.length-1),this.setSelection(i)}else this.services.forEach(function(e){return e.setVisibility(!1)});this.visible.set(e)},i.prototype.setSelection=function(e){var i=this.services[Math.floor(e)];if(!i)throw new Error("Basemap index out of range.");this.allowTransition||(e=Math.floor(e)),this._settingSelection=!0,this.selectedIndex.set(e),this._refreshSelectedLabel();var t=this.services[Math.floor(e)+1],s=e-Math.floor(e),a=s&&t;this.services.forEach(function(e){e===i?(e.setVisibility(!0),e.mapService.setOpacity(1)):a&&e===t?(e.setVisibility(!0),e.mapService.setOpacity(s)):(e.setVisibility(!1),e.mapService.setOpacity(1))}),this._settingSelection=!1},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this._visibilityChangeHandles.forEach(function(e){return e.remove()}),this._opacityChangeHandles.forEach(function(e){return e.remove()})},i.prototype._onChildVisibilityChange=function(){if(!this._settingSelection){var e=[];this.services.forEach(function(i,t){i.mapService.serviceLayer.visible&&e.push(t)}),1===e.length&&1===this.services[e[0]].mapService.opacity?(this.selectedIndex.set(e[0]),this.visible.set(!0)):2===e.length&&this.allowTransition&&e[1]-e[0]===1&&1==this.services[e[0]].mapService.opacity&&this.services[e[1]].mapService.opacity<1?(this.selectedIndex.set(e[0]+this.services[e[1]].mapService.opacity),this.visible.set(!0)):this.visible.set(!1),this._refreshSelectedLabel()}},i.prototype._refreshSelectedLabel=function(){var e=this.selectedIndex.get()-Math.floor(this.selectedIndex.get()),i=e<=.5?Math.floor(this.selectedIndex.get()):Math.floor(this.selectedIndex.get())+1;this.selectedLabel.set(this.services[i].displayName())},i}(t.ViewModelBase);i.BasemapSliderViewModel=a})},"Mapping/modules/Basemap/BasemapSwitcherButtonView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,i,t){"use strict";var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.attach=function(i){e.prototype.attach.call(this,i),this.configuration&&this.configuration.hasOwnProperty("hideIfNoBasemapsAvailable")&&(this.viewModel.hideIfNoBasemapsAvailable=this.configuration.hideIfNoBasemapsAvailable)},i.prototype.handleDrawerButtonClicked=function(){this.viewModel.basemaps.getLength()>0&&(this.app.viewManager.getViewById("BasemapSwitcherView")&&this.app.command("ToggleView").execute("BasemapSwitcherView"),this.app.command("ToggleBasemapsDrawer").execute())},i}(t.ViewBase);i.BasemapSwitcherButtonView=s})},"Mapping/modules/Basemap/BasemapSwitcherView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","./BasemapSliderViewModel"],function(e,i,t,s){"use strict";var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.attach=function(i){e.prototype.attach.call(this,i),this.viewModel.isExpanded.bind(this,this._setButtonSize),this.viewModel.selectedBasemap.get()instanceof s.BasemapSliderViewModel&&this.viewModel.sliderIsExpanded.set(!0)},i.prototype._setButtonSize=function(){var e=$(this.drawerContentParent).children().eq(0);this.viewModel.buttonWidth=$(e).outerWidth(!0),this.viewModel.buttonHeight=$(e).outerHeight(!0)},i.prototype.handleBasemapClick=function(e,i,t){this.app.command("SelectBaseMap").execute(t.displayName.get())},i}(t.ViewBase);i.BasemapSwitcherView=a})},"Mapping/modules/Basemap/BasemapSwitcherViewControllerView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,i,t){"use strict";var s;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e[e.None=2]="None"}(s=i.ExpandDirection||(i.ExpandDirection={}));var a;!function(e){e[e.Back=0]="Back",e[e.Forward=1]="Forward",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom"}(a=i.ScrollDirection||(i.ScrollDirection={}));var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._collapsibleAreaWidth=null,i._collapsibleAreaHeight=null,i._numberOfRowsMaximumLimit=5,i._numberOfColumnsMaximumLimit=5,i._numberOfRowsMinimumLimit=2,i._numberOfColumnsMinimumLimit=2,i._numberOfColumns=3,i._numberOfRows=1,i._adjustedNumberOfRows=0,i._adjustedNumberOfColumns=0,i._numberOfElementsAfterCurrentWindow=0,i._numberOfElementsBeforeCurrentWindow=0,i._numberOfDrawerItems=0,i}return __extends(i,e),i.prototype.resolveWidget=function(i,t){if(e.prototype.resolveWidget.call(this,i,t),!i||"basemapsList"!==i||!t)return null;var s=this.app.viewManager.createView({markupResource:"Mapping/modules/Basemap/BasemapSwitcherView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSwitcherView",isVisible:!0,libraryId:this.libraryId});return s.attach(t),s},i.prototype.attach=function(i){var t=this;e.prototype.attach.call(this,i),this.configuration&&this.configuration.hasOwnProperty("grid")&&this.configuration.grid.hasOwnProperty("numberOfRows")&&this.configuration.grid.hasOwnProperty("numberOfColumns")&&(this._numberOfRows=this.configuration.grid.numberOfRows,this._numberOfColumns=this.configuration.grid.numberOfColumns),this.app.site&&this.app.site.isInitialized?(this._numberOfDrawerItems=this.viewModel.basemaps.getLength(),this.viewModel.isExpanded.get()&&this._sizeDrawer()):this.app.event("SiteInitializedEvent").once(this,function(){t._numberOfDrawerItems=t.viewModel.basemaps.getLength(),t.viewModel.isExpanded.get()&&t._sizeDrawer()}),this.viewModel.selectedLayerTheme.bind(this,function(){t._numberOfDrawerItems=t.viewModel.basemaps.getLength(),t.viewModel.isExpanded.get()&&(t._sizeDrawer(!0),0===t.viewModel.basemaps.getLength()&&t.viewModel.isExpanded.set(!1))}),this.app.command("ToggleBasemapsDrawer").register(this,function(){t.viewModel.isExpanded.set(!t.viewModel.isExpanded.get()),t.viewModel.isExpanded.get()||t.viewModel.selectedBasemap.pulse(),t.viewModel.isExpanded.get()&&t.app.command("DeactivateView").execute("BasemapSliderView"),t._sizeDrawer(t.viewModel.isExpanded.get())}),this.app.eventRegistry.event("BaseMapSelected").subscribe(this,function(){t.viewModel.isExpanded.set(!1),t.app.command("ShowMap").execute()}),this.viewModel.isExpanded.bind(this,this._handleIsExpandedChanged)},i.prototype._handleIsExpandedChanged=function(e){var i=this;if(e){this.app.event("FlyoutActivated").publish(this);var t={view:this,onOtherInteracted:function(e){return i._onOtherInteracted(e)}};this.app.command("TapToDismiss").execute(t)}else this.app.event("FlyoutDeactivated").publish(this)},i.prototype._onOtherInteracted=function(e){0===$(e.target).closest(".BasemapSwitcherButtonView").length&&this.viewModel.isExpanded.set(!1)},i.prototype._adjustDrawerGrid=function(){this._adjustedNumberOfRows=this._numberOfRows,this._adjustedNumberOfColumns=this._numberOfColumns,this._numberOfRows<=0&&(this._adjustedNumberOfRows=1),this._numberOfColumns<=0&&(this._adjustedNumberOfColumns=1),this._numberOfDrawerItems>1&&this._numberOfColumns<this._numberOfColumnsMinimumLimit&&this._numberOfRows<this._numberOfRowsMinimumLimit&&(this._adjustedNumberOfColumns=this._numberOfColumnsMinimumLimit),this._adjustedNumberOfColumns>this._numberOfColumnsMaximumLimit&&(this._adjustedNumberOfColumns=this._numberOfColumnsMaximumLimit),this._adjustedNumberOfRows>this._numberOfRowsMaximumLimit&&(this._adjustedNumberOfRows=this._numberOfRowsMaximumLimit);var e=this._adjustedNumberOfColumns*this._adjustedNumberOfRows,i=e-this._numberOfDrawerItems;if(i>0)for(;i>0;){var t=(this._adjustedNumberOfColumns-1)*this._adjustedNumberOfRows,s=this._adjustedNumberOfColumns*(this._adjustedNumberOfRows-1),a=t-this._numberOfDrawerItems,r=s-this._numberOfDrawerItems;if(a<0&&r<0)return;a>=0&&r>=0?a<r?this._adjustedNumberOfColumns=this._adjustedNumberOfColumns-1:this._adjustedNumberOfRows=this._adjustedNumberOfRows-1:a<0&&r>=0?this._adjustedNumberOfRows=this._adjustedNumberOfRows-1:a>=0&&r<0&&(this._adjustedNumberOfColumns=this._adjustedNumberOfColumns-1),e=this._adjustedNumberOfColumns*this._adjustedNumberOfRows,i=e-this._numberOfDrawerItems}this._adjustedNumberOfRows>1?this.viewModel.multipleRows.set(!0):this.viewModel.multipleRows.set(!1)},i.prototype._getExpandDirection=function(e,i,t){var a=t*i;if(e>a){if(i===t)return s.Horizontal;if(i>t)return s.Vertical;if(t>i)return s.Horizontal}return s.None},i.prototype._sizeDrawer=function(e){this._adjustDrawerGrid();var i=$(this.forwardArrowElement).outerWidth(),t=$(this.bottomArrowElement).outerHeight(),a=this._getExpandDirection(this._numberOfDrawerItems,this._adjustedNumberOfRows,this._adjustedNumberOfColumns);(0===this._numberOfElementsBeforeCurrentWindow||e)&&(this._numberOfElementsBeforeCurrentWindow=0,this._numberOfElementsAfterCurrentWindow=Math.ceil(this._numberOfDrawerItems/(a===s.Vertical?this._adjustedNumberOfColumns:this._adjustedNumberOfRows))-(a===s.Vertical?this._adjustedNumberOfRows:this._adjustedNumberOfColumns));var r=Math.ceil(this.viewModel.buttonWidth*this._adjustedNumberOfColumns);a===s.Horizontal&&(r+=2*i);var n=Math.ceil(this.viewModel.buttonHeight)*this._adjustedNumberOfRows;a===s.Vertical&&(n+=2*t),this._initializeControllerElements(a,e),this._collapsibleAreaWidth=r,this._collapsibleAreaHeight=n,this._sizeDrawerContent(a)},i.prototype._sizeDrawerContent=function(e){$(this.collapsibleAreaElement).width(this._collapsibleAreaWidth),$(this.collapsibleAreaElement).height(this._collapsibleAreaHeight),$(this.drawerElement).width(this._collapsibleAreaWidth),$(this.drawerElement).height(this._collapsibleAreaHeight),this._numberOfDrawerItems>this._adjustedNumberOfColumns*this._adjustedNumberOfRows?e===s.Horizontal?($(this.drawerContentElement).width(Math.ceil(Math.ceil(this._numberOfDrawerItems/this._adjustedNumberOfRows)*this.viewModel.buttonWidth+$(this.forwardArrowElement).outerWidth())),$(this.drawerContentElement).height(this._collapsibleAreaHeight)):e===s.Vertical&&($(this.drawerContentElement).height(Math.ceil(Math.ceil(this._numberOfDrawerItems/this._adjustedNumberOfColumns)*this.viewModel.buttonHeight+$(this.bottomArrowElement).outerHeight())),$(this.drawerContentElement).width(this._collapsibleAreaWidth)):($(this.drawerContentElement).width(this._collapsibleAreaWidth),$(this.drawerContentElement).height(this._collapsibleAreaHeight))},i.prototype._initializeControllerElements=function(e,i){e===s.None&&(this.viewModel.hasHorizontalControls.set(!1),this.viewModel.hasVerticalControls.set(!1),this.viewModel.backArrowVisible.set(!1),this.viewModel.forwardArrowVisible.set(!1),this.viewModel.bottomArrowVisible.set(!1),this.viewModel.topArrowVisible.set(!1)),e===s.Horizontal&&(this.viewModel.hasHorizontalControls.set(!0),this.viewModel.hasVerticalControls.set(!1),this.viewModel.backArrowVisible.set(!0),this.viewModel.forwardArrowVisible.set(!0),i&&(this.viewModel.backArrowEnabled.set(!1),this.viewModel.forwardArrowEnabled.set(!0),$(this.drawerElement).scrollLeft(0))),e===s.Vertical&&(this.viewModel.hasVerticalControls.set(!0),this.viewModel.hasHorizontalControls.set(!1),this.viewModel.topArrowVisible.set(!0),this.viewModel.bottomArrowVisible.set(!0),i&&(this.viewModel.topArrowEnabled.set(!1),this.viewModel.bottomArrowEnabled.set(!0),$(this.drawerElement).scrollTop(0)))},i.prototype._enableDisableScrollArrows=function(e,i){e===s.Horizontal?(i===a.Forward?(this._numberOfElementsAfterCurrentWindow=this._numberOfElementsAfterCurrentWindow-this._adjustedNumberOfColumns,this._numberOfElementsBeforeCurrentWindow=this._numberOfElementsBeforeCurrentWindow+this._adjustedNumberOfColumns):(this._numberOfElementsAfterCurrentWindow=this._numberOfElementsAfterCurrentWindow+this._adjustedNumberOfColumns,this._numberOfElementsBeforeCurrentWindow=this._numberOfElementsBeforeCurrentWindow-this._adjustedNumberOfColumns),this._numberOfElementsAfterCurrentWindow<0&&(this._numberOfElementsBeforeCurrentWindow=this._numberOfElementsBeforeCurrentWindow+this._numberOfElementsAfterCurrentWindow,this._numberOfElementsAfterCurrentWindow=0),this._numberOfElementsBeforeCurrentWindow>0?this.viewModel.backArrowEnabled.set(!0):this.viewModel.backArrowEnabled.set(!1),this._numberOfElementsAfterCurrentWindow>0?this.viewModel.forwardArrowEnabled.set(!0):this.viewModel.forwardArrowEnabled.set(!1)):(i===a.Bottom?(this._numberOfElementsAfterCurrentWindow=this._numberOfElementsAfterCurrentWindow-this._adjustedNumberOfRows,this._numberOfElementsBeforeCurrentWindow=this._numberOfElementsBeforeCurrentWindow+this._adjustedNumberOfRows):(this._numberOfElementsAfterCurrentWindow=this._numberOfElementsAfterCurrentWindow+this._adjustedNumberOfRows,this._numberOfElementsBeforeCurrentWindow=this._numberOfElementsBeforeCurrentWindow-this._adjustedNumberOfRows),this._numberOfElementsBeforeCurrentWindow>0?this.viewModel.topArrowEnabled.set(!0):this.viewModel.topArrowEnabled.set(!1),this._numberOfElementsAfterCurrentWindow>0?this.viewModel.bottomArrowEnabled.set(!0):this.viewModel.bottomArrowEnabled.set(!1))},i.prototype.handleScrollForward=function(e,i,t){var r=$(this.drawerElement);r.scrollLeft(r.scrollLeft()+$(this.drawerElement).width()-2*$(this.backArrowElement).width()),this._enableDisableScrollArrows(s.Horizontal,a.Forward),$(this.forwardArrowElement).blur()},i.prototype.handleScrollBack=function(e,i,t){var r=$(this.drawerElement);r.scrollLeft(r.scrollLeft()-$(this.drawerElement).width()+2*$(this.forwardArrowElement).width()),this._enableDisableScrollArrows(s.Horizontal,a.Back),$(this.backArrowElement).blur()},i.prototype.handleScrollTop=function(e,i,t){var r=$(this.drawerElement);r.scrollTop(r.scrollTop()-$(this.drawerElement).height()+2*$(this.bottomArrowElement).height()),this._enableDisableScrollArrows(s.Vertical,a.Top),$(this.topArrowElement).blur()},i.prototype.handleScrollBottom=function(e,i,t){var r=$(this.drawerElement);r.scrollTop(r.scrollTop()+$(this.drawerElement).height()-2*$(this.topArrowElement).height()),this._enableDisableScrollArrows(s.Vertical,a.Bottom),$(this.bottomArrowElement).blur()},i}(t.ViewBase);i.BasemapSwitcherViewControllerView=r})},"Mapping/modules/Basemap/BasemapSwitcherViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","./BasemapViewModel","geocortex/framework/observables","geocortex/infrastructure/layerList/LayerListItem","./BasemapServiceViewModel"],function(e,i,t,s,a,r,n){"use strict";var l=function(e){function i(i,t){var s=e.call(this,i,t)||this;return s._visibilityChangeTokens=[],s.hideIfNoBasemapsAvailable=!1,s.visibleBasemaps=[],s.backArrowVisible=new a.Observable((!1)),s.backArrowEnabled=new a.Observable((!1)),s.forwardArrowVisible=new a.Observable((!1)),s.forwardArrowEnabled=new a.Observable((!0)),s.topArrowVisible=new a.Observable((!1)),s.topArrowEnabled=new a.Observable((!1)),s.bottomArrowVisible=new a.Observable((!1)),s.bottomArrowEnabled=new a.Observable((!0)),s.multipleRows=new a.Observable((!1)),s.isExpanded=new a.Observable((!1)),s.sliderMinLabel=new a.Observable,s.sliderMaxLabel=new a.Observable,s.sliderSelectedLabel=new a.Observable,s.sliderIsExpanded=new a.Observable((!0)),s.sliderTicks=new a.ObservableCollection,s.basemaps=new a.ObservableCollection,s.layerThemes=new a.ObservableCollection,s.selectedBasemap=new a.Observable,s.selectedBasemapIconUri=new a.Observable,s.selectedLayerTheme=new a.Observable,s.buttonWidth=0,s.buttonHeight=0,s.hasHorizontalControls=new a.Observable((!1)),s.hasVerticalControls=new a.Observable((!1)),s._basemapsAutoCreated=!1,s.headerLabel=new a.Observable(i.getResource(t,"language-basemap-switcher-basemaps")),s.selectedBasemapIconUri.set("Resources/Images/Icons/basemap-24.png"),s.selectedBasemap.bind(s,s._updateBasemapSwitcherButton),s.selectedLayerTheme.bind(s,function(){s._populateBaseMaps(),s.layerList&&s._orderBaseMaps(),s._updateVisibleBasemaps()}),s.app.command("SelectBaseMap").register(s,s._executeSelectBaseMap),s}return __extends(i,e),i.prototype.initialize=function(e){var i=this;this.app.event("SiteInitializedEvent").once(this,function(){i._populateBaseMaps(),i._populateLayerThemes(),i._updateVisibleBasemaps()}),this.app.event("LayerListInitializedEvent").once(this,function(e){i.layerList=e,i._orderBaseMaps()})},i.prototype._layerListInitialized=function(){this._populateBaseMaps(),this._populateLayerThemes(),this._updateVisibleBasemaps()},i.prototype._orderBaseMaps=function(){var e=this,i=[];if(this.layerList.children.get().forEach(function(e){return i.push.apply(i,e.getSelfAndDescendants())}),i=i.filter(function(e){return e.type===r.LayerListItemType.MAPSERVICE&&"Base"===e.mapService.serviceLayerFunction&&e.inActiveTheme.get()}),i.forEach(function(i){e.basemaps.get().forEach(function(e){e.services.forEach(function(e){i.mapService.id==e.mapService.id&&(e.relatedLayerListItem=i)}),e.slider&&e.slider.services.forEach(function(e){i.mapService.id==e.mapService.id&&(e.relatedLayerListItem=i)})})}),this._basemapsAutoCreated){var t=[];t.push.apply(t,i.map(function(e){return e.mapService.id})),t.push.apply(t,this.app.site.essentialsMap.mapServices.map(function(e){return e.id}));var s=this.basemaps.get().slice(),a=function(e){var i=e.slider&&e.slider.services?e.slider.services[0]:e.services[0];return t.indexOf(i.mapService.id)};s.sort(function(e,i){return a(e)-a(i)}),this.basemaps.set(s)}},i.prototype._populateBaseMaps=function(){var e=this;this._visibilityChangeTokens.forEach(function(e){return e.remove()}),this._visibilityChangeTokens=[],this.basemaps.get().forEach(function(e){return e.destroy()}),this.basemaps.clear();var i=this.app.site.essentialsMap.mapServicesFilteredView||[];i=i.filter(function(e){return"Base"===e.mapServiceFunction});var t=i.map(function(e){return new n.BasemapServiceViewModel(e)});if(this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.baseMaps&&this.app.site.essentialsMap.baseMaps.length)this.app.site.essentialsMap.baseMaps.forEach(function(i){var a=[];if(i.services.forEach(function(e){var i=t.filter(function(i){return i.mapService===e.mapService})[0];i&&a.push(i)}),a.length){var r=new s.BasemapViewModel(e.app,e.libraryId,a);r.displayName.set(i.displayName),i.iconUri&&r.iconUri.set(i.iconUri),e.basemaps.addItem(r),r.visible.bind(e,function(i){return e._updateVisibleBasemaps()})}});else{this._basemapsAutoCreated=!0;var a={};t.forEach(function(i){var r=i.mapService.iconUri,n=i.displayName(),l=[i];if(i.mapService.baseMapGroup){var o=i.mapService.baseMapGroup;if(a[o])return;n=o,a[o]=!0,t.forEach(function(e){e!==i&&e.mapService.baseMapGroup===o&&(l.push(e),r=r||e.mapService.iconUri)})}var d=new s.BasemapViewModel(e.app,e.libraryId,l);d.displayName.set(n),d.iconUri.set(r),e.basemaps.addItem(d),d.visible.bind(e,function(i){return e._updateVisibleBasemaps()})})}var r=this.basemaps.getLength()<=1&&this.hideIfNoBasemapsAvailable,l=this.app.viewManager.getViewById("BasemapSwitcherButtonView");r?(this.isExpanded.set(!r),l&&this.app.viewManager.deactivateView(l)):l&&this.app.viewManager.activateView(l)},i.prototype._populateLayerThemes=function(){var e=this;if(this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.layerThemesInfo){var i=this.app.site.essentialsMap.layerThemesInfo;this.layerThemes.addItems(i.themes),i.activeTheme&&this.selectedLayerTheme.set(i.activeTheme),dojo.connect(i,"layerThemeChangedEvent",function(i){i.currTheme&&i.currTheme.displayName&&e.selectedLayerTheme.get()!==i.currTheme&&e.selectedLayerTheme.set(i.currTheme)})}},i.prototype._updateVisibleBasemaps=function(){this.visibleBasemaps=[];for(var e=0;e<this.basemaps.length();e++){var i=this.basemaps.getAt(e);i.visible.get()&&this.visibleBasemaps.push(i)}var t=null;1==this.visibleBasemaps.length&&(t=this.visibleBasemaps[0],t!=this.selectedBasemap.get()&&this.selectedBasemap.set(t))},i.prototype._updateBasemapSwitcherButton=function(e){if(e&&null!=e.slider){this.sliderMinLabel.sync(e.slider.minLabel),this.sliderMaxLabel.sync(e.slider.maxLabel),this.sliderSelectedLabel.sync(e.slider.selectedLabel),this.sliderTicks.clear();for(var i=100/(e.slider.services.length-1),t=0;t<100;t+=i)this.sliderTicks.addItem({position:t+"%"})}else this.sliderMinLabel.removeSync(),this.sliderMinLabel.set(""),this.sliderMaxLabel.removeSync(),this.sliderMaxLabel.set(""),this.sliderSelectedLabel.removeSync(),this.sliderSelectedLabel.set("");e&&e.visible.get()?(this.headerLabel.set(e.displayName.get()),this.selectedBasemapIconUri.set(e?e.iconUri.get():"Resources/Images/Icons/basemap-24.png")):(this.headerLabel.set(this.app.getResource(this.libraryId,"language-basemap-switcher-basemaps")),this.selectedBasemapIconUri.set("Resources/Images/Icons/basemap-24.png"))},i.prototype._executeSelectBaseMap=function(e){if(e){e=e.toString().toLowerCase();for(var i,t=0;t<this.basemaps.getLength();t++){var s=this.basemaps.getAt(t);if(s&&s.displayName.get()&&s.displayName.get().toLowerCase()===e){i=s;break}}i&&(i.setVisibility(!0),this.selectedBasemap.set(i),this.app.eventRegistry.event("BaseMapSelected").publish(e))}},i.prototype._getActiveLayerTheme=function(){return this.app.site.essentialsMap.layerThemesInfo?this.app.site.essentialsMap.layerThemesInfo.activeTheme:null},i}(t.ViewModelBase);i.BasemapSwitcherViewModel=l})},"Mapping/modules/Basemap/BasemapView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,i,t){"use strict";var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i}(t.ViewBase);i.BasemapView=s})},"Mapping/modules/Basemap/BasemapViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./BasemapSliderViewModel","geocortex/essentials/MapServiceConstants"],function(e,i,t,s,a,r){"use strict";var n=function(e){function i(i,t,a){var r=e.call(this,i,t)||this;return r.displayName=new s.Observable,r.visible=new s.Observable,r.iconUri=new s.Observable,r.services=[],r.slider=null,r._serviceIds=[],r._visibilityChangeHandles=[],r._sliderVisibilityBindToken=null,r.DEFAULT_ICON="Resources/Images/Icons/basemap-24.png",r.iconUri.set(r.DEFAULT_ICON),a&&r.setServices(a),r}return __extends(i,e),i.prototype.setServices=function(e){var i=this;if(e){this._visibilityChangeHandles.forEach(function(e){return e.remove()}),this._visibilityChangeHandles=[],this.slider&&(this.slider.visible.unbind(this._sliderVisibilityBindToken),this.slider.destroy()),this.services=[],this._serviceIds=[],this.slider=null;var t=[];e.forEach(function(e){i._serviceIds.push(e.mapService.id),e.mapService.baseMapGroup&&0===t.length?t.push(e):e.mapService.baseMapGroup&&e.mapService.baseMapGroup===t[0].mapService.baseMapGroup?t.push(e):i.services.push(e)}),t.length>1?(t.sort(function(e,i){return e.mapService.baseMapGroupIndex-i.mapService.baseMapGroupIndex}),this.slider=new a.BasemapSliderViewModel(this.app,t,(!t[0].mapService.baseMapGroupIsMutuallyExclusive),this.libraryId),this._sliderVisibilityBindToken=this.slider.visible.bind(this,function(e){return i.visible.set(i._calculateIsVisible())})):1==t.length&&this.services.push(t[0]),this.visible.set(this._calculateIsVisible());var s=this.app.site.essentialsMap.layerThemesInfo;this.app.site.essentialsMap.mapServices.forEach(function(e){i._visibilityChangeHandles.push(e.serviceLayer.on("visibility-change",function(e){s&&s.layerThemesConfigured&&s.themeChangeInProgress||i.visible.set(i._calculateIsVisible())}))})}},i.prototype.setVisibility=function(e){var i=this;this.services.forEach(function(i){return i.setVisibility(e)}),this.slider&&this.slider.setVisibility(e);var t=this.app.site.essentialsMap.mapServices.filter(function(e){return e.mapServiceFunction===r.MapServiceFunction.BASE});t.forEach(function(e){i.hasMapService(e)||e.setVisibility(!1)})},i.prototype.hasMapService=function(e){return!!e&&this._serviceIds.some(function(i){return i===e.id})},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this._visibilityChangeHandles.forEach(function(e){return e.remove()}),this.slider&&(this.slider.visible.unbind(this._sliderVisibilityBindToken),this.slider.destroy())},i.prototype._calculateIsVisible=function(){var e=this,i=this.app.site.essentialsMap.mapServices.filter(function(e){return e.mapServiceFunction===r.MapServiceFunction.BASE}),t=i.every(function(i){return!i.isVisible()||e.hasMapService(i)});return t=t&&this.services.every(function(e){return e.isVisible()}),this.slider&&(t=t&&this.slider.visible.get()),t},i}(t.ViewModelBase);i.BasemapViewModel=n})},"url:/Mapping/modules/Basemap/BasemapSliderView.html":'<div class="basemap-slider-container" data-binding="{@class-basemap-slider-expanded: sliderIsExpanded}">\r\n    <button class="basemap-slider-toggle" data-binding="{@event-onclick: toggleExpanded}{@class-basemap-slider-expanded: sliderIsExpanded}{title: @language-basemap-slider-toggle-button}" tabindex="0">Toggle</button>\r\n    <div class="basemap-slider-inner" data-binding="{@visible: sliderIsExpanded}">\r\n        <div class="slider-label slider-label-min" data-binding="{@text: sliderMinLabel}"></div>\r\n        <div class="slider-label slider-label-max" data-binding="{@text: sliderMaxLabel}"></div>\r\n        <div class="basemap-slider-ticks" data-binding="{@source: sliderTicks}">\r\n            <div class="tick" data-binding="{@template-for: sliderTicks}{@style-left: position}"></div>\r\n        </div>\r\n        <div class="basemap-slider" data-binding="{@var: sliderElement}">\r\n            <div class="tick last-tick"></div>\r\n            <div class="slider-label slider-label-current" data-binding="{@var: sliderLabelElement}{@text: sliderSelectedLabel}"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/modules/Basemap/BasemapSwitcherButtonView.html":'<div class="flyout-menu">\r\n    <button class="flyout-menu-active-tool" data-binding="{@event-onclick: handleDrawerButtonClicked}{title: @language-basemap-switcher-switch}{@enabled: basemaps}" tabindex="0">\r\n        <img data-binding="{@visible: selectedBasemapIconUri}{src: selectedBasemapIconUri}{alt: headerLabel}"/>\r\n        <p class="tool-label" data-binding="{@text: headerLabel}{title: headerLabel}"></p>\r\n    </button>\r\n    \r\n    <div data-binding="{@widget: BasemapsListController}{@widget-context: @context}{@widget-replace: true}"></div>\r\n</div>',
"url:/Mapping/modules/Basemap/BasemapSwitcherView.html":'<ul class="basemap-switcher toolbar-parent" data-binding="{@source: basemaps}{@var: drawerContentParent}">\r\n    <li class="basemap-item" data-binding="{@template-for: basemaps}">\r\n        <button class="toolbar-item" data-binding="{@class-selected: visible}{@event-onclick: handleBasemapClick}" tabindex="0">\r\n            <img class="icon" data-binding="{@visible: iconUri}{src: iconUri}{title: displayName}{alt: displayName}" />\r\n            <p class="label" data-binding="{@text: displayName}{title: displayName}"></p>\r\n        </button>\r\n    </li>\r\n</ul>',"url:/Mapping/modules/Basemap/BasemapSwitcherViewControllerView.html":'<div class="flyout-menu-collapsible-area flyout-menu-tools" data-binding="{@visible: isExpanded}{@var: collapsibleAreaElement}{@class-multi-row: multipleRows}">\r\n    <button class="flyout-menu-scroll scroll-back" data-binding="{@event-onclick: handleScrollBack}{@enabled:backArrowEnabled}{@visible:backArrowVisible}{@var: backArrowElement}" tabindex="0">\r\n        <img src="Resources/Images/Icons/chevron-left-16.png" data-binding="{alt: @language-compact-toolbar-more-tools}" />\r\n    </button>\r\n\r\n    <button class="flyout-menu-scroll scroll-top" data-binding="{@event-onclick: handleScrollTop}{@enabled: topArrowEnabled}{@visible: topArrowVisible}{@var: topArrowElement}" tabindex="0">\r\n        <img src="Resources/Images/Icons/chevron-up-24.png" data-binding="{alt: @language-compact-toolbar-more-tools}" />\r\n    </button>\r\n\r\n    <!--<div class="flyout-menu-expanded" data-binding="{@var: expandedElement}">-->\r\n    <div class="flyout-menu-floating-area" data-binding="{@var: drawerElement}">\r\n        <div class="toolbar-item toolbar-group" data-binding="{@var: drawerContentElement}{@class-toolbar-group-horizontal-controls: hasHorizontalControls}{@class-toolbar-group-vertical-controls: hasVerticalControls}">\r\n            <div data-binding="{@widget: basemapsList}{@widget-context: @context}{@widget-replace: true}"></div>\r\n        </div>\r\n    </div>\r\n    <!--</div>-->\r\n\r\n    <button class="flyout-menu-scroll scroll-forward" data-binding="{@event-onclick: handleScrollForward}{@enabled: forwardArrowEnabled}{@visible:forwardArrowVisible}{@var: forwardArrowElement}">\r\n        <img src="Resources/Images/Icons/chevron-right-16.png" data-binding="{alt: @language-compact-toolbar-more-tools}" />\r\n    </button>\r\n\r\n    <button class="flyout-menu-scroll scroll-bottom" data-binding="{@event-onclick: handleScrollBottom}{@enabled: bottomArrowEnabled}{@visible: bottomArrowVisible}{@var: bottomArrowElement}">\r\n        <img src="Resources/Images/Icons/chevron-down-24.png" data-binding="{alt: @language-compact-toolbar-more-tools}" />\r\n    </button>\r\n</div>',"url:/Mapping/modules/Basemap/BasemapView.html":'<div class="region basemap-region" data-region-name="BasemapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>',"url:/Mapping/modules/Basemap/SmallBasemapSwitcherButtonView.html":'<div class="basemap-switcher-wrapper" data-binding="{@visible: showBasemapsControl}{@class-switcher-active: expanded}{@noclass-switcher-inactive: expanded}">\r\n\r\n    <div class="basemap-button small" data-binding="{@event-onclick: handleDrawerButtonClicked}">\r\n        <img class="basemap-icon" data-binding="{@visible: selectedBasemapIconUri}{src: selectedBasemapIconUri}{alt: displayName}" />\r\n        <span class="display-name" data-binding="{@text: headerLabel}{title: headerLabel}"></span>\r\n    </div>\r\n</div>\r\n\r\n'}}),define(["Mapping/modules/Basemap/BasemapModule","Mapping/modules/Basemap/BasemapServiceViewModel","Mapping/modules/Basemap/BasemapSliderView","Mapping/modules/Basemap/BasemapSliderViewModel","Mapping/modules/Basemap/BasemapSwitcherButtonView","Mapping/modules/Basemap/BasemapSwitcherView","Mapping/modules/Basemap/BasemapSwitcherViewControllerView","Mapping/modules/Basemap/BasemapSwitcherViewModel","Mapping/modules/Basemap/BasemapView","Mapping/modules/Basemap/BasemapViewModel"],function(e,i,t,s,a,r,n,l,o,d){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapModule",e.BasemapModule),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapServiceViewModel",i.BasemapServiceViewModel),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSliderView",t.BasemapSliderView),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSliderViewModel",s.BasemapSliderViewModel),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSwitcherButtonView",a.BasemapSwitcherButtonView),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSwitcherView",r.BasemapSwitcherView),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.ExpandDirection",n.ExpandDirection),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.ScrollDirection",n.ScrollDirection),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSwitcherViewControllerView",n.BasemapSwitcherViewControllerView),shim(l,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapSwitcherViewModel",l.BasemapSwitcherViewModel),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapView",o.BasemapView),shim(d,"geocortex.essentialsHtmlViewer.mapping.modules.basemap.BasemapViewModel",d.BasemapViewModel)});