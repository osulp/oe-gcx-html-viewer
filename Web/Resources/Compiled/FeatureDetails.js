function shim(e,t,r){if("string"==typeof e&&(r=t,t=e),"undefined"==typeof r)return void console.warn("Undefined shim for: "+t);for(var a=t.split("."),i=null,n=window,s=0,o=a.length;s<o;s++)i=a[s],s==o-1?n[i]=r:n[i]||(n[i]={}),n=n[i]}require({cache:{"Mapping/modules/FeatureDetails/FeatureDetailsModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSetCollection","geocortex/framework/ui/MultiViewRegionAdapter","geocortex/geocortex","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/GraphicUtils"],function(e,t,r,a,i,n,s,o,l){"use strict";var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.providerViewModelList=[],t.providerViewList=[],t._providerConfig=null,t._currentFeature=null,t._defaultViewMode=null,t._viewModes={},t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this._processConfig(t),this.registerCommands(),this.app.event("GraphicAttributesChangedEvent").subscribe(this,this.handleGraphicAttributesUpdated)},t.prototype.handleGraphicAttributesUpdated=function(e){var t=e.graphic;this._currentFeature&&this._currentFeature.esriFeature&&this._currentFeature.esriFeature.get()==t&&(this._currentFeature.esriFeature.pulse(),this.app.event("FeatureChangedEvent").publish(this._currentFeature))},t.prototype.getStateFilter=function(){return{currentFeature:this.app.project.filter.feature,viewMode:!0}},t.prototype.exportState=function(){var e=this;return Promise["try"](function(){var t=e._viewModes[e._defaultViewMode].viewId,r=e.app.viewManager.getViewById(t);return{currentFeature:r&&r.isActive?e.app.project.convert.fromGcxFeature(e._currentFeature):null,viewMode:e._defaultViewMode}})},t.prototype.applyState=function(e){var t=this;return this.app.project.convert.toGcxFeature(e.currentFeature)["catch"](function(e){return null}).then(function(r){var a=e.viewMode;t._viewModes[a]||(a=t._defaultViewMode),t._executeSetFeatureDetailsMode({viewMode:a,feature:r})})},t.prototype._processConfig=function(e){if(e){if(e.viewModes)for(var t in e.viewModes)e.viewModes.hasOwnProperty(t)&&(e.viewModes[t].viewId&&e.viewModes[t].defaultProviderTargetRegion?(e.defaultViewMode||(e.defaultViewMode=t.toLowerCase()),this._viewModes[t.toLowerCase()]=e.viewModes[t]):this.app.trace.warning("FeatureDetailsModule: Error loading view mode - viewId or defaultProviderTargetRegion not specified. Please check your configuration"));if(this._defaultViewMode=e.defaultViewMode,!this._defaultViewMode)return void this.app.trace.error("FeatureDetailsModule: Could not compute default view mode. Please check your configuration settings");e.providers&&(this._providerConfig=e.providers)}},t.prototype.registerCommands=function(){var e=this;this.app.command("ShowFirstFeatureFromCollection").register(this,function(t){var r=null;if(!t&&e._currentFeature?e.app.command("ShowFeatureDetails").execute(e._currentFeature):"string"==typeof t?r=e.app.featureSetManager.getCollectionById(t):t instanceof i.FeatureSetCollection?r=t:e.app.trace.error("No FeatureSetCollection or ID given"),r){var a=r.firstFeature();a?e.app.command("ShowFeatureDetails").execute(a):e.app.trace.error("No feature in FeatureSetCollection")}else e.app.trace.error("No FeatureSetColection found.")}),this.app.command("ShowFeatureDetails").register(this,function(t){!t&&e._currentFeature&&(t=e._currentFeature),t?"string"==typeof t?e.app.command("ShowFirstFeatureFromCollection").execute(t):(e.app.command("_updateFeatureDetailViewModels").execute(t),e._processFeatureDetails(t)):e.app.trace.error("ShowFeatureDetails: Could not execute command. No feature found.")}),this.app.command("ShowFeatureDetailsFromMaptip").register(this,this._showFeatureDetailsFromMaptip,this._canExecuteshowFeatureDetailsFromMaptip),this.app.command("HideFeatureDetails").register(this,this._deactivateFeatureDetailsView),this.app.command("GetFeatureDetailsProviders").register(this,this._processFeatureDetails),this.app.command("ShowFeatureDetailsCompact").register(this,function(t){e._executeSetFeatureDetailsMode({viewMode:"compact",feature:t}),e.app.command("ShowFeatureDetailsExpanded").raiseCanExecuteChanged()},function(t){return e._canExecuteSetFeatureDetailsMode({viewMode:"compact",feature:t})}),this.app.command("ShowFeatureDetailsExpanded").register(this,function(t){e._executeSetFeatureDetailsMode({viewMode:"expanded",feature:t}),e.app.command("ShowFeatureDetailsCompact").raiseCanExecuteChanged()},function(t){return e._canExecuteSetFeatureDetailsMode({viewMode:"expanded",feature:t})}),this.app.command("SetFeatureDetailsMode").register(this,this._executeSetFeatureDetailsMode,this._canExecuteSetFeatureDetailsMode),this.app.command("GetRelatedFeatures").register(this,this._executeGetRelatedFeatures)},t.prototype._executeSetFeatureDetailsMode=function(e){this._defaultViewMode="string"==typeof e?e:e.viewMode;this._getViewModeConfigParams(this._defaultViewMode);"string"!=typeof e&&e.feature&&e.feature!==this._currentFeature&&(this.app.command("_updateFeatureDetailViewModels").execute(e.feature),this._processFeatureDetails(e.feature)),this._activateFeatureDetailsView(this._currentFeature)},t.prototype._canExecuteSetFeatureDetailsMode=function(e){var t="string"==typeof e?e:e.viewMode,r=this._getViewModeConfigParams(t);if(r)var a=this.app.viewManager.getViewById(r.viewId);var i=e.feature;return i&&i!==this._currentFeature?!!a&&!!r.defaultProviderTargetRegion:!(!a||a.isActive||!r.defaultProviderTargetRegion||!i&&!this._currentFeature)},t.prototype.updateFeature=function(e){e&&e!==this._currentFeature&&(this._currentFeature=e,this.providerViewModelList.forEach(function(t){return t.currentFeature.set(e)}),this.app.project.isLoading||this.app.event("FeatureDetailsCurrentFeatureChanged").publish(e))},t.prototype._processFeatureDetails=function(e){var t=this,r=function(){t._loadProviders(t._providerConfig),t.updateFeature(e),t._activateFeatureDetailsView(e),t.app.event("FeatureDetailsInvokedEvent").publish(e)};this.app.allLibrariesLoaded?r():this.app.event("ViewerLibrariesDownloadedEvent").once(this,r)},t.prototype._activateFeatureDetailsView=function(e){if(e){var t=null;if(!this.app.project.isLoading){for(var r in this._viewModes)if(this._viewModes.hasOwnProperty(r)){var a=this._viewModes[r].viewId;if(r===this._defaultViewMode)t=a;else{var i=this.app.viewManager.getViewById(a);i&&i.isActive&&this.app.command("DeactivateView").execute(a)}}t&&(this.app.command("ActivateView").execute(t),t=null)}this._setProviderTargetRegions(this._defaultViewMode)}},t.prototype._showFeatureDetailsFromMaptip=function(e){this.app.configuration.mobileMode||this.app.command("DeactivateView").execute("MapTipView"),this.app.command("ShowFeatureDetails").execute(e)},t.prototype._canExecuteshowFeatureDetailsFromMaptip=function(e){if(e&&e.esriFeature&&e.esriFeature.get()){var t=e.esriFeature.get();if(l.isClickableGraphic(this.app,t)){var r=l.getClickableLayerInfo(this.app,t);if(r&&r.canEdit(t))return!1}}return!0},t.prototype._deactivateFeatureDetailsView=function(){var e=this._getViewModeConfigParams(this._defaultViewMode);if(e&&e.viewId){var t=this.app.viewManager.getViewById(e.viewId);t&&t.isActive&&this.app.command("DeactivateView").execute(e.viewId)}},t.prototype._loadProviders=function(e){var t=this;if(!(this.providerViewModelList.length>0)){var r=function(e,r){r.forEach(function(e){t._wireUpViewBindings(e),t.providerViewList.push(e)}),t._setProviderTargetRegions(t._defaultViewMode)};e.forEach(function(e){if(e.enabled!==!1){var a=dojo.getObject(e.type);if(a){var i=new a(t.app,e.libraryId||t.libraryId),n=t._getProviderViewModeRegionConfig(e);i.app=t.app,i.libraryId=e.libraryId||t.libraryId,i.initialize(e.config),i.createAttachedViews(e,n,function(e){return r(i,e)}),t.providerViewModelList.push(i)}else t.app.trace.warning("Cannot find FeatureDetailsProvider '{0}'.".format(e.type))}})}},t.prototype._getProviderConfigByView=function(e){if(this._providerConfig)for(var t=0;t<this._providerConfig.length;t++){var r=this._providerConfig[t].markup;if(r&&"string"==typeof r){if(r===e.markupResource)return this._providerConfig[t]}else for(var a in r)if(r.hasOwnProperty(a)&&r[a]===e.markupResource)return this._providerConfig[t]}return null},t.prototype._getProviderTargetRegionForMode=function(e,t){var r=null;if(e.targetRegion&&e.targetRegion[t])r=e.targetRegion[t];else{var a=this._getViewModeConfigParams(t);a&&(r=a.defaultProviderTargetRegion)}return r},t.prototype._getViewModeConfigParams=function(e){for(var t in this._viewModes)if(this._viewModes.hasOwnProperty(t)&&t===e)return this._viewModes[e];return null},t.prototype._getProviderViewModeRegionConfig=function(e){var t={};if("string"==typeof e.markup)t["default"]=this._getProviderTargetRegionForMode(e,this._defaultViewMode);else for(var r in e.markup)e.markup.hasOwnProperty(r)&&(t[r]=this._getProviderTargetRegionForMode(e,r));return t},t.prototype._setProviderTargetRegions=function(e){var t=this;e&&(this.providerViewList.forEach(function(r){var a=t._getProviderConfigByView(r),i=t._getProviderTargetRegionForMode(a,e),n="string"==typeof a.markup||a.markup[e]&&a.markup[e]===r.markupResource||void 0===a.markup[e];if(t.app.viewManager.deactivateView(r),n){var s=null;if(i){var o=t.app.viewManager.getRegionForViewId(r.id);o&&(s=r.removed,r.removed=function(){},o.unhostView(r),r.regionName=i)}t.app.viewManager.activateView(r),s&&(r.removed=s),void 0!=r.viewModel.providerEnabled&&r.viewModel.providerEnabled.pulse()}}),this.app.event("Internal.FeatureProviderTargetRegionsChanged").publish(this._currentFeature))},t.prototype._wireUpViewBindings=function(e){var t=this,r=function(r){if(r){var a=t.app.viewManager.getExistingRegionByName(e.regionName);!a||a instanceof n.MultiViewRegionAdapter&&1!==a.views.length||t.app.viewManager.activateView(e)}else t.app.viewManager.deactivateView(e)};if(e.viewModel&&e.viewModel.providerEnabled&&e.viewModel.providerEnabled.isObservable){r(e.viewModel.providerEnabled.get());var a=e.viewModel.providerEnabled.bind(this,r),i=e.onDestroy;e.onDestroy=function(){e.viewModel.providerEnabled.unbind(a);for(var r=t.providerViewList.length-1;r>=0;r--)t.providerViewList[r]===e&&t.providerViewList.splice(r,1);"function"==typeof i&&i()}}},t.prototype._executeGetRelatedFeatures=function(e){this._getRelatedFeatures(e.mapService,e.relationshipId,e.objectId,e.currentFeature,e.successCallback,e.errorCallback)},t.prototype._getRelatedFeatures=function(e,t,r,i,n,l){var u=new dojo.Deferred;if(!e){var d=new Error("_getRelatedFeatures: mapService cannot be null.");return s.deferredReject(u,d),"function"==typeof l&&l(d),u}if(isNaN(t)){var d=new Error("_getRelatedFeatures: relationshipId cannot be null.");return s.deferredReject(u,d),"function"==typeof l&&l(d),u}if(!r){var d=new Error("_getRelatedFeatures: objectId cannot be null.");return s.deferredReject(u,d),"function"==typeof l&&l(d),u}var c=new esri.tasks.RelationshipQuery;c.outFields=["*"],c.relationshipId=t,c.objectIds=[r];var p=null;if(i&&(i instanceof a.Feature?p=i.layer?i.layer:i.featureLayer:i instanceof esri.Graphic&&(p=i.getLayer())),p||(p=e.serviceLayer),p){var h=o.getQueryTask(p,e),g=h.executeRelationshipQuery(c);g.then(function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r))for(var a=0;a<e[r].features.length;a++)t.push(e[r].features[a]);s.deferredResolve(u,t),"function"==typeof n&&n(t)},function(e){s.deferredReject(u,e)})}else s.deferredResolve(u,[]);return u},t}(r.ModuleBase);t.FeatureDetailsModule=u})},"Mapping/modules/FeatureDetails/FeatureDetailsModuleConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/FeatureDetails/FeatureDetailsState":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/FeatureDetails/FeatureDetailsSwitcherView":function(){define(["require","exports","geocortex/framework-ui/ViewSwitcher/ViewSwitcherView"],function(e,t,r){"use strict";var a=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.viewModel=null,a.scrollingTabContainerElement=null,a.tabContainerElement=null,a.tabElements=null,a.scrollTabLeftElement=null,a.scrollTabRightElement=null,a.delayedExecuteToken=null,a.appResizedSubToken=null,a}return __extends(t,e),t.prototype.handleClickTab=function(t,r,a){e.prototype.handleClickTab.call(this,t,r,a),this._refreshTabControlVisibility()},t.prototype.activated=function(){e.prototype.activated.call(this),this.appResizedSubToken=this.app.event("ApplicationResizedEvent").subscribe(this,this.handleResize)},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.app.event("ApplicationResizedEvent").unsubscribe(this.appResizedSubToken),this.appResizedSubToken=null},t.prototype.handleResize=function(){var e=this;this.isActive&&(this.delayedExecuteToken&&(clearTimeout(this.delayedExecuteToken),this.delayedExecuteToken=null),this.delayedExecuteToken=setTimeout(function(){e._refreshTabControlVisibility()},200)),this._refreshTabControlVisibility()},t.prototype._updateScrollTabDisabledStatus=function(){if(this.tabContainerElement){var e=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth;this.viewModel.leftScrollTabDisabled.set(0===this.tabContainerElement.scrollLeft),this.viewModel.rightScrollTabDisabled.set(this.tabContainerElement.scrollLeft>e-1)}},t.prototype.handleTabScrollBack=function(e,t,r){var a=$(this.tabContainerElement),i=a.scrollLeft()-2*this.scrollTabLeftElement.offsetWidth;a.scrollLeft(i<0?0:i),this._updateScrollTabDisabledStatus()},t.prototype.handleTabScrollForward=function(e,t,r){var a=$(this.tabContainerElement),i=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth,n=a.scrollLeft()+2*this.scrollTabRightElement.offsetWidth;a.scrollLeft(n>i?i:n),this._updateScrollTabDisabledStatus()},t.prototype._refreshTabControlVisibility=function(){var e=this;setTimeout(function(){e.scrollingTabContainerElement&&e.tabElements&&(e.viewModel.tabControlsEnabled.set(e.tabElements.offsetWidth>e.scrollingTabContainerElement.offsetWidth),e._updateScrollTabDisabledStatus())},100)},t}(r.ViewSwitcherView);t.FeatureDetailsSwitcherView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsSwitcherViewDescriptor":function(){define(["require","exports","geocortex/framework-ui/ViewSwitcher/ViewSwitcherViewDescriptor","geocortex/framework/observables"],function(e,t,r,a){"use strict";var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.providerEnabled=new a.Observable((!1)),t}return __extends(t,e),t}(r.ViewSwitcherViewDescriptor);t.FeatureDetailsSwitcherViewDescriptor=i})},"Mapping/modules/FeatureDetails/FeatureDetailsSwitcherViewModel":function(){define(["require","exports","geocortex/framework-ui/ViewSwitcher/ViewSwitcherViewModel","geocortex/framework/observables","./FeatureDetailsSwitcherViewDescriptor"],function(e,t,r,a,i){"use strict";var n=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.tabControlsEnabled=new a.Observable((!1)),n.leftScrollTabDisabled=new a.Observable((!1)),n.rightScrollTabDisabled=new a.Observable((!1)),n._defaultLayerTabView=null,n._layerTabViews={},n._currFeatureProviderBindings=[],n.app.event("Internal.FeatureProviderTargetRegionsChanged").subscribe(n,n._handleFeatureChanged),n.app.command("_updateFeatureDetailViewModels").register(n,n._handleFeatureChanged),n}return __extends(t,e),t.prototype.initialize=function(t){if(e.prototype.initialize.call(this,t),t&&t.hasOwnProperty("defaultTabViewForLayer")){var r=t.defaultTabViewForLayer;for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];if(dojo.isArray(i))for(var n=0;n<i.length;n++)this._addProperty(a,i[n]);else this._addProperty(a,i)}}},t.prototype.createDescriptorForView=function(e){var t=new i.FeatureDetailsSwitcherViewDescriptor(e,this);return this._processViewDescriptor(t),t},t.prototype.checkIfSwitcherActive=function(){var e=dojo.filter(this.viewDescriptors.get(),function(e){return e.providerEnabled.get()});return e.length>1},t.prototype._addProperty=function(e,t){return this._layerTabViews[e]||(this._layerTabViews[e]=[]),e&&"default"===t?void(this._defaultLayerTabView=e):void(null!=t.mapServiceId&&null!=t.layerId?this._layerTabViews[e].push(t):this.app.trace.warning("Invalid configuration for default layer tab view. Syntax is - {PreferredViewId} : { {mapServiceId}, {layerId} }"))},t.prototype._getPreferredViewDescriptor=function(e,t){if(!e||!t)return null;for(var r in this._layerTabViews)if(this._layerTabViews.hasOwnProperty(r))for(var a=this._layerTabViews[r],i=0;i<a.length;i++)if(e===a[i].mapServiceId&&t===a[i].layerId){var n=this._getDescriptorForFirstEligibleTabView(r);if(n)return n}},t.prototype._processViewDescriptor=function(e){var t=this,r=function(r){e.providerEnabled.bind(t,t.updateViewSwitcherState),e.providerEnabled.sync(r.providerEnabled)};e.view.viewModel?r(e.view.viewModel):dojo.aspect.after(e.view,"attach",dojo.hitch(this,r),!0)},t.prototype._handleFeatureChanged=function(e){if(0!==this.viewDescriptors.length()&&(this._cancelBindingsIfApplicable(),e&&e.layer)){var t=e.layer.mapService?e.layer.mapService.id:null;this._activateDefaultTabViewForLayer(t,e.layer.id)}},t.prototype._activateDefaultTabViewForLayer=function(e,t){var r=this,a=null,i=!1,n=null,s=function(){for(var e=0;e<r.viewDescriptors.length();e++)if(r.viewDescriptors.getAt(e).providerEnabled.get()&&r.viewDescriptors.getAt(e).view)return r.viewDescriptors.getAt(e);return null},o=function(e){var t=e.providerEnabled,a=e.providerEnabled.bind(r,function(t){if(t){var a=n&&e.view.id===n.view.id;i&&!a||(r.app.viewManager.activateView(e.view),a&&r._cancelBindingsIfApplicable()&&(n=null),i=!0)}});r._currFeatureProviderBindings.push({currentFeatureProviderEnabledRef:t,currentFeatureProviderBindingToken:a})};a=this._getPreferredViewDescriptor(e,t),!a&&this._defaultLayerTabView&&(a=this._getDescriptorForFirstEligibleTabView(this._defaultLayerTabView)),a&&!a.providerEnabled.get()&&(n=a,a=null),!a&&(a=s()),a?(this.app.viewManager.activateView(a.view),i=!0,n&&o(n)):this.viewDescriptors.get().forEach(function(e){return o(e)})},t.prototype._cancelBindingsIfApplicable=function(){this._currFeatureProviderBindings.length&&(this._currFeatureProviderBindings.forEach(function(e){e.currentFeatureProviderEnabledRef.unbind(e.currentFeatureProviderBindingToken)}),this._currFeatureProviderBindings=[])},t.prototype._getDescriptorForFirstEligibleTabView=function(e){var t=null;if(t=this.getDescriptorForView(this.app.viewManager.getViewById(e)),!t){var r=this.app.viewManager.getViews(),a=r.filter(function(t){return t.id.startsWith(e)});if(a.length)for(var i=0;i<a.length&&!(t=this.getDescriptorForView(a[i]));i++);}return t},t}(r.ViewSwitcherViewModel);t.FeatureDetailsSwitcherViewModel=n})},"Mapping/modules/FeatureDetails/FeatureDetailsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";var a=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a._multiRegionCssBindingToken="",a.app.event("FeatureDetailsCurrentFeatureChanged").subscribe(a,a._handleFeatureChanged),a.app.event("ViewContainerViewClosedEvent").subscribe(a,function(e){e.viewId===a.id&&a.viewModel&&a.viewModel.currentFeature.get()&&a.viewModel.setFeatureDetailsDisplayFeatureTag(a.viewModel.currentFeature.get(),!1)}),a}return __extends(t,e),t.prototype.attach=function(t){e.prototype.attach.call(this,t),this.title.syncTransform(t.headerText,function(e){return String.unescapeHtml(e)}),t.viewsToActivate.indexOf(this.id)===-1&&t.viewsToActivate.push(this.id)},t.prototype.resolveWidget=function(t,r,a){switch(e.prototype.resolveWidget.call(this,t,r,a),t){case"FeatureDetailsRegionWidget":var i=this.app.viewManager.createView({markupResource:"Framework.UI/geocortex/framework/ui/MultiRegion/MultiRegionView.html",libraryId:"Framework.UI",typeName:"geocortex.framework.ui.MultiRegion.MultiRegionView",isVisible:!1});return i&&i.attach(r),this._processView(i),i;case"FeatureActionsWidget":return this.app.menuRegistry.createMenuWidget(this,r,a);default:return}},t.prototype.activated=function(){e.prototype.activated.call(this),this.app.behavior("FeatureDetailsOpenedBehavior").run(this.viewModel.currentFeature.get())},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.app.behavior("FeatureDetailsClosedBehavior").run(this.viewModel.currentFeature.get()),this.isActive=!1},t.prototype._handleFeatureChanged=function(e){var t=this,r=this.app.command("ShowMap").postExecute.once(this,function(){setTimeout(function(){t.app.command("FocusOnFirstInputInView").execute(t)},0),r=null});this.app.event("ViewActivated").once(this,function(){r&&(t.app.command("ShowMap").postExecute.unsubscribe(r),setTimeout(function(){t.app.command("FocusOnFirstInputInView").execute(t)},0))})},t.prototype._processView=function(e){var t=this,r=e.multiRegionViewElement,a="",i=function(){r.className=a+" "+t.viewModel.featureMultiRegionCss.get().trim()};this._multiRegionCssBindingToken&&(this.viewModel.featureMultiRegionCss.unbind(this._multiRegionCssBindingToken),this._multiRegionCssBindingToken=""),r&&(a=r.className.trim(),i(),this._multiRegionCssBindingToken=this.viewModel.featureMultiRegionCss.bind(this,i))},t}(r.ViewBase);t.FeatureDetailsView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsViewModel":function(){define(["require","exports","geocortex/framework-ui/MultiRegion/MultiRegionViewModel","geocortex/framework/observables","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","./FeatureDetailsSwitcherViewModel","geocortex/infrastructure/MapUtils"],function(e,t,r,a,i,n,s,o){"use strict";var l=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.headerText=new a.Observable(""),i.currentFeature=new a.Observable(null),i.currentEsriFeatureClone=null,i.currentFeatureSet=null,i.viewsToActivate=[],i.featureMultiRegionCss=new a.Observable(""),i._featureTag="isShownInFeaturedetails",i._lastTaggedCurrentFeature=null,i.currentFeature.bind(i,function(){return i._handleCurrentFeatureChanged()}),i.regionViewSwitcherWidgetMarkup="Mapping/modules/FeatureDetails/FeatureDetailsSwitcherView.html",i.regionViewSwitcherWidgetType="geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsSwitcherView",i.regionViewSwitcherLibraryId=i.libraryId,i._registerCommands(),i._subscribeEvents(),i.currentFeature.bind(i,function(e){e?(i._lastTaggedCurrentFeature&&i.setFeatureDetailsDisplayFeatureTag(i._lastTaggedCurrentFeature,!1),i.setFeatureDetailsDisplayFeatureTag(e,!0),i._lastTaggedCurrentFeature=e):i._lastTaggedCurrentFeature&&i.setFeatureDetailsDisplayFeatureTag(e,!1)}),i}return __extends(t,e),t.prototype.initialize=function(t){t&&(this._config=t,this._config.autoInsertViewSwitcher=!0),e.prototype.initialize.call(this,t)},t.prototype.createViewSwitcherViewModel=function(e){var t=new s.FeatureDetailsSwitcherViewModel(this.app,this.libraryId,e);return t.initialize(this._config),t},t.prototype.processRegion=function(t){var r=this;e.prototype.processRegion.call(this,t),t.regionActive.bind(this,function(e){return r._updateMultiRegionViewCss(t,e)})},t.prototype._updateMultiRegionViewCss=function(e,t){var r="";this.regionDescriptors.get().forEach(function(e){return r=r.concat(" {0}-{1}".format(e.regionName,e.regionActive.get()?"active":"inactive"))}),this.featureMultiRegionCss.set(r.trim())},t.prototype._registerCommands=function(){var e=this;this.app.command("_updateFeatureDetailViewModels").register(this,function(t){t&&t instanceof i.Feature&&(e._setCurrentFeature(t),e.currentFeatureSet=e.currentFeature.get()?e.currentFeature.get().featureSet:null)})},t.prototype._subscribeEvents=function(){this.app.event("FeatureEditedEvent").subscribe(this,this._handleEditedFeature),this.app.event("FeatureDeletedEvent").subscribe(this,this._handleDeletedFeature),this.app.event("FSMCollectionRemovedEvent").subscribe(this,this._onFeatureSetCollectionRemoved)},t.prototype._handleDeletedFeature=function(e){var t=e.originalFeature||e instanceof esri.Graphic?e:null;t&&this.currentEsriFeatureClone&&o.esriFeaturesEqual(this.currentEsriFeatureClone,t)&&(this.currentEsriFeatureClone=null,this._deactivateViews())},t.prototype._handleEditedFeature=function(e){return e.originalFeature&&e.editedFeature?void(this.currentEsriFeatureClone&&o.esriFeaturesEqual(e.originalFeature,this.currentEsriFeatureClone)&&(this.currentFeature.get().esriFeature.set(e.editedFeature),this._processCurrentFeature(),this.currentEsriFeatureClone=e.editedFeature)):void this.app.trace.warning("FeatureDetailsViewModel: Could not handle FeatureEditedEvent. Original or Edited feature not provided.")},t.prototype._onFeatureSetCollectionRemoved=function(e){var t=e.featureSetCollection;if(t){var r=this.currentFeature.get();if(r&&r.featureSet){var a=t.getFeatureSetById(r.featureSet.id);a&&a.uniqueId==r.featureSet.uniqueId&&(this._deactivateViews(),this.currentFeature.set(null))}}},t.prototype._setCurrentFeature=function(e){if(this.currentFeature.get()&&this.app.command("ClearFeatureFocus").execute(this.currentFeature.get()),"string"==typeof e){var t=this.app.featureSetManager.getCollectionById(e);if(t){var r=t.firstFeature();r?this.currentFeature.set(r):this.app.trace.error("No feature in feature set collection")}else this.app.trace.error("No feature set collection found matching id: "+e)}else if(e&&e instanceof i.Feature){var a=e;if(null==a.featureSet){var s=new n.FeatureSet({app:this.app});s.addFeature(a),a.featureSet=s}this.currentFeature.set(a)}this._processCurrentFeature()},t.prototype._handleCurrentFeatureChanged=function(){var e=this.currentFeature.get();e?this.currentEsriFeatureClone=o.cloneEsriFeature(e._graphic):this.currentEsriFeatureClone=null},t.prototype._processCurrentFeature=function(){var e=this.currentFeature.get();this.headerText.removeSync(),e&&this.headerText.sync(e.plainLabel)},t.prototype._deactivateViews=function(){for(var e=0;e<this.viewsToActivate.length;e++){var t=this.viewsToActivate[e];this.app.command("DeactivateView").execute(t)}},t.prototype.setFeatureDetailsDisplayFeatureTag=function(e,t){e&&dojo.isFunction(e.setExtendedProperty)&&e.setExtendedProperty(this._featureTag,!!t)},t}(r.MultiRegionViewModel);t.FeatureDetailsViewModel=l})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttachmentsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attachment_click=function(e,t,r){var a=this;return this.app.isOffline.get()?(this.app.command("RewriteUrlForOffline").execute(r.url.get(),function(e){return e?a.app.command("OpenWebPage").execute({url:e,element:t}):void a.app.command("Alert").execute(a.getResource("language-feature-details-attachment-not-available-offline"))}),!1):this.app.followNavigationLink({url:r.url.get(),element:t})},t.prototype.handleDeleteClick=function(e,t,r){var a=this,i=this.app.getResource(this.libraryId,"language-feature-attachments-delete-prompt-title"),n=this.app.getResource(this.libraryId,"language-feature-attachments-delete-prompt-text");this.app.command("Confirm").execute(n,i,function(e){if(e){var t={layer:a.viewModel.currentFeature.get().layer.mapService.serviceLayer,feature:a.viewModel.currentFeature.get().esriFeature.get(),attachmentIds:[r.attachmentId],callback:function(e){if(e[0]&&e[0].error){var t=a.getResource("language-feature-attachments-delete-prompt-title"),r=e[0].error.message||a.getResource("language-feature-attachments-delete-prompt-error-unknown");a.app.command("Alert").execute(r,t)}else a.viewModel.currentFeature.get().resetAttachmentInfos(),a.viewModel.handleCurrentFeatureChanged(a.viewModel.currentFeature.get())},errback:function(e){var t=a.getResource("language-feature-attachments-delete-prompt-title");a.app.command("Alert").execute(e.message||e,t)}};a.app.command("DeleteAttachments").execute(t)}})},t}(r.ViewBase);t.AttachmentsView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttachmentsViewModel":function(){define(["require","exports","geocortex/infrastructure/featureDetails/FeatureProviderBase","geocortex/framework/observables","geocortex/essentials/FeatureLayerService"],function(e,t,r,a,i){"use strict";var n=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.hasAttachments=new a.Observable((!1)),i.attachmentInfos=new a.ObservableCollection,i.isAttachmentInfosInitialized=new a.Observable((!1)),i.noAttachments=new a.Observable((!1)),i.isOffline=new a.Observable((!1)),i.canEditAttachments=new a.Observable((!1)),i.bindToken=null,i.app.event("FeatureAttachmentAddedEvent").subscribe(i,i.handleCurrentFeatureChanged),i}return __extends(t,e),t.prototype.handleCurrentFeatureChanged=function(e){var t=this;if(this.updateProviderState(!0),this.hasAttachments.set(!1),this.noAttachments.set(!1),this.isOffline.set(!1),this.isAttachmentInfosInitialized.set(!1),this.canEditAttachments.set(!1),this._setAttachmentInfos(null),!e)throw new Error("Feature cannot be null for the attachment infos view model");if(this.hasAttachments.set(e.hasAttachments.get()),this.hasAttachments.get()){var r=e.layer&&e.layer.mapService;r&&r instanceof i.FeatureLayerService&&this.canEditAttachments.set(r.canAddAttachments&&r.canEdit),e.attachmentInfosInitialized.get()?(this._setAttachmentInfos(e.attachmentInfos),0==this.attachmentInfos.length()&&(this.isOffline.set(this.app.isOffline.get()),this.noAttachments.set(!this.app.isOffline.get())),this.isAttachmentInfosInitialized.set(!0)):this.bindToken=e.attachmentInfosInitialized.bind(this,function(r){r&&(t.isAttachmentInfosInitialized.set(!0),t._setAttachmentInfos(e.attachmentInfos),0==t.attachmentInfos.length()&&(t.isOffline.set(t.app.isOffline.get()),t.noAttachments.set(!t.app.isOffline.get())),e.attachmentInfosInitialized.unbind(t.bindToken))}),e.attachmentInfos.get()}},t.prototype._setAttachmentInfos=function(e){if(this.attachmentInfos.clear(),e)for(var t=e.getLength(),r=0;r<t;r++){var a=e.getAt(r),i=this.app,n=i.nativeManager.isNative()?null:"_blank";this.attachmentInfos.addItem({name:a.name,url:a.url,canEditAttachments:this.canEditAttachments.get(),size:this.formatSize(a.size.get()),attachmentId:a.id.get(),target:n})}},t.prototype.formatSize=function(e){for(var t=0;e>1e3;t++)e=Math.round(e/1e3);return e+" "+["B","KB","MB","GB","TB","PB"][t]},t}(r.FeatureProviderBase);t.AttachmentsViewModel=n})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttributesView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleClickAttributeLink=function(e,t,r){return this.app.followNavigationLink({url:r.value.get(),element:t})},t}(r.ViewBase);t.AttributesView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttributesViewModel":function(){define(["require","exports","geocortex/infrastructure/featureDetails/FeatureProviderBase","geocortex/framework/observables","geocortex/essentials/Field","geocortex/framework/utils/utils"],function(e,t,r,a,i,n){"use strict";var s=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.attributeTypes={},i.MAX_COLUMNS=3,i.COLUMN_THRESHOLD=5,i._attributesChangedSubscriptionToken=null,i.attributes=new a.ObservableCollection([]),i.multiColumnAttributeContainer=new a.ObservableCollection([]),i}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(this.MAX_COLUMNS=isNaN(parseInt(t.maxColumns,10))?this.MAX_COLUMNS:parseInt(t.maxColumns,10),this.COLUMN_THRESHOLD=isNaN(parseInt(t.columnThreshold,10))?this.COLUMN_THRESHOLD:parseInt(t.columnThreshold,10))},t.prototype.handleCurrentFeatureChanged=function(e){if(e){this._getAttributeTypes(this.currentFeature.get());var t=e.getAttributes();this._attributesChangedSubscriptionToken&&this._prevFeatureLinkedAttributes&&this._prevFeatureLinkedAttributes.unbind(this._attributesChangedSubscriptionToken),
this._attributesChangedSubscriptionToken=this._prevFeatureLinkedAttributes=null,this._prevFeatureLinkedAttributes=e.linkedAttributes,this._attributesChangedSubscriptionToken=e.linkedAttributes.bind(this,this._handleAttributesChanged),this.processAttributes(t),this._setAttributes(t)}else this._setAttributes(null)},t.prototype._getAttributeTypes=function(e){if(this.attributeTypes={},e.layer&&e.layer.fields)for(var t=0;t<e.layer.fields.length;t++){var r=e.layer.fields[t];if(e.layer instanceof esri.layers.FeatureLayer){var a=r;r.dataType=i.Field.convertFromEsriType(a.type)}this.attributeTypes[r.name]=r.dataType}},t.prototype._handleAttributesChanged=function(){var e=this.currentFeature.get().getAttributes();this.processAttributes(e),this._setAttributes(e)},t.prototype._setAttributes=function(e){this.attributes.clear(),e&&this.attributes.set(e),this._populateMultiColumnAttributeContainer(),this.updateProviderState(!!this.attributes.length())},t.prototype._populateMultiColumnAttributeContainer=function(){this.multiColumnAttributeContainer.clear();var e=dojo.filter(this.attributes.get(),function(e){return e.visible.get()}),t=e.length>this.COLUMN_THRESHOLD?Math.ceil(e.length/this.COLUMN_THRESHOLD):1;t=t>this.MAX_COLUMNS?this.MAX_COLUMNS:t;for(var r=Math.ceil(e.length/t),i=0;i<t;i++){var n=new a.ObservableCollection(e.slice(i*r,(i+1)*r));this.multiColumnAttributeContainer.addItem(n)}},t.prototype.processAttributes=function(e){for(var t=0;t<e.length;t++){var r=(e[t].name.get(),e[t].value.get());e[t].displayAsUrl=n.isUrl(r)}},t}(r.FeatureProviderBase);t.AttributesViewModel=s})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinksView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/Table/TableViewModel","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel"],function(e,t,r,a,i){"use strict";var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){this.masterViewModel=t.masterViewModel,e.prototype.attach.call(this,t)},t.prototype.handleViewClick=function(e,t,r){for(var a=0;a<this.viewModel.dataLinks.length();a++){var i=this.viewModel.dataLinks.getAt(a);if(i===r){this.masterViewModel.currentDataLink.set(i);break}}this.masterViewModel.activateDataLinkDetailsView()},t.prototype.resolveWidget=function(t,r,n){switch(e.prototype.resolveWidget.call(this,t,r),t){case"DataLinksTableViewWidget":var s=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableView",markupResource:"Mapping/infrastructure/ui/components/Table/TableView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(s){var o=new a.TableViewModel(this.app,this.libraryId);o.addRecordClickEvents(this.masterViewModel.DATALINK_TABLE_ITEM_CLICKED_EVENT),o.addRecordLongPressEvents(this.masterViewModel.DATALINK_TABLE_ITEM_PRESSED_EVENT),o.columnHeaders=r.columnHeaders,o.attachToPresentableCollection(r.presentableResults),s.attach(o)}return s;case"PagingControlsWidget":var l=new i.PagingControlsViewModel(this.app,r),u=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});return u&&l&&u.attach(l),u;default:return null}},t}(r.ViewBase);t.DataLinksView=n})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinksViewModel":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModel","geocortex/infrastructure/featureDetails/FeatureProviderBase","geocortex/framework/utils/utils","geocortex/framework-ui/LazyObservable","geocortex/infrastructure/FormatUtils"],function(e,t,r,a,i,n,s,o,l){"use strict";var u=function(e){function t(t,a){var i=e.call(this,t,a)||this;return i.hasDataLinks=new r.Observable((!1)),i.dataLinksList=new r.ObservableCollection([]),i.currentDataLink=new r.Observable(null),i.targetDataLinkDetailsRegion=null,i.DEFAULT_VIEW_ID="FeatureDataLinksProviderView",i.DEFAULT_PAGED=!0,i.DEFAULT_PAGE_SIZE=50,i.DATALINK_TABLE_ITEM_CLICKED_EVENT="DataLinkTableItemClickedEvent",i.DATALINK_TABLE_ITEM_PRESSED_EVENT="DataLinkTableItemPressedEvent",i._featureDataLinkBindingToken=null,i._datalinkViews=[],i._addedDataLinks=[],i._dataLinkListBindingTokens=[],i._config=null,i._viewModeRegionConfig=null,i._onViewsCreated=null,i}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(t.dataLinkView||t.dataLinkDetailsView)&&(this.targetDataLinkDetailsRegion=t.dataLinkView||t.dataLinkDetailsView),this.hasDataLinks.bind(this,this.updateProviderState)},t.prototype.handleCurrentFeatureChanged=function(e){this.hasDataLinks.set(!1),this._destroyAttachedViews(),this.dataLinksList.clear(),this._featureDataLinkBindingToken&&this._prevFeatureDataLinkingResults&&this._prevFeatureDataLinkingResults.unbind(this._featureDataLinkBindingToken),this._prevFeatureDataLinkingResults=this._featureDataLinkBindingToken=null,this._prevFeatureDataLinkingResults=e.dataLinkingResults,this._featureDataLinkBindingToken=e.dataLinkingResults.bind(this,this.handleCollectionChanged),this._handleDataLinks(e.dataLinkingResults.get()),this._createAttachedViews()},t.prototype.activateDataLinkDetailsView=function(){if(this.targetDataLinkDetailsRegion){if(!this.currentDataLink.get())throw new Error("Cannot display data link details. Current datalink not set.");this.dataLinkView||(this.dataLinkView=this.app.viewManager.createView({markupResource:"Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinkView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.DataLinkView",iconUri:"Resources/Images/Icons/Toolbar/file-multi-24.png",regionName:this.targetDataLinkDetailsRegion,isVisible:!1,libraryId:this.libraryId}),this.dataLinkView.attach(this)),this.dataLinkView.title.set(this.currentDataLink.get().displayName),this.app.viewManager.activateView(this.dataLinkView),this.app.command("FocusOnFirstInputInView").execute(this.dataLinkView)}},t.prototype.createAttachedViews=function(e,t,r){this._config=e,this._viewModeRegionConfig=t,this._onViewsCreated=r},t.prototype._createAttachedViews=function(t,r,a){var i=this;if(t=t||this._config,r=r||this._viewModeRegionConfig,a=a||this._onViewsCreated,t){var n=function(){i.dataLinksList.get().forEach(function(n){if(i._addedDataLinks.indexOf(n.displayName)===-1){var s=dojo.clone(t);s.title=n.displayName,s.viewId=i._generateDataLinksViewIdFromConfigViewId(s.viewId,s.title),e.prototype.createAttachedViews.call(i,s,r,function(e){i._datalinkViews=i._datalinkViews.concat(e),a&&a(e)},n),i._addedDataLinks.push(n.displayName)}})};n(),this._dataLinkListBindingTokens.push(this.dataLinksList.bind(this,function(){return n()}))}},t.prototype.handleCollectionChanged=function(e){if("append"===e.type){var t=e.sender.value.slice(e.rangeStart,e.rangeStart+1);this._handleDataLinks(t)}},t.prototype._generateDataLinksViewIdFromConfigViewId=function(e,t){var r=s.alphaNumericToken();return t=t?t+"-"+r:r,"{0} datalink-{1}".format(e||this.DEFAULT_VIEW_ID,t)},t.prototype._createConfiguredPresentableResultCollection=function(e){var t=new a.PresentableCollection(e);return t.pageSize.set(this.DEFAULT_PAGE_SIZE),this.DEFAULT_PAGED!=t.isPaginated.get()&&t.isPaginated.set(this.DEFAULT_PAGED),t.items.useThrottling=!0,t.sortingPredicate=null,t},t.prototype._destroyAttachedViews=function(){var e=this;this._datalinkViews.forEach(function(t){e.app.viewManager.destroyView(t),delete t.viewModel}),this._dataLinkListBindingTokens.forEach(function(t){return e.dataLinksList.unbind(t)}),this._datalinkViews=[],this._addedDataLinks=[],this._dataLinkListBindingTokens=[]},t.prototype._handleDataLinks=function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.dataLink&&a.dataLink.get()&&!a.dataLink.get().isOneToOne){var i=new r.ObservableCollection(this._buildLinkRecords(a)),n=new r.ObservableCollection(this._buildTableRows(a)),s=this._createConfiguredPresentableResultCollection(n),o=this._createColumnHeaderCollection(s),l=new r.Observable(this.providerEnabled.get());l.sync(this.providerEnabled),this.dataLinksList.addItem({displayName:a.dataLink.get().displayName,dataLinks:i,presentableResults:s,columnHeaders:o,providerEnabled:l,masterViewModel:this}),this.hasDataLinks.get()||this.hasDataLinks.set(!0)}}},t.prototype._buildTableRows=function(e){for(var t=[],a=e.table.get(),i=0;i<a.rows.length;i++){var n=this._buildTableColumns(a.columns,a.rows[i].row);t.push({attributes:new r.ObservableCollection(n)})}return t},t.prototype._buildTableColumns=function(e,t){for(var a=[],i=0;i<e.length;i++)a.push({visible:new r.Observable((!0)),value:new r.Observable(t[i]),presentableValue:function(e){return new o.LazyObservable(null,function(){return l.format(t[e])})}(i),displayAsUrl:s.isUrl(t[i]),columnHeader:e[i]});return a},t.prototype._createColumnHeaderCollection=function(e){var t=new r.ObservableCollection([]),a=new i.SharedState(e,"sort","sort-up","sort-down"),n=e.items.get();if(n.length)for(var s=n[0].attributes.get(),o=0;o<s.length;o++){var l="string";s[o].value.get()instanceof Date&&(l="DateTime"),s[o].visible&&!s[o].visible.get()||t.addItem(new i.TableColumnHeaderViewModel(this.app,this.libraryId,a,s[o].columnHeader,l,o))}return t},t.prototype._buildLinkRecords=function(e){for(var t=e.table.get(),a=[],i=0;i<t.rows.length;i++){var n=t.rows[i].row;a.push({displayName:n[0],attributes:new r.ObservableCollection(this.toDict(t.columns,n))})}return a},t.prototype.toDict=function(e,t){for(var r=[],a=0;a<e.length;a++)r.push({name:e[a],value:t[a],presentableValue:l.format(t[a]),displayAsUrl:s.isUrl(t[a])});return r},t}(n.FeatureProviderBase);t.DataLinksViewModel=u})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinkView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleClickDataLink=function(e,t,r){return this.app.followNavigationLink({url:r.value.get(),element:t})},t}(r.ViewBase);t.DataLinkView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/DescriptionView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FeatureDescriptionPresenterView"],function(e,t,r,a){"use strict";var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._featureChangedToken=null,t._featureEditedToken=null,t._relatedRecordEditedToken=null,t._presenterView=null,t}return __extends(t,e),t.prototype.attach=function(t){e.prototype.attach.call(this,t),this._featureChangedToken&&(this.app.event("FeatureChangedEvent").unsubscribe(this._featureChangedToken),this._featureChangedToken=null),this._featureEditedToken&&(this.app.event("FeatureEditedEvent").unsubscribe(this._featureEditedToken),this._featureEditedToken=null),this._featureChangedToken=this.app.event("FeatureChangedEvent").subscribe(this,this._handleFeatureChangedEvent),this._featureEditedToken=this.app.event("FeatureEditedEvent").subscribe(this,this._updateDescription),this._relatedRecordEditedToken=this.app.event("RelatedRecordEditedEvent").subscribe(this,this._handleRelatedRecordsEdited)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._featureChangedToken&&(this.app.event("FeatureChangedEvent").unsubscribe(this._featureChangedToken),this._featureChangedToken=null),this._featureEditedToken&&(this.app.event("FeatureEditedEvent").unsubscribe(this._featureEditedToken),this._featureEditedToken=null),this._relatedRecordEditedToken&&(this.app.event("RelatedRecordEditedEvent").unsubscribe(this._relatedRecordEditedToken),this._relatedRecordEditedToken=null),this._presenterView&&(this._presenterView.destroy(),this._presenterView=null)},t.prototype.resolveWidget=function(t,r,i){if(r&&"GetDescription"===t){var n=new a.FeatureDescriptionPresenterView(this.app,this.libraryId);return n.contentField=this.viewModel.showLongDescription?"longDescription":"description",n.root=dojo.create("div"),n.root.className="feature-description",n.attach(r),this._presenterView=n,n}return e.prototype.resolveWidget.call(this,t,r,i)},t.prototype._handleFeatureChangedEvent=function(e){this._presenterView&&e&&this.viewModel.currentFeature.get()&&this.viewModel.currentFeature.get().token===e.token&&this._updateDescription()},t.prototype._handleRelatedRecordsEdited=function(e){var t=this.viewModel.currentFeature.get(),r=t&&t.esriFeature.get(),a=r&&r.getLayer();t&&a&&r.attributes[a.objectIdField]===e.attributes[a.objectIdField]&&(dojo.mixin(r.attributes,e.attributes),t.esriFeature.pulse())},t.prototype._updateDescription=function(){this._presenterView.destroyBindings(),this._presenterView.attach(this.viewModel.currentFeature.get())},t}(r.ViewBase);t.DescriptionView=i})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/DescriptionViewModel":function(){define(["require","exports","geocortex/infrastructure/featureDetails/FeatureProviderBase"],function(e,t,r){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.showLongDescription=!1,t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&t.longDescription&&(this.showLongDescription=!0)},t.prototype.handleCurrentFeatureChanged=function(e){if(e.longDescription||e.description){var t=this.showLongDescription?e.longDescription.get():e.description.get();this.updateProviderState(!!t)}else this.app.trace.warning("Input must be a Feature")},t}(r.FeatureProviderBase);t.DescriptionViewModel=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/FeatureActionsView":function(){define(["require","exports","geocortex/infrastructure/menus/MenuView"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){var r=this;e.prototype.attach.call(this,t),this.viewModel.menuContext.sync(t.currentFeature),this.viewModel.visibleMenuItems.bind(this,function(e){var a=r.viewModel.visibleMenuItems.length();if("clear"===e.type)a=0;else if("remove"===e.type){var i=e.sender.get().slice(0);i.splice(e.rangeStart,e.rangeEnd-e.rangeStart+1),a=i.length}t.updateProviderState(!!a)})},t}(r.MenuView);t.FeatureActionsView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/FeatureActionsViewModel":function(){define(["require","exports","geocortex/infrastructure/featureDetails/FeatureProviderBase"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(r.FeatureProviderBase);t.FeatureActionsViewModel=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/Hyperlink":function(){define(["require","exports"],function(e,t){"use strict";var r=function(){function e(e,t){if(this.text=null,this.uri=null,this.iconUri=null,this.target=null,this.toolTip=null,this.isBroken=!1,t&&(this.currentFeature=t,e)){if(e.text)this.text=this.currentFeature.formatTemplateString(e.text),this.text=String.unescapeHtml(this.text);else{if(!e.uri)return;this.text=this.currentFeature.formatTemplateString(e.uri),this.text=String.unescapeHtml(this.text)}e.uri&&(this.uri=this.currentFeature.formatTemplateString(e.uri),this.uri=String.unescapeHtml(this.uri)),e.iconUri&&(this.iconUri=e.iconUri),e.target&&(this.target=e.target),e.toolTip&&(this.toolTip=this.currentFeature.formatTemplateString(e.toolTip),this.toolTip=String.unescapeHtml(this.toolTip))}}return e}();t.Hyperlink=r})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/HyperlinksView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleClickHyperlink=function(e,t,r){return!r.isBroken&&this.app.followNavigationLink({url:r.uri,element:t})},t}(r.ViewBase);t.HyperlinksView=a})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/HyperlinksViewModel":function(){define(["require","exports","geocortex/infrastructure/featureDetails/FeatureProviderBase","geocortex/framework/observables","geocortex/config"],function(e,t,r,a,i){"use strict";var n=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._numHyperlinksChecked=0,i._numHyperlinksTotal=0,i.hyperlinks=new a.ObservableCollection,i}return __extends(t,e),t.prototype.handleCurrentFeatureChanged=function(e){if(this.hyperlinks.set(null),e&&e.hyperlinks){var t=dojo.getObject("geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.Hyperlink");if(t){var r=[];this._numHyperlinksChecked=0,this._numHyperlinksTotal=e.hyperlinks.getLength(),0!==e.hyperlinks.getLength()&&this.updateProviderState(!0);for(var a=0;a<this._numHyperlinksTotal;a++){var i=new t(e.hyperlinks.getAt(a),e);r.push(i),e.layer&&"ShowAll"!==e.layer.showFeatureHyperlinks&&this._testHyperlink(i,r,"HEAD")}e.layer&&"ShowAll"===e.layer.showFeatureHyperlinks&&this._showHyperlinks(r)}else this.hyperlinks.addItems(e.hyperlinks.get())}},t.prototype._testHyperlink=function(e,t,r){var a=this,n=function(){a._numHyperlinksChecked++,a._numHyperlinksChecked===a._numHyperlinksTotal&&a._showHyperlinks(t)};if(!e.uri)return e.isBroken=!0,void n();if(e.uri&&e.uri.length>i.config.io.postLength-500)return this.app.trace.warning("Unable to test hyperlink with URI '{0}...'. The URI was too long.".format(e.uri.substr(0,100))),void n();var s={type:r,cache:!0,url:e.uri};"GET"===r&&(s.headers={"If-Match":"LatitudeGeographics"}),s.success=function(e,t,r){n()},s.error=function(i,s,o){var l=i.status;return"HEAD"!==r||405!==l&&0!==l?(e.isBroken=l>=400&&412!==l,void n()):void a._testHyperlink(e,t,"GET")},$.ajax(s)},t.prototype._showHyperlinks=function(e){for(var t=this.currentFeature.get(),r=t&&t.layer?t.layer.showFeatureHyperlinks:null,a=0;a<e.length;a++){var i=e[a];if(null!=i.uri&&""!==i.uri){if(r&&"HideBrokenLinks"===r&&i.isBroken)continue;this.hyperlinks.addItem(i)}}0===this.hyperlinks.getLength()&&this.updateProviderState(!1)},t}(r.FeatureProviderBase);t.HyperlinksViewModel=n})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/Table/TableViewModel","geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel","geocortex/framework/utils/utils"],function(e,t,r,a,i,n){"use strict";var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){this.masterViewModel=t.masterViewModel,e.prototype.attach.call(this,t),this.masterViewModel._viewContainerViewClosedEventBindingToken||(this.masterViewModel._viewContainerViewClosedEventBindingToken=this.app.event("ViewContainerViewClosedEvent").subscribe(this,this._checkIfEventIsRelevant))},t.prototype.destroy=function(){this.masterViewModel._viewContainerViewClosedEventBindingToken&&0===this.masterViewModel.relatedFeatureViews.length&&(this.app.event("ViewContainerViewClosedEvent").unsubscribe(this.masterViewModel._viewContainerViewClosedEventBindingToken),this.masterViewModel._viewContainerViewClosedEventBindingToken=null)},t.prototype.resolveWidget=function(t,r,n){switch(e.prototype.resolveWidget.call(this,t,r),t){case"RelatedFeaturesTableViewWidget":var s=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableView",markupResource:"Mapping/infrastructure/ui/components/Table/TableView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});if(s){var o=new a.TableViewModel(this.app,this.libraryId);o.addRecordClickEvents(this.masterViewModel.REL_FEATURES_TABLE_ITEM_CLICKED_EVENT),o.addRecordLongPressEvents(this.masterViewModel.REL_FEATURES_TABLE_ITEM_PRESSED_EVENT),o.columnHeaders=r.columnHeaders,o.attachToPresentableCollection(r.presentableResults),s.attach(o)}return s;case"PagingControlsWidget":var l=new i.PagingControlsViewModel(this.app,r),u=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.PagingControls.PagingControlsView",markupResource:"Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html",libraryId:"Mapping.Infrastructure",isVisible:!0});return u&&l&&u.attach(l),u;default:return null}},t.prototype.handleViewClick=function(e,t,r){if(r&&r.attributes&&r.attributes.getLength()>0)for(var a=r.attributes.get(),i=0;i<a.length;i++){var s=a[i].value.get();a[i].displayAsUrl=n.isUrl(s)}this.isBusy.set(!0),this.masterViewModel.activateRelatedFeatureView(r)},t.prototype.handleClickAddRelatedRecord=function(e,t,r){var a=this;if(!r)return!1;if(r.editable&&!r.editable.get())return!1;var i=this.masterViewModel;i&&i.generateRelatedLayerObject(r,function(e){a.app.command("StartEditingNewRelatedRecord").execute(e,!0)})},t.prototype._checkIfEventIsRelevant=function(e){(e.backButtonClicked||e.xButtonClicked)&&this.masterViewModel.showParentView()},t}(r.ViewBase);t.RelatedFeaturesView=s})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesViewModel":function(){define(["require","exports","./RelatedFeaturesViewModelBase","geocortex/framework/observables","geocortex/essentials/Layer","geocortex/infrastructure/TaskUtils","geocortex/essentials/utilities/LayerUtilities","geocortex/infrastructure/FeatureSet"],function(e,t,r,a,i,n,s,o){"use strict";var l=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a._canEditOffline=!1,a.app.event("RelatedRecordCreatedEvent").subscribe(a,a._relatedRecordCreated),a.app.event("RelatedRecordEditedEvent").subscribe(a,a._relatedRecordEdited),a}return __extends(t,e),t.prototype.initialize=function(t){var r=this;e.prototype.initialize.call(this,t),this.app.nativeManager.hasNativeCapability("editing").then(function(e){r._canEditOffline=e})},t.prototype.handleCurrentFeatureChanged=function(e){var t=this;if(!e)throw new Error("Feature cannot be null for the related features view model");this._destroyAttachedViews(),this.hasRelationships.set(!1),this.relationList.clear(),this._allRelatedFeatureInfo=[],this.relatedLayers=new a.ObservableCollection([]),this._relatedLayerPromises&&(this._relatedLayerPromises.cancel(),this._relatedLayerPromises=null);var r=[],n=this.currentFeature.get().layer||this.currentFeature.get().featureLayer;if(n&&n.relationships){for(var s=0;s<n.relationships.length;s++){var o=n.relationships[s];n instanceof i.Layer&&r.push(new Promise(function(e,t){return n.getRelatedFeatureLayer(o.id,e,t)}))}this._relatedLayerPromises=Promise.all(r),this._relatedLayerPromises.then(function(r){if(t._relatedLayerPromises=null,t.relatedLayers.addItems(r),e.hasVisibleRelationships.get()&&n&&n.relationships&&t.app.site.getFeatureServices()){t.hasRelationships.set(!0);for(var i=0;i<n.relationships.length;i++)if(n.relationships[i].visible){var s=function(){var e=new a.Observable(t.providerEnabled.get()),r=new a.ObservableCollection([]);e.sync(t.providerEnabled);var s={displayName:new a.Observable(n.relationships[i].displayName||n.relationships[i].name),id:new a.Observable(n.relationships[i].id),relatedTableId:new a.Observable(n.relationships[i].relatedTableId),visible:new a.Observable(n.relationships[i].visible),relatedEsriFeatureInfo:new a.ObservableCollection([]),relatedGcxFeatures:r,hasRetrievedData:new a.Observable((!1)),noRelatedFeatures:new a.Observable((!1)),canAdd:new a.Observable((!0)),validCardinality:new a.Observable((!0)),errorFetchingRelatedFeatures:new a.Observable((!1)),presentableResults:t._createConfiguredPresentableResultCollection(r),columnHeaders:new a.ObservableCollection([]),providerEnabled:e,masterViewModel:t};s.relatedEsriFeatureInfo.bind(t,function(e){t._generateGCXFeaturesFromRelatedFeatureInfos(e.sender.getRange(e.rangeStart,e.rangeEnd))}),t.relationList.addItem(s)};s()}t._fetchRelatedFeatures()}t._createAttachedViews(),t._updateProviderState(),null==t.parentFeature.get()&&t.parentFeature.set(t.currentFeature.get())})}},t.prototype._generateGCXFeaturesFromRelatedFeatureInfos=function(e){for(var t=0;t<e.length;t++){var r=e[t];this._generateRelatedGCXFeature(r)}},t.prototype._generateRelatedGCXFeature=function(e){var t={featureInfo:e,esriFeature:null,gcxFeature:null,layer:null},r={};e.attributes.get().forEach(function(e){var t=e.name.get(),a=e.value.get();r[t]=a});var a=new esri.Graphic;a.setAttributes(r);var i=this.currentFeature.get().layer||this.currentFeature.get().featureLayer,n=null;i.relationships.forEach(function(t){var r=t.name?t.name:t.displayName;r==e.relationName.get()&&(n=t.relatedTableId)});for(var s=null,o=0;o<this.relatedLayers.getLength();o++){var l=this.relatedLayers.getAt(o);l.layerId===n&&(s=l)}if(s)null!=n&&(s.add(a),t.layer=s,t.esriFeature=a,this._checkRelatedFeature(t));else{for(var u=new RegExp("/[^/]*.$"),d=e.featureUrl.replace(u,""),c=this.app.site.getFeatureServices(),o=0;o<c.length;o++){var p=c[o],h=this._getProperMapServiceUrlForComparison(p,d);d==h&&(s=p.serviceLayer)}t.layer=s,t.esriFeature=a,this._checkRelatedFeature(t)}},t.prototype.generateRelatedLayerObject=function(e,t){var r=this,a=null,i=null;try{this._getFeatureLayerForCurrentFeature(e,function(n){var s=n.relationships;s.forEach(function(t){t.id==e.id.get()&&t.relatedTableId==e.relatedTableId.get()&&(i=t)}),a={id:e.id.get(),text:"New "+e.displayName.get(),relatedFeature:r.currentFeature.get().esriFeature.get(),essentialsRelatedFeature:r.currentFeature.get(),feature:null,editable:!0,relationship:i},t(a)})}catch(n){this.app.trace.error("Error in generating related layer object for creation: "+n)}},t.prototype._getFeatureLayerForCurrentFeature=function(e,t){var r=this.currentFeature.get().esriFeature.get().getLayer();if(r)return void t(r);if(!r&&"Table"!=this.currentFeature.get().layer.type)return this.app.command("GetFeatureDetailsProviders").execute(this.currentFeature.get()),r=this.currentFeature.get().esriFeature.get().getLayer(),r||(r=this.currentFeature.get().layer.mapService.layers[0]),void t(r);if(!r)for(var a=this.app.site.getFeatureServices(),i=0;i<a.length;i++)for(var n=a[i],s=0;s<n.layers.length;s++){var o=n.layers[s];o.id==e.relatedTableId.get()&&n.getRelatedFeatureLayer(e.id.get(),function(e){r=e,t(r)},function(e){})}},t.prototype._relatedRecordCreated=function(e){this.handleCurrentFeatureChanged(this.currentFeature.get())},t.prototype._relatedRecordEdited=function(e){e.attributes.Date&&(e.attributes.Date=this._formatDate(e.attributes.Date));var t=this.currentFeature.get().esriFeature.get().attributes;for(var r in t)e.attributes[r]&&(t[r]=e.attributes[r]);this.currentFeature.get().loadAttributes(!0)},t.prototype._fetchRelatedFeatures=function(){var e=this,t=this.currentFeature.get(),r=this.currentFeature.get().layer||this.currentFeature.get().featureLayer;if(t&&r&&this.relationList&&this.relationList.length()>0){var a=t.layer?t.layer:t.featureLayer;if(a){var i;for(i=0;i<this.relationList.length();i++){var s=function(r){var i=r.id.get(),s=new esri.tasks.RelationshipQuery;s.outFields=["*"],s.relationshipId=r.id.get(),null!=t.getPrimaryKeyValue()?s.objectIds=[t.getPrimaryKeyValue()]:s.objectIds=[t.esriFeature.get().attributes.OBJECTID];var o=n.getQueryTask(a),l=o.executeRelationshipQuery(s);l.then(function(t){var n=!1;for(var s in t)if(t.hasOwnProperty(s)){n=!0;break}if(!n)return e._setCanAddNewFeature(a,r),r.noRelatedFeatures.set(!0),void r.hasRetrievedData.set(!0);var o=null,l=null;if(a.getRelatedFeatureLayer)o=a.getRelatedFeatureLayer(i);else for(var u=e.app.site.getFeatureServices(),d=a.url.match(/.*\//g),c=0;c<u.length;c++){var p=u[c],h=p.serviceLayer;if(p.serviceUrl.match(/.*\//g)[0]===d[0]){for(var g=0;g<h.relationships.length;g++){var f=h.relationships[g];if(f.relatedTableId==r.relatedTableId.get()){o=p.getRelatedFeatureLayer(f.id,null,null);break}}if(h.layerId==r.relatedTableId.get()){l=p.serviceLayer;break}if(o)break}}if(!o){for(var v in t)if(t.hasOwnProperty(v)){e._resolveDatalinksAfterFeaturesResolved(r,t[v].features.length);for(var c=0;c<t[v].features.length;c++){var m=t[v].features[c],b=e._processRelatedFeature(l,m,r);r.relatedEsriFeatureInfo.addItem(b),l.hasAttachments&&setTimeout(function(e,t){return function(){t._loadAttachments(e)}}(b,e),100)}}return e._setCanAddNewFeature(a,r),void r.hasRetrievedData.set(!0)}o.then(function(i){if(i.message)return e._setCanAddNewFeature(a,r),r.noRelatedFeatures.set(!0),void r.hasRetrievedData.set(!0);for(var n in t)if(t.hasOwnProperty(n)){e._resolveDatalinksAfterFeaturesResolved(r,t[n].features.length);for(var s=0;s<t[n].features.length;s++){var o=t[n].features[s],l=e._processRelatedFeature(i,o,r);r.relatedEsriFeatureInfo.addItem(l),i.hasAttachments&&setTimeout(function(e,t){return function(){t._loadAttachments(e)}}(l,e),100)}}e._setCanAddNewFeature(a,r),r.hasRetrievedData.set(!0)},function(t){r.errorFetchingRelatedFeatures.set(!0),r.hasRetrievedData.set(!0),e.app.trace.error("Error getting related record for layer {0}: {1}.".format(a.displayName,t.message))})},function(t){r.errorFetchingRelatedFeatures.set(!0),r.hasRetrievedData.set(!0),e.app.trace.error("Error getting related record for layer {0}: {1}.".format(a.displayName,t.message))})};s(this.relationList.getAt(i))}}}},t.prototype._setCanAddNewFeature=function(e,t){var r=null,a=null;if(t.canAdd.set(!0),t.validCardinality.set(!0),e instanceof i.Layer){r=e;r.mapService;r.mapService.serviceLayer instanceof esri.layers.FeatureLayer&&(a=r.mapService.serviceLayer)}else e instanceof esri.layers.FeatureLayer&&(a=e);if(!a)return this.app.trace.debug("Attempted to see if related feature could be created but layer is not a Essentials Layer or Esri FeatureLayer."),t.canAdd.set(!1),void t.validCardinality.set(!1);if(a){var n=a.relationships,o=null;if(n&&n.length)for(var l=0;l<n.length;l++){var u=n[l];u.id===t.id.get()&&(o=u)}if(o){("esriRelCardinalityOneToOne"===o.cardinality||"esriRelCardinalityOneToMany"===o.cardinality&&"esriRelRoleDestination"===o.role)&&t.relatedEsriFeatureInfo.get().length>0&&t.validCardinality.set(!1);for(var d=this.app.site.essentialsMap.mapServices,l=0;l<d.length;l++){var c=d[l].serviceLayer;if(c instanceof esri.layers.FeatureLayer){var p=c;p.layerId===t.relatedTableId.get()&&p.getEditCapabilities().canCreate===!1&&t.canAdd.set(!1)}}var h=s.LayerUtilities.decomposeFeatureLayerUrl(a.url).serviceUrl+"/"+t.relatedTableId.get();if(this.app.offlineManager.isOfflineMapActive.get()){var g=this.app.offlineManager.syncInfo.findLayerOrTable(h);this._canEditOffline&&g&&g.canEdit||t.canAdd.set(!1)}}}},t.prototype._resolveDatalinksAfterFeaturesResolved=function(e,t){if(e&&!(t<1)){var r=function(){var t=e.relatedGcxFeatures.getAt(0).layer;if(t){var r=new o.FeatureSet;r.features.set(e.relatedGcxFeatures.get()),r.layer=t,r.esriFeatureSet=new esri.tasks.FeatureSet,r.esriFeatureSet.features=e.relatedGcxFeatures.get().map(function(e){return e.esriFeature.get()}),r.resolveDataLinks()}};if(e.relatedGcxFeatures.length()===t)r();else var a=e.relatedGcxFeatures.bind(this,function(){e.relatedGcxFeatures.length()===t&&(e.relatedGcxFeatures.unbind(a),a=null,r())})}},t}(r.RelatedFeaturesViewModelBase);t.RelatedFeaturesViewModel=l})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesViewModelBase":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/Feature","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModel","geocortex/infrastructure/featureDetails/FeatureProviderBase","geocortex/framework/utils/utils","geocortex/infrastructure/TimeZoneUtils","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/gis/FieldInfo","geocortex/infrastructure/AttachmentInfo","geocortex/essentials/LayerType","geocortex/infrastructure/MapUtils","geocortex/infrastructure/TaskUtils","geocortex/essentials/RestHelperHTTPService"],function(e,t,r,a,i,n,s,o,l,u,d,c,p,h,g,f,v){
"use strict";var m=function(e){function t(t,a){var i=e.call(this,t,a)||this;return i.DEFAULT_VIEW_ID="FeatureRelationsProviderView",i.DEFAULT_PAGED=!0,i.DEFAULT_PAGE_SIZE=50,i.REL_FEATURES_TABLE_ITEM_CLICKED_EVENT="RelatedFeatureTableItemClickedEvent",i.REL_FEATURES_TABLE_ITEM_PRESSED_EVENT="RelatedFeatureTableItemPressedEvent",i.hasRelationships=new r.Observable((!1)),i.relationList=new r.ObservableCollection([]),i.parentFeature=new r.Observable(null),i.relatedLayers=new r.ObservableCollection([]),i.relatedFeatures=new r.ObservableCollection,i.relatedFeatureViews=[],i._viewContainerViewClosedEventBindingToken=null,i._config=null,i._viewModeRegionConfig=null,i._onViewsCreated=null,i._allRelatedFeatureInfo=[],i._addedRelatedFeatures=[],i._relatedFeatureListBindingTokens=[],i._relatedLayerPromises=null,i.app.command("ShowFeatureParentDetails").register(i,i.showParentView),i.app.command("ClearFeatureInformation").register(i,i._cleanup),i.app.event(i.REL_FEATURES_TABLE_ITEM_CLICKED_EVENT).subscribe(i,i.activateRelatedFeatureView),i}return __extends(t,e),t.prototype.createAttachedViews=function(e,t,r,a){this._config=e,this._viewModeRegionConfig=t,this._onViewsCreated=r},t.prototype.createAttachedViewsSuper=function(t,r,a,i){e.prototype.createAttachedViews.call(this,t,r,a,i)},t.prototype.activateRelatedFeatureView=function(e){var t;if(t=e instanceof a.Feature?this._getFeatureInfoFromFeature(e):e)for(var r=0;r<this._allRelatedFeatureInfo.length;r++){var i=this._allRelatedFeatureInfo[r].featureInfo;if(t.id.get()===i.id.get()){if(t.layer&&i.layer&&t.layer!==i.layer&&t.layer.layerId!==i.layer.layerId)continue;this._displayGeocortexFeatureDetails(this._allRelatedFeatureInfo[r].gcxFeature);break}}},t.prototype.showParentView=function(){return this.relatedFeatures.getLength()<1?void(this.parentFeature.get()&&this.parentFeature.set(null)):(this.relatedFeatures.removeItem(this.currentFeature.get()),0==this.relatedFeatures.getLength()?void this.app.command("ShowFeatureDetails").execute(this.parentFeature.get()):void this.app.command("ShowFeatureDetails").execute(this.relatedFeatures.getAt(this.relatedFeatures.length()-1)))},t.prototype._generateRelatedFeaturesViewIdFromConfigViewId=function(e,t){var r=o.alphaNumericToken();return t=t?t+"-"+r:r,"{0} relatedfeatures-{1}".format(e||this.DEFAULT_VIEW_ID,t)},t.prototype._createConfiguredPresentableResultCollection=function(e){var t=new i.PresentableCollection(e);return t.pageSize.set(this.DEFAULT_PAGE_SIZE),this.DEFAULT_PAGED!=t.isPaginated.get()&&t.isPaginated.set(this.DEFAULT_PAGED),t.items.useThrottling=!0,t.sortingPredicate=null,t},t.prototype._createColumnHeaderItems=function(e){var t=[],r=new n.SharedState(e,"sort","sort-up","sort-down"),a=e.items.get();if(a.length)for(var i=a[0].attributes.get(),s=0;s<i.length;s++)i[s].visible&&!i[s].visible.get()||t.push(new n.TableColumnHeaderViewModel(this.app,this.libraryId,r,i[s].displayName.get(),i[s].type.get(),s));return t},t.prototype._getFeatureInfoFromFeature=function(e){for(var t=0;t<this._allRelatedFeatureInfo.length;t++)if(this._allRelatedFeatureInfo[t].gcxFeature===e)return this._allRelatedFeatureInfo[t].featureInfo;return null},t.prototype._getFeatureFromFeatureInfo=function(e){for(var t=0;t<this._allRelatedFeatureInfo.length;t++)if(this._allRelatedFeatureInfo[t].featureInfo===e)return this._allRelatedFeatureInfo[t].gcxFeature;return null},t.prototype._displayGeocortexFeatureDetails=function(e){this._addFeatureToBucket(e),this.app.command("ShowFeatureDetails").execute(e)},t.prototype._addFeatureToBucket=function(e){e!=this.relatedFeatures.getAt(this.relatedFeatures.getLength())&&this.relatedFeatures.addItem(e)},t.prototype._destroyAttachedViews=function(){for(var e=this,t=this.relatedFeatureViews.length-1;t>=0;t--){var r=this.relatedFeatureViews[t];this.relatedFeatureViews.splice(t,1),this.app.viewManager.destroyView(r),delete r.viewModel}this._relatedFeatureListBindingTokens.forEach(function(t){return e.relationList.unbind(t)}),this._addedRelatedFeatures=[],this._relatedFeatureListBindingTokens=[]},t.prototype._getRelationshipObjectFromFeatureInfo=function(e){for(var t=null,r=0;r<this.relationList.length();r++){t=this.relationList.getAt(r);for(var a=0;a<t.relatedEsriFeatureInfo.length();a++)if(e===t.relatedEsriFeatureInfo.getAt(a))return t}return t},t.prototype._processGeneratedGCXFeature=function(e){this._allRelatedFeatureInfo.push(e);var t=this._getRelationshipObjectFromFeatureInfo(e.featureInfo);t&&(t.relatedGcxFeatures.addItem(e.gcxFeature),t.columnHeaders.length()||t.columnHeaders.addItems(this._createColumnHeaderItems(t.presentableResults)))},t.prototype._generateGeocortexFeature=function(e,t,r){var i=l.getTimeZoneFromLayer(t),n=null;this.parentFeature.get()&&this.parentFeature.get().layer&&(n=l.getDisplayTimeZoneFromMapService(this.parentFeature.get().layer.mapService),i||(i=l.getTimeZoneFromMapService(this.parentFeature.get().layer.mapService)));var s=new a.Feature({graphic:e,layer:t,featureLayer:r,timeZoneId:i,displayTimeZoneId:n});if(s.loadAttributes(!0),t)s.defaultNumberFormat=u.firstOrDefault([t.defaultNumberFormat,t.mapService.defaultNumberFormat],function(e){return!!e}),s.defaultDateFormat=u.firstOrDefault([t.defaultDateFormat,t.mapService.defaultDateFormat],function(e){return!!e});else if(this.parentFeature.get()){var o=this.parentFeature.get().layer;o&&(s.defaultNumberFormat=o.mapService.defaultNumberFormat,s.defaultDateFormat=o.mapService.defaultDateFormat)}if(r&&"Table"===r.type&&r.relationships.length>0&&this.app.site.getFeatureServices().length>0){s.hasVisibleRelationships.set(!0);for(var d=0;d<r.relationships.length;d++){var c=r.relationships[d];c.visible||(c.visible=!0)}}return s},t.prototype._makeAttributesObservable=function(e,t){var a=new r.ObservableCollection,i=this._getAttributeTypes(t);if(e)for(var n in e)if(e.hasOwnProperty(n)){var s=e[n];i[n]&&"esriFieldTypeDate"===i[n]&&s&&(s=this._formatDate(s)),a.addItem({name:new r.Observable(n),value:new r.Observable(s)})}return a},t.prototype._getAttributeTypes=function(e){var t={};return e&&e.fields&&dojo.forEach(e.fields,function(e){t[e.name]=e.type}),t},t.prototype._formatDate=function(e){return d.formatDate(d.parseDate(e))},t.prototype._cleanup=function(){this.parentFeature.set(null),this.relatedFeatures.clear()},t.prototype._processRelatedFeature=function(e,t,a){var i=new r.ObservableCollection,n=t.attributes[e.displayField];if(e.getField&&n){var s=c.FieldInfo.fromEsriField(e.getField(e.displayField),e);if(s.isCodedValueDomain()||s.hasSubtypeCodedValueDomains()){var o=t.attributes[e.typeIdField];n=s.resolveCodedDomainValue(n,o)}else"esriFieldTypeDate"===s.type&&(n=this._formatDate(n))}n||(n=t.attributes[e.objectIdField]);var l=e.objectIdField,u={id:new r.Observable(t.attributes[l]),displayName:new r.Observable(n),relationName:new r.Observable(a.displayName.get()),layer:e,featureUrl:e.url+"/"+t.attributes[e.objectIdField],attributes:this._makeAttributesObservable(t.attributes,e),geometry:new r.Observable(t.geometry),hasAttachments:new r.Observable((!1)),attachmentInfos:i};return u},t.prototype._loadAttachments=function(e){var t=this,r=e.featureUrl+"/attachments",a=null,i={url:r+"?f=json&ts="+(new Date).getTime(),handleAs:"json"};if(e.layer instanceof esri.layers.FeatureLayer&&e.layer.url){var n=e.layer;a=n.queryAttachmentInfos(parseInt(e.id.get()))}else var a=esri.request(i);a.then(function(t){if(t.length>0&&!t.attachmentInfos&&t instanceof Array){t.attachmentInfos=[];for(var a=0;a<t.length;a++)t.attachmentInfos[a]=t[a]}if(t&&t.attachmentInfos&&t.attachmentInfos.length>0){var i;for(i=0;i<t.attachmentInfos.length;i++){var n=t.attachmentInfos[i],s=new p.AttachmentInfo;s.id.set(n.id),s.contentType.set(n.contentType),s.size.set(n.size),s.name.set(n.name),s.url.set(r+"/"+n.id),e.attachmentInfos.addItem(s)}e.hasAttachments.set(!0)}},function(r){t.app.trace.error("Unable to retrieve attachment information for related feature '"+e.featureUrl+"': "+r.message)})},t.prototype._updateProviderState=function(){var e=this,t=!1;this.updateProviderState(t);var r=function(r){(r.canAdd.get()||!r.errorFetchingRelatedFeatures.get()&&r.relatedEsriFeatureInfo.length())&&(t=!0),e.updateProviderState(t)};if(this.relationList.length())for(var a=0;a<this.relationList.length();a++){var i=function(){if(!t){var i=e.relationList.getAt(a);i.hasRetrievedData.get()?r(i):i.hasRetrievedData.once(e,function(){return r(i)})}};i()}},t.prototype._createAttachedViews=function(t,r,a){var i=this;if(t=t||this._config,a=a||this._onViewsCreated,r=r||this._viewModeRegionConfig,t){var n=function(){i.relationList.get().forEach(function(n){if(i._addedRelatedFeatures.indexOf(n.displayName.get())===-1){var s=dojo.clone(t);s.title=n.displayName.get(),s.viewId=i._generateRelatedFeaturesViewIdFromConfigViewId(s.viewId,n.displayName.get()),e.prototype.createAttachedViews.call(i,s,r,function(e){i.relatedFeatureViews=i.relatedFeatureViews.concat(e),a&&a(e)},n),i._addedRelatedFeatures.push(n.displayName.get())}})};n(),this._relatedFeatureListBindingTokens.push(this.relationList.bind(this,function(){return n()}))}},t.prototype._checkRelatedFeature=function(e){var t=this;if(e){var r=e.layer,i=e.esriFeature,n=null;if(r&&(n=this._findGeocortexLayer(r,this.app.site),!n&&"Table"!==r.type))return this.app.trace.debug("Could not find related layer in site. Related features will not be editable/viewable."),e.gcxFeature=new a.Feature({graphic:i,featureLayer:r}),void this._processGeneratedGCXFeature(e);if(!i.geometry&&n&&n.mapService&&n.mapService.serviceLayer&&n.type!==h.LayerType.TABLE_LAYER){var s=null,o=n.mapService.serviceLayer;if(o instanceof esri.layers.FeatureLayer&&(s=g.findFeatureInMap(i,this.app.site,o)),s)e.gcxFeature=this._generateGeocortexFeature(s,n,o),this._processGeneratedGCXFeature(e);else{var l=new esri.tasks.Query;if(l.objectIds=[i.attributes[n.getObjectIdFieldName()]],l.outFields=["*"],l.returnGeometry=!0,o instanceof esri.layers.FeatureLayer)o.queryFeatures(l,function(r){r.features&&(i=r.features[0],e.gcxFeature=t._generateGeocortexFeature(i,n,o),t._processGeneratedGCXFeature(e))},function(e){t.app.trace.error("There was an error in retrieving the related feature: "+e)});else{var u=(n.mapService.serviceUrl.split("?"),f.getQueryTask(n));n.getFeatureLayer().then(function(r){u.execute(l,function(a){a.features&&(i=a.features[0],e.gcxFeature=t._generateGeocortexFeature(i,n,r),t._processGeneratedGCXFeature(e))},function(e){t.app.trace.error("There was an error in retrieving the related feature: "+e)})})["catch"](function(e){t.app.trace.error("There was an error in returning the feature layer: "+e)})}}}else e.gcxFeature=this._generateGeocortexFeature(i,n,r),this._processGeneratedGCXFeature(e)}},t.prototype._findGeocortexLayer=function(e,t){if(e&&t&&t.essentialsMap)return t.essentialsMap.findLayerFromMatchingEsriFeatureLayer(e)},t.prototype._getProperMapServiceUrlForComparison=function(e,t){var r=e.serviceUrl;return e.serviceToken&&t.search(/token=.[^&]*/g)>0&&(r=v.RestHelperHTTPService.appendTokenToUrl(r,e.serviceToken)),r},t}(s.FeatureProviderBase);t.RelatedFeaturesViewModelBase=m})},"Mapping/modules/FeatureDetails/FeatureDetailsProviders/SearchTablesRelatedFeaturesViewModel":function(){define(["require","exports","./RelatedFeaturesViewModelBase","geocortex/essentials/Layer","geocortex/infrastructure/Feature","geocortex/infrastructure/FilterUtils","geocortex/framework/observables","geocortex/infrastructure/gis/FieldInfo","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/FeatureSet"],function(e,t,r,a,i,n,s,o,l,u){"use strict";var d=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.SEARCHTABLE_KEY="parentSearchTable",a.SEARCH_TABLE_ID_KEY="SearchTableId",a.datalinkSearches=[],a.currentSearchTable=null,t.site&&t.site.isInitialized?a._siteInitialized():t.event("SiteInitializedEvent").once(a,a._siteInitialized),a}return __extends(t,e),t.prototype.activateRelatedFeatureView=function(t){t instanceof i.Feature||(t=this._getFeatureFromFeatureInfo(t));var r=this.parentFeature.get();r&&t&&t instanceof i.Feature&&r.getExtendedPropertyByName(this.SEARCH_TABLE_ID_KEY)==t.getExtendedPropertyByName(this.SEARCH_TABLE_ID_KEY)?this.showParentView():e.prototype.activateRelatedFeatureView.call(this,t)},t.prototype.handleCurrentFeatureChanged=function(e){var t=this;if(!e)throw new Error("Feature cannot be null for the related features view model");this._destroyAttachedViews(),this.hasRelationships.set(!1),this.relationList.clear(),this._allRelatedFeatureInfo=[],this.datalinkSearches=[],this.currentSearchTable=null,this._featureLayers={},this._allLayers=[],this._relatedLayerPromises&&(this._relatedLayerPromises.cancel(),this._relatedLayerPromises=null);var r=e.getExtendedPropertyByName(this.SEARCHTABLE_KEY);if(r){var i=r.getExtendedPropertyByName(this.SEARCH_TABLE_ID_KEY),o=this._getSearchTable(i);if(o){var l={allowFrames:!1,uriTransformer:function(e){return e}},u=new s.Observable(this.providerEnabled.get()),d=new s.ObservableCollection([]),c=r.esriFeature.get(),p={id:new s.Observable("Parent_SearchTable"),displayName:new s.Observable(n.sanitize(r.label.get(),l)),relationName:new s.Observable(null),layer:null,featureUrl:"",attributes:r.attributes,geometry:new s.Observable(c.geometry),hasAttachments:new s.Observable((!1)),attachmentInfos:new s.ObservableCollection([])};u.sync(this.providerEnabled);var h={displayName:new s.Observable(o.displayName),id:new s.Observable(0),relatedTableId:new s.Observable(null),visible:new s.Observable((!0)),relatedEsriFeatureInfo:new s.ObservableCollection([p]),relatedGcxFeatures:d,hasRetrievedData:new s.Observable((!0)),noRelatedFeatures:new s.Observable((!1)),canAdd:new s.Observable((!1)),validCardinality:new s.Observable((!1)),errorFetchingRelatedFeatures:new s.Observable((!1)),presentableResults:this._createConfiguredPresentableResultCollection(d),columnHeaders:new s.ObservableCollection([]),providerEnabled:u,masterViewModel:this};this.relationList.addItem(h);var g={featureInfo:p,esriFeature:c,gcxFeature:r,layer:null};this._checkRelatedFeature(g),g.gcxFeature.setExtendedProperty(this.SEARCH_TABLE_ID_KEY,i),this._createAttachedViews(),this.updateProviderState(!0)}}else{var i=e.getExtendedPropertyByName(this.SEARCH_TABLE_ID_KEY);if(this.currentSearchTable=this._getSearchTable(i),!this.currentSearchTable||!this._searchTablesRelationships.hasOwnProperty(this.currentSearchTable.id))return;this.datalinkSearches=this._searchTablesRelationships[this.currentSearchTable.id];for(var f=[],v=0,m=this.datalinkSearches.length;v<m;v++){var b=function(){var e=t.datalinkSearches[v],r=e&&e.dataLink?e.dataLink.layer:null;if(t._allLayers.push(r),r&&r instanceof a.Layer){var i=r.getFeatureLayer();i.then(function(e){t._featureLayers[r.url]=e}),f.push(i)}};b()}this._relatedLayerPromises=Promise.all(f),this._relatedLayerPromises.then(function(){if(t._relatedLayerPromises=null,t.datalinkSearches.length>0){t.hasRelationships.set(!0);for(var r=0,a=t.datalinkSearches.length;r<a;r++){var i=function(){var a=t.datalinkSearches[r],i=a.dataLink.layer,n=a.displayName,o=new s.Observable(t.providerEnabled.get()),l=new s.ObservableCollection([]);o.sync(t.providerEnabled);var u={displayName:new s.Observable(n),id:new s.Observable(r),relatedTableId:new s.Observable(null),visible:new s.Observable((!0)),relatedEsriFeatureInfo:new s.ObservableCollection([]),relatedGcxFeatures:l,hasRetrievedData:new s.Observable((!1)),noRelatedFeatures:new s.Observable((!1)),canAdd:new s.Observable((!1)),validCardinality:new s.Observable((!1)),errorFetchingRelatedFeatures:new s.Observable((!1)),presentableResults:t._createConfiguredPresentableResultCollection(l),columnHeaders:new s.ObservableCollection([]),providerEnabled:o,masterViewModel:t},d=t._featureLayers[i.url];t._resolveRelatedFeatures(u,e,a,d),t.relationList.addItem(u)};i()}}if(t._createAttachedViews(),t._updateProviderState(),null==t.parentFeature.get()){t.parentFeature.set(t.currentFeature.get());t.parentFeature.get()}})}},t.prototype._findGeocortexLayer=function(t){for(var r in this._featureLayers)if(this._featureLayers.hasOwnProperty(r)){var a=this._featureLayers[r];if(a==t)for(var i=0,n=this._allLayers.length;i<n;i++){var s=this._allLayers[i];if(s&&s.url==r)return s}}return e.prototype._findGeocortexLayer.call(this,t,this.app.site)},t.prototype._siteInitialized=function(){this._findSearchTableRelationships()},t.prototype._findSearchTableRelationships=function(){if(this._searchTablesRelationships={},this.app.site&&this.app.site.essentialsMap)for(var e=this.app.site.essentialsMap.allLayers(),t=0,r=e.length;t<r;t++)for(var a=e[t],i=0,n=a.dataLinks.length;i<n;i++)for(var s=a.dataLinks[i],o=0,l=s.searches.length;o<l;o++){var u=s.searches[o],d=u.searchTableId;this._searchTablesRelationships.hasOwnProperty(d)||(this._searchTablesRelationships[d]=[]),this._searchTablesRelationships[d].push(u)}},t.prototype._resolveRelatedFeatures=function(e,t,r,a){var i=this;if(!(e&&t&&r&&a))return void this.app.trace.error("_resolveRelatedFeatures missing parameters");var n=r.dataLink,s=n?n.layer:null,d=(s&&s.mapService?s.mapService.serviceLayer:null,t.esriFeature.get()),c=d&&d.attributes&&r.tableField?d.attributes[r.tableField]:null,p=s?s.getFieldByName(r.featureField):null,h=this._getEsriField(a,r.featureField),g=h?o.FieldInfo.fromEsriField(h,null,p):null,f=[];if(s&&g){g.searchable=!0,f.push(g);var v=l.getSearchTextWhereClause(s,f,c),m=new esri.tasks.Query;m.where=v,m.outFields=["*"],m.outSpatialReference=this.app.map.spatialReference,m.returnGeometry=!0;var b=l.getQueryTask(s);b.execute(m,function(r){if(0==r.features.length)return e.noRelatedFeatures.set(!0),void e.hasRetrievedData.set(!0);for(var n=new u.FeatureSet({layer:s,app:i.app,esriFeatureSet:new esri.tasks.FeatureSet}),o=0,l=r.features.length;o<l;o++){var d={featureInfo:null,esriFeature:null,gcxFeature:null,layer:a},c=r.features[o];d.esriFeature=c;var p=i._processRelatedFeature(a,c,e);d.featureInfo=p,e.relatedEsriFeatureInfo.addItem(p),i._checkRelatedFeature(d),n.addFeature(d.gcxFeature),d.gcxFeature.setExtendedProperty(i.SEARCHTABLE_KEY,t),d.gcxFeature.hasVisibleRelationships.set(!0),a.hasAttachments&&setTimeout(function(e,t){return function(){t._loadAttachments(e)}}(p,i),100)}n.resolveDataLinks(function(e){i.app.event("FeatureChangedEvent").publish(e)}),e.hasRetrievedData.set(!0)},function(t){e.errorFetchingRelatedFeatures.set(!0),e.hasRetrievedData.set(!0),i.app.trace.error("Error getting related record for search table datalink {0}: {1}.".format(r.displayName,t.message))})}},t.prototype._getEsriField=function(e,t){var r=null;if(e&&e.fields)for(var a=e.fields,i=0,n=a.length;i<n;i++){a[i];if(a[i].name==t){r=a[i];break}}return r},t.prototype._getSearchTable=function(e){var t=null,r=this.app.site;return e&&r&&r.hasSearchTables&&(t=r.getResourceById(r.searchTables,e)),t},t}(r.RelatedFeaturesViewModelBase);t.SearchTablesRelatedFeaturesViewModel=d})},"url:/Mapping/modules/FeatureDetails/FeatureDetailsSwitcherView.html":'<div class="tab-container" data-binding="{@var: scrollingTabContainerElement}">\r\n    <table>\r\n        <tr>\r\n            <td class="tab-left-scroll" data-binding="{@visible: tabControlsEnabled}{@class-disabled: leftScrollTabDisabled}{@var: scrollTabLeftElement}">\r\n                <button data-binding="{@event-onclick: handleTabScrollBack}{title: @language-tab-scroll-prev}">\r\n                    <img src="Resources/Images/Icons/chevron-left-16.png" alt="">\r\n                </button>\r\n            </td>\r\n            <td >\r\n                <div class="tab-container" data-binding="{@var: tabContainerElement}">\r\n                    <ul class="tab-control" data-binding="{@source: viewDescriptors}{@var: tabElements}">\r\n                        <li data-binding="{@template-for: viewDescriptors}{@visible: providerEnabled}{@event-onclick: handleClickTab}">\r\n                            <button data-binding="{@noclass-tab: isActive}{@class-tab-active: isActive}{@text: title}{title: title}"></button>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </td>\r\n            <td class="tab-right-scroll" data-binding="{@visible: tabControlsEnabled}{@class-disabled: rightScrollTabDisabled}{@var: scrollTabRightElement}">\r\n                <button data-binding="{@event-onclick: handleTabScrollForward}{title: @language-tab-scroll-next}">\r\n                    <img src="Resources/Images/Icons/chevron-right-16.png">\r\n                </button>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>',"url:/Mapping/modules/FeatureDetails/FeatureDetailsView.html":'<div class="feature-details-header">\r\n    <div class="feature-actions-widget" data-binding="{@visible: currentFeature}{@widget: FeatureActionsWidget}{@widget-context: currentFeature}{@widget-required: false}" data-menu-id="FeatureActions" data-menu-template="Mapping/infrastructure/menus/MenuHyperlinkView.html"></div>\r\n</div>\r\n<div data-binding="{@widget: FeatureDetailsRegionWidget}{@widget-context: @context}{@widget-required: true}{@widget-replace: true}" tabindex="0"></div>',"url:/Mapping/modules/FeatureDetails/LargeFeatureDetailsView.html":'<div class="large-feature-detail" data-binding="{@visible: headerText}">\r\n    \r\n    <h2 data-binding="{@text: headerText}"></h2>\r\n    <div class="panel-group" data-binding="{@visible: FeatureActions}">\r\n        <ul class="actions-menu" data-binding="{@source: FeatureActions}">\r\n            <li data-binding="{@template-for: FeatureActions}">\r\n                <a href="javascript:void(0);" data-binding="{@text: text}{@event-onmouseover: getDescription}{@event-onclick: handleMenuItemClick}"></a>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    \r\n    <div class="panel-group" data-region-name="FeatureRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter"></div>\r\n \r\n</div>',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttachmentsView.html":'\r\n<div class="panel-group" data-binding="{@visible: attachmentInfos}">\r\n    <h3 data-binding="{@text: @language-feature-attachments}"></h3>\r\n    <div class="no-item" data-binding="{@hidden: isAttachmentInfosInitialized}{@text: @language-feature-attachments-checking}"></div>\r\n    <div class="no-item" data-binding="{@visible: noAttachments}{@text: @language-feature-attachments-no-attachments}"></div>\r\n    <div class="no-item" data-binding="{@visible: isOffline}{@text: @language-feature-attachments-no-attachments-offline}"></div>\r\n    <ul class="list-menu active has-icon" data-binding="{@source: attachmentInfos}">\r\n        <li class="attachment list-menu-item" data-binding="{@template-for: attachmentInfos}{@class-has-delete-button: canEditAttachments}">\r\n            <a data-binding="{href: url}{@event-onclick: attachment_click}{target: target}">\r\n                <img class="list-menu-icon" src="Resources/Images/Icons/Toolbar/attach-24.png" data-binding="{alt: @language-feature-attachments}" />\r\n                <span class="list-menu-details">\r\n                    <strong class="list-menu-name" data-binding="{@text: name}"></strong>\r\n                    <span class="list-menu-desc">\r\n                        <span data-binding="{@text: size}"></span>\r\n                    </span>\r\n                </span>\r\n            </a>\r\n            <button class="list-item-button button-delete" data-binding="{@visible: canEditAttachments}{@event-click: handleDeleteClick}">\r\n                <img src="Resources/Images/Icons/delete-16.png" data-binding="{title: @language-feature-attachments-delete}{alt: @language-feature-attachments-delete}" />\r\n            </button>\r\n        </li>\r\n    </ul>\r\n</div>\r\n',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttributesView.html":'\r\n<div class="panel-group" data-binding="{@visible: providerEnabled}">\r\n    <h3 data-binding="{@text: @language-feature-attributes}" tab-index="1"></h3>\r\n    <div class="list-menu attrib static" data-binding="{@source: attributes}">\r\n        <div class="list-menu-item" data-binding="{@template-for: attributes}{@visible: visible}">\r\n            <strong class="list-menu-name" data-binding="{@text: displayName}"></strong>\r\n            <div class="list-menu-desc">\r\n                <span data-binding="{@hidden: displayAsUrl}{@text: presentableValue}"></span>\r\n                <a data-binding="{href: value}{@visible: displayAsUrl}{@text: presentableValue}{@event-onclick: handleClickAttributeLink}" target="_blank"></a>\r\n                <span data-binding="{@hidden: presentableValue}{@text: @language-feature-not-available}"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinksTableView.html":'<div class="panel-group">\r\n    <h3 data-binding="{@text: displayName}"></h3>\r\n\r\n    <!-- DataLinks Table -->\r\n    <div class="datalinks-table-widget" data-binding="{@widget: DataLinksTableViewWidget}{@widget-context: @context}{@widget-required: false}"></div>\r\n    <!-- END: DataLinksTable Table -->\r\n\r\n    <!-- BEGIN: Paging Controls -->\r\n    <div data-binding="{@hidden: noRelatedFeatures}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}"></div>\r\n    <!-- END: Paging Controls -->\r\n</div>\r\n\r\n',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinksView.html":'<div class="panel-group" data-binding="{@visible: providerEnabled}">\r\n    <h3 data-binding="{@text: displayName}"></h3>\r\n    <div class="list-menu active" data-binding="{@source: dataLinks}">\r\n        <button class="list-menu-item" data-binding="{@template-for: dataLinks}{@event-click: handleViewClick}">\r\n            <div class="list-menu-details">\r\n                <div class="list-menu-name" data-binding="{@text: displayName}"></div>\r\n            </div>\r\n        </button>\r\n    </div>\r\n</div>',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinkView.html":'\r\n<div class="panel-group data-link">\r\n    <h3 data-binding="{@text: @language-feature-attributes}"></h3>\r\n    <div class="datalinks" data-binding="{@visible: currentDataLink}{@source: currentDataLink}">\r\n        <div class="list-menu attrib" data-binding="{@template-for: currentDataLink}{@source: attributes}">\r\n            <div class="list-menu-item" data-binding="{@template-for: attributes}" tabindex="0">\r\n                <strong class="list-menu-name" data-binding="{@text: name}"></strong>\r\n                <span class="list-menu-desc" data-binding="{@visible: presentableValue}">\r\n                    <span data-binding="{@hidden: displayAsUrl}{@text: presentableValue}"></span>\r\n                    <a data-binding="{@event-onclick: handleClickDataLink}{href: value}{@visible: displayAsUrl}{@text: value}" target="_blank"></a>\r\n                </span>\r\n                <span class="list-menu-desc" data-binding="{@hidden: presentableValue}{@text: @language-feature-not-available}"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/DescriptionView.html":'<div class="panel-group feature-description-provider" data-binding="{@visible: providerEnabled}">\r\n    <h3 data-binding="{@text: @language-feature-description}" tab-index="1"></h3>\r\n    <div class="feature-details-content" data-binding="{@widget: GetDescription}{@widget-context: currentFeature}{@widget-required: false}">\r\n    </div>\r\n</div>',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/FeatureActionsView.html":'\r\n<div class="panel-group" data-binding="{@visible: providerEnabled}"  tabindex="0">\r\n    <h3 data-binding="{@text: @language-feature-actions}" tabindex="0"></h3>\r\n    <div class="list-menu active has-icon" data-binding="{@source: visibleMenuItems}">\r\n        <div class="list-menu-item" data-binding="{@template-for: visibleMenuItems}{@event-onmouseover: getDescription}{@event-onclick: handleMenuItemClick}">\r\n            <img class="list-menu-icon" data-binding="{@visible: iconUri}{src: iconUri}{alt: text}" />\r\n            <button class="list-menu-details">\r\n                <strong class="list-menu-name" data-binding="{@text: text}"></strong>\r\n                <span class="list-menu-desc" data-binding="{@text: description}"></span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/HyperlinksView.html":'\r\n<div class="panel-group feature-hyperlinks-provider" data-binding="{@visible: providerEnabled}">\r\n    <h3 data-binding="{@text: @language-feature-hyperlinks}"></h3>\r\n    <div class="list-menu hyperlinks" data-binding="{@visible: providerEnabled}{@source: hyperlinks}">\r\n        <a class="list-menu-item" data-binding="{@template-for: hyperlinks}{href: uri}{target: target}{@event-onclick: handleClickHyperlink}">\r\n            <span class="list-menu-details" data-binding="{title: toolTip}{@class-disabled: isBroken}">\r\n                <strong class="list-menu-name" data-binding="{@text: text}"></strong>\r\n            </span>\r\n        </a>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/MultiColumnAttributesView.html":'<div class="panel-group" data-binding="{@visible: providerEnabled}">\r\n    <h3 data-binding="{@text: @language-feature-attributes}" tabindex="0"></h3>\r\n    <div class="attrib static" data-binding="{@source: multiColumnAttributeContainer}">\r\n        <div class="multi-column-container" data-binding="{@template-for: multiColumnAttributeContainer}">\r\n            <ul class="attribute-list columns" data-binding="{@source: @context}{@template: Mapping/modules/FeatureDetails/FeatureDetailsProviders/SingleAttributeView.html}"></ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesTableView.html":'<div class="panel-group" data-binding="{@class-has-editable-related-features: relatedsEditable}{@visible: providerEnabled}" tabindex="0">\r\n    <h3>\r\n        <span>\r\n            <span data-binding="{@text: displayName}"></span>\r\n        </span>\r\n    </h3>\r\n    <!-- CREATE/EDIT RELATED FEATURES -->\r\n    <div class="no-item" data-binding="{@hidden: hasRetrievedData}{@text: @language-feature-related-checking}"></div>\r\n    <div class="createfeature" data-binding="{@enabled: hasRetrievedData}">\r\n        <div class="list-menu has-icon createfeature-actions" data-binding="{@visible: canAdd}">\r\n            <button class="list-menu-item" data-binding="{@enabled: validCardinality}{@event-click: handleClickAddRelatedRecord}">\r\n                <img class="list-menu-icon" src="Resources/Images/Icons/add-24.png" alt=" " />\r\n                <span class="list-menu-desc" data-binding="{@text: @language-feature-create-related-features}"></span>\r\n            </button>\r\n        </div>\r\n\r\n        <div class="no-item" data-binding="{@visible: noRelatedFeatures}{@text: @language-feature-related-no-data}"></div>\r\n        <div class="no-item" data-binding="{@visible: errorFetchingRelatedFeatures}{@text: @language-feature-related-error-fetching}"></div>\r\n\r\n        <!-- Related Features Table -->\r\n        <div class="related-features-table-widget" data-binding="{@hidden: noRelatedFeatures}{@widget: RelatedFeaturesTableViewWidget}{@widget-context: @context}{@widget-required: false}"></div>\r\n        <!-- END: Related Features Table -->\r\n\r\n        <!-- BEGIN: Paging Controls -->\r\n        <div data-binding="{@hidden: noRelatedFeatures}{@widget: PagingControlsWidget}{@widget-context: @context}{@widget-required: false}"></div>\r\n        <!-- END: Paging Controls -->\r\n    </div>\r\n</div>\r\n\r\n',"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesView.html":'<div class="panel-group" data-binding="{@visible: providerEnabled}" tabindex="0">\r\n    <h3>\r\n        <span>\r\n            <span data-binding="{@text: displayName}"></span>\r\n        </span>\r\n    </h3>\r\n    <!-- CREATE/EDIT RELATED FEATURES -->\r\n    <div class="no-item" data-binding="{@hidden: hasRetrievedData}{@text: @language-feature-related-checking}"></div>\r\n    <div data-binding="{@enabled: hasRetrievedData}">\r\n        <div class="list-menu has-icon" data-binding="{@visible: canAdd}">\r\n            <button class="list-menu-item" data-binding="{@enabled: validCardinality}{@event-click: handleClickAddRelatedRecord}">\r\n                <img class="list-menu-icon" src="Resources/Images/Icons/add-24.png" alt=" " />\r\n                <span class="list-menu-desc" data-binding="{@text: @language-feature-create-related-features}"></span>\r\n            </button>\r\n        </div>\r\n\r\n        <div class="no-item" data-binding="{@visible: noRelatedFeatures}{@text: @language-feature-related-no-data}"></div>\r\n        <div class="no-item" data-binding="{@visible: errorFetchingRelatedFeatures}{@text: @language-feature-related-error-fetching}"></div>\r\n\r\n        <div class="list-menu active" data-binding="{@source: relatedEsriFeatureInfo}">\r\n            <button class="list-menu-item" data-binding="{@template-for: relatedEsriFeatureInfo}{@event-click: handleViewClick}">\r\n                <div class="list-menu-details">\r\n                    <strong class="list-menu-name" data-binding="{@text: displayName}"></strong>\r\n                </div>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n',
"url:/Mapping/modules/FeatureDetails/FeatureDetailsProviders/SingleAttributeView.html":'<li class="attribute-item" data-binding="{@template-for: @context}{@visible: visible}" tabindex="0">\r\n    <span class="attribute-label" data-binding="{@text: displayName}"></span>\r\n    <div class="attribute-details">\r\n        <span data-binding="{@hidden: displayAsUrl}{@text: presentableValue}"></span>\r\n        <a data-binding="{href: value}{@visible: displayAsUrl}{@text: presentableValue}{@event-onclick: handleClickAttributeLink}" target="_blank"></a>\r\n        <span data-binding="{@hidden: presentableValue}{@text: @language-feature-not-available}"></span>\r\n    </div>\r\n</li>'}}),define(["Mapping/modules/FeatureDetails/FeatureDetailsModule","Mapping/modules/FeatureDetails/FeatureDetailsSwitcherView","Mapping/modules/FeatureDetails/FeatureDetailsSwitcherViewDescriptor","Mapping/modules/FeatureDetails/FeatureDetailsSwitcherViewModel","Mapping/modules/FeatureDetails/FeatureDetailsView","Mapping/modules/FeatureDetails/FeatureDetailsViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttachmentsView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttachmentsViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttributesView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/AttributesViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinksView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinksViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/DataLinkView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/DescriptionView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/DescriptionViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/FeatureActionsView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/FeatureActionsViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/Hyperlink","Mapping/modules/FeatureDetails/FeatureDetailsProviders/HyperlinksView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/HyperlinksViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesView","Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesViewModel","Mapping/modules/FeatureDetails/FeatureDetailsProviders/RelatedFeaturesViewModelBase","Mapping/modules/FeatureDetails/FeatureDetailsProviders/SearchTablesRelatedFeaturesViewModel"],function(e,t,r,a,i,n,s,o,l,u,d,c,p,h,g,f,v,m,b,w,F,y,_,D){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsModule",e.FeatureDetailsModule),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsSwitcherView",t.FeatureDetailsSwitcherView),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsSwitcherViewDescriptor",r.FeatureDetailsSwitcherViewDescriptor),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsSwitcherViewModel",a.FeatureDetailsSwitcherViewModel),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsView",i.FeatureDetailsView),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsViewModel",n.FeatureDetailsViewModel),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.AttachmentsView",s.AttachmentsView),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.AttachmentsViewModel",o.AttachmentsViewModel),shim(l,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.AttributesView",l.AttributesView),shim(u,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.AttributesViewModel",u.AttributesViewModel),shim(d,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.DataLinksView",d.DataLinksView),shim(c,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.DataLinksViewModel",c.DataLinksViewModel),shim(p,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.DataLinkView",p.DataLinkView),shim(h,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.DescriptionView",h.DescriptionView),shim(g,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.DescriptionViewModel",g.DescriptionViewModel),shim(f,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.FeatureActionsView",f.FeatureActionsView),shim(v,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.FeatureActionsViewModel",v.FeatureActionsViewModel),shim(m,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.Hyperlink",m.Hyperlink),shim(b,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.HyperlinksView",b.HyperlinksView),shim(w,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.HyperlinksViewModel",w.HyperlinksViewModel),shim(F,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.RelatedFeaturesView",F.RelatedFeaturesView),shim(y,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.RelatedFeaturesViewModel",y.RelatedFeaturesViewModel),shim(_,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.RelatedFeaturesViewModelBase",_.RelatedFeaturesViewModelBase),shim(D,"geocortex.essentialsHtmlViewer.mapping.modules.FeatureDetails.FeatureDetailsProviders.SearchTablesRelatedFeaturesViewModel",D.SearchTablesRelatedFeaturesViewModel)});