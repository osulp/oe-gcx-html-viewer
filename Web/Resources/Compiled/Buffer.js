!function(){function e(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var i=t.split("."),n=null,o=window,a=0,s=i.length;a<s;a++)n=i[a],a==s-1?o[n]=r:o[n]||(o[n]={}),o=o[n];else console.warn("Undefined shim for: "+t)}var t="<div class='buffer-options'>    <div class='form-item'>        <label>            <span data-binding='{@text: @language-buffer-options-distance-label}'></span>            <input type='number' step='any' data-binding='{@value: bufferDistance}{@event-onchange: validateAndApplyInput}{title: @language-buffer-options-distance-title}' />        </label>    </div>    <div class='form-validation' data-binding='{@visible: inputError}'>        <span class='field-validation-error' data-binding='{@text: inputError}'></span>    </div>    <div class='form-item'>        <label>            <span data-binding='{@text: @language-buffer-options-units-label}'></span>            <select data-binding='{@source: bufferUnits}{@value: selectedBufferUnit}{@event-onchange: validateAndApplyInput}{title: @language-buffer-options-length-unit-select}'>                <option data-binding='{@template-for: bufferUnits}{@text: displayName}{value: config}' />            </select>        </label>    </div>    <div class='form-item'>        <label>            <input type='checkbox' data-binding='{@value: writeToMarkupLayer}{@event-onchange: validateAndApplyInput}{title: @language-buffer-options-markup-select}' />            <span data-binding='{@text: @language-buffer-options-markup-label}'></span>        </label>    </div>    <div class='form-validation' data-binding='{@visible: bufferingError}'>        <span class='field-validation-error' data-binding='{@text: bufferingError}'></span>    </div>    <div class='form-btns'>        <button class='button' data-binding='{title: @language-buffer-clear-button-title}{@text: @language-buffer-clear-button-text}{@event-onclick: handleClearButtonClick}'></button>        <button class='button' data-binding='{title: @language-buffer-cancel-button-title}{@text: @language-buffer-cancel-button-text}{@event-onclick: handleCancelButtonClick}'></button>        <button class='button' data-binding='{title: @language-buffer-options-continue-button-title}{@text: @language-buffer-options-continue-button-text}{@event-onclick: handleContinueButtonClick}'></button>    </div></div>";require({cache:{"Mapping/modules/Buffer/BufferModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/buffer/BufferUtils","geocortex/framework/utils/utils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection","geocortex/framework-ui/animation/AnimationSequence","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/commandArgs/AddStatusArgs"],function(t,r,i,n,o,a,s,u,f,c,p,l,d){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var g=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetCommandSettings={},e._bufferWkid=-1,e._bufferSpatialReference=null,e._geodesic=!0,e._extentExpansionFactor=1.25,e._statusMsgTimers={},e.DEFAULT_NUM_FEATURES_WARNING_THRESHOLD=250,e.BUFFERING_STATUS_DISPLAY_DELAY=300,e}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this._bufferWkid=e&&e.bufferProjectionWkid&&""!=e.bufferProjectionWkid?parseInt(e.bufferProjectionWkid,10):-1,void 0!=e.geodesic?this._geodesic=!!e.geodesic:this._geodesic=-1===this._bufferWkid,-1!==this._bufferWkid&&(this._bufferSpatialReference=new esri.SpatialReference(this._bufferWkid)),this._bufferLayerId=e.bufferLayerName?e.bufferLayerName:"Buffering",this._lineColor=e.lineColor?new esri.Color(e.lineColor):new esri.Color("#cf4c40"),this._fillColor=e.fillColor?new esri.Color(e.fillColor):new esri.Color("#cf4c40"),this._numFeaturesWarningThreshold=void 0!=e.numFeaturesWarningThreshold?parseInt(e.numFeaturesWarningThreshold,10):this.DEFAULT_NUM_FEATURES_WARNING_THRESHOLD,this.app.map&&this.app.map.loaded?this.onMapLoaded():this.app.event("MapLoadedEvent").once(this,this.onMapLoaded)},r.prototype.registerCommands=function(){this.app.command("ActivateBuffering").register(this,this.executeActivateBuffering),this.app.command("DeactivateBuffering").register(this,this.executeDeactivateBuffering),this.app.command("BufferGeometry").register(this,this.executeBufferGeometry,this.canExecuteBufferGeometry),this.app.command("IdentifyBufferedGeometry").register(this,this.executeIdentifyBufferedGeometry,this.canExecuteIdentifyBufferedGeometry),this.app.command("IdentifyBufferedFeature").register(this,this.executeIdentifyBufferedFeature,this.canExecuteIdentifyBufferedFeature),this.app.command("IdentifyBufferedFeatureSet").register(this,this.executeIdentifyBufferedFeatureSet,this.canExecuteIdentifyBufferedFeatureSet),this.app.command("IdentifyBufferedFeatureSetCollection").register(this,this.executeIdentifyBufferedFeatureSetCollection,this.canExecuteIdentifyBufferedFeatureSetCollection)},r.prototype.subscribeEvents=function(){this.app.event("BufferDistanceChangedEvent").subscribe(this,this.handleBufferDistanceChangedEvent)},r.prototype.onMapLoaded=function(){this.registerCommands(),this.subscribeEvents();var e=this.app.map.spatialReference;this._geodesic=!(void 0==e.wkid||!n.isGeographicWkid(e.wkid))||this._geodesic,this._bufferSpatialReference||(this._bufferSpatialReference=e)},r.prototype.executeActivateBuffering=function(e){this._setCmdBufferStatusAndRaiseEvent(e,!0)},r.prototype.executeDeactivateBuffering=function(e){this._setCmdBufferStatusAndRaiseEvent(e,!1)},r.prototype.handleBufferDistanceChangedEvent=function(e){if(e&&e.targetCommands)for(var t=0;t<e.targetCommands.length;t++){var r=e.targetCommands[t],i=this.targetCommandSettings[r];i?(i.bufferDistance=e.distance,i.bufferUnit=e.unit.config,i.writeToMarkupLayer=e.writeToMarkupLayer):i=this._createEntryForTargetCommand(r,e.distance,e.unit.config),this._updateTargetCommandToolStatusMessages(r,i)}},r.prototype.executeBufferGeometry=function(e){var t=this;if(this._performBufferOperation(e)){var r=void 0==e.bufferId?o.alphaNumericToken():e.bufferId;this._addBufferingStatusMsg(r),n.bufferGeometry(this.app,e).then(function(i){t._processBufferResults(i,e),t._removeBufferingStatusMsg(r)},function(i){t._reportBufferingError(i,e.errback),t._removeBufferingStatusMsg(r)})}},r.prototype.executeBufferGeometries=function(e){var t=this;if(this._performBufferOperation(e)){var r=function(){var r=void 0==e.bufferId?o.alphaNumericToken():e.bufferId;t._addBufferingStatusMsg(r),n.bufferGeometries(t.app,e).then(function(i){t._processBufferResults(i,e),t._removeBufferingStatusMsg(r)},function(i){t._reportBufferingError(i,e.errback),t._removeBufferingStatusMsg(r)})};e.geometries.length>this._numFeaturesWarningThreshold?this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-buffer-excess-features-warning").format(e.geometries.length),null,function(e){e&&r()}):r()}},r.prototype.canExecuteBufferGeometry=function(e){return!!e.geometry&&a.isValidGeometry(e.geometry)&&(e.bufferUnit&&null!=e.bufferDistance&&!isNaN(Number(e.bufferDistance))||!!e.sourceCommand)},r.prototype.executeIdentifyBufferedGeometry=function(e){e&&this._showBufferOptionsAndExecuteBufferGeometry("IdentifyBufferedGeometry",e)},r.prototype.canExecuteIdentifyBufferedGeometry=function(e){return!!e&&a.isValidGeometry(e)},r.prototype.executeIdentifyBufferedFeature=function(e){var t=e instanceof esri.Graphic?e.geometry:e&&e.esriFeature.get()?e.esriFeature.get().geometry:null;t&&this._showBufferOptionsAndExecuteBufferGeometry("IdentifyBufferedFeature",t)},r.prototype.canExecuteIdentifyBufferedFeature=function(e){var t=null;return e&&e instanceof esri.Graphic?t=e.geometry:e&&e instanceof s.Feature&&e.esriFeature&&e.esriFeature.get()&&(t=e.esriFeature.get().geometry),!!t&&a.isValidGeometry(t)},r.prototype.executeIdentifyBufferedFeatureSet=function(e){var t=null;if("string"==typeof e&&(e=this.app.featureSetManager.getCollectionById(e)),e instanceof f.FeatureSetCollection&&(t=e.featureSets.get().filter(function(e){return e.isSelectedInCollection.get()})[0]||e.featureSets.get()[0]||null),e instanceof u.FeatureSet&&(t=e),t){var r=this._retrieveGeometries(t);r.length&&this._showBufferOptionsAndExecuteBufferGeometries("IdentifyBufferedFeatureSet",r)}else{var i=this.app.getResource(this.libraryId,"language-buffer-error-identify-buffered-feature-set");this._reportBufferingError(this._generateErrorObjFromString(i,"IdentifyBufferedFeatureSet"))}},r.prototype.canExecuteIdentifyBufferedFeatureSet=function(e){return e&&"string"==typeof e?!!this.app.featureSetManager.getCollectionById(e):!!e},r.prototype.executeIdentifyBufferedFeatureSetCollection=function(e){var t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e;if(t){var r=this._retrieveGeometries(t);r.length&&this._showBufferOptionsAndExecuteBufferGeometries("IdentifyBufferedFeatureSetCollection",r)}else{var i=this.app.getResource(this.libraryId,"language-buffer-error-identify-buffered-feature-set-collection");this._reportBufferingError(this._generateErrorObjFromString(i,"IdentifyBufferedFeatureSetCollection"))}},r.prototype.canExecuteIdentifyBufferedFeatureSetCollection=function(e){return e&&"string"==typeof e?!!this.app.featureSetManager.getCollectionById(e):!!e},r.prototype._createEntryForTargetCommand=function(e,t,r,i){if(e&&!this.targetCommandSettings[e]){var n={};return n.isActive=!!i,n.bufferDistance=t||null,n.bufferUnit=r||null,this.targetCommandSettings[e]=n,n}},r.prototype._performBufferOperation=function(e){if(this._processBufferArgs(e))return!0;var t=this.targetCommandSettings[e.sourceCommand];if(!t||t&&!t.isActive){var r={};return r.bufferId=e.bufferId,r.sourceCommand=e.sourceCommand,r.geometry=e.geometry,r.geometries=e.geometries,e.callback(r),!1}var i=this.app.getResource(this.libraryId,"language-buffer-error-process-args");this._reportBufferingError(this._generateErrorObjFromString(i,e.sourceCommand,e.bufferId),e.errback)},r.prototype._processBufferArgs=function(e){if(e.bufferSpatialReference=e.bufferSpatialReference||this._bufferSpatialReference,e.outSpatialReference=this.app.map.spatialReference,e.geodesic=void 0!=e.geodesic?e.geodesic:this._geodesic,e.bufferId=void 0==e.bufferId?o.alphaNumericToken():e.bufferId,(void 0==e.bufferDistance||void 0==e.bufferUnit)&&e.sourceCommand){var t=this.targetCommandSettings[e.sourceCommand];if(t&&t.isActive&&void 0!=t.bufferDistance&&t.bufferUnit&&(e.bufferDistance=t.bufferDistance,e.bufferUnit=t.bufferUnit,e.writeToMarkupLayer=t.writeToMarkupLayer),t&&t.isActive&&(void 0==t.bufferDistance||void 0==t.bufferUnit))return!1}return void 0!=e.bufferDistance&&void 0!=e.bufferUnit},r.prototype._processBufferResults=function(e,t){var r=this,i=e.geometry||e.geometries,n=function(i){if("point"!==i.type){var n=i.getExtent().expand(r._extentExpansionFactor);r.app.map.extent.contains(n)||r.app.command("ZoomToExtent").execute(n)}if(t.writeToMarkupLayer)r.app.command("AddMarkupGeometry").execute(i);else{var o=r._addGeometryMarkup(i);$(document.body).one("mouseup touchend keydown",function(e){return r._removeGeometryMarkup(o)})}t.callback&&dojo.isFunction(t.callback)&&t.callback(e),r.app.event("BufferingCompletedEvent").publish(e)};if(dojo.isArray(i)){if(i.length<1)return void this._reportBufferingError(this._generateErrorObjFromString(this.app.getResource(this.libraryId,"language-buffer-error-invalid-results"),t.sourceCommand,t.bufferId),t.errback);if(1===i.length)return void n(i[0]);a.unionGeometries(i,this.app).then(function(t){e.geometry=t,n(t)},function(e){r._reportBufferingError(r._generateErrorObjFromString(r.app.getResource(r.libraryId,"language-buffer-error-union-operation"),t.sourceCommand,t.bufferId),t.errback)})}else n(i)},r.prototype._setCmdBufferStatusAndRaiseEvent=function(e,t){var r=this,i=function(e){var i=r.targetCommandSettings[e];i?i.isActive=t:i=r._createEntryForTargetCommand(e,null,null,!0),r._updateTargetCommandToolStatusMessages(e,i)};if("string"==typeof e)i(e);else{if(!e.length)return;e.forEach(function(e){return i(e)})}t?this.app.event("BufferingActivatedEvent").publish(e):this.app.event("BufferingDeactivatedEvent").publish(e)},r.prototype._retrieveGeometries=function(e){var t=[],r=[];e instanceof u.FeatureSet&&r.push(e),e instanceof f.FeatureSetCollection&&(r=e.featureSets.get());for(var i=0;i<r.length;i++)for(var n=r[i],o=0;o<n.features.length();o++){var s=n.features.getAt(o),c=s.esriFeature.get()?s.esriFeature.get().geometry:null;c&&a.isValidGeometry(c)&&t.push(c)}return t},r.prototype._showBufferOptionsAndExecuteBufferGeometry=function(e,t){this._showBufferOptionsAndExecuteBufferGeometries(e,[t])},r.prototype._showBufferOptionsAndExecuteBufferGeometries=function(e,t){var r=this,i={targetCommand:e,delegateFunction:function(i){var n={};n.geometries=t,n.callback=function(e){return r._performIdentifyForGeometry(e,!0)},n.sourceCommand=e,n.unionResults=!0,r.executeActivateBuffering(e),r.executeBufferGeometries(n),r.app.command("DeactivateBufferingAndDismissOptions").execute(e)}};this.app.command("DisplayBufferOptions").execute(i)},r.prototype._performIdentifyForGeometry=function(e,t){var r=this;void 0===t&&(t=!1);var i=e.geometry||(e.geometries&&1===e.geometries.length?e.geometries[0]:null);if(i){var n={};n.geometry=i,n.source="Identify",n.layerRestriction=function(e){return e.identifiable},n.doNotBuffer=t,c.runWhenIdle(function(){r.app.command("Identify").execute(n)})}},r.prototype._generateErrorObjFromString=function(e,t,r){var i={};return i.sourceCommand=t,i.error=new Error(e),void 0!=r&&(i.bufferId=r),i},r.prototype._reportBufferingError=function(e,t){this.app.event("BufferingErrorEvent").publish(e),t&&dojo.isFunction(t)&&t(e)},r.prototype._updateTargetCommandToolStatusMessages=function(e,t){var r=this,i=this._getToolsByCommand(e);if(i&&i.length){var o=function(e){if(e.isActive){var t={id:e.name+"StatusMessageView",text:e.statusText,closeButton:{}};r.app.command("DisplayNotification").execute(t)}},a=function(e){e.originalStatusText||(e.originalStatusText=e.statusText);var i=n.getUnitDescFromConfig(t.bufferUnit).displayName,a=r.app.getResource(r.libraryId,"language-buffer-active-tool-addon-message").format(t.bufferDistance,i);e.statusText="{0} {1}".format(e.originalStatusText,a),o(e)},s=function(e){e.originalStatusText&&(e.statusText=e.originalStatusText,delete e.originalStatusText,o(e))},u=function(e){t.isActive&&null!=t.bufferDistance&&t.bufferUnit?a(e):s(e)};i.forEach(function(e){return u(e)})}},r.prototype._getToolsByCommand=function(e){var t=[],r=this.app.toolRegistry.tools;for(var i in r){if(!r.hasOwnProperty(i))return;var n=r[i];n.command===e&&t.push(n)}return t},r.prototype._addGeometryMarkup=function(e){var t=new esri.Graphic;t.setGeometry(e);var r;return"polygon"===t.geometry.type||"extent"===t.geometry.type?((r=p.defaultFillSymbol()).setColor(this._fillColor),r.color.a=.3,r.outline.setColor(this._lineColor)):"polyline"===t.geometry.type?(r=p.defaultLineSymbol()).setColor(this._lineColor):(r=p.defaultMarkerSymbol()).setColor(this._lineColor),t.setSymbol(r),l.getInternalGraphicsLayer(this._bufferLayerId,this.app,l.GraphicsLayerType.Markup)&&l.addGraphicToLayer(t,this._bufferLayerId,this.app),t},r.prototype._removeGeometryMarkup=function(e){var t=this.app.map.getLayer(this._bufferLayerId);t&&e&&t.remove(e)},r.prototype._addBufferingStatusMsg=function(e){if(e){var t=setTimeout(dojo.hitch(this,function(){var t=this.app.getResource(this.libraryId,"language-buffer-status-msg"),r=new d.AddStatusArgs(t);r.id=e,r.showBusyIcon=!0,r.timeoutMS=0,this.app.command("AddStatus").execute(r)}),this.BUFFERING_STATUS_DISPLAY_DELAY);this._statusMsgTimers[e]=t}},r.prototype._removeBufferingStatusMsg=function(e){if(e){var t=this._statusMsgTimers[e];t&&(clearTimeout(t),this.app.command("RemoveStatus").execute(e),delete this._statusMsgTimers[e])}},r}(i.ModuleBase);r.BufferModule=g})},"Mapping/modules/Buffer/BufferOptionsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._currentTargetCommands=[],e}return e(r,t),r.prototype.attach=function(e){if(this.configuration&&this.configuration.targetCommands&&this.configuration.targetCommands.length){this.masterViewModel=e,e.registerView(this.id,this.configuration.targetCommands);var r=e.getViewModelForView(this.id);r&&(t.prototype.attach.call(this,r),this.registerCommands())}else this.app.trace.error(this.app.getResource(this.libraryId,"language-buffer-target-modules-error"))},r.prototype.registerCommands=function(){this.app.command("DisplayBufferOptions").register(this,this.executeDisplayBufferOptions,this.canExecuteDisplayBufferOptions),this.app.command("ActivateBufferingAndDisplayOptions").register(this,this.executeActivateBufferingAndDisplayOptions,this.canExecuteDisplayBufferOptions),this.app.command("DeactivateBufferingAndDismissOptions").register(this,this.executeDeactivateBufferingAndDismissOptions,this.canExecuteDisplayBufferOptions)},r.prototype.executeDisplayBufferOptions=function(e){var t="string"==typeof e?e:e.targetCommand,r="string"==typeof e?null:e.delegateFunction;r&&dojo.isFunction(r)&&(this._oneTimeCommandDelegateParams={},this._oneTimeCommandDelegateParams.delegateFunction=r,this._oneTimeCommandDelegateParams.targetCommand=t),this._currentTargetCommands.push(t),this.app.viewManager.activateView(this)},r.prototype.executeActivateBufferingAndDisplayOptions=function(e){var t="string"==typeof e?e:e.targetCommand;this.canExecuteDisplayBufferOptions(t)&&(this.app.command("ActivateBuffering").execute(t),this.app.command("DisplayBufferOptions").execute(e))},r.prototype.executeDeactivateBufferingAndDismissOptions=function(e){var t="string"==typeof e?e:e.targetCommand;this.canExecuteDisplayBufferOptions(t)&&(this.app.command("DeactivateBuffering").execute(t),this.dismissBufferOptions(t))},r.prototype.canExecuteDisplayBufferOptions=function(e){if(!e)return!1;var t="string"==typeof e?e:e.targetCommand;return!!t&&this.canDisplayOptionsForTargetCommand(t)},r.prototype.canDisplayOptionsForTargetCommand=function(e){var t=this.viewModel.targetCommands;return!(!t||!t.length)&&t.indexOf(e)>-1},r.prototype.validateAndApplyInput=function(){this.masterViewModel.validateAndProcessInput(this.id)},r.prototype.handleContinueButtonClick=function(){this.masterViewModel.validateAndProcessInput(this.id)&&(this._executeOneTimeCommandDelegate(),this.dismissBufferOptions())},r.prototype.handleCancelButtonClick=function(){this._oneTimeCommandDelegateParams&&(this._oneTimeCommandDelegateParams=null);var e=this._currentTargetCommands.length?this._currentTargetCommands[this._currentTargetCommands.length-1]:null;e&&this.app.command("DeactivateBufferingAndDismissOptions").execute(e)},r.prototype.handleClearButtonClick=function(){this.viewModel.bufferingError.set(""),this.viewModel.bufferDistance.set(null),this.masterViewModel._raiseChangedBufferDistanceEvent(this.viewModel)},r.prototype.dismissBufferOptions=function(e){if(e){var t=this._currentTargetCommands.indexOf(e);t>-1&&this._currentTargetCommands.splice(t,1)}0===this._currentTargetCommands.length&&this.isActive&&this.app.viewManager.deactivateView(this);var r=this.viewModel.targetCommands;if(r&&r.length){var i=this.masterViewModel.generateBufferDistanceChangedEventArgs(this.viewModel);this.app.event("BufferOptionsDismissedEvent").publish(i)}},r.prototype._executeOneTimeCommandDelegate=function(){if(this._oneTimeCommandDelegateParams&&dojo.isFunction(this._oneTimeCommandDelegateParams.delegateFunction)){var e=this.masterViewModel.generateBufferDistanceChangedEventArgs(this.viewModel,[this._oneTimeCommandDelegateParams.targetCommand]);this._oneTimeCommandDelegateParams.delegateFunction(e),this._oneTimeCommandDelegateParams=null}},r}(i.ViewBase);r.BufferOptionsView=n})},"Mapping/modules/Buffer/BufferOptionsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","geocortex/framework/observables","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/buffer/BufferUtils"],function(t,r,i,n,o,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n.childViewModels=[],n.bufferUnits=new i.ObservableCollection([]),n._addBufferToMarkupLayerByDefault=!1,n._getSupportedBufferUnitLanguageResources(),n}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this._setBufferUnits(e.bufferUnits),this._setDefaultBufferUnit(e.defaultBufferUnit),this.DEFAULT_BUFFER_DISTANCE=isNaN(parseInt(e.defaultBufferDistance,10))?0:parseInt(e.defaultBufferDistance,10),this._addBufferToMarkupLayerByDefault=!!e.addBufferToMarkupLayerByDefault,this.bufferUnits.length()&&this.DEFAULT_BUFFER_UNIT?this.subscribeEvents():this.app.trace.error(this.app.getResource(this.libraryId,"language-buffer-config-units-error"))},r.prototype.subscribeEvents=function(){this.app.event("BufferingErrorEvent").subscribe(this,this.handleBufferingErrorEvent)},r.prototype.registerView=function(e,t){if(!e||!t||!t.length)return!1;if(this.childViewModels.filter(function(t){return t.viewId===e}).length)return!1;var r={};r.viewId=e,r.bufferUnits=this.bufferUnits,r.targetCommands=t.slice(0),r.bufferDistance=new i.Observable(this.DEFAULT_BUFFER_DISTANCE?this.DEFAULT_BUFFER_DISTANCE:null),r.selectedBufferUnit=new i.Observable(this.DEFAULT_BUFFER_UNIT.config),r.inputError=new i.Observable(""),r.bufferingError=new i.Observable(""),r.writeToMarkupLayer=new i.Observable(this._addBufferToMarkupLayerByDefault),this.childViewModels.push(r)},r.prototype.validateAndProcessInput=function(e){var t=this.getViewModelForView(e);if(!t){var r=this.app.getResource(this.libraryId,"language-buffer-error-input-validation").format(e);return this.app.trace.error(r),t.bufferingError.set(r),!1}var i="number"==typeof t.bufferDistance.get()?t.bufferDistance.get():t.bufferDistance.get()?o.parseNumber(t.bufferDistance.get()):null;return null===i||isNaN(i)?(t.inputError.set(this.app.getResource(this.libraryId,"language-buffer-invalid-distance")),!1):(t.inputError.set(""),t.bufferingError.set(""),t.bufferDistance.set(o.formatNumber(i)),this._raiseChangedBufferDistanceEvent(t),!0)},r.prototype.getViewModelForView=function(e){var t=this.childViewModels.filter(function(t){return t.viewId===e});return t.length?(t.length>1&&this.app.trace.warning("Multiple child view models registered for view with id {0}. Please check your configuration. Using first instance of view model.".format(e)),t[0]):(this.app.trace.error("BufferOptionsViewModel: Could not find child view model for view with id {0}".format(e)),null)},r.prototype.getViewModelForCommand=function(e){var t=this.childViewModels.filter(function(t){return t.targetCommands.indexOf(e)>-1});return t.length?t[0]:null},r.prototype.handleBufferingErrorEvent=function(e){if(e&&e.sourceCommand){var t=this.getViewModelForCommand(e.sourceCommand);if(t){var r=e&&e.error?e.error.message||e.error.name:"",i=e.error.details;i&&i.length&&(r=r.concat(" ",i.join(" "))),r=r?this.app.getResource(this.libraryId,"language-buffer-operation-error").format(r):this.app.getResource(this.libraryId,"language-buffer-error-details-unavailable"),t.bufferingError.set(r);var n=this.app.viewManager.getViewById(t.viewId);this.app.viewManager.activateView(n)}}},r.prototype.generateBufferDistanceChangedEventArgs=function(e,t){var r={};return r.distance=o.parseNumber(e.bufferDistance.get()),r.unit=a.getUnitDescFromConfig(e.selectedBufferUnit.get()),r.writeToMarkupLayer=e.writeToMarkupLayer.get(),r.targetCommands=t&&t.length?t:e.targetCommands.slice(0),r},r.prototype._raiseChangedBufferDistanceEvent=function(e){var t=this.generateBufferDistanceChangedEventArgs(e);this.app.event("BufferDistanceChangedEvent").publish(t)},r.prototype._getSupportedBufferUnitLanguageResources=function(){for(var e in a.SUPPORTED_BUFFER_UNITS)a.SUPPORTED_BUFFER_UNITS.hasOwnProperty(e)&&(a.SUPPORTED_BUFFER_UNITS[e]={displayName:this.app.getResource(this.libraryId,"language-buffer-unit-"+e.toLowerCase()+"-display-name"),config:e})},r.prototype._setBufferUnits=function(e){var t=this;e&&e.length&&e.forEach(function(e){var r=a.SUPPORTED_BUFFER_UNITS[e];r?t.bufferUnits.addItem(r):t.app.trace.warning(t.app.getResource(t.libraryId,"language-buffer-invalid-unit-warning").format(e))})},r.prototype._setDefaultBufferUnit=function(e){var t;if(e&&(t=a.SUPPORTED_BUFFER_UNITS[e]),!t){if(!this.bufferUnits.length())return void this.app.trace.warning(this.app.getResource(this.libraryId,"language-buffer-invalid-unit-warning").format(e));t=this.bufferUnits.getAt(0)}this.DEFAULT_BUFFER_UNIT=t},r}(n.ViewModelBase);r.BufferOptionsViewModel=s})},"url:/Mapping/modules/Buffer/BufferOptionsView.html":t}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Buffer/CSS/common.css","css","LmJ1ZmZlci1vcHRpb25zIHsNCiAgICBwYWRkaW5nOiAxZW07DQp9DQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J10gew0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQp9"),e.resourceManager.register("Mapping","inv","Mapping/modules/Buffer/BufferOptionsView.html","html",t)}),require({cache:{}}),define(["Mapping/modules/Buffer/BufferModule","Mapping/modules/Buffer/BufferOptionsView","Mapping/modules/Buffer/BufferOptionsViewModel"],function(t,r,i){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.buffer.BufferModule",t.BufferModule),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.buffer.BufferOptionsView",r.BufferOptionsView),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.buffer.BufferOptionsViewModel",i.BufferOptionsViewModel)})}();