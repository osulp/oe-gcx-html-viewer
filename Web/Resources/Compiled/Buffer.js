!function(){var t="<div class='buffer-options'>    <div class='form-item'>        <label>            <span data-binding='{@text: @language-buffer-options-distance-label}'></span>            <input type='number' step='any' data-binding='{@value: bufferDistance}{@event-onchange: validateAndApplyInput}{title: @language-buffer-options-distance-title}' />        </label>    </div>    <div class='form-validation' data-binding='{@visible: inputError}'>        <span class='field-validation-error' data-binding='{@text: inputError}'></span>    </div>    <div class='form-item'>        <label>            <span data-binding='{@text: @language-buffer-options-units-label}'></span>            <select data-binding='{@source: bufferUnits}{@value: selectedBufferUnit}{@event-onchange: validateAndApplyInput}{title: @language-buffer-options-length-unit-select}'>                <option data-binding='{@template-for: bufferUnits}{@text: displayName}{value: config}' />            </select>        </label>    </div>    <div class='form-item'>        <label>            <input type='checkbox' data-binding='{@value: writeToMarkupLayer}{@event-onchange: validateAndApplyInput}{title: @language-buffer-options-markup-select}' />            <span data-binding='{@text: @language-buffer-options-markup-label}'></span>        </label>    </div>    <div class='form-validation' data-binding='{@visible: bufferingError}'>        <span class='field-validation-error' data-binding='{@text: bufferingError}'></span>    </div>    <div class='form-btns'>        <button class='button' data-binding='{title: @language-buffer-clear-button-title}{@text: @language-buffer-clear-button-text}{@event-onclick: handleClearButtonClick}'></button>        <button class='button' data-binding='{title: @language-buffer-cancel-button-title}{@text: @language-buffer-cancel-button-text}{@event-onclick: handleCancelButtonClick}'></button>        <button class='button' data-binding='{title: @language-buffer-options-continue-button-title}{@text: @language-buffer-options-continue-button-text}{@event-onclick: handleContinueButtonClick}'></button>    </div></div>";function i(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var i=t.split("."),n=null,o=window,a=0,s=i.length;a<s;a++)n=i[a],a==s-1?o[n]=r:o[n]||(o[n]={}),o=o[n];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Buffer/BufferModule":function(){var i,h=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/buffer/BufferUtils","geocortex/framework/utils/utils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection","geocortex/framework-ui/animation/AnimationSequence","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/commandArgs/AddStatusArgs"],function(e,t,r,s,n,f,i,c,l,o,a,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d,g=(d=r.ModuleBase,h(m,d),m.prototype.initialize=function(e){d.prototype.initialize.call(this,e),this._bufferWkid=e&&e.bufferProjectionWkid&&""!==e.bufferProjectionWkid?parseInt(e.bufferProjectionWkid,10):-1,n.isNullOrUndefined(e.geodesic)?this._geodesic=-1===this._bufferWkid:this._geodesic=!!e.geodesic,-1!==this._bufferWkid&&(this._bufferSpatialReference=new esri.SpatialReference(this._bufferWkid)),this._bufferLayerId=e.bufferLayerName?e.bufferLayerName:"Buffering",this._lineColor=e.lineColor?new esri.Color(e.lineColor):new esri.Color("#cf4c40"),this._fillColor=e.fillColor?new esri.Color(e.fillColor):new esri.Color("#cf4c40"),this._numFeaturesWarningThreshold=n.isNullOrUndefined(e.numFeaturesWarningThreshold)?this.DEFAULT_NUM_FEATURES_WARNING_THRESHOLD:parseInt(e.numFeaturesWarningThreshold,10),this.app.map&&this.app.map.loaded?this.onMapLoaded():this.app.event("MapLoadedEvent").once(this,this.onMapLoaded)},m.prototype.registerCommands=function(){this.app.command("ActivateBuffering").register(this,this.executeActivateBuffering),this.app.command("DeactivateBuffering").register(this,this.executeDeactivateBuffering),this.app.command("BufferGeometry").register(this,this.executeBufferGeometry,this.canExecuteBufferGeometry),this.app.command("IdentifyBufferedGeometry").register(this,this.executeIdentifyBufferedGeometry,this.canExecuteIdentifyBufferedGeometry),this.app.command("IdentifyBufferedFeature").register(this,this.executeIdentifyBufferedFeature,this.canExecuteIdentifyBufferedFeature),this.app.command("IdentifyBufferedFeatureSet").register(this,this.executeIdentifyBufferedFeatureSet,this.canExecuteIdentifyBufferedFeatureSet),this.app.command("IdentifyBufferedFeatureSetCollection").register(this,this.executeIdentifyBufferedFeatureSetCollection,this.canExecuteIdentifyBufferedFeatureSetCollection)},m.prototype.subscribeEvents=function(){this.app.event("BufferDistanceChangedEvent").subscribe(this,this.handleBufferDistanceChangedEvent)},m.prototype.onMapLoaded=function(){this.registerCommands(),this.subscribeEvents();var e=this.app.map.spatialReference;this._geodesic=!(n.isNullOrUndefined(e.wkid)||!s.isGeographicWkid(e.wkid))||this._geodesic,this._bufferSpatialReference||(this._bufferSpatialReference=e)},m.prototype.executeActivateBuffering=function(e){this._setCmdBufferStatusAndRaiseEvent(e,!0)},m.prototype.executeDeactivateBuffering=function(e){this._setCmdBufferStatusAndRaiseEvent(e,!1)},m.prototype.handleBufferDistanceChangedEvent=function(e){if(e&&e.targetCommands)for(var t=0,r=e.targetCommands;t<r.length;t++){var i=r[t],n=this.targetCommandSettings[i];n?(n.bufferDistance=e.distance,n.bufferUnit=e.unit.config,n.writeToMarkupLayer=e.writeToMarkupLayer):n=this._createEntryForTargetCommand(i,e.distance,e.unit.config),this._updateTargetCommandToolStatusMessages(i,n)}},m.prototype.executeBufferGeometry=function(t){var r=this;if(this._performBufferOperation(t)){var i=n.isNullOrUndefined(t.bufferId)?n.alphaNumericToken():t.bufferId;this._addBufferingStatusMsg(i),s.bufferGeometry(this.app,t).then(function(e){r._processBufferResults(e,t),r._removeBufferingStatusMsg(i)},function(e){r._reportBufferingError(e,t.errback),r._removeBufferingStatusMsg(i)})}},m.prototype.executeBufferGeometries=function(r){var i=this;if(this._performBufferOperation(r)){var t=function(){var t=n.isNullOrUndefined(r.bufferId)?n.alphaNumericToken():r.bufferId;i._addBufferingStatusMsg(t),s.bufferGeometries(i.app,r).then(function(e){i._processBufferResults(e,r),i._removeBufferingStatusMsg(t)},function(e){i._reportBufferingError(e,r.errback),i._removeBufferingStatusMsg(t)})};r.geometries.length>this._numFeaturesWarningThreshold?this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-buffer-excess-features-warning").format(r.geometries.length),null,function(e){e&&t()}):t()}},m.prototype.canExecuteBufferGeometry=function(e){return!!e.geometry&&f.isValidGeometry(e.geometry)&&(e.bufferUnit&&null!=e.bufferDistance&&!isNaN(Number(e.bufferDistance))||!!e.sourceCommand)},m.prototype.executeIdentifyBufferedGeometry=function(e){e&&this._showBufferOptionsAndExecuteBufferGeometry("IdentifyBufferedGeometry",e)},m.prototype.canExecuteIdentifyBufferedGeometry=function(e){return!!e&&f.isValidGeometry(e)},m.prototype.executeIdentifyBufferedFeature=function(e){var t=e instanceof esri.Graphic?e.geometry:e&&e.esriFeature.get()?e.esriFeature.get().geometry:null;t&&this._showBufferOptionsAndExecuteBufferGeometry("IdentifyBufferedFeature",t)},m.prototype.canExecuteIdentifyBufferedFeature=function(e){var t=null;return e&&e instanceof esri.Graphic?t=e.geometry:e&&e instanceof i.Feature&&e.esriFeature&&e.esriFeature.get()&&(t=e.esriFeature.get().geometry),!!t&&f.isValidGeometry(t)},m.prototype.executeIdentifyBufferedFeatureSet=function(e){var t="IdentifyBufferedFeatureSet",r=null;if("string"==typeof e&&(e=this.app.featureSetManager.getCollectionById(e)),e instanceof l.FeatureSetCollection&&(r=e.featureSets.get().filter(function(e){return e.isSelectedInCollection.get()})[0]||e.featureSets.get()[0]||null),e instanceof c.FeatureSet&&(r=e),r){var i=this._retrieveGeometries(r);i.length&&this._showBufferOptionsAndExecuteBufferGeometries(t,i)}else{var n=this.app.getResource(this.libraryId,"language-buffer-error-identify-buffered-feature-set");this._reportBufferingError(this._generateErrorObjFromString(n,t))}},m.prototype.canExecuteIdentifyBufferedFeatureSet=function(e){return e&&"string"==typeof e?!!this.app.featureSetManager.getCollectionById(e):!!e},m.prototype.executeIdentifyBufferedFeatureSetCollection=function(e){var t="IdentifyBufferedFeatureSetCollection",r="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e;if(r){var i=this._retrieveGeometries(r);i.length&&this._showBufferOptionsAndExecuteBufferGeometries(t,i)}else{var n=this.app.getResource(this.libraryId,"language-buffer-error-identify-buffered-feature-set-collection");this._reportBufferingError(this._generateErrorObjFromString(n,t))}},m.prototype.canExecuteIdentifyBufferedFeatureSetCollection=function(e){return e&&"string"==typeof e?!!this.app.featureSetManager.getCollectionById(e):!!e},m.prototype._createEntryForTargetCommand=function(e,t,r,i){if(e&&!this.targetCommandSettings[e]){var n={};return n.isActive=!!i,n.bufferDistance=t||null,n.bufferUnit=r||null,this.targetCommandSettings[e]=n}},m.prototype._performBufferOperation=function(e){if(this._processBufferArgs(e))return!0;var t=this.targetCommandSettings[e.sourceCommand];if(!t||t&&!t.isActive){var r={};return r.bufferId=e.bufferId,r.sourceCommand=e.sourceCommand,r.geometry=e.geometry,r.geometries=e.geometries,e.callback(r),!1}var i=this.app.getResource(this.libraryId,"language-buffer-error-process-args");this._reportBufferingError(this._generateErrorObjFromString(i,e.sourceCommand,e.bufferId),e.errback)},m.prototype._processBufferArgs=function(e){if(e.bufferSpatialReference=e.bufferSpatialReference||this._bufferSpatialReference,e.outSpatialReference=this.app.map.spatialReference,e.geodesic=n.isNullOrUndefined(e.geodesic)?this._geodesic:e.geodesic,e.bufferId=n.isNullOrUndefined(e.bufferId)?n.alphaNumericToken():e.bufferId,(n.isNullOrUndefined(e.bufferDistance)||n.isNullOrUndefined(e.bufferUnit))&&e.sourceCommand){var t=this.targetCommandSettings[e.sourceCommand];if(t&&t.isActive&&!n.isNullOrUndefined(t.bufferDistance)&&t.bufferUnit&&(e.bufferDistance=t.bufferDistance,e.bufferUnit=t.bufferUnit,e.writeToMarkupLayer=t.writeToMarkupLayer),t&&t.isActive&&(n.isNullOrUndefined(t.bufferDistance)||n.isNullOrUndefined(t.bufferUnit)))return!1}return!n.isNullOrUndefined(e.bufferDistance)&&!n.isNullOrUndefined(e.bufferUnit)},m.prototype._processBufferResults=function(i,n){function t(e){if("point"!==e.type){var t=e.getExtent().expand(o._extentExpansionFactor);o.app.map.extent.contains(t)||o.app.command("ZoomToExtent").execute(t)}if(n.writeToMarkupLayer)o.app.command("AddMarkupGeometry").execute(e);else{var r=o._addGeometryMarkup(e);$(document.body).one("mouseup touchend keydown",function(e){return o._removeGeometryMarkup(r)})}n.callback&&dojo.isFunction(n.callback)&&n.callback(i),o.app.event("BufferingCompletedEvent").publish(i)}var o=this,e=i.geometry||i.geometries;if(dojo.isArray(e)){if(e.length<1)return void this._reportBufferingError(this._generateErrorObjFromString(this.app.getResource(this.libraryId,"language-buffer-error-invalid-results"),n.sourceCommand,n.bufferId),n.errback);if(1===e.length)return void t(e[0]);f.unionGeometries(e,this.app).then(function(e){i.geometry=e,t(e)},function(e){o._reportBufferingError(o._generateErrorObjFromString(o.app.getResource(o.libraryId,"language-buffer-error-union-operation"),n.sourceCommand,n.bufferId),n.errback)})}else t(e)},m.prototype._setCmdBufferStatusAndRaiseEvent=function(e,r){function t(e){var t=i.targetCommandSettings[e];t?t.isActive=r:t=i._createEntryForTargetCommand(e,null,null,!0),i._updateTargetCommandToolStatusMessages(e,t)}var i=this;if("string"==typeof e)t(e);else{if(!e.length)return;e.forEach(function(e){return t(e)})}r?this.app.event("BufferingActivatedEvent").publish(e):this.app.event("BufferingDeactivatedEvent").publish(e)},m.prototype._retrieveGeometries=function(e){var t=[],r=[];e instanceof c.FeatureSet&&r.push(e),e instanceof l.FeatureSetCollection&&(r=e.featureSets.get());for(var i=0,n=r;i<n.length;i++)for(var o=n[i],a=0;a<o.features.length();a++){var s=o.features.getAt(a),u=s.esriFeature.get()?s.esriFeature.get().geometry:null;u&&f.isValidGeometry(u)&&t.push(u)}return t},m.prototype._showBufferOptionsAndExecuteBufferGeometry=function(e,t){this._showBufferOptionsAndExecuteBufferGeometries(e,[t])},m.prototype._showBufferOptionsAndExecuteBufferGeometries=function(r,i){var n=this,e={targetCommand:r,delegateFunction:function(e){var t={};t.geometries=i,t.callback=function(e){return n._performIdentifyForGeometry(e,!0)},t.sourceCommand=r,t.unionResults=!0,n.executeActivateBuffering(r),n.executeBufferGeometries(t),n.app.command("DeactivateBufferingAndDismissOptions").execute(r)}};this.app.command("DisplayBufferOptions").execute(e)},m.prototype._performIdentifyForGeometry=function(e,t){var r=this;void 0===t&&(t=!1);var i=e.geometry||(e.geometries&&1===e.geometries.length?e.geometries[0]:null);if(i){var n={};n.geometry=i,n.source="Identify",n.layerRestriction=function(e){return e.identifiable},n.doNotBuffer=t,o.runWhenIdle(function(){r.app.command("Identify").execute(n)})}},m.prototype._generateErrorObjFromString=function(e,t,r){var i={};return i.sourceCommand=t,i.error=new Error(e),n.isNullOrUndefined(r)||(i.bufferId=r),i},m.prototype._reportBufferingError=function(e,t){this.app.event("BufferingErrorEvent").publish(e),t&&dojo.isFunction(t)&&t(e)},m.prototype._updateTargetCommandToolStatusMessages=function(e,i){var n=this,t=this._getToolsByCommand(e);if(t&&t.length){var o=function(e){if(e.isActive){var t={id:e.name+"StatusMessageView",text:e.statusText,closeButton:{}};n.app.command("DisplayNotification").execute(t)}},r=function(e){e.originalStatusText&&(e.statusText=e.originalStatusText,delete e.originalStatusText,o(e))},a=function(e){i.isActive&&null!=i.bufferDistance&&i.bufferUnit?function(e){e.originalStatusText||(e.originalStatusText=e.statusText);var t=s.getUnitDescFromConfig(i.bufferUnit).displayName,r=n.app.getResource(n.libraryId,"language-buffer-active-tool-addon-message").format(i.bufferDistance,t);e.statusText="{0} {1}".format(e.originalStatusText,r),o(e)}(e):r(e)};t.forEach(function(e){return a(e)})}},m.prototype._getToolsByCommand=function(e){var t=[],r=this.app.toolRegistry.tools;for(var i in r){if(!r.hasOwnProperty(i))return;var n=r[i];n.command===e&&t.push(n)}return t},m.prototype._addGeometryMarkup=function(e){var t,r=new esri.Graphic;return r.setGeometry(e),"polygon"===r.geometry.type||"extent"===r.geometry.type?((t=a.defaultFillSymbol()).setColor(this._fillColor),t.color.a=.3,t.outline.setColor(this._lineColor)):"polyline"===r.geometry.type?(t=a.defaultLineSymbol()).setColor(this._lineColor):(t=a.defaultMarkerSymbol()).setColor(this._lineColor),r.setSymbol(t),u.getInternalGraphicsLayer(this._bufferLayerId,this.app,u.GraphicsLayerType.Markup)&&u.addGraphicToLayer(r,this._bufferLayerId,this.app),r},m.prototype._removeGeometryMarkup=function(e){var t=this.app.map.getLayer(this._bufferLayerId);t&&e&&t.remove(e)},m.prototype._addBufferingStatusMsg=function(r){if(r){var e=setTimeout(dojo.hitch(this,function(){var e=this.app.getResource(this.libraryId,"language-buffer-status-msg"),t=new p.AddStatusArgs(e);t.id=r,t.showBusyIcon=!0,t.timeoutMS=0,this.app.command("AddStatus").execute(t)}),this.BUFFERING_STATUS_DISPLAY_DELAY);this._statusMsgTimers[r]=e}},m.prototype._removeBufferingStatusMsg=function(e){if(e){var t=this._statusMsgTimers[e];t&&(clearTimeout(t),this.app.command("RemoveStatus").execute(e),delete this._statusMsgTimers[e])}},m);function m(){var e=null!==d&&d.apply(this,arguments)||this;return e.targetCommandSettings={},e._bufferWkid=-1,e._bufferSpatialReference=null,e._geodesic=!0,e._extentExpansionFactor=1.25,e._statusMsgTimers={},e.DEFAULT_NUM_FEATURES_WARNING_THRESHOLD=250,e.BUFFERING_STATUS_DISPLAY_DELAY=300,e}t.BufferModule=g})},"Mapping/modules/Buffer/BufferOptionsView":function(){var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=r.ViewBase,a(o,i),o.prototype.attach=function(e){if(this.configuration&&this.configuration.targetCommands&&this.configuration.targetCommands.length){(this.masterViewModel=e).registerView(this.id,this.configuration.targetCommands);var t=e.getViewModelForView(this.id);t&&(i.prototype.attach.call(this,t),this.registerCommands())}else this.app.trace.error(this.app.getResource(this.libraryId,"language-buffer-target-modules-error"))},o.prototype.registerCommands=function(){this.app.command("DisplayBufferOptions").register(this,this.executeDisplayBufferOptions,this.canExecuteDisplayBufferOptions),this.app.command("ActivateBufferingAndDisplayOptions").register(this,this.executeActivateBufferingAndDisplayOptions,this.canExecuteDisplayBufferOptions),this.app.command("DeactivateBufferingAndDismissOptions").register(this,this.executeDeactivateBufferingAndDismissOptions,this.canExecuteDisplayBufferOptions)},o.prototype.executeDisplayBufferOptions=function(e){var t="string"==typeof e?e:e.targetCommand,r="string"==typeof e?null:e.delegateFunction;r&&dojo.isFunction(r)&&(this._oneTimeCommandDelegateParams={},this._oneTimeCommandDelegateParams.delegateFunction=r,this._oneTimeCommandDelegateParams.targetCommand=t),this._currentTargetCommands.push(t),this.app.viewManager.activateView(this)},o.prototype.executeActivateBufferingAndDisplayOptions=function(e){var t="string"==typeof e?e:e.targetCommand;this.canExecuteDisplayBufferOptions(t)&&(this.app.command("ActivateBuffering").execute(t),this.app.command("DisplayBufferOptions").execute(e))},o.prototype.executeDeactivateBufferingAndDismissOptions=function(e,t){void 0===t&&(t=!1);var r="string"==typeof e?e:e.targetCommand;this.canExecuteDisplayBufferOptions(r)&&(this.app.command("DeactivateBuffering").execute(r),this.dismissBufferOptions(r,t))},o.prototype.canExecuteDisplayBufferOptions=function(e){if(!e)return!1;var t="string"==typeof e?e:e.targetCommand;return!!t&&this.canDisplayOptionsForTargetCommand(t)},o.prototype.canDisplayOptionsForTargetCommand=function(e){var t=this.viewModel.targetCommands;return!(!t||!t.length)&&-1<t.indexOf(e)},o.prototype.validateAndApplyInput=function(){this.masterViewModel.validateAndProcessInput(this.id)},o.prototype.handleContinueButtonClick=function(){this.masterViewModel.validateAndProcessInput(this.id)&&(this._executeOneTimeCommandDelegate(),this.dismissBufferOptions())},o.prototype.handleCancelButtonClick=function(){this._oneTimeCommandDelegateParams&&(this._oneTimeCommandDelegateParams=null);var e=this._currentTargetCommands.length?this._currentTargetCommands[this._currentTargetCommands.length-1]:null;e&&this.executeDeactivateBufferingAndDismissOptions(e,!0)},o.prototype.handleClearButtonClick=function(){this.viewModel.bufferingError.set(""),this.viewModel.bufferDistance.set(null),this.masterViewModel._raiseChangedBufferDistanceEvent(this.viewModel)},o.prototype.dismissBufferOptions=function(e,t){if(void 0===t&&(t=!1),e){var r=this._currentTargetCommands.indexOf(e);-1<r&&this._currentTargetCommands.splice(r,1)}if(0===this._currentTargetCommands.length&&this.isActive&&(this.app.configuration.mobileMode?this.app.viewManager.deactivateView(this.hostView):this.app.viewManager.deactivateView(this)),!t){var i=this.viewModel.targetCommands;if(i&&i.length){var n=this.masterViewModel.generateBufferDistanceChangedEventArgs(this.viewModel);this.app.event("BufferOptionsDismissedEvent").publish(n)}}},o.prototype._executeOneTimeCommandDelegate=function(){if(this._oneTimeCommandDelegateParams&&dojo.isFunction(this._oneTimeCommandDelegateParams.delegateFunction)){var e=this.masterViewModel.generateBufferDistanceChangedEventArgs(this.viewModel,[this._oneTimeCommandDelegateParams.targetCommand]);this._oneTimeCommandDelegateParams.delegateFunction(e),this._oneTimeCommandDelegateParams=null}},o);function o(){var e=null!==i&&i.apply(this,arguments)||this;return e._currentTargetCommands=[],e}t.BufferOptionsView=n})},"Mapping/modules/Buffer/BufferOptionsViewModel":function(){var i,f=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/observables","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/buffer/BufferUtils"],function(e,t,i,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,s=(a=r.ViewModelBase,f(u,a),u.prototype.initialize=function(e){a.prototype.initialize.call(this,e),this._setBufferUnits(e.bufferUnits),this._setDefaultBufferUnit(e.defaultBufferUnit),this.DEFAULT_BUFFER_DISTANCE=isNaN(parseInt(e.defaultBufferDistance,10))?0:parseInt(e.defaultBufferDistance,10),this._addBufferToMarkupLayerByDefault=!!e.addBufferToMarkupLayerByDefault,this.bufferUnits.length()&&this.DEFAULT_BUFFER_UNIT?this.subscribeEvents():this.app.trace.error(this.app.getResource(this.libraryId,"language-buffer-config-units-error"))},u.prototype.subscribeEvents=function(){this.app.event("BufferingErrorEvent").subscribe(this,this.handleBufferingErrorEvent)},u.prototype.registerView=function(t,e){if(!t||!e||!e.length)return!1;if(this.childViewModels.filter(function(e){return e.viewId===t}).length)return!1;var r={};r.viewId=t,r.bufferUnits=this.bufferUnits,r.targetCommands=e.slice(0),r.bufferDistance=new i.Observable(this.DEFAULT_BUFFER_DISTANCE?this.DEFAULT_BUFFER_DISTANCE:null),r.selectedBufferUnit=new i.Observable(this.DEFAULT_BUFFER_UNIT.config),r.inputError=new i.Observable(""),r.bufferingError=new i.Observable(""),r.writeToMarkupLayer=new i.Observable(this._addBufferToMarkupLayerByDefault),this.childViewModels.push(r)},u.prototype.validateAndProcessInput=function(e){var t=this.getViewModelForView(e);if(!t){var r=this.app.getResource(this.libraryId,"language-buffer-error-input-validation").format(e);return this.app.trace.error(r),t.bufferingError.set(r),!1}var i="number"==typeof t.bufferDistance.get()?t.bufferDistance.get():t.bufferDistance.get()?n.parseNumber(t.bufferDistance.get()):null;return null===i||isNaN(i)?(t.inputError.set(this.app.getResource(this.libraryId,"language-buffer-invalid-distance")),!1):(t.inputError.set(""),t.bufferingError.set(""),t.bufferDistance.set(n.formatNumber(i)),this._raiseChangedBufferDistanceEvent(t),!0)},u.prototype.getViewModelForView=function(t){var e=this.childViewModels.filter(function(e){return e.viewId===t});return e.length?(1<e.length&&this.app.trace.warning("Multiple child view models registered for view with id {0}. Please check your configuration. Using first instance of view model.".format(t)),e[0]):(this.app.trace.error("BufferOptionsViewModel: Could not find child view model for view with id {0}".format(t)),null)},u.prototype.getViewModelForCommand=function(t){var e=this.childViewModels.filter(function(e){return-1<e.targetCommands.indexOf(t)});return e.length?e[0]:null},u.prototype.handleBufferingErrorEvent=function(e){if(e&&e.sourceCommand){var t=this.getViewModelForCommand(e.sourceCommand);if(t){var r=e&&e.error?e.error.message||e.error.name:"",i=e.error.details;i&&i.length&&(r=r.concat(" ",i.join(" "))),r=r?this.app.getResource(this.libraryId,"language-buffer-operation-error").format(r):this.app.getResource(this.libraryId,"language-buffer-error-details-unavailable"),t.bufferingError.set(r);var n=this.app.viewManager.getViewById(t.viewId);this.app.viewManager.activateView(n)}}},u.prototype.generateBufferDistanceChangedEventArgs=function(e,t){var r={};return r.distance=n.parseNumber(e.bufferDistance.get()),r.unit=o.getUnitDescFromConfig(e.selectedBufferUnit.get()),r.writeToMarkupLayer=e.writeToMarkupLayer.get(),r.targetCommands=t&&t.length?t:e.targetCommands.slice(0),r},u.prototype._raiseChangedBufferDistanceEvent=function(e){var t=this.generateBufferDistanceChangedEventArgs(e);this.app.event("BufferDistanceChangedEvent").publish(t)},u.prototype._getSupportedBufferUnitLanguageResources=function(){for(var e in o.SUPPORTED_BUFFER_UNITS)o.SUPPORTED_BUFFER_UNITS.hasOwnProperty(e)&&(o.SUPPORTED_BUFFER_UNITS[e]={displayName:this.app.getResource(this.libraryId,"language-buffer-unit-"+e.toLowerCase()+"-display-name"),config:e})},u.prototype._setBufferUnits=function(e){var r=this;e&&e.length&&e.forEach(function(e){var t=o.SUPPORTED_BUFFER_UNITS[e];t?r.bufferUnits.addItem(t):r.app.trace.warning(r.app.getResource(r.libraryId,"language-buffer-invalid-unit-warning").format(e))})},u.prototype._setDefaultBufferUnit=function(e){var t;if(e&&(t=o.SUPPORTED_BUFFER_UNITS[e]),!t){if(!this.bufferUnits.length())return void this.app.trace.warning(this.app.getResource(this.libraryId,"language-buffer-invalid-unit-warning").format(e));t=this.bufferUnits.getAt(0)}this.DEFAULT_BUFFER_UNIT=t},u);function u(e,t){var r=a.call(this,e,t)||this;return r.childViewModels=[],r.bufferUnits=new i.ObservableCollection([]),r._addBufferToMarkupLayerByDefault=!1,r._getSupportedBufferUnitLanguageResources(),r}t.BufferOptionsViewModel=s})},"url:/Mapping/modules/Buffer/BufferOptionsView.html":t}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Buffer/CSS/common.css","css","LmJ1ZmZlci1vcHRpb25zIHsNCiAgICBwYWRkaW5nOiAxZW07DQp9DQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J10gew0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQp9"),e.resourceManager.register("Mapping","inv","Mapping/modules/Buffer/BufferOptionsView.html","html",t)}),require({cache:{}}),define(["Mapping/modules/Buffer/BufferModule","Mapping/modules/Buffer/BufferOptionsView","Mapping/modules/Buffer/BufferOptionsViewModel"],function(e,t,r){i(e,"geocortex.essentialsHtmlViewer.mapping.modules.buffer.BufferModule",e.BufferModule),i(t,"geocortex.essentialsHtmlViewer.mapping.modules.buffer.BufferOptionsView",t.BufferOptionsView),i(r,"geocortex.essentialsHtmlViewer.mapping.modules.buffer.BufferOptionsViewModel",r.BufferOptionsViewModel)})}();