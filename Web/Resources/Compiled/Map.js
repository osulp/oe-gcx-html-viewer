!function(){var t="<div class='region map-context-menu-region' data-region-name='MapContextMenuContentRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter'></div>",i="<div class='map-menu-coordinates' data-binding='{@visible: showCoordinates}'>    <div tabindex='0'><strong data-binding='{@text: xType}'></strong> <span data-binding='{@text: xValue}'></span></div>    <div tabindex='0'><strong data-binding='{@visible: yValue}{@text: yType}'></strong> <span data-binding='{@text: yValue}'></span></div></div>",a="<div data-binding='{@widget: MapContextMenuWidget}{@widget-required: true}{@widget-context: mapPoint}{@visible: showMenu}' data-menu-id='MapContextMenu' data-menu-hoist-disabled data-menu-type='geocortex.essentialsHtmlViewer.mapping.modules.map.MapMenuView'></div>",o="<div class='map-menu-reverse-geocode' tabindex='0' data-binding='{@visible: showReverseGeocoder}'>    <strong data-binding='{@text: label}'></strong> <span data-binding='{@text: address}'></span>    \x3c!-- Used to mitigate the movement of the menu when the address result is populated --\x3e    <p data-binding='{@visible: isSearching}'></p></div>",n="<div class='region map-region' data-region-name='MapRegion'></div>",r="<div class='map-error' aria-label='map error' data-binding='{@hidden: showMap}' role='form'>    <div data-binding='{@visible: showError}'>        <h2 data-binding='{@text: @language-map-site-initialization-failed}'>\x3c!-- The site failed to initialize. --\x3e</h2>        <p data-binding='{@text: @language-common-debug-log-keys}'>\x3c!-- The site failed to initialize. --\x3e</p>    </div>    <div data-binding='{@visible: showAuthError}'>        <h2 data-binding='{@text: @language-map-site-authorization-failed}'>\x3c!-- The site authorization failed. --\x3e</h2>        <p data-binding='{@text: @language-map-site-authorization-failed-message}'>\x3c!-- The site failed to initialize. --\x3e</p>    </div>    <div data-binding='{@visible: showCriticalServicesError}'>        <h2 data-binding='{@text: @language-map-site-critical-services-failed}'>\x3c!-- Critical services failed. --\x3e</h2>        <p data-binding='{@text: @language-map-site-critical-services-failed-message}'>\x3c!-- Critical services failed. --\x3e</p>    </div></div><div id='map-container' style='height: 100%; width: 100%' data-binding='{@visible: showMap}{@var: mapContainer}'>    \x3c!-- MAP --\x3e    <div id='map' class='map needsclick' data-binding='{@var: mapDiv}'></div>    \x3c!-- MAP REGIONS --\x3e    <div class='region map-top-top-left' aria-label='top top left map region' data-region-name='TopTopLeftMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-top' aria-label='top map region' data-region-name='TopMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-center-region' aria-label='center map region' data-region-name='CenterRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-top-left' aria-label='top left map region' data-region-name='TopLeftMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-navigation-region' aria-label='navigation region' data-region-name='NavigationMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='navigation'></div>    <div class='region map-top-center' aria-label='top center map region' data-region-name='TopCenterMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-top-right' aria-label='top right map region' data-region-name='TopRightMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-basemap-region' aria-label='basemap map region' data-region-name='BasemapMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-middle-right' aria-label='middle right map region' data-region-name='MiddleRightMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-bottom-right' aria-label='bottom right map region' data-region-name='BottomRightMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-bottom-center' aria-label='bottom center map region' data-region-name='BottomCenterMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-bottom-left' aria-label='bottom left map region' data-region-name='BottomLeftMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-middle-left' aria-label='middle left map region' data-region-name='MiddleLeftMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false' role='complementary'></div>    <div class='region map-background' data-region-name='BackgroundMapRegion' data-region-adapter='geocortex.framework.ui.DivStackRegionAdapter' data-region-options='activateViewsInLastPosition=false'></div></div>";function m(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var a=t.split("."),o=null,n=window,r=0,s=a.length;r<s;r++)o=a[r],r==s-1?n[o]=i:n[o]||(n[o]={}),n=n[o];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Map/CenterSharingLinkProvider":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/sharing/SharingLinkProviderBase","geocortex/infrastructure/MapUtils"],function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=a.SharingLinkProviderBase,s(r,n),r.prototype.generate=function(){if(!this.app.map.extent)return"";var e=this.app.map.extent.getCenter();return"{1}{0}{2}".format(this._separator,e.x,e.y)},r.prototype.apply=function(e){var t=this;if(e){var i=e.split(this._separator);2<=i.length?this.app.waitUntilShellStabilized().then(function(){t._applyCenter(i)}):this.app.trace.warning("Unable to parse the center parameter {0}: expected two comma separated number values.".format(e))}},r.prototype._applyCenter=function(e){for(var t=0;t<e.length;t++)if(isNaN(parseFloat(e[t])))return void this.app.trace.warning("Unable to parse the center parameter value '{0}': invalid number value.".format(e[t]));var i=new esri.geometry.Point(parseFloat(e[0]),parseFloat(e[1]));3<=e.length&&!isNaN(parseInt(e[2]))?i.spatialReference=new esri.SpatialReference(parseInt(e[2])):this.app.map&&this.app.map.spatialReference&&(i.spatialReference=this.app.map.spatialReference),o.panToPointWithPriority(this.app,i,7,!0)},r);function r(e,t){var i=n.call(this,e,t)||this;return i._separator=",",i.name="center",i.priority=a.ExtentLinkPriority.CENTER,i}t.CenterSharingLinkProvider=i})},"Mapping/modules/Map/ExtentSharingLinkProvider":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/sharing/SharingLinkProviderBase","geocortex/infrastructure/MapUtils"],function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=a.SharingLinkProviderBase,s(r,n),r.prototype.generate=function(){if(!this.app.map.extent)return"";var e=this.app.map.extent;return"{1}{0}{2}{0}{3}{0}{4}".format(this._separator,e.xmin,e.ymin,e.xmax,e.ymax)},r.prototype.apply=function(e){var t=this;if(e){var i=e.split(this._separator);4<=i.length?this.app.waitUntilShellStabilized().then(function(){t._applyExtent(i)}):this.app.trace.warning("Unable to parse the extent parameter '{0}': expected four comma separated number values.".format(e))}},r.prototype._applyExtent=function(e){for(var t=0;t<e.length;t++)if(isNaN(parseFloat(e[t])))return void this.app.trace.warning("Unable to parse the extent parameter value '{0}': invalid number value.".format(e[t]));var i=new esri.geometry.Extent(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),new esri.SpatialReference(4326));5<=e.length&&!isNaN(parseInt(e[4]))?i.setSpatialReference(new esri.SpatialReference(parseInt(e[4]))):this.app.map&&this.app.map.spatialReference&&i.setSpatialReference(this.app.map.spatialReference),o.zoomToExtentWithPriority(this.app,i,7,!0)},r);function r(e,t){var i=n.call(this,e,t)||this;return i._separator=",",i.name="extent",i.priority=a.ExtentLinkPriority.EXTENT,i}t.ExtentSharingLinkProvider=i})},"Mapping/modules/Map/MapCoordinatesController":function(){var a,p=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/FrameworkObject","geocortex/infrastructure/coordinates/CoordinateSystem","geocortex/infrastructure/buffer/BufferUtils","geocortex/infrastructure/GeometryUtils"],function(e,t,i,a,c,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=(s=i.FrameworkObject,p(n,s),n.prototype.initializeCoordinateDataModel=function(e){var t=this;if(e){this._dataModel=e;var i=function(){t._processCoordinatesDataModel(),t._disabled||t.app.coordinatesManager.registerModel(t._dataModel,!0)};this.app.map&&this.app.map.loaded?i():this.app.event("MapLoadedEvent").once(this,i)}},n.prototype._processCoordinatesDataModel=function(){var s=this;if(this._dataModel){var e=this._dataModel.configuration,p=!1,r=function(e,t,i,a){var o="mgrs"===(t=t.trim().toLowerCase())||"usng"===t;if(t&&"latlon"===t&&(t="dd"),!o||s._skipGeometryServiceVersionCheck||s._geometryServiceAgsVer&&!(s._geometryServiceAgsVer&&s._geometryServiceAgsVer<10.3))if(e&&t&&0<=s._supportedDisplayTypeConfig.indexOf(t)&&(i||a||o)){var n={};if(n.displayName=e.trim(),n.output=t,i){if(n.wkid=i,"xy"!==t&&!c.isGeographicWkid(i))return void s.app.trace.error("Could not add coordinate system {0}. This coordinate system uses a geographic output type. Please configure a valid WKID for a geographic coordinate system.".format(e))}else a&&(n.wkt=a);s._dataModel.coordinateSystems.addItem(n)}else s.app.trace.error("Could not add coordinate system {0} due to a configuration error. Please check your configuration settings.".format(e));else if(!p){var r="GeoCoordinate strings are only available with ArcGIS Server 10.3 or above. ";r+=null===s._geometryServiceAgsVer?"Could not determine current geometry service version. Check your proxy settings maybe? ":"Current version is {0}. ".format(s._geometryServiceAgsVer),r+="Disabling all geo coordinate systems.",s.app.trace.error(r),p=!0}};e.defaultGcsWkid&&!isNaN(parseInt(e.defaultGcsWkid,10))&&(this._dataModel.defaultGcsWkid=parseInt(e.defaultGcsWkid,10)),e.defaultCoordinateDisplayTypes&&e.defaultCoordinateDisplayTypes.length&&e.defaultCoordinateDisplayTypes.forEach(function(e){var t=e.toLowerCase().trim(),i=s._dataModel.defaultGcsWkid,a=s.getResource("language-map-coordinates-{0}".format(t.toUpperCase())),o=s.getResource("language-map-coordinates-WKID")+": "+i,n="";"xy"===t&&(i=s.app.map.spatialReference.wkid,n=s.getResource("language-map-coordinates-default-coordinate-system-label"),o=i?s.getResource("language-map-coordinates-WKID")+": "+i:s.getResource("language-map-coordinates-WKT")),r(n+" "+o+" "+a,t,i,s.app.map.spatialReference.wkt)}),e.customCoordinateSystems&&e.customCoordinateSystems.length&&e.customCoordinateSystems.forEach(function(e){return r(e.displayName,e.output,e.wkid,e.wkt)}),0!==this._dataModel.coordinateSystems.length()?(e.fractionalDigits&&!isNaN(parseInt(e.fractionalDigits,10))&&(this._dataModel.fractionalDigits=parseInt(e.fractionalDigits,10)),this._dataModel.currentCoordinateSystem.set(this._dataModel.coordinateSystems.getAt(0)),e.disableMouseLocationMonitoring||this._dataModel.isActive.bind(this,this._logCoordinates)):this._disabled=!0}},n.prototype._logCoordinates=function(e){var i=this;this._disabled||(this._mouseMoveToken&&(this._mouseMoveToken.remove(),this._mouseMoveToken=null),this._keyboardMoveToken&&(this.app.event("EditVertexMovedEvent").unsubscribe(this._keyboardMoveToken),this._keyboardMoveToken=null),e&&(this._keyboardMoveToken=this.app.event("EditVertexMovedEvent").subscribe(this,function(e){e.mapPoint&&i._dataModel.inputStream.set(e.mapPoint)}),this._mouseMoveToken=this.app.map.on("mouse-move",function(t){i.app.map.snappingManager?i.app.map.snappingManager.getSnappingPoint(t.screenPoint).then(function(e){e?i._dataModel.inputStream.set(e):i._dataModel.inputStream.set(t.mapPoint)},function(e){i._dataModel.inputStream.set(t.mapPoint)}):i._dataModel.inputStream.set(t.mapPoint)})))},n.prototype._handleCoordinateModelError=function(e){this.app.trace.error("MapCoordinatesController: An error occurred while trying to retrieve the coordinatesModel {0}. Details of the error are: {1}".format(this.mapCoordinateDataModelId||"<unknown>",e.message))},n);function n(o,e,t){var n=s.call(this,o,e)||this;return n._skipGeometryServiceVersionCheck=!1,n._disabled=!1,n._geometryServiceAgsVer=null,n._supportedDisplayTypeConfig=[a.CoordinateSystemType.DD,a.CoordinateSystemType.DDM,a.CoordinateSystemType.DMS,a.CoordinateSystemType.XY,a.CoordinateSystemType.MGRS,a.CoordinateSystemType.USNG],n.mapCoordinateDataModelId=t,n.app.waitUntilSiteInitialized().then(function(){return n.app.coordinatesManager.getCoordinatesModel(n.mapCoordinateDataModelId).then(function(t){var e=!1;if(t.configuration){n._skipGeometryServiceVersionCheck=!!t.configuration.skipGeometryServiceVersionCheck;var i=t.configuration.customCoordinateSystems||[],a=t.configuration.defaultCoordinateDisplayTypes||[];e=(e=i.some(function(e){return"mgrs"===e.output||"usng"===e.output}))||a.some(function(e){return"mgrs"===e||"usng"===e})}e&&!n._skipGeometryServiceVersionCheck?r.getGeometryServiceArcGisVersion(o).then(function(e){n._geometryServiceAgsVer=e,n.initializeCoordinateDataModel(t)}):n.initializeCoordinateDataModel(t)},function(e){return n._handleCoordinateModelError(e)})}),n}t.MapCoordinatesController=o})},"Mapping/modules/Map/MapExtentLog":function(){define(["require","exports","geocortex/infrastructure/MapUtils","geocortex/essentials/GeometryUtilities","geocortex/framework/utils/utils"],function(e,t,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(r.prototype._onMapLoaded=function(){this.app.event("MapLoadedEvent").unsubscribe(this._mapLoadedEventToken),this.app.map.on("extent-change",dojo.hitch(this,this._recordExtentChange)),this.app.map.on("resize",dojo.hitch(this,this._onMapResized)),this._initialExtent=this.app.map.extent,this._registerCommands()},r.prototype._onMapResized=function(){this._pauseRecordExtentChangeOperation()},r.prototype._registerCommands=function(){this.app.command("ZoomToPreviousExtent").register(this,this._executeZoomToPreviousExtent,this._canExecuteZoomToPreviousExtent),this.app.command("ZoomToNextExtent").register(this,this._executeZoomToNextExtent,this._canExecuteZoomToNextExtent)},r.prototype._canExecuteZoomToPreviousExtent=function(){return!this._prevNextExtentCommandInProgress&&0!==this._previousExtentArray.length},r.prototype._canExecuteZoomToNextExtent=function(){return!this._prevNextExtentCommandInProgress&&0!==this._nextExtentArray.length},r.prototype._executeZoomToPreviousExtent=function(){if(this._previousExtentArray.length){var e=this._previousExtentArray.pop();this._prevNextExtentCommandInProgress=!0,this._addExtentConditionally(this._nextExtentArray,this._currentExtent),this._currentExtent=e,i.zoomToExtent(this.app,this._currentExtent,!0),this._zoomToPrevNextExtentCanExecuteChanged()}},r.prototype._executeZoomToNextExtent=function(){if(this._nextExtentArray.length){var e=this._nextExtentArray.pop();this._prevNextExtentCommandInProgress=!0,this._addExtentConditionally(this._previousExtentArray,this._currentExtent),this._currentExtent=e,i.zoomToExtent(this.app,this._currentExtent,!0),this._zoomToPrevNextExtentCanExecuteChanged()}},r.prototype._recordExtentChange=function(e){this._pauseRecordExtentChange||this._prevNextExtentCommandInProgress||(this._currentExtent&&this._addExtentConditionally(this._previousExtentArray,this._currentExtent),this._nextExtentArray=[]),this._currentExtent=e.extent,this._pauseRecordExtentChangeOperation(this._extentChangeRecordDelayMs),this._prevNextExtentCommandInProgress=!1,this._zoomToPrevNextExtentCanExecuteChanged()},r.prototype._numLogEntries=function(){return this._previousExtentArray.length+this._nextExtentArray.length},r.prototype._addExtentConditionally=function(e,t){var i=this._numLogEntries();this._isValidExtentObject(t)?(i>=this._maxLogEntries&&e.length&&e.shift(),this._extentsEqual(e[e.length-1]||this._initialExtent,t)||e.push(new esri.geometry.Extent(t.toJson()))):this.app.trace.error("MapExtentLog: Invalid extent specified. Could not add to extent log")},r.prototype._pauseRecordExtentChangeOperation=function(e){var t=this;this._disableExtentChangeTimeoutId&&(clearTimeout(this._disableExtentChangeTimeoutId),this._disableExtentChangeTimeoutId=null),this._pauseRecordExtentChange=!0,o.isNullOrUndefined(e)||(this._disableExtentChangeTimeoutId=setTimeout(function(){t._pauseRecordExtentChange=!1},e))},r.prototype._extentsEqual=function(e,t){return e&&t&&e.spatialReference&&t.spatialReference&&e.xmin===t.xmin&&e.xmax===t.xmax&&e.ymin===t.ymin&&e.ymax===t.ymax&&a.spatialRefsAreEqual(e.spatialReference,t.spatialReference,!1)},r.prototype._isValidExtentObject=function(e){return!!(e&&e instanceof esri.geometry.Extent)||e&&"number"==typeof parseFloat(e.xmin)&&"number"==typeof parseFloat(e.xmax)&&"number"==typeof parseFloat(e.ymin)&&"number"==typeof parseFloat(e.ymax)&&e.spatialReference&&(e.spatialReference.wkid&&"number"==typeof parseInt(e.spatialReference.wkid,10)||e.spatialReference.wkt)},r.prototype._zoomToPrevNextExtentCanExecuteChanged=function(){this.app.command("ZoomToPreviousExtent").raiseCanExecuteChanged(),this.app.command("ZoomToNextExtent").raiseCanExecuteChanged()},r);function r(e,t,i){this._mapLoadedEventToken=null,this._previousExtentArray=[],this._nextExtentArray=[],this._currentExtent=null,this._pauseRecordExtentChange=!1,this._prevNextExtentCommandInProgress=!1,this._disableExtentChangeTimeoutId=null,this._maxLogEntries=100,this._extentChangeRecordDelayMs=500,this.app=e,this.libraryId=t,this._maxLogEntries=o.isNullOrUndefined(i)?this._maxLogEntries:i,this._maxLogEntries&&(this._mapLoadedEventToken=this.app.event("MapLoadedEvent").subscribe(this,this._onMapLoaded))}t.MapExtentLog=n})},"Mapping/modules/Map/MapHostView":function(){var a,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=(a=i.ViewBase,r(n,a),n.prototype.attach=function(){this.app.event("ViewActivatedEvent").subscribe(this,this._activateMapHost),this.app.event("ViewDeactivatedEvent").subscribe(this,this._deactivateMapHost)},n.prototype._activateMapHost=function(e){"MapView"==e.id&&(this.app.command("ActivateView").execute(this.id),this.app.command("MapResize").execute())},n.prototype._deactivateMapHost=function(e){"MapView"==e.id&&this.app.command("DeactivateView").execute(this.id)},n);function n(){return null!==a&&a.apply(this,arguments)||this}t.MapHostView=o})},"Mapping/modules/Map/MapModule":function(){var a,_=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/application/ModuleBase","./MapExtentLog","./MapCoordinatesController","geocortex/infrastructure/ArrayUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/PromiseUtils","geocortex/infrastructure/commandArgs/ProjectArgs","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/FocusUtils","geocortex/framework/utils/ArrayUtils"],function(e,t,i,r,a,o,s,p,l,u,d,h,n,c,m,g,v,f,y,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var M,x=(M=i.ModuleBase,_(C,M),C.prototype.initialize=function(e){var t=this;if(M.prototype.initialize.call(this,e),(e=e||{})&&e.menus&&this.app.menuRegistry.loadMenus(e),b.firstOrDefault(this.app.configModel.moduleConfigs,function(e){return"LayerList"===e.moduleName})||this.app.waitUntilApplicationReady().then(function(){return t.app.site.essentialsMap.enableUnsuspendedMapLayers()}),e.hasOwnProperty("showLoadingStatus")||(e.showLoadingStatus=!0),e.hasOwnProperty("loadingMessageTiming")&&e.loadingMessageTiming.length||(e.loadingMessageTiming=[1e3,3e3,3e3]),e.hasOwnProperty("defaultPointFeatureZoomScales")&&e.defaultPointFeatureZoomScales.length||(e.defaultPointFeatureZoomScales=[]),e.hasOwnProperty("panDuration")){var i=parseInt(e.panDuration,10);isNaN(i)||(esri.config.defaults.map.panDuration=i)}if(e.hasOwnProperty("panRate")){var a=parseInt(e.panRate,10);isNaN(a)||(esri.config.defaults.map.panRate=a)}if(e.hasOwnProperty("zoomDuration")){var o=parseInt(e.zoomDuration,10);isNaN(o)||(esri.config.defaults.map.zoomDuration=o)}if(e.hasOwnProperty("zoomRate")){var n=parseInt(e.zoomRate,10);isNaN(n)||(esri.config.defaults.map.zoomRate=n)}this._initializeCoordinateModels(),e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),e.hasOwnProperty("showMapOnZoom")&&(this._showMapOnZoom=e.showMapOnZoom),e.hasOwnProperty("showMapOnPan")&&(this._showMapOnPan=e.showMapOnPan),e.hasOwnProperty("maxExtentLogSize")&&(this._maxLogEntries=isNaN(parseInt(e.maxExtentLogSize,10))?this._maxLogEntries:parseInt(e.maxExtentLogSize,10)),this._config=e,this._mapExtentLog=new r.MapExtentLog(this.app,this.libraryId,this._maxLogEntries),this.app.event("MapLoadedEvent").subscribe(this,this.subscribeToMapEvents),dojo.subscribe("FeatureClickedEvent",this,this.featureClickHandler),dojo.subscribe("geoRssLayerLoaded",this,this._onGeoRssLayerLoaded)},C.prototype.registerCommands=function(){this.app.command("ZoomToLayerVisibleScale").register(this,this._executeZoomToVisibleScale),this.app.command("ZoomToLayerExtent").register(this,this._executeZoomToLayerExtent),this.app.command("PanToAllFeatures").register(this,this._executePanToAllFeatures),this.app.command("PanToFeature").register(this,this._executePanToFeature,function(e){return e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry}),this.app.command("PanToFeatureIfOutsideMapExtent").register(this,this._executePanToFeatureIfOutsideMapExtent,function(e){return e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry}),this.app.command("PanToPoint").register(this,this._executePanToPoint),this.app.command("Project").register(this,this._executeProject),this.app.command("RecenterMapOnNextMapResize").register(this,this._executeRecenterMap),this.app.command("ZoomOutToExtent").register(this,this._executeZoomOutToExtent),this.app.command("ZoomToFeatures").register(this,this._executeZoomToFeatures),this.app.command("ZoomToFeatureSetCollection").register(this,this._executeZoomToFeatureSetCollection),this.app.command("ZoomToAllFeatures").register(this,this._executeZoomToAllFeatures),this.app.command("ZoomToExtent").register(this,this._executeZoomToExtent),this.app.command("ZoomToFeature").register(this,this._executeZoomToFeature,this._canExecuteZoomToFeature),this.app.command("ZoomToFeatureIfOutsideMapExtent").register(this,this._executeZoomToFeatureIfOutsideMapExtent,this._canExecuteZoomToFeature),this.app.command("ZoomToScale").register(this,this._executeZoomToScale),this.app.command("ZoomToNamedExtent").register(this,this._executeZoomToNamedExtent),this.app.command("ZoomToOfflineMapExtent").register(this,this._executeZoomToOfflineMapExtent),this.app.command("PanUp").register(this,this._executePanUp),this.app.command("PanDown").register(this,this._executePanDown),this.app.command("PanLeft").register(this,this._executePanLeft),this.app.command("PanRight").register(this,this._executePanRight),this.app.command("SetTimeExtent").register(this,this._executeSetTimeExtent),this.app.command("EnableMapClick").register(this,this._executeEnableMapClick),this.app.command("DisableMapClick").register(this,this._executeDisableMapClick),this.app.command("EnableMapOnNextClick").register(this,this._enableMapNextClick),this.app.command("FocusMap").register(this,this._focusMap)},C.prototype._focusMap=function(){y.focusOnMap(this.app.map)},C.prototype.getStateFilter=function(){return{serviceLayers:{item:this.app.project.filter.serviceLayer},graphicsLayers:{item:this.app.project.filter.operationalLayer}}},C.prototype.exportState=function(){var i=this;return Promise.try(function(){var e=o.ArrayUtils.mapWithErrorCallback(i.app.site.essentialsMap.mapServices,function(e){return i.app.project.convert.fromGcxMapService(e)},function(e,t){i.app.trace.warning('Unable to save map service "{0}" to project: {1}'.format(e.displayName,t))}),t=s.getGraphicsLayersExceptExcluded(i.app,[s.ExcludeFromEnum.ExportApplyStateName]);return t=t.filter(function(e){return e.id!==g.COORDINATES_LAYER_ID}),{serviceLayers:e,graphicsLayers:o.ArrayUtils.mapWithErrorCallback(t,function(e){return i.app.project.convert.fromEsriLayer(e)},function(e,t){i.app.trace.warning('Unable to save graphics layer "{0}" to project: {1}'.format(e.id,t))})}})},C.prototype.applyState=function(n){var r=this;return Promise.try(function(){r.app.site.essentialsMap.mapServices.filter(function(e){return e.isUserCreated}).forEach(function(e){r.app.site.essentialsMap.removeMapService(e)});var e=s.getInternalGraphicsLayer(g.MARKUP_LAYER_ID,r.app,s.GraphicsLayerType.Markup,!0);e&&e.clear();var t=s.getInternalGraphicsLayer(g.MEASUREMENT_LAYER_ID,r.app,s.GraphicsLayerType.Label);t&&t.clear(),r.app.event("MarkupClearedEvent").publish();var i=r.app.project.convert,a=p.PromiseUtils.mapSkipRejected(n.serviceLayers,function(e){return p.PromiseUtils.warnOnReject(i.toGcxMapService(e),r.app,'Unable to restore map service "{0}": {{0}}'.format(e.id))}).return(),o=p.PromiseUtils.mapSkipRejected(n.graphicsLayers,function(e){return p.PromiseUtils.warnOnReject(i.toEsriLayer(e),r.app,'Unable to restore graphics layer "{0}": {{0}}'.format(e.id))}).return();return Promise.join(a,o).then(function(){r._fixGraphicsLayersOrder(),r.app.command("ClearMarkup").raiseCanExecuteChanged(),r.app.command("ClearMarkupQuiet").raiseCanExecuteChanged(),r.app.command("EditMarkup").raiseCanExecuteChanged(),r.app.command("DeleteMarkup").raiseCanExecuteChanged()})})},C.prototype._fixGraphicsLayersOrder=function(){var a=this,e=[g.MARKUP_LAYER_ID,g.MEASUREMENT_LAYER_ID,g.COORDINATES_LAYER_ID].filter(function(e){return 0<=a.app.map.graphicsLayerIds.indexOf(e)});if(e.length){var o=Math.min.apply(null,e.map(function(e){return a.app.map.graphicsLayerIds.indexOf(e)}));e.forEach(function(e,t){var i=a.app.map.getLayer(e);a.app.map.reorderLayer(i,t+o)})}},C.prototype._androidSieve=function(e,t){var i=e.match(/Android (\d+(?:\.\d+)+)/);return null!==i&&t<=parseFloat(i[1])},C.prototype._executeEnableMapClick=function(){this._executeMapClickCommands=!0},C.prototype._executeDisableMapClick=function(){this._executeMapClickCommands=!1,$(document.body).off("mousedown.nextClick touchstart.nextClick")},C.prototype._enableMapNextClick=function(){var e=this;$(document.body).off("mousedown.nextClick touchstart.nextClick"),this._isAndroid?setTimeout(function(){$(document.body).one("mousedown.nextClick touchstart.nextClick",function(){return e.app.command("EnableMapClick").execute()})},100):$(document.body).one("mousedown.nextClick touchstart.nextClick",function(){return e.app.command("EnableMapClick").execute()})},C.prototype._executeRecenterMap=function(){var e=this;if(!this._coolDownTimer&&this.app.applicationReady){var t=this.app.map&&this.app.map.extent&&this.app.map.extent.getCenter();t&&(this._coolDownTimer=setTimeout(function(){e._coolDownTimer=null,e.app.map.centerAt(t)},this._coolDownDuration))}},C.prototype._executeZoomOutToExtent=function(e){function t(e){var t=null;if(e&&0<e.length){t=e[0],s.app.command("ShowMap").execute();var i=2,a=2;0<t.getWidth()&&(i=s.app.map.extent.getWidth()/t.getWidth()),0<t.getHeight()&&(a=s.app.map.extent.getHeight()/t.getHeight());var o=s.app.map.extent.getWidth()*i,n=s.app.map.extent.getHeight()*a,r=new esri.geometry.Extent(t.getCenter().x-o/2,t.getCenter().y-n/2,t.getCenter().x+o/2,t.getCenter().y+n/2,t.spatialReference);s.app.site.essentialsMap.extentManager.setExtentWithPriority(r,5)}}var s=this;if(e&&e.isInstanceOf(esri.geometry.Extent)){if(!e.spatialReference&&this.app.map.spatialReference)return e.spatialReference=this.app.map.spatialReference,void t([e]);var i=new l.ProjectArgs([e],t,function(e){s.app.trace.warning("ZoomOutToExtent: "+e.message)});this.app.command("Project").execute(i)}},C.prototype._executeZoomToExtent=function(e){u.zoomToExtentWithPriority(this.app,e,10,this._showMapOnZoom)},C.prototype._executePanToPoint=function(e){u.panToPointWithPriority(this.app,e,9,this._showMapOnPan)},C.prototype._executeProject=function(t){var i=this;if(t&&t instanceof l.ProjectArgs){var e=function(e){i.app.command("Alert").execute(i.app.getResource(i.libraryId,"language-map-operation-project-failed")),i.app.trace.warning(e),t.errback&&t.errback(e)};if(0<t.geometries.length&&!d.needsProjection(t.geometries[0],this.app)){var a=t.callback;return e=t.errback,t.callback&&dojo.isFunction(a)?void a(t.geometries):void(e&&dojo.isFunction(e)&&e(new Error("callback function required.")))}var o=void 0;(o=void 0!==esri.tasks.ProjectParameters?new esri.tasks.ProjectParameters:new Object).geometries=t.geometries,t.outputSpatialReference?o.outSR=t.outputSpatialReference:o.outSR=this.app.map.spatialReference,o.transformation=t.transformation,d.project(o,t.callback,e,this.app)}},C.prototype._executeZoomToVisibleScale=function(e){if(e&&this.app.site.essentialsMap){var t=1,i=null,a=this.app.map,o=this.app.site.essentialsMap.calculateScale();if(o&&!(o<=0))if(e.withinScaleRange(o)?i=null:o<e.maxScale?i=this._getClosestLODScale("greaterThan",e.maxScale)+1:o>e.minScale&&(i=this._getClosestLODScale("lessThan",e.minScale)-1),i&&(t=i/o),1!==t){var n=a.extent.getCenter();u.zoomToExtentWithPriority(this.app,a.extent.expand(t).centerAt(n),8,this._showMapOnZoom)}else this.app.command("ShowMap").execute()}},C.prototype._getClosestLODScale=function(e,t){var i=this.app.map,a=i.__tileInfo&&i.__tileInfo.lods;if(!a||!a.length)return t;for(var o=0,n=0,r=a;n<r.length;n++){var s=r[n];if(s.scale===t)return t;if("lessThan"===e){if(t<s.scale)continue}else if(s.scale>t){o=s.scale;continue}return"lessThan"===e?s.scale:o}},C.prototype._executeZoomToLayerExtent=function(e){e&&e.fullExtent&&u.zoomToExtentWithPriority(this.app,e.fullExtent,8,this._showMapOnZoom)},C.prototype._executeZoomToNamedExtent=function(i){var a=this;i?this.app.doWhenMapInitialized(function(){var e=a.app.site.namedExtents.filter(function(e){return e.displayName.toLowerCase().trim()===i.toLowerCase().trim()}),t=e.length?e[0]:null;t?u.zoomToExtentWithPriority(a.app,t.extent,8,a._showMapOnZoom):a.app.trace.error("Error ZoomToNamedExtent: could not find extent '{0}'.".format(i))}):this.app.trace.error("Error ZoomToNamedExtent: extent name was null.")},C.prototype._executeZoomToOfflineMapExtent=function(){var i=this;this.app.doWhenMapInitialized(function(){var e=i.app.offlineManager.getActiveOfflineMap();if(e){var t=new esri.geometry.Polygon(e.content.geometry).getExtent();u.zoomToExtentWithPriority(i.app,t,8,i._showMapOnZoom)}else i.app.trace.warning("ZoomToOfflineMapExtent: no active offline map.")})},C.prototype._executePanToFeature=function(e){if(e&&e instanceof h.Feature){var t=e.esriFeature.get();t&&t.geometry?this.app.command("PanToPoint").execute(t.geometry):this.app.trace.warning("Error PanToFeature: No geometry.")}else this.app.trace.error("Error PanToFeature: not a feature.")},C.prototype._executePanToFeatureIfOutsideMapExtent=function(e){if(e&&e instanceof h.Feature){var t=e.esriFeature.get();t&&t.geometry?this.app&&this.app.map?this.app.map.extent.intersects(t.geometry)&&!this._isObscuredByMapTipView(t.geometry)||this.app.command("PanToFeature").execute(e):this.app.trace.error("Error ZoomToFeature: No access to the Esri map."):this.app.trace.warning("Error PanToFeatureIfOutsideMapExtent: No geometry.")}else this.app.trace.error("Error PanToFeatureIfOutsideMapExtent: not a feature.")},C.prototype._executePanToAllFeatures=function(e){if(e&&dojo.isArray(e)){if(1===e.length)return void this.app.command("PanToFeature").execute(e[0]);for(var t=null,i=0,a=e;i<a.length;i++){var o=a[i];if(o&&o instanceof h.Feature){var n=o.esriFeature.get();if(!n||!n.geometry)continue;var r=n.geometry,s=u.getExtent(r);t=null==t?s:t.union(s)}}t&&u.panToPointWithPriority(this.app,t,8,this._showMapOnPan)}},C.prototype._executeZoomToFeatures=function(e){e&&e instanceof n.FeatureSet&&this._executeZoomToAllFeatures(e.features.getItems())},C.prototype._executeZoomToAllFeatures=function(e){if(e&&dojo.isArray(e)){if(1===e.length)return void this._executeZoomToFeature(e[0]);for(var t=null,i=0,a=e;i<a.length;i++){var o=a[i];if(o&&o instanceof h.Feature){var n=o.esriFeature.get();if(!n||!n.geometry)continue;var r=n.geometry,s=u.getExtent(r);t=null==t?s:t.union(s)}}t&&(0===t.getWidth()&&0===t.getHeight()?u.panToPointWithPriority(this.app,t.getCenter(),8,this._showMapOnPan):(t=t.expand(1.5),u.zoomToExtentWithPriority(this.app,t,8,this._showMapOnZoom)))}},C.prototype._executeZoomToFeatureSetCollection=function(e){var t,i=this;if(t=e instanceof c.FeatureSetCollection?e:this.app.featureSetManager.getCollectionById(e)){var a=function(e){var t=[].concat.apply([],e.map(function(e){return e.features.get()}));i._executeZoomToAllFeatures(t)};if(t.featureSets&&t.featureSets.get()&&0<t.countFeatures())a(t.featureSets.get());else{var o=this.app.event("FSMCollectionChangedEvent").subscribe(this,function(e){t.featureSets&&t.featureSets.get()&&0<t.countFeatures()&&(a(t.featureSets.get()),i.app.event("FSMCollectionChangedEvent").unsubscribe(o),o=null)});setTimeout(function(){o&&i.app.event("FSMCollectionChangedEvent").unsubscribe(o)},C._fscPopDelay)}}},C.prototype._executeZoomToFeature=function(o){var e,n=this;if(o&&o instanceof h.Feature)if(this.app&&this.app.map)if(o.zoomExtent.get())u.zoomToExtentWithPriority(this.app,o.zoomExtent.get(),null,this._showMapOnZoom);else{if(o.esriFeature.get()&&o.esriFeature.get().geometry){var t=o.esriFeature.get().geometry,i=o.zoomScale.get(),a=void 0;if(i){var r=null;r="point"===t.type?t:(a=t.getExtent())?a.getCenter():null;var s=i/(this.app.map.spatialReference.wkid?esri.geometry.getScale(this.app.map.extent,this.app.map.width,this.app.map.spatialReference.wkid):esri.geometry.getScale(this.app.map.extent,this.app.map.width,this.app.map.spatialReference.wkt));return e=new l.ProjectArgs([r],function(e){var t=null;e&&0<e.length&&(t=e[0]),t&&u.zoomToExtentWithPriority(n.app,n.app.map.extent.centerAt(t).expand(s),8,n._showMapOnZoom)},function(e){}),void this.app.command("Project").execute(e)}if("point"===t.type)return e=new l.ProjectArgs([t],function(e){var t=null;if(e&&0<e.length&&(t=e[0]),t){var i=n.app.map.extent.centerAt(t),a=n._pickDefaultZoomScaleForPointFeature(o);isNaN(a)&&(a=n.app.map.spatialReference.wkid?esri.geometry.getScale(i,n.app.map.width,n.app.map.spatialReference.wkid):esri.geometry.getScale(i,n.app.map.width,n.app.map.spatialReference.wkt)),i=esri.geometry.getExtentForScale(n.app.map,o.calculateScaleToMakeVisible(a)).centerAt(i.getCenter()),u.zoomToExtentWithPriority(n.app,i,8,n._showMapOnZoom)}},function(e){}),void this.app.command("Project").execute(e);var p=o.zoomFactor.get();p=p||1.5;var c=t.getExtent();return c=c&&d.fixAspectRatio(c.expand(p),this.app.map.extent),e=new l.ProjectArgs([c],function(e){var t=null;if(e&&0<e.length&&(t=e[0]),t){var i=void 0;i=n.app.map.spatialReference.wkid?esri.geometry.getScale(t,n.app.map.width,n.app.map.spatialReference.wkid):esri.geometry.getScale(t,n.app.map.width,n.app.map.spatialReference.wkt),o.withinScaleRange(i)||(i=o.calculateScaleToMakeVisible(i),t=esri.geometry.getExtentForScale(n.app.map,i).centerAt(t.getCenter())),u.zoomToExtentWithPriority(n.app,t,8,n._showMapOnZoom)}},function(e){}),void this.app.command("Project").execute(e)}this.app.trace.warning("Error ZoomToFeature: No geometry.")}else this.app.trace.error("Error ZoomToFeature: No access to the Esri map.");else this.app.trace.error("Error ZoomToFeature: No feature provided.")},C.prototype._executeZoomToFeatureIfOutsideMapExtent=function(e){if(e&&e instanceof h.Feature)if(this.app&&this.app.map){if(this.app.map.extent){var t=void 0;if(e.zoomExtent.get())t=e.zoomExtent.get();else{if(!e.esriFeature.get()||!e.esriFeature.get().geometry)return void this.app.trace.warning("Error ZoomToFeatureIfOutsideMapExtent: No geometry.");t=e.esriFeature.get().geometry}if(this.app.map.extent.intersects(t)&&!this._isObscuredByMapTipView(t))return}this.app.command("ZoomToFeature").execute(e)}else this.app.trace.error("Error ZoomToFeature: No access to the Esri map.");else this.app.trace.error("Error ZoomToFeatureIfOutsideMapExtent: No feature provided.")},C.prototype._canExecuteZoomToFeature=function(e){if(e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry){if(this.app.isOffline.get()){var t=this.app.map.spatialReference,i=e.esriFeature.get().geometry.spatialReference;return i?t.equals(i)||t.isWebMercator()&&4326===i.wkid||i.isWebMercator()&&4326===t.wkid:t.equals(i)}return!0}return!1},C.prototype._isObscuredByMapTipView=function(e){if(!e)return!1;var t=this.app.viewManager.getViewById("MapTipView");if(!t||!t.root)return!1;var i=t.root.getBoundingClientRect(),a=this.app.map.toMap(new esri.geometry.ScreenPoint(i.left-this.app.map.position.x,i.bottom-this.app.map.position.y)),o=this.app.map.toMap(new esri.geometry.ScreenPoint(i.right-this.app.map.position.x,i.top-this.app.map.position.y));return new esri.geometry.Extent(a.x,a.y,o.x,o.y,this.app.map.spatialReference).contains(u.getExtent(e))},C.prototype.calculateScaleToMakeVisible=function(e){return null},C.prototype._executeZoomToScale=function(e){e&&this.app&&this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.extentManager.setScaleWithPriority(e,6)},C.prototype._executePanUp=function(e){if(e){var t=this.app.map.extent,i=this._calculateVerticalPanAmount(e),a=new esri.geometry.Extent(t.xmin,t.ymin+i,t.xmax,t.ymax+i,t.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(a,C.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panUp()},C.extentChangePriority)},C.prototype._executePanDown=function(e){if(e){var t=this.app.map.extent,i=this._calculateVerticalPanAmount(e),a=new esri.geometry.Extent(t.xmin,t.ymin-i,t.xmax,t.ymax-i,t.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(a,C.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panDown()},C.extentChangePriority)},C.prototype._executePanLeft=function(e){if(e){var t=this.app.map.extent,i=this._calculateHorizontalPanAmount(e),a=new esri.geometry.Extent(t.xmin-i,t.ymin,t.xmax-i,t.ymax,t.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(a,C.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panLeft()},C.extentChangePriority)},C.prototype._executePanRight=function(e){if(e){var t=this.app.map.extent,i=this._calculateHorizontalPanAmount(e),a=new esri.geometry.Extent(t.xmin+i,t.ymin,t.xmax+i,t.ymax,t.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(a,C.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panRight()},C.extentChangePriority)},C.prototype._calculateHorizontalPanAmount=function(e){return this.app.map&&this.app.map.extent?this.app.map.extent.getWidth()*e:0},C.prototype._calculateVerticalPanAmount=function(e){return this.app.map&&this.app.map.extent?this.app.map.extent.getHeight()*e:0},C.prototype._executeSetTimeExtent=function(e){this.app.map&&this.app.map.setTimeExtent(e)},C.prototype._pickDefaultZoomScaleForPointFeature=function(e){var t=e.layer;if(t)for(var i=0,a=this._config.defaultPointFeatureZoomScales;i<a.length;i++){var o=a[i];if(t.withinScaleRange(o))return o}else if(0<this._config.defaultPointFeatureZoomScales.length)return this._config.defaultPointFeatureZoomScales[0];return NaN},C.prototype._pointToExtent=function(e){var t=this.app.map.extent.getWidth()/this.app.map.width*5;return new esri.geometry.Extent(e.x-t,e.y-t,e.x+t,e.y+t,this.app.map.spatialReference)},C.prototype.featureClickHandler=function(e){e&&this.app.behavior("MapOnFeatureClickBehavior").run(e)},C.prototype.subscribeToMapEvents=function(){function i(e){if(p)return p=!1;if(!s._executeMapClickCommands)return!1;var t=(new Date).getTime();s._isAndroid3plus?t-c<=300&&l&&Math.abs(l.x-e.screenPoint.x)<50&&Math.abs(l.y-e.screenPoint.y)<50?clearTimeout(u):u=setTimeout(function(){s._executeMapClickCommands&&s.app.behavior("MapOnClickBehavior").run(e.mapPoint)},300):s.app.behavior("MapOnClickBehavior").run(e.mapPoint),c=t,l=e.screenPoint}function a(e){null!=d&&(clearTimeout(d),d=null)}function o(o){a(),p=!1,d=setTimeout(function(){if(p=!(d=null),esri.MapNavigationManager?esri.MapNavigationManager.prototype._panEnd?s.app.map.navigationManager?s.app.map.navigationManager._panHandle&&esri.MapNavigationManager.prototype._panEnd.call(s.app.map.navigationManager):s.app.trace.warning("Can't prevent panning: missing map.navigationManager."):s.app.trace.warning("Can't prevent panning: missing esri.MapNavigationManager._panEnd"):s.app.trace.warning("Can't prevent panning: missing esri.MapNavigationManager."),o.preventDefault(),!(Date.now()-c<700)&&o.touches&&0<o.touches.length){var e=o.touches[0],t=$(s.app.map.root).offset(),i=new esri.geometry.ScreenPoint(Math.floor(e.pageX)-t.left,Math.floor(e.pageY)-t.top),a=s.app.map.toMap(i);c=Date.now(),s.app.behavior("MapOnLongClickBehavior").run(a)}},s._config.longClickMilliseconds||500)}function n(e){if(e.preventDefault(),!(Modernizr.touch&&Date.now()-c<700)){var t=$(s.app.map.root).offset(),i=e.pageX-t.left,a=e.pageY-t.top,o=new esri.geometry.ScreenPoint({x:i,y:a}),n=s.app.map.toMap(o);c=Date.now(),s.app.behavior("MapOnContextMenuBehavior").run(n)}}function r(){dojo.forEach(h,dojo.disconnect),h.length=0,Modernizr.touch&&(s.app.map.root.removeEventListener("touchstart",o,!1),s.app.map.root.removeEventListener("touchend",a,!1),s.app.map.root.removeEventListener("touchcancel",a,!1),s.app.map.root.removeEventListener("touchleave",a,!1),s.app.map.root.removeEventListener("touchmove",a,!1))}function e(){r(),h.push(dojo.connect(s.app.map,"onClick",i));var e=s.app.behaviorRegistry.behaviors.MapOnLongClickBehavior;e&&0<e.commands.length&&(h.push(dojo.connect(s.app.map,"onMouseDown",o)),h.push(dojo.connect(s.app.map,"onMouseUp",a)),h.push(dojo.connect(s.app.map,"onMouseDrag",a)),h.push(dojo.connect(s.app.map,"onPanStart",a)),h.push(dojo.connect(s.app.map,"onZoomStart",a)),Modernizr.touch&&(s.app.map.root.addEventListener("touchstart",o,!1),s.app.map.root.addEventListener("touchend",a,!1),s.app.map.root.addEventListener("touchcancel",a,!1),s.app.map.root.addEventListener("touchleave",a,!1),s.app.map.root.addEventListener("touchmove",a,!1)));var t=s.app.behaviorRegistry.behaviors.MapOnContextMenuBehavior;t&&0<t.commands.length&&s.app.map.root.addEventListener("contextmenu",n,!1)}var s=this,t=this,p=!1,c=0,l=null,u=null,d=null,h=[];e(),this.app.event("GraphicDrawActivatedEvent").subscribe(this,function(){0!==s._mapClickTimerHandles.length&&(s._mapClickTimerHandles.forEach(function(e){clearTimeout(e)}),s._mapClickTimerHandles=[]),r()}),this.app.event("GraphicDrawDeactivatedEvent").subscribe(this,function(){s._isAndroid?s._mapClickTimerHandles.push(setTimeout(e,950)):e()});var m=esri.toolbars.Draw.prototype.activate;esri.toolbars.Draw.prototype.activate=function(){if(!this.__attached_isActive)if(m.apply(this,arguments),this.__attached_isActive=!0,this.__attached_stopEvent)delete this.__attached_stopEvent;else{var e=arguments[0];t.app.event("GraphicDrawActivatedEvent").publish({sender:this,geometryType:e})}};var g=esri.toolbars.Draw.prototype.deactivate;if(esri.toolbars.Draw.prototype.deactivate=function(){this.__attached_isActive&&(this.__attached_stopEvent?delete this.__attached_stopEvent:t.app.event("GraphicDrawDeactivatedEvent").publish({sender:this,geometryType:null}),g.apply(this,arguments),this.__attached_isActive=!1)},this.app.event("GraphicEditActivatedEvent").subscribe(this,r),this.app.event("GraphicEditDeactivatedEvent").subscribe(this,function(){s.app.toolRegistry.getActiveTool()||e()}),void 0!==esri.toolbars.Edit){var v=0,f=null,y=esri.toolbars.Edit.prototype.activate;esri.toolbars.Edit.prototype.activate=function(){if(!this.__attached_isActive)if(y.apply(this,arguments),this.__attached_isActive=!0,this._textSymbolEditor&&(this._textSymbolEditor._showHaloStyler=!1),this.__attached_stopEvent)delete this.__attached_stopEvent;else{var e={tool:v=arguments[0],graphic:f=arguments[1],sender:this};t.app.event("GraphicEditActivatedEvent").publish(e)}};var b=esri.toolbars.Edit.prototype.deactivate;esri.toolbars.Edit.prototype.deactivate=function(){if(this.__attached_isActive){if(this.__attached_stopEvent)delete this.__attached_stopEvent;else{var e={tool:v,graphic:f,sender:this};v=0,f=null,t.app.event("GraphicEditDeactivatedEvent").publish(e)}b.apply(this,arguments),this.__attached_isActive=!1}}}},C.prototype._onGeoRssLayerLoaded=function(e){e&&e.esriLayer&&dojo.connect(e.esriLayer,"onClick",this,function(e){dojo.stopEvent(e);var t=new h.Feature({graphic:e.graphic,allowUnsafeContent:this.app.configuration.allowUnsafeContent});t.descriptionFormat.set("{content}"),t.labelFormat.set("{title}"),this.app.command("ShowMapTip").execute(t)})},C.prototype._handleSiteInitialized=function(e){e&&e.isInitialized?this._registerLayersClickableIfNeeded():this.app.trace.error("Error processing MapModule._handleSiteInitialized. - site was not initialized.")},C.prototype._registerLayersClickableIfNeeded=function(e){function t(e){i._registerStreamLayersAsClickable(e),i._registerLayerAdditionBasedWfsLayersAsClickable(e)}var i=this,a=this.app.site;a&&a.isInitialized&&(e?t(e):a.essentialsMap.mapServices.forEach(function(e){return t(e)}))},C.prototype._registerStreamLayersAsClickable=function(e){var t=e&&e.layers&&e.layers[0];e&&t&&e.serviceLayer&&e.serviceLayer instanceof esri.layers.StreamLayer&&(t.identifiable||t.showMapTips)&&v.registerStreamLayerAsClickable(e.serviceLayer,this.app,t.displayName)},C.prototype._registerLayerAdditionBasedWfsLayersAsClickable=function(e){var t=e&&e.layers&&e.layers[0];e&&t&&e.isUserCreated&&e.userLayerType===f.UserLayerType.LAYER_ADDITION&&e.serviceLayer&&e.serviceLayer instanceof esri.layers.WFSLayer&&(t.identifiable||t.showMapTips)&&v.registerWfsLayerAsClickable(e.serviceLayer,this.app,t.displayName)},C.prototype._handleLayerUpdateStart=function(o,n){if(n){n.attached_isLoading=!0,n.attached_timers||(n.attached_timers=new Array);var e=setTimeout(dojo.hitch(this,function(){if(!(this._config.loadingMessageTiming.length<1)&&this._config.showLoadingStatus&&n.attached_isLoading){var t,e=this.app.getResource(this.libraryId,"language-map-loading-stage1").format(n.displayName),i=new m.AddStatusArgs(e);if(i.id=o.id+"LoadingStatus",i.showBusyIcon=!0,this.app.command("AddStatus").execute(i),this._config.loadingMessageTiming.length<2)return;var a=setTimeout(dojo.hitch(this,function(){if(n.attached_isLoading){if((t=this.app.viewManager.getViewById(i.id))&&t.viewModel&&t.viewModel.text.set(this.app.getResource(this.libraryId,"language-map-loading-stage2").format(n.displayName)),this._config.loadingMessageTiming.length<3)return;var e=setTimeout(dojo.hitch(this,function(){n.attached_isLoading&&(t=this.app.viewManager.getViewById(i.id))&&t.viewModel&&t.viewModel.text.set(this.app.getResource(this.libraryId,"language-map-loading-stage3").format(n.displayName))}),this._config.loadingMessageTiming[2]);n.attached_timers.push(e)}}),this._config.loadingMessageTiming[1]);n.attached_timers.push(a)}}),this._config.loadingMessageTiming[0]);n.attached_timers.push(e)}},C.prototype._handleLayerUpdateEnd=function(e,t){if(t){if(t.attached_timers){for(var i=0,a=t.attached_timers;i<a.length;i++){var o=a[i];clearTimeout(o)}t.attached_timers.length=0}t.attached_isLoading=!1;var n=e.id+"LoadingStatus";this.app.command("RemoveStatus").execute(n)}},C.prototype._handleLayerAdded=function(e,t){this._registerLayersClickableIfNeeded(t)},C.prototype._handleLayerRemoved=function(e){var t=e.id+"LoadingStatus";this.app.command("RemoveStatus").execute(t)},C.prototype._initializeCoordinateModels=function(){var i=this,t=this.id.split("-").pop(),e=this.app.configModel.moduleConfigs.filter(function(e){return e.moduleName===t})[0];e&&e.viewModelConfigs.length&&e.viewModelConfigs.forEach(function(e){var t=e.viewModelId;e.typeName===i._coordModelType&&i._mapCoordinatesControllers.push(new a.MapCoordinatesController(i.app,i.libraryId,t))})},C.extentChangePriority=6,C._fscPopDelay=1500,C);function C(e,t){var i=M.call(this,e,t)||this;return i._config=null,i._isAndroid=!1,i._isAndroid3plus=!1,i._showMapOnZoom=!0,i._showMapOnPan=!1,i._maxLogEntries=100,i._executeMapClickCommands=!0,i._mapClickTimerHandles=[],i._mapCoordinatesControllers=[],i._mapExtentLog=null,i._coordModelType="geocortex.essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinatesModel",i._coolDownDuration=300,i.registerCommands(),i.app.event("LayerUpdateStartedEvent").subscribe(i,i._handleLayerUpdateStart),i.app.event("LayerUpdateEndedEvent").subscribe(i,i._handleLayerUpdateEnd),i.app.event("LayerAddedEvent").subscribe(i,i._handleLayerAdded),i.app.event("LayerRemovedEvent").subscribe(i,i._handleLayerRemoved),i.app.waitUntilSiteInitialized().then(function(){i._handleSiteInitialized(i.app.site)}),i._isAndroid3plus=i._androidSieve(navigator.userAgent,3),i._isAndroid=$(document.documentElement).hasClass("dj_android"),i}t.MapModule=x})},"Mapping/modules/Map/MapState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Map/MapView":function(){var a,l=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FocusUtils","geocortex/infrastructure/eventArgs/MapExtentEventArgs","./RippleClick","geocortex/infrastructure/ShellUtils","geocortex/essentials/utilities/StringUtilities","geocortex/framework/utils/utils","geocortex/framework/utils/ArrayUtils","geocortex/workflow/LayerActivityHandlers"],function(e,t,i,a,o,M,n,x,C,_,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,p=(s=i.ViewBase,l(c,s),c.prototype.removed=function(){null!=this.app.map&&this.app.map.destroy()},c.prototype.activated=function(){var e=this;s.prototype.activated.call(this),this.initialized||this.initialize(),this.active=!0,setTimeout(function(){return a.focusOnMap(e.app.map)},0)},c.prototype.deactivated=function(){s.prototype.deactivated.call(this),this.active=!1,clearTimeout(this.hoverTimer)},c.prototype.attach=function(e){var t=this;s.prototype.attach.call(this,e),this.viewModel&&(this.initialized||this.initialize(),this.app.waitUntilMapLoaded().then(function(){t._addBrokenPanDetection()}))},c.prototype._activateMapContextMenu=function(e){var t=this.mapDiv.getBoundingClientRect(),i=this.app.map.toScreen(e),a=t.left+i.x,o=t.top+i.y;this.app.event("MapContextMenuPointUpdatedEvent").publish(e),this.app.command("ActivateContextMenu").execute({pageX:a,pageY:o,viewId:"MapContextMenuView"})},c.prototype._addBrokenPanDetection=function(){if(/.*Trident\/([0-9]+)\..*/.test(navigator.userAgent)){var e,i;if(navigator.msPointerEnabled)e="MSPointerMove",i="MSPointerUp";else{if(!navigator.pointerEnabled)return;e="pointermove",i="pointerup"}var a=this.mapDiv.childNodes[0].childNodes[0],o=this.app.map;void 0!==o.__panning&&this._addEventListener(a,e,function(e){if(e=e||window.event,o.__panning&&0===e.buttons&&(void 0===e.pointerType||"mouse"===e.pointerType||4===e.pointerType)){var t=document.createEvent("HTMLEvents");t.initEvent(i,!1,!0),dojo.mixin(t,e),t.button=0,t.buttons=0,t.which=0,a.dispatchEvent(t)}})}},c.prototype.resize=function(){function e(){if(i.mapDiv){i.app.map.reposition();var e=i.mapDiv.clientWidth,t=i.mapDiv.clientHeight;!0===i.isActive&&2<e&&2<t&&a.width&&a.height&&(1<Math.abs(a.width-e)||1<Math.abs(a.height-t))&&(a.resizeDelay=0,i.app.site.essentialsMap.extentManager.blockForResize(e,t,!0),i.app.trace.debug("Map size change executing. Map will be sized to "+e+"px x "+t+"px"))}}var i=this,a=this.app.map;this._firstResizeComplete&&this.app.applicationReady?e():this.app.waitUntilApplicationReady().then(function(){setTimeout(function(){i._firstResizeComplete=!0,e()},1e3)})},c.prototype.initialize=function(){var t=this;!this.initializing&&!this.initialized&&this.viewModel&&this.root&&(this.initializing=!0,this.app.waitUntilSiteDownloaded().then(function(e){t._initializeMap(e)}))},c.prototype._initializeMap=function(e){var p=this,t=!1,i=!!Modernizr.csstransforms3d,a=!0,o=!1,n=!1,r=!1;this.configuration&&this.configuration.hasOwnProperty("wrapAround180")&&(t=this.configuration.wrapAround180),this.configuration&&this.configuration.hasOwnProperty("force3DTransforms")&&(i=this.configuration.force3DTransforms),this.configuration&&this.configuration.hasOwnProperty("showAttribution")&&(a=!!this.configuration.showAttribution),this.configuration&&this.configuration.hasOwnProperty("fitTiledMapsToExtent")&&(o=!!this.configuration.fitTiledMapsToExtent),this.configuration&&this.configuration.hasOwnProperty("disableMapKeyboardNavigation")&&(n=!!this.configuration.disableMapKeyboardNavigation),this.configuration&&this.configuration.hasOwnProperty("showLabels")&&(r=!!this.configuration.showLabels);var s={slider:!1,logo:!1,showAttribution:a,wrapAround180:t,force3DTransforms:i,autoResize:!1,fitExtent:o,showInfoWindowOnClick:!1,showLabels:r},c=null;if(e){if(e.map&&e.map.initialExtent){var l=esri.geometry.fromJson(e.map.initialExtent);if(l&&l instanceof esri.geometry.Extent){if(C.isNullOrUndefined(e.map.initialExtent.spatialReference)){var u=_.firstOrDefault(e.map.mapServices,function(e){return e.fullExtent&&e.fullExtent.spatialReference});u&&(l.spatialReference=u.fullExtent.spatialReference)}s.extent=l}}if(e.timeSliders&&0<e.timeSliders.length){var d=e.timeSliders[0],h=d.initialStartTime||d.startTime,m=d.initialEndTime||d.endTime;h&&m&&(c=new esri.TimeExtent(x.StringUtilities.getDateFromRestDateString(h),x.StringUtilities.getDateFromRestDateString(m)))}}if(this.configuration&&this.configuration.hasOwnProperty("minScale")){var g=parseFloat(this.configuration.minScale);isNaN(g)||(this.minScale=g,s.minScale=g)}if(this.configuration&&this.configuration.hasOwnProperty("maxScale")){var v=parseFloat(this.configuration.maxScale);isNaN(v)||(this.maxScale=v,s.maxScale=v)}this.rippleClick=new M.RippleClick(this.app,this.mapDiv,this.mapContainer),this.rippleClick.initialize(this.configuration),this.app.debugModeActive("time")&&this.app._debug.timers.determineTimeToESRIMapCreation(this.app),this.app.trace.debug("Initial shell height: "+this.app.initialShellHeight),this.app.trace.debug("Initial shell width: "+this.app.initialShellWidth);var f=window.innerWidth-this.app.initialShellWidth,y=window.innerHeight-this.app.initialShellHeight,b=document.getElementById("map");b.setAttribute("style","width:"+f+"px; height:"+y+"px;"),this.app.trace.debug("Set the initial map size to "+f+"x"+y),this.app.waitUntilApplicationReady().then(function(){setTimeout(function(){return b.setAttribute("style","width:100%; height:100%;")},300)}),this.app.map=new esri.Map("map",s),this.app.map._fitTiledMapsToExtent=o,this.app.map.hideZoomSlider(),this.extentBroadcastFrequency=this.configuration.extentBroadcastFrequency||0,c&&this.app.map.setTimeExtent(c),n&&this._disableMapKeyboardNavigation(),this.app.command("ZoomToInitialExtent").register(this,function(){p.app.command("ActivateView").execute(p.id)}),this.app.command("ZoomToFullExtent").register(this,function(){p.app.command("ActivateView").execute(p.id)}),this.app.event("ApplicationResizedEvent").subscribe(this,function(){return p.resize()}),this.app.command("MapResize").register(this,function(){return p.resize()}),this.app.command("ShowMap").register(this,function(){p.app.command("ActivateView").execute(p.id)}),this.app.command("EnableMapClick").register(this,function(){return p._enableMapClickEvent=!0}),this.app.command("DisableMapClick").register(this,function(){return p._enableMapClickEvent=!1}),this.app.command("DisableMapKeyboardNavigation").register(this,this._disableMapKeyboardNavigation),this.app.command("EnableMapKeyboardNavigation").register(this,this._enableMapKeyboardNavigation),this.app.event("ActiveToolChangedEvent").subscribe(this,this._toolChanged),dojo.connect(this.app.map,"onExtentChange",function(e,t,i,a){var o=a;!o&&p.app.site&&p.app.site.essentialsMap&&(o=p._getLevelOfDetails(e)),p.app.map.graphicsLayerIds.forEach(function(e){var t=p.app.map.getLayer(e),i=t.getNode();i&&i.style&&"none"===i.style.display&&t.visible&&t.visibleAtMapScale&&!t.suspended&&$(i).show()}),p.app.event("MapExtentChangeEvent").publish(e,t,i,o),p._publishWithMapExtent("MapExtentChangedEvent",e,o)}),dojo.connect(this.app.map,"onLayerAdd",this,this._layerAdd),dojo.connect(this.app.map,"onLayerAddResult",this,function(e,t){p.app.event("LayerAddResultEvent").publish(e,t),p.app.event("LayerAddedWithResultEvent").publish(e,t),p._updateBingLogoPosition()}),dojo.connect(this.app.map,"onLayerRemove",this,function(e){if(e){var t=p._layerEventsLookup[e.id];if(t){for(var i=0,a=t;i<a.length;i++){var o=a[i];dojo.disconnect(o)}delete p._layerEventsLookup[e.id]}p.app.event("LayerRemovedEvent").publish(e),p._updateBingLogoPosition()}}),dojo.connect(this.app.map,"onLayersAddResult",this,function(e){p.app.event("LayersAddedWithResultEvent").publish(e||[]),p._updateBingLogoPosition()}),dojo.connect(this.app.map,"onPanStart",function(e,t){p.app.event("MapPanStartEvent").publish(e,t),p.app.event("MapPanStartedEvent").publish(e,t)}),dojo.connect(this.app.map,"onPan",function(e,t){p.app.event("MapPanEvent").publish(e,t),p._broadcastExtent(e)}),dojo.connect(this.app.map,"onPanEnd",function(e,t){p.app.event("MapPanEndEvent").publish(e,t),p.app.event("MapPanEndedEvent").publish(e,t)}),dojo.connect(this.app.map,"onZoomStart",function(e,t,i,a){p.app.event("MapZoomStartEvent").publish(e,t,i,a),p.app.event("MapZoomStartedEvent").publish(e,t,i,a)}),dojo.connect(this.app.map,"onZoom",function(e,t,i){p.app.event("MapZoomEvent").publish(e,t,i),p._broadcastExtent(e)}),dojo.connect(this.app.map,"onZoomEnd",function(e,t,i,a){p.app.event("MapZoomEndEvent").publish(e,t,i,a),p.app.event("MapZoomEndedEvent").publish(e,t,i,a)}),dojo.connect(this.app.map,"onLoad",function(e){if(p.minScale||p.maxScale){var t=p.app.map._params,i=t.lods;if(i&&i.length){var a=p.app.map.__tileInfo.lods;if(p.minScale){for(;i[0].scale<p.minScale;){var o=Math.min(p.minScale,2*i[0].scale);(s=new esri.layers.LOD).level=0,s.scale=o,s.resolution=i[0].resolution*o/i[0].scale,i.splice(0,0,s),a.splice(0,0,s),t.hasOwnProperty("maxZoom")&&t.maxZoom++}for(var n=0;n<i.length;n++)a[i[n].level=n].level=n}if(p.maxScale)for(var r=i.length-1;i[r].scale>p.maxScale;){var s;o=Math.max(p.maxScale,.5*i[r].scale),(s=new esri.layers.LOD).level=i[r].level+1,s.scale=o,s.resolution=i[r].resolution*o/i[r].scale,i.push(s),a.push(s),t.maxZoom=s.level,r++}}}p._installZoomFix(),p.app.site.essentialsMap.isLoaded=!0,p.app.event("MapLoadedEvent").publish(e)}),dojo.connect(this.app.map,"onClick",function(e){p._enableMapClickEvent&&(p.app.event("MapClickedEvent").publish(e),e.mapPoint&&p.app.event("MapClickedPointEvent").publish(e.mapPoint))}),dojo.connect(this.app.map,"onMouseDown",function(e){p.app.event("MapMouseDownEvent").publish(e)}),dojo.connect(this.app.map,"onMouseUp",function(e){p.app.event("MapMouseUpEvent").publish(e)}),dojo.connect(this.app.map,"onTimeExtentChange",function(e){p.app.event("MapTimeExtentChangedEvent").publish(e)}),dojo.subscribe("LayerVisibilityChange",function(e){var t=[];if(e&&0<e.length)for(var i=0,a=e;i<a.length;i++){var o=a[i];if(o&&o.mapServiceId&&o.layerId){var n=p.app.site.essentialsMap.findMapServiceById(o.mapServiceId);if(n){var r=n.findLayerById(o.layerId);r&&t.push({layer:r,mapService:n,visibility:o.visibility})}}else p.app.trace.error(p.id+" can't find map service for layer. Either mapServiceId or layerId are not available.")}p.app.event("LayerVisibilityChangedEvent").publish(t)}),dojo.subscribe("ServiceLayerInitializedEvent",function(e){p.app.event("SiteLayerLoadingEvent").publish(e)}),dojo.subscribe("MapServiceVisibilityChangedEvent",function(e){e&&(p.app.event("MapServiceVisibilityChangedEvent").publish(e.serviceLayer,e),p._updateBingLogoPosition())}),dojo.subscribe("MapServiceAddedEvent",function(e){e&&p.app.event("MapServiceAddedEvent").publish(e)}),dojo.subscribe("MapServiceRemovedEvent",function(e){e&&p.app.event("MapServiceRemovedEvent").publish(e)}),dojo.subscribe("CatalogLayerAddedEvent",function(e){return p.app.event("CatalogLayerAddedEvent").publish(e)}),dojo.subscribe("CatalogLayerRemovedEvent",function(e){return p.app.event("CatalogLayerRemovedEvent").publish(e)}),dojo.subscribe("MapServiceLayersChangedWithResultEvent",function(e){return p.app.event("MapServiceLayersChangedWithResultEvent").publish(e)}),this._attachMouseHoverHandlers(),this._attachMouseMoveHandlers(),this._updateBingLogoPosition(),this.initialized=!0,this.app.event("MapInitializedEvent").publish()},c.prototype._installZoomFix=function(){var a=this;this.app.map.on("zoom-start",function(e){a.app.map.layerIds.forEach(function(e){var t=a.app.map.getLayer(e);if(t&&t instanceof esri.layers.DynamicMapServiceLayer&&t.updating){var i=t._img;i&&(i.style.display="none")}})})},c.prototype._addEventListener=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},c.prototype._removeEventListener=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)},c.prototype._attachMouseMoveHandlers=function(){var t=this,i=n.throttle(function(e){e.mapPoint&&t.app.event("MapMouseMovePointEvent").publish(e.mapPoint)},50);dojo.aspect.after(this.app.event("MapMouseMovePointEvent"),"subscribe",function(e){return t._mapMouseMoveSubscriberCount++<=0&&t._addEventListener(t.app.map.root,"mousemove",i),e}),dojo.aspect.after(this.app.event("MapMouseMovePointEvent"),"unsubscribe",function(){--t._mapMouseMoveSubscriberCount<=0&&t._removeEventListener(t.app.map.root,"mousemove",i)})},c.prototype._attachMouseHoverHandlers=function(){function t(e){clearTimeout(a.hoverTimer);var t={clientX:e.clientX,clientY:e.clientY};a.hoverTimer=setTimeout(function(){a.app.event("MapMouseHoverEvent").publish(t)},a._mapHoverTimeout)}function i(e){e.explicitOriginalTarget&&"path"===e.explicitOriginalTarget.localName||clearTimeout(a.hoverTimer)}var a=this;dojo.aspect.after(this.app.event("MapMouseHoverEvent"),"subscribe",function(e){return a._mapHoverSubscriberCount++<=0&&(a._addEventListener(a.app.map.root,"mousemove",t),a._addEventListener(a.app.map.root,"mouseout",i)),e}),dojo.aspect.after(this.app.event("MapMouseHoverEvent"),"unsubscribe",function(){--a._mapHoverSubscriberCount<=0&&(a._removeEventListener(a.app.map.root,"mousemove",t),a._removeEventListener(a.app.map.root,"mouseout",i))})},c.prototype._updateTopLeftMapRegion=function(e){if("TopMapRegion"===e.regionName){var t=this.app.viewManager.getExistingRegionByName("TopMapRegion");t&&0<t.views.filter(function(e){return"DataFrameButtonView"!==e.id&&e.isActive}).length?$(".map-top-left").removeClass("map-top-hidden").addClass("map-top-visible"):$(".map-top-left").removeClass("map-top-visible").addClass("map-top-hidden")}},c.prototype._updateBingLogoPosition=function(){for(var e=0;this.app.map&&e<this.app.map.layerIds.length;e++){var t=this.app.map.getLayer(this.app.map.layerIds[e]);if(t.isInstanceOf(esri.virtualearth.VETiledLayer)&&t.visible){var i=this.app.viewManager.getExistingRegionByName("BottomLeftMapRegion");if(i){var a=i.activeViews;if(a&&0<a.length){for(var o=0,n=0,r=a;n<r.length;n++){var s=r[n];s.root.clientHeight>o&&(o=s.root.clientHeight)}$(".bingLogo-lg").css("bottom",o)}}return}}},c.prototype._broadcastExtent=function(e){var t,i=null;this.extentEpoch||(this.extentEpoch=+new Date),(t=+new Date)-this.extentEpoch>this.extentBroadcastFrequency&&(this.app.site&&this.app.site.essentialsMap&&(i=this._getLevelOfDetails(e)),this._publishWithMapLod("MapExtentChangingEvent",i),this.extentEpoch=t)},c.prototype._layerAdd=function(t){var e=this,i=this.app.site.essentialsMap.mapServices.filter(function(e){return e.serviceLayer===t});if(0!==i.length){var a=i[0];this.app.event("LayerAddEvent").publish(t,a),this.app.event("LayerAddedEvent").publish(t,a);var o=[];(this._layerEventsLookup[t.id]=o).push(dojo.connect(t,"onUpdateStart",this,function(){e.app.event("LayerUpdateStartEvent").publish(t,a),e.app.event("LayerUpdateStartedEvent").publish(t,a)})),o.push(dojo.connect(t,"onUpdateEnd",this,function(){e.app.event("LayerUpdateEndEvent").publish(t,a),e.app.event("LayerUpdateEndedEvent").publish(t,a)})),o.push(dojo.connect(t,"onVisibilityChange",this,function(){e.app.event("MapServiceVisibilityChangedEvent").publish(t,a),e._updateBingLogoPosition()})),this._updateBingLogoPosition()}},c.prototype._getLevelOfDetails=function(e){var t={scale:this.app.site.essentialsMap.calculateScale()};return e&&this.app.map&&0<this.app.map.width&&(t.resolution=e.getWidth()/this.app.map.width),t},c.prototype._publishWithMapLod=function(e,t){var i=null;t&&((i=new o.MapExtentEventArgs).currentScale=t.scale,i.currentResolution=t.resolution),this.app.event(e).publish(i)},c.prototype._publishWithMapExtent=function(e,t,i){var a=null;i&&((a=new o.MapExtentEventArgs).currentScale=i.scale,a.currentResolution=i.resolution),this.app.event(e).publish(t,a)},c.prototype._toolChanged=function(e){e.tool&&this.app.command("ActivateView").execute(this.id)},c.prototype._disableMapKeyboardNavigation=function(){this._setMapKeyboardNavigation(!1)},c.prototype._enableMapKeyboardNavigation=function(){this._setMapKeyboardNavigation(!0)},c.prototype._setMapKeyboardNavigation=function(e){var t=this;if(this.app.map){var i=function(e){e?t.app.map.enableKeyboardNavigation():t.app.map.disableKeyboardNavigation()};this.app.map.loaded?i(e):this.app.event("MapLoadedEvent").once(this,function(){i(e)})}},c.prototype._animateTopRightRegionOpening=function(){$(".region.map-top").removeClass("map-top-slide-up"),$(".region.map-top").addClass("map-top-slide-down")},c.prototype._animateTopRightRegionClosing=function(){$(".region.map-top").removeClass("map-top-slide-down"),$(".region.map-top").addClass("map-top-slide-up")},c);function c(e,t){var n=s.call(this,e,t)||this;return n.active=null,n.hoverTimer=null,n.firstResize=!1,n.initialized=!1,n.initializing=!1,n.extentEpoch=null,n.extentBroadcastFrequency=null,n.minScale=null,n.maxScale=null,n._layerEventsLookup={},n._mapHoverSubscriberCount=0,n._mapMouseMoveSubscriberCount=0,n._mapHoverTimeout=500,n._enableMapClickEvent=!0,n._firstResizeComplete=!1,n.app.event("ViewActivatedEvent").subscribe(n,n._updateBingLogoPosition),n.app.event("ViewDeactivatedEvent").subscribe(n,n._updateBingLogoPosition),n.app.event("RegionActivatedEvent").subscribe(n,n._updateBingLogoPosition),n.app.event("RegionDeactivatedEvent").subscribe(n,n._updateBingLogoPosition),n.app.event("ViewActivatedEvent").subscribe(n,n._updateTopLeftMapRegion),n.app.event("ViewDeactivatedEvent").subscribe(n,n._updateTopLeftMapRegion),n.app.command("ActivateMapContextMenu").register(n,n._activateMapContextMenu),n.app.command("SetLayerVisibility").register(n,function(e){var t=e.mapServiceId,i=e.layerId,a=e.layerName,o=e.visible;r.setLayerVisibility({site:n.app.site,mapServiceId:t,layerId:i,layerName:a,visible:o})}),n.app.event("SmallShellTopRightRegionOpeningEvent").subscribe(n,n._animateTopRightRegionOpening),n.app.event("SmallShellTopRightRegionClosingEvent").subscribe(n,n._animateTopRightRegionClosing),n}t.MapView=p})},"Mapping/modules/Map/MapViewModel":function(){var a,h=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/MapServiceConstants","geocortex/essentials/MapService","geocortex/essentials/Layer","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,i,a,o,r,s,n,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,u=(l=i.ViewModelBase,h(d,l),d.prototype.initialize=function(e){var t=this;if(l.prototype.initialize.call(this,e),e&&e.hasOwnProperty("stepZoomFactor")){var i=parseFloat(e.stepZoomFactor);this.stepZoomFactor=!isNaN(i)&&0<i?i:.5}this.temporaryMarkupSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,20,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0]),1),new esri.Color([255,255,0,.5])),this.app.doIfSiteInitializationFails({initFailCallback:function(){t.showMap.set(!1),t.showError.set(!0)},authFailCallback:function(){t.showMap.set(!1),t.showAuthError.set(!0)}}),this.app.event("SiteServiceLayersFailedEvent").once(this,function(e){dojo.some(e,function(e){return e.failureAction===o.FailureAction.ERROR})&&(t.showMap.set(!1),t.showCriticalServicesError.set(!0))}),this.app.waitUntilMapLoaded().then(function(){t._subscribeToMapEvents()}),this.app.event("UserAddedLayerOrMapServiceRemovedEvent").subscribe(this,this._userAddedLayerOrMapServiceRemoved)},d.prototype.registerCommands=function(){var i=this;this.app.command("AddTemporaryMarkupGeometry").register(this,function(e){if(i.temporaryGraphicsLayer||(i.temporaryGraphicsLayer=c.getInternalGraphicsLayer(p.TEMP_GRAPHICS_LAYER_ID,i.app,c.GraphicsLayerType.Markup,!1)),e){var t=null;switch(e.type){case"polygon":case"extent":t=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([255,51,51,.8]),2),new esri.Color([255,51,51,.5]));break;case"polyline":t=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([204,51,51,.8]),2);break;default:t=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,14,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0]),1),new esri.Color([204,51,51]))}i.temporaryGraphicsLayer.add(new esri.Graphic(e,t))}}),this.app.command("ClearTemporaryMarkup").register(this,function(){i.temporaryGraphicsLayer&&i.temporaryGraphicsLayer.clear()}),this.app.command("AddMapService").register(this,this._executeAddMapService),this.app.command("RemoveMapService").register(this,this._executeRemoveMapService,this._canExecuteRemoveMapService),this.app.command("RemoveUserAddedLayer").register(this,this._executeRemoveUserAddedLayer,this._canExecuteRemoveUserAddedLayer),this.app.command("ZoomToInitialExtent").register(this,function(){setTimeout(function(){if(null!=i.app.map){if(null===i.app.site||!i.app.site.isInitialized||null===i.app.site.essentialsMap)return void i.app.trace.warning("Could not zoom to initial extent - Site was null or uninitialized.");if(!i.app.site.essentialsMap.isInitialized||null===i.app.site.essentialsMap.initialExtent)return void i.app.trace.warning("Could not zoom to initial extent - Map was not initialized or has no initial extent.");i.app.site.essentialsMap.extentManager.setExtentWithPriority(i.app.site.essentialsMap.initialExtent,8)}},1)}),this.app.command("ZoomToFullExtent").register(this,function(){setTimeout(function(){if(null!=i.app.map){if(null===i.app.site||!i.app.site.isInitialized||null===i.app.site.essentialsMap)return void i.app.trace.warning("Could not zoom to full extent - Site was null or uninitialized.");if(!i.app.site.essentialsMap.isInitialized||null===i.app.site.essentialsMap.fullExtent)return void i.app.trace.warning("Could not zoom to full extent - Map was not initialized or has no full extent.");i.app.site.essentialsMap.extentManager.setExtentWithPriority(i.app.site.essentialsMap.fullExtent,8)}},1)}),this.app.command("StepZoomIn").register(this,this._executeStepZoomIn),this.app.command("StepZoomOut").register(this,this._executeStepZoomOut)},d.prototype._executeAddMapService=function(e){this.app.site.essentialsMap.addMapService(e)},d.prototype._canExecuteRemoveMapService=function(t){return!!(this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.mapServices&&this.app.site.essentialsMap.mapServices.some(function(e){return e.isUserCreated&&e.serviceLayer===t.serviceLayer}))},d.prototype._executeRemoveMapService=function(e){e.catalogId?this.app.command("RemoveLayerCatalogItem").execute(e):this.app.site.essentialsMap.removeMapService(e),this.app.event("UserAddedLayerOrMapServiceRemovedEvent").publish(e)},d.prototype._executeRemoveUserAddedLayer=function(e){e.catalogId?this.app.command("RemoveLayerCatalogItem").execute(e):this.app.site.essentialsMap.removeMapService(e.mapService);var t=this.app.viewManager.getViewById("LayerActionsView");t&&this.app.viewManager.deactivateView(t),this.app.event("UserAddedLayerOrMapServiceRemovedEvent").publish(e)},d.prototype._userAddedLayerOrMapServiceRemoved=function(e){var n=this;if(e){var t=new Array;e instanceof s.Layer?t.push(e):e instanceof r.MapService&&e.layers.forEach(function(e){t.push(e)});var i=this.app.featureSetManager.featureSetCollections;i&&0<i.getLength()&&i.get().forEach(function(o){t.forEach(function(e){if(o.featureSets&&o.featureSets.get()&&0<o.featureSets.getLength())for(var t=0,i=o.featureSets.get();t<i.length;t++){var a=i[t];if(a.layer===e){a.clearFeatures(),n.app.event("_featureRemovedFromResults").publish(),o.featureSets.removeItem(a),n.app.command("_updateMetadataForSavedSelections").execute(o);break}}})})}},d.prototype._canExecuteRemoveUserAddedLayer=function(e){if(!e||!e.isUserCreated)return!1;if(e.catalogId)return this._canRemoveCatalogLayer(e);var t=e.mapService;return t.mapServiceType===o.MapServiceType.FEATURE||t.drawingBehavior===o.DrawingBehavior.FEATURE_LAYER||t.drawingBehavior===o.DrawingBehavior.WFS_LAYER||t.drawingBehavior===o.DrawingBehavior.STREAM_LAYER},d.prototype._canRemoveCatalogLayer=function(e){return e&&e.isUserCreated&&0<e.mapService.layers.length&&!String.isNullOrEmpty(e.catalogId)},d.prototype._executeStepZoomOut=function(){this.app.command("ShowMap").execute(),this._zoomedExtent=n.stepZoomWithPriority(this.app.site,this.stepZoomFactor,this._zoomedExtent,5)},d.prototype._executeStepZoomIn=function(){this.app.command("ShowMap").execute(),this._zoomedExtent=n.stepZoomWithPriority(this.app.site,1/this.stepZoomFactor,this._zoomedExtent,5)},d.prototype._subscribeToMapEvents=function(){dojo.connect(this.app.map,"onPanEnd",this,function(){this._zoomedExtent=null}),dojo.connect(this.app.map,"onZoomEnd",this,function(){this._zoomedExtent=null})},d);function d(e,t){var i=l.call(this,e,t)||this;return i._zoomedExtent=null,i.showMap=new a.Observable(!0),i.showError=new a.Observable(!1),i.showAuthError=new a.Observable(!1),i.showCriticalServicesError=new a.Observable(!1),i.siteFailed=new a.Observable(!1),i.temporaryGraphicsLayer=null,i.temporaryMarkupSymbol=null,i.stepZoomFactor=.5,i.registerCommands(),i}t.MapViewModel=u})},"Mapping/modules/Map/RippleClick":function(){define(["require","exports","geocortex/framework-ui/animation/Animation","geocortex/infrastructure/tools/MapTool"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="rippleClickElem",a=(o.prototype.initialize=function(e){var t=this;-1!==navigator.appVersion.indexOf("MSIE 10")||$(document.documentElement).hasClass("dj_ie9")?(this.rippleClickEnabled=!1,this.app.trace.debug("Ripple Click disabled on browsers that do not support the pointer-events css property.")):e.rippleClick||null==e.rippleClick?this.rippleClickEnabled=!0:this.rippleClickEnabled=!1,this.app.waitUntilSiteInitializing().then(function(){t.registerEventsAndCommands()})},o.prototype.registerEventsAndCommands=function(){var t=this;this._addEventListener(this.mapContainer,"click",function(e){t._stopRippleClick(),t.app.command("RippleClick").execute(e)}),this.app.command("RippleClick").register(this,this._executeRippleClick,this._canExecuteRippleClick),this.app.command("ToggleRippleClick").register(this,this._toggleRippleClick),this.app.command("DisableRippleClick").register(this,this._disableRippleClick),this.app.command("EnableRippleClick").register(this,this._enableRippleClick),this._addEventListener(this.mapContainer,"mousewheel",function(e){t._stopRippleClick()}),this.app.event("MapZoomStartedEvent").subscribe(this,function(){t._stopRippleClick()}),this.app.event("MapPanEvent").subscribe(this,function(){t._stopRippleClick(),t._disableThisRippleClick=!0}),this.app.event("MapPanEndedEvent").subscribe(this,function(){setTimeout(function(){t._disableThisRippleClick=!1},0)}),this.app.event("GraphicEditActivatedEvent").subscribe(this,function(){t.app.command("DisableRippleClick").execute()}),this.app.event("GraphicEditDeactivatedEvent").subscribe(this,function(){t.app.command("EnableRippleClick").execute()}),this.app.event("ActiveToolChangedEvent").subscribe(this,this._toolChanged)},o.prototype._toolChanged=function(e){var t=this;!e.tool||e.tool instanceof i.MapTool&&this._isPointIdentify(e.tool)?(this.app.command("EnableRippleClick").execute(),this._disableThisRippleClick=!0,setTimeout(function(){t._disableThisRippleClick=!1},0)):this.app.command("DisableRippleClick").execute()},o.prototype._isPointIdentify=function(e){return"Identify"===e.command&&("POINT"===e.drawMode||"MULTIPOINT"===e.drawMode)},o.prototype._canExecuteRippleClick=function(e){return!(!this.rippleClickEnabled||!this._clickHitMap(e)||this._disableThisRippleClick&&!(this._disableThisRippleClick=!1))},o.prototype._clickHitMap=function(e){return e.target===this.app.map._layersDiv||e.target===this.app.map._gc._surface.rawNode||-1<(" "+e.target.className+" ").indexOf(" region ")||!!e.graphic},o.prototype._stopRippleClick=function(){var e=this;$("#"+r)[0]&&this.animation&&this.animation.stop().then(function(){e.animation=null})},o.prototype._executeRippleClick=function(e){if(null==this.animation){var t;this.parent||(this.parent=$(this.mapDiv)),this.rippleElem?t=$(this.rippleElem):(this.parent.append($("<span></span>").attr("id",r)),t=this.parent.find("#"+r),this.rippleElem=t[0]);var i=Math.max(this.parent.width(),this.parent.height());t.css({width:i,height:i});var a=e.pageX-this.parent.offset().left-t.width()/2,o=e.pageY-this.parent.offset().top-t.width()/2;t.css({left:a+"px",top:o+"px"}),this.animation=n.create(t.get()[0]),this.animation.setResets(!0).add({className:"animate"}).play(),this.app.trace.debug("Executed a Ripple Click")}},o.prototype._toggleRippleClick=function(){this.rippleClickEnabled=!this.rippleClickEnabled},o.prototype._disableRippleClick=function(){this.rippleClickEnabled=!1},o.prototype._enableRippleClick=function(){this.rippleClickEnabled=!0},o.prototype._addEventListener=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},o);function o(e,t,i){this.rippleClickEnabled=!0,this._disableThisRippleClick=!1,this.app=e,this.mapDiv=t,this.mapContainer=i}t.RippleClick=a})},"Mapping/modules/Map/ScaleSharingLinkProvider":function(){var a,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/sharing/SharingLinkProviderBase"],function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=(o=a.SharingLinkProviderBase,r(n,o),n.prototype.generate=function(){return this.app.map.extent?this.app.map.getScale().toString():""},n.prototype.apply=function(e){var t=this;if(e){var i=parseFloat(e);isNaN(i)?this.app.trace.warning("Unable to parse the scale parameter {0}: expected a single number value.".format(e)):this.app.waitUntilShellStabilized().then(function(){t.app.site.essentialsMap.extentManager.setScaleWithPriority(i,7)})}},n);function n(e,t){var i=o.call(this,e,t)||this;return i.name="scale",i.priority=a.ExtentLinkPriority.SCALE,i}t.ScaleSharingLinkProvider=i})},"Mapping/modules/Map/MapContextMenu/MapContextMenuView":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/commandArgs/ShowMapElementArgs"],function(e,t,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=(a=i.ViewBase,s(r,a),r.prototype.activated=function(){this._stopMapClicks()},r.prototype.deactivated=function(){this._enableMapClicks(),this._removePushPin()},r.prototype._stopMapClicks=function(){this.app.event("FlyoutActivated").publish(this)},r.prototype._enableMapClicks=function(){this.app.event("FlyoutDeactivated").publish(this)},r.prototype._contextMenuDeactivatedHandler=function(){this.isActive&&(this._removePushPin(),this._enableMapClicks())},r.prototype._smallBottomPanelClosedHandler=function(){this.isActive&&this._enableMapClicks()},r.prototype._updatePointInfo=function(e){this._showPushPin(e)},r.prototype._deactivateContextMenu=function(){this.app.command("DeactivateContextMenu").execute()},r.prototype._showPushPin=function(e){var t=document.createElement("div"),i=document.createElement("img");i.src="Resources/Images/Pushpins/map-marker-green-32.png",i.style.pointerEvents="none",t.appendChild(i);var a=new o.ShowMapElementArgs(this._pushPinId,e,t);this.app.command("ShowMapElement").execute(a),this.app.configuration.mobileMode?this.app.command("PanToPoint").execute(e):this.app.event("MapExtentChangingEvent").once(this,this._handleExtentChangedEvent)},r.prototype._removePushPin=function(){this.app.isShuttingDown||this.app.command("HideMapElement").execute(this._pushPinId)},r.prototype._handleExtentChangedEvent=function(){this._deactivateContextMenu(),this._removePushPin()},r);function r(e,t){var i=a.call(this,e,t)||this;return i._pushPinId="MapContextMenuPushPin",i.app.event("MapContextMenuPointUpdatedEvent").subscribe(i,i._updatePointInfo),i.app.configuration.mobileMode?i.app.event("SmallBottomPanelClosedEvent").subscribe(i,i._smallBottomPanelClosedHandler):i.app.event("ContextMenuDeactivated").subscribe(i,i._contextMenuDeactivatedHandler),i}t.MapContextMenuView=n})},"Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView":function(){var a,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/menus/MenuView"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=(a=i.MenuView,r(n,a),n.prototype.attach=function(e){a.prototype.attach.call(this,e),this.title.set(this.getResource("language-menu-map-context-menu-title"))},n.prototype.resolveWidget=function(e,t,i){if(a.prototype.resolveWidget.call(this,e,t),"MapContextMenuWidget"===e)return this.app.menuRegistry.createMenuWidget(this,t,i)},n.prototype._deactivateContextMenu=function(){this.app.command("DeactivateContextMenu").execute()},n.prototype.handleMenuItemClick=function(e,t,i){this.app.configuration.mobileMode||this._deactivateContextMenu(),a.prototype.handleMenuItemClick.call(this,e,t,i)},n);function n(){return null!==a&&a.apply(this,arguments)||this}t.MapMenuView=o})},"Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuViewModel":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/menus/MenuViewModel","geocortex/framework/observables"],function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=(o=i.MenuViewModel,s(r,o),r.prototype.initialize=function(e){o.prototype.initialize.call(this,e),e.showMenu&&this.app.menuRegistry.getMenu("MapContextMenu")&&(this.showMenu.set(!0),this.app.event("MapContextMenuPointUpdatedEvent").subscribe(this,this._updatePointInfo))},r.prototype._updatePointInfo=function(e){this.mapPoint.set(e)},r);function r(){var e=null!==o&&o.apply(this,arguments)||this;return e.showMenu=new a.Observable(!1),e.mapPoint=new a.Observable,e}t.MapMenuViewModel=n})},"Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesViewModel":function(){var a,p=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/coordinates/CoordinateUtils"],function(e,t,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewModelBase,p(s,n),s.prototype.initialize=function(e){n.prototype.initialize.call(this,e),e.showCoordinates&&(this._isActive=!0,this.app.event("MapContextMenuPointUpdatedEvent").subscribe(this,this._updatePointInfo))},s.prototype._updatePointInfo=function(e){var a=this;this._isActive&&this.app.coordinatesManager.getCoordinate(e).then(function(e){var t,i;switch(e.targetCoordinateSystem.output){case"xy":t=o.getResource(a.app,"x"),i=o.getResource(a.app,"y");break;case"mgrs":t=o.getResource(a.app,"MGRS"),i=null;break;case"usng":t=o.getResource(a.app,"USNG"),i=null;break;default:t=o.getResource(a.app,"latitude-abbrev"),i=o.getResource(a.app,"longitude-abbrev")}a.xType.set(t+":"),a.yType.set(i?i+":":null),a.xValue.set(e.formattedGeoCoordString?e.formattedGeoCoordString.coordinateValue:e.formattedLatitudeOrX),a.yValue.set(null===a.yType.get()?null:e.formattedLongitudeOrY),a.showCoordinates.set(!0)},function(e){a.app.trace.warning(e.message),a.showCoordinates.set(!1)})},s);function s(){var e=null!==n&&n.apply(this,arguments)||this;return e.showCoordinates=new a.Observable(!1),e.xValue=new a.Observable,e.yValue=new a.Observable,e.xType=new a.Observable(""),e.yType=new a.Observable(""),e._isActive=!1,e}t.CoordinatesViewModel=r})},"Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeViewModel":function(){var a,p=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/ReverseGeocoder"],function(e,t,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewModelBase,p(s,n),s.prototype.initialize=function(e){var t=this;n.prototype.initialize.call(this,e),e.showReverseGeocoder&&this.app.waitUntilApplicationReady().then(function(){t._handleSiteInitialized()})},s.prototype._handleSiteInitialized=function(){var e=this.app.site.geocodingEndpoints;if(e)for(var t=0,i=e;t<i.length;t++){var a=i[t];if(a.isDefaultReverseGeocoder){this._endpoint=a;break}}this._endpoint&&(this.showReverseGeocoder.set(!0),this.reverseGeocoder=new o.ReverseGeocoder(this.app,this._endpoint),this.label.set(this.getResource("language-map-context-menu-reverse-geocode-label")),this.app.event("MapContextMenuPointUpdatedEvent").subscribe(this,this._updatePointInfo))},s.prototype._updatePointInfo=function(e){var t=this;this.app.isOffline.get()?this.showReverseGeocoder.set(!1):(this.showReverseGeocoder.set(!0),this.address.set(this.getResource("language-map-context-menu-reverse-geocode-search-in-progress")),this.isSearching.set(!0),this.reverseGeocoder.reverseGeocode(e).then(function(e){t.isSearching.set(!1),e&&e.address?t.address.set(e.address):t._handleResultError()},function(e){t.isSearching.set(!1),t._handleResultError()}))},s.prototype._handleResultError=function(){this.address.set(this.getResource("language-map-context-menu-reverse-geocode-search-no-result"))},s);function s(){var e=null!==n&&n.apply(this,arguments)||this;return e.showReverseGeocoder=new a.Observable(!1),e.label=new a.Observable,e.address=new a.Observable,e.isSearching=new a.Observable(!1),e}t.ReverseGeocodeViewModel=r})},"url:/Mapping/modules/Map/MapContextMenu/MapContextMenuView.html":t,"url:/Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesView.html":i,"url:/Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView.html":a,"url:/Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeView.html":o,"url:/Mapping/modules/Map/MapHostView.html":n,"url:/Mapping/modules/Map/MapView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Map/CSS/common.css","css","DQovKiBNQVAgKENPTU1PTikgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5tYXAsDQoubWFwLXJlZ2lvbiB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICAvKnotaW5kZXg6IDEwMDsqLw0KfQ0KDQoubWFwLXRvcC1sZWZ0IHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgbGVmdDogMDsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi5tYXAtdG9wLWxlZnQubWFwLXRvcC1oaWRkZW4gew0KICAgIHRvcDogMy4wNWVtOw0KfQ0KDQoubWFwLXRvcCB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQoubm8tdG91Y2ggLm1hcC10b3AtbGVmdCB7DQogICAgLyp0b3A6IDMuMDVlbTsqLw0KfQ0KDQoubWFwLWJvdHRvbS1sZWZ0IHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYm90dG9tOiAwZW07DQogICAgbGVmdDogMGVtOw0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBmbG9hdDogbGVmdDsNCn0NCg0KLm1hcC1ib3R0b20tbGVmdCAuYWN0aXZlIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2sgIWltcG9ydGFudDsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOw0KfQ0KDQoubWFwIC5iaW5nTG9nby1sZyB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL2JpbmctbG9nby03MHg0MC5wbmciKTsNCiAgICBsZWZ0OiAwOw0KICAgIHdpZHRoOiA3MHB4Ow0KICAgIGhlaWdodDogNDBweDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgei1pbmRleDogMTsNCn0NCg0KLm1hcC1uYXZpZ2F0aW9uLXJlZ2lvbiB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBtYXgtaGVpZ2h0OiA0MCU7DQogICAgbWF4LXdpZHRoOiA1MCU7DQogICAgLyp6LWluZGV4OiAxMDE7Ki8NCiAgICBtYXJnaW4tbGVmdDogMy45ZW07DQp9DQoNCi5uby10b3VjaCAubWFwLW5hdmlnYXRpb24tcmVnaW9uIHsNCiAgICBtYXJnaW4tbGVmdDogMy4xZW07DQp9DQoNCi5tYXAtYmFzZW1hcC1yZWdpb24gew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIG1hcmdpbjogNXB4IDVweCAwIDVweDsNCiAgICBtYXgtd2lkdGg6IDYwJTsNCn0NCg0KLm1hcC10b3AtY2VudGVyIHsNCiAgICB0b3A6IDA7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQoubWFwLXRvcC1yaWdodCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHRvcDogMDsNCiAgICByaWdodDogMDsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQoubWFwLXRvcC1yaWdodCA+IC52aWV3IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCn0NCg0KLm1hcC1taWRkbGUtbGVmdCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGxlZnQ6IDA7DQogICAgdG9wOiA1MCU7DQp9DQoNCi5tYXAtbWlkZGxlLXJpZ2h0IHsNCiAgICByaWdodDogMDsNCn0NCg0KLm1hcC1ib3R0b20tY2VudGVyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYm90dG9tOiAwOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogYXV0bzsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQp9DQoNCi5zdGF0dXMtd2luZG93IHsNCiAgICBwb2ludGVyLWV2ZW50czogYXV0bzsNCn0NCg0KLm1hcC1ib3R0b20tY2VudGVyIC52aWV3LmFjdGl2ZSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB6LWluZGV4OiAyMTA7DQp9DQoNCi5tYXAtYm90dG9tLXJpZ2h0IHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYm90dG9tOiAwLjRlbTsNCiAgICByaWdodDogMGVtOw0KICAgIHdpZHRoOiBhdXRvOw0KICAgIGhlaWdodDogYXV0bzsNCn0NCg0KLm1hcC1lcnJvciB7DQogICAgcGFkZGluZzogMWVtOw0KfQ0KDQogICAgLm1hcC1lcnJvciBkaXYgew0KICAgICAgICBwYWRkaW5nLWxlZnQ6IDQwcHg7DQogICAgICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9Ub29sYmFyL3N0b3AtMzIucG5nIikgbm8tcmVwZWF0IHRvcCBsZWZ0Ow0KICAgIH0NCg0KICAgIC5tYXAtZXJyb3IgaDIgew0KICAgICAgICBmb250LXNpemU6IDEuMWVtOw0KICAgIH0NCg0KLk1hcFZpZXcgew0KICAgIGhlaWdodDogMTAwJTsNCn0NCg0KLnZpZXdlci1sb2FkZXItZXJyb3IgLk1hcFZpZXcgew0KICAgIHBhZGRpbmctdG9wOiA1ZW07DQp9DQoNCi5tYXAta2V5Ym9hcmQtZm9jdXMgPiBkaXYgew0KICAgIGJvcmRlcjogbm9uZSAhaW1wb3J0YW50Ow0KfQ0KDQovKlJpcHBsZSBjbGljayBhbmltYXRpb24gaW5zcGlyZWQgYnkgdGhlIEJvcmlzIEFuaW1hdGlvbiBodHRwOi8vdHltcGFudXMubmV0L0RldmVsb3BtZW50L0NsaWNrRWZmZWN0cy8qLw0KDQovKiBSaXBwbGUgQ2xpY2sgYW5pbWF0aW9uIHN0eWxpbmcgKi8NCiNyaXBwbGVDbGlja0VsZW0gew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBiYWNrZ3JvdW5kOiAjMUE3MkM0OyAvKiBWaWV3ZXIgYmx1ZSAqLw0KICAgIGJvcmRlci1yYWRpdXM6IDEwMCU7DQogICAgLW1zLXRyYW5zZm9ybTogc2NhbGUoMCk7DQogICAgdHJhbnNmb3JtOiBzY2FsZSgwKTsNCiAgICBvcGFjaXR5OiAwLjc1Ow0KICAgIHotaW5kZXg6MTsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCg0KLypSaXBwbGUgY2xpY2sgYW5pbWF0aW9uIGVmZmVjdCovDQovKiAgYWRkaW5nIHRoZSBhbmltYXRlIGNsYXNzIHRvIGEgcmlwcGxlIGNsaWNrIGVsZW1lbnQgdHJpZ2dlcnMgdGhlIGFuaW1hdGlvbi4gDQogICAgVGhlIGVsZW1lbnQgZ3Jvd3MgaW4gc2l6ZSBhbmQgc2ltdWx0YW5lb3VzbHkgZmFkZXMuDQogICAgSSB1c2UgdGhpcyBpbiBjb21iaW5hdGlvbiB3aXRoIHRoZSBBbmltYXRpb24gRnJhbWV3b3JrIHRvIGNyZWF0ZSBhIHJpcHBsZSBjbGljayAqLw0KI3JpcHBsZUNsaWNrRWxlbS5hbmltYXRlIHsNCiAgICAtd2Via2l0LXRyYW5zaXRpb246IGFsbCAwLjVzIGN1YmljLWJlemllcigwLCAwLCAwLCAxLjAyKTsgDQogICAgdHJhbnNpdGlvbjogYWxsIDAuNXMgY3ViaWMtYmV6aWVyKDAsIDAsIDAsIDEuMDIpOyAvKnRoZSBhbmltYXRpb24gZnVuY3Rpb24qLw0KICAgIG9wYWNpdHk6IDA7DQp9DQoNCkBtZWRpYSBhbGwgYW5kICggbWluLXdpZHRoOiAwcHgpIHsNCiAgICAjcmlwcGxlQ2xpY2tFbGVtLmFuaW1hdGUgew0KICAgICAgICAtbXMtdHJhbnNmb3JtOiBzY2FsZSgwLjE1KTsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHNjYWxlKDAuMTUpOw0KICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDAuMTUpOyAvKnRoZSBzaXplIG9mIHRoZSByaXBwbGUqLw0KICAgIH0NCn0NCg0KQG1lZGlhIGFsbCBhbmQgKCBtaW4td2lkdGg6IDUwMHB4KSB7DQogICAgI3JpcHBsZUNsaWNrRWxlbS5hbmltYXRlIHsNCiAgICAgICAgLW1zLXRyYW5zZm9ybTogc2NhbGUoMC4xKTsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHNjYWxlKDAuMSk7DQogICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMC4xKTsgLyp0aGUgc2l6ZSBvZiB0aGUgcmlwcGxlKi8NCiAgICB9DQp9DQoNCkBtZWRpYSBhbGwgYW5kICggbWluLXdpZHRoOiAxMDAwcHgpIHsNCiAgICAjcmlwcGxlQ2xpY2tFbGVtLmFuaW1hdGUgew0KICAgICAgICAtbXMtdHJhbnNmb3JtOiBzY2FsZSgwLjA3NSk7DQogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiBzY2FsZSgwLjA3NSk7DQogICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMC4wNzUpOyAvKnRoZSBzaXplIG9mIHRoZSByaXBwbGUqLw0KICAgIH0NCn0NCg0KQG1lZGlhIGFsbCBhbmQgKCBtaW4td2lkdGg6IDE1MDBweCkgew0KICAgICNyaXBwbGVDbGlja0VsZW0uYW5pbWF0ZSB7DQogICAgICAgIC1tcy10cmFuc2Zvcm06IHNjYWxlKDAuMDUpOw0KICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogc2NhbGUoMC4wNSk7DQogICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMC4wNSk7IC8qdGhlIHNpemUgb2YgdGhlIHJpcHBsZSovDQogICAgfQ0KfQ0KLyogTWFwIEVsZW1lbnRzIHBvc2l0aW9uaW5nL3NwYWNpbmcsIHJlZ2lvbiBzcGVjaWZpYyAqLw0KLnJlZ2lvbi5tYXAtbmF2aWdhdGlvbi1yZWdpb24gLnZpZXcsDQoucmVnaW9uLmZvb3Rlci1sZWZ0IC52aWV3LA0KLnJlZ2lvbi5tYXAtdG9wLWxlZnQgLnZpZXcsDQoucmVnaW9uLm1hcC1jZW50ZXItbGVmdCAudmlldywNCi5yZWdpb24ubWFwLWJvdHRvbS1sZWZ0IC52aWV3IHsNCiAgICBtYXJnaW46IDAuMzhlbSAwZW0gMC40ZW0gMC40ZW07DQp9DQoNCi5yZWdpb24uZm9vdGVyLWxlZnQgLnZpZXcgew0KICAgIG1hcmdpbi10b3A6IDA7DQogICAgbWFyZ2luLWJvdHRvbTogMDsNCn0NCg0KLnJlZ2lvbi5mb290ZXItcmlnaHQgLnZpZXcsDQoucmVnaW9uLm1hcC10b3AtcmlnaHQgLnZpZXcsDQoucmVnaW9uLm1hcC1jZW50ZXItcmlnaHQgLnZpZXcsDQoucmVnaW9uLm1hcC1ib3R0b20tcmlnaHQgLnZpZXcgew0KICAgIG1hcmdpbjogMC4zOGVtIDAuNGVtIDAuNGVtIDBlbTsNCn0NCg0KLnJlZ2lvbi5tYXAtYm90dG9tLXJpZ2h0IC52aWV3IHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQoucmVnaW9uLmZvb3Rlci1yaWdodCAudmlldyB7DQogICAgbWFyZ2luLXRvcDogMDsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQoucmVnaW9uLmZvb3Rlci1yZWdpb24gLnZpZXcgYnV0dG9uIHsNCiAgICBib3JkZXI6IDA7DQogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7DQp9DQoNCiAgICAucmVnaW9uLmZvb3Rlci1yZWdpb24gLnZpZXcgYnV0dG9uOmhvdmVyIHsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjsNCiAgICB9DQoNCi8qI3JlZ2lvbiBNYXAgQ29udGV4dCBNZW51ICovDQoNCi5jb250ZXh0LW1lbnUtcmVnaW9uIC5NYXBDb250ZXh0TWVudVZpZXcgew0KICAgIHdpZHRoOiAxNWVtOw0KfQ0KDQouY29udGV4dC1tZW51LXJlZ2lvbiAuTWFwQ29udGV4dE1lbnVWaWV3IC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgcGFkZGluZy1sZWZ0OiAwLjVlbTsNCn0NCg0KLmNvbnRleHQtbWVudS1yZWdpb24ub2Zmc2V0LXVwIC5NYXBDb250ZXh0TWVudVZpZXcgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IC00MHB4Ow0KfQ0KDQoubWFwLW1lbnUtcmV2ZXJzZS1nZW9jb2RlIHsNCiAgICAvKiBQcmV2ZW50cyBjbGljayBvbiB0aGUgYWRkcmVzcyBvcGVuaW5nIEdvb2dsZSBNYXBzIGFwcGxpY2F0aW9uIG9uIEFuZHJvaWQgKi8NCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCg0KLyojZW5kcmVnaW9uICov"),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/CSS/medium.css","css","Lm1hcC10b3AtbGVmdC5tYXAtdG9wLWhpZGRlbiB7DQogICAgdG9wOiAzLjg1ZW07DQp9DQo="),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/CSS/small.css","css","LyogTUFQIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoubm8tdG91Y2ggLm1hcC1uYXZpZ2F0aW9uLXJlZ2lvbiwNCi5tYXAtbmF2aWdhdGlvbi1yZWdpb24gew0KICAgIG1hcmdpbjogMDsNCiAgICBtYXgtd2lkdGg6IDgwJTsNCn0NCg0KLnZpZXdlci1sb2FkZXItZXJyb3IgLk1hcFZpZXcgew0KICAgIHBhZGRpbmctdG9wOiAwOw0KfQ0KDQovKiBCRUdJTjogVG9wIG1hcCByZWdpb24gKGNvbXBhY3QgdG9vbGJhcikgLSBzbGlkZSB1cCBhbmQgZG93biAqLw0KDQoubWFwLXRvcC1zbGlkZS1kb3duIHsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDFweCk7DQogICAgYW5pbWF0aW9uOiBtYXAtdG9wLXNsaWRlLWRvd24gMTAwbXMgZm9yd2FyZHM7DQogICAgYW5pbWF0aW9uLWRlbGF5OiA0MDBtczsNCiAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBlYXNlLWluOw0KfQ0KDQoubWFwLXRvcC1zbGlkZS11cCB7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAxcHgpOw0KICAgIGFuaW1hdGlvbjogbWFwLXRvcC1zbGlkZS11cCAxMDBtcyBmb3J3YXJkczsNCiAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiBlYXNlLW91dDsNCn0NCg0KQGtleWZyYW1lcyBtYXAtdG9wLXNsaWRlLWRvd24gew0KICBmcm9tIHsNCiAgICB0b3A6IDBlbTsNCiAgfQ0KDQogIHRvIHsNCiAgICB0b3A6IDEuN2VtOw0KICB9DQp9DQoNCkBrZXlmcmFtZXMgbWFwLXRvcC1zbGlkZS11cCB7DQogIGZyb20gew0KICAgIHRvcDogMS43ZW07DQogIH0NCg0KICB0byB7DQogICAgdG9wOiAwZW07DQogIH0NCn0NCi8qIEVORDogVG9wIG1hcCByZWdpb24gKGNvbXBhY3QgdG9vbGJhcikgLSBzbGlkZSB1cCBhbmQgZG93biAqLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/MapContextMenu/MapContextMenuView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView.html","html",a),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/MapHostView.html","html",n),e.resourceManager.register("Mapping","inv","Mapping/modules/Map/MapView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Map/CenterSharingLinkProvider","Mapping/modules/Map/ExtentSharingLinkProvider","Mapping/modules/Map/MapCoordinatesController","Mapping/modules/Map/MapExtentLog","Mapping/modules/Map/MapHostView","Mapping/modules/Map/MapModule","Mapping/modules/Map/MapView","Mapping/modules/Map/MapViewModel","Mapping/modules/Map/ScaleSharingLinkProvider","Mapping/modules/Map/MapContextMenu/MapContextMenuView","Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesViewModel","Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeViewModel","Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView","Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuViewModel"],function(e,t,i,a,o,n,r,s,p,c,l,u,d,h){m(e,"geocortex.essentialsHtmlViewer.mapping.modules.map.CenterSharingLinkProvider",e.CenterSharingLinkProvider),m(t,"geocortex.essentialsHtmlViewer.mapping.modules.map.ExtentSharingLinkProvider",t.ExtentSharingLinkProvider),m(i,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapCoordinatesController",i.MapCoordinatesController),m(a,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapExtentLog",a.MapExtentLog),m(o,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapHostView",o.MapHostView),m(n,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapModule",n.MapModule),m(r,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapView",r.MapView),m(s,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapViewModel",s.MapViewModel),m(p,"geocortex.essentialsHtmlViewer.mapping.modules.map.ScaleSharingLinkProvider",p.ScaleSharingLinkProvider),m(c,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapContextMenuView",c.MapContextMenuView),m(l,"geocortex.essentialsHtmlViewer.mapping.modules.map.CoordinatesViewModel",l.CoordinatesViewModel),m(u,"geocortex.essentialsHtmlViewer.mapping.modules.map.ReverseGeocodeViewModel",u.ReverseGeocodeViewModel),m(d,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapMenuView",d.MapMenuView),m(h,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapMenuViewModel",h.MapMenuViewModel)})}();