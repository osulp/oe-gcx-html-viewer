function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var a=t.split("."),n=null,o=window,r=0,s=a.length;r<s;r++)n=a[r],r==s-1?o[n]=i:o[n]||(o[n]={}),o=o[n]}require({cache:{"Mapping/modules/Map/CenterSharingLinkProvider":function(){define(["require","exports","geocortex/infrastructure/sharing/SharingLinkProviderBase","geocortex/infrastructure/MapUtils"],function(e,t,i,a){"use strict";var n=function(e){function t(t,a){var n=e.call(this,t,a)||this;return n._separator=",",n.name="center",n.priority=i.ExtentLinkPriority.CENTER,n}return __extends(t,e),t.prototype.generate=function(){if(!this.app.map.extent)return"";var e=this.app.map.extent.getCenter();return"{1}{0}{2}".format(this._separator,e.x,e.y)},t.prototype.apply=function(e){var t=this;if(e){var i=e.split(this._separator);i.length>=2?this.app.site&&this.app.site.serviceLayersLoaded?this._applyCenter(i):this.app.event("SiteServiceLayersLoadedEvent").once(this,function(){t._applyCenter(i)}):this.app.trace.warning("Unable to parse the center parameter {0}: expected two comma separated number values.".format(e))}},t.prototype._applyCenter=function(e){for(var t=0;t<e.length;t++)if(isNaN(parseFloat(e[t])))return void this.app.trace.warning("Unable to parse the center parameter value '{0}': invalid number value.".format(e[t]));var i=new esri.geometry.Point(parseFloat(e[0]),parseFloat(e[1]));e.length>=3&&!isNaN(parseInt(e[2]))?i.spatialReference=new esri.SpatialReference(parseInt(e[2])):this.app.map&&this.app.map.spatialReference&&(i.spatialReference=this.app.map.spatialReference),a.panToPointWithPriority(this.app,i,7,!0)},t}(i.SharingLinkProviderBase);t.CenterSharingLinkProvider=n})},"Mapping/modules/Map/ExtentSharingLinkProvider":function(){define(["require","exports","geocortex/infrastructure/sharing/SharingLinkProviderBase","geocortex/infrastructure/MapUtils"],function(e,t,i,a){"use strict";var n=function(e){function t(t,a){var n=e.call(this,t,a)||this;return n._separator=",",n.name="extent",n.priority=i.ExtentLinkPriority.EXTENT,n}return __extends(t,e),t.prototype.generate=function(){if(!this.app.map.extent)return"";var e=this.app.map.extent;return"{1}{0}{2}{0}{3}{0}{4}".format(this._separator,e.xmin,e.ymin,e.xmax,e.ymax)},t.prototype.apply=function(e){var t=this;if(e){var i=e.split(this._separator);i.length>=4?this.app.site&&this.app.site.serviceLayersLoaded?this._applyExtent(i):this.app.event("SiteServiceLayersLoadedEvent").once(this,function(){t._applyExtent(i)}):this.app.trace.warning("Unable to parse the extent parameter '{0}': expected four comma separated number values.".format(e))}},t.prototype._applyExtent=function(e){for(var t=0;t<e.length;t++)if(isNaN(parseFloat(e[t])))return void this.app.trace.warning("Unable to parse the extent parameter value '{0}': invalid number value.".format(e[t]));var i=new esri.geometry.Extent(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),new esri.SpatialReference(4326));e.length>=5&&!isNaN(parseInt(e[4]))?i.setSpatialReference(new esri.SpatialReference(parseInt(e[4]))):this.app.map&&this.app.map.spatialReference&&i.setSpatialReference(this.app.map.spatialReference),a.zoomToExtentWithPriority(this.app,i,7,!0)},t}(i.SharingLinkProviderBase);t.ExtentSharingLinkProvider=n})},"Mapping/modules/Map/MapCoordinatesController":function(){define(["require","exports","geocortex/framework/FrameworkObject","geocortex/infrastructure/buffer/BufferUtils"],function(e,t,i,a){"use strict";var n=function(e){function t(t,i,a){var n=e.call(this,t,i)||this;return n._disabled=!1,n._supportedDisplayTypeConfig=["dd","ddm","dms","xy"],n.mapCoordinateDataModelId=a,n.app.coordinatesManager.getCoordinatesModel(n.mapCoordinateDataModelId).then(function(e){return n.initializeCoordinateDataModel(e)},function(e){return n._handleCoordinateModelError(e)}),n}return __extends(t,e),t.prototype.initializeCoordinateDataModel=function(e){var t=this;if(e){this._dataModel=e;var i=function(){t._processCoordinatesDataModel(),t._disabled||t.app.coordinatesManager.registerModel(t._dataModel,!0)};this.app.map&&this.app.map.loaded?i():this.app.event("MapLoadedEvent").once(this,i)}},t.prototype._processCoordinatesDataModel=function(){var e=this;if(this._dataModel){var t=this._dataModel.configuration,i=function(t,i,n,o){if(i&&"latlon"===i.trim().toLowerCase()&&(i="dd"),t&&i&&e._supportedDisplayTypeConfig.indexOf(i.trim())>=0&&(n||o)){var r={};if(r.displayName=t.trim(),r.output=i.trim(),n){if(r.wkid=n,"xy"!==i&&!a.isGeographicWkid(n))return void e.app.trace.error("Could not add coordinate system {0}. This coordinate system uses a geographic output type. Please configure a valid WKID for a geographic coordinate system.".format(t))}else o&&(r.wkt=o);e._dataModel.coordinateSystems.addItem(r)}else e.app.trace.error("Could not add coordinate system {0} due to a configuration error. Please check your configuration settings.".format(t))};if(t.defaultGcsWkid&&!isNaN(parseInt(t.defaultGcsWkid,10))&&(this._dataModel.defaultGcsWkid=parseInt(t.defaultGcsWkid,10)),t.defaultCoordinateDisplayTypes&&t.defaultCoordinateDisplayTypes.length&&t.defaultCoordinateDisplayTypes.forEach(function(t){var a=t.toLowerCase().trim();if(e._supportedDisplayTypeConfig.indexOf(a)>=0){var n=e._dataModel.defaultGcsWkid,o=e.getResource("language-map-coordinates-{0}".format(a.toUpperCase())),r=e.getResource("language-map-coordinates-WKID")+": "+n,s="";if("xy"===a){n=e.app.map.spatialReference.wkid,s=e.getResource("language-map-coordinates-default-coordinate-system-label");var r=n?e.getResource("language-map-coordinates-WKID")+": "+n:e.getResource("language-map-coordinates-WKT")}var p=s+" "+r+" "+o;i(p,a,n,e.app.map.spatialReference.wkt)}}),t.customCoordinateSystems&&t.customCoordinateSystems.length&&t.customCoordinateSystems.forEach(function(e){return i(e.displayName,e.output,e.wkid,e.wkt)}),0===this._dataModel.coordinateSystems.length())return void(this._disabled=!0);t.fractionalDigits&&!isNaN(parseInt(t.fractionalDigits,10))&&(this._dataModel.fractionalDigits=parseInt(t.fractionalDigits,10)),this._dataModel.currentCoordinateSystem.set(this._dataModel.coordinateSystems.getAt(0)),t.disableMouseLocationMonitoring||this._dataModel.isActive.bind(this,this._logCoordinates)}},t.prototype._logCoordinates=function(e){var t=this;this._disabled||(this._mouseMoveToken&&(this._mouseMoveToken.remove(),this._mouseMoveToken=null),this._keyboardMoveToken&&(this.app.event("EditVertexMovedEvent").unsubscribe(this._keyboardMoveToken),this._keyboardMoveToken=null),e&&(this._keyboardMoveToken=this.app.event("EditVertexMovedEvent").subscribe(this,function(e){e.mapPoint&&t._dataModel.inputStream.set(e.mapPoint)}),this._mouseMoveToken=this.app.map.on("mouse-move",function(e){t.app.map.snappingManager?t.app.map.snappingManager.getSnappingPoint(e.screenPoint).then(function(i){i?t._dataModel.inputStream.set(i):t._dataModel.inputStream.set(e.mapPoint)},function(i){t._dataModel.inputStream.set(e.mapPoint)}):t._dataModel.inputStream.set(e.mapPoint)})))},t.prototype._handleCoordinateModelError=function(e){this.app.trace.error("MapCoordinatesController: An error occurred while trying to retrieve the coordinatesModel {0}. Details of the error are: {1}".format(this.mapCoordinateDataModelId||"<unknown>",e.message))},t}(i.FrameworkObject);t.MapCoordinatesController=n})},"Mapping/modules/Map/MapExtentLog":function(){define(["require","exports","geocortex/infrastructure/MapUtils","geocortex/essentials/GeometryUtilities"],function(e,t,i,a){"use strict";var n=function(){function e(e,t,i){this._mapLoadedEventToken=null,this._previousExtentArray=[],this._nextExtentArray=[],this._currentExtent=null,this._pauseRecordExtentChange=!1,this._prevNextExtentCommandInProgress=!1,this._disableExtentChangeTimeoutId=null,this._maxLogEntries=100,this._extentChangeRecordDelayMs=500,this.app=e,this.libraryId=t,this._maxLogEntries=void 0!=i?i:this._maxLogEntries,this._maxLogEntries&&(this._mapLoadedEventToken=this.app.event("MapLoadedEvent").subscribe(this,this._onMapLoaded))}return e.prototype._onMapLoaded=function(){this.app.event("MapLoadedEvent").unsubscribe(this._mapLoadedEventToken),this.app.map.on("extent-change",dojo.hitch(this,this._recordExtentChange)),this.app.map.on("resize",dojo.hitch(this,this._onMapResized)),this._registerCommands()},e.prototype._onMapResized=function(){this._pauseRecordExtentChangeOperation()},e.prototype._registerCommands=function(){this.app.command("ZoomToPreviousExtent").register(this,this._executeZoomToPreviousExtent,this._canExecuteZoomToPreviousExtent),this.app.command("ZoomToNextExtent").register(this,this._executeZoomToNextExtent,this._canExecuteZoomToNextExtent)},e.prototype._canExecuteZoomToPreviousExtent=function(){return!this._prevNextExtentCommandInProgress&&0!==this._previousExtentArray.length},e.prototype._canExecuteZoomToNextExtent=function(){return!this._prevNextExtentCommandInProgress&&0!==this._nextExtentArray.length},e.prototype._executeZoomToPreviousExtent=function(){if(this._previousExtentArray.length){var e=this._previousExtentArray.pop();this._prevNextExtentCommandInProgress=!0,this._addExtentConditionally(this._nextExtentArray,this._currentExtent),this._currentExtent=e,i.zoomToExtent(this.app,this._currentExtent,!0),this._zoomToPrevNextExtentCanExecuteChanged()}},e.prototype._executeZoomToNextExtent=function(){if(this._nextExtentArray.length){var e=this._nextExtentArray.pop();this._prevNextExtentCommandInProgress=!0,this._addExtentConditionally(this._previousExtentArray,this._currentExtent),this._currentExtent=e,i.zoomToExtent(this.app,this._currentExtent,!0),this._zoomToPrevNextExtentCanExecuteChanged()}},e.prototype._recordExtentChange=function(e){this._pauseRecordExtentChange||this._prevNextExtentCommandInProgress||(this._currentExtent&&this._addExtentConditionally(this._previousExtentArray,this._currentExtent),this._nextExtentArray=[]),this._currentExtent=e.extent,this._pauseRecordExtentChangeOperation(this._extentChangeRecordDelayMs),this._prevNextExtentCommandInProgress=!1,this._zoomToPrevNextExtentCanExecuteChanged()},e.prototype._numLogEntries=function(){return this._previousExtentArray.length+this._nextExtentArray.length},e.prototype._addExtentConditionally=function(e,t){var i=this._numLogEntries();return this._isValidExtentObject(t)?(i>=this._maxLogEntries&&e.length&&e.shift(),void((!e.length||e.length&&!this._extentsEqual(e[e.length-1],t))&&e.push(new esri.geometry.Extent(t.toJson())))):void this.app.trace.error("MapExtentLog: Invalid extent specified. Could not add to extent log")},e.prototype._pauseRecordExtentChangeOperation=function(e){var t=this;this._disableExtentChangeTimeoutId&&(clearTimeout(this._disableExtentChangeTimeoutId),this._disableExtentChangeTimeoutId=null),this._pauseRecordExtentChange=!0,void 0!=e&&(this._disableExtentChangeTimeoutId=setTimeout(function(){t._pauseRecordExtentChange=!1},e))},e.prototype._extentsEqual=function(e,t){return e&&t&&e.spatialReference&&t.spatialReference&&e.xmin===t.xmin&&e.xmax===t.xmax&&e.ymin===t.ymin&&e.ymax===t.ymax&&a.spatialRefsAreEqual(e.spatialReference,t.spatialReference,!1)},e.prototype._isValidExtentObject=function(e){return!!(e&&e instanceof esri.geometry.Extent)||e&&"number"==typeof parseFloat(e.xmin)&&"number"==typeof parseFloat(e.xmax)&&"number"==typeof parseFloat(e.ymin)&&"number"==typeof parseFloat(e.ymax)&&e.spatialReference&&(e.spatialReference.wkid&&"number"==typeof parseInt(e.spatialReference.wkid,10)||e.spatialReference.wkt)},e.prototype._zoomToPrevNextExtentCanExecuteChanged=function(){this.app.command("ZoomToPreviousExtent").raiseCanExecuteChanged(),this.app.command("ZoomToNextExtent").raiseCanExecuteChanged()},e}();t.MapExtentLog=n})},"Mapping/modules/Map/MapHostView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(){this.app.event("ViewActivatedEvent").subscribe(this,this._activateMapHost),this.app.event("ViewDeactivatedEvent").subscribe(this,this._deactivateMapHost)},t.prototype._activateMapHost=function(e){"MapView"==e.id&&(this.app.command("ActivateView").execute(this.id),this.app.command("MapResize").execute())},t.prototype._deactivateMapHost=function(e){"MapView"==e.id&&this.app.command("DeactivateView").execute(this.id)},t}(i.ViewBase);t.MapHostView=a})},"Mapping/modules/Map/MapModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","./MapExtentLog","./MapCoordinatesController","geocortex/infrastructure/ArrayUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/PromiseUtils","geocortex/infrastructure/commandArgs/ProjectArgs","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/GraphicsLayerIds"],function(e,t,i,a,n,o,r,s,p,c,l,u,d,h,m){"use strict";var g=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a._subscribedToMapEvents=!1,a._config=null,a._isAndroid=!1,a._isAndroid3plus=!1,a._shownProjectError=null,a._showMapOnZoom=!0,a._showMapOnPan=!1,a._mapExtentLog=null,a._maxLogEntries=100,a._executeMapClickCommands=!0,a._mapClickTimerHandles=[],a._mapCoordinatesControllers=[],a._coordModelType="geocortex.essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinatesModel",a._recenterRetryIntervalMs=100,a._postCenterFixupDelay=1e3,a.registerCommands(),a._shownProjectError=!1,a.app.event("SiteInitializedEvent").subscribe(a,a._handleSiteInitialized),a.app.event("LayerUpdateStartedEvent").subscribe(a,a._handleLayerUpdateStart),a.app.event("LayerUpdateEndedEvent").subscribe(a,a._handleLayerUpdateEnd),a.app.event("LayerAddedEvent").subscribe(a,a._handleLayerAdded),a.app.event("LayerRemovedEvent").subscribe(a,a._handleLayerRemoved),a._isAndroid3plus=a._androidSieve(navigator.userAgent,3),a._isAndroid=$(document.documentElement).hasClass("dj_android"),a}return __extends(t,e),t.prototype.initialize=function(t){if(e.prototype.initialize.call(this,t),t||(t={}),t&&t.menus&&this.app.menuRegistry.loadMenus(t),t.hasOwnProperty("showLoadingStatus")||(t.showLoadingStatus=!0),t.hasOwnProperty("loadingMessageTiming")&&t.loadingMessageTiming.length||(t.loadingMessageTiming=[1e3,3e3,3e3]),t.hasOwnProperty("defaultPointFeatureZoomScales")&&t.defaultPointFeatureZoomScales.length||(t.defaultPointFeatureZoomScales=[]),t.hasOwnProperty("panDuration")){var i=parseInt(t.panDuration);isNaN(i)||(esri.config.defaults.map.panDuration=i)}if(t.hasOwnProperty("panRate")){var n=parseInt(t.panRate);isNaN(n)||(esri.config.defaults.map.panRate=n)}if(t.hasOwnProperty("zoomDuration")){var o=parseInt(t.zoomDuration);isNaN(o)||(esri.config.defaults.map.zoomDuration=o)}if(t.hasOwnProperty("zoomRate")){var r=parseInt(t.zoomRate);isNaN(r)||(esri.config.defaults.map.zoomRate=r)}this._initializeCoordinateModels(),t.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(t.tools,!0),t.hasOwnProperty("showMapOnZoom")&&(this._showMapOnZoom=t.showMapOnZoom),t.hasOwnProperty("showMapOnPan")&&(this._showMapOnPan=t.showMapOnPan),t.hasOwnProperty("maxExtentLogSize")&&(this._maxLogEntries=isNaN(parseInt(t.maxExtentLogSize,10))?this._maxLogEntries:parseInt(t.maxExtentLogSize,10)),this._config=t,this._mapExtentLog=new a.MapExtentLog(this.app,this.libraryId,this._maxLogEntries),this.app.event("MapLoadedEvent").subscribe(this,this.subscribeToMapEvents),dojo.subscribe("FeatureClickedEvent",this,this.featureClickHandler),dojo.subscribe("geoRssLayerLoaded",this,this._onGeoRssLayerLoaded)},t.prototype.registerCommands=function(){this.app.command("ZoomToLayerVisibleScale").register(this,this._executeZoomToVisibleScale),this.app.command("ZoomToLayerExtent").register(this,this._executeZoomToLayerExtent),this.app.command("PanToAllFeatures").register(this,this._executePanToAllFeatures),this.app.command("PanToFeature").register(this,this._executePanToFeature,function(e){return e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry}),this.app.command("PanToFeatureIfOutsideMapExtent").register(this,this._executePanToFeatureIfOutsideMapExtent,function(e){return e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry}),this.app.command("PanToPoint").register(this,this._executePanToPoint),this.app.command("Project").register(this,this._executeProject),this.app.command("RecenterMapOnNextMapResize").register(this,this._executeRecenterMapOnNextMapResize),this.app.command("ZoomOutToExtent").register(this,this._executeZoomOutToExtent),this.app.command("ZoomToFeatures").register(this,this._executeZoomToFeatures),this.app.command("ZoomToFeatureSetCollection").register(this,this._executeZoomToFeatureSetCollection),this.app.command("ZoomToAllFeatures").register(this,this._executeZoomToAllFeatures),this.app.command("ZoomToExtent").register(this,this._executeZoomToExtent),this.app.command("ZoomToFeature").register(this,this._executeZoomToFeature,this._canExecuteZoomToFeature),this.app.command("ZoomToFeatureIfOutsideMapExtent").register(this,this._executeZoomToFeatureIfOutsideMapExtent,this._canExecuteZoomToFeature),this.app.command("ZoomToScale").register(this,this._executeZoomToScale),this.app.command("ZoomToNamedExtent").register(this,this._executeZoomToNamedExtent),this.app.command("ZoomToOfflineMapExtent").register(this,this._executeZoomToOfflineMapExtent),this.app.command("PanUp").register(this,this._executePanUp),this.app.command("PanDown").register(this,this._executePanDown),this.app.command("PanLeft").register(this,this._executePanLeft),this.app.command("PanRight").register(this,this._executePanRight),this.app.command("SetTimeExtent").register(this,this._executeSetTimeExtent),this.app.command("EnableMapClick").register(this,this._executeEnableMapClick),this.app.command("DisableMapClick").register(this,this._executeDisableMapClick),this.app.command("EnableMapOnNextClick").register(this,this._enableMapNextClick)},t.prototype.getStateFilter=function(){return{serviceLayers:{item:this.app.project.filter.serviceLayer},graphicsLayers:{item:this.app.project.filter.operationalLayer}}},t.prototype.exportState=function(){var e=this;return Promise["try"](function(){var t=o.ArrayUtils.mapWithErrorCallback(e.app.site.essentialsMap.mapServices,function(t){return e.app.project.convert.fromGcxMapService(t)},function(t,i){e.app.trace.warning('Unable to save map service "{0}" to project: {1}'.format(t.displayName,i))}),i=r.getGraphicsLayersExceptExcluded(e.app,[r.ExcludeFromEnum.ExportApplyStateName]);i=i.filter(function(e){return e.id!==m.COORDINATES_LAYER_ID});var a=o.ArrayUtils.mapWithErrorCallback(i,function(t){return e.app.project.convert.fromEsriLayer(t)},function(t,i){e.app.trace.warning('Unable to save graphics layer "{0}" to project: {1}'.format(t.id,i))});return{serviceLayers:t,graphicsLayers:a}})},t.prototype.applyState=function(e){var t=this;return Promise["try"](function(){t.app.site.essentialsMap.mapServices.filter(function(e){return e.isUserCreated}).forEach(function(e){t.app.site.essentialsMap.removeMapService(e)});var i=r.getInternalGraphicsLayer(m.MARKUP_LAYER_ID,t.app,r.GraphicsLayerType.Markup);i&&i.clear();var a=r.getInternalGraphicsLayer(m.MEASUREMENT_LAYER_ID,t.app,r.GraphicsLayerType.Label);a&&a.clear(),t.app.event("MarkupClearedEvent").publish();var n=t.app.project.convert,o=function(e){return s.PromiseUtils.warnOnReject(n.toGcxMapService(e),t.app,'Unable to restore map service "{0}": {{0}}'.format(e.id))},p=function(e){return s.PromiseUtils.warnOnReject(n.toEsriLayer(e),t.app,'Unable to restore graphics layer "{0}": {{0}}'.format(e.id))},c=s.PromiseUtils.mapSkipRejected(e.serviceLayers,o)["return"](),l=s.PromiseUtils.mapSkipRejected(e.graphicsLayers,p)["return"]();return Promise.join(c,l).then(function(){t._fixGraphicsLayersOrder(),t.app.command("ClearMarkup").raiseCanExecuteChanged(),t.app.command("ClearMarkupQuiet").raiseCanExecuteChanged(),t.app.command("EditMarkup").raiseCanExecuteChanged(),t.app.command("DeleteMarkup").raiseCanExecuteChanged()})})},t.prototype._fixGraphicsLayersOrder=function(){var e=this,t=[m.MARKUP_LAYER_ID,m.MEASUREMENT_LAYER_ID,m.COORDINATES_LAYER_ID].filter(function(t){return e.app.map.graphicsLayerIds.indexOf(t)>=0});if(t.length){var i=Math.min.apply(null,t.map(function(t){return e.app.map.graphicsLayerIds.indexOf(t)}));t.forEach(function(t,a){var n=e.app.map.getLayer(t);e.app.map.reorderLayer(n,a+i)})}},t.prototype._androidSieve=function(e,t){var i=/Android (\d+(?:\.\d+)+)/,a=e.match(i);if(null!==a){var n=parseFloat(a[1]);if(n>=t)return!0}return!1},t.prototype._executeEnableMapClick=function(){this._executeMapClickCommands=!0},t.prototype._executeDisableMapClick=function(){this._executeMapClickCommands=!1,$(document.body).off("mousedown.nextClick touchstart.nextClick")},t.prototype._enableMapNextClick=function(){var e=this;$(document.body).off("mousedown.nextClick touchstart.nextClick"),this._isAndroid?setTimeout(function(){$(document.body).one("mousedown.nextClick touchstart.nextClick",function(){return e.app.command("EnableMapClick").execute()})},100):$(document.body).one("mousedown.nextClick touchstart.nextClick",function(){return e.app.command("EnableMapClick").execute()})},t.prototype._executeRecenterMapOnNextMapResize=function(){var e=this;if(!this._recenterRetryTimerHandler){var t=this.app.map&&this.app.map.extent&&this.app.map.extent.getCenter();if(t){this._previousCenter=t;var i=this.app.map,a=0;if(i.layerIds.map(function(e){return i.getLayer(e)}).filter(function(e){return e.updating}).map(function(e){return++a}),a>0||this.app.map.updating)return this.app.trace.debug("RecenterMapOnNextResize: Map updating, deferring recenter..."),void(this._recenterRetryTimerHandler=setTimeout(function(){e._recenterRetryTimerHandler=null,e._executeRecenterMapOnNextMapResize()},this._recenterRetryIntervalMs));var n=function(){var t=0;setTimeout(function(){e.app.site.essentialsMap.extentManager.centerAtWithPriority(e._previousCenter,4)},t)};if(n(),this.app.map&&this.app.map.extent)var o=dojo.connect(this.app.map,"onResize",function(){e._previousCenter&&(dojo.disconnect(o),dojo.disconnect(r),dojo.disconnect(s),dojo.disconnect(p),n())}),r=dojo.connect(this.app.map,"onExtentChange",function(t,i,a,n){e._previousCenter=t.getCenter()}),s=dojo.connect(this.app.map,"onPanStart",function(){e._previousCenter=null}),p=dojo.connect(this.app.map,"onPanEnd",function(t,i){e._previousCenter=t.getCenter()});else;}}},t.prototype._executeZoomOutToExtent=function(e){var t=this,i=function(e){var i=null;if(e&&e.length>0){i=e[0],t.app.command("ShowMap").execute();var a=2,n=2;i.getWidth()>0&&(a=t.app.map.extent.getWidth()/i.getWidth()),i.getHeight()>0&&(n=t.app.map.extent.getHeight()/i.getHeight());var o=t.app.map.extent.getWidth()*a,r=t.app.map.extent.getHeight()*n,s=new esri.geometry.Extent(i.getCenter().x-o/2,i.getCenter().y-r/2,i.getCenter().x+o/2,i.getCenter().y+r/2,i.spatialReference);t.app.site.essentialsMap.extentManager.setExtentWithPriority(s,5)}};if(e&&e.isInstanceOf(esri.geometry.Extent)){if(!e.spatialReference&&this.app.map.spatialReference)return e.spatialReference=this.app.map.spatialReference,void i([e]);var a=function(e){t.app.trace.warning("ZoomOutToExtent: "+e.message)},n=new p.ProjectArgs([e],i,a);this.app.command("Project").execute(n)}},t.prototype._executeZoomToExtent=function(e){c.zoomToExtentWithPriority(this.app,e,10,this._showMapOnZoom)},t.prototype._executePanToPoint=function(e){c.panToPointWithPriority(this.app,e,9,this._showMapOnPan)},t.prototype._executeProject=function(e){var t=this;if(e&&e instanceof p.ProjectArgs){if(e.geometries.length>0&&!l.needsProjection(e.geometries[0],this.app)){var i=e.callback;if(o=e.errback,!e.callback||!dojo.isFunction(i)){if(o&&dojo.isFunction(o)){var a="callback function required.";o(new Error(a))}return}return void i(e.geometries)}var n,o=function(i){t.app.command("Alert").execute(t.app.getResource(t.libraryId,"language-map-operation-project-failed")),t.app.trace.warning(i),e.errback&&e.errback(i)};n=void 0!==esri.tasks.ProjectParameters?new esri.tasks.ProjectParameters:new Object,n.geometries=e.geometries,e.outputSpatialReference?n.outSR=e.outputSpatialReference:n.outSR=this.app.map.spatialReference,n.transformation=e.transformation,l.project(n,e.callback,o,this.app)}},t.prototype._executeZoomToVisibleScale=function(e){if(e){var t=1,i=null,a=this.app.map;if(this.app.site.essentialsMap){var n=this.app.site.essentialsMap.calculateScale();if(n&&!(n<=0)){if(e.withinScaleRange(n)?i=null:n<e.maxScale?i=this._getClosestLODScale("greaterThan",e.maxScale)+1:n>e.minScale&&(i=this._getClosestLODScale("lessThan",e.minScale)-1),i&&(t=i/n),1===t)return void this.app.command("ShowMap").execute();var o=a.extent.getCenter();c.zoomToExtentWithPriority(this.app,a.extent.expand(t).centerAt(o),8,this._showMapOnZoom)}}}},t.prototype._getClosestLODScale=function(e,t){var i=this.app.map,a=i.__tileInfo&&i.__tileInfo.lods;if(!a||!a.length)return t;for(var n=0,o=0;o<a.length;o++){if(a[o].scale===t)return t;if("lessThan"===e){if(t<a[o].scale)continue}else if(a[o].scale>t){n=a[o].scale;continue}return"lessThan"===e?a[o].scale:n}},t.prototype._executeZoomToLayerExtent=function(e){e&&e.fullExtent&&c.zoomToExtentWithPriority(this.app,e.fullExtent,8,this._showMapOnZoom)},t.prototype._executeZoomToNamedExtent=function(e){var t=this;return e?void this.app.doWhenMapInitialized(function(){var i=t.app.site.namedExtents.filter(function(t){return t.displayName.toLowerCase().trim()===e.toLowerCase().trim()}),a=i.length?i[0]:null;return a?void c.zoomToExtentWithPriority(t.app,a.extent,8,t._showMapOnZoom):void t.app.trace.error("Error ZoomToNamedExtent: could not find extent '{0}'.".format(e))}):void this.app.trace.error("Error ZoomToNamedExtent: extent name was null.")},t.prototype._executeZoomToOfflineMapExtent=function(){var e=this;this.app.doWhenMapInitialized(function(){var t=e.app.offlineManager.getActiveOfflineMap();if(!t)return void e.app.trace.warning("ZoomToOfflineMapExtent: no active offline map.");var i=new esri.geometry.Polygon(t.content.geometry).getExtent();c.zoomToExtentWithPriority(e.app,i,8,e._showMapOnZoom)})},t.prototype._executePanToFeature=function(e){if(!(e&&e instanceof u.Feature))return void this.app.trace.error("Error PanToFeature: not a feature.");var t=e.esriFeature.get();t&&t.geometry?this.app.command("PanToPoint").execute(t.geometry):this.app.trace.warning("Error PanToFeature: No geometry.")},t.prototype._executePanToFeatureIfOutsideMapExtent=function(e){if(!(e&&e instanceof u.Feature))return void this.app.trace.error("Error PanToFeatureIfOutsideMapExtent: not a feature.");var t=e.esriFeature.get();return t&&t.geometry?this.app&&this.app.map?void(this.app.map.extent.intersects(t.geometry)&&!this._isObscuredByMapTipView(t.geometry)||this.app.command("PanToFeature").execute(e)):void this.app.trace.error("Error ZoomToFeature: No access to the Esri map."):void this.app.trace.warning("Error PanToFeatureIfOutsideMapExtent: No geometry.")},t.prototype._executePanToAllFeatures=function(e){if(e&&dojo.isArray(e)){if(1==e.length)return void this.app.command("PanToFeature").execute(e[0]);for(var t=null,i=0;i<e.length;i++){var a=e[i];if(a&&a instanceof u.Feature){var n=a.esriFeature.get();if(!n||!n.geometry)continue;var o=n.geometry,r=c.getExtent(o);t=null==t?r:t.union(r)}}t&&c.panToPointWithPriority(this.app,t,8,this._showMapOnPan)}},t.prototype._executeZoomToFeatures=function(e){e&&e instanceof d.FeatureSet&&this._executeZoomToAllFeatures(e.features.getItems())},t.prototype._executeZoomToAllFeatures=function(e){if(e&&dojo.isArray(e)){if(1==e.length)return void this._executeZoomToFeature(e[0]);for(var t=null,i=0;i<e.length;i++){var a=e[i];if(a&&a instanceof u.Feature){var n=a.esriFeature.get();if(!n||!n.geometry)continue;var o=n.geometry,r=c.getExtent(o);t=null==t?r:t.union(r)}}t&&(0==t.getWidth()&&0==t.getHeight()?c.panToPointWithPriority(this.app,t.getCenter(),8,this._showMapOnPan):(t=t.expand(1.5),c.zoomToExtentWithPriority(this.app,t,8,this._showMapOnZoom)))}},t.prototype._executeZoomToFeatureSetCollection=function(e){var t=[].concat.apply([],[[]].concat(e.featureSets.get().map(function(e){return e.features.get()})));this._executeZoomToAllFeatures(t)},t.prototype._executeZoomToFeature=function(e){var t=this;if(!(e&&e instanceof u.Feature))return void this.app.trace.error("Error ZoomToFeature: No feature provided.");if(!this.app||!this.app.map)return void this.app.trace.error("Error ZoomToFeature: No access to the Esri map.");var i;if(e.zoomExtent.get())return void c.zoomToExtentWithPriority(this.app,e.zoomExtent.get(),8,this._showMapOnZoom);if(e.esriFeature.get()&&e.esriFeature.get().geometry){var a,n=e.esriFeature.get().geometry,o=e.zoomScale.get();if(o){var r=null;if("point"==n.type?r=n:(a=n.getExtent(),r=a?a.getCenter():null),this.app.map.spatialReference.wkid)var s=esri.geometry.getScale(this.app.map.extent,this.app.map.width,this.app.map.spatialReference.wkid);else var s=esri.geometry.getScale(this.app.map.extent,this.app.map.width,this.app.map.spatialReference.wkt);var d=o/s;return i=new p.ProjectArgs([r],function(e){var i=null;e&&e.length>0&&(i=e[0]),i&&c.zoomToExtentWithPriority(t.app,t.app.map.extent.centerAt(i).expand(d),8,t._showMapOnZoom)},function(e){}),void this.app.command("Project").execute(i)}if("point"==n.type)return i=new p.ProjectArgs([n],function(i){var a=null;if(i&&i.length>0&&(a=i[0]),a){var n=t.app.map.extent.centerAt(a),o=t._pickDefaultZoomScaleForPointFeature(e);isNaN(o)&&(o=t.app.map.spatialReference.wkid?esri.geometry.getScale(n,t.app.map.width,t.app.map.spatialReference.wkid):esri.geometry.getScale(n,t.app.map.width,t.app.map.spatialReference.wkt)),n=esri.geometry.getExtentForScale(t.app.map,e.calculateScaleToMakeVisible(o)).centerAt(n.getCenter()),c.zoomToExtentWithPriority(t.app,n,8,t._showMapOnZoom)}},function(e){}),void this.app.command("Project").execute(i);var h=e.zoomFactor.get();h||(h=1.5);var m=n.getExtent();return m&&(m=l.fixAspectRatio(m.expand(h),this.app.map.extent)),i=new p.ProjectArgs([m],function(i){var a=null;if(i&&i.length>0&&(a=i[0]),a){if(t.app.map.spatialReference.wkid)var n=esri.geometry.getScale(a,t.app.map.width,t.app.map.spatialReference.wkid);else var n=esri.geometry.getScale(a,t.app.map.width,t.app.map.spatialReference.wkt);e.withinScaleRange(n)||(n=e.calculateScaleToMakeVisible(n),a=esri.geometry.getExtentForScale(t.app.map,n).centerAt(a.getCenter())),c.zoomToExtentWithPriority(t.app,a,8,t._showMapOnZoom)}},function(e){}),void this.app.command("Project").execute(i)}this.app.trace.warning("Error ZoomToFeature: No geometry.")},t.prototype._executeZoomToFeatureIfOutsideMapExtent=function(e){if(!(e&&e instanceof u.Feature))return void this.app.trace.error("Error ZoomToFeatureIfOutsideMapExtent: No feature provided.");if(!this.app||!this.app.map)return void this.app.trace.error("Error ZoomToFeature: No access to the Esri map.");if(this.app.map.extent){var t;if(e.zoomExtent.get())t=e.zoomExtent.get();else{if(!e.esriFeature.get()||!e.esriFeature.get().geometry)return void this.app.trace.warning("Error ZoomToFeatureIfOutsideMapExtent: No geometry.");t=e.esriFeature.get().geometry}if(this.app.map.extent.intersects(t)&&!this._isObscuredByMapTipView(t))return}this.app.command("ZoomToFeature").execute(e)},t.prototype._canExecuteZoomToFeature=function(e){if(e&&e.esriFeature&&e.esriFeature.get()&&e.esriFeature.get().geometry){if(this.app.isOffline.get()){var t=this.app.map.spatialReference,i=e.esriFeature.get().geometry.spatialReference;return i?t.equals(i)||t.isWebMercator()&&4326===i.wkid||i.isWebMercator()&&4326===t.wkid:t.equals(i)}return!0}return!1},t.prototype._isObscuredByMapTipView=function(e){if(!e)return!1;var t=this.app.viewManager.getViewById("MapTipView");if(!t||!t.root)return!1;var i=t.root.getBoundingClientRect(),a=this.app.map.toMap(new esri.geometry.ScreenPoint(i.left-this.app.map.position.x,i.bottom-this.app.map.position.y)),n=this.app.map.toMap(new esri.geometry.ScreenPoint(i.right-this.app.map.position.x,i.top-this.app.map.position.y)),o=new esri.geometry.Extent(a.x,a.y,n.x,n.y,this.app.map.spatialReference);
return o.contains(c.getExtent(e))},t.prototype.calculateScaleToMakeVisible=function(e){return null},t.prototype._executeZoomToScale=function(e){e&&this.app&&this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.extentManager.setScaleWithPriority(e,6)},t.prototype._executePanUp=function(e){if(e){var i=this.app.map.extent,a=this._calculateVerticalPanAmount(e),n=new esri.geometry.Extent(i.xmin,i.ymin+a,i.xmax,i.ymax+a,i.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(n,t.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panUp()},t.extentChangePriority)},t.prototype._executePanDown=function(e){if(e){var i=this.app.map.extent,a=this._calculateVerticalPanAmount(e),n=new esri.geometry.Extent(i.xmin,i.ymin-a,i.xmax,i.ymax-a,i.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(n,t.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panDown()},t.extentChangePriority)},t.prototype._executePanLeft=function(e){if(e){var i=this.app.map.extent,a=this._calculateHorizontalPanAmount(e),n=new esri.geometry.Extent(i.xmin-a,i.ymin,i.xmax-a,i.ymax,i.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(n,t.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panLeft()},t.extentChangePriority)},t.prototype._executePanRight=function(e){if(e){var i=this.app.map.extent,a=this._calculateHorizontalPanAmount(e),n=new esri.geometry.Extent(i.xmin+a,i.ymin,i.xmax+a,i.ymax,i.spatialReference);this.app.site.essentialsMap.extentManager.setExtentWithPriority(n,t.extentChangePriority)}else this.app.site.essentialsMap.extentManager.changeExtentWithPriority(function(e){return e.panRight()},t.extentChangePriority)},t.prototype._calculateHorizontalPanAmount=function(e){return this.app.map&&this.app.map.extent?this.app.map.extent.getWidth()*e:0},t.prototype._calculateVerticalPanAmount=function(e){return this.app.map&&this.app.map.extent?this.app.map.extent.getHeight()*e:0},t.prototype._executeSetTimeExtent=function(e){this.app.map&&this.app.map.setTimeExtent(e)},t.prototype._pickDefaultZoomScaleForPointFeature=function(e){var t=e.layer;if(t)for(var i=0;i<this._config.defaultPointFeatureZoomScales.length;i++){var a=this._config.defaultPointFeatureZoomScales[i];if(t.withinScaleRange(a))return a}else if(this._config.defaultPointFeatureZoomScales.length>0)return this._config.defaultPointFeatureZoomScales[0];return NaN},t.prototype._pointToExtent=function(e){var t=this.app.map.extent.getWidth()/this.app.map.width,i=5*t;return new esri.geometry.Extent(e.x-i,e.y-i,e.x+i,e.y+i,this.app.map.spatialReference)},t.prototype.featureClickHandler=function(e){e&&this.app.behavior("MapOnFeatureClickBehavior").run(e)},t.prototype.subscribeToMapEvents=function(){var e=this,t=this,i=!1,a=0,n=null,o=null,r=function(t){if(i)return i=!1,!1;if(!e._executeMapClickCommands)return!1;var r=(new Date).getTime();if(e._isAndroid3plus){var s=r-a,p=300,c=s<=p&&n&&Math.abs(n.x-t.screenPoint.x)<50&&Math.abs(n.y-t.screenPoint.y)<50;c?clearTimeout(o):o=setTimeout(function(){e._executeMapClickCommands&&e.app.behavior("MapOnClickBehavior").run(t.mapPoint)},p)}else e.app.behavior("MapOnClickBehavior").run(t.mapPoint);a=r,n=t.screenPoint},s=null,p=function(e){null!=s&&(clearTimeout(s),s=null)},c=function(t){p(t),i=!1,s=setTimeout(function(){s=null,i=!0,esri.MapNavigationManager?esri.MapNavigationManager.prototype._panEnd?e.app.map.navigationManager?e.app.map.navigationManager._panHandle&&esri.MapNavigationManager.prototype._panEnd.call(e.app.map.navigationManager):e.app.trace.warning("Can't prevent panning: missing map.navigationManager."):e.app.trace.warning("Can't prevent panning: missing esri.MapNavigationManager._panEnd"):e.app.trace.warning("Can't prevent panning: missing esri.MapNavigationManager."),t.preventDefault();var n=Date.now()-a;if(!(n<700)&&t.touches&&t.touches.length>0){var o=t.touches[0],r=$(e.app.map.root).offset(),p=new esri.geometry.ScreenPoint(Math.floor(o.pageX)-r.left,Math.floor(o.pageY)-r.top),c=e.app.map.toMap(p);a=Date.now(),e.app.behavior("MapOnLongClickBehavior").run(c)}},e._config.longClickMilliseconds||500)},l=function(t){if(t.preventDefault(),Modernizr.touch){var i=Date.now()-a;if(i<700)return}var n=$(e.app.map.root).offset(),o=t.pageX-n.left,r=t.pageY-n.top,s=new esri.geometry.ScreenPoint({x:o,y:r}),p=e.app.map.toMap(s);a=Date.now(),e.app.behavior("MapOnContextMenuBehavior").run(p)},u=[],d=function(){dojo.forEach(u,dojo.disconnect),u.length=0,Modernizr.touch&&(e.app.map.root.removeEventListener("touchstart",c,!1),e.app.map.root.removeEventListener("touchend",p,!1),e.app.map.root.removeEventListener("touchcancel",p,!1),e.app.map.root.removeEventListener("touchleave",p,!1),e.app.map.root.removeEventListener("touchmove",p,!1))},h=function(){d(),u.push(dojo.connect(e.app.map,"onClick",r));var t=e.app.behaviorRegistry.behaviors.MapOnLongClickBehavior;t&&t.commands.length>0&&(u.push(dojo.connect(e.app.map,"onMouseDown",c)),u.push(dojo.connect(e.app.map,"onMouseUp",p)),u.push(dojo.connect(e.app.map,"onMouseDrag",p)),u.push(dojo.connect(e.app.map,"onPanStart",p)),u.push(dojo.connect(e.app.map,"onZoomStart",p)),Modernizr.touch&&(e.app.map.root.addEventListener("touchstart",c,!1),e.app.map.root.addEventListener("touchend",p,!1),e.app.map.root.addEventListener("touchcancel",p,!1),e.app.map.root.addEventListener("touchleave",p,!1),e.app.map.root.addEventListener("touchmove",p,!1)));var i=e.app.behaviorRegistry.behaviors.MapOnContextMenuBehavior;i&&i.commands.length>0&&e.app.map.root.addEventListener("contextmenu",l,!1)};h(),this.app.event("GraphicDrawActivatedEvent").subscribe(this,function(){0!==e._mapClickTimerHandles.length&&(e._mapClickTimerHandles.forEach(function(e){clearTimeout(e)}),e._mapClickTimerHandles=[]),d()}),this.app.event("GraphicDrawDeactivatedEvent").subscribe(this,function(){e._isAndroid?e._mapClickTimerHandles.push(setTimeout(h,950)):h()});var m=esri.toolbars.Draw.prototype.activate;esri.toolbars.Draw.prototype.activate=function(){if(!this.__attached_isActive)if(m.apply(this,arguments),this.__attached_isActive=!0,this.__attached_stopEvent)delete this.__attached_stopEvent;else{var e=arguments[0];t.app.event("GraphicDrawActivatedEvent").publish({sender:this,geometryType:e})}};var g=esri.toolbars.Draw.prototype.deactivate;if(esri.toolbars.Draw.prototype.deactivate=function(){this.__attached_isActive&&(this.__attached_stopEvent?delete this.__attached_stopEvent:t.app.event("GraphicDrawDeactivatedEvent").publish({sender:this,geometryType:null}),g.apply(this,arguments),this.__attached_isActive=!1)},this.app.event("GraphicEditActivatedEvent").subscribe(this,d),this.app.event("GraphicEditDeactivatedEvent").subscribe(this,function(){e.app.toolRegistry.getActiveTool()||h()}),"undefined"!=typeof esri.toolbars.Edit){var v=0,f=null,x=esri.toolbars.Edit.prototype.activate;esri.toolbars.Edit.prototype.activate=function(){if(!this.__attached_isActive)if(x.apply(this,arguments),this.__attached_isActive=!0,this._textSymbolEditor&&(this._textSymbolEditor._showHaloStyler=!1),this.__attached_stopEvent)delete this.__attached_stopEvent;else{v=arguments[0],f=arguments[1];var e={tool:v,graphic:f,sender:this};t.app.event("GraphicEditActivatedEvent").publish(e)}};var M=esri.toolbars.Edit.prototype.deactivate;esri.toolbars.Edit.prototype.deactivate=function(){if(this.__attached_isActive){if(this.__attached_stopEvent)delete this.__attached_stopEvent;else{var e={tool:v,graphic:f,sender:this};v=0,f=null,t.app.event("GraphicEditDeactivatedEvent").publish(e)}M.apply(this,arguments),this.__attached_isActive=!1}}}},t.prototype._onGeoRssLayerLoaded=function(e){e&&e.esriLayer&&dojo.connect(e.esriLayer,"onClick",this,function(e){dojo.stopEvent(e);var t=new u.Feature({graphic:e.graphic,allowUnsafeContent:this.app.configuration.allowUnsafeContent});e.graphic.attributes;t.descriptionFormat.set("{content}"),t.labelFormat.set("{title}"),this.app.command("ShowMapTip").execute(t)})},t.prototype._handleSiteInitialized=function(e){var t=this;return e&&e.isInitialized?(this._previousCenter=this.app.map.extent.getCenter(),void(e.essentialsMap&&e.essentialsMap.mapServices.forEach(function(e){if(e.serviceLayer instanceof esri.layers.StreamLayer&&e.layers&&1===e.layers.length){var i=e.layers[0];(i.identifiable||i.showMapTips)&&t.app.clickableGraphics.register(e.serviceLayer,{displayName:i.displayName,autoEditable:!1,canEdit:function(){return!1},canDelete:function(){return!1},canChangeStyles:function(){return!1}})}}))):void this.app.trace.error("Error processing MapModule._handleSiteInitialized. - site was not initialized.")},t.prototype._handleLayerUpdateStart=function(e,t){if(t){t.attached_isLoading=!0,t.attached_timers||(t.attached_timers=new Array);var i=setTimeout(dojo.hitch(this,function(){if(!(this._config.loadingMessageTiming.length<1)&&this._config.showLoadingStatus&&t.attached_isLoading){var i=this.app.getResource(this.libraryId,"language-map-loading-stage1"),a=i.format(t.displayName),n=new h.AddStatusArgs(a);if(n.id=e.id+"LoadingStatus",n.showBusyIcon=!0,this.app.command("AddStatus").execute(n),this._config.loadingMessageTiming.length<2)return;var o=setTimeout(dojo.hitch(this,function(){if(t.attached_isLoading){var e=this.app.viewManager.getViewById(n.id);if(e&&e.viewModel&&e.viewModel.text.set(this.app.getResource(this.libraryId,"language-map-loading-stage2").format(t.displayName)),this._config.loadingMessageTiming.length<3)return;var i=setTimeout(dojo.hitch(this,function(){if(t.attached_isLoading){var e=this.app.viewManager.getViewById(n.id);e&&e.viewModel&&e.viewModel.text.set(this.app.getResource(this.libraryId,"language-map-loading-stage3").format(t.displayName))}}),this._config.loadingMessageTiming[2]);t.attached_timers.push(i)}}),this._config.loadingMessageTiming[1]);t.attached_timers.push(o)}}),this._config.loadingMessageTiming[0]);t.attached_timers.push(i)}},t.prototype._handleLayerUpdateEnd=function(e,t){if(t){if(t.attached_timers){for(var i=0;i<t.attached_timers.length;i++)clearTimeout(t.attached_timers[i]);t.attached_timers.length=0}t.attached_isLoading=!1;var a=e.id+"LoadingStatus";this.app.command("RemoveStatus").execute(a)}},t.prototype._handleLayerAdded=function(e,t){},t.prototype._handleLayerRemoved=function(e){var t=e.id+"LoadingStatus";this.app.command("RemoveStatus").execute(t)},t.prototype._initializeCoordinateModels=function(){var e=this,t=this.id.split("-").pop(),i=this.app.configModel.moduleConfigs.filter(function(e){return e.moduleName===t})[0];i&&i.viewModelConfigs.length&&i.viewModelConfigs.forEach(function(t){var i=t.viewModelId,a=t.typeName;a===e._coordModelType&&e._mapCoordinatesControllers.push(new n.MapCoordinatesController(e.app,e.libraryId,i))})},t}(i.ModuleBase);g.extentChangePriority=6,t.MapModule=g})},"Mapping/modules/Map/MapState":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/Map/MapView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FocusUtils","geocortex/infrastructure/eventArgs/MapExtentEventArgs","./RippleClick"],function(e,t,i,a,n,o){"use strict";var r=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.active=null,a.hoverTimer=null,a.resizeTimer=null,a.firstResize=!1,a.initialized=!1,a.extentEpoch=null,a.extentBroadcastFrequency=null,a.minScale=null,a.maxScale=null,a._layerEventsLookup={},a._mapHoverSubscriberCount=0,a._mapHoverTimeout=500,a._enableMapClickEvent=!0,a._coordChannelId="defaultMapCoordinates",a.app.event("ViewActivatedEvent").subscribe(a,a._updateBingLogoPosition),a.app.event("ViewDeactivatedEvent").subscribe(a,a._updateBingLogoPosition),a.app.event("RegionActivatedEvent").subscribe(a,a._updateBingLogoPosition),a.app.event("RegionDeactivatedEvent").subscribe(a,a._updateBingLogoPosition),a.app.event("ViewActivatedEvent").subscribe(a,a._updateTopLeftMapRegion),a.app.event("ViewDeactivatedEvent").subscribe(a,a._updateTopLeftMapRegion),a.app.command("ActivateMapContextMenu").register(a,a._activateMapContextMenu),a.app.event("SmallShellTopRightRegionOpeningEvent").subscribe(a,a._animateTopRightRegionOpening),a.app.event("SmallShellTopRightRegionClosingEvent").subscribe(a,a._animateTopRightRegionClosing),a}return __extends(t,e),t.prototype.removed=function(){null!=this.app.map&&this.app.map.destroy()},t.prototype.activated=function(){var t=this;e.prototype.activated.call(this),this.initialized||this.initialize(),this.active=!0,setTimeout(function(){return a.focusOnMap(t.app.map)},0),this.resize()},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.active=!1,clearTimeout(this.resizeTimer),clearTimeout(this.hoverTimer)},t.prototype.attach=function(t){e.prototype.attach.call(this,t),this.viewModel&&(this.initialized||this.initialize(),this._addBrokenPanDetection())},t.prototype._activateMapContextMenu=function(e){var t=this.mapDiv.getBoundingClientRect(),i=this.app.map.toScreen(e),a=t.left+i.x,n=t.top+i.y;this.app.event("MapContextMenuPointUpdatedEvent").publish(e),this.app.command("ActivateContextMenu").execute({pageX:a,pageY:n,viewId:"MapContextMenuView"})},t.prototype._addBrokenPanDetection=function(){if(/.*Trident\/([0-9]+)\..*/.test(navigator.userAgent)){var e,t;if(navigator.msPointerEnabled)e="MSPointerMove",t="MSPointerUp";else{if(!navigator.pointerEnabled)return;e="pointermove",t="pointerup"}var i=this.mapDiv.childNodes[0].childNodes[0],a=this.app.map;void 0!==a.__panning&&this._addEventListener(i,e,function(e){if(e=e||window.event,a.__panning&&0===e.buttons&&(void 0===e.pointerType||"mouse"===e.pointerType||4===e.pointerType)){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),dojo.mixin(n,e),n.button=0,n.buttons=0,n.which=0,i.dispatchEvent(n)}})}},t.prototype.resize=function(){var e=this,t=this.app.map;t&&t.extent&&!this.resizeTimer&&(this.resizeTimer=setTimeout(function(){e.resizeTimer=null;try{if(e.mapDiv){var i=dojo.coords(e.mapDiv);e.isActive===!0&&i.w>2&&i.h>2&&t.width&&t.height&&(t.resizeDelay=0,e.app.map.reposition(),e.app.site.essentialsMap.extentManager.blockForResize(i.w,i.h,!0))}}catch(a){}}))},t.prototype.initialize=function(){var e=this;if(!this.initialized&&this.viewModel&&this.root){var t=!1,i=!!Modernizr.csstransforms3d,a=!0,n=!1,r=!1;this.configuration&&this.configuration.hasOwnProperty("wrapAround180")&&(t=this.configuration.wrapAround180),this.configuration&&this.configuration.hasOwnProperty("force3DTransforms")&&(i=this.configuration.force3DTransforms),this.configuration&&this.configuration.hasOwnProperty("showAttribution")&&(a=!!this.configuration.showAttribution),this.configuration&&this.configuration.hasOwnProperty("fitTiledMapsToExtent")&&(n=!!this.configuration.fitTiledMapsToExtent),this.configuration&&this.configuration.hasOwnProperty("disableMapKeyboardNavigation")&&(r=!!this.configuration.disableMapKeyboardNavigation);var s={slider:!1,logo:!1,showAttribution:a,wrapAround180:t,force3DTransforms:i,autoResize:!1,fitExtent:n,showInfoWindowOnClick:!1};if(this.configuration&&this.configuration.hasOwnProperty("minScale")){var p=parseFloat(this.configuration.minScale);isNaN(p)||(this.minScale=p,s.minScale=p)}if(this.configuration&&this.configuration.hasOwnProperty("maxScale")){var c=parseFloat(this.configuration.maxScale);isNaN(c)||(this.maxScale=c,s.maxScale=c)}this.configuration&&this.configuration.hasOwnProperty("showLabels")&&(s.showLabels=!!this.configuration.showLabels),this.rippleClick=new o.RippleClick(this.app,this.mapDiv,this.mapContainer),this.rippleClick.initialize(this.configuration),this.app.map=new esri.Map("map",s),this.app.map._fitTiledMapsToExtent=n,this.app.map.hideZoomSlider(),this.extentBroadcastFrequency=this.configuration.extentBroadcastFrequency||0,r&&this._disableMapKeyboardNavigation(),this.app.command("ZoomToInitialExtent").register(this,function(){e.app.command("ActivateView").execute(e.id)}),this.app.command("ZoomToFullExtent").register(this,function(){e.app.command("ActivateView").execute(e.id)}),this.app.event("ApplicationResizedEvent").subscribe(this,function(){return e.resize()}),this.app.command("MapResize").register(this,function(){return e.resize()}),this.app.command("ShowMap").register(this,function(){this.app.command("ActivateView").execute(this.id)}),this.app.command("EnableMapClick").register(this,function(){return e._enableMapClickEvent=!0}),this.app.command("DisableMapClick").register(this,function(){return e._enableMapClickEvent=!1}),this.app.command("DisableMapKeyboardNavigation").register(this,this._disableMapKeyboardNavigation),this.app.command("EnableMapKeyboardNavigation").register(this,this._enableMapKeyboardNavigation),this.app.event("ActiveToolChangedEvent").subscribe(this,this._toolChanged),dojo.connect(this.app.map,"onExtentChange",function(t,i,a,n){var o=n;!o&&e.app.site&&e.app.site.essentialsMap&&(o=e._getLevelOfDetails(t)),e.app.map.graphicsLayerIds.forEach(function(t){var i=e.app.map.getLayer(t),a=i.getNode();a&&a.style&&"none"===a.style.display&&i.visible&&i.visibleAtMapScale&&!i.suspended&&$(a).show()}),e.app.event("MapExtentChangeEvent").publish(t,i,a,o),e._publishWithMapExtent("MapExtentChangedEvent",t,o)}),dojo.connect(this.app.map,"onLayerAdd",this,this._layerAdd),dojo.connect(this.app.map,"onLayerAddResult",this,function(t,i){e.app.event("LayerAddResultEvent").publish(t,i),e.app.event("LayerAddedWithResultEvent").publish(t,i),e._updateBingLogoPosition()}),dojo.connect(this.app.map,"onLayerRemove",this,function(t){if(t){var i=e._layerEventsLookup[t.id];if(i){for(var a=0;a<i.length;a++)dojo.disconnect(i[a]);delete e._layerEventsLookup[t.id]}e.app.event("LayerRemovedEvent").publish(t),e._updateBingLogoPosition()}}),dojo.connect(this.app.map,"onLayersAddResult",this,function(t){e.app.event("LayersAddedWithResultEvent").publish(t||[]),e._updateBingLogoPosition()}),dojo.connect(this.app.map,"onPanStart",function(t,i){e.app.event("MapPanStartEvent").publish(t,i),e.app.event("MapPanStartedEvent").publish(t,i)}),dojo.connect(this.app.map,"onPan",function(t,i){e.app.event("MapPanEvent").publish(t,i),e._broadcastExtent(t)}),dojo.connect(this.app.map,"onPanEnd",function(t,i){e.app.event("MapPanEndEvent").publish(t,i),e.app.event("MapPanEndedEvent").publish(t,i)}),dojo.connect(this.app.map,"onZoomStart",function(t,i,a,n){e.app.event("MapZoomStartEvent").publish(t,i,a,n),e.app.event("MapZoomStartedEvent").publish(t,i,a,n)}),dojo.connect(this.app.map,"onZoom",function(t,i,a){e.app.event("MapZoomEvent").publish(t,i,a),e._broadcastExtent(t)}),dojo.connect(this.app.map,"onZoomEnd",function(t,i,a,n){e.app.event("MapZoomEndEvent").publish(t,i,a,n),e.app.event("MapZoomEndedEvent").publish(t,i,a,n)}),dojo.connect(this.app.map,"onLoad",function(t){if(e.minScale||e.maxScale){var i=e.app.map._params,a=i.lods;if(a&&a.length){var n=e.app.map.__tileInfo.lods;if(e.minScale){for(;a[0].scale<e.minScale;){var o=Math.min(e.minScale,2*a[0].scale),r=new esri.layers.LOD;r.level=0,r.scale=o,r.resolution=a[0].resolution*o/a[0].scale,a.splice(0,0,r),n.splice(0,0,r),i.hasOwnProperty("maxZoom")&&i.maxZoom++}for(var s=0;s<a.length;s++)a[s].level=s,n[s].level=s}if(e.maxScale)for(var p=a.length-1;a[p].scale>e.maxScale;){var o=Math.max(e.maxScale,.5*a[p].scale),r=new esri.layers.LOD;r.level=a[p].level+1,r.scale=o,r.resolution=a[p].resolution*o/a[p].scale,a.push(r),n.push(r),i.maxZoom=r.level,p++}}}e._installZoomFix(),e.resize(),e.app.event("MapLoadedEvent").publish(t)}),dojo.connect(this.app.map,"onClick",function(t){e._enableMapClickEvent&&(e.app.event("MapClickEvent").publish(t),e.app.event("MapClickedEvent").publish(t))}),dojo.connect(this.app.map,"onMouseDown",function(t){e.app.event("MapMouseDownEvent").publish(t)}),dojo.connect(this.app.map,"onMouseUp",function(t){e.app.event("MapMouseUpEvent").publish(t)}),dojo.connect(this.app.map,"onTimeExtentChange",function(t){e.app.event("MapTimeExtentChangedEvent").publish(t)}),dojo.subscribe("LayerVisibilityChange",function(t){var i=[];if(t&&t.length>0)for(var a=0;a<t.length;a++){var n=t[a];if(n&&n.mapServiceId&&n.layerId){var o=e.app.site.essentialsMap.findMapServiceById(n.mapServiceId);if(o){var r=o.findLayerById(n.layerId);r&&i.push({layer:r,mapService:o,visibility:n.visibility})}}else e.app.trace.error(e.id+" can't find map service for layer. Either mapServiceId or layerId are not available.")}e.app.event("LayerVisibilityChangedEvent").publish(i)}),dojo.subscribe("ServiceLayerInitializedEvent",function(t){e.app.event("SiteLayerLoadingEvent").publish(t)}),dojo.subscribe("MapServiceVisibilityChangedEvent",function(t){t&&(e.app.event("MapServiceVisibilityChangedEvent").publish(t.serviceLayer,t),e._updateBingLogoPosition())}),dojo.subscribe("MapServiceAddedEvent",function(t){t&&e.app.event("MapServiceAddedEvent").publish(t)}),dojo.subscribe("MapServiceRemovedEvent",function(t){t&&e.app.event("MapServiceRemovedEvent").publish(t)}),dojo.subscribe("CatalogLayerAddedEvent",function(t){return e.app.event("CatalogLayerAddedEvent").publish(t)}),dojo.subscribe("CatalogLayerRemovedEvent",function(t){return e.app.event("CatalogLayerRemovedEvent").publish(t)}),dojo.subscribe("MapServiceLayersChangedWithResultEvent",function(t){return e.app.event("MapServiceLayersChangedWithResultEvent").publish(t)}),this._attachMouseHoverHandlers(),this._updateBingLogoPosition(),this.initialized=!0,this.app.event("MapInitializedEvent").publish()}},t.prototype._installZoomFix=function(){var e=this;this.app.map.on("zoom-start",function(t){var i=e.app.map.layerIds;i.forEach(function(t){var i=e.app.map.getLayer(t);if(i&&i instanceof esri.layers.DynamicMapServiceLayer&&i.updating){var a=i._img;a&&(a.style.display="none")}})})},t.prototype._addEventListener=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},t.prototype._removeEventListener=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)},t.prototype._attachMouseHoverHandlers=function(){var e=this,t=function(t){clearTimeout(e.hoverTimer);var i={clientX:t.clientX,clientY:t.clientY};e.hoverTimer=setTimeout(function(){e.app.event("MapMouseHoverEvent").publish(i)},e._mapHoverTimeout)},i=function(t){t.explicitOriginalTarget&&"path"==t.explicitOriginalTarget.localName||clearTimeout(e.hoverTimer)};dojo.aspect.after(this.app.event("MapMouseHoverEvent"),"subscribe",function(a){return e._mapHoverSubscriberCount++<=0&&(e._addEventListener(e.app.map.root,"mousemove",t),e._addEventListener(e.app.map.root,"mouseout",i)),a}),dojo.aspect.after(this.app.event("MapMouseHoverEvent"),"unsubscribe",function(){--e._mapHoverSubscriberCount<=0&&(e._removeEventListener(e.app.map.root,"mousemove",t),e._removeEventListener(e.app.map.root,"mouseout",i))})},t.prototype._updateTopLeftMapRegion=function(e){if("TopMapRegion"===e.regionName){var t=this.app.viewManager.getExistingRegionByName("TopMapRegion");t&&t.views.filter(function(e){return"DataFrameButtonView"!==e.id&&e.isActive}).length>0?$(".map-top-left").removeClass("map-top-hidden").addClass("map-top-visible"):$(".map-top-left").removeClass("map-top-visible").addClass("map-top-hidden")}},t.prototype._updateBingLogoPosition=function(){for(var e=0;this.app.map&&e<this.app.map.layerIds.length;e++){var t=this.app.map.getLayer(this.app.map.layerIds[e]);if(t.isInstanceOf(esri.virtualearth.VETiledLayer)&&t.visible){var i=this.app.viewManager.getExistingRegionByName("BottomLeftMapRegion");if(i){var a=i.activeViews;if(a&&a.length>0){for(var n=0,o=0;o<a.length;o++)a[o].root.clientHeight>n&&(n=a[o].root.clientHeight);$(".bingLogo-lg").css("bottom",n)}}return}}},t.prototype._broadcastExtent=function(e){var t=null,i=null;this.extentEpoch||(this.extentEpoch=+new Date),t=+new Date,t-this.extentEpoch>this.extentBroadcastFrequency&&(this.app.site&&this.app.site.essentialsMap&&(i=this._getLevelOfDetails(e)),this._publishWithMapLod("MapExtentChangingEvent",i),this.extentEpoch=t)},t.prototype._layerAdd=function(e){var t=this,i=this.app.site.essentialsMap.mapServices.filter(function(t){return t.serviceLayer===e});if(0!=i.length){var a=i[0];this.app.event("LayerAddEvent").publish(e,a),this.app.event("LayerAddedEvent").publish(e,a);var n=[];this._layerEventsLookup[e.id]=n,n.push(dojo.connect(e,"onUpdateStart",this,function(){t.app.event("LayerUpdateStartEvent").publish(e,a),t.app.event("LayerUpdateStartedEvent").publish(e,a)})),n.push(dojo.connect(e,"onUpdateEnd",this,function(){t.app.event("LayerUpdateEndEvent").publish(e,a),t.app.event("LayerUpdateEndedEvent").publish(e,a)})),n.push(dojo.connect(e,"onVisibilityChange",this,function(){t.app.event("MapServiceVisibilityChangedEvent").publish(e,a),t._updateBingLogoPosition()})),this._updateBingLogoPosition()}},t.prototype._getLevelOfDetails=function(e){var t={scale:this.app.site.essentialsMap.calculateScale()};return e&&this.app.map&&this.app.map.width>0&&(t.resolution=e.getWidth()/this.app.map.width),t},t.prototype._publishWithMapLod=function(e,t){var i=null;t&&(i=new n.MapExtentEventArgs,i.currentScale=t.scale,i.currentResolution=t.resolution),this.app.event(e).publish(i)},t.prototype._publishWithMapExtent=function(e,t,i){var a=null;i&&(a=new n.MapExtentEventArgs,a.currentScale=i.scale,a.currentResolution=i.resolution),this.app.event(e).publish(t,a)},t.prototype._toolChanged=function(e){e.tool&&this.app.command("ActivateView").execute(this.id)},t.prototype._disableMapKeyboardNavigation=function(){this._setMapKeyboardNavigation(!1)},t.prototype._enableMapKeyboardNavigation=function(){this._setMapKeyboardNavigation(!0)},t.prototype._setMapKeyboardNavigation=function(e){var t=this;if(this.app.map){var i=function(e){e?t.app.map.enableKeyboardNavigation():t.app.map.disableKeyboardNavigation()};this.app.map.loaded?i(e):this.app.event("MapLoadedEvent").once(this,function(){i(e)})}},t.prototype._animateTopRightRegionOpening=function(){$(".region.map-top").removeClass("map-top-slide-up"),$(".region.map-top").addClass("map-top-slide-down")},t.prototype._animateTopRightRegionClosing=function(){$(".region.map-top").removeClass("map-top-slide-down"),$(".region.map-top").addClass("map-top-slide-up")},t}(i.ViewBase);t.MapView=r})},"Mapping/modules/Map/MapViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/MapUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,i,a,n,o,r,s){"use strict";var p=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._zoomedExtent=null,n.showMap=new a.Observable((!0)),n.showError=new a.Observable((!1)),n.showAuthError=new a.Observable((!1)),n.showCriticalServicesError=new a.Observable((!1)),n.siteFailed=new a.Observable((!1)),n.temporaryGraphicsLayer=null,n.temporaryMarkupSymbol=null,n.stepZoomFactor=.5,n.registerCommands(),n}return __extends(t,e),t.prototype.initialize=function(t){if(e.prototype.initialize.call(this,t),t&&t.hasOwnProperty("stepZoomFactor")){var i=parseFloat(t.stepZoomFactor);this.stepZoomFactor=!isNaN(i)&&i>0?i:.5}this.temporaryMarkupSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,20,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0]),1),new esri.Color([255,255,0,.5])),this.app.event("SiteInitializationFailedEvent").subscribe(this,function(e){this.showMap.set(!1),this.showError.set(!0)}),this.app.event("SiteAuthorizationFailedEvent").subscribe(this,function(e){this.showMap.set(!1),this.showAuthError.set(!0)}),this.app.event("SiteServiceLayersFailedEvent").subscribe(this,function(e){dojo.some(e,function(e){return e.failureAction===n.FailureAction.ERROR})&&(this.showMap.set(!1),this.showCriticalServicesError.set(!0))}),this.app.event("UserSignInCancelledEvent").subscribe(this,function(e){this.showMap.set(!1),this.showAuthError.set(!0)}),this.app.event("MapLoadedEvent").subscribe(this,this._subscribeToMapEvents)},t.prototype.registerCommands=function(){var e=this;this.app.command("AddTemporaryMarkupGeometry").register(this,function(e){if(this.temporaryGraphicsLayer||(this.temporaryGraphicsLayer=s.getInternalGraphicsLayer(r.TEMP_GRAPHICS_LAYER_ID,this.app,s.GraphicsLayerType.Markup,!1)),e){var t=null;switch(e.type){case"polygon":case"extent":t=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([255,51,51,.8]),2),new esri.Color([255,51,51,.5]));break;case"polyline":t=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([204,51,51,.8]),2);break;default:t=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,14,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0]),1),new esri.Color([204,51,51]))}this.temporaryGraphicsLayer.add(new esri.Graphic(e,t))}}),this.app.command("ClearTemporaryMarkup").register(this,function(){e.temporaryGraphicsLayer&&e.temporaryGraphicsLayer.clear()}),this.app.command("AddMapService").register(this,this._executeAddMapService),this.app.command("RemoveMapService").register(this,this._executeRemoveMapService,this._canExecuteRemoveMapService),this.app.command("RemoveUserAddedLayer").register(this,this._executeRemoveUserAddedLayer,this._canExecuteRemoveUserAddedLayer),this.app.command("ZoomToInitialExtent").register(this,function(){setTimeout(function(){if(null!=e.app.map){if(null===e.app.site||!e.app.site.isInitialized||null===e.app.site.essentialsMap)return void e.app.trace.warning("Could not zoom to initial extent - Site was null or uninitialized.");if(!e.app.site.essentialsMap.isInitialized||null===e.app.site.essentialsMap.initialExtent)return void e.app.trace.warning("Could not zoom to initial extent - Map was not initialized or has no initial extent.");e.app.site.essentialsMap.extentManager.setExtentWithPriority(e.app.site.essentialsMap.initialExtent,8)}},1)}),this.app.command("ZoomToFullExtent").register(this,function(){setTimeout(function(){if(null!=e.app.map){if(null===e.app.site||!e.app.site.isInitialized||null===e.app.site.essentialsMap)return void e.app.trace.warning("Could not zoom to full extent - Site was null or uninitialized.");if(!e.app.site.essentialsMap.isInitialized||null===e.app.site.essentialsMap.fullExtent)return void e.app.trace.warning("Could not zoom to full extent - Map was not initialized or has no full extent.");e.app.site.essentialsMap.extentManager.setExtentWithPriority(e.app.site.essentialsMap.fullExtent,8)}},1)}),this.app.command("StepZoomIn").register(this,this._executeStepZoomIn),this.app.command("StepZoomOut").register(this,this._executeStepZoomOut)},t.prototype._executeAddMapService=function(e){this.app.site.essentialsMap.addMapService(e)},t.prototype._canExecuteRemoveMapService=function(e){return!!(this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.mapServices&&this.app.site.essentialsMap.mapServices.some(function(t){return t.isUserCreated&&t.serviceLayer==e.serviceLayer}))},t.prototype._executeRemoveMapService=function(e){e.catalogId?this.app.command("RemoveLayerCatalogItem").execute(e):this.app.site.essentialsMap.removeMapService(e)},t.prototype._executeRemoveUserAddedLayer=function(e){e.catalogId?this.app.command("RemoveLayerCatalogItem").execute(e):this.app.site.essentialsMap.removeMapService(e.mapService);var t=this.app.viewManager.getViewById("LayerActionsView");t&&this.app.viewManager.deactivateView(t)},t.prototype._canExecuteRemoveUserAddedLayer=function(e){if(!e||!e.isUserCreated)return!1;if(e.catalogId)return this._canRemoveCatalogLayer(e);var t=e.mapService;return t.mapServiceType==n.MapServiceType.FEATURE||t.drawingBehavior==n.DrawingBehavior.FEATURE_LAYER},t.prototype._canRemoveCatalogLayer=function(e){
return e&&e.isUserCreated&&e.mapService.layers.length>0&&!String.isNullOrEmpty(e.catalogId)},t.prototype._executeStepZoomOut=function(){this.app.command("ShowMap").execute(),this._zoomedExtent=o.stepZoomWithPriority(this.app.site,this.stepZoomFactor,this._zoomedExtent,5)},t.prototype._executeStepZoomIn=function(){this.app.command("ShowMap").execute(),this._zoomedExtent=o.stepZoomWithPriority(this.app.site,1/this.stepZoomFactor,this._zoomedExtent,5)},t.prototype._subscribeToMapEvents=function(){dojo.connect(this.app.map,"onPanEnd",this,function(){this._zoomedExtent=null}),dojo.connect(this.app.map,"onZoomEnd",this,function(){this._zoomedExtent=null})},t}(i.ViewModelBase);t.MapViewModel=p})},"Mapping/modules/Map/RippleClick":function(){define(["require","exports","geocortex/framework-ui/animation/Animation","geocortex/infrastructure/tools/MapTool"],function(e,t,i,a){"use strict";var n="rippleClickElem",o=function(){function e(e,t,i){this.rippleClickEnabled=!0,this._disableThisRippleClick=!1,this.app=e,this.mapDiv=t,this.mapContainer=i}return e.prototype.initialize=function(e){var t=this;navigator.appVersion.indexOf("MSIE 10")!==-1||$(document.documentElement).hasClass("dj_ie9")?(this.rippleClickEnabled=!1,this.app.trace.debug("Ripple Click disabled on browsers that do not support the pointer-events css property.")):e.rippleClick||null==e.rippleClick?this.rippleClickEnabled=!0:this.rippleClickEnabled=!1,this.app.waitUntilSiteInitialized().then(function(){t.registerEventsAndCommands()})},e.prototype.registerEventsAndCommands=function(){var e=this;this._addEventListener(this.mapContainer,"click",function(t){e._stopRippleClick(),e.app.command("RippleClick").execute(t)}),this.app.command("RippleClick").register(this,this._executeRippleClick,this._canExecuteRippleClick),this.app.command("ToggleRippleClick").register(this,this._toggleRippleClick),this.app.command("DisableRippleClick").register(this,this._disableRippleClick),this.app.command("EnableRippleClick").register(this,this._enableRippleClick),this._addEventListener(this.mapContainer,"mousewheel",function(t){e._stopRippleClick()}),this.app.event("MapZoomStartedEvent").subscribe(this,function(){e._stopRippleClick()}),this.app.event("MapPanEvent").subscribe(this,function(){e._stopRippleClick(),e._disableThisRippleClick=!0}),this.app.event("MapPanEndedEvent").subscribe(this,function(){setTimeout(function(){e._disableThisRippleClick=!1},0)}),this.app.event("GraphicEditActivatedEvent").subscribe(this,function(){e.app.command("DisableRippleClick").execute()}),this.app.event("GraphicEditDeactivatedEvent").subscribe(this,function(){e.app.command("EnableRippleClick").execute()}),this.app.event("ActiveToolChangedEvent").subscribe(this,this._toolChanged)},e.prototype._toolChanged=function(e){var t=this;!e.tool||e.tool instanceof a.MapTool&&this._isPointIdentify(e.tool)?(this.app.command("EnableRippleClick").execute(),this._disableThisRippleClick=!0,setTimeout(function(){t._disableThisRippleClick=!1},0)):this.app.command("DisableRippleClick").execute()},e.prototype._isPointIdentify=function(e){return"Identify"===e.command&&("POINT"===e.drawMode||"MULTIPOINT"===e.drawMode)},e.prototype._canExecuteRippleClick=function(e){return!!this.rippleClickEnabled&&(!!this._clickHitMap(e)&&(!this._disableThisRippleClick||(this._disableThisRippleClick=!1,!1)))},e.prototype._clickHitMap=function(e){return e.target===this.app.map._layersDiv||e.target===this.app.map._gc._surface.rawNode||((" "+e.target.className+" ").indexOf(" region ")>-1||!!e.graphic)},e.prototype._stopRippleClick=function(){var e=this,t=$("#"+n);t[0]&&this.animation&&this.animation.stop().then(function(){e.animation=null})},e.prototype._executeRippleClick=function(e){if(null==this.animation){this.parent||(this.parent=$(this.mapDiv));var t;this.rippleElem?t=$(this.rippleElem):(this.parent.append($("<span></span>").attr("id",n)),t=this.parent.find("#"+n),this.rippleElem=t[0]);var a=Math.max(this.parent.width(),this.parent.height());t.css({width:a,height:a});var o=e.pageX-this.parent.offset().left-t.width()/2,r=e.pageY-this.parent.offset().top-t.width()/2;t.css({left:o+"px",top:r+"px"}),this.animation=i.create(t.get()[0]),this.animation.setResets(!0).add({className:"animate"}).play(),this.app.trace.debug("Executed a Ripple Click")}},e.prototype._toggleRippleClick=function(){this.rippleClickEnabled=!this.rippleClickEnabled},e.prototype._disableRippleClick=function(){this.rippleClickEnabled=!1},e.prototype._enableRippleClick=function(){this.rippleClickEnabled=!0},e.prototype._addEventListener=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},e}();t.RippleClick=o})},"Mapping/modules/Map/ScaleSharingLinkProvider":function(){define(["require","exports","geocortex/infrastructure/sharing/SharingLinkProviderBase"],function(e,t,i){"use strict";var a=function(e){function t(t,a){var n=e.call(this,t,a)||this;return n.name="scale",n.priority=i.ExtentLinkPriority.SCALE,n}return __extends(t,e),t.prototype.generate=function(){return this.app.map.extent?this.app.map.getScale().toString():""},t.prototype.apply=function(e){var t=this;if(e){var i=parseFloat(e);return isNaN(i)?void this.app.trace.warning("Unable to parse the scale parameter {0}: expected a single number value.".format(e)):void(this.app.site&&this.app.site.serviceLayersLoaded?this.app.site.essentialsMap.extentManager.setScaleWithPriority(i,7):this.app.event("SiteServiceLayersLoadedEvent").once(this,function(){t.app.site.essentialsMap.extentManager.setScaleWithPriority(i,7)}))}},t}(i.SharingLinkProviderBase);t.ScaleSharingLinkProvider=a})},"Mapping/modules/Map/MapContextMenu/MapContextMenuView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/commandArgs/ShowMapElementArgs"],function(e,t,i,a){"use strict";var n=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a._pushPinId="MapContextMenuPushPin",a.app.event("MapContextMenuPointUpdatedEvent").subscribe(a,a._updatePointInfo),a.app.configuration.mobileMode?a.app.event("SmallBottomPanelClosedEvent").subscribe(a,a._smallBottomPanelClosedHandler):a.app.event("ContextMenuDeactivated").subscribe(a,a._contextMenuDeactivatedHandler),a}return __extends(t,e),t.prototype.activated=function(){this._stopMapClicks()},t.prototype.deactivated=function(){this._enableMapClicks(),this._removePushPin()},t.prototype._stopMapClicks=function(){this.app.event("FlyoutActivated").publish(this)},t.prototype._enableMapClicks=function(){this.app.event("FlyoutDeactivated").publish(this)},t.prototype._contextMenuDeactivatedHandler=function(){this.isActive&&(this._removePushPin(),this._enableMapClicks())},t.prototype._smallBottomPanelClosedHandler=function(){this.isActive&&this._enableMapClicks()},t.prototype._updatePointInfo=function(e){this._showPushPin(e)},t.prototype._deactivateContextMenu=function(){this.app.command("DeactivateContextMenu").execute()},t.prototype._showPushPin=function(e){var t=document.createElement("div"),i=document.createElement("img");i.src="Resources/Images/Pushpins/map-marker-green-32.png",i.style.pointerEvents="none",t.appendChild(i);var n=new a.ShowMapElementArgs(this._pushPinId,e,t);this.app.command("ShowMapElement").execute(n),this.app.configuration.mobileMode?this.app.command("PanToPoint").execute(e):this.app.event("MapExtentChangingEvent").once(this,this._handleExtentChangedEvent)},t.prototype._removePushPin=function(){this.app.command("HideMapElement").execute(this._pushPinId)},t.prototype._handleExtentChangedEvent=function(){this._deactivateContextMenu(),this._removePushPin()},t}(i.ViewBase);t.MapContextMenuView=n})},"Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/coordinates/CoordinateUtils"],function(e,t,i,a,n){"use strict";var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.showCoordinates=new a.Observable((!1)),t.xValue=new a.Observable,t.yValue=new a.Observable,t.xType=new a.Observable(""),t.yType=new a.Observable(""),t._isActive=!1,t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t.showCoordinates&&(this._isActive=!0,this.app.event("MapContextMenuPointUpdatedEvent").subscribe(this,this._updatePointInfo))},t.prototype._updatePointInfo=function(e){var t=this;this._isActive&&this.app.coordinatesManager.getCoordinate(e).then(function(e){t.xType.set("xy"===e.targetCoordinateSystem.output?n.getResource(t.app,"x")+":":n.getResource(t.app,"latitude-abbrev")+":"),t.yType.set("xy"===e.targetCoordinateSystem.output?n.getResource(t.app,"y")+":":n.getResource(t.app,"longitude-abbrev")+":"),t.xValue.set(e.formattedLatitudeOrX),t.yValue.set(e.formattedLongitudeOrY),t.showCoordinates.set(!0)},function(e){t.app.trace.warning(e.message),t.showCoordinates.set(!1)})},t}(i.ViewModelBase);t.CoordinatesViewModel=o})},"Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView":function(){define(["require","exports","geocortex/infrastructure/menus/MenuView"],function(e,t,i){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){e.prototype.attach.call(this,t),this.title.set(this.getResource("language-menu-map-context-menu-title"))},t.prototype.resolveWidget=function(t,i,a){if(e.prototype.resolveWidget.call(this,t,i),"MapContextMenuWidget"===t)return this.app.menuRegistry.createMenuWidget(this,i,a)},t.prototype._deactivateContextMenu=function(){this.app.command("DeactivateContextMenu").execute()},t.prototype.handleMenuItemClick=function(t,i,a){this.app.configuration.mobileMode||this._deactivateContextMenu(),e.prototype.handleMenuItemClick.call(this,t,i,a)},t}(i.MenuView);t.MapMenuView=a})},"Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuViewModel":function(){define(["require","exports","geocortex/infrastructure/menus/MenuViewModel","geocortex/framework/observables"],function(e,t,i,a){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.showMenu=new a.Observable((!1)),t.mapPoint=new a.Observable,t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t.showMenu&&this.app.menuRegistry.getMenu("MapContextMenu")&&(this.showMenu.set(!0),this.app.event("MapContextMenuPointUpdatedEvent").subscribe(this,this._updatePointInfo))},t.prototype._updatePointInfo=function(e){this.mapPoint.set(e)},t}(i.MenuViewModel);t.MapMenuViewModel=n})},"Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/ReverseGeocoder"],function(e,t,i,a,n){"use strict";var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.showReverseGeocoder=new a.Observable((!1)),t.label=new a.Observable,t.address=new a.Observable,t.isSearching=new a.Observable((!1)),t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t.showReverseGeocoder&&(this.app.site&&this.app.site.isInitialized?this._handleSiteInitialized():this.app.event("SiteInitializedEvent").once(this,this._handleSiteInitialized))},t.prototype._handleSiteInitialized=function(){var e=this.app.site.geocodingEndpoints;if(e)for(var t=0;t<e.length;t++){var i=e[t];if(i.isDefaultReverseGeocoder){this._endpoint=i;break}}this._endpoint&&(this.showReverseGeocoder.set(!0),this.reverseGeocoder=new n.ReverseGeocoder(this.app,this._endpoint),this.label.set(this.getResource("language-map-context-menu-reverse-geocode-label")),this.app.event("MapContextMenuPointUpdatedEvent").subscribe(this,this._updatePointInfo))},t.prototype._updatePointInfo=function(e){var t=this;return this.app.isOffline.get()?void this.showReverseGeocoder.set(!1):(this.showReverseGeocoder.set(!0),this.address.set(this.getResource("language-map-context-menu-reverse-geocode-search-in-progress")),this.isSearching.set(!0),void this.reverseGeocoder.reverseGeocode(e).then(function(e){t.isSearching.set(!1),e&&e.address?t.address.set(e.address):t._handleResultError()},function(e){t.isSearching.set(!1),t._handleResultError()}))},t.prototype._handleResultError=function(){this.address.set(this.getResource("language-map-context-menu-reverse-geocode-search-no-result"))},t}(i.ViewModelBase);t.ReverseGeocodeViewModel=o})},"url:/Mapping/modules/Map/MapHostView.html":'<div class="region map-region" data-region-name="MapRegion"></div>',"url:/Mapping/modules/Map/MapView.html":'\r\n<div class="map-error" data-binding="{@hidden: showMap}">\r\n    <div data-binding="{@visible: showError}">\r\n        <h2 data-binding="{@text: @language-map-site-initialization-failed}"><!-- The site failed to initialize. --></h2>\r\n        <p data-binding="{@text: @language-common-debug-log-keys}"><!-- The site failed to initialize. --></p>\r\n    </div>\r\n    <div data-binding="{@visible: showAuthError}">\r\n        <h2 data-binding="{@text: @language-map-site-authorization-failed}"><!-- The site authorization failed. --></h2>\r\n        <p data-binding="{@text: @language-map-site-authorization-failed-message}"><!-- The site failed to initialize. --></p>\r\n    </div>\r\n    <div data-binding="{@visible: showCriticalServicesError}">\r\n        <h2 data-binding="{@text: @language-map-site-critical-services-failed}"><!-- Critical services failed. --></h2>\r\n        <p data-binding="{@text: @language-map-site-critical-services-failed-message}"><!-- Critical services failed. --></p>\r\n    </div>\r\n</div>\r\n\r\n\r\n<div id="map-container" style="height: 100%; width: 100%" data-binding="{@visible: showMap}{@var: mapContainer}">\r\n\r\n    <!-- MAP -->\r\n    <div id="map" class="map needsclick" data-binding="{@var: mapDiv}"></div>\r\n\r\n    <!-- MAP REGIONS -->\r\n    <div class="region map-top-top-left" data-region-name="TopTopLeftMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-top" data-region-name="TopMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-center-region" data-region-name="CenterRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-top-left" data-region-name="TopLeftMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-navigation-region" data-region-name="NavigationMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-top-center" data-region-name="TopCenterMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-top-right" data-region-name="TopRightMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-basemap-region" data-region-name="BasemapMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-middle-right" data-region-name="MiddleRightMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-bottom-right" data-region-name="BottomRightMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-bottom-center" data-region-name="BottomCenterMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-bottom-left" data-region-name="BottomLeftMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n    <div class="region map-middle-left" data-region-name="MiddleLeftMapRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter" data-region-options="activateViewsInLastPosition=false"></div>\r\n\r\n</div>',"url:/Mapping/modules/Map/MapContextMenu/MapContextMenuView.html":'<div class="region map-context-menu-region" data-region-name="MapContextMenuContentRegion" data-region-adapter="geocortex.framework.ui.DivStackRegionAdapter"></div>',"url:/Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesView.html":'<div class="map-menu-coordinates" data-binding="{@visible: showCoordinates}">\r\n    <div tabindex="0"><b data-binding="{@text: xType}"></b> <span data-binding="{@text: xValue}"></span></div>\r\n    <div tabindex="0"><b data-binding="{@text: yType}"></b> <span data-binding="{@text: yValue}"></span></div>\r\n</div>',"url:/Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView.html":'<div data-binding="{@widget: MapContextMenuWidget}{@widget-required: true}{@widget-context: mapPoint}{@visible: showMenu}" data-menu-id="MapContextMenu" data-menu-hoist-disabled data-menu-type="geocortex.essentialsHtmlViewer.mapping.modules.map.MapMenuView"></div>',"url:/Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeView.html":'<div class="map-menu-reverse-geocode" tabindex="0" data-binding="{@visible: showReverseGeocoder}">\r\n    <b data-binding="{@text: label}"></b> <span data-binding="{@text: address}"></span>\r\n    <!-- Used to mitigate the movement of the menu when the address result is populated -->\r\n    <p data-binding="{@visible: isSearching}"></p>\r\n</div>'}}),define(["Mapping/modules/Map/CenterSharingLinkProvider","Mapping/modules/Map/ExtentSharingLinkProvider","Mapping/modules/Map/MapCoordinatesController","Mapping/modules/Map/MapExtentLog","Mapping/modules/Map/MapHostView","Mapping/modules/Map/MapModule","Mapping/modules/Map/MapView","Mapping/modules/Map/MapViewModel","Mapping/modules/Map/ScaleSharingLinkProvider","Mapping/modules/Map/MapContextMenu/MapContextMenuView","Mapping/modules/Map/MapContextMenu/Views/Coordinates/CoordinatesViewModel","Mapping/modules/Map/MapContextMenu/Views/ReverseGeocode/ReverseGeocodeViewModel","Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuView","Mapping/modules/Map/MapContextMenu/Views/Menu/MapMenuViewModel"],function(e,t,i,a,n,o,r,s,p,c,l,u,d,h){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.map.CenterSharingLinkProvider",e.CenterSharingLinkProvider),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.map.ExtentSharingLinkProvider",t.ExtentSharingLinkProvider),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapCoordinatesController",i.MapCoordinatesController),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapExtentLog",a.MapExtentLog),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapHostView",n.MapHostView),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapModule",o.MapModule),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapView",r.MapView),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapViewModel",s.MapViewModel),shim(p,"geocortex.essentialsHtmlViewer.mapping.modules.map.ScaleSharingLinkProvider",p.ScaleSharingLinkProvider),shim(c,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapContextMenuView",c.MapContextMenuView),shim(l,"geocortex.essentialsHtmlViewer.mapping.modules.map.CoordinatesViewModel",l.CoordinatesViewModel),shim(u,"geocortex.essentialsHtmlViewer.mapping.modules.map.ReverseGeocodeViewModel",u.ReverseGeocodeViewModel),shim(d,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapMenuView",d.MapMenuView),shim(h,"geocortex.essentialsHtmlViewer.mapping.modules.map.MapMenuViewModel",h.MapMenuViewModel)});