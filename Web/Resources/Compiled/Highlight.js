function shim(e,i,t){if("string"==typeof e&&(t=i,i=e),"undefined"==typeof t)return void console.warn("Undefined shim for: "+i);for(var h=i.split("."),a=null,r=window,g=0,s=h.length;g<s;g++)a=h[g],g==s-1?r[a]=t:r[a]||(r[a]={}),r=r[a]}require({cache:{"Mapping/modules/Highlight/HighlightModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/HighlightManager","geocortex/infrastructure/Feature","geocortex/essentials/utilities/GraphicsLayerUtilities","geocortex/infrastructure/GraphicsLayerUtils"],function(e,i,t,h,a,r,g){"use strict";var s=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._isInitialized=!1,i._additionalLayers=null,i._geometryEditHighlightId="",i._editCancelled=!1,i._clearAndHighlightDebounceToken=null,i._clearAndHighlightDebounceTimeMs=300,i._geomGeneralizationInfo=null,i._maxHighlightableGeometryVertices=0,i._maxVerticesNotificationDisplayed=!1,i._doNotNotifyMaxVerticesAgain=!1,i._geometryNotificationId="___geomMaxVerticesExceeded",i}return __extends(i,e),i.prototype.initialize=function(t){var h=this;if(e.prototype.initialize.call(this,t),t.borderColor&&this.app.highlightManager.setInnerHighlightBorderColor(t.borderColor),t.outerBorderColor&&this.app.highlightManager.setOuterHighlightBorderColor(t.outerBorderColor),t.borderWidth&&this.app.highlightManager.setBorderWidth(t.borderWidth),t.fillColor&&this.app.highlightManager.setHighlightFillColor(t.fillColor),t.focusedBorderColor&&this.app.highlightManager.setFocusedBorderColor(t.focusedBorderColor),t.outerBorderWidth&&this.app.highlightManager.setOuterBorderWidth(t.outerBorderWidth),t.focusedFillColor&&this.app.highlightManager.setFocusedFillColor(t.focusedFillColor),t.outerFocusedBorderColor&&this.app.highlightManager.setOuterFocusedBorderColor(t.outerFocusedBorderColor),t.highlightLineOpacity&&this.app.highlightManager.setHighlightLineOpacity(t.highlightLineOpacity),t.additionalLayers&&(this._additionalLayers=t.additionalLayers),t.geometryGeneralization){var a=t.geometryGeneralization;this._geomGeneralizationInfo={},this._geomGeneralizationInfo.maxDeviationInMeters=void 0!=a.maxDeviationInMeters?parseFloat(a.maxDeviationInMeters.toString()):NaN,this._geomGeneralizationInfo.thresholdVertices=void 0!=a.thresholdVertices?parseInt(a.thresholdVertices.toString(),10):NaN,this._geomGeneralizationInfo.geometryGeneralizationEnabled=a.geometryGeneralizationEnabled&&!(isNaN(this._geomGeneralizationInfo.maxDeviationInMeters)||isNaN(this._geomGeneralizationInfo.thresholdVertices)),this._geomGeneralizationInfo.geometryGeneralizationEnabled&&this.app.waitUntilSiteInitialized().then(function(){return h.app.highlightManager.setGeometryGeneralizationParams(h._geomGeneralizationInfo.thresholdVertices,h._geomGeneralizationInfo.maxDeviationInMeters)}).then(function(){return h.app.trace.debug("Geometry generalization (using the Ramer–Douglas–Peucker algorithm) enabled for the Highlight module for geometries with more than {0} vertices.".format(h._geomGeneralizationInfo.thresholdVertices))},function(){return h.app.trace.error("Unable to activate geometry generalization for the Highlight module.")})}if(void 0!=t.maxHighlightableGeometryVertices){var s=parseInt(t.maxHighlightableGeometryVertices.toString(),10);isNaN(s)||(this._maxHighlightableGeometryVertices=s),this.app.highlightManager.setMaxHighlightableGeometryVertices(this._maxHighlightableGeometryVertices),dojo.connect(this.app.highlightManager,"onMaxGeometryVerticesExceeded",function(e){return h._onMaxGeometryVerticesExceeded(e)})}this.registerCommands(),this.subscribeEvents(),r.addToGraphicsLayerIdsToExclude([g.ExcludeFromEnum.ExportApplyStateName,g.ExcludeFromEnum.WebMapName],i.DEFAULT_HIGHLIGHT_LAYER_ID),this._layersReady()?this._initializeDefaultHighlights():this.app.event("SiteServiceLayersLoaded").once(this,this._initializeDefaultHighlights)},i.prototype.registerCommands=function(){this.app.command("HighlightFeature").register(this,this._highlightFeature,this._isReady),this.app.command("HighlightFeatures").register(this,this._highlightFeature,this._isReady),this.app.command("ClearAndHighlightFeatures").register(this,this._clearAndHighlightFeature,this._isReady),this.app.command("ClearHighlights").register(this,this._clearHighlights,this._isReady),this.app.command("ClearFeatureHighlight").register(this,this._clearFeatureHighlight,this._isReady),this.app.command("SetHighlightBorderColor").register(this,this._setHighlightBorderColor),this.app.command("SetHighlightBorderWidth").register(this,this._setHighlightBorderWidth),this.app.command("SetHighlightFillColor").register(this,this._setHighlightFillColor),this.app.command("FocusFeature").register(this,this._focusFeature,this._isReady),this.app.command("ClearFeatureFocus").register(this,this._clearFeatureFocus,this._isReady),this.app.command("SetFocusedBorderColor").register(this,this._setFocusedHighlightBorderColor),this.app.command("SetFocusedFillColor").register(this,this._setFocusedHighlightFillColor),this.app.command("HighlightFeatureSet").register(this,this._highlightFeatureSet,this._canHighlightFeatureSet),this.app.command("HighlightEsriFeatureSet").register(this,this._highlightEsriFeatureSet,this._canHighlightEsriFeatureSet),this.app.command("CreateHighlightLayer").register(this,this._createHighlightLayer,this._canCreateHighlightLayer),this.app.command("SetActiveHighlightLayer").register(this,this._setActiveHighlightLayer,this._canSetActiveHighlightLayer),this.app.command("SetActiveHighlightLayerDefault").register(this,this._setActiveHighlightLayerDefault,this._canSetActiveHighlightLayerDefault),this.app.command("RemoveHighlightLayer").register(this,this._removeHighlightLayer,this._canRemoveHighlightLayer),this.app.command("HighlightFeatureDefault").register(this,this._highlightFeatureDefault,this._isReady),this.app.command("ClearDefaultHighlights").register(this,this._clearHighlightsDefault),this.app.command("HighlightFeatureSetTestHarness").register(this,this._highlightFeatureSetTestHarness),this.app.command("HighlightFeatureTestHarness").register(this,this._highlightFeatureTestHarness)},i.prototype.subscribeEvents=function(){var e=this;this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._refreshHighlights),this.app.event("MapZoomEndedEvent").subscribe(this,this._redrawHighlights),this.app.event("GeometryEditInvokedEvent").subscribe(this,function(i){e._startEditingHighlightedGraphic(i)}),this.app.event("MarkupEditingStartedEvent").subscribe(this,function(i){e._startEditingHighlightedGraphic(i)}),this.app.event("GeometryEditCompletedEvent").subscribe(this,function(t){t.cancelled?e._editCancelled=t.cancelled:e._editCancelled=!1,!t.cancelled&&t.editedGraphic&&t.originalGraphic?(e._originalEditGeometry=null,t.editedGraphic[h.HIGHLIGHT_ID_PROPERTY]=t.originalGraphic[h.HIGHLIGHT_ID_PROPERTY],e.app.highlightManager.updateHighlightId(t.editedGraphic),e._geometryEditHighlightId=t.editedGraphic[h.HIGHLIGHT_ID_PROPERTY],e._clearHighlights(i.EDITOR_HIGHLIGHT_LAYER_ID),e._focusFeature({feature:t.editedGraphic,layer:i.EDITOR_HIGHLIGHT_LAYER_ID}),e._enableHighlight(t.editedGraphic)):(e._originalEditGeometry&&(t.originalGraphic.geometry=e._originalEditGeometry),e._clearHighlights(i.EDITOR_HIGHLIGHT_LAYER_ID),e._enableHighlight(t.originalGraphic))}),this.app.event("FeatureEditedEvent").subscribe(this,function(i){e._geometryEditHighlightId&&(i.editedFeature[h.HIGHLIGHT_ID_PROPERTY]=e._geometryEditHighlightId)}),this.app.event("_internalEvent.EditorViewDeactivated").subscribe(this,function(t){!e._editCancelled&&t&&t.geometry&&(e._clearHighlights(i.EDITOR_HIGHLIGHT_LAYER_ID),e._enableHighlight(t))}),this.app.event("GraphicEditingDoneEvent").subscribe(this,function(t){t.old&&t["new"]&&t["new"].geometry&&(t["new"][h.HIGHLIGHT_ID_PROPERTY]=t.old[h.HIGHLIGHT_ID_PROPERTY],e._clearHighlights(i.EDITOR_HIGHLIGHT_LAYER_ID),e._enableHighlight(t["new"]))})},i.prototype._startEditingHighlightedGraphic=function(e){e&&(this._editCancelled=!1,this._geometryEditHighlightId="",this._originalEditGeometry=null,this._clearHighlights(i.EDITOR_HIGHLIGHT_LAYER_ID),this._focusFeature({feature:e,layer:i.EDITOR_HIGHLIGHT_LAYER_ID}),this._suppressHighlight(e),this._originalEditGeometry=esri.geometry.fromJson(e.geometry.toJson()))},i.prototype.getStateFilter=function(){var e=this;return{highlightLayers:function(i){for(var t={},h=0,a=Object.keys(i);h<a.length;h++){var r=a[h];t[r]=e.app.project.filter.operationalLayer}return t},activeHighlightLayerName:!0,highlights:{item:{feature:this.app.project.filter.feature,highlightLayer:!0,originalLayer:!0}}}},i.prototype.exportState=function(){return this.app.highlightManager.exportState()},i.prototype.applyState=function(e){return this.app.highlightManager.applyState(e)},i.prototype._layersReady=function(){if(this.app.site&&this.app.site.essentialsMap&&this.app.site.essentialsMap.mapServices){for(var e=this.app.site.essentialsMap.mapServices,i=0;i<e.length;i++){var t=e[i].serviceLayer;if(!t.loaded)return!1}return!0}return!1},i.prototype._initializeDefaultHighlights=function(){if(this.app.highlightManager._defaultHighlightLayerName=i.DEFAULT_HIGHLIGHT_LAYER_ID,this.app.highlightManager.getOrCreateHighlightLayer(i.DEFAULT_HIGHLIGHT_LAYER_ID),this._additionalLayers)for(var e=0;e<this._additionalLayers.length;e++){var t=this._additionalLayers[e];this.app.highlightManager.getOrCreateHighlightLayer(t.name,t.hasOwnProperty("fillColor")?t.fillColor:void 0,t.hasOwnProperty("borderColor")?t.borderColor:void 0)}this._setActiveHighlightLayerDefault(),this._isInitialized=!0;var h=["CreateHighlightLayer","SetActiveHighlightLayer","SetActiveHighlightLayerDefault","HighlightEsriFeatureSet","RemoveHighlightLayer","ClearHighlights","HighlightFeatureSet","HighlightFeature"];for(e=0;e<h.length;e++)this.app.command(h[e]).raiseCanExecuteChanged()},i.prototype._createHighlightLayer=function(e,i,t){this.app.highlightManager.getOrCreateHighlightLayer(e,i,t)},i.prototype._canCreateHighlightLayer=function(e){return this._isInitialized&&!this.app.project.isLoading&&!this.app.highlightManager.getHighlightLayer(e)},i.prototype._canSetActiveHighlightLayer=function(e){return this._isInitialized&&!this.app.project.isLoading&&!!this.app.highlightManager.getHighlightLayer(e)},i.prototype._setActiveHighlightLayer=function(e){this.app.highlightManager.setActiveHighlightLayer(e)},i.prototype._canSetActiveHighlightLayerDefault=function(){return this._isInitialized&&!this.app.project.isLoading&&!!this.app.highlightManager.getHighlightLayer(this.app.highlightManager._defaultHighlightLayerName)},i.prototype._setActiveHighlightLayerDefault=function(){this.app.highlightManager.setActiveHighlightLayer(this.app.highlightManager._defaultHighlightLayerName)},i.prototype._highlightEsriFeatureSet=function(e){this.app.highlightManager.highlightEsriFeatureSet(e)},i.prototype._canHighlightEsriFeatureSet=function(e){return!!(this._isInitialized&&!this.app.project.isLoading&&e&&e instanceof esri.tasks.FeatureSet)},i.prototype._setHighlightBorderColor=function(e){this.app.highlightManager.setHighlightBorderColor(e)},i.prototype._setHighlightBorderWidth=function(e){this.app.highlightManager.setBorderWidth(e)},i.prototype._setHighlightFillColor=function(e){this.app.highlightManager.setHighlightFillColor(e)},i.prototype._setFocusedHighlightBorderColor=function(e){this.app.highlightManager.setFocusedBorderColor(e)},i.prototype._setFocusedHighlightFillColor=function(e){this.app.highlightManager.setFocusedFillColor(e)},i.prototype._removeHighlightLayer=function(e){this.app.highlightManager.removeHighlightLayer(e)},i.prototype._canRemoveHighlightLayer=function(e){return this._isInitialized&&!this.app.project.isLoading&&!!this.app.highlightManager.getHighlightLayer(e)},i.prototype._clearHighlights=function(e){this.app.highlightManager.clearHighlights(e)},i.prototype._clearHighlightsDefault=function(){this.app.highlightManager.clearHighlights(i.DEFAULT_HIGHLIGHT_LAYER_ID)},i.prototype._highlightFeatureSet=function(e){this.app.highlightManager.highlightFeatures(e.features.get())},i.prototype._canHighlightFeatureSet=function(e){return this._isReady()&&e&&e.features&&e.features.getLength()>0},i.prototype._refreshHighlights=function(e){this._isInitialized&&!this.app.project.isLoading&&this.app.highlightManager.refreshHighlights()},i.prototype._redrawHighlights=function(e){this._isInitialized&&!this.app.project.isLoading&&this.app.highlightManager.redrawHighlights()},i.prototype._highlightFeature=function(e){if(e)return e instanceof esri.tasks.FeatureSet?void this.app.highlightManager.highlightEsriFeatureSet(e):void(this.isHighlightFeatureArgs(e)?$.isArray(e.feature)?this.app.highlightManager.highlightFeatures(e.feature,e.layer):this.app.highlightManager.highlightFeatures([e.feature],e.layer):$.isArray(e)?this.app.highlightManager.highlightFeatures(e):this.app.highlightManager.highlightFeatures([e]))},i.prototype._clearAndHighlightFeature=function(e){var i=this,t=function(){i.app.highlightManager.clearHighlights(e.layer||""),i._highlightFeature(e)};this._clearAndHighlightDebounceToken&&clearTimeout(this._clearAndHighlightDebounceToken),this._clearAndHighlightDebounceToken=setTimeout(function(){i._clearAndHighlightDebounceToken=null,t()},this._clearAndHighlightDebounceTimeMs)},i.prototype._highlightFeatureDefault=function(e){this._clearHighlightsDefault(),this.app.highlightManager.highlightFeatures([e],this.app.highlightManager._defaultHighlightLayerName)},i.prototype._suppressHighlight=function(e){e&&this.app.highlightManager.suppressHighlight(e)},i.prototype._enableHighlight=function(e){e&&this.app.highlightManager.enableHighlight(e)},i.prototype._focusFeature=function(e){e&&(this.isHighlightFeatureArgs(e)?$.isArray(e.feature)?this.app.highlightManager.emphasizeFeatures(e.feature,e.layer):this.app.highlightManager.emphasizeFeatures([e.feature],e.layer):e instanceof esri.tasks.FeatureSet?this.app.highlightManager.emphasizeFeatures(e.features,this.app.highlightManager._defaultHighlightLayerName):this.app.highlightManager.emphasizeFeatures($.isArray(e)?e:[e],this.app.highlightManager._defaultHighlightLayerName))},i.prototype._clearFeatureFocus=function(e){e&&(this.isHighlightFeatureArgs(e)?$.isArray(e.feature)?this.app.highlightManager.clearEmphasis(e.feature,e.layer):this.app.highlightManager.clearEmphasis([e.feature],e.layer):e instanceof esri.tasks.FeatureSet?this.app.highlightManager.clearEmphasis(e.features,this.app.highlightManager._defaultHighlightLayerName):this.app.highlightManager.clearEmphasis($.isArray(e)?e:[e],this.app.highlightManager._defaultHighlightLayerName))},i.prototype._clearFeatureHighlight=function(e){e&&(this.isHighlightFeatureArgs(e)?$.isArray(e.feature)?this.app.highlightManager.clearHighlight(e.feature,e.layer):this.app.highlightManager.clearHighlight([e.feature],e.layer):this.app.highlightManager.clearHighlight($.isArray(e)?e:[e],this.app.highlightManager._defaultHighlightLayerName))},i.prototype._isReady=function(){return this._isInitialized},i.prototype._highlightFeatureSetTestHarness=function(e){for(var i=this.app.featureSetManager.getCollectionById(e).featureSets,t=(i.bind(this,function(e){if("append"===e.type)for(var i=e.rangeStart;i<e.rangeEnd+1;i++)this.app.command("HighlightFeatureSet").execute(e.sender.getAt(i))}),0);t<i.length();t++)this.app.command("HighlightFeatureSet").execute(i[t])},i.prototype._highlightFeatureTestHarness=function(e){var i=this.app.featureSetManager.getCollectionById(e),t=i.firstFeature();if(t)this.app.command("HighlightFeature").execute(t);else var h=i.featureSets.bind(this,function(e){var t=i.firstFeature();t&&(i.featureSets.unbind(h),this.app.command("HighlightFeature").execute(t))})},i.prototype.isHighlightFeatureArgs=function(e){return!!(e&&e.layer&&e.feature)&&(!!(e.feature instanceof a.Feature||$.isArray(e.feature)&&e.feature[0]instanceof a.Feature)||!!(e.feature instanceof esri.Graphic||$.isArray(e.feature)&&e.feature[0]instanceof esri.Graphic))},i.prototype._onMaxGeometryVerticesExceeded=function(e){var i=this;if(!this._maxVerticesNotificationDisplayed&&!this._doNotNotifyMaxVerticesAgain){var t=this.getResource("language-highlight-max-geometry-vertices-exceeded-alert"),h=this.getResource("language-highlight-max-geometry-vertices-alert-permanent-dismiss-msg"),a=this.getResource("language-highlight-max-geometry-vertices-exceeded-alert-image-url"),r=this.getResource("language-highlight-max-geometry-vertices-exceeded-alert-alt-text"),g={text:h,callback:function(){i._maxVerticesNotificationDisplayed=!1,i._doNotNotifyMaxVerticesAgain=!0,i.app.command("RemoveNotification").execute(i._geometryNotificationId)}},s={callback:function(){i._maxVerticesNotificationDisplayed=!1}};this._maxVerticesNotificationDisplayed=!0;var o={id:this._geometryNotificationId,text:t.format(this._maxHighlightableGeometryVertices),iconProperties:{uri:a,altText:r},buttons:[g],closeButton:s};this.app.command("DisplayNotification").execute(o)}},i}(t.ModuleBase);s.DEFAULT_HIGHLIGHT_LAYER_ID="defaultHighlightLayer",s.EDITOR_HIGHLIGHT_LAYER_ID="editorHighlightLayer",i.HighlightModule=s})}}}),define(["Mapping/modules/Highlight/HighlightModule"],function(e){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.Highlight.HighlightModule",e.HighlightModule)});