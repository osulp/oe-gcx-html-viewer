function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var r=t.split("."),s=null,a=window,n=0,l=r.length;n<l;n++)s=r[n],n==l-1?a[s]=i:a[s]||(a[s]={}),a=a[s]}require({cache:{"Mapping/modules/LayerStyles/CustomLayerStylesVisualizationProvider":function(){define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase","./LayerStylesModule","geocortex/essentials/LayerStyle"],function(e,t,i,r,s){"use strict";var a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.displayName=r.app.getResource(i,"language-layerstyles-custom-name"),r.customStyleMenuItem=r.app.getResource(i,"language-layerstyles-custom-menuitem"),r}return __extends(t,e),t.prototype.canSupport=function(e){return!(!e.allowSymbolization&&!e.isUserCreated||"None"===e.featureType||!(e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&e.mapService.serviceLayer.supportsDynamicLayers||e.mapService.serviceLayer instanceof esri.layers.FeatureLayer||e.mapService.serviceLayer instanceof esri.layers.WFSLayer))},t.prototype.handleCurrentLayerChanged=function(e){this.isEnabled.set(!!e.styles&&e.styles.some(function(e){return e.id===r.CUSTOM_STYLE_ID&&e.enabled})),this.isSupported.set(this.canSupport(e)),this.visualizations=[];var t={provider:this,name:this.customStyleMenuItem,id:r.CUSTOM_STYLE_ID};this.visualizations.push(t),this.isEnabled.get()&&(this.enabledVisualization=t)},t.prototype.handleActivate=function(e){for(var t=this.currentLayer.get(),i=t.styles.filter(function(e){return e.id===r.CUSTOM_STYLE_ID})[0],s=0,a=t.styles;s<a.length;s++){var n=a[s];n.enabled=!1}i&&(this.enabledVisualization=e,i.enabled=!0,this.app.command("ResymbolizeLayer").execute({gcxLayer:t,renderer:i.getRenderer()})),this.app.event("CustomSymbolizationStartedEvent").publish(t)},t.prototype.handleApply=function(){var e=this.currentLayer.get(),t=e.styles.filter(function(e){return e.id===r.CUSTOM_STYLE_ID})[0],i=this.app.viewManager.getViewById("LayerStyleSelectorView"),a=i.getRenderer();if(a){if(t)t.setRenderer(a);else{var n=new s.LayerStyle(a,r.CUSTOM_STYLE_ID,r.CUSTOM_STYLE_ID,(!0));e.styles.push(n),this.enabledVisualization={provider:this,name:this.customStyleMenuItem,id:r.CUSTOM_STYLE_ID}}this.handleActivate(this.enabledVisualization)}},t}(i.VisualizationProviderBase);t.CustomLayerStylesVisualizationProvider=a})},"Mapping/modules/LayerStyles/LayerStyleSelectorView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbolType","geocortex/infrastructure/SymbolUtils"],function(e,t,i,r,s){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){var i=this;e.prototype.attach.call(this,t),this.viewModel=t,this.viewModel.symbologyType.bind(this,function(e){i.pictureSymbologyWidget&&e===i.viewModel.imageType&&i.pictureSymbologyWidget.activated(),i.symbologyWidget&&e===i.viewModel.simpleType&&i.symbologyWidget.activated()})},t.prototype.reset=function(){this.symbologyWidget.reset(),this.attributeSettingsView.reset(),this.pictureSymbologyWidget.reset(),this.viewModel.symbologyType.set(this.viewModel.simpleType)},t.prototype.getRenderer=function(){return this.viewModel.symbolizeByAttribute.get()?(this.attributeSettingsView.applySettings(),this.attributeSettingsView.getRenderer()):this.viewModel.symbolizeWithImagery.get()?(this.pictureSymbologyWidget.applySettings(),this.pictureSymbologyWidget.getRenderer()):(this.symbologyWidget.applySettings(),this.symbologyWidget.getRenderer())},t.prototype.setFeatureType=function(e){e=s.layerFeatureTypeToSymbolType(e),this.symbologyWidget.setFeatureType(e),this.attributeSettingsView.viewModel.featureType=e,e===r.SymbolType.POINT?(this.attributeSettingsView.viewModel.noMarker.set(!1),this.viewModel.imageType&&!this.viewModel.availableSymbologyTypes.contains(this.viewModel.imageType)&&this.viewModel.availableSymbologyTypes.addItem(this.viewModel.imageType)):(this.attributeSettingsView.viewModel.noMarker.set(!0),this.viewModel.imageType&&this.viewModel.availableSymbologyTypes.contains(this.viewModel.imageType)&&(this.viewModel.availableSymbologyTypes.removeItem(this.viewModel.imageType),this.viewModel.symbologyType.get()===this.viewModel.imageType&&this.viewModel.symbologyType.set(this.viewModel.simpleType)))},t}(i.ViewBase);t.LayerStyleSelectorView=a})},"Mapping/modules/LayerStyles/LayerStyleSelectorViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=new r.Observable(null),t.symbolizeByAttribute=new r.Observable((!1)),t.symbolizeWithImagery=new r.Observable((!1)),t.availableSymbologyTypes=new r.ObservableCollection([]),t.symbologyType=new r.Observable(""),t}return __extends(t,e),t.prototype.initialize=function(t){var i=this;e.prototype.initialize.call(this,t),this.simpleType=this.app.getResource(this.libraryId,"language-layerstyles-symbology-simple"),this.attributeType=this.app.getResource(this.libraryId,"language-layerstyles-symbology-attribute"),this.availableSymbologyTypes.addItem(this.simpleType),this.availableSymbologyTypes.addItem(this.attributeType),t.showImageSelector&&(this.imageType=this.app.getResource(this.libraryId,"language-layerstyles-symbology-image"),this.availableSymbologyTypes.addItem(this.imageType)),this.symbolizeByAttribute.syncTransform(this.symbologyType,function(e){return e===i.attributeType}),this.symbolizeWithImagery.syncTransform(this.symbologyType,function(e){return e===i.imageType}),this.symbologyType.set(this.simpleType)},t}(i.ViewModelBase);t.LayerStyleSelectorViewModel=s})},"Mapping/modules/LayerStyles/LayerStylesModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/essentials/Field"],function(e,t,i,r){"use strict";t.CUSTOM_STYLE_ID="__CUSTOM__";var s=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultRenderers={},t.initialized=!1,t.symbolizableDataTypes=[r.EssentialsFieldTypes.essentialsFieldTypeDate,r.EssentialsFieldTypes.essentialsFieldTypeDouble,r.EssentialsFieldTypes.essentialsFieldTypeInteger,r.EssentialsFieldTypes.essentialsFieldTypeSingle,r.EssentialsFieldTypes.essentialsFieldTypeSmallInteger,r.EssentialsFieldTypes.essentialsFieldTypeString],t}return __extends(i,e),i.prototype.initialize=function(){var e=this;this.app.command("ResymbolizeLayer").register(this,this.executeResymbolizeLayer,function(){return e.initialized}),this.app.command("RemoveSymbolization").register(this,this.executeRemoveSymbolization,function(){return e.initialized}),this.app.event("LayerListInitializedEvent").once(this,function(){e.populateDefaultRenderers(),e.app.event("LayerAddedEvent").subscribe(e,function(t,i){e.storeMapServiceRenderers(i)})}),this.app.event("CustomSymbolizationStartedEvent").subscribe(this,function(t){e.currentLayer&&t.name===e.currentLayer.name||(e.applyConfiguration(t),e.currentLayer=t)}),this.app.event("ProjectLoadedEvent").subscribe(this,function(){e.currentLayer=null,setTimeout(function(){for(var t=0,i=e.app.site.essentialsMap.allLayers();t<i.length;t++){var r=i[t];(r.mapService.serviceLayer instanceof esri.layers.FeatureLayer||r.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer)&&r.styles.some(function(e){return e.enabled})&&e.app.event("LayerVisualizationChangedEvent").publish(r)}},1e3)})},i.prototype.executeRemoveSymbolization=function(e){for(var t=this._getGeocortexLayer(e.gcxLayer),i=t.mapService.serviceLayer,r=t.mapService.id,s=t.id,a=0,n=t.styles;a<n.length;a++){var l=n[a];l.enabled=!1}if(i instanceof esri.layers.ArcGISDynamicMapServiceLayer){var o=(i.layerDrawingOptions||[]).slice(),y=void 0;y=o[s]?o[s]:new esri.layers.LayerDrawingOptions,this.defaultRenderers[r]&&this.defaultRenderers[r][s]?y.renderer=esri.renderer.fromJson(JSON.parse(this.defaultRenderers[r][s])):y.renderer=null,o[s]=y,i.setLayerDrawingOptions(o)}else if(i instanceof esri.layers.FeatureLayer||i instanceof esri.layers.WFSLayer){var d=null;this.defaultRenderers[r]&&(d=esri.renderer.fromJson(JSON.parse(this.defaultRenderers[r]))),(d instanceof esri.renderer.Renderer||i instanceof esri.layers.WFSLayer&&null===d)&&(i.setRenderer(d),i.redraw())}this.app.event("LayerVisualizationChangedEvent").publish(t)},i.prototype.executeResymbolizeLayer=function(e){if(e.gcxLayer&&e.renderer){var t=this._getGeocortexLayer(e.gcxLayer),i=t.mapService.serviceLayer,r=this._getRenderer(e.renderer),s=!1;if(t.mapService.featureClustering&&t.mapService.featureClustering.enabled&&(this.app.command("RemoveClusterLayer").execute({gcxLayer:t}),s=!0),t.mapService.heatMap&&t.mapService.heatMap.enabled&&this.app.command("RemoveHeatMap").execute({gcxLayer:t}),i instanceof esri.layers.ArcGISDynamicMapServiceLayer){var a=(i.layerDrawingOptions||[]).slice(),n=void 0;n=a[t.id]?a[t.id]:new esri.layers.LayerDrawingOptions,n.renderer=r,a[t.id]=n,i.setLayerDrawingOptions(a)}else(i instanceof esri.layers.FeatureLayer||i instanceof esri.layers.WFSLayer)&&(i.setRenderer(r),t.isUserCreated||s?i.refresh():i.redraw());this.app.event("LayerVisualizationChangedEvent").publish(t)}},i.prototype.applyConfiguration=function(e){var i,s=this,a=this.app.viewManager.getViewById("LayerStyleSelectorView"),n=a.viewModel,l=e.mapService.serviceLayer;a.reset(),a.setFeatureType(e.featureType),l instanceof esri.layers.ArcGISDynamicMapServiceLayer?a.attributeSettingsView.viewModel.attributes.set(e.fields.filter(function(t){return s.symbolizableDataTypes.indexOf(t.dataType)>-1&&t.name!==(e.primaryKeyField?e.primaryKeyField.name:"OBJECTID")&&t.visible&&t.dataType!==r.EssentialsFieldTypes.essentialsFieldTypeDate})):a.attributeSettingsView.viewModel.attributes.set(e.fields.filter(function(t){return s.symbolizableDataTypes.indexOf(t.dataType)>-1&&t.name!==(e.primaryKeyField?e.primaryKeyField.name:"OBJECTID")&&t.visible})),n.name.set(t.CUSTOM_STYLE_ID);var o=e.styles.filter(function(e){return e.id===t.CUSTOM_STYLE_ID})[0];if(o){if(i=o.getRenderer(),o.isSimple()){var y=i.toJson();"esriPMS"===y.symbol.type?(a.pictureSymbologyWidget.setFromRenderer(i),n.symbologyType.set(n.imageType)):(a.symbologyWidget.setFromRenderer(i),n.symbologyType.set(n.simpleType))}else{a.attributeSettingsView.setFromRenderer(i),n.symbologyType.set(n.attributeType);var d=a.attributeSettingsView.viewModel.attributes.getItems().filter(function(e){return e.name===s._getAttribute(i)})[0];a.attributeSettingsView.attributeInput.selectedIndex=a.attributeSettingsView.viewModel.attributes.indexOf(d)+1,a.attributeSettingsView.viewModel.currentAttribute.set(d.displayName)}a.attributeSettingsView.applySettings(),a.symbologyWidget.applySettings(),a.pictureSymbologyWidget.applySettings()}},i.prototype.populateDefaultRenderers=function(){for(var e=0,t=this.app.site.essentialsMap.mapServices;e<t.length;e++){var i=t[e];this.storeMapServiceRenderers(i)}this.initialized=!0},i.prototype.storeMapServiceRenderers=function(e){var t=e.serviceLayer;if((t instanceof esri.layers.FeatureLayer||t instanceof esri.layers.WFSLayer)&&!this.defaultRenderers[e.id])if(e.heatMap&&e.heatMap.defaultRenderer&&JSON.stringify(e.heatMap.defaultRenderer.toJson()))this.defaultRenderers[e.id]=JSON.stringify(e.heatMap.defaultRenderer.toJson());else if(e.featureClustering&&e.featureClustering.enabled){var i=this.app.map.graphicsLayerIds.filter(function(e){return e===t.id+"-cluster"});if(i.length>0){var r=this.app.map.getLayer(i[0]);r&&r.featureLayerRenderer&&JSON.stringify(r.featureLayerRenderer.toJson())&&(this.defaultRenderers[e.id]=JSON.stringify(r.featureLayerRenderer.toJson()))}}else t.renderer&&JSON.stringify(t.renderer.toJson())&&(this.defaultRenderers[e.id]=JSON.stringify(t.renderer.toJson()));if(t instanceof esri.layers.ArcGISDynamicMapServiceLayer){var s=[];for(var a in t.layerDrawingOptions)t.layerDrawingOptions.hasOwnProperty(a)&&t.layerDrawingOptions[a].renderer&&(this.defaultRenderers[e.id]&&this.defaultRenderers[e.id][a]?this.defaultRenderers[e.id]&&(s[a]=this.defaultRenderers[e.id][a]):s[a]=JSON.stringify(t.layerDrawingOptions[a].renderer.toJson()));this.defaultRenderers[e.id]=s}},i.prototype._getAttribute=function(e){var t=e.toJson();return t.field||t.field1||""},i.prototype._getGeocortexLayer=function(e){if("string"==typeof e){if(!this.app.site||!this.app.site.essentialsMap)return null;var t=this.app.site.essentialsMap.allLayers();return t.filter(function(t){return e===t.mapService.id})[0]}return e},i.prototype._getRenderer=function(e){return"string"==typeof e?esri.renderer.fromJson(JSON.parse(e)):e},i}(i.ModuleBase);t.LayerStylesModule=s})},"Mapping/modules/LayerStyles/LayerStylesVisualizationProvider":function(){define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase","./LayerStylesModule"],function(e,t,i,r){"use strict";var s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.displayName=r.app.getResource(i,"language-layerstyles-name"),r}return __extends(t,e),t.prototype.canSupport=function(e){return!(!e.allowSymbolization||"None"===e.featureType||!(e.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&e.mapService.serviceLayer.supportsDynamicLayers||e.mapService.serviceLayer instanceof esri.layers.FeatureLayer||e.mapService.serviceLayer instanceof esri.layers.WFSLayer))},t.prototype.handleCurrentLayerChanged=function(e){this.isEnabled.set(!!e.styles&&e.styles.some(function(e){return e.enabled&&e.id!==r.CUSTOM_STYLE_ID})),this.isSupported.set(this.canSupport(e)),this.visualizations=[];for(var t=0,i=e.styles.filter(function(e){return e.id!==r.CUSTOM_STYLE_ID});t<i.length;t++){var s=i[t],a={provider:this,name:s.displayName,id:s.id};this.visualizations.push(a),s.enabled&&(this.enabledVisualization=a)}},t.prototype.handleActivate=function(e){for(var t=this.currentLayer.get(),i=t.styles.filter(function(t){return t.id===e.id})[0],r=(t.mapService.serviceLayer,0),s=t.styles;r<s.length;r++){var a=s[r];a.enabled=!1}i&&(this.enabledVisualization=e,i.enabled=!0,this.app.command("ResymbolizeLayer").execute({gcxLayer:t,renderer:i.getRenderer()}))},t.prototype.handleApply=function(){this.handleActivate(this.enabledVisualization)},t}(i.VisualizationProviderBase);t.LayerStylesVisualizationProvider=s})},"url:/Mapping/modules/LayerStyles/LayerStyleSelectorView.html":'<div class="layer-styles symbol-dialog">\r\n\r\n    <!-- Symbolization type selector -->\r\n    <div class="symbolization-type-selector form-item">\r\n        <label for="symbolization-type" data-binding="{@text: @language-layerstyles-symbology-type}"></label>\r\n        <select id="symbolization-type" data-binding="{@source: availableSymbologyTypes}{@value: symbologyType}">\r\n            <option data-binding="{@template-for: availableSymbologyTypes}{@text: @context}"></option>\r\n        </select>\r\n    </div>\r\n\r\n    <div data-binding="{@hidden: symbolizeWithImagery}">\r\n        <!-- Group: Attribute symbology settings. -->\r\n        <div data-binding="{@visible: symbolizeByAttribute}">\r\n            <div data-binding="{@widget: AttributeSymbologySettings}{@widget-replace: true}"></div>\r\n        </div>\r\n\r\n        <!-- Symbology settings widget. -->\r\n        <div data-binding="{@hidden: symbolizeByAttribute}">\r\n            <div data-binding="{@widget: SimpleSymbolWidget}{@widget-replace: true}"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Image symbology widget. -->\r\n    <div class="layer-style-image-selector" data-binding="{@visible: symbolizeWithImagery}">\r\n        <div data-binding="{@widget: PictureSymbolWidget}{@widget-replace: true}"></div>\r\n    </div>\r\n</div>\r\n'}}),define(["Mapping/modules/LayerStyles/CustomLayerStylesVisualizationProvider","Mapping/modules/LayerStyles/LayerStyleSelectorView","Mapping/modules/LayerStyles/LayerStyleSelectorViewModel","Mapping/modules/LayerStyles/LayerStylesModule","Mapping/modules/LayerStyles/LayerStylesVisualizationProvider"],function(e,t,i,r,s){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.CustomLayerStylesVisualizationProvider",e.CustomLayerStylesVisualizationProvider),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStyleSelectorView",t.LayerStyleSelectorView),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStyleSelectorViewModel",i.LayerStyleSelectorViewModel),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.CUSTOM_STYLE_ID",r.CUSTOM_STYLE_ID),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStylesModule",r.LayerStylesModule),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStylesVisualizationProvider",s.LayerStylesVisualizationProvider)});