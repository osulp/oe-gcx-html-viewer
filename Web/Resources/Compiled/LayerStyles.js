!function(){function e(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var r=t.split("."),s=null,a=window,n=0,o=r.length;n<o;n++)s=r[n],n==o-1?a[s]=i:a[s]||(a[s]={}),a=a[s];else console.warn("Undefined shim for: "+t)}var t="<div class='layer-styles symbol-dialog'>    \x3c!-- Symbolization type selector --\x3e    <div class='symbolization-type-selector form-item'>        <label for='symbolization-type' data-binding='{@text: @language-layerstyles-symbology-type}'></label>        <select id='symbolization-type' data-binding='{@source: availableSymbologyTypes}{@value: symbologyType}'>            <option data-binding='{@template-for: availableSymbologyTypes}{@text: @context}'></option>        </select>    </div>    <div data-binding='{@hidden: symbolizeWithImagery}'>        \x3c!-- Group: Attribute symbology settings. --\x3e        <div data-binding='{@visible: symbolizeByAttribute}'>            <div data-binding='{@widget: AttributeSymbologySettings}{@widget-replace: true}'></div>        </div>        \x3c!-- Symbology settings widget. --\x3e        <div data-binding='{@hidden: symbolizeByAttribute}'>            <div data-binding='{@widget: SimpleSymbolWidget}{@widget-replace: true}'></div>        </div>    </div>    \x3c!-- Image symbology widget. --\x3e    <div class='layer-style-image-selector' data-binding='{@visible: symbolizeWithImagery}'>        <div data-binding='{@widget: PictureSymbolWidget}{@widget-replace: true}'></div>    </div></div>";require({cache:{"Mapping/modules/LayerStyles/CustomLayerStylesVisualizationProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase","./LayerStylesModule","geocortex/essentials/LayerStyle","geocortex/infrastructure/VisualizationUtils"],function(t,i,r,s,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.displayName=r.app.getResource(i,"language-layerstyles-custom-name"),r.customStyleMenuItem=r.app.getResource(i,"language-layerstyles-custom-menuitem"),r}return e(i,t),i.prototype.canSupport=function(e){return n.isSymbolizable(e)},i.prototype.handleCurrentLayerChanged=function(e){this.isEnabled.set(!!e.styles&&e.styles.some(function(e){return e.id===s.CUSTOM_STYLE_ID&&e.enabled})),this.isSupported.set(this.canSupport(e)),this.visualizations=[];var t={provider:this,name:this.customStyleMenuItem,id:s.CUSTOM_STYLE_ID};this.visualizations.push(t),this.isEnabled.get()&&(this.enabledVisualization=t)},i.prototype.handleActivate=function(e){for(var t=this.currentLayer.get(),i=t.styles.filter(function(e){return e.id===s.CUSTOM_STYLE_ID})[0],r=0,a=t.styles;r<a.length;r++)a[r].enabled=!1;i&&(this.enabledVisualization=e,i.enabled=!0,this.app.command("ResymbolizeLayer").execute({gcxLayer:t,renderer:i.getRenderer()})),this.app.event("CustomSymbolizationStartedEvent").publish(t)},i.prototype.handleApply=function(){var e=this.currentLayer.get(),t=e.styles.filter(function(e){return e.id===s.CUSTOM_STYLE_ID})[0],i=this.app.viewManager.getViewById("LayerStyleSelectorView").getRenderer();if(i){if(t)t.setRenderer(i);else{var r=new a.LayerStyle(i,s.CUSTOM_STYLE_ID,s.CUSTOM_STYLE_ID,!0);e.styles.push(r),this.enabledVisualization={provider:this,name:this.customStyleMenuItem,id:s.CUSTOM_STYLE_ID}}this.handleActivate(this.enabledVisualization)}},i}(r.VisualizationProviderBase);i.CustomLayerStylesVisualizationProvider=o})},"Mapping/modules/LayerStyles/LayerStyleSelectorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbolType","geocortex/infrastructure/SymbolUtils"],function(t,i,r,s,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.attach=function(e){var i=this;t.prototype.attach.call(this,e),this.viewModel=e,this.viewModel.symbologyType.bind(this,function(e){i.pictureSymbologyWidget&&e===i.viewModel.imageType&&i.pictureSymbologyWidget.activated(),i.symbologyWidget&&e===i.viewModel.simpleType&&i.symbologyWidget.activated()})},i.prototype.reset=function(){this.symbologyWidget.reset(),this.attributeSettingsView.reset(),this.pictureSymbologyWidget.reset(),this.viewModel.symbologyType.set(this.viewModel.simpleType)},i.prototype.getRenderer=function(){return this.viewModel.symbolizeByAttribute.get()?(this.attributeSettingsView.applySettings(),this.attributeSettingsView.getRenderer()):this.viewModel.symbolizeWithImagery.get()?(this.pictureSymbologyWidget.applySettings(),this.pictureSymbologyWidget.getRenderer()):(this.symbologyWidget.applySettings(),this.symbologyWidget.getRenderer())},i.prototype.setFeatureType=function(e){e=a.layerFeatureTypeToSymbolType(e),this.symbologyWidget.setFeatureType(e),this.attributeSettingsView.viewModel.featureType=e,e===s.SymbolType.POINT?(this.attributeSettingsView.viewModel.noMarker.set(!1),this.viewModel.imageType&&!this.viewModel.availableSymbologyTypes.contains(this.viewModel.imageType)&&this.viewModel.availableSymbologyTypes.addItem(this.viewModel.imageType)):(this.attributeSettingsView.viewModel.noMarker.set(!0),this.viewModel.imageType&&this.viewModel.availableSymbologyTypes.contains(this.viewModel.imageType)&&(this.viewModel.availableSymbologyTypes.removeItem(this.viewModel.imageType),this.viewModel.symbologyType.get()===this.viewModel.imageType&&this.viewModel.symbologyType.set(this.viewModel.simpleType)))},i}(r.ViewBase);i.LayerStyleSelectorView=n})},"Mapping/modules/LayerStyles/LayerStyleSelectorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,r,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=new s.Observable(null),e.symbolizeByAttribute=new s.Observable(!1),e.symbolizeWithImagery=new s.Observable(!1),e.availableSymbologyTypes=new s.ObservableCollection([]),e.symbologyType=new s.Observable(""),e}return e(i,t),i.prototype.initialize=function(e){var i=this;t.prototype.initialize.call(this,e),this.simpleType=this.app.getResource(this.libraryId,"language-layerstyles-symbology-simple"),this.attributeType=this.app.getResource(this.libraryId,"language-layerstyles-symbology-attribute"),this.availableSymbologyTypes.addItem(this.simpleType),this.availableSymbologyTypes.addItem(this.attributeType),e.showImageSelector&&(this.imageType=this.app.getResource(this.libraryId,"language-layerstyles-symbology-image"),this.availableSymbologyTypes.addItem(this.imageType)),this.symbolizeByAttribute.syncTransform(this.symbologyType,function(e){return e===i.attributeType}),this.symbolizeWithImagery.syncTransform(this.symbologyType,function(e){return e===i.imageType}),this.symbologyType.set(this.simpleType)},i}(r.ViewModelBase);i.LayerStyleSelectorViewModel=a})},"Mapping/modules/LayerStyles/LayerStylesModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/essentials/Field","geocortex/essentials/StreamLayerService"],function(t,i,r,s,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CUSTOM_STYLE_ID="__CUSTOM__";var n=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultRenderers={},e.initialized=!1,e.symbolizableDataTypes=[s.EssentialsFieldTypes.essentialsFieldTypeDate,s.EssentialsFieldTypes.essentialsFieldTypeDouble,s.EssentialsFieldTypes.essentialsFieldTypeInteger,s.EssentialsFieldTypes.essentialsFieldTypeSingle,s.EssentialsFieldTypes.essentialsFieldTypeSmallInteger,s.EssentialsFieldTypes.essentialsFieldTypeString],e}return e(r,t),r.prototype.initialize=function(){var e=this;this.app.command("ResymbolizeLayer").register(this,this.executeResymbolizeLayer,function(){return e.initialized}),this.app.command("RemoveSymbolization").register(this,this.executeRemoveSymbolization,function(){return e.initialized}),this.app.event("LayerListInitializedEvent").once(this,function(){e.populateDefaultRenderers(),e.app.event("LayerAddedEvent").subscribe(e,function(t,i){e.storeMapServiceRenderers(i)})}),this.app.event("CustomSymbolizationStartedEvent").subscribe(this,function(t){e.currentLayer&&t.name===e.currentLayer.name?t.mapService&&t.mapService instanceof a.StreamLayerService&&(e.currentLayer.mapService&&t.mapService.displayName===e.currentLayer.mapService.displayName||(e.applyConfiguration(t),e.currentLayer=t)):(e.applyConfiguration(t),e.currentLayer=t)}),this.app.event("ProjectLoadedEvent").subscribe(this,function(){e.currentLayer=null,setTimeout(function(){for(var t=0,i=e.app.site.essentialsMap.allLayers();t<i.length;t++){var r=i[t];(r.mapService.serviceLayer instanceof esri.layers.FeatureLayer||r.mapService.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer)&&r.styles.some(function(e){return e.enabled})&&e.app.event("LayerVisualizationChangedEvent").publish(r)}},1e3)})},r.prototype.executeRemoveSymbolization=function(e){for(var t=this._getGeocortexLayer(e.gcxLayer),i=t.mapService.serviceLayer,r=t.mapService.id,s=t.id,a=0,n=t.styles;a<n.length;a++)n[a].enabled=!1;if(i instanceof esri.layers.ArcGISDynamicMapServiceLayer){var o=(i.layerDrawingOptions||[]).slice(),l=void 0;l=o[s]?o[s]:new esri.layers.LayerDrawingOptions,this.defaultRenderers[r]&&this.defaultRenderers[r][s]?l.renderer=esri.renderer.fromJson(JSON.parse(this.defaultRenderers[r][s])):l.renderer=null,o[s]=l,i.setLayerDrawingOptions(o)}else if(i instanceof esri.layers.FeatureLayer||i instanceof esri.layers.WFSLayer){var y=null;this.defaultRenderers[r]&&(y=esri.renderer.fromJson(JSON.parse(this.defaultRenderers[r]))),(y instanceof esri.renderer.Renderer||i instanceof esri.layers.WFSLayer&&null===y)&&(i.setRenderer(y),i.redraw())}this.app.event("LayerVisualizationChangedEvent").publish(t)},r.prototype.executeResymbolizeLayer=function(e){if(e.gcxLayer&&e.renderer){var t=this._getGeocortexLayer(e.gcxLayer),i=t.mapService.serviceLayer,r=this._getRenderer(e.renderer),s=!1;if(t.mapService.featureClustering&&t.mapService.featureClustering.enabled&&(this.app.command("RemoveClusterLayer").execute({gcxLayer:t}),s=!0),t.mapService.heatMap&&t.mapService.heatMap.enabled&&this.app.command("RemoveHeatMap").execute({gcxLayer:t}),i instanceof esri.layers.ArcGISDynamicMapServiceLayer){var a=(i.layerDrawingOptions||[]).slice(),n=void 0;(n=a[t.id]?a[t.id]:new esri.layers.LayerDrawingOptions).renderer=r,a[t.id]=n,i.setLayerDrawingOptions(a)}else(i instanceof esri.layers.FeatureLayer||i instanceof esri.layers.WFSLayer)&&(i.setRenderer(r),t.isUserCreated||s?i.refresh():i.redraw());this.app.event("LayerVisualizationChangedEvent").publish(t)}},r.prototype.applyConfiguration=function(e){var t,r=this,a=this.app.viewManager.getViewById("LayerStyleSelectorView"),n=a.viewModel,o=e.mapService.serviceLayer;a.reset(),a.setFeatureType(e.featureType),o instanceof esri.layers.ArcGISDynamicMapServiceLayer?a.attributeSettingsView.viewModel.attributes.set(e.fields.filter(function(t){return r.symbolizableDataTypes.indexOf(t.dataType)>-1&&t.name!==(e.primaryKeyField?e.primaryKeyField.name:"OBJECTID")&&t.visible&&t.dataType!==s.EssentialsFieldTypes.essentialsFieldTypeDate})):a.attributeSettingsView.viewModel.attributes.set(e.fields.filter(function(t){return r.symbolizableDataTypes.indexOf(t.dataType)>-1&&t.name!==(e.primaryKeyField?e.primaryKeyField.name:"OBJECTID")&&t.visible})),n.name.set(i.CUSTOM_STYLE_ID);var l=e.styles.filter(function(e){return e.id===i.CUSTOM_STYLE_ID})[0];if(l){if(t=l.getRenderer(),l.isSimple())"esriPMS"===t.toJson().symbol.type?(a.pictureSymbologyWidget.setFromRenderer(t),n.symbologyType.set(n.imageType)):(a.symbologyWidget.setFromRenderer(t),n.symbologyType.set(n.simpleType));else{a.attributeSettingsView.setFromRenderer(t),n.symbologyType.set(n.attributeType);var y=a.attributeSettingsView.viewModel.attributes.getItems().filter(function(e){return e.name===r._getAttribute(t)})[0];a.attributeSettingsView.attributeInput.selectedIndex=a.attributeSettingsView.viewModel.attributes.indexOf(y)+1,a.attributeSettingsView.viewModel.currentAttribute.set(y.displayName)}a.attributeSettingsView.applySettings(),a.symbologyWidget.applySettings(),a.pictureSymbologyWidget.applySettings()}},r.prototype.populateDefaultRenderers=function(){for(var e=0,t=this.app.site.essentialsMap.mapServices;e<t.length;e++){var i=t[e];this.storeMapServiceRenderers(i)}this.initialized=!0},r.prototype.storeMapServiceRenderers=function(e){var t=e.serviceLayer;if((t instanceof esri.layers.FeatureLayer||t instanceof esri.layers.WFSLayer)&&!this.defaultRenderers[e.id])if(e.heatMap&&e.heatMap.defaultRenderer&&JSON.stringify(e.heatMap.defaultRenderer.toJson()))this.defaultRenderers[e.id]=JSON.stringify(e.heatMap.defaultRenderer.toJson());else if(e.featureClustering&&e.featureClustering.enabled){var i=this.app.map.graphicsLayerIds.filter(function(e){return e===t.id+"-cluster"});if(i.length>0){var r=this.app.map.getLayer(i[0]);r&&r.featureLayerRenderer&&JSON.stringify(r.featureLayerRenderer.toJson())&&(this.defaultRenderers[e.id]=JSON.stringify(r.featureLayerRenderer.toJson()))}}else t.renderer&&JSON.stringify(t.renderer.toJson())&&(this.defaultRenderers[e.id]=JSON.stringify(t.renderer.toJson()));if(t instanceof esri.layers.ArcGISDynamicMapServiceLayer){var s=[];for(var a in t.layerDrawingOptions)t.layerDrawingOptions.hasOwnProperty(a)&&t.layerDrawingOptions[a].renderer&&(this.defaultRenderers[e.id]&&this.defaultRenderers[e.id][a]?this.defaultRenderers[e.id]&&(s[a]=this.defaultRenderers[e.id][a]):s[a]=JSON.stringify(t.layerDrawingOptions[a].renderer.toJson()));this.defaultRenderers[e.id]=s}},r.prototype._getAttribute=function(e){var t=e.toJson();return t.field||t.field1||""},r.prototype._getGeocortexLayer=function(e){return"string"==typeof e?this.app.site&&this.app.site.essentialsMap?this.app.site.essentialsMap.allLayers().filter(function(t){return e===t.mapService.id})[0]:null:e},r.prototype._getRenderer=function(e){return"string"==typeof e?esri.renderer.fromJson(JSON.parse(e)):e},r}(r.ModuleBase);i.LayerStylesModule=n})},"Mapping/modules/LayerStyles/LayerStylesVisualizationProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase","./LayerStylesModule","geocortex/infrastructure/VisualizationUtils"],function(t,i,r,s,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.displayName=r.app.getResource(i,"language-layerstyles-name"),r}return e(i,t),i.prototype.canSupport=function(e){return a.isSymbolizable(e)},i.prototype.handleCurrentLayerChanged=function(e){this.isEnabled.set(!!e.styles&&e.styles.some(function(e){return e.enabled&&e.id!==s.CUSTOM_STYLE_ID})),this.isSupported.set(this.canSupport(e)),this.visualizations=[];for(var t=0,i=e.styles.filter(function(e){return e.id!==s.CUSTOM_STYLE_ID});t<i.length;t++){var r=i[t],a={provider:this,name:r.displayName,id:r.id};this.visualizations.push(a),r.enabled&&(this.enabledVisualization=a)}},i.prototype.handleActivate=function(e){for(var t=this.currentLayer.get(),i=t.styles.filter(function(t){return t.id===e.id})[0],r=(t.mapService.serviceLayer,0),s=t.styles;r<s.length;r++)s[r].enabled=!1;i&&(this.enabledVisualization=e,i.enabled=!0,this.app.command("ResymbolizeLayer").execute({gcxLayer:t,renderer:i.getRenderer()}))},i.prototype.handleApply=function(){this.handleActivate(this.enabledVisualization)},i}(r.VisualizationProviderBase);i.LayerStylesVisualizationProvider=n})},"url:/Mapping/modules/LayerStyles/LayerStyleSelectorView.html":t}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/LayerStyles/LayerStyleSelectorView.html","html",t)}),require({cache:{}}),define(["Mapping/modules/LayerStyles/CustomLayerStylesVisualizationProvider","Mapping/modules/LayerStyles/LayerStyleSelectorView","Mapping/modules/LayerStyles/LayerStyleSelectorViewModel","Mapping/modules/LayerStyles/LayerStylesModule","Mapping/modules/LayerStyles/LayerStylesVisualizationProvider"],function(t,i,r,s,a){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.CustomLayerStylesVisualizationProvider",t.CustomLayerStylesVisualizationProvider),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStyleSelectorView",i.LayerStyleSelectorView),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStyleSelectorViewModel",r.LayerStyleSelectorViewModel),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.CUSTOM_STYLE_ID",s.CUSTOM_STYLE_ID),e(s,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStylesModule",s.LayerStylesModule),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.layerStyles.LayerStylesVisualizationProvider",a.LayerStylesVisualizationProvider)})}();