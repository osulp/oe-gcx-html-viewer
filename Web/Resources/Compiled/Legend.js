!function(){var t="<div class='results-list-actions-widget' data-binding='{@visible: viewInitialized}{@widget: LegendActionsWidget}{@widget-context: @context}{@widget-required: false}'     data-menu-id='LegendActions'></div><div class='panel-filter-widget' data-binding='{@visible: viewInitialized}{@widget: LegendListFilterWidget}{@widget-context: @context}{@widget-required: true}'></div><div class='no-results' data-binding='{@hidden: hasVisibleItems}'>    <p data-binding='{@text: @language-legend-no-items}'></p></div><div class='layer-list legend' data-binding='{@visible: hasVisibleItems}{@source: onDemandRootNode}'>    <div class='legend-list' data-binding='{@template-for: onDemandRootNode}'>        <ul data-binding='{@source: children}{@template: Mapping/modules/Legend/Templates/LegendItemNode.html}'></ul>    </div></div><div class='bound-invisible' data-binding='{@var: esriLegendElement}'></div>",r="<div class='legend-item leaf clear'>    <div class='legend-swatch' data-binding='{innerHTML: swatchElement}{title: label}'></div>    <span class='legend-item-label' data-binding='{@text: label}{title: label}'></span></div>",n="<div class='legend-item group clear'>    <div class='legend-item-parent'>        <button data-binding='{class: expanderClass}{@visible: children}{@event-onclick: handleSlideToggleClick}{title: label}'>        <span class='legend-item-label' data-binding='{@text: label}{title: label}'></span></button>    </div>    <ul class='legend-item children' data-binding='{@source: children}{@visible: expanded}{@template: Mapping/modules/Legend/Templates/LegendItemNode.html}'>    </ul></div>",i="<li data-binding='{@source: @context}{@visible: isVisible}{@template-selector: templateType}'>    <div class='templ-item' data-binding='{@template-select: single-item}{@template: Mapping/modules/Legend/Templates/LegendItem.html}'></div>    <div class='templ-group' data-binding='{@template-select: group}{@template: Mapping/modules/Legend/Templates/LegendItemGroup.html}'></div></li>";function g(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var n=t.split("."),i=null,o=window,s=0,a=n.length;s<a;s++)i=n[s],s==a-1?o[i]=r:o[i]||(o[i]={}),o=o[i];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Legend/LegendModule":function(){var n,L=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/legend/LegendItemProviderFactory","./Providers/ArcGISDynamicMapService/ArcGISDynamicMapServiceLegendProvider","./Providers/ArcGISTiledMapService/ArcGISTiledMapServiceLegendProvider","./Providers/FeatureLayer/FeatureLayerLegendProvider","./Providers/KML/KMLLayerLegendProvider","./Providers/WMS/WMSLayerLegendProvider","./Providers/WFS/WFSLayerLegendProvider","./Providers/HeatMaps/HeatMapLayerLegendProvider","./Providers/ClusterLayer/ClusterLayerLegendProvider","geocortex/framework/utils/utils"],function(e,t,r,n,i,o,s,a,l,d,p,g,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u,h=(u=r.ModuleBase,L(m,u),m.prototype.initialize=function(e){this.enableThrottling=!(e&&!c.isNullOrUndefined(e.enableThrottling))||e.enableThrottling,n.LegendItemProviderFactory.registerLegendItemProvider(new i.ArcGISDynamicMapServiceLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new o.ArcGISTiledMapServiceLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new s.FeatureLayerLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new a.KMLLayerLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new l.WMSLayerLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new d.WFSLayerLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new p.HeatMapLayerLegendProvider(this.app,this.libraryId,this.enableThrottling)),n.LegendItemProviderFactory.registerLegendItemProvider(new g.ClusterLayerLegendProvider(this.app,this.libraryId,this.enableThrottling))},m);function m(){return null!==u&&u.apply(this,arguments)||this}t.LegendModule=h})},"Mapping/modules/Legend/LegendView":function(){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ui/components/FilterControl/FilterControlViewBase"],function(e,v,t,o){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.esriLegendSwatches={};var s,r=(s=t.ViewBase,i(n,s),n.prototype.registerCommands=function(){var e=this;this.app.command("SwitchToLegendView").register(this,function(){e.app.command("ActivateView").execute(e.id)})},n.prototype.resolveWidget=function(e,t,r){switch(s.prototype.resolveWidget.call(this,e,t),e){case"LegendActionsWidget":return this.app.menuRegistry.createMenuWidget(this,t,r);case"LegendListFilterWidget":if(!t)return null;var n=new o.FilterControlViewBase(this.app,this.libraryId);n.handleFilterButtonClick=dojo.hitch(this,this.handleFilterButtonClick),n.handleFilterTextClear=dojo.hitch(this,this.handleFilterTextClear);var i=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/ui/components/FilterControl/FilterControlView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.FilterControl.FilterControlViewBase",isVisible:!0},n);return i.attach(t.filterControlViewModel),i;default:return this.app.trace.warning("LegendView: Unknown Widget"),null}},n.prototype.attach=function(){var n=this;this.app.site&&this.app.site.esriLegendProcessed.get()||this.app.waitUntilApplicationReady().then(function(){function t(e){e?n._loadESRILegendWidget():n.app.site.esriLegendProcessed.set(!0)}if(null===n.app.site.hasAGOLRenderers.get())var r=n.app.site.hasAGOLRenderers.bind(n,function(e){t(e),n.app.site.hasAGOLRenderers.unbind(r)});else t(n.app.site.hasAGOLRenderers.get())})},n.prototype.activated=function(){this.viewModel.viewActive.set(!0)},n.prototype.deactivated=function(){this.viewModel.viewActive.set(!1)},n.prototype.onDestroy=function(){this.esriLegend&&this.esriLegend.destroy()},n.prototype.handleSlideToggleClick=function(e,t,r){r.expanded.set(!r.expanded.get())},n.prototype.handleClickShowLayerList=function(){this.app.command("SwitchToLayerView").execute()},n.prototype.handleFilterTextClear=function(e,t,r){this.viewModel.filterControlViewModel.filterText.set("")},n.prototype.handleFilterButtonClick=function(e,t,r){this.viewModel.filterControlViewModel.filterText.pulse()},n.prototype._loadESRILegendWidget=function(){var L=this;e(["esri/dijit/Legend"],function(e){if(e){L.esriLegend=new e({map:L.app.map,respectCurrentMapScale:!1,respectVisibility:!1,autoUpdate:!1},L.esriLegendElement),L.esriLegend.startup();for(var t=L.esriLegendElement.children,r=L.esriLegendElement.id,n=0,i=Array.prototype.slice.call(t);n<i.length;n++){var o=i[n],s=o.getElementsByTagName("div")[0];if(s)for(var a=0,l=Object.keys(L.app.map._layers);a<l.length;a++){var d=l[a];if(o.id===r+"_"+d){var p=s.children,g=[],c=Array.prototype.slice.call(p).filter(function(e){return e.classList.contains("esriLegendLayer")||e instanceof HTMLDivElement});if(1<c.length)for(var u=0,h=c;u<h.length;u++){var m=h[u];"<tbody></tbody>"!==m.innerHTML&&g.push(m.outerHTML)}0<g.length&&(v.esriLegendSwatches[d]=g);break}}}}L.app.site.esriLegendProcessed.set(!0)})},n);function n(e,t){var r=s.call(this,e,t)||this;return r.registerCommands(),r}v.LegendView=r})},"Mapping/modules/Legend/LegendViewModel":function(){var n,c=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/legend/LegendItem","geocortex/framework/observables","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItemProviderFactory","geocortex/infrastructure/ui/components/FilterControl/FilterControlComponent","geocortex/infrastructure/ui/components/FilterControl/FilterControlViewModelBase"],function(e,t,r,n,i,s,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d,p=(d=r.ViewModelBase,c(g,d),g.prototype.initialize=function(){var r=this;this.rootNode=new n.LegendItem(null),this.onDemandRootNode=new n.LegendItem(null,!0),this.filterControlViewModel=new l.FilterControlViewModelBase(this.app,this.libraryId),this.filterControlViewModel.filterInputPlaceholder.set(this.getResource("language-legend-search-placeholder")),this.filterControlViewModel.filterButtonText.set(this.getResource("language-legend-filter-button-text")),this.filterControlViewModel.setFilterControlComponent(new o.FilterControlComponent(this.app,this._filterControlId)),this.app.event("FilterControlResultChangedEvent").subscribe(this,this._handleFilterChanged),this.app.waitUntilApplicationReady().then(function(){if(r.app.site.esriLegendProcessed.get())r._handleInitializedSite(r.app.isOffline.get());else var t=r.app.site.esriLegendProcessed.bind(r,function(e){e&&(r._handleInitializedSite(r.app.isOffline.get()),r.app.site.esriLegendProcessed.unbind(t))})}),this.app.event("MapServiceAddedEvent").subscribe(this,this._handleMapServiceAddedEvent),this.app.event("MapServicePropertyChangedEvent").subscribe(this,this._handleMapServiceAddedEvent),this.app.event("MapServiceLayersChangedEvent").subscribe(this,this._handleMapServiceAddedEvent),this.app.event("MapServiceRemovedEvent").subscribe(this,this._handleMapServiceRemovedEvent),this.app.event("MapExtentChangedEvent").subscribe(this,this._handleMapExtentChangedEvent),this.app.event("LayerVisualizationChangedEvent").subscribe(this,this._handleLayerVisualizationChanged),this.app.event("ClusterLayerAddedEvent").subscribe(this,this._handleAddClusterLegend),this.app.isOffline.bind(this,function(e){try{r._clear(),r._handleInitializedSite(e),setTimeout(function(){r._handleMapExtentChangedEvent()},100)}catch(e){r.app.trace.warning("Legend error while transitioning between online/offline modes: "+e)}})},g.prototype._handleAddClusterLegend=function(e){this._handleLayerAddition(e,this.app.isOffline.get())},g.prototype._handleLayerVisualizationChanged=function(e){var t=this;setTimeout(function(){t._handleMapServiceAddedEvent(e.mapService),t._removeClusteredLegendItems()},500)},g.prototype._handleMapServiceAddedEvent=function(e){if(e){var t=e.serviceLayer;try{this._handleLayerAddition(t,this.app.isOffline.get())}catch(e){this.app.trace.warning("Error loading legend items for layer '{0}': {1}".format(t.url,e.toString()))}}},g.prototype._handleMapServiceRemovedEvent=function(e){if(e)for(var t=e.serviceLayer,r=0;r<this.rootNode.children.get().length;r++)t===this.rootNode.children.get()[r].esriLayer&&(this.rootNode.children.removeAt(r),this._removeTopLevelItem(r))},g.prototype._clear=function(){this._onServiceLayerAddConnectHandle&&(this._onServiceLayerAddConnectHandle.remove(),this._onServiceLayerAddConnectHandle=null),this._onLayerRemoveHandle&&(this._onLayerRemoveHandle.remove(),this._onLayerRemoveHandle=null),this._serviceLayerVisEventSubscribeHandle&&(this.app.event("MapServiceVisibilityChangedEvent").unsubscribe(this._serviceLayerVisEventSubscribeHandle),this._serviceLayerVisEventSubscribeHandle=null),this._layerVisEventSubscribeHandle&&(this.app.event("LayerVisibilityChangedEvent").unsubscribe(this._layerVisEventSubscribeHandle),this._layerVisEventSubscribeHandle=null),this._clearTopLevelItems(),this.hasVisibleItems.set(!1)},g.prototype._handleInitializedSite=function(s){var a=this;this._map=this.app.map;for(var l={},e=this._map.layerIds.concat(this._map.graphicsLayerIds),t=function(e){var t,r,n,i=d._map.getLayer(e);if(!i)return"continue";function o(e,t){try{a._handleLayerAddition(e,t)}catch(e){a.app.trace.warning("Error loading legend items for layer '{0}': {1}".format(i.url,e.toString()))}}(l[i.url]=i)instanceof esri.layers.WFSLayer&&"esriGeometryComplex"===i.geometryType&&0===i.graphics.length?(r=s,n=(t=i).on("graphic-add",function(){n.remove(),o(t,r)})):o(i,s)},d=this,r=0,n=e;r<n.length;r++)t(n[r]);this._onServiceLayerAddConnectHandle=this._map.on("layer-add",function(t){if(!l[t.layer.url])try{a._handleLayerAddition(t.layer,s)}catch(e){a.app.trace.warning("Error loading legend items for layer '{0}': {1}".format(t.layer.url,e.toString()))}}),this._onLayerRemoveHandle=this._map.on("layer-remove",function(e){a._handleLayerRemoval(e.layer,s)}),this._layerVisEventSubscribeHandle=this.app.event("LayerVisibilityChangedEvent").subscribe(this,this._handleMapExtentChangedEvent),this._serviceLayerVisEventSubscribeHandle=this.app.event("MapServiceVisibilityChangedEvent").subscribe(this,this._handleMapExtentChangedEvent)},g.prototype._refreshLegend=function(){this._handleMapExtentChangedEvent()},g.prototype._handleMapExtentChangedEvent=function(){var e=this;if(this.viewActive.get())try{this._handleMapExtentChangedEventImpl()}catch(e){}else this.extentChangedBindingToken||(this.extentChangedBindingToken=this.viewActive.bind(this,function(){e.viewActive.unbind(e.extentChangedBindingToken),e.extentChangedBindingToken=null,e._handleMapExtentChangedEventImpl()}))},g.prototype._handleMapExtentChangedEventImpl=function(){for(var e=this.app.map.getScale(),t=!1,r=0,n=this._topLevelItems;r<n.length;r++){var i=n[r];i&&(this._walkLegendTree(e,i),i.isVisible.get()&&("group"!==i.templateType||"group"===i.templateType&&i.children.length())&&(t=!0))}this._removeClusteredLegendItems(),this._populateOnDemandRootNode(),t!==this.hasVisibleItems.get()&&this.hasVisibleItems.set(t)},g.prototype._populateOnDemandRootNode=function(){this.onDemandRootNode.children.clear();var e=this.rootNode.children.get().filter(function(e){return e.isVisible.get()});this.onDemandRootNode.children.addItems(e)},g.prototype._isVisibleInTree=function(e){if(e&&!e.isVisible())return!0;if(e){if(null==e.parentLayerId)return!1;var t=e.mapService.findLayerById(e.parentLayerId);return!!t&&this._isVisibleInTree(t)}return!1},g.prototype._walkLegendTree=function(e,t){if(t.essLayer&&this._isVisibleInTree(t.essLayer))return this._hideLegendItem(t),0;if(!t.essLayer&&!t.esriLayer.visible)return this._hideLegendItem(t),0;if(t.isCluster)return 1;for(var r=0,n=0<t.children.getLength(),i=0;i<t.children.getLength();++i)r+=this._walkLegendTree(e,t.children.getAt(i));var o,s=Number.POSITIVE_INFINITY;s=t.essLayer?t.essLayer.minScale:t.esriLayer.minScale,o=t.essLayer?t.essLayer.maxScale:t.esriLayer.maxScale;var a=!1;return 0===s&&0===o?a=!0:o<=e&&e<=s&&(a=!0),(a=a&&(t.essLayer?t.essLayer.isVisible():t.esriLayer.visible))?a=n&&0===r?this._setFilterContingentLegendVisibility(t,!1):this._setFilterContingentLegendVisibility(t,!0):this._setFilterContingentLegendVisibility(t,!1),!a||0===r&&0<t.children.getLength()?0:r+(n?0:1)},g.prototype._hideLegendItem=function(e){!0===e.isVisible.get()&&e.isVisible.set(!1)},g.prototype._showLegendItem=function(e){!1===e.isVisible.get()&&e.isVisible.set(!0)},g.prototype._setFilterContingentLegendVisibility=function(e,t){var r=t&&-1===this._filteredOutLegendItemLabels.indexOf(e.label.get());return r?this._showLegendItem(e):this._hideLegendItem(e),r},g.prototype._handleLayerAddition=function(e,t){var r=this._getProvider(e,t);if(r){var n=r.item;if(r.code.get()===s.LegendItemProviderResponseCode.Show||r.code.get()===s.LegendItemProviderResponseCode.Pending)this._replaceDuplicate(n,r)||this._addTopLevelItem(n,r);else if(r.code.get()===s.LegendItemProviderResponseCode.Hide){for(var i=0;i<this.rootNode.children.length();i++)if(this.rootNode.children.getAt(i).esriLayer===n.esriLayer){this.rootNode.children.removeAt(i);break}for(i=0;i<this._topLevelItems.length;i++)if(this._topLevelItems[i]&&this._topLevelItems[i].esriLayer===n.esriLayer){this._removeTopLevelItem(i);break}}this._handleMapExtentChangedEvent()}},g.prototype._handleLayerRemoval=function(e,t){var r=this._getProvider(e,t);if(r){for(var n=r.item,i=0;i<this.rootNode.children.length();i++)if(this.rootNode.children.getAt(i).esriLayer===n.esriLayer){if(n.esriLayer instanceof esri.layers.FeatureLayer){var o=n.esriLayer.name;(!this._namePositionDictionary.hasOwnProperty(o)||this._namePositionDictionary[o]>i)&&(this._namePositionDictionary[o]=i)}this.rootNode.children.removeAt(i);break}for(i=0;i<this._topLevelItems.length;i++)if(this._topLevelItems[i]&&this._topLevelItems[i].esriLayer===n.esriLayer){this._removeTopLevelItem(i);break}this._handleMapExtentChangedEvent()}},g.prototype._getProvider=function(e,t){for(var r=0,n=a.LegendItemProviderFactory.getProviders();r<n.length;r++){var i=n[r];if(!t||i.supportsOffline()){var o=void 0;try{o=i.provide(e)}catch(e){this.app.trace.warning("Error building legend: "+e);continue}if(o&&o.code.get()!==s.LegendItemProviderResponseCode.NotFound)return o}}return null},g.prototype._replaceDuplicate=function(e,t){for(var r=this,n=0;n<this.rootNode.children.get().length;n++){var i=this.rootNode.children.get()[n];if(e.esriLayer===i.esriLayer)return this.rootNode.children.removeAt(n),this.rootNode.children.insertItem(n,e),this._topLevelItems[n]=e,this._getLegendFlatListFromItem(i).forEach(function(e){r.filterControlViewModel.getFilterControlComponent().removeRegisteredItem(e)}),this._registerFilterableItem(e,t),!0}return!1},g.prototype._addTopLevelItem=function(e,t){var r=0;if(e.esriLayer instanceof esri.layers.FeatureLayer){var n=e.esriLayer.name;n&&this._namePositionDictionary.hasOwnProperty(n)&&(r=this._namePositionDictionary[n])}this.rootNode.children.insertItem(r,e),this._topLevelItems.unshift(e),this._registerFilterableItem(e,t)},g.prototype._registerFilterableItem=function(t,r){var n=this;if(r&&r.code.get()!==s.LegendItemProviderResponseCode.Show)var i=r.code.bind(this,function(e){e===s.LegendItemProviderResponseCode.Show&&(r.code.unbind(i),n._getLegendFlatListFromItem(t).forEach(function(e){return n.filterControlViewModel.getFilterControlComponent().registerFilterableItem(e,[e.label.get()])}))});else this._getLegendFlatListFromItem(t).forEach(function(e){return n.filterControlViewModel.getFilterControlComponent().registerFilterableItem(e,[e.label.get()])})},g.prototype._removeTopLevelItem=function(e){var t=this,r=this._topLevelItems[e];if(!r)return!1;this._topLevelItems.splice(e,1),this._getLegendFlatListFromItem(r).forEach(function(e){t.filterControlViewModel.getFilterControlComponent().removeRegisteredItem(e)})},g.prototype._clearTopLevelItems=function(){this._topLevelItems.length=0,this.filterControlViewModel.getFilterControlComponent().clear()},g.prototype._getLegendFlatListFromItem=function(e){var t=this,r=[];return r.push(e),"group"===e.templateType&&e.children.get().forEach(function(e){r=r.concat(t._getLegendFlatListFromItem(e))}),r},g.prototype._removeClusteredLegendItems=function(){for(var e=0,t=this._topLevelItems;e<t.length;e++){var r=t[e];r&&r.esriLayer instanceof esri.layers.FeatureLayer&&null===r.esriLayer.renderer&&r.isVisible.set(!1)}},g.prototype._handleFilterChanged=function(e){if(e.filterControlId===this._filterControlId){this._restoreExpandedLegendItems(),this._filteredOutLegendItemLabels=e.filterableItems.filter(function(e){return!e.queryMatched}).map(function(e){return e.item.label.get()});var t=e.filterableItems.filter(function(e){return e.queryMatched}).map(function(e){return e.item});this._processDisplayableLegendItems(t,e.filterableItems.length&&!e.filterableItems[0].filterQuery),this._refreshLegend()}},g.prototype._restoreExpandedLegendItems=function(){this._itemsExpandedByFilter&&this._itemsExpandedByFilter.length&&(this._itemsExpandedByFilter.forEach(function(e){return e.expanded.set(!1)}),this._itemsExpandedByFilter.length=0)},g.prototype._processDisplayableLegendItems=function(e,t){var r=this;function n(e){!function(e){var t=r._filteredOutLegendItemLabels.indexOf(e);0<=t&&r._filteredOutLegendItemLabels.splice(t,1)}(e.label.get()),function(e){e.expanded.get()||t||(e.expanded.set(!0),r._itemsExpandedByFilter.push(e))}(e)}void 0===t&&(t=!1),e.forEach(function(e){!function(e){for(var t=e.parent;t;)n(t),t=t.parent}(e),function(e){n(e),e.children.get().forEach(function(e){n(e)})}(e)})},g);function g(){var e=null!==d&&d.apply(this,arguments)||this;return e.hasVisibleItems=new i.Observable(!1),e.viewActive=new i.Observable(!1),e.extentChangedBindingToken=null,e.esriLegendProcessed=new i.Observable(!1),e._topLevelItems=[],e._filteredOutLegendItemLabels=[],e._itemsExpandedByFilter=[],e._filterControlId="LegendListFilterControl",e._namePositionDictionary={},e}t.LegendViewModel=p})},"Mapping/modules/Legend/Providers/ArcGISCommonLegendProviderClasses/ArcGISMapServiceLegendProvider":function(){define(["require","exports","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem","geocortex/essentials/RestHelperHTTPService","geocortex/framework/utils/utils","geocortex/framework/utils/ArrayUtils"],function(e,t,L,v,i,y,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.supportsOffline=function(){return this.offlineSupported},n.prototype.provide=function(t){var r=this;if((null!=t.declaredClass?t.declaredClass:null)!==this.layerType)return new L.LegendItemProviderResponse(L.LegendItemProviderResponseCode.NotFound,null);if(Number(t.version)<10.01)return new L.LegendItemProviderResponse(L.LegendItemProviderResponseCode.NotFound,null);if(t.url&&0<=t.url.indexOf("/ImageServer"))return new L.LegendItemProviderResponse(L.LegendItemProviderResponseCode.NotFound,null);for(var e=this.app.site,n="",i=null,o=0,s=e.essentialsMap.mapServices;o<s.length;o++){var a=s[o];if(a.serviceLayer===t){i=a;break}}var l=null;i&&(l=this._getLegendUrl(i)),null==l&&(l=t.url.replace("/MapServer","/MapServer/legend"));var d=new v.LegendItem(t,this.useThrottledCollections),p=esri.request({url:l,content:{f:"json"},handleAs:"json",callbackParamName:"callBack"}),g=new L.LegendItemProviderResponse(L.LegendItemProviderResponseCode.Pending,d);if(p.then(function(e){r._handleLegendResponse(e,g,d,t,i)},function(e){r._handleLegendError(d,e)}),i)n=i.displayName;else{var c=t.url.lastIndexOf("/");-1<c&&(n=t.url.substr(c))}return d.label.set(n),d.templateType="group",g},n.prototype._handleLegendResponse=function(e,t,r,n,i){this._populateItemForLayer(e,t,r,n,i)},n.prototype._findGcxLayerForEsriLayer=function(e,t){return e.findLayerById(t.layerId)},n.prototype._populateItemForLayer=function(e,t,c,u,h){if(e){c.isVisible.set(!0);for(var r=function(s){var a=null,e=null,l=new v.LegendItem(u,m.useThrottledCollections);if(l.label.set(e||s.layerName),l.essLayer=a,h){if(!(a=m._findGcxLayerForEsriLayer(h,s)))return"continue";if(!a.includeInLegend)return"continue";e=a.displayName;var t=y.getProp(h,["serviceLayer","layerDrawingOptions",a.id,"renderer","attributeField"]);if(t){var r=f.firstOrDefault(a.fields.filter(function(e){return e.name===t})),n=r?r.alias||r.name:t,i=m._addFieldTitleForClassBreaks(a,u,s,n);(i.parent=l).children.addItem(i)}}for(var o=function(e){var t=e.imageData,r=String.escapeHtml(t),n=new v.LegendItem(u,m.useThrottledCollections);n.label.set(e.label?e.label:m.app.getResource(m.libraryId,"language-legend-default-swatch-label")),n.sublayerId=s.layerId,n.essLayer=a;var i="data:"+e.contentType+";base64,"+r,o=m.app.getResource(m.libraryId,"language-legend-icon-alt-text").format(n.label.get());n.swatchElement.delegateGetter=function(){return"<img src='"+i+"' alt='"+o+"' />"},(n.parent=l).children.addItem(n)},d=0,p=s.legend;d<p.length;d++)o(p[d]);if(1===l.children.getLength()){var g=l.children.getAt(0);g.templateType="single-item",g.label.set(l.label.get()),(g.parent=c).children.addItem(g)}else 1<l.children.getLength()&&(l.templateType="group",(l.parent=c).children.addItem(l))},m=this,n=0,i=e.layers;n<i.length;n++)r(i[n]);0<c.children.getLength()&&(c.templateType="group"),t.code.set(L.LegendItemProviderResponseCode.Show)}else this.app.trace.warning("Could not fetch legend entry for '{0}'".format(u.url))},n.prototype._handleLegendError=function(e,t){this.app.trace.warning("Error fetching legend information: "+t.toString()),e.isVisible.set(!1)},n.prototype._getLegendUrl=function(e){var t=null;if(e&&e.serviceLayer&&e.serviceLayer.url){var r=e.serviceLayer.url.match(/(\/MapServer\/jobs\/[\d\w]+)[\?\/]?/),n=r&&r[1]?r[1]:"/MapServer";t=e.serviceLayer.url.replace(n,n+"/legend")}return t&&e.serviceToken&&!/.*token=.*/.test(t)&&(t=i.RestHelperHTTPService.appendTokenToUrl(t,e.serviceToken)),t},n.prototype._addFieldTitleForClassBreaks=function(e,t,r,n){var i;return(i=new v.LegendItem(t,this.useThrottledCollections)).essLayer=e,i.sublayerId=r.layerId,i.swatchElement.delegateGetter=function(){return'<table cellpadding="0" cellspacing="0" width="95%" class="esriLegendLayer"><tbody><tr><td><table width="95%"><tbody><tr><td align="left">'+n+"</td></tr></tbody></table></td></tr></tbody></table>"},i},n);function n(e,t,r,n,i){this.app=e,this.libraryId=t,this.layerType=r||"",this.offlineSupported=n||!1,this.useThrottledCollections=i||!1}t.ArcGISMapServiceLegendProvider=r})},"Mapping/modules/Legend/Providers/ArcGISDynamicMapService/ArcGISDynamicMapServiceLegendProvider":function(){var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","./../ArcGISCommonLegendProviderClasses/ArcGISMapServiceLegendProvider","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem"],function(e,t,r,m,L){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=(i=r.ArcGISMapServiceLegendProvider,a(o,i),o.prototype.provide=function(t){var r=this;if((null!=t.declaredClass?t.declaredClass:null)!==this.layerType)return new m.LegendItemProviderResponse(m.LegendItemProviderResponseCode.NotFound,null);var e=t;if(Number(e.version)<10.01)return new m.LegendItemProviderResponse(m.LegendItemProviderResponseCode.NotFound,null);for(var n=this.app.site,i="",o=null,s=0,a=n.essentialsMap.mapServices;s<a.length;s++){var l=a[s];if(l.serviceLayer===t){o=l;break}}var d=null;o&&(d=this._getLegendUrl(o)),null==d&&(d=t.url.replace("/MapServer","/MapServer/legend"));var p=new L.LegendItem(t,this.useThrottledCollections),g={};if(o){if(0===o.layers.length)return new m.LegendItemProviderResponse(m.LegendItemProviderResponseCode.NotFound,null);o.supportsDynamicLayers&&e.dynamicLayerInfos&&0<e.dynamicLayerInfos.length&&(g.dynamicLayers=this.getDynamicLayersParameterJSON(e)),i=o.displayName}else{var c=t.url.lastIndexOf("/");-1<c&&(i=t.url.substr(c))}p.label.set(i),p.templateType="group",g.f="json";var u=esri.request({url:d,content:g,handleAs:"json",callbackParamName:"callBack"}),h=new m.LegendItemProviderResponse(m.LegendItemProviderResponseCode.Pending,p);return u.then(function(e){r._handleLegendResponse(e,h,p,t,o)},function(e){r._handleLegendError(p,e)}),h},o.prototype.getDynamicLayersParameterJSON=function(e){var t=[];if(e.dynamicLayerInfos)for(var r=0,n=e.dynamicLayerInfos;r<n.length;r++){var i=n[r];if(i){var o=new s;o.source=i.source.toJson(),o.id=i.id,e.layerDrawingOptions&&e.layerDrawingOptions[i.id]&&(o.drawingInfo=e.layerDrawingOptions[i.id].toJson()),t.push(o)}}return JSON.stringify(t)},o);function o(e,t,r){var n=i.call(this,e,t,"esri.layers.ArcGISDynamicMapServiceLayer",!1,!!r)||this;return n.offlineSupported=!0,n}t.ArcGISDynamicMapServiceLegendProvider=n;var s=function(){}})},"Mapping/modules/Legend/Providers/ClusterLayer/ClusterLayerLegendProvider":function(){define(["require","exports","geocortex/infrastructure/ClusterLayer","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem","./../FeatureLayer/FeatureLayerLegendProvider"],function(e,t,l,d,p,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.supportsOffline=function(){return!0},n.prototype.provide=function(e){if(!(e instanceof l.ClusterLayer))return new d.LegendItemProviderResponse(d.LegendItemProviderResponseCode.NotFound,null);for(var t,r=0,n=this.app.site.essentialsMap.mapServices;r<n.length;r++){var i=n[r];if(i.serviceLayer===e.featureLayer){t=i;break}}var o=new p.LegendItem(e,this.useThrottledCollections);o.label.set(t.displayName);for(var s=0,a=t.layers;s<a.length;s++)a[s].includeInLayerList&&this.populateItemForLayer(o,e,null);return o&&o.children&&o.children.length()&&t.featureClustering.enabled?new d.LegendItemProviderResponse(d.LegendItemProviderResponseCode.Show,o):t.featureClustering.enabled?void 0:new d.LegendItemProviderResponse(d.LegendItemProviderResponseCode.Hide,o)},n.prototype.populateItemForLayer=function(t,s,e){var a=new Array;if(t.essLayer=s.gcxLayer,s&&s.renderer&&s.gcxLayer.includeInLegend){new i.FeatureLayerLegendProvider(this.app,this.libraryId,!0).populateItemForLayer(t,s.gcxLayer,s.singleFeatureLayer,s.gcxLayer.mapService.serviceUrl);for(var l=s.renderer.infos,r=function(e){var t=l[e].symbol,r=String.escapeHtml(t.color.toHex()),n=String.escapeHtml(""+t.size),i=t.color.toRgb(),o=new p.LegendItem(s.featureLayer,d.useThrottledCollections);o.isCluster=!0,o.essLayer=s.gcxLayer,o.isVisible.sync(s.rendererInformation[e].isVisible),o.label.sync(s.rendererInformation[e].rangeString),o.swatchElement.delegateGetter=function(){return"<div class='simple-swatch circle' style='background-color: "+r+"; width: "+n+"px; height: "+n+"px; border-radius: 50%; background-clip: padding-box; border: 4px solid rgba("+i[0]+", "+i[1]+", "+i[2]+", 0.25);'></div>"},a.push(o)},d=this,n=0;n<l.length;n++)r(n)}a.forEach(function(e){return e.parent=t}),t.children.addItems(a),0<t.children.getLength()&&(t.templateType="group")},n);function n(e,t,r){this.app=e,this.libraryId=t,this.useThrottledCollections=!!r}t.ClusterLayerLegendProvider=r})},"Mapping/modules/Legend/Providers/ArcGISTiledMapService/ArcGISTiledMapServiceLegendProvider":function(){var n,s=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","./../ArcGISCommonLegendProviderClasses/ArcGISMapServiceLegendProvider"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r.ArcGISMapServiceLegendProvider,s(o,n),o);function o(e,t,r){return n.call(this,e,t,"esri.layers.ArcGISTiledMapServiceLayer",!1,!!r)||this}t.ArcGISTiledMapServiceLegendProvider=i})},"Mapping/modules/Legend/Providers/FeatureLayer/FeatureLayerLegendProvider":function(){define(["require","exports","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem","geocortex/infrastructure/SymbolUtils","./../../LegendView","geocortex/framework/utils/utils","geocortex/framework/utils/ArrayUtils"],function(e,t,v,f,g,I,l,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.supportsOffline=function(){return!0},n.prototype.provide=function(e){var t=null!=e.declaredClass?e.declaredClass:null;if("esri.layers.FeatureLayer"!==t&&"esri.layers.StreamLayer"!==t)return new v.LegendItemProviderResponse(v.LegendItemProviderResponseCode.NotFound,null);for(var r=this.app.site,n=0,i=r.essentialsMap.mapServices;n<i.length;n++){var o=i[n];if(o.serviceLayer instanceof esri.layers.KMLLayer){for(var s=0,a=o.serviceLayer.getLayers();s<a.length;s++)if(a[s]===e)return new v.LegendItemProviderResponse(v.LegendItemProviderResponseCode.NotFound,null)}else if(o.serviceLayer===e){if(o.heatMap&&o.heatMap.enabled&&Modernizr.canvas)return new v.LegendItemProviderResponse(v.LegendItemProviderResponseCode.NotFound,null);if(o.featureClustering&&o.featureClustering.enabled)return new v.LegendItemProviderResponse(v.LegendItemProviderResponseCode.NotFound,null)}}for(var l=new f.LegendItem(e,this.useThrottledCollections),d=e,p=null,g=0,c=r.getFeatureServices().concat(r.getStreamServices());g<c.length;g++){var u=c[g];if(u.serviceLayer===e){p=u;break}}if(p){l.label.set(p.displayName);for(var h=0,m=p.layers;h<m.length;h++){var L=m[h];L.includeInLegend&&this.populateItemForLayer(l,L,d,null)}}else l.label.set(d.name),this.populateItemForLayer(l,null,d,null);return l&&l.children&&l.children.length()?new v.LegendItemProviderResponse(v.LegendItemProviderResponseCode.Show,l):new v.LegendItemProviderResponse(v.LegendItemProviderResponseCode.Hide,l)},n.prototype._buildLegendItemsForESRISwatch=function(r,n,e){for(var i=[],t=function(e){var t=void 0;(t=new f.LegendItem(n,o.useThrottledCollections)).essLayer=r,t.swatchElement.delegateGetter=function(){return e.replace(/dojoxUnique/g,l.alphaNumericToken())},i.push(t)},o=this,s=0,a=e;s<a.length;s++)t(a[s]);return 1===e.length&&i[0].label.set(r&&r.displayName?r.displayName:n.name),i},n.prototype._buildLegendItemForTemplate=function(e,t,r){var n;if((n=new f.LegendItem(t,this.useThrottledCollections)).essLayer=e,n.label.set(r.name),t.renderer){var i=this._getTemplateSymbol(r,t.renderer);i&&this._populateSwatchElement(n,i)}return n},n.prototype._buildLegendItemFromSimpleRenderer=function(e,t,r){var n;return(n=new f.LegendItem(t,this.useThrottledCollections)).essLayer=e,n.label.set(e&&e.displayName?e.displayName:t.name),r.symbol&&this._populateSwatchElement(n,r.symbol),n},n.prototype._buildLegendItemFromRendererInfo=function(e,t,r){var n;return(n=new f.LegendItem(t,this.useThrottledCollections)).essLayer=e,n.label.set(r.label),r.symbol&&this._populateSwatchElement(n,r.symbol),n},n.prototype._addFieldTitleForClassBreaks=function(e,t,r){var n;(n=new f.LegendItem(t,this.useThrottledCollections)).essLayer=e;var i=r.attributeField,o=s.firstOrDefault(e.fields.filter(function(e){return e.name===i}));return o&&o.alias&&(i=o.alias),n.swatchElement.delegateGetter=function(){return'<table cellpadding="0" cellspacing="0" width="95%" class="esriLegendLayer"><tbody><tr><td><table width="95%"><tbody><tr><td align="left">'+i+"</td></tr></tbody></table></td></tr></tbody></table>"},n},n.prototype._populateSwatchElement=function(e,t){if(t&&t.type&&e){var r=t.color?t.color.toCss():"rgb(255,255,255)",n=String.escapeHtml(r);switch(t.type){case"picturefillsymbol":case"picturemarkersymbol":var i=t.url,o=this.app.getResource(this.libraryId,"language-legend-icon-alt-text").format(e.label.get()),s=t.width,a=t.height,l=String.escapeHtml(i);e.swatchElement.delegateGetter=function(){return"<img src='"+l+"' alt='"+o+"' style='width:"+s+"px;height:"+a+"px'/>"};break;case"simplefillsymbol":case"simplemarkersymbol":case"simplelinesymbol":var d=document.createElement("div"),p=t instanceof esri.symbol.SimpleMarkerSymbol?t.size+(t.outline?t.outline.width:0):32;g.createSymbolSwatch(d,p,t),e.swatchElement.delegateGetter=function(){return d.innerHTML};break;default:e.swatchElement.delegateGetter=function(){return"<div class='simple-swatch square' style='background-color: "+n+"; border-color: "+n+";'></div>"}}}},n.prototype._getTemplateSymbol=function(e,t){var r=new esri.Graphic(null);return r.attributes={},e.prototype.attributes&&dojo.mixin(r.attributes,e.prototype.attributes),t.getSymbol(r)},n.prototype.populateItemForLayer=function(t,e,r,n){var i,o=new Array;if(t.essLayer=e,i=-1<r.id.indexOf("-explodedClusterLayer")?r.id.substring(0,r.id.indexOf("-explodedClusterLayer")):r.id,r&&I.esriLegendSwatches[i]&&(r.renderer.visualVariables||r.renderer.valueExpression))o.push.apply(o,this._buildLegendItemsForESRISwatch(e,r,I.esriLegendSwatches[i])),1===o.length&&(o[0].forceExpand=!0);else if(r.renderer&&(r.renderer instanceof esri.renderer.UniqueValueRenderer||r.renderer instanceof esri.renderer.ClassBreaksRenderer)&&r.renderer.infos&&r.renderer.infos.length){var s=[];r.renderer instanceof esri.renderer.ClassBreaksRenderer&&o.push(this._addFieldTitleForClassBreaks(e,r,r.renderer));for(var a=0,l=r.renderer.infos;a<l.length;a++){var d=l[a];-1===s.indexOf(d.label)&&(o.push(this._buildLegendItemFromRendererInfo(e,r,d)),s.push(d.label))}if(r.renderer.defaultSymbol){var p=new f.LegendItem(r,this.useThrottledCollections);p.essLayer=e,p.label.set(this.app.getResource(this.libraryId,"language-legend-all-other-values")),this._populateSwatchElement(p,r.renderer.defaultSymbol),o.push(p)}}else if(r.renderer&&r.renderer instanceof esri.renderer.SimpleRenderer&&r.renderer.symbol)o.push(this._buildLegendItemFromSimpleRenderer(e,r,r.renderer));else if(r.templates&&0<r.templates.length)for(var g=0,c=r.templates;g<c.length;g++){var u=c[g];o.push(this._buildLegendItemForTemplate(e,r,u))}else if(r.types&&0<r.types.length)for(var h=0,m=r.types;h<m.length;h++){var L=m[h];if(L.templates)for(var v=0,y=L.templates;v<y.length;v++)u=y[v],o.push(this._buildLegendItemForTemplate(e,r,u))}o.forEach(function(e){return e.parent=t}),t.children.addItems(o),0<t.children.getLength()&&(t.templateType="group")},n.prototype._handleLegendError=function(e,t){this.app.trace.warning("Error fetching legend information: "+t.toString())},n);function n(e,t,r){this.app=e,this.libraryId=t,this.mapServiceLegends={},this.useThrottledCollections=!!r}t.FeatureLayerLegendProvider=r})},"Mapping/modules/Legend/Providers/HeatMaps/HeatMapLayerLegendProvider":function(){define(["require","exports","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem","geocortex/infrastructure/ColorUtils"],function(e,t,l,g,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.supportsOffline=function(){return!0},n.prototype.provide=function(e){if(!(e instanceof esri.layers.FeatureLayer&&Modernizr.canvas))return new l.LegendItemProviderResponse(l.LegendItemProviderResponseCode.NotFound,null);for(var t,r=this.app.site,n=e,i=0;i<r.essentialsMap.mapServices.length;i++){var o=r.essentialsMap.mapServices[i];if(o.serviceLayer===n){t=o;break}}if(!(t&&t.heatMap&&t.heatMap.enabled&&t.heatMap.includeInLegend))return new l.LegendItemProviderResponse(l.LegendItemProviderResponseCode.NotFound,null);var s=new g.LegendItem(e,this.useThrottledCollections);for(s.label.set(t.displayName),i=0;i<t.layers.length;i++){var a=t.layers[i];a.includeInLayerList&&this.populateItemForLayer(s,a,n,null)}return s&&s.children&&s.children.length()?new l.LegendItemProviderResponse(l.LegendItemProviderResponseCode.Show,s):new l.LegendItemProviderResponse(l.LegendItemProviderResponseCode.Hide,s)},n.prototype.populateItemForLayer=function(t,o,s,e){var a=new Array;t.essLayer=o;var r=s.renderer;if(r&&r instanceof esri.renderer.HeatmapRenderer){var n=r.colors;!n&&r.colorStops&&(n=r.colorStops.map(function(e){var t=e.color;return t instanceof dojo.Color?t.toCss(!0):t instanceof Array?c.getStringFromList(t):t}));for(var l=n.filter(function(e){return!e.match(/rgba.*,(?= 0\))/g)}),i=function(e){var t=l[e],r=String.escapeHtml(t),n=new g.LegendItem(s,d.useThrottledCollections);n.essLayer=o;var i="";0===e?i=d.app.getResource(d.libraryId,"language-legend-heat-maps-low"):e===l.length-1&&(i=d.app.getResource(d.libraryId,"language-legend-heat-maps-high")),n.label.set(i),n.swatchElement.delegateGetter=function(){return"<div class='simple-swatch square' style='background-color: "+r+"; border-color: "+r+";'></div>"},a.push(n)},d=this,p=l.length-1;0<=p;p--)i(p)}a.forEach(function(e){return e.parent=t}),t.children.addItems(a),0<t.children.getLength()&&(t.templateType="group")},n);function n(e,t,r){this.app=e,this.libraryId=t,this.useThrottledCollections=!!r}t.HeatMapLayerLegendProvider=r})},"Mapping/modules/Legend/Providers/KML/KMLLayerLegendProvider":function(){define(["require","exports","./../FeatureLayer/FeatureLayerLegendProvider","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem"],function(e,t,n,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(i.prototype.supportsOffline=function(){return!0},i.prototype.provide=function(e){if(!(e instanceof esri.layers.KMLLayer))return new a.LegendItemProviderResponse(a.LegendItemProviderResponseCode.NotFound,null);for(var t,r=this.app.site,n=0;n<r.essentialsMap.mapServices.length;n++){var i=r.essentialsMap.mapServices[n];i.serviceLayer===e&&(t=i)}var o=new l.LegendItem(e,this.useThrottledCollections);t?o.label.set(t.displayName):o.label.set(this.app.getResource(this.libraryId,"language-legend-kml-default-title"));var s=t.serviceLayer.getLayers();for(n=0;n<s.length;n++)s[n]instanceof esri.layers.FeatureLayer&&this._featureLayerProvider.populateItemForLayer(o,null,s[n],null);return o&&o.children&&o.children.length()?new a.LegendItemProviderResponse(a.LegendItemProviderResponseCode.Show,o):new a.LegendItemProviderResponse(a.LegendItemProviderResponseCode.Hide,o)},i);function i(e,t,r){this.app=e,this.libraryId=t,this._featureLayerProvider=new n.FeatureLayerLegendProvider(this.app,this.libraryId),this.useThrottledCollections=!!r}t.KMLLayerLegendProvider=r})},"Mapping/modules/Legend/Providers/WMS/WMSLayerLegendProvider":function(){define(["require","exports","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem"],function(e,t,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(n.prototype.supportsOffline=function(){return!1},n.prototype.provide=function(r){if("esri.layers.WMSLayer"!==(null!=r.declaredClass?r.declaredClass:null))return new h.LegendItemProviderResponse(h.LegendItemProviderResponseCode.NotFound,null);for(var t=new m.LegendItem(r,this.useThrottledCollections),e=this.app.site,n="",i=null,o=0;o<e.essentialsMap.mapServices.length;++o){var s=e.essentialsMap.mapServices[o];if(s.serviceLayer===r){i=s;break}}if(!i)return new h.LegendItemProviderResponse(h.LegendItemProviderResponseCode.NotFound,null);n=i.displayName;var a,l,d,p,g=[],c=function(){if(!(a=i.layers[o]).includeInLegend||!a.legendUrl)return"continue";l=a.legendUrl,i.proxyUrl&&(l=i.proxyUrl+"?"+encodeURIComponent(l));var e=String.escapeHtml(l),t=u.app.getResource(u.libraryId,"language-legend-icon-alt-text").format(a.displayName);(d=new m.LegendItem(r,u.useThrottledCollections)).essLayer=a,d.swatchElement.delegateGetter=function(){return"<img src='"+e+"' alt='"+t+"' class='wms-legend-swatch'/>"},(p=new m.LegendItem(r,u.useThrottledCollections)).label.set(a.displayName),p.templateType="group",(d.parent=p).children.addItem(d),g.push(p)},u=this;for(o=0;o<i.layers.length;++o)c();return 0<g.length?(g.forEach(function(e){return e.parent=t}),t.children.addItems(g),t.label.set(n),0<t.children.getLength()&&(t.templateType="group"),new h.LegendItemProviderResponse(h.LegendItemProviderResponseCode.Show,t)):new h.LegendItemProviderResponse(h.LegendItemProviderResponseCode.Hide,t)},n);function n(e,t,r){this.app=e,this.libraryId=t,this.useThrottledCollections=!!r}t.WMSLayerLegendProvider=r})},"Mapping/modules/Legend/Providers/WFS/WFSLayerLegendProvider":function(){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","./../FeatureLayer/FeatureLayerLegendProvider","geocortex/infrastructure/legend/LegendItemProviderResponse","geocortex/infrastructure/legend/LegendItem","geocortex/framework/utils/utils"],function(e,t,r,a,l,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d,n=(d=r.FeatureLayerLegendProvider,o(i,d),i.prototype.supportsOffline=function(){return!1},i.prototype.provide=function(e){if("esri.layers.WFSLayer"!==(null!=e.declaredClass?e.declaredClass:null))return new a.LegendItemProviderResponse(a.LegendItemProviderResponseCode.NotFound,null);for(var t=new l.LegendItem(e,this.useThrottledCollections),r=null,n=0,i=this.app.site.essentialsMap.mapServices;n<i.length;n++){var o=i[n];if(o.serviceLayer===e){r=o;break}}if(r){t.label.set(r.displayName);var s=r.layers[0];s&&s.includeInLegend&&this.populateItemForLayer(t,s,e,null)}return t&&t.children&&t.children.length()?new a.LegendItemProviderResponse(a.LegendItemProviderResponseCode.Show,t):new a.LegendItemProviderResponse(a.LegendItemProviderResponseCode.Hide,t)},i.prototype.populateItemForLayer=function(e,t,r,n){if(d.prototype.populateItemForLayer.call(this,e,t,r,n),!(e&&e.children&&e.children.length())){var i=null;switch(t.featureType){case"Point":i=r._pointSymbol;break;case"Line":i=r._lineSymbol;break;case"Polygon":i=r._polygonSymbol;break;case"None":switch(s.getProp(t,["mapService","serviceLayer","geometryType"])){case"esriGeometryPoint":i=r._pointSymbol;break;case"esriGeometryPolyline":i=r._lineSymbol;break;case"esriGeometryPolygon":i=r._polygonSymbol;break;case"esriGeometryComplex":default:i=(i=s.getProp(t,["mapService","serviceLayer","graphics","0","symbol"]))||r._polygonSymbol}}if(i){var o=this._buildLegendItemFromSymbol(t,r,i);o&&(e.children.addItem(o),e.templateType="group")}}},i.prototype._buildLegendItemFromSymbol=function(e,t,r){var n=new esri.renderer.SimpleRenderer(r);return this._buildLegendItemFromSimpleRenderer(e,t,n)},i);function i(){return null!==d&&d.apply(this,arguments)||this}t.WFSLayerLegendProvider=n})},"url:/Mapping/modules/Legend/LegendView.html":t,"url:/Mapping/modules/Legend/Templates/LegendItem.html":r,"url:/Mapping/modules/Legend/Templates/LegendItemGroup.html":n,"url:/Mapping/modules/Legend/Templates/LegendItemNode.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Legend/CSS/common.css","css","LyogU1RBUlQ6IExlZ2VuZCAtLS0tLS0tLS0tLS0tLS0gKi8NCi5sYXllciAubGVnZW5kLWxpc3Qgew0KICAgIG1hcmdpbi1sZWZ0OiAyZW07DQp9DQoubGVnZW5kIHVsIHsNCiAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5sZWdlbmQgdWwgbGkgdWwgbGkgew0KICAgIG1hcmdpbi1sZWZ0OiAyZW07DQp9DQoNCi5sZWdlbmQtc3dhdGNoIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgbWFyZ2luLXJpZ2h0OiAwLjVlbTsNCiAgICBtaW4td2lkdGg6IDNlbTsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoubGVnZW5kLXN3YXRjaCBpbWcgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1hcmdpbjogMCBhdXRvOw0KICAgIHdpZHRoOiBhdXRvOw0KICAgIGhlaWdodDogYXV0bzsNCn0NCg0KLmxlZ2VuZC1zd2F0Y2ggaW1nLndtcy1sZWdlbmQtc3dhdGNoIHsNCiAgICB3aWR0aDogYXV0bzsNCiAgICBoZWlnaHQ6IGF1dG87DQp9DQoNCi5sZWdlbmQtaXRlbS1wYXJlbnQgLmxlZ2VuZC1pdGVtLWxhYmVsLA0KLmxlZ2VuZC1pdGVtLmxlYWYgew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRUVFRUVFOw0KICAgIHBhZGRpbmc6IDAuMjVlbSAwOw0KfQ0KLmxheWVyIC5sZWdlbmQtaXRlbS1wYXJlbnQgLmxlZ2VuZC1pdGVtLWxhYmVsLA0KLmxheWVyIC5sZWdlbmQtaXRlbS5sZWFmIHsNCiAgICBib3JkZXItYm90dG9tOiBub25lOw0KfQ0KDQoubGVnZW5kLWl0ZW0ubGVhZiwNCi5sZWdlbmQtaXRlbS1wYXJlbnQgLnRyZWUtZXhwYW5kZXIgew0KICAgIG1hcmdpbjogMC4yNWVtIDA7DQp9DQoubGVnZW5kIC5sZWdlbmQtaXRlbS5sZWFmOmxhc3QtY2hpbGQgew0KICAgIG1hcmdpbi1ib3R0b206IDAuMjVlbTsNCiAgICBwYWRkaW5nLWJvdHRvbTogMC4yNWVtOw0KfQ0KLmxheWVyLWxpc3QubGVnZW5kIC50cmVlLWV4cGFuZGVyIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmUgIWltcG9ydGFudDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBib3JkZXI6IDA7DQp9DQoubGVnZW5kLWl0ZW0tcGFyZW50IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoubGVnZW5kLWl0ZW0tbGFiZWwgew0KICAgIHBhZGRpbmc6IDAuMjVlbSAwOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQogICAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoubGVnZW5kLWl0ZW0tcGFyZW50IC5sZWdlbmQtaXRlbS1sYWJlbCB7DQogICAgcGFkZGluZzogMC42NWVtIDAgMC42NWVtIDAuNjVlbTsNCiAgICBmb250LXdlaWdodDogNjAwOw0KfQ0KLmxlZ2VuZC1saXN0IC50ZW1wbC1pdGVtIC5sZWdlbmQtaXRlbS5sZWFmIHsNCiAgICBwYWRkaW5nOiAwLjI1ZW0gMDsNCn0NCi5sZWdlbmQtaXRlbS5sZWFmLmNsZWFyOmFmdGVyLA0KLmxlZ2VuZC1pdGVtLXBhcmVudDphZnRlciB7DQogICAgY29udGVudDogIiI7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgY2xlYXI6IGJvdGg7DQogICAgd2lkdGg6IDA7DQogICAgaGVpZ2h0OiAwOw0KICAgIHZpc2liaWxpdHk6IGhpZGRlbjsNCn0NCi5sZWdlbmQtaXRlbS5sZWFmIC5sZWdlbmQtaXRlbS1sYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lOw0KfQ0KLmxlZ2VuZC1pdGVtLmNoaWxkcmVuIC50ZW1wbC1ncm91cCB7DQogICAgbWFyZ2luLWxlZnQ6IC0xZW07DQp9DQouc2ltcGxlLXN3YXRjaCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBtYXJnaW4tYm90dG9tOiAtMC4zNWVtOw0KfQ0KLmxheWVyLWxpc3QtbGVnZW5kLWljb24gLnNpbXBsZS1zd2F0Y2ggew0KICAgIHRvcDogMC4zNWVtOw0KICAgIG1hcmdpbi1sZWZ0OiAwLjVlbTsNCn0NCi5sZWdlbmQtaXRlbSAubGVnZW5kLXN3YXRjaCAuc2ltcGxlLXN3YXRjaCB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luLWxlZnQ6IGF1dG87DQogICAgbWFyZ2luLXJpZ2h0OiBhdXRvOw0KfQ0KLnNpbXBsZS1zd2F0Y2guc3F1YXJlLA0KLnNxdWFyZSB7DQogICAgd2lkdGg6IDIwcHg7DQogICAgaGVpZ2h0OiAyMHB4Ow0KICAgIGJvcmRlci1zdHlsZTogc29saWQ7DQogICAgYm9yZGVyLXdpZHRoOiAycHg7DQp9DQouc2ltcGxlLXN3YXRjaC5saW5lLA0KLmxpbmUgew0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMHB4Ow0KICAgIHRvcDogLTVweDsNCiAgICBib3JkZXItc3R5bGU6IHNvbGlkOw0KICAgIGJvcmRlci13aWR0aDogMnB4Ow0KfQ0KLmxheWVyLWxpc3QtZm9vdGVyIGJ1dHRvbiB7DQogICAgcGFkZGluZzogLjVlbTsNCiAgICBvdXRsaW5lOiBub25lOw0KICAgIGJhY2tncm91bmQ6ICNGNUY1RjU7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0NDQ0NDQzsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6ICMxQTcyQzQ7DQogICAgYm94LXNoYWRvdzogMXB4IDFweCAxcHggI0ZGRkZGRiBpbnNldDsNCiAgICAtbW96LWJveC1zaGFkb3c6IDFweCAxcHggMXB4ICNGRkZGRkYgaW5zZXQ7DQogICAgLXdlYmtpdC1ib3gtc2hhZG93OiAxcHggMXB4IDFweCAjRkZGRkZGIGluc2V0Ow0KfQ0KLmxlZ2VuZC1pdGVtIHRhYmxlIHsNCiAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50Ow0KfQ0KLyogRU5EOiBMZWdlbmQgLS0tLS0tLS0tLS0tLS0tICov"),e.resourceManager.register("Mapping","inv","Mapping/modules/Legend/LegendView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Legend/Templates/LegendItem.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Legend/Templates/LegendItemGroup.html","html",n),e.resourceManager.register("Mapping","inv","Mapping/modules/Legend/Templates/LegendItemNode.html","html",i)}),require({cache:{}}),define(["Mapping/modules/Legend/LegendModule","Mapping/modules/Legend/LegendView","Mapping/modules/Legend/LegendViewModel","Mapping/modules/Legend/Providers/ArcGISCommonLegendProviderClasses/ArcGISMapServiceLegendProvider","Mapping/modules/Legend/Providers/ArcGISTiledMapService/ArcGISTiledMapServiceLegendProvider","Mapping/modules/Legend/Providers/ArcGISDynamicMapService/ArcGISDynamicMapServiceLegendProvider","Mapping/modules/Legend/Providers/FeatureLayer/FeatureLayerLegendProvider","Mapping/modules/Legend/Providers/ClusterLayer/ClusterLayerLegendProvider","Mapping/modules/Legend/Providers/HeatMaps/HeatMapLayerLegendProvider","Mapping/modules/Legend/Providers/KML/KMLLayerLegendProvider","Mapping/modules/Legend/Providers/WMS/WMSLayerLegendProvider"],function(e,t,r,n,i,o,s,a,l,d,p){g(e,"geocortex.essentialsHtmlViewer.mapping.modules.legend.LegendModule",e.LegendModule),g(t,"geocortex.essentialsHtmlViewer.mapping.modules.legend.LegendView",t.LegendView),g(r,"geocortex.essentialsHtmlViewer.mapping.modules.legend.LegendViewModel",r.LegendViewModel),g(n,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.ArcGISMapServiceLegendProvider",n.ArcGISMapServiceLegendProvider),g(i,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.ArcGISTiledMapServiceLegendProvider",i.ArcGISTiledMapServiceLegendProvider),g(o,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.ArcGISDynamicMapServiceLegendProvider",o.ArcGISDynamicMapServiceLegendProvider),g(s,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.FeatureLayerLegendProvider",s.FeatureLayerLegendProvider),g(a,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.ClusterLayerLegendProvider",a.ClusterLayerLegendProvider),g(l,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.HeatMapLayerLegendProvider",l.HeatMapLayerLegendProvider),g(d,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.KMLLayerLegendProvider",d.KMLLayerLegendProvider),g(p,"geocortex.essentialsHtmlViewer.mapping.modules.legend.providers.WMSLayerLegendProvider",p.WMSLayerLegendProvider)})}();