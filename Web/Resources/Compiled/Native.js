!function(){function e(e,t,a){if("string"==typeof e&&(a=t,t=e),void 0!==a)for(var i=t.split("."),n=null,o=window,r=0,s=i.length;r<s;r++)n=i[r],r==s-1?o[n]=a:o[n]||(o[n]={}),o=o[n];else console.warn("Undefined shim for: "+t)}var t="<div class='attach-photo'>    <div class='panel-content panel-group-contents' data-binding='{@hidden: browserFileAPISupported}'>        <p class='heading'><span data-binding='{@text: @language-native-image-select-heading}'></span></p>        <p><button class='btn' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoCamera}{@text: @language-native-photo-from-camera}'></button></p>        <p><button class='btn' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoGallery}{@text: @language-native-photo-from-gallery}'></button></p>    </div>    <div class='panel-content panel-group-contents' data-binding='{@visible: browserFileAPISupported}'>        <p class='heading'><span data-binding='{@text: @language-native-file-select-heading}'></span></p>        <form data-binding='{@var: uploadFormElement}'>            <input type='file' class='inp' data-binding='{@var: fileInputElement}{aria-label: @language-native-file-select-heading}' />            <div class='form-btns'>                <button type='submit' class='button' data-binding='{@event-onclick: handleSelectedFileInput}{@text: @language-native-attach-file-view-attach-button}'></button>                <button class='button' data-binding='{@event-onclick: handleCancelClicked}{@text: @language-native-attach-file-view-cancel-button}'></button>            </div>        </form>        <p class='loading'><span data-binding='{@visible: isUploading}{@text: @language-native-file-uploading}'></span></p>    </div></div>",a="<div style='padding: 0px 10px 10px 10px;'>    <div style='margin-top: 10px;'>        <label>Name: </label><input type='text' data-binding='{@var: nameInput}' value='Jeff' />    </div>    <div style='margin-top: 10px;'>        <button class='native-test-button' data-binding='{@event-onclick: sayHello_Click}'>Say Hello</button>    </div>    <div style='margin-top: 10px;'>        <label>Iterations: </label><input type='text' data-binding='{@var: iterationsInput}' value='10' />        <label>Duration (ms): </label><input type='text' data-binding='{@var: iterationDurationInput}' value='500' />    </div>    <div style='margin-top: 10px;'>        <button class='native-test-button' data-binding='{@event-onclick: workerJob_Click}'>Start Iterations</button>        <button class='native-test-button' data-binding='{@event-onclick: workerJobCancel_Click}'>Cancel</button>    </div>    <div style='margin-top: 10px;'>        <label>URL: </label><input type='text' data-binding='{@var: downloadInput}' value='http://jsiemens-pc2.latitudegeo.com/tpks/ImageryTPK.tpk' />    </div>    <div style='margin-top: 10px;'>        <button class='native-test-button' data-binding='{@event-onclick: download_Click}'>Download</button>        <button class='native-test-button' data-binding='{@event-onclick: downloadCancel_Click}'>Cancel</button>    </div>    <div style='margin-top: 10px;'>        <textarea data-binding='{@var: output}' rows='8' style='height: 400px;'></textarea>    </div></div>";require({cache:{"Mapping/modules/Native/AttachFileView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/BrowserUtils"],function(t,a,i,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(t){function a(){return null!==t&&t.apply(this,arguments)||this}return e(a,t),a.prototype.handleTakeNativePhotoCamera=function(e,t,a){n.handleTakeNativePhotoCamera(this.viewModel._handleFileFromBrowser.bind(this.viewModel))},a.prototype.handleTakeNativePhotoGallery=function(e,t,a){n.handleTakeNativePhotoGallery(this.viewModel._handleFileFromBrowser.bind(this.viewModel))},a.prototype.handleSelectedFileInput=function(e,t,a){this.fileInputElement.files&&this.fileInputElement.files.length>0&&this.fileInputElement.files[0]&&this.viewModel._handleFileFromBrowser(this.fileInputElement.files[0])},a.prototype.clearFileInputField=function(){this.uploadFormElement.reset()},a.prototype.handleCancelClicked=function(e,t,a){this.clearFileInputField(),this.app.viewManager.deactivateView(this)},a}(i.ViewBase);a.AttachFileView=o})},"Mapping/modules/Native/AttachFileViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/FeatureLayerService","geocortex/infrastructure/BrowserUtils","geocortex/infrastructure/EditingUtils"],function(t,a,i,n,o,r,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var l=function(t){function a(e,a){var i=t.call(this,e,a)||this;return i.feature=new n.Observable(null),i.esriFeature=new n.Observable(null),i.esriFeatureLayer=new n.Observable(null),i.isUploading=new n.Observable(!1),i._attachFileViewId=null,i._canEditOffline=!1,i.browserFileAPISupported=new n.Observable(r.isFileApiSupported()),i.app.command("AttachFileToFeature").register(i,i._executeAttachFile,i._canExecuteAttachFile),i}return e(a,t),a.prototype.initialize=function(e){var a=this;t.prototype.initialize.call(this,e),this._attachFileViewId=e.attachFileViewId,this.app.nativeManager.hasNativeCapability("editing").then(function(e){a._canEditOffline=e})},a.prototype._handleFileFromBrowser=function(e){var t=this;this.isUploading.set(!0);var a=new FileReader;a.onload=function(a){var i={data:decodeURIComponent(a.target.result.substring(a.target.result.indexOf("base64,")+7)),fileName:e.name,fileType:e.type};s.createAttachmentFromFileData(i,t.feature.get(),t.esriFeature.get(),t.esriFeatureLayer.get(),t._reportStatus.bind(t),t._handleCallback.bind(t),t.app)},a.readAsDataURL(e)},a.prototype._handleCallback=function(e){var t={};try{t=JSON.parse(e.currentTarget.response).error}catch(a){e.currentTarget&&e.currentTarget.statusText?t.message=e.currentTarget.statusText:t.message=this.app.getResource(this.libraryId,"language-native-internal-server-error")}t&&t.message?this._reportStatus("language-native-file-upload-failed",t.message):(this._reportStatus("language-native-file-upload-success"),this.app.event("FeatureAttachmentAddedEvent").publish(this.feature.get()))},a.prototype._executeAttachFile=function(e){this._resolveFeature(e),this.app.command("HideFeatureTemplatePicker").execute(),this.esriFeature.get()&&this.esriFeatureLayer.get()?this.app.command("ActivateView").execute(this._attachFileViewId):this._reportStatus("language-native-feature-no-layer")},a.prototype._canExecuteAttachFile=function(e){if(e&&(this._resolveFeature(e,!1),this.esriFeature.get()&&this.esriFeatureLayer.get())){var t=this.esriFeatureLayer.get(),a=this.app.site.essentialsMap.findLayerFromMatchingEsriFeatureLayer(t);if(a&&a.hasAttachments&&a.mapService instanceof o.FeatureLayerService&&a.mapService.canAddAttachments&&a.mapService.canEdit){if(this.app.isOffline.get()){if(!this._canEditOffline)return!1;if(parseFloat(a.mapService.serverVersion)>=10.4)return!0;var i=a.mapService.url;if(!this.app.offlineManager.syncInfo.findLayerOrTable(i).canAddAttachments)return!1}if(this.browserFileAPISupported.get())return!0}}return!1},a.prototype._reportStatus=function(e,t){var a=this;this.isUploading.set(!1);var i=this.app.getResource(this.libraryId,e);i=t?i+t:i,this.app.command("Alert").execute(i,null,function(){var e=a.app.viewManager.getViewById(a._attachFileViewId);e&&e.isActive&&(e.clearFileInputField(),a.app.command("DeactivateView").execute(a._attachFileViewId))})},a.prototype._resolveFeature=function(e,t){void 0===t&&(t=!0);var a=s.resolveFeature(e,this.app,t);this.feature.set(a.feature),this.esriFeature.set(a.esriFeature),this.esriFeatureLayer.set(a.esriFeatureLayer)},a}(i.ViewModelBase);a.AttachFileViewModel=l})},"Mapping/modules/Native/NativeGeolocationClient":function(){define(["require","exports","geocortex/infrastructure/Dictionary","geocortex/infrastructure/CancellationTokenSource"],function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.app=e,this._watchId=-1,this._cancellationTokenLookup=new a.Dictionary}return e.prototype.implementGeolocation=function(){(this.app.nativeManager.isWindowsNative()||this.app.nativeManager.isIosNative())&&(navigator.geolocation.getCurrentPosition=this.getCurrentPosition.bind(this),navigator.geolocation.watchPosition=this.watchPosition.bind(this),navigator.geolocation.clearWatch=this.clearWatch.bind(this))},e.prototype.getCurrentPosition=function(e,t,a){var i;a.timeout>0&&a.timeout<Number.POSITIVE_INFINITY&&(i=setTimeout(function(){t&&t({code:3,message:"timeout",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3})},Math.min(a.timeout,2147483647))),this.app.nativeManager.message("GetCurrentPosition",a).then(function(t){clearTimeout(i),e&&e(t)}).catch(function(e){clearTimeout(i),t&&t(e)})},e.prototype.watchPosition=function(e,t,a){var n=new i.CancellationTokenSource;this._watchId++,this._cancellationTokenLookup.set(this._watchId+"",n);var o;return a.timeout>0&&a.timeout<Number.POSITIVE_INFINITY&&(o=setTimeout(function(){n.cancel(),t&&t({code:3,message:"timeout",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3})},Math.min(a.timeout,2147483647))),this.app.nativeManager.message("WatchPosition",a,n.token(),function(t){clearTimeout(o),e&&e(t.details)}).catch(function(e){clearTimeout(o),t&&t(e)}),this._watchId},e.prototype.clearWatch=function(e){var t=this._cancellationTokenLookup.get(e+"");t&&t.cancel()},e}();t.NativeGeolocationClient=n})},"Mapping/modules/Native/NativeMessageTesterView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/CancellationTokenSource"],function(t,a,i,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(t){function a(e,a){return t.call(this,e,a)||this}return e(a,t),a.prototype.sayHello_Click=function(){var e=this;this.output.textContent="Sending message...\n",this.app.nativeManager.message("MessageTest_Hello",{name:this.nameInput.value}).then(function(t){e.output.textContent+="Promise resolved: "+t.hello+"\n"}).catch(function(t){e.output.textContent+="Error: "+t.message+"\n"})},a.prototype.workerJob_Click=function(){var e=this;this._workerJobCancellation=new n.CancellationTokenSource,this.output.textContent="Sending message...\n",this.app.nativeManager.message("MessageTest_Worker",{iterations:this.iterationsInput.value,durationPerIteration:this.iterationDurationInput.value},this._workerJobCancellation.token(),function(t){e.output.textContent+=t.status+": "+t.details.message+"\n"}).then(function(t){e.output.textContent+="Promise resolved."}).catch(function(t){"OperationCanceled"==t.name?e.output.textContent+="Canceled.\n":e.output.textContent+="Error: "+t.message+"\n"})},a.prototype.workerJobCancel_Click=function(){this._workerJobCancellation&&this._workerJobCancellation.cancel()},a.prototype.download_Click=function(){var e=this;this._downloadCancellation=new n.CancellationTokenSource,this.output.textContent="Sending message...\n",this.app.nativeManager.message("DownloadResource",{url:this.downloadInput.value},this._downloadCancellation.token(),function(t){e.output.textContent+=t.status+": "+t.details.status+". "+t.details.message+". Bytes downloaded: "+t.details.bytesDownloaded+"\n"}).then(function(t){e.output.textContent+="Promise resolved."}).error(function(t){e.output.textContent+="Error: "+t.message+"\n"})},a.prototype.downloadCancel_Click=function(){this._downloadCancellation&&this._downloadCancellation.cancel()},a}(i.ViewBase);a.NativeMessageTesterView=o})},"Mapping/modules/Native/NativeModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/commandArgs/AddStatusArgs","./NativeGeolocationClient"],function(t,a,i,n,o){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.nativeInitialized=!1,e}return e(a,t),a.prototype.initialize=function(e){var t=this;this.app.nativeManager.subscribe("NativeMessageEvent",function(e){var a=t._parseNativeMessage(e);t.handleNativeEvent(a)}),this.app.command("NativeHasCapability").register(this,function(e,a){t.app.nativeManager.hasNativeCapability(e).then(function(e){a.apply(t,[e])})}),this.app.event("NativeMessageEvent").subscribe(this,this._onNativeMessageEvent),dojo.subscribe("SiteSignInRequired",function(e){t.app.nativeManager.isNative()?t.app.nativeManager.message("InformGmafOfSignInRequirement",{errorCode:e.error,url:t.app.site.url}).finally(e.callback):e.callback()}),new o.NativeGeolocationClient(this.app).implementGeolocation(),this.app.nativeManager.isNative()&&dojo.xhrPost({url:"http://127.0.0.1:8181/message/NativeModuleLoaded",method:"POST",postData:"{}"})},a.prototype._parseNativeMessage=function(e){return"NativeMessageEvent"!==e.type?e:e.parameters},a.prototype._onNativeMessageEvent=function(e){var t;if(this.app.trace.debug("Received native event message: "+JSON.stringify(e)),"native ready"===e.type)this.app.localServerAddress=e.parameters.localServerAddress,this.app.localServerNamespace=e.parameters.localServerNamespace,this.app.localServerToken=e.parameters.localServerToken,this.app.trace.info("Native initialization complete.  Geocortex Mobile Application Framework version: {0}  Local Server Address: {1}  Locale: {2}".format(e.parameters.version,e.parameters.localServerAddress,e.parameters.locale)),this.nativeInitialized=!0,this.app.nativeManager.signalNativeInitialized();else if("download"===e.type){var a=e.parameters;(t=new n.AddStatusArgs(null)).timeoutMS=1e4,t.id="native-download-status","Downloading"===a.state?(t.text=this.getResource("language-native-download-downloading").format(a.fileName,a.progress),this.app.command("AddStatus").execute(t)):"Completed"===a.state?(t.text=this.getResource("language-native-download-complete").format(a.fileName),this.app.command("AddStatus").execute(t)):"Failed"===a.state&&(t.text=this.getResource("language-native-download-failed").format(a.fileName),this.app.command("AddStatus").execute(t)),this.app.command("ActivateView").execute(t.id)}else"low memory"===e.type?((t=new n.AddStatusArgs(this.getResource("language-native-low-memory"))).timeoutMS=3e4,t.id="native-low-memory-status",this.app.command("AddStatus").execute(t),this.app.command("ActivateView").execute(t.id)):"license information"===e.type&&this.app.trace.info("ArcGIS License Level: {0}. Expiry: {1}".format(e.parameters.level,e.parameters.expiry))},a.prototype.handleNativeEvent=function(e){this.app.event("NativeMessageEvent").publish(e)},a}(i.ModuleBase);a.NativeIntegrationModule=r})},"url:/Mapping/modules/Native/AttachFileView.html":t,"url:/Mapping/modules/Native/NativeMessageTesterView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Native/CSS/common.css","css","DQoNCi5idG4gew0KICAgIHdpZHRoOiAyMDBweDsNCiAgICBtYXJnaW4tdG9wOiAzMnB4Ow0KfQ0KDQouaW5wIHsNCiAgICB3aWR0aDogMjAwcHg7DQogICAgbWFyZ2luLXRvcDogMzJweDsNCn0NCg0KLmxvYWRpbmcgew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGNvbG9yOiAjRkYwMDAwOw0KfQ0KDQouaGVhZGluZyB7DQogICAgbWFyZ2luLXRvcDogMzJweDsNCiAgICBmb250LXNpemU6IDEuMWVtOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQoNCi5uYXRpdmUtdGVzdC1idXR0b24gew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRjUyNTI7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIHBhZGRpbmc6IDVweDsNCiAgICBmb250LXNpemU6IDEycHQ7DQogICAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICAgIG1hcmdpbi1yaWdodDogNXB4Ow0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Native/AttachFileView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Native/NativeMessageTesterView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Native/AttachFileView","Mapping/modules/Native/AttachFileViewModel","Mapping/modules/Native/NativeMessageTesterView","Mapping/modules/Native/NativeModule"],function(t,a,i,n){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.AttachFileView",t.AttachFileView),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.AttachFileViewModel",a.AttachFileViewModel),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.NativeMessageTesterView",i.NativeMessageTesterView),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.NativeIntegrationModule",n.NativeIntegrationModule)})}();