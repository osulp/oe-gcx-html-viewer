!function(){var t="<div class='attach-photo'>    <div class='panel-content panel-group-contents' data-binding='{@hidden: browserFileAPISupported}'>        <p class='heading'><span data-binding='{@text: @language-native-image-select-heading}'></span></p>        <p><button class='btn' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoCamera}{@text: @language-native-photo-from-camera}'></button></p>        <p><button class='btn' href='javascript:void(0)' data-binding='{@event-onclick: handleTakeNativePhotoGallery}{@text: @language-native-photo-from-gallery}'></button></p>    </div>    <div class='panel-content panel-group-contents' data-binding='{@visible: browserFileAPISupported}'>        <p class='heading'><span data-binding='{@text: @language-native-file-select-heading}'></span></p>        <form data-binding='{@var: uploadFormElement}'>            <input type='file' class='inp' data-binding='{@var: fileInputElement}{aria-label: @language-native-file-select-heading}' />            <div class='form-btns'>                <button type='submit' class='button' data-binding='{@event-onclick: handleSelectedFileInput}{@text: @language-native-attach-file-view-attach-button}'></button>                <button class='button' data-binding='{@event-onclick: handleCancelClicked}{@text: @language-native-attach-file-view-cancel-button}'></button>            </div>        </form>        <p class='loading'><span data-binding='{@visible: isUploading}{@text: @language-native-file-uploading}'></span></p>    </div></div>",a="<div style='padding: 0px 10px 10px 10px;'>    <div style='margin-top: 10px;'>        <label>Name: </label><input type='text' data-binding='{@var: nameInput}' value='Jeff' />    </div>    <div style='margin-top: 10px;'>        <button class='native-test-button' data-binding='{@event-onclick: sayHello_Click}'>Say Hello</button>    </div>    <div style='margin-top: 10px;'>        <label>Iterations: </label><input type='text' data-binding='{@var: iterationsInput}' value='10' />        <label>Duration (ms): </label><input type='text' data-binding='{@var: iterationDurationInput}' value='500' />    </div>    <div style='margin-top: 10px;'>        <button class='native-test-button' data-binding='{@event-onclick: workerJob_Click}'>Start Iterations</button>        <button class='native-test-button' data-binding='{@event-onclick: workerJobCancel_Click}'>Cancel</button>    </div>    <div style='margin-top: 10px;'>        <label>URL: </label><input type='text' data-binding='{@var: downloadInput}' value='http://jsiemens-pc2.latitudegeo.com/tpks/ImageryTPK.tpk' />    </div>    <div style='margin-top: 10px;'>        <button class='native-test-button' data-binding='{@event-onclick: download_Click}'>Download</button>        <button class='native-test-button' data-binding='{@event-onclick: downloadCancel_Click}'>Cancel</button>    </div>    <div style='margin-top: 10px;'>        <textarea data-binding='{@var: output}' rows='8' style='height: 400px;'></textarea>    </div></div>";function n(e,t,a){if("string"==typeof e&&(a=t,t=e),void 0!==a)for(var i=t.split("."),n=null,o=window,r=0,s=i.length;r<s;r++)n=i[r],r==s-1?o[n]=a:o[n]||(o[n]={}),o=o[n];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Native/AttachFileView":function(){var i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/BrowserUtils"],function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=(n=a.ViewBase,s(r,n),r.prototype.handleTakeNativePhotoCamera=function(e,t,a){i.handleTakeNativePhotoCamera(this.viewModel._handleFileFromBrowser.bind(this.viewModel))},r.prototype.handleTakeNativePhotoGallery=function(e,t,a){i.handleTakeNativePhotoGallery(this.viewModel._handleFileFromBrowser.bind(this.viewModel))},r.prototype.handleSelectedFileInput=function(e,t,a){this.fileInputElement.files&&0<this.fileInputElement.files.length&&this.fileInputElement.files[0]&&this.viewModel._handleFileFromBrowser(this.fileInputElement.files[0])},r.prototype.clearFileInputField=function(){this.uploadFormElement.reset()},r.prototype.handleCancelClicked=function(e,t,a){this.clearFileInputField(),this.app.viewManager.deactivateView(this)},r);function r(){return null!==n&&n.apply(this,arguments)||this}t.AttachFileView=o})},"Mapping/modules/Native/AttachFileViewModel":function(){var i,u=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/FeatureLayerService","geocortex/infrastructure/BrowserUtils","geocortex/infrastructure/EditingUtils"],function(e,t,a,i,n,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,l=(s=a.ViewModelBase,u(c,s),c.prototype.initialize=function(e){var t=this;s.prototype.initialize.call(this,e),this._attachFileViewId=e.attachFileViewId,this.app.nativeManager.hasNativeCapability("editing").then(function(e){t._canEditOffline=e})},c.prototype._handleFileFromBrowser=function(a){var i=this;this.isUploading.set(!0);var e=new FileReader;e.onload=function(e){var t={data:decodeURIComponent(e.target.result.substring(e.target.result.indexOf("base64,")+7)),fileName:a.name,fileType:a.type};r.createAttachmentFromFileData(t,i.feature.get(),i.esriFeature.get(),i.esriFeatureLayer.get(),i._reportStatus.bind(i),i._handleCallback.bind(i),i.app)},e.readAsDataURL(a)},c.prototype._handleCallback=function(t){var a={};try{a=JSON.parse(t.currentTarget.response).error}catch(e){t.currentTarget&&t.currentTarget.statusText?a.message=t.currentTarget.statusText:a.message=this.app.getResource(this.libraryId,"language-native-internal-server-error")}a&&a.message?this._reportStatus("language-native-file-upload-failed",a.message):(this._reportStatus("language-native-file-upload-success"),this.app.event("FeatureAttachmentAddedEvent").publish(this.feature.get()))},c.prototype._executeAttachFile=function(e){this._resolveFeature(e),this.app.command("HideFeatureTemplatePicker").execute(),this.esriFeature.get()&&this.esriFeatureLayer.get()?this.app.command("ActivateView").execute(this._attachFileViewId):this._reportStatus("language-native-feature-no-layer")},c.prototype._canExecuteAttachFile=function(e){if(e&&(this._resolveFeature(e,!1),this.esriFeature.get()&&this.esriFeatureLayer.get())){var t=this.esriFeatureLayer.get(),a=this.app.site.essentialsMap.findLayerFromMatchingEsriFeatureLayer(t);if(a&&a.hasAttachments&&a.mapService instanceof n.FeatureLayerService&&a.mapService.canAddAttachments&&a.mapService.canEdit){if(this.app.isOffline.get()){if(!this._canEditOffline)return!1;if(10.4<=parseFloat(a.mapService.serverVersion))return!0;var i=a.mapService.url;if(!this.app.offlineManager.syncInfo.findLayerOrTable(i).canAddAttachments)return!1}if(this.browserFileAPISupported.get())return!0}}return!1},c.prototype._reportStatus=function(e,t){var a=this;this.isUploading.set(!1);var i=this.app.getResource(this.libraryId,e);i=t?i+t:i,this.app.command("Alert").execute(i,null,function(){var e=a.app.viewManager.getViewById(a._attachFileViewId);e&&e.isActive&&(e.clearFileInputField(),a.app.command("DeactivateView").execute(a._attachFileViewId))})},c.prototype._resolveFeature=function(e,t){void 0===t&&(t=!0);var a=r.resolveFeature(e,this.app,t);this.feature.set(a.feature),this.esriFeature.set(a.esriFeature),this.esriFeatureLayer.set(a.esriFeatureLayer)},c);function c(e,t){var a=s.call(this,e,t)||this;return a.feature=new i.Observable(null),a.esriFeature=new i.Observable(null),a.esriFeatureLayer=new i.Observable(null),a.isUploading=new i.Observable(!1),a._attachFileViewId=null,a._canEditOffline=!1,a.browserFileAPISupported=new i.Observable(o.isFileApiSupported()),a.app.command("AttachFileToFeature").register(a,a._executeAttachFile,a._canExecuteAttachFile),a}t.AttachFileViewModel=l})},"Mapping/modules/Native/NativeGeolocationClient":function(){define(["require","exports","geocortex/infrastructure/Dictionary","geocortex/infrastructure/CancellationTokenSource"],function(e,t,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.implementGeolocation=function(){(this.app.nativeManager.isWindowsNative()||this.app.nativeManager.isIosNative())&&(navigator.geolocation.getCurrentPosition=this.getCurrentPosition.bind(this),navigator.geolocation.watchPosition=this.watchPosition.bind(this),navigator.geolocation.clearWatch=this.clearWatch.bind(this))},n.prototype.getCurrentPosition=function(t,a,e){var i;0<e.timeout&&e.timeout<Number.POSITIVE_INFINITY&&(i=setTimeout(function(){a&&a({code:3,message:"timeout",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3})},Math.min(e.timeout,2147483647))),this.app.nativeManager.message("GetCurrentPosition",e).then(function(e){clearTimeout(i),t&&t(e)}).catch(function(e){clearTimeout(i),a&&a(e)})},n.prototype.watchPosition=function(t,a,e){var i,n=new o.CancellationTokenSource;return this._watchId++,this._cancellationTokenLookup.set(this._watchId+"",n),0<e.timeout&&e.timeout<Number.POSITIVE_INFINITY&&(i=setTimeout(function(){n.cancel(),a&&a({code:3,message:"timeout",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3})},Math.min(e.timeout,2147483647))),this.app.nativeManager.message("WatchPosition",e,n.token(),function(e){clearTimeout(i),t&&t(e.details)}).catch(function(e){clearTimeout(i),a&&a(e)}),this._watchId},n.prototype.clearWatch=function(e){var t=this._cancellationTokenLookup.get(e+"");t&&t.cancel()},n);function n(e){this.app=e,this._watchId=-1,this._cancellationTokenLookup=new a.Dictionary}t.NativeGeolocationClient=i})},"Mapping/modules/Native/NativeMessageTesterView":function(){var i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/CancellationTokenSource"],function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=(n=a.ViewBase,s(r,n),r.prototype.sayHello_Click=function(){var t=this;this.output.textContent="Sending message...\n",this.app.nativeManager.message("MessageTest_Hello",{name:this.nameInput.value}).then(function(e){t.output.textContent+="Promise resolved: "+e.hello+"\n"}).catch(function(e){t.output.textContent+="Error: "+e.message+"\n"})},r.prototype.workerJob_Click=function(){var t=this;this._workerJobCancellation=new i.CancellationTokenSource,this.output.textContent="Sending message...\n",this.app.nativeManager.message("MessageTest_Worker",{iterations:this.iterationsInput.value,durationPerIteration:this.iterationDurationInput.value},this._workerJobCancellation.token(),function(e){t.output.textContent+=e.status+": "+e.details.message+"\n"}).then(function(e){t.output.textContent+="Promise resolved."}).catch(function(e){"OperationCanceled"===e.name?t.output.textContent+="Canceled.\n":t.output.textContent+="Error: "+e.message+"\n"})},r.prototype.workerJobCancel_Click=function(){this._workerJobCancellation&&this._workerJobCancellation.cancel()},r.prototype.download_Click=function(){var t=this;this._downloadCancellation=new i.CancellationTokenSource,this.output.textContent="Sending message...\n",this.app.nativeManager.message("DownloadResource",{url:this.downloadInput.value},this._downloadCancellation.token(),function(e){t.output.textContent+=e.status+": "+e.details.status+". "+e.details.message+". Bytes downloaded: "+e.details.bytesDownloaded+"\n"}).then(function(e){t.output.textContent+="Promise resolved."}).error(function(e){t.output.textContent+="Error: "+e.message+"\n"})},r.prototype.downloadCancel_Click=function(){this._downloadCancellation&&this._downloadCancellation.cancel()},r);function r(e,t){return n.call(this,e,t)||this}t.NativeMessageTesterView=o})},"Mapping/modules/Native/NativeModule":function(){var i,l=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/commandArgs/AddStatusArgs","./NativeGeolocationClient"],function(e,t,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=(o=a.ModuleBase,l(s,o),s.prototype.initialize=function(e){var a=this;this.app.nativeManager.subscribe("NativeMessageEvent",function(e){var t=a._parseNativeMessage(e);a.handleNativeEvent(t)}),this.app.command("NativeHasCapability").register(this,function(e,t){a.app.nativeManager.hasNativeCapability(e).then(function(e){t.apply(a,[e])})}),this.app.event("NativeMessageEvent").subscribe(this,this._onNativeMessageEvent),dojo.subscribe("SiteSignInRequired",function(e){a.app.nativeManager.isNative()?a.app.nativeManager.message("InformGmafOfSignInRequirement",{errorCode:e.error,url:a.app.site.url}).finally(e.callback):e.callback()}),new n.NativeGeolocationClient(this.app).implementGeolocation(),this.app.nativeManager.isNative()&&dojo.xhrPost({url:"http://127.0.0.1:8181/message/NativeModuleLoaded",method:"POST",postData:"{}"})},s.prototype._parseNativeMessage=function(e){return"NativeMessageEvent"!==e.type?e:e.parameters},s.prototype._onNativeMessageEvent=function(e){var t;if(this.app.trace.debug("Received native event message: "+JSON.stringify(e)),"native ready"===e.type)this.app.localServerAddress=e.parameters.localServerAddress,this.app.localServerNamespace=e.parameters.localServerNamespace,this.app.localServerToken=e.parameters.localServerToken,this.app.trace.info("Native initialization complete.  Geocortex Mobile Application Framework version: {0}  Local Server Address: {1}  Locale: {2}".format(e.parameters.version,e.parameters.localServerAddress,e.parameters.locale)),this.nativeInitialized=!0,this.app.nativeManager.signalNativeInitialized();else if("download"===e.type){var a=e.parameters;(t=new i.AddStatusArgs(null)).timeoutMS=1e4,t.id="native-download-status","Downloading"===a.state?(t.text=this.getResource("language-native-download-downloading").format(a.fileName,a.progress),this.app.command("AddStatus").execute(t)):"Completed"===a.state?(t.text=this.getResource("language-native-download-complete").format(a.fileName),this.app.command("AddStatus").execute(t)):"Failed"===a.state&&(t.text=this.getResource("language-native-download-failed").format(a.fileName),this.app.command("AddStatus").execute(t)),this.app.command("ActivateView").execute(t.id)}else"low memory"===e.type?((t=new i.AddStatusArgs(this.getResource("language-native-low-memory"))).timeoutMS=3e4,t.id="native-low-memory-status",this.app.command("AddStatus").execute(t),this.app.command("ActivateView").execute(t.id)):"license information"===e.type&&this.app.trace.info("ArcGIS License Level: {0}. Expiry: {1}".format(e.parameters.level,e.parameters.expiry))},s.prototype.handleNativeEvent=function(e){this.app.event("NativeMessageEvent").publish(e)},s);function s(){var e=null!==o&&o.apply(this,arguments)||this;return e.nativeInitialized=!1,e}t.NativeIntegrationModule=r})},"url:/Mapping/modules/Native/AttachFileView.html":t,"url:/Mapping/modules/Native/NativeMessageTesterView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Native/CSS/common.css","css","DQoNCi5idG4gew0KICAgIHdpZHRoOiAyMDBweDsNCiAgICBtYXJnaW4tdG9wOiAzMnB4Ow0KfQ0KDQouaW5wIHsNCiAgICB3aWR0aDogMjAwcHg7DQogICAgbWFyZ2luLXRvcDogMzJweDsNCn0NCg0KLmxvYWRpbmcgew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGNvbG9yOiAjRkYwMDAwOw0KfQ0KDQouaGVhZGluZyB7DQogICAgbWFyZ2luLXRvcDogMzJweDsNCiAgICBmb250LXNpemU6IDEuMWVtOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQoNCi5uYXRpdmUtdGVzdC1idXR0b24gew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRjUyNTI7DQogICAgY29sb3I6IHdoaXRlOw0KICAgIHBhZGRpbmc6IDVweDsNCiAgICBmb250LXNpemU6IDEycHQ7DQogICAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICAgIG1hcmdpbi1yaWdodDogNXB4Ow0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Native/AttachFileView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Native/NativeMessageTesterView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Native/AttachFileView","Mapping/modules/Native/AttachFileViewModel","Mapping/modules/Native/NativeMessageTesterView","Mapping/modules/Native/NativeModule"],function(e,t,a,i){n(e,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.AttachFileView",e.AttachFileView),n(t,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.AttachFileViewModel",t.AttachFileViewModel),n(a,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.NativeMessageTesterView",a.NativeMessageTesterView),n(i,"geocortex.essentialsHtmlViewer.mapping.modules.nativeIntegration.NativeIntegrationModule",i.NativeIntegrationModule)})}();