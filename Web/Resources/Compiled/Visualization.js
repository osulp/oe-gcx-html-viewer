!function(){function i(i,e,t){if("string"==typeof i&&(t=e,e=i),void 0!==t)for(var o=e.split("."),a=null,n=window,r=0,s=o.length;r<s;r++)a=o[r],r==s-1?n[a]=t:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+e)}var e="<div class='region panel-status-region visualization-status' data-region-name='VisualizationStatusRegion' data-region-adapter='geocortex.framework.ui.DivRegionAdapter' ></div><div class='visualization panel-group-contents'>    <div class='visualization-selector form-item'>        <label for='visualization' data-binding='{@text: @language-visualization-select}'></label>        <select id='visualization' data-binding='{@source: visualizationInfos}{@value: selectedVisualization}'>            <option data-binding='{@template-for: visualizationInfos}{@source: @context}{@text: name}{@attached: @context}'></option>        </select>    </div>    \x3c!-- BEGIN: Content region --\x3e    <div class='visualization-options' data-binding='{data-region-name: regionName}{data-region-adapter: regionType}{@var: scrollRegionElement}{@event-onscroll: handleScrollChange}{@visible: hasOptionsView}'></div>    \x3c!-- END: Content region --\x3e    <div class='form-btns'>        <button class='button' data-binding='{@event-click: handleApplyButtonClick}{@text: @language-common-apply}{@visible: hasOptionsView}'></button>        <button class='button' data-binding='{@event-click: handleDoneButtonClick}{@text: @language-common-done}'></button>    </div></div>";require({cache:{"Mapping/modules/Visualization/SimpleVisualizationProvider":function(){var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(i,t){var o=e.call(this,i,t)||this;o.displayName=o.app.getResource(t,"language-visualization-none");var a={provider:o,name:name,id:name};return o.enabledVisualization=a,o.visualizations.push(a),o}return i(t,e),t.prototype.initialize=function(i){e.prototype.initialize.call(this,i),this.isEnabled.set(!0),this.isSupported.set(!0)},t.prototype.canSupport=function(i){return!0},t.prototype.handleCurrentLayerChanged=function(i){},t.prototype.handleActivate=function(){this.app.command("RemoveVisualization").execute({gcxLayer:this.currentLayer.get()})},t.prototype.handleApply=function(){this.app.command("RemoveVisualization").execute({gcxLayer:this.currentLayer.get()})},t}(o.VisualizationProviderBase);t.SimpleVisualizationProvider=a})},"Mapping/modules/Visualization/VisualizationModule":function(){var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initialize=function(i){e.prototype.initialize.call(this,i),this._registerCommandsAndEvents()},t.prototype._registerCommandsAndEvents=function(){this.app.command("RemoveVisualization").register(this,this._executeRemoveVisualization,this._canExecuteRemoveVisualization)},t.prototype._executeRemoveVisualization=function(i){var e=this._getGeocortexLayer(i);this.app.command("RemoveHeatMap").execute({gcxLayer:e}),this.app.command("RemoveClusterLayer").execute({gcxLayer:e}),this.app.command("RemoveSymbolization").execute({gcxLayer:e})},t.prototype._canExecuteRemoveVisualization=function(i){var e=this._getGeocortexLayer(i);return e&&!!e.mapService},t.prototype._getGeocortexLayer=function(i){if("string"==typeof i){if(!this.app.site||!this.app.site.essentialsMap)return null;return this.app.site.essentialsMap.allLayers().filter(function(e){return i===e.mapService.id})[0]}return i.gcxLayer},t}(o.ModuleBase);t.VisualizationModule=a})},"Mapping/modules/Visualization/VisualizationView":function(){var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView"],function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(i,t){var o=e.call(this,i,t)||this;return o._registerCommandsAndEvents(),o}return i(t,e),t.prototype._registerCommandsAndEvents=function(){this.app.command("ShowVisualizationView").register(this,this._executeShowVisualizationView,this._canExecuteShowVisualizationView)},t.prototype._executeShowVisualizationView=function(i){var e=this._getGeocortexLayer(i);this.viewModel.selectedLayer.set(e),this.app.command("ActivateView").execute(this.id),this.app.event("VisualizationViewActivatedEvent").publish(e)},t.prototype._canExecuteShowVisualizationView=function(i){var e=this,t=this._getGeocortexLayer(i);return t?this.viewModel&&this.viewModel.supportsVisualization(t):(this.app.site&&this.app.site.serviceLayersLoaded||this.app.event("SiteServiceLayersLoadedEvent").once(this,function(i){e.app.command("ShowVisualizationView").raiseCanExecuteChanged()}),!1)},t.prototype.handleApplyButtonClick=function(i,e,t){this.viewModel.updateVisualization()},t.prototype.handleDoneButtonClick=function(i,e,t){this.viewModel.updateVisualization(),this.app.command("DeactivateView").execute(this.id)},t.prototype._getGeocortexLayer=function(i){if("string"==typeof i){if(!this.app.site||!this.app.site.essentialsMap)return null;return this.app.site.essentialsMap.allLayers().filter(function(e){return i===e.mapService.id})[0]}return i},t}(o.SmartPanelView);t.VisualizationView=a})},"Mapping/modules/Visualization/VisualizationViewModel":function(){var i=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel","geocortex/framework/observables","./SimpleVisualizationProvider"],function(e,t,o,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i._activeProvider=null,i._providers=[],i._simpleViewProvider=null,i._simpleVisualizationInfo=null,i.selectedLayer=new a.Observable(null),i.supportedProviders=new a.ObservableCollection([]),i.visualizationInfos=new a.ObservableCollection([]),i.selectedVisualization=new a.Observable(null),i.hasOptionsView=new a.Observable(!1),i}return i(t,e),t.prototype.initialize=function(i){e.prototype.initialize.call(this,i),this._simpleViewProvider=new n.SimpleVisualizationProvider(this.app,this.libraryId),this._simpleViewProvider.initialize({type:"geocortex.essentialsHtmlViewer.mapping.modules.visualization.SimpleVisualizationProvider",displayName:i.defaultDisplayName}),this._simpleVisualizationInfo={provider:this._simpleViewProvider,name:this._simpleViewProvider.displayName,id:this._simpleViewProvider.displayName},i.visualizationProviders&&this._loadProviders(i.visualizationProviders),this.selectedLayer.bind(this,this._handleLayerChange),this.selectedVisualization.bind(this,this._handleVisualizationChanged)},t.prototype.supportsVisualization=function(i){for(var e=0;e<this._providers.length;e++){var t=this._providers[e];if(this._isVisualization(t)&&t.canSupport(i))return!0}return!1},t.prototype.updateVisualization=function(){this._activeProvider&&this._activeProvider.handleApply()},t.prototype._isVisualization=function(i){return!(i instanceof n.SimpleVisualizationProvider)},t.prototype._handleLayerChange=function(i){var e;this._simpleViewProvider.currentLayer.set(i),this.supportedProviders.clear();for(var t=0;t<this._providers.length;t++){var o=this._providers[t];o.currentLayer.set(i),o.isSupported.get()&&this.supportedProviders.addItem(o)}this.visualizationInfos.clear(),this.visualizationInfos.addItem(this._simpleVisualizationInfo),e=this._simpleVisualizationInfo;for(t=this.supportedProviders.getLength()-1;t>=0;t--){var a=this.supportedProviders.getAt(t);a.isEnabled.get()&&a.enabledVisualization&&(e=a.enabledVisualization);for(var n=a.visualizations.length-1;n>=0;n--){var r=a.visualizations[n];this.visualizationInfos.addItem(r)}}this.selectedVisualization.set(this.visualizationInfos.getItems().filter(function(i){return i.id===e.id&&i.provider===e.provider})[0])},t.prototype._handleVisualizationChanged=function(i){for(var e=0,t=this.supportedProviders.getItems();e<t.length;e++){t[e].enabledVisualization=null}if(this._activeProvider=i.provider,this._activeProvider.handleActivate(i),this.hasOptionsView.set(!1),this._activeProvider.isSupported.get()){if(i.provider.viewId){var o=this.app.viewManager.getViewById(i.provider.viewId);o&&(this.hasOptionsView.set(!0),this.app.viewManager.activateView(o))}}else this._activeProvider=this._simpleViewProvider},t.prototype._loadProviders=function(i){for(var e=this,t=0;t<i.length;t++){var o=i[t];o.libraryId&&!this.app.allLibrariesLoaded?this.app.event("ViewerLibrariesDownloadedEvent").once(this,function(){e._loadProvider(o)}):this._loadProvider(o)}},t.prototype._loadProvider=function(i){var e;if(e=dojo.getObject(i.type)){var t=new e(this.app,i.libraryId||this.libraryId);return t.initialize(i),this._providers.push(t),t}this.app.trace.error("{0} can't find visualization provider typed {1}".format(this.id,i.type))},t}(o.SmartPanelViewModel);t.VisualizationViewModel=r})},"Mapping/modules/Visualization/VisualizationViewModelConfig":function(){define(["require","exports"],function(i,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})})},"url:/Mapping/modules/Visualization/VisualizationView.html":e}}),require(["geocortex/framework/resourceManager"],function(i){i.resourceManager.register("Mapping","inv","Mapping/modules/Visualization/CSS/common.css","css","LnZpc3VhbGl6YXRpb24gLnZpc3VhbGl6YXRpb24tdGl0bGUgew0KICAgIGNvbG9yOiAjOTU5Mzk4Ow0KICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgZm9udC1zaXplOiAxLjI1ZW07DQp9DQoNCi52aXN1YWxpemF0aW9uLXN0YXR1cyAuc3RhdHVzLW1zZyB7DQogICAgd2hpdGUtc3BhY2U6IG5vcm1hbDsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCg=="),i.resourceManager.register("Mapping","inv","Mapping/modules/Visualization/VisualizationView.html","html",e)}),require({cache:{}}),define(["Mapping/modules/Visualization/SimpleVisualizationProvider","Mapping/modules/Visualization/VisualizationModule","Mapping/modules/Visualization/VisualizationView","Mapping/modules/Visualization/VisualizationViewModel"],function(e,t,o,a){i(e,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.SimpleVisualizationProvider",e.SimpleVisualizationProvider),i(t,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.VisualizationModule",t.VisualizationModule),i(o,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.VisualizationView",o.VisualizationView),i(a,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.VisualizationViewModel",a.VisualizationViewModel)})}();