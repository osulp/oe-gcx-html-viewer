!function(){var i="<div class='region panel-status-region visualization-status' data-region-name='VisualizationStatusRegion' data-region-adapter='geocortex.framework.ui.DivRegionAdapter' ></div><div class='visualization panel-group-contents'>    <div class='visualization-selector form-item'>        <label for='visualization' data-binding='{@text: @language-visualization-select}'></label>        <select id='visualization' data-binding='{@source: visualizationInfos}{@value: selectedVisualization}'>            <option data-binding='{@template-for: visualizationInfos}{@source: @context}{@text: name}{@attached: @context}'></option>        </select>    </div>    \x3c!-- BEGIN: Content region --\x3e    <div class='visualization-options' data-binding='{data-region-name: regionName}{data-region-adapter: regionType}{@var: scrollRegionElement}{@event-onscroll: handleScrollChange}{@visible: hasOptionsView}'></div>    \x3c!-- END: Content region --\x3e    <div class='form-btns'>        <button class='button' data-binding='{@event-click: handleResetButtonClick}{@text: @language-common-reset}{@visible: canReset}'></button>        <button class='button' data-binding='{@event-click: handleApplyButtonClick}{@text: @language-common-apply}{@visible: hasOptionsView}'></button>        <button class='button' data-binding='{@event-click: handleDoneButtonClick}{@text: @language-common-done}'></button>    </div></div>";function a(e,i,t){if("string"==typeof e&&(t=i,i=e),void 0!==t)for(var o=i.split("."),a=null,n=window,r=0,s=o.length;r<s;r++)a=o[r],r==s-1?n[a]=t:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+i)}require({cache:{"Mapping/modules/Visualization/SimpleVisualizationProvider":function(){var o,r=this&&this.__extends||(o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a,o=(a=t.VisualizationProviderBase,r(n,a),n.prototype.initialize=function(e){a.prototype.initialize.call(this,e),this.isEnabled.set(!0),this.isSupported.set(!0)},n.prototype.canSupport=function(e){return!0},n.prototype.handleCurrentLayerChanged=function(e){},n.prototype.handleActivate=function(){this.app.command("RemoveVisualization").execute({gcxLayer:this.currentLayer.get()})},n.prototype.handleApply=function(){this.app.command("RemoveVisualization").execute({gcxLayer:this.currentLayer.get()})},n.prototype.handleReset=function(){this.app.command("RemoveVisualization").execute({gcxLayer:this.currentLayer.get()})},n);function n(e,i){var t=a.call(this,e,i)||this;t.displayName=t.app.getResource(i,"language-visualization-none");var o={provider:t,name:name,id:name};return t.enabledVisualization=o,t.visualizations.push(o),t}i.SimpleVisualizationProvider=o})},"Mapping/modules/Visualization/VisualizationModule":function(){var o,r=this&&this.__extends||(o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o,a=(o=t.ModuleBase,r(n,o),n.prototype.initialize=function(e){o.prototype.initialize.call(this,e),this._registerCommandsAndEvents()},n.prototype._registerCommandsAndEvents=function(){this.app.command("RemoveVisualization").register(this,this._executeRemoveVisualization,this._canExecuteRemoveVisualization)},n.prototype._executeRemoveVisualization=function(e){var i=this._getGeocortexLayer(e);this.app.command("RemoveHeatMap").execute({gcxLayer:i}),this.app.command("RemoveClusterLayer").execute({gcxLayer:i}),this.app.command("RemoveSymbolization").execute({gcxLayer:i})},n.prototype._canExecuteRemoveVisualization=function(e){var i=this._getGeocortexLayer(e);return i&&!!i.mapService},n.prototype._getGeocortexLayer=function(i){return"string"!=typeof i?i.gcxLayer:this.app.site&&this.app.site.essentialsMap?this.app.site.essentialsMap.allLayers().filter(function(e){return i===e.mapService.id})[0]:null},n);function n(){return null!==o&&o.apply(this,arguments)||this}i.VisualizationModule=a})},"Mapping/modules/Visualization/VisualizationView":function(){var o,s=this&&this.__extends||(o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView","geocortex/infrastructure/LayerIntegrationUtils"],function(e,i,t,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a,n=(a=t.SmartPanelView,s(r,a),r.prototype._registerCommandsAndEvents=function(){this.app.command("ShowVisualizationView").register(this,this._executeShowVisualizationView,this._canExecuteShowVisualizationView)},r.prototype._executeShowVisualizationView=function(e){var i=o.getGeocortexLayer(e,this.app);this.viewModel.selectedLayer.set(i),this.app.command("ActivateView").execute(this.id),this.app.event("VisualizationViewActivatedEvent").publish(i)},r.prototype._canExecuteShowVisualizationView=function(e){var i=this,t=o.getGeocortexLayer(e,this.app);return t?this.viewModel&&this.viewModel.supportsVisualization(t):(this.app.site&&this.app.site.serviceLayersLoaded||this.app.event("SiteServiceLayersLoadedEvent").once(this,function(e){i.app.command("ShowVisualizationView").raiseCanExecuteChanged()}),!1)},r.prototype.handleResetButtonClick=function(){this.viewModel.resetVisualization()},r.prototype.handleApplyButtonClick=function(e,i,t){this.viewModel.updateVisualization()},r.prototype.handleDoneButtonClick=function(e,i,t){this.viewModel.updateVisualization(),this.app.command("DeactivateView").execute(this.id)},r);function r(e,i){var t=a.call(this,e,i)||this;return t._registerCommandsAndEvents(),t}i.VisualizationView=n})},"Mapping/modules/Visualization/VisualizationViewModel":function(){var o,l=this&&this.__extends||(o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)},function(e,i){function t(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)});define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel","geocortex/framework/observables","./SimpleVisualizationProvider","geocortex/essentials/LayerStyle","geocortex/framework/utils/utils","geocortex/framework/utils/ArrayUtils"],function(e,i,t,o,a,u,p,c){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=(n=t.SmartPanelViewModel,l(s,n),s.prototype.initialize=function(e){n.prototype.initialize.call(this,e),this._simpleViewProvider=new a.SimpleVisualizationProvider(this.app,this.libraryId),this._simpleViewProvider.initialize({type:"geocortex.essentialsHtmlViewer.mapping.modules.visualization.SimpleVisualizationProvider",displayName:e.defaultDisplayName}),this._simpleVisualizationInfo={provider:this._simpleViewProvider,name:this._simpleViewProvider.displayName,id:this._simpleViewProvider.displayName},e.visualizationProviders&&this._loadProviders(e.visualizationProviders),this.selectedLayer.bind(this,this._handleLayerChange),this.selectedVisualization.bind(this,this._handleVisualizationChanged)},s.prototype.supportsVisualization=function(e){for(var i=0,t=this._providers;i<t.length;i++){var o=t[i];if(this._isVisualization(o)&&o.canSupport(e))return!0}return!1},s.prototype.resetVisualization=function(){this._activeProvider&&this._activeProvider.handleReset()},s.prototype.updateVisualization=function(){this._activeProvider&&this._activeProvider.handleApply()},s.prototype._isVisualization=function(e){return!(e instanceof a.SimpleVisualizationProvider)},s.prototype._handleLayerChange=function(e){var i;this._simpleViewProvider.currentLayer.set(e),this.supportedProviders.clear();for(var t=0,o=this._providers;t<o.length;t++)(n=o[t]).currentLayer.set(e),n.isSupported.get()&&this.supportedProviders.addItem(n);this.visualizationInfos.clear(),this.visualizationInfos.addItem(this._simpleVisualizationInfo),i=this._simpleVisualizationInfo;for(var a=this.supportedProviders.getLength()-1;0<=a;a--){var n;(n=this.supportedProviders.getAt(a)).isEnabled.get()&&n.enabledVisualization&&(i=n.enabledVisualization);for(var r=n.visualizations.length-1;0<=r;r--){var s=n.visualizations[r];this.visualizationInfos.addItem(s)}}if(this.visualizationInfos.getItems().some(function(e){return e.id===u.CUSTOM_STYLE_ID})&&!e.styles.some(function(e){return e.id===u.CUSTOM_STYLE_ID})){var l=p.getProp(e,["mapService","serviceLayer","renderer"])||p.getProp(e,["mapService","clusterLayer","singleFeatureLayer","renderer"]);l&&e.styles.push(new u.LayerStyle(JSON.stringify(l.toJson()),u.CUSTOM_STYLE_ID,u.CUSTOM_STYLE_ID,!0))}this.selectedVisualization.set(c.firstOrDefault(this.visualizationInfos.getItems().filter(function(e){return e.id===i.id&&e.provider===i.provider})))},s.prototype._handleVisualizationChanged=function(e){for(var i=0,t=this.supportedProviders.getItems();i<t.length;i++)t[i].enabledVisualization=null;if(this._activeProvider=e.provider,this._activeProvider.handleActivate(e),this.hasOptionsView.set(!1),this.canReset.set(!1),this._activeProvider.isSupported.get()){if(e.provider.viewId){var o=this.app.viewManager.getViewById(e.provider.viewId);o&&(this.hasOptionsView.set(!0),this.app.viewManager.activateView(o)),"ClusterLayerView"!==o.id&&"HeatMapsView"!==o.id||this.canReset.set(!0)}}else this._activeProvider=this._simpleViewProvider},s.prototype._loadProviders=function(e){for(var i=this,t=function(e){e.libraryId&&!o.app.allLibrariesLoaded?o.app.event("ViewerLibrariesDownloadedEvent").once(o,function(){i._loadProvider(e)}):o._loadProvider(e)},o=this,a=0,n=e;a<n.length;a++)t(n[a])},s.prototype._loadProvider=function(e){var i;if(i=dojo.getObject(e.type)){var t=new i(this.app,e.libraryId||this.libraryId);return t.initialize(e),this._providers.push(t),t}this.app.trace.error("{0} can't find visualization provider typed {1}".format(this.id,e.type))},s);function s(){var e=null!==n&&n.apply(this,arguments)||this;return e._activeProvider=null,e._providers=[],e._simpleViewProvider=null,e._simpleVisualizationInfo=null,e.selectedLayer=new o.Observable(null),e.supportedProviders=new o.ObservableCollection([]),e.visualizationInfos=new o.ObservableCollection([]),e.selectedVisualization=new o.Observable(null),e.hasOptionsView=new o.Observable(!1),e.canReset=new o.Observable(!1),e}i.VisualizationViewModel=r})},"Mapping/modules/Visualization/VisualizationViewModelConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"url:/Mapping/modules/Visualization/VisualizationView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Visualization/CSS/common.css","css","LnZpc3VhbGl6YXRpb24gLnZpc3VhbGl6YXRpb24tdGl0bGUgew0KICAgIGNvbG9yOiAjNzY3Njc2Ow0KICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgZm9udC1zaXplOiAxLjI1ZW07DQp9DQoNCi52aXN1YWxpemF0aW9uLXN0YXR1cyAuc3RhdHVzLW1zZyB7DQogICAgd2hpdGUtc3BhY2U6IG5vcm1hbDsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCg=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Visualization/VisualizationView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/Visualization/SimpleVisualizationProvider","Mapping/modules/Visualization/VisualizationModule","Mapping/modules/Visualization/VisualizationView","Mapping/modules/Visualization/VisualizationViewModel"],function(e,i,t,o){a(e,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.SimpleVisualizationProvider",e.SimpleVisualizationProvider),a(i,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.VisualizationModule",i.VisualizationModule),a(t,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.VisualizationView",t.VisualizationView),a(o,"geocortex.essentialsHtmlViewer.mapping.modules.visualization.VisualizationViewModel",o.VisualizationViewModel)})}();