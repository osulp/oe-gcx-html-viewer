!function(){require({cache:{"Mapping/modules/OptimizerIntegration/OptimizerIntegrationModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/framework/observables","geocortex/optimizer/EventRelay"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n._userName=new a.Observable,n._eventRelay=null,n}return e(i,t),i.prototype.initialize=function(e){var t=this;if(this.app.command("LogOptimizerEvent").register(this,this._executeLogOptimizerEvent,this._canExecuteLogOptimizerEvent),this._loggingEnabled=!(!e||void 0==e.enabled)&&e.enabled,this._userName.set(e&&e.userName&&""!=e.userName?e.userName:"DefaultUser"),this._dataRelayUri=e&&e.dataRelayUri&&""!=e.dataRelayUri?e.dataRelayUri:"http://localhost/Geocortex/Optimizer/Rest/DataRelay/LogData.ashx?f=json",!1!==this._loggingEnabled&&!0!==this.app.isOffline.get()){this._dataRelayUri.endsWith(".ashx")&&(this._dataRelayUri=this._dataRelayUri+"?f=json"),this._requiresProxy(this._dataRelayUri)&&(this._dataRelayUri=this.app.configuration.proxyUri+this._dataRelayUri);var i=this._userName.bind(this,function(){null!=t._eventRelay&&(t._eventRelay.userName=t._userName.get()),t._userName.unbind(i)});if(this._authenticationSucceededToken=this.app.event("AuthenticationSucceededEvent").subscribe(this,this._handleAuthenticationSucceeded),this._authenticationFailedToken=this.app.event("AuthenticationFailedEvent").subscribe(this,this._handleAuthenticationFailed),this.app.map&&this.app.map.loaded)this._onMapLoaded();else var n=this.app.event("MapLoadedEvent").subscribe(this,function(){t.app.event("MapLoadedEvent").unsubscribe(n),t._onMapLoaded()})}},i.prototype._onMapLoaded=function(){this._eventRelay=new o.EventRelay(this.app.map,this.app.site.id,this._dataRelayUri,this._userName.get()),this._executeLogOptimizerEvent("ViewerShell",this.app.shellName)},i.prototype._canExecuteLogOptimizerEvent=function(e,t){return this._loggingEnabled&&null!=this._eventRelay},i.prototype._executeLogOptimizerEvent=function(e,t){this._eventRelay.logToolUsage(e,t)},i.prototype._handleAuthenticationSucceeded=function(e){!0===e.result&&this._userName.set(e.username),null!=this._eventRelay&&this._executeLogOptimizerEvent("AuthenticationSucceededEvent",e.username),this._unsubscribeFromAuthenticationEvents()},i.prototype._handleAuthenticationFailed=function(e){null!=this._eventRelay&&this._executeLogOptimizerEvent("AuthenticationFailedEvent",e.username)},i.prototype._unsubscribeFromAuthenticationEvents=function(){this.app.event("AuthenticationSucceededEvent").unsubscribe(this._authenticationSucceededToken),this.app.event("AuthenticationFailedEvent").unsubscribe(this._authenticationSucceededToken)},i.prototype._requiresProxy=function(e){var t=new dojo._Url(e),i=window.location;return!!(t.scheme||t.host||t.port)&&i.protocol+"//"+i.hostname+(i.port?":"+i.port:"")!=t.scheme+"://"+t.host+(t.port?":"+t.port:"")},i}(n.ModuleBase);i.OptimizerIntegrationModule=r})}}}),require({cache:{}}),define(["Mapping/modules/OptimizerIntegration/OptimizerIntegrationModule"],function(e){!function(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var n=t.split("."),a=null,o=window,r=0,s=n.length;r<s;r++)a=n[r],r==s-1?o[a]=i:o[a]||(o[a]={}),o=o[a];else console.warn("Undefined shim for: "+t)}(e,"geocortex.essentialsHtmlViewer.mapping.modules.optimizerIntegration.OptimizerIntegrationModule",e.OptimizerIntegrationModule)})}();