function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var n=t.split("."),a=null,o=window,s=0,r=n.length;s<r;s++)a=n[s],s==r-1?o[a]=i:o[a]||(o[a]={}),o=o[a]}require({cache:{"Mapping/modules/OptimizerIntegration/OptimizerIntegrationModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/framework/observables","geocortex/optimizer/EventRelay"],function(e,t,i,n,a){"use strict";var o=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a._userName=new n.Observable,a._eventRelay=null,a}return __extends(t,e),t.prototype.initialize=function(e){var t=this;if(this.app.command("LogOptimizerEvent").register(this,this._executeLogOptimizerEvent,this._canExecuteLogOptimizerEvent),this._loggingEnabled=!(!e||void 0==e.enabled)&&e.enabled,this._userName.set(e&&e.userName&&""!=e.userName?e.userName:"DefaultUser"),this._dataRelayUri=e&&e.dataRelayUri&&""!=e.dataRelayUri?e.dataRelayUri:"http://localhost/Geocortex/Optimizer/Rest/DataRelay/LogData.ashx?f=json",this._loggingEnabled!==!1&&this.app.isOffline.get()!==!0){this._dataRelayUri.endsWith(".ashx")&&(this._dataRelayUri=this._dataRelayUri+"?f=json"),this._requiresProxy(this._dataRelayUri)&&(this._dataRelayUri=this.app.configuration.proxyUri+this._dataRelayUri);var i=this._userName.bind(this,function(){null!=t._eventRelay&&(t._eventRelay.userName=t._userName.get()),t._userName.unbind(i)});if(this._authenticationSucceededToken=this.app.event("AuthenticationSucceededEvent").subscribe(this,this._handleAuthenticationSucceeded),this._authenticationFailedToken=this.app.event("AuthenticationFailedEvent").subscribe(this,this._handleAuthenticationFailed),this.app.map&&this.app.map.loaded)this._onMapLoaded();else var n=this.app.event("MapLoadedEvent").subscribe(this,function(){t.app.event("MapLoadedEvent").unsubscribe(n),t._onMapLoaded()})}},t.prototype._onMapLoaded=function(){this._eventRelay=new a.EventRelay(this.app.map,this.app.site.id,this._dataRelayUri,this._userName.get()),this._executeLogOptimizerEvent("ViewerShell",this.app.shellName)},t.prototype._canExecuteLogOptimizerEvent=function(e,t){return this._loggingEnabled&&null!=this._eventRelay},t.prototype._executeLogOptimizerEvent=function(e,t){this._eventRelay.logToolUsage(e,t)},t.prototype._handleAuthenticationSucceeded=function(e){e.result===!0&&this._userName.set(e.username),null!=this._eventRelay&&this._executeLogOptimizerEvent("AuthenticationSucceededEvent",e.username),this._unsubscribeFromAuthenticationEvents()},t.prototype._handleAuthenticationFailed=function(e){null!=this._eventRelay&&this._executeLogOptimizerEvent("AuthenticationFailedEvent",e.username)},t.prototype._unsubscribeFromAuthenticationEvents=function(){this.app.event("AuthenticationSucceededEvent").unsubscribe(this._authenticationSucceededToken),this.app.event("AuthenticationFailedEvent").unsubscribe(this._authenticationSucceededToken)},t.prototype._requiresProxy=function(e){var t=new dojo._Url(e),i=window.location;return!!(t.scheme||t.host||t.port)&&i.protocol+"//"+i.hostname+(i.port?":"+i.port:"")!=t.scheme+"://"+t.host+(t.port?":"+t.port:"")},t}(i.ModuleBase);t.OptimizerIntegrationModule=o})}}}),define(["Mapping/modules/OptimizerIntegration/OptimizerIntegrationModule"],function(e){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.optimizerIntegration.OptimizerIntegrationModule",e.OptimizerIntegrationModule)});