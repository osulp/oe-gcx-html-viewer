require({cache:{"geocortex/infrastructure/accessibility/MapNavigationState":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/InputMethod":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();i.MOUSE="mouse",i.KEYBOARD="keyboard",t.InputMethod=i})},"geocortex/infrastructure/accessibility/AccessibleMapComponent":function(){define(["require","exports","geocortex/framework/utils/utils","geocortex/infrastructure/accessibility/InputMethod"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){this.inputMethod=null,this.suspended=!1,this.isKeyboardActive=!1,this.id=i.alphaNumericToken(),this._map=null,this._mapNavState=null,this._mouseDownHandle=null,this._keyDownHandle=null,this._keyUpHandle=null,this.setMap(e),this.setApp(t)}return e.prototype.setMap=function(e){this._map=e},e.prototype.setApp=function(e){this.app=e},e.prototype.setInputMethod=function(e){if(e!==this.inputMethod){var t=this.inputMethod;this.inputMethod=e,this.onInputMethodChange({previousMethod:t,newMethod:this.inputMethod})}},e.prototype.setKeyboardActive=function(e){this.isKeyboardActive=e},e.prototype.suspend=function(){this.suspended=!0},e.prototype.resume=function(){this.suspended=!1},e.prototype.disableMapNavigation=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!0);var r=this._map;return this._mapNavState={isDoubleClickZoom:r.isDoubleClickZoom,isClickRecenter:r.isClickRecenter,isPan:r.isPan,isRubberBandZoom:r.isRubberBandZoom,isKeyboardNavigation:r.isKeyboardNavigation,isScrollWheelZoom:r.isScrollWheelZoom,isShiftDoubleClickZoom:r.isShiftDoubleClickZoom,isPanArrows:r.isPanArrows,isZoomSlider:r.isZoomSlider},r.disableDoubleClickZoom(),r.disableClickRecenter(),r.disablePan(),r.disableRubberBandZoom(),r.disableKeyboardNavigation(),r.disableScrollWheelZoom(),r.disableShiftDoubleClickZoom(),e&&r.isZoomSlider&&r.hideZoomSlider(),t&&r.isPanArrows&&r.hidePanArrows(),i&&r.graphics.disableMouseEvents(),this._mapNavState},e.prototype.enableMapNavigation=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!0);var n=this._map,a=r||this._mapNavState;a&&(a.isDoubleClickZoom&&n.enableDoubleClickZoom(),a.isClickRecenter&&n.enableClickRecenter(),a.isPan&&n.enablePan(),a.isRubberBandZoom&&n.enableRubberBandZoom(),a.isKeyboardNavigation&&n.enableKeyboardNavigation(),a.isScrollWheelZoom&&n.enableScrollWheelZoom(),a.isShiftDoubleClickZoom&&n.enableShiftDoubleClickZoom(),e&&a.isZoomSlider&&n.showZoomSlider(),t&&a.isPanArrows&&n.showPanArrows(),i&&n.graphics.enableMouseEvents())},e.prototype.getMapState=function(){return this._mapNavState},e.prototype.activateMouseControls=function(e){var t=this;void 0===e&&(e=!0),this.deactivateMouseControls(e),this._mouseDownHandle=this.app.map.on("mouse-down",function(){t._mouseDownHandle.remove(),t._mouseDownHandle=null,t.setInputMethod(r.InputMethod.MOUSE)})},e.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),this._mouseDownHandle&&(this._mouseDownHandle.remove(),this._mouseDownHandle=null),e&&this.inputMethod===r.InputMethod.MOUSE&&this.setInputMethod(null)},e.prototype.activateKeyboardControls=function(e){void 0===e&&(e=!0),this.isKeyboardActive&&this.deactivateKeyboardControls(e),this.setKeyboardActive(!0),this._keyDownHandle=dojo.on(this._map.root,"keydown",dojo.hitch(this,"_onKeyDown")),this._keyUpHandle=dojo.on(this._map.root,"keyup",dojo.hitch(this,"_onKeyUp")),this.app.event("AccessibleComponentStartedEvent").publish(this)},e.prototype.deactivateKeyboardControls=function(e){void 0===e&&(e=!0),this.setKeyboardActive(!1),this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null),e&&this.inputMethod===r.InputMethod.KEYBOARD&&this.setInputMethod(null),this.app.event("AccessibleComponentCompletedEvent").publish(this)},e.prototype.toggleKeyboardMode=function(){var e=this.inputMethod===r.InputMethod.KEYBOARD;e?this.onKeyboardStop():this.onKeyboardStart()},e.prototype.onInputMethodChange=function(e){this.app.event("InputMethodChangedEvent").publish(e)},e.prototype.onKeyboardStart=function(){this._mouseDownHandle&&(this._mouseDownHandle.remove(),this._mouseDownHandle=null),this.setInputMethod(r.InputMethod.KEYBOARD)},e.prototype.onKeyboardStop=function(e){void 0===e&&(e=!1),this.setInputMethod(null)},e.prototype._onKeyDown=function(e){},e.prototype._onKeyUp=function(e){},e}();t.AccessibleMapComponent=n})},"geocortex/infrastructure/accessibility/ExtendedDrawOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/ExtendedEditOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/EditInterface":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/EditCapability":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/EditCapabilityBase":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i){this.owner=null,this.graphic=null,this.map=null,this.suspended=!1,this.graphic=e,this.map=t,this.owner=i}return e.prototype.destroy=function(){this.suspended=!1,this.graphic=this.map=this.owner=null},e.prototype.refresh=function(e){void 0===e&&(e=!1)},e.prototype.suspend=function(){this.suspended=!0},e.prototype.resume=function(){this.suspended=!1},e}();t.EditCapabilityBase=i})},"geocortex/infrastructure/accessibility/GraphicMoverOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/DatumTransformRegistryItem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/gis/DatumTransform":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/DatumTransformParameters":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferUnitDesc":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferUnits":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferResultBase":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferOperationResult":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferArgsBase":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferGeometryArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferGeometriesArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferOperationError":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/BufferUtils":function(){define(["require","exports","geocortex/infrastructure/GeometryUtils","geocortex/essentials/DistanceUnit"],function(e,t,i,r){"use strict";function n(e,t){var i={bufferId:t.bufferId,geometries:[t.geometry],callback:t.callback,geodesic:t.geodesic,bufferSpatialReference:t.bufferSpatialReference,outSpatialReference:t.outSpatialReference,bufferDistance:t.bufferDistance,bufferUnit:t.bufferUnit,unionResults:t.unionResults,sourceCommand:t.sourceCommand},r=function(t,r){a(e,i).then(function(e){e.geometry=e.geometries[0]||null,t(e)},function(e){r(e)})};return new Promise(r)}function a(r,n){var a=function(i){var a=null;e(["esri/tasks/BufferParameters"],function(e){a=new esri.tasks.BufferParameters,a.geometries=i,a.unit=c(n.bufferUnit),a.bufferSpatialReference=n.bufferSpatialReference||n.outSpatialReference||n.geometries[0].spatialReference||r.map.spatialReference,a.outSpatialReference=n.outSpatialReference||r.map.spatialReference||n.geometries[0].spatialReference||n.bufferSpatialReference,a.distances=[n.bufferDistance],a.unionResults=void 0==n.unionResults||!!n.unionResults,a.geodesic=!!n.geodesic,a.unit==t.GCX_UNIT_YARDS&&(a.unit=esri.tasks.GeometryService.UNIT_FOOT,a.distances=[u(n.bufferDistance,t.GCX_UNIT_YARDS,esri.tasks.GeometryService.UNIT_FOOT)])});var s=function(e,t){o(r,a).then(e,t)};return new Promise(s)},s=function(e,t){var r=d(n.geometries),o=[];r.forEach(function(e){o.push(a(e))}),Promise.all(o).then(function(r){var a=r[0];if(a.bufferId=n.bufferId,a.sourceCommand=n.sourceCommand,1===r.length)e(a);else{for(var o=1;o<r.length;o++){var s=r[o].geometries;s.length&&(a.geometries=a.geometries.concat(s))}n.unionResults?i.unionGeometries(a.geometries).then(function(t){i.isValidGeometry(t)&&(a.geometries=[t],a.geometry=t,e(a))},function(e){var i={};i.error=e,i.bufferId=n.bufferId,i.sourceCommand=n.sourceCommand,t(i)}):e(a)}},function(e){e.bufferId=n.bufferId,e.sourceCommand=n.sourceCommand,t(e)})};return new Promise(s)}function o(e,t){var r=function(e,t){var i={};return e&&(i.geometries=e),t&&(i.error=t),i},n=function(n,a){var o=i.getGeometryService(e);if(!o){var s="BufferUtils: Buffer operation failed. Could not retrieve geometry service.";return e.trace.error(s),void a(r(null,new Error(s)))}var l=function(){0===t.distances[0]?n(r(t.geometries,null)):o.buffer(t,function(e){return n(r(e,null))},function(e){return a(r(null,e))})};esri.geometry.normalizeCentralMeridian(t.geometries).then(function(e){"polygon"===e[0].type?o.simplify(t.geometries,function(e){t.geometries=e,l()},function(e){a(r(null,e))}):(t.geometries=e,l())})};return new Promise(n)}function s(e){var t=parseInt(e,10);if(isNaN(t))return!1;if(p.indexOf(t)>-1)return!0;for(var i=0;i<h.length;i++)if(t>=h[i][0]&&t<=h[i][1])return!0;return!1}function l(e){for(var i in t.SUPPORTED_BUFFER_UNITS)if(t.SUPPORTED_BUFFER_UNITS.hasOwnProperty(i)&&t.SUPPORTED_BUFFER_UNITS[i]&&t.SUPPORTED_BUFFER_UNITS[i].config===e)return t.SUPPORTED_BUFFER_UNITS[i];return null}function c(e,i){if(!e)return null;var n=null;switch(e){case"feet":case r.DistanceUnitType.FEET:case esri.tasks.GeometryService.UNIT_FOOT.toString():case esri.Units.FEET:n=esri.tasks.GeometryService.UNIT_FOOT;break;case"kilometer":case r.DistanceUnitType.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER.toString():case esri.Units.KILOMETERS:n=esri.tasks.GeometryService.UNIT_KILOMETER;break;case"meter":case r.DistanceUnitType.METERS:case esri.tasks.GeometryService.UNIT_METER.toString():case esri.Units.METERS:n=esri.tasks.GeometryService.UNIT_METER;break;case"mile":case r.DistanceUnitType.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE.toString():case esri.Units.MILES:n=esri.tasks.GeometryService.UNIT_STATUTE_MILE;break;case"nauticalmile":case r.DistanceUnitType.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE.toString():case esri.Units.NAUTICAL_MILES:n=esri.tasks.GeometryService.UNIT_NAUTICAL_MILE;break;case"yard":case r.DistanceUnitType.YARDS:case esri.Units.YARDS:n=t.GCX_UNIT_YARDS;break;default:n=i||e}return n}function u(e,i,r){var n=0;switch(i){case esri.tasks.GeometryService.UNIT_METER:n=3.280839895013*e;break;case esri.tasks.GeometryService.UNIT_KILOMETER:n=3280.839895013123*e;break;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:n=5280*e;break;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:n=6076.12*e;break;case t.GCX_UNIT_YARDS:n=3*e;break;default:n=e}switch(r){case esri.tasks.GeometryService.UNIT_METER:return n/3.280839895013;case esri.tasks.GeometryService.UNIT_KILOMETER:return n/3280.839895013123;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:return n/5280;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:return n/6076.12;case t.GCX_UNIT_YARDS:return n/3;default:return n}}function d(e){var t=[],i=function(e){for(var i=!1,r=0;r<t.length;r++)if(t[r].length&&t[r][0].type===e.type){t[r].push(e),i=!0;break}if(!i){var n=t.length;t[n]=[],t[n].push(e)}};return e.forEach(i),t}t.SUPPORTED_BUFFER_UNITS={feet:null,yard:null,meter:null,kilometer:null,mile:null,nauticalmile:null};var p=[3819,3821,3824,3889,3906,5013,5233,5246,5252,5264,5324,5340,5354,5360,5365,5371,5373,5381,5393,5451,5464,5467,5489,5524,5527,5546,5561,37257,104e3,104020,104023,104199,104223,104896],h=[[4001,4999],[5228,5229],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700],[37001,37008],[37201,37208],[37211,37235],[37237,37243],[37245,37247],[37249,37255],[37259,37260],[104100,104145],[104256,104259],[104260,104261],[104286,104287],[104304,104305],[104700,104786],[104800,104871],[104900,104970],[104990,104992]];t.GCX_UNIT_YARDS=12345,t.bufferGeometry=n,t.bufferGeometries=a,t.buffer=o,t.isGeographicWkid=s,t.getUnitDescFromConfig=l,t.getGeometryServiceUnitConstant=c,t.convertLength=u})},"geocortex/infrastructure/GeometryUtils":function(){define(["require","exports","geocortex/framework/utils/utils","geocortex/essentials/GeometryUtilities","geocortex/essentials/RestHelperHTTPService","geocortex/infrastructure/buffer/BufferUtils"],function(e,t,i,r,n,a){"use strict";function o(e){var t=i.isNullOrUndefined;if(t(e))return!1;switch(e.type){case"point":var r=e;return!t(r.x)&&!t(r.y);case"multipoint":var n=e.points;return n&&n.length>0;case"polyline":var a=e.paths;return a&&a.length>0;case"polygon":var o=e.rings;return o&&o.length>0;case"extent":var s=e;return!(t(s.xmin)||t(s.xmax)||t(s.ymin)||t(s.ymax));default:return!1}}function s(e){if(!e||!e.type||!o(e))return null;var t;if("point"==e.type)return e;if("multipoint"==e.type)return t=e.getExtent(),t?t.getCenter():null;if("polyline"==e.type){for(var i=e,r=0,n=0;n<i.paths.length;n++)for(var a=0;a<i.paths[n].length-1;a++){var s=new esri.geometry.Point(i.paths[n][a]),l=new esri.geometry.Point(i.paths[n][a+1]);r+=c(s,l)}var u=0;for(n=0;n<i.paths.length;n++)for(a=0;a<i.paths[n].length-1;a++){var s=new esri.geometry.Point(i.paths[n][a]),l=new esri.geometry.Point(i.paths[n][a+1]),d=c(s,l);if(u+d>r/2){var p=r/2-u,h=l.x-s.x,m=l.y-s.y,f=d/p,g=h/f,y=m/f;return new esri.geometry.Point(s.x+g,s.y+y,e.spatialReference)}u+=d}}else{if("polygon"==e.type)return t=e.getExtent(),t?t.getCenter():null;if("extent"==e.type)return e.getCenter()}return null}function l(e,t){if(!e||!t)throw new Error("The beginning and ending points are required.");var i=new esri.geometry.Point({x:(e.x+t.x)/2,y:(e.y+t.y)/2,spatialReference:e.spatialReference.toJson()});return i}function c(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function u(e,t){if(!e)return null;var i=null;switch(e.toLowerCase()){case"rectangle":i=esri.toolbars.Draw.EXTENT;break;case"freehandpolygon":i=esri.toolbars.Draw.FREEHAND_POLYGON;break;case"freehandpolyline":i=esri.toolbars.Draw.FREEHAND_POLYLINE;break;case"mappoint":i=esri.toolbars.Draw.POINT;break;case"multipoint":i=esri.toolbars.Draw.MULTI_POINT;break;case"polygon":i=esri.toolbars.Draw.POLYGON;break;case"polyline":i=esri.toolbars.Draw.POLYLINE;break;default:i=t||esri.toolbars.Draw.EXTENT}return i}function d(e){return p(e)}function p(e){if(!e||!e.configuration)return null;if(O&&O.url&&O.url.startsWith(e.configuration.geometryServiceUrl))return O;var t=e.configuration.geometryServiceUrl,i=e.configuration.geometryServiceToken;if(i){t=n.RestHelperHTTPService.appendTokenToUrl(t,i);var r=dojo.subscribe("ServiceTokenRefreshed",function(t){t.serviceUrl===e.configuration.geometryServiceUrl&&(e.configuration.geometryServiceToken=t.token,O=null,dojo.unsubscribe(r))})}return"https:"!=window.location.protocol||/^(https|\/\/)/.test(t)||e.trace.warning("Mixed Content Warning: This Viewer was loaded over HTTPS but the geometry service was loaded over HTTP. This may limit functionality. Please configure the geometry service to be served securely."),O=new esri.tasks.GeometryService(t)}function h(e,t){return!r.spatialRefsAreEqual(e.spatialReference,t.map.spatialReference,!1)}function m(e,t,i,r,n){if(!e||!e.spatialReference)return void(r&&r(new Error("Invalid geometry or spatial reference.")));if(e.spatialReference.equals(t))i&&i(e);else{var a=new esri.tasks.ProjectParameters;a.outSR=t,a.geometries=[e];var o=function(e){e&&e.length>0&&i&&i(e[0])};this.project(a,o,r,n)}}function f(e,t,i,r,n,a){if(!i)return void this.projectGeometry(e,t,r,n);if(!e||!e.spatialReference)return void(n&&n(new Error("Invalid geometry or spatial reference.")));if(e.spatialReference.equals(t))r&&r(e);else{var o=new esri.tasks.ProjectParameters;o.outSR=t,o.geometries=[e],o.transformation={wkid:i};var s=function(e){e&&e.length>0&&r&&r(e[0])};this.project(o,s,n,a)}}function g(e,t,i,n){if(e&&(!esri.tasks.hasOwnProperty("ProjectParameters")||e instanceof esri.tasks.ProjectParameters)&&e.hasOwnProperty("outSR")&&e.hasOwnProperty("geometries")){if(t&&dojo.isFunction(t)){if(e.outSR){var a=e.geometries,o=!1;if(a&&a.length>0&&(r.spatialRefsAreEqual(a[0].spatialReference,e.outSR,!1)||(o=!0)),o){var s=this._getGeometryService(n);if(e.outSR.isWebMercator()&&4326===a[0].spatialReference.wkid||4326===e.outSR.wkid&&a[0].spatialReference.isWebMercator())return void this._projectLocally(e.geometries,e.outSR,t,i);if(!s){if(i&&dojo.isFunction(i)){var l="Unable to get the geometry service. Make sure a geometry service url is configured in the application.";i(new Error(l))}return}var c=C(a[0].spatialReference,e.outSR);c&&!e.transformation&&(e.transformation=c.transformation,e.transformForward=c.transformForward),esri.tasks.hasOwnProperty("ProjectParameters")?s.project(e,t,i):s.project(e.geometries,e.outSR,t,i)}else t(a)}else if(i&&dojo.isFunction(i)){var l="output spatial reference is required.";i(new Error(l))}}else if(i&&dojo.isFunction(i)){var l="callback required.";i(new Error(l))}}else if(i&&dojo.isFunction(i)){var l="projectParameters required.";i(new Error(l))}}function y(e,t,i,r){var n=this._getGeometryService(r);n.simplify(e,t,i)}function b(e,t,i,r){function n(e){e&&e.length>0?t(e[0]):i()}this.simplifyPolygons([e],n,i,r)}function v(e,t,i,r){for(var n=[],a=0;a<e.length;a++)if(e[a].spatialReference.isWebMercator()&&4326===t.wkid)n[a]=esri.geometry.webMercatorToGeographic(e[a]);else if(4326===e[a].spatialReference.wkid&&t.isWebMercator())n[a]=esri.geometry.geographicToWebMercator(e[a]);else{if(r&&dojo.isFunction(r)){var o="Unable to get the geometry service. Make sure a geometry service url is configured in the application.";r(new Error(o))}this.app.trace.error("An operation requiring projection attempted to project while offline, but was not between WebMercator and WGS84")}i(n)}function S(e,t,i,r){var n=[],a=null,o=r||40,s=new esri.geometry.Polygon(e);a=360/o;for(var l=1;l<=o;l++){var c=l*a*Math.PI/180;n.push([t.x+i*Math.cos(c),t.y+i*Math.sin(c)])}return n.push(n[0]),s.addRing(n),s}function _(e,t){var i=t.getWidth()/t.getHeight(),r=e.getWidth()/e.getHeight(),n=e.getWidth(),a=e.getHeight();r<i?n=i*a:a=1/i*n;var o=e.getCenter();return new esri.geometry.Extent(o.x-n/2,o.y-a/2,o.x+n/2,o.y+a/2,e.spatialReference)}function I(e){var t=new esri.geometry.Polygon(e.spatialReference),i=new Array;return i.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y+e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x+e.getWidth()/2,e.getCenter().y+e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x+e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),t.addRing(i),t}function w(e,t){return!(e&&!t||!e&&t)&&(!e||e.x===t.x&&e.y===t.y&&(!(!e.spatialReference&&t.spatialReference||e.spatialReference&&!t.spatialReference)&&!!e.spatialReference.equals(t.spatialReference)))}function x(){var e=[];e.push({transformWkid:108457,fromWkid:28992,toWkid:4326}),e.push({transformWkid:1195,fromWkid:27700,toWkid:4326}),e.push({transformWkid:1623,fromWkid:102067,toWkid:4326}),L(e)}function L(e){e.forEach(function(e){var t=null;e.fromWkid&&e.fromWkid>0?t=new esri.SpatialReference(e.fromWkid):e.fromWkt&&(t=new esri.SpatialReference(e.fromWkt));var i=null;e.toWkid&&e.toWkid>0?i=new esri.SpatialReference(e.toWkid):e.toWkt&&(i=new esri.SpatialReference(e.toWkt));var r=null;if(e.transformWkid&&e.transformWkid>0?r=new esri.SpatialReference(e.transformWkid):e.transformWkt&&(r=new esri.SpatialReference(e.transformWkt)),!t||!i||!r)throw new Error("Invalid or missing spatial reference. Cannot register datum transform.");Z.push({fromSR:t,toSR:i,transformation:r})})}function C(e,t){if(!e||!t||0==Z.length)return null;for(var i=0;i<Z.length;i++){var n=Z[i];if(r.spatialRefsAreEqual(e,n.fromSR)&&r.spatialRefsAreEqual(t,n.toSR))return{transformation:n.transformation,transformForward:!0};if(r.spatialRefsAreEqual(e,n.toSR)&&r.spatialRefsAreEqual(t,n.fromSR))return{transformation:n.transformation,transformForward:!1}}return null}function M(t,i){var r=function(r,n){e(["esri/geometry/geometryEngine"],function(e){try{r(e.intersects(t,i))}catch(a){n(a)}})};return new Promise(r)}function F(t){var i=function(i,r){e(["esri/geometry/geometryEngine"],function(e){try{i(e.union(t))}catch(n){r(n)}})};return new Promise(i)}function E(t,i){var r=this,n=111319.4907932738,o=function(o,s){e(["esri/geometry/geometryEngine"],function(e){var l=new esri.SpatialReference(t.spatialReference.toJson()),c=t.units;try{if(c&&!c.isLinear()||l.wkid&&a.isGeographicWkid(l.wkid)){var u=i/n;o(u)}else{var d=new esri.geometry.Point(0,0,l),p=new esri.geometry.Point(0,100,l),h=new esri.tasks.ProjectParameters;h.geometries=[d,p],h.outSR=new esri.SpatialReference(102100),g(h,function(t){var r=e.distance(t[0],t[1],"meters");o(100/r*i)},function(e){return s(e)},r.app)}}catch(m){s(m)}})};return new Promise(o)}function T(e){switch(e.type){case"polygon":return e.rings.map(function(t){return new esri.geometry.Polygon(t).setSpatialReference(e.spatialReference)});case"polyline":return e.paths.map(function(t){return new esri.geometry.Polyline(t).setSpatialReference(e.spatialReference)});case"multipoint":return e.points.map(function(t){return new esri.geometry.Point(t,e.spatialReference)})}return[e]}function R(e,t,i){var r=this,n=function(n,a){var o=r.getGeometryService(i);if(!o)return Promise.reject(new Error("Unable to get the geometry service. Make sure a geometry service url is configured in the application."));try{o.cut(e,t).then(function(e){for(var t=[],i=0;i<e.geometries.length;i++){var r=e.cutIndexes[i];t[r]||(t[r]=[]),t[r].push(e.geometries[i])}n(t)})}catch(s){a(s)}};return new Promise(n)}function k(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}function G(e,t,i){if(t&&"point"===t.type){var r=e.extent.getWidth()/e.width,n=i*r,a=t;return new esri.geometry.Extent(a.x-n,a.y-n,a.x+n,a.y+n,e.spatialReference)}return t}function W(e,t){var i=function(t,i){return void 0===t&&(t=!1),void 0===i&&(i=""),t&&console.log("An error occurred during the Ramer Douglas Pecker geometry simplification process."+i+". Using original geometry. This may have performance implications."),esri.geometry.fromJson(e.toJson())};if(!(e instanceof esri.geometry.Polygon||e instanceof esri.geometry.Polyline))return i();try{for(var r=[],n=e.rings||e.paths,a=0;a<n.length;a++)r.push(V(n[a],t));if(e instanceof esri.geometry.Polygon){var s=new esri.geometry.Polygon(e.spatialReference);return r.forEach(function(e){return s.addRing(e)}),o(s)?s:i(!0)}var l=new esri.geometry.Polyline(e.spatialReference);return r.forEach(function(e){return l.addPath(e)}),o(l)?l:i(!0)}catch(c){return i(!0,c.message)}}function V(e,t){if(e.length<3)return e;for(var i=1,r=0,n=1;n<e.length-1;n++){var a=P(e[n],e[0],e[e.length-1]);a>r&&(r=a,i=n)}if(r>t){var o=V(e.slice(0,i+1),t),s=V(e.slice(i),t);return o.slice(0,o.length-1).concat(s)}return[e[0],e[e.length-1]]}function P(e,t,i){var r,n,a;return t[0]===i[0]?r=Math.abs(e[0]-t[0]):(n=(i[1]-t[1])/(i[0]-t[0]),a=t[1]-n*t[0],r=Math.abs(n*e[0]-e[1]+a)/Math.sqrt(Math.pow(n,2)+1)),r}t.DEFAULT_GEOMETRY_SERVICE_URI="http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/Geometry/GeometryServer";var Z=[],O=null;t.isValidGeometry=o,t.getMiddle=s,t.getMidpoint=l,t.getEsriGeometryType=u,t._getGeometryService=d,t.getGeometryService=p,t.needsProjection=h,t.projectGeometry=m,t.projectGeometryWithTransform=f,t.project=g,t.simplifyPolygons=y,t.simplifyPolygon=b,t._projectLocally=v,t.createCircle=S,t.fixAspectRatio=_,t.extentToPolygon=I,t.pointsAreEqual=w,t.registerDefaultDatumTransforms=x,t.registerDatumTransforms=L,t.getDatumTransformParameters=C,t.intersects=M,t.unionGeometries=F,t.convertMetersToMapPoints=E,t.explodeGeometry=T,t.cutGeometries=R,t.toRing=k,t.createToleranceEnvelope=G,t.getRamerDouglasPeuckerSimplifiedGeometry=W})},"geocortex/infrastructure/MatrixUtils":function(){define(["require","exports","geocortex/infrastructure/GeometryUtils"],function(e,t,i){"use strict";var r=function(){function e(){}return e.translate=function(e,t,i,r){if(!e||!t)return null;switch(e.type){case"point":var n=t.toScreen(e);e=t.toMap(n.offset(i,r));break;case"polyline":e=this._applyOffset(e,e.paths,i,r,t);break;case"polygon":e=this._applyOffset(e,e.rings,i,r,t)}return{geometry:e,transform:dojox.gfx.matrix.translate(i,r)}},e.rotate=function(e,t,i,r){if(!e||!t)return null;var n=r||this.getCentroid(e),a=dojox.gfx.matrix.rotategAt(-i,n.x,n.y);switch(e.type){case"polyline":e=this._applyTransform(e,e.paths,a);break;case"polygon":e=this._applyTransform(e,e.rings,a)}var o=t.toScreen(n);return{geometry:e,transform:dojox.gfx.matrix.rotategAt(-i,o.x,o.y)}},e.scale=function(e,t,i,r){if(void 0===r&&(r=null),!e||!t)return null;(isNaN(i)||1/0===i||-(1/0)===i)&&(i=1),null!==r&&"undefined"!=typeof r||(r=i);var n=this.getCentroid(e),a=dojox.gfx.matrix.scaleAt(i,r,n.x,n.y);switch(e.type){case"polyline":e=this._applyTransform(e,e.paths,a);break;case"polygon":e=this._applyTransform(e,e.rings,a)}var o=t.toScreen(n);return{geometry:e,transform:dojox.gfx.matrix.scaleAt(i,r,o.x,o.y)}},e.getCentroid=function(e){if(!e||!e.type||!i.isValidGeometry(e))return null;var t;switch(e.type){case"point":return e;case"multipoint":case"polyline":case"polygon":if(t=e.getExtent())return t.getCenter();case"extent":return e.getCenter()}return null},e._applyOffset=function(e,t,i,r,n){if(e&&t)for(var a=e.getPoint(0,0),o=n.toMap(n.toScreen(a).offset(i,r)),s=o.x-a.x,l=o.y-a.y,c=0;c<t.length;c++)for(var u=0;u<t[c].length;u++){var d=e.getPoint(c,u);e.setPoint(c,u,d.offset(s,l))}return e},e._applyTransform=function(e,t,i){if(e&&t)for(var r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++){var a=e.getPoint(r,n),o=dojox.gfx.matrix.multiplyPoint(i,a.x,a.y);a.setX(o.x),a.setY(o.y),e.setPoint(r,n,a)}return e},e}();t.MatrixUtils=r})},"geocortex/infrastructure/eventArgs/EditVertexMovedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/GraphicMover":function(){define(["require","exports","geocortex/infrastructure/accessibility/EditCapabilityBase","geocortex/infrastructure/MatrixUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i,r,n,a){var o=e.call(this,t,i,r)||this;return o._options={offsetX:10,offsetY:10,preciseOffsetX:1,preciseOffsetY:1},o._modified=!1,o._isMoving=!1,o._transform=null,o._textAnchor=null,o._keyDownHandle=null,o._keyUpHandle=null,o._options=dojo.mixin(o._options,a||{}),o._textAnchor=n,o._init(),o}return __extends(t,e),t.prototype.hasMoved=function(){return this._modified},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._cleanUp()},t.prototype.refresh=function(t){void 0===t&&(t=!1),e.prototype.refresh.call(this,t),this.graphic&&(t||this._needsRefresh())&&(this._cleanUp(),this._init())},t.prototype._needsRefresh=function(){return null==this._keyDownHandle},t.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler")),this._keyUpHandle=dojo.on(this.map.root,"keyup",dojo.hitch(this,"_onKeyUpHandler"))},t.prototype._cleanUp=function(){this._modified=!1,this._isMoving=!1,this._textAnchor=this._transform=null,this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null)},t.prototype._onKeyDownHandler=function(e){if(!this.suspended){var t=e.altKey,i=t?this._options.preciseOffsetX:this._options.offsetX,r=t?this._options.preciseOffsetY:this._options.offsetY,n=e.keyCode||e.which,a=0,o=0;switch(n){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:o=-1;break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:a=1;break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:o=1;break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:a=-1;break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:a=1,o=-1;break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:a=1,o=1;break;case dojo.keys.END:case dojo.keys.NUMPAD_1:a=-1,o=1;break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:a=-1,o=-1;break;default:return}this._moveGraphic(a*i,o*r),e.preventDefault(),e.stopPropagation()}},t.prototype._onKeyUpHandler=function(e){if(!this.suspended){var t=(e.altKey,e.keyCode||e.which);switch(t){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:case dojo.keys.END:case dojo.keys.NUMPAD_1:case dojo.keys.HOME:case dojo.keys.NUMPAD_7:this._isMoving=!1,this.map.enableMapNavigation(),this.owner.onGraphicMoveStop(this.graphic,this._transform);break;default:return}e.preventDefault(),e.stopPropagation()}},t.prototype._moveGraphic=function(e,t){this._isMoving||(this.owner.onGraphicMoveStart(this.graphic),this.owner.onGraphicFirstMove(this.graphic),this._isMoving=!0,this.map.disableMapNavigation());var i=r.MatrixUtils.translate(this.graphic.geometry,this.map,e,t);if(this._transform=i.transform,this._modified=!0,this.graphic.setGeometry(i.geometry),this._textAnchor&&this._textAnchor.setGeometry(new esri.geometry.Point(this.graphic.geometry.toJson())),this.owner.refresh(),this.owner.onGraphicMove(this.graphic,i.transform),this.graphic.geometry instanceof esri.geometry.Point){var n=this.graphic.geometry.offset(0,0),a={sender:this,mapPoint:n,screenPoint:this.map.toScreen(n)};this._raiseEditVertexMoved(a)}},t.prototype._raiseEditVertexMoved=function(e){this.owner&&this.owner.app&&this.owner.app.event("EditVertexMovedEvent").publish(e)},t}(i.EditCapabilityBase);t.GraphicMover=n})},"geocortex/infrastructure/accessibility/VertexInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/VertexEditorOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/SnappingFeedbackEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();t.SnappingFeedbackEventArgs=i})},"geocortex/infrastructure/accessibility/VertexEditor":function(){define(["require","exports","geocortex/infrastructure/accessibility/EditCapabilityBase","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/MatrixUtils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i,r,n){var a=e.call(this,t,i,r)||this;return a._keyDownHandle=null,a._keyUpHandle=null,a._keyDx=0,a._keyDy=0,
a._transform=null,a._isMoving=!1,a._isActive=!1,a._vertexControls=null,a._midpointControls=null,a._allControls=null,a._selectedControl=null,a._vertexHandleGraphic=null,a._options={offsetX:10,offsetY:10,preciseOffsetX:1,preciseOffsetY:1,allowAddVertices:!0,allowDeleteVertices:!0},a._snappingInputMovedToken=null,a._options=dojo.mixin(a._options,n||{}),a._init(),a.owner&&a.owner.app&&(a._snappingInputMovedToken=a.owner.app.event("SnappingFeedbackEvent").subscribe(a,a._handleSnappingInputMovedEvent)),a}return __extends(t,e),t.create=function(e,t,i,r){var n="This method is obsolete. Call createVertexEditor in VertexEditorFactory instead.";throw console.log(n),new Error(n)},t.prototype._handleSnappingInputMovedEvent=function(e){e&&e.snappingPoint&&this.graphic&&this.getSelectedVertex()&&this._vertexHandleGraphic&&this._vertexHandleGraphic.visible&&(this._updateGraphicVertex(e.snappingPoint,this.getSelectedVertex().segmentIndex,this.getSelectedVertex().pointIndex),this.owner.refresh())},t.prototype.isActive=function(){return this._isActive},t.prototype.hideVertexHandle=function(){this._vertexHandleGraphic&&(this._vertexHandleGraphic.hide(),this.owner&&this.owner.app&&this.owner.app.event("VertexHandleHiddenEvent").publish())},t.prototype.showVertexHandle=function(){if(this._selectedControl){var e=this._selectedControl.point.offset(0,0);this._vertexHandleGraphic?(this._vertexHandleGraphic.setGeometry(e).setSymbol(this._options.selectedVertexSymbol),this._vertexHandleGraphic.show()):this._vertexHandleGraphic=this.map.graphics.add(new esri.Graphic(e,this._options.selectedVertexSymbol)),this.owner&&this.owner.app&&this.owner.app.event("VertexHandleShownEvent").publish(e);var t=this._vertexHandleGraphic.getDojoShape();t&&t.moveToFront()}},t.prototype.destroy=function(){this._cleanUp(),e.prototype.destroy.call(this)},t.prototype.refresh=function(e){void 0===e&&(e=!1),this._transform=null,e?(this._removeControllers(),this._addControllers()):this._refreshControllers()},t.prototype.getSelectedVertex=function(){return this._selectedControl},t.prototype.onVertexAdd=function(e){if(e&&e.segmentIndex===this._selectedControl.segmentIndex){var t=null,i=this._selectedControl.segmentIndex,r=this._selectedControl.pointIndex;this._selectedControl.isGhost?(t=this._midpointControls,e.pointIndex<r+1?r+=1:e.pointIndex===r+1&&(r=e.pointIndex,t=this._vertexControls)):(t=this._vertexControls,r+=e.pointIndex<=r?1:0),this._selectedControl=t[i][r]}},t.prototype.onVertexDelete=function(e){if(e&&e.segmentIndex===this._selectedControl.segmentIndex){var t=null,i=this._selectedControl.segmentIndex,r=this._selectedControl.pointIndex;this._selectedControl.isGhost?(t=this._midpointControls,r-=e.pointIndex<=r?1:0):(t=this._vertexControls,r-=e.pointIndex<=r&&r>0?1:0),this._selectedControl=t[i][r]}},t.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler"))},t.prototype._cleanUp=function(){this._isMoving=this._isActive=!1,this._transform=null,this._selectedControl=null,this._removeControllers(),this._vertexHandleGraphic&&(this.map.graphics.remove(this._vertexHandleGraphic),this._vertexHandleGraphic=null),this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null),this.owner.app&&this.owner.app&&this._snappingInputMovedToken&&this.owner.app.event("SnappingFeedbackEvent").unsubscribe(this._snappingInputMovedToken)},t.prototype._getSegments=function(e){throw new Error("This method is abstract")},t.prototype._getMidpointSegments=function(e){throw new Error("This method is abstract")},t.prototype._updatePoints=function(e){throw new Error("This method is abstract")},t.prototype._insertGraphicVertex=function(e,t,i){throw new Error("This method is abstract")},t.prototype._updateGraphicVertex=function(e,t,i){throw new Error("This method is abstract")},t.prototype._deleteGraphicVertex=function(e,t){throw new Error("This method is abstract")},t.prototype._findVertex=function(e,t){for(var i=t?t.length:0,n=0;n<i;n++)for(var a=t[n],o=0;o<a.length;o++){var s=a[o];if(s&&r.pointsAreEqual(s.point,e))return s}return null},t.prototype._addControllers=function(){var e=this;this._vertexControls=this._add(this._getSegments(this.graphic.geometry)),this._options.allowAddVertices&&(this._midpointControls=this._add(this._getMidpointSegments(this.graphic.geometry),!0)),this._allControls=[],this._vertexControls.forEach(function(t,i){t.forEach(function(t,r){e._allControls.push(t),e._midpointControls&&e._midpointControls[i]&&r<e._midpointControls[i].length&&e._allControls.push(e._midpointControls[i][r])})})},t.prototype._removeControllers=function(){this._remove(this._vertexControls),this._remove(this._midpointControls),this._vertexControls=this._midpointControls=this._allControls=null},t.prototype._refreshControllers=function(){this._refresh(this._vertexControls,this._getSegments(this.graphic.geometry)),this._options.allowAddVertices&&this._refresh(this._midpointControls,this._getMidpointSegments(this.graphic.geometry),!0)},t.prototype._add=function(e,t){void 0===t&&(t=!1);for(var i=[],r=0;r<e.length;r++){for(var n=e[r],a=[],o=0;o<n.length;o++)a.push({isGhost:t,segmentIndex:r,pointIndex:o,point:n[o]});i.push(a)}return i},t.prototype._remove=function(e){e&&(e.forEach(function(e){e.length=0}),e.length=0)},t.prototype._refresh=function(e,t,i){void 0===i&&(i=!1),e&&t&&e.forEach(function(e,i){e.forEach(function(e,r){e.point=t[i][r]})})},t.prototype._previous=function(){var e=this._allControls.indexOf(this._selectedControl);this._selectedControl=0==e?this._allControls[this._allControls.length-1]:this._allControls[e-1],this.showVertexHandle(),this._refreshControllers()},t.prototype._next=function(){var e=this._allControls.indexOf(this._selectedControl);this._selectedControl=this._allControls[(e+1)%this._allControls.length],this.showVertexHandle(),this._refreshControllers()},t.prototype._onKeyDownHandler=function(e){if(!this.suspended)if(this._isActive)this._onKeyDownWhenActive(e);else{var t=e.keyCode||e.which;86===t&&(e.preventDefault(),e.stopImmediatePropagation(),this._isActive=!0,this.owner.suspend(),this.resume(),this._addControllers(),this._selectedControl=this._vertexControls[0][0],this.showVertexHandle())}},t.prototype._onKeyDownWhenActive=function(e){var t=e.altKey,i=t?this._options.preciseOffsetX:this._options.offsetX,r=t?this._options.preciseOffsetY:this._options.offsetY,n=e.keyCode||e.which;switch(n){case 86:return e.preventDefault(),e.stopImmediatePropagation(),void(e.shiftKey?this._previous():this._next());case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:return e.preventDefault(),e.stopImmediatePropagation(),this.owner.resume(),this._isActive=this._isMoving=!1,this._selectedControl=null,void(this._vertexHandleGraphic&&(this.hideVertexHandle(),this.map.graphics.remove(this._vertexHandleGraphic),this._vertexHandleGraphic=null));case 68:return void(this._options.allowDeleteVertices&&(this._delete(this.getSelectedVertex()),e.preventDefault(),e.stopImmediatePropagation()));case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:this._keyDy-=r;break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:this._keyDx+=i;break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:this._keyDy+=r;break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:this._keyDx-=i;break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:this._keyDx+=i,this._keyDy-=r;break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:this._keyDx+=i,this._keyDy+=r;break;case dojo.keys.END:case dojo.keys.NUMPAD_1:this._keyDx-=i,this._keyDy+=r;break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:this._keyDx-=i,this._keyDy-=r;break;default:return}e.preventDefault(),e.stopImmediatePropagation(),this._move(this.getSelectedVertex(),this._keyDx,this._keyDy),this._moveStop(this.getSelectedVertex(),this._keyDx,this._keyDy),this._keyDx=this._keyDy=0},t.prototype._move=function(e,t,i){var r={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex};this._isMoving||(this._isMoving=!0,this.owner.onVertexMoveStart(this.graphic,r),this.owner.onVertexFirstMove(this.graphic,r));var n=this.map.toScreen(e.point).offset(t,i);this._vertexHandleGraphic.setGeometry(this.map.toMap(n)),this.owner.onVertexMove(this.graphic,r,this._transform);var a={sender:this,mapPoint:this.map.toMap(n),screenPoint:n};this._raiseEditVertexMoved(a)},t.prototype._raiseEditVertexMoved=function(e){this.owner&&this.owner.app&&this.owner.app.event("EditVertexMovedEvent").publish(e)},t.prototype._moveStop=function(e,t,i){if(this._isMoving=!1,e&&e.point){var r={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex},a=n.MatrixUtils.translate(e.point,this.map,t,i);this._transform=a.transform,r.isGhost?(r.pointIndex+=1,this._insertGraphicVertex(a.geometry,r.segmentIndex,r.pointIndex)):this._updateGraphicVertex(a.geometry,r.segmentIndex,r.pointIndex),this.owner.refresh(),this.owner.onVertexMoveStop(this.graphic,r,this._transform),r.isGhost&&(r.isGhost=!1,this.owner.onVertexAdd(this.graphic,r))}},t.prototype._delete=function(e){if(e&&!e.isGhost){var t={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex};this._deleteGraphicVertex(e.segmentIndex,e.pointIndex),this.owner.refresh(),this.owner.onVertexDelete(this.graphic,t)}},t}(i.EditCapabilityBase);t.VertexEditor=a})},"geocortex/infrastructure/accessibility/BoxEditorOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/BoxEditor":function(){define(["require","exports","geocortex/infrastructure/accessibility/EditCapabilityBase","geocortex/infrastructure/GeometryUtils","geocortex/framework/utils/utils","geocortex/infrastructure/MatrixUtils"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i,r,n,a){var o=e.call(this,t,i,r)||this;o._options={rotateEnabled:!1,scaleEnabled:!1,uniformScaling:!1,rotationAngle:15,preciseRotationAngle:1,scaleFactor:.2,preciseScaleFactor:.01},o._scaleEnabled=!1,o._rotateEnabled=!1,o._uniformScaling=!1,o._isTextPoint=!1,o._modified=!1,o._isRotating=!1,o._isScaling=!1,o._lineSymbol=null,o._markerSymbol=null,o._transform=null,o._keyDownHandle=null,o._keyUpHandle=null,o._options=dojo.mixin(o._options,a||{});var s=r.getOptions();return o._markerSymbol=o._options.boxHandleSymbol?o._options.boxHandleSymbol:s.boxHandleSymbol,o._lineSymbol=o._options.boxLineSymbol?o._options.boxLineSymbol:s.boxLineSymbol,o._scaleEnabled=!!o._options.scaleEnabled,o._rotateEnabled=!!o._options.rotateEnabled,o._uniformScaling=!!o._options.uniformScaling,o._isTextPoint=n,o._init(),o}return __extends(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this._cleanUp()},t.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler")),this._keyUpHandle=dojo.on(this.map.root,"keyup",dojo.hitch(this,"_onKeyUpHandler"))},t.prototype._cleanUp=function(){this._scaleEnabled=this._rotateEnabled=this._uniformScaling=this._isTextPoint=!1,this._isRotating=this._isScaling=this._modified=!1,this._lineSymbol=this._markerSymbol=this._transform=null,this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null)},t.prototype._onKeyDownHandler=function(e){if(!this.suspended){var t=e.altKey,i=e.shiftKey,r=!1,n=t?this._options.preciseScaleFactor:this._options.scaleFactor,a=t?this._options.preciseRotationAngle:this._options.rotationAngle,o=e.keyCode||e.which;if(this._scaleEnabled)switch(o){case 83:n=i?n*-1:n,this._scaleGraphic(1+n,1+n),r=!0}if(this._rotateEnabled)switch(o){case 82:a=i?a*-1:a,this._rotateGraphic(a),r=!0}r&&(e.preventDefault(),e.stopPropagation())}},t.prototype._onKeyUpHandler=function(e){if(!this.suspended){var t=(e.altKey,e.keyCode||e.which),i=!1;if(this._scaleEnabled)switch(t){case 83:this._isScaling=!1,this.owner.onScaleStop(this.graphic,this._transform),i=!0}if(this._rotateEnabled)switch(t){case 82:this._isRotating=!1,this.owner.onRotateStop(this.graphic,this._transform),i=!0}i&&(e.preventDefault(),e.stopPropagation())}},t.prototype._rotateGraphic=function(e,t){this._isRotating||(this.owner.onRotateStart(this.graphic),this.owner.onRotateFirstMove(this.graphic),this._isRotating=!0);var i=this.graphic.geometry,o=t||r.getMiddle(i);if(r.isValidGeometry(i)&&!n.isNullOrUndefined(o)){var s=a.MatrixUtils.rotate(i,this.map,e,o);if(this._transform=s.transform,this._modified=!0,this._isTextPoint){var l=this.graphic.symbol;l.angle+=e,this.graphic.setSymbol(l)}else this.graphic.setGeometry(s.geometry);var c={transform:s.transform,angle:e,scaleX:1,scaleY:1,around:this.map.toScreen(o)};this.owner.refresh(),this.owner.onRotate(this.graphic,c)}},t.prototype._scaleGraphic=function(e,t){this._isScaling||(this.owner.onScaleStart(this.graphic),this.owner.onScaleFirstMove(this.graphic),this._isScaling=!0),null!==t&&"undefined"!=typeof t||(t=e);var i=this.graphic.geometry,r=a.MatrixUtils.scale(i,this.map,e,t);if(this._transform=r.transform,this._modified=!0,this._isTextPoint){var n=this.graphic.symbol;n.font.setSize(Math.round(100*n.font.size*e)/100),this.graphic.setSymbol(n)}else this.graphic.setGeometry(r.geometry);var o={transform:r.transform,angle:0,scaleX:e,scaleY:t,around:null};this.owner.refresh(),this.owner.onScale(this.graphic,o)},t}(i.EditCapabilityBase);t.BoxEditor=o})},"geocortex/infrastructure/eventArgs/GraphicEditActivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/tools/ToolConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/tools/ToolBase":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.name="",this.isActive=!1,dojo.mixin(this,t),this.app=e}return e.prototype.setActive=function(e){e?(this.isActive=!0,this.onActivated()):(this.isActive=!1,this.onDeactivated())},e.prototype.onActivated=function(){},e.prototype.onDeactivated=function(){},e}();t.ToolBase=i})},"geocortex/infrastructure/tools/MapToolConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/ToolInputMethodChangedEvent":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/tools/MapTool":function(){define(["require","exports","geocortex/infrastructure/tools/ToolBase","geocortex/infrastructure/accessibility/Draw"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._drawIsActive=!1,r._drawEndHandlerToken=null,r._inputMethodChangeHandle=null,r._mapMouseHoverToken=null,r._mapMouseDownToken=null,r._autoPanPixelTolerance=15,r._autoPanStep=1/3,r._unsupportedAutoPanDrawModes=["FREEHAND_POLYGON","FREEHAND_POLYLINE","POINT","MULTI_POINT"],r._drawEndSuspended=!1,r}return __extends(t,e),t.prototype._createDrawObject=function(){this._drawObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.draw",this.app.map),this._drawObject.setMarkerSymbol(new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.8]))),this._drawObject.setFillSymbol(new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.25]))),this._drawObject.setLineSymbol(new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2))},t.prototype._activateToolbar=function(){this._drawObject||this._createDrawObject(),this._drawEndHandlerToken||(this._drawEndHandlerToken=dojo.aspect.after(this._drawObject,"onDrawEnd",dojo.hitch(this,"onDrawEnd"),!0)),this._drawObject instanceof r.Draw&&(this._inputMethodChangeHandle=dojo.aspect.after(this._drawObject,"onInputMethodChange",dojo.hitch(this,"onInputMethodChange"),!0)),this._drawObject.activate(esri.toolbars.Draw[this.drawMode]),this._drawIsActive=!0,this._drawEndSuspended=!1},t.prototype._deactivateToolbar=function(){this._drawEndHandlerToken&&(this._drawEndHandlerToken.remove(),this._drawEndHandlerToken=null),this._inputMethodChangeHandle&&(this._inputMethodChangeHandle.remove(),this._inputMethodChangeHandle=null),this._drawObject&&this._drawIsActive&&(this._drawObject.deactivate(),this._drawIsActive=!1,this._drawEndSuspended=!1)},t.prototype.onActivated=function(){if(this._drawObject||this._createDrawObject(),this._drawIsActive&&this._deactivateToolbar(),"CURRENT_EXTENT"==this.drawMode)this.onDrawEnd(this.app.map.extent);else{if(!this.app.map.graphics)return;this.app.command("ShowMap").execute(),this._activateToolbar()}this._mapMouseDownToken=this.app.event("MapMouseDownEvent").subscribe(this,this.onMapMouseDown),this._mapMouseHoverToken=this.app.event("MapMouseHoverEvent").subscribe(this,this.onMapMouseHover)},t.prototype.onDeactivated=function(){this._mapMouseHoverToken&&(this.app.event("MapMouseHoverEvent").unsubscribe(this._mapMouseHoverToken),this._mapMouseHoverToken=null),this._mapMouseDownToken&&(this.app.event("MapMouseDownEvent").unsubscribe(this._mapMouseDownToken),this._mapMouseDownToken=null),this._deactivateToolbar(),this.app.command("ShowMap").execute()},t.prototype.onDrawEnd=function(e){var t=this;if(!this._drawEndSuspended){if(this.command){var i=this.app.command(this.command);i.canExecute(e)?(i.execute(e),this.app.command("LogOptimizerEvent").execute(this.name,this.command)):this.app.trace.warning("Could not invoke command '{0}' for tool '{1}'.".format(this.command,this.name))}this.isSticky?(this._drawEndSuspended=!0,setTimeout(function(){return t._drawEndSuspended=!1},100)):this.setActive(!1)}},t.prototype.onInputMethodChange=function(e){var t={tool:this,previousMethod:e?e.previousMethod:null,newMethod:e?e.newMethod:null};this.app.event("ToolInputMethodChangedEvent").publish(t)},t.prototype.onMapMouseDown=function(e){3===e.which&&this._drawObject&&(this.app.command("ClearActiveTool").execute(),this._deactivateToolbar(),this.app.command("RemoveStatus").execute())},t.prototype.onMapMouseHover=function(e){if(null!=this._drawObject&&this._drawIsActive&&!(this._unsupportedAutoPanDrawModes.indexOf(this.drawMode)>=0)&&e.hasOwnProperty("clientX")&&e.hasOwnProperty("clientY")){var t=$(this.app.map.root).offset();e.clientX<t.left+this._autoPanPixelTolerance?this.app.command("PanLeft").execute(this._autoPanStep):t.left+this.app.map.width-this._autoPanPixelTolerance<e.clientX?this.app.command("PanRight").execute(this._autoPanStep):e.clientY<t.top+this._autoPanPixelTolerance?this.app.command("PanUp").execute(this._autoPanStep):t.top+this.app.map.height-this._autoPanPixelTolerance<e.clientY&&this.app.command("PanDown").execute(this._autoPanStep)}},t}(i.ToolBase);t.MapTool=n,n.prototype.command=null,n.prototype.drawMode=null,n.prototype.isSticky=!1})},"geocortex/infrastructure/tools/DrawMode":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();i.POINT="POINT",i.MULTI_POINT="MULTI_POINT",i.LINE="LINE",i.POLYGON="POLYGON",i.FREEHAND_POLYGON="FREEHAND_POLYGON",i.POLYLINE="POLYLINE",i.FREEHAND_POLYLINE="FREEHAND_POLYLINE",i.RECTANGLE="RECTANGLE",i.TRIANGLE="TRIANGLE",i.CIRCLE="CIRCLE",i.ELLIPSE="ELLIPSE",i.ARROW="ARROW",i.LEFT_ARROW="LEFT_ARROW",i.RIGHT_ARROW="RIGHT_ARROW",i.UP_ARROW="UP_ARROW",i.DOWN_ARROW="DOWN_ARROW",i.EXTENT="EXTENT",t.DrawMode=i})},"geocortex/infrastructure/eventArgs/GraphicEditDeactivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/ImageProperties":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/DisplayNotificationArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/MultipointVertexEditor":function(){define(["require","exports","geocortex/infrastructure/accessibility/VertexEditor"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._getSegments=function(e){for(var t=0,i=[];t<e.points.length;t++)i.push(e.getPoint(t));return[i]},t.prototype._getMidpointSegments=function(e){return[]},t.prototype._insertGraphicVertex=function(e,t,i){},t.prototype._updateGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.setPoint(i,e.offset(0,0)),this.graphic.setGeometry(r)},t.prototype._deleteGraphicVertex=function(e,t){var i=this.graphic.geometry;i.removePoint(t),this.graphic.setGeometry(i)},t}(i.VertexEditor);t.MultipointVertexEditor=r})},"geocortex/infrastructure/accessibility/PolylineVertexEditor":function(){define(["require","exports","geocortex/infrastructure/accessibility/VertexEditor","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._getSegments=function(e){for(var t=[],i=0;i<e.paths.length;i++){for(var r=e.paths[i].length,n=[],a=0;a<r;a++)n.push(e.getPoint(i,a));t.push(n)}return t},t.prototype._getMidpointSegments=function(e){for(var t=[],i=0;i<e.paths.length;i++){for(var n=e.paths[i].length,a=[],o=0;o<n-1;o++){var s=e.getPoint(i,o),l=e.getPoint(i,o+1),c=r.getMidpoint(s,l);a.push(c)}t.push(a)}return t},t.prototype._insertGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.insertPoint(t,i,e.offset(0,0)),this.graphic.setGeometry(r)},t.prototype._updateGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.setPoint(t,i,e.offset(0,0)),this.graphic.setGeometry(r)},t.prototype._deleteGraphicVertex=function(e,t){var i=this.graphic.geometry;i.removePoint(e,t),this.graphic.setGeometry(i)},t}(i.VertexEditor);t.PolylineVertexEditor=n})},"geocortex/infrastructure/accessibility/PolygonVertexEditor":function(){define(["require","exports","geocortex/infrastructure/accessibility/VertexEditor","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._getSegments=function(e){for(var t=[],i=0;i<e.rings.length;i++){for(var r=e.rings[i].length,n=[],a=0;a<r-1;a++)n.push(e.getPoint(i,a));t.push(n)}return t},t.prototype._getMidpointSegments=function(e){for(var t=[],i=0;i<e.rings.length;i++){for(var n=e.rings[i].length,a=[],o=0;o<n-1;o++){var s=e.getPoint(i,o),l=e.getPoint(i,o+1),c=r.getMidpoint(s,l);a.push(c)}t.push(a)}return t},t.prototype._insertGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.insertPoint(t,i,e.offset(0,0)),this.graphic.setGeometry(r)},t.prototype._updateGraphicVertex=function(e,t,i){var r=this.graphic.geometry;if(r.setPoint(t,i,e.offset(0,0)),0===i){var n=r.rings[t];r.setPoint(t,n.length-1,e.offset(0,0))}this.graphic.setGeometry(r)},t.prototype._deleteGraphicVertex=function(e,t){var i=this.graphic.geometry;if(i.removePoint(e,t),0===t){var r=i.rings[e],n=i.getPoint(e,0);i.setPoint(e,r.length-1,n.offset(0,0))}this.graphic.setGeometry(i)},t}(i.VertexEditor);t.PolygonVertexEditor=n})},"geocortex/infrastructure/accessibility/VertexEditorFactory":function(){define(["require","exports","geocortex/infrastructure/accessibility/MultipointVertexEditor","geocortex/infrastructure/accessibility/PolylineVertexEditor","geocortex/infrastructure/accessibility/PolygonVertexEditor"],function(e,t,i,r,n){"use strict";function a(e,t,a,o){if(!e||!e.geometry)return null;switch(e.geometry.type){case"multipoint":return new i.MultipointVertexEditor(e,t,a,o);case"polyline":return new r.PolylineVertexEditor(e,t,a,o);case"polygon":return new n.PolygonVertexEditor(e,t,a,o)}return null}t.createVertexEditor=a})},"geocortex/infrastructure/eventArgs/GeometryChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/Table/TableColumnViewModelInterface":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();t.TableColumnViewModelInterface=i})},"geocortex/infrastructure/ui/components/Table/TableRowViewModelInterface":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/gis/DomainInfo":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e.create=function(t){var i=new e;return i.domain=t,i},e.prototype.isCodedValueDomain=function(){return this.domain&&"codedValue"==this.domain.type},e.prototype.getCodedValueDomain=function(){return this.domain},e.prototype.getName=function(e){if(this.isCodedValueDomain())for(var t=0;t<this.getCodedValueDomain().codedValues.length;t++){var i=this.getCodedValueDomain().codedValues[t];if(i.code+""==e+"")return i.name}return null},e}();t.DomainInfo=i})},"geocortex/infrastructure/TimeZoneUtils":function(){define(["require","exports","geocortex/framework/utils/ArrayUtils"],function(e,t,i){"use strict";function r(e){if(!e)return null;var t=null,r=null;return t=e.timeZoneId,e.mapService&&(r=n(e.mapService)),i.firstOrDefault([t,r],function(e){return!!e})}function n(e){if(!e)return null;var t=null,r=null;return t=e.timeZoneId,e.essentialsMap&&e.essentialsMap.site&&(r=e.essentialsMap.site.timeZoneId),i.firstOrDefault([t,r],function(e){return!!e})}function a(e){return e&&e.essentialsMap&&e.essentialsMap.site?e.essentialsMap.site.displayTimeZoneId:null}function o(e,i,r){if(null===e||void 0===e)return null;if(i||(i=t.UTC_ZONE_ID),!r)return s(e,i);var n=-e.getTimezoneOffset(),a=moment.tz(e.getTime(),r).utcOffset(),o=-(n-a),l=s(e,i);return moment(l).add(o,"minutes").toDate()}function s(e,t){if(null===e||void 0===e)return null;if(!t)return e;var i=moment.tz(e.getTime(),t).utcOffset(),r=-i;return moment(e).add(r,"minutes").toDate()}function l(e,i,r){if(null===e||void 0===e)return null;i||(i=t.UTC_ZONE_ID);var n=moment.tz(e.getTime(),i).utcOffset();if(!r)return moment(e).add(n,"minutes").toDate();var a=moment.tz(e.getTime(),r).utcOffset(),o=n-a,s=-e.getTimezoneOffset();return moment(e).add(s+o,"minutes").toDate()}function c(e,i,r){if(null===e||void 0===e)return null;i||(i=t.UTC_ZONE_ID);var n=moment.tz(e.getTime(),i).utcOffset();if(!r){var a=e.getTimezoneOffset();return moment(e).add(a+n,"minutes").toDate()}var o=moment.tz(e.getTime(),r).utcOffset(),s=n-o;return moment(e).add(s,"minutes").toDate()}t.UTC_ZONE_ID="Etc/UTC",t.getTimeZoneFromLayer=r,t.getTimeZoneFromMapService=n,t.getDisplayTimeZoneFromMapService=a,t.correctDatesForDisplayInDisplayTimeZone=o,t.correctDatesForDisplayInLocalTime=s,t.correctDatesToSubmitInDatabaseTime=l,t.correctDatesToQueryInDatabaseTime=c})},"geocortex/infrastructure/NumberFormat":function(){define(["require","exports"],function(e,t){"use strict";function i(e){return!isNaN(parseFloat(e))&&isFinite(e)}var r=function(){function e(){}return e}();r.NUMBER="n",r.FIXED_POINT="f",r.CURRENCY="c",r.ACCOUNTING="a",r.PERCENT="p",r.ROUND_TRIP="r",r.DEFAULT=r.FIXED_POINT,t.NumberFormat=r,t.isNumeric=i})},"geocortex/infrastructure/FormatUtils":function(){define(["require","exports","geocortex/infrastructure/TimeZoneUtils","geocortex/framework/index","geocortex/infrastructure/NumberFormat"],function(e,t,i,r,n){"use strict";function a(e){return e instanceof Date?o(e):"number"==typeof e?c(e):null===e||void 0===e?"":e.toString()}function o(e,t,i){void 0===t&&(t=g.DEFAULT);var r=null;if(!e||!e.getTime||isNaN(e.getTime()))return"";if(!moment)throw new Error('Error: The "moment.js" library is required for formatting dates.');var n=l(e,i);if(i){var a=moment(e.toISOString());i.displayTimeZoneId&&(r=a.tz(i.displayTimeZoneId).format("Z"))}return moment(n).format(m(t,r))}function s(e,t){if(!e||!e.getTime||isNaN(e.getTime()))return"";if(!moment)throw new Error('Error: The "moment.js" library is required for formatting dates.');var i=l(e,t);return moment(i).fromNow()}function l(e,t){return t&&(t.timeZoneId||t.displayTimeZoneId)?t.displayTimeZoneId?t.timeZoneId?i.correctDatesForDisplayInDisplayTimeZone(e,t.timeZoneId,t.displayTimeZoneId):i.correctDatesForDisplayInDisplayTimeZone(e,i.UTC_ZONE_ID,t.displayTimeZoneId):i.correctDatesForDisplayInLocalTime(e,t.timeZoneId):e}function c(e,t,i){if(void 0===t&&(t=y.DEFAULT),void 0===i&&(i={}),null===e||void 0===e||isNaN(e))return"";if(t=t||y.DEFAULT,i=i||{},t===y.ROUND_TRIP)return e.toString();if(!_globalize)throw new Error('Error: The "globalize.js" library is required for formatting numbers.');var r=t.toLowerCase();r===y.CURRENCY||r===y.ACCOUNTING?(t=r,t+=void 0!==i.fractionalDigits?i.fractionalDigits:"",t+=i.currency?"$"+i.currency.toUpperCase():""):r!==y.NUMBER&&r!==y.FIXED_POINT&&r!==y.PERCENT||(t=r,t+=void 0!==i.fractionalDigits?i.fractionalDigits:"");var n=_globalize.locale()?_globalize.locale().locale:"en",a=n+"|"+t,o=v[a];if(!o){o=[];var s=t.split(";",3);1===s.length?(o[0]=f(s[0]),o[1]=o[0],o[2]=o[0]):2===s.length?(o[0]=f(s[0]),o[1]=f(s[1]),o[2]=o[0]):3===s.length&&(o[0]=f(s[0]),o[1]=f(s[1]),o[2]=f(s[2])),v[a]=o}return e>0?o[0](e):e<0?o[1](e):o[2](e)}function u(e,t){return h(e,!1,t)}function d(e,t){return h(e,!0,t)}function p(e,t){if("number"==typeof e)return e;if("boolean"==typeof e)return e?1:0;if(null===e||void 0===e)return NaN;if(!_globalize)throw new Error('Error: The "globalize.js" library is required for parsing numbers.');e=e.toString().trim(),e=e.replace(" "," ");var i=_globalize.locale()?_globalize.locale().locale:"en",r=S[i];r||(r=_globalize.numberParser(),S[i]=r);var n=1;e&&"("===e[0]&&")"===e[e.length-1]&&(n=-1,e=e.slice(1,-1));var a=r(e);if(isNaN(a)&&(a=parseFloat(e)),isNaN(a))return a;a*=n;var o=[].concat(t||[]),s=/^([acfnp])(?:\$([a-zA-Z]{3}))?$/i,l=!o.length||o.some(function(t){var i=f(t,{minimumFractionDigits:0,maximumFractionDigits:20});if(e===i(a))return!0;if(t.match(s))for(var r=0;r<=20;r++){var i=f(t,{minimumFractionDigits:r,maximumFractionDigits:r});if(e===i(a))return!0}return!1});return l?a:NaN}function h(e,t,i){if(e instanceof Date)return e;if("number"==typeof e)return new Date(e);if(!e||"string"!=typeof e)return b;if((void 0===i||null===i)&&n.isNumeric(e))return new Date(parseFloat(e));if(!moment)throw new Error('Error: The "moment.js" library is required for parsing dates.');i=i||g.DEFAULT_PARSING_FORMATS;var r=[].concat(i);r=r.map(function(e){var t=m(e);return void 0===t?moment.ISO_8601:t});var a;return a=t?moment.utc(e,r):moment(e,r),a.isValid()?a.toDate():b}function m(e,t){e=e||g.DEFAULT;var i=e+(t?t:"");switch(e){case g.DATE_SHORT:return"L";case g.DATE_LONG:return"LL";case g.TIME_SHORT:return"LT";case g.TIME_LONG:return"LTS";case g.DATE_TIME_SHORT:return"lll";case g.DATE_TIME_LONG:return"LLL";case g.FULL:return"LLLL";case g.ISO_8601:return;default:var r=_[i];if(r)return r;var n=/%?([dfFghHKmMstyz])\1*|\\.|(["'])[^\2]+\2|[^dfFghHKmMstyz\\'"]+/g,a=e.match(n);r="";for(var o=0;o<a.length;o++){var s=a[o];switch(s.startsWith("%")&&(s=s.slice(1)),s[0]){case"y":r+=s.length<=2?"YY":s.length<=4?"YYYY":"YYYYY";break;case"d":r+=s.length<=2?s.slice(0,2).toUpperCase():s.slice(0,4);break;case"f":case"F":r+=s.slice(0,3).replace(/[Ff]/g,"S");break;case"t":r+="A";break;case"z":r+=t?"["+t+"]":"Z";break;case"M":r+=s.slice(0,4);break;case"h":case"H":case"m":case"s":r+=s.slice(0,2);break;case"g":case"K":console.warn('The "{0}" date format specifier is not supported.'.format(s));break;default:s.startsWith('"')||s.startsWith("'")?s=s.slice(1,-1):s.startsWith("\\")&&(s=s.slice(1)),r+="["+s+"]"}}return _[i]=r,r}}function f(e,t){var i=t||{},n=/^([acfnp])(\d*)(?:\$([a-zA-Z]{3}))?$/i,a=e.match(n);if(a){var o=a[1].toLowerCase(),s=Math.min(20,parseInt(a[2])),l=a[3];if(o===y.CURRENCY||o===y.ACCOUNTING){if(!l){var c=r.applications[0];l=c&&c.configuration&&c.configuration.defaultCurrency?c.configuration.defaultCurrency:"USD"}}else l="",void 0===i.minimumFractionDigits&&(i.minimumFractionDigits=0),void 0===i.maximumFractionDigits&&(i.maximumFractionDigits=Math.max(4,i.minimumFractionDigits));
return o===y.PERCENT?i.style="percent":o===y.ACCOUNTING?i.style="accounting":o===y.FIXED_POINT&&(i.useGrouping=!1),isNaN(s)||(i.minimumFractionDigits=s,i.maximumFractionDigits=s),l?_globalize.currencyFormatter(l,i):_globalize.numberFormatter(i)}var u=/[0#]+|\.|,|%|\\.|(["'])[^\1]+\1|[^0#.,\\'"]+/g,a=e.match(u),d=!1,p="",h="",m="",f="";i.minimumFractionDigits=0,i.maximumFractionDigits=0,i.useGrouping=!1;for(var g=0;g<a.length;g++){var b=a[g];switch(b[0]){case".":d=!0;break;case",":i.useGrouping=!0;break;case"%":i.style="percent";break;case"0":case"#":d?h+=b:p+=b;break;default:b.startsWith('"')||b.startsWith("'")?b=b.slice(1,-1):b.startsWith("\\")&&(b=b.slice(1)),p||h?f+=b:m+=b}}if(p){var v=p.indexOf("0");v>=0&&(i.minimumIntegerDigits=p.length-v)}if(h){var S=h.lastIndexOf("0");S>=0?i.minimumFractionDigits=S+1:i.minimumFractionDigits=0,i.maximumFractionDigits=Math.min(20,h.length)}if(p||h){var _=_globalize.numberFormatter(i);return function(e){return void 0!==i.minimumIntegerDigits&&e<0?m+"-"+_(e*-1)+f:m+_(e)+f}}return function(e){return m+f}}var g=function(){function e(){}return e}();g.DATE_SHORT="d",g.DATE_LONG="D",g.TIME_SHORT="t",g.TIME_LONG="T",g.DATE_TIME_SHORT="g",g.DATE_TIME_LONG="G",g.FULL="f",g.ISO_8601="u",g.ROUND_TRIP="u",g.DEFAULT="g",g.DEFAULT_PARSING_FORMATS=[g.ISO_8601,g.DATE_TIME_SHORT,g.DATE_TIME_LONG,g.DATE_SHORT,g.DATE_LONG],t.DateFormat=g;var y=function(){function e(){}return e}();y.NUMBER="n",y.FIXED_POINT="f",y.CURRENCY="c",y.ACCOUNTING="a",y.PERCENT="p",y.ROUND_TRIP="r",y.DEFAULT=y.FIXED_POINT,t.NumberFormat=y;var b=new Date(NaN);t.format=a,t.formatDate=o,t.formatDateFromNow=s,t.formatNumber=c,t.parseDate=u,t.parseUtcDate=d,t.parseNumber=p;var v={},S={},_={}})},"geocortex/infrastructure/gis/FieldInfo":function(){define(["require","exports","geocortex/infrastructure/gis/DomainInfo","geocortex/essentials/Field","geocortex/infrastructure/TimeZoneUtils","geocortex/infrastructure/FormatUtils"],function(e,t,i,r,n,a){"use strict";var o=function(){function e(){this.subtypeDomains={},this.subtypeDomainInfos={},this.isVisible=!0}return e.fromEsriField=function(t,r,a){var o=new e;if(o.name=t.name,o.type=t.type,o.alias=a?a.displayName||t.alias:t.alias,o.isVisible=!a||a.visible,o.searchable=!a||a.searchable,o.editable=t.editable,o.nullable=t.nullable,o.length=t.length,o.esriField=t,o.isTypeField=r&&r.typeIdField===t.name,r){if(o.isTypeField&&!t.domain){var s=new esri.layers.CodedValueDomain;s.codedValues=[],s.type="codedValue",r.types.forEach(function(e){s.codedValues.push({name:e.name,code:e.id})}),o.domainInfo=i.DomainInfo.create(s),o.domain=s}else o.domainInfo=i.DomainInfo.create(t.domain),o.domain=t.domain;r.types&&r.types.forEach(function(e){for(var r in e.domains)if(e.domains.hasOwnProperty(r)&&r===t.name&&null!==e.id){var n=e.domains[r];o.subtypeDomains[e.id.toString()]=n,o.subtypeDomainInfos[e.id.toString()]=i.DomainInfo.create(n);break}})}if(a){if(o.format=a.format,!o.format)if(o._isNumericFormat()){var l=[a.layer.defaultNumberFormat,a.layer.mapService.defaultNumberFormat].filter(function(e){return!!e})[0];l&&(o.format="{0:"+l+"}")}else if(o.isDate()){var c=[a.layer.defaultDateFormat,a.layer.mapService.defaultDateFormat].filter(function(e){return!!e})[0];c&&(o.format="{0:"+c+"}")}o.timeZoneId||(o.timeZoneId=n.getTimeZoneFromLayer(a.layer)),o.displayTimeZoneId||(o.displayTimeZoneId=n.getDisplayTimeZoneFromMapService(a.layer.mapService))}return o},e.fromGcxField=function(t){var i=new esri.layers.Field;new e;return i.name=t.name,i.type=r.Field.convertToEsriFieldType(t.dataType),i.alias=t.displayName,i.editable=!1,i.nullable=!0,e.fromEsriField(i,null,t)},e.prototype.isNumeric=function(){var e=[r.EsriFieldTypes.esriFieldTypeOID,r.EsriFieldTypes.esriFieldTypeSmallInteger,r.EsriFieldTypes.esriFieldTypeInteger,r.EsriFieldTypes.esriFieldTypeSingle,r.EsriFieldTypes.esriFieldTypeDouble];return dojo.indexOf(e,this.type)>=0},e.prototype.isDate=function(){var e=[r.EsriFieldTypes.esriFieldTypeDate];return dojo.indexOf(e,this.type)>=0},e.prototype.isText=function(){var e=[r.EsriFieldTypes.esriFieldTypeString];return dojo.indexOf(e,this.type)>=0},e.prototype.isCodedValueDomain=function(){return this.domainInfo&&this.domainInfo.isCodedValueDomain()},e.prototype.hasSubtypeCodedValueDomains=function(){for(var e in this.subtypeDomainInfos)if(this.subtypeDomainInfos.hasOwnProperty(e)&&this.subtypeDomainInfos[e].isCodedValueDomain())return!0;return!1},e.prototype.getCodedValueDomain=function(){return this.domain},e.prototype.getSubtypeCodedValueDomains=function(){var e={};for(var t in this.subtypeDomainInfos)this.subtypeDomainInfos.hasOwnProperty(t)&&this.subtypeDomainInfos[t].isCodedValueDomain()&&(e[t]=this.subtypeDomainInfos[t].domain);return e},e.prototype.resolveCodedDomainValue=function(e,t){var i=null;if(this.domainInfo&&(i=this.domainInfo.getName(e)),null==i){var r=this.subtypeDomainInfos[t];r&&(i=r.getName(e))}return i},e.prototype.formatValue=function(e,t){var i=this;if(this.isCodedValueDomain()||this.hasSubtypeCodedValueDomains()){var r=this.resolveCodedDomainValue(e,t);if(null!=r)return r}if(this.format)return this.format.replace(/\{0(?::([^}]*))?\}/,function(t,r){if(i.isDate()){var n={timeZoneId:i.timeZoneId,displayTimeZoneId:i.displayTimeZoneId};return a.formatDate(a.parseDate(e),r,n)}return i._isNumericFormat()?a.formatNumber(a.parseNumber(e),r):null===e||void 0===e?e:e.toString()});if(this.isDate()){var n={timeZoneId:this.timeZoneId,displayTimeZoneId:this.displayTimeZoneId};return a.formatDate(a.parseDate(e),null,n)}return this._isNumericFormat()?a.formatNumber(a.parseNumber(e)):null===e||void 0===e?e:e.toString()},e.prototype._isNumericFormat=function(){return this.isNumeric()&&this.type!==r.EsriFieldTypes.esriFieldTypeOID&&(!this.name||"OBJECTID"!==this.name.toUpperCase())},e}();t.FieldInfo=o})},"geocortex/infrastructure/DateFormat":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();i.DATE_SHORT="d",i.DATE_LONG="D",i.TIME_SHORT="t",i.TIME_LONG="T",i.DATE_TIME_SHORT="g",i.DATE_TIME_LONG="G",i.FULL="f",i.ISO_8601="u",i.ROUND_TRIP="u",i.DEFAULT="g",i.DEFAULT_PARSING_FORMATS=[i.ISO_8601,i.DATE_TIME_SHORT,i.DATE_TIME_LONG,i.DATE_SHORT,i.DATE_LONG],t.DateFormat=i})},"geocortex/infrastructure/PresentableDelegateFactory":function(){define(["require","exports","geocortex/essentials/Field","geocortex/infrastructure/gis/FieldInfo","geocortex/infrastructure/DateFormat","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat","geocortex/framework/utils/utils"],function(e,t,i,r,n,a,o,s){"use strict";var l=function(){function e(){}return e.typeIdForLayerAndAttributes=function(e,t){return e.typeIdField?t[e.typeIdField]:null},e.typeFromLayerAndId=function(e,t){for(var i=0;i<e.types.length;i++)if(e.types[i].id==t)return e.types[i];return null},e.makeValueTruthy=function(e){return 0===e?"0":e===!1?"false":e},e.valuePresenterDelegate=function(t,l){var c,u;return"string"==typeof t?(u=t,l&&l.layer&&(c=l.layer.fields.filter(function(e){return e.name===u})[0])):t instanceof i.Field?(c=t,u=c.name):t&&t.name&&(u=t.name),function(i){return function(){var d,p=l?l.featureLayer:null,h=l?l.getType():null,m=p?p.getField(u):null;if(t instanceof r.FieldInfo&&(d=t),!(m||c||d)){if(i instanceof Date){var f=l?l.defaultDateFormat:n.DateFormat.DEFAULT;return a.formatDate(i,f)}if("number"==typeof i){var g=l?l.defaultNumberFormat:o.NumberFormat.DEFAULT;return a.formatNumber(i,g)}return e.makeValueTruthy(i)}if(c&&c.hyperlinkLabel&&s.isUrl(i)&&(i=c.hyperlinkLabel),l){var y=l.esriFeature.get();if(y&&y.attributes.hasOwnProperty(u+".Name()"))return e.makeValueTruthy(y.attributes[u+".Name()"])}return d||(d=m?r.FieldInfo.fromEsriField(m,p,c):r.FieldInfo.fromGcxField(c)),d.isDate()&&!d.format&&l&&l.defaultDateFormat?d.format="{0:"+l.defaultDateFormat+"}":d.isNumeric()&&!d.format&&l&&l.defaultNumberFormat&&(d.format="{0:"+l.defaultNumberFormat+"}"),d.formatValue(i,h?h.id.toString():null)}}},e}();t.PresentableDelegateFactory=l})},"geocortex/infrastructure/FeatureAttribute":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework-ui/LazyObservable","geocortex/infrastructure/PresentableDelegateFactory","geocortex/framework/utils/utils"],function(e,t,i,r,n,a){"use strict";var o=function(){function e(e,t,o,s,l,c,u){this.value=new i.Observable("undefined"==typeof e?"":e),this.name=new i.Observable("undefined"==typeof t?"":t),this.alias=new i.Observable("undefined"==typeof o?this.name.get():o),this.displayName=new i.Observable("undefined"==typeof s?this.alias.get()?this.alias.get():this.name.get():s),this.visible=new i.Observable("undefined"==typeof l||l),this.type=new i.Observable("undefined"==typeof u?"":u),c=c||n.PresentableDelegateFactory.valuePresenterDelegate(null,null),this.presentableValue=new r.LazyObservable(null,c(e),(!0)),this.displayAsUrl=a.isUrl(e)}return e.ignoreAttribute=function(t){return t&&e.ignoreAttributeMatcher.test(t)},e}();o.ignoreAttributeMatcher=/.*\.Name\(\)$/,t.FeatureAttribute=o})},"geocortex/infrastructure/Dictionary":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t,i){for(var n=new r,a=0,o=e;a<o.length;a++){var s=o[a];n.set(t(s),i(s))}return n}var r=function(){function e(){this._backingStore={}}return e.prototype.containsKey=function(e){return this._backingStore.hasOwnProperty(e)},e.prototype.get=function(e){return this._backingStore[e]},e.prototype.set=function(e,t){this._backingStore[e]=t},e.prototype.remove=function(e){return!!this.containsKey(e)&&(delete this._backingStore[e],!0)},e.prototype.clear=function(){this._backingStore={}},e.prototype.values=function(){var e=[];for(var t in this._backingStore)this._backingStore.hasOwnProperty(t)&&e.push(this._backingStore[t]);return e},e.prototype.keys=function(){var e=[];for(var t in this._backingStore)this._backingStore.hasOwnProperty(t)&&e.push(t+"");return e},e}();t.Dictionary=r,t.toDictionary=i})},"geocortex/infrastructure/TaskUtils":function(){define(["require","exports","geocortex/essentials/Layer","geocortex/essentials/MapServiceConstants","geocortex/essentials/FeatureLayerService","geocortex/essentials/RestHelperHTTPService","geocortex/essentials/Field","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/FormatUtils"],function(e,t,i,r,n,a,o,s,l){"use strict";function c(e,t){var r,n=null,a=null;if(e instanceof i.Layer?(n=e,r=n.mapService,t&&(a=t.serviceLayer)):e instanceof esri.layers.Layer&&(a=e,t&&(r=t)),a instanceof esri.layers.FeatureLayer&&"table"===a.type||a instanceof esri.layers.FeatureLayer&&!r)return a.url;if(!b(r))return null;var o=null;if(a instanceof esri.layers.WMSLayer||a instanceof esri.layers.WFSLayer){if(!n)return null;o=n.url}else n?o=n.mapService.serviceLayer.url:a&&(o=a.url);var s,l=null;if(n?n.isDynamic?(s="dynamicLayer",l=p(a,n)):s=n.id:a&&(s=a.id),!(a instanceof esri.layers.FeatureLayer||o.match(/\/\d+(\?.*)?$/))){var c=o.indexOf("?"),u=o.indexOf("#");c!=-1?o=o.substring(0,c)+"/"+s+o.substring(c):u!=-1?o=o.substring(0,u)+"/"+s+o.substring(u):o+="/"+s}return o=f(o,t),l&&(o+=o.indexOf("?")>-1?"&layer=":"?layer=",o+=encodeURIComponent(JSON.stringify(l))),o}function u(e,t){var r=null,n=null,a=null,o=null;if(e instanceof esri.layers.Layer)n=e,t&&(a=t);else{if(!(e instanceof i.Layer&&e.mapService&&e.mapService.serviceLayer))throw new Error("Cannot generate a QueryTask from the given parameters.");n=e.mapService.serviceLayer,a=e.mapService,o=e}if(n){var s=d(n);s&&(r={gdbVersion:s})}return new esri.tasks.QueryTask(c(o?o:n,a),r)}function d(e){var t=null;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer){var i=e;i.gdbVersion&&(t=i.gdbVersion)}else if(e instanceof esri.layers.FeatureLayer){var i=e;i.gdbVersion&&(t=i.gdbVersion)}return t}function p(e,t){var i=null,r=t.mapService.getDynamicLayerInfoById(t.id);if(r&&r.source&&(r.source instanceof esri.layers.LayerDataSource||r.source instanceof esri.layers.LayerMapSource)){i=new S,i.source=r.source.toJson(),r.id&&(i.id=r.id);var n=t.getDefinitionExpression(t.mapService.serviceLayer);return n&&(i.definitionExpression=n),i}throw new Error("A dynamic layer must have a DataSource!")}function h(e){if(!e||!e.serviceUrl)return null;if(e.mapServiceType===r.MapServiceType.WMS||e.mapServiceType===r.MapServiceType.WFS){for(var t=0;t<e.layers.length;t++)if(g(e.layers[t]))return f(e.url,e);return null}if(!b(e))return null;if(e instanceof n.FeatureLayerService){var i=e.serviceUrl.substring(0,e.serviceUrl.lastIndexOf("/")),a=i.replace(/FeatureServer$/i,"MapServer");return a}return e.mapServiceType==r.MapServiceType.DYNAMIC||e.mapServiceType==r.MapServiceType.TILED?f(e.serviceUrl,e):null}function m(e){var t=null;if(e.serviceLayer){var i=d(e.serviceLayer);i&&(t={gdbVersion:i})}return new esri.tasks.IdentifyTask(h(e),t)}function f(e,t){if(!e)return null;if(!t)return e;if(t.mapServiceType===r.MapServiceType.WMS||t.mapServiceType===r.MapServiceType.WFS){var i=a.RestHelperHTTPService.getTokenForScope(t.url);i&&(e=a.RestHelperHTTPService.appendTokenToUrl(e,i))}else t.serviceToken&&!/.*token=.*/.test(e)&&(e=a.RestHelperHTTPService.appendTokenToUrl(e,t.serviceToken));return e}function g(e){return!!e&&!(!e.identifiable||!e.supportsIdentify)}function y(e){return!!e&&!(!e.queryable||!e.supportsQuery)}function b(e){if(!e||!e.serviceLayer)return!1;if(e.mapServiceType===r.MapServiceType.WMS||e.mapServiceType===r.MapServiceType.WFS){for(var t=0;t<e.layers.length;t++)if(y(e.layers[t]))return!0;return!1}var i=e.serviceLayer;return!!i.capabilities&&(i.version<10||i.capabilities&&i.capabilities.indexOf("Query")>=0)}function v(e,t,i,r){var n=new _(i);if(!e||!t||0==t.length||!n.searchText)return"";for(var a="",s=0;s<t.length;s++){var l=t[s];if(l.searchable&&"gml:id"!==l.name)if(l.isCodedValueDomain()||l.hasSubtypeCodedValueDomains()){var c=[],u=l.getCodedValueDomain();u&&u.codedValues.forEach(function(e){return c.push(e)});var d=l.getSubtypeCodedValueDomains();for(var p in d)d.hasOwnProperty(p)&&d[p].codedValues.forEach(function(e){return c.push(e)});c.forEach(function(e){e.name.toLowerCase().indexOf(n.searchTextLower)>-1&&(a.length>0&&(a+=" OR "),a+=l.type===o.EsriFieldTypes.esriFieldTypeString?encodeURI(l.name)+" = '"+e.code.replace("'","''")+"'":encodeURI(l.name)+" = "+e.code)})}else switch(l.type){case o.EsriFieldTypes.esriFieldTypeString:a.length>0&&(a+=" OR "),a+=e.mapService.serviceLayer instanceof esri.layers.WMSLayer||e.mapService.serviceLayer instanceof esri.layers.WFSLayer?encodeURI(l.name)+" LIKE '%"+n.searchTextQuotesFixed+"%'":"LOWER("+l.name+") LIKE '%"+n.searchTextLowerQuotesFixed+"%'";break;case o.EsriFieldTypes.esriFieldTypeSmallInteger:case o.EsriFieldTypes.esriFieldTypeInteger:case o.EsriFieldTypes.esriFieldTypeOID:case o.EsriFieldTypes.esriFieldTypeSingle:case o.EsriFieldTypes.esriFieldTypeDouble:if(isNaN(n.searchNum))break;a.length>0&&(a+=" OR "),a+="("+encodeURI(l.name.toLowerCase())+" <= "+n.searchUpperBound+" AND "+encodeURI(l.name.toLowerCase())+" >= "+n.searchLowerBound+")";break;case o.EsriFieldTypes.esriFieldTypeDate:break;case o.EsriFieldTypes.esriFieldTypeGlobalID:case o.EsriFieldTypes.esriFieldTypeBlob:break;default:r&&r.warning("Unhandled layer data type: '{0}'. Field '{1}' in layer '{2}' has been excluded from search.".format(l.type,l.alias,e.displayName))}}var h=e.getDefinitionExpression(e.mapService.serviceLayer);return h&&(a="("+a+") AND ("+h+")"),a}var S=function(){function e(){}return e}(),_=function(){function e(e){this.searchText=e?(e+"").trim():"",this.searchTextLower=this.searchText.toLowerCase(),this.searchTextQuotesFixed=this.searchText.replace("'","''"),this.searchTextLowerQuotesFixed=this.searchTextLower.replace("'","''");var t=[s.NumberFormat.ACCOUNTING,s.NumberFormat.CURRENCY,s.NumberFormat.FIXED_POINT,s.NumberFormat.NUMBER,s.NumberFormat.PERCENT,s.NumberFormat.ROUND_TRIP];this.searchNum=l.parseNumber(this.searchText,t);var i;if(!isNaN(this.searchNum)){i=l.formatNumber(this.searchNum,s.NumberFormat.ROUND_TRIP);var r;if(i.indexOf(".")){var n=i.length-i.indexOf(".")-1;r=Math.pow(10,-n)}else r=1;this.searchNum<0?(this.searchLowerBound=l.formatNumber(this.searchNum-r,s.NumberFormat.ROUND_TRIP),this.searchUpperBound=i):(this.searchLowerBound=i,this.searchUpperBound=l.formatNumber(this.searchNum+r,s.NumberFormat.ROUND_TRIP))}}return e}();t.getQueryTaskUrl=c,t.getQueryTask=u,t.getIdentifyTaskUrl=h,t.getIdentifyTask=m,t.getTokenizedUrl=f,t.canIdentifyLayer=g,t.canQueryLayer=y,t.canQueryMapService=b,t.getSearchTextWhereClause=v})},"geocortex/infrastructure/commandArgs/ProjectArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i,r,n){this.geometries=e,this.outputSpatialReference=r,this.callback=t,this.errback=i,this.transformation=n}return e}();t.ProjectArgs=i})},"geocortex/infrastructure/MapUtils":function(){define(["require","exports","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/commandArgs/ProjectArgs","geocortex/framework/utils/ArrayUtils","geocortex/essentials/ReportParameters","geocortex/framework/utils/utils"],function(e,t,i,r,n,a,o){"use strict";function s(e,t,r){null==r&&(r=e.extent);var n=i.scaleEnvelopeWithoutTranslation(r,1/t);return e.setExtent(n,!!e._fitTiledMapsToExtent),n}function l(e,t,r,n){null==r&&(r=e.getMap().extent);var a=e.essentialsMap.getMap(),o=i.scaleEnvelopeWithoutTranslation(r,1/t),s=a.getLevel();if(void 0!==s&&null!==s&&s>-1){var l=s;return t>1?l=s+1:t<1&&(l=s-1),a.setLevel(l),o}return e.essentialsMap.extentManager.setExtentWithPriority(o,n),o}function c(e){if(e){if("point"==e.type){var t=e;return new esri.geometry.Extent(t.x,t.y,t.x,t.y,e.spatialReference)}return e.getExtent()}return null}function u(e,t,i,n){function a(t){e.trace.warning("PanToPoint: "+t.message)}var o=function(t){var r=null,a=null;t&&t.length>0&&(r=t[0]),e.map&&r&&((n||void 0===n)&&e.command("ShowMap").execute(),"point"==r.type?e.site.essentialsMap.extentManager.centerAtWithPriority(r,i):"extent"==r.type?e.site.essentialsMap.extentManager.centerAtWithPriority(r.getCenter(),i):"polyline"!=r.type&&"polygon"!=r.type&&"multipoint"!=r.type||(a=r.getExtent(),a&&e.site.essentialsMap.extentManager.centerAtWithPriority(a.getCenter(),i)))};if(t&&t.isInstanceOf(esri.geometry.Geometry)){var s=new r.ProjectArgs([t],o,a);e.command("Project").execute(s)}}function d(e,t,i){this.zoomToExtentWithPriority(e,t,null,null,i)}function p(e,t,i,n){var a=function(t){t&&t.length>0&&((n||void 0===n)&&e.command("ShowMap").execute(),null==i?e.map.setExtent(t[0],!!e.map._fitTiledMapsToExtent):e.site.essentialsMap.extentManager.setExtentWithPriority(t[0],i),e.event("MapStartupExtentChangedEvent").publish(t[0]))};if(t&&t.isInstanceOf(esri.geometry.Extent)){if(!t.spatialReference&&e.map.spatialReference)return t.spatialReference=e.map.spatialReference,void a([t]);t.spatialReference&&!t.spatialReference.toJson&&(t.spatialReference.wkid||t.spatialReference.wkt)&&(t.spatialReference=new esri.SpatialReference(t.spatialReference));var o=function(t){e.trace.warning("ZoomToExtent: "+t.message)},s=new r.ProjectArgs([t],a,o);e.command("Project").execute(s)}}function h(e,t,i){var r=e.__tileInfo&&e.__tileInfo.lods;if(!r||!r.length)return i;for(var n=0,a=0;a<r.length;a++){if(r[a].scale===i)return i;if(t===M.LessThan){if(i<r[a].scale)continue}else if(r[a].scale>i){n=r[a].scale;continue}return t===M.LessThan?r[a].scale:n}}function m(e){var t=new esri.Graphic(e.toJson());return t._graphicsLayer=e._graphicsLayer,t}function f(e,t,i){if(o.isNullOrUndefined(e)||o.isNullOrUndefined(t))return!1;if(e===t)return!0;var r=Object.keys(e),a=Object.keys(t);if(!r.length||!a.length)return!1;if(r=n.difference(r,i),a=n.difference(a,i),r.length!==a.length)return!1;for(var s=0,l=r;s<l.length;s++){var c=l[s];if(e[c]!==t[c])return!1}return!0}function g(e,t){if(o.isNullOrUndefined(e)||o.isNullOrUndefined(t))return!1;if(e===t)return!0;var i=["timestamp","clusterId","clusterCount","extent"],r=e.getLayer();if(r&&r instanceof esri.layers.FeatureLayer||(r=t.getLayer()),r instanceof esri.layers.FeatureLayer){var n=r.objectIdField;if(n&&e.attributes&&t.attributes&&e.attributes[n]===t.attributes[n])return!0;if(r.editFieldsInfo)for(var a=Object.keys(r.editFieldsInfo),s=0,l=a;s<l.length;s++){var c=l[s];i.push(r.editFieldsInfo[c])}}return f(e.attributes,t.attributes,i)}function y(e,t){var i=e?e.type:null;switch(i){case"point":return v(e,t);case"multipoint":return S(e,t);case"polyline":return _(e,t);case"polygon":return I(e,t);case"extent":return w(e,t)}return!1}function b(e,t){return e===t||e.type===t.type&&e.spatialReference&&t.spatialReference&&e.spatialReference.equals(t.spatialReference)}function v(e,t){return e===t||e.x==t.x&&e.y==t.y&&b(e,t)}function S(e,t){var i=b(e,t);if(i&&e.points.length===t.points.length){for(var r=0;i&&r<e.points.length;r++)i=e.points[r][0]===t.points[r][0]&&e.points[r][1]===t.points[r][1];return i}return!1}function _(e,t){var i=b(e,t);return i&&dojo.forEach(e.paths,function(e,r){if(e.length!==t.paths[r].length)return void(i=!1);for(var n=0;i&&n<e.length;n++)i=e[n][0]===t.paths[r][n][0]&&e[n][1]===t.paths[r][n][1];return i?void 0:i}),i}function I(e,t){var i=b(e,t);return i&&dojo.forEach(e.rings,function(e,r){if(e.length!==t.rings[r].length)return void(i=!1);for(var n=0;i&&n<e.length;n++)i=e[n][0]===t.rings[r][n][0]&&e[n][1]===t.rings[r][n][1];return i?void 0:i}),i}function w(e,t){var i=b(e,t);return i&&e.xmin==t.xmin&&e.xmax==t.xmax&&e.ymin==t.ymin&&e.ymax==t.ymax}function x(e,t){if(!e||!t)return null;var i=null,r=t.objectIdField;e.attributes[r]&&(i=e.attributes[r]);var a=t.graphics;if(a.length<1)return null;var o=["timestamp","clusterId","clusterCount","extent"];if(t.editFieldsInfo)for(var s in t.editFieldsInfo)t.editFieldsInfo.hasOwnProperty(s)&&o.push(t.editFieldsInfo[s]);var l=function(e){return n.contains(o,e)},c=function(e){var t=0;for(var i in e)!l(i)&&e.hasOwnProperty(i)&&++t;return t},u=a[0].attributes;if(c(u)!==c(e.attributes))return null;var d=0,p=[],h=[];for(var m in u){var f=l(m);if(!(f||u.hasOwnProperty(m)&&e.attributes.hasOwnProperty(m)))return null;f||(p.push(m),h.push(m),++d)}for(var g=0;g<d;++g)if(p[g]!==h[g])return null;for(var y=0;y<a.length;y++){var b=a[y];if(c(u)===c(e.attributes)&&b.attributes[r]===e.attributes[r])return b._graphicsLayer=t,b}return null}function L(e,t,i){var r=null;if(i&&(r=this.findFeatureInLayer(e,i)))return r._graphicsLayer=i,r;for(var n=t.getFeatureServices(),a=0;a<n.length;a++){var o=n[a],s=o.serviceLayer;if((!i||s!==i)&&(r=this.findFeatureInLayer(e,s)))return r}return!r&&e.getLayer&&e.getLayer()&&(r=e),r}function C(e,t,i,r,n){void 0===i&&(i=150),void 0===r&&(r=150),void 0===n&&(n=20);var o=new a.ReportParameters;return o.outputFormat="PNG",o.includeData=!0,o.imageWidth=i,o.imageHeight=r,o.resolution={displayName:"custom",dpi:n},o.customExtent=t||e.map.extent,o.extentType=a.ReportParameters.CUSTOM_EXTENT,o.populateMapGraphicsLayers(e.map),new Promise(function(t,i){e.site.essentialsMap.exportMap(o,function(e){t(e.data?"data:image/png;base64,{0}".format(e.data):e.href?e.href:null)},function(i){e.trace.error("Error exporting map for thumbnail: {0}".format(i.message)),t(null)})})}t.stepZoom=s,t.stepZoomWithPriority=l,t.getExtent=c,t.panToPointWithPriority=u,t.zoomToExtent=d,t.zoomToExtentWithPriority=p,t.getClosestScale=h;var M;!function(e){e[e.LessThan=0]="LessThan",e[e.GreaterThan=1]="GreaterThan"}(M=t.ScaleChangeMode||(t.ScaleChangeMode={})),t.cloneEsriFeature=m,t.esriFeatureAttributesEqual=f,t.esriFeaturesEqual=g,t.esriGeometriesEqual=y,t.compareTypeSR=b,t.esriPointsEqual=v,t.esriMultipointsEqual=S,t.esriPolylinesEqual=_,t.esriPolygonsEqual=I,t.esriExtentsEqual=w,t.findFeatureInLayer=x,t.findFeatureInMap=L,t.getThumbnailUri=C})},"geocortex/infrastructure/KmlFeature":function(){define(["require","exports","geocortex/infrastructure/Feature"],function(e,t,i){"use strict";t.isKmlProperty="__isKml";var r=function(e){function i(i){var r=e.call(this,i)||this,n=r.esriFeature.get(),a=n?n.attributes||{}:{};return r.labelFormat.set(a.hasOwnProperty("name")?"{name}":"{id}"),r.descriptionFormat.set("{snippet}"),r.longDescriptionFormat.set(a.hasOwnProperty("balloonStyleText")?"{balloonStyleText}":"{description}"),n&&!n[t.isKmlProperty]&&(n[t.isKmlProperty]=!0),r}return __extends(i,e),i}(i.Feature);t.KmlFeature=r})},"geocortex/infrastructure/AttributeGroup":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();t.AttributeGroup=i})},"geocortex/infrastructure/DataLinkingResult":function(){define(["require","exports","geocortex/infrastructure/AttributeGroup","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(){function e(){this.dataLink=new r.Observable,this.table=new r.Observable}return e.prototype.toAttributes=function(){var e=this.table.get();if(!e)return null;for(var t={},i=0;i<e.columns.length;i++){var r=e.columns[i],n=e.rows.length>0?e.rows[0].row[i]:null;t[r]=n}return t},e.prototype.asAttributeGroup=function(){return this._attributeGroup||(this._attributeGroup=new i.AttributeGroup,this._attributeGroup.owner=this,this._attributeGroup.attributes=this.toAttributes()),this._attributeGroup},e}();t.DataLinkingResult=n})},"geocortex/infrastructure/FeatureSet":function(){define(["require","exports","geocortex/framework-ui/LazyObservable","geocortex/framework/observables","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/DateFormat","geocortex/infrastructure/Dictionary","geocortex/framework/utils/utils","geocortex/framework/events/CollectionChangedArgs","geocortex/framework/utils/ArrayUtils","geocortex/geocortex","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/MapUtils","geocortex/infrastructure/KmlFeature","geocortex/infrastructure/PresentableDelegateFactory","geocortex/infrastructure/DataLinkingResult"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m,f,g,y){"use strict";var b;!function(e){e[e.Unresolved=0]="Unresolved",e[e.Resolving=1]="Resolving",e[e.Resolved=2]="Resolved"}(b=t.DataLinksState||(t.DataLinksState={}));var v=function(){function e(e){var t=this;this.id="",this.featureLayer=null,this.displayName=new i.LazyObservable,this.features=new r.ObservableCollection,this.attributes=new r.ObservableCollection,this.iconUri=new i.LazyObservable,this.extendedProperties=new r.ObservableCollection,this.isSelectedInCollection=new r.Observable((!1)),this.dataLinksResolved=new r.Observable((!1)),this.defaultNumberFormat=o.NumberFormat.DEFAULT,this.defaultDateFormat=s.DateFormat.DEFAULT,this._objectIds=new l.Dictionary,this._watchHandles={},this._dataLinksState=b.Unresolved;var n=null,a=null;e=e||{},e.hasOwnProperty("esriFeatureSet")&&(n=e.esriFeatureSet),e.hasOwnProperty("featureLayer")&&(this.featureLayer=e.featureLayer),e.hasOwnProperty("layer")&&(a=e.layer),e.hasOwnProperty("allowUnsafeContent")?this._allowUnsafeContent=e.allowUnsafeContent:this._allowUnsafeContent=!1,e.hasOwnProperty("app")&&(this.app=e.app),this.defaultDateFormat=e.defaultDateFormat||s.DateFormat.DEFAULT,this.defaultNumberFormat=e.defaultNumberFormat||o.NumberFormat.DEFAULT,this.uniqueId="fs_"+c.alphaNumericToken(),this.esriFeatureSet=n,a&&(this.layer=a),e.hasOwnProperty("id")&&!String.isNullOrEmpty(e.id)&&(this.id=e.id),String.isNullOrEmpty(this.id)&&this.layer&&this.layer.mapService&&(this.id="{0}/{1}".format(this.layer.mapService.id,this.layer.id)),this.displayName.delegateGetter=function(){return t.layer&&t.layer.displayName?t.layer.displayName:""},this.iconUri.delegateGetter=function(){return t.layer&&t.layer.iconUri?t.layer.iconUri:""},this.loadFeatures(),this.loadAttributes()}return Object.defineProperty(e.prototype,"dataLinksState",{get:function(){return this._dataLinksState},enumerable:!0,configurable:!0}),e.prototype.setDataLinksState=function(e){this._dataLinksState=e,this.dataLinksResolved.set(e===b.Resolved)},e.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var i=this.extendedProperties.getAt(t);if(i&&i.name==e)return i.value}return null},e.prototype.setExtendedProperty=function(e,t){for(var i=0;i<this.extendedProperties.getLength();i++){var r=this.extendedProperties.getAt(i);if(r&&r.name==e)return void(r.value=t)}this.extendedProperties.addItem({name:e,value:t})},e.prototype.addFeature=function(e,t){var i=new u.CollectionChangedArgs,r=this.features.length();i.type="append",i.rangeStart=r,i.rangeEnd=r,i.sender=this.features;var n=this._addFeatureWithoutNotification(e,t);return!!n&&(this.features.bindingEvent.publish(i),!0)},e.prototype._addFeatureWithoutNotification=function(e,t){if(!e)throw new Error("Feature cannot be null.");var i=this.features.getItems();return!(!t&&this.containsFeature(e))&&(e.featureSet=this,i.push(e),this.esriFeatureSet&&this.esriFeatureSet.features&&this.esriFeatureSet.features.push(e.esriFeature.get()),!0)},e.prototype.removeFeature=function(e){if(!e)throw new Error("Feature cannot be null.");var t=e.id.get();if(!String.isNullOrEmpty(t)&&!this._objectIds.containsKey(t))return!1;var i=new u.CollectionChangedArgs;i.type="remove";for(var r=this.features.length();r--;){var n=this.features.getAt(r);if(n&&n.structurallyEquals(e))return i.rangeStart=r,i.rangeEnd=r,i.sender=this.features,this.features.bindingEvent.publish(i),this._removeWithoutNotificationAt(r),!0}return!1},e.prototype._removeWithoutNotificationAt=function(e){var t=this.features.getItems();if(0<=e&&e<t.length){var i=t[e],r=i.esriFeature.get();return r&&this.esriFeatureSet&&this.esriFeatureSet.features&&d.removeItem(this.esriFeatureSet.features,r),i.featureSet=null,d.remove(t,e,e),this._objectIds.remove(i.id.get()),!0}return!1},e.prototype.containsFeature=function(e){if(!e)throw new Error("Feature cannot be null.");var t=e.id.get();if(t&&this._objectIds.containsKey(t))return!0;for(var i=0;i<this.features.length();i++){var r=this.features.getAt(i);if(r.structurallyEquals(e))return!0}return!1},e.prototype.clearFeatures=function(){if(0!=this.features.length()){var e=new u.CollectionChangedArgs;for(e.type="clear",e.rangeStart=0,e.rangeEnd=this.features.length()-1,e.sender=this.features,this.features.bindingEvent.publish(e);this.features.length()>0;)this._removeWithoutNotificationAt(0)}},e.prototype.loadGeometries=function(e,t,i){var r=this,n=new dojo.Deferred;if(!this.layer){var a=new Error("loadGeometries: Layer must be present.");return p.deferredReject(n,a),"function"==typeof i&&i(a),n}if(!this.layer.primaryKeyField){var a=new Error("loadGeometries: Layer must have a PrimaryKeyField to load geometries.");return p.deferredReject(n,a),"function"==typeof i&&i(a),n}var o=this.layer.primaryKeyField.name;e||(e=this.features.getItems());var s=[];if(e){var l;for(l=0;l<e.length;l++){var c=e[l];if(!c.hasGeometry.get()){var u=c.esriFeature.get();u&&u.attributes[o]&&s.push(c)}}}if(s.length>0){var d=[];for(l=0;l<s.length;l++)d.push(s[l].esriFeature.get().attributes[o]);var m=h.getQueryTask(this.layer),f=new esri.tasks.Query;if(f.objectIds=d,f.returnGeometry=!0,f.outFields=[o],this.layer&&this.layer.mapService&&this.layer.mapService.essentialsMap&&this.layer.mapService.essentialsMap.site){var g=this.layer.mapService.essentialsMap.site.getMap();g&&(f.outSpatialReference=this.layer.mapService.essentialsMap.site.getMap().spatialReference)}m.execute(f).then(function(e){if(e&&e.features&&e.features.length>0)for(var i=0;i<e.features.length;i++){var a=e.features[i],l=r._findFeature(a.attributes[o],o,s);l&&(l.esriFeature.get().geometry=a.geometry)}p.deferredResolve(n,void 0),"function"==typeof t&&t()},function(e){var t=new Error("loadGeometries: Query error: "+e.message);p.deferredReject(n,t),"function"==typeof i&&i(t)})}else p.deferredResolve(n,void 0),"function"==typeof t&&t();return n},e.prototype.findFeatureById=function(e){return this._objectIds.get(e)},e.prototype.findFeatureByEsriFeature=function(e){var t=null,i=e.getLayer();if(i&&this.layer&&this.layer.mapService&&this.layer.mapService.serviceLayer!==i)return null;
for(var r=0;r<this.features.length();r++){var n=this.features.getAt(r);if(n.esriFeature&&(n.esriFeature.get()===e||m.esriFeaturesEqual(n.esriFeature.get(),e))){t=n;break}}return t},e.prototype._findFeature=function(e,t,i){var r,n,a=null;if(i&&i.length>0)for(r=0;r<i.length;r++)if(n=i[r].esriFeature.get(),n&&n.attributes&&n.attributes[t]==e){a=i[r];break}return a},e.prototype.loadFeatures=function(){this._watchFeatureSetChanges(),this.features.clear();var e,t=[];if(this.esriFeatureSet&&this.esriFeatureSet.features)for(var i=0;i<this.esriFeatureSet.features.length;++i){var r=this.esriFeatureSet.features[i],a={graphic:r,layer:this.layer,featureLayer:this.featureLayer,resolveLayerFields:!0,allowUnsafeContent:this._allowUnsafeContent};e=r&&r[f.isKmlProperty]?new f.KmlFeature(a):new n.Feature(a),e.featureSet=this,e.defaultDateFormat=this.defaultDateFormat,e.defaultNumberFormat=this.defaultNumberFormat,t.push(e)}this.features.useThrottling=!1,this.features.addItems(t)},e.prototype.loadAttributes=function(){this.attributes.clear();var e=[],t=[];if(this.layer&&this.layer.fields){for(var i=0;i<this.layer.fields.length;i++){var r=this.layer.fields[i];a.FeatureAttribute.ignoreAttribute(r.name)?t.push(r):e.push(new a.FeatureAttribute("",r.name,r.alias,r.displayName,r.visible,g.PresentableDelegateFactory.valuePresenterDelegate(r,null)))}for(var n=0;n<t.length;n++){var o=t[n];if(o.visible){var s=e.filter(function(e){return e.name.get()===o.name.substr(0,o.name.length-".Name()".length)}),l=1===s.length?s[0]:null;l&&(l.visible.get()||l.visible.set(!0),l.alias.set(o.alias),l.displayName.set(o.displayName))}}}else if(this.features&&this.features.getLength()>0)for(var c=this.features.getAt(0),u=0;u<c.attributes.getLength();u++){var d=c.attributes.getAt(u);e.push(new a.FeatureAttribute("",d.name.get(),d.alias.get(),d.displayName.get()))}else if(this.esriFeatureSet&&this.esriFeatureSet.features&&this.esriFeatureSet.features.length>0){var p=this.esriFeatureSet.features[0];for(var h in p.attributes)p.attributes.hasOwnProperty(h)&&e.push(new a.FeatureAttribute("",h,h,h))}this.attributes.addItems(e)},e.prototype.featureSetChanged=function(e){if("append"==e.type||"insert"==e.type)for(var t=e.rangeStart;t<=e.rangeEnd;t++){var i=this.features.getAt(t),r=i.featureSetUniqueIds.indexOf(this.uniqueId);r>=0&&i.featureSetUniqueIds.splice(r,1),i.featureSet=this,i.featureSetUniqueIds.push(this.uniqueId);var n=i.id.get();n&&this._objectIds.set(n,i)}if("remove"==e.type||"clear"==e.type)for(var t=e.rangeStart;t<=e.rangeEnd;t++){var i=this.features.getAt(t),r=i.featureSetUniqueIds.indexOf(this.uniqueId);r>=0&&i.featureSetUniqueIds.splice(r,1),i.featureSet===this&&(i.featureSet=null);var n=i.id.get();n&&this._objectIds.remove(n)}},e.prototype._applyDataLinks=function(e,t,i,r,n){for(var a=0;a<e.features.length();a++){var o=e.features.getAt(a);if(o.linkedAttributes.length()>0){var s=o.linkedAttributes.getAt(0);o.linkedAttributes.clear(),o.linkedAttributes.addItem(s),o.dataLinkingResults.clear()}}for(var l=0;l<i.length;l++)for(var c=r[l],u=i[l],d=0;d<c.length;d++){var p=c[d],h=new y.DataLinkingResult;h.table.set(p.linkedData),h.dataLink.set(u);var o=t[p.index];o.dataLinkingResults.addItem(h),n&&n(o),u.isOneToOne&&o.linkedAttributes.addItem(h.asAttributeGroup())}},e.prototype.resolveDataLinks=function(e,t,i,r,n){var a=this,o=this;if(this.dataLinksState===b.Resolving)return void(n&&n(this,new Error("Currently performing data linking"),i));if("undefined"==typeof t&&(t=!0),o.layer&&o.layer.hasDataLinks&&o.features.length()>0){o.setDataLinksState(b.Resolving);var s=this.features.get().slice(),l=[];l=t?dojo.filter(o.layer.dataLinks,function(e){return e.visible}):o.layer.dataLinks,l=dojo.filter(l,function(e){return!!(e&&e.parameters&&e.parameters.length)});for(var c=[],u=0,d=0,p=!1,h=0;h<l.length&&!p;h++){var m=function(t){return function(n){if(!p&&(c[t]=n,u++,u>=l.length)){if(a._applyDataLinks(o,s,l,c,e),o.setDataLinksState(b.Resolved),"undefined"!=typeof a.app)for(var d=0;d<l.length;d++)a.app.event("DatalinkResolutionCompletedEvent").publish(l[d].id,o);r&&r(o,i)}}},f=m(h),g=function(e){return function(t){d++,d>=l.length?(console.error("There was an error in resolving {0} datalink. Message : {1}".format(l[e].displayName,t.message)),p=!0,o.setDataLinksState(b.Unresolved),n&&n(o,t,i)):(console.error("There was an error in resolving {0} datalink. Message : {1}".format(l[e].displayName,t.message)),m(e)(new y.DataLinkingResult))}},v=g(h);"undefined"!=typeof this.app&&this.app.event("DatalinkResolutionStartedEvent").publish(l[h].id,o),l[h].performDataLinking(o.esriFeatureSet,f,v)}}else o.setDataLinksState(b.Resolved),r&&r(o,i)},e.prototype.doWhenDataLinkingCompleted=function(e){var t=this;if("function"==typeof e)if(this.dataLinksResolved.get())e(this);else var i=this.dataLinksResolved.bind(this,function(r){r&&(t.dataLinksResolved.unbind(i),e(t))})},e.prototype.append=function(e){for(var t=new Object,i=0;i<this.features.length();i++){var r,n=this.features.getAt(i);if(this.layer&&this.layer.primaryKeyField&&(r=this.layer.primaryKeyField.name),r){var a=n.esriFeature.get().attributes[r];t[a]=n}}for(var i=0;i<e.features.length();i++){var r,n=e.features.getAt(i);if(e.layer&&e.layer.primaryKeyField&&(r=e.layer.primaryKeyField.name),r){var a=n.esriFeature.get().attributes[r];t[a]||this.features.addItem(n)}else this.features.addItem(n)}},e.prototype.union=function(e){for(var t=this.clone(),i=e&&e.features?e.features.length():0,r=0;r<i;r++)t.containsFeature(e.features.getAt(r))||t.addFeature(e.features.getAt(r),!0);return t},e.prototype.unionInPlace=function(e){if(!e||!e.features||0===e.features.length())return!1;var t=new u.CollectionChangedArgs;t.type="append",t.rangeStart=this.features.length();for(var i=!1,r=0,n=0;n<e.features.length();n++){var a=e.features.getAt(n);this.containsFeature(a)||this._addFeatureWithoutNotification(a,!0)&&(i=!0,r++)}return i&&(t.rangeEnd=t.rangeStart+r-1,t.sender=this.features,this.features.bindingEvent.publish(t)),i},e.prototype.subtract=function(e){for(var t=this.cloneStructure(),i=0;null!=e&&i<this.features.length();i++)e.containsFeature(this.features.getAt(i))||t.addFeature(this.features.getAt(i));return t},e.prototype.subtractInPlace=function(e){if(!e||!e.features||0===e.features.length())return!1;for(var t=!1,i=this.features.length();i--;){var r=this.features.getAt(i);e.containsFeature(r)&&(this._removeWithoutNotificationAt(i),t=!0)}return t&&this.features.pulse(),t},e.prototype.intersect=function(e){for(var t=this.cloneStructure(),i=0;null!=e&&i<this.features.length();i++)e.containsFeature(this.features.getAt(i))&&t.addFeature(this.features.getAt(i));return t},e.prototype.intersectInPlace=function(e){if(!e||!e.features)return!1;for(var t=!1,i=this.features.length();i--;){var r=this.features.getAt(i);e.containsFeature(r)||(this._removeWithoutNotificationAt(i),t=!0)}return t&&this.features.pulse(),t},e.prototype.clone=function(){for(var e=this.cloneStructure(),t=0;t<this.features.length();t++)e.addFeature(this.features.getAt(t),!0);return e},e.prototype.cloneStructure=function(){var t=new e({app:this.app,layer:this.layer,featureLayer:this.featureLayer,allowUnsafeContent:this._allowUnsafeContent,defaultDateFormat:this.defaultDateFormat,defaultNumberFormat:this.defaultNumberFormat,id:this.id});return t.id=this.id,t.isSelectedInCollection.set(this.isSelectedInCollection.get()),t.setDataLinksState(this.dataLinksState),t.displayName.set(this.displayName.get()),t.iconUri.set(this.iconUri.get()),t.attributes.set(this.attributes.get()),t.extendedProperties.set(this.extendedProperties.get()),t.esriFeatureSet=this._cloneEsriStructure(this.esriFeatureSet),t},e.prototype._cloneEsriStructure=function(e){if(!e)return null;var t=new esri.tasks.FeatureSet;return t.displayFieldName=e.displayFieldName,t.exceededTransferLimit=e.exceededTransferLimit,t.fieldAliases=e.fieldAliases,t.geometryType=e.geometryType,t.spatialReference=e.spatialReference,e.fields&&(t.fields=e.fields),t},e.prototype._watchFeatureSetChanges=function(){var e=this;this._unwatchFeatureSetChanges();var t=this.features.bind(this,this.featureSetChanged),i={remove:function(){return e.features.unbind(t)}};return this._watchHandles.features=i,i},e.prototype._unwatchFeatureSetChanges=function(){var e=this._watchHandles.features;e&&e.remove(),this._watchHandles.features=null},e}();t.FeatureSet=v})},"geocortex/infrastructure/AttachmentInfo":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r=function(){function e(){this.id=new i.Observable,this.contentType=new i.Observable,this.size=new i.Observable,this.name=new i.Observable,this.url=new i.Observable}return e}();t.AttachmentInfo=r})},"geocortex/infrastructure/FilterUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t){return void 0===t&&(t={}),html4.ATTRIBS["*::aria-label"]=0,html4.ATTRIBS["*::data-replacement-token"]=0,html4.ATTRIBS["a::target"]=0,t.allowFrames&&(html4.ATTRIBS["iframe::src"]=1),html.sanitize(e,function(e,i,r,a){if(t.uriTransformer){e=e.toString();var o=void 0;if("MARKUP"===a.TYPE){var s=a;o={uri:e,type:"a"===s.XML_TAG&&"href"===s.XML_ATTR?n.NavigableLink:n.Markup,tag:s.XML_TAG,attribute:s.XML_ATTR}}else{if("CSS"!==a.TYPE)throw new Error("Unknown URI hint type: '"+a.TYPE+"'");var l=a;o={uri:e,type:n.Css,property:l.CSS_PROP}}return t.uriTransformer(e,o)}return""})}function r(e){e=String.unescapeHtml(e);var t=i(e),r=document.createElement("div");return r.innerHTML=t,r.innerText||r.textContent}t.sanitize=i,t.stripHtml=r;var n;!function(e){e[e.Markup=0]="Markup",e[e.Css=1]="Css",e[e.NavigableLink=2]="NavigableLink"}(n=t.UriType||(t.UriType={}));var a=function(){function e(e,t){void 0===t&&(t={}),this.sanitize(e,t)}return e.prototype.sanitize=function(e,t){void 0===t&&(t={}),this._unsafeHtml=e,this._safeHtml=i(this._unsafeHtml,t)},Object.defineProperty(e.prototype,"unsafeHtml",{get:function(){return this._unsafeHtml},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"safeHtml",{get:function(){return this._safeHtml},enumerable:!0,configurable:!0}),e}();t.UnsafeHtml=a;var o;!function(e){function t(e){var t=e.match(/^\s*data:(.*?),.+/i);if(!t)return null;for(var i,r,n,a=t[1],o=a.split(";"),s=0,l=o;s<l.length;s++){var c=l[s];if(/^charset=(.+)$/i.test(c)){if(r)return null;r=c}else if(/^base64$/i.test(c)){if(n)return null;n=c}else if(/^.+$/i.test(c)){if(i)return null;i=c}}var u=e.indexOf(",")+1;return{uri:e,meta:a,mediaType:i,charset:r,extension:n,payloadIndex:u}}function i(i){var r=t(i);if(!r)return!1;var n=r.mediaType;return n||(n="text/plain"),!!e.dataUriMediaTypeWhitelist.some(function(e){return n.toLowerCase()===e.toLowerCase()})}e.dataUriMediaTypeWhitelist=["image/jpeg","image/png","image/gif","image/svg+xml"],e.parseDataUri=t,e.isDataUriSafe=i}(o=t.DataUri||(t.DataUri={}))})},"geocortex/infrastructure/Feature":function(){define(["require","exports","geocortex/essentials/Layer","geocortex/framework-ui/LazyObservable","geocortex/framework/observables","geocortex/infrastructure/FeatureAttribute","geocortex/infrastructure/AttachmentInfo","geocortex/infrastructure/AttributeGroup","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/DateFormat","geocortex/framework/utils/utils","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/FilterUtils","geocortex/essentials/Field","geocortex/infrastructure/PresentableDelegateFactory","geocortex/infrastructure/gis/FieldInfo","geocortex/infrastructure/MapUtils","geocortex/essentials/utilities/StringUtilities","geocortex/essentials/RestHelperHTTPService"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m,f,g,y,b){"use strict";var v=function(){function e(e){var t=this;this._isAttachmentInfosLoaded=!1,this._defaultFieldFormatString="{0}: {1}",this.token=null,this.featureLayer=null,this.featureSet=null,this.featureSetUniqueIds=[],this.labelFormat=new r.LazyObservable,this.minScale=new r.LazyObservable,this.maxScale=new r.LazyObservable,this.zoomScale=new r.LazyObservable,this.zoomFactor=new r.LazyObservable,this.zoomExtent=new n.Observable,this.borderColor=new r.LazyObservable,this.borderWidth=new r.LazyObservable,this.fillColor=new r.LazyObservable,this.id=new r.LazyObservable,this.attributes=new n.ObservableCollection,this.label=new r.LazyObservable,this.plainLabel=new r.LazyObservable,this.description=new r.LazyObservable,this.descriptionFormat=new r.LazyObservable,this.longDescription=new r.LazyObservable,this.longDescriptionFormat=new r.LazyObservable,this.hyperlinks=new n.ObservableCollection,this.extendedProperties=new n.ObservableCollection,this.attachmentInfos=null,this.attachmentInfosInitialized=new n.Observable((!1)),this.hasAttachments=new n.Observable((!1)),this.hasRelationships=new n.Observable((!1)),this.hasVisibleRelationships=new n.Observable((!1)),this.hasGeometry=new r.LazyObservable,this.hasValidGeometry=new r.LazyObservable,this.iconUri=new r.LazyObservable,this.linkedAttributes=new n.ObservableCollection,this.dataLinkingResults=new n.ObservableCollection,this.defaultNumberFormat=l.NumberFormat.DEFAULT,this.defaultDateFormat=c.DateFormat.DEFAULT,this.isModified=!1,this.timeZoneId=null,this.displayTimeZoneId=null,this._allowUnsafeContent=!1,this._resolveLayerFields=!1,this._attributeValueBindingTokens={};var i=null;if(e&&e.hasOwnProperty("graphic")&&(this._graphic=e.graphic),e&&e.hasOwnProperty("featureLayer")&&(this.featureLayer=e.featureLayer),e&&e.hasOwnProperty("layer")&&(i=e.layer,i&&!this.featureLayer&&i.getFeatureLayer().then(function(e){t.featureLayer=e,e&&t._refreshPresentableValues()})),e&&e.hasOwnProperty("resolveLayerFields")?this._resolveLayerFields=e.resolveLayerFields:i&&i.fields&&(this._resolveLayerFields=!0),e&&e.hasOwnProperty("allowUnsafeContent")?this._allowUnsafeContent=e.allowUnsafeContent:this._allowUnsafeContent=!1,e&&e.hasOwnProperty("timeZoneId")&&(this.timeZoneId=e.timeZoneId),e&&e.hasOwnProperty("displayTimeZoneId")&&(this.displayTimeZoneId=e.displayTimeZoneId),this.token=u.alphaNumericToken(),this.esriFeature=new n.Observable(this._graphic),this.esriFeature.bind(this,function(){t._graphic=t.esriFeature.get(),t.loadAttributes(t._resolveLayerFields),t._setupLinkedAttributes(),t.attachmentInfos.clear(),t._isAttachmentInfosLoaded=!1,t.attachmentInfosInitialized.set(!1),t._refreshPresentableValues()}),this.connectDelegates(),i){if(this.layer=i,this.hasAttachments.set(this.layer.hasAttachments),this.layer.relationships&&this.layer.relationships.length>0){this.hasRelationships.set(!0);for(var a=0;a<this.layer.relationships.length;a++)if(this.layer.relationships[a].visible){this.hasVisibleRelationships.set(!0);break}}null!=i.featureHyperlinks&&this.hyperlinks.addItems(i.featureHyperlinks)}this.loadAttributes(this._resolveLayerFields),this.isModified=!1,this._prepAttachmentInfos(),this._graphic&&this._setupLinkedAttributes()}return e.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var i=this.extendedProperties.getAt(t);if(i&&i.name==e)return i.value}return null},e.prototype.setExtendedProperty=function(e,t){for(var i=0;i<this.extendedProperties.getLength();i++){var r=this.extendedProperties.getAt(i);if(r&&r.name==e)return void(r.value=t)}this.extendedProperties.addItem({name:e,value:t})},e.prototype.connectDelegates=function(){var e=this;this.hasGeometry.delegateGetter=function(){return!(!e._graphic||!e._graphic.geometry)},this.hasValidGeometry.delegateGetter=function(){return!(!e._graphic||!e._graphic.geometry)&&d.isValidGeometry(e._graphic.geometry)},this.id.cacheDelegateResults=!0,this.id.delegateGetter=function(){var t="";if(e._graphic&&e.layer){var i=null;e.layer&&(i=e.layer.getObjectIdFieldName()),i&&e._graphic.attributes&&e._graphic.attributes.hasOwnProperty(i)&&(t=e._graphic.attributes[i])}return t},this.label.delegateGetter=function(){var t=null,i=e.labelFormat.get();t=e.formatTemplateString(i),null!=t&&void 0!=t&&t.toString().trim()||(t=e._getDefaultFieldValue(),void 0!=t&&null!=t&&e.layer&&(t=e.layer.displayName&&e.layer.displayName.toString().trim()?e.layer.displayName+(t.toString().trim()?", "+t:""):t.toString().trim()?t:""));var r={allowFrames:!1,uriTransformer:function(e,t){return t.type!==p.UriType.NavigableLink?e:/^mailto\:/.test(e)?e:"command:OpenWebPage?"+e}};return p.sanitize(t,r)},this.plainLabel.delegateGetter=function(){return p.stripHtml(e.label.get())},this.labelFormat.delegateGetter=function(){return e.layer&&e.layer.featureLabel?e.layer.featureLabel:e.layer&&e.layer.displayField?"{"+e._sanitizeFieldName(e.layer.displayField.name)+"}":e.featureSet&&e.featureSet.esriFeatureSet&&e.featureSet.esriFeatureSet.displayFieldName&&e.featureSet.layer&&e.featureSet.layer.displayName?e.featureSet.layer.displayName+", {"+e.featureSet.esriFeatureSet.displayFieldName+"}":e.featureSet&&e.featureSet.esriFeatureSet&&e.featureSet.esriFeatureSet.displayFieldName?"{"+e._sanitizeFieldName(e.featureSet.esriFeatureSet.displayFieldName)+"}":""},this.borderColor.delegateGetter=function(){return e.layer&&e.layer.featureBorderColor?e.layer.featureBorderColor:null},this.borderWidth.delegateGetter=function(){return e.layer&&"number"==typeof e.layer.featureBorderWidth&&e.layer.featureBorderWidth>=0?e.layer.featureBorderWidth:null},this.fillColor.delegateGetter=function(){return e.layer&&e.layer.featureFillColor?e.layer.featureFillColor:null},this.description.delegateGetter=function(){var t=e.descriptionFormat.get();return e.formatTemplateString(t)},this.descriptionFormat.delegateGetter=function(){return e.layer&&e.layer.featureDescription?e.layer.featureDescription:null},this.longDescription.delegateGetter=function(){var t=e.longDescriptionFormat.get();return e.formatTemplateString(t)},this.longDescriptionFormat.delegateGetter=function(){return e.layer&&e.layer.featureLongDescription?e.layer.featureLongDescription:e.descriptionFormat.get()},this.minScale.delegateGetter=function(){return e.layer&&!isNaN(e.layer.minScale)?e.layer.minScale:1/0},this.maxScale.delegateGetter=function(){return e.layer&&!isNaN(e.layer.maxScale)?e.layer.maxScale:0},this.iconUri.delegateGetter=function(){return e.layer&&e.layer.iconUri?e.layer.iconUri:e.featureSet&&e.featureSet.iconUri&&e.featureSet.iconUri.get()?e.featureSet.iconUri.get():null},this.zoomScale.delegateGetter=function(){return e.layer&&e.layer.featureZoomScale?e.layer.featureZoomScale:null},this.zoomFactor.delegateGetter=function(){return e.layer&&e.layer.featureZoomFactor?e.layer.featureZoomFactor:null}},e.prototype.withinScaleRange=function(e){return!!(0==this.maxScale.get()&&this.minScale.get()==1/0||isNaN(this.maxScale.get())&&isNaN(this.minScale.get()))||!!e&&(this.maxScale.get()<=e&&e<=this.minScale.get())},e.prototype.calculateScaleToMakeVisible=function(e){return this.withinScaleRange(e)?e:e<this.maxScale.get()?this.maxScale.get():this.minScale.get()},e.prototype._sanitizeFieldName=function(e){return e?e.replace(/\W/g,""):""},e.prototype._getDefaultFieldValue=function(){var e="",t=this.esriFeature.get();if(t&&this.layer&&this.layer.displayField&&(e=t.attributes[this.layer.displayField.name],null!==e&&void 0!==e&&(e=e.toString().trim())),null!=e&&void 0!=e&&e||!t||!t.attributes||(e=t.attributes.OBJECTID,null!==e&&void 0!==e&&(e=e.toString().trim())),(null==e||void 0==e||!e)&&t&&t.attributes)for(var i in t.attributes)if(e=t.attributes[i],null!==e&&void 0!==e&&(e=e.toString().trim()),e)break;return String.escapeHtmlEncode(e)},e.prototype.resetAttachmentInfos=function(){this.attachmentInfos.clear(),this._isAttachmentInfosLoaded=!1,this.attachmentInfosInitialized.set(!1)},e.prototype._prepAttachmentInfos=function(){var e=this,t=new n.ObservableCollection,i=t.get;t.get=function(){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),i.call(t)};var r=t.getItems;t.getItems=function(){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),r.call(t)};var a=t.getAt;t.getAt=function(i){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),a.call(t,i)},this.attachmentInfos=t},e.prototype.loadAttributes=function(e){var t=this,i={};if(this.attributes.get().forEach(function(e){i[e.name.get()]=e.value.get();var r=t._attributeValueBindingTokens[e.name.get()];r&&e.value.unbind(r)}),this.attributes.clear(),this._attributeValueBindingTokens={},this._graphic&&this._graphic.attributes){var r=this.getAttributesFromEsriFeature(this._graphic.attributes,e);r.forEach(function(e){var r=e.name.get(),n=e.value.get();t._attributeValueBindingTokens[r]=e.value.bind(t,function(){t.isModified=!0}),t.isModified=t.isModified||i.hasOwnProperty(r)&&n!==i[r]||!i.hasOwnProperty(r)});var n=this._graphic.attributes||{};this.isModified=this.isModified||Object.keys(i).some(function(e){return!n.hasOwnProperty(e)}),this.attributes.addItems(r)}},e.prototype.getAttributesFromEsriFeature=function(e,t){var i=this,r=[];if(t!==!1&&this.layer&&this.layer.fields){var n=null;this.layer.mapService&&(n=this.layer.mapService.serviceLayer);for(var o=[],s=0;s<this.layer.fields.length;s++){var l,c=this.layer.fields[s];e&&(c.name||c.alias)&&(l=e.hasOwnProperty(c.name)?e[c.name]:e[c.alias]),a.FeatureAttribute.ignoreAttribute(c.name)?o.push(c):"undefined"==typeof l||null==l?r.push(new a.FeatureAttribute("",c.name,c.alias,c.displayName,c.visible,m.PresentableDelegateFactory.valuePresenterDelegate(c,this),c.dataType)):r.push(new a.FeatureAttribute(l,c.name,c.alias,c.displayName,c.visible,m.PresentableDelegateFactory.valuePresenterDelegate(c,this),c.dataType))}for(var u=0;u<o.length;u++){var d=o[u];if(d.visible){var p=r.filter(function(e){return e.name.get()===d.name.substr(0,d.name.length-".Name()".length)}),g=1===p.length?p[0]:null;g&&(g.visible.get()||g.visible.set(!0),g.alias.set(d.alias),g.displayName.set(d.displayName))}}if(n instanceof esri.layers.WMSLayer)for(var y in e){for(var b=!1,v=e[y],u=0;u<this.layer.fields.length;u++)if(y===this.layer.fields[u].name){b=!0;break}b||r.push(new a.FeatureAttribute(v,y))}}else if(this.featureLayer)this.featureLayer.fields.forEach(function(t){var n=t.alias?t.alias:t.name;if(t.type===h.EsriFieldTypes.esriFieldTypeDate){var o=f.FieldInfo.fromEsriField(t,i.featureLayer);o.timeZoneId||(o.timeZoneId=i.timeZoneId),o.displayTimeZoneId||(o.displayTimeZoneId=i.displayTimeZoneId),!i.layer&&i.defaultDateFormat&&(o.format="{0:"+i.defaultDateFormat+"}"),r.push(new a.FeatureAttribute(e[t.name],t.name,n,n,(!0),m.PresentableDelegateFactory.valuePresenterDelegate(o,null)))}else r.push(new a.FeatureAttribute(e[t.name],t.name,n,n,(!0),m.PresentableDelegateFactory.valuePresenterDelegate(t.name,i)))});else if(this.featureSet&&this.featureSet.attributes&&this.featureSet.attributes.length()>0&&e)for(var u=0;u<this.featureSet.attributes.length();u++){var S=this.featureSet.attributes.getAt(u),_=S.name.get();a.FeatureAttribute.ignoreAttribute(_)||e.hasOwnProperty(_)&&r.push(new a.FeatureAttribute(e[_],_,S.alias.get(),S.displayName.get(),S.visible.get(),m.PresentableDelegateFactory.valuePresenterDelegate(_,this)))}else if(e)for(var I in e)r.push(new a.FeatureAttribute(e[I],I,I,I,(!0),m.PresentableDelegateFactory.valuePresenterDelegate(I,this)));return r},e.prototype.getAttributes=function(e){for(var t=this.linkedAttributes.get(),i=[],r=0;r<t.length;r++){var n=t[r];if(0===r)for(var o=this.attributes.get(),s=0;s<o.length;s++)i.push(o[s]);else{var l=n.attributes;for(var c in l)l.hasOwnProperty(c)&&i.push(new a.FeatureAttribute(l[c],c,c,c,(!0),m.PresentableDelegateFactory.valuePresenterDelegate(null,null)))}}return i},e.prototype.getPrimaryKeyValue=function(){var e=null;if(this.layer&&this.layer.primaryKeyField){var t=this.layer.primaryKeyField;t&&(e=this._graphic.attributes[t.name])}return e},e.prototype.getFeatureUrl=function(){var e=null,t=this.layer.getLayerUrl?this.layer.getLayerUrl():this.layer.url,r=null;if(this.layer instanceof i.Layer)r=this.getPrimaryKeyValue();else if(this.layer instanceof esri.layers.Layer){var n=this.layer;r=this.esriFeature.get().attributes[n.objectIdField]}return t&&r&&(e=t+"/"+r),e},e.prototype.getType=function(){if(!this.featureLayer)return null;var e=m.PresentableDelegateFactory.typeIdForLayerAndAttributes(this.featureLayer,this._graphic.attributes);return null!==e?m.PresentableDelegateFactory.typeFromLayerAndId(this.featureLayer,e):void 0},e.prototype.structurallyEquals=function(t){if(!(t&&t instanceof e))return!1;if(this===t)return!0;if(this._graphic&&t._graphic&&this._graphic===t._graphic)return!0;if(null==this._graphic)return!1;if(null==t._graphic)return!1;var i=this._getLayerUniqueId()==t._getLayerUniqueId();if(i){var r=this.id.get()===t.id.get();if(r)return!String.isNullOrEmpty(this.id.get())||g.esriFeaturesEqual(this._graphic,t._graphic)}return!1},e.prototype.equals=function(t){if(!(t&&t instanceof e&&this._graphic&&t._graphic))return!1;if(this===t)return!0;var i=this._graphic.geometry,r=t._graphic.geometry,n=this.id.get()===t.id.get()||this.id.get()&&t.id.get()&&this.id.get()==t.id.get(),a=this.layer===t.layer||this.layer&&t.layer&&this.layer.id==t.layer.id,o=this.layer===t.layer||this.layer&&t.layer&&this.layer.mapService===t.layer.mapService||this.layer&&t.layer&&this.layer.mapService&&t.layer.mapService&&this.layer.mapService.id==t.layer.mapService.id,s=i===r||i&&r&&i.declaredClass==r.declaredClass;if(!(n&&a&&o&&s))return!1;if(!g.esriFeaturesEqual(this._graphic,t._graphic))return!1;if(i===r)return!0;switch(i.declaredClass){case"esri.geometry.Point":case"esri.geometry.ScreenPoint":return g.esriPointsEqual(i,r);case"esri.geometry.MultiPoint":return g.esriMultipointsEqual(i,r);case"esri.geometry.Polyline":return g.esriPolylinesEqual(i,r);case"esri.geometry.Polygon":return g.esriPolygonsEqual(i,r);case"esri.geometry.Extent":return g.esriExtentsEqual(i,r);default:throw new Error("Warning: equals() in Feature.ts - declared class does not match known geometry.")}},e.prototype._loadAttachmentsInfos=function(){var e=this;if(this._isAttachmentInfosLoaded=!0,!this.layer)throw new Error("Error fetching attachment infos: Feature was not associated with any known layer.");var t=this.getFeatureUrl()+"/attachments/?f=json&ts={0}".format((new Date).getTime()),i={url:t,handleAs:"json"},r=this.layer.mapService&&this.layer.mapService.serviceToken?this.layer.mapService.serviceToken:null,n=this.layer;!this.layer.mapService&&n.credential&&n.credential.token&&(r=n.credential.token),r&&(i.url=b.RestHelperHTTPService.appendTokenToUrl(i.url,r));var a=null;try{var s=this.layer.mapService.serviceLayer;a=s.queryAttachmentInfos(parseInt(this.id.get()))}catch(l){a=esri.request(i)}a.then(function(t){if(t.length>0&&!t.attachmentInfos&&t instanceof Array){t.attachmentInfos=[];for(var i=0;i<t.length;i++)t.attachmentInfos[i]=t[i]}if(t&&t.attachmentInfos&&t.attachmentInfos.length>0){var n;for(n=0;n<t.attachmentInfos.length;n++){var a=t.attachmentInfos[n],s=new o.AttachmentInfo;s.id.set(a.id),s.contentType.set(a.contentType),s.size.set(a.size),s.name.set(a.name);var l="{0}/attachments/{1}".format(e.getFeatureUrl(),a.id);r&&(l=b.RestHelperHTTPService.appendTokenToUrl(l,r)),s.url.set(l),e.attachmentInfos.addItem(s)}}e.attachmentInfosInitialized.set(!0)},function(t){e.attachmentInfosInitialized.set(!0)})},e.prototype.formatTemplateString=function(e){var t=this;if(!e)return"";var i=e.replace(/{{.+?}}|{.+?}/g,function(e){if(e.match(/{{.+?}}/g))return e.substring(1,e.length-1);var i=e.substring(1,e.length-1),r="",n=i.match(/(.*)\.Name\(\)$/);n&&(i=n[1]);for(var a=t.getAttributes(),o=0;o<a.length;o++)if(a[o].name&&a[o].name.get()===i||a[o].alias&&a[o].alias.get()===i){if(t.layer){var s=t.layer.getFieldByName(i);if(s&&u.isUrl(a[o].value.get())){r=a[o].value.get();break}}r=a[o].presentableValue.get();break}if(!r&&t.layer&&(r=y.StringUtilities.replaceLayerTokens(i,t.layer)),!r&&t.layer&&t.layer.mapService&&(r=y.StringUtilities.replaceMapServicetokens(i,t.layer.mapService)),!r){var l={};if(t.parseDataLinkId(i,l)&&t.dataLinkingResults.get())for(var o=0;o<t.dataLinkingResults.length();o++){var c=t.dataLinkingResults.getAt(o);if(c.dataLink.get()&&c.dataLink.get().id===l.dataLinkId){if("_rowcount"===l.attributeName.toLowerCase())r=c.table?c.table.get().rows.length:0;else if(c.table.get())for(var d=c.table.get(),h=0;h<d.columns.length;h++)if(d.columns[h].toLowerCase()===l.attributeName.toLowerCase()){d.rows.length>0&&(r=d.rows[0].row[h]);break}break}}}return r||"RestToken"!==i||(r=b.RestHelperHTTPService.token),t._allowUnsafeContent?null==r&&(r=""):r=r||0===r?p.sanitize(r.toString()):"",null!==r&&void 0!==r||(r=""),r});return i},e.prototype.parseDataLinkId=function(e,t){var i=e.indexOf(".");return!(i<0)&&(t.dataLinkId=e.substring(0,i),t.attributeName=e.substring(i+1),!0)},e.prototype._getLayerUniqueId=function(){var e="";return this.layer&&(e=this.layer.id,this.layer.mapService&&(e=this.layer.mapService.id+"/"+e)),e},e.prototype._setupLinkedAttributes=function(){var e=new s.AttributeGroup;e.owner=this._graphic,e.attributes=this._graphic.attributes,this.linkedAttributes.clear(),this.linkedAttributes.addItem(e)},e.prototype._refreshPresentableValues=function(){this.attributes.get().forEach(function(e){e.presentableValue.clear(),e.presentableValue.pulse()}),this.label.clear(),this.plainLabel.clear(),this.description.clear(),this.longDescription.clear(),this.label.pulse(),this.plainLabel.pulse(),this.description.pulse(),this.longDescription.pulse()},e}();t.Feature=v})},"geocortex/infrastructure/clickableGraphics/ClickableOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/clickableGraphics/ClickableLayerInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/GraphicsLayerIds":function(){define(["require","exports"],function(e,t){"use strict";function i(e){t.MARKUP_LAYER_ID=e,t.COORDINATES_LAYER_ID=e+"_coordinates",t.MEASUREMENT_LAYER_ID=e+"_measurement"}t.MARKUP_LAYER_ID="Drawings",t.COORDINATES_LAYER_ID=t.MARKUP_LAYER_ID+"_coordinates",t.MEASUREMENT_LAYER_ID=t.MARKUP_LAYER_ID+"_measurement",t.PUSHPINS_LAYER_ID="DefaultPushpinsLayer",t.COLLABORATION_LAYER_ID="__CollaborationGraphicsLayer",t.COLLABORATION_SCRATCH_LAYER_ID="CollaborationScratch",t.SNAPPING_GRAPHICS_LAYER_ID="snapping_graphics",t.SNAPPING_HELPER_GRAPHICS_LAYER_ID="snapping_helper_graphics",t.TEMP_SNAPPING_EDITOR_LAYER_ID="temp_snapping_graphics_editing",t.AOI_MASK_LAYER_ID="AreaOfInterestMask",t.EDITING_LAYER_ID="editing_layer",t.EDITOR_CLONE_LAYER_ID="editor_clone_layer",t.GEOLOCATION_LAYER_ID="geolocation_layer",t.VIEWPOINT_INDICATOR_GRAPHICS_LAYER_ID="viewpointIndicatorGraphicsLayer",t.MARKER_GRAPHICS_LAYER_ID="MarkerGraphicsLayer",t.TEMP_GRAPHICS_LAYER_ID="TemporaryMarkup",t.changeGraphicsLayerIdBase=i})},"geocortex/infrastructure/FeatureSetCollection":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/infrastructure/Dictionary"],function(e,t,i,r,n){"use strict";var a=function(){function e(){this.displayName=new i.Observable(""),this.isModified=new i.Observable((!1)),this.featureSets=new i.ObservableCollection,this.extendedProperties=new i.ObservableCollection,this.id="FSC-{0}".format(r.alphaNumericToken()),this.featureSets.useThrottling=!1}return e.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var i=this.extendedProperties.getAt(t);if(i&&i.name==e)return i.value}return null},e.prototype.setExtendedProperty=function(e,t){for(var i=0;i<this.extendedProperties.getLength();i++){var r=this.extendedProperties.getAt(i);if(r&&r.name==e)return void(r.value=t)}this.extendedProperties.addItem({name:e,value:t})},e.prototype.getFeatureSetById=function(e){return this._getFeatureSetByIdImpl(e)},e.prototype.getFeatureSetByUniqueId=function(e){return this._getFeatureSetByIdImpl(e,!0)},e.prototype.getFeatureSetByLayer=function(e){if(!e)return null;for(var t=0;t<this.featureSets.getLength();++t){var i=this.featureSets.getAt(t),r=i.layer,n=e===r||e&&r&&e.id==r.id,a=e===r||e&&r&&e.mapService===r.mapService||e&&r&&e.mapService&&r.mapService&&e.mapService.id==r.mapService.id;
if(n&&a)return i}return null},e.prototype.getFeatureSetbyEsriLayer=function(e){if(!e)return null;for(var t=0;t<this.featureSets.getLength();++t){var i=this.featureSets.getAt(t);if(i.esriFeatureSet&&i.esriFeatureSet.features&&i.esriFeatureSet.features.length>0&&i.esriFeatureSet.features[0].getLayer()){var r=i.esriFeatureSet.features[0].getLayer();if(r===e)return i}}return null},e.prototype.findFeatureByEsriFeature=function(e){for(var t=0;t<this.featureSets.getLength();t++){var i=this.featureSets.getAt(t).findFeatureByEsriFeature(e);if(i)return i}return null},e.prototype.firstFeature=function(){for(var e=0;e<this.featureSets.getLength();e++){var t=this.featureSets.getAt(e);if(t.features.getLength()>0)return t.features.getAt(0)}return null},e.prototype.countFeatures=function(){for(var e=0,t=0;t<this.featureSets.length();t++)e+=this.featureSets.getAt(t).features.length();return e},e.prototype.clear=function(){for(var e=0;e<this.featureSets.getLength();e++){var t=this.featureSets.getAt(e);t.features.clear()}this.featureSets.clear()},e.prototype.clone=function(e){void 0===e&&(e=!1);for(var t=this.cloneStructure(),i=0;i<this.featureSets.length();i++){var r=e?this.featureSets.getAt(i).clone():this.featureSets.getAt(i);t.featureSets.addItem(r)}return t},e.prototype.cloneStructure=function(){var t=new e;return t.sourceName=this.sourceName,t.displayName.set(this.displayName.get()),t.isModified.set(this.isModified.get()),t.tag=this.tag,this.extendedProperties.getItems().forEach(function(e){return t.setExtendedProperty(e.name,e.value)}),t},e.prototype.unionInPlace=function(e){if(!e||0===e.featureSets.length())return!1;for(var t=this._buildFeatureSetLookup(),i=this._buildLayerLookup(),r=!1,n=0;n<e.featureSets.length();n++){var a=e.featureSets.getAt(n),o=a.id,s=a.layer,l=null;if(o&&t.containsKey(o)&&(l=t.get(o)),!l&&s&&s.mapService){var c=this._generateLayerKey(s.mapService.id,s.id);l=i.get(c)}l?l.unionInPlace(a)&&(r=!0):(this.featureSets.addItem(a),r=!0)}return r},e.prototype.unionManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,i=0;i<e.length;i++)this.unionInPlace(e[i])&&(t=!0);return t},e.prototype.subtractInPlace=function(e){if(!e||0===e.featureSets.length())return!1;for(var t=e._buildFeatureSetLookup(),i=e._buildLayerLookup(),r=!1,n=this.featureSets.length();n--;){var a=this.featureSets.getAt(n),o=a.id,s=a.layer,l=null;if(o&&t.containsKey(o)&&(l=t.get(o)),!l&&s&&s.mapService){var c=this._generateLayerKey(s.mapService.id,s.id);l=i.get(c)}l&&(a.subtractInPlace(l)&&(r=!0),0==a.features.length()&&(this.featureSets.removeAt(n),r=!0))}return r},e.prototype.subtractManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,i=0;i<e.length;i++)this.subtractInPlace(e[i])&&(t=!0);return t},e.prototype.intersectInPlace=function(e){if(!e)return!1;for(var t=e._buildFeatureSetLookup(),i=e._buildLayerLookup(),r=!1,n=this.featureSets.length();n--;){var a=this.featureSets.getAt(n),o=a.id,s=a.layer,l=null;if(o&&t.containsKey(o)&&(l=t.get(o)),!l&&s&&s.mapService){var c=this._generateLayerKey(s.mapService.id,s.id);l=i.get(c)}l?(a.intersectInPlace(l)&&(r=!0),0==a.features.length()&&(this.featureSets.removeAt(n),r=!0)):(this.featureSets.removeAt(n),r=!0)}return r},e.prototype.intersectManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,i=0;i<e.length;i++)this.intersectInPlace(e[i])&&(t=!0);return t},e.prototype._generateLayerKey=function(e,t){return"{0}/{1}".format(e,t)},e.prototype._buildLayerLookup=function(){for(var e=new n.Dictionary,t=0;t<this.featureSets.length();t++){var i=this.featureSets.getAt(t);if(i&&i.layer&&i.layer.mapService){var r=this._generateLayerKey(i.layer.mapService.id,i.layer.id);e.containsKey(r)||e.set(r,i)}}return e},e.prototype._buildFeatureSetLookup=function(){for(var e=new n.Dictionary,t=0;t<this.featureSets.length();t++){var i=this.featureSets.getAt(t);i&&i.id&&!e.containsKey(i.id)&&e.set(i.id,i)}return e},e.prototype._getFeatureSetByIdImpl=function(e,t){void 0===t&&(t=!1);for(var i=0;i<this.featureSets.getLength();++i){var r=this.featureSets.getAt(i);if(t){if(r.uniqueId==e)return r}else if(r.id==e)return r}return null},e}();t.FeatureSetCollection=a})},"geocortex/infrastructure/BrowserUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(){var e=a();return e!==-1&&e<12?e:-1}function r(){var e=a();return e!==-1&&e>=12?e:-1}function n(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function a(){var e=window.navigator.userAgent,t=-1,i=e.indexOf("Trident/");if(i>0){var r=parseInt(e.substring(i+8,e.indexOf(".",i)),10);4===r&&(t=8),5===r&&(t=9),6===r&&(t=10),7===r&&(t=11)}if(t===-1){var n=e.indexOf("MSIE ");n>0&&(t=parseInt(e.substring(n+5,e.indexOf(".",n)),10))}if(t===-1){var a=e.indexOf("Edge/");a>0&&(t=parseInt(e.substring(a+5,e.indexOf(".",a)),10))}return t}t.isIE=i,t.isEdge=r,t.isChrome=n,t.isInternetExplorerOrEdge=a})},"geocortex/infrastructure/ClusterLayer":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/Feature","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/BrowserUtils"],function(e,t,i,r,n,a,o){"use strict";t.ClusterHidingOptions={none:0,unselected:1};var s=function(e){function s(r,n){var a=e.call(this)||this;if(a.gcxLayer=null,a.featureLayer=null,a.singleFeatureLayer=null,a.clusterRadius=new i.Observable(null),a.maxFeaturesInCluster=new i.Observable(null),a.hideClusters=new i.Observable(t.ClusterHidingOptions.none),a.renderer=null,a.rendererInformation=[],a.featureLayerRenderer=null,a._featureLayerGraphics=[],a._clusters=[],a._hiddenClusters=[],a._clusterLabelColor=null,a._clusterBackgroundColor=null,a._featureSetName=null,a._esriEventHandlers=[],a._gcxEventHandlers=[],a._fontSize="10pt",a._fontFamily="Segoe UI, sans-serif",a._clusterExploded=!1,a._mapClickEnabled=!0,a.MAP_CLICK_PREVENTION_DELAY=300,a._isChrome=!1,!(r.mapService.serviceLayer instanceof esri.layers.FeatureLayer))throw new Error("ClusterLayers require an Esri FeatureLayer to be passed in as a parameter.");a.app=n,a.id=r.mapService.id+"-cluster",a._featureSetName=a.id+"FeatureSet",a.gcxLayer=r,a.featureLayer=r.mapService.serviceLayer,a.singleFeatureLayer=new esri.layers.GraphicsLayer,a.url=a.featureLayer.url,a.setVisibility(a.featureLayer.visible&&a.featureLayer.visibleAtMapScale),a.setOpacity(a.featureLayer.opacity),a.featureLayerRenderer=a.featureLayer.renderer,a.featureLayer.setRenderer(null),a.featureLayer.redraw(),a.singleFeatureLayer.id=r.mapService.id+"-explodedClusterLayer",a.singleFeatureLayer.setRenderer(a.featureLayerRenderer),a.singleFeatureLayer.setOpacity(a.featureLayer.opacity),a.singleFeatureLayer.url=a.url,a.clusterRadius.set(r.mapService.featureClustering.radius||50),a.maxFeaturesInCluster.set(r.mapService.featureClustering.maximumFeatures||0),a._clusterLabelColor=new esri.Color(r.mapService.featureClustering.labelColor),a._clusterBackgroundColor=new esri.Color(r.mapService.featureClustering.backgroundColor);for(var s=0;s<4;s++)a.rendererInformation.push({isVisible:new i.Observable((!1)),rangeString:new i.Observable("")});return a.maxFeaturesInCluster.bind(a,function(e){a.gcxLayer.mapService.featureClustering.maximumFeatures=e,a._loadRenderer()}),a.clusterRadius.bind(a,function(e){a.gcxLayer.mapService.featureClustering.radius=e}),a.maxFeaturesInCluster.get()>0&&a._loadRenderer(),a.app.map&&a.app.map.loaded?a._setupEventListeners(a.app.map):a.app.event("MapLoadedEvent").once(a,function(e){a._setupEventListeners(e)}),a._isChrome=o.isChrome(),a.recluster(),a}return __extends(s,e),s.prototype.recluster=function(){this.singleFeatureLayer.clear(),this._clusterExploded=!1,this._featureLayerGraphics=this.featureLayer.graphics.slice(0,this.featureLayer.graphics.length),this._generateClusters(),this.redraw()},s.prototype.destroy=function(){this.app.map.getLayer(this.singleFeatureLayer.id)===this.singleFeatureLayer&&this.app.map.removeLayer(this.singleFeatureLayer),this.app.featureSetManager.getCollectionById(this._featureSetName)&&(this.app.featureSetManager.closeCollection(this._featureSetName),this.app.featureSetManager.removeCollectionById(this._featureSetName)),this.app.map.removeLayer(this),this.featureLayer.setRenderer(this.featureLayerRenderer),this.featureLayer.redraw();for(var e=0;e<this._esriEventHandlers.length;e++)this._esriEventHandlers[e].remove();for(var e=0;e<this._gcxEventHandlers.length;e++)this.app.event(this._gcxEventHandlers[e].eventName).unsubscribe(this._gcxEventHandlers[e].token)},s.prototype.onFeatureClicked=function(e){if(e.graphic instanceof esri.Graphic&&!this.app.toolRegistry.getActiveTool()){var t=e.graphic,i=this.isClusterExploded();this.singleFeatureLayer.clear(),this._addClusterToMapTip(t.attributes.clusterId,i)}},s.prototype.isClusterExploded=function(){return this.singleFeatureLayer.graphics.length>0},s.prototype._addClusterToMapTip=function(e,i){var o=this;this._hiddenClusters=[];var s=[],l=[];this.hideClusters.get()===t.ClusterHidingOptions.none&&i&&this.recluster();for(var c=0;c<this._featureLayerGraphics.length;c++)if(this._featureLayerGraphics[c].attributes.clusterId===e){var u={graphic:this._featureLayerGraphics[c],layer:this.gcxLayer,resolveLayerFields:!0};u.symbol=this._getRenderedSymbol(this._featureLayerGraphics[c]),s.push(new r.Feature(u)),l.push(this._featureLayerGraphics[c])}l.length>1?this._explodeCluster(e,l,i):this.app.command("EnableMapClick").execute();var d=new n.FeatureSet;d.features.set(s),d.layer=this.gcxLayer,d.esriFeatureSet=new esri.tasks.FeatureSet,d.esriFeatureSet.features=l,d.resolveDataLinks(function(e){o.app.event("FeatureChangedEvent").publish(e)});var p=new a.FeatureSetCollection;p.featureSets.addItem(d),p.id=this._featureSetName,p.sourceName="ClusterFeatures",d.features.length()>1&&this.app.command("ScreenReaderNarrate").execute("Cluster with "+d.features.length()+" features exploded"),this.app.featureSetManager.getCollectionById(this._featureSetName)&&this.app.featureSetManager.removeCollectionById(this._featureSetName),this.app.featureSetManager.addCollection(p),this.app.featureSetManager.openCollection(this._featureSetName),this.app.featureSetManager.closeCollection(this._featureSetName)},s.prototype._explodeCluster=function(e,i,r){for(var n=this,a=0;a<i.length;a++)this.singleFeatureLayer.add(i[a]);if(this.hideClusters.get()===t.ClusterHidingOptions.unselected)this._hiddenClusters=this.graphics.slice(0,this.graphics.length),this.clear(),this.redraw();else{for(var o=0;o<this.graphics.length;o++)this.graphics[o].attributes.clusterId==e&&this._hiddenClusters.push(this.graphics[o]);this._hiddenClusters.forEach(function(e){n.remove(e)})}var s=this.app.map.graphicsLayerIds.indexOf(this.featureLayer.id),l=this.app.map.graphicsLayerIds.indexOf(this.id),c=Math.max(s,l);this.app.map.getLayer(this.singleFeatureLayer.id)||this.app.map.addLayer(this.singleFeatureLayer,c+1),this.singleFeatureLayer.redraw(),this._clusterExploded=!0,this._disableMapClick()},s.prototype._implodeCluster=function(){return this.app.stateManager.getActiveStates().filter(function(e){return"EditorActiveState"===e.stateDefinition.name}).length>0?void this.singleFeatureLayer.redraw():(this.recluster(),this.app.command("ScreenReaderNarrate").execute("Exploded cluster was collapsed"),void(this._clusterExploded=!1))},s.prototype._setupEventListeners=function(e){var t=this;this._isChrome?this._gcxEventHandlers.push({eventName:"MapMouseDownEvent",token:this.app.event("MapMouseDownEvent").subscribe(this,function(e){return t._mapMouseDownEvent(e)})}):this._esriEventHandlers.push(e.on("click",function(e){t._mapClickedEvent(e)})),this._gcxEventHandlers.push({eventName:"MapExtentChangedEvent",token:this.app.event("MapExtentChangedEvent").subscribe(this,function(e,i){return t._mapExtentChangedEvent(e,i)})}),this._gcxEventHandlers.push({eventName:"MapTipClosedEvent",token:this.app.event("MapTipClosedEvent").subscribe(this,function(){return t._mapTipClosedEvent()})}),this._gcxEventHandlers.push({eventName:"ClusterLayerRemovedEvent",token:this.app.event("ClusterLayerRemovedEvent").subscribe(this,function(e){return t._clusterLayerRemovedEvent(e)})}),this._gcxEventHandlers.push({eventName:"LayerVisibilityChangedEvent",token:this.app.event("LayerVisibilityChangedEvent").subscribe(this,function(e){return t._layerVisibilityChangedEvent(e)})}),this._gcxEventHandlers.push({eventName:"GeometryEditInvokedEvent",token:this.app.event("GeometryEditInvokedEvent").subscribe(this,function(e){t.isClusterExploded()||t.recluster()})}),this._gcxEventHandlers.push({eventName:"GeometryEditCompletedEvent",token:this.app.event("GeometryEditCompletedEvent").subscribe(this,function(e){return t._handleGeometryChange()})}),this._gcxEventHandlers.push({eventName:"EditorClosedEvent",token:this.app.event("EditorClosedEvent").subscribe(this,function(){return t._handleEditorClosedEvent()})}),this._esriEventHandlers.push(this.featureLayer.on("update-end",function(e){t.isClusterExploded()||t.recluster()}))},s.prototype._handleGeometryChange=function(){this.isClusterExploded()?this.singleFeatureLayer.redraw():this.recluster()},s.prototype._handleEditorClosedEvent=function(){this.isClusterExploded()?this.singleFeatureLayer.redraw():this.recluster()},s.prototype._mapMouseDownEvent=function(e){var t=this;if(this.visible&&(!e.button||0===e.button)){var i=!1,r=!1,n=this.app.event("MapMouseUpEvent").once(this,function(e){i=!0}),a=dojo.connect(this.app.map,"onDblClick",function(e){r=!0});setTimeout(function(){t.app.event("MapMouseUpEvent").unsubscribe(n),dojo.disconnect(a),i&&!r&&t._mapClickedEvent(e)},300)}},s.prototype._mapClickedEvent=function(e){if(this.visible&&null===this.app.toolRegistry.getActiveTool()){if(this._clusterExploded)return this._implodeCluster(),void this._enableMapClick();if(!this._mapClickEnabled)return void this._enableMapClick();this._isChrome&&this.recluster();var t=e&&e.graphic?e.graphic:null;return t&&t.getLayer()===this&&t.attributes&&t.geometry instanceof esri.geometry.Point?(this.app.command("CancelSearch").execute(),this.app.command("DisableMapClick").execute(),t.attributes.clusterId&&t.attributes.clusterCount?void this.onFeatureClicked(e):void this.app.command("ShowMapTip").execute(new r.Feature({graphic:t,layer:this.gcxLayer}))):void 0}},s.prototype._mapExtentChangedEvent=function(e,i){if(!this._currExtent||JSON.stringify(e.toJson())!==JSON.stringify(this._currExtent.toJson())){if(this._currExtent=e,!this.featureLayer.visibleAtMapScale||!this.featureLayer.visible)return this.setVisibility(!1),void this._enableMapClick();this.setVisibility(!0),!this.visible||!this.featureLayer.visibleAtMapScale||this.isClusterExploded()&&this.hideClusters.get()!==t.ClusterHidingOptions.none||(this.isClusterExploded()&&this._enableMapClick(),this.recluster()),this._loadRenderer()}},s.prototype._mapTipClosedEvent=function(){this.visible&&(this._enableMapClick(),this.recluster())},s.prototype._clusterLayerRemovedEvent=function(e){e===this&&this.destroy()},s.prototype._layerVisibilityChangedEvent=function(e){var t=this;e.forEach(function(e){e.layer===t.gcxLayer&&(t.setVisibility(e.visibility&&t.featureLayer.visibleAtMapScale),t._loadRenderer())})},s.prototype._loadRenderer=function(){var e=new esri.renderer.ClassBreaksRenderer(null,"clusterCount"),t=null;if(this.maxFeaturesInCluster.get()>0)t=this.maxFeaturesInCluster.get();else{for(var i=0,r=0;r<this._clusters.length;r++)this._clusters[r].attributes.clusterCount>i&&(i=this._clusters[r].attributes.clusterCount);t=i}var n=Math.ceil(.309999999999*t);1===n&&n++;var a=Math.ceil(.31*t);a<=n&&(a=n+1);var o=Math.ceil(.609999999999*t);o<a&&(o=a);var s=Math.ceil(.61*t);s<=o&&(s=o+1);var l=Math.ceil(.909999999999*t);l<s&&(l=s);var c=Math.ceil(.91*t);c<=l&&(c=l+1),this._addBreak(e,21,2,n,t,0),this._addBreak(e,28,a,o,t,1),this._addBreak(e,35,s,l,t,2),this._addBreak(e,42,c,1/0,t,3),this.setRenderer(e)},s.prototype._addBreak=function(e,t,i,r,n,a){n>=i&&this.visible&&this.featureLayer.visibleAtMapScale?(i!==r?r!==1/0?this.rendererInformation[a].rangeString.set(i+" - "+r):this.rendererInformation[a].rangeString.set(i+"+"):this.rendererInformation[a].rangeString.set(i.toString()),this.rendererInformation[a].isVisible.set(!0)):this.rendererInformation[a].isVisible.set(!1);var o=null;o=8===dojo.isIE?new esri.symbol.SimpleMarkerSymbol({color:this._clusterBackgroundColor.toRgba(),size:t,type:"esriSMS",style:"esriSMSCircle",outline:{color:this._makeTransparent(this._clusterBackgroundColor.toRgba()),width:8,type:"esriSLS",style:"esriSLSSolid"}}):new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(this._makeTransparent(this._clusterBackgroundColor.toRgba())),8),this._clusterBackgroundColor),e.addBreak(i,r,o)},s.prototype._makeTransparent=function(e){return 4===e.length&&(e[3]=.25),e},s.prototype._isValidCluster=function(e,t,i){var r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/i;return r<=this.clusterRadius.get()&&this._isClusterFull(t)},s.prototype._isClusterFull=function(e){return e.attributes.clusterCount<this.maxFeaturesInCluster.get()||0==this.maxFeaturesInCluster.get()||""==this.maxFeaturesInCluster.get().toString()},s.prototype._generateClusters=function(){this.clear(),this._clusters=[],this._addGraphicsToClusters(!1);for(var e=[],t=0;t<this._clusters.length;t++)e[t]={x:this._clusters[t].x,y:this._clusters[t].y,attributes:{clusterCount:0,clusterId:this._clusters[t].attributes.clusterId,extent:this._clusters[t].attributes.extent}};this._clusters=e,this._addGraphicsToClusters(!0),this._showAllClusters()},s.prototype._addGraphicsToClusters=function(e){for(var t=this._featureLayerGraphics.length,i=this.app.map.extent.getWidth()/this.app.map.width,r=0;r<t;r++){var n=null;if(this._featureLayerGraphics[r].geometry instanceof esri.geometry.Point&&this._featureLayerGraphics[r].visible)if(n=this._featureLayerGraphics[r].geometry,this.app.map.extent.contains(n)){for(var a=this._featureLayerGraphics[r],o=[],s=0;s<this._clusters.length;s++){var l=this._clusters[s];this._isValidCluster(n,l,i)&&o.push(l)}if(1===o.length)this._clusterAddPoint(a,n,o[0],e);else if(o.length>1){for(var c=[],s=0;s<o.length;s++)c[s]=Math.sqrt(Math.pow(o[s].x-n.x,2)+Math.pow(o[s].y-n.y,2));for(var u=null,d=null,s=0;s<c.length;s++)(null===d||d>c[s])&&(d=c[s],u=o[s]);this._clusterAddPoint(a,n,u,e)}else this._createCluster(a,n)}else this._featureLayerGraphics[r].attributes.clusterId=-1}},s.prototype._showAllClusters=function(){0!=this.maxFeaturesInCluster.get()&&""!=this.maxFeaturesInCluster.get().toString()||this._loadRenderer();for(var e=0,t=this._clusters.length;e<t;e++)this._showCluster(this._clusters[e])},s.prototype._showCluster=function(e){var t=new esri.geometry.Point(e.x,e.y,this.app.map.spatialReference),i=new esri.Graphic(t,null,e.attributes);if(i.setSymbol(this._getRenderedSymbol(i)),this.add(i),!(e.attributes.clusterCount<2)){var r=0,n=-5,a=null;8===dojo.isIE?(a=new esri.symbol.TextSymbol({type:"esriTS",color:this._clusterLabelColor.toRgba(),xoffset:r,yoffset:n,font:{family:this._fontFamily,size:this._fontSize,weight:"bold"}}),a.setText(e.attributes.clusterCount.toString())):(a=new esri.symbol.TextSymbol(e.attributes.clusterCount),a.setColor(this._clusterLabelColor),a.setOffset(r,n),a.setFont(new esri.symbol.Font(this._fontSize).setFamily(this._fontFamily).setWeight(esri.symbol.Font.WEIGHT_BOLD)));var o=new esri.Graphic(t,a,e.attributes);this.add(o)}},s.prototype._getRenderedSymbol=function(e){var t=e.attributes;if(1!==t.clusterCount)return null;var i=this.featureLayerRenderer;if(!i)return null;if(i instanceof esri.renderer.SimpleRenderer)return i.getSymbol(e);for(var r=0;r<this._featureLayerGraphics.length;r++){var n=this._featureLayerGraphics[r];if(n.attributes.clusterId===e.attributes.clusterId)return i.getSymbol(n)}},s.prototype._clusterAddPoint=function(e,t,i,r){var n,a,o;r||(n=i.attributes.clusterCount,a=(t.x+i.x*n)/(n+1),o=(t.y+i.y*n)/(n+1),i.x=a,i.y=o),t.x<i.attributes.extent[0]?i.attributes.extent[0]=t.x:t.x>i.attributes.extent[2]&&(i.attributes.extent[2]=t.x),t.y<i.attributes.extent[1]?i.attributes.extent[1]=t.y:t.y>i.attributes.extent[3]&&(i.attributes.extent[3]=t.y),i.attributes.clusterCount++,t.hasOwnProperty("attributes")||(t.attributes={}),e.attributes.clusterId=t.attributes.clusterId=i.attributes.clusterId},s.prototype._createCluster=function(e,t){var i=this._clusters.length+1;e.attributes.clusterId=i;var r={x:t.x,y:t.y,attributes:{clusterCount:1,clusterId:i,extent:[t.x,t.y,t.x,t.y]}};this._clusters.push(r)},s.prototype._enableMapClick=function(){var e=this;this.visible&&setTimeout(function(){e.app.command("CancelSearch").execute(),e.app.command("EnableMapClick").execute(),e._mapClickEnabled=!0},this.MAP_CLICK_PREVENTION_DELAY)},s.prototype._disableMapClick=function(){var e=this;this.visible&&setTimeout(function(){e.app.command("DisableMapClick").execute(),e._mapClickEnabled=!1},this.MAP_CLICK_PREVENTION_DELAY)},s}(esri.layers.GraphicsLayer);t.ClusterLayer=s})},"geocortex/infrastructure/GraphicsLayerUtils":function(){define(["require","exports","geocortex/infrastructure/ClusterLayer","geocortex/essentials/utilities/GraphicsLayerUtilities"],function(e,t,i,r){"use strict";function n(e,i,r,n){if(void 0===n&&(n=!0),!r){var a=o(e,!1,i,i.map.graphicsLayerIds.length-d-p-h);return a.layer}if(r===t.GraphicsLayerType.Pushpin){var a=o(e,!0,i,i.map.graphicsLayerIds.length);return a.create&&d++,a.layer}if(r===t.GraphicsLayerType.Label){var a=o(e,!0,i,i.map.graphicsLayerIds.length-d);return a.create&&p++,a.layer}if(r===t.GraphicsLayerType.Highlight){var a=o(e,!0,i,i.map.graphicsLayerIds.length-d-p);return a.create&&h++,a.layer}if(r===t.GraphicsLayerType.Markup){var l=s(e,i,n,i.map.graphicsLayerIds.length-d-p-h);return l}}function a(e,i,r){var n=i.map.getLayer(e);n&&(i.map.removeLayer(n),r===t.GraphicsLayerType.Pushpin&&(0===d||d--),r===t.GraphicsLayerType.Highlight&&(0===h||h--),r===t.GraphicsLayerType.Label&&(0===p||p--))}function o(e,t,i,r){var n=i.map.getLayer(e);return!n&&t?($.isNumeric(r)||(r=i.map.graphicsLayerIds.length-d-p-h),n=new esri.layers.GraphicsLayer,n.id=e,i.map.addLayer(n,r)):t=!1,{layer:n,create:t}}function s(e,t,i,r){var n=t.map.getLayer(e),a=!1;return n||($.isNumeric(r)||(r=t.map.graphicsLayerIds.length-1),n=new esri.layers.GraphicsLayer,n.id=e,t.map.addLayer(n,r),a=!0),i&&l(n,t),n}function l(e,t){if(!t.clickableGraphics.isLayerRegistered(e)){var i={};i.autoEditable=!0,i.displayName=t.getResource("Mapping.Infrastructure","language-clickable-graphics-label-drawing"),t.clickableGraphics.register(e,i)}}function c(e,t){var n=function(t){return e.site.essentialsMap.mapServices.some(function(e){return e.serviceLayer===t||e.serviceLayer instanceof esri.layers.KMLLayer&&e.serviceLayer.getLayers().indexOf(t)>=0})},a=[];return e.map.graphicsLayerIds.forEach(function(o){var s=e.map.getLayer(o);n(s)||s instanceof i.ClusterLayer||s.id.endsWith("-explodedClusterLayer")||r.getGraphicsLayerIdsToExclude(t).indexOf(o)>=0||a.push(s)}),a}function u(e,t,i){if(e){var r=o(t,!1,i);if(r.layer)return r.layer.add(e),r.layer.visible||r.layer.setVisibility(!0),!0}return!1}t.ExcludeFromEnum={WebMapName:"WebMap",ExportApplyStateName:"ExportApplyState",ExportMapTaskName:r.excludeFromExportMapTaskName},t.GraphicsLayerType={Pushpin:"Pushpin",Label:"Label",Highlight:"Highlight",Markup:"Markup"};var d=0,p=0,h=0;t.getInternalGraphicsLayer=n,t.removeInternalGraphicsLayer=a,t.registerMarkupLayerAsClickable=l,t.getGraphicsLayersExceptExcluded=c,t.addGraphicToLayer=u})},"geocortex/infrastructure/GraphicUtils":function(){define(["require","exports","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,i,r){"use strict";function n(e,t){var i,r=t.mapService?"{0}.{1}".format(t.mapService.id,t.id):null;if(r&&R[r])i=R[r];else{i={};for(var n=0;n<t.fields.length;n++){var o=t.fields[n];a(o,t)||(i[o.alias]=o.name)}r&&(R[r]=i)}var s=[];for(var l in i)if(i.hasOwnProperty(l)&&e.attributes.hasOwnProperty(l)){"Null"===e.attributes[l]&&(e.attributes[l]=null);var c=e.attributes[l];if(void 0!==c){var u={alias:l,name:i[l],value:c};u.alias!=u.name&&s.push(u)}}for(var d=0;d<s.length;d++){var p=s[d];delete e.attributes[p.alias],e.attributes[p.name]=p.value}}function a(e,t){if(t&&e&&e.name){if(e.name.indexOf(".Name()",e.name.length-".Name()".length)!==-1)return!0;if(t.getFieldByName(e.name+".Name()"))return!0}return!1}function o(e,t,i,r,n){void 0===n&&(n=!1),s(e,t,i,r,n)}function s(e,t,i,r,n,a,o,s){void 0===n&&(n=!1),void 0===s&&(s="Mapping");var c=[],u=[],d=0,p={},h=function(e){r&&r(e)},m=function(){for(var e=0;e<c.length;e++)if(c[e].visible){if(n&&!c[e].hasOwnProperty("measurementId")){c.splice(e,1);continue}var t=c[e].getLayer();t&&t.remove(c[e])}else c.splice(e,1)};if(!(e&&t&&t.length&&i)){var f="Error deleting markup. Required parameters missing.";return i?i.trace.error(f):console.log(f),void h(c)}for(var g=0;g<t.length;g++){var y=i.map.getLayer(t[g]);y&&u.push(y)}if(!u.length)return i.trace.error("Error deleting markup. No graphics layer(s) found."),void h(c);for(var b=0;b<u.length;b++){var v=l(e,u[b],i);v&&v.length&&(c=c.concat(v))}for(var S=0;S<c.length;S++){var _=c[S];if(_.visible&&(_.hasOwnProperty("measurementId")?p.hasOwnProperty(_.measurementId)||(p[_.measurementId]=!0,d++):n||d++),d>1)break}if(0===d)h(c);else if(1!==d&&a){var I=i.getResource(s,a),w=o?i.getResource(s,o):null;i.command("Confirm").execute(I,w,function(e){e?m():c=[],h(c)})}else m(),h(c)}function l(e,t,i,r,n){void 0===n&&(n=6);var a=null,o=[];if(!e||!t||!i){var s="Error retrieving markup. Required parameters missing.";return i?i.trace.error(s):console.log(s),o}if(!t.graphics.length)return o;if(a=c(e,i,n),null==a)return i.trace.error("Error retrieving markup. Could not compute extent."),o;for(var l=t.graphics,u=0;u<l.length;u++)if(a.intersects(l[u].geometry))o.push(t.graphics[u]);else if(l[u].symbol instanceof esri.symbol.SimpleMarkerSymbol||l[u].symbol instanceof esri.symbol.PictureMarkerSymbol){if(l[u].geometry instanceof esri.geometry.Point)a.intersects(d(l[u],l[u].symbol,i,r||f(l[u],i)))&&o.push(t.graphics[u]);else if(l[u].geometry instanceof esri.geometry.Multipoint)for(var p=h(l[u],i,r||f(l[u],i)),g=0;g<p.length;g++)if(a.intersects(p[g])){o.push(t.graphics[u]);break}}else l[u].symbol instanceof esri.symbol.TextSymbol&&a.intersects(m(l[u],l[u].symbol,i))&&o.push(t.graphics[u]);return o}function c(e,t,i){var r=null;return"point"==e.type?r=b(e,i,t).getExtent():"polyline"==e.type?r=e.getExtent():"polygon"==e.type&&(r=e.getExtent()),null==r&&t.trace.error("Could not compute extent."),r}function u(e,t,r){return new Promise(function(n,a){i.intersects(e,t.geometry).then(function(o){if(o)n(!0);else{var s=t.symbol;if(!s&&t.getLayer()&&t.getLayer().renderer&&(s=t.getLayer().renderer.getSymbol(t)),s instanceof esri.symbol.SimpleMarkerSymbol||s instanceof esri.symbol.PictureMarkerSymbol){if(t.geometry instanceof esri.geometry.Point)i.intersects(e,d(t,s,r,f(t,r))).then(function(e){n(e)},function(e){a(e)});else if(t.geometry instanceof esri.geometry.Multipoint){var l=p(t,s,r,f(t,r));i.intersects(e,l).then(function(e){n(e)},function(e){a(e)})}}else s instanceof esri.symbol.TextSymbol?i.intersects(e,m(t,s,r)).then(function(e){n(e)},function(e){a(e)}):n(!1)}},function(e){a(e)})})}function d(e,t,i,r){var n=b(e.geometry,r,i,t.xoffset,t.yoffset);return n}function p(e,t,i,r){var n=e.geometry,a=(new Array,n.spatialReference),o=new esri.geometry.Polygon(a);return n.points.forEach(function(e){var n=new esri.geometry.Point(e,a),s=b(n,r,i,t.xoffset,t.yoffset).rings;s.forEach(function(e){o.addRing(e)})}),o}function h(e,t,i){for(var r=(e.symbol,e.geometry),n=new Array,a=0;a<r.points.length;a++){var o=new esri.geometry.Point(r.points[a],r.spatialReference);n.push(b(o,i,t,e.symbol.xoffset,e.symbol.yoffset))}return n}function m(e,t,i){var r=i.map.toScreen(e.geometry),n=v(t.text,t.font.family,t.font.size,t.font.weight),a=n.height,o=n.width;switch(r.x+=t.xoffset,r.y-=t.yoffset,t.align){case esri.symbol.TextSymbol.ALIGN_START:var s=new esri.geometry.Point(r.x,r.y-a,null),l=new esri.geometry.Point(r.x+o,r.y-a,null),c=new esri.geometry.Point(r.x,r.y,null),u=new esri.geometry.Point(r.x+o,r.y,null);break;case esri.symbol.TextSymbol.ALIGN_MIDDLE:var s=new esri.geometry.Point(r.x-o/2,r.y-a,null),l=new esri.geometry.Point(r.x+o/2,r.y-a,null),c=new esri.geometry.Point(r.x-o/2,r.y,null),u=new esri.geometry.Point(r.x+o/2,r.y,null);break;case esri.symbol.TextSymbol.ALIGN_END:var s=new esri.geometry.Point(r.x-o,r.y-a,null),l=new esri.geometry.Point(r.x,r.y-a,null),c=new esri.geometry.Point(r.x-o,r.y,null),u=new esri.geometry.Point(r.x,r.y,null)}s=i.map.toMap(s),l=i.map.toMap(l),c=i.map.toMap(c),u=i.map.toMap(u);var d=new esri.geometry.Polygon({rings:[[[s.x,s.y],[l.x,l.y],[u.x,u.y],[c.x,c.y]]],spatialReference:s.spatialReference});return d=y(t.angle,e.geometry,d)}function f(e,t){if(!e)return t&&t.trace.error("cound not compute size of bounding box."),null;var i;i=e.symbol;var r=0,n=0;if(!i&&e.getLayer()&&e.getLayer().renderer){var a=e.getLayer().renderer;i=a.getSymbol(e),r=a.getSize(e);try{n=a.getRotationAngle(e)}catch(o){}}if(i instanceof esri.symbol.SimpleMarkerSymbol)r||(r=i.size),r+=i.outline?i.outline.width:0;else{if(!(i instanceof esri.symbol.PictureMarkerSymbol))return t&&t.trace.error("cound not compute size of bounding box"),null;r||(r=Math.max(i.height,i.width))}return!n&&i.angle&&(n=i.angle),n&&(n=g(n),r*=Math.abs(Math.sin(n))+Math.abs(Math.cos(n))),r}function g(e){return e*(Math.PI/180)}function y(e,t,i){for(var r=new esri.geometry.Polygon(i.toJson()),n=(e<0?360+e:e)%360,a=(360-n)*(Math.PI/180),o=0;o<r.rings.length;o++)for(var s=0;s<r.rings[o].length;s++){var l=r.getPoint(o,s),c=(l.x-t.x)*Math.cos(a)-(l.y-t.y)*Math.sin(a)+t.x,u=(l.x-t.x)*Math.sin(a)+(l.y-t.y)*Math.cos(a)+t.y;l.setX(c),l.setY(u),r.setPoint(o,s,l)}return r}function b(e,t,i,r,n){t=parseFloat(t);var a=i.map.toScreen(e),o=t/2;a.x+=r||0,a.y-=n||0;var s=new esri.geometry.Point(a.x-o,a.y-o,null),l=new esri.geometry.Point(a.x+o,a.y-o,null),c=new esri.geometry.Point(a.x-o,a.y+o,null),u=new esri.geometry.Point(a.x+o,a.y+o,null);s=i.map.toMap(s),l=i.map.toMap(l),c=i.map.toMap(c),u=i.map.toMap(u);var d=new esri.geometry.Polygon({rings:[[[s.x,s.y],[l.x,l.y],[u.x,u.y],[c.x,c.y],[s.x,s.y]]],spatialReference:s.spatialReference});return d}function v(e,t,i,r){void 0===r&&(r="normal");var n=document.body,a=document.createElement("div"),o=void 0!=i&&"number"==typeof i?i+"px":i,s={fontFamily:t,fontSize:o,fontWeight:r,padding:"0",position:"absolute",lineHeight:"1",visibility:"hidden"};for(var l in s)a.style[l]=s[l];a.appendChild(document.createTextNode(e)),n.appendChild(a);var c={width:a.clientWidth,height:a.clientHeight};return n.removeChild(a),c}function S(e){if(e){var t=e.getDojoShape();t&&t.moveToFront()}}function _(e,t){if(t){var i=t.getLayer();if(i&&i instanceof esri.layers.GraphicsLayer&&e.clickableGraphics.isLayerRegistered(i))return!0}return!1}function I(e,t){if(t&&t.esriFeature.get()&&t.esriFeature.get().geometry){var i=x(e,t.esriFeature.get()),r=L(e,t.esriFeature.get(),i),n=C("edit",r),a=i&&i.autoEditable;return n&&!a}return!1}function w(e,t){if(t&&t.esriFeature.get()&&t.esriFeature.get().geometry){var i=x(e,t.esriFeature.get()),r=L(e,t.esriFeature.get(),i),n=C("edit",r),a=i&&i.autoEditable;return n&&a}return!1}function x(e,t){var i=null,r=t?t.getLayer():null;return r&&r instanceof esri.layers.GraphicsLayer&&e.clickableGraphics.isLayerRegistered(r)&&(i=e.clickableGraphics.getLayerInfo(r)),i}function L(e,t,i){var r=[];return i||(i=x(e,t)),i&&"function"==typeof i.canEdit&&i.canEdit(t)&&r.push("edit"),i&&"function"==typeof i.canDelete&&i.canDelete(t)&&r.push("delete"),i&&"function"==typeof i.canChangeStyles&&i.canChangeStyles(t)&&r.push("style"),r}function C(e,t){return t&&t.some(function(t){return t==e})}function M(e,t,i){return t?r.getInternalGraphicsLayer(e,i,r.GraphicsLayerType.Markup):r.getInternalGraphicsLayer(e,i);
}function F(e,t){return r.getInternalGraphicsLayer(e,t,r.GraphicsLayerType.Markup)}function E(e){var t=["snapping_graphics","snapping_helper_graphics","DefaultPushpinsLayer"],i=e.highlightManager.getHighlightLayers();for(var n in i)t.push(i[n].id);return r.getGraphicsLayersExceptExcluded(e,t)}function T(e,t,i){return r.addGraphicToLayer(e,t,i)}var R={};t.sanitizeAttributeNames=n,t._isSEPCodedDomainField=a,t.deleteMarkupSilently=o,t.deleteMarkup=s,t.getMarkupFromGeometry=l,t.getExtentFromGeometry=c,t.geometryIntersectsGraphic=u,t._getEnhancedGeometryOfPointGraphic=d,t._getenhancedPolygonGeometryOfMultipoint=p,t._getEnhancedGeometriesOfMultiPoint=h,t._getEnhancedGeometryOfTextGraphic=m,t.getBoundingBoxSize=f,t._toRadians=g,t.rotatePolygon=y,t.getPolygonFromPoint=b,t.getRenderedTextMarkupSize=v,t.moveGraphicToTop=S,t.isClickableGraphic=_,t.isEditableButNotAutoEditableClickableFeature=I,t.isAutoEditableClickableFeature=w,t.getClickableLayerInfo=x,t.getCapabilitiesForGraphic=L,t.getGraphicsLayer=M,t.getMarkupLayer=F,t.getUserGraphicsLayers=E,t.addGraphicToLayer=T})},"geocortex/infrastructure/accessibility/Edit":function(){define(["require","exports","geocortex/infrastructure/accessibility/AccessibleMapComponent","geocortex/infrastructure/accessibility/GraphicMover","geocortex/infrastructure/accessibility/BoxEditor","geocortex/infrastructure/tools/MapTool","geocortex/infrastructure/tools/DrawMode","geocortex/framework/utils/utils","geocortex/infrastructure/accessibility/InputMethod","geocortex/infrastructure/accessibility/VertexEditorFactory","geocortex/infrastructure/GraphicUtils"],function(e,t,i,r,n,a,o,s,l,c,u){"use strict";var d=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;n._editObject=null,n._options=null,n._defaultOptions=null,n._tool=0,n._isTextPoint=!1,n._editHandle=[],n._isGeo=!1,n._active=!1,n._modified=!1,n._cancelled=!1,n._needsRefresh=!1,n._handles=[],n._snappingFeedbackEventToken=null,n._lastSnapPoint=null,n._graphicMover=null,n._vertexEditor=null,n._boxEditor=null,n._symbolChangeHandle=null,n._editNotificationViewId="edit-notification-view";var a=Modernizr&&!!Modernizr.touch,o={vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([128,128,128])),ghostVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?18:10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([255,255,255,.75])),ghostLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DOT,new esri.Color([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,narrateKeyboardShortcuts:!0,rotateHandleOffset:a?24:16,boxLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new esri.Color([64,64,64]),1),boxHandleSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,a?16:9,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([255,255,255,.75])),textAnchorSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,null,new esri.Color([255,0,0])),selectedVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?25:15,null,new esri.Color([0,0,255,.75]))};return n._defaultOptions=dojo.mixin(o,i||{}),n._editObject=new esri.toolbars.Edit(t,i),n._addPointerEventsOnRedraw(),n}return __extends(t,e),t.prototype._addPointerEventsOnRedraw=function(){var e=this,t=this.app.site.getMap().graphics;t.on("graphic-draw",function(t){if(e._editHandle&&e._editHandle.length>0)for(var i=0;i<e._editHandle.length;i++)t.graphic===e._editHandle[i]&&$(e._editHandle[i].getNode()).css("pointer-events","none")})},t.prototype.activate=function(e,i,r){var n=this;if(this.deactivate(),this.app&&(this._snappingFeedbackEventToken=this.app.event("SnappingFeedbackEvent").subscribe(this,function(e){e&&e.snappingPoint?n._lastSnapPoint=e.snappingPoint:n._lastSnapPoint=null})),this._active=!0,this._graphic=i,this._tool=e,this._options=dojo.mixin(dojo.mixin({},this._defaultOptions),r||{}),e>0){var a=this._map.spatialReference,o=i&&i.geometry?i.geometry.spatialReference:null;if(this._isGeo=a&&o&&!a.equals(o)&&a.isWebMercator()&&4326===o.wkid,i&&i.geometry&&"point"===i.geometry.type){var s=this._getSymbol(i);this._isTextPoint=s&&"textsymbol"===s.type}else this._isTextPoint=!1;i&&i.geometry&&"multipoint"===i.geometry.type&&(this._options.allowAddVertices=!1),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicClick",dojo.hitch(this,"_onGraphicClickImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicFirstMove",dojo.hitch(this,"_onGraphicFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMove",dojo.hitch(this,"_onGraphicMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMoveStart",dojo.hitch(this,"_onGraphicMoveStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMoveStop",dojo.hitch(this,"_onGraphicMoveStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotate",dojo.hitch(this,"_onRotateImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateFirstMove",dojo.hitch(this,"_onRotateFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateStart",dojo.hitch(this,"_onRotateStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateStop",dojo.hitch(this,"_onRotateStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScale",dojo.hitch(this,"_onScaleImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleFirstMove",dojo.hitch(this,"_onScaleFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleStart",dojo.hitch(this,"_onScaleStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleStop",dojo.hitch(this,"_onScaleStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexAdd",dojo.hitch(this,"_onVertexAddImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexClick",dojo.hitch(this,"_onVertexClickImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexDelete",dojo.hitch(this,"_onVertexDeleteImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexFirstMove",dojo.hitch(this,"_onVertexFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMouseOut",dojo.hitch(this,"_onVertexMouseOutImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMouseOver",dojo.hitch(this,"_onVertexMouseOverImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMove",dojo.hitch(this,"_onVertexMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMoveStart",dojo.hitch(this,"_onVertexMoveStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMoveStop",dojo.hitch(this,"_onVertexMoveStopImpl"),!0)),this._symbolChangeHandle=this.app.event("GraphicSymbolChangedEvent").subscribe(this,this._updateSizePointEditHandles),this.activateMouseControls(),this.activateKeyboardControls();var l=!1,c=!1,u=!1;(e&t.MOVE)===t.MOVE&&(l=this._enableMove(i));var d=(e&t.SCALE)===t.SCALE,p=(e&t.ROTATE)===t.ROTATE;if((d||p)&&(c=this._enableBoxEditing(i,d,p)),(e&t.EDIT_VERTICES)===t.EDIT_VERTICES&&(u=this._enableVertexEditing(i)),(e&t.EDIT_TEXT)===t.EDIT_TEXT,!l&&!c&&!u)throw new Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");this.onKeyboardStart(),this._updateToolStatusMessage(),this._addPointEditHandles(i),this.onActivate(e,i);var h={sender:this,graphic:i,tool:e};this.raiseGraphicEditActivated(h)}},t.prototype._addPointEditHandles=function(e){if(e.getLayer()!=this.app.map.graphics&&this._graphic==e&&this._tool>0&&("point"===e.geometry.type||"multipoint"===e.geometry.type)){var t,i,r=e.getLayer(),n=r.renderer,a=44;if(t=e.symbol?e.symbol:n.getSymbol(e),"textsymbol"===t.type)return;i=u.getBoundingBoxSize(e,this.app),i=1.5*i,i<a&&(i=a);var o=i/4;this._editHandle.push(this._getTargetGraphic(e,t,i,o,esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color("#FFFFFF"))),this._editHandle.push(this._getTargetGraphic(e,t,i,o,esri.symbol.SimpleLineSymbol.STYLE_DASH,new esri.Color("#000000")));var s=this.app.site.getMap().graphics;s.add(this._editHandle[0]),s.add(this._editHandle[1]),$(this._editHandle[0].getNode()).css("pointer-events","none"),$(this._editHandle[1].getNode()).css("pointer-events","none")}},t.prototype._calculatePath=function(e,t){var i=e/2;return"M 0 0 "+e+" 0 "+e+" "+e+" 0 "+e+" 0 0M "+(0-t)+" "+i+" 0 "+i+"M "+i+" "+(e+t)+" "+i+" "+e+"M "+(e+t)+" "+i+" "+e+" "+i+"M "+i+" 0 "+i+" "+(0-t)},t.prototype._getTargetGraphic=function(e,t,i,r,n,a){var o=new esri.Graphic;o.setGeometry(esri.geometry.fromJson(e.geometry.toJson()));var s=new esri.symbol.SimpleMarkerSymbol;if(s.setOutline(new esri.symbol.SimpleLineSymbol(n,a,2)),s.setColor(new esri.Color([0,0,0,0])),s.setPath(this._calculatePath(i,r)),s.setSize(i),t){var l=t.xoffset||0,c=t.yoffset||0;s.setOffset(l,c)}return o.setSymbol(s),o},t.prototype.deactivate=function(){var e=this._tool;if(this._active=!1,this.app&&this._snappingFeedbackEventToken&&(this.app.event("SnappingFeedbackEvent").unsubscribe(this._snappingFeedbackEventToken),this._snappingFeedbackEventToken=null),e>0){var t=this._modified,i=this._cancelled,r=this._graphic;if(this._graphicMover&&this._graphicMover.hasMoved()&&this._adjustGraphicMoverPoint(r,this._lastSnapPoint),this._symbolChangeHandle&&this.app.event("GraphicSymbolChangedEvent").unsubscribe(this._symbolChangeHandle),this._symbolChangeHandle=null,this._removePointEditHandles(r),this._clear(),this._graphic=null,this._isGeo=this._isTextPoint=!1,this.deactivateMouseControls(),this.deactivateKeyboardControls(),this.app.toolRegistry&&this.app.toolRegistry.getActiveTool){var n=this.app.toolRegistry.getActiveTool();if(n instanceof a.MapTool){var s=n;s.drawMode===o.DrawMode.EXTENT&&r.setGeometry(this._convertPolygonToExtent(r.geometry))}}this.onDeactivate(e,r,{isModified:t,cancelled:i});var l={sender:this,graphic:r,tool:e,isModified:t,cancelled:i};this.raiseGraphicEditDeactivated(l)}},t.prototype._removePointEditHandles=function(e){if(this._graphic===e&&0!=this._editHandle.length){var t=this.app.site.getMap().graphics;this._editHandle.forEach(function(e){return t.remove(e)}),this._editHandle=[]}},t.prototype._hidePointEditHandles=function(e){this._graphic===e&&0!=this._editHandle.length&&this._editHandle.forEach(function(e){return e.hide()})},t.prototype._showPointEditHandles=function(e){this._graphic===e&&0!=this._editHandle.length&&(this._editHandle.forEach(function(e){return e.show()}),$(this._editHandle[0].getNode()).css("pointer-events","none"),$(this._editHandle[1].getNode()).css("pointer-events","none"))},t.prototype._updateLocationPointEditHandles=function(e){this._graphic===e&&0!=this._editHandle.length&&this._editHandle.forEach(function(t){t.setGeometry(esri.geometry.fromJson(e.geometry.toJson()))})},t.prototype._updateSizePointEditHandles=function(e){this._graphic===e&&(e.symbol instanceof esri.symbol.TextSymbol||(this._removePointEditHandles(e),this._addPointEditHandles(e)))},t.prototype._convertPolygonToExtent=function(e){return e.getExtent?e.getExtent():(this.app.trace.warning("Tried to convert polygon to extent, but failed. Polygon object lacks getExtent() method."),null)},t.prototype.getOptions=function(){return this._options||this._defaultOptions||{}},t.prototype.getCurrentState=function(){return{tool:this._tool,graphic:this._graphic,isModified:this._modified}},t.prototype.getEnabledTools=function(){return[this._graphicMover,this._boxEditor,this._vertexEditor].filter(function(e){return!s.isNullOrUndefined(e)})},t.prototype.refresh=function(){this._editObject.refresh(),this._needsRefresh=!1,this._updateLocationPointEditHandles(this._graphic)},t.prototype.setNeedsRefresh=function(e){this._needsRefresh=e},t.prototype.suspend=function(){e.prototype.suspend.call(this),this.getEnabledTools().forEach(function(e){return e.suspend()})},t.prototype.resume=function(){e.prototype.resume.call(this),this.getEnabledTools().forEach(function(e){return e.resume()})},t.prototype.isActive=function(){return this._active},t.prototype.activateMouseControls=function(t){if(void 0===t&&(t=!0),e.prototype.activateMouseControls.call(this,t),!(this._tool>0))throw new Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");this._editObject.__attached_stopEvent=!0,this._editObject.activate(this._tool,this._graphic,this._options)},t.prototype.deactivateMouseControls=function(t){void 0===t&&(t=!0),e.prototype.deactivateMouseControls.call(this,t),this._editObject.__attached_stopEvent=!0,this._editObject.deactivate()},t.prototype.on=function(e,t){throw new Error("[geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Edit] On style events not implemented yet. Use connect instead.")},t.prototype.onActivate=function(e,t){},t.prototype.onDeactivate=function(e,t,i){},t.prototype.onGraphicClick=function(e,t){},t.prototype._onGraphicClickImpl=function(e,t){this.onGraphicClick(e,t)},t.prototype.onGraphicFirstMove=function(e){this._modified=!0},t.prototype._onGraphicFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onGraphicFirstMove(e)},t.prototype.onGraphicMove=function(e,t){},t.prototype._onGraphicMoveImpl=function(e,t){this.onGraphicMove(e,t)},t.prototype.onGraphicMoveStart=function(e){},t.prototype._onGraphicMoveStartImpl=function(e){e&&e.geometry&&"point"==e.geometry.type&&this._hidePointEditHandles(e),this.onGraphicMoveStart(e)},t.prototype.onGraphicMoveStop=function(e,t){var i={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(i)},t.prototype._onGraphicMoveStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),e&&e.geometry&&"point"==e.geometry.type&&(this._updateLocationPointEditHandles(e),this._showPointEditHandles(e)),this.onGraphicMoveStop(e,t)},t.prototype.onRotate=function(e,t){},t.prototype._onRotateImpl=function(e,t){this.onRotate(e,t)},t.prototype.onRotateFirstMove=function(e){this._modified=!0},t.prototype._onRotateFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onRotateFirstMove(e)},t.prototype.onRotateStart=function(e){},t.prototype._onRotateStartImpl=function(e){this.onRotateStart(e)},t.prototype.onRotateStop=function(e,t){var i={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(i)},t.prototype._onRotateStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onRotateStop(e,t)},t.prototype.onScale=function(e,t){},t.prototype._onScaleImpl=function(e,t){this.onScale(e,t)},t.prototype.onScaleFirstMove=function(e){this._modified=!0},t.prototype._onScaleFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onScaleFirstMove(e)},t.prototype.onScaleStart=function(e){},t.prototype._onScaleStartImpl=function(e){this.onScaleStart(e)},t.prototype.onScaleStop=function(e,t){var i={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(i)},t.prototype._onScaleStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onScaleStop(e,t)},t.prototype.onVertexAdd=function(e,t){this._modified=!0,null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this._vertexEditor.refresh(!0),this._vertexEditor.onVertexAdd(t),this._vertexEditor.showVertexHandle())},t.prototype._onVertexAddImpl=function(e,t){this.onVertexAdd(e,t)},t.prototype.onVertexClick=function(e,t){},t.prototype._onVertexClickImpl=function(e,t){this.onVertexClick(e,t)},t.prototype.onVertexDelete=function(e,t){this._modified=!0,null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this._vertexEditor.refresh(!0),this._vertexEditor.onVertexDelete(t),this._vertexEditor.showVertexHandle())},t.prototype._onVertexDeleteImpl=function(e,t){this.onVertexDelete(e,t)},t.prototype.onVertexFirstMove=function(e,t){this._modified=!0},t.prototype._onVertexFirstMoveImpl=function(e,t){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onVertexFirstMove(e,t)},t.prototype.onVertexMouseOut=function(e,t){},t.prototype._onVertexMouseOutImpl=function(e,t){this.onVertexMouseOut(e,t)},t.prototype.onVertexMouseOver=function(e,t){},t.prototype._onVertexMouseOverImpl=function(e,t){this.onVertexMouseOver(e,t)},t.prototype.onVertexMove=function(e,t,i){t&&t.graphic&&this.app.event("EditVertexHandleMovedEvent").publish(t.graphic)},t.prototype._onVertexMoveImpl=function(e,t,i){this.onVertexMove(e,t,i)},t.prototype.onVertexMoveStart=function(e,t){},t.prototype._onVertexMoveStartImpl=function(e,t){e&&e.geometry&&"multipoint"==e.geometry.type&&this._hidePointEditHandles(e),this.onVertexMoveStart(e,t)},t.prototype.onVertexMoveStop=function(e,t,i){null!==this._vertexEditor&&this._vertexEditor.isActive()&&!t.isGhost&&(this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle());var r={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(r)},t.prototype._onVertexMoveStopImpl=function(e,t,i){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume()),e&&e.geometry&&"multipoint"==e.geometry.type&&(this._updateLocationPointEditHandles(e),this._showPointEditHandles(e)),this.onVertexMoveStop(e,t,i)},t.prototype.onKeyboardStart=function(){e.prototype.onKeyboardStart.call(this)},t.prototype.onKeyboardStop=function(t){void 0===t&&(t=!1),e.prototype.onKeyboardStop.call(this,t),this._cancelled=t,this.deactivate()},t.prototype._onKeyDown=function(t){if(e.prototype._onKeyDown.call(this,t),!this.suspended&&this._active&&this.inputMethod!==l.InputMethod.MOUSE){var i=!1,r=t.keyCode||t.which;switch(r){case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:this.toggleKeyboardMode(),i=!0;break;case dojo.keys.ESCAPE:this.onKeyboardStop(!0),i=!0}i&&(t.preventDefault(),t.stopPropagation())}},t.prototype.raiseGraphicEditActivated=function(e){this.app.event("GraphicEditActivatedEvent").publish(e)},t.prototype.raiseGraphicEditDeactivated=function(e){this.app.event("GraphicEditDeactivatedEvent").publish(e)},t.prototype._updateToolStatusMessage=function(){if(this._graphic&&this._graphic.geometry&&"point"!==this._graphic.geometry.type){var e=null;if(this.app.toolRegistry&&this.app.toolRegistry.getActiveTool()){var t=this.app.toolRegistry.getActiveTool(),i=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-zoomin-tool"),r=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-zoomout-tool");t.name!==i&&t.name!==r||(e=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-desc-shortcuts-zoom"))}if(e){var n={id:this._editNotificationViewId,text:e,closeButton:{}};this.app.command("DisplayNotification").execute(n),this._options.narrateKeyboardShortcuts&&this.app.command("ScreenReaderNarrate").execute(e)}}},t.prototype._clear=function(){this._disableMove(),this._disableBoxEditing(),this._disableVertexEditing(),this._tool=0,this._modified=!1,this._cancelled=!1,this.suspended=!1,this.setInputMethod(null)},t.prototype._getSymbol=function(e){if(e){var t=e.symbol;if(t)return t;var i=e.getLayer()?e.getLayer().renderer:null;if(i)return i.getSymbol(e)}return null},t.prototype._enableMove=function(e){switch(e.geometry.type){case"point":var t=this._isTextPoint&&this._editObject._textAnchor?this._editObject._textAnchor:null;return this._graphicMover=new r.GraphicMover(e,this._map,this,t),!0;case"polyline":case"polygon":return this._graphicMover=new r.GraphicMover(e,this._map,this,null),!0}return!1},t.prototype._enableBoxEditing=function(e,t,i){var r={scaleEnabled:t,rotateEnabled:i,uniformScaling:this._options.uniformScaling,boxHandleSymbol:this._options.boxHandleSymbol,boxLineSymbol:this._options.boxLineSymbol};return!!(this._isTextPoint||["polyline","polygon"].indexOf(e.geometry.type)>-1)&&(this._boxEditor=new n.BoxEditor(e,this._map,this,this._isTextPoint,r),!0)},t.prototype._enableVertexEditing=function(e){var t={allowAddVertices:this._options.allowAddVertices,allowDeleteVertices:this._options.allowDeleteVertices,selectedVertexSymbol:this._options.selectedVertexSymbol};switch(e.geometry.type){case"multipoint":case"polyline":case"polygon":return this._vertexEditor=c.createVertexEditor(e,this._map,this,t),!0}return!1},t.prototype._adjustGraphicMoverPoint=function(e,t){t&&e&&t instanceof esri.geometry.Point&&e.geometry instanceof esri.geometry.Point&&e.setGeometry(t)},t.prototype._disableMove=function(){this._graphicMover&&(this._graphicMover.destroy(),this._graphicMover=null)},t.prototype._disableBoxEditing=function(){this._boxEditor&&(this._boxEditor.destroy(),this._boxEditor=null)},t.prototype._disableVertexEditing=function(){this._vertexEditor&&(this._vertexEditor.destroy(),this._vertexEditor=null)},t}(i.AccessibleMapComponent);d._edit=function(){e(["esri/toolbars/edit"],function(e){d.EDIT_TEXT=e.EDIT_TEXT,d.EDIT_VERTICES=e.EDIT_VERTICES,d.MOVE=e.MOVE,d.ROTATE=e.ROTATE,d.SCALE=e.SCALE})}(),t.Edit=d})},"geocortex/infrastructure/eventArgs/GraphicDrawActivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GraphicDrawDeactivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GraphicVertexAddedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GraphicVertexMovedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/accessibility/Draw":function(){define(["require","exports","geocortex/infrastructure/accessibility/AccessibleMapComponent","geocortex/infrastructure/accessibility/Edit","geocortex/infrastructure/accessibility/InputMethod","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r,n,a){"use strict";var o=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;n.respectDrawingVertexOrder=!1,n._arrowShapeTemplate=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],n._leftArrowShapeTemplate=[[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],n._rightArrowShapeTemplate=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],n._upArrowShapeTemplate=[[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],n._downArrowShapeTemplate=[[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],n._triangleShapeTemplate=[[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],n._rectangleShapeTemplate=[[0,-48],[96,-48],[96,0],[0,0],[0,-48]],n._drawObject=null,n._editObject=null,n._options=null,n._defaultOptions=null,n._active=!1,n._graphic=null,n._createGeometryDeferred=null,n._isPlottingPolyGeometry=!1,n._lastVertexPosition=null,n._vertexAnchor=null,n._ghostLine=null,n._handles=[],n._polyGeometryKeyDownHandle=null,n._editCompletedHandle=null,n._dblClickHandlerToken=null,n._lastSnappingPoint=null;var a=Modernizr&&!!Modernizr.touch,o={enableEditing:!0,vertexOffsetX:10,vertexOffsetY:10,preciseVertexOffsetX:1,preciseVertexOffsetY:1,vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([128,128,128])),selectedVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?25:15,null,new esri.Color([0,0,255,.75]))};return n._defaultOptions=dojo.mixin(o,i||{}),n._points=[],n._drawObject=new esri.toolbars.Draw(e,i),n._twoClicksWithin300MsFixup(),n._editObject=new s(e,null,r),n.fillSymbol=n._drawObject.fillSymbol,n.lineSymbol=n._drawObject.lineSymbol,n.markerSymbol=n._drawObject.markerSymbol,n.respectDrawingVertexOrder=n._drawObject.respectDrawingVertexOrder,n.setVertexSymbol(n._defaultOptions.vertexSymbol),n.setSelectedVertexSymbol(n._defaultOptions.selectedVertexSymbol),n.app&&n.app.event("SnappingFeedbackEvent").subscribe(n,n._handleSnappingEvent),n}return __extends(i,t),i.createEllipse=function(e){for(var t=e.center,i=e.longAxis||48,r=e.shortAxis||24,n=e.numberOfPoints||60,a=e.map,o=[],s=2*Math.PI/n,l=0;l<n;l++){var c=Math.cos(l*s),u=Math.sin(l*s),d=a.toMap(new esri.geometry.ScreenPoint({x:i*c+t.x,y:r*u+t.y}));o.push(d)}o.push(o[0]);var p=new esri.geometry.Polygon(a.spatialReference);return p.addRing(o),p},i.createCircle=function(e){return i.createEllipse({center:e.center,longAxis:e.radius,shortAxis:e.radius,numberOfPoints:e.numberOfPoints,map:e.map})},i.prototype.activate=function(e,t){var r=this;(this._active||this._geometryType)&&this.deactivate(),this._handles.push(this.app.map.on("click",function(e){return r.app.trace.debug("[DrawTool] map-click")})),this._handles.push(this.app.map.on("dbl-click",function(e){return r.app.trace.debug("[DrawTool] map-double-click")})),this._active=!0,this._geometryType=e,this._options=dojo.mixin(dojo.mixin({},this._defaultOptions),t||{}),e===i.MULTI_POINT&&(this._options.enableEditing=!1),this.setVertexSymbol(this._options.vertexSymbol),this.setSelectedVertexSymbol(this._options.selectedVertexSymbol),this._handles.push(dojo.aspect.after(this._drawObject,"onDrawEnd",dojo.hitch(this,"onDrawEnd"),!0)),this._handles.push(dojo.aspect.after(this._drawObject,"onDrawComplete",dojo.hitch(this,"onDrawComplete"),!0)),this._drawObject&&"function"==typeof this._drawObject._onClickHandler&&this._handles.push(dojo.aspect.after(this._drawObject,"_onClickHandler",dojo.hitch(this,"_onClickHandler"),!0)),this._extraPointOnTouchDevicesFixup(),this.activateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.activateKeyboardControls(),this.onActivate(),this.raiseGraphicDrawActivated({sender:this,geometryType:e})},i.prototype.deactivate=function(){var e=this._geometryType;this._active=!1,this._clear(),this.setInputMethod(null),this._dblClickHandlerToken&&(this._dblClickHandlerToken.remove(),this._dblClickHandlerToken=null),this._handles.forEach(function(e){e.remove()}),this._handles.length=0,this._geometryType=this.vertexSymbol=this.selectedVertexSymbol=null,this.onDeactivate(),this.raiseGraphicDrawDeactivated({sender:this,geometryType:e})},i.prototype.finishDrawing=function(){switch(this.inputMethod){case n.InputMethod.MOUSE:this._drawObject.finishDrawing(),this._syncPointsCollection();break;case n.InputMethod.KEYBOARD:this._finishKeyboardDrawing()}},i.prototype.setFillSymbol=function(e){this.fillSymbol=e,this._drawObject.setFillSymbol(e)},i.prototype.setLineSymbol=function(e){this.lineSymbol=e,this._drawObject.setLineSymbol(e)},i.prototype.setMarkerSymbol=function(e){this.markerSymbol=e,this._drawObject.setMarkerSymbol(e)},i.prototype.setRespectDrawingVertexOrder=function(e){this.respectDrawingVertexOrder=e,this._drawObject.setRespectDrawingVertexOrder(e)},i.prototype.setVertexSymbol=function(e){this.vertexSymbol=e},i.prototype.setSelectedVertexSymbol=function(e){this.selectedVertexSymbol=e},i.prototype.activateMouseControls=function(e){void 0===e&&(e=!0),t.prototype.activateMouseControls.call(this,e),this._geometryType&&(this._drawObject.__attached_stopEvent=!0,this._drawObject.activate(this._geometryType,this._options))},i.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),t.prototype.deactivateMouseControls.call(this,e),this._drawObject.__attached_stopEvent=!0,this._drawObject.deactivate()},i.prototype.raiseGraphicDrawActivated=function(e){this.app.event("GraphicDrawActivatedEvent").publish(e)},i.prototype.raiseGraphicDrawDeactivated=function(e){this.app.event("GraphicDrawDeactivatedEvent").publish(e)},i.prototype.raiseGraphicVertexAdded=function(e){this.app.event("GraphicVertexAddedEvent").publish(e)},i.prototype.raiseGraphicVertexMoved=function(e){this.app.event("GraphicVertexMovedEvent").publish(e)},i.prototype.on=function(e,t){throw new Error("[geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibilit.Draw::on] On style events not implemented yet. Use connect instead.")},i.prototype.onActivate=function(){},i.prototype.onDeactivate=function(){},i.prototype.onDrawComplete=function(e){this.inputMethod==n.InputMethod.MOUSE&&this._clear()},i.prototype.onDrawEnd=function(e){this.app.trace.debug("[DrawTool] Number of vertices drawn "+this._vertexCount(e)),this.inputMethod==n.InputMethod.MOUSE&&this._clear(),this.app.event("GraphicDrawCompletedEvent").publish(e)},i.prototype.onKeyboardStart=function(){var e=this;t.prototype.onKeyboardStart.call(this),this.deactivateMouseControls();var i=this._map.extent.getCenter();this._plotShape(i,this._geometryType).then(function(t){return e._editShape(t)})},i.prototype.onKeyboardStop=function(e){if(void 0===e&&(e=!1),t.prototype.onKeyboardStop.call(this,e),this._graphic&&!e){var i=this._graphic.geometry;this._clear(),this._drawEnd(i)}else this._clear()},i.prototype._onKeyDown=function(e){if(t.prototype._onKeyDown.call(this,e),!this.suspended&&this._active&&this.inputMethod!==n.InputMethod.MOUSE){var i=!1,r=e.keyCode||e.which;switch(r){case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:this.toggleKeyboardMode(),i=!0;break;case dojo.keys.ESCAPE:this.onKeyboardStop(!0),i=!0}i&&(e.preventDefault(),e.stopPropagation())}},i.prototype._onClickHandler=function(e){this.inputMethod===n.InputMethod.MOUSE&&this._syncPointsCollection()},i.prototype._supportsKeyboardInput=function(e){switch(e){case i.ARROW:case i.CIRCLE:case i.DOWN_ARROW:case i.ELLIPSE:case i.EXTENT:case i.LEFT_ARROW:case i.MULTI_POINT:case i.POINT:case i.POLYGON:case i.POLYLINE:case i.RECTANGLE:case i.RIGHT_ARROW:case i.TRIANGLE:case i.UP_ARROW:return!0}return!1},i.prototype._finishKeyboardDrawing=function(e){if(void 0===e&&(e=!0),this._active){var t,r=this._map.spatialReference,n=this._points.slice(0,this._points.length);switch(this._geometryType){case i.POLYLINE:if(!this._graphic||n.length<2)return;t=new esri.geometry.Polyline(r),t.addPath(n),this._graphic.setGeometry(t);break;case i.POLYGON:if(!this._graphic||n.length<2)return;n.push(n[0].offset(0,0)),esri.geometry.Polygon.prototype.isClockwise(n)||this.respectDrawingVertexOrder||(this.app.trace.debug("Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),n.reverse()),t=new esri.geometry.Polygon(r),t.addRing(n),this._graphic.setGeometry(t);break;case i.MULTI_POINT:t=new esri.geometry.Multipoint(r),n.forEach(function(e){t.addPoint(e)}),this._graphic.setGeometry(t);break;default:if(!this._graphic||!this._graphic.geometry)return;t=this._graphic.geometry}e&&this.onKeyboardStop()}},i.prototype._clear=function(){this._graphic&&this._map.graphics.remove(this._graphic),this._ghostLine&&this._map.graphics.remove(this._ghostLine),this._vertexAnchor&&this._map.graphics.remove(this._vertexAnchor),this._editCompletedHandle&&this._editCompletedHandle.remove(),this._polyGeometryKeyDownHandle&&this._polyGeometryKeyDownHandle.remove(),this._editObject&&this._editObject.deactivate(),this._polyGeometryKeyDownHandle=this._editCompletedHandle=this._createGeometryDeferred=this._graphic=this._vertexAnchor=this._ghostLine=null,
this._isPlottingPolyGeometry=!1,this._lastVertexPosition=null,this.suspended=!1,this._points.length=0,this.deactivateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.deactivateKeyboardControls(),this.setInputMethod(null),this._active&&(this.activateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.activateKeyboardControls())},i.prototype._drawEnd=function(e){if(e){this.onDrawEnd(e);var t,i=this._map.spatialReference;i&&(i.isWebMercator()?t=esri.geometry.webMercatorToGeographic(e):4326===i.wkid&&(t=esri.geometry.fromJson(e.toJson()))),this.onDrawComplete({geometry:e,geographicGeometry:t})}},i.prototype._moveVertexAnchor=function(e,t){if(this._vertexAnchor&&!isNaN(e)&&!isNaN(t)){var r=this._vertexAnchor.geometry,n=this._map.toMap(this._map.toScreen(r).offset(e,t)),a=n.x-r.x,o=n.y-r.y,s=r.offset(a,o);[i.POLYLINE,i.POLYGON].indexOf(this._geometryType)>-1&&this._updateGhostLine(s),this._vertexAnchor.setGeometry(s).setSymbol(this.selectedVertexSymbol),this._vertexAnchor.getDojoShape().moveToFront();var l={sender:this,mapPoint:s,screenPoint:this._map.toScreen(s),snappingPoint:this._lastSnappingPoint};this.raiseGraphicVertexMoved(l)}},i.prototype._handleSnappingEvent=function(e){this._active&&this._editObject.isActive()||(this._lastSnappingPoint=e.snappingPoint,this._lastSnappingPoint&&this._ghostLine&&this._updateGhostLine(this._lastSnappingPoint))},i.prototype._updateGhostLine=function(e){if(this._points&&this._points.length>0){var t=this._points[this._points.length-1],i=this._ghostLine.geometry;i.setPoint(0,0,t.offset(0,0)),i.setPoint(0,1,e),this._ghostLine.setGeometry(i)}},i.prototype._addVertex=function(e){var t=e;this._lastSnappingPoint&&(e=this._lastSnappingPoint);var r,n,a,o;switch(this._points.push(e.offset(0,0)),this._geometryType){case i.POLYLINE:1===this._points.length?(r=new esri.geometry.Polyline(this._map.spatialReference),r.addPath(this._points),this._graphic=this._map.graphics.add(new esri.Graphic(r,this.lineSymbol)),o=new esri.geometry.Polyline(this._map.spatialReference),o.addPath([e.offset(0,0),e.offset(0,0)]),this._ghostLine=this._map.graphics.add(new esri.Graphic(o,this.lineSymbol))):(r=this._graphic.geometry,r.insertPoint(0,r.paths[0].length,e.offset(0,0)),this._graphic.setGeometry(r).setSymbol(this.lineSymbol),o=this._ghostLine.geometry,o.setPoint(0,0,e.offset(0,0)),o.setPoint(0,1,e.offset(0,0)),this._ghostLine.setGeometry(o));break;case i.POLYGON:1===this._points.length?(n=new esri.geometry.Polygon(this._map.spatialReference),n.addRing(this._points),this._graphic=this._map.graphics.add(new esri.Graphic(n,this.fillSymbol)),o=new esri.geometry.Polyline(this._map.spatialReference),o.addPath([e.offset(0,0),e.offset(0,0)]),this._ghostLine=this._map.graphics.add(new esri.Graphic(o,this.fillSymbol))):(n=this._graphic.geometry,n.insertPoint(0,n.rings[0].length,e.offset(0,0)),this._graphic.setGeometry(n).setSymbol(this.fillSymbol),o=this._ghostLine.geometry,o.setPoint(0,0,e.offset(0,0)),o.setPoint(0,1,e.offset(0,0)),this._ghostLine.setGeometry(o));break;case i.MULTI_POINT:1===this._points.length?(a=new esri.geometry.Multipoint(this._map.spatialReference),a.addPoint(e.offset(0,0)),this._graphic=this._map.graphics.add(new esri.Graphic(a,this.markerSymbol))):(a=this._graphic.geometry,a.addPoint(e.offset(0,0)),this._graphic.setGeometry(a).setSymbol(this.markerSymbol))}this._lastVertexPosition=t.offset(0,0),this._vertexAnchor.setGeometry(t.offset(0,0)).setSymbol(this.selectedVertexSymbol),this._vertexAnchor.getDojoShape().moveToFront()},i.prototype._drawPolyGeometry=function(e,t){var i=this;if(!e||this._isPlottingPolyGeometry)return Promise.resolve(null);this._lastSnappingPoint&&(e=this._lastSnappingPoint),this._isPlottingPolyGeometry=!0,this.app.map.disableMapNavigation(),this.suspend(),this._lastVertexPosition=null,this._vertexAnchor=this._map.graphics.add(new esri.Graphic(e.offset(0,0),this.selectedVertexSymbol));var r={sender:this,mapPoint:e,screenPoint:this._map.toScreen(e),snappingPoint:this._lastSnappingPoint};this.raiseGraphicVertexMoved(r),this._polyGeometryKeyDownHandle&&(this._polyGeometryKeyDownHandle.remove(),this._polyGeometryKeyDownHandle=null);var n=null;return new Promise(function(e,t){return i._polyGeometryKeyDownHandle=i._drawPolyGeometry_handleKeyDown(e,t)}).then(function(e){return n=e})["catch"](function(){return i.onKeyboardStop(!0),n=null}).lastly(function(){return i._isPlottingPolyGeometry=!1,i.app.map.enableMapNavigation(),i._polyGeometryKeyDownHandle&&(i._polyGeometryKeyDownHandle.remove(),i._polyGeometryKeyDownHandle=null),i.resume(),n})},i.prototype._drawPolyGeometry_handleKeyDown=function(e,t){var i=this;return dojo.on(this._map.root,"keydown",function(r){var n=r.altKey,o=n?i._options.preciseVertexOffsetX:i._options.vertexOffsetX,s=n?i._options.preciseVertexOffsetY:i._options.vertexOffsetY,l=r.keyCode||r.which;switch(l){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:i._moveVertexAnchor(0,-s);break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:i._moveVertexAnchor(o,0);break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:i._moveVertexAnchor(0,s);break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:i._moveVertexAnchor(-o,0);break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:i._moveVertexAnchor(o,-s);break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:i._moveVertexAnchor(o,s);break;case dojo.keys.END:case dojo.keys.NUMPAD_1:i._moveVertexAnchor(-o,s);break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:i._moveVertexAnchor(-o,-s);break;case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:if(a.pointsAreEqual(i._vertexAnchor.geometry,i._lastVertexPosition))i._graphic&&i._map.graphics.remove(i._graphic),i._vertexAnchor&&i._map.graphics.remove(i._vertexAnchor),i._finishKeyboardDrawing(!1),e(i._graphic?i._graphic.geometry:null);else{var c=i._vertexAnchor.geometry;i._addVertex(c);var u={sender:i,mapPoint:c,screenPoint:i._map.toScreen(c),snappingPoint:i._lastSnappingPoint};i.raiseGraphicVertexAdded(u)}break;case dojo.keys.ESCAPE:t(null);break;default:return}r.preventDefault(),r.stopPropagation()})},i.prototype._plotShape=function(e,t){var r=this._map.toScreen(e);switch(t){case i.POINT:return Promise.resolve(e.offset(0,0));case i.POLYLINE:return this._drawPolyGeometry(e,t);case i.POLYGON:return this._drawPolyGeometry(e,t);case i.MULTI_POINT:return this._drawPolyGeometry(e,t);case i.ARROW:return Promise.resolve(this._toPolygon(this._arrowShapeTemplate,r.x,r.y));case i.LEFT_ARROW:return Promise.resolve(this._toPolygon(this._leftArrowShapeTemplate,r.x,r.y));case i.RIGHT_ARROW:return Promise.resolve(this._toPolygon(this._rightArrowShapeTemplate,r.x,r.y));case i.UP_ARROW:return Promise.resolve(this._toPolygon(this._upArrowShapeTemplate,r.x,r.y));case i.DOWN_ARROW:return Promise.resolve(this._toPolygon(this._downArrowShapeTemplate,r.x,r.y));case i.TRIANGLE:return Promise.resolve(this._toPolygon(this._triangleShapeTemplate,r.x,r.y));case i.RECTANGLE:case i.EXTENT:return Promise.resolve(this._toPolygon(this._rectangleShapeTemplate,r.x-48,r.y+24));case i.CIRCLE:var n=i.createCircle({center:r,radius:48,numberOfPoints:60,map:this._map});return Promise.resolve(n);case i.ELLIPSE:var a=i.createEllipse({center:r,longAxis:48,shortAxis:24,numberOfPoints:60,map:this._map});return Promise.resolve(a)}return Promise.resolve(null)},i.prototype._editShape=function(e){if(e){if(this._options.enableEditing===!1)return this._clear(),void this._drawEnd(e);this.suspend();var t;switch(e.type){case"point":case"multipoint":t=this.markerSymbol;break;case"polyline":t=this.lineSymbol;break;case"polygon":case"extent":t=this.fillSymbol}var i=this._getEditMode(this._geometryType);this._graphic=this._map.graphics.add(new esri.Graphic(e,t)),this._editCompletedHandle&&(this._editCompletedHandle.remove(),this._editCompletedHandle=null),this._editCompletedHandle=dojo.aspect.after(this._editObject,"onDeactivate",dojo.hitch(this,"_onEditShapeCompleted"),!0),this._editObject.activate(i.mode,this._graphic,i.options)}},i.prototype._onEditShapeCompleted=function(e,t,i){var r=!!i&&!!i.isModified,n=!!i&&!!i.cancelled;t&&r&&(this._graphic=t),this.resume(),this.onKeyboardStop(n)},i.prototype._toPolygon=function(e,t,i){var r=this._map,n=e.map(function(e){return r.toMap(new esri.geometry.ScreenPoint(e[0]+t,e[1]+i))}),a=new esri.geometry.Polygon(r.spatialReference);return a.addRing(n),a},i.prototype._syncPointsCollection=function(){this._points=this._drawObject._points},i.prototype._getEditMode=function(e){var t={mode:0,options:{}};switch(e){case i.POINT:t.mode=r.Edit.MOVE;break;case i.MULTI_POINT:t.mode=r.Edit.EDIT_VERTICES,t.options.allowAddVertices=!1,t.options.allowDeleteVertices=!0;break;case i.POLYLINE:case i.ARROW:case i.LEFT_ARROW:case i.RIGHT_ARROW:case i.UP_ARROW:case i.DOWN_ARROW:case i.TRIANGLE:case i.RECTANGLE:case i.POLYGON:t.mode=r.Edit.MOVE|r.Edit.ROTATE|r.Edit.SCALE|r.Edit.EDIT_VERTICES,t.options.allowAddVertices=!0,t.options.allowDeleteVertices=!0,t.options.uniformScaling=!1;break;case i.EXTENT:t.mode=r.Edit.MOVE|r.Edit.SCALE,t.options.allowAddVertices=!1,t.options.allowDeleteVertices=!1,t.options.uniformScaling=!1;break;case i.CIRCLE:t.mode=r.Edit.MOVE|r.Edit.SCALE,t.options.uniformScaling=!0;break;case i.ELLIPSE:t.mode=r.Edit.MOVE|r.Edit.ROTATE|r.Edit.SCALE,t.options.uniformScaling=!1}return t},i.prototype._vertexCount=function(e){return e&&"polyline"===e.type?e.paths[0].length:e&&"polygon"===e.type?e.rings[0].length-1:e&&"multipoint"===e.type?e.points.length:0},i.prototype._twoClicksWithin300MsFixup=function(){var e=this,t=this._drawObject;if(t&&"function"==typeof t._onClickHandler){var i=t._onClickHandler;t._onClickHandler=function(t){return e._twoClicksWithin300MsFixup_handleClick(t,i)}}else this.app.trace.warning("The _drawObject _onClickHandler hook is dysfunctional. Markup and Measurement (tool) functionality may be affected on touch devices.")},i.prototype._twoClicksWithin300MsFixup_handleClick=function(e,t){var r=!1,n=0,a=0,o=function(e){n=e[0].mapPoint.x,a=e[0].mapPoint.y};if(this._geometryType===i.POLYLINE||this._geometryType===i.POLYGON||this._geometryType===i.POINT||this._geometryType===i.MULTI_POINT){if(!r&&(e.mapPoint.x!==n||e.mapPoint.y!==a)){r=!0,setTimeout(function(){r=!1},300);var s={sender:this,mapPoint:e.mapPoint,screenPoint:e.screenPoint,snappingPoint:this._lastSnappingPoint};t.apply(this._drawObject,arguments),this.raiseGraphicVertexAdded(s)}o(arguments)}else t.apply(this._drawObject,arguments)},i.prototype._extraPointOnTouchDevicesFixup=function(){var t=this,i=function(i){var r=t._drawObject,n=!!(e&&e.has&&e.has("esri-touch"));t.app.trace.debug("[DrawTool] IsTouch = "+n);var a=r?r._points:null;if(a)if(n){if(a.length>=2){var o=a.push;a.push=function(){t.app.trace.debug("[DrawTool] points.length "+a.length),a.push=o}}}else if(a.length<2||a[a.length-1].x!==i.mapPoint.x&&a[a.length-1].y!==i.mapPoint.y){if(t._lastSnappingPoint)return void t.app.trace.debug("[DrawTool] Bailout due to snapping");a.push(i.mapPoint),t.raiseGraphicVertexAdded({sender:t,mapPoint:i.mapPoint,screenPoint:i.screenPoint,snappingPoint:t._lastSnappingPoint})}};this._dblClickHandlerToken?this.app.trace.debug("[DrawTool] No double click subscribed"):this._dblClickHandlerToken=this.app.map.on("dbl-click",i)},i}(i.AccessibleMapComponent);o._draw=function(){e(["esri/toolbars/draw"],function(e){o.ARROW=e.ARROW,o.CIRCLE=e.CIRCLE,o.DOWN_ARROW=e.DOWN_ARROW,o.ELLIPSE=e.ELLIPSE,o.EXTENT=e.EXTENT,o.FREEHAND_POLYGON=e.FREEHAND_POLYGON,o.FREEHAND_POLYLINE=e.FREEHAND_POLYLINE,o.LEFT_ARROW=e.LEFT_ARROW,o.LINE=e.LINE,o.MULTI_POINT=e.MULTI_POINT,o.POINT=e.POINT,o.POLYGON=e.POLYGON,o.POLYLINE=e.POLYLINE,o.RECTANGLE=e.RECTANGLE,o.RIGHT_ARROW=e.RIGHT_ARROW,o.TRIANGLE=e.TRIANGLE,o.UP_ARROW=e.UP_ARROW})}(),t.Draw=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.raiseGraphicEditActivated=function(e){this.app.event("GraphicDrawAccessibleEditActivatedEvent").publish(e)},t.prototype.raiseGraphicEditDeactivated=function(e){this.app.event("GraphicDrawAccessibleEditDeactivatedEvent").publish(e)},t}(r.Edit);t.EditInternal=s})},"geocortex/infrastructure/accessibility/AccessibilityManager":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e){this._registeredComponentTypes={"esri.toolbars.draw":"esri.toolbars.Draw","esri.toolbars.edit":"esri.toolbars.Edit","geocortex.accessibility.draw":"geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Draw","geocortex.accessibility.edit":"geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Edit"},this._stack=[],this.app=e,this.app.event("AccessibleComponentStartedEvent").subscribe(this,this._handleAccessibleComponentStarted),this.app.event("AccessibleComponentCompletedEvent").subscribe(this,this._handleAccessibleComponentCompleted)}return e.prototype.registerComponent=function(e,t){if(null==e||null==t)throw new Error("[AccessibilityManager::registerComponent] Null name or typeName passed to registerComponent");this._registeredComponentTypes[e]=t},e.prototype.unregisterComponent=function(e){return!(!e||!this._registeredComponentTypes.hasOwnProperty(e))&&(delete this._registeredComponentTypes[e],!0)},e.prototype.createComponent=function(e,t,i){if(e&&this._registeredComponentTypes.hasOwnProperty(e)){var r=this._registeredComponentTypes[e],n=dojo.getObject(r);if(n){var a=new n(t,i,this.app);return a}this.app.trace.warning("Could not create component '{0}' from type name '{1}'".format(e,r))}return null},e.prototype._handleAccessibleComponentStarted=function(e){if(e&&this._stack){var t=this._stack.indexOf(e);t>-1&&this._stack.splice(t,1),this._stack.forEach(function(e){return!e.suspended&&e.suspend()}),this._stack.push(e),e.resume()}},e.prototype._handleAccessibleComponentCompleted=function(e){if(e&&this._stack&&0!=this._stack.length){var t=this._stack.indexOf(e);if(t>-1&&(this._stack.splice(t,1),!e.suspended&&e.suspend()),this._stack.length>0){var i=this._stack[this._stack.length-1];i.resume()}}},e}();t.AccessibilityManager=i})},"geocortex/infrastructure/coordinates/CoordinateSystem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/coordinates/CoordinateBase":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/coordinates/Coordinate":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/coordinates/CoordinatesModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/coordinates/CoordinatesModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isActive=new r.Observable((!1)),t.coordinateSystems=new r.ObservableCollection([]),t.currentCoordinateSystem=new r.Observable(null),t.fractionalDigits=5,t.defaultGcsWkid=4326,t.inputStream=new r.Observable(null),t.outputStream=new r.Observable(null),t.isRegistered=!1,t}return __extends(t,e),t.prototype.initialize=function(e){this.configuration=e},t}(i.ViewModelBase);t.CoordinatesModel=n})},"geocortex/infrastructure/coordinates/AngleFormat":function(){define(["require","exports"],function(e,t){"use strict";t.DD="dd",t.DDM="ddm",t.DMS="dms"})},"geocortex/infrastructure/coordinates/CoordinateUtils":function(){define(["require","exports","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/coordinates/AngleFormat","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat"],function(e,t,i,r,n,a){"use strict";function o(e,t,r,n,a){void 0===n&&(n=5),void 0===a&&(a=4326);var o=function(o,s){var l=esri.geometry,c=t.spatialReference,u=e.map.spatialReference.wkt?r.wkt!==e.map.spatialReference.wkt:r.wkid!==e.map.spatialReference.wkid,d=u||"xy"===r.output?new esri.SpatialReference(r.wkid||r.wkt):new esri.SpatialReference(a),p=function(t){var i=h(e,t,r,n);o(i)},m=function(){i.projectGeometry(t,d,function(e){p(e)},function(e){s(new Error("Unable to project geometry for coordinate tracking: {0}".format(e.message)))},e)},f=function(){e.command("NativeHasCapability").execute("project",function(e){return e?void m():void s(new Error("Offline Mode. Unable to project geometry for coordinate tracking."))})};if(l.canProject(c,d)){var g=l.project(t,d);p(g)}else e.isOffline.get()?f():m()};return new Promise(o)}function s(e,t,i,r,n){var a=p(e,"west-abbrev").toUpperCase(),o=p(e,"east-abbrev").toUpperCase(),s=p(e,"north-abbrev").toUpperCase(),l=p(e,"south-abbrev").toUpperCase();n=n.toUpperCase();var c=parseFloat(t),u=parseFloat(i),d=parseFloat(r);if(isNaN(c)||isNaN(u)||isNaN(d)||c<0||c>180||u<0||u>60||d<0||d>60||n!=a&&n!=o&&n!=s&&n!=l)return null;var h=c+u/60+d/3600;return n!==l&&n!==a||(h=-h),h}function l(e,t,i,n){switch(null!=n&&"undefined"!=typeof n||(n=4),t||(t=r.DD),t=t.toLowerCase()){case r.DDM:return g(e,i,n);case r.DMS:return f(e,i,n);default:return m(e,i,n)}}function c(e,t,i,r,n){var a=null,o=null;return a=e>0?p(r,"north-abbrev"):p(r,"south-abbrev"),o=t>0?p(r,"east-abbrev"):p(r,"west-abbrev"),{latitude:"{0} {1}".format(l(Math.abs(e),i,r,n),a),longitude:"{0} {1}".format(l(Math.abs(t),i,r,n),o)}}function u(e,t,i){return null!=i&&"undefined"!=typeof i||(i=4),n.formatNumber(e,a.NumberFormat.NUMBER,{fractionalDigits:i})}function d(e,t,i,r){if(0===e)return p(i,"north-abbrev");if(90===e)return p(i,"east-abbrev");if(180===e)return p(i,"south-abbrev");if(270===e)return p(i,"west-abbrev");var n=p(i,"north-abbrev"),a=p(i,"east-abbrev");return e>=90&&e<180?(n=p(i,"south-abbrev"),e=180-e):e>=180&&e<270?(n=p(i,"south-abbrev"),a=p(i,"west-abbrev"),e-=180):e>=270&&e<360&&(a=p(i,"west-abbrev"),e=360-e),"{0} {1} {2}".format(n,l(e,t,i,r),a)}function p(e,t){return t=t.startsWith("language-coordinates-")?t:"language-coordinates-"+t,e.getResource("Mapping.Infrastructure",t)}function h(e,t,i,r){void 0===r&&(r=5);var o={};if(o.targetCoordinateSystem=i,o.x=t.x,o.y=t.y,o.spatialReference=t.spatialReference,"xy"==i.output)o.formattedLatitudeOrX=n.formatNumber(t.x,a.NumberFormat.DEFAULT,{fractionalDigits:r}),o.formattedLongitudeOrY=n.formatNumber(t.y,a.NumberFormat.DEFAULT,{fractionalDigits:r});else{var s=c(t.y,t.x,i.output,e,r);o.formattedLatitudeOrX=s.latitude,o.formattedLongitudeOrY=s.longitude}return o}function m(e,t,i){return"{0}{1}".format(n.formatNumber(e,a.NumberFormat.NUMBER,{fractionalDigits:i}),p(t,"degrees"))}function f(e,t,i){var r=Math.floor(Math.abs(e)),o=Math.floor(60*(Math.abs(e)-r)),s=60*(Math.abs(e)-r-o/60)*60;return"{0}{1} {2}{3} {4}{5}".format(r*y(e),p(t,"degrees"),o,p(t,"minutes"),n.formatNumber(s,a.NumberFormat.NUMBER,{fractionalDigits:i}),p(t,"seconds"))}function g(e,t,i){var r=Math.floor(Math.abs(e)),o=60*(Math.abs(e)-r);return"{0}{1} {2}{3}".format(r*y(e),p(t,"degrees"),n.formatNumber(o,a.NumberFormat.NUMBER,{fractionalDigits:i}),p(t,"minutes"))}function y(e){return"number"!=typeof e?NaN:e>0?1:e<0?-1:e}t.getCoordinate=o,t.convertDmsToDecimalDegrees=s,t.formatAngle=l,t.formatLatLon=c,t.formatXYCoordinate=u,t.formatBearing=d,t.getResource=p})},"geocortex/infrastructure/coordinates/CoordinatesManager":function(){define(["require","exports","geocortex/infrastructure/coordinates/CoordinatesModel","geocortex/infrastructure/coordinates/CoordinateUtils"],function(e,t,i,r){"use strict";t.featureSetExtendedProperty="containsCoordinates",t.coordinateIdentifierProperty="coordinateId";var n=function(){function e(e){this._registeredCoordinateModels=[],this.app=e}return e.prototype.registerModel=function(e,t){return void 0===t&&(t=!1),!!this._validateModelRegistration(e)&&(this._processCoordinatesModel(e),(0===this._registeredCoordinateModels.length||t)&&(this._defaultCoordinatesModel=e),this._registeredCoordinateModels.push(e.id),!0)},e.prototype.getCoordinate=function(e,t,i){var n=this;if(!this.hasRegisteredCoordinatesModel(i)){var a="Coordinates Manager: Could not resolve coordinates. Target coordinates model incorrectly configured or not registered.";return Promise.reject(new Error(a))}var o=e instanceof esri.geometry.Point?e:new esri.geometry.Point(e.x,e.y,e.spatialReference),s=this._defaultCoordinatesModel;return i&&s.id!==i?void this.getCoordinatesModel(i).then(function(e){return r.getCoordinate(n.app,o,t||e.currentCoordinateSystem.get(),e.fractionalDigits,e.defaultGcsWkid)},function(e){return Promise.reject(e)}):r.getCoordinate(this.app,o,t||s.currentCoordinateSystem.get(),s.fractionalDigits,s.defaultGcsWkid)},e.prototype.getCoordinatesModel=function(e){var t=this,r=function(r,n){t.app.getFrameworkObjectByIdAsync(e,function(t){t instanceof i.CoordinatesModel?r(t):n(new Error("CoordinatesManager: getCoordinatesModel - {0} is not an instance of a Coordinates Model.".format(e)))},function(e){return n(e)})};return new Promise(r)},e.prototype.hasRegisteredCoordinatesModel=function(e){return!(e||!this._defaultCoordinatesModel||!this._defaultCoordinatesModel.isRegistered)||!!e&&this._registeredCoordinateModels.indexOf(e)>-1},e.prototype._validateModelRegistration=function(e){if(!(e&&e.id&&e.coordinateSystems.length()&&e.currentCoordinateSystem.get()))return!1;var t=this._registeredCoordinateModels.filter(function(t){return e.id===t});if(t.length)return!1;for(var i=0;i<e.coordinateSystems.length();i++){var r=e.coordinateSystems.getAt(i);if(!this._validateCoordinateSystem(r))return!1}return!0},e.prototype._validateCoordinateSystem=function(e){return null!=e.displayName&&null!=e.output&&(null!=e.wkid||null!=e.wkt)},e.prototype._processCoordinatesModel=function(e){var t=this;this._addModelSubscriptionHooks(e);var i=!1;e.inputStream.bind(this,function(n){if(i||!e.isActive.get()||t._prevCoord&&t._prevCoord.x==n.x&&t._prevCoord.y==n.y&&t._prevCoord.spatialReference&&n.spatialReference&&(t._prevCoord.spatialReference.wkid===n.spatialReference.wkid||t._prevCoord.spatialReference.wkt==n.spatialReference.wkt))return void(t._prevCoord=n);t._prevCoord=n;var a=n instanceof esri.geometry.Point?n:new esri.geometry.Point(n.x,n.y,n.spatialReference);i=!0,r.getCoordinate(t.app,a,e.currentCoordinateSystem.get(),e.fractionalDigits,e.defaultGcsWkid).then(function(t){e.outputStream.set(t),i=!1},function(r){t.app.trace.error("CoordinatesManager: An error occurred while attempting to map from input to output coordinate streams for model: {0}".format(e.id)),i=!1})}),e.isRegistered=!0},e.prototype._addModelSubscriptionHooks=function(e){var t=this,i=e.outputStream.bindingEvent;dojo.aspect.after(i,"subscribe",function(r){return t._handleModelSubscriptionsChanged(e,i.subscriptions),r}),dojo.aspect.after(i,"unsubscribe",function(r){return t._handleModelSubscriptionsChanged(e,i.subscriptions),r}),dojo.aspect.after(i,"clear",function(){return t._handleModelSubscriptionsChanged(e,i.subscriptions)}),this._handleModelSubscriptionsChanged(e,i.subscriptions)},e.prototype._handleModelSubscriptionsChanged=function(e,t){var i=!1;for(var r in t)if(t.hasOwnProperty(r)){i=!0;break}i!==e.isActive.get()&&e.isActive.set(i)},e}();t.CoordinatesManager=n})},"geocortex/infrastructure/eventArgs/FeatureSetManagerEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e){dojo.safeMixin(this,e)}return e}();t.FeatureSetManagerEventArgs=i})},"geocortex/infrastructure/FeatureSetManager":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/eventArgs/FeatureSetManagerEventArgs"],function(e,t,i,r){"use strict";var n=function(){function e(e){this.featureSetCollections=new i.ObservableCollection,this._featureSetCollectionsMap={},this._collectionChangedEventMap={},this._collectionOpenCount={},this._searchSuggestions={},this.app=e,this._registerCommands()}return e.prototype._registerCommands=function(){this.app.command("OpenFeatureSetCollection").register(this,this.openCollection),this.app.command("CloseFeatureSetCollection").register(this,this.closeCollection),this.app.command("RemoveCollection").register(this,this.removeCollection),this.app.command("RemoveFeatureSetCollection").register(this,this.removeCollection),this.app.command("RemoveCollectionById").register(this,this.removeCollectionById),this.app.command("RemoveFeatureSetCollectionById").register(this,this.removeCollectionById)},e.prototype.openCollection=function(e){if(!this._featureSetCollectionsMap.hasOwnProperty(e))return this.app.trace.warning("Cannot open feature set collection '{0}': No feature set collection with matching ID found.".format(e)),null;if(this._collectionOpenCount.hasOwnProperty(e)||(this._collectionOpenCount[e]=0),++this._collectionOpenCount[e],1==this._collectionOpenCount[e]){var t=this._featureSetCollectionsMap[e],i=new r.FeatureSetManagerEventArgs({sender:this,featureSetCollection:t,featureSetCollectionId:e});this.app.event("FSMCollectionOpenedEvent").publish(i)}return this._featureSetCollectionsMap[e]},e.prototype.closeCollection=function(e){if(!this._featureSetCollectionsMap.hasOwnProperty(e))return this.app.trace.warning("Cannot close feature set collection '{0}': No feature set collection with matching ID found.".format(e)),!1;if(!this._collectionOpenCount.hasOwnProperty(e)||0==this._collectionOpenCount[e])return this.app.trace.warning("Attempted to close an already-closed FeatureSetCollection."),!1;if(--this._collectionOpenCount[e],0==this._collectionOpenCount[e]){var t=new r.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[e],featureSetCollectionId:e});this.app.event("FSMCollectionClosedEvent").publish(t)}return!0},e.prototype.tryCloseCollection=function(e){return!!this._featureSetCollectionsMap.hasOwnProperty(e)&&(!this.isCollectionOpen(e)||this.closeCollection(e))},e.prototype.isCollectionOpen=function(e){return this._featureSetCollectionsMap.hasOwnProperty(e)?this._collectionOpenCount.hasOwnProperty(e)&&this._collectionOpenCount[e]>0:(this.app.trace.warning("Cannot check open state of feature set collection '{0}': No feature set collection with matching ID found.".format(e)),!1)},e.prototype.addCollection=function(e){return this._addCollectionImpl(e)},e.prototype._addCollectionImpl=function(e){if(!e)throw new Error("FeatureSetManager.addCollection: Parameter 'fsc' required.");var t=this._featureSetCollectionsMap[e.id];if(e===t)return!0;if(t)return this.app.trace.warning("Cannot add feature set collection '{0}': A feature set collection with that ID already exists.".format(e.id)),!1;this._featureSetCollectionsMap[e.id]=e,this.featureSetCollections.addItem(e);var i=e.featureSets.bind(this,dojo.hitch(this,function(t){this.handleCollectionChanged(e,t)}));this._collectionChangedEventMap[e.id]=i;var n=new r.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[e.id],featureSetCollectionId:e.id});return this.app.event("FSMCollectionAddedEvent").publish(n),!0},e.prototype.handleCollectionChanged=function(e,t){var i=new r.FeatureSetManagerEventArgs({sender:this,featureSetCollection:e,featureSetCollectionId:e.id,collectionChangedEventArgs:t});this.app.event("FSMCollectionChangedEvent").publish(i)},e.prototype.removeCollection=function(e){return!!this.canRemoveCollection(e)&&this.removeCollectionById(e.id)},e.prototype.removeCollectionById=function(e){if(!this._featureSetCollectionsMap.hasOwnProperty(e))return this.app.trace.warning("Cannot remove feature set collection '{0}': Collection not found.".format(e)),!1;this.isCollectionOpen(e)&&this.closeCollection(e);var t=this._featureSetCollectionsMap[e],i=this._collectionChangedEventMap[e];t.featureSets.unbind(i),this.featureSetCollections.removeItem(this._featureSetCollectionsMap[e]),delete this._collectionOpenCount[e],delete this._collectionChangedEventMap[e];var n=new r.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[e],featureSetCollectionId:e});return this.app.event("FSMCollectionRemovedEvent").publish(n),t.featureSets.get().forEach(function(e){e.features.get().forEach(function(t){if(!(t.featureSet&&t.featureSet.uniqueId!==e.uniqueId||t.featureSetUniqueIds.length>1||t.getExtendedPropertyByName("isShownInMaptip")||t.getExtendedPropertyByName("isShownInFeaturedetails"))){for(var i in t)t.hasOwnProperty(i)&&null!==t[i]&&void 0!==t[i]&&(t[i].isObservableCollection&&(t[i].clear(),t[i].bindingEvent.clear()),t[i].delegateGetter&&(t[i].delegateGetter=null));t.esriFeature.get()&&(t.esriFeature.bindingEvent.clear(),t.esriFeature.set(null))}}),e.features.clear(),e.features.bindingEvent.clear(),e.esriFeatureSet&&(e.esriFeatureSet.features=[],e.esriFeatureSet=null)}),t.featureSets.clear(),delete this._featureSetCollectionsMap[e],!0},e.prototype.canRemoveCollection=function(e){return null!=e&&null!=this.getCollectionById(e.id)},e.prototype.getCollectionById=function(e){return this._featureSetCollectionsMap[e]},e.prototype.getCollectionIds=function(){var e=[];for(var t in this._featureSetCollectionsMap)this._featureSetCollectionsMap.hasOwnProperty(t)&&e.push(t);return e},e.prototype.findFeatureSetByUniqueId=function(e){for(var t=0,i=this.featureSetCollections.length();t<i;t++){var r=this.featureSetCollections.getAt(t).getFeatureSetByUniqueId(e);if(r)return r}return null},e.prototype.findFeaturesByEsriFeature=function(e){var t=[];return this.featureSetCollections.get().forEach(function(i){var r=i.findFeatureByEsriFeature(e);r&&t.push(r)}),t},e.prototype.addSearchSuggestions=function(e){for(var t in e)if(e.hasOwnProperty(t)){if(this._searchSuggestions.hasOwnProperty(t)){this.app.trace.warning("Cannot add search suggestion '{0}': A search suggestion for that feature set type already exists.".format(e[t]));continue}e[t]&&(this._searchSuggestions[t]=e[t])}},e.prototype.getSearchSuggestion=function(e){return this._searchSuggestions[e]},e.prototype.updateCollectionsOnFeatureDeletion=function(e,t){void 0===t&&(t=!0),(this.featureSetCollections.get()||[]).forEach(function(i){for(var r=i.featureSets.length();r--;){var n=i.featureSets.getAt(r),a=n.findFeatureByEsriFeature(e);a&&(n.removeFeature(a),t&&0===n.features.length()&&i.featureSets.removeItem(n))}})},e.prototype.findOpenFeatureSetCollectionByFeatureSetUniqueId=function(e){for(var t=0,i=this.featureSetCollections.length();t<i;t++){var r=this.featureSetCollections.getAt(t);if(this.isCollectionOpen(r.id)){var n=r.getFeatureSetByUniqueId(e);if(n)return r}}return null},e}();t.FeatureSetManager=n})},"geocortex/infrastructure/search/SearchProviderBase":function(){define(["require","exports","geocortex/framework/utils/utils","geocortex/infrastructure/search/SearchManager"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){this.app=e,this.libraryId=t,this.id="SearchProvider-"+i.alphaNumericToken(),this.supportsOffline=!1,this.supportsHints=!1,this.status=r.Status.IDLE}return e.prototype.initialize=function(e){},e.prototype.search=function(e,t){},e.prototype.cancelSearch=function(){},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();t.SearchProviderBase=n})},"geocortex/infrastructure/search/SearchHintItem":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/FilterUtils"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){var n=this;this.iconUri=new i.Observable(""),this.text=new i.Observable(e),this.plainText=new i.Observable(""),this.plainText.syncTransform(this.text,function(e){return r.stripHtml(e)}),this.safeText=new i.Observable(""),this.safeText.syncTransform(this.text,function(e){return n.sanitizeText(e)})}return e.prototype.sanitizeText=function(e){var t={allowFrames:!1,uriTransformer:function(e){return e}};return e?r.sanitize(e,t):""},e.prototype.toString=function(){return this.plainText.get()},e}();t.SearchHintItem=n})},"geocortex/infrastructure/search/SearchHintProvider":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/SearchProgressEventArgs":function(){
define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.status=null,this.searchType=null,this.endpointUrl=null,this.error=null,this.message=null,this.results=null,this.query=null}return e}();t.SearchProgressEventArgs=i})},"geocortex/infrastructure/search/SearchManager":function(){define(["require","exports","geocortex/infrastructure/FeatureSetCollection"],function(e,t,i){"use strict";var r;!function(e){e.IDLE="Idle",e.SEARCHING="Searching",e.ERROR="Error"}(r=t.Status||(t.Status={}));var n=function(){function e(e){this._searchProviders=[],this._fscRootID="SearchResultsCollection",this._count=0,this._fscSourceName="Search",this.app=e,this._registerCommands(),this.app.event("SearchProgressEvent").subscribe(this,this._searchProgress)}return e.prototype._resetFeatureSetCollection=function(){this._fsc||(this._fsc=this.app.featureSetManager.getCollectionById(this._fscRootID)),this._fsc?(this.app.featureSetManager.getCollectionById(this._fsc.id)||this.app.featureSetManager.addCollection(this._fsc),this._fsc.clear(),this.app.featureSetManager.tryCloseCollection(this._fsc.id)):(this._fsc=new i.FeatureSetCollection,this._fsc.id=this._fscRootID,this._fsc.sourceName=this._fscSourceName,this.app.featureSetManager.addCollection(this._fsc))},e.prototype.getSearchHints=function(e,t){var i=this._enabledProviders();if(0==i.length)return void this.app.trace.warning("No search providers enabled.");for(var r=0;r<i.length;r++)if(i[r].supportsHints){var n=i[r];n.getSearchHints(e,t)}},e.prototype._registerCommands=function(){this.app.command("RegisterSearchProvider").register(this,this._registerProvider),this.app.command("Search").register(this,this._search),this.app.command("GlobalSearch").register(this,this._search),this.app.command("CancelSearch").register(this,this._cancelSearch),this.app.command("ClearSearch").register(this,this._clearSearch)},e.prototype._registerProvider=function(e){if(!e)throw new Error("Search Provider cannot be null.");for(var t=0;t<this._searchProviders.length;t++){var i=this._searchProviders[t];if(i.id==e.id)throw new Error("Search Provider '{0}' already registered.".format(e.name))}this._searchProviders.push(e)},e.prototype._enabledProviders=function(){for(var e=[],t=0;t<this._searchProviders.length;t++){var i=this._searchProviders[t];i.isEnabled&&(this.app.isOffline.get()===!0?i.supportsOffline&&e.push(i):e.push(i))}return e},e.prototype._isSearching=function(){for(var e=0;e<this._searchProviders.length;e++){var t=this._searchProviders[e];if(t.status==r.SEARCHING)return!0}return!1},e.prototype._cancelSearch=function(){if(this._isSearching())for(var e=0;e<this._searchProviders.length;e++){var t=this._searchProviders[e];t.status==r.SEARCHING&&t.cancelSearch()}},e.prototype._clearSearch=function(){this._isSearching()&&this._cancelSearch(),this._resetFeatureSetCollection()},e.prototype._search=function(e){if(this._isSearching()&&this._cancelSearch(),this._resetFeatureSetCollection(),!e||""==e.replace(/ /g,""))return void this.app.trace.warning("Cannot perform search without search text.");var t=this._enabledProviders();if(0==t.length)return void this.app.trace.warning("No search providers enabled.");var i=this.app.getResource("Mapping","language-search-fsc-display-name");this._fsc.displayName.set(i.format(e)),this.app.featureSetManager.isCollectionOpen(this._fsc.id)||this.app.featureSetManager.openCollection(this._fsc.id);for(var r=0;r<t.length;r++)t[r].search(this._fsc,e)},e.prototype._searchProgress=function(e){var t=!0;if(e.status!=r.SEARCHING){for(var i=0;i<this._searchProviders.length;i++){var n=this._searchProviders[i];n.status==r.SEARCHING&&(t=!1)}t&&this.app.featureSetManager.tryCloseCollection(e.results.id)}},e}();t.SearchManager=n})},"geocortex/infrastructure/project/ModuleState":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/ServiceLayer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/SpatialReference":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Geometry":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){function t(t){if(t){if(t.startsWith("esriGeometry"))return t;switch(t){case"point":return e.POINT;case"multipoint":return e.MULTIPOINT;case"polyline":return e.POLYLINE;case"polygon":return e.POLYGON;case"extent":return e.EXTENT;default:throw new Error("GeometryType.fromEsriGeometryType: Unrecognized geometry type.")}}}e.POINT="esriGeometryPoint",e.MULTIPOINT="esriGeometryMultipoint",e.POLYLINE="esriGeometryPolyline",e.POLYGON="esriGeometryPolygon",e.EXTENT="esriGeometryEnvelope",e.fromEsriGeometryType=t}(i=t.GeometryType||(t.GeometryType={}))})},"geocortex/infrastructure/webMap/Feature":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/FeatureSet":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Symbol":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e.SIMPLE_MARKER="esriSMS",e.SIMPLE_LINE="esriSLS",e.SIMPLE_FILL="esriSFS",e.PICTURE_MARKER="esriPMS",e.PICTURE_FILL="esriPFS",e.TEXT="esriTS"}(i=t.SymbolType||(t.SymbolType={}));var r;!function(e){e.CIRCLE="esriSMSCircle",e.CROSS="esriSMSCross",e.DIAMOND="esriSMSDiamond",e.SQUARE="esriSMSSquare",e.X="esriSMSX",e.TRIANGLE="esriSMSTriangle",e.PATH="esriSMSPath"}(r=t.SimpleMarkerStyle||(t.SimpleMarkerStyle={}));var n;!function(e){e.DASH="esriSLSDash",e.DASH_DOT="esriSLSDashDot",e.DASH_DOT_DOT="esriSLSDashDotDot",e.DOT="esriSLSDot",e.NONE="esriSLSNull",e.SOLID="esriSLSSolid"}(n=t.SimpleLineStyle||(t.SimpleLineStyle={}));var a;!function(e){e.BACKWARD_DIAGONAL="esriSFSBackwardDiagonal",e.CROSS="esriSFSCross",e.DIAGONAL_CROSS="esriSFSDiagonalCross",e.FORWARD_DIAGONAL="esriSFSForwardDiagonal",e.HORIZONTAL="esriSFSHorizontal",e.NONE="esriSFSNull",e.SOLID="esriSFSSolid",e.VERTICAL="esriSFSVertical"}(a=t.SimpleFillStyle||(t.SimpleFillStyle={}));var o;!function(e){e.BASELINE="baseline",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom"}(o=t.VerticalAlignment||(t.VerticalAlignment={}));var s;!function(e){e.LEFT="left",e.RIGHT="right",e.CENTER="center",e.JUSTIFY="justify"}(s=t.HorizontalAlignment||(t.HorizontalAlignment={}));var l;!function(e){e.ITALIC="italic",e.NORMAL="normal",e.OBLIQUE="oblique"}(l=t.FontStyle||(t.FontStyle={}));var c;!function(e){e.BOLD="bold",e.BOLDER="bolder",e.LIGHTER="lighter",e.NORMAL="normal"}(c=t.FontWeight||(t.FontWeight={}));var u;!function(e){e.LINE_THROUGH="line-through",e.UNDERLINE="underline",e.NONE="none"}(u=t.TextDecoration||(t.TextDecoration={}))})},"geocortex/infrastructure/webMap/Renderer":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e.SIMPLE="simple",e.UNIQUE_VALUE="uniqueValue",e.CLASS_BREAKS="classBreaks",e.HEATMAP="heatmap"}(i=t.RendererType||(t.RendererType={}));var r;!function(e){e.BY_FIELD="esriNormalizeByField",e.BY_LOG="esriNormalizeByLog",e.BY_PERCENT_OF_TOTAL="esriNormalizeByPercentOfTotal"}(r=t.NormalizationType||(t.NormalizationType={}));var n;!function(e){e.NATURAL_BREAKS="esriClassifyNaturalBreaks",e.EQUAL_INTERVAL="esriClassifyEqualInterval",e.QUANTILE="esriClassifyQuantile",e.STANDARD_DEVIATION="esriClassifyStandardDeviation",e.GEOMETRICAL_INTERVAL="esriClassifyGeometricalInterval"}(n=t.ClassificationMethod||(t.ClassificationMethod={}))})},"geocortex/infrastructure/webMap/DrawingInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Domain":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e.INHERITED="inherited",e.RANGE="range",e.CODED_VALUE="codedValue"}(i=t.DomainType||(t.DomainType={}))})},"geocortex/infrastructure/webMap/Field":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Template":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Type":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/LayerDefinition":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/PopupInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Layer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/FeatureCollection":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/OperationalLayer":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e.CSV="CSV",e.WMS="WMS",e.KML="KML"}(i=t.OperationalLayerType||(t.OperationalLayerType={}))})},"geocortex/infrastructure/project/DrawingInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/LayerDefinition":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/Feature":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/FeatureSet":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/Layer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/ServiceLayer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/FeatureCollection":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/OperationalLayer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/SimpleRenderer":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.fillColor=new esri.Color([236,236,0,.22745]),this.borderColor=new esri.Color([204,204,51,1]),this.borderWidth=2,this.polylineOpacity=1,this.defaultSymbol=null,this._pictureMarkerSymbolCache={}}return e.prototype.clone=function(){var t=new e;return t.fillColor=this.fillColor,t.borderColor=this.borderColor,t.borderWidth=this.borderWidth,t},e.prototype.getSymbol=function(e,t,i){if(void 0===i&&(i=!1),!e||!e.geometry)return null;var r=(e.getLayer(),0),n=0,a=0,o=0;if(t&&(t instanceof esri.symbol.SimpleLineSymbol&&(r=Math.max(t.width,this.borderWidth),i&&r>3&&(r-=2)),t instanceof esri.symbol.SimpleMarkerSymbol&&(n=t.size+(t.outline?t.outline.width:0),a=t.xoffset,o=t.yoffset),t instanceof esri.symbol.PictureMarkerSymbol&&(n=Math.max(t.height,t.width),a=t.xoffset,o=t.yoffset),n<24&&(n=24)),t||(t=e.symbol),e.geometry instanceof esri.geometry.Point||e.geometry instanceof esri.geometry.Multipoint){var s=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n||24,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.borderColor,this.borderWidth),this.fillColor);return s.setOffset(a,o),s}if(e.geometry instanceof esri.geometry.Polygon){var l=esri.symbol.SimpleLineSymbol.STYLE_SOLID;return i&&t&&(l=t.outline?t.outline.style:esri.symbol.SimpleLineSymbol.STYLE_SOLID),new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(l,this.borderColor,this.borderWidth),this.fillColor)}if(e.geometry instanceof esri.geometry.Polyline){var l=esri.symbol.SimpleLineSymbol.STYLE_SOLID;i&&t&&(l=t.style);var c=new esri.Color(this.borderColor.toHex());return c.a=this.polylineOpacity,new esri.symbol.SimpleLineSymbol(l,c,(r||this.borderWidth)+2)}return null},e.prototype.toJson=function(){return{fillColor:this.fillColor,borderColor:this.borderColor,borderWidth:this.borderWidth}},e}();t.SimpleRenderer=i})},"geocortex/infrastructure/symbology/SymbolColor":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e){if(e instanceof esri.Color)this._fromEsriColor(e);else if(this._isHSV(e))this.hue=this._clamp(e.h,0,1),this.value=this._clamp(e.v,0,1),this.saturation=this._clamp(e.s,0,1),this.alpha=null==e.a?1:this._clamp(e.a,0,1);else if(this._isRGB(e)){var t=void 0;t=e.r>1&&e.g>1&&e.b>1?this._fromRGB({r:e.r/255,g:e.g/255,b:e.b/255,a:e.a}):this._fromRGB({r:this._clamp(e.r,0,1),g:this._clamp(e.g,0,1),b:this._clamp(e.b,0,1)}),this.hue=t.h,this.value=t.v,this.saturation=t.s,this.alpha=null==e.a?1:this._clamp(e.a,0,1)}else{var i=esri.Color.fromRgb(e);if(i)this._fromEsriColor(i);else{var r=this._hexToRGB(e),t=this._fromRGB(r);this.hue=t.h,this.value=t.v,this.saturation=t.s,this.alpha=1}}}return e.prototype.toHex=function(){return this._rgbToHex(this.toRGB())},e.prototype.toRGBAString=function(){var e=this.toRGB();return"rgba("+Math.round(255*e.r).toString()+","+Math.round(255*e.g).toString()+","+Math.round(255*e.b).toString()+","+e.a.toString()+")"},e.prototype.toEsriColor=function(e){void 0===e&&(e=!0);var t=new esri.Color,i=this.toRGB();return t.r=Math.round(255*i.r),t.g=Math.round(255*i.g),t.b=Math.round(255*i.b),t.a=e?i.a:1,t},e.prototype.darken=function(t,i){return void 0===i&&(i=!0),t=this._clamp(t,0,1),new e({h:this.hue,v:this.value*(1-t),s:this.saturation,a:i?this.alpha:1})},e.prototype.lighten=function(t,i){return void 0===i&&(i=!0),t=this._clamp(t,0,1),new e({h:this.hue,v:this.value+(1-this.value)*t,s:this.saturation*(1-t),a:i?this.alpha:1})},e.prototype.blend=function(t,i){t=this._clamp(t,0,1);var r=i.toRGB(),n=this.toRGB(),a=n.r+(r.r-n.r)*t,o=n.b+(r.b-n.b)*t,s=n.g+(r.g-n.g)*t,l=n.a+(r.a-n.a)*t;return new e({r:a,g:s,b:o,a:l})},e.prototype.toRGB=function(){var e,t,i,r=this.saturation*this.value,n=6*this.hue,a=r*(1-Math.abs(n%2-1)),o=this.value-r;switch(Math.floor(n)%6){case 0:e=r+o,t=a+o,i=o;break;case 1:e=a+o,t=r+o,i=o;break;case 2:e=o,t=r+o,i=a+o;break;case 3:e=o,t=a+o,i=r+o;break;case 4:e=a+o,t=o,i=r+o;break;case 5:e=r+o,t=o,i=a+o}return{r:e,g:t,b:i,a:this.alpha}},e.prototype.equals=function(e){return e.hue===this.hue&&e.value===this.value&&e.saturation===this.saturation&&e.alpha===this.alpha},e.prototype.setAlpha=function(t){return new e({h:this.hue,s:this.saturation,v:this.value,a:t})},e.prototype._fromRGB=function(e){var t,i,r,n,a=Math.max(e.r,e.g,e.b),o=Math.min(e.r,e.g,e.b),s=a-o;return n=0===s?0:a===e.r?(e.g-e.b)/s:a===e.g?2+(e.b-e.r)/s:4+(e.r-e.g)/s,t=n/6,t<0&&(t+=1),i=0===s?0:s/a,r=a,{h:t,s:i,v:r,a:null==e.a?1:e.a}},e.prototype._fromEsriColor=function(e){var t=this._fromRGB({r:e.r/255,g:e.g/255,b:e.b/255,a:e.a});this.hue=t.h,this.value=t.v,this.saturation=t.s,this.alpha=t.a},e.prototype._rgbToHex=function(e){var t=("00"+Math.floor(255*e.r).toString(16)).slice(-2),i=("00"+Math.floor(255*e.g).toString(16)).slice(-2),r=("00"+Math.floor(255*e.b).toString(16)).slice(-2);return"#"+t+i+r},e.prototype._hexToRGB=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,r){return t+t+i+i+r+r});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16)/255,g:parseInt(i[2],16)/255,b:parseInt(i[3],16)/255,a:1}:null},e.prototype._clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},e.prototype._isHSV=function(e){return!!($.isNumeric(e.h)&&$.isNumeric(e.s)&&$.isNumeric(e.v))},e.prototype._isRGB=function(e){return!!($.isNumeric(e.r)&&$.isNumeric(e.g)&&$.isNumeric(e.b))},e}();t.SymbolColor=i})},"geocortex/infrastructure/ColorUtils":function(){define(["require","exports","geocortex/infrastructure/symbology/SymbolColor"],function(e,t,i){"use strict";function r(e){if("string"==typeof e){var t=n(e);if(t)return new dojo.Color({r:t.r,g:t.g,b:t.b,a:t.a})}return dojo.isArray(e)&&4===e.length?(e[3]>1&&(e[3]=e[3]/255),new dojo.Color(e)):new dojo.Color(e)}function n(e){if(dojo.isArray(e))return new esri.Color(r(e));if("string"==typeof e&&e.startsWith("#")&&9===e.length){var t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16),a=parseInt(e.slice(7,9),16);return t/=255,new esri.Color([i,n,a,t])}return new esri.Color(e)}function a(e){if(e)return 4===e.length?(e[3]>1&&(e[3]=e[3]/255),"rgba({0}, {1}, {2}, {3})".format(e[0],e[1],e[2],e[3])):3===e.length?"rgb({0}, {1}, {2})".format(e[0],e[1],e[2]):void 0}function o(e){if("string"==typeof e&&e.startsWith("#")){if(9===e.length){var t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),n=parseInt(e.slice(7,9),16);return t/=255,"rgba({0}, {1}, {2}, {3})".format(i,r,n,t)}if(7===e.length){var i=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return"rgb({0}, {1}, {2})".format(i,r,n)}}}function s(e){void 0===e&&(e=6);for(var t=[],r=Math.random(),n=0;n<e;n++){var a=r+1/e*n;a-=Math.floor(a);var o=new i.SymbolColor({h:a,s:.8,v:1});n%3===0&&(o=o.darken(Math.random()/1.8)),n%3===1&&(o=o.lighten(Math.random()/1.1)),t.push(o)}return t.sort(function(e){return.5-Math.random()})}function l(){var e=Math.random();return new i.SymbolColor({h:e,s:.8,v:1})}function c(){if(window.navigator.userAgent.indexOf("GeocortexApp.Windows")>-1)return!1;var e=document.createElement("input");return e.setAttribute("type","color"),"text"!==e.type}t.getColorFromList=r,t.getColorFromString=n,t.getStringFromList=a,t.getStringFromHex=o,t.generateRandomColors=s,t.generateRandomColor=l,t.isColorInputSupported=c})},"geocortex/infrastructure/PromiseUtils":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){function t(e,t){var i={};return Promise.resolve(e).then(function(e){var r=(e||[]).map(function(e){return Promise.resolve(e)["catch"](function(e){return t&&console.error(e),i})});return Promise.all(r).then(function(e){return e.filter(function(e){return e!==i})})})}function i(e,t,i,r){var n={};return Promise.resolve(e).then(function(e){var a=(e||[]).map(function(e){return Promise.resolve(e)["catch"](function(e){return n})}),o=function(e,i,a){return Promise["try"](function(){return t(e,i,a)})["catch"](function(e){return r&&console.error(e),n})};return Promise.map(a,o,i).then(function(e){return e.filter(function(e){return e!==n})})})}function r(e){return Promise.resolve(e).then(function(e){var t={};return Promise.map(Object.keys(e),function(i){return Promise.resolve(e[i]).then(function(e){t[i]=e},function(e){})})["return"](t)})}function n(e,t,i){return Promise.resolve(e)["catch"](function(e){return t.trace.warning(i.format(e)),Promise.reject(e)})}e.allSkipRejected=t,e.mapSkipRejected=i,e.propsSkipRejected=r,e.warnOnReject=n}(i=t.PromiseUtils||(t.PromiseUtils={}))})},"geocortex/infrastructure/symbology/SymbolType":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();i.POINT="point",i.MULTIPOINT="multipoint",i.POLYLINE="polyline",i.POLYGON="polygon",i.TEXT="text",t.SymbolType=i})},"geocortex/infrastructure/SymbolUtils":function(){define(["require","exports","geocortex/infrastructure/symbology/SymbolType","geocortex/framework/utils/utils","geocortex/framework-ui/LazyObservable","geocortex/infrastructure/BrowserUtils"],function(e,t,i,r,n,a){"use strict";function o(e){e||(e={});var t={a:e.a?e.a:E.a,r:e.r?e.r:E.r,g:e.g?e.g:E.g,b:e.b?e.b:E.b};return new dojo.Color(t)}function s(){return new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,14,l().setWidth(0),o())}function l(){return new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,o({a:.8}),2)}function c(){return new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,l(),o({a:.5}))}function u(e){void 0===e&&(e=!1);var t=new esri.symbol.TextSymbol(""),i=new esri.symbol.Font;return i.setSize("14pt"),i.setFamily("Calibri"),i.setWeight(esri.symbol.Font.WEIGHT_BOLD),t.setFont(i),t.setAlign(esri.symbol.TextSymbol.ALIGN_START),e||(t.setHaloColor(new esri.Color("#FFFFFF")),t.setHaloSize(1)),t}function d(e){switch(e){case i.SymbolType.POINT:case i.SymbolType.MULTIPOINT:return s();case i.SymbolType.POLYLINE:return l();case i.SymbolType.POLYGON:return c();case i.SymbolType.TEXT:return u()}}function p(e){switch(e){case i.SymbolType.POINT:case i.SymbolType.MULTIPOINT:return t.defaultPointMarkup.get();case i.SymbolType.POLYLINE:return t.defaultPolylineMarkup.get();case i.SymbolType.POLYGON:return t.defaultPolygonMarkup.get();case i.SymbolType.TEXT:return t.defaultTextMarkup.get()}}function h(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return t>>>0}function m(e){return"None"===e?null:"Line"==e?i.SymbolType.POLYLINE:e.toLowerCase()}function f(e){return"simplemarkersymbol"===e||"picturemarkersymbol"===e?i.SymbolType.POINT:"simplelinesymbol"===e?i.SymbolType.POLYLINE:"simplefillsymbol"===e?i.SymbolType.POLYGON:"textsymbol"===e?i.SymbolType.TEXT:null}function g(e){var t=e%360;return t=t<0?Math.abs(t):360-t}function y(e,t,i,r,n){var a=Math.PI/180*n,o=Math.cos(a),s=Math.sin(a),l=o*(i-e)+s*(r-t)+e,c=o*(r-t)-s*(i-e)+t;return{x:l,y:c}}function b(e,t,i){var r=dojox.gfx.createSurface(e,t,t),n=esri.symbol.getShapeDescriptors(i),a=r.createShape(n.defaultShape).setFill(n.fill).setStroke(n.stroke);a.applyTransform({dx:.5*t,dy:.5*t})}function v(e,t,i,n){var a=dojox.gfx.createSurface(e,t,t);i.setText("Aa");var o=esri.symbol.getShapeDescriptors(i);o.defaultShape.x+=.5*t,o.defaultShape.y+=.5*t;var s=a.createShape(o.defaultShape).setFill(o.fill).setFont(o.font);if(i.haloColor&&i.haloSize){var l=r.alphaNumericToken(),c=n._getDilateFilter(i.haloColor,i.haloSize,l);delete n._svgFilters[l],c.x=0,c.y=0,c.width="120%",c.height="120%",s.setFilter(c),s.rawNode.setAttribute("filter","url(#"+l+")")}}function S(e,t){if(!e||!t)return!1;if(e===t)return!0;if(e.type!==t.type)return!1;switch(e.type){case"simplemarkersymbol":return _(e,t);case"picturemarkersymbol":return I(e,t);case"simplelinesymbol":return w(e,t);case"cartographiclinesymbol":return x(e,t);case"simplefillsymbol":return L(e,t);case"picturefillsymbol":return C(e,t);case"textsymbol":return M(e,t);default:return!1}}function _(e,t){return e.color.toHex()===t.color.toHex()&&e.angle===t.angle&&e.size===t.size&&e.style===t.style&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset&&w(e.outline,t.outline)}function I(e,t){return e.color.toHex()===t.color.toHex()&&e.angle===t.angle&&e.height===t.height&&e.size===t.size&&e.url===t.url&&e.width===t.width&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset}function w(e,t){return e.color.toHex()===t.color.toHex()&&e.style===t.style&&e.type===t.type&&e.width===t.width}function x(e,t){return e.color.toHex()===t.color.toHex()&&e.cap===t.cap&&e.miterLimit===t.miterLimit&&e.join===t.join&&e.style===t.style&&e.type===t.type&&e.width===t.width}function L(e,t){return e.color.toHex()===t.color.toHex()&&e.style===t.style&&w(e.outline,t.outline)}function C(e,t){return e.color.toHex()===t.color.toHex()&&e.height===t.height&&e.url===t.url&&e.width===t.width&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset&&e.xscale===t.xscale&&e.yscale===t.yscale&&w(e.outline,t.outline)}function M(e,t){return e.color.toHex()===t.color.toHex()&&e.align===t.align&&e.angle===t.angle&&e.decoration===t.decoration&&e.font.decoration===t.font.decoration&&e.font.family===t.font.family&&e.font.size===t.font.size&&e.font.style===t.font.style&&e.font.variant===t.font.variant&&e.font.weight===t.font.weight&&e.haloColor.toHex()===t.haloColor.toHex()&&e.haloSize===t.haloSize&&e.horizontalAlignment===t.horizontalAlignment&&e.kerning===t.kerning&&e.rotated===t.rotated&&e.text===t.text&&e.verticalAlignment===t.verticalAlignment&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset}var F=a.isIE();t.defaultPointMarkup=new n.LazyObservable(null,function(){return s()},(!1)),t.defaultPolylineMarkup=new n.LazyObservable(null,function(){return l()},(!1)),t.defaultPolygonMarkup=new n.LazyObservable(null,function(){return c()},(!1)),t.defaultTextMarkup=new n.LazyObservable(null,function(){return u(9===F||11===F)},(!1)),t.POINTS_TO_PIXELS=96/72;var E={r:204,g:51,b:51,a:1};t.defaultSymbolColor=o,t.defaultMarkerSymbol=s,t.defaultLineSymbol=l,t.defaultFillSymbol=c,t.defaultTextSymbol=u,t.defaultSymbol=d,t.defaultMarkupSymbol=p,t.stringToHash=h,t.layerFeatureTypeToSymbolType=m,t.fromEsriSymbolType=f,t.webMapAngleToJSAPIAngle=g,t.rotate=y,t.createSymbolSwatch=b,t.createTextSymbolSwatch=v,t.esriSymbolsEqual=S})},"geocortex/infrastructure/HighlightManager":function(){define(["require","exports","geocortex/infrastructure/SimpleRenderer","geocortex/infrastructure/ColorUtils","geocortex/infrastructure/Feature","geocortex/infrastructure/PromiseUtils","geocortex/infrastructure/GraphicUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/SymbolUtils","geocortex/essentials/utilities/GraphicsLayerUtilities","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r,n,a,o,s,l,c,u,d){"use strict";t.HIGHLIGHT_ID_PROPERTY="__gcxHlId";var p=function(){function e(e){this.activeHighlightLayerName=null,this.onMaxGeometryVerticesExceeded=function(){},this._highlightLayers={},this._managedGraphics={},this._outerHighlightRenderer=new i.SimpleRenderer,this._highlightRenderer=new i.SimpleRenderer,this._focusRenderer=new i.SimpleRenderer,this._outerFocusRenderer=new i.SimpleRenderer,this._defaultHighlightLayerName=null,this._minBorder=1,this._defaultBorderOffset=3,this._ramerGeomGeneralizationDisabled=!0,this._ramerDeviationInMeters=100,this._ramerEpsilon=0,this._ramerGeomVerticesThreshold=0,this._maxHighlightableGeometryVertices=0,this._geometryCache=[],this._maxGeomCacheItems=50,this._supressedHighlightIds=[],this.app=e}return e.prototype.getHighlightFillColor=function(){return this._toARGBHex(this._outerHighlightRenderer.fillColor)},e.prototype.getHighlightBorderColor=function(){return this._toARGBHex(this._highlightRenderer.borderColor)},e.prototype.getHighlightBorderWidth=function(){return this._outerHighlightRenderer.borderWidth},e.prototype.setHighlightFillColor=function(e){var t;t=e instanceof esri.Color?e:r.getColorFromString(e),this._outerHighlightRenderer.fillColor=t,this._highlightRenderer.fillColor=new esri.Color("transparent")},e.prototype.setHighlightBorderColor=function(e){var t;t=e instanceof esri.Color?e:r.getColorFromString(e),this.setInnerHighlightBorderColor(t),this.setOuterHighlightBorderColor(new l.SymbolColor(t).darken(.4,!0).toEsriColor())},e.prototype.setOuterHighlightBorderColor=function(e){var t;t=e instanceof esri.Color?e:r.getColorFromString(e),this._outerHighlightRenderer.borderColor=t},e.prototype.setInnerHighlightBorderColor=function(e){var t;t=e instanceof esri.Color?e:r.getColorFromString(e),this._highlightRenderer.borderColor=t},e.prototype.setBorderWidth=function(e){e<this._minBorder&&(e=this._minBorder),this.setOuterBorderWidth(e),e-=this._defaultBorderOffset,e<this._minBorder&&(e=this._minBorder),this.setInnerBorderWidth(e)},e.prototype.setInnerBorderWidth=function(e){this._highlightRenderer.borderWidth=e,this._focusRenderer.borderWidth=e},e.prototype.setOuterBorderWidth=function(e){this._outerHighlightRenderer.borderWidth=e,this._outerFocusRenderer.borderWidth=e},e.prototype.getFocusedFillColor=function(){return this._toARGBHex(this._outerFocusRenderer.fillColor)},e.prototype.getFocusedBorderColor=function(){return this._toARGBHex(this._focusRenderer.borderColor)},e.prototype.setFocusedFillColor=function(e){var t=r.getColorFromString(e);this._outerFocusRenderer.fillColor=t,this._focusRenderer.fillColor=new esri.Color("transparent")},e.prototype.setFocusedBorderColor=function(e){var t=r.getColorFromString(e);this.setInnerFocusedBorderColor(t),this.setOuterFocusedBorderColor(new l.SymbolColor(t).darken(.4,!0).toEsriColor())},e.prototype.setOuterFocusedBorderColor=function(e){var t;t=e instanceof esri.Color?e:r.getColorFromString(e),this._outerFocusRenderer.borderColor=t},e.prototype.setInnerFocusedBorderColor=function(e){var t;t=e instanceof esri.Color?e:r.getColorFromString(e),this._focusRenderer.borderColor=t},e.prototype.setHighlightLineOpacity=function(e){this._outerHighlightRenderer.polylineOpacity=e,this._highlightRenderer.polylineOpacity=e},e.prototype.getHighlightLayers=function(){return this._highlightLayers},e.prototype.getMaxHighlightableGeometryVertices=function(){return this._maxHighlightableGeometryVertices},e.prototype.setMaxHighlightableGeometryVertices=function(e){var t=parseInt(e.toString(),10);this._maxHighlightableGeometryVertices=t&&!isNaN(t)?t:0},e.prototype.getOrCreateHighlightLayer=function(e,t,i){if(!e)return this._highlightLayers[this._defaultHighlightLayerName];if(this._highlightLayers.hasOwnProperty(e))return this._highlightLayers[e];var n=s.getInternalGraphicsLayer(e,this.app,s.GraphicsLayerType.Highlight);return(null!==t&&void 0!==t||null!==i&&void 0!==i)&&(n.renderer=this._outerHighlightRenderer.clone(),null!==t&&void 0!==t&&(n.renderer.fillColor="string"==typeof t?r.getColorFromString(t):r.getColorFromList(t)),null!==i&&void 0!==i&&(n.renderer.borderColor="string"==typeof i?r.getColorFromString(i):r.getColorFromList(i))),this._highlightLayers[e]=n,u.addToGraphicsLayerIdsToExclude([s.ExcludeFromEnum.ExportApplyStateName,s.ExcludeFromEnum.WebMapName],n.id),this.activeHighlightLayerName&&""!==this.activeHighlightLayerName||(this.activeHighlightLayerName=e),this.app.event("HighlightLayerCreated").publish(e),n},e.prototype.setActiveHighlightLayer=function(e){e&&(this._highlightLayers.hasOwnProperty(e)||this.getOrCreateHighlightLayer(e),this.activeHighlightLayerName=e)},e.prototype.setGeometryGeneralizationParams=function(e,t){var i=this;return this._ramerGeomVerticesThreshold=e>=0?e:0,this._ramerDeviationInMeters=t>=0?t:0,0===this._ramerGeomVerticesThreshold||0===this._ramerDeviationInMeters?(this._ramerEpsilon=0,this._ramerGeomGeneralizationDisabled=!0,Promise.resolve()):(this._ramerGeomGeneralizationDisabled=!1,d.convertMetersToMapPoints(this.app.site.essentialsMap,this._ramerDeviationInMeters).then(function(e){i._clearGeometryCache(),i._ramerEpsilon=e},function(e){return e}))},e.prototype.getGeometryGeneralizationParams=function(){return{thresholdVertices:this._ramerGeomVerticesThreshold,maxDeviationMeters:this._ramerDeviationInMeters}},e.prototype.highlightEsriFeatureSet=function(e,t){if(e&&e.features&&0!=e.features.length){var i=this.getHighlightLayerOrActive(t);i&&i.graphics||(i=this.getOrCreateHighlightLayer(t));for(var r=[],n=0;n<e.features.length;n++){var a=this._highlightGraphic(e.features[n],i,i.id);a&&r.push(a)}for(var n=0;n<r.length;n++)o.moveGraphicToTop(r[n])}},e.prototype.highlightFeatures=function(e,t){this._highlightFeaturesImpl(e,t)},e.prototype.emphasizeFeatures=function(e,t){this._highlightFeaturesImpl(e,t,!0)},e.prototype.clearHighlight=function(e,t){var i=this;if(e&&e.length&&e[0]){var r=null;t&&(r=this.getHighlightLayerOrActive(t)),e[0]instanceof n.Feature?e.filter(function(e){return!!e&&!!e.esriFeature}).forEach(function(e){return i._clearFeatureHighlight(e.esriFeature.get(),r)}):e.filter(function(e){return!!e}).forEach(function(e){return i._clearFeatureHighlight(e,r)})}},e.prototype.suppressHighlight=function(e){this._supressedHighlightIds.push(this._getHighlightId(e)),this.redrawHighlights()},e.prototype.enableHighlight=function(e){var t=this._getHighlightId(e),i=this._supressedHighlightIds.indexOf(t);i>-1&&(this._supressedHighlightIds.splice(i,1),this.updateHighlightId(e,t))},e.prototype.updateHighlightId=function(e,i){var r=this;i||(i=this._getHighlightId(e));var n=this._managedGraphics[i];if(n){var a=this._refreshHighlightId(e,i);a!==i&&n.forEach(function(i){i.managedGraphic.geometry=e.geometry,i.bottomGraphic.geometry=e.geometry,i.topGraphic.geometry=e.geometry,i.gcxFeature&&i.gcxFeature.esriFeature&&i.gcxFeature.esriFeature.get()&&(i.gcxFeature.esriFeature.get()[t.HIGHLIGHT_ID_PROPERTY]=a)});var o=n.map(function(e){return e.highlightLayer});o.forEach(function(e){return r.redrawHighlights(e)})}},e.prototype.clearEmphasis=function(e,t){var i=this;if(e&&e.length&&e[0]){var r=null;t&&(r=this.getHighlightLayerOrActive(t)),e[0]instanceof n.Feature?e.filter(function(e){return!!e&&!!e.esriFeature;
}).forEach(function(e){return i._clearFeatureEmphasis(e.esriFeature.get(),r)}):e.filter(function(e){return!!e}).forEach(function(e){return i._clearFeatureEmphasis(e,r)})}},e.prototype.highlightGraphics=function(e,t){if(e&&0!==e.length&&e[0]){var i=this.getHighlightLayerOrActive(t);i||(i=this.getOrCreateHighlightLayer(t));for(var r=[],n=0;n<e.length;n++){var a=this._highlightGraphic(e[n],i);a&&r.push(a)}for(var n=0;n<r.length;n++)o.moveGraphicToTop(r[n])}},e.prototype.removeHighlightLayer=function(e){if(e&&this._highlightLayers.hasOwnProperty(e)){var t=this._highlightLayers[e];this.clearHighlights(t),this.app.map.removeLayer(t),delete this._highlightLayers[e],u.removeFromGraphicsLayerIdsToExclude([s.ExcludeFromEnum.ExportApplyStateName,s.ExcludeFromEnum.WebMapName],e),this.activeHighlightLayerName===e&&(this.activeHighlightLayerName=null)}},e.prototype.clearHighlights=function(e){e||(e=this._defaultHighlightLayerName);var t,i;if(e instanceof esri.layers.GraphicsLayer?(t=e,i=this._getHighlightLayerNameFromLayerId(e.id)):(t=this.getHighlightLayer(e),i=e),t&&i)for(var r in this._managedGraphics)if(this._managedGraphics.hasOwnProperty(r)){for(var n=this._managedGraphics[r].length-1;n>=0;n--){var a=this._managedGraphics[r][n];a.highlightLayer===i&&(a.gcxFeature&&this.app.command("RemovePushpin").execute({feature:a.gcxFeature,tag:i}),t.remove(this._managedGraphics[r][n].bottomGraphic),t.remove(this._managedGraphics[r][n].topGraphic),this._managedGraphics[r].splice(n,1))}0==this._managedGraphics[r].length&&delete this._managedGraphics[r]}},e.prototype.refreshHighlights=function(e){var t=[];for(var i in this._managedGraphics)if(this._managedGraphics.hasOwnProperty(i)){var a=this._managedGraphics[i],o=this._outerHighlightRenderer.borderColor,s=this._highlightRenderer.borderColor,l=this._outerHighlightRenderer.fillColor,c=this._outerHighlightRenderer.borderWidth;try{for(var u,d=function(i){var o=a[i];if(e&&o.highlightLayer!==e)return"continue";var s=new n.Feature({graphic:o.managedGraphic}),l=void 0;s.borderColor&&s.borderColor.get()&&(l=r.getColorFromList(s.borderColor.get()),l&&p.setHighlightBorderColor(l)),s.fillColor&&s.fillColor.get()&&(l=r.getColorFromList(s.fillColor.get()),l&&p.setHighlightFillColor(l)),s.borderWidth&&s.borderWidth.get()&&(u=s.borderWidth.get(),u>0&&p.setBorderWidth(u));var c=p._outerHighlightRenderer.getSymbol(o.managedGraphic,o.originalSymbol);o.bottomGraphic.setSymbol(c),0===t.filter(function(e){return e===o.highlightLayer}).length&&t.push(o.highlightLayer)},p=this,h=0;h<a.length;h++)d(h)}finally{this.setOuterHighlightBorderColor(o),this.setInnerHighlightBorderColor(s),this.setHighlightFillColor(l),this.setBorderWidth(c)}}for(var m=0,f=t;m<f.length;m++){var g=f[m],y=this.getHighlightLayer(g);y&&y.redraw()}},e.prototype.redrawHighlights=function(e){var t=this,i=function(){var i={};for(var r in t._managedGraphics)if(t._managedGraphics.hasOwnProperty(r)){var n=t._managedGraphics[r];if(n)for(var a=0;a<n.length;a++){var o=n[a];!o||e&&o.highlightLayer!==e||(i[o.highlightLayer]||(i[o.highlightLayer]=[]),i[o.highlightLayer].push({feature:o.gcxFeature||o.managedGraphic,isEmphasized:o.highlightFocused}))}}for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];t._highlightFeaturesImpl(l.filter(function(e){return!e.isEmphasized}).map(function(e){return e.feature}),s,!1),t._highlightFeaturesImpl(l.filter(function(e){return e.isEmphasized}).map(function(e){return e.feature}),s,!0);var c=t._highlightLayers[s];c.redraw()}};setTimeout(i,0)},e.prototype.getHighlightLayer=function(e){return e?this._highlightLayers[e]:(this.app.trace.warning("Unable to get a highlight layer with null or empty name"),null)},e.prototype.getHighlightLayerOrActive=function(e){var t;return t=e?this.getHighlightLayer(e):this._activeHighlightLayer()},e.prototype.activeHighlightLayerGraphics=function(){var e=this._activeHighlightLayer();return e&&e.graphics?e.graphics.slice(0):null},e.prototype.defaultHighlightLayerGraphics=function(){var e=this.getHighlightLayer(this._defaultHighlightLayerName);return e?e.graphics.slice(0):null},e.prototype._highlightFeaturesImpl=function(e,t,i){if(void 0===t&&(t=""),void 0===i&&(i=!1),e&&e.length&&e[0]){t=t||this._defaultHighlightLayerName;var a=this.getOrCreateHighlightLayer(t);if(a){for(var s=this._outerHighlightRenderer.borderColor,l=this._highlightRenderer.borderColor,c=this._outerHighlightRenderer.fillColor,u=this._outerHighlightRenderer.borderWidth,d=[],p=0;p<e.length;p++){var h=e[p];if(h instanceof n.Feature)try{var m;if(h.borderColor&&h.borderColor.get()&&(m=r.getColorFromList(h.borderColor.get()),m&&this.setHighlightBorderColor(m)),h.fillColor&&h.fillColor.get()&&(m=r.getColorFromList(h.fillColor.get()),m&&this.setHighlightFillColor(m)),h.borderWidth&&h.borderWidth.get()){var f=h.borderWidth.get();f>=0&&this.setBorderWidth(f)}var g=this._highlightGraphic(h.esriFeature.get(),a,t,i,h);g&&d.push(g)}finally{this.setOuterHighlightBorderColor(s),this.setInnerHighlightBorderColor(l),this.setHighlightFillColor(c),this.setBorderWidth(u)}else{var g=this._highlightGraphic(h,a,t,i);g&&d.push(g)}}for(var y=0;y<d.length;y++)o.moveGraphicToTop(d[y])}}},e.prototype._highlightGraphic=function(e,t,i,r,n){if(void 0===r&&(r=!1),e&&e.geometry&&t){var a;i||(i=this._defaultHighlightLayerName),a=this.getOrCreateHighlightLayer(i);var o=this._getOrCreateMangedGraphic(e,t,i,n);if(!o)return null;var s=r?this._focusRenderer:this._highlightRenderer,l=r?this._outerFocusRenderer:this._outerHighlightRenderer;if(o.bottomGraphic.hide(),o.topGraphic.hide(),o.bottomGraphic.geometry){if(o.highlightFocused&&!r&&(o.highlightFocused=!1),r?o.highlightFocused=!0:o.highlightStandard=!0,this._supressedHighlightIds.indexOf(this._getHighlightId(o.managedGraphic))>-1)return this.app.command("RemovePushpin").execute({feature:o.gcxFeature,tag:i}),o.bottomGraphic.hide(),void o.topGraphic.hide();var c=t.renderer?t.renderer.getSymbol(o.bottomGraphic):null,u=s.getSymbol(o.bottomGraphic,o.originalSymbol,!0);c?u=null:c=l.getSymbol(o.bottomGraphic,o.originalSymbol),o.bottomGraphic.setSymbol(c),o.topGraphic.setSymbol(u),a.graphics.indexOf(o.bottomGraphic)===-1&&a.add(o.bottomGraphic),a.graphics.indexOf(o.topGraphic)===-1&&a.add(o.topGraphic),o.bottomGraphic.show(),o.topGraphic.show();var d=o.bottomGraphic.getNode();d&&d.setAttribute("style","pointer-events: none");var p=o.topGraphic.getNode();p&&p.setAttribute("style","pointer-events: none"),r&&this._addPushpinIfNeeded(o.topGraphic,o,i,n)}return o.topGraphic}},e.prototype._clearFeatureEmphasis=function(e,t){var i=this;if(e){var n=[];if(t)n.push(t);else for(var a in this._highlightLayers)this._highlightLayers.hasOwnProperty(a)&&n.push(this._highlightLayers[a]);n.forEach(function(t){i._refreshHighlightId(e);var n=i._retrieveManagedGraphic(e,t);if(n&&n.highlightFocused){if(n.gcxFeature&&i.app.command("RemovePushpin").execute({feature:n.gcxFeature,tag:n.highlightLayer}),!n.highlightStandard)return n.highlightFocused=!1,void i._clearFeatureHighlight(e,t);n.bottomGraphic,n.topGraphic;n.highlightFocused=!1;var a=i._outerHighlightRenderer.borderColor,o=i._highlightRenderer.borderColor,s=i._outerHighlightRenderer.fillColor,l=i._outerHighlightRenderer.borderWidth;if(n.gcxFeature&&n.gcxFeature.borderColor&&n.gcxFeature.borderColor.get()){var c=r.getColorFromList(n.gcxFeature.borderColor.get());c&&i.setHighlightBorderColor(c)}if(n.gcxFeature&&n.gcxFeature.fillColor&&n.gcxFeature.fillColor.get()){var c=r.getColorFromList(n.gcxFeature.fillColor.get());c&&i.setHighlightFillColor(c)}if(n.gcxFeature&&n.gcxFeature.borderWidth&&n.gcxFeature.borderWidth.get()){var u=n.gcxFeature.borderWidth.get();u>=0&&i.setBorderWidth(u)}n.bottomGraphic.setSymbol(i._outerHighlightRenderer.getSymbol(n.bottomGraphic,n.originalSymbol)),n.topGraphic.setSymbol(i._highlightRenderer.getSymbol(n.topGraphic,n.originalSymbol,!0)),i.setOuterHighlightBorderColor(a),i.setInnerHighlightBorderColor(o),i.setHighlightFillColor(s),i.setBorderWidth(l)}})}},e.prototype._clearFeatureHighlight=function(e,t){var i=this;if(e){var r=[];if(t)r.push(t);else for(var n in this._highlightLayers)this._highlightLayers.hasOwnProperty(n)&&r.push(this._highlightLayers[n]);r.forEach(function(t){var r=i._retrieveManagedGraphic(e,t);if(r){if(r.highlightFocused&&r.highlightStandard)return void(r.highlightStandard=!1);var n=i._getHighlightLayerNameFromLayerId(t.id);r.highlightFocused&&r.gcxFeature&&i.app.command("RemovePushpin").execute({feature:r.gcxFeature,tag:n}),t.remove(r.bottomGraphic),t.remove(r.topGraphic);var a=i._getHighlightId(e);if(1===i._managedGraphics[a].length)delete i._managedGraphics[a];else{var o=i._managedGraphics[a].filter(function(e){return e.highlightLayer===i._getHighlightLayerNameFromLayerId(t.id)})[0];if(o){var s=i._managedGraphics[a].indexOf(o);i._managedGraphics[a].splice(s,1)}}}})}},e.prototype._getOrCreateMangedGraphic=function(e,t,i,r){var n=this._retrieveManagedGraphic(e,t);if(n)return n;var a=this._getHighlightId(e),o=this._getOrCreateHighlightGeometry(e.geometry,a);if(!o)return null;if(this._geometryExceedsMaxVertices(o))return dojo.isFunction(this.onMaxGeometryVerticesExceeded)&&this.onMaxGeometryVerticesExceeded(e),null;var s=new esri.Graphic(o,e.symbol?esri.symbol.fromJson(e.symbol.toJson()):null),l=new esri.Graphic(o,e.symbol?esri.symbol.fromJson(e.symbol.toJson()):null);this._setHighlightId(s,a),this._setHighlightId(l,a);var c=e.getLayer(),u=null;return u=c&&c.renderer?c.renderer.getSymbol(e):e.symbol,this._trackGraphic(e,s,l,t.id,i,u,r)},e.prototype._trackGraphic=function(e,t,i,r,n,a,o){var s,l=this._getHighlightId(e);this._managedGraphics.hasOwnProperty(l)?s=this._managedGraphics[l]:(s=[],this._managedGraphics[l]=s);for(var c=0;c<s.length;c++)if(s[c].highlightLayer===n)return s[c];var u="";o&&o.layer&&(u=o.layer.id);var d={originalLayer:u,highlightLayer:n,managedGraphic:e,bottomGraphic:t,topGraphic:i,originalSymbol:a,highlightStandard:!1,highlightFocused:!1,gcxFeature:o};return s.push(d),d},e.prototype._addPushpinIfNeeded=function(e,t,i,r){var a=e.geometry instanceof esri.geometry.Point||e.geometry instanceof esri.geometry.Multipoint;if(!a){var o=this.app.site.essentialsMap.allLayers().filter(function(e){return e.id===t.originalLayer})[0];o&&o.minScale&&o.minScale<this.app.map.getScale()?a=!0:t.gcxFeature&&this.app.command("RemovePushpin").execute({feature:t.gcxFeature,tag:i})}if(a){var s=r||new n.Feature({graphic:e});t.gcxFeature=s,t.gcxFeature.esriFeature.get().geometry=e.geometry,this.app.command("AddPushpin").execute({feature:s,tag:i}),this.app.command("ShowPushpins").execute()}},e.prototype._getHighlightLayerNameFromLayerId=function(e){var t=this.app.map.getLayer(e);if(t)for(var i in this._highlightLayers)if(this._highlightLayers.hasOwnProperty(i)&&this._highlightLayers[i]===t)return i;return null},e.prototype._toARGBHex=function(e){var t=("00"+Math.floor(255*e.a).toString(16)).slice(-2),i=("00"+e.r.toString(16)).slice(-2),r=("00"+e.g.toString(16)).slice(-2),n=("00"+e.b.toString(16)).slice(-2);return"#"+t+i+r+n},e.prototype._getHighlightId=function(e){if(e&&e.geometry){if(e[t.HIGHLIGHT_ID_PROPERTY])return e[t.HIGHLIGHT_ID_PROPERTY];var i=this._getGeometryHash(e.geometry);return e[t.HIGHLIGHT_ID_PROPERTY]=i,i}},e.prototype._getGeometryHash=function(e){return c.stringToHash(JSON.stringify(e,["rings","paths","points","x","y","xmax","ymax","xmin","ymin"])).toString()},e.prototype._getCachedGeometry=function(e){var t=this._geometryCache.filter(function(t){return t.highlightId===e});return t.length?t[0].geometry:null},e.prototype._cacheGeometry=function(e,t){this._geometryCache.unshift({highlightId:e,geometry:t}),this._geometryCache.length>this._maxGeomCacheItems&&(this._geometryCache.length=this._maxGeomCacheItems)},e.prototype._clearGeometryCache=function(){this._geometryCache.length=0},e.prototype._setHighlightId=function(e,i){e[t.HIGHLIGHT_ID_PROPERTY]=i},e.prototype._refreshHighlightId=function(e,i){i||(i=this._getHighlightId(e)),e[t.HIGHLIGHT_ID_PROPERTY]=null;var r=this._getHighlightId(e);if(r!==i&&this._managedGraphics[i]){this._managedGraphics[r]=this._managedGraphics[i],delete this._managedGraphics[i],this._managedGraphics[r].forEach(function(e){return e.managedGraphic[t.HIGHLIGHT_ID_PROPERTY]=r});var n=this._supressedHighlightIds.indexOf(i);n>-1&&(this._supressedHighlightIds.splice(n,1),this._supressedHighlightIds.push(r))}return r},e.prototype._showHighlightLayer=function(e){this.app.map.reorderLayer(e,this.app.map.graphicsLayerIds.length-1),e.visible||e.setVisibility(!0),e!=this._highlightLayers[this._defaultHighlightLayerName]&&this.app.map.reorderLayer(this._highlightLayers[this._defaultHighlightLayerName],this.app.map.graphicsLayerIds.length-1)},e.prototype._activeHighlightLayer=function(){return this.activeHighlightLayerName?this.getHighlightLayer(this.activeHighlightLayerName):null},e.prototype._shouldGeneralizeGeometry=function(e){if(this._ramerGeomGeneralizationDisabled)return!1;if(!e||!e.rings&&!e.paths)return!1;var t=0;return e instanceof esri.geometry.Polygon?e.rings.forEach(function(e){return t+=e.length}):e.paths.forEach(function(e){return t+=e.length}),t>this._ramerGeomVerticesThreshold&&this._ramerEpsilon>0},e.prototype._getOrCreateHighlightGeometry=function(e,t){if(!e)return null;if(!this._shouldGeneralizeGeometry(e)||!t)return esri.geometry.fromJson(e.toJson());var i=this._getCachedGeometry(t);return i||(i=d.getRamerDouglasPeuckerSimplifiedGeometry(e,this._ramerEpsilon),this._cacheGeometry(t,i)),i},e.prototype._geometryExceedsMaxVertices=function(e){if(!e||!e.rings&&!e.paths||0===this._maxHighlightableGeometryVertices)return!1;var t=0;return e instanceof esri.geometry.Polygon?e.rings.forEach(function(e){return t+=e.length}):e.paths.forEach(function(e){return t+=e.length}),t>this._maxHighlightableGeometryVertices},e.prototype._retrieveManagedGraphic=function(e,t){var i=null,r=this._getHighlightId(e);if(this._managedGraphics.hasOwnProperty(r))for(var n=0;n<this._managedGraphics[r].length;n++)if(this._managedGraphics[r][n].highlightLayer===this._getHighlightLayerNameFromLayerId(t.id)){i=this._managedGraphics[r][n];break}return i},e.prototype.exportState=function(){var e=this;return Promise["try"](function(){var t=e.app.project.convert,i={highlightLayers:{},activeHighlightLayerName:e.activeHighlightLayerName,highlights:[]};for(var r in e._highlightLayers)i.highlightLayers[r]=t.fromEsriLayer(e._highlightLayers[r]),i.highlightLayers[r].layers=[],i.highlightLayers[r].featureCollection.layers=[];for(var n in e._managedGraphics)e._managedGraphics[n].forEach(function(e){e.highlightFocused&&!e.highlightStandard||i.highlights.push({feature:t.fromEsriGraphic(e.managedGraphic),originalLayer:e.originalLayer,highlightLayer:e.highlightLayer})});return i})},e.prototype.applyState=function(e){var t=this,i=this.app.project.convert,r={};for(var n in e.highlightLayers)r[n]=i.toEsriLayer(e.highlightLayers[n]);var l={highlightLayers:a.PromiseUtils.propsSkipRejected(r),highlights:a.PromiseUtils.mapSkipRejected(e.highlights,function(e){return Promise.props({graphic:i.toEsriGraphic(e.feature),originalLayer:e.originalLayer,highlightLayer:e.highlightLayer})})};return Promise.props(l).then(function(i){for(var r in t._highlightLayers)t.clearHighlights(r);t._highlightLayers={},t._managedGraphics={};for(var r in i.highlightLayers)t._highlightLayers[r]=i.highlightLayers[r],u.addToGraphicsLayerIdsToExclude([s.ExcludeFromEnum.ExportApplyStateName,s.ExcludeFromEnum.WebMapName],r);t.activeHighlightLayerName=e.activeHighlightLayerName;for(var n=[],a=function(e){var r=i.highlights[e],a=(t._getHighlightId(r.graphic),t._highlightLayers[r.highlightLayer]),o=a.graphics.filter(function(e){return t._getHighlightId(e)===t._getHighlightId(r.graphic)});if(o.length>0){var s=o[0],l=o[1]||new esri.Graphic(s.toJson()),c=t._trackGraphic(r.graphic,s,l,r.originalLayer,r.highlightLayer,null);c.highlightStandard=!0}else{var l=t._highlightGraphic(r.graphic,r.highlightLayer);l&&n.push(l)}},l=0;l<i.highlights.length;l++)a(l);for(var c=0;c<n.length;c++)o.moveGraphicToTop(n[c])})},e}();t.HighlightManager=p})},"geocortex/infrastructure/CancellationToken":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/native/NativeMessage":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/native/MessageClient":function(){define(["require","exports","geocortex/infrastructure/Dictionary"],function(e,t,i){"use strict";var r=function(){function e(e){this.app=e,this._handlers=new i.Dictionary,window.__geocortexNativeMessageClient=this}return e.prototype._postMessage=function(e,t){var i;try{i=JSON.parse(t)}catch(r){return void this.app.trace.warning("Native message could not be parsed to JSON: "+t)}for(var n=0,a=this._handlers.get(e)||[];n<a.length;n++){var o=a[n];o(i)}},e.prototype.subscribe=function(e,t){var i=this._handlers.get(e);i||(i=[],this._handlers.set(e,i)),i.push(t)},e.prototype.unsubscribe=function(e,t){var i=this._handlers.get(e);if(i){var r=i.indexOf(t);r>=0&&i.splice(r,1)}},e.prototype.message=function(e,t,i,r){var n=this;return new Promise(function(a,o){if(!n.app.nativeManager.isNative())return void o(new Error("Method not supported in browser."));var s;i&&i.register(function(){n.cancel(s)});if(r){var l=function(e){if(e.parameters.jobId===s)if("inProgress"===e.parameters.status)r(e.parameters);else if("complete"===e.parameters.status)a(e.parameters.details),n.unsubscribe("JobProgress",l);else if("canceled"===e.parameters.status){var t=new Error(e.parameters.details.message);t.name="OperationCanceled",o(t),n.unsubscribe("JobProgress",l)}else"error"===e.parameters.status&&(o(new Error(e.parameters.details.message)),n.unsubscribe("JobProgress",l))};n.subscribe("JobProgress",l)}n.app.nativeManager.onNativeInitialized().then(function(){return n.app.nativeManager.xhrPost({url:n.app.localServerAddress+"/message/"+e,postData:JSON.stringify(t),method:"POST"})}).then(function(e){var t=JSON.parse(e);s=t.jobId,i&&i.isCancellationRequested?n.cancel(s):s?n.app.nativeManager.xhrPost({url:n.app.localServerAddress+"/message/JobHandshake",postData:JSON.stringify({jobId:s}),method:"POST"}):a(t.result)})["catch"](function(e){try{var t=JSON.parse(e.response.data);o(new Error(t.error.message))}catch(i){o(e)}})})},e.prototype.cancel=function(e){if(e)return this.app.nativeManager.xhrPost({url:this.app.localServerAddress+"/message/CancelJob",postData:JSON.stringify({jobId:e}),method:"POST"})},e}();t.MessageClient=r})},"geocortex/infrastructure/native/ResourceInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/native/NativeManager":function(){define(["require","exports","geocortex/infrastructure/native/MessageClient"],function(e,t,i){"use strict";var r=function(){function e(e){this.app=e,this.nativeInitialized=!1,this._messageClient=new i.MessageClient(e)}return e.prototype.isNative=function(){return/\bGeocortexApp\b/.test(navigator.userAgent)||/http:\/\/127.0.0.1(:[0-9]*)?\/viewerpackages\//gi.test(window.location.href)||this.app.isNative.get()},e.prototype.xhrGet=function(e){var t=this;return this.onNativeInitialized().then(function(){return t.appendAuthorizationHeader(e),dojo.xhrGet(e)})},e.prototype.xhrPost=function(e){var t=this;return this.onNativeInitialized().then(function(){return t.appendAuthorizationHeader(e),dojo.xhrPost(e)})},e.prototype.appendAuthorizationHeader=function(e){e||(e={}),e.headers||(e.headers={}),e.headers.Authorization||(e.headers.Authorization="Token "+this.app.localServerToken)},e.prototype.message=function(e,t,i,r){return this._messageClient.message(e,t,i,r)},e.prototype.subscribe=function(e,t){return this._messageClient.subscribe(e,t)},e.prototype.onNativeInitialized=function(){var e=this;return this._nativeInitializedPromise?this._nativeInitializedPromise:(this._nativeInitializedPromise=new Promise(function(t,i){e._nativeInitializedResolve=t}),this._nativeInitializedPromise)},e.prototype.signalNativeInitialized=function(){this.onNativeInitialized(),this.nativeInitialized=!0,this._nativeInitializedResolve()},e.prototype.getViewerResourceInfo=function(e){var t=this.app.localServerAddress+"/resource/"+this.app.localServerNamespace+"/"+e+"/info";return this.xhrGet({url:t}).then(function(e){var t=JSON.parse(e);return{name:t.name,exists:t.exists,length:t.length,lastAccessTime:t.lastAccessTime?new Date(t.lastAccessTime):null,lastWriteTime:t.lastWriteTime?new Date(t.lastWriteTime):null}})},e.prototype.hasNativeCapability=function(e){var t=this;return new Promise(function(i,r){t._capabilities?i(t._capabilities.indexOf(e)>-1):t.isNative()?geocortex.GeocortexNativeApp.capabilities(function(r){t._capabilities=r,i(t._capabilities.indexOf(e)>-1)},function(e){i(!1)}):i(!1)})},e}();t.NativeManager=r})},"geocortex/infrastructure/CancellationTokenSource":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this._tokenImpl=new r}return e.prototype.token=function(){return this._tokenImpl},e.prototype.cancel=function(){this._tokenImpl.cancel()},e.prototype.dispose=function(){this._tokenImpl.dispose()},e.none=function(){return this._none||(this._none={isCancellationRequested:!1,register:function(e){}}),this._none},e}();t.CancellationTokenSource=i;var r=function(){function e(){this._listeners=new Array,this.isCancellationRequested=!1}return e.prototype.register=function(e){this._listeners.push(e)},e.prototype.cancel=function(){this.isCancellationRequested=!0;for(var e=0;e<this._listeners.length;e++)this._listeners[e]()},e.prototype.dispose=function(){this._listeners.length=0},e}()})},"geocortex/infrastructure/offline/OfflineMap":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){function t(e){if(!e)throw new Error("offlineMap is null or undefined.");if(!e.id)throw new Error("offlineMap.id is null or undefined.");if(!e.content)throw new Error("offlineMap.content is null or undefined.");if(!e.content.geometry)throw new Error("offlineMap.content.geometry is null or undefined.");if(!e.content.basemaps)throw new Error("offlineMap.content.basemaps is null or undefined.");for(var t=0;t<e.content.basemaps.length;t++){if(!e.content.basemaps[t].url)throw new Error("offlineMap.content.basemaps["+t+"].url is null or undefined.");if(!e.content.basemaps[t].baseMapId)throw new Error("offlineMap.content.basemaps["+t+"].baseMapId is null or undefined.");if(!e.content.basemaps[t].filename)throw new Error("offlineMap.content.basemaps["+t+"].filename is null or undefined.");if(!e.content.basemaps[t].sourceType)throw new Error("offlineMap.content.basemaps["+t+"].sourceType is null or undefined.")}if(!e.content.layers)throw new Error("offlineMap.content.layers is null or undefined.");for(var i=0;i<e.content.layers.length;i++)if(!e.content.layers[i].layerInfoUniqueId)throw new Error("offlineMap.content.layers["+i+"].layerInfoUniqueId is null or undefined.");if(!e.properties.siteId)throw new Error("offlineMap.properties.siteId is null or undefined.");if(!e.properties.viewerId)throw new Error("offlineMap.properties.viewerId is null or undefined.")}function i(e,t){var i={};e.description!==t.description&&(i.description=t.description),r(e.grants,t.grants)||(i.grants=t.grants),r(e.properties,t.properties)||(i.properties=t.properties),r(e.shape,t.shape)||(i.shape=t.shape),r(e.tags||[],t.tags||[])||(i.tags=t.tags),e.title!==t.title&&(i.title=t.title),r(e.thumbnail,t.thumbnail)||(i.thumbnail=t.thumbnail),e.version!==t.version&&(i.version=t.version),null==e.content!=(null==t.content)?i.content=t.content:null==t.content?i.content=null:r(e.content,t.content)||(i.content={},r(e.content.geometry,t.content.geometry)||(i.content.geometry=t.content.geometry),r(e.content.layers,t.content.layers)||(i.content.layers=t.content.layers),r(e.content.basemaps,t.content.basemaps)||(i.content.basemaps=t.content.basemaps),e.content.includeAttachments!==t.content.includeAttachments&&(i.content.includeAttachments=t.content.includeAttachments));for(var n in i)if(i.hasOwnProperty(n))return i;return null}function r(e,t){return e===t||JSON.stringify(e)===JSON.stringify(t)}e.verify=t,e.diff=i}(i=t.OfflineMap||(t.OfflineMap={}));var r;!function(e){e.Type={EXPORT_TILES:"exportTiles",PREGENERATED:"pregenerated"}}(r=t.OfflineMapBasemap||(t.OfflineMapBasemap={}))})},"geocortex/infrastructure/offline/bundle/RequestContext":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i){this.options=null,this.content=null,this.handleAs=null,this.timeOut=null,this.url=null,e&&dojo.mixin(this,e),this.dfd=t||new dojo.Deferred,this.options=i||null}return e}();t.RequestContext=i})},"geocortex/infrastructure/offline/bundle/RoutingRule":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/offline/bundle/offlineHandlers/OfflineHandler":function(){define(["require","exports"],function(e,t){"use strict";function i(e){var t=e.dfd,i=e.load;i&&t.addCallback(function(e){var r=t._pendingDfd,n=r&&r.ioArgs,a=n&&n.args;return i.call(a,e,n)});var r=e.error;r&&t.addErrback(function(e){var i=t._pendingDfd,n=i&&i.ioArgs,a=n&&n.args;return r.call(a,e,n)})}t.hookDeferredCallbacks=i})},"geocortex/infrastructure/offline/bundle/offlineHandlers/RewriteHandler":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function t(e,t){this.app=e,this.unhackedRequesthandler=t,this.name="Rewrite"}return t.prototype.handle=function(t,i,r,n){t.url=this.rewriteRequest(t,i,r),!e.has("esri-cors")&&Modernizr.cors&&(delete e.has.cache["esri-cors"],e.has.add("esri-cors",function(){return!0}));var a=null;return n.register(function(){a&&a.cancel("Pass through from ESRI cancellation.")}),a=this.unhackedRequesthandler(t,t.options).then(function(e){return t.dfd.resolve(e)},function(e){return t.dfd.errback(e)}),!0},t.prototype.rewriteRequest=function(e,t,i){if(!t||!t.parameters||!t.parameters.newUrl)throw new Error("Not a rewrite rule.");var r=t.parameters.newUrl;return r=r.format.apply(r,i),r=r.replace("{localserver}",this.app.localServerAddress),this.app.localServerAddress&&this.app.localServerAddress.length>0&&r.startsWith(this.app.localServerAddress)&&(r=this._appendLocalServerToken(r)),r},t.prototype._appendLocalServerToken=function(e){return this.app.localServerToken&&(e.endsWith("?")||(e+=e.indexOf("?")>0?"&":"?"),e+="localServerToken="+this.app.localServerToken),e},t}();t.RewriteHandler=i})},"geocortex/infrastructure/offline/bundle/OfflineRouter":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/offline/bundle/RequestContext","geocortex/infrastructure/CancellationTokenSource"],function(e,t,i,r,n){"use strict";var a=function(){function e(e){var t=this;this.app=e,this.isReady=new i.Observable((!1)),this._handlers={},this._rules=[],this.app.command("RewriteUrlForOffline").register(this,function(e,i){i(t.rewriteUrl(e))})}return e.prototype.addHandler=function(e){this._handlers[e.name]=e},e.prototype.removeHandler=function(e){return!!this._handlers.hasOwnProperty(e)&&(delete this._handlers[e],!0)},e.prototype.setDefaultHandler=function(e){this._defaultHandler=e},e.prototype.setRoutingRules=function(e){this._rules=e.concat(),this.isReady.set(!0)},e.prototype.setRoutingRulesFromPromise=function(e){var t=this;this._rules.length=0,this.isReady.set(!1),e.then(function(e){if(!e)return void t.app.trace.debug("No offline request routing table was found.");try{t.setRoutingRules(JSON.parse(e))}catch(i){t.app.trace.error("Unable to parse routing rules: {0}".format(i))}},function(e){t.app.trace.warning("An error occurred while attempting to fetch offline request routing rules: {0}".format(e))})},e.prototype.clearRoutingRules=function(){this._rules.length=0,this.isReady.set(!1)},e.prototype.rewriteUrl=function(e){var t=this._handlers.Rewrite;if(!t)return e;e=this._stripOutProxy(e);for(var i=0;i<this._rules.length;++i){var r=this._rules[i];if("Rewrite"===r.handlerName){var n=new RegExp(r.pattern),a=n.exec(e);if(a&&a.length&&a.length>0)return t.rewriteRequest(null,r,a)}}return null},e.prototype.handle=function(e,t){var i=this,a=new n.CancellationTokenSource,o=new dojo.Deferred(function(e){a.cancel()});return this._whenReady(function(){for(var n=new r.RequestContext(e,o,t),s=i._stripOutProxy(n.url),l=!1,c=0;c<i._rules.length;++c){var u=i._rules[c],d=new RegExp(u.pattern),p=d.exec(s),h=!0;if(p&&u.queryParameterPatterns)for(var m in u.queryParameterPatterns){var f=u.queryParameterPatterns[m],g=e.content?e.content[m]:null,y=new RegExp(f.pattern),b=y.exec(g);h=h&&!!b}if(p&&p.length&&p.length>0&&h){var v=i._handlers[u.handlerName];if(v){l=!0;try{if(v.handle(n,u,p,a.token())===!1){l=!1;continue}break}catch(S){i.app.trace.warning("Offline request failed for resource '"+e.url+"'. "+S),o.errback(new Error("Offline request failed"));break}}else i.app.trace.warning("Offline request failed for resource '"+e.url+"'. Matching rule found without handler.")}}l||i._defaultHandler.handle(n,null,null,a.token())}),o.then(function(){return a.dispose()},function(){return a.dispose()}),o},e.prototype._whenReady=function(e){this.isReady.get()?e():this.isReady.once(this,e)},e.prototype._stripOutProxy=function(e){if(!e)return null;var t=this.app.configuration.proxyUri;return e.indexOf(t)>=0?e.replace?e.replace(t,""):null:e},e}();t.OfflineRouter=a})},"geocortex/infrastructure/offline/bundle/EsriRequestHacker":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.app=e,this.requestHandler=t,this._isEnabled=!0,this._setupEsriRequestHooks()}return e.prototype.unhackedRequest=function(e,t){return this._hooked_esri_request.call(esri,e,t)},e.prototype.disable=function(){this._isEnabled=!1},e.prototype.enable=function(){this._isEnabled=!0},e.prototype._setupEsriRequestHooks=function(){var e=this;if(!esri.request)return void this.app.trace.error("Offline module could not hook into ESRI API.");this._hooked_esri_request=esri.request,esri.request=function(t,i){return e.app.offlineManager.getActiveOfflineMap()&&e._isEnabled?e.requestHandler(t,i):e._hooked_esri_request.call(esri,t,i)};var t=null;esri.request.setRequestPreCallback=function(e){t=e},this._hooked_esri_request.setRequestPreCallback(function(i){return e.app.nativeManager.isNative()&&/^https:\/\/(localhost|127\.0\.0\.1)(:\d+)?\//.test(i.url)&&(i.url="http"+i.url.substring(5)),t&&(i=t(i)),i})},e}();t.EsriRequestHacker=i})},"geocortex/infrastructure/offline/bundle/EsriLayerHacker":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.app=e,this.urlRewriter=t,this.errorReporter=function(e){},this._captureHooks(),this._extendEsriLayers()}return e.prototype._captureHooks=function(){this._hooked_esri_getTileUrl=esri.layers.ArcGISTiledMapServiceLayer._meta.hidden.getTileUrl,this._hooked_ogc_getWMTSTileUrl=esri.layers.WMTSLayer._meta.hidden.getTileUrl,this._ogc__tileLoadHandler=esri.layers.WMTSLayer.superclass._tileLoadHandler,this._hooked_BingMaps_getTileUrl=esri.virtualearth.VETiledLayer._meta.hidden.getTileUrl,this._bingMaps__tileLoadHandler=esri.virtualearth.VETiledLayer.superclass._tileLoadHandler,this._hooked_WebTiledLayer_getTileUrl=esri.layers.WebTiledLayer._meta.hidden.getTileUrl,this._webTiledLayer__tileLoadHandler=esri.layers.WebTiledLayer.superclass._tileLoadHandler,this._hooked_esri_getImageUrl=esri.layers.ArcGISDynamicMapServiceLayer._meta.hidden.getImageUrl,this._hooked_ogc_getImageUrl=esri.layers.WMSLayer._meta.hidden.getImageUrl},e.prototype._extendEsriLayers=function(){var e=this;esri.virtualearth.VETiledLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_BingMaps_getTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n},_tileLoadHandler:function(t){e._bingMaps__tileLoadHandler.apply(this,[t])}}),esri.layers.WMTSLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_ogc_getWMTSTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n;
},_tileLoadHandler:function(t){e._ogc__tileLoadHandler.apply(this,[t])}}),esri.layers.WebTiledLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_WebTiledLayer_getTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n},_tileLoadHandler:function(t){e._webTiledLayer__tileLoadHandler.apply(this,[t])}}),esri.layers.ArcGISTiledMapServiceLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_esri_getTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n}}),esri.layers.WMSLayer.extend({getImageUrl:function(t,i,r,n){if(!e.app.offlineManager.isOfflineMapActive.get())return i&&r||e.errorReporter("Invalid dimensions on requested map image. This is usually due to an invalid map resize event."),void e._hooked_ogc_getImageUrl.apply(this,arguments);var a=function(t){var i=e.urlRewriter(t)||t;n&&n(i)};e._hooked_ogc_getImageUrl.apply(this,[t,i,r,a])}}),esri.layers.ArcGISDynamicMapServiceLayer.extend({getImageUrl:function(t,i,r,n){if(!e.app.offlineManager.isOfflineMapActive.get())return i&&r||e.errorReporter("Invalid dimensions on requested map image. This is usually due to an invalid map resize event."),void e._hooked_esri_getImageUrl.apply(this,arguments);var a=function(t){var i=e.urlRewriter(t)||t;n&&n(i)};e._hooked_esri_getImageUrl.apply(this,[t,i,r,a])}})},e}();t.EsriLayerHacker=i})},"geocortex/infrastructure/offline/bundle/BundleResourceEntry":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e){e?dojo.safeMixin(this,e):this.key=""}return e}();t.BundleResourceEntry=i})},"geocortex/infrastructure/offline/bundle/Bundle":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/offline/bundle/offlineHandlers/ServeResourceHandler":function(){define(["require","exports","geocortex/infrastructure/offline/bundle/offlineHandlers/OfflineHandler","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(){function e(e,t,i,n){this.app=e,this.resourceGetter=t,this.resourceSetter=i,this.resourceRemover=n,this.name="ServeResource",this.isReady=new r.Observable((!1))}return e.prototype.handle=function(e,t,r,n){var a=this;if(!this._bundle||!t.parameters||!t.parameters.key)return!1;var o=t.parameters.key;o=o.format.apply(o,r);for(var s=0,l=this._bundle.resources.length;s<l;s++)if(this._bundle.resources[s].key===o)return i.hookDeferredCallbacks(e),this._getResourceValue(this._bundle.resources[s]).then(function(t){e.dfd.resolve(t)})["catch"](function(t){a.app.trace.error(t.message),e.dfd.reject(t.message)}),!0;return!1},e.prototype.loadBundle=function(e){this.isReady.set(!0),this._bundle=e},e.prototype.clear=function(){this.isReady.set(!1),this._bundle=null},e.prototype.stripAndStoreBundle=function(t){var i=this;if(!t)return Promise.reject(new Error("Bundle cannot be null."));var r=t.resources.map(function(r){return null==r.value?Promise.reject(new Error("Bundle resoure entry value is already null: "+r.key)):r.value&&r.value.length>e._resourceCachingLength?i.resourceSetter(e.getResourceStorageKey(t.id,r.key),r.value).then(function(){r.value=null},function(e){i.app.trace.error("Unable to strip '"+r.key+"' out of the bundle and store it separately. "+e)}):null});return Promise.all(r).then(function(){return t})},e.prototype.unstoreBundle=function(t){var i=this;if(!t)return Promise.reject(new Error("Bundle cannot be null."));var r=t.resources.map(function(r){return null==r.value?i.resourceRemover(e.getResourceStorageKey(t.id,r.key)):null});return Promise.all(r).then(function(){return t})},e.prototype.getResourceValue=function(e){for(var t=0,i=this._bundle.resources.length;t<i;t++)if(this._bundle.resources[t].key===e)return this._getResourceValue(this._bundle.resources[t]);return Promise.reject(new Error("No such entry found."))},e.prototype._getResourceValue=function(t){var i=this;return Promise.resolve(t.value).then(function(r){return null==r?i.resourceGetter(e.getResourceStorageKey(i._bundle.id,t.key)):r}).then(function(e){if(!e)throw new Error("Resource entry missing for: "+t.key);return e}).then(function(e){return t.isEncoded===!0&&(e=n.base64Decode(e)),t.isJson===!0&&(e=JSON.parse(e)),e})},e.getResourceStorageKey=function(e,t){return e+"-"+t},e}();a._resourceCachingLength=200,t.ServeResourceHandler=a})},"geocortex/infrastructure/offline/bundle/offlineHandlers/PassthroughHandler":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.app=e,this.unhackedRequesthandler=t,this.name="Passthrough"}return e.prototype.handle=function(e,t,i,r){return this.unhackedRequesthandler(e,e.options).then(function(t){return e.dfd.resolve(t)},function(t){return e.dfd.errback(t)}),!0},e}();t.PassthroughHandler=i})},"geocortex/infrastructure/offline/bundle/offlineHandlers/FailHandler":function(){define(["require","exports","geocortex/infrastructure/offline/bundle/offlineHandlers/OfflineHandler"],function(e,t,i){"use strict";var r=function(){function e(){this.name="Fail"}return e.prototype.handle=function(e,t,r,n){return e.dfd.reject(),i.hookDeferredCallbacks(e),!0},e}();t.FailHandler=r})},"geocortex/infrastructure/offline/bundle/offlineHandlers/SiteHandler":function(){define(["require","exports","geocortex/infrastructure/offline/bundle/offlineHandlers/OfflineHandler","geocortex/infrastructure/offline/bundle/RequestContext"],function(e,t,i,r){"use strict";var n=function(){function e(e,t,i,r){this.app=e,this.siteJsonGetter=t,this.siteJsonSetter=i,this.unhackedRequesthandler=r,this.name="Site"}return e.prototype.handle=function(e,t,r,n){var a=this;return i.hookDeferredCallbacks(e),this.siteJsonGetter(t.parameters.key).then(function(i){return i.__loadedOffline=!0,a._hasToken(e)?a._getOnlineSitePrincipal(e).then(function(e){return i.principal=e,a.siteJsonSetter(t.parameters.key,JSON.stringify(i)).then(function(){return i})})["catch"](function(e){return a._getGmafPrincipal(i.principal).then(function(e){return i.principal=e,i})["catch"](function(e){return i})}):i}).then(function(t){e.dfd.resolve(t)})["catch"](function(t){e.dfd.errback(t)}),!0},e.prototype._hasToken=function(e){return/[?&]token=/.test(e.url)||e.content&&e.content.token},e.prototype._getOnlineSitePrincipal=function(e){var t=this,i=new r.RequestContext({callbackParamName:e.callbackParamName,content:e.content,form:e.form,handleAs:e.handleAs,timeOut:1e4,url:e.url},null,e.options);return new Promise(function(e,r){return t.unhackedRequesthandler(i,i.options).then(e,r)}).then(function(e){if(!e||e.error||!e.principal)throw new Error("Site JSON looks malformed.");return e.principal})},e.prototype._getGmafPrincipal=function(e){return this.app.nativeManager.nativeInitialized?this.app.nativeManager.xhrGet({url:this.app.localServerAddress+"/account/userinfo",handleAs:"json"}).then(function(t){if(!t||!t.token)throw new Error("GMAF has no login info.");return dojo.mixin(e,{isAuthenticated:!0,label:t.userName,expiry:(new Date).toISOString(),tokens:{site:t.token}})}):Promise.reject(new Error("Not a native app."))},e}();t.SiteHandler=n})},"geocortex/infrastructure/offline/SyncInfo":function(){define(["require","exports","geocortex/essentials/utilities/LayerUtilities"],function(e,t,i){"use strict";var r=function(){function e(e){this.servers=[],this.lastSyncNotificationDate=new Date(0);for(var t=0;t<e.servers.length;t++)"string"==typeof e.servers[t].lastSyncTime&&(e.servers[t].lastSyncTime=new Date(e.servers[t].lastSyncTime)),this.servers.push(e.servers[t]);this.lastSyncNotificationDate=new Date(e.lastSyncNotificationDate)}return e.prototype.isSynced=function(e){return!!this.findLayerOrTable(e)},e.prototype.findLayerOrTable=function(e){for(var t=i.LayerUtilities.decomposeFeatureLayerUrl(e),r=this.servers.filter(function(e){return e.featureServiceUrl==t.serviceUrl}),n=0;n<r.length;n++){var a=r[n],o=a.layers.filter(function(e){return e.id==t.layerId})[0];if(o)return o;var s=a.layers.filter(function(e){return e.id==t.layerId})[0];if(s)return s}return null},e.prototype.getOldestSyncTime=function(){if(this.servers.length){for(var e=this.servers[0].lastSyncTime,t=0;t<this.servers.length;t++)this.servers[t].lastSyncTime<e&&(e=this.servers[t].lastSyncTime);return e}return null},e}();t.SyncInfo=r})},"geocortex/infrastructure/offline/bundle/BundleBuilderContext":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ArrayUtils":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e.sortBy=function(e,t){return e.sort(function(e,i){var r=t(e),n=t(i);return r==n?0:r<n?-1:1}),e},e.sum=function(e,t){for(var i=0,r=0;r<e.length;r++)i+=t(e[r]);return i},e.max=function(e,t){for(var i=null,r=0;r<e.length;r++){var n=t(e[r]);(null==i||i<n)&&(i=n)}return i},e.mapWithErrorCallback=function(e,t,i,r){if("function"!=typeof t)throw new Error("Callback required.");if("function"!=typeof i)throw new Error("Error callback required.");if(!e)return e;for(var n=[],a=0;a<e.length;a++){var o=e[a];try{n.push(t.call(r,o,a,e))}catch(s){i.call(r,o,s,n)}}return n},e.findIndex=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(t(r))return i}return-1},e}();t.ArrayUtils=i})},"geocortex/infrastructure/gis/LayerInfo":function(){define(["require","exports","geocortex/infrastructure/gis/FieldInfo","geocortex/essentials/utilities/DecomposedUri","geocortex/essentials/MapServiceConstants","geocortex/essentials/Field","geocortex/infrastructure/ArrayUtils"],function(e,t,i,r,n,a,o){"use strict";var s=function(){function e(){this.fields=new Array,this.isUserCreated=!1,this.includeInLayerList=!0,this.isExpanded=!0,this._visible=!1,this._fieldsRetrieved=!1}return e.fromEsriLayerInfo=function(t,i){var n=new e;return n.esriLayerInfo=t,n.id=t.id+"",n.name=t.name,n.displayName=t.name,n.parentLayerId=t.parentLayerId?t.parentLayerId.toString():null,n.subLayerIds=t.subLayerIds?dojo.map(t.subLayerIds,function(e){return e.toString()}):null,n.uniqueId=i.id.replace(".","..")+"."+t.id,n.url=r.DecomposedUri.appendToPath(i.url,"/"+t.id),n.queryable=!0,n.dataProvider="Default",n._visible=t.defaultVisibility,n},e.fromEsriFeatureLayer=function(t){var i=new e;return i.id=t.id+"",i.name=t.name,i.displayName=t.name,i.uniqueId=t.id,i.url=t.url,i.queryable=!0,i.dataProvider="Default",i._featureLayer=t,i._visible=t.defaultVisibility,i.subLayerIds=null,i.parentLayerId=null,i.relationships=t.relationships,i},e.fromGcxLayer=function(t){var i=new e;return i.gcxLayer=t,i.id=t.id,i.name=t.name,i.displayName=t.displayName||t.name,i.uniqueId=t.mapService.id+"."+t.id,i.dataProvider=t.dataProvider||"Default",i.isExpanded=t.isExpanded,i.isUserCreated=t.isUserCreated,i.relationships=t.relationships,t.mapService.drawingBehavior==n.DrawingBehavior.FEATURE_LAYER?i.url=t.mapService.serviceLayer.url:t.mapService.mapServiceType==n.MapServiceType.DYNAMIC||t.mapService.mapServiceType==n.MapServiceType.TILED?i.url=r.DecomposedUri.appendToPath(t.mapService.serviceLayer.url,"/"+t.id):(t.mapService.serviceLayer instanceof esri.layers.WMSLayer||t.mapService.serviceLayer instanceof esri.layers.WFSLayer)&&(i.url=t.url),t.parentLayerId&&(i.parentLayerId=t.parentLayerId),i.subLayerIds=t.subLayerIds?t.subLayerIds:null,i.includeInLayerList=t.includeInLayerList,i.queryable=t.queryable&&t.fields.length>0&&t.supportsQuery,i._visible=t.configuredVisible,i},e.prototype.getUrlWithoutParameters=function(){var e=this.url.indexOf("?");return e>=0?this.url.substr(0,e):this.url},e.prototype.getFields=function(){var e=this,t=new dojo.Deferred;return this._fieldsRetrieved?t.resolve(this.fields):this.getInitializedFeatureLayer().then(function(r){for(var n=0;n<r.fields.length;n++){var a=r.fields[n],o=e.gcxLayer?e.gcxLayer.getFieldByName(a.name):null,s=i.FieldInfo.fromEsriField(a,r,o);e.fields.push(s)}e._fieldsRetrieved=!0,t.isCanceled()||t.resolve(e.fields)},function(e){t.errback(e)}),t},e.prototype.getInitializedFeatureLayer=function(){var e=this;return this.gcxLayer?this.gcxLayer.getFeatureLayer():new Promise(function(t,i){if(e._featureLayer||(e._featureLayer=new esri.layers.FeatureLayer(e.url)),e._featureLayer.loaded)return t(e._featureLayer);if(e._featureLayer.__attached_error)return i(e._featureLayer.__attached_error);var r=e._featureLayer.on("load",function(){if(r.remove(),n.remove(),e.gcxLayer.wmsLayerName||e.gcxLayer.wfsLayerName)for(var i=e.gcxLayer.fields,o=e._featureLayer.fields.length-1;o>=0;o--){var s=e._featureLayer.fields[o];"gml:id"===s.name&&e._featureLayer.fields.splice(o,1),s.type=a.Field.convertToEsriFieldType(i[o].dataType)}return t(e._featureLayer)}),n=e._featureLayer.on("error",function(t){return r.remove(),n.remove(),e._featureLayer.__attached_error=t,i(t)})})},e.prototype.setDefinitionExpression=function(e){var t=this.serviceLayerInfo.serviceLayer;if(t instanceof esri.layers.ArcGISDynamicMapServiceLayer){var i=t,r=i.layerDefinitions||[];e&&"1 = 1"!=e?r[parseInt(this.id)]=e:delete r[parseInt(this.id)],i.setLayerDefinitions(r)}else if(t instanceof esri.layers.FeatureLayer){var n=t;e&&"1 = 1"!=e?n.setDefinitionExpression(e):n.setDefinitionExpression(null)}},e.prototype.getDefinitionExpression=function(){var e=this.serviceLayerInfo.serviceLayer;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer){var t=e.layerDefinitions||[];return t[parseInt(this.id)]}return e instanceof esri.layers.FeatureLayer?e.getDefinitionExpression():null},e.prototype.isVisible=function(){return this.gcxLayer?this.gcxLayer.isVisible():this._visible},e.prototype.areAllAncestorsVisible=function(){for(var e=this.serviceLayerInfo.findLayerById(this.parentLayerId);null!==e&&void 0!==e;){if(!e.isVisible())return!1;e=this.serviceLayerInfo.findLayerById(e.parentLayerId)}return!0},e.prototype.setVisibility=function(e,t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=150);var n=!1;i&&this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer&&(n=this.serviceLayerInfo.supportsLayerVisibility()),this.gcxLayer?this.gcxLayer.setVisibility(e,t||n):this.setEsriLayerVisibility(e,t||n),n&&this.serviceLayerInfo.refresh(r)},e.prototype.setEsriLayerVisibility=function(e,t){var i=this;if(void 0===t&&(t=!1),this._visible=e,e||this.serviceLayerInfo.serviceLayer.visible){var r,a,s={mapServiceId:this.serviceLayerInfo.id,layerId:this.id,visibility:e},l=this.serviceLayerInfo.serviceLayer;switch(this.serviceLayerInfo.serviceType){case n.MapServiceType.DYNAMIC:if(l instanceof esri.layers.FeatureLayer)e?l.show():l.hide(),dojo.publish("LayerVisibilityChange",[new Array(s)]);else{var c=this.serviceLayerInfo.serviceLayer.visibleLayers.slice(0).map(function(e){return e.toString()});if(c&&c.length||l.layerInfos&&l.layerInfos.length){1===c.length&&"-1"==c[0]&&c.pop();var u=o.ArrayUtils.findIndex(c,function(e){return e==i.id});if(e){if(u!==-1)return;if(this.subLayerIds&&this.subLayerIds.length)return;c.push(this.id)}else{if(u===-1)return;c.splice(u,1)}c.length||c.push("-1"),c.InternallyChangedLayer=s,this.serviceLayerInfo.serviceLayer.setVisibleLayers(c,t)}else l.setVisibility(e),dojo.publish("LayerVisibilityChange",[new Array(s)])}break;case n.MapServiceType.WMS:if(null!==l){var d=[];for(d.InternallyChangedLayer=s,r=0,a=0;a<this.serviceLayerInfo.layers.length;a++){var p=this.serviceLayerInfo.layers[a];if(p.isVisible()&&(null===p.subLayerIds||0===p.subLayerIds.length)&&p.areAllAncestorsVisible()){var h=p.gcxLayer?p.gcxLayer.wmsLayerName:p.serviceLayerInfo.serviceLayer.id;(this.gcxLayer&&this.gcxLayer.wmsLayerName===h||this.serviceLayerInfo.serviceLayer.id===h||null!==h&&""!==h)&&(d[r]=h,r++)}}t?(this.serviceLayerInfo.serviceLayer.visibleLayers=d.slice(0),dojo.publish("LayerVisibilityChange",[new Array(s)])):this.serviceLayerInfo.serviceLayer.setVisibleLayers(d)}break;case n.MapServiceType.FEATURE:case n.MapServiceType.GEORSS:case n.MapServiceType.KML:case n.MapServiceType.BING:case n.MapServiceType.TILED:case n.MapServiceType.WMTS:case n.MapServiceType.IMAGE:case n.MapServiceType.WEBTILED:case n.MapServiceType.WFS:if(null!==l){if(1!==this.serviceLayerInfo.layers.length)throw new Error("Visibility of individual layers cannot be set for this Map Service: {0}".format(this.displayName));e?l.show():l.hide(),dojo.publish("LayerVisibilityChange",[new Array(s)])}break;default:throw new Error("Cannot set layer visibility. Unknown MapService type.")}}},e.prototype.getMinScale=function(){var e;return e=this.gcxLayer?this.gcxLayer.minScale:this._featureLayer?this._featureLayer.minScale:this.esriLayerInfo.minScale,this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer.minScale?Math.min(e,this.serviceLayerInfo.serviceLayer.minScale):e},e.prototype.getMaxScale=function(){var e;return e=this.gcxLayer?this.gcxLayer.maxScale:this._featureLayer?this._featureLayer.maxScale:this.esriLayerInfo.maxScale,this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer.maxScale?Math.max(e,this.serviceLayerInfo.serviceLayer.maxScale):e},e}();t.LayerInfo=s})},"geocortex/infrastructure/gis/GisUtils":function(){define(["require","exports","geocortex/essentials/MapServiceConstants"],function(e,t,i){"use strict";function r(e){return e instanceof esri.layers.DynamicMapServiceLayer?e instanceof esri.layers.ArcGISDynamicMapServiceLayer?i.MapServiceType.DYNAMIC:e instanceof esri.layers.ArcGISImageServiceLayer?i.MapServiceType.IMAGE:e instanceof esri.layers.WMSLayer?i.MapServiceType.WMS:i.MapServiceType.DYNAMIC:e instanceof esri.layers.TiledMapServiceLayer?e instanceof esri.layers.WMTSLayer?i.MapServiceType.WMTS:e instanceof esri.layers.WebTiledLayer?i.MapServiceType.WEBTILED:e instanceof esri.virtualearth.VETiledLayer?i.MapServiceType.BING:i.MapServiceType.TILED:e instanceof esri.layers.GraphicsLayer?e instanceof esri.layers.FeatureLayer?esri.layers.StreamLayer&&e instanceof esri.layers.StreamLayer?i.MapServiceType.STREAM:e instanceof esri.layers.CSVLayer?i.MapServiceType.CSV:i.MapServiceType.FEATURE:esri.layers.LabelLayer&&e instanceof esri.layers.LabelLayer?i.MapServiceType.LABEL:e instanceof esri.layers.WFSLayer?i.MapServiceType.WFS:i.MapServiceType.GRAPHICS:e instanceof esri.layers.GeoRSSLayer?i.MapServiceType.GEORSS:e instanceof esri.layers.KMLLayer?i.MapServiceType.KML:e instanceof esri.layers.MapImageLayer?i.MapServiceType.MAPIMAGE:i.MapServiceType.UNKNOWN}t.getServiceLayerType=r})},"geocortex/infrastructure/gis/ServiceLayerInfo":function(){define(["require","exports","geocortex/infrastructure/gis/LayerInfo","geocortex/infrastructure/gis/GisUtils","geocortex/essentials/LayerType","geocortex/essentials/MapServiceConstants"],function(e,t,i,r,n,a){"use strict";var o=function(){function e(){this.layers=[],this.tables=[],this.isUserCreated=!1,this.includeInLayerList=!0,this.isExpanded=!0,this._delayedRefreshToken=null}return e.fromEsriLayer=function(t){var n=new e;if(n.serviceLayer=t,n.serviceType=r.getServiceLayerType(t),n.id=t.id,t instanceof esri.layers.ArcGISDynamicMapServiceLayer||t instanceof esri.layers.ArcGISTiledMapServiceLayer){var a=t;n.capabilities=a.capabilities.split(",");for(var o=0;o<a.layerInfos.length;o++){var s=a.layerInfos[o],l=i.LayerInfo.fromEsriLayerInfo(s,t);l.serviceLayerInfo=n,n.layers.push(l)}}else if(t instanceof esri.layers.FeatureLayer){var c=t;n.displayName=c.name,n.capabilities=c.capabilities.split(",");var l=i.LayerInfo.fromEsriFeatureLayer(c);l.serviceLayerInfo=n,"Table"===c.type?n.tables.push(l):n.layers.push(l)}return n},e.fromGcxMapService=function(t){var r=new e;r.gcxMapService=t,r.serviceType=t.mapServiceType,r.serviceLayerFunction=t.mapServiceFunction,r.serviceLayer=t.serviceLayer,r.id=t.id,r.isExpanded=t.isExpanded,r.isUserCreated=t.isUserCreated,r.includeInLayerList=t.includeInLayerList,r.displayName=t.displayName,t.serviceLayer.capabilities&&(r.capabilities=t.serviceLayer.capabilities.split(","));for(var a=0;a<t.layers.length;a++){var o=t.layers[a],s=i.LayerInfo.fromGcxLayer(o);s.serviceLayerInfo=r,o.type===n.LayerType.TABLE_LAYER?r.tables.push(s):r.layers.push(s)}for(var a=0;a<t.tables.length;a++){var l=t.tables[a],c=i.LayerInfo.fromGcxLayer(l);c.serviceLayerInfo=r,r.tables.push(c)}return r},e.prototype.findLayerById=function(e){for(var t=0,i=this.layers.length;t<i;t++){var r=this.layers[t];if(e===r.id.toString())return r}return null},e.prototype.isVisible=function(){var e=!1;return this.serviceLayer&&"boolean"==typeof this.serviceLayer.visible&&(e=this.serviceLayer.visible),e},e.prototype.setVisibility=function(e){this.gcxMapService?this.gcxMapService.setVisibility(e):null!==this.serviceLayer&&this.serviceLayer.setVisibility(e)},e.prototype.opacity=function(){return this.gcxMapService?this.gcxMapService.opacity:this.serviceLayer?this.serviceLayer.opacity:null},e.prototype.setOpacity=function(e){this.gcxMapService?this.gcxMapService.setOpacity(e):this.serviceLayer&&((null==e||isNaN(e))&&(e=1),e=Math.min(1,Math.max(0,e)),this.serviceLayer.setOpacity(e))},e.prototype.refresh=function(e,t){var i=this,r=this.serviceLayer;if(r&&"function"==typeof r.refresh){var n=function(){if(i._delayedRefreshToken=null,e===!0&&"function"==typeof r.setDisableClientCaching){var e=r.disableClientCaching;r.setDisableClientCaching(!0),r.refresh(),r.setDisableClientCaching(e)}else r.refresh()};this._delayedRefreshToken&&clearTimeout(this._delayedRefreshToken),"number"!=typeof e?n():this._delayedRefreshToken=setTimeout(n,e)}},e.prototype.supportsLayerVisibility=function(){switch(this.serviceType){case a.MapServiceType.WMS:return!0;case a.MapServiceType.DYNAMIC:return null!==this.serviceLayer&&!!this.serviceLayer.visibleLayers;case a.MapServiceType.GRAPHICS:case a.MapServiceType.FEATURE:case a.MapServiceType.CSV:case a.MapServiceType.LABEL:case a.MapServiceType.STREAM:case a.MapServiceType.GEORSS:case a.MapServiceType.KML:case a.MapServiceType.BING:case a.MapServiceType.TILED:case a.MapServiceType.WMTS:case a.MapServiceType.WFS:case a.MapServiceType.IMAGE:case a.MapServiceType.WEBTILED:case a.MapServiceType.VECTORTILE:case a.MapServiceType.MAPIMAGE:case a.MapServiceType.UNKNOWN:default:return!1}},e.prototype.loaded=function(){var e=this;if(this._loadedDeferred)return this._loadedDeferred;if(this._loadedDeferred=new dojo.Deferred,this.serviceLayer.loaded)this._loadedDeferred.resolve(this.serviceLayer);else if(this.serviceLayer.loadError)this._loadedDeferred.resolve(this.serviceLayer.loadError);else var t=this.serviceLayer.on("load",function(){t.remove(),i.remove(),e._loadedDeferred.resolve(e.serviceLayer)}),i=this.serviceLayer.on("error",function(r){t.remove(),i.remove(),e._loadedDeferred.errback(r)});return this._loadedDeferred},e}();t.ServiceLayerInfo=o})},"geocortex/infrastructure/gis/MapInfo":function(){define(["require","exports","geocortex/infrastructure/gis/ServiceLayerInfo","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(){function e(){this.serviceLayers=[],this.markupLayer=new r.Observable}return e.fromEsriMap=function(t){var r=new e;r.map=t,r.markupLayer.set(t.graphics);for(var n=t.layerIds.concat(t.graphicsLayerIds),a=0;a<n.length;a++){var o=t.getLayer(n[a]),s=i.ServiceLayerInfo.fromEsriLayer(o);r.serviceLayers.push(s)}return r},e.fromViewerApp=function(t){var i=e.fromEssentialsMap(t.site.essentialsMap);return i.markupLayer.sync(t.markupLayer),i},e.fromEssentialsMap=function(t){var r=new e;r.gcxMap=t,r.map=t.getMap(),r.markupLayer.set(t.getMap().graphics);for(var n=0;n<t.mapServices.length;n++){var a=t.mapServices[n],o=i.ServiceLayerInfo.fromGcxMapService(a);r.serviceLayers.push(o)}return r},e.prototype.getLayerInfos=function(){for(var e=new Array,t=0;t<this.serviceLayers.length;t++)for(var i=this.serviceLayers[t].layers,r=0;r<i.length;r++)e.push(i[r]);return e},e.prototype.getTableInfos=function(){for(var e=new Array,t=0;t<this.serviceLayers.length;t++)for(var i=this.serviceLayers[t].tables,r=0;r<i.length;r++)e.push(i[r]);return e},e.prototype.getGraphicsLayers=function(){var e=new Array;e.push(this.map.graphics);for(var t=0;t<this.map.graphicsLayerIds.length;t++)e.push(this.map.getLayer(this.map.graphicsLayerIds[t]));return e},e.prototype.findMapServiceById=function(e){for(var t,i=null,r=0,n=this.serviceLayers.length;r<n;r++){var a=this.serviceLayers[r];if(null==i&&(i=!(!a||!a.gcxMapService)),t=i?a.gcxMapService:a.serviceLayer,t&&t.id===e)return a}return null},e}();t.MapInfo=n})},"geocortex/infrastructure/gis/AppInfo":function(){define(["require","exports","geocortex/infrastructure/gis/MapInfo","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r){"use strict";var n=function(){function e(){}return e.fromGeocortexApp=function(t){var r=new e;return r.gcxApp=t,r.urlParameters=t.urlParameters,t.isArcGisWebApp?r.mapInfo=i.MapInfo.fromEsriMap(t.map):(r.essentialsVersion=t.site.getEssentialsVersion(),r.mapInfo=i.MapInfo.fromViewerApp(t)),r.map=r.mapInfo.map,r},e.prototype.getGeometryService=function(){return this._geometryService?this._geometryService:this.geometryServiceUrl?(this._geometryService=new esri.tasks.GeometryService(this.geometryServiceUrl),this._geometryService):this.gcxApp?r.getGeometryService(this.gcxApp):null},e}();t.AppInfo=n})},"geocortex/infrastructure/offline/SyncParameters":function(){define(["require","exports","geocortex/infrastructure/gis/AppInfo","geocortex/infrastructure/gis/LayerInfo","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a;!function(e){function t(e,t){var r=i.AppInfo.fromGeocortexApp(e),n=r.mapInfo.getLayerInfos(),o=n.concat(r.mapInfo.getTableInfos());o.forEach(function(e){return e.url=e.getUrlWithoutParameters()});var s=[],l={};return t.content.layers.forEach(function(e){var t,i,c,u,d,p=n.filter(function(t){return t.uniqueId==e.layerInfoUniqueId})[0];if(p||e.isUserCreated){if(p){if(i=p.url.substring(0,p.url.lastIndexOf("/")),c=parseInt(p.id),t={id:c,where:e.definitionExpression,displayName:p.displayName},p.gcxLayer.isDynamic){var h=p.serviceLayerInfo.serviceLayer,m=h.dynamicLayerInfos.filter(function(e){return e.id===c})[0];m&&(t.dynamicLayerInfo=m.toJson());var f=h.layerDrawingOptions[c];f&&(t.layerDrawingOptions=f.toJson())}d=p.serviceLayerInfo.gcxMapService.serviceToken,u=p.serviceLayerInfo.capabilities}else{if(!(e.isUserCreated&&e.serviceInfo&&e.layerJson))return;i=e.serviceInfo.url,u=e.serviceInfo.capabilities,c=parseInt(e.layerJson.id);var g=JSON.parse(e.layerJson.dynamicDefinition);t={id:c,displayName:e.layerJson.name,where:e.definitionExpression,dynamicLayerInfo:g,layerDrawingOptions:g?g.drawingInfo:null}}var y=s.filter(function(e){return e.url===i})[0];if(y?l[p.uniqueId]||y.layers.push(t):(y={url:i,layers:[t],capabilities:u,token:d},s.push(y)),p){l[p.uniqueId]=p;for(var b=a(r.mapInfo,o,p),v=function(e){var t=parseInt(e.id);l[e.id]||(y.layers.some(function(e){return e.id==t})||y.layers.push({id:t,displayName:e.displayName||e.name}),l[e.uniqueId]=e)},S=0,_=b;S<_.length;S++){var I=_[S];v(I)}}}}),{profile:t.id,featureServices:s,geometry:t.content.geometry,includeAttachments:t.content.includeAttachments,mapSpatialReference:e.map.spatialReference.toJson()}}function a(e,t,i,s){s||(s={});var l=[];if(s[i.uniqueId])return l;s[i.uniqueId]=!0;for(var c=function(c){var u=i.url.replace(/\/[0-9]+$/,"/"+c.relatedTableId),d=t.filter(function(e){return e.url==u})[0];d||(d=o(t,i,c.relatedTableId),d||(d=new r.LayerInfo,d.id=c.relatedTableId+"",d.relationships=[],d.uniqueId=n.alphaNumericToken()),d.url=u),l.push(d);for(var p=a(e,t,d,s),h=0,m=p;h<m.length;h++){var f=m[h];l.push(f)}},u=0,d=i.relationships;u<d.length;u++){var p=d[u];c(p)}return l}function o(e,t,i){var r=t.serviceLayerInfo.gcxMapService.serviceTag;if(r){var n=e.filter(function(e){return e.serviceLayerInfo.gcxMapService.serviceTag===r}),a=i+"",o=n.filter(function(e){return e.id===a});return o[0]}}e.buildSyncParameters=t}(a=t.SyncParameters||(t.SyncParameters={}))})},"geocortex/infrastructure/offline/SyncProgress":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/offline/SyncEngine":function(){define(["require","exports","geocortex/infrastructure/offline/SyncInfo","geocortex/essentials/FeatureLayerService","geocortex/essentials/utilities/LayerUtilities"],function(e,t,i,r,n){"use strict";var a=function(){function e(){}return e.getSyncInfo=function(e,t){var r=e.localServerAddress+"/sync/"+e.localServerNamespace+"/info?profile="+t;return e.nativeManager.xhrGet({url:r}).then(function(e){var t=JSON.parse(e);return new i.SyncInfo(t)})},e.sync=function(e,t,i,r){var n=this;return e.event("FeatureDataSyncStartedEvent").publish(t),this._unregisterOfflineDeletedReplicas(e).then(function(a){return n._sync(e,t,i,r)}).then(function(t){return e.event("FeatureDataSyncCompletedEvent").publish(),t})},e._sync=function(e,t,i,r){var n=this;return i.register(function(){return n._cancel(e)}),new Promise(function(i,a){var o=e.event("NativeMessageEvent").subscribe(n,function(t){"syncStatus"===t.type&&(t.parameters.state===n.STATUS_SUCCESS?(e.event("NativeMessageEvent").unsubscribe(o),r(t.parameters),i(t.parameters)):t.parameters.state===n.STATUS_ERROR?(e.event("NativeMessageEvent").unsubscribe(o),a(t.parameters.text)):t.parameters.state===n.STATUS_IN_PROGRESS&&r(t.parameters))}),s={options:JSON.stringify(t)},l=e.localServerAddress+"/sync/"+e.localServerNamespace+"/execute";e.nativeManager.xhrPost({url:l,content:s,error:function(t){e.event("NativeMessageEvent").unsubscribe(o),a(t.responseText)}})})},e._cancel=function(e){var t=e.localServerAddress+"/sync/"+e.localServerNamespace+"/cancel";return e.nativeManager.xhrPost({url:t,method:"POST"})},e.deleteData=function(e,t){var i=this._getFeatureServiceTokenInfo(e),r=e.localServerAddress+"/sync/"+e.localServerNamespace+"/delete",n={parameters:JSON.stringify({profile:t,serviceInfo:i})};return e.nativeManager.xhrPost({url:r,content:n,method:"POST"})},e.deletePartialData=function(e,t,i){var r=this._getFeatureServiceTokenInfo(e),n={profile:t,serviceInfo:r,localServerNamespace:e.localServerNamespace,firstDownload:i};return e.nativeManager.message("DeletePartiallySyncedData",n)},e._unregisterOfflineDeletedReplicas=function(e){var t=this._getFeatureServiceTokenInfo(e),i=e.localServerAddress+"/sync/"+e.localServerNamespace+"/unregisterDeletedReplicas",r={parameters:JSON.stringify({serviceInfo:t})};return e.nativeManager.xhrPost({url:i,content:r})},e._getFeatureServiceTokenInfo=function(e){return e.site.essentialsMap.mapServices.filter(function(e){return e instanceof r.FeatureLayerService}).map(function(e){return{serviceUrl:n.LayerUtilities.decomposeFeatureLayerUrl(e.serviceUrl).serviceUrl,token:e.serviceToken}})},e}();a.STATUS_IN_PROGRESS="inProgress",a.STATUS_SUCCESS="success",a.STATUS_ERROR="error",t.SyncEngine=a})},"geocortex/infrastructure/offline/bundle/RoutingRulesBuilder":function(){define(["require","exports","geocortex/infrastructure/offline/bundle/BundleBuilder","geocortex/essentials/MapServiceConstants","geocortex/essentials/FeatureLayerService"],function(e,t,i,r,n){"use strict";function a(e){var t=[{handlerName:"Rewrite",pattern:"/arcgis/+rest/+services/+Utilities/+Geometry/+GeometryServer/+(.*)",parameters:{newUrl:"{localserver}/GeometryServer/{1}"}},{handlerName:"ServeResource",pattern:"/map/+layerlist$",parameters:{key:"__layerlist_"}},{handlerName:"ServeResource",pattern:"/search$",parameters:{key:"__no_search_results"}},{handlerName:"Site",pattern:i.urlToPattern(e.app.site.originalUrl)+"/*$",parameters:{key:"__site_"}}],a=[],d=e.app.site.essentialsMap.mapServices;return e.app.site.overviewMap&&(d=d.concat(e.app.site.overviewMap.mapServices)),d.forEach(function(d){if(a.indexOf(d.url)===-1){a.push(d.url);var p=d.serviceLayer&&d.serviceLayer.attributionDataUrl||d.attributionDataUrl;p&&t.push({handlerName:"ServeResource",pattern:i.urlToPattern(p),parameters:{key:"__empty_attribution_response"}});var f=i.urlToPattern(i.cleanUpMapServiceUrl(e,d));if(d.mapServiceType===r.MapServiceType.WMS)return void(t=t.concat(o(f)));if(d.mapServiceType===r.MapServiceType.BING&&(t=t.concat(s(f,d,e))),d.mapServiceType===r.MapServiceType.WMTS||d.mapServiceType===r.MapServiceType.WEBTILED)return void(t=t.concat(c(f)));
t=d instanceof n.FeatureLayerService?t.concat(u(f,d,e)):t.concat(l(f,d,e)),d.mapServiceType===r.MapServiceType.TILED&&(t=t.concat(h(f,d,e))),d.mapServiceFunction===r.MapServiceFunction.BASE||d instanceof n.FeatureLayerService||(t=t.concat(m(f))),t.push({handlerName:"ServeResource",pattern:f+"/*$",parameters:{key:f}})}}),t.push({handlerName:"ServeResource",pattern:"/+map/+mapservices/+[0-9]+/+layers/+[0-9]+/+datalinks/+[^/]+/+link$",parameters:{key:"__no_data_links"}}),t}function o(e){return[{handlerName:"Rewrite",pattern:e,parameters:{newUrl:"Resources/Images/blank-tile.png"}}]}function s(e,t,i){var r=[];return r.push({handlerName:"ServeResource",pattern:e+"REST/v1/Imagery/Metadata/"+t.bingProperties.mapStyle,parameters:{key:e}}),r.push({handlerName:"Rewrite",pattern:"https?://[^/]*tiles.virtualearth.net/tiles",parameters:{newUrl:"Resources/Images/blank-tile.png"}}),r}function l(e,t,i){var r=[],n=t.serviceLayer.url.indexOf("?")!==-1?t.serviceLayer.url.substr(0,t.serviceLayer.url.indexOf("?")):t.serviceLayer.url;n=n.toLowerCase();var a=i.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(t){return e.featureServiceUrl.toLowerCase()===n})[0]})[0];return a?r.push({handlerName:"Rewrite",pattern:e+"/+(?!tile)(.+)",parameters:{newUrl:a.localServerUrl.replace("FeatureServer","MapServer")+"/{1}"}}):r=r.concat(m(e)),r}function c(e){return e=decodeURI(e).replace(/%24/g,"$"),[{handlerName:"Rewrite",pattern:e.replace(/\$?{subDomain}/gi,"(?:.*)").replace(/\$?{level}/gi,"[0-9]*").replace(/\$?{row}/gi,"[0-9]*").replace(/\$?{col}/gi,"[0-9]*"),parameters:{newUrl:"Resources/Images/blank-tile.png"}}]}function u(e,t,r){var a=[],o=d(t.serviceUrl).layerId,s=d(t.serviceUrl).serviceUrl,l=/^(.*)(\/\+?[0-9]+\/?\+?)$/.exec(e)[1];a.push({handlerName:"ServeResource",pattern:l+"/*$",parameters:{key:l}});var c=t.serviceLayer.url.indexOf("?")!==-1?t.serviceLayer.url.substr(0,t.serviceLayer.url.indexOf("?")):t.serviceLayer.url;c=c.toLowerCase();var u,h=r.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(t){return(e.featureServiceUrl+"/"+t.id).toLowerCase()===c})[0]})[0];if(!h&&t.serviceUrl.indexOf("/rest/services/x/")>0&&t.serviceTag)for(var m=t.essentialsMap.mapServices.filter(function(e){return e instanceof n.FeatureLayerService}),g=0,y=m.filter(function(e){return e.serviceTag===t.serviceTag});g<y.length;g++){for(var b=y[g],v=0,S=b.serviceLayer.relationships;v<S.length;v++){var _=S[v];if(_.relatedTableId===o&&(u=d(b.serviceUrl).serviceUrl+"/"+o,h=r.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(t){return(e.featureServiceUrl+"/"+t.id).toLowerCase()===u.toLowerCase()})[0]})[0]))break}if(h)break}if(h){if(a.push({handlerName:"Rewrite",pattern:e+"/+(.+)",parameters:{newUrl:h.localServerUrl+"/"+o+"/{1}"}}),u){var I=i.urlToPattern(i.cleanUpRestUrl(r,u));a.push({handlerName:"Rewrite",pattern:I+"/+(.+)",parameters:{newUrl:h.localServerUrl+"/"+o+"/{1}"}})}}else a=a.concat(f(l,o));var w=(t.layers[0],(t.serviceLayer.relationships||[]).map(function(e){return p(l,s,h?h.localServerUrl:null,e,r)}));return a=a.concat.apply(a,w)}function d(e){var t=/^(.*)\/([0-9]+\/?)$/.exec(e),i=t[1],r=parseInt(t[2]);return{serviceUrl:i,layerId:r}}function p(e,t,i,r,n){var a=[{handlerName:"ServeResource",pattern:e+"/+"+r.relatedTableId+"/*$",parameters:{key:e+"/+"+r.relatedTableId}}],o=i&&n.featureLayerSyncInfo.servers.filter(function(e){return e.featureServiceUrl===t}).some(function(e){return e.layers&&e.layers.some(function(e){return e.id===r.relatedTableId})});return o?a.push({handlerName:"Rewrite",pattern:e+"/+"+r.relatedTableId+"/+(.+)",parameters:{newUrl:i+"/"+r.relatedTableId+"/{1}"}}):a=a.concat(f(e,r.relatedTableId)),a}function h(e,t,i){var r=i.basemaps.filter(function(e){return e.url===t.url||e.url===t.serviceUrl})[0];if(r){var n=g(e);return[{handlerName:"Rewrite",pattern:e+"/+tile/+([0-9]*)/+([0-9]*)/+([0-9]*)",parameters:{newUrl:"{localserver}/"+r.localServicePath+"/{{{0}}}/{{{1}}}/{{{2}}}".format(n+1,n+2,n+3)}}].concat(m(e))}return o(e+"/+(tile|tilemap)").concat(m(e))}function m(e){return[{handlerName:"ServeResource",pattern:e+"/+([^/]*/+)?(query|queryRelatedRecords|identify|find)",parameters:{key:"__no_features"}}]}function f(e,t){return[{handlerName:"ServeResource",pattern:e+"/+"+t+"/+(query|queryRelatedRecords|applyEdits)",parameters:{key:"__no_features"}}]}function g(e){var t;if(e instanceof RegExp){var i=e.toString();i=i.substring(1,i.length-2),t=new RegExp(i+"|")}else t=new RegExp(e.toString()+"|");return t.exec("").length-1}t.buildRoutingRules=a})},"geocortex/infrastructure/offline/bundle/BundleBuilder":function(){define(["require","exports","geocortex/infrastructure/offline/bundle/RoutingRulesBuilder","geocortex/geocortex","geocortex/essentials/MapServiceConstants","geocortex/essentials/FeatureLayerService","geocortex/framework/utils/utils"],function(e,t,i,r,n,a,o){"use strict";function s(e){var t={id:e.bundleId,timestamp:(new Date).getTime(),routingRules:i.buildRoutingRules(e),resources:[]},r=[l(e,t),u(e,t),c(e,t),d(e,t)];return Promise.all(r).then(function(){return t})}function l(e,t){return t.resources.push(y("__error_offline_no_endpoint",{error:{code:400,message:"This resource is not available offline.",details:[]}})),t.resources.push(y("__no_features",{objectIdFieldName:"OBJECTID",globalIdFieldName:"GlobalID",features:[]})),t.resources.push(y("__no_search_results",{count:0,features:[],ResponseStatus:{}})),t.resources.push(y("__no_data_links",{results:[]})),t.resources.push(y("__empty_attribution_response","")),null}function c(e,t){return new Promise(function(i,n){var a=S(e,e.app.site.url+"/map/layerlist");r.request({url:a,content:{f:"json"},load:function(e){t.resources.push(y("__layerlist_",e)),i(null)},error:function(t){var i=g(e.app,a,t.message);e.app.trace.error(i),n(t.message||i)},callbackParamName:"Callback"})})}function u(e,t){return new Promise(function(i,n){var a=S(e,e.app.site.url);r.request({url:a,content:{f:"json",deep:e.app.site.deepInitialize},load:function(e){t.resources.push(y("__site_",e)),i(null)},error:function(t){var i=g(e.app,a,t.message);e.app.trace.error(i),n(t.message||i)},callbackParamName:"Callback"})})}function d(e,t){var i=[],r=e.app.site.essentialsMap.mapServices;e.app.site.overviewMap&&(r=r.concat(e.app.site.overviewMap.mapServices));var o=r.map(function(r){return i.indexOf(r.url)!=-1?null:(i.push(r.url),r.mapServiceType===n.MapServiceType.WMS||r.mapServiceType===n.MapServiceType.WEBTILED?null:r.mapServiceType===n.MapServiceType.BING?h(e,t,r):r.mapServiceType===n.MapServiceType.GEORSS||r.mapServiceType===n.MapServiceType.KML?f(e,t,r):r instanceof a.FeatureLayerService?p(e,t,r):m(e,t,r))});return Promise.all(o)}function p(e,t,i){var r=[],n=/^(.*)(\/[0-9]+\/?)$/.exec(i.serviceUrl)[1],a=null;return i.layers[0]?a=i.layers[0].relationships:i.serviceLayer&&(a=i.serviceLayer.relationships),a&&(r=r.concat(a.map(function(r){return new Promise(function(a,o){var s=n+"/"+r.relatedTableId,l={f:"json"},c=i.findServiceToken();c&&(l.token=c),esri.request({url:s,handleAs:"json",content:l,callbackParamName:"Callback"}).then(function(e){t.resources.push(y(_(s),e)),a(null)},function(t){var i=g(e.app,s,t.message);e.app.trace.error(i),o(t.message||i)})})}))),r.push(m(e,t,i)),Promise.all(r)}function h(e,t,i){return new Promise(function(r,n){var a=v(e,i),o=i.serviceLayer,s={ss:"true",c:o.culture,key:i.bingProperties.bingMapsKey},l=a+"/Imagery/Metadata/"+o.mapStyle;esri.request({url:l,handleAs:"json",content:s,callbackParamName:"jsonp"}).then(function(e){t.resources.push(y(_(a),e)),r(null)},function(t){var i=g(e.app,a,t.message);e.app.trace.error(i),n(t.message||i)})})}function m(e,t,i){return new Promise(function(r,n){var a=v(e,i),o={f:"json"},s=i.findServiceToken();s&&(o.token=s),esri.request({url:a,handleAs:"json",content:o,callbackParamName:"Callback"}).then(function(e){t.resources.push(y(_(a),e)),r(null)},function(t){var i=g(e.app,a,t.message);e.app.trace.error(i),n(t.message||i)})})}function f(e,t,i){return new Promise(function(r,n){var a=v(e,i);esri.request({url:a,handleAs:"xml",content:{},callbackParamName:"Callback"}).then(function(e){t.resources.push(b(_(a),(new XMLSerializer).serializeToString(e))),r(null)},function(t){var i=g(e.app,a,t.message);e.app.trace.error(i),n(t.message||i)})})}function g(e,t,i){var r=e.offlineManager.getResource("language-offline-errors-fetch-error").format(t);return i&&(r+=" "+i),r}function y(e,t,i){return void 0===i&&(i=!1),b(e,JSON.stringify(t),i)}function b(e,t,i){return void 0===i&&(i=!1),{isEncoded:i,isJson:!0,key:e,value:i?o.base64Encode(t):t}}function v(e,t){var i=t.serviceUrl;return!i&&t.serviceLayer&&(i=t.serviceLayer.url),i&&(i=S(e,i)),i}function S(e,t){t=e.app.makeAbsolute(t);var i=document.createElement("a");i.href=t;var r=i.href,n=r.charAt(r.length-1);return"/"!==n&&"\\"!==n||(r=r.substr(0,r.length-1)),r}function _(e){var t=e,i=/^[a-z]+:\/\/(.*)/.exec(t);i&&(t=i[1]);var r=/^(services|server)\.arcgisonline\.(.*)/.exec(t);r&&(t="(services|server).arcgisonline."+r[2]);var n=/^[^\/]*virtualearth.net\//.exec(t);n&&(t="[^/]*virtualearth.net/");var a=/^([a-zA-Z.]+):(80|443)(.*)/.exec(t);return a&&(t=a[1]+a[3]),t=t.replace(/\//g,"/+").replace(/\./g,"\\.")}t.buildBundle=s,t.cleanUpMapServiceUrl=v,t.cleanUpRestUrl=S,t.urlToPattern=_})},"geocortex/infrastructure/offline/bundle/BundleManager":function(){define(["require","exports","geocortex/infrastructure/offline/bundle/OfflineRouter","geocortex/infrastructure/offline/bundle/EsriRequestHacker","geocortex/infrastructure/offline/bundle/EsriLayerHacker","geocortex/infrastructure/offline/bundle/offlineHandlers/ServeResourceHandler","geocortex/infrastructure/offline/bundle/offlineHandlers/PassthroughHandler","geocortex/infrastructure/offline/bundle/offlineHandlers/FailHandler","geocortex/infrastructure/offline/bundle/offlineHandlers/RewriteHandler","geocortex/infrastructure/offline/bundle/offlineHandlers/SiteHandler","geocortex/infrastructure/offline/SyncEngine","geocortex/infrastructure/offline/bundle/BundleBuilder"],function(e,t,i,r,n,a,o,s,l,c,u,d){"use strict";var p=function(){function e(e,t){var u=this;this.app=e,this.libraryId=t,this._router=new i.OfflineRouter(this.app),this._esriRequestHacker=new r.EsriRequestHacker(e,function(e,t){return u._router.handle(e,t)}),this._esriLayerHacker=new n.EsriLayerHacker(e,function(e){return u._router.rewriteUrl(e)}),this._esriLayerHacker.errorReporter=function(e){return u.app.trace.warning(e)},this._serveResourceHandler=new a.ServeResourceHandler(this.app,function(e){return u._appStoreGetPromise(e)},function(e,t){return u._appStoreSetPromise(e,t)},function(e){return u._appStoreRemovePromise(e)});var d=new o.PassthroughHandler(this.app,function(e,t){return u._esriRequestHacker.unhackedRequest(e,t)});this._router.setDefaultHandler(d),this._router.addHandler(d),this._router.addHandler(this._serveResourceHandler),this._router.addHandler(new s.FailHandler),this._router.addHandler(new l.RewriteHandler(this.app,function(e,t){return u._esriRequestHacker.unhackedRequest(e,t)})),this._router.addHandler(new c.SiteHandler(this.app,function(e){return u._serveResourceHandler.getResourceValue(e)},function(e,t){var i=a.ServeResourceHandler.getResourceStorageKey(u._activeBundle.id,e);return u._serveResourceHandler.resourceSetter(i,t)},function(e,t){return u._esriRequestHacker.unhackedRequest(e,t)})),this.app.event("ApplicationStorageClearedEvent").subscribe(this,function(){u._serveResourceHandler.clear(),u._router.clearRoutingRules()})}return e.prototype.createBundle=function(e,t){var i=this;return this._buildBundle(e,t).then(function(e){return i._storeBundle(e)}).then(function(e){})},e.prototype.deleteBundle=function(e){var t=this;return this._getBundle(e).then(function(e){return e?t._serveResourceHandler.unstoreBundle(e):null}).then(function(e){return e?t._appStoreRemovePromise(t._getBundleKey(e)):null}).then(function(){})},e.prototype.updateBundle=function(e,t){var i=this;return this._buildBundle(e,t).then(function(t){return i.deleteBundle(e)["catch"](function(e){return i.app.trace.warning("Unable to delete old bundle before replacing it. "+(e.message||e)+" Attempting to continue."),null}).then(function(){return t})}).then(function(e){return i._storeBundle(e)}).then(function(e){return i._router.setRoutingRules(e.routingRules)}).then(function(){})},e.prototype.loadBundle=function(e){var t=this;return e?this._getBundle(e).then(function(e){if(!e)throw new Error(t.getResource("language-offline-errors-bundlenotfound"));t._activeBundle=e,t._serveResourceHandler.loadBundle(e),t._router.setRoutingRules(e.routingRules)}):Promise.reject(new Error("Bundle ID cannot be null."))},e.prototype.unloadBundle=function(){return this._serveResourceHandler.clear(),this._router.clearRoutingRules(),Promise.resolve()},e.prototype._buildBundle=function(e,t){var i=this;return u.SyncEngine.getSyncInfo(this.app,e).then(function(r){var n={app:i.app,bundleId:e,basemaps:t,featureLayerSyncInfo:r};return i._esriRequestHacker.disable(),d.buildBundle(n)["finally"](function(){i._esriRequestHacker.enable()})})},e.prototype._storeBundle=function(e){var t=this;return null==e?Promise.reject(new Error("Bundle is null.")):null==e.id?Promise.reject(new Error("Bundle ID is null.")):this._serveResourceHandler.stripAndStoreBundle(e).then(function(){return t._appStoreSetPromise(t._getBundleKey(e),JSON.stringify(e)),e},function(i){throw t.app.trace.warning("Failed to save offline bundle '"+e.id+"'. "+(i.message||i)),22==i.code&&window.localStorage&&window.localStorage.remainingSpace&&t.app.trace.warning("Local storage has "+window.localStorage.remainingSpace+" bytes remaining."),i})},e.prototype._getBundle=function(e){return e?this._appStoreGetPromise(this._getBundleKey(e)).then(function(e){return e?JSON.parse(e):null}):Promise.reject(new Error("Bundle ID is null."))},e.prototype._getBundleKey=function(e){return"__bundle-"+("string"==typeof e?e:e.id)},e.prototype.getStoreResource=function(e,t){var i=a.ServeResourceHandler.getResourceStorageKey(e,t);return this._appStoreGetPromise(i)},e.prototype.setStoreResource=function(e,t,i){var r=a.ServeResourceHandler.getResourceStorageKey(e,t);return this._appStoreSetPromise(r,i)},e.prototype._appStoreGetPromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.get(e,i,r)})},e.prototype._appStoreSetPromise=function(e,t){var i=this;return new Promise(function(r,n){return i.app.store.set(e,t,function(){return r()},n)})},e.prototype._appStoreRemovePromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.remove(e,function(){return i()},r)})},e.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},e}();t.BundleManager=p})},"geocortex/infrastructure/offline/OfflineMapProgressClient":function(){define(["require","exports"],function(e,t){"use strict";function i(e){return!!e.basemaps.some(function(e){return e.status===t.ProgressStatus.InProgress||e.status==t.ProgressStatus.NotStarted})||!!e.layers.some(function(e){return e.status===t.ProgressStatus.InProgress||e.status==t.ProgressStatus.NotStarted})}var r=function(){function e(e){this.app=e}return e.prototype.getLastOperationProgress=function(e){return this.app.nativeManager.message("GetOfflineMapProgress",{localServerNamespace:this.app.localServerNamespace,offlineMapId:e})},e.prototype.resetOfflineMapProgress=function(e){return this.app.nativeManager.message("ResetOfflineMapProgress",{localServerNamespace:this.app.localServerNamespace,offlineMapId:e}).then(function(e){})},e.prototype.setOfflineBasemapProgress=function(e,t){return this.app.nativeManager.message("SetOfflineBasemapProgress",{localServerNamespace:this.app.localServerNamespace,offlineMapId:e,progress:t}).then(function(e){})},e}();t.OfflineMapProgressClient=r,t.wasOfflineMapSyncInterupted=i,t.ProgressStatus={NotStarted:"notStarted",InProgress:"inProgress",Complete:"complete",Error:"error"}})},"geocortex/infrastructure/offline/Progress":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/offline/WorkCalculator":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e.calculateFirstDownloadWork=function(e){var t={saveProfileWork:.25,featureLayerWork:e.content.layers.length+2,basemapWork:4*e.content.basemaps.length,bundleWork:.5};return t},e.calculateSyncWork=function(e,t){var i={saveProfileWork:0,featureLayerWork:t.featureDataSync?e.content.layers.length+2:0,basemapWork:t.basemapDownloads?2*e.content.basemaps.length:0,bundleWork:t.updateBundle?.5:0};return i},e.noWork=function(){var e={saveProfileWork:0,bundleWork:0,featureLayerWork:0,basemapWork:0};return e},e.calculatePercentageComplete=function(e,t){var i=this._calculateTotalWork(e)/this._calculateTotalWork(t)*100;return i},e._calculateTotalWork=function(e){var t=e.saveProfileWork+e.bundleWork+e.featureLayerWork+e.basemapWork;return t},e}();t.WorkCalculator=i})},"geocortex/infrastructure/offline/StringFormatting":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t){var i=t/1024;if(i<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-bytes-per-second").format(Math.round(t));var r=t/1048576;return r<1?e.getResource("Mapping.Infrastructure","language-offline-progress-kilobytes-per-second").format(Math.round(i)):e.getResource("Mapping.Infrastructure","language-offline-progress-megabytes-per-second").format(Math.round(10*r)/10)}function r(e,t){var i=t/1024;if(i<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-bytes").format(t);var r=t/1048576;if(r<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-kilobytes").format(Math.round(i));var n=t/1073741824;return n<1?e.getResource("Mapping.Infrastructure","language-offline-progress-megabytes").format(Math.round(r)):e.getResource("Mapping.Infrastructure","language-offline-progress-gigabytes").format(Math.round(100*n)/100)}t.formatByteTransferRateString=i,t.formatBytesString=r})},"geocortex/infrastructure/offline/BasemapDownloading":function(){define(["require","exports","geocortex/infrastructure/offline/OfflineMap","geocortex/infrastructure/offline/OfflineMapProgressClient","geocortex/essentials/Site","geocortex/infrastructure/offline/StringFormatting","geocortex/essentials/RestHelperHTTPService"],function(e,t,i,r,n,a,o){"use strict";function s(e,t,i,n,a){var o=new r.OfflineMapProgressClient(e),s=0;return Promise.reduce(t.content.basemaps,function(l,u){if(n.isCancellationRequested)throw new Error("Operation cancelled.");var d=i?i.basemaps.filter(function(e){return e.referenceId==u.baseMapId})[0]:null;return Promise.resolve().then(function(){return d&&d.status===r.ProgressStatus.Complete?Promise.resolve():o.setOfflineBasemapProgress(t.id,{referenceId:u.baseMapId,status:r.ProgressStatus.InProgress,type:u.sourceType,filename:u.filename,statusUrl:d?d.statusUrl:null})}).then(function(){return d&&d.status===r.ProgressStatus.Complete?Promise.resolve():c(e,t,u,n,function(e){var i=(e.percentage+100*s)/t.content.basemaps.length;a&&a({message:e.message,percentage:i})})}).then(function(){return o.setOfflineBasemapProgress(t.id,{referenceId:u.baseMapId,status:r.ProgressStatus.Complete,type:u.sourceType,filename:u.filename})})["catch"](function(i){return a&&a({isWarning:!0,message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-failed").format(u.filename,i.message||i),percentage:100}),o.setOfflineBasemapProgress(t.id,{referenceId:u.baseMapId,status:r.ProgressStatus.Error,errorMessage:i.message||i,type:u.sourceType,filename:u.filename})})["finally"](function(){s++})},null)}function l(e,t){var i=(e.map.layerIds.filter(function(i){var r=e.map.getLayer(i);return r.url.indexOf(t)>=0}).map(function(t){return e.map.getLayer(t)})[0],e.site.essentialsMap.mapServices.filter(function(e){return e.serviceUrl.indexOf(t)>=0}).map(function(e){return e.serviceToken})[0]);return i}function c(e,t,r,n,a){if(!r)throw new Error("basemap cannot be null.");if(!r.filename)throw new Error("basemap.filename cannot be null.");if(!r.url)throw new Error("basemap.url cannot be null.");switch(r.sourceType){case i.OfflineMapBasemap.Type.PREGENERATED:return u(e,r,n,a);case i.OfflineMapBasemap.Type.EXPORT_TILES:return d(e,t,r,n,a)}return null}function u(e,t,i,r){var s=e.makeAbsolute(t.url,e.site.url),l=e.site.getTokenFromPrincipal(s,n.Site)||e.site.getTokenFromPrincipal(s,esri.IdentityManagerBase);null!=l&&(s=o.RestHelperHTTPService.appendTokenToUrl(s,l));var c={url:s,fileName:t.filename,overwrite:"OnNewer"};return e.nativeManager.message("DownloadResource",c,i,function(i){var n=i.details;switch(n.status){case p.connecting:r&&r({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-connecting").format(t.filename),percentage:0});break;case p.downloading:if(r){var o=Math.round(n.bytesDownloaded/n.bytesTotal*100),s=a.formatBytesString(e,n.bytesDownloaded),l=a.formatBytesString(e,n.bytesTotal),c=a.formatByteTransferRateString(e,n.bytesPerSecond);r({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-downloading").format(t.filename,s,l,o,c),percentage:o})}break;default:e.trace.error("Unknown ResourceDownloadEvent status "+n.status)}})}function d(e,t,i,r,s){var c=i.url,u=e.site.getTokenFromPrincipal(c,esri.IdentityManagerBase)||e.site.getTokenFromPrincipal(c,n.Site);null!=u&&(c=o.RestHelperHTTPService.appendTokenToUrl(c,u));var d=l(e,c),h={url:c,fileName:i.filename,minLevel:i.minLevel,maxLevel:i.maxLevel,areaOfInterest:JSON.stringify({features:[{geometry:t.content.geometry}]}),refreshInterval:i.refreshInterval,token:d};return e.nativeManager.message("ExportTiles",h,r,function(t){var r=t.details;switch(r.status){case p.connecting:s&&s({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-connecting").format(i.filename),percentage:0});break;case p.processing:s&&s({message:r.message||e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-processing").format(i.filename),percentage:0});break;case p.downloading:if(s){var n=Math.round(r.bytesDownloaded/r.bytesTotal*100),o=a.formatBytesString(e,r.bytesDownloaded),l=a.formatBytesString(e,r.bytesTotal),c=a.formatByteTransferRateString(e,r.bytesPerSecond);s({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-downloading").format(i.filename,o,l,n,c),percentage:n})}break;default:e.trace.error("Unknown ResourceDownloadEvent status "+r.status)}})}t.downloadBasemaps=s,t.getServiceTokenForMapService=l;var p={connecting:"Connecting",processing:"Processing",downloading:"Downloading"}})},"geocortex/infrastructure/offline/BasemapDeleting":function(){define(["require","exports","geocortex/infrastructure/offline/OfflineMap"],function(e,t,i){"use strict";function r(e,t){return Promise.all(t.map(function(t){return n(e,t)})).then(function(){return null})}function n(e,t){if(!t)return Promise.reject("basemap cannot be null.");if(!t.filename)return Promise.reject("basemap.filename cannot be null.");switch(t.sourceType){case i.OfflineMapBasemap.Type.PREGENERATED:return e.nativeManager.message("RemoveResource",{fileName:t.filename});case i.OfflineMapBasemap.Type.EXPORT_TILES:return e.nativeManager.message("RemoveExportedTiles",{fileName:t.filename})}return null}t.deleteBasemaps=r})},"geocortex/infrastructure/offline/TokenRefresher":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e.ensureAllTokensAreUpToDate=function(e){var t=new Date(e.site.principal.expiry).valueOf()-(new Date).valueOf(),i=t<6e4;return e.site.principal.isAuthenticated&&i?e.site.refreshPrincipal().then(function(){return Promise.resolve(e.site.updateServiceTokensIfStale())}).then(function(){}):Promise.resolve(e.site.updateServiceTokensIfStale()).then(function(){})},e}();t.TokenRefresher=i})},"geocortex/infrastructure/offline/OfflineManager":function(){define(["require","exports","geocortex/infrastructure/CancellationTokenSource","geocortex/infrastructure/offline/OfflineMap","geocortex/infrastructure/offline/bundle/BundleManager","geocortex/infrastructure/offline/OfflineMapProgressClient","geocortex/infrastructure/AreaOfInterestMask","geocortex/framework/observables","geocortex/infrastructure/ArrayUtils","geocortex/infrastructure/offline/WorkCalculator","geocortex/infrastructure/offline/SyncParameters","geocortex/infrastructure/offline/SyncEngine","geocortex/infrastructure/offline/BasemapDownloading","geocortex/infrastructure/offline/BasemapDeleting","geocortex/infrastructure/offline/TokenRefresher","geocortex/essentials/FeatureLayerService","geocortex/infrastructure/gis/AppInfo","geocortex/essentials/Layer","geocortex/essentials/MapServiceConstants","geocortex/essentials/utilities/DecomposedUri"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m,f,g,y,b,v){"use strict";var S=function(){function e(e,t){this.app=e,this.libraryId=t,this._activeOfflineMapId=null,this._isCancelling=!1,this._previousActiveOfflineMapId=null,this._offlineMaps=[],this.canCancel=new s.Observable((!1)),this.isOfflineMapActive=new s.Observable((!1)),this.currentOperation=null,this._bundleManager=new n.BundleManager(e,t),this._progressClient=new a.OfflineMapProgressClient(e),this.aoiMask=new o.AreaOfInterestMask(e,{enabled:!1})}return e.prototype.addOfflineMap=function(e,t){var n,o=this;return this._lastOperation=this._waitForLast().then(function(){return o.currentOperation=_.Download,o._throwIfNotNativeInitialized(),o._progressClient.getLastOperationProgress(e.id)}).then(function(t){return n=t,n&&a.wasOfflineMapSyncInterupted(n)?o._loadOfflineMapFromStorage(e.id):e}).then(function(a){a&&(e=a),r.OfflineMap.verify(e),o.canCancel.set(!0),o._cancellationTokenSource=new i.CancellationTokenSource,t||(t=function(){});var s=c.WorkCalculator.calculateFirstDownloadWork(e),l=c.WorkCalculator.noWork(),h=function(){return c.WorkCalculator.calculatePercentageComplete(l,s)};return t({message:o.getResource("language-offline-progress-updating-tokens"),percentage:h()}),m.TokenRefresher.ensureAllTokensAreUpToDate(o.app).then(function(){return o._appStoreSetPromise(o._getOfflineMapKey(e),JSON.stringify(e))}).then(function(){return t({message:o.getResource("language-offline-progress-savingofflinemap"),percentage:h()}),o._setOfflineMap({id:e.id,isDownloaded:!1,hasProgress:!0},e),o._save()}).then(function(){o._throwIfCanceled(),l.saveProfileWork=s.saveProfileWork,t({message:o.getResource("language-offline-progress-starting-sync"),percentage:h()});var i=u.SyncParameters.buildSyncParameters(o.app,e);return d.SyncEngine.sync(o.app,i,o._cancellationTokenSource.token(),function(e){if(e.warnings)for(var i=0,r=e.warnings;i<r.length;i++){var n=r[i];t({message:n,percentage:h(),isWarning:!0})}l.featureLayerWork=e.overallProgress/100*s.featureLayerWork,t({message:e.text,percentage:h()})})}).then(function(){return o._throwIfCanceled(),l.featureLayerWork=s.featureLayerWork,t({message:o.getResource("language-offline-progress-starting-basemap-download"),percentage:h()}),p.downloadBasemaps(o.app,e,n,o._cancellationTokenSource.token(),function(e){l.basemapWork=e.percentage/100*s.basemapWork,t({message:e.message,percentage:h(),isWarning:e.isWarning})})}).then(function(){return o._throwIfCanceled(),l.basemapWork=s.basemapWork,t({message:o.getResource("language-offline-progress-downloadingsite"),percentage:h()}),o._bundleManager.createBundle(e.id,o._getOfflineMapBasemapMapping(e))}).then(function(){return o._progressClient.resetOfflineMapProgress(e.id)}).then(function(){return o._setOfflineMap({id:e.id,isDownloaded:!0,hasProgress:!1},e),o._save()}).then(function(){o._throwIfCanceled(),l.bundleWork=s.bundleWork,t({message:o.getResource("language-offline-progress-complete"),percentage:h()}),o.app.event("OfflineMapAddedEvent").publish({offlineMap:e})})["catch"](function(t){throw o._isCancelling&&o._removeOfflineMapNow(e,function(){}),o.app.event("OfflineMapSyncErrorEvent").publish({offlineMap:e,error:t}),t})["finally"](function(){o._cancellationTokenSource.dispose(),o._cancellationTokenSource=null,o.canCancel.set(!1),o._isCancelling=!1,o.currentOperation=null})}).then(function(){})},e.prototype.removeOfflineMap=function(e,t){var i=this;return this._lastOperation=this._waitForLast()["finally"](function(){return i._removeOfflineMapNow(e,t)})},e.prototype.removeOfflineMapPartialData=function(e,t){var i=this;if(!e)throw new Error(this.getResource("language-offline-errors-offlinemapnull"));this._throwIfNotNativeInitialized(),this.currentOperation=_.RemovePartial;var r=this._getOfflineMapIx(e);if(r===-1)throw new Error(this.getResource("language-offline-errors-notfound"));return d.SyncEngine.deletePartialData(this.app,e.id,t)["catch"](function(e){i.app.trace.error("Error deleting feature data: "+e)}).then(function(){return i._progressClient.resetOfflineMapProgress(e.id)})["catch"](function(e){i.app.trace.error("Error resetting offline map progress. "+e)})["finally"](function(){i.currentOperation=null,i.app.event("OfflineMapPartialDataRemovedEvent").publish({offlineMap:e})})},e.prototype._removeOfflineMapNow=function(e,t){var i=this;if(!e)throw new Error(this.getResource("language-offline-errors-offlinemapnull"));this._throwIfNotNativeInitialized(),this.currentOperation=_.Remove;var n="string"==typeof e||e instanceof String?e:e.id,a=this._getOfflineMapIx(e);if(a===-1)throw new Error(this.getResource("language-offline-errors-notfound"));var o=this._offlineMaps[a].offlineMap;if(o.id===this._activeOfflineMapId)throw new Error(this.getResource("language-offline-errors-isactive"));return d.SyncEngine.deleteData(this.app,o.id)["catch"](function(e){i.app.trace.error("Error deleting feature data: "+e)}).then(function(){return t&&t(i.getResource("language-offline-progress-unregisteringreplica")),i._bundleManager.deleteBundle(o.id)})["catch"](function(e){i.app.trace.error("Error deleting bundle: "+e)}).then(function(){t&&t(i.getResource("language-offline-progress-removingofflinemap"));var n=o.content.basemaps.filter(function(e){return e.sourceType===r.OfflineMapBasemap.Type.EXPORT_TILES});return h.deleteBasemaps(i.app,n).then(null,function(e){i.app.trace.error("Error deleting offline map. "+e)}),i._appStoreRemovePromise(i._getOfflineMapKey(e))})["catch"](function(e){i.app.trace.error("Error deleting offline map. "+e)}).then(function(){return o.id===i._previousActiveOfflineMapId&&(i._previousActiveOfflineMapId=null),i._offlineMaps.splice(a,1),i._save()}).then(function(){return i._progressClient.resetOfflineMapProgress(n)})["catch"](function(e){i.app.trace.error("Error resetting offline map progress. "+e)})["finally"](function(){i.app.event("OfflineMapRemovedEvent").publish({offlineMap:e}),i.currentOperation=null})},e.prototype.syncFeatureData=function(e,t){for(var i=[],r=0,n=e;r<n.length;r++){var a=n[r];i.push(this.syncOfflineMap(a,function(i){t&&t({isWarning:i.isWarning,message:i.message,percentage:i.percentage/e.length})}))}return Promise.all(i)},e.prototype.syncOfflineMap=function(e,t,n){var o=this;n||(n={basemapDownloads:!0,updateBundle:!0,featureDataSync:!0,refreshMap:!0});var s,l=this._getOfflineMapIx(e),f="string"==typeof e||e instanceof String?this._offlineMaps[l].offlineMap:e;return this._lastOperation=this._waitForLast().then(function(){if(!e)throw new Error(o.getResource("language-offline-errors-offlinemapnull"));if(l===-1)throw new Error(o.getResource("language-offline-errors-notfound"));return o._throwIfNotNativeInitialized(),o.currentOperation=_.Sync,o._progressClient.getLastOperationProgress(f.id)}).then(function(e){return s=e,s&&a.wasOfflineMapSyncInterupted(s)?o._loadOfflineMapFromStorage(f.id):f}).then(function(e){return e&&(f=e),o._setOfflineMap({id:f.id,isDownloaded:!0,hasProgress:!0},f),o._save()}).then(function(){var e=null;f!==o._offlineMaps[l].offlineMap&&(e=r.OfflineMap.diff(o._offlineMaps[l].offlineMap,f)),o.canCancel.set(!0),o._cancellationTokenSource=new i.CancellationTokenSource;
var a=c.WorkCalculator.calculateSyncWork(f,n),g=c.WorkCalculator.noWork(),y=function(){return c.WorkCalculator.calculatePercentageComplete(g,a)};return t({message:o.getResource("language-offline-progress-updating-tokens"),percentage:y()}),Promise.resolve().then(function(){return m.TokenRefresher.ensureAllTokensAreUpToDate(o.app)}).then(function(){if(n.featureDataSync){var e=u.SyncParameters.buildSyncParameters(o.app,f);return d.SyncEngine.sync(o.app,e,o._cancellationTokenSource.token(),function(e){if(e.warnings)for(var i=0,r=e.warnings;i<r.length;i++){var n=r[i];t({message:n,percentage:y(),isWarning:!0})}g.featureLayerWork=e.overallProgress/100*a.featureLayerWork,t({message:e.text,percentage:y()})})}}).then(function(){if(o._throwIfCanceled(),g.featureLayerWork=a.featureLayerWork,n.basemapDownloads){var t=[];return e&&e.content&&e.content.geometry?t=f.content.basemaps.filter(function(e){return e.sourceType===r.OfflineMapBasemap.Type.EXPORT_TILES}):e&&e.content&&e.content.basemaps&&(t=f.content.basemaps.filter(function(e){return e.sourceType===r.OfflineMapBasemap.Type.EXPORT_TILES}).filter(function(t){return!e.content.basemaps.some(function(e){return e.baseMapId===t.baseMapId&&e.sourceType===t.sourceType&&e.url===t.url&&e.minLevel===t.minLevel&&e.maxLevel===t.maxLevel})})),t.length>0?h.deleteBasemaps(o.app,t):null}}).then(function(){if(o._throwIfCanceled(),n.basemapDownloads)return t({message:o.getResource("language-offline-progress-starting-basemap-download"),percentage:y()}),p.downloadBasemaps(o.app,f,s,o._cancellationTokenSource.token(),function(e){g.basemapWork=e.percentage/100*a.basemapWork,t({message:e.message,percentage:y(),isWarning:e.isWarning})})}).then(function(){if(o._throwIfCanceled(),o.canCancel.set(!1),g.basemapWork=a.basemapWork,n.updateBundle)return t({message:o.getResource("language-offline-progress-downloadingsite"),percentage:y()}),o._bundleManager.updateBundle(f.id,o._getOfflineMapBasemapMapping(f))}).then(function(){return e?(t({message:o.getResource("language-offline-progress-savingofflinemap"),percentage:y()}),o._appStoreSetPromise(o._getOfflineMapKey(f),JSON.stringify(f))):null}).then(function(){return o._setOfflineMap({id:f.id,isDownloaded:!0,hasProgress:!1},f),o._save()}).then(function(){return o._progressClient.resetOfflineMapProgress(f.id)}).then(function(){g.bundleWork=a.bundleWork,t({message:o.getResource("language-offline-progress-complete"),percentage:y()}),n.refreshMap&&(o.aoiMask.show(new esri.geometry.Polygon(f.content.geometry)),o.app.site.essentialsMap.mapServices.forEach(function(e){return e.refresh()})),o.app.event("OfflineMapSyncedEvent").publish({offlineMap:f})})["catch"](function(e){if(o._isCancelling)return o._setOfflineMap({id:f.id,isDownloaded:!0,hasProgress:!1},f),o._progressClient.resetOfflineMapProgress(f.id).then(function(){o.app.event("OfflineMapSyncErrorEvent").publish({offlineMap:f,error:e})});throw o.app.event("OfflineMapSyncErrorEvent").publish({offlineMap:f,error:e}),e})["finally"](function(){o._cancellationTokenSource.dispose(),o._cancellationTokenSource=null,o.canCancel.set(!1),o._isCancelling=!1,o.currentOperation=null})})},e.prototype.updateBundle=function(e){var t=this;return this._lastOperation=this._waitForLast()["finally"](function(){if(!i)throw new Error(t.getResource("language-offline-errors-offlinemapnull"));var e=t._getOfflineMapIx(i);if(e===-1)throw new Error(t.getResource("language-offline-errors-notfound"));t._throwIfNotNativeInitialized();var i=t._offlineMaps[e].offlineMap;return t._bundleManager.updateBundle(i.id,t._getOfflineMapBasemapMapping(i))})},e.prototype.activateOfflineMap=function(e,t){var i=this;return this._lastOperation=this._waitForLast()["finally"](function(){if(!e)throw new Error(i.getResource("language-offline-errors-offlinemapnull"));var r=i._getOfflineMapIx(e);if(r===-1)throw new Error(i.getResource("language-offline-errors-notfound"));i.currentOperation=_.Activate;var n=i._offlineMaps[r].offlineMap;i._throwIfNotNativeInitialized();var a=i._activeOfflineMapId;return i._activeOfflineMapId=n.id,i._bundleManager.loadBundle(i._activeOfflineMapId).then(function(){return i.refreshSyncInfo()}).then(function(){return i._save()})["catch"](function(e){return i._activeOfflineMapId=a,Promise.resolve().then(function(){return a?i._bundleManager.loadBundle(i._activeOfflineMapId):i._bundleManager.unloadBundle()}).then(function(){return i.refreshSyncInfo()})["catch"](function(e){i.app.trace.error("Error undoing attempt to activate offline map. "+(e.message||e))}).then(function(){throw e})}).then(function(){i.app.isOffline.set(!0),i.isOfflineMapActive.set(!0);var e=new esri.geometry.Polygon(n.content.geometry);i.aoiMask.show(e),i._restoreOfflineUserAddedLayers(n),i.app.site.essentialsMap.mapServices.forEach(function(e){if(e instanceof f.FeatureLayerService){var t=e.serviceLayer;t.suspended&&t.resume()}e.refresh()}),i.app.event("OfflineMapActivatedEvent").publish({offlineMap:i._offlineMaps[r].offlineMap,userAction:!!t})})["finally"](function(){i.currentOperation=null})})},e.prototype.deactivateOfflineMap=function(e){var t=this;return this._lastOperation=this._waitForLast()["finally"](function(){return t._throwIfNotNativeInitialized(),null==t._activeOfflineMapId?Promise.resolve():(t.currentOperation=_.Deactivate,t._previousActiveOfflineMapId=t._activeOfflineMapId,t._activeOfflineMapId=null,t._bundleManager.unloadBundle().then(function(){return t.refreshSyncInfo()}).then(function(){return t._save()}).then(function(){t.app.isOffline.set(!1),t.isOfflineMapActive.set(!1),t.aoiMask.hide(),t.app.site.updateServiceTokensIfStale().then(function(){t.app.site.essentialsMap.mapServices.forEach(function(e){if(e instanceof f.FeatureLayerService){var t=e.serviceLayer,i=new esri.tasks.Query;i.objectIds=[0],t.queryIds(i,function(){e.refresh()},function(){t.suspend()})}else e.refresh()})}),t.app.event("OfflineMapActivatedEvent").publish({offlineMap:null,userAction:!!e})})["finally"](function(){t.currentOperation=null}))})},e.prototype.cancel=function(){return this.canCancel.get()?(this._isCancelling=!0,this._cancellationTokenSource.cancel(),this.canCancel.set(!1),this._lastOperation):Promise.reject(this.getResource("language-offline-errors-cancelrejected"))},e.prototype.forgetLast=function(){this._lastOperation=Promise.resolve()},e.prototype.getOfflineMapById=function(e){return this._offlineMaps.map(function(e){return e.offlineMap}).filter(function(t){return t.id===e})[0]},e.prototype.getOfflineMapWithStateById=function(e){return this._offlineMaps.filter(function(t){return t.offlineMap.id===e})[0]},e.prototype.getOfflineMaps=function(){return this._offlineMaps.map(function(e){return e.offlineMap})},e.prototype.getOfflineMapsWithState=function(){return this._offlineMaps.concat()},e.prototype.getActiveOfflineMap=function(){return this._activeOfflineMapId?this.getOfflineMapById(this._activeOfflineMapId):null},e.prototype.refreshSyncInfo=function(){var e=this;return this._activeOfflineMapId?(console.log("refreshing sync info"),d.SyncEngine.getSyncInfo(this.app,this._activeOfflineMapId).then(function(t){console.log("sync info refreshed"),e.syncInfo=t})):(this.syncInfo=null,Promise.resolve())},e.prototype._save=function(){var e=this,t={offlineMapStates:this._offlineMaps.map(function(e){return e.state}),activeOfflineMapId:this._activeOfflineMapId,previousActiveOfflineMapId:this._previousActiveOfflineMapId};return this._appStoreSetPromise("__offlineManager",JSON.stringify(t))["catch"](function(t){throw e.app.trace.error("Error saving offline manager state. "+(t.message||t)),t.message=e.getResource("language-offline-errors-savefailed"),t}).then(function(){})},e.prototype.load=function(){var e=this;if(!this._lastOperation)return this.app.trace.info("loading offline map"),this._lastOperation=this._appStoreGetPromise("__offlineManager").then(function(t){if(e.app.trace.info("offline map loaded"),!t)return null;var i=JSON.parse(t);i.offlineMapIds&&!i.offlineMapStates&&(i.offlineMapStates=i.offlineMapIds.map(function(e){return{id:e,isDownloaded:!0,hasProgress:!1}}));var r=i.offlineMapStates.map(function(t){return e._loadOfflineMapFromStorage(t.id)["catch"](function(i){return e.app.trace.warning("Unable to restore offline map '"+t.id+"'. "+(i.message||i)),null})});return Promise.filter(r,function(e){return null!=e}).then(function(t){e._offlineMaps=t.map(function(e){return{offlineMap:e,state:i.offlineMapStates.filter(function(t){return t.id===e.id})[0]}});var r=e._prioritizeOfflineMaps(i,e._offlineMaps.map(function(e){return e.offlineMap}));return e._initializeMap(r).then(function(){e.app.trace.info("offline map initialized")})}).then(function(){e.app.event("OfflineMapsLoadedEvent").publish({offlineMaps:e._offlineMaps.map(function(e){return e.offlineMap}),activeOfflineMap:e.getActiveOfflineMap(),offlineMapStates:e._offlineMaps.map(function(e){return e.state})})})})["catch"](function(t){throw e.app.trace.error("Error loading offline manager state. "+(t.message||t)),t.message=e.getResource("language-offline-errors-loadfailed"),t}),this._lastOperation.then(function(){})},e.prototype.setStoreResource=function(e,t,i){return this._bundleManager.setStoreResource(e.id,t,i)},e.prototype.getStoreResource=function(e,t){return this._bundleManager.getStoreResource(e.id,t)},e.prototype.hasInternetCheck=function(){return this.app.nativeManager.message("CanReachHost",{url:this.app.site.url})},e.prototype._prioritizeOfflineMaps=function(e,t){for(var i=[e.activeOfflineMapId,e.previousActiveOfflineMapId],r=0,n=t.map(function(e){return e.id});r<n.length;r++){var a=n[r];a!==e.activeOfflineMapId&&a!==e.previousActiveOfflineMapId&&i.push(a)}return i},e.prototype._initializeMap=function(e){var t=this;if(0===e.length&&this.app.isOffline.get())return Promise.resolve();var i=e[0];return this.app.isOffline.get()&&!i?this._initializeMap(e.slice(1)):i?this._bundleManager.loadBundle(i).then(function(){t._activeOfflineMapId=i,t.app.isOffline.set(!!i),t.isOfflineMapActive.set(!!i);var e=t._getOfflineMapIx(i),r=t._offlineMaps[e].offlineMap,n=new esri.geometry.Polygon(t._offlineMaps[e].offlineMap.content.geometry);return t.aoiMask.show(n),t._restoreOfflineUserAddedLayers(r),t.refreshSyncInfo()})["catch"](function(i){return t._initializeMap(e.slice(1))}):Promise.resolve()},e.prototype._waitForLast=function(){return this._lastOperation["catch"](function(e){})},e.prototype._throwIfCanceled=function(){if(this._cancellationTokenSource.token().isCancellationRequested)throw new Error(this.getResource("language-offline-errors-canceled"))},e.prototype._throwIfNotNativeInitialized=function(){if(!this.app.nativeManager.nativeInitialized)throw new Error(this.getResource("language-offline-errors-notnativeinitialized"))},e.prototype._loadOfflineMapFromStorage=function(e){var t=this;return this._appStoreGetPromise(this._getOfflineMapKey(e)).then(function(e){if(!e)throw t.app.trace.error("Offline profile '{offlineMapId}' not found."),new Error(t.getResource("language-offline-errors-notfound"));return JSON.parse(e)},function(e){throw t.app.trace.error("Error loading offline map. "+(e.message||e)),e.message=t.getResource("language-offline-errors-loadfailed"),e})},e.prototype._restoreOfflineUserAddedLayers=function(e){var t=this;this.app.waitUntilSiteServiceLayersLoaded().then(function(){var i=[],r=g.AppInfo.fromGeocortexApp(t.app);e.content.layers.forEach(function(t){if(t.isUserCreated&&t.serviceInfo){var n=t.serviceInfo.url;if(n){var a=r.mapInfo.getLayerInfos().filter(function(e){return e.uniqueId===t.layerInfoUniqueId})[0];if(a)return void(a.gcxLayer&&a.gcxLayer.properties.offlineMapId&&(a.gcxLayer.properties.offlineMapId=e.id));var o=r.mapInfo.serviceLayers.filter(function(e){return e.serviceLayer.url===n})[0];if(o&&o.gcxMapService){var s=new y.Layer(t.layerJson.url);s.createFromDefinition(t.layerJson),s.isUserCreated=!0,s.catalogId=t.layerJson.catalogId,s.includeInLayerList=!0,s.setInActiveTheme(!0),s.properties.offlineMapId=e.id,s.parentLayerId=null,o.gcxMapService.add(s);var l=i.filter(function(e){return e.service===o.gcxMapService})[0];l?l.layers.push(s):i.push({service:o.gcxMapService,layers:[s]})}}}}),i.forEach(function(e){t.app.event("MapServiceLayersChangedWithResultEvent").publish({mapService:e.service,newItems:e.layers,oldItems:[]}),t.app.event("MapServiceLayersChangedEvent").publish(e.service)})})},e.prototype._getOfflineMapIx=function(e){for(var t="string"==typeof e?e:e.id,i=0;i<this._offlineMaps.length;i++)if(this._offlineMaps[i].offlineMap.id===t)return i;return-1},e.prototype._getOfflineMapBasemapMapping=function(e){var t=this.app.site.essentialsMap.baseMaps;return e.content.basemaps.map(function(e){var i=t.filter(function(t){return e.baseMapId===t.id})[0];if(!i)return null;var n=i.services.filter(function(e){return e.mapService.mapServiceType===b.MapServiceType.TILED}).pop();return n?{url:v.DecomposedUri.removeQueryParameters(n.mapService.serviceLayer.url,"token"),localServicePath:(e.sourceType===r.OfflineMapBasemap.Type.PREGENERATED?"tile":"viewertile")+"/"+e.filename.replace(" ","_")}:null}).filter(function(e){return!!e})},e.prototype._getOfflineMapKey=function(e){return"string"==typeof e?"__offlineMap-"+e:"__offlineMap-"+e.id},e.prototype._appStoreGetPromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.get(e,i,r)})},e.prototype._appStoreSetPromise=function(e,t){var i=this;return new Promise(function(r,n){return i.app.store.set(e,t,function(){return r()},n)})},e.prototype._appStoreRemovePromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.remove(e,function(){return i()},r)})},e.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},e.prototype._setOfflineMap=function(e,t){var i=l.ArrayUtils.findIndex(this._offlineMaps,function(e){return e.offlineMap.id==t.id});i>=0?this._offlineMaps.splice(i,1,{state:e,offlineMap:t}):this._offlineMaps.push({state:e,offlineMap:t})},e}();t.OfflineManager=S;var _;!function(e){e[e.Download=1]="Download",e[e.Sync=2]="Sync",e[e.Remove=3]="Remove",e[e.Activate=4]="Activate",e[e.Deactivate=5]="Deactivate",e[e.RemovePartial=6]="RemovePartial"}(_=t.OfflineManagerOperation||(t.OfflineManagerOperation={}))})},"geocortex/infrastructure/states/State":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.stateDefinition=e,this.activatedBy=t}return e}();t.ActiveState=i})},"geocortex/infrastructure/states/States":function(){define(["require","exports"],function(e,t){"use strict";t.definedStates=[{name:"DefaultState",description:"language-states-default-description",isModal:!1},{name:"TransientActiveState",description:"language-states-transient-active-description",isModal:!1,enterEvents:[{name:"TransientActivatedEvent"}],exitEvents:[{name:"TransientsDeactivatedEvent"}]},{name:"IdentifyState",description:"language-states-identify-state-description",isModal:!1,enterCommands:[{name:"SetActiveTool",parameter:"PointIdentifyTool-Navigation"},{name:"SetActiveTool",parameter:"IdentifyRectangleTool"},{name:"SetActiveTool",parameter:"RectangleIdentifyTool"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"Identify"}]},{name:"IdentifyBufferingState",parentState:"IdentifyState",description:"language-states-buffering-description",isModal:!1,enterEvents:[{name:"BufferingActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"BufferingDeactivatedEvent",parameter:"Identify"}]},{name:"IdentifyCombineModeUnionState",parentState:"IdentifyState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"union"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"},{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}]},{name:"IdentifyCombineModeSubtractState",parentState:"IdentifyState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"union"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"}]},{name:"PlotCoordinatesState",description:"language-states-plotcoordinates-state-description",isModal:!1,enterCommands:[{name:"SetActiveTool",parameter:"PlotCoordinatesTool"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"PlotCoordinates"}]},{name:"SnappingState",description:"language-states-snapping-description",isModal:!1,enterCommands:[{name:"ActivateSnapping"}],exitCommands:[{name:"DeactivateSnapping"}]},{name:"FindDataState",description:"language-states-identify-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"Identify"}]},{name:"FindDataBufferingState",parentState:"FindDataState",description:"language-states-buffering-description",isModal:!1,enterEvents:[{name:"BufferingActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"BufferingDeactivatedEvent",parameter:"Identify"}]},{name:"FindDataCombineModeUnionState",parentState:"FindDataState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"union"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"},{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}]},{name:"FindDataCombineModeSubtractState",parentState:"FindDataState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"union"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"}]},{name:"DrawMarkupState",description:"language-states-draw-markup-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"AddMarkup"},{name:"ToolCommandActivatedEvent",parameter:"AddTextMarkup"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"AddMarkup"},{name:"ToolCommandDeactivatedEvent",parameter:"AddTextMarkup"}]},{name:"MeasureState",description:"language-states-measure-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"MeasureDistance"},{name:"ToolCommandActivatedEvent",parameter:"MeasureArea"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"MeasureDistance"},{name:"ToolCommandDeactivatedEvent",parameter:"MeasureArea"}]},{name:"SelectMarkupForEditingState",description:"language-states-edit-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"DeleteMeasurement"},{name:"ToolCommandActivatedEvent",parameter:"DeleteMarkup"},{name:"ToolCommandActivatedEvent",parameter:"EditMarkup"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"DeleteMeasurement"},{name:"ToolCommandDeactivatedEvent",parameter:"DeleteMarkup"},{name:"ToolCommandDeactivatedEvent",parameter:"EditMarkup"}]},{name:"EditorActiveState",description:"language-states-editing-active-state-description",isModal:!1,enterCommands:[{name:"StartEditingFeature"},{name:"StartEditingNewFeature"},{name:"StartEditingNewRelatedRecord"}],exitEvents:[{name:"EditorClosedEvent"}]},{name:"EditingMarkupState",description:"language-states-editing-state-description",isModal:!1,enterEvents:[{name:"MarkupEditingStartedEvent"}],exitEvents:[{name:"MarkupEditingStoppedEvent"}]},{name:"EditingMeasurementMarkupState",description:"language-states-editing-state-description",isModal:!1,enterEvents:[{name:"MeasurementEditingStartedEvent"}],exitEvents:[{name:"MarkupEditingStoppedEvent"}]},{name:"FeaturePlacementState",description:"language-states-feature-editing-state-description",isModal:!0,enterEvents:[{name:"StartFeaturePlacementEvent"},{name:"ToolCommandActivatedEvent",parameter:"SetEditorFeatureGeometry"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"FeaturePlacementGraphicState",parentState:"FeaturePlacementState",description:"language-states-feature-editing-state-graphic-description",isModal:!1,enterCommands:[{name:"StartEditingGraphicGeometry"}],enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"SetEditorFeatureGeometry"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"FeaturePlacementPointGraphicState",parentState:"FeaturePlacementState",description:"language-states-feature-editing-state-point-graphic-description",isModal:!1,enterEvents:[{name:"GeometryEditPointActivatedEvent"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"MarkupStyleToggleState",description:"State for the markup style toggle button",isModal:!1,enterCommands:[{name:"_showMarkupStyleSelectorView"}],exitEvents:[{name:"_markupToggleDeactivated"}]}]})},"geocortex/infrastructure/states/StateManager":function(){define(["require","exports","geocortex/infrastructure/states/State","geocortex/infrastructure/states/States"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){this.registeredStates=[],this.activeStates=[],this.modalState=null,this.previousModalState=null,this.commandTokens=[],this.eventTokens=[],this.app=e,this.libraryId=t;for(var i=0;i<r.definedStates.length;i++)this.registerState(r.definedStates[i])}return e.prototype.registerState=function(e){var t=this;if(this.registeredStates.some(function(t){return t.name===e.name}))return void this.app.trace.info("States with duplicate names registered! New state ignored. Name is: "+e.name);var r=this.registeredStates.filter(function(e){return e.hasOwnProperty("parentState")});if(r.some(function(t){return t.name===e.parentState}))return void this.app.trace.info("Tried to load a state with a parent that references another state that has a parent. Only parent -> child relationships are allowed. State name: "+e.name);var n=dojo.connect(this.app,"onLibrariesDownloaded",this,function(){dojo.disconnect(n),t.app.hasLibrary(t.libraryId)&&e.description.search(" ")===-1&&(e.description=t.app.getResource(t.libraryId,e.description))});e.enterCommands&&e.enterCommands.forEach(function(i){var r=t.app.command(i.name).register(t,function(r){return t._stateEntered(e,i,r)});t.commandTokens.push({instance:i,token:r})}),e.exitCommands&&e.exitCommands.forEach(function(i){var r=t.app.command(i.name).register(t,function(r){return t._stateExited(e,i,r)});t.commandTokens.push({instance:i,token:r})}),e.enterEvents&&e.enterEvents.forEach(function(i){var r=t.app.event(i.name).subscribe(t,function(r){return t._stateEntered(e,i,r)});t.eventTokens.push({instance:i,token:r})}),e.exitEvents&&e.exitEvents.forEach(function(i){var r=t.app.event(i.name).subscribe(t,function(r){return t._stateExited(e,i,r)});t.eventTokens.push({instance:i,token:r})}),this.registeredStates.push(e),"DefaultState"===e.name&&this.activeStates.push(new i.ActiveState(e))},e.prototype.onDestroy=function(){for(var e=0;e<this.eventTokens.length;e++)this.app.event(this.eventTokens[e].instance.name).unsubscribe(this.eventTokens[e].token);for(var e=0;e<this.commandTokens.length;e++)this.app.command(this.commandTokens[e].instance.name).unregister(this.commandTokens[e].token)},e.prototype.getActiveStates=function(){for(var e=[],t=0;t<this.activeStates.length;t++)e[this.activeStates[t].stateDefinition.name]=this.activeStates[t];return this.activeStates.filter(function(t){return t.stateDefinition.parentState&&e[t.stateDefinition.parentState]||!t.stateDefinition.parentState})},e.prototype.getStateByName=function(e){for(var t=0;t<this.registeredStates.length;t++)if(this.registeredStates[t].name===e)return this.registeredStates[t];return null},e.prototype.getModalState=function(){return this.modalState||null},e.prototype.isModalStateActive=function(){return null!==this.modalState},e.prototype.isCurrentlyActive=function(e){return this.activeStates.some(function(t){return t.stateDefinition.name===e})},e.prototype.getAllStateNames=function(){for(var e=[],t=0;t<this.registeredStates.length;t++)e.push(this.registeredStates[t].name);return e},e.prototype._stateEntered=function(e,t,r){if((!e.parentState||this.activeStates.some(function(t){return t.stateDefinition.name===e.parentState}))&&!(this.isCurrentlyActive(e.name)||t.parameter&&t.parameter!==r)){var n=null;("string"==typeof r||r instanceof String)&&(n=r),this.app.trace.debug("State entered: "+e.name),e.isModal&&(null!==this.modalState&&(this.previousModalState=this.modalState,this._exitState(this.modalState,t,n)),this.app.trace.debug("Modal State entered: "+e.name),this.modalState=e),this.activeStates.push(new i.ActiveState(e,t)),this.app.event("StateEnteredEvent").publish({stateDefinition:e,activeStates:this.activeStates,modalState:this.modalState,previousModalState:this.modalState})}},e.prototype._stateExited=function(e,t,i){if(!t.parameter||t.parameter===i){for(var r=!1,n=0;n<this.activeStates.length;n++)this.activeStates[n].stateDefinition===e&&(r=!0);var a=!1;if(e.parentState&&(a=this.activeStates.some(function(t){return t.stateDefinition.name===e.parentState})),r&&(!e.parentState||a)){var o=null;("string"==typeof i||i instanceof String)&&(o=i),this._exitState(e,t,o)}}},e.prototype._exitState=function(e,t,i){this._exitChildStates(e,t,i);for(var r=this.activeStates.length-1;r>=0;r--){var n=this.activeStates[r].stateDefinition;n===e&&(this.activeStates.splice(r,1),this.app.trace.debug("State exited: "+e.name))}this.modalState===e&&(this.modalState=null,this.previousModalState=e,this.app.trace.debug("Modal state exited: "+e.name)),this.app.event("StateExitedEvent").publish({stateDefinition:e,activeStates:this.activeStates,modalState:this.modalState,previousModalState:this.previousModalState})},e.prototype._exitChildStates=function(e,t,i){for(var r=[],n=0;n<this.activeStates.length;n++)if(this.activeStates[n].stateDefinition.parentState===e.name){var a=this.activeStates[n].stateDefinition;if(a.exitCommands)for(var o=0;o<a.exitCommands.length;o++)a.exitCommands[o].name!==t.name||a.exitCommands[o].parameter&&a.exitCommands[o].parameter!==i||r.push(a);if(a.exitEvents)for(var o=0;o<a.exitEvents.length;o++)a.exitEvents[o].name!==t.name||a.exitEvents[o].parameter&&a.exitEvents[o].parameter!==i||r.push(a)}for(var n=0;n<r.length;n++)this._exitState(r[n],t,i)},e}();t.StateManager=n})},"geocortex/infrastructure/undo/Undoable":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/undo/TransactionStatus":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e.PENDING="pending",e.COMMITTING="committing",e.COMMITTED="committed",e.ABORTING="aborting",e.ABORTED="aborted"}(i=t.TransactionStatus||(t.TransactionStatus={}))})},"geocortex/infrastructure/undo/UndoTransaction":function(){define(["require","exports","geocortex/infrastructure/undo/TransactionStatus"],function(e,t,i){"use strict";var r=function(){function e(e,t,r){if(void 0===t&&(t="[anonymous]"),void 0===r&&(r={}),!e)throw new Error("Transaction manager is required");this.owner=e,this.displayName=t,this.state=r,this.transactionStatus=i.TransactionStatus.PENDING,this.changes=[]}return e.prototype.isTopLevel=function(){return!this.parentTransaction},e.prototype.isComplete=function(){return this.isCommitted()||this.isAborted()},e.prototype.isAborted=function(){return this.transactionStatus==i.TransactionStatus.ABORTED},e.prototype.isCommitted=function(){return this.transactionStatus==i.TransactionStatus.COMMITTED},e.prototype.add=function(t,i,r){if(void 0===r&&(r={}),i&&!this.isComplete()){var n;n=i instanceof e?i:this._wrapInTransaction(t,i,r),this.changes.push(n)}},e.prototype._wrapInTransaction=function(t,r,n){void 0===n&&(n={}),r.state=r.state||n;var a=new e(this.owner,t);return a.transactionStatus=i.TransactionStatus.PENDING,a.parentTransaction=this,a.changes.push(r),a},e.prototype.hasChanges=function(){return this.changes.length>0},e.prototype.commit=function(){return this.owner.commitTransaction(this)},e.prototype.rollback=function(){return this.owner.rollbackTransaction(this)},e.prototype.performUndo=function(e,t){var i=this;if(!this.hasChanges())return Promise.resolve();var r=function(e,t){if(t)return t.performUndo(t.state,i)};return Promise.reduce(this.changes.slice().reverse(),r,null)},e.prototype.performRedo=function(e,t){var i=this;if(!this.hasChanges())return Promise.resolve();var r=function(e,t){if(t)return t.performRedo(t.state,i)};return Promise.reduce(this.changes,r,null)},e}();t.UndoTransaction=r})},"geocortex/infrastructure/undo/TransactionManager":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/undo/UndoManagerState":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/undo/UndoManager":function(){define(["require","exports","geocortex/infrastructure/undo/UndoTransaction","geocortex/infrastructure/undo/TransactionStatus"],function(e,t,i,r){"use strict";var n;!function(e){e.IDLE="Idle",e.UNDOING="Undoing",e.REDOING="Redoing",e.COMMITTING="Committing",e.ROLLINGBACK="RollingBack"}(n=t.Status||(t.Status={}));var a=function(){function e(e,t){this.maxOperations=0,this.isSuspended=!1,this.isUndoing=!1,this.isRedoing=!1,this.canRedo=!1,this.canUndo=!1,this.length=0,this.position=0,this.rootTransaction=null,this._status=n.IDLE,this._historyStack=[],this.app=e,t=t||{},"number"==typeof t.maxOperations&&this.setMaxOperations(t.maxOperations),this.registerCommands()}return e.prototype.registerCommands=function(){var e=this;this.app.command("Undo").register(this,this.undo,function(t){return e.canUndo}),this.app.command("Redo").register(this,this.redo,function(t){return e.canRedo})},e.prototype.suspend=function(){this.isSuspended=!0},e.prototype.resume=function(){this.isSuspended=!1},e.prototype.setMaxOperations=function(e){this.maxOperations=e},e.prototype.getCurrentState=function(){return{historyStack:(this._historyStack||[]).slice(),position:this.position,rootTransaction:this.rootTransaction,status:this._status}},e.prototype.add=function(e){if(!e)throw new Error("Undo operation cannot be null");for(;this.maxOperations>0&&this._historyStack.length>=this.maxOperations;){var t=this._historyStack.shift();this.app.event("UndoOperationDiscardedEvent").publish({sender:this,operation:t})}this._historyStack.splice(this.position,0,e),this.position++,this.clearRedo(),this.app.event("UndoOperationAddedEvent").publish({sender:this,operation:e}),this._checkAvailability()},e.prototype.undo=function(){var e=this;if(0===this.position)return Promise.resolve();var t=this.peekUndo();return this.position--,t&&"function"==typeof t.performUndo?(this._updateStatus(n.UNDOING),this.app.event("UndoStartedEvent").publish({sender:this,operation:t}),t.performUndo(t.state).lastly(function(){e._updateStatus(n.IDLE),e.app.event("UndoCompletedEvent").publish({sender:e,operation:t}),e._checkAvailability()})):Promise.resolve()},e.prototype.redo=function(){var e=this;if(this.position===this._historyStack.length)return Promise.resolve();var t=this.peekRedo();return this.position++,t&&"function"==typeof t.performRedo?(this._updateStatus(n.REDOING),this.app.event("RedoStartedEvent").publish({sender:this,operation:t}),t.performRedo(t.state).lastly(function(){e._updateStatus(n.IDLE),e.app.event("RedoCompletedEvent").publish({sender:e,operation:t}),e._checkAvailability()})):Promise.resolve()},e.prototype.peekUndo=function(){return this._historyStack.length>0&&this.position>0?this.getAt(this.position-1):null},e.prototype.peekRedo=function(){return this._historyStack.length>0&&this.position<this._historyStack.length?this.getAt(this.position):null},e.prototype.clearUndo=function(){
this._historyStack.splice(0,this.position),this.position=0,this._checkAvailability()},e.prototype.clearRedo=function(){this._historyStack.splice(this.position,this._historyStack.length-this.position),this.position=this._historyStack.length,this._checkAvailability()},e.prototype.getAt=function(e){return this._historyStack[e]},e.prototype.removeAt=function(e){0<=e&&e<this._historyStack.length&&(this._historyStack.splice(e,1),this.position>0&&this.position>e&&this.position--,this._checkAvailability())},e.prototype.beginTransaction=function(e,t){var r=new i.UndoTransaction(this,e);return this.rootTransaction?r.parentTransaction=t||this.rootTransaction:this.rootTransaction=r,r},e.prototype.commitTransaction=function(e){var t=this;if(e=e||this.rootTransaction,!e)return Promise.reject(new Error("Cannot find the transaction to commit"));if(e.isComplete())return Promise.reject(new Error("Transaction has been closed already"));if(e.transactionStatus=r.TransactionStatus.COMMITTING,!e.hasChanges())return e.transactionStatus=r.TransactionStatus.COMMITTED,this._onTransactionCommitted(e),Promise.resolve();var n=function(t){return t instanceof i.UndoTransaction?t.isComplete()?Promise.resolve():t.commit():t&&"function"==typeof t.performRedo?t.performRedo(t.state,e):void 0},a=function(e,t){return t?n(t):null},o=e.changes[0];return n(o).then(function(){return Promise.reduce(e.changes.slice(1),a,null)}).then(function(){e.transactionStatus==r.TransactionStatus.COMMITTING&&(e.transactionStatus=r.TransactionStatus.COMMITTED,t._onTransactionCommitted(e))})},e.prototype.rollbackTransaction=function(e){var t=this;if(e=e||this.rootTransaction,!e)return Promise.reject(new Error("Cannot find the transaction to rollback"));if(e.isComplete())return Promise.reject(new Error("Transaction has been closed already"));if(e.transactionStatus=r.TransactionStatus.ABORTING,!e.hasChanges())return e.transactionStatus=r.TransactionStatus.ABORTED,this._onTransactionAborted(e),Promise.resolve();var n=function(t,r){return r instanceof i.UndoTransaction?r.isAborted()?Promise.resolve():r.rollback():r&&"function"==typeof r.performUndo?r.performUndo(r.state,e):void 0};return Promise.reduce(e.changes.slice().reverse(),n,null).then(function(){if(e.isAborted()||(e.transactionStatus=r.TransactionStatus.ABORTED,t._onTransactionAborted(e)),!e.isTopLevel()&&!e.parentTransaction.isAborted())return t.rollbackTransaction(e.parentTransaction)})},e.prototype.destroy=function(){this._historyStack=null},e.prototype._onTransactionCommitted=function(e){e&&e.isTopLevel()&&e==this.rootTransaction&&(this.rootTransaction=null,this.add(e))},e.prototype._onTransactionAborted=function(e){if(e){var t=e.parentTransaction;if(t){var i=t.changes.indexOf(e);i>-1&&t.changes.splice(i,1)}e.isTopLevel()&&e==this.rootTransaction&&(this.rootTransaction=null)}},e.prototype._checkAvailability=function(){this.length=this._historyStack.length,this.isUndoing=this._status==n.UNDOING,this.isRedoing=this._status==n.REDOING,0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canUndo=!1,this.canRedo=!0):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canUndo=this.canRedo=!0,this.app.command("Undo").raiseCanExecuteChanged(),this.app.command("Redo").raiseCanExecuteChanged(),this.app.event("UndoStackChangedEvent").publish({sender:this})},e.prototype._updateStatus=function(e){this._status=e||n.IDLE,this.isUndoing=this._status==n.UNDOING,this.isRedoing=this._status==n.REDOING},e}();t.UndoManager=a})},"geocortex/infrastructure/menus/BatchItemConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/menus/BatchItemModel":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){return t&&t.command?(this.app=e,this.command=e.command(t.command),this.commandParameter=t.commandParameter||null,void(this.abortBatchOnFailure=!!t.abortBatchOnFailure)):void(e&&e.trace.warning("BatchItemModel: Could not create batch item. Configuration or command not specified."))}return e}();t.BatchItemModel=i})},"geocortex/infrastructure/menus/MenuItemConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/menus/MenuItemModel":function(){define(["require","exports","geocortex/infrastructure/menus/BatchItemModel","geocortex/framework-ui/StringLocalizer"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){var i=this;if(!e||!t)throw new Error("MenuItemModel: Required input parameters cannot be undefined");this.menuModel=e,this.app=e.app,this.id=t.id||"",this.text=t.text||"",this.description=t.description||"",this.iconUri=t.iconUri||this.menuModel.defaultIconUri,this.hideOnDisable=void 0!=t.hideOnDisable&&t.hideOnDisable,t.batch?(this.batchItems=[],this._setBatchItems(t.batch)):t.command&&(this.command=this.app.command(t.command),this.commandParameter=t.commandParameter||null),t.libraryId&&(r.localizeString(this.app,t.libraryId,this.text,function(e){return i.text=e}),r.localizeString(this.app,t.libraryId,this.description,function(e){return i.description=e}))}return e.prototype._setBatchItems=function(e){var t=this;e&&e.length&&e.forEach(function(e){e&&e.command&&t.batchItems.push(new i.BatchItemModel(t.app,e))})},e}();t.MenuItemModel=n})},"geocortex/infrastructure/menus/MenuEntryConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/menus/MenuModel":function(){define(["require","exports","geocortex/infrastructure/menus/MenuItemModel"],function(e,t,i){"use strict";var r=function(){function e(e,t){if(!e||!t||!t.id)throw new Error("MenuModel: Required input parameters cannot be undefined");this.app=e,this.id=t.id,this.title=t.title||"",this.description=t.description||"",this.defaultIconUri=t.defaultIconUri||"",this.items=this._createMenuItems(t.items)}return e.prototype._createMenuItems=function(e){var t=this,r=[];return e&&e.length&&e.forEach(function(e){try{var n=new i.MenuItemModel(t,e);n&&(n.command||n.batchItems)?r.push(n):t.app.trace.warning("MenuModel: Could not create menu item for menu with id: {0}. Invalid configuration.".format(t.id))}catch(a){t.app.trace.warning("Unexpected configuration error: {0}".format(a.message))}}),r},e}();t.MenuModel=r})},"geocortex/infrastructure/menus/MenuItemViewModel":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/menus/MenuViewModel"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){if(this._canExecuteChangedBindingTokens=[],this._contextPropertyBindingTokens={},!r.MenuViewModel||!t)throw new Error("MenuViewModel: Could not create menu view model. Input arguments cannot be undefined.");this.menuViewModel=e,this.menuItem=t,this.app=t.app,this.text=new i.Observable(t.text),this.description=new i.Observable(t.description),this.canExecute=new i.Observable(this.computeCanExecute()),this.iconUri=new i.Observable(t.iconUri),this._setupBindings()}return e.prototype.execute=function(){var t=this;this.computeCanExecute()&&(this.menuItem.command?this.menuItem.command.execute(e._computeCommandParameter(this,this.menuItem.commandParameter)):this.menuItem.batchItems.forEach(function(i){return i.command.execute(e._computeCommandParameter(t,i.commandParameter))}))},e.prototype.computeCanExecute=function(){if(this.menuItem.batchItems&&this.menuItem.batchItems.length){for(var t=!!this.menuItem.batchItems.length,i=0;i<this.menuItem.batchItems.length;i++){var r=this.menuItem.batchItems[i];if(t&&r.abortBatchOnFailure)if(r.command)try{t=r.command.canExecute(e._computeCommandParameter(this,r.commandParameter))}catch(n){t=!1}else t=!1}return t}if(!this.menuItem.command)return!1;try{return this.menuItem.command.canExecute(e._computeCommandParameter(this,this.menuItem.commandParameter))}catch(n){return!1}},e.prototype.refreshCanExecute=function(){var e=this.computeCanExecute();this.canExecute.get()!==e&&this.canExecute.set(e)},e.prototype.destroy=function(){for(var e=this._canExecuteChangedBindingTokens.length-1;e>=0;e--){var t=this._canExecuteChangedBindingTokens[e];t.canExecuteEvent.unsubscribe(t.token),this._canExecuteChangedBindingTokens.pop()}for(var i in this._contextPropertyBindingTokens)if(this._contextPropertyBindingTokens.hasOwnProperty(i)){var r=this.menuViewModel.menuContext.get();r[i]&&r[i].unbind(this._contextPropertyBindingTokens[i])}this._contextPropertyBindingTokens=null,this._canExecuteChangedBindingTokens=null},e.prototype._setupBindings=function(){var e=this,t=function(t){t&&e._canExecuteChangedBindingTokens.push({canExecuteEvent:t.canExecuteChanged,token:t.canExecuteChanged.subscribe(e,e.refreshCanExecute)})};this.menuItem.batchItems&&this.menuItem.batchItems.length?this.menuItem.batchItems.forEach(function(e){t(e.command)}):t(this.menuItem.command)},e._computeCommandParameter=function(e,t){var i=e.menuViewModel.menuContext.get(),n=function(t){var n=t.trim();return 0===n.indexOf("{{")&&n.indexOf("}}")>0?(n=n.replace("{{","").replace("}}",""),n.toLowerCase()===r.MenuViewModel.DefaultParameterName.toLowerCase()?i:i&&"undefined"!=typeof i[n]?(i[n].isObservable&&(e._contextPropertyBindingTokens[n]&&i[n].unbind(e._contextPropertyBindingTokens[n]),e._contextPropertyBindingTokens[n]=i[n].once(e,e.refreshCanExecute)),i[n]):(e.app.trace.warning("Could not find menu item '{0}'.".format(n)),null)):n};if(null===t||"undefined"==typeof t)return i;if("string"==typeof t)return n(t);if(i&&t&&"object"==typeof t){var a={};for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];"string"==typeof s?a[o]=n(s):a[o]=s}return a}return t},e}();t.MenuItemViewModel=n})},"geocortex/infrastructure/menus/MenuViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/menus/MenuItemViewModel"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.menuTitle=new r.Observable(""),n.menuDescription=new r.Observable(""),n.menuItems=new r.ObservableCollection([]),n.visibleMenuItems=new r.ObservableCollection([]),n.hasExecutableMenuItems=new r.Observable((!1)),n.menuContext=new r.Observable(null),n.auto(n.menuContext,n,n._handleContextChanged),n.auto(n.menuItems,n,n._handleMenuItemsChanged),n}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.menuId=t&&t.menuId||null,this.libraryId=t&&t.libraryId||this.libraryId},t.prototype.setupMenu=function(e){var t=this;if(this.menuId=e||this.menuId,!this.menuId)return void this.app.trace.error("MenuViewModel: Could not load menu. Menu id not specified.");this.menuItems.clear();var i=this.app.menuRegistry.getMenu(this.menuId);if(!i)return void this.app.trace.error("MenuViewModel: Could not load menu '{0}'. Menu not registered.".format(this.menuId));if(i.title&&this.menuTitle.set(i.title),i.description&&this.menuDescription.set(i.description),i.items&&i.items.length){var r=[];i.items.forEach(function(e){var i=new n.MenuItemViewModel(t,e);r.push(i),t.auto(i.canExecute,t,t._computeExecutableMenuItems)}),this.menuItems.addItems(r)}},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.menuItems.get().forEach(function(e){return e.destroy()}),this.menuItems.clear(),this.visibleMenuItems.clear()},t.prototype._computeExecutableMenuItems=function(){var e=!1,t=[];this.visibleMenuItems.clear();for(var i=0;i<this.menuItems.length();i++){var r=this.menuItems.getAt(i);r.canExecute.get()?(e=!0,t.push(r)):r.menuItem.hideOnDisable||t.push(r)}this.visibleMenuItems.set(t),this.hasExecutableMenuItems.set(e)},t.prototype._handleContextChanged=function(e){this.menuItems.get().forEach(function(e){return e.refreshCanExecute()})},t.prototype._handleMenuItemsChanged=function(e){if("clear"===e.type)this.visibleMenuItems.clear();else if("append"===e.type)this._computeExecutableMenuItems();else if("remove"===e.type)for(var t=e.sender.get().slice(e.rangeStart,e.rangeEnd+1),i=0;i<t.length;i++)this.visibleMenuItems.removeItem(t[i]);else"insert"===e.type&&this._computeExecutableMenuItems()},t}(i.ViewModelBase);a.DefaultParameterName="context",t.MenuViewModel=a})},"geocortex/infrastructure/menus/MenuView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/menus/MenuViewModel"],function(e,t,i,r){"use strict";var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){var i=this.configuration.libraryId||t.libraryId||this.libraryId;if(t instanceof r.MenuViewModel==!1){var n=new r.MenuViewModel(this.app,i);n.menuContext.set(t),t=n}return this.viewModel=t,this.viewModel&&!this.viewModel.menuId&&(this.viewModel.menuId=this.configuration&&this.configuration.menuId||null),this.viewModel.setupMenu(),this.viewModel&&this.viewModel.menuId?(this.title.set(this.getResource("language-menu-default-title")),void e.prototype.attach.call(this,t)):void this.app.trace.warning("Could not set up menu view '{0}'. View model or 'menuId' option not found.".format(this.id))},t.prototype.handleMenuItemClick=function(e,t,i){i&&(this.app.event("MenuItemInvokedEvent").publish({menuView:this,menuId:this.viewModel.menuId,menuItem:i}),i.execute())},t.prototype.getDescription=function(e,t,i){i.description&&(t.title=i.description.get())},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.app.menuRegistry.destroyMenuWidget(this)},t}(i.ViewBase);t.MenuView=n})},"geocortex/infrastructure/menus/MenuWidgetParameters":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/menus/MenuConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/menus/MenuRegistry":function(){define(["require","exports","geocortex/infrastructure/menus/MenuModel","geocortex/infrastructure/menus/MenuViewModel"],function(e,t,i,r){"use strict";var n=function(){function e(e){this.menuList=[],this._viewMenuEntries={},this._menuConfig=[],this.app=e}return e.prototype.loadMenus=function(e){var t=this;e&&e.menus&&e.menus.length&&(e.menus.forEach(function(e){return t.register(e)}),this._menuConfig=this._menuConfig.concat(e.menus))},e.prototype.register=function(e){var t=e&&e.id;if(!this._validMenuId(t))return void this.app.trace.warning("Could not register menu with id: {0}. Menu id should be defined and unique.".format(t));var r=e instanceof i.MenuModel?e:new i.MenuModel(this.app,e);this._validateMenuModel(r)?this.menuList.push(r):this.app.trace.warning("Could not register menu with id: {0}. Invalid menu configuration.".format(t))},e.prototype.unregister=function(e){for(var t=this.menuList.length-1,i=t;i>=0;i--)this.menuList[i].id===e&&this.menuList.splice(i,1)},e.prototype.getMenu=function(e){for(var t=this.menuList,i=0;i<t.length;i++)if(t[i].id===e)return t[i];return null},e.prototype.getDefaultIconUri=function(e){var t=this.getMenu(e);return t&&t.defaultIconUri?t.defaultIconUri:""},e.prototype.getMenuWidgetsForView=function(e){return this._viewMenuEntries[e.id]||[]},e.prototype.createMenuWidget=function(e,t,i,n,a){var o=this,s=i.domElement,l=i.viewModel,c=a?a:s.getAttribute("data-menu-id");if(!c||!this.getMenu(c))return console.log("Warning: Could not create menu view from DOM element attributes. Menu Id: {0} not registered with the MenuRegistry.".format(c)),null;var u=s.getAttribute("data-menu-template")||"Mapping/infrastructure/menus/MenuView.html",d=s.getAttribute("data-menu-type")||"geocortex.essentialsHtmlViewer.mapping.infrastructure.menus.MenuView",p=s.getAttribute("data-menu-library-id")||n||"Mapping",h=!s.hasAttribute("data-menu-hoist-disabled"),m=this.app.viewManager.createView({typeName:d,markupResource:u,isVisible:!0});if(!m)return console.log("Warning: Could not create menu '{0}' for view '{1}': Could not construct the menu widget view.".format(c,e.id)),null;m.app=this.app,m.configuration.menuId=c,p&&(m.libraryId=p);var f=new r.MenuViewModel(this.app,p);f.id="MenuViewModel-{0}".format(m.id),f.menuSourceView=e;var g=t;t&&t.isObservable?f.menuContext.sync(g):l&&i&&l[i.target]&&l[i.target].isObservable?(g=l[i.target],f.menuContext.sync(g)):f.menuContext.set(g),m.attach(f);var y={view:e,widgetView:m,widgetViewModel:f,context:g,menuId:c,hoistMenu:h,domElement:s};this._viewMenuEntries[e.id]||(this._viewMenuEntries[e.id]=[]),this._viewMenuEntries[e.id].push(y);var b=e.id;return dojo.aspect.after(e,"onDestroy",function(){return o._viewMenuEntries[b]=null}),this.app.event("MenuWidgetCreatedForView").publish(y),m},e.prototype.destroyMenuWidget=function(e){var t=this;e.viewModel&&(e.viewModel.menuContext.removeSync(),e.viewModel.destroy());for(var i in this._viewMenuEntries)this._viewMenuEntries.hasOwnProperty(i)&&null!=this._viewMenuEntries[i]&&this._viewMenuEntries[i].filter(function(t){return t.widgetView===e}).forEach(function(e,r){t._viewMenuEntries[i].splice(r,1)})},e.prototype._validMenuId=function(e){var t=e?this.menuList.filter(function(t){return t.id===e}):null;return null!==t&&0===t.length},e.prototype._validateMenuModel=function(e){return!!(e&&e.id&&e.items&&e.items.length)},e}();t.MenuRegistry=n})},"geocortex/infrastructure/tools/ToolRegistry":function(){define(["require","exports","geocortex/infrastructure/tools/MapTool"],function(e,t,i){"use strict";var r=function(){function e(e){this.tools={},this._subscriptions={},this._toolTypes={},this.app=e,this._registerCommands()}return e.prototype._registerCommands=function(){var e=this;this.app.command("SetActiveTool").register(this,function(t){return e.setActiveTool(t)},function(t){return e._setActiveToolCanExecute(t)}),this.app.command("ClearActiveTool").register(this,function(){return e.clearActiveTool()})},e.prototype._setActiveToolCanExecute=function(e){return!!this.tool(e)},e.prototype.clearActiveTool=function(){for(var e in this.tools)if(this.tools.hasOwnProperty(e)){var t=this.tools[e];t&&t.isActive&&t.setActive(!1)}},e.prototype.getActiveTool=function(){for(var e in this.tools)if(this.tools.hasOwnProperty(e)){var t=this.tools[e];if(t&&t.isActive)return t}return null},e.prototype.setActiveTool=function(e){var t=this.getActiveTool();if(this.clearActiveTool(),e){var i=this.tool(e);i?(this.app.event("ActiveToolChangingEvent").publish({tool:i,previousTool:t}),i.setActive(!0)):this.app.trace.warning("Could not activate tool '{0}'. The tool does not exist in the registry.".format(e))}},e.prototype.tool=function(e){return this.tools[e]},e.prototype.register=function(e){var t=this;this.unregister(e),e&&e.name&&(this.tools[e.name]=e,this._subscriptions[e.name]=dojo.connect(e,"setActive",function(r){if(r===!0){for(var n in t.tools)if(t.hasOwnProperty(n)){var a=t.tools[n];a&&a!=e&&a.isActive&&a.setActive(!1)}t.app.event("ActiveToolChanged").publish({tool:e,previousTool:null}),t.app.event("ActiveToolChanged").publish({tool:e,previousTool:null}),t.app.event("ActiveToolChangedEvent").publish({tool:e,previousTool:null}),e instanceof i.MapTool&&t.app.event("ToolCommandActivatedEvent").publish(e.command)}else t.getActiveTool()||(t.app.event("ActiveToolChanged").publish({tool:null,previousTool:e}),t.app.event("ActiveToolChangedEvent").publish({tool:null,previousTool:e}),e instanceof i.MapTool&&t.app.event("ToolCommandDeactivatedEvent").publish(e.command))}))},e.prototype.unregister=function(e){if(e&&e.name&&this.tools[e.name]==e){this.tools[e.name]=null;var t=this._subscriptions[e.name];t&&(dojo.disconnect(t),this._subscriptions[e.name]=null)}},e.prototype.clear=function(){for(var e in this.tools){var t=this.tools[e];t&&this.unregister(t)}},e.prototype.createTools=function(e,t){var i=this,r=[];return e&&e.forEach(function(e){var n=e.typeName?e.typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.tools.MapTool";i._toolTypes.hasOwnProperty(e.command)&&(n=i._toolTypes[e.command]);var a=dojo.getObject(n);if(a){var o=new a(i.app,e);r.push(o),t&&i.register(o)}else i.app.trace.warning("Could not create tool '{0}' from type name '{1}'.".format(e.name,n))}),r},e.prototype.registerToolTypeForCommand=function(e,t){this._toolTypes[e]=t},e}();t.ToolRegistry=r})},"geocortex/infrastructure/CommandViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i,n,a){var o=e.call(this,t,i)||this;return o.commandName="",o.commandParameter=null,o.canExecute=new r.Observable((!0)),o.notExecuteHidden=new r.Observable((!1)),n&&o._bindToCommand(n,a),o}return __extends(t,e),t.prototype.applyContext=function(e){this._command&&e&&this.canExecute.set(this._command.canExecute(e))},t.prototype._bindToCommand=function(e,t){this._canExecuteChangedBindingToken&&this._command&&this._command.canExecuteChanged.unsubscribe(this._canExecuteChangedBindingToken),this.commandName=e,this.commandParameter=t||null,this._command=this.app.command(e),this._canExecuteChangedBindingToken=this._command.canExecuteChanged.subscribe(this,this._handleCanExecuteChanged),this.canExecute.set(this._command.canExecute(t))},t.prototype._handleCanExecuteChanged=function(){this.canExecute.set(this._command.canExecute(this.commandParameter))},t}(i.ViewModelBase);t.CommandViewModel=n;var a;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){e.CommandViewModel=e.CommandViewModel}(t=e.command||(e.command={}))}(t=e.modules||(e.modules={}))}(t=e.mapping||(e.mapping={}))}(t=e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(a||(a={}))})},"geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework-ui/StringLocalizer"],function(e,t,i,r){"use strict";var n=function(){function e(e,t,n){this.libraryId="",this.isActive=new i.Observable((!0)),this.activeTransient=new i.Observable((!1)),this.disabled=new i.Observable((!1)),this.hidden=new i.Observable((!1)),this.cssClass=new i.Observable,this.items=new i.ObservableCollection,this.hasSmallLayout=new i.Observable((!1)),this.selectedTool=new i.Observable(null),this.toolChangeActive=new i.Observable((!1)),n&&(this.id=n.id,this.app=e,this.libraryId=t,this.type=n.type,this.name=new i.Observable(n.name),this.tooltip=new i.Observable(n.tooltip||null),this.hideOnDisable=new i.Observable((!!n.hideOnDisable)),n.libraryId&&r.localizeObservables(e,n.libraryId,[this.name,this.tooltip]))}return e.prototype.areAllHidden=function(e){for(var t=0;t<e.length();t++)if(e.getAt(t).disabled.get()===!1||e.getAt(t).hideOnDisable.get()===!1)return!1;return!0},e.prototype.setHidden=function(){this.disabled.get()===!0&&this.hideOnDisable.get()===!0?this.hidden.set(!0):this.hidden.set(!1)},e.prototype.execute=function(){},e.prototype.activate=function(){this.isActive.set(!0)},e.prototype.deactivate=function(){this.isActive.set(!1),this.activeTransient.set(!1)},e.prototype.onDestroy=function(){},e}();t.ToolbarGroupItemBase=n})},"geocortex/infrastructure/toolbarGroup/ToolbarGroupBase":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/framework-ui/StringLocalizer"],function(e,t,i,r,n){"use strict";function a(e,t){s[e]=t}function o(e,t,i){var r=i.type,n=s[r];if(n)return n(e,t,i);throw new Error("Could not find factory delegate for toolbar item type '"+r+"'")}var s={};t.registerToolbarFactoryMethod=a,t.createToolbarItem=o;var l=function(){function e(e,t,a){this.libraryId="",this.isActive=new i.Observable((!1)),this.disabled=new i.Observable((!1)),this.cssClass=new i.Observable,this.app=e,this.libraryId=t,a&&(this.name=new i.Observable(a.name),this.id=a.id||a.name||r.alphaNumericToken(),this.tooltip=new i.Observable(a.tooltip||null),this.type=a.type||"toolbarGroup",this.isDefault=!!a.isDefault,this.items=a.items?this.getToolbarGroupItems(a.items):new i.ObservableCollection,a.libraryId&&n.localizeObservables(e,a.libraryId,[this.name,this.tooltip]))}return e.prototype.getToolbarGroupItems=function(e){for(var t=new i.ObservableCollection,r=0;r<e.length;r++){var n=null;n=o(this.app,this.libraryId,e[r]),t.addItem(n)}return t},e}();t.ToolbarGroupBase=l})},"geocortex/infrastructure/toolbarGroup/ToolbarGroupRegistry":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(e,t,i,r){"use strict";var n=function(){function e(e){this.toolbarGroupList=new i.ObservableCollection,this._toolbarGroupsConfig=[],this.app=e}return e.prototype.getToolbarGroupById=function(e){if(0===this.toolbarGroupList.get().length||null===e)return null;for(var t=0;t<this.toolbarGroupList.get().length;t++)if(this.toolbarGroupList.getAt(t).id==e)return this.toolbarGroupList.getAt(t);return null},e.prototype.registerToolbarGroups=function(e,t){if(e)for(var i=0;i<e.length;i++){var n=e[i],a=new r.ToolbarGroupBase(this.app,t,n);this._toolbarGroupsConfig.push(n),this.unregisterToolbarGroup(n.id),this.toolbarGroupList.addItem(a)}},e.prototype.unregisterToolbarGroup=function(e){var t=this.getPosition(e);null!=t&&this.toolbarGroupList.get().splice(t,1)},e.prototype.getPosition=function(e){for(var t=0;t<this.toolbarGroupList.getLength();t++)if(this.toolbarGroupList.getAt(t).id===e)return t;return null},e}();t.ToolbarGroupRegistry=n})},"geocortex/infrastructure/clickableGraphics/ClickableGraphicsRegistry":function(){define(["require","exports","geocortex/infrastructure/Dictionary"],function(e,t,i){"use strict";var r=function(){function e(e){this._clickableGraphicLayers=new i.Dictionary,this._defaultOptions={displayName:null,autoEditable:!0,aliases:{},canEdit:this._defaultCallback,canDelete:this._defaultCallback,canChangeStyles:this._defaultCallback},this.app=e,this.app.event("LayerRemovedEvent").subscribe(this,this._handleLayerRemoved)}return e.prototype._defaultCallback=function(e){return!0},e.prototype.register=function(e,t){if(e instanceof esri.layers.GraphicsLayer){var i=$.extend({},this._defaultOptions,t||{}),r={};r.graphicsLayerId=e.id,r.displayName=i.displayName?i.displayName:"",r.aliases=i.aliases,r.autoEditable=i.autoEditable,r.canEdit=i.canEdit,r.canDelete=i.canDelete,r.canChangeStyles=i.canChangeStyles,this._clickableGraphicLayers.containsKey(e.id)&&this.app.trace.debug("Graphic layer with id '"+e.id+"' was already registered. ClickableLayerInfo will be overridden."),this._clickableGraphicLayers.set(e.id,r)}},e.prototype.unregister=function(e){if(this._clickableGraphicLayers.containsKey(e.id)){var t=this._clickableGraphicLayers.get(e.id);this._disposeLayerInfoObject(t),this._clickableGraphicLayers.remove(e.id)}else this.app.trace.debug("Graphic layer with id '"+e.id+"' was not found.")},e.prototype.getLayerInfo=function(e){if(this._clickableGraphicLayers.containsKey(e.id)){var t=this._clickableGraphicLayers.get(e.id);return $.extend({},t)}return this.app.trace.debug("Graphic layer with id '"+e.id+"' is not registered."),null},e.prototype.getLayerInfos=function(){var e=this,t=this.app.map.graphicsLayerIds.slice(0);t.reverse();var i=t.map(function(t){return e._clickableGraphicLayers.get(t)}).filter(function(e){return null!=e});return i.map(function(e){return $.extend({},e)})},e.prototype.clear=function(){this._clickableGraphicLayers.clear()},e.prototype.isLayerRegistered=function(e){return!!this._clickableGraphicLayers.containsKey(e.id)},e.prototype._disposeLayerInfoObject=function(e){e.canEdit=null,e.canDelete=null,e.canChangeStyles=null},e.prototype._handleLayerRemoved=function(e){e instanceof esri.layers.GraphicsLayer&&this.isLayerRegistered(e)&&this.unregister(e)},e}();t.ClickableGraphicsRegistry=r})},"geocortex/infrastructure/LayerIntegrationUtils":function(){define(["require","exports","geocortex/essentials/FeatureLayerService","geocortex/framework/utils/utils","geocortex/essentials/MapServiceConstants","geocortex/essentials/Layer","geocortex/essentials/LayerType","geocortex/essentials/KmlService","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r,n,a,o,s,l){"use strict";function c(e){return new Promise(function(t,i){esri.request({url:e,content:{f:"json"},handleAs:"json"}).then(function(r){if("layers"in r){for(var n=[],a=0,o=r.layers;a<o.length;a++){var s=o[a];s.subLayerIds||n.push(e+"/"+s.id)}t(n)}else"fields"in r?t([e]):i(new Error("Unknown response type from url ("+e+")."))},i)})}function u(e){var t=new i.FeatureLayerService;return t._createFrom({id:r.alphaNumericToken(),displayName:r.alphaNumericToken(),serviceType:n.MapServiceType.FEATURE,serviceFunction:n.MapServiceFunction.OPERATIONAL,connectionString:e}),t.serviceUrl=e,t.outFields="*",t.isUserCreated=!0,t.userLayerType=n.UserLayerType.UPLOAD,t._createServiceLayer(),new Promise(function(e,i){t.serviceLayer.on("load",function(i){t.displayName=t.serviceLayer.name;var r=new a.Layer;r._createFrom(t.serviceLayer),r.id=t.serviceLayer.layerId.toString(),r.type=o.LayerType.FEATURE_LAYER,r.userLayerType=n.UserLayerType.UPLOAD,r.isUserCreated=!0;var s=t.serviceLayer;"esriGeometryPoint"===s.geometryType&&(r.featureType="Point"),"esriGeometryPolyline"===s.geometryType&&(r.featureType="Line"),"esriGeometryPolygon"===s.geometryType&&(r.featureType="Polygon"),r.mapService=t,t.layers.push(r),e(t)})})}function d(e,t){void 0===t&&(t={});var i=new s.KmlService;return t=$.extend({id:r.alphaNumericToken(),serviceType:n.MapServiceType.KML,serviceFunction:n.MapServiceFunction.OPERATIONAL,serviceUrl:e,drawingBehavior:n.DrawingBehavior.KML_SERVICE,connectionString:e},t),i._createFrom(t),i.isUserCreated=!0,i.userLayerType=n.UserLayerType.UPLOAD,i._createServiceLayer(),new Promise(function(e,t){i.serviceLayer.on("load",function(t){e(i)})})}function p(e,t){void 0===t&&(t={});var i=new m;t=$.extend({id:r.alphaNumericToken()+":Local",displayName:e.layerDefinition.name,serviceType:n.MapServiceType.FEATURE,serviceFunction:n.MapServiceFunction.OPERATIONAL,connectionString:i.url},t),i._createFrom(t),i.isUserCreated=!0,i.userLayerType=n.UserLayerType.UPLOAD;var a=i.serviceLayer=new h(dojo.clone(e));a.id=i.id,a.layerId=0,a.name=e.layerDefinition.name,a.graphics.length&&(a.fullExtent=esri.graphicsExtent(a.graphics)),a.setEditable(!1);var s=new f;if(s._createFrom(a),s.id=a.layerId.toString(),s.primaryKeyField=s.getFieldByName(a.objectIdField),s.mapService=i,s.type=o.LayerType.FEATURE_LAYER,s.userLayerType=n.UserLayerType.UPLOAD,s.isUserCreated=!0,e.layerDefinition&&e.layerDefinition.geometryType){var l=e.layerDefinition.geometryType.toLowerCase();l.indexOf("point")>-1?s.featureType="Point":l.indexOf("line")>-1?s.featureType="Line":l.indexOf("polygon")>-1&&(s.featureType="Polygon")}return s.queryable=!1,s.supportsQuery=!1,s.supportsIdentify=!0,s.identifiable=!0,s.searchable=!0,s.showMapTips=!0,s.snappable=!0,s.snappingEnabled=!0,i.layers.push(s),Promise.resolve(i)}t.discoverFeatureServices=c,t.buildFeatureLayerService=u,t.buildKmlService=d,t.buildLocalFeatureLayerService=p;var h=function(e){function t(t){return e.call(this,t,{mode:esri.layers.FeatureLayer.MODE_SNAPSHOT})||this}return __extends(t,e),t.prototype.queryFeatures=function(t,i,r){var n=new esri.tasks.Query;t.hasOwnProperty("geometry")&&(n.geometry="extent"!==t.geometry.type?t.geometry.getExtent():t.geometry);for(var a=["num","objectIds","returnGeometry","spatialRelationship"],o=0,s=a;o<s.length;o++){var c=s[o];n[c]=t[c]}return e.prototype.queryFeatures.call(this,n,i,r).then(function(e){var i=function(e){return l.intersects(t.geometry,e.geometry)};return Promise.all(e.features.map(i)).then(function(t){return e.features.filter(function(e,i){return!!t[i]})}).then(function(t){return e.features=t,e})})},t}(esri.layers.FeatureLayer);t.LocalFeatureLayer=h;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(i.FeatureLayerService);t.LocalFeatureLayerService=m;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(a.Layer);t.LocalLayer=f})},"geocortex/infrastructure/webMap/BaseMapLayer":function(){define(["require","exports"],function(e,t){
"use strict";var i;!function(e){e.OPEN_STREET_MAP="OpenStreetMap",e.BING_AERIAL="BingMapsAerial",e.BING_ROAD="BingMapsRoad",e.BING_HYBRID="BingMapsHybrid",e.WEB_TILED="WebTiledLayer"}(i=t.BaseMapType||(t.BaseMapType={}))})},"geocortex/infrastructure/webMap/WebMapConverter":function(){define(["require","exports","geocortex/infrastructure/webMap/Symbol","geocortex/essentials/MapService","geocortex/essentials/Layer","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature","geocortex/infrastructure/webMap/Geometry","geocortex/infrastructure/webMap/Renderer","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/webMap/OperationalLayer","geocortex/infrastructure/LayerIntegrationUtils","geocortex/framework/utils/utils","geocortex/essentials/Field","geocortex/essentials/LayerType","geocortex/infrastructure/PromiseUtils","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/webMap/BaseMapLayer"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m,f,g,y){"use strict";var b=function(){function e(){}return e}(),v="Mapping.Infrastructure";t.CONVERSION_TYPE_PROPERTY="__conversionType";var S,_="__visible",I="__id",w="__symbol",x="__symbolId",L=x,C="graphics-layer-",M={type:i.SymbolType.SIMPLE_MARKER,style:i.SimpleMarkerStyle.CIRCLE,size:0,color:[0,0,0,0]},F=0;!function(e){e.FeatureLayer="ArcGISFeatureLayer",e.MapService="ArcGISMapServiceLayer",e.TiledMapService="ArcGISTiledMapServiceLayer",e.ImageService="ArcGISImageServiceLayer",e.BingAerial="BingMapsAerial",e.BingHybrid="BingMapsHybrid",e.BingRoad="BingMapsRoad",e.OpenStreetMap="OpenStreetMap",e.WebTiled="WebTiledLayer",e.KML="KML",e.WMS="WMS"}(S=t.LayerType||(t.LayerType={}));var E;!function(e){e.WEB_MAP_SERVICE_LAYER="webMapServiceLayer",e.WEB_MAP_LAYER="webMapLayer",e.WEB_MAP_FEATURE_SET="webMapFeatureSet",e.WEB_MAP_FEATURE="webMapFeature",e.WEB_MAP_GEOMETRY="webMapGeometry",e.WEB_MAP_SYMBOL="webMapSymbol",e.WEB_MAP_RENDERER="webMapRenderer",e.WEB_MAP_SPATIAL_REFERENCE="webMapSpatialReference",e.WEB_MAP_COLOR="webMapColor",e.WEB_MAP_DATA="webMapData",e.GCX_MAP_SERVICE="gcxMapService",e.GCX_LAYER="gcxLayer",e.GCX_FEATURE_SET="gcxFeatureSet",e.GCX_FEATURE="gcxFeature",e.ESRI_LAYER="esriLayer",e.ESRI_FEATURE_SET="esriFeatureSet",e.ESRI_GRAPHIC="esriGraphic",e.ESRI_GEOMETRY="esriGeometry",e.ESRI_SYMBOL="esriSymbol",e.ESRI_RENDERER="esriRenderer",e.ESRI_SPATIAL_REFERENCE="esriSpatialReference",e.ESRI_COLOR="esriColor",e.OBJECT="object"}(E=t.ConversionType||(t.ConversionType={}));var T=function(){function e(e){this._resultCache={},this._nextSymbolId=1,this._nestingLevel=0,this._hasReferences=!1,this._converting={},this.app=e}return e.prototype.fromGcxMapService=function(e){return this._convert(e,E.WEB_MAP_SERVICE_LAYER,this._fromGcxMapService)},e.prototype.fromGcxLayer=function(e){return this._convert(e,E.WEB_MAP_LAYER,this._fromGcxlayer)},e.prototype.fromGcxFeatureSet=function(e){return this._convert(e,E.WEB_MAP_FEATURE_SET,this._fromGcxFeatureSet)},e.prototype.fromGcxFeature=function(e){return this._convert(e,E.WEB_MAP_FEATURE,this._fromGcxFeature)},e.prototype.fromEsriLayer=function(e){return this._convert(e,E.WEB_MAP_SERVICE_LAYER,this._fromEsriLayer)},e.prototype.fromEsriFeatureSet=function(e){return this._convert(e,E.WEB_MAP_FEATURE_SET,this._fromEsriFeatureSet)},e.prototype.fromEsriGraphic=function(e){return this._convert(e,E.WEB_MAP_FEATURE,this._fromEsriGraphic)},e.prototype.fromEsriGeometry=function(e){return this._convert(e,E.WEB_MAP_GEOMETRY,this._fromEsriGeometry)},e.prototype.fromEsriSymbol=function(e){return this._convert(e,E.WEB_MAP_SYMBOL,this._fromEsriSymbol)},e.prototype.fromEsriRenderer=function(e){return this._convert(e,E.WEB_MAP_RENDERER,this._fromEsriRenderer)},e.prototype.fromEsriSpatialReference=function(e){return this._convert(e,E.WEB_MAP_SPATIAL_REFERENCE,this._fromEsriSpatialReference)},e.prototype.fromEsriColor=function(e){return this._convert(e,E.WEB_MAP_COLOR,this._fromEsriColor)},e.prototype.fromObject=function(e){return this._convert(e,E.WEB_MAP_DATA,this._fromObject)},e.prototype.toGcxMapService=function(e){return Promise.resolve(this._convert(e,E.GCX_MAP_SERVICE,this._toGcxMapService))},e.prototype.toGcxLayer=function(e,t){return Promise.resolve(this._convert(e,E.GCX_LAYER,this._toGcxLayer,[t]))},e.prototype.toGcxFeatureSet=function(e){return Promise.resolve(this._convert(e,E.GCX_FEATURE_SET,this._toGcxFeatureSet))},e.prototype.toGcxFeature=function(e){return Promise.resolve(this._convert(e,E.GCX_FEATURE,this._toGcxFeature))},e.prototype.toEsriLayer=function(e){return Promise.resolve(this._convert(e,E.ESRI_LAYER,this._toEsriLayer))},e.prototype.toEsriFeatureSet=function(e){return Promise.resolve(this._convert(e,E.ESRI_FEATURE_SET,this._toEsriFeatureSet))},e.prototype.toEsriGraphic=function(e){return Promise.resolve(this._convert(e,E.ESRI_GRAPHIC,this._toEsriGraphic))},e.prototype.toEsriGeometry=function(e){return this._convert(e,E.ESRI_GEOMETRY,this._toEsriGeometry)},e.prototype.toEsriSymbol=function(e){return this._convert(e,E.ESRI_SYMBOL,this._toEsriSymbol)},e.prototype.toEsriRenderer=function(e){return this._convert(e,E.ESRI_RENDERER,this._toEsriRenderer)},e.prototype.toEsriSpatialReference=function(e){return this._convert(e,E.ESRI_SPATIAL_REFERENCE,this._toEsriSpatialReference)},e.prototype.toEsriColor=function(e){return this._convert(e,E.ESRI_COLOR,this._toEsriColor)},e.prototype.toObject=function(e){return Promise.resolve(this._convert(e,E.OBJECT,this._toObject))},e.prototype.clearCache=function(){this._resultCache={}},e.prototype._convert=function(e,t,i,r){if(void 0===r&&(r=[]),null===e||void 0===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||e instanceof Date)return e;var n=this._resultCache[t];n||(n=this._resultCache[t]=new WeakMap);var a=this._converting[t];if(a||(a=this._converting[t]=new WeakMap),n.has(e))return n.get(e);if(a.has(e)){var o=new b;return n.set(e,o),this._hasReferences=!0,o}var s=void 0;0===this._nestingLevel&&(this._hasReferences=!1),this._nestingLevel++,a.set(e,!0);try{s=i.apply(this,[e].concat(r));var o=n.get(e);o&&(o.result=s),n.set(e,s)}catch(l){throw n["delete"](e),l}finally{this._nestingLevel--,a["delete"](e)}return 0===this._nestingLevel&&this._hasReferences&&this._resolveReferences(s),s},e.prototype._resolveReferences=function(e){if(e){var t=new WeakMap,i=function(e){if(!(e instanceof r.MapService||e instanceof n.Layer)){t.set(e,!0);for(var a in e){var o=e[a];"object"==typeof o&&(o instanceof b?e[a]=o.result:o&&!t.has(o)&&i(o))}}};i(e)}},e.prototype._getWebMapLayerDefinitionFromFeatureLayer=function(e){var t={};return t.definitionExpression=e.getDefinitionExpression(),t.drawingInfo={renderer:this.fromEsriRenderer(e.renderer)},t},e.prototype._getWebMapLayerDefinitionFromDynamicLayer=function(e,t){var i={},r=!1;if(e.layerDefinitions&&e.layerDefinitions[t]&&(r=!0,i.definitionExpression=e.layerDefinitions[t]),e.dynamicLayerInfos){var n=c.firstOrDefault(e.dynamicLayerInfos,function(e){return e.id===t});n&&(r=!0,i.minScale=n.minScale,i.maxScale=n.maxScale,i.source=n.source.toJson())}return e.layerDrawingOptions&&e.layerDrawingOptions[t]&&(r=!0,i.drawingInfo={renderer:this.fromEsriRenderer(e.layerDrawingOptions[t].renderer),fixedSymbols:!e.layerDrawingOptions[t].scaleSymbols}),r?i:null},e.prototype._applyWebMapServiceLayerToMapService=function(e,t){var i=this;return Promise["try"](function(){t.setOpacity(e.opacity),t.setVisibility(e.visibility);var r=t.serviceLayer,n=e;return r instanceof esri.layers.FeatureLayer&&(t.layers[0].setVisibility(e.visibility),n.layerDefinition&&n.layerDefinition.definitionExpression&&r.setDefinitionExpression(n.layerDefinition.definitionExpression)),i._isFeatureCollection(e)&&n.featureCollection.layers[0].layerDefinition?i._applyDrawingInfo(n.featureCollection.layers[0].layerDefinition.drawingInfo,t):n.layerDefinition?i._applyDrawingInfo(n.layerDefinition.drawingInfo,t):void 0})},e.prototype._applyWebMapLayersToGcxLayers=function(e,t){var i=this,r=e.layers||[],n=[];return r.forEach(function(e,r){var a=i._findOrCreateMatchingGcxLayer(e,t).then(function(t){return!!t&&i._applyWebMapLayerToGcxLayer(e,r,t)});n.push(a)}),Promise.all(n).then(function(e){return e.some(function(e){return e})})},e.prototype._applyWebMapLayerToGcxLayer=function(e,t,i){var r=this,n=i.mapService.serviceLayer;if(!(e.layerDefinition&&n instanceof esri.layers.ArcGISDynamicMapServiceLayer))return Promise.resolve(!1);var a=n;return this.app.waitUntilServiceLayerLoaded(n).then(function(){var t=parseInt(i.id),n=!1;if(e.layerDefinition.definitionExpression){var o=(a.layerDefinitions||[]).slice();o[t]=e.layerDefinition.definitionExpression,a.setLayerDefinitions(o,!0),n=!0}if(e.layerDefinition.drawingInfo){i.mapService.convertToDynamicLayers();var s=(a.layerDrawingOptions||[]).slice();if(s[t]=new esri.layers.LayerDrawingOptions,s[t].renderer=r.toEsriRenderer(e.layerDefinition.drawingInfo.renderer),s[t].scaleSymbols=!e.layerDefinition.drawingInfo.fixedSymbols,e.layerDefinition.drawingInfo.hasOwnProperty("showLabels")&&(s[t].showLabels=e.layerDefinition.drawingInfo.showLabels),e.layerDefinition.drawingInfo.hasOwnProperty("labelingInfo")&&e.layerDefinition.drawingInfo.labelingInfo){var l=e.layerDefinition.drawingInfo.labelingInfo;s[t].labelingInfo=s[t].labelingInfo||[],s[t].labelingInfo.length?s[t].labelingInfo[0]=new esri.layers.LabelClass(l[0]):s[t].labelingInfo.push(new esri.layers.LabelClass(l[0]));var u=l[0],d=u.symbol.color,p=u.symbol.haloColor;d&&s[t].labelingInfo[0].symbol.setColor(new esri.Color([d.r,d.g,d.b,d.a])),p&&s[t].labelingInfo[0].symbol.setHaloColor(new esri.Color([p.r,p.g,p.b,p.a]));var h=s[t].labelingInfo[0].symbol;s[t].labelingInfo[0].symbol.font.setSize(.75*h.font.size),s[t].labelingInfo[0].symbol.setHaloSize(.75*h.haloSize)}a.setLayerDrawingOptions(s,!0),n=!0}if(a.dynamicLayerInfos){var m=c.firstOrDefault(a.dynamicLayerInfos,function(e){return e.id===t});m&&(m.minScale=e.layerDefinition.minScale,m.maxScale=e.layerDefinition.maxScale,a.setDynamicLayerInfos(a.dynamicLayerInfos,!0),n=!0)}return n})},e.prototype._applyDrawingInfo=function(e,t){var i=this;if(!e)return Promise.resolve();var r=t.serviceLayer;return this.app.waitUntilServiceLayerLoaded(r).then(function(){if(!t.heatMap||!t.heatMap.userCanToggle||t.isUserCreated&&t.heatMap.enabled||i.app.command("RemoveHeatMap").execute({gcxLayer:t.layers[0]}),e.renderer)if(t.heatMap&&t.heatMap.userCanToggle&&e.renderer.type===l.RendererType.HEATMAP){var n=e.renderer;if(n){var a=t.heatMap;a.intensity=n.blurRadius,a.field=n.field,a.gradient=[],a.offset=[],(n.colorStops||[]).forEach(function(e,t){a.gradient[t]=e.color,a.offset[t]=e.ratio}),i.app.command("AddHeatMap").execute({gcxLayer:t.layers[0]})}}else r instanceof esri.layers.GraphicsLayer&&i._setGraphicsLayerRenderer(r,i.toEsriRenderer(e.renderer))})},e.prototype._setGraphicsLayerRenderer=function(e,t){e.setRenderer(t),e.redraw()},e.prototype._findMatchingGcxMapService=function(e){var t=this.app.site.essentialsMap.findMapServiceById(e.id);return t=t||c.firstOrDefault(this.app.site.essentialsMap.mapServices,function(t){return t.serviceUrl===e.url})},e.prototype._findMatchingGcxLayer=function(e,t){var i="object"==typeof e?e:null,r=null;i&&(r=t.findLayerOrTableByName(i.name));var n=i?i.id.toString():e.toString();r=r||t.findLayerOrTableById(n),r=r||c.firstOrDefault(t.layers,function(e){return e.wmsLayerName===n});var a=void 0;return!r&&i&&i.layerDefinition&&i.layerDefinition.source&&"mapLayer"===i.layerDefinition.source.type&&(a=i.layerDefinition.source.mapLayerId),r||null===a||void 0===a||(r=t.findLayerById(a.toString())),r||t.layers.forEach(function(e){if(e.dynamicDefinition){var t=JSON.parse(e.dynamicDefinition);!t||!t.source||"mapLayerId"!==t.source.type||!t.source.mapLayerId&&0!==t.source.mapLayerId||t.source.mapLayerId.toString()!==n&&t.source.mapLayerId.toString()!==a||(r=e)}}),r},e.prototype._findOrCreateMatchingGcxLayer=function(e,t){var i=this._findMatchingGcxLayer(e,t);return!i&&this._canCreateGcxLayer(e,t)?this._createGcxLayer(e,t):Promise.resolve(i)},e.prototype._findOrCreateMatchingGcxMapService=function(e){var t=this._findMatchingGcxMapService(e);return!t&&this._canCreateGcxMapService(e)?this._createGcxMapService(e):Promise.resolve(t)},e.prototype._canCreateGcxLayer=function(e,t){return t.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer},e.prototype._createGcxLayer=function(e,t){if(!this._canCreateGcxLayer(e,t))return Promise.reject(new Error("WebMapConverter._createGcxLayer: Unsupported layer type."));var i={source:{type:"mapLayerId",mapLayerId:e.id}};e.layerDefinition&&e.layerDefinition.drawingInfo&&(i.drawingInfo=e.layerDefinition.drawingInfo);var r={id:e.id.toString(),name:e.name,displayName:e.title||e.name,isDynamic:!0,dynamicDefinition:JSON.stringify(i)},a=new n.Layer(t.url+"/layers/"+e.id.toString());return a.createFromDefinition(r),t.add(a),Promise.resolve(a)},e.prototype._canCreateGcxMapService=function(e){return this._isFeatureCollection(e)||this._isKmlLayer(e)||this._isLayerCatalogService(e)},e.prototype._createGcxMapService=function(e){var t=this,i=this._getMapServiceDefinition(e);if(this._isLayerCatalogService(e)){var r=e.gcxMapServiceDefinition.catalogId,n=e.layers.map(function(e){return e.gcxLayerDefinition.catalogId});return new Promise(function(i,a){var o=function(e){e&&i(e),a(new Error("WebMapConverter._createGcxMapService: Unsupported layer catalog id."))},s={mapServiceId:e.id,layerLookupIds:n,lookupId:r,callback:o,serviceLayer:e};t.app.waitUntilAllLibrariesLoaded().then(function(){t.app.command("LayerCatalogRestoreMapService").execute(s)})})}if(this._isFeatureCollection(e)){var a=e,o=a.featureCollection,s=o.layers[0],l=s.featureSet||{},c=l.features||[];l.features=[];var u={mapService:d.buildLocalFeatureLayerService(s,i),graphics:Promise.map(c,function(e){return t.toEsriGraphic(e)})};return Promise.props(u).then(function(e){var i=e.mapService,r=t._toEsriRenderer(s.layerDefinition.drawingInfo.renderer);return i.serviceLayer.setRenderer(r),e.graphics.forEach(function(e){i.serviceLayer.add(e)}),e.graphics.length&&(i.serviceLayer.fullExtent=esri.graphicsExtent(e.graphics)),t.app.site.essentialsMap.addMapService(i),i})}return this._isKmlLayer(e)?d.buildKmlService(e.url,i).then(function(e){return t.app.site.essentialsMap.addMapService(e),e}):Promise.reject(new Error("WebMapConverter._createGcxMapService: Unsupported service layer type."))},e.prototype._getMapServiceDefinition=function(e){return{id:e.id,displayName:e.title}},e.prototype._isFeatureCollection=function(e){var t=e;return t.featureCollection&&t.featureCollection.layers&&1===t.featureCollection.layers.length&&!!t.featureCollection.layers[0].featureSet},e.prototype._isKmlLayer=function(e){return e.type===u.OperationalLayerType.KML},e.prototype._isGraphicsLayer=function(e){return e.id&&e.id.startsWith(C)},e.prototype._isLayerCatalogService=function(e){var t=e;return t.gcxMapServiceDefinition&&t.gcxMapServiceDefinition.catalogId},e.prototype._addSourceType=function(e,i){return i[t.CONVERSION_TYPE_PROPERTY]=e,i},e.prototype._getWebMapLayerType=function(e){if(e instanceof esri.layers.FeatureLayer)return S.FeatureLayer;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer)return S.MapService;if(e instanceof esri.layers.ArcGISTiledMapServiceLayer)return S.TiledMapService;if(e instanceof esri.layers.ArcGISImageServiceLayer)return S.ImageService;if(e instanceof esri.virtualearth.VETiledLayer)switch(e.mapStyle.toLowerCase()){case esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL.toLowerCase():return S.BingAerial;case esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL_WITH_LABELS.toLowerCase():return S.BingHybrid;case esri.virtualearth.VETiledLayer.MAP_STYLE_ROAD.toLowerCase():return S.BingRoad}else{if(e instanceof esri.layers.WebTiledLayer)return e.url&&e.url.indexOf("tile.openstreetmap.org")>=0?S.OpenStreetMap:S.WebTiled;if(e instanceof esri.layers.KMLLayer)return S.KML;if(e instanceof esri.layers.WMSLayer)return S.WMS;if(e instanceof esri.layers.WMTSLayer)return S.WebTiled}},e.prototype._inferAttributeType=function(e,t){var i=c.firstOrDefault(e,function(e){return e.attributes&&!p.isNullOrUndefined(e.attributes[t])});if(!i)return h.EsriFieldTypes.esriFieldTypeString;var r=i.attributes[t];return"number"==typeof r?h.EsriFieldTypes.esriFieldTypeDouble:r instanceof Date?h.EsriFieldTypes.esriFieldTypeDate:h.EsriFieldTypes.esriFieldTypeString},e.prototype._setVisibleLayers=function(e,t){var i=this;if(!t.supportsLayerVisibility())return!1;var r=!1,n=[],a=e.visibleLayers||[],o=e.layers||[];return a.forEach(function(e){var r=void 0;if(o){var a=c.firstOrDefault(o,function(t){return t.id===e});a=a||c.firstOrDefault(o,function(t){return t.name===e}),a&&(r=i._findMatchingGcxLayer(a,t))}r||(r=i._findMatchingGcxLayer(e,t)),r&&n.push(r)}),t.layers.forEach(function(e){if(e.type!==m.LayerType.GROUP_LAYER){var t=n.indexOf(e)>=0;r=r||t!==e.isVisible(),e.setVisibility(t,!0)}}),r},e.prototype._toGcxMapService=function(e){var t=this,i=void 0,r=e;return Promise.all([this.app.waitUntilSiteInitialized(),this.app.waitUntilMapLoaded()]).then(function(){return t._findOrCreateMatchingGcxMapService(e)}).then(function(r){if(i=r,!i)throw new Error('No matching Essentials map service was found for service "{0}".'.format(e.id));return t._applyWebMapServiceLayerToMapService(e,i)}).then(function(){return t._applyWebMapLayersToGcxLayers(r,i)}).then(function(e){return e=t._setVisibleLayers(r,i)||e,e&&i.refresh(),i})},e.prototype._toGcxLayer=function(e,t){var i=this;if(!t)throw new Error('WebMapConverter.toGcxLayer: Parameter "serviceLayer" is required.');return this.toGcxMapService(t).then(function(r){var n=i._findMatchingGcxLayer(e,r);if(!n)throw new Error('No matching Essentials layer was found for layer "{0}" for service "{1}".'.format(e.id,t.id));return n})},e.prototype._toGcxFeatureSet=function(e){var t=this;return this.toEsriFeatureSet(e).then(function(e){return new a.FeatureSet({app:t.app,esriFeatureSet:e})})},e.prototype._toEsriLayer=function(e){if(this._isGraphicsLayer(e))return this._toEsriGraphicsLayer(e);if(e.layerType===S.FeatureLayer)return this._toEsriFeatureLayer(e);throw new Error("WebMapConverter.toEsriLayer: Unsupported layer type.")},e.prototype._toEsriGraphicsLayer=function(e){var t=this,i=e.id.slice(C.length),r=this.app.map.getLayer(i);return!r||r instanceof esri.layers.GraphicsLayer?Promise.all([this.app.waitUntilSiteInitialized(),this.app.waitUntilMapLoaded()]).then(function(){var n=r;n||(n=new esri.layers.GraphicsLayer({id:i}),t.app.map.addLayer(n)),n.setVisibility(e.visibility),n.setOpacity(e.opacity),n.clear();var a=[],o=e.featureCollection||{},s=o.layers||[];return s.forEach(function(e){var i=e.featureSet||{},r=i.features||[];if(r.forEach(function(e){e.attributes&&(a[e.attributes[I]]=t.toEsriGraphic(e))}),!n.renderer&&e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer){var o=e.layerDefinition.drawingInfo.renderer;o.uniqueValueInfos&&o.uniqueValueInfos[0]&&JSON.stringify(o.uniqueValueInfos[0].symbol)===JSON.stringify(M)||n.setRenderer(t.toEsriRenderer(o))}}),Promise.all(a).then(function(e){return e.forEach(function(e){e&&n.add(e)}),n})}):Promise.resolve(r)},e.prototype._toEsriFeatureLayer=function(e){var t=this;if(e.url){var i=new esri.layers.FeatureLayer(e.url);return i.setVisibility(e.visibility),i.setOpacity(e.opacity),this.app.waitUntilServiceLayerLoaded(i)["return"](i)}if(this._isFeatureCollection(e)){var r=new esri.layers.FeatureLayer(e.featureCollection.layers[0]);r.setVisibility(e.visibility),r.setOpacity(e.opacity),r.clear();var n=e.featureCollection.layers[0].featureSet||{},a=n.features||[];return Promise.map(a,function(e){return t.toEsriGraphic(e).then(function(e){return r.add(e)})})["return"](r)}throw new Error("WebMapConverter.toEsriLayer: Unsupported layer type.")},e.prototype._toEsriFeatureSet=function(e){var t=this,i=e.features||[];return f.PromiseUtils.mapSkipRejected(i,function(e){return t.toEsriGraphic(e)}).then(function(e){var t=new esri.tasks.FeatureSet;return t.features=e,t})},e.prototype._toGcxFeature=function(e){return this.toEsriGraphic(e).then(function(e){return new o.Feature({graphic:e})})},e.prototype._toEsriGraphic=function(e){var t=this;return this.toObject(e.attributes).then(function(i){var r,n=t.toEsriGeometry(e.geometry),a=!0;i&&(r=i[w],delete i[w],i.hasOwnProperty(_)&&(a=i[_],delete i[_]),delete i[I]);var o=new esri.Graphic(n,r,i,null);return o.visible=a,o})},e.prototype._toEsriGeometry=function(e){if(e.hasOwnProperty("x")&&e.hasOwnProperty("y"))return new esri.geometry.Point(e);if(e.hasOwnProperty("points"))return new esri.geometry.Multipoint(e);if(e.hasOwnProperty("paths"))return new esri.geometry.Polyline(e);if(e.hasOwnProperty("rings"))return new esri.geometry.Polygon(e);if(e.hasOwnProperty("xmin")&&e.hasOwnProperty("xmax")&&e.hasOwnProperty("ymin")&&e.hasOwnProperty("ymax"))return new esri.geometry.Extent(e);throw new Error("WebMapConverter.toEsriGeometry: Unrecognized type of geometry object.")},e.prototype._toEsriSymbol=function(e){switch(e.type){case i.SymbolType.SIMPLE_MARKER:var t=new esri.symbol.SimpleMarkerSymbol(e);return e.size!==t.size&&(t.size=e.size),t;case i.SymbolType.SIMPLE_LINE:return new esri.symbol.SimpleLineSymbol(e);case i.SymbolType.SIMPLE_FILL:return new esri.symbol.SimpleFillSymbol(e);case i.SymbolType.PICTURE_MARKER:return new esri.symbol.PictureMarkerSymbol(e);case i.SymbolType.PICTURE_FILL:return new esri.symbol.PictureFillSymbol(e);case i.SymbolType.TEXT:return new esri.symbol.TextSymbol(e);default:throw new Error('WebMapConverter.toEsriSymbol: Unsupported symbol type "{0}".'.format(e.type))}},e.prototype._toEsriRenderer=function(e){var t=this;switch(e.type){case l.RendererType.SIMPLE:var i=new esri.renderer.SimpleRenderer(dojo.clone(e));return i.symbol=this.toEsriSymbol(e.symbol),i;case l.RendererType.UNIQUE_VALUE:var r=new esri.renderer.UniqueValueRenderer(dojo.clone(e));return r.defaultSymbol=this.toEsriSymbol(e.defaultSymbol),r.infos.forEach(function(i,r){i.symbol=t.toEsriSymbol(e.uniqueValueInfos[r].symbol)}),r;case l.RendererType.CLASS_BREAKS:var n=new esri.renderer.ClassBreaksRenderer(dojo.clone(e));return n.defaultSymbol=this.toEsriSymbol(e.defaultSymbol),n.infos.forEach(function(i,r){i.symbol=t.toEsriSymbol(e.classBreakInfos[r].symbol)}),n;case l.RendererType.HEATMAP:var a=new esri.renderer.HeatmapRenderer(dojo.clone(e));if(e.colorStops){var o=[];e.colorStops.forEach(function(e,i){var r=dojo.clone(e);r.color=t.toEsriColor(r.color),o.push(r)})}return a.setColorStops(o),a;default:throw new Error('WebMapConverter.toEsriRenderer: Unsupported renderer type "{0}".'.format(e.type))}},e.prototype._toEsriSpatialReference=function(e){return new esri.SpatialReference(e)},e.prototype._toEsriColor=function(e){return e.constructor===Array&&4===e.length&&(e[3]=e[3]/255),new esri.Color(e)},e.prototype._toObject=function(e){var i=this;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||e instanceof Date||null===e||void 0===e)return Promise.resolve(e);if(e.hasOwnProperty(t.CONVERSION_TYPE_PROPERTY)){var r=e[t.CONVERSION_TYPE_PROPERTY];switch(r){case E.GCX_MAP_SERVICE:return this.toGcxMapService(e);case E.GCX_LAYER:return this.toGcxLayer(e,null);case E.GCX_FEATURE_SET:return this.toGcxFeatureSet(e);case E.GCX_FEATURE:return this.toGcxFeature(e);case E.ESRI_LAYER:return this.toEsriLayer(e);case E.ESRI_FEATURE_SET:return this.toEsriFeatureSet(e);case E.ESRI_GRAPHIC:return this.toEsriGraphic(e);case E.ESRI_GEOMETRY:return Promise.resolve(this.toEsriGeometry(e));case E.ESRI_SYMBOL:return Promise.resolve(this.toEsriSymbol(e));case E.ESRI_RENDERER:return Promise.resolve(this.toEsriRenderer(e));case E.ESRI_SPATIAL_REFERENCE:return Promise.resolve(this.toEsriSpatialReference(e))}}var n={},a=[];return Object.keys(e).forEach(function(t){a.push(i.toObject(e[t]).then(function(e){n[t]=e}))}),Promise.all(a)["return"](n)},e.prototype._fromGcxMapService=function(e){var t=this,i=e.serviceLayer,r={id:e.id,url:e.serviceUrl,opacity:e.opacity,visibility:e.isVisible(),layerType:this._getWebMapLayerType(i)};if(e.mapServiceFunction===g.MapServiceFunction.OPERATIONAL){var n=r;if(n.title=e.displayName,n.minScale=e.minScale===1/0?0:e.minScale,n.maxScale=e.maxScale,i instanceof esri.layers.ArcGISDynamicMapServiceLayer){n.capabilities=i.capabilities,n.visibleLayers=i.visibleLayers.map(function(e){return parseInt(e)});var a=e.layers;i.dynamicLayerInfos&&(a=[],i.dynamicLayerInfos.forEach(function(t,i){var r=e.findLayerById(t.id.toString());r&&a.push(r)})),n.layers=a.map(function(e){return t.fromGcxLayer(e)})}else i instanceof esri.layers.WMSLayer?(n.visibleLayers=i.visibleLayers,n.type=u.OperationalLayerType.WMS):i instanceof esri.layers.KMLLayer?n.type=u.OperationalLayerType.KML:i instanceof esri.layers.FeatureLayer&&(n.layerDefinition=this._getWebMapLayerDefinitionFromFeatureLayer(i),n.capabilities=i.capabilities,e.isUserCreated&&i.graphics&&i.graphics.length&&(n.featureCollection=this._esriFeatureLayerToFeatureCollection(i),n.featureCollection.showLegend=e.layers[0].includeInLegend));i instanceof esri.layers.GraphicsLayer&&i.renderer instanceof esri.renderer.HeatmapRenderer&&!n.featureCollection&&(n.layerDefinition=n.layerDefinition||{},n.layerDefinition.drawingInfo={renderer:this.fromEsriRenderer(i.renderer)})}else{var o=r;if(i instanceof esri.virtualearth.VETiledLayer)o.type=r.layerType,delete r.url;else if(i instanceof esri.layers.WebTiledLayer)o.type=r.layerType,o.templateUrl=i.url,delete r.url;else if(i instanceof esri.layers.WMTSLayer){if(o.type=y.BaseMapType.WEB_TILED,!e.tileRestUrl)throw new Error('WebMapConverter.fromGcxMapService: WMTS layers are only supported if the "tileRestUrl" property is set.');e.tileRestUrl&&!i.resourceUrls&&(i.resourceUrls=[{template:e.tileRestUrl}]),o.templateUrl=i._getTileUrlTemplate(),delete r.url}}return r},e.prototype._esriFeatureLayerToFeatureCollection=function(e){var t=e.toJson(),i=t.layerDefinition||{};return{layers:[{featureSet:{geometryType:e.geometryType,features:e.graphics.map(this.fromEsriGraphic,this)},layerDefinition:{displayField:i.displayField,fields:i.fields,geometryType:i.geometryType,hasAttachments:i.hasAttachments,minScale:i.minScale,maxScale:i.maxScale,name:i.name,objectIdField:i.objectIdField,templates:i.templates,type:i.type,typeIdField:i.typeIdField,types:i.types,drawingInfo:{renderer:this.fromEsriRenderer(e.renderer)}}}],showLegend:!0}},e.prototype._fromGcxlayer=function(e){var t={name:e.wmsLayerName,title:e.displayName,layerUrl:e.getLayerUrl(),legendUrl:e.legendUrl},i=parseInt(e.id);isNaN(i)||void 0===i||(t.id=i);var r=e.mapService.serviceLayer;if(r instanceof esri.layers.ArcGISDynamicMapServiceLayer){var n=this._getWebMapLayerDefinitionFromDynamicLayer(r,i);n&&(t.layerDefinition=n)}return t},e.prototype._fromGcxFeatureSet=function(e){var t,i=e.esriFeatureSet;if(i)t=s.GeometryType.fromEsriGeometryType(i.geometryType),!t&&i.features&&i.features.length>0&&i.features[0].geometry&&(t=s.GeometryType.fromEsriGeometryType(i.features[0].geometry.type));else if(e.features.length){var r=e.features.getAt(0);r.hasGeometry.get()&&(t=s.GeometryType.fromEsriGeometryType(r.esriFeature.get().geometry.type))}return{features:e.features.get().map(this.fromGcxFeature,this),geometryType:t||s.GeometryType.POINT}},e.prototype._fromEsriLayer=function(e){if(e instanceof esri.layers.FeatureLayer)return this._fromEsriFeatureLayer(e);if(e instanceof esri.layers.GraphicsLayer)return this._fromEsriGraphicsLayer(e);throw new Error("WebMapConverter.fromEsriLayer: Unsupported layer type.")},e.prototype._fromEsriGraphicsLayer=function(e){var t=this,i={id:C+e.id,title:e.id,visibility:e.visible,opacity:e.opacity,minScale:e.minScale,maxScale:e.maxScale},r={};e.graphics.forEach(function(i,n){var a=i.geometry.type,o=r[a];o||(o={featureSet:{features:[],geometryType:s.GeometryType.fromEsriGeometryType(a)},layerDefinition:{geometryType:s.GeometryType.fromEsriGeometryType(a),objectIdField:I,name:t.app.getResource(v,"language-webmap-layer-name-"+a),fields:[{name:I,alias:"OBJECTID",type:h.EsriFieldTypes.esriFieldTypeOID,editable:!1,nullable:!1},{name:_,alias:t.app.getResource(v,"language-webmap-field-name-visible"),type:h.EsriFieldTypes.esriFieldTypeInteger,editable:!0,nullable:!1}],drawingInfo:{renderer:e.renderer?t.fromEsriRenderer(e.renderer):{type:l.RendererType.UNIQUE_VALUE,field1:x,uniqueValueInfos:[{value:F,symbol:M}]}}}},r[i.geometry.type]=o);var u=t.fromEsriGraphic(i);if(u.attributes=u.attributes||{},u.attributes[I]=n,Object.keys(u.attributes).forEach(function(i){if(i!==x&&i!==w){var r=function(e){return c.firstOrDefault(o.layerDefinition.fields,function(t){return t.name===e})}(i);if(!r){var n=t._inferAttributeType(e.graphics,i);r={name:i,alias:i,type:n,nullable:!0,editable:!0},o.layerDefinition.fields.push(r)}}}),!e.renderer){var d=o.layerDefinition.drawingInfo.renderer,p=u.attributes[x];p&&!c.firstOrDefault(d.uniqueValueInfos,function(e){return e.value===p})&&d.uniqueValueInfos.push({value:p,symbol:u.attributes[w]})}o.featureSet.features.push(u)}),i.featureCollection={layers:[],showLegend:!1};for(var n=0,a=Object.keys(r);n<a.length;n++){var o=a[n];i.featureCollection.layers.push(r[o])}return i},e.prototype._fromEsriFeatureLayer=function(e){var t={id:e.id,title:e.id,visibility:e.visible,opacity:e.opacity,minScale:e.minScale,maxScale:e.maxScale,layerType:S.FeatureLayer};return e.url?t.url=e.url:t.featureCollection=this._esriFeatureLayerToFeatureCollection(e),t},e.prototype._fromEsriFeatureSet=function(e){return{features:e.features.map(this.fromEsriGraphic,this),geometryType:s.GeometryType.fromEsriGeometryType(e.geometryType)}},e.prototype._fromGcxFeature=function(e){var t=this,i={};return e.attributes.get().forEach(function(e){i[e.name.get()]=t.fromObject(e.value.get())}),{attributes:i,geometry:this.fromEsriGeometry(e.esriFeature.get().geometry)}},e.prototype._fromEsriGraphic=function(e){var t={attributes:this.fromObject(e.attributes)||{},geometry:this.fromEsriGeometry(e.geometry)};return t.attributes[_]=e.visible?1:0,e.symbol&&(t.attributes[w]=this._addSourceType(E.ESRI_SYMBOL,this.fromEsriSymbol(e.symbol)),e.symbol[L]||(e.symbol[L]=this._nextSymbolId++),t.attributes[x]=e.visible?e.symbol[L]:F),t},e.prototype._fromEsriGeometry=function(e){var t={spatialReference:this.fromEsriSpatialReference(e.spatialReference)};switch(e.type){case"point":t.x=e.x,t.y=e.y;break;case"multipoint":t.points=e.points;case"polyline":t.paths=e.paths;break;case"polygon":t.rings=e.rings;break;case"extent":t.xmin=e.xmin,t.xmax=e.xmax,t.ymin=e.ymin,t.ymax=e.ymax}return t},e.prototype._fromEsriSymbol=function(e){var t=e.toJson();return e.size!==t.size&&(t.size=e.size),t},e.prototype._fromEsriRenderer=function(e){var t=this,i=e.toJson();return e instanceof esri.renderer.SimpleRenderer?i.symbol=this.fromEsriSymbol(e.symbol):e instanceof esri.renderer.UniqueValueRenderer?(i.defaultSymbol=this.fromEsriSymbol(e.defaultSymbol),i.uniqueValueInfos.forEach(function(i,r){i.symbol=t.fromEsriSymbol(e.infos[r].symbol)})):e instanceof esri.renderer.ClassBreaksRenderer&&(i.defaultSymbol=this.fromEsriSymbol(e.defaultSymbol),i.classBreakInfos.forEach(function(i,r){i.symbol=t.fromEsriSymbol(e.infos[r].symbol)})),i},e.prototype._fromEsriSpatialReference=function(e){return e.toJson()},e.prototype._fromEsriColor=function(e){return e.toRgba()},e.prototype._fromObject=function(e){if(e instanceof r.MapService)return this._addSourceType(E.GCX_MAP_SERVICE,this.fromGcxMapService(e));if(e instanceof n.Layer)return this._addSourceType(E.GCX_LAYER,this.fromGcxLayer(e));if(e instanceof a.FeatureSet)return this._addSourceType(E.GCX_FEATURE_SET,this.fromGcxFeatureSet(e));if(e instanceof o.Feature)return this._addSourceType(E.GCX_FEATURE,this.fromGcxFeature(e));if(e instanceof esri.layers.Layer)return this._addSourceType(E.ESRI_LAYER,this.fromEsriLayer(e));if(e instanceof esri.tasks.FeatureSet)return this._addSourceType(E.ESRI_FEATURE_SET,this.fromEsriFeatureSet(e));if(e instanceof esri.Graphic)return this._addSourceType(E.ESRI_GRAPHIC,this.fromEsriGraphic(e));
if(e instanceof esri.geometry.Geometry)return this._addSourceType(E.ESRI_GEOMETRY,this.fromEsriGeometry(e));if(e instanceof esri.symbol.Symbol)return this._addSourceType(E.ESRI_SYMBOL,this.fromEsriSymbol(e));if(e instanceof esri.renderer.Renderer)return this._addSourceType(E.ESRI_RENDERER,this.fromEsriRenderer(e));if(e instanceof esri.SpatialReference)return this._addSourceType(E.ESRI_SPATIAL_REFERENCE,this.fromEsriSpatialReference(e));var t={};for(var i in e)e.hasOwnProperty(i)&&"function"!=typeof e[i]&&i!==L&&(t[i]=this.fromObject(e[i]));return t},e}();t.WebMapConverter=T})},"geocortex/infrastructure/project/FeatureSetCollection":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/ProjectConverter":function(){define(["require","exports","geocortex/infrastructure/webMap/WebMapConverter","geocortex/essentials/Layer","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature","geocortex/infrastructure/LayerIntegrationUtils","geocortex/essentials/LayerStyle","geocortex/infrastructure/PromiseUtils","geocortex/infrastructure/KmlFeature","geocortex/infrastructure/DateFormat","geocortex/infrastructure/NumberFormat","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/coordinates/CoordinatesManager","geocortex/framework/utils/utils","geocortex/infrastructure/webMap/BaseMapLayer","geocortex/infrastructure/ArrayUtils","geocortex/essentials/utilities/ServiceDiscoveryUtilities","geocortex/infrastructure/webMap/WebMapConverter","geocortex/infrastructure/webMap/Renderer"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m,f,g,y,b,v,S,_){"use strict";t.PROPERTY_MEASUREMENT_ID="measurementId",t.PROPERTY_HIGHLIGHT_ID="__gcxHlId";var I=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._exclusionCache={},t}return __extends(i,e),i.prototype.exclude=function(e,t){var i=this._exclusionCache[t];i||(i=this._exclusionCache[t]=[]),i.push(e)},i.prototype.clearExclusionCache=function(){this._exclusionCache={}},i.prototype.clearCache=function(){e.prototype.clearCache.call(this),this.clearExclusionCache()},i.prototype.fromGcxMapService=function(t){return e.prototype.fromGcxMapService.call(this,t)},i.prototype.fromGcxLayer=function(t){return e.prototype.fromGcxLayer.call(this,t)},i.prototype.fromGcxFeatureSetCollection=function(e){return this._convert(e,"projectFeatureSetCollection",this._fromGcxFeatureSetCollection)},i.prototype.fromGcxFeatureSet=function(t){return e.prototype.fromGcxFeatureSet.call(this,t)},i.prototype.fromEsriFeatureSet=function(t){return e.prototype.fromEsriFeatureSet.call(this,t)},i.prototype.fromEsriLayer=function(t){return e.prototype.fromEsriLayer.call(this,t)},i.prototype.fromGcxFeature=function(t){return e.prototype.fromGcxFeature.call(this,t)},i.prototype.fromEsriGraphic=function(t){return e.prototype.fromEsriGraphic.call(this,t)},i.prototype.toGcxFeatureSetCollection=function(e){return Promise.resolve(this._convert(e,"gcxFeatureSetCollection",this._toGcxFeatureSetCollection))},i.prototype._canCreateGcxLayer=function(e,t){return!!e.gcxLayerDefinition},i.prototype._canCreateGcxMapService=function(e){return!!e.gcxMapServiceDefinition},i.prototype._createGcxMapService=function(t){var i=this;return Promise["try"](function(){if(e.prototype._canCreateGcxMapService.call(i,t))return e.prototype._createGcxMapService.call(i,t);var r=i._getMapServiceDefinition(t);if(r){var n=t;return r.layers=n.layers.map(function(e){return e.gcxLayerDefinition}).filter(function(e){return null!=e}),v.ServiceDiscoveryUtilities.buildMapService(i.app.site.essentialsMap,r).then(function(e){return i.app.site.essentialsMap.addMapService(e),e})}return Promise.reject(new Error("ProjectConverter._createGcxMapService: Unsupported service layer type."))}).then(function(e){if(e instanceof s.LocalFeatureLayerService){var i=t;i.layers&&i.layers[0]&&i.layers[0].gcxLayerDefinition&&e.layers[0].createFromDefinition(i.layers[0].gcxLayerDefinition)}return e})},i.prototype._createGcxLayer=function(e,t){var i=this,n=e.gcxLayerDefinition;if(n&&n.catalogId)return new Promise(function(e,r){var a=function(t){t&&e(t),r(new Error("ProjectConverter._createGcxLayer: Unsupported layer catalog id."))},o={catalogId:n.catalogId,callback:a,gcxLayerDefinition:n,mapService:t};i.app.waitUntilAllLibrariesLoaded().then(function(){i.app.command("RestoreDynamicLayer").execute(o)})});var a=new r.Layer(n.url);return a.createFromDefinition(n),t.add(a),a.isUserCreated=!0,Promise.resolve(a)},i.prototype._getMapServiceDefinition=function(e){return e.gcxMapServiceDefinition},i.prototype._getWebMapLayerDefinitionFromDynamicLayer=function(t,i){var r=e.prototype._getWebMapLayerDefinitionFromDynamicLayer.call(this,t,i);return t.layerDrawingOptions&&t.layerDrawingOptions[i]&&(r.drawingInfo.showLabels=t.layerDrawingOptions[i].showLabels,r.drawingInfo.labelingInfo=t.layerDrawingOptions[i].labelingInfo),r},i.prototype._applyDynamicLayerInfo=function(e,t,i){var r=i.mapService.serviceLayer,n=parseInt(i.id);i.mapService.convertToDynamicLayers();var a=r.dynamicLayerInfos||[],o=a.filter(function(e){return e.id===n})[0];if(o){var s=a.indexOf(o);s!=t&&a.splice(t,0,a.splice(s,1)[0])}else o=new esri.layers.DynamicLayerInfo,o.id=n,o.name=e.name,e.layerDefinition&&(o.minScale=e.layerDefinition.minScale,o.maxScale=e.layerDefinition.maxScale),a.splice(t,0,o);r.setDynamicLayerInfos(a)},i.prototype._applyDrawingInfo=function(t,i){var r=this;return t?e.prototype._applyDrawingInfo.call(this,t,i).then(function(){var e=t.clustering&&(t.clustering.enabled||"undefined"==typeof t.clustering.enabled);if(r.app.command("RemoveClusterLayer").execute({gcxLayer:i.layers[0]}),i.featureClustering&&i.featureClustering.userCanToggle&&t.clustering&&(i.featureClustering.radius=t.clustering.radius,i.featureClustering.backgroundColor=t.clustering.backgroundColor,i.featureClustering.labelColor=t.clustering.labelColor,i.featureClustering.maximumFeatures=t.clustering.maximumFeatures),e)r.app.command("AddClusterLayer").execute({gcxLayer:i.layers[0]});else if(!(i.heatMap&&i.heatMap.userCanToggle&&t.renderer&&t.renderer.type===_.RendererType.HEATMAP)){var n=i.serviceLayer;n.setRenderer(r.toEsriRenderer(t.renderer)),n.redraw()}}):Promise.resolve()},i.prototype._setGraphicsLayerRenderer=function(e,t){},i.prototype._applyWebMapLayerToGcxLayer=function(t,i,r){var n=this;return e.prototype._applyWebMapLayerToGcxLayer.call(this,t,i,r).then(function(e){for(var a=r.mapService.serviceLayer,o=t,s=0,c=r.styles;s<c.length;s++){var u=c[s];u.enabled=!1}if(o.layerStyleId){var u=r.styles.filter(function(e){return e.id===o.layerStyleId})[0],d=void 0;if(a instanceof esri.layers.ArcGISDynamicMapServiceLayer)d=JSON.stringify(n.toEsriRenderer(o.layerDefinition.drawingInfo.renderer).toJson());else if(a instanceof esri.layers.FeatureLayer){var p=o.serviceLayer;d=JSON.stringify(n.toEsriRenderer(p.layerDefinition.drawingInfo.renderer).toJson())}u?(d&&u.setRenderer(d),u.enabled=!0):d&&r.styles.push(new l.LayerStyle(d,o.layerStyleId,o.layerStyleId,(!0)))}return o.isDynamic&&a instanceof esri.layers.ArcGISDynamicMapServiceLayer?n.app.waitUntilServiceLayerLoaded(a).then(function(){return n._applyDynamicLayerInfo(o,i,r),e}):e})},i.prototype._toGcxLayer=function(t,i){var r=t;return i||(i=r.serviceLayer),e.prototype._toGcxLayer.call(this,t,i)},i.prototype._toGcxFeatureSetCollection=function(e){var t=this,i=this.app.featureSetManager.featureSetCollections.get().filter(function(t){return t.id===e.id})[0];i||(i=new n.FeatureSetCollection,i.id=e.id,this.app.featureSetManager.addCollection(i)),i.displayName.set(e.displayName),i.sourceName=e.sourceName;var r='feature set collection "{0}"'.format(e.id),a=function(e){return c.PromiseUtils.warnOnReject(t.toGcxFeatureSet(e),t.app,'Unable to restore feature set "{0}" for {1}: {{0}}'.format(e.id,r))};return c.PromiseUtils.mapSkipRejected(e.featureSets,a).then(function(e){i.clear(),i.featureSets.addItems(e)}).then(function(){return c.PromiseUtils.warnOnReject(t.toObject(e.tag),t.app,"Unable to restore tag for {0}: {{0}}".format(r))}).then(function(e){i.tag=e}).then(function(){return t._toGcxExtendedProperties(e.extendedProperties,r)}).then(function(e){i.extendedProperties.addItems(e)}).then(function(){return i})},i.prototype._toGcxFeatureSet=function(e){var t,i=this,r=e.layer,n=r?r.serviceLayer:null,o=e.features||[],s={gcxLayer:this.toGcxLayer(r,n),esriFeatureSet:this.toEsriFeatureSet(e),extendedProperties:this._toGcxExtendedProperties(e.extendedProperties,"feature set")};return Promise.props(s).then(function(n){t=new a.FeatureSet({app:i.app,layer:n.gcxLayer,esriFeatureSet:n.esriFeatureSet,allowUnsafeContent:i.app.configuration&&i.app.configuration.allowUnsafeContent&&e.allowUnsafeContent}),r||(t.loadAttributes(),t.displayName.set(e.displayName),t.iconUri.set(e.iconUri)),t.id=e.id,t.extendedProperties.addItems(n.extendedProperties)}).then(function(){return c.PromiseUtils.mapSkipRejected(o,function(e){return i._findMatchingGcxFeature(e,t).then(function(t){return i._applyFeatureToGcxFeature(e,t)})})}).then(function(){i.app.waitUntilAllLibrariesLoaded().then(function(){t.dataLinksState===a.DataLinksState.Unresolved&&t.resolveDataLinks(function(e){i.app.event("FeatureChangedEvent").publish(e)})})}).then(function(){return t})},i.prototype._toGcxFeature=function(e){var t=this;return e.featureSet?this.toGcxFeatureSet(e.featureSet).then(function(i){return t._findMatchingGcxFeature(e,i)}).then(function(t){if(!t)throw new Error('Unable to restore feature with ID "{0}": feature no longer exists.'.format(e.id));return t}):this._createGcxFeature(e)},i.prototype._createGcxFeature=function(e){var t=this,i=e.layer,r=i?i.serviceLayer:null,n={gcxLayer:this.toGcxLayer(i,r),featureLayer:i?null:this.toEsriLayer(e.featureLayer),graphic:this.toEsriGraphic(e),extendedProperties:this._toGcxExtendedProperties(e.extendedProperties,"feature")};return Promise.props(n).then(function(i){var r={layer:i.gcxLayer,featureLayer:i.featureLayer,graphic:i.graphic,allowUnsafeContent:t.app.configuration&&t.app.configuration.allowUnsafeContent&&e.allowUnsafeContent},n=e[u.isKmlProperty]?new u.KmlFeature(r):new o.Feature(r);return n.defaultDateFormat=e.defaultDateFormat||d.DateFormat.DEFAULT,n.defaultNumberFormat=e.defaultNumberFormat||p.NumberFormat.DEFAULT,n.timeZoneId=e.timeZoneId,n.displayTimeZoneId=e.displayTimeZoneId,n.borderColor.set(e.borderColor),n.fillColor.set(e.fillColor),n.borderWidth.set(e.borderWidth),n.extendedProperties.addItems(i.extendedProperties),n})},i.prototype._applyFeatureToGcxFeature=function(e,t){return e&&t?(t.defaultDateFormat=e.defaultDateFormat||d.DateFormat.DEFAULT,t.defaultNumberFormat=e.defaultNumberFormat||p.NumberFormat.DEFAULT,t.timeZoneId=e.timeZoneId,this._toGcxExtendedProperties(e.extendedProperties,"feature").then(function(e){return t.extendedProperties.addItems(e)})):Promise.resolve()},i.prototype._findMatchingGcxFeature=function(e,t){return e.id?Promise.resolve(t.findFeatureById(e.id)):this.toEsriGraphic(e).then(function(e){return h.firstOrDefault(t.features.get(),function(t){return t.esriFeature.get()===e})})},i.prototype._queryFeatures=function(e,t){var i=this;return e&&e.length&&t&&t.layer?Promise["try"](function(){for(var r=1e3,n=e.map(function(e){return e.id}),a=[];n.length>r;)a.push(n.splice(0,r));a.push(n);var o=t.layer,s=o?o.serviceLayer:null;return i.toGcxLayer(o,s).then(function(e){if(!e||!e.getObjectIdFieldName())throw new Error('Cannot restore features for layer "{0}": no primary key field defined.'.format(e?e.name:""));var t=(e.getObjectIdFieldName(),m.getQueryTask(e));return c.PromiseUtils.mapSkipRejected(a,function(e){var i=new esri.tasks.Query;return i.objectIds=e.map(function(e){return parseInt(e)}),i.returnGeometry=!0,i.outFields=["*"],t.execute(i).then(function(e){return e.features})},{concurrency:2}).then(function(e){return h.flatten(e)})})}):Promise.resolve([])},i.prototype._toEsriGraphic=function(i){return e.prototype._toEsriGraphic.call(this,i).then(function(e){return i.hasOwnProperty(t.PROPERTY_MEASUREMENT_ID)&&(e[t.PROPERTY_MEASUREMENT_ID]=i[t.PROPERTY_MEASUREMENT_ID]),i.hasOwnProperty(f.coordinateIdentifierProperty)&&(e[f.coordinateIdentifierProperty]=i[f.coordinateIdentifierProperty]),i.hasOwnProperty(u.isKmlProperty)&&(e[u.isKmlProperty]=i[u.isKmlProperty]),i.hasOwnProperty(t.PROPERTY_HIGHLIGHT_ID)&&(e[t.PROPERTY_HIGHLIGHT_ID]=i[t.PROPERTY_HIGHLIGHT_ID]),e})},i.prototype._toEsriFeatureSet=function(e){var t=this,i=e.layer,r=i?i.serviceLayer:null,n=e.features||[],a=n.filter(function(e){return!g.isNullOrUndefined(e.id)}),o=n.filter(function(e){return g.isNullOrUndefined(e.id)}),s={gcxLayer:this.toGcxLayer(i,r),queryResults:this._queryFeatures(a,e),rehydratedGraphics:c.PromiseUtils.mapSkipRejected(o,function(e){return t.toEsriGraphic(e)})};return Promise.props(s).then(function(e){var t=e.queryResults.concat(e.rehydratedGraphics),i=new esri.tasks.FeatureSet;return i.features=t,i})},i.prototype._fromGcxMapService=function(t){var i=this,r=this._exclusionCache[S.ConversionType.GCX_MAP_SERVICE]||[];if(r.indexOf(t)>=0)throw new Error("ProjectConverter.fromGcxMapService: Services added through layer addition dialog are only supported if they have been whitelisted by your administrator.");var n;t.serviceLayer;if(n=t&&t.serviceLayer instanceof esri.layers.WMTSLayer&&!t.tileRestUrl?{id:t.id,url:t.serviceUrl,type:y.BaseMapType.WEB_TILED,opacity:t.opacity,visibility:t.isVisible(),layers:[]}:e.prototype._fromGcxMapService.call(this,t),t.isUserCreated&&(n.gcxMapServiceDefinition=t.toJson(),n.isUserCreated=t.isUserCreated,n.userLayerType=t.userLayerType),n.layers||(n.layers=b.ArrayUtils.mapWithErrorCallback(t.layers,function(e){return i.fromGcxLayer(e)},function(e,t){console.warn('Unable to convert layer "{0}": {1}'.format(e.id,t))})),t.featureClustering){var a=n,o=void 0;this._isFeatureCollection(n)?(a.featureCollection.layers[0].layerDefinition=a.featureCollection.layers[0].layerDefinition||{drawingInfo:{}},o=a.featureCollection.layers[0].layerDefinition):(a.layerDefinition=a.layerDefinition||{drawingInfo:{}},o=a.layerDefinition),o.drawingInfo=o.drawingInfo||{},o.drawingInfo.clustering={radius:t.featureClustering.radius,backgroundColor:t.featureClustering.backgroundColor,labelColor:t.featureClustering.labelColor,maximumFeatures:t.featureClustering.maximumFeatures,enabled:t.featureClustering.enabled};var s=this.app.map.getLayer(t.id+"-cluster");s&&(o.drawingInfo.renderer=this.fromEsriRenderer(s.featureLayerRenderer))}return n},i.prototype._fromGcxlayer=function(t){var i=this._exclusionCache[S.ConversionType.GCX_MAP_SERVICE]||[];if(i.indexOf(t.mapService)>=0)throw new Error("ProjectConverter.fromGcxLayer: Services added through layer addition dialog are only supported if they have been whitelisted by your administrator.");var r=e.prototype._fromGcxlayer.call(this,t);r.serviceLayer=this.fromGcxMapService(t.mapService);var n=t.mapService.serviceLayer;r.isDynamic=t.isDynamic,n instanceof esri.layers.ArcGISDynamicMapServiceLayer&&n.supportsDynamicLayers&&(r.isDynamic=r.isDynamic||n.dynamicLayerInfos&&!!n.dynamicLayerInfos[parseInt(t.id)]),t.isUserCreated&&(r.gcxLayerDefinition=t.toJson(),r.isUserCreated=t.isUserCreated,r.userLayerType=t.userLayerType);var a=t.styles.filter(function(e){return e.enabled})[0];return a&&(r.layerStyleId=a.id),r},i.prototype._fromGcxFeatureSetCollection=function(e){var t={id:e.id,displayName:e.displayName.get(),featureSets:e.featureSets.get().map(this.fromGcxFeatureSet,this),sourceName:e.sourceName,tag:this.fromObject(e.tag)};return e.extendedProperties.getLength()&&(t.extendedProperties=this._fromGcxExtendedProperties(e.extendedProperties)),t},i.prototype._fromGcxFeatureSet=function(t){var i=e.prototype._fromGcxFeatureSet.call(this,t);return i.id=t.id,i.layer=this.fromGcxLayer(t.layer),i.allowUnsafeContent=t._allowUnsafeContent,t.layer||(i.displayName=t.displayName.get(),i.iconUri=t.iconUri.get()),i},i.prototype._fromGcxFeature=function(t){var i={};this._canRequeryFeatureData(t)?i={id:t.id.get(),featureSet:this.fromGcxFeatureSet(t.featureSet)}:(i=e.prototype._fromGcxFeature.call(this,t),i.featureSet=this.fromGcxFeatureSet(t.featureSet)),i.featureSet||(i.layer=this.fromGcxLayer(t.layer)),t.featureLayer&&!t.layer&&(i.featureLayer=this.fromEsriLayer(t.featureLayer)),i.allowUnsafeContent=t._allowUnsafeContent,t.borderColor.get()&&(i.borderColor=t.borderColor.get()),t.fillColor.get()&&(i.fillColor=t.fillColor.get()),t.borderWidth.get()>=0&&(i.borderWidth=t.borderWidth.get()),t.extendedProperties.getLength()&&(i.extendedProperties=this._fromGcxExtendedProperties(t.extendedProperties)),t.defaultDateFormat!==d.DateFormat.DEFAULT&&(i.defaultDateFormat=t.defaultDateFormat),t.defaultNumberFormat!==p.NumberFormat.DEFAULT&&(i.defaultNumberFormat=t.defaultNumberFormat);var r=t.esriFeature.get();return r&&r.hasOwnProperty(u.isKmlProperty)&&(i[u.isKmlProperty]=r[u.isKmlProperty]),t.timeZoneId&&(i.timeZoneId=t.timeZoneId),t.displayTimeZoneId&&i.displayTimeZoneId,i},i.prototype._fromEsriGraphic=function(i){var r=e.prototype._fromEsriGraphic.call(this,i);return i.hasOwnProperty(t.PROPERTY_MEASUREMENT_ID)&&(r[t.PROPERTY_MEASUREMENT_ID]=i[t.PROPERTY_MEASUREMENT_ID]),i.hasOwnProperty(f.coordinateIdentifierProperty)&&(r[f.coordinateIdentifierProperty]=i[f.coordinateIdentifierProperty]),i.hasOwnProperty(u.isKmlProperty)&&(r[u.isKmlProperty]=i[u.isKmlProperty]),i.hasOwnProperty(t.PROPERTY_HIGHLIGHT_ID)&&(r[t.PROPERTY_HIGHLIGHT_ID]=i[t.PROPERTY_HIGHLIGHT_ID]),r},i.prototype._toGcxExtendedProperties=function(e,t){var i=this;return e=e||{},c.PromiseUtils.mapSkipRejected(Object.keys(e),function(r){var n=i.toObject(e[r]).then(function(e){return{name:r,value:e}});return c.PromiseUtils.warnOnReject(n,i.app,"Unable to restore extended property '{0}' for {1}: {{0}}".format(r,t))})},i.prototype._fromGcxExtendedProperties=function(e){var t=this,i={};return e.get().forEach(function(e){i[e.name]=t.fromObject(e.value)}),i},i.prototype._canRequeryFeatureData=function(e){return e&&!e.isModified&&!g.isNullOrUndefined(e.id.get())&&""!==e.id.get()&&e.featureSet&&e.featureSet.layer&&(e.featureSet.layer.getLayerUrl()&&e.featureSet.layer.supportsQuery||!String.isNullOrEmpty(e.featureSet.layer.catalogId))},i}(i.WebMapConverter);t.ProjectConverter=I})},"geocortex/infrastructure/validation/Validator":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/validation/NumberValidator":function(){define(["require","exports","geocortex/infrastructure/FormatUtils","geocortex/framework/utils/utils"],function(e,t,i,r){"use strict";var n=function(){function e(){}return e.prototype.validate=function(e,t){var n=t&&!!t.invalidNumbersAsNaN,a=i.parseNumber(e);return r.isNullOrUndefined(e)?Promise.resolve({validatedValue:e}):isNaN(a)&&!n?Promise.reject(new Error("Invalid number.")):Promise.resolve({validatedValue:a})},e}();t.NumberValidator=n})},"geocortex/infrastructure/UrlUtilities":function(){define(["require","exports","geocortex/infrastructure/Dictionary"],function(e,t,i){"use strict";function r(e){var t="";if(!e)return t;for(var i=e.keys(),r=0;r<i.length;r++)t.length>0&&(t+="&"),t+="{0}={1}".format(i[r],e.get(i[r]));return"{0}{1}".format(t.length>0?"?":"",t)}function n(e){var t=new i.Dictionary;return e?(e.startsWith("?")&&(e=e.slice(1)),e.split(/[&;]/g).forEach(function(e){if(e){var i=e.split("=",2);t.set(i[0],i[1])}}),t):t}function a(e){var t=document.createElement("a");return t.href=e,t}function o(e,t,i){var o=a(e),s=n(o.search);return s.set(t,i),o.search=r(s),o.toString()}function s(e,t){var i=a(e),o=n(i.search);return o.remove(t),i.search=r(o),i.toString()}function l(e){var t="string"==typeof e?a(e):dojo.clone(e),i=null==t.pathname?"":t.pathname;if(null==i)return t;var r=i.split("/"),n=r[r.length-1];return n.indexOf(".")>=0&&(r.pop(),t.pathname=r.join("/")),t.pathname.endsWith("/")||(t.pathname=t.pathname+"/"),t.search="",t.hash="",t.href=t.href.replace(/[\?#]+$/,""),t}function c(e){var t="string"==typeof e?a(e):dojo.clone(e),i=null==t.pathname?"":t.pathname;return null==i?t:(t.pathname.endsWith("/")||(t.pathname=t.pathname+"/"),t.search="",t.hash="",t.href=t.href.replace(/[\?#]+$/,""),t)}t.queryStringDictionaryToString=r,t.queryStringToDictionary=n,t.parseUrl=a,t.addQueryParameter=o,t.removeQueryParameter=s,t.getFolder=l,t.removeParameters=c})},"geocortex/infrastructure/validation/SiteUrlValidator":function(){define(["require","exports","geocortex/infrastructure/UrlUtilities","geocortex/essentials/RestHelper","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(){function e(e){if(!e)throw new Error('Argument "app" is required.');this.app=e,this._initializeAllowedUrls(),this.app.command("ClearTrustedUrls").register(this,this.executeClearTrustedUrls)}return e.prototype.executeClearTrustedUrls=function(){for(var e=Object.keys(window.localStorage),t=0;t<e.length;t++)e[t].match("^uri.markup|^uri.css|^uri.navigablelink")&&window.localStorage.removeItem(e[t])},e.prototype.validate=function(e,t){var n=this;return e?"string"!=typeof e?Promise.reject(new Error("Input is not a URL.")):this._initializeAllowedUrls().then(function(){var t=i.parseUrl(r.RestHelper.processClientSideTokens(n.app.site,e));if(n._allowedUrls.some(function(e){return n._isMatch(e,t)}))return Promise.resolve({validatedValue:e});var a="The following URL is not defined by this Essentials site and will be skipped: {0}".format(e);return Promise.reject(a)}):Promise.resolve({validatedValue:e})},e.prototype.tryValidateSynchronously=function(e){var t=this;if(!this._allowedUrls)return!1;var n=i.parseUrl(r.RestHelper.processClientSideTokens(this.app.site,e));return this._allowedUrls.some(function(e){return t._isMatch(e,n)})},e.prototype._isMatch=function(e,t){return"mailto:"===t.protocol||!n.isNullOrUndefined(t.pathname)&&(t.host==e.host&&t.protocol==e.protocol&&(t.pathname.startsWith(e.pathname)||t.pathname+"/"===e.pathname))},e.prototype._initializeAllowedUrls=function(){var e=this;return this._allowedUrls?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var t=e.app.site;e._allowedUrls=[],e._allowUrl(t.url),e._allowUrl("http://localhost:8181"),e._allowUrl("http://127.0.0.1:8181");for(var i=0;i<t.trustedUrls.length;i++)e._allowUrl(t.trustedUrls[i].url);if(t.properties.trustedUrls&&t.properties.trustedUrls.split(",").forEach(function(t){e._allowUrl(t)}),t.essentialsMap){t.essentialsMap.mapServices.filter(function(e){return!e.isUserCreated}).forEach(function(t){e._allowUrl(t.serviceUrl),e._allowUrl(t.tileRestUrl),e._allowUrl(t.mapUrl),e._allowUrl(t.iconUri),(t.layerHyperlinks||[]).forEach(function(t){e._allowUrl(t.uri),e._allowUrl(t.iconUri)}),(t.layers||[]).forEach(function(t){e._allowUrl(t.getLayerUrl()),e._allowUrl(t.legendUrl),e._allowUrl(t.iconUri),(t.featureHyperlinks||[]).forEach(function(t){e._allowUrl(t.uri),e._allowUrl(t.iconUri)}),(t.layerHyperlinks||[]).forEach(function(t){e._allowUrl(t.uri),e._allowUrl(t.iconUri)}),e._extractUrls(t.featureLabel).forEach(function(t){return e._allowUrl(t)}),e._extractUrls(t.featureDescription).forEach(function(t){return e._allowUrl(t)}),e._extractUrls(t.featureLongDescription).forEach(function(t){return e._allowUrl(t)})})})}})},e.prototype._allowUrl=function(e){if(e)try{this._allowedUrls.push(i.getFolder(e))}catch(t){}},e.prototype._extractUrls=function(e){return e?(e.match(/(https?:\/\/[A-Za-z0-9\-\._~:\/\?#[\]@!\$&'()*\+,;=%]+)/g)||[]).map(function(e){return e.indexOf("{")>=0?e.slice(0,e.indexOf("{")):e}):[]},e}();t.SiteUrlValidator=a})},"geocortex/infrastructure/webMap/WebMapFilter":function(){define(["require","exports","geocortex/infrastructure/validation/NumberValidator","geocortex/infrastructure/validation/SiteUrlValidator","geocortex/infrastructure/webMap/Domain","geocortex/infrastructure/webMap/Renderer","geocortex/infrastructure/webMap/Symbol","geocortex/infrastructure/webMap/WebMapConverter"],function(e,t,i,r,n,a,o,s){"use strict";var l="__conversionType",c=function(){function e(e){var t=this;this._numberValidator=new i.NumberValidator,this.object=function(e){if(!e||"object"!=typeof e)return!0;if(Array.isArray(e))return{item:t.object};switch(e[l]){case s.ConversionType.GCX_MAP_SERVICE:case s.ConversionType.ESRI_LAYER:return t.serviceLayer;case s.ConversionType.GCX_LAYER:return t.layer;case s.ConversionType.GCX_FEATURE_SET:case s.ConversionType.ESRI_FEATURE_SET:return t.featureSet;case s.ConversionType.GCX_FEATURE:case s.ConversionType.ESRI_GRAPHIC:return t.feature;case s.ConversionType.ESRI_GEOMETRY:return t.geometry;case s.ConversionType.ESRI_SYMBOL:return t.symbol;case s.ConversionType.ESRI_RENDERER:return t.renderer;case s.ConversionType.ESRI_SPATIAL_REFERENCE:return t.spatialReference}for(var i={},r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];i[a]=t.object}return i},this.app=e,this._urlValidator=new r.SiteUrlValidator(e)}return Object.defineProperty(e.prototype,"baseMap",{get:function(){return this._baseMap||(this._baseMap={baseMapLayers:{item:this.baseMapLayer},title:!0}),this._baseMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseMapLayer",{get:function(){return this._baseMapLayer||(this._baseMapLayer=$.extend({},this._serviceLayerCommon,{type:!0,isReference:!0,templateUrl:this._urlValidator}),this._baseMapLayer[l]=!0),this._baseMapLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bookmark",{get:function(){return this._bookmark||(this._bookmark={name:!0,extent:this.extent}),this._bookmark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color||(this._color={item:this._numberValidator}),this._color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"csvLayer",{get:function(){return this._csvLayer||(this._csvLayer=$.extend({},this.operationalLayer,{columnDelimiter:!0,locationInfo:this.locationInfo})),this._csvLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domain",{get:function(){var e=this;return this._domain||(this._domain=function(t){if(!t)return!1;switch(t.type){case n.DomainType.INHERITED:return e.inheritedDomain;case n.DomainType.RANGE:return e.rangeDomain;case n.DomainType.CODED_VALUE:return e.codedValueDomain;default:return!1}}),this._domain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inheritedDomain",{get:function(){return this._inheritedDomain||(this._inheritedDomain={type:!0}),this._inheritedDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeDomain",{get:function(){return this._rangeDomain||(this._rangeDomain={type:!0,name:!0,range:{item:this._numberValidator}}),this._rangeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codedValueDomain",{get:function(){return this._codedValueDomain||(this._codedValueDomain={type:!0,name:!0,codedValues:{item:{name:!0,code:!0}}}),this._codedValueDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawingInfo",{get:function(){return this._drawingInfo||(this._drawingInfo={renderer:this.renderer,fixedSymbols:!0}),this._drawingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature||(this._feature={attributes:this.object,geometry:this.geometry},this._feature[l]=!0),this._feature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureCollection",{get:function(){return this._featureCollection||(this._featureCollection={layers:{item:this.layer},showLegend:!0}),this._featureCollection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureSet",{get:function(){return this._featureSet||(this._featureSet={features:{item:this.feature},geometryType:!0},this._featureSet[l]=!0),this._featureSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"field",{get:function(){return this._field||(this._field={alias:!0,domain:this.domain,editable:!0,length:!0,name:!0,nullable:!0,type:!0}),this._field},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){var e=this;return this._geometry||(this._geometry=function(t){return!!t&&(t.hasOwnProperty("x")?e.point:t.hasOwnProperty("points")?e.multiPoint:t.hasOwnProperty("paths")?e.polyline:t.hasOwnProperty("rings")?e.polygon:!!t.hasOwnProperty("xmin")&&e.extent)}),this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return this._point||(this._point={spatialReference:this.spatialReference,x:this._numberValidator,y:this._numberValidator,z:this._numberValidator,m:this._numberValidator},this._point[l]=!0),this._point},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiPoint",{get:function(){return this._multipoint||(this._multipoint={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,points:{item:{item:this._numberValidator}}},this._multipoint[l]=!0),this._multipoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polyline",{get:function(){return this._polyline||(this._polyline={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,paths:{item:{item:{item:this._numberValidator}}}},this._polyline[l]=!0),this._polyline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polygon",{get:function(){return this._polygon||(this._polygon={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,rings:{item:{item:{item:this._numberValidator}}}},this._polygon[l]=!0),this._polygon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._extent||(this._extent={spatialReference:this.spatialReference,xmin:this._numberValidator,xmax:this._numberValidator,ymin:this._numberValidator,ymax:this._numberValidator,zmin:this._numberValidator,zmax:this._numberValidator,mmin:this._numberValidator,mmax:this._numberValidator},this._extent[l]),this._extent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer||(this._layer={featureSet:this.featureSet,id:!0,layerDefinition:this.layerDefinition,layerUrl:this._urlValidator,legendUrl:this._urlValidator,name:!0,title:!0,popupInfo:this.popupInfo},this._layer[l]=!0),this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerDefinition",{get:function(){return this._layerDefinition||(this._layerDefinition={definitionExpression:!0,displayField:!0,drawingInfo:this.drawingInfo,fields:{item:this.field},geometryType:!0,hasAttachments:!0,maxScale:this._numberValidator,minScale:this._numberValidator,name:!0,objectIdField:!0,templates:{item:this.template},type:!0,typeIdField:!0,types:{item:this.type},source:{type:!0,mapLayerId:this._numberValidator}}),this._layerDefinition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locationInfo",{get:function(){return this._locationInfo||(this._locationInfo={locationType:!0,latitudeFieldName:!0,longitudeFieldName:!0}),this._locationInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operationalLayer",{get:function(){return this._operationalLayer||(this._operationalLayer=$.extend({},this._serviceLayerCommon,{type:!0,capabilities:!0,featureCollection:this.featureCollection,itemId:!0,layerDefinition:this.layerDefinition,layers:{item:this.layer},maxScale:this._numberValidator,minScale:this._numberValidator,mode:this._numberValidator,popupInfo:this.popupInfo,title:!0,visibleLayers:{item:!0}}),this._operationalLayer[l]=!0),this._operationalLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"popupInfo",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){var e=this;return this._renderer||(this._renderer=function(t){if(!t)return!1;switch(t.type){case a.RendererType.SIMPLE:return e.simpleRenderer;case a.RendererType.UNIQUE_VALUE:return e.uniqueValueRenderer;case a.RendererType.CLASS_BREAKS:
return e.classBreaksRenderer;case a.RendererType.HEATMAP:return e.heatmapRenderer;default:return!1}}),this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceLayer",{get:function(){return this._serviceLayer||(this._serviceLayer=$.extend({},this.operationalLayer,this.wmsLayer,this.csvLayer,this.baseMapLayer)),this._serviceLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleRenderer",{get:function(){return this._simpleRenderer||(this._simpleRenderer={type:!0,symbol:this.symbol,label:!0,description:!0},this._simpleRenderer[l]=!0),this._simpleRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueValueRenderer",{get:function(){return this._uniqueValueRenderer||(this._uniqueValueRenderer={type:!0,field1:!0,field2:!0,field3:!0,fieldDelimiter:!0,defaultSymbol:this.symbol,defaultLabel:!0,uniqueValueInfos:{item:{value:!0,label:!0,description:!0,symbol:this.symbol}}},this._uniqueValueRenderer[l]=!0),this._uniqueValueRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classBreaksRenderer",{get:function(){return this._classBreaksRenderer||(this._classBreaksRenderer={type:!0,field:!0,classificationMethod:!0,normalizationType:!0,normalizationField:!0,normalizationTotal:this._numberValidator,defaultSymbol:this.symbol,defaultLabel:!0,backgroundFillSymbol:this.simpleFillSymbol,minValue:this._numberValidator,classBreakInfos:{item:{classMinValue:this._numberValidator,classMaxValue:this._numberValidator,label:!0,description:!0,symbol:this.symbol}}},this._classBreaksRenderer[l]=!0),this._classBreaksRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heatmapRenderer",{get:function(){return this._heatmapRenderer||(this._heatmapRenderer={type:!0,blurRadius:this._numberValidator,field:!0,maxPixelIntensity:this._numberValidator,minPixelIntensity:this._numberValidator,colorStops:{item:{ratio:!0,color:this.color}}}),this._heatmapRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_serviceLayerCommon",{get:function(){return{id:!0,url:this._urlValidator,visibility:!0,opacity:this._numberValidator,layerType:!0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._spatialReference||(this._spatialReference={wkid:this._numberValidator,wkt:!0},this._spatialReference[l]=!0),this._spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"symbol",{get:function(){var e=this;return this._symbol||(this._symbol=function(t){if(!t)return!1;switch(t.type){case o.SymbolType.SIMPLE_MARKER:return e.simpleMarkerSymbol;case o.SymbolType.SIMPLE_LINE:return e.simpleLineSymbol;case o.SymbolType.SIMPLE_FILL:return e.simpleFillSymbol;case o.SymbolType.PICTURE_MARKER:return e.pictureMarkerSymbol;case o.SymbolType.PICTURE_FILL:return e.pictureFillSymbol;case o.SymbolType.TEXT:return e.textSymbol;default:return!1}}),this._symbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleMarkerSymbol",{get:function(){return this._simpleMarkerSymbol||(this._simpleMarkerSymbol={type:!0,style:!0,color:this.color,size:!0,angle:this._numberValidator,path:!0,xoffset:this._numberValidator,yoffset:this._numberValidator,outline:{type:!0,style:!0,color:this.color,width:this._numberValidator}},this._simpleMarkerSymbol[l]=!0),this._simpleMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleLineSymbol",{get:function(){return this._simpleLineSymbol||(this._simpleLineSymbol={type:!0,style:!0,color:this.color,width:this._numberValidator},this._simpleLineSymbol[l]=!0),this._simpleLineSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleFillSymbol",{get:function(){return this._simpleFillSymbol||(this._simpleFillSymbol={type:!0,style:!0,color:this.color,outline:this.simpleLineSymbol},this._simpleFillSymbol[l]=!0),this._simpleFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureMarkerSymbol",{get:function(){return this._pictureMarkerSymbol||(this._pictureMarkerSymbol={type:!0,url:this._urlValidator,imageData:!0,contentType:!0,width:this._numberValidator,height:this._numberValidator,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator},this._pictureMarkerSymbol[l]=!0),this._pictureMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureFillSymbol",{get:function(){return this._pictureFillSymbol||(this._pictureFillSymbol={type:!0,url:this._urlValidator,imageData:!0,contentType:!0,outline:this.simpleLineSymbol,width:this._numberValidator,height:this._numberValidator,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator,xscale:this._numberValidator,yscale:this._numberValidator},this._pictureFillSymbol[l]=!0),this._pictureFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSymbol",{get:function(){return this._textSymbol||(this._textSymbol={type:!0,color:this.color,backgroundColor:this.color,borderLineSize:this._numberValidator,borderLineColor:this.color,haloSize:this._numberValidator,haloColor:this.color,verticalAlignment:!0,horizontalAlignment:!0,rightToLeft:!0,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator,kerning:!0,font:{family:!0,size:this._numberValidator,style:!0,weight:!0,decoration:!0},text:!0},this._textSymbol[l]=!0),this._textSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"template",{get:function(){return this._template||(this._template={description:!0,drawingTool:!0,name:!0,prototype:this.feature}),this._template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){var e=this;return this._type||(this._type={domains:function(t){if(!t)return!0;for(var i={},r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];i[a]=e.domain}return i},id:this._numberValidator,name:!0,templates:{item:this.template}}),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webMap",{get:function(){return this._webMap||(this._webMap={operationalLayers:{item:this.operationalLayer},baseMap:this.baseMap,bookmarks:{item:this.bookmark},version:!0,applicationProperties:!0}),this._webMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wmsLayer",{get:function(){return this.wmsLayer||(this._wmsLayer=$.extend({},this.operationalLayer,{copyright:!0,extent:this.extent,format:!0,mapUrl:this._urlValidator,maxHeight:this._numberValidator,maxWidth:this._numberValidator,spatialReferences:{item:this._numberValidator},version:!0})),this._wmsLayer},enumerable:!0,configurable:!0}),e}();t.WebMapFilter=c})},"geocortex/infrastructure/validation/ServiceDiscoveryUrlValidator":function(){define(["require","exports","geocortex/infrastructure/validation/SiteUrlValidator","geocortex/essentials/RestHelper","geocortex/essentials/serviceDiscovery/SiteServiceDiscoveryProvider"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var r=e.call(this,t)||this;if(r._serviceDiscovery=null,!t)throw new Error('Argument "app" is required.');return r.app=t,i&&r.setDiscoveryProvider(i),r}return __extends(t,e),t.prototype.getDiscoveryProvider=function(){return this._serviceDiscovery},t.prototype.setDiscoveryProvider=function(e){this._serviceDiscovery=e},t.prototype.validate=function(t,i){var r=this;return t?"string"!=typeof t?Promise.reject(new Error("Input is not a URL.")):this._initializeDiscoveryProvider().then(function(){return e.prototype.validate.call(r,t,i)})["catch"](function(){return r._validate(t,i)}):Promise.resolve({validatedValue:t})},t.prototype._validate=function(e,t){var i=r.RestHelper.processClientSideTokens(this.app.site,e),n="The following URL is not allowed by this Essentials service connection whitelist and will be skipped: "+e;return Promise.resolve(this._serviceDiscovery.findServices(i)).then(function(t){if(t&&t.length>0&&t[0].isWhitelisted)return Promise.resolve({validatedValue:e});throw new Error(n)})["catch"](function(){return Promise.reject(new Error(n))})},t.prototype._initializeDiscoveryProvider=function(){var e=this;return this._serviceDiscovery?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var t=e.app.site,i=new n.SiteServiceDiscoveryProvider;i.initialize(t),e.setDiscoveryProvider(i)})},t}(i.SiteUrlValidator);t.ServiceDiscoveryUrlValidator=a})},"geocortex/infrastructure/commandArgs/ConfirmOptionArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ContentPolicy":function(){define(["require","exports","geocortex/infrastructure/FilterUtils","geocortex/infrastructure/validation/SiteUrlValidator","geocortex/infrastructure/UrlUtilities"],function(e,t,i,r,n){"use strict";var a,o=[],s=!1;!function(e){e[e.DisableSecurityPrompt=1]="DisableSecurityPrompt",e[e.DisablePromptOnImages=2]="DisablePromptOnImages",e[e.TrustExactUrl=4]="TrustExactUrl"}(a=t.PolicyFlags||(t.PolicyFlags={}));var l=function(){function e(e){this._debounceInterval=250,this._flags=0,this._app=e}return e.prototype.hasFlag=function(e){return(this._flags&e)===e},e.prototype.setFlag=function(e){this._flags|=e},e.prototype.screenUris=function(e){this._siteValidator||(this._siteValidator=new r.SiteUrlValidator(this._app));for(var t=[],i=0,n=e;i<n.length;i++){var a=n[i];a.uri;a.uri=this._screenDataUri(a.uri),null!==a.uri?t.push(a):this._app.trace.debug("Skipped unknown, untrusted data URI.")}return this._validateUris(t)},e.prototype.tryScreenNavLinkSynchronously=function(e){if(!this._siteValidator)return!1;var t=this._siteValidator.tryValidateSynchronously(e.uri);return t?t:this._getMemoizedResult(e)||!1},e.prototype._validateUris=function(e){var t=this,r=[],n=[];return n=e.map(function(e){return new Promise(function(n,a){var o=e.uri;if(t.hasFlag(2)&&e.type===i.UriType.Markup){var s=e;if("img"===s.tag&&"src"===s.attribute)return n(e)}return t._validateUriAgainstSite(e).then(function(t){return null==t.validatedValue||""===t.validatedValue?(e.uri=o,r.push(e),n(null)):(e.type===i.UriType.NavigableLink&&e.forcePrompt&&r.push(e),n(e))},function(t){return e.uri=o,r.push(e),n(e)})})}),Promise.all(n).then(function(){return t._promptForUris(r)}).then(function(){return e})},e.prototype._validateUriAgainstSite=function(e){if(!this._siteValidator){e.uri="";var t={validatedValue:null};return Promise.resolve(t)}return this._siteValidator.validate(e.uri)},e.prototype._promptForUris=function(e){var t=this;return Promise.map(e,function(e,i){return new Promise(function(i,r){t._enqueueConfirmation({uriDetails:e,resolve:i})})})},e.prototype._enqueueConfirmation=function(e){o.push(e),this._processConfirmationQueue()},e.prototype._processConfirmationQueue=function(){if(!s){s=!0;try{for(;o.length;){var e=o.shift(),t=this._getConfirmation(e);if(t)return}}catch(i){throw s=!1,i}s=!1}},e.prototype._getConfirmation=function(e){var t=this;if(!e.uriDetails.forcePrompt&&this.hasFlag(1))return e.resolve(e.uriDetails),!1;var r=e.uriDetails.type===i.UriType.NavigableLink,n=this._getMemoizedResult(e.uriDetails);if(r||n!==!0){if(r||n!==!1){var a=function(i){s=!1,t._memoizeResult(e.uriDetails,i),i===!0?e.resolve(e.uriDetails):(e.uriDetails.uri="",e.resolve(e.uriDetails));try{if(r){var n=e.uriDetails.linkChallengeCallback;n&&n(i,e.uriDetails)}}finally{t._processConfirmationQueue()}},o={okLabel:this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-accept-btn"),cancelLabel:this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-reject-btn")},l=this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-title"),c=this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-desc");if(c=c.format(e.uriDetails.uri),!this._app.command("Confirm").canExecute(c,l,a,o)){var u=window.confirm(c);return a(u),!1}return this._app.command("Confirm").execute(c,l,a,o),!0}return e.uriDetails.uri="",e.resolve(e.uriDetails),!1}return e.resolve(e.uriDetails),!1},e.prototype._getMemoizationKey=function(e){var t;t=this.hasFlag(4)?n.parseUrl(e.uri):n.getFolder(e.uri);var r=String.quickHashCode(t.toString());return"uri."+i.UriType[e.type].toLowerCase()+"."+r},e.prototype._memoizeResult=function(e,t){var i=this._getMemoizationKey(e);window.localStorage.setItem(i,t.toString())},e.prototype._getMemoizedResult=function(e){var t=this._getMemoizationKey(e),i=window.localStorage.getItem(t);return null===i?null:"true"===i},e.prototype._screenDataUri=function(e){var t=!!i.DataUri.parseDataUri(e),r=i.DataUri.isDataUriSafe(e),n=!t||r;return n?e:""},e}();t.ContentPolicy=l})},"geocortex/infrastructure/validation/XssHtmlValidator":function(){define(["require","exports","geocortex/infrastructure/FilterUtils"],function(e,t,i){"use strict";var r=function(){function e(e){void 0===e&&(e={}),this._tokenLeft="{",this._tokenRight="}",this._tokenLeftEscaped="\\{",this._tokenRightEscaped="\\}",e.contentPolicy&&(this._contentPolicy=e.contentPolicy)}return e.prototype.validate=function(e,t){var i=this;void 0===t&&(t={XssHtmlValidator:{}});var r={html:e,uris:[],contentPolicy:this._contentPolicy||t.XssHtmlValidator.defaultContentPolicy};if(!r.contentPolicy)throw new Error("XssHtmlValidator cannot perform validation without a ContentPolicy instance.");var n=t.sanitizeOptions;return Promise.resolve(r).then(function(e){return i._escape(e)}).then(function(e){return i._sanitize(e,n)}).then(function(e){return i._runUrisThroughContentPolicy(e)}).then(function(e){return i._applyUris(e)}).then(function(e){return i._unescape(e)}).then(function(e){return{validatedValue:e.html}})},e.prototype._escape=function(e){return e.html=e.html.split(this._tokenLeft).join(this._tokenLeftEscaped),e.html=e.html.split(this._tokenRight).join(this._tokenRightEscaped),e},e.prototype._sanitize=function(e,t){var r=this;void 0===t&&(t={});var n=t?t.uriTransformer:null,a=function(a,o){return n&&(a=n(a,o),o.uri=a),t.allowArbitraryHyperlinks&&o.type===i.UriType.NavigableLink?a:(e.uris.push(o),r._tokenize(e.uris.length-1))};return t.uriTransformer=a,e.html=i.sanitize(e.html,t),e},e.prototype._runUrisThroughContentPolicy=function(e){return this._contentPolicy?this._contentPolicy.screenUris(e.uris).then(function(t){return e}):e.contentPolicy.screenUris(e.uris).then(function(t){return e})},e.prototype._applyUris=function(e){var t=this;return e.uris.forEach(function(i,r){var n=t._tokenize(r);e.html=e.html.replace(n,i.uri)}),e},e.prototype._unescape=function(e){return e.html=e.html.split(this._tokenLeftEscaped).join(this._tokenLeft),e.html=e.html.split(this._tokenRightEscaped).join(this._tokenRight),e},e.prototype._tokenize=function(e){return this._tokenLeft+e.toString()+this._tokenRight},e}();t.XssHtmlValidator=r})},"geocortex/infrastructure/project/BaseMapLayer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/project/ProjectFilter":function(){define(["require","exports","geocortex/infrastructure/webMap/WebMapFilter","geocortex/infrastructure/validation/NumberValidator","geocortex/infrastructure/validation/SiteUrlValidator","geocortex/infrastructure/validation/ServiceDiscoveryUrlValidator","geocortex/infrastructure/validation/XssHtmlValidator","geocortex/infrastructure/project/ProjectConverter","geocortex/infrastructure/KmlFeature","geocortex/infrastructure/webMap/WebMapConverter","geocortex/infrastructure/webMap/OperationalLayer","geocortex/essentials/MapServiceConstants"],function(e,t,i,r,n,a,o,s,l,c,u,d){"use strict";var p=function(){function e(e){var t=this;this._numberValidator=new r.NumberValidator,this._xssHtmlValidator=new o.XssHtmlValidator,this.baseMapLayer=function(e){var i=t._getUrlValidator(e);return $.extend({},t._webMapFilter.baseMapLayer,t._serviceLayerCommon,{url:i,templateUrl:i,gcxMapServiceDefinition:$.extend({},t._serviceLayerCommon.gcxMapServiceDefinition,{url:i,serviceUrl:i,tileRestUrl:i,mapUrl:i})})},this.layer=function(e){var i=t._getUrlValidator(e);return $.extend({},t._webMapFilter.layer,{serviceLayer:function(){return t.serviceLayer},layerDefinition:t.layerDefinition,featureSet:function(){return t.featureSet},isDynamic:!0,layerStyleId:!0,isUserCreated:!0,userLayerType:!0,layerUrl:i,legendUrl:i,gcxLayerDefinition:{id:!0,name:t._xssHtmlValidator,url:i,defaultVisibility:!0,visible:!0,displayName:t._xssHtmlValidator,description:!0,featureType:!0,featureZoomScale:!0,featureZoomFactor:!0,hasAttachments:!0,nativeID:!0,parentLayerId:!0,subLayerIds:!0,styleName:!0,legendUrl:i,isDynamic:!0,dynamicDefinition:!0,defaultDateFormat:!0,defaultNumberFormat:!0,timeZoneId:!0,fullExtent:!0,drawIndex:!0,identifiable:!0,includeInLayerList:!0,includeInLegend:!0,isExpanded:!0,featureBorderColor:!0,featureBorderWidth:!0,featureFillColor:!0,minScale:t._numberValidator,maxScale:t._numberValidator,queryable:!0,searchable:!0,snappable:!0,snappingEnabled:!0,showFeatureHyperlinks:!0,canToggleLabels:!0,showLabels:!0,showMapTips:!0,supportsIdentify:!0,supportsQuery:!0,type:!0,fields:!0,primaryKeyField:!0,displayField:!0,catalogId:t.object,isUserCreated:!0,userLayerType:!0,featureDescription:!1,featureLongDescription:!1,featureLabel:!1,featureHyperlinks:!1,layerHyperlinks:!1,relationships:!1,dataLinks:!1,reports:!1,charts:!1}})},this.operationalLayer=function(e){var i=t._getUrlValidator(e);return $.extend({},t._webMapFilter.operationalLayer,t._serviceLayerCommon,{layers:{item:function(){return t.layer}},featureCollection:t.featureCollection,layerDefinition:t.layerDefinition,url:i,gcxMapServiceDefinition:$.extend({},t._serviceLayerCommon.gcxMapServiceDefinition,{url:i,serviceUrl:i,tileRestUrl:i,mapUrl:i})})},this.serviceLayer=function(e){return $.extend({},t.operationalLayer(e),t.baseMapLayer(e))},this.object=function(e){if(!e||"object"!=typeof e)return!0;switch(e[c.CONVERSION_TYPE_PROPERTY]){case c.ConversionType.GCX_MAP_SERVICE:case c.ConversionType.ESRI_LAYER:return function(){return t.serviceLayer};case c.ConversionType.GCX_LAYER:return function(){return t.layer};case c.ConversionType.GCX_FEATURE_SET:case c.ConversionType.ESRI_FEATURE_SET:return function(){return t.featureSet};case c.ConversionType.GCX_FEATURE:case c.ConversionType.ESRI_GRAPHIC:return function(){return t.feature};case c.ConversionType.ESRI_GEOMETRY:return t.geometry;case c.ConversionType.ESRI_SYMBOL:return t.symbol;case c.ConversionType.ESRI_RENDERER:return t.renderer;case c.ConversionType.ESRI_SPATIAL_REFERENCE:return t.spatialReference}for(var i={},r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];i[a]=t.object}return i},this.app=e,this._urlValidator=new n.SiteUrlValidator(e),this._serviceDiscoveryUrlValidator=new a.ServiceDiscoveryUrlValidator(e),this._webMapFilter=new i.WebMapFilter(e),this._xssHtmlValidator=new o.XssHtmlValidator(e.defaultContentPolicy)}return Object.defineProperty(e.prototype,"baseMap",{get:function(){return this._webMapFilter.baseMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bookmark",{get:function(){return this._webMapFilter.bookmark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._webMapFilter.color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this._coordinateSystem||(this._coordinateSystem={wkid:this._numberValidator,wkt:!0,output:!0}),this._coordinateSystem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domain",{get:function(){return this._webMapFilter.domain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inheritedDomain",{get:function(){return this._webMapFilter.inheritedDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeDomain",{get:function(){return this._webMapFilter.rangeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codedValueDomain",{get:function(){return this._webMapFilter.codedValueDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawingInfo",{get:function(){return this._drawingInfo||(this._drawingInfo=$.extend({},this._webMapFilter.drawingInfo,{showLabels:!0,clustering:{radius:this._numberValidator,backgroundColor:this.color,labelColor:this.color,maximumFeatures:this._numberValidator,enabled:!0},labelingInfo:{item:{fieldInfos:{item:this.object},labelExpression:!0,labelExpressionInfo:this.object,labelPlacement:!0,maxScale:this._numberValidator,minScale:this._numberValidator,sizeInfo:this.object,symbol:{align:!0,angle:this._numberValidator,color:{a:this._numberValidator,b:this._numberValidator,g:this._numberValidator,r:this._numberValidator},decoration:!0,font:{decoration:!0,family:!0,size:this._numberValidator,style:!0,variant:!0,weight:!0},haloColor:{a:this._numberValidator,b:this._numberValidator,g:this._numberValidator,r:this._numberValidator},haloSize:!0,horizontalAlignment:!0,kerning:!0,rotated:!0,text:!0,type:!0,verticalAlignment:!0,xoffset:this._numberValidator,yoffset:this._numberValidator},useCodedValues:!0,where:!0}}})),this._drawingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"feature",{get:function(){var e=this;return this._feature||(this._feature=$.extend({},this._webMapFilter.feature,{id:!0,layer:function(){return e.layer},featureLayer:function(){return e.serviceLayer},featureSet:function(){return e.featureSet},allowUnsafeContent:!0,extendedProperties:this.object,defaultNumberFormat:this._xssHtmlValidator,defaultDateFormat:this._xssHtmlValidator,timeZoneId:!0,displayTimeZoneId:!0,borderColor:this.color,fillColor:this.color,borderWidth:!0,attributes:this.object}),this._feature[s.PROPERTY_MEASUREMENT_ID]=!0,this._feature[s.PROPERTY_HIGHLIGHT_ID]=!0,this._feature[l.isKmlProperty]=!0),this._feature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureCollection",{get:function(){return this._featureCollection||(this._featureCollection=$.extend({},this._webMapFilter.featureCollection,{layers:{item:this.layer}})),this._featureCollection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureSet",{get:function(){var e=this;return this._featureSet||(this._featureSet=$.extend({},this._webMapFilter.featureSet,{id:!0,features:{item:function(){return e.feature}},allowUnsafeContent:!0,extendedProperties:this.object,layer:function(){return e.layer},displayName:this._xssHtmlValidator,iconUri:this._urlValidator})),this._featureSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureSetCollection",{get:function(){var e=this;return this._featureSetCollection||(this._featureSetCollection={id:!0,displayName:this._xssHtmlValidator,featureSets:{item:function(){return e.featureSet}},sourceName:!0,tag:this.object,extendedProperties:this.object}),this._featureSetCollection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"field",{get:function(){return this._webMapFilter.field},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._webMapFilter.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphic",{get:function(){return this._graphic||(this._graphic=$.extend({},this._webMapFilter.feature),this._graphic[s.PROPERTY_MEASUREMENT_ID]=!0,this._graphic[s.PROPERTY_HIGHLIGHT_ID]=!0,this._graphic[l.isKmlProperty]=!0),this._graphic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return this._webMapFilter.point},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiPoint",{get:function(){return this._webMapFilter.multiPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polyline",{get:function(){return this._webMapFilter.polyline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polygon",{get:function(){return this._webMapFilter.polygon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._webMapFilter.extent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerDefinition",{get:function(){return this._layerDefinition||(this._layerDefinition=$.extend({},this._webMapFilter.layerDefinition,{drawingInfo:this.drawingInfo})),this._layerDefinition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return this._webMapFilter.renderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleRenderer",{get:function(){return this._webMapFilter.simpleRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueValueRenderer",{get:function(){return this._webMapFilter.uniqueValueRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classBreaksRenderer",{get:function(){return this._webMapFilter.classBreaksRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heatmapRenderer",{get:function(){return this._webMapFilter.heatmapRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._webMapFilter.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"symbol",{get:function(){return this._webMapFilter.symbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleMarkerSymbol",{get:function(){return this._webMapFilter.simpleMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleLineSymbol",{get:function(){return this._webMapFilter.simpleLineSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleFillSymbol",{get:function(){return this._webMapFilter.simpleFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureMarkerSymbol",{get:function(){return this._webMapFilter.pictureMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureFillSymbol",{get:function(){return this._webMapFilter.pictureFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSymbol",{get:function(){return this._webMapFilter.textSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"template",{get:function(){return this._webMapFilter.template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._webMapFilter.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_serviceLayerCommon",{get:function(){var e=this;return{layers:{item:function(){return e.layer}},isUserCreated:!0,userLayerType:!0,gcxMapServiceDefinition:{id:!0,url:this._urlValidator,serviceUrl:this._urlValidator,tileRestUrl:this._urlValidator,mapUrl:this._urlValidator,subDomains:{item:!0},serviceType:!0,serviceFunction:!0,displayName:this._xssHtmlValidator,shortDisplayName:!0,baseMapGroup:!0,baseMapGroupIndex:!0,baseMapGroupIsMutuallyExclusive:!0,description:!0,copyright:!0,hasAttributionData:!0,visible:!0,disableClientCaching:!0,opacity:this._numberValidator,instantSearch:!0,format:!0,isExpanded:!0,serverVersion:!0,failureAction:!0,tileMatrixSet:!0,requestEncoding:!0,operationalSpatialReference:!0,minScale:this._numberValidator,maxScale:this._numberValidator,identifiable:!0,includeCatalogItems:!0,includeMosaicDatasetValues:!0,defaultDateFormat:!0,defaultNumberFormat:!0,tileInfo:!0,includeInLayerList:!0,drawingBehavior:!0,featureClustering:{enabled:!0,userCanToggle:!0,radius:this._numberValidator,maximumFeatures:this._numberValidator,backgroundColor:this.color,labelColor:this.color},featureHeatMap:{enabled:!0,userCanToggle:!0,respectScaleRange:!0,gradient:!0,offset:{item:this._numberValidator},intensity:this._numberValidator,field:!0,defaultRenderer:this.renderer,defaultMinScale:this._numberValidator,defaultMaxScale:this._numberValidator,includeInLegend:!0},catalogId:this.object,isUserCreated:!0,userLayerType:!0,dataProvider:!0,timeZoneId:!0,startTime:!0,endTime:!0,supportsDynamicLayers:!0,hasLayerCatalog:!0,updateInterval:this._numberValidator,layerOptions:!1,layerHyperlinks:!1,attributionDataUrl:!1}}},enumerable:!0,configurable:!0}),e.prototype._getUrlValidator=function(e){var t=this._urlValidator;return this._getUserLayerType(e)===d.UserLayerType.LAYER_ADDITION&&(t=this._serviceDiscoveryUrlValidator),t},e.prototype._getUserLayerType=function(e){if(e){if(e.isUserCreated&&void 0!=e.userLayerType)return e.userLayerType;var t=void 0;if(t=e.serviceLayer?e.serviceLayer:e,this._isLayerCatalogService(t))return d.UserLayerType.LAYER_CATALOG;if(this._isFeatureCollection(t)||this._isKmlLayer(t))return d.UserLayerType.UPLOAD}return null},e.prototype._isFeatureCollection=function(e){var t=e;return t&&t.featureCollection&&t.featureCollection.layers&&1===t.featureCollection.layers.length&&!!t.featureCollection.layers[0].featureSet},e.prototype._isKmlLayer=function(e){var t=e;return t&&t.type===u.OperationalLayerType.KML},e.prototype._isLayerCatalogService=function(e){return e&&e.gcxMapServiceDefinition&&e.gcxMapServiceDefinition.catalogId},e}();t.ProjectFilter=p})},"geocortex/infrastructure/project/Project":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ShellUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t,i){void 0===i&&(i=400);var n=["ViewInitializedEvent","ViewActivatedEvent","ViewDeactivatedEvent","ViewDimensionsChangedEvent","ViewHostedEvent","ViewUnhostedEvent","ApplicationResizeEvent"];r(e,t,n,i)}function r(e,t,i,r){var n=this;void 0===r&&(r=200);var a=-1,o=[],s=function(){for(var t=o.length-1;t>=0;t--){var i=o[t];e.event(i.eventName).unsubscribe(i.subscriptionToken),o.pop()}},l=function(){a=setTimeout(function(){a=null,s(),t()},r)};i.forEach(function(t){var i=e.event(t).subscribe(n,function(){null!==a&&(clearTimeout(a),l())});o.push({eventName:t,subscriptionToken:i})}),l()}function n(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)}t.debounceViewEvents=i,t.debounceEvents=r,t.hasClass=n})},"geocortex/infrastructure/ObjectFilter":function(){define(["require","exports","geocortex/infrastructure/PromiseUtils"],function(e,t,i){"use strict";var r;!function(e){function t(e,t,i){if(!t)return Promise.reject(new Error("Filter required."));var r=new WeakMap;return a(e,t,r,i)}function r(e){return e&&"function"==typeof e.validate}function n(t,i,n,o){if("object"==typeof t&&n.has(t))return Promise.resolve(n.get(t));for(;"function"==typeof i;)i=i(t,o);return r(i)?i.validate(t,o).then(function(e){return e.validatedValue}):"object"==typeof i&&"object"==typeof t?a(t,i,n,o):i===!0?Promise.resolve(t):Promise.reject(e.FILTERED)}function a(e,t,r,a){if(!e)return Promise.resolve(e);if(r.has(e))return r.get(e);for(var o;"function"==typeof t;)t=t(e,a);if("object"==typeof t)if(Array.isArray(e))o=i.PromiseUtils.mapSkipRejected(e,function(e){return n(e,t.item,r,a)}),r.set(e,o);else{var s={};r.set(e,s),o=i.PromiseUtils.mapSkipRejected(Object.keys(t),function(i){if(i in e)return n(e[i],t[i],r,a).then(function(e){s[i]=e})})["return"](s)}else o=n(e,t,r);return o}e.FILTERED={},e.filter=t}(r=t.ObjectFilter||(t.ObjectFilter={}))})},"geocortex/infrastructure/project/ProjectManager":function(){define(["require","exports","geocortex/infrastructure/project/ProjectConverter","geocortex/infrastructure/project/ProjectFilter","geocortex/infrastructure/ShellUtils","geocortex/infrastructure/MapUtils","geocortex/framework/utils/utils","geocortex/infrastructure/UrlUtilities","geocortex/infrastructure/Dictionary","geocortex/infrastructure/PromiseUtils","geocortex/infrastructure/ObjectFilter","geocortex/essentials/serviceDiscovery/SiteServiceDiscoveryProvider","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/webMap/WebMapConverter"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h){"use strict";var m="~",f="\\x7e",g="unknown";t.PROJECT_TYPE="gvh-project",t.SITE_ID_PROPERTY_NAME="siteID",t.VIEWER_ID_PROPERTY_NAME="viewerID",t.PROJECT_QUERY_STRING_KEY="project",t.VIEWER_QUERY_STRING_KEY="viewer";
var y=function(){function e(e){if(this._serviceDiscovery=null,!e)throw new Error("ProjectManager: Parameter 'app' is required.");this.app=e,this.convert=new i.ProjectConverter(e),this.filter=new r.ProjectFilter(e)}return e.prototype.createEmpty=function(e){var i={};return i[t.SITE_ID_PROPERTY_NAME]={string:this.app.site.id},i[t.VIEWER_ID_PROPERTY_NAME]={string:this.app.configModel.viewerId},{title:e,fileType:t.PROJECT_TYPE,contentType:"application/json",content:{moduleState:{}},properties:i}},e.prototype.create=function(e){var t=this.createEmpty(e);return this.update(t)["return"](t)},e.prototype.update=function(e){return this._exportState().then(function(t){e.content=t})},e.prototype.remove=function(e){var t=this;if(!e)throw new Error('RemoveProject: parameter "project" is required.');var i=this.getProjectID(e);return this.app.waitUntilSiteInitialized().then(function(){return t.app.event("ProjectDeletingEvent").publish(i)}).then(function(){return t.app.site.documentStore.deleteById(i)}).then(function(){t.current&&t.current.id===i&&(t.current=null)}).then(function(){t.app.event("ProjectDeletedEvent").publish(i)})["catch"](function(e){t.app.event("ProjectErrorEvent").publish(null,e);var i=t._getResource("language-project-error-title"),r=t._getResource("language-project-error-delete");throw e&&"writer denied"===e.formalCode&&(r=t._getResource("language-project-error-delete-denied")),t.app.command("Alert").execute(r,i),e})},e.prototype.save=function(e,t){var i=this;if(void 0===t&&(t=!0),!e)throw new Error('SaveProject: parameter "project" is required.');return this.app.waitUntilSiteInitialized().then(function(){return i.app.event("ProjectSavingEvent").publish(e)}).then(function(){return t?new Promise(function(e,t){return n.debounceViewEvents(i.app,function(){return e()})}).then(function(){return i.update(e)}).then(function(){return a.getThumbnailUri(i.app)}).then(function(t){return e.thumbnail={location:t}})["catch"](function(t){i.app.event("ProjectErrorEvent").publish(e,t);var r=i._getResource("language-project-error-title"),n=i._getResource("language-project-error-write");throw i.app.command("Alert").execute(n,r),t}):Promise.resolve()}).then(function(){return i.write(e)}).then(function(t){return dojo.mixin(e,t)}).then(function(){return i.app.event("ProjectSavedEvent").publish(e)})},e.prototype.load=function(e){var t=this;if(!e)throw new Error('LoadProject: parameter "project" is required.');var i=this.getProjectID(e);return this.app.event("ProjectLoadingEvent").publish(i),"object"==typeof e&&void 0===e.content&&(e=i),this.getProject(e).then(function(e){return t._beginLoad(e)}).then(function(){if(t.current&&t.current.content)return t._applyState(t.current.content)}).then(function(){return t._finishLoad()})["catch"](function(e){t.isLoading=!1})},e.prototype.write=function(e){var t=this;if(!e)throw new Error('ProjectManager.write: Parameter "project" is required.');return e.content&&e.content.isDecoded&&this.encodeReferences(e.content),this.app.waitUntilSiteInitialized().then(function(){return o.isNullOrUndefined(e.id)?t.app.site.documentStore.add(e).then(function(t){return e.id=t.id,t}):t.app.site.documentStore.updateById(e.id,e)})["catch"](function(i){t.app.event("ProjectErrorEvent").publish(e,i);var r=t._getResource("language-project-error-title"),n=t._getResource("language-project-error-write");throw!i||"writer denied"!==i.formalCode&&"create denied"!==i.formalCode||(n=t._getResource("language-project-error-write-denied")),t.app.command("Alert").execute(n,r),i})},e.prototype.read=function(e,t){var i=this;if(void 0===t&&(t=!0),!e)throw new Error('ProjectManager.read: parameter "id" is required.');return this.app.waitUntilSiteInitialized().then(function(){return i.app.site.documentStore.getById(e,t)}).then(function(e){return e?(i.decodeReferences(e.content),i._filterApplicationState(e.content).then(function(t){return e.content=t,e})):e})["catch"](function(t){i.app.event("ProjectErrorEvent").publish(null,t);var r=i._getResource("language-project-error-title"),n=i._getResource("language-project-error-read");if(t&&"item missing"===t.formalCode)n=i._getResource("language-project-error-read-not-found").format(e);else if(t&&"reader denied"===t.formalCode){if(n=i._getResource("language-project-error-read-denied"),i.app.command("SignIn").canExecute(null)){n=i._getResource("language-project-error-sign-in-required");var a=function(e){e?i.app.command("SignIn").execute(null):window.location.assign(s.removeQueryParameter(window.location.href,"project"))};throw i.app.command("Confirm").execute(n,r,a,{okLabel:i._getResource("language-project-sign-in")}),t}n=i._getResource("language-project-error-read-denied")}throw i.app.command("Alert").execute(n,r),t})},e.prototype.getProject=function(e,t){if(void 0===t&&(t=!0),!e)throw new Error('ProjectManager.getProject: parameter "project" is required.');return"string"==typeof e?this.app.project.read(e,t):Promise.resolve(e)},e.prototype.getProjectID=function(e){if(!e)throw new Error('ProjectManager.getProjectID: parameter "project" is required.');return"string"==typeof e?e:e.id},e.prototype.getProjectUrl=function(e){if(!e||!e.id)return null;var i=this.getSiteID(e);if(!i)throw new Error("ProjectManager.getProjectUrl: project siteId is null or undefined.");var r=this.getViewerID(e);if(!r)throw new Error("ProjectManager.getProjectUrl: project viewerId is null or undefined.");var n=window.location.href;n.indexOf("?")>-1?n=n.substring(0,n.indexOf("?")):n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var a=new l.Dictionary;if(r!==g){var o=encodeURIComponent("{0}.{1}".format(i,r));a.set(t.VIEWER_QUERY_STRING_KEY,o)}return a.set(t.PROJECT_QUERY_STRING_KEY,encodeURIComponent(e.id)),"{0}{1}".format(n,s.queryStringDictionaryToString(a))},e.prototype.getSiteID=function(e){if(!e)throw new Error('ProjectManager.getSiteID: parameter "project" is required.');if(!e.properties)return null;var i=e.properties[t.SITE_ID_PROPERTY_NAME];return i?i.string:null},e.prototype.getViewerID=function(e){if(!e)throw new Error('ProjectManager.getViewerID: parameter "project" is required.');if(!e.properties)return null;var i=e.properties[t.VIEWER_ID_PROPERTY_NAME];return i?i.string:null},e.prototype.validateProjectOwnership=function(e){return this.app.site.documentStore.isOwner(e)?Promise.resolve(e):Promise.reject(this._getResource("language-project-error-owner"))},e.prototype._initializeDiscoveryProvider=function(){var e=this;return this._serviceDiscovery?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var t=e.app.site,i=new d.SiteServiceDiscoveryProvider;i.initialize(t),e._serviceDiscovery=i})},e.prototype._validateAgainstServiceDiscovery=function(e){var t=this,i={mapService:e,trusted:!1};return e.isUserCreated&&e.userLayerType===p.UserLayerType.LAYER_ADDITION?this._initializeDiscoveryProvider().then(function(){return t._serviceDiscovery.findServices(e.serviceUrl)}).then(function(e){return Array.isArray(e)&&e.some(function(e){return!!e.isWhitelisted})?i.trusted=!0:i.trusted=!1,i})["catch"](function(){return i.trusted=!1,i}):(i.trusted=!0,Promise.resolve(i))},e.prototype._excludeUnsafeState=function(){var e=this,t=this.app.site.essentialsMap.mapServices;return Promise.map(t,function(t){return e._validateAgainstServiceDiscovery(t)}).then(function(t){for(var i=0,r=t;i<r.length;i++){var n=r[i];n.trusted||e.convert.exclude(n.mapService,h.ConversionType.GCX_MAP_SERVICE)}})},e.prototype._exportState=function(){var e=this;return this.convert.clearCache(),this._excludeUnsafeState().then(function(){var t=e._getModules(),i={};return Object.keys(t).forEach(function(e){i[e]=Promise["try"](function(){return t[e].exportState()})}),c.PromiseUtils.propsSkipRejected(i)}).then(function(t){for(var i in t)t[i]||delete t[i];var r={mapScale:e.app.map.getScale(),mapCenter:e.convert.fromEsriGeometry(e.app.map.extent.getCenter()),moduleState:t};return e._filterApplicationState(r)}).then(function(t){return e.encodeReferences(t),t})},e.prototype._applyState=function(e){var t=this;if(!e)return Promise.resolve();this.decodeReferences(e);var i=e.moduleState||[];return Promise.map(Object.keys(i),function(e){var r=t._getModules()[e];if(r){var n=i[e];return n.serialVersion||(n.serialVersion=1),Promise["try"](function(){return r.applyState(n)})["catch"](function(i){return t.app.trace.warning('Unable to restore project state for module "{0}": {1}'.format(e,i))})}})["return"]()},e.prototype._applyMapExtent=function(e){this.app.site.essentialsMap.extentManager.setScaleWithPriority(e.content.mapScale,Number.MAX_VALUE);var t=this.convert.toEsriGeometry(e.content.mapCenter);this.app.site.essentialsMap.extentManager.centerAtWithPriority(t,Number.MAX_VALUE)},e.prototype._getResource=function(e){return this.app.getResource("Mapping.Infrastructure",e)},e.prototype._getModules=function(){return this.app.moduleManager._modules},e.prototype._beginLoad=function(e){var t=this;return this.app.waitUntilSiteInitialized().then(function(){if(t.isLoading)throw new Error("Cannot load a new project until the current project has finished loading.");var i=t.getSiteID(e);if(t.app.site.id!==i)throw new Error('The project "{0}" was created for the Essentials site ID "{1}" and is not compatible with this site.'.format(e.title,i));t.convert.clearCache(),t.isLoading=!0,t.current=e,t._applyMapExtent(e)})},e.prototype._finishLoad=function(){var e=this;setTimeout(function(){return e._applyMapExtent(e.current)},150),this.app.event("ProjectLoadedEvent").publish(this.current),this.isLoading=!1},e.prototype._filterApplicationState=function(e){var t=this,i={mapCenter:this.filter.point,mapScale:!0,moduleState:{},isDecoded:!0},r=this._getModules();return Promise.map(Object.keys(r),function(n){var a=r[n];if(a){var o=a.getStateFilter();if(e.moduleState[n]&&!o)return void t.app.trace.warning('Module "{0}" has project state, but has no defined state filter. A module that participate in projects must implement ModuleBase.getStateFilter().'.format(n));"object"==typeof o&&(o=$.extend({},o,{serialVersion:!0})),i.moduleState[n]=o}}).then(function(){return u.ObjectFilter.filter(e,i,{XssHtmlValidator:{defaultContentPolicy:t.app.defaultContentPolicy}})})},e.prototype.encodeReferences=function(e){if(e){var t=new RegExp(m,"g"),i=new WeakMap,r=[],n=function(e){Array.isArray(e)||i.set(e,m+r.join(m));for(var a=0,o=Object.keys(e);a<o.length;a++){var s=o[a],l=e[s];if(l&&"object"==typeof l){var c=i.get(l);c?e[s]=c:(r.push((s+"").replace(t,f)),n(l),r.pop())}else l&&"string"==typeof l&&l.startsWith(m)&&(e[s]=l.replace(m,f))}};n(e),delete e.isDecoded}},e.prototype.decodeReferences=function(e){if(e&&!e.isDecoded){var t=new RegExp(f.replace("\\","\\\\"),"g"),i=new WeakMap,r=function(n){if(!i.has(n)){i.set(n,!0);for(var a=0,o=Object.keys(n);a<o.length;a++){var s=o[a],l=n[s];if(l&&"string"==typeof l)if(l.startsWith(m)){for(var c=l.split(m).map(function(e){return e.replace(t,m)}),u=e,d=1;d<c.length;d++){var p=c[d];p&&u&&(u=u[p])}n[s]=u}else l.startsWith(f)&&(n[s]=l.replace(f,m));else l&&"object"==typeof l&&r(l)}}};r(e),e.isDecoded=!0}},e}();t.ProjectManager=y})},"geocortex/infrastructure/webMap/BaseMap":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/Bookmark":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/WebMap":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/WebMapManager":function(){define(["require","exports","geocortex/infrastructure/webMap/WebMapConverter","geocortex/infrastructure/webMap/WebMapFilter","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/ArrayUtils","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,i,r,n,a,o){"use strict";var s=function(){function e(e){if(!e)throw new Error("ProjectManager: Parameter 'app' is required.");this.app=e,this.convert=new i.WebMapConverter(e),this.filter=new r.WebMapFilter(e)}return e.prototype.create=function(){var e=this;if(!this.app.site||!this.app.site.isInitialized)throw new Error("WebMapConverter.fromCurrentMap: The Essentials site for this application is missing or not yet initialized.");this.convert.clearCache();var t=this.app.site.essentialsMap,i=function(e,t){console.warn('Unable to convert map service "{0}" to web map format: {1}'.format(e.displayName,t))},r=n.MapServiceFunction,s=t.mapServices.filter(function(e){return e.mapServiceFunction===r.OPERATIONAL}).reverse(),l=a.ArrayUtils.mapWithErrorCallback(s,function(t){return e.convert.fromGcxMapService(t)},i),c=o.getGraphicsLayersExceptExcluded(this.app,[o.ExcludeFromEnum.WebMapName]).filter(function(e){return e.graphics.length>0});c.forEach(function(t){try{l.push(e.convert.fromEsriLayer(t))}catch(i){console.warn('Unable to convert graphics layer "{0}" to web map format: {1}'.format(t.id,i))}});var u=t.mapServices.filter(function(e){return e.isVisible()&&e.mapServiceFunction===r.BASE}).reverse(),d="",p=a.ArrayUtils.mapWithErrorCallback(u,function(t){return e.convert.fromGcxMapService(t)},i);if(u.length){var h=t.baseMaps.filter(function(e){return u.every(function(t){return e.services.some(function(e){return e.mapService===t})})});d=1===h.length?h[0].displayName:u[u.length-1].displayName}return p.length||(d="Light Gray Canvas",p[0]={id:"World_Light_Gray_Base_1486",layerType:"ArcGISTiledMapServiceLayer",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"}),this.app.bookmarks["export"]().then(function(e){return{operationalLayers:l,baseMap:{title:d,baseMapLayers:p},bookmarks:e,version:"1.7"}})},e}();t.WebMapManager=s})},"geocortex/infrastructure/Bookmark":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/BookmarkManager":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e[e.Site=0]="Site",e[e.User=1]="User",e[e.Project=2]="Project"}(i=t.BookmarkSource||(t.BookmarkSource={}));var r="bookmarks",n=function(){function e(e){if(this._projectBookmarks=[],!e)throw new Error('Parameter "app" required.');this.app=e}return e.prototype.getAll=function(){var e=this;return Promise.join(this.getSiteBookmarks(),this.getUserBookmarks()).spread(function(t,i){return(t||[]).concat(i).concat(e._projectBookmarks)})},e.prototype.getUserBookmarks=function(){var e=this;return new Promise(function(t,i){e.app.store.get(r,function(i){var r=[];if(i)try{r=JSON.parse(i)}catch(n){e.app.trace.warning("Unable to parse user bookmarks: {0}".format(n))}var a=r.map(function(t){return e._deserialize(t)});t(a)},i)})},e.prototype.getSiteBookmarks=function(){var e=this;return this.app.waitUntilSiteInitialized().then(function(){return(e.app.site.namedExtents||[]).map(function(e){return{name:e.displayName,extent:e.extent,source:i.Site}})})},e.prototype.getProjectBookmarks=function(){return Promise.resolve(this._projectBookmarks)},e.prototype.add=function(e){var t=this;if(!e)throw new Error('Parameter "bookmark" required.');return e.source=e.source||i.User,e.source===i.Project?(this._projectBookmarks.push(e),this.app.event("BookmarksModifiedEvent").publish(""),Promise.resolve()):this.getUserBookmarks().then(function(i){return i.push(e),t._save(i)})},e.prototype.remove=function(e){var t=this;if(e)return"string"==typeof e?this._projectBookmarks=this._projectBookmarks.filter(function(t){return t.name!==e}):"object"==typeof e&&(this._projectBookmarks=this._projectBookmarks.filter(function(t){return t!==e})),this.getUserBookmarks().then(function(i){return"string"==typeof e?i=i.filter(function(t){return t.name!==e}):"object"==typeof e&&(i=i.filter(function(t){return t!==e})),t._save(i)})},e.prototype["export"]=function(e){var t=this;return e=e||[i.Site,i.User,i.Project],this.getAll().then(function(i){return i.filter(function(t){return e.indexOf(t.source)>=0}).map(function(e){return{name:e.name,extent:t.app.project.convert.fromEsriGeometry(e.extent)}})})},e.prototype._save=function(e){var t=this;return new Promise(function(i,n){var a=JSON.stringify((e||[]).map(function(e){return t._serialize(e)}));t.app.store.set(r,a,function(e,r){i(),t.app.event("BookmarksModifiedEvent").publish(a)},n)})},e.prototype._serialize=function(e){return{displayName:e.name,extent:this.app.webMap.convert.fromEsriGeometry(e.extent),isUserDefined:!0}},e.prototype._deserialize=function(e){return{name:e.displayName,extent:this.app.webMap.convert.toEsriGeometry(e.extent),source:i.User}},e}();t.BookmarkManager=n})},"geocortex/infrastructure/Viewer":function(){define(["require","exports","geocortex/framework/application/Application","geocortex/framework/observables","geocortex/infrastructure/accessibility/AccessibilityManager","geocortex/infrastructure/coordinates/CoordinatesManager","geocortex/infrastructure/FeatureSetManager","geocortex/infrastructure/search/SearchManager","geocortex/infrastructure/HighlightManager","geocortex/infrastructure/native/NativeManager","geocortex/infrastructure/offline/OfflineManager","geocortex/infrastructure/states/StateManager","geocortex/infrastructure/undo/UndoManager","geocortex/infrastructure/menus/MenuRegistry","geocortex/infrastructure/tools/ToolRegistry","geocortex/infrastructure/toolbarGroup/ToolbarGroupRegistry","geocortex/infrastructure/clickableGraphics/ClickableGraphicsRegistry","geocortex/infrastructure/project/ProjectManager","geocortex/infrastructure/webMap/WebMapManager","geocortex/infrastructure/BookmarkManager","geocortex/infrastructure/ContentPolicy","geocortex/infrastructure/FilterUtils","geocortex/essentials/documents/DocumentStore","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/GeometryUtils","geocortex/essentials/OAuth2Client"],function(require,exports,Application_1,observables_21,AccessibilityManager_1,CoordinatesManager_2,FeatureSetManager_1,SearchManager_2,HighlightManager_1,NativeManager_1,OfflineManager_1,StateManager_1,UndoManager_1,MenuRegistry_1,ToolRegistry_1,ToolbarGroupRegistry_1,ClickableGraphicsRegistry_1,ProjectManager_1,WebMapManager_1,BookmarkManager_1,ContentPolicy_1,FilterUtils_5,DocumentStore_1,FormatUtils_6,GeometryUtils_14,OAuth2Client_1){"use strict";var ViewerApplication=function(_super){function ViewerApplication(configObject,hostElement,id,configTokens){var _this=_super.call(this,configObject,hostElement,id,configTokens)||this;return _this.version=eval("geocortex.essentialsHtmlViewer.version"),_this.markupLayer=new observables_21.Observable,_this.isArcGisWebApp=!1,_this._workflowActivityDispatcher=null,_this._activityTypeHandlerQueue=[],_this._activityIdHandlerQueue=[],_this._localeResourcesLoaded=!1,_this._initialProjectPromise=null,_this._momentLocales=["af","ar","ar-MA","ar-SA","ar-TN","az","be","bg","bn","bo","br","bs","ca","cs","cv","cy","da","de","de-AT","el","en-AU","en-CA","en-GB","eo","es","et","eu","fa","fi","fo","fr","fr-CA","fy","gl","he","hi","hr","hu","hy-AM","id","is","it","ja","jv","ka","km","ko","lb","lt","lv","me","mk","ml","mr","ms","ms-MY","my","nb","ne","nl","nn","pl","pt","pt-BR","ro","ru","si","sk","sl","sq","sr","sr-Cyrl","sv","ta","th","tl-PH","tr","tzl","tzm","tzm-Latn","uk","uz","vi","zh-CN","zh-TW"],_this._globalizeLocales=["af","ar","ar-MA","ar-SA","ar-TN","az","be","bg","bn","bo","br","bs","ca","cs","cy","da","de","de-AT","el","en","en-AU","en-CA","en-GB","eo","es","et","eu","fa","fi","fo","fr","fr-CA","fy","gl","he","hi","hr","hu","hy","id","is","it","ja","ka","km","ko","lb","lt","lv","mk","ml","mr","ms","my","nb","ne","nl","nn","pl","pt","ro","ru","si","sk","sl","sq","sr","sr-Cyrl","sv","ta","th","tr","tzm","tzm-Latn","uk","uz","vi","zh"],_this.___uaIsiPad=!!navigator.userAgent.match(/iPad/i),_this.accessibilityManager=new AccessibilityManager_1.AccessibilityManager(_this),_this.coordinatesManager=new CoordinatesManager_2.CoordinatesManager(_this),_this.featureSetManager=new FeatureSetManager_1.FeatureSetManager(_this),_this.searchManager=new SearchManager_2.SearchManager(_this),_this.highlightManager=new HighlightManager_1.HighlightManager(_this),_this.nativeManager=new NativeManager_1.NativeManager(_this),_this.offlineManager=new OfflineManager_1.OfflineManager(_this,"Mapping.Infrastructure"),_this.toolRegistry=new ToolRegistry_1.ToolRegistry(_this),_this.menuRegistry=new MenuRegistry_1.MenuRegistry(_this),_this.toolbarGroupRegistry=new ToolbarGroupRegistry_1.ToolbarGroupRegistry(_this),_this.stateManager=new StateManager_1.StateManager(_this,"Mapping.Infrastructure"),_this.undoManager=new UndoManager_1.UndoManager(_this),_this.project=new ProjectManager_1.ProjectManager(_this),_this.webMap=new WebMapManager_1.WebMapManager(_this),_this.bookmarks=new BookmarkManager_1.BookmarkManager(_this),_this.clickableGraphics=new ClickableGraphicsRegistry_1.ClickableGraphicsRegistry(_this),_this._applicationContentPolicy=new ContentPolicy_1.ContentPolicy(_this),_this._registerApplicationLevelCommands(),_this}return __extends(ViewerApplication,_super),Object.defineProperty(ViewerApplication.prototype,"defaultContentPolicy",{get:function(){return this._applicationContentPolicy},enumerable:!0,configurable:!0}),ViewerApplication.prototype.followNavigationLink=function(e){var t=(e.url,e.element),i={uri:e.url,attribute:"href",tag:"a",type:FilterUtils_5.UriType.NavigableLink,linkChallengeCallback:function(e,i){if(e){var r="_blank";t&&t.hasAttribute("target")&&(r=t.getAttribute("target")),window.open(i.uri,r)}return!1}},r=this._applicationContentPolicy.tryScreenNavLinkSynchronously(i);return!!r||(this._executeOpenWebPage(e),!1)},ViewerApplication.prototype._registerApplicationLevelCommands=function(){this.command("OpenWebPage").register(this,this._executeOpenWebPage)},ViewerApplication.prototype._executeOpenWebPage=function(e){var t="string"==typeof e?e:e.url,i="string"==typeof e?null:e.element?e.element:null,r="string"==typeof e?null:e.isLink?e.isLink:null,n=["http","https","ftp","ftps","gopher","mailto","arcgis-navigator","comgooglemaps","comgooglemaps-x-callback","comgooglemapsurl"];r||(t=decodeURIComponent(t));var a=new dojo._Url(t);if(n.indexOf(a.scheme)<0)return void this.trace.warning("Could not open '"+t+"': Invalid URI scheme.");var o=function(e,t){var i="_blank";t&&t.hasAttribute("target")&&(i=t.getAttribute("target")),window.open(e,i)},s={uri:t,attribute:"href",tag:"a",type:FilterUtils_5.UriType.NavigableLink,linkChallengeCallback:function(e,t){return e&&o(t.uri,i),!1}},l=this._applicationContentPolicy.hasFlag(1);return l||this._applicationContentPolicy.tryScreenNavLinkSynchronously(s)?(o(s.uri,i),!1):(s.forcePrompt=!0,void this._applicationContentPolicy.screenUris([s]))},ViewerApplication.prototype.initialize=function(){var e=this;document.all&&!document.querySelector&&(this.debugMode=!0);var t=this.configUri?this.configUri.split("/"):window.location.href.split("/"),i=t.slice(0,t.length-1).join("/")+"/";this.configTokens.ViewerConfigUri=i,this.getUrlParameter("gcxLocalServer")&&(this.localServerAddress=this.getUrlParameter("gcxLocalServer")),this.getUrlParameter("gcxLocalServerNamespace")&&(this.localServerNamespace=this.getUrlParameter("gcxLocalServerNamespace")),this.getUrlParameter("gcxLocalServerToken")&&(this.localServerToken=this.getUrlParameter("gcxLocalServerToken")),this._offlineManagerLoaded=this.offlineManager.load(),_super.prototype.initialize.call(this);var r=this.getUrlParameter(ProjectManager_1.PROJECT_QUERY_STRING_KEY);if(r){var n=this.getUrlParameter(DocumentStore_1.LINK_QUERY_STRING_KEY);n&&this.waitUntilSiteInitialized().then(function(){return e.site.documentStore.setGuestLink(n)}),this.waitUntilAllLibrariesLoaded().then(function(){return e.event("ProjectLoadingEvent").publish(r)}),this._initialProjectPromise=this.project.read(r).then(function(t){return e.project._beginLoad(t)})["catch"](function(t){e.trace.error("Error loading project: {0}".format(t.message),t)});var a=this.initialStateAppliedCallback;this.initialStateAppliedCallback=function(t){e.project.isLoading&&e.project._finishLoad(),a&&a(t)}}},ViewerApplication.prototype.waitUntilSiteInitialized=function(){var e=this;return new Promise(function(t,i){e.site&&e.site.isInitialized?t():(e.event("SiteInitializedEvent").once(e,function(e){t()}),e.event("SiteInitializationFailedEvent").once(e,function(e){i(e)}),e.event("SiteAuthorizationFailedEvent").once(e,function(e){i(e)}))})},ViewerApplication.prototype.waitUntilDocumentStoreInitialized=function(){var e=this;return this.waitUntilSiteInitialized().then(function(){return e.site.documentStore.onInitialized()})},ViewerApplication.prototype.waitUntilOfflineManagerLoaded=function(){return this._offlineManagerLoaded},ViewerApplication.prototype.waitUntilMapLoaded=function(){var e=this;return new Promise(function(t,i){if(e.map&&e.map.loaded)t();else if(e.map)var r=e.map.on("load",function(e){r.remove(),t()});else e.event("SiteInitializingEvent").once(e,function(){var i=e.map.on("load",function(e){i.remove(),t()})})})},ViewerApplication.prototype.waitUntilServiceLayerLoaded=function(e){return new Promise(function(t,i){if(e.loadError)i(e.loadError);else if(e.loaded)t();else var r=e.on("load",function(e){r.remove(),n.remove(),t()}),n=e.on("error",function(e){r.remove(),n.remove(),i(e.error)})})},ViewerApplication.prototype.waitUntilSiteServiceLayersLoaded=function(){var e=this;return new Promise(function(t,i){e.site&&e.site.serviceLayersLoaded?t():(e.event("SiteServiceLayersLoadedEvent").once(e,function(e){t()}),e.event("SiteInitializationFailedEvent").once(e,function(e){i(e)}),e.event("SiteAuthorizationFailedEvent").once(e,function(e){i(e)}))})},ViewerApplication.prototype.waitUntilAllLibrariesLoaded=function(){var e=this;return new Promise(function(t,i){e.allLibrariesLoaded?t():e.event("ViewerLibrariesDownloadedEvent").once(e,function(e){t()})})},ViewerApplication.prototype.waitUntilViewInitialized=function(e){var t=this;return new Promise(function(i,r){var n=t.viewManager.getViewById(e);if(n&&n.initiallyBound)i(n);else var a=t.event("ViewInitializedEvent").subscribe(t,function(r){r.id===e&&(i(r),t.event("ViewInitializedEvent").unsubscribe(a))})})},ViewerApplication.prototype.registerActivityTypeHandler=function(e,t){this._workflowActivityDispatcher?this._workflowActivityDispatcher.registerActivityHandler(e,t):this._activityTypeHandlerQueue.push({typeName:e,handler:t})},ViewerApplication.prototype.registerActivityIdHandler=function(e,t){this._workflowActivityDispatcher?this._workflowActivityDispatcher.registerExternalIdHandler(e,t):this._activityIdHandlerQueue.push({id:e,handler:t})},ViewerApplication.prototype.getWorkflowActivityDispatcher=function(){return this._workflowActivityDispatcher},ViewerApplication.prototype.setWorkflowActivityDispatcher=function(e){this._workflowActivityDispatcher=e;for(var t=0;t<this._activityTypeHandlerQueue.length;++t){var i=this._activityTypeHandlerQueue[t];this._workflowActivityDispatcher.registerActivityHandler(i.typeName,i.handler)}this._activityTypeHandlerQueue.length=0;for(var t=0;t<this._activityIdHandlerQueue.length;++t){var r=this._activityIdHandlerQueue[t];this._workflowActivityDispatcher.registerExternalIdHandler(r.id,r.handler)}this._activityIdHandlerQueue.length=0},ViewerApplication.prototype.shutdown=function(e){this.toolRegistry.clear(),this.undoManager.destroy(),this.clickableGraphics.clear(),_super.prototype.shutdown.call(this,e)},ViewerApplication.prototype.onConfigurationLoaded=function(e){var t=this,i=e.configuration,r=!0;if(i.hasOwnProperty("application")&&i.application.hasOwnProperty("contentPolicy")){var n=i.application.contentPolicy;n.disableSecurityPrompt&&this._applicationContentPolicy.setFlag(1),n.disablePromptOnImages===!1&&(r=!1),n.trustExactUrl===!0&&this._applicationContentPolicy.setFlag(4)}r&&this._applicationContentPolicy.setFlag(2),this._applicationContentPolicy.screenUris([]),i&&i.hasOwnProperty("application")&&i.application.locale&&(this.locale=i.application.locale),this.urlParameters&&this.getUrlParameter("locale")&&(this.locale=this.getUrlParameter("locale"));var a=this.locale||"en-US";document.documentElement.setAttribute("lang",a),this._loadThirdPartyLocaleResources().then(function(){if($&&$.timepicker){var r=Object.getPrototypeOf($.timepicker);r._onTimeChange&&(r._base_onTimeChange=r._onTimeChange,r._onTimeChange=function(){if(this._base_onTimeChange(),this._defaults&&this._defaults.gcxTimeFormat&&this.$timeObj){var e=FormatUtils_6.formatDate($(this.$input).datepicker("getDate"),this._defaults.gcxTimeFormat);this.$timeObj.text(e)}if(this._defaults&&this._defaults.gcxTimeStyle===!0){var t=this.$timeObj?this.$timeObj.prevObject:null;t&&1!==$(".info-message",t).length&&t.append("<div class='info-message'></div>");var i=t?$(".info-message",t):null;i&&(i.text(this._defaults.timeText+": "+this.$timeObj.text()),this.$timeObj.css("display","none"),$(this.$timeObj.selector+"_label").css("display","none"))}})}if($&&$.datepicker&&$.datepicker._showDatepicker&&($.datepicker.__base_showDatepicker=$.datepicker._showDatepicker,$.datepicker._showDatepicker=function(e){this.__base_showDatepicker(e);var t=$(e).siblings(".gcxDatepicker");t.length&&t.focus()}),i.hasOwnProperty("application")&&i.application.hasOwnProperty("geometryServiceUrl")&&(esri.config.defaults.geometryService=new esri.tasks.GeometryService(i.application.geometryServiceUrl)),i.hasOwnProperty("application")&&i.application.hasOwnProperty("datumTransforms")?GeometryUtils_14.registerDatumTransforms(i.application.datumTransforms):GeometryUtils_14.registerDefaultDatumTransforms(),e.configuration.application&&e.configuration.application.oAuth2ClientId){window.location.href;if(!OAuth2Client_1.OAuth2Client.applicationHasImplicitGrant()&&!OAuth2Client_1.OAuth2Client.applicationHasImplicitGrantError()){var n=e.configuration.application.oAuth2AuthorizeUri||"http://www.arcgisonline.com/sharing/oauth2/authorize";return OAuth2Client_1.OAuth2Client.redirectToLogOnPage(n,e.configuration.application.oAuth2ClientId),void(t.abortInitialization=!0)}}_super.prototype.onConfigurationLoaded.call(t,e)})},ViewerApplication.prototype.getInitialState=function(e,t){var i=this;return!this._initialProjectPromise||this._initialProjectPromise.isRejected()?Promise.resolve(null):this._initialProjectPromise.then(function(){var t=i.project.current;return t&&t.content&&t.content.moduleState?t.content.moduleState[e]:null})},Object.defineProperty(ViewerApplication.prototype,"locale",{get:function(){return this._locale},set:function(e){this._locale=this._canonicalizeLocale(e),this._localeResourcesLoaded&&(moment.locale(this._getMomentLocaleForLocale(this._locale)),_globalize.locale(this._getGlobalizeLocaleForLocale(this._locale)))},enumerable:!0,configurable:!0}),ViewerApplication.prototype.doWhenMapInitialized=function(e){var t=this;if(this.isArcGisWebApp)e();else if(this.site&&this.site.isInitialized)e();else var i=this.eventRegistry.event("SiteServiceLayersLoadedEvent").subscribe(this,function(){t.eventRegistry.event("SiteServiceLayersLoadedEvent").unsubscribe(i),e()})},ViewerApplication.prototype._loadThirdPartyLocaleResources=function(){var e,t=this;return"function"==typeof define&&(e=define.amd,delete define.amd),Promise.all([this._loadMomentLocaleData(),this._loadGlobalizeLocaleData()]).then(function(){"function"==typeof define&&(define.amd=e),t._localeResourcesLoaded=!0},function(t){"function"==typeof define&&(define.amd=e)})},ViewerApplication.prototype._loadMomentLocaleData=function(){var e=this,t=this._getMomentLocaleForLocale(this.locale);return moment.localeData(t)?Promise.resolve():new Promise(function(i,r){if("en"===t)i();else{var n="./Resources/Scripts/moment/locale/"+t+".js";e.includeScript(n,function(e){moment.locale(t),i()},r)}})},ViewerApplication.prototype._loadGlobalizeLocaleData=function(){var e=this._getGlobalizeLocaleForLocale(this.locale),t="./Resources/Scripts/globalize/locale/"+e+".json";return this.fetchConfigResource({url:t}).then(function(t){var i=JSON.parse(t);_globalize.load(i),_globalize.locale(e)})},ViewerApplication.prototype._getMomentLocaleForLocale=function(e){
return this._getBestMatchLocale(e,this._momentLocales)},ViewerApplication.prototype._getGlobalizeLocaleForLocale=function(e){return this._getBestMatchLocale(e,this._globalizeLocales)},ViewerApplication.prototype._getBestMatchLocale=function(e,t){e=this._canonicalizeLocale(e);var i=this._parseLocale(e);if(t.indexOf(e)>=0)return e;if(i.script){if(e=i.language+"-"+i.script,t.indexOf(e)>=0)return e;if(e=i.language+"-"+i.territory,t.indexOf(e)>=0)return e}else if(i.territory&&(e=i.language,t.indexOf(e)>=0))return e;return"en"},ViewerApplication.prototype._parseLocale=function(e){if(!e)throw new Error("Invalid locale: {0}".format(e));var t=e.split("-");if(t.length<1||t.length>3||t.some(function(e){return 0===e.length}))throw new Error("Invalid locale: {0}".format(e));var i={language:t[0].toLowerCase()};return 2==t.length?2==t[1].length?i.territory=t[1].toUpperCase():i.script=t[1][0].toUpperCase()+t[1].slice(1).toLowerCase():3===t.length&&(i.script=t[1][0].toUpperCase()+t[1].slice(1).toLowerCase(),i.territory=t[2].toUpperCase()),i},ViewerApplication.prototype._canonicalizeLocale=function(e){var t=this._parseLocale(e),i=t.language;return t.script&&(i+="-"+t.script),t.territory&&(i+="-"+t.territory),i},ViewerApplication}(Application_1.Application);exports.ViewerApplication=ViewerApplication})},"geocortex/infrastructure/AreaOfInterestMask":function(){define(["require","exports","geocortex/infrastructure/GeometryUtils","geocortex/framework/utils/utils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(e,t,i,r,n,a){"use strict";var o=function(){function e(e,t){this.app=e,this._enabled=!0,this.matchMapBackground=!1,this.fillColor=null,this.boundaryColor=new esri.Color("red"),this.boundaryWidth=2,this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.layerId=n.AOI_MASK_LAYER_ID}return e.prototype.show=function(e){var t=this;this._aoi=e,this.app.waitUntilSiteServiceLayersLoaded().then(function(){if(t._enabled){var r=t._getLayer();if(r.clear(),(t.fillColor||t.boundaryStyle!==esri.symbol.SimpleFillSymbol.STYLE_NULL)&&r.show(),t.fillColor){for(var n=new esri.geometry.Polygon(e.spatialReference),a=t.app.map.getLayer(t.app.map.layerIds[0]),o=i.toRing(a.fullExtent.expand(1.5)),s=0;s<e.rings.length;s++){var l=e.rings[s];n.rings.push(dojo.clone(l).reverse())}n.rings.push(o);var c=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL),t.fillColor),u=new esri.Graphic({geometry:n});u.setSymbol(c),t.app.map.graphics.add(u)}if(t.boundaryStyle!==esri.symbol.SimpleFillSymbol.STYLE_NULL){var d=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL,new esri.symbol.SimpleLineSymbol(t.boundaryStyle,t.boundaryColor,t.boundaryWidth),new esri.Color("white")),p=new esri.Graphic({geometry:e});p.setSymbol(d),r.add(p)}if(t.matchMapBackground&&t.fillColor){var h=t._getMapNode();t._originalMapBackground=h.css("background-color"),h.css("background-color","rgba("+t.fillColor.r+","+t.fillColor.g+","+t.fillColor.b+","+t.fillColor.a+")")}}})},e.prototype.hide=function(){this._aoi=null,a.removeInternalGraphicsLayer(this.layerId,this.app,a.GraphicsLayerType.Pushpin),this.matchMapBackground&&this._getMapNode().css("background-color",this._originalMapBackground)},e.prototype.enable=function(){this._enabled=!0,this._aoi&&this.show(this._aoi)},e.prototype.disable=function(){this._enabled=!1},e.prototype.configure=function(e){e&&(r.isNullOrUndefined(e.boundaryColor)||(this.boundaryColor=new esri.Color(e.boundaryColor)),r.isNullOrUndefined(e.boundaryWidth)||(this.boundaryWidth=e.boundaryWidth),r.isNullOrUndefined(e.boundaryStyle)||("null"==e.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_NULL:"solid"==e.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_SOLID:"dash"==e.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_DASH:"dot"==e.boundaryStyle&&(this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_DOT)),r.isNullOrUndefined(e.enabled)||(e.enabled?this.enable():this.disable()),r.isNullOrUndefined(e.fillColor)||(this.fillColor=new esri.Color(e.fillColor)),r.isNullOrUndefined(e.layerId)||(this.layerId=e.layerId),r.isNullOrUndefined(e.matchMapBackground)||(this.matchMapBackground=e.matchMapBackground))},e.prototype._getLayer=function(){return a.getInternalGraphicsLayer(this.layerId,this.app,a.GraphicsLayerType.Pushpin)},e.prototype._getMapNode=function(){return $(".esriMapContainer").first().parent()},e}();t.AreaOfInterestMask=o})},"geocortex/infrastructure/DistanceConverter":function(){define(["require","exports","geocortex/essentials/DistanceUnit"],function(e,t,i){"use strict";function r(e){var t=l[e];if(t)return t;throw new Error("Units cannot be converted because are not supported")}function n(e,t){var i=r(e);return t/i}function a(e,t){var i=r(e);return t*i}function o(e,t){var r=!1,n=!1;if(e===t)return!0;for(var a in i.DistanceUnitType)i.DistanceUnitType.hasOwnProperty(a)&&(i.DistanceUnitType[a]===e?r=!0:i.DistanceUnitType[a]===t&&(n=!0));return n&&r}function s(e,t,i){if(!t||e===i)return t;var r=a(i,t);return n(e,r)}var l=(Math.PI/180,{});l[i.DistanceUnitType.METERS]=1,l[i.DistanceUnitType.MILLIMETERS]=.001,l[i.DistanceUnitType.CENTIMETERS]=.01,l[i.DistanceUnitType.DECIMETERS]=.1,l[i.DistanceUnitType.KILOMETERS]=1e3,l[i.DistanceUnitType.INCHES]=.0254,l[i.DistanceUnitType.FEET]=.3048,l[i.DistanceUnitType.US_SURVEY_FEET]=.3048006096012192,l[i.DistanceUnitType.YARDS]=.9144,l[i.DistanceUnitType.MILES]=1609.344,l[i.DistanceUnitType.NAUTICAL_MILES]=1852,l[i.DistanceUnitType.DEGREES]=111319.49079327357,l[i.DistanceUnitType.GRADS]=100187.54171394621,l[i.DistanceUnitType.RADIANS]=6378136.999999998,t.canConvert=o,t.convert=s})},"geocortex/infrastructure/ExportTilesUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t,r){var n=e+"/"+t;return c.hasOwnProperty(e)&&(n+="/submitjob"),esri.request({callbackParamName:"callback",content:dojo.mixin({f:"json"},r),handleAs:"json",url:n}).then(function(n){return!n.jobStatus&&n.executionType&&n.parameters?(c[e]=!0,i(e,t,r)):n})}function r(e,t,i,n,a){switch(void 0===n&&(n=null),void 0===a&&(a=1e3),i.jobStatus){case esri.tasks.JobInfo.STATUS_CANCELLED:case esri.tasks.JobInfo.STATUS_DELETED:case esri.tasks.JobInfo.STATUS_FAILED:case esri.tasks.JobInfo.STATUS_TIMED_OUT:return Promise.reject(o(i));case esri.tasks.JobInfo.STATUS_SUCCEEDED:return Promise.resolve(i);default:return Promise.delay(a).then(function(){return esri.request({callbackParamName:"callback",content:n?{f:"json",token:n}:{f:"json"},handleAs:"json",url:e+"/"+t+"/jobs/"+i.jobId})}).then(function(i){return r(e,t,i,n,Math.min(2*a,6e4))})}}function n(e,t,i,r,n){return void 0===n&&(n=null),esri.request({callbackParamName:"callback",content:n?{f:"json",token:n}:{f:"json"},handleAs:"json",url:e+"/"+t+"/jobs/"+i+"/"+r})}function a(e){return esri.request({callbackParamName:"callback",content:{f:"json"},handleAs:"json",url:e})}function o(e){if(!e||!e.messages)return"";var t=e.messages.filter(function(e){return e.type===esri.tasks.GPMessage.TYPE_ERROR}),i=t.filter(function(e){return/^ERROR \d+:/.test(e.description)});return i.length>0&&(t=i),t.reduce(function(e,t){return t.description.length>e.length?t.description:e},"")}function s(e,t){for(var o="string"==typeof e?e:e.url;"/"===o[o.length-1];)o=o.substring(0,o.length-1);return i(o,"exportTiles",t).then(function(e){return r(o,"exportTiles",e,t.token)}).then(function(e){return n(o,"exportTiles",e.jobId,e.results.out_service_url.paramUrl,t.token)}).then(function(e){return a(e.value)}).then(function(e){return e.files})}function l(e,t){for(var a="string"==typeof e?e:e.url;"/"===a[a.length-1];)a=a.substring(0,a.length-1);return i(a,"estimateExportTilesSize",t).then(function(e){return r(a,"estimateExportTilesSize",e,t.token)}).then(function(e){return n(a,"estimateExportTilesSize",e.jobId,e.results.out_service_url.paramUrl,t.token)}).then(function(e){return"string"==typeof e.value?{totalSize:+e.value,totalTilesToExport:null}:e.value})}var c={};t.exportTiles=s,t.estimateExportTilesSize=l})},"geocortex/infrastructure/commands.meta":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){function t(t){for(var i=0;i<e.commandsMetadata.length;i++){var r=e.commandsMetadata[i];if(r.name===t)return r.metadata}return null}function i(){for(var t=[],i=0;i<e.commandsMetadata.length;i++){var r=e.commandsMetadata[i];"public"===r.metadata.visibility&&t.push(r)}return t}e.commandsMetadata=[{name:"ActivateView",metadata:{arguments:"string",description:"Activates a view.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateView",metadata:{arguments:"string",description:"Deactivates a view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleView",metadata:{arguments:"string",description:"Activates or deactivates a view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleLogView",metadata:{arguments:"none",description:"Activates or deactivates log view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLog",metadata:{arguments:"boolean",description:"Shows the log view if the parameter is true.",isHyperlinkable:!0,visibility:"public"}},{name:"HideLog",metadata:{arguments:"none",description:"Hides the log view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleResultsFrame",metadata:{arguments:"none",description:"Activates or deactivates Results frame.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleDataFrame",metadata:{arguments:"none",description:"Activates or deactivates data frame.",isHyperlinkable:!0,visibility:"public"}},{name:"DestroyView",metadata:{arguments:"string",description:"Destroys a view, wiping out its bindings and DOM substructure.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseModalRegion",metadata:{arguments:"none",description:"Closes the ModalWindowRegion.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenWebPage",metadata:{arguments:"string",description:"Opens a web page in another tab/window.",isHyperlinkable:!0,visibility:"public"}},{name:"Alert",metadata:{arguments:"string",description:"Displays an alert.",isHyperlinkable:!0,visibility:"public"}},{name:"Confirm",metadata:{arguments:"list",description:"Displays a confirm.",isHyperlinkable:!0,visibility:"private"}},{name:"ConsoleDir",metadata:{arguments:"object",description:"Displays a representation of the specified parameter object in the browser's debugging console.",isHyperlinkable:!0,visibility:"public"}},{name:"Identify",metadata:{arguments:"esri.geometry.Geometry",description:"Executes an identify operation on a geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedGeometry",metadata:{arguments:"esri.geometry.Geometry",description:"Activates the Buffer Options dialog, buffers input geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedFeature",metadata:{arguments:"esri.Graphic|essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Activates the Buffer Options dialog, buffers input feature geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedFeatureSet",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSet|essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection|string",description:"Activates the Buffer Options dialog, buffers input feature set geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedFeatureSetCollection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection|string",description:"Activates the Buffer Options dialog, buffers input feature set collection geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"Prompt",metadata:{arguments:"object",description:"Displays a prompt.",isHyperlinkable:!0,visibility:"private"}},{name:"StartOfflineSyncAndShowProgress",metadata:{arguments:"string",description:"Starts downloading or syncing an offline map an displays the progress to the user.",isHyperlinkable:!0,visibility:"public"}},{name:"StepZoomIn",metadata:{arguments:"none",description:"Zooms in a step.",isHyperlinkable:!0,visibility:"public"}},{name:"StepZoomOut",metadata:{arguments:"none",description:"Zooms out a step.",isHyperlinkable:!0,visibility:"public"}},{name:"RecenterMapOnNextMapResize",metadata:{arguments:"none",description:"Recenters the map to its existing position the next time the map is resized.",isHyperlinkable:!0,visibility:"public"}},{name:"PanToPoint",metadata:{arguments:"esri.geometry.Geometry",description:"Pans to a point or other type of Geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"PanUp",metadata:{arguments:"none",description:"Pans the map up.",isHyperlinkable:!0,visibility:"public"}},{name:"PlotCoordinates",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateBase|essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateBase[]",description:"Plots a coordinate (or a number of coordinates) on the map.",isHyperlinkable:!1,visibility:"public"}},{name:"PanDown",metadata:{arguments:"none",description:"Pans the map down.",isHyperlinkable:!0,visibility:"public"}},{name:"PanLeft",metadata:{arguments:"none",description:"Pans the map left.",isHyperlinkable:!0,visibility:"public"}},{name:"PanRight",metadata:{arguments:"none",description:"Pans the map right.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToExtent",metadata:{arguments:"esri.geometry.Extent",description:"Zooms to the given extent.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToScale",metadata:{arguments:"number",description:"Zooms to the given scale.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomOutToExtent",metadata:{arguments:"esri.geometry.Extent",description:"Zooms out to the given extent.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToLayerExtent",metadata:{arguments:"geocortex.essentials.Layer",description:"Zooms to the extent of all the features in a layer.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToLayerVisibleScale",metadata:{arguments:"geocortex.essentials.Layer",description:"Zooms to the scale at which features in a layer become visible.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToInitialExtent",metadata:{arguments:"none",description:"Zooms to the initial extent of the current Site.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToPreviousExtent",metadata:{arguments:"none",description:"Zooms to the previous recorded map extent if any.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToNamedExtent",metadata:{arguments:"string",description:"Zooms to the bookmarked extent with the specified name.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToNextExtent",metadata:{arguments:"none",description:"Zooms to the next recorded map extent if any.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToOfflineMapExtent",metadata:{arguments:"none",description:"Zooms to the extent of the currently active offline map.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToFullExtent",metadata:{arguments:"none",description:"Zooms to the full extent of the current Site.",isHyperlinkable:!0,visibility:"public"}},{name:"MapResize",metadata:{arguments:"none",description:"Tells the map control to resize itself. This should be called after altering the map container's dimensions.",isHyperlinkable:!0,visibility:"public"}},{name:"MaximizePanel",metadata:{arguments:"string",description:"Instructs the region hosting a view to maximize itself if it supports this action. As of v2.4, only the BottomPanelRegion and its sub regions support this action.",isHyperlinkable:!0,visibility:"public"}},{name:"RestorePanel",metadata:{arguments:"string",description:"Instructs the region hosting a view to restore itself to default dimensions if it supports this action. As of v2.4, only the BottomPanelRegion and its sub regions support this action.",isHyperlinkable:!0,visibility:"public"}},{name:"AddTemporaryMarkupGeometry",metadata:{arguments:"esri.geometry.Geometry",description:"Adds a temporary markup graphic to the map. The {@link Commands.ClearTemporaryMarkup} command will clear this piece of markup.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearTemporaryMarkup",metadata:{arguments:"none",description:"Removes temporary markup created by the command 'AddTemporaryMarkupGeometry'",isHyperlinkable:!0,visibility:"public"}},{name:"RippleClick",metadata:{arguments:"MouseEvent",description:"Creates a ripple feedback effect when clicking on the map",isHyperlinkable:!1,visibility:"private"}},{name:"ToggleRippleClick",metadata:{arguments:"none",description:"Toggles the visibility of the ripple feedback given for map clicks",isHyperlinkable:!0,visibility:"private"}},{name:"ClearTrustedUrls",metadata:{arguments:"none",description:"Clears list of trusted URLs which are added by clicking 'yes' on potentially untrusted content popup",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Zooms to a feature.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToFeatureIfOutsideMapExtent",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Zooms to a feature if the it's outside of the map's extent, otherwise nothing happens.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSet",description:"Zooms to the extent of all the features in the feature set.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToFeatureSetCollection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Shows all of the features in the Feature Set Collection on the map",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToAllFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Zooms to the extent of all the features.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMap",metadata:{arguments:"none",description:"Activates map view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapElement",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs",description:"Displays an element anchored to a specific point on the map.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapCallout",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs",description:"Displays a map callout anchored to a given point.",isHyperlinkable:!0,visibility:"private"}},{name:"HideMapElement",metadata:{arguments:"string",description:"Removes an element previously anchored to the map using {@link Commands.ShowMapElement}.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapTipResults",metadata:{arguments:"string",description:"Shows map tip results for a FeatureSetCollection previously added to the FeatureSetManager.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapTipResultsInCallout",metadata:{arguments:"string",description:"Shows map tip results for a FeatureSetCollection previously added to the FeatureSetManager, in a floating callout window on the map (the default behavior prior to version 2.4).",isHyperlinkable:!0,visibility:"public"}},{name:"OpenDataFrame",metadata:{arguments:"none",description:"Opens the DataRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseDataFrame",metadata:{arguments:"none",description:"Closes the DataRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"ChangeDataFramePosition",metadata:{arguments:"args: {position: PanelPosition; callback?: () => void",description:"Change the DataRegion position to desidered one, if it is present in the current shell.",isHyperlinkable:!1,visibility:"private"}},{name:"OpenBottomRegion",metadata:{arguments:"none",description:"Opens the BottomPanelRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseBottomRegion",metadata:{arguments:"none",description:"Closes the BottomPanelRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"RunWorkflowById",metadata:{arguments:"string",description:"Runs a workflow.",isHyperlinkable:!0,visibility:"public"}},{name:"RunWorkflowWithGeometry",metadata:{arguments:"object",description:"Runs a workflow with a geometry used as an input argument.",isHyperlinkable:!0,visibility:"private"}},{name:"RunWorkflowWithArguments",metadata:{arguments:"object",description:"Runs a workflow with a set of input arguments.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayWorkflowContainerContent",metadata:{arguments:"object",description:"Displays a view in a workflow container.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearActiveTool",metadata:{arguments:"none",description:"Clears the active tool.",isHyperlinkable:!0,visibility:"public"}},{name:"SetActiveTool",metadata:{arguments:"string",description:"Sets the active tool.",isHyperlinkable:!0,visibility:"public"}},{name:"Geolocate",metadata:{arguments:"object",description:"Zooms to the current location of the device when it becomes available.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateTrack",metadata:{arguments:"none",description:"Enables the tracking of the device's location when it is available, without panning the map.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateFollow",metadata:{arguments:"none",description:"Enables the following of the device's location when it is available, panning the map.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateStop",metadata:{arguments:"none",description:"Stops the tracking and following of the device's location.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateShowBuffer",metadata:{arguments:"none",description:"Display a circular buffer showing the accuracy of the latest GPS reading.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateHideBuffer",metadata:{arguments:"none",description:"Hide a circular buffer showing the accuracy of the latest GPS reading.",isHyperlinkable:!0,visibility:"public"}},{name:"TakeApplicationOffline",metadata:{arguments:"none",description:"Puts the application in an offline state.",isHyperlinkable:!1,visibility:"public"}},{name:"TapToDismiss",metadata:{arguments:"args: {view: framework.ui.ViewBase; onOtherInteracted?: (evt?: Event) => void ; onElementInteracted?: (evt?: Event) => void}",description:"Dismisses the specified view on the next tap anywhere on the screen. Optionally fires specified callbacks.",isHyperlinkable:!1,visibility:"private"}},{name:"TakeApplicationOnline",metadata:{arguments:"none",description:"Connects the application to the internet.",isHyperlinkable:!1,visibility:"public"}},{name:"SetGMAFOfflineButtonState",metadata:{arguments:"string",description:"Sets the visibility of the online/offline button in the GMAF app.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleConnectivity",metadata:{arguments:"none",description:"Toggles the connectivity of the app, from offline to online or viceversa",isHyperlinkable:!0,visibility:"public"}},{name:"RefreshOfflineMapsList",metadata:{arguments:"string",description:"Refresh the list of offline maps on the OfflineMapsList view.",isHyperlinkable:!1,visibility:"public"}},{name:"OpenFeatureSetCollection",metadata:{arguments:"string",description:"Opens the FeatureSetCollection.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenPortalMyContentWindow",metadata:{arguments:"none",description:"Opens a new browser window to the authenticated users ArcGIS Portal 'My Content' page.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseFeatureSetCollection",metadata:{arguments:"string",description:"Closes the FeatureSetCollection.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveFeatureSetCollection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Removes the specified collection from the FeatureSetManager.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveFeatureSetCollectionById",metadata:{arguments:"string",description:"Removes the collection specified by ID from the FeatureSetManager.",isHyperlinkable:!0,visibility:"public"}},{name:"Search",metadata:{arguments:"string",description:"Performs a search on all active providers.",isHyperlinkable:!0,visibility:"public"}},{name:"GlobalSearch",metadata:{arguments:"string",description:"Performs a search on all active providers.",isHyperlinkable:!0,visibility:"public"}},{name:"BufferGeometry",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.buffer.BufferGeometryArgs",description:"Buffers input geometry, adds buffer markup to the map, and fires the callback and event with the buffered geometry. When the source command is specified, buffers using current settings for the command.",isHyperlinkable:!0,visibility:"private"}},{name:"CancelEditCoordinate",metadata:{arguments:"none",description:"Cancels editing of a coordinate if currently active.",isHyperlinkable:!0,visibility:"public"}},{name:"CancelSearch",metadata:{arguments:"none",description:"Cancel the search on all providers.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearSearch",metadata:{arguments:"none",description:"Clear the search results.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearSelection",metadata:{arguments:"none",description:"Clears the open identify results/selection.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowExportWebMapDialog",metadata:{arguments:"none",description:"Activates the export web map view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowFeatureDetails",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays the Feature Details dialog for the Feature or FeatureSetCollection specified.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowFeatureDetailsCompact",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays the Feature Details dialog for the {@link geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature} in Compact View mode. If the feature is not specified, details for the last feature will be displayed.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowFeatureDetailsExpanded",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays the Feature Details dialog for the {@link geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature} in Expanded View mode. If the feature is not specified, details for the last feature will be displayed.",isHyperlinkable:!0,visibility:"private"}},{name:"SetFeatureDetailsMode",metadata:{arguments:"string",description:"Sets the feature details dialog to the specified view mode.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowFeatureParentDetails",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Shows the previously opened feature when browsing related features in the feature details view.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowFeatureAttributeEditor",metadata:{arguments:"none",description:"Shows the feature attribute editor used to set feature attributes.",isHyperlinkable:!0,visibility:"public"}},{name:"HideFeatureAttributeEditor",metadata:{arguments:"none",description:"Hides the feature attribute editor used to set feature attributes.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowFeatureTemplatePicker",metadata:{arguments:"layer",description:"Shows the feature template picker used to create new features. If a layer is supplied, shows the templates for the layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HideFeatureTemplatePicker",metadata:{arguments:"none",description:"Hides the feature template picker used to create new features.",isHyperlinkable:!0,visibility:"public"}},{name:"FSMCollectionSetCommand",metadata:{arguments:"string, string",description:"Set the preferred command to open the FeatureSetCollection for the given source name.",isHyperlinkable:!0,visibility:"private"}},{name:"PanToAllFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Pans to the extent of all the features.",isHyperlinkable:!0,visibility:"private"}},{name:"PanToFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Pans to a Geocortex feature.",isHyperlinkable:!0,visibility:"private"}},{name:"PanToFeatureIfOutsideMapExtent",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Pans to a Geocortex feature if the feature is outside of the map's extent, otherwise nothing happens.",isHyperlinkable:!0,visibility:"private"}},{name:"Project",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ProjectArgs",description:"Calls a geometry service to project geometries between different coordinate systems.",isHyperlinkable:!1,visibility:"private"}},{name:"InvokeMapTip",metadata:{arguments:"esri.geometry.Geometry",description:'Executes an Identify operation on the given geometry and sets "MapTip" as its source tag.',isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapTip",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Displays a feature in the map tip view.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapTipInCallout",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Displays a feature in a map tip callout anchored to the map.",isHyperlinkable:!0,visibility:"private"}},{name:"SuspendMapTips",metadata:{arguments:"none",description:"Suspends the display of map tips, allowing other components the opportunity to interact with the map without invoking map tips on click/tap events.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToLayerTheme",metadata:{arguments:"string",description:"Switches to the specified layer theme, identified by ID or display name.",isHyperlinkable:!0,visibility:"public"}},{name:"ResumeMapTips",metadata:{arguments:"none",description:"Resumes the previously suspended display of map tips.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearStorageForApplication",metadata:{arguments:"none",description:"Clears the offline data for the current application.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearStorageForDomain",metadata:{arguments:"none",description:"Clears all offline data for the current domain. This includes data for all applications loaded from the current domain.",isHyperlinkable:!0,visibility:"public"}},{name:"ListReports",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Presents a user interface for choosing to run a report from a list of reports that are available to the given reportable input (group of features).",isHyperlinkable:!1,visibility:"public"}},{name:"RunFeatureReport",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Alias to 'ListReports' for backwards compatibility with the Silverlight viewer.",isHyperlinkable:!0,visibility:"public"}},{name:"RunFeaturesReport",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Alias to 'ListReports' for backwards compatibility with the Silverlight viewer.",isHyperlinkable:!1,visibility:"public"
}},{name:"RunReport",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.RunReportArgs",description:"Runs a given report on the provided features, and displays the result (a download link to the report file) to the user.",isHyperlinkable:!1,visibility:"public"}},{name:"ShowResultsList",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Displays the list of features in the given FeatureSetCollection as a list.",isHyperlinkable:!1,visibility:"private"}},{name:"ShowResultsTable",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Displays the list of features in the given FeatureSetCollection in a tabular view.",isHyperlinkable:!1,visibility:"private"}},{name:"SwitchToListResultsView",metadata:{arguments:"none",description:"Switches from Results Table to Results List view if the Results Table view is currently active.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToTabularResultsView",metadata:{arguments:"none",description:"Switches from Results List to Results Table view if the Results List view is currently active.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenResultsFrame",metadata:{arguments:"none",description:"Activates the ResultsRegion.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseResultsFrame",metadata:{arguments:"none",description:"Deactivates the ResultsRegion.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLayerList",metadata:{arguments:"none",description:"Displays the layer list.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToLayerView",metadata:{arguments:"none",description:"Displays the layer list.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToLegendView",metadata:{arguments:"none",description:"Displays the legend view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLayerActions",metadata:{arguments:"geocortex.essentials.Layer",description:"Shows available actions for a given layer.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapServiceActions",metadata:{arguments:"geocortex.essentials.MapService",description:"Shows available actions for a given map service.",isHyperlinkable:!0,visibility:"private"}},{name:"HideMapServiceActions",metadata:{arguments:"none",description:"Closes the map service actions view.",isHyperlinkable:!0,visibility:"private"}},{name:"PulseStatus",metadata:{arguments:"string",description:"Resets the timer of the status view model.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveStatus",metadata:{arguments:"string",description:"Removes the status indicator from the screen with the specified ID.",isHyperlinkable:!0,visibility:"public"}},{name:"AddStatus",metadata:{arguments:"string",description:"Adds a status indicator to the screen.",isHyperlinkable:!0,visibility:"public"}},{name:"CreateHighlightLayer",metadata:{arguments:"string",description:"Creates a new highlight layer with the specified name.",isHyperlinkable:!0,visibility:"private"}},{name:"SetActiveHighlightLayer",metadata:{arguments:"string",description:"Sets the layer with the specified name as active, if there is one.",isHyperlinkable:!0,visibility:"private"}},{name:"SetActiveHighlightLayerDefault",metadata:{arguments:"none",description:"Sets the default highlight layer as the active highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HighlightEsriFeatureSet",metadata:{arguments:"esri.tasks.FeatureSet",description:"Highlights all of the features in the specified Esri feature set in the active highlight layer.",isHyperlinkable:!1,visibility:"private"}},{name:"SetHighlightBorderColor",metadata:{arguments:"string",description:"Sets the border color used for new highlights, specified in 6 or 8 digit hex in RGB or ARGB form.",isHyperlinkable:!0,visibility:"public"}},{name:"SetHighlightBorderWidth",metadata:{arguments:"number",description:"Sets the border width (in pixels) used for new highlights.",isHyperlinkable:!0,visibility:"public"}},{name:"SetHighlightFillColor",metadata:{arguments:"string",description:"Sets the current highlight fill color to use for a highlighted feature.",isHyperlinkable:!0,visibility:"public"}},{name:"SetFocusedBorderColor",metadata:{arguments:"string",description:"Sets the border color used for an focused feature.",isHyperlinkable:!0,visibility:"public"}},{name:"SetFocusedFillColor",metadata:{arguments:"string",description:"Sets the current highlight fill color to use, if the feature does not specify one.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveHighlightLayer",metadata:{arguments:"string",description:"Removes the highlight layer with the specified name, if there is one.",isHyperlinkable:!0,visibility:"public"}},{name:"AddMapService",metadata:{arguments:"essentials.MapService",description:"Integrate a map service and its sub-components into the viewer and onto the map.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveMapService",metadata:{arguments:"essentials.MapService",description:"Removes a user added map service off of the map and out of the viewer.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveUserAddedLayer",metadata:{arguments:"essentials.Layer",description:"Remove a user added layer (and its parent map service) off of the map and out of the viewer.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearHighlights",metadata:{arguments:"string",description:"Removes the highlights from the default highlight layer (no parameter), or from the highlight layer with the supplied name",isHyperlinkable:!0,visibility:"public"}},{name:"ClearDefaultHighlights",metadata:{arguments:"none",description:"Removes the highlights from the default highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HighlightFeatureSet",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSet",description:"Highlights all of the features in the specified feature set in the active highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HighlightFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Highlights the feature (or array of features) in the active highlight layer.",isHyperlinkable:!0,visibility:"public"}},{name:"HighlightFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Highlights the feature (or array of features) in the active highlight layer.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearAndHighlightFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Clears existing highlights and highlights all specified features on the active highlight layer.",isHyperlinkable:!1,visibility:"public"}},{name:"FocusFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Focuses the specified feature on the active highlight layer.",isHyperlinkable:!1,visibility:"public"}},{name:"ClearFeatureHighlight",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Clears the highlight from a feature if it's currently highlighted.",isHyperlinkable:!1,visibility:"public"}},{name:"ClearFeatureFocus",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Clears the feature emphasis from a feature if it's currently focused, returning it to the highlighted state.",isHyperlinkable:!1,visibility:"public"}},{name:"HighlightFeatureDefault",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Highlights the feature in the default highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"AddMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Adds the given geometry to the markup layer.",isHyperlinkable:!0,visibility:"private"}},{name:"AddMarkupGeometry",metadata:{arguments:"esri.geometry.Geometry",description:"Adds the given geometry to the markup layer.  (Identical to the AddMarkup command.)",isHyperlinkable:!0,visibility:"private"}},{name:"AddTextMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Prompts the user for text to add as markup. When completed, text markup is added at the provided geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearMarkup",metadata:{arguments:"none",description:"Prompts the user for confirmation, and if approved, clears all of the markup from the markup layer.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearMarkupQuiet",metadata:{arguments:"none",description:"Clears all of the markup from the markup layer without prompting for confirmation.",isHyperlinkable:!0,visibility:"public"}},{name:"MeasureDistance",metadata:{arguments:"esri.geometry.Polyline",description:"Computes the total and segment distance measurements for the specified Polyline geometry and plots it on the map along with its measurements. NOTE: An Esri or Geocortex feature may also be provided as arguments in lieu of a polyline geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"MeasureArea",metadata:{arguments:"esri.geometry.Polygon",description:"Computes the area, perimeter and individual segment distances for the specified Polylgon geometry and plots it on the map along with its measurements. NOTE: An Esri or Geocortex feature may also be provided as arguments in lieu of a polygon geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteMeasurement",metadata:{arguments:"esri.geometry.Geometry",description:"Deletes measurement markup within the given geometry",isHyperlinkable:!0,visibility:"private"}},{name:"SetMeasurementUnits",metadata:{arguments:"string, string",description:"Sets the measurement units for the measurements performed by the measurement module. Also updates existing measurements already on the map.",isHyperlinkable:!1,visibility:"private"}},{name:"ResizeShell",metadata:{arguments:"none",description:"Recalculate the size and layout of the shell and refresh the shell accordingly.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateHomePanel",metadata:{arguments:"none",description:"Activates Home Panel if it is configured to be included.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivatePlotCoordinatesView",metadata:{arguments:"none",description:"Activates the Plot Coordinates view.",isHyperlinkable:!0,visibility:"public"}},{name:"ApplyFilterControlQuery",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.eventArgs.FilterControlQueryChangedEventArgs",description:"Applies the current query to the specified Filter Control.",isHyperlinkable:!1,visibility:"public"}},{name:"ShowHomePanel",metadata:{arguments:"none",description:"Activates Home Panel if it is configured to be included.",isHyperlinkable:!0,visibility:"public"}},{name:"HideHomePanel",metadata:{arguments:"none",description:"Deactivates/hides the Home Panel if it is configured to be included.",isHyperlinkable:!0,visibility:"public"}},{name:"AttachFileToFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Checks for HTML5 FileReader / Cordova support and activates File Attachments if supported.",isHyperlinkable:!0,visibility:"private"}},{name:"ToggleToolbar",metadata:{arguments:"none",description:"Toggles the visibility of the toolbar if present.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenToolbar",metadata:{arguments:"none",description:"Opens the toolbar, if present.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseToolbar",metadata:{arguments:"none",description:"Closes the toolbar, if present.",isHyperlinkable:!0,visibility:"public"}},{name:"PrintMap",metadata:{arguments:"none",description:"Displays a dialog to create a printable map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowExportMapDialog",metadata:{arguments:"none",description:"Displays a dialog to save a map image.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLayerCatalog",metadata:{arguments:"none",description:"Shows the layer catalog view.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateTimeSlider",metadata:{arguments:"none",description:"Activates and shows the Time Slider if time slider profiles are available in the site.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateTimeSlider",metadata:{arguments:"none",description:"Deactivates time settings applied to the map and hides the Time Slider.",isHyperlinkable:!0,visibility:"public"}},{name:"HideTimeSlider",metadata:{arguments:"none",description:"Hides the time slider if currently visible but does not deactivate time settings applied to the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowTimeSliderSettings",metadata:{arguments:"none",description:"Shows the time slider settings view.",isHyperlinkable:!0,visibility:"public"}},{name:"HideTimeSliderSettings",metadata:{arguments:"none",description:"Hides the time slider settings view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleTimeSliderActions",metadata:{arguments:"none",description:"Toggles the time slider actions container visibility.",isHyperlinkable:!0,visibility:"public"}},{name:"SetTimeSliderProfile",metadata:{arguments:"none",description:"Validates and sets a specified time slider profile.",isHyperlinkable:!1,visibility:"private"}},{name:"AddCatalogLayers",metadata:{arguments:"Comma seperated string of layer ids.",description:"Adds catalog layers.",isHyperlinkable:!1,visibility:"public"}},{name:"AppendCatalogLayers",metadata:{arguments:"Comma seperated string of layer ids.",description:"Appends catalog layers.",isHyperlinkable:!1,visibility:"public"}},{name:"ClearLayerCatalogLayers",metadata:{arguments:"none",description:"Clears all catalog layers.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveLayerCatalogIds",metadata:{arguments:"A string array of CatalogIds to be removed",description:"Removes specific catalog layers",isHyperlinkable:!1,visibility:"public"}},{name:"ShowBookmarks",metadata:{arguments:"none",description:"Displays the Bookmarked Locations menu if the BookmarkViewModel's property, bookmarksEnabled, is set to true.",isHyperlinkable:!0,visibility:"public"}},{name:"AddBookmark",metadata:{arguments:"string",description:"Bookmark the current extent with the given name.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowAddBookmark",metadata:{arguments:"none",description:"Prompts the user to bookmark the current extent by entering a name.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowCoordinateActions",metadata:{arguments:"string",description:"Shows the configured coordinate actions.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveBookmark",metadata:{arguments:"string",description:"Removes a bookmark with the given name if exists.",isHyperlinkable:!0,visibility:"public"}},{name:"SelectBaseMap",metadata:{arguments:"string",description:"A map can have a number of basemaps associated with it. SelectBaseMap allows you to programmatically select one of the basemaps to display. All other basemaps are then faded out.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateSelectLayersForIdentify",metadata:{arguments:"none",description:"Activates the Layer Selector for Identify and applies current settings.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateSelectLayersForIdentify",metadata:{arguments:"none",description:"Deactivates the Layer Selector for Identify and enables all default identifiable layers.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateBuffering",metadata:{arguments:"string|string[]",description:"Activates buffering for the specified command(s). Uses currently configured settings for the command.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateBufferingAndDisplayOptions",metadata:{arguments:"string",description:"Activates buffering for the specified command and displays the associated Buffer Options dialog. ",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateTransientElements",metadata:{arguments:"string",description:"Activates any transient elements configured against a specific ID in the toolbar module.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateBuffering",metadata:{arguments:"string|string[]",description:"Deactivates buffering, if active, for the specified command(s).",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateBufferingAndDismissOptions",metadata:{arguments:"string",description:"Deactivates buffering for the specified command and dismisses the associated Buffer Options dialog if its active. ",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateTransientElements",metadata:{arguments:"string",description:"Deactivates any transient elements configured against a specific ID in the toolbar module.",isHyperlinkable:!0,visibility:"public"}},{name:"DeleteAllCoordinates",metadata:{arguments:"none",description:"Deletes all plotted Coordinates from the map.",isHyperlinkable:!0,visibility:"public"}},{name:"DeleteCoordinates",metadata:{arguments:"string|string[]",description:"Deletes one or many plotted Coordinates from the map.",isHyperlinkable:!0,visibility:"public"}},{name:"EditCoordinate",metadata:{arguments:"string|null",description:"Edits a plotted Coordinate on the map or creates a new coordinate in edit mode if no descriptor Id is provided.",isHyperlinkable:!0,visibility:"public"}},{name:"EditMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Edits markup that intersects the extent of the provided geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Deletes markup within the given geometry",isHyperlinkable:!0,visibility:"private"}},{name:"CreateMarkupStyleView",metadata:{arguments:"string",description:"Activates the style picker if 'point', 'polyline', 'polygon', or 'text' is the string provided. If it is null, then the app will try and detect what style selector to activate.",isHyperlinkable:!0,visibility:"public"}},{name:"ChangeMarkupStyle",metadata:{arguments:"MarkupTemplate",description:"Takes a MarkupTemplate, PointTemplate, PolylineTemplate, PolygonTemplate, or TextTemplate. It will change the style of the markup to suit the template provided.",isHyperlinkable:!0,visibility:"private"}},{name:"StopEditingMarkup",metadata:{arguments:"boolean",description:"Stops editing. If arg is true, clears the active tool, if arg is false, doesn't clear active tool.",isHyperlinkable:!0,visibility:"public"}},{name:"StartEditingFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Shows the editing form.",isHyperlinkable:!0,visibility:"private"}},{name:"EnableSearchRefinement",metadata:{arguments:"boolean",description:"Enables or disables the refinement of a global search from within search hints (if any).",isHyperlinkable:!0,visibility:"public"}},{name:"ExportResultsTo",metadata:{arguments:"{ format: string, fsc: geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection }",description:"Enables or disables the refinement of a global search from within search hints (if any).",isHyperlinkable:!0,visibility:"private"}},{name:"ExportMarkupLayer",metadata:{arguments:"none",description:"Exports markup layer.",isHyperlinkable:!0,visibility:"public"}},{name:"ExportGraphicsLayer",metadata:{arguments:"{ args:  geocortex.essentialsHtmlViewer.mapping.infrastructure.commandArgs.ExportGraphicsLayerArgs}",description:"Exports graphics layer.",isHyperlinkable:!1,visibility:"public"}},{name:"HideAllCoordinates",metadata:{arguments:"none",description:"Hides all plotted Coordinates temporarily.",isHyperlinkable:!0,visibility:"public"}},{name:"HideCoordinates",metadata:{arguments:"string|string[]",description:"Hides one or many plotted Coordinates temporarily.",isHyperlinkable:!0,visibility:"public"}},{name:"HideCoordinateActions",metadata:{arguments:"none",description:"Hide any coordinate actions view that is currently open.",isHyperlinkable:!0,visibility:"public"}},{name:"SignIn",metadata:{arguments:"string",description:"Navigates to the sign-in page. The sign in experience can be customized by crafting a custom sign-in URL, otherwise the default sign-in URL for the site will be used.",isHyperlinkable:!0,visibility:"public"}},{name:"SignOut",metadata:{arguments:"string",description:"Navigates to the sign-out page, which will sign the current user out.",isHyperlinkable:!0,visibility:"public"}},{name:"LogOptimizerEvent",metadata:{arguments:"string, string",description:"Logs an event for Geocortex Optimizer.",isHyperlinkable:!0,visibility:"private"}},{name:"AddPushpin",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays a pushpin for the Feature specified.",isHyperlinkable:!0,visibility:"private"}},{name:"AddPushpins",metadata:{arguments:"string",description:"Creates and displays pushpins for the FeatureSetCollection specified.",isHyperlinkable:!0,visibility:"public"}},{name:"RemovePushpin",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Removes the pushpin from the map for the given feature, if there is one.",isHyperlinkable:!0,visibility:"private"}},{name:"RemovePushpins",metadata:{arguments:"none",description:"Removes all pushpins from the map.",isHyperlinkable:!0,visibility:"public"}},{name:"EnablePushpins",metadata:{arguments:"none",description:"Enables the display of pushpins/markers on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"DisablePushpins",metadata:{arguments:"none",description:"Disables the display of pushpins/markers on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowPushpins",metadata:{arguments:"none",description:"Displays pushpins by setting their visibility to true, for each result in the results list or results table.  Pushpins must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"StopFeaturePlacementState",metadata:{arguments:"none",description:"Cancels any feature placement while a feature is being created or edited.",isHyperlinkable:!0,visibility:"public"}},{name:"HidePushpins",metadata:{arguments:"none",description:"Prevents the display of pushpins by setting their visibility to false.  Pushpins must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"SetCollectionOfInterest",metadata:{arguments:"string",description:"Sets the FeatureSetCollection of interest that will be used to generate data for Charts.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowChartingView",metadata:{arguments:"none",description:"Activates the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayBufferOptions",metadata:{arguments:"string",description:"Displays the Buffer Options dialog for the specified target command",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayChartById",metadata:{arguments:"string",description:"Opens the specified chart in the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveChartById",metadata:{arguments:"string",description:"Removes the specified chart from the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearCharts",metadata:{arguments:"none",description:"Removes all charts from the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearFeatureInformation",metadata:{arguments:"none",description:"Used to 'reset' the information stored within RelatedFeatures (which features are currently open, etc.)",isHyperlinkable:!0,visibility:"public"}},{name:"DisableMapClick",metadata:{arguments:"none",description:"Prevents the commands configured to execute on map click from executing and also prevents the MapClickedEvent from firing.",isHyperlinkable:!0,visibility:"public"}},{name:"DisableMapTips",metadata:{arguments:"none",description:"Disables the display of map tips on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableAllLayersForIdentify",metadata:{arguments:"none",description:"Enables all identifiable layers such that they participate in Identify operations",isHyperlinkable:!0,visibility:"public"}},{name:"DisableAllLayersForIdentify",metadata:{arguments:"none",description:"Disables all identifiable layers such that they do not participate in Identify operations",isHyperlinkable:!0,visibility:"public"}},{name:"EnableLayerForIdentify",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.identify.LayerDescriptor",description:"Enables the specified layer, if it's identifiable, such that it participates in Identify operations.",isHyperlinkable:!0,visibility:"public"}},{name:"DisableLayerForIdentify",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.identify.LayerDescriptor",description:"Disables the specified layer, if it's in the list of identifiable layers, such that it does not participate in Identify operations.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableMapClick",metadata:{arguments:"none",description:"Enables all configured commands to execute on map click and also wires up the MapClickEvent to fire when the map is clicked.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableMapTips",metadata:{arguments:"none",description:"Enables the display of map tips on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"HideAllMapTips",metadata:{arguments:"none",description:"Prevents the display of map tips by setting their visibility to `false`.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"HideMapTips",metadata:{arguments:"none",description:"Prevents the display of map tips by setting their visibility to `false`, and suspends displaying map tips.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"RestoreAllMapTips",metadata:{arguments:"none",description:"Displays previously hidden map tips by setting their visibility to `true`.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowAllCoordinates",metadata:{arguments:"none",description:"Shows all plotted coordinates (including temporarily hidden ones) on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowCoordinates",metadata:{arguments:"string|string[]",description:"Shows one or many plotted, hidden Coordinates on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapTips",metadata:{arguments:"none",description:"Displays previously hidden map tips by setting their visibility to `true`, and resumes displaying map tips.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleMouseCoordinates",metadata:{arguments:"none",description:"Toggles the visibility of the mouse coordinates widget if present.",isHyperlinkable:!0,visibility:"public"}},{name:"SetTimeExtent",metadata:{arguments:"esri.TimeExtent",description:"Sets the time extent for the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowShareView",metadata:{arguments:"none",description:"Activates the share view",isHyperlinkable:!0,visibility:"public"}},{name:"ShareOn",metadata:{arguments:"string",description:"Shares the Viewer url on the specified platform",isHyperlinkable:!0,visibility:"public"}},{name:"ScreenReaderNarrate",metadata:{arguments:"string",description:"If a user has screenreader software enabled, then the provided string is immediately spoken to them.",isHyperlinkable:!0,visibility:"public"}},{name:"DisableScreenReaderNarrate",metadata:{arguments:"none",description:"Disables the 'ScreenReaderNarrate' command temporarily.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableScreenReaderNarrate",metadata:{arguments:"none",description:"Enables screen reader narration if it was previously disabled using DisableScreenReaderNarrate.",isHyperlinkable:!0,visibility:"public"}},{name:"BroadcastCurrentViewpoint",metadata:{arguments:"string",description:"Broadcasts the viewers current viewpoint to the specified external component.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateStatus",metadata:{arguments:"string",description:"Updates the message shown on the status indicator.",isHyperlinkable:!0,visibility:"public"}},{name:"UploadData",metadata:{arguments:"none",description:"Prompt the user to upload layers onto the map straight from their own computer.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowExternalComponentView",metadata:{arguments:"none",description:"Activates the external component view.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayDockedExternalComponentById",metadata:{arguments:"string",description:"Opens the specified external component in the external components view. If this component is open in a separate window, it will be closed.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayUndockedExternalComponentById",metadata:{arguments:"string",description:"Opens the specified external component in a separate window from the viewer. If this component is open in the viewer, it will be closed.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveExternalComponentById",metadata:{arguments:"string",description:"Removes the specified external component from the viewer. If the component is in a separate window, that window will be closed.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleExternalComponentSyncById",metadata:{arguments:"string",description:"Toggle whether the specified external component is synchronized with the viewer.",isHyperlinkable:!0,visibility:"private"}},{name:"ListenToExternalComponentFrame",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.integration.ComponentFrameInfo",description:"Wires up a PostMessage Transport and enables bi-directional communication with the component.",isHyperlinkable:!0,visibility:"private"}},{name:"CreateOrEditFeatureFromBarcodeScan",metadata:{arguments:"object",description:"Launch the barcode scanner, and use the result to create a new feature or edit an existing one.",isHyperlinkable:!0,visibility:"public"}},{name:"LaunchBarcodeScannerWithCallback",metadata:{arguments:"none",description:"Lauches a QR scan, then calls the provided callback with the result.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMarkers",metadata:{arguments:"none",description:"Displays markers by setting their visibility to `true`.",isHyperlinkable:!0,visibility:"private"}},{name:"HideMarkers",metadata:{arguments:"none",description:"Prevents the display of markers by setting their visibility to `false`.",isHyperlinkable:!0,visibility:"private"}},{name:"AddMarker",metadata:{arguments:"string",description:"Creates and displays a marker on the map.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveMarker",metadata:{arguments:"string",description:"Removes the marker from the map.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateMarker",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.MarkerArgs",description:"Updates the marker with the given marker arguments.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowAccessibilityView",metadata:{arguments:"none",description:"Activates the accessibility view.",isHyperlinkable:!0,visibility:"public"}},{name:"AddClusterLayer",metadata:{arguments:"string",description:"Adds a cluster layer to an existing Geocortex Layer that holds an Esri FeatureLayer.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveClusterLayer",metadata:{arguments:"string",description:"Removes a cluster layer from an existing Geocortex Layer that holds an Esri FeatureLayer.",isHyperlinkable:!0,visibility:"public"}},{name:"AddHeatMap",metadata:{arguments:"string",description:"Adds a heat map visualization to a given Geocortex layer.",isHyperlinkable:!0,visibility:"public"}},{name:"Redo",metadata:{arguments:"none",description:"Reverses the last recorded undo operation or transaction.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveHeatMap",metadata:{arguments:"string",description:"Removes a heat map visualization from a Geocortex layer.",isHyperlinkable:!0,visibility:"public"
}},{name:"RemoveVisualization",metadata:{arguments:"string",description:"Removes the visualization from a Geocortex layer, if one is enabled.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowVisualizationView",metadata:{arguments:"string",description:"Shows the visualization options view for a given Geocortex layer if the layer supports any visualizations.",isHyperlinkable:!0,visibility:"public"}},{name:"Undo",metadata:{arguments:"none",description:"Invokes the last recorded undo operation or transaction.",isHyperlinkable:!0,visibility:"public"}},{name:"CreateGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Creates new graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.UpdateGraphicsArgs",description:"Updates existing graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Deletes graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"CutGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.CutGraphicsArgs",description:"Cut graphics using a polyline. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"ExplodeGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Separates multi-part graphics into individual graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"UnionGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Merge graphics into a single graphic. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteProject",metadata:{arguments:"string",description:"Deletes a project.",isHyperlinkable:!0,visibility:"public"}},{name:"LoadProject",metadata:{arguments:"string",description:"Loads a project and applies it to the viewer.",isHyperlinkable:!0,visibility:"public"}},{name:"ListSelections",metadata:{arguments:"none",description:"List the available selections.",isHyperlinkable:!0,visibility:"public"}},{name:"RefreshProjectsList",metadata:{arguments:"none",description:"Refresh the list of browsable projects.",isHyperlinkable:!0,visibility:"public"}},{name:"RegisterChartPointAdapter",metadata:{arguments:"object",description:"Register the chart point adapter.",isHyperlinkable:!0,visibility:"private"}},{name:"SaveAsProject",metadata:{arguments:"none",description:"Displays the user interface to fill in details about a project to be saved.",isHyperlinkable:!0,visibility:"public"}},{name:"SaveProject",metadata:{arguments:"none",description:"Save the current state of the viewer as a project or displays the user interface to fill in details about the project to be saved.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowProjectEditor",metadata:{arguments:"string",description:"Shows the user interface for editing a project.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowProjects",metadata:{arguments:"none",description:"Shows the user interface for browsing and loading projects.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowShareProject",metadata:{arguments:"string",description:"Shows the user interface for sharing projects.",isHyperlinkable:!0,visibility:"public"}},{name:"HideFeatureDetails",metadata:{arguments:"none",description:"Hides the Feature Details dialog.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowSaveSelectionDialog",metadata:{arguments:"string",description:"Displays a dialog to save a FeatureSetCollection as a named selection.",isHyperlinkable:!0,visibility:"public"}},{name:"CreateSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Creates a new named, saved selection based on the supplied FeatureSetCollection.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Deletes a named selection.",isHyperlinkable:!0,visibility:"private"}},{name:"FindSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindSelectionArgs",description:"Looks up a particular named selection.",isHyperlinkable:!0,visibility:"private"}},{name:"RenameSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.RenameSelectionArgs",description:"Assigns a new name to a saved selection.",isHyperlinkable:!0,visibility:"private"}},{name:"RestoreSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Loads a named, saved selection into the results view.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Updates an existing named, saved selection with the supplied FeatureSetCollection.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateSelectionFindAllSelectionMetadata",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindAllSelectionMetadataArgs",description:"Lists all the available metadata for named selections.",isHyperlinkable:!0,visibility:"private"}},{name:"FindMetadataForSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindMetadataForSelectionArgs",description:"Looks up metadata about a particular named selection.",isHyperlinkable:!0,visibility:"private"}},{name:"AddFeatureToResults",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Adds an individual feature to the current FeatureSetCollection displayed in the results view.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveFeatureFromResults",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Removes an individual feature from the current FeatureSetCollection displayed in the results view.",isHyperlinkable:!0,visibility:"public"}},{name:"CombineResults",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.CombineResultsArgs",description:"Performs advanced set operations with multiple lists of results.",isHyperlinkable:!0,visibility:"public"}},{name:"CombineResultsInteractive",metadata:{arguments:"object",description:"Performs advanced set operations with multiple lists of results.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsIntersect",metadata:{arguments:"string",description:"Only keeps results from the current set of results that also appear in the supplied FeatureSetCollection.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsReplace",metadata:{arguments:"string",description:"Replaces the current set of results with the FeatureSetCollection supplied as argument.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsSubtract",metadata:{arguments:"string",description:"Removes the supplied FeatureSetCollection from the current set of results.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsUnion",metadata:{arguments:"string",description:"Adds the supplied FeatureSetCollection to the current set of results.",isHyperlinkable:!0,visibility:"public"}},{name:"AddResultsStatus",metadata:{arguments:"string",description:"Displays a status indicator that can relay short messages in the results list or table.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveResultsStatus",metadata:{arguments:"none",description:"Removes the status indicator from the results list or table.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowCopyDialogForEvent",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.collaboration.RestEvent",description:"Opens the Collaboration event copy view.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenCollaboration",metadata:{arguments:"none",description:"Opens the Collaboration view.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenAfterActionPlayback",metadata:{arguments:"none",description:"Opens the After Action Playback view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowEditCollaborationGraphicMessageView",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Edit the associated message for a collaboration event using one of its drawn features.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowEditCollaborationMessageView",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.collaboration.RestEvent",description:"Edit the associated message for a collaboration event using its rest event",isHyperlinkable:!0,visibility:"public"}},{name:"AutoJoinCollaborationRoom",metadata:{arguments:"string",description:"Add a collaboration room to the auto join list.",isHyperlinkable:!0,visibility:"public"}}],e.metadataForCommandName=t,e.publicCommands=i}(i=t.Commands||(t.Commands={}))})},"geocortex/infrastructure/FeatureDescriptionPresenterView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/validation/XssHtmlValidator","geocortex/infrastructure/Feature","geocortex/framework/utils/utils","geocortex/infrastructure/FilterUtils","geocortex/essentials/utilities/StringUtilities","geocortex/infrastructure/commands.meta"],function(e,t,i,r,n,a,o,s,l){"use strict";var c=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._xssHtmlValidator=new r.XssHtmlValidator({contentPolicy:t.defaultContentPolicy}),n}return __extends(t,e),t.prototype.attach=function(t){var i=this;return t&&t instanceof n.Feature?this.descriptionApply(t,this.root).then(function(){return e.prototype.attach.call(i,t)}):(e.prototype.attach.call(this,t),Promise.resolve())},t.prototype.descriptionGet=function(e){return this.getDescriptionContent(e)},t.prototype.getContentFieldFormat=function(e){switch(this.contentField){case"label":return e.labelFormat.get();case"description":return e.descriptionFormat.get();case"longDescription":return e.longDescriptionFormat.get();default:return e.longDescriptionFormat.get()}},t.prototype.getDescriptionContent=function(e,t){var i=this,r=t;r||(r=this.getContentFieldFormat(e));var n=this._extractCommandHyperlinks(r);return r=n.html,this._sanitizeHtml(e.formatTemplateString(r)).then(function(e){return n.html=e,e=i._injectCommandHyperlinks(n),e=i.insertLinkAndImageBindings(e)})},t.prototype.descriptionApply=function(e,t){return this.applyDescriptiveTemplate(e,t)},t.prototype.applyDescriptiveTemplate=function(e,t){var i=this,r=[],n=this.getContentFieldFormat(e);if(n&&e.hasRelationships){var a=n.match(/{{.[^}]+?\..+?}}|{.[^}]+?\..+?}/g),o=[];for(var s in a)if(a.hasOwnProperty(s)){var l=a[s];l=l.substr(1,l.length-2),o.push(l.match(/[^.].[^.]*/g))}if(o.length&&e.layer&&e.layer.relationships)for(var s in e.layer.relationships)if(e.layer.relationships.hasOwnProperty(s)){var c=e.layer.relationships[s];o.toString().indexOf(c.name)==-1&&o.toString().indexOf(c.displayName)==-1||r.push(new Promise(function(r,s){var l=function(s){return function(l){if(l.length>0){for(var c in o)if(o.hasOwnProperty(c)){var u=l[0],d=o[c],p=d[0].trim(),h=d[1].trim();if(s.indexOf(p)!==-1&&void 0!==u.attributes[h])for(var c in a)if(a.hasOwnProperty(c)){var m=a[c];n.indexOf(m)!==-1&&m.indexOf(p)!==-1&&m.indexOf(h)!==-1&&(n=n.replace(m,u.attributes[h]),i.getDescriptionContent(e,n).then(function(e){return t.innerHTML=e}).then(function(){return r()}))}}}else r()}};i.app.command("GetRelatedFeatures").execute({mapService:e.layer.mapService,currentFeature:e,relationshipId:c.id,objectId:e.id.get(),successCallback:l("{0}-{1}".format(c.name,c.displayName)),errorCallback:function(e){e.message="There was an error retrieving related features: "+e.message,i.app.trace.warning(e.message),r(e)}})}))}}return r.push(this.getDescriptionContent(e).then(function(e){return t.innerHTML=e})),Promise.all(r).then(function(){return null})},t.prototype._extractCommandHyperlinks=function(e){var t=[];return e?(e=e.replace(/\bhref="#?command:.*?"/gi,function(e){var i='href="mailto:'+a.alphaNumericToken()+'"';return t.push({commandHyperlink:e,placeholder:i}),i}),{html:e,commandHyperlinkPlaceholders:t}):{html:e,commandHyperlinkPlaceholders:t}},t.prototype._injectCommandHyperlinks=function(e){var t=e.html,i=e.commandHyperlinkPlaceholders;if(!t)return"";var r=function(e){for(var t=0,r=i;t<r.length;t++){var n=r[t];if(e===n.placeholder)return n.commandHyperlink}return e};return t.replace(/\bhref="mailto:.*?"/gi,r)},t.prototype._sanitizeHtml=function(e){var t={allowFrames:!0,allowArbitraryHyperlinks:!0,uriTransformer:function(e,t){return t.type!==o.UriType.NavigableLink?e:/^mailto\:/.test(e)?e:"command:OpenWebPage?"+e}};return this._xssHtmlValidator.validate(e,{sanitizeOptions:t}).then(function(e){return e.validatedValue})},t.prototype.cleansedFormatForFormat=function(e){return this.insertLinkAndImageBindings(e)},t.prototype.insertLinkAndImageBindings=function(e){var t=this;if(null===e)return null;if(e in this._descFormats)return this._descFormats[e];var i=/<a[^>]*(\/?>)/g,r=/(<a.*?href\s*?=\s*?")(command:.+?)(".*?)(\/?>)/,n=e.replace(i,function(e,i,n,a){var o=e.match(r);if(o){var s="",l=e.match(/(title|aria-label)\s*?=\s*?"[^"]*?"/g);return l&&(s=" "+l.join(" ")),'<a _key="'+t.keyForUri(o[2])+'" href="javascript:void(0)" data-binding="{@event-onclick: handleHyperlinkClick}{@event-mouseup: ignoreEvent}{@event-mousedown: ignoreEvent}"'+s+o[4]}return e});return n=n.replace(/<img/g,'<img data-binding="{@event-load: handleImgLoad}"'),this._descFormats[e]=n,n},t.prototype.handleImgLoad=function(e){},t.prototype.keyForUri=function(e){var t=dojo.indexOf(this._uris,e);return t>=0||(t=this._uris.length,this._uris.push(e)),t},t.prototype.parseArguments=function(e,t,i){var r={};if("none"===t)return null;if("string"===t)return this.tryPerformTokenSubstitution(e,i,r)?[r.value]:[e];if("list"===t){var n;try{n=JSON.parse(e)}catch(a){n=e.split("&")}for(var o=0;o<n.length;o++)this.tryPerformTokenSubstitution(n[o],i,r)&&(n[o]=r.value);return n}var s;try{s=JSON.parse(e)}catch(a){if(e.indexOf("=")<0)return this.tryPerformTokenSubstitution(e,i,r)?[r.value]:(this.app.trace.warning("The specified parameter could not be parsed to a valid Object in JSON or Query String format."),[null]);s=dojo.queryToObject(e)}for(var l in s)s.hasOwnProperty(l)&&"function"!=typeof s[l]&&this.tryPerformTokenSubstitution(s[l],i,r)&&(s[l]=r.value);var c=null;if("object"!==t){var u=dojo.getObject(t)();c=s,s=dojo.safeMixin(u,s)}return c&&s.spatialReference&&!c.spatialReference&&(s.spatialReference=null),[s]},t.prototype.tryPerformTokenSubstitution=function(e,t,i){var r=this;if(!(null!==e&&void 0!==e&&t&&t instanceof n.Feature))return i.value=null,!1;var a=t.esriFeature&&t.esriFeature.get&&t.esriFeature.get()||null;if("{$Feature}"===e)return i.value=t,!0;if("{$Graphic}"===e)return i.value=a||null,null!==i.value;if("{$Geometry}"===e)return i.value=a&&a.geometry||null,null!==i.value;if("string"==typeof e){var o=!1,l=e.replace(/{.+?}/g,function(e){o=!0;var i=e.substring(1,e.length-1),n=a&&a.attributes[i];return n?n:(!n&&t.layer&&(n=s.StringUtilities.replaceLayerTokens(i,t.layer)),!n&&t.layer&&t.layer.mapService&&(n=s.StringUtilities.replaceMapServicetokens(i,t.layer.mapService)),n.length>0?n:(r.app.trace.warning("The token syntax {"+i+"} was detected, but could not be matched to a valid replacement value."),e))});return i.value=l,o}return!1},t.prototype.decodeHtmlQuotes=function(e){return e=e.replace(/&quot;/g,'"'),e=e.replace(/&39;/g,"'")},t.prototype.decodeHtmlAmpersands=function(e){return e=e.replace(/&amp;/g,"&")},t.prototype.handleHyperlinkClick=function(e,t,i){var r=t.getAttribute("_key"),n=this._uris[r];if(n){var a=new dojo._Url(n);if("command"===a.scheme){var o=a.path,s=a.query,l=a.fragment;return l&&(s+="#"+l),this.runCommand(o,s,i),!1}}return!1},t.prototype.ignoreEvent=function(e,t,i){return!1},t.prototype.runCommand=function(e,t,i){var r=this.app.command(e),n=l.Commands.metadataForCommandName(e);if(null===n)return void this.app.trace.warning('The specified command "{0}" has no associated metadata.'.format(e));if(!n.isHyperlinkable)return void this.app.trace.warning('The specified command "{0}" is not able to be hyperlinked.'.format(e));var a=[];if(t){t=this.decodeHtmlQuotes(t),t=this.decodeHtmlAmpersands(t);var a=this.parseArguments(t,n.arguments,i)}if("OpenWebPage"==e){var o={url:a[0],isLink:!0},s=[];s.push(o),r.execute.apply(r,s)}else r.execute.apply(r,a)},t}(i.ViewBase);t.FeatureDescriptionPresenterView=c,c.prototype._uris=[],c.prototype._descFormats={},c.prototype.contentField=null})},"geocortex/infrastructure/FocusUtils":function(){define(["require","exports","geocortex/framework-ui/animation/AnimationSequence"],function(e,t,i){"use strict";function r(e){if(e&&e.root&&!(e.app&&e.app.modalRegionSingleton&&e.app.modalRegionSingleton.isActive&&"ModalViewContainerView"!==e.id))try{for(var t=$(e.root).find("input, a, button, select, textarea, [tabindex]").not(".inactive, .bound-invisible, .disabled, .close-16, .back-16, [tabindex=-1], [readonly]:not(.control-readonly)"),i=0;i<t.length;i++){var r=t[i];if(!($(r).parentsUntil(e.root,".inactive, .bound-invisible, .disabled, .invisible, .hidden-hoisted-menu").length>=1)){var n=["select","input","textarea"];if($.inArray(r.tagName.toLowerCase(),n)!==-1){if(r===document.activeElement)return;$(r).addClass("control-readonly"),r.setAttribute("readonly","true"),a(r),$(r).one("blur",function(e){r.removeAttribute("readonly"),$(r).removeClass("control-readonly")}),$(document).off("keypress.focus-control mousedown.focus-control touchstart.focus-control"),$(document).off("keydown.focus-control"),$(document).on("keydown.focus-control",function(e){return function(e,t){t.getAttribute("readonly")?8===e.keyCode&&e.preventDefault():$(document).off("keydown.focus-control")}(e,r)}),$(document).one("keypress.focus-control mousedown.focus-control touchstart.focus-control",function(e){return function(e,t){t.removeAttribute("readonly"),$(t).removeClass("control-readonly");var i=e.target||e.srcElement;if(i!==t)t.blur();else{t.blur(),a(t);var r=t.getAttribute("type");r&&r.toLowerCase&&(r=r.toLowerCase());var n=function(e){if("textarea"===e.tagName.toLowerCase())return!0;if("true"===e.contentEditable)return!0;if(r){var t=["date","datetime","datetime-local","email","month","number","password","search","text","tel","time","week"];return t.indexOf(r)>=0}return!1};n(t)&&"keypress"===e.type&&(0!=e.keyCode&&$(t).val($(t).val()+String.fromCharCode(e.keyCode)),/Edge\/\d+/i.test(navigator.userAgent)&&setTimeout(function(){t.setSelectionRange(1,1)},10))}$(document).off("keypress.focus-control mousedown.focus-control touchstart.focus-control"),$(document).off("keydown.focus-control")}(e,r)})}else a(r);break}}}catch(o){e.app&&e.app.trace.debug("Could not focus: "+o)}}function n(e){if(e){var t=function(e){var t=e.root;$(t).find("svg").attr("focusable","false"),t.tabIndex=0,a(t)};if(e.loaded)t(e);else var i=e.on("load",function(e){i.remove(),t(e.map)})}}function a(e){e&&i.runWhenIdle(function(){try{if(e===document.activeElement)return;e.focus()}catch(t){}})}t.focusOnFirstInput=r,t.focusOnMap=n,t.focus=a})},"geocortex/infrastructure/HtmlUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t,i){return new Promise(function(r,n){if(("undefined"==typeof t||null===t||t<1)&&(t=500),("undefined"==typeof i||null===i||i<1)&&(i=2e4),e())return void r();var a=(new Date).getTime(),o=setInterval(function(){e()&&(clearInterval(o),r()),(new Date).getTime()-a>i&&(clearInterval(o),n("timeout"))},t)})}t.pollUntil=i})},"geocortex/infrastructure/SecurityUtils":function(){define(["require","exports","geocortex/framework/utils/ArrayUtils"],function(e,t,i){"use strict";function r(e,t){var r=t.site;return r&&r.principal&&r.principal.identities?i.firstOrDefault(r.principal.identities,function(t){return t.authenticationType===e}):null}function n(e,t){return e.claims.filter(function(e){return e.type===t})}function a(e,t){return e.claims.filter(function(e){return e.value===t})}function o(e,t,r){return i.firstOrDefault(e.claims,function(e){return e.type===t&&e.value===r})}function s(e,t){return!!o(e,l,t)}var l="http://www.geocortex.net/security/claims/privilege";t.getIdentity=r,t.getClaimsByType=n,t.getClaimsByValue=a,t.getClaimByTypeAndValue=o,t.hasPrivilegeClaim=s})},"geocortex/infrastructure/PortalUtils":function(){define(["require","exports","geocortex/infrastructure/SecurityUtils"],function(e,t,i){"use strict";function r(e){return i.getIdentity("ags-oauth2",e)}function n(e){return!!r(e)}function a(e){var t=r(e);return!!t&&i.hasPrivilegeClaim(t,"portal:user:createItem")}function o(e){var t=r(e);return!!t&&i.hasPrivilegeClaim(t,"portal:publisher:publishFeatures")}function s(e){var t=r(e);if(!t)return null;var n=i.getClaimsByType(t,"http://www.geocortex.com/security/ags/portal"),a=n[0];return a?a.value:null}function l(e){var t=s(e);if(!t)return null;var i=e.configuration.portalContentRelUrl||"home/content.html";return String.format("{0}{1}",t,i)}function c(e,t){var i=s(t);if(!i)return null;var r=t.configuration.portalItemRelUrl||"home/item.html?id=";return String.format("{0}{1}{2}",i,r,e)}t.getPortalIdentity=r,t.hasAccessToPortal=n,t.hasCreateContentPrivilege=a,t.hasPublishFeaturePrivilege=o,t.getPortalBaseUrl=s,t.getPortalMyContentUrl=l,t.getPortalItemUrl=c})},"geocortex/infrastructure/Reporting":function(){define(["require","exports","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature"],function(e,t,i,r,n){"use strict";function a(e){var t=[];if(e instanceof i.FeatureSetCollection){var a=e;a.featureSets.get().forEach(function(e){e.features.get().forEach(function(e){t.push(e)})})}else if(e instanceof r.FeatureSet){var o=e;o.features.get().forEach(function(e){t.push(e)})}else if(e instanceof n.Feature){var s=e;t.push(s)}else e&&e.constructor===Array&&(t=e);return t}t.getAllFeaturesFromReportable=a})},"geocortex/infrastructure/ReverseGeocoder":function(){define(["require","exports","geocortex/essentials/GeocodingEndpoint","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){this.geocoder=this._noGeocoderConfigured,this.geocoderToken=null,this.geocoderUrl=null,this.SEARCH_RADIUS=1e3,this.AGS_ADDRESS_FIELD="Match_addr",this.BING_REQUEST_TEMPLATE="http://dev.virtualearth.net/REST/v1/Locations/{0},{1}?{2}key={3}",this.app=e,this._initializeGeocoder(t)}return e.prototype.reverseGeocode=function(e){var t=this;return new Promise(function(i,r){return t.app.isOffline.get()?r(new Error("Could not execute Reverse Geocode: Application is offline")):e.spatialReference?void t.geocoder(e).then(function(e){i(e)},function(e){r(e)}):r(new Error("Could not execute Reverse Geocode: Point had no spatial reference"))})},e.prototype._initializeGeocoder=function(e){var t=this;if(e&&e.geocoderUrl&&(this.geocoderUrl=e.geocoderUrl),e&&e.geocoderToken&&(this.geocoderToken=e.geocoderToken),e.geocoderType===i.GeocodingEndpointType.ARCGIS_GEOCODER){if(!this._agsGeocoder||this._agsGeocoder.url!==e.geocoderUrl){var r=this._updateUrl(this.geocoderToken);this._agsGeocoder=new esri.tasks.Locator(r)}this.geocoderToken&&dojo.subscribe("ServiceTokenRefreshed",function(e){if(e.serviceUrl==t.geocoderUrl){var i=t._updateUrl(e.token);t._agsGeocoder=new esri.tasks.Locator(i)}}),this.geocoder=this._executeAgsReverseGeocode}else e.geocoderType===i.GeocodingEndpointType.BING_GEOCODER&&e.bingProperties&&e.bingProperties.bingMapsKey&&(this._bingMapsKey=e.bingProperties.bingMapsKey,e.bingProperties.culture&&(this._bingMapsCulture=e.bingProperties.culture),this.geocoder=this._executeBingReverseGeocode)},e.prototype._updateUrl=function(e){this.geocoderToken=e;var t=this.geocoderUrl+(this.geocoderToken?"?token="+encodeURIComponent(this.geocoderToken):"");return t},e.prototype._parseAddressObject=function(e){var t=[],i=null;for(var r in e)e[r]&&t.push(e[r]);return t.length>0&&(i=t.join(", ")),i},e.prototype._executeAgsReverseGeocode=function(e){var t=this;return new Promise(function(i,r){t._agsGeocoder.locationToAddress(e,t.SEARCH_RADIUS).then(function(e){if(!e.address||!e.location)return t.app.trace.warning("Check geocoder configuration. No results were returned from a reverse geocode."),r("Check geocoder configuration. No results were returned from a reverse geocode.");var n={address:e.address[t.AGS_ADDRESS_FIELD]||t._parseAddressObject(e.address),location:e.location};return i(n)},function(e){return r(e)})})},e.prototype._executeBingReverseGeocode=function(e){var t=this;return new Promise(function(i,n){r.projectGeometry(e,new esri.SpatialReference(4326),function(e){var r=t._bingMapsCulture?"c="+t._bingMapsCulture+"&":"",a=t.BING_REQUEST_TEMPLATE.format(e.y,e.x,r,t._bingMapsKey);dojo.xhrGet({url:t.app.configuration.proxyUri+a,handleAs:"json",load:function(e){if(e&&e.resourceSets.length>0&&e.resourceSets[0].resources.length>0){var t=e.resourceSets[0].resources[0],r={location:new esri.geometry.Point(t.point.coordinates[1],t.point.coordinates[0],new esri.SpatialReference(4326)),address:t.address.formattedAddress};i(r)}else n(new Error("Reverse Geocode: No response from Bing Geocoder."))},error:function(e){n(e)}})},function(e){},t.app)})},e.prototype._noGeocoderConfigured=function(e){return new Promise(function(e,t){t(new Error("Reverse Geocoder: No geocoder configured"))})},e}();t.ReverseGeocoder=n})},"geocortex/infrastructure/TimeSliderUtils":function(){define(["require","exports","geocortex/essentials/TimeUnits"],function(e,t,i){"use strict";function r(e){if(!e)return NaN;var t=0;switch(e){case i.TimeUnits.UNIT_MILLISECONDS:t=1;break;case i.TimeUnits.UNIT_SECONDS:t=1e3;break;case i.TimeUnits.UNIT_MINUTES:t=6e4;break;case i.TimeUnits.UNIT_HOURS:t=36e5;break;case i.TimeUnits.UNIT_DAYS:t=864e5;break;case i.TimeUnits.UNIT_WEEKS:t=6048e5;break;case i.TimeUnits.UNIT_MONTHS:t=Math.round(26784e5);break;case i.TimeUnits.UNIT_YEARS:t=31536e6;break;case i.TimeUnits.UNIT_DECADES:t=31536e7;break;case i.TimeUnits.UNIT_CENTURIES:t=31536e8;break;case i.TimeUnits.UNIT_UNKNOWN:default:t=NaN}return t}function n(e,t){var i=r(t);return isNaN(parseInt(e,10))||isNaN(i)?NaN:i*e}t.convertTimeUnitToMilliseconds=r,t.computeTimeIntervalInMs=n})},"geocortex/infrastructure/VisualizationUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e){return e&&e.mapService?(e.includeInLegend&&e.mapService.heatMap&&(e.mapService.heatMap.includeInLegend=e.includeInLegend),e.mapService.heatMap):null}function r(e){if(!e||!e.mapService||!e.mapService.serviceLayer)return null;var t=e.mapService.serviceLayer.renderer;return t instanceof esri.renderer.HeatmapRenderer?t:null}t.getFeatureHeatMap=i,t.getHeatMapRenderer=r})},"geocortex/infrastructure/accessibility/AccessibilityProviderBase":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){e.id&&(this.id=e.id)},e}();t.AccessibilityProviderBase=i})},"geocortex/infrastructure/buffer/BufferDistanceChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/buffer/DisplayBufferOptionsArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/RestRoom":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/RestEvent":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/ICollaborationEventViewModel":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/RestRoomRequestArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/QueryResponse":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/QueryOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/RestEventRequestArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/RoomQueryOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/collaboration/ICollaborationHandler":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/AddStatusArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i,r,n,a){this.text=e,this.imageProperties=t,this.userClosedCallback=i,this.id=r,this.timeoutMS=n||3e4,this.showBusyIcon=!!a}return e}();t.AddStatusArgs=i})},"geocortex/infrastructure/commandArgs/ClusterLayerArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();t.ClusterLayerArgs=i})},"geocortex/infrastructure/selection/CombineResultsResponse":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/CombineResultsArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/ContextMenuArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/CreateOrEditFeatureFromBarcodeScanArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/EditInMemoryArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/CutGraphicsArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/DeleteAttachmentsArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/DownloadOfflineResourcesArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/EditAttachmentArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/EditFeatureArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/EditRelatedRecordArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/ExportGraphicsLayerArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/selection/SelectionMetadata":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/FindAllSelectionMetadataArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/FindMetadataForSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/FindSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/GeolocateArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/HeatMapArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/HighlightFeatureArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/identify/IdentifiableLayerInfo":function(){
define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/IdentifyArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/MarkerArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/PushpinArgs":function(){define(["require","exports","geocortex/infrastructure/Feature"],function(e,t,i){"use strict";function r(e){return!!(e&&e.feature&&e.feature instanceof i.Feature&&e.tag)}t.isPushpinArgs=r})},"geocortex/infrastructure/commandArgs/SelectionArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/RenameSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/RunReportArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/ShowMapElementArgs":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FilterUtils"],function(e,t,i,r){"use strict";var n=function(){function e(e,t,i,r){this.destroyContentView=!1,this.delay=0,this.elementID=e||null,this.mapPoint=t||null,this.content=i||null,this.title=r||null}return e.prototype.getNode=function(){if(this.content){if(this.contentIsView())return this.content.root;if(this.content.nodeName)return this.content;if("string"==typeof this.content){var e=document.createElement("div");return e.innerHTML=new r.UnsafeHtml(this.content).safeHtml,e}}return null},e.prototype.getTitleNode=function(){if(this.title){if(this.titleIsView())return this.title.root;if(this.title.nodeName)return this.title;if("string"==typeof this.title){var e=document.createElement("div");return e.innerHTML=new r.UnsafeHtml(this.title).safeHtml,e}}return null},e.prototype.contentIsView=function(){return this.content&&this.content instanceof i.ViewBase},e.prototype.titleIsView=function(){return this.title&&this.title instanceof i.ViewBase},e}();t.ShowMapElementArgs=n})},"geocortex/infrastructure/commandArgs/ShowOfflineProfileEditorArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/TapToDismissArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/UpdateGraphicsArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/UpdateMetadataForSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/commandArgs/VisualizationArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/coordinates/AngleDirectionSystem":function(){define(["require","exports"],function(e,t){"use strict";t.POLAR="polar",t.NORTH_AZIMUTH="north_azimuth",t.SOUTH_AZIMUTH="south_azimuth"})},"geocortex/infrastructure/documents/DocumentCollectionConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/documents/DocumentFieldSorter":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/documents/DocumentCollection":function(){define(["require","exports","geocortex/framework/FrameworkObject","geocortex/framework/observables","geocortex/essentials/documents/DocumentConstants"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i,n){var a=e.call(this,t,i)||this;return a._pageSize=10,a._queryParams={},a.isInitialized=!1,a.stopFetching=!1,a.items=new r.ObservableCollection,a.numberOfItems=new r.Observable(0),a.currIndexStart=new r.Observable(0),a.currIndexStartFromOne=new r.Observable(1),a.currIndexEnd=new r.Observable(0),a.currPageNumber=new r.Observable(1),a.firstPageNumber=new r.Observable(1),a.lastPageNumber=new r.Observable(1),a.statusFetching=new r.Observable((!1)),a.statusOffline=new r.Observable((!1)),a._mapCallback=n,a}return __extends(t,e),t.prototype.initialize=function(e){var t=this;void 0===e&&(e={}),e.pageSize&&(this._pageSize=e.pageSize),e.queryParams&&(this._queryParams=dojo.mixin(this._queryParams,e.queryParams)),e.fileType&&this.addFilter({field:n.DocumentField.FILE_TYPE,method:n.FilterMethod.VALUES,range:[{string:e.fileType}]}),this.isInitialized=!0,this.currIndexStartFromOne.syncTransform(this.currIndexStart,function(e){return e+1}),this.currPageNumber.bind(this,function(){return t._handlePageChanged()}),this._populateFromDocStore()},t.prototype.getLength=function(){return this.numberOfItems.get()},t.prototype.nextPage=function(){this.currPageNumber.set(this.currPageNumber.get()+1)},t.prototype.prevPage=function(){this.currPageNumber.set(this.currPageNumber.get()-1)},t.prototype.refresh=function(){this._populateFromDocStore()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.items&&this.items.clear()},t.prototype.setQueryParameters=function(e){this._queryParams=e,this.currPageNumber.set(1)},t.prototype.getQueryParameters=function(){return this._queryParams},t.prototype.addFilter=function(e,t){void 0===t&&(t=n.FilterType.REQUIRE),this._queryParams.filters||(this._queryParams.filters={}),this._queryParams.filters[t]||(this._queryParams.filters[t]=[]),this._queryParams.filters[t]=this._queryParams.filters[t].filter(function(t){return t.field!==e.field}),this._queryParams.filters[t].push(e),this.currPageNumber.set(1)},t.prototype.removeFilter=function(e,t){void 0===t&&(t=n.FilterType.REQUIRE),this._queryParams.filters&&this._queryParams.filters[t]&&(this._queryParams.filters[t]=this._queryParams.filters[t].filter(function(t){return t.field!==e}),0===this._queryParams.filters[t].length&&delete this._queryParams.filters[t],this.currPageNumber.set(1))},t.prototype.sortBy=function(e){e.fields&&0!==e.fields.length&&(e.descending?(delete this._queryParams.sort,this._queryParams.sortDescending=e.fields):(delete this._queryParams.sortDescending,this._queryParams.sort=e.fields),this.currPageNumber.set(1))},t.prototype._handlePageChanged=function(){this.currPageNumber.value=Math.max(1,Number(this.currPageNumber.get())),this.currPageNumber.get()>this.lastPageNumber.get()&&this.lastPageNumber.get()>0?this.currPageNumber.set(this.lastPageNumber.get()):(this.currIndexStart.set((this.currPageNumber.get()-1)*this._pageSize),this.currIndexEnd.set(Math.min(this.numberOfItems.get(),this.currIndexStart.get()+this._pageSize)),this._populateFromDocStore())},t.prototype._populateFromDocStore=function(){var e=this;if(this.app.site.documentStore.supported&&this.isInitialized&&!this.stopFetching){this.statusFetching.set(!0);var t=this._buildQueryParams();this.app.waitUntilSiteInitialized().then(function(){return e.statusOffline.set(!1)}).then(function(){return e.app.site.documentStore.query(t)}).then(function(t){return e._handleQueryResult(t)})["catch"](function(t){e.items.clear(),e.numberOfItems.set(0),e.statusOffline.set(!0),e.app.trace.error("Error fetching documents: {0}".format(t),t)})["finally"](function(){return e.statusFetching.set(!1)})}},t.prototype._buildQueryParams=function(){var e=dojo.mixin({},this._queryParams);return e.start=this.currIndexStart.get(),e.limit=this._pageSize,e},t.prototype._handleQueryResult=function(e){this.items.set(e.results.map(this._mapCallback));var t=e.total?e.total:0;this.numberOfItems.set(t);var i=Math.ceil(t/this._pageSize);this.lastPageNumber.set(i),this.firstPageNumber.set(1),this.currIndexStart.set((this.currPageNumber.get()-1)*this._pageSize),this.currIndexEnd.set(Math.min(this.numberOfItems.get(),this.currIndexStart.get()+this._pageSize))},t}(i.FrameworkObject);t.DocumentCollection=a})},"geocortex/infrastructure/documents/MonikerModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/documents/MonikerModel":function(){define(["require","exports","geocortex/framework/observables","geocortex/essentials/documents/DocumentConstants"],function(e,t,i,r){"use strict";var n=function(){function e(e){if(this.grants=[],this.isGlobal=!1,this.isPublic=!1,this.isRevoked=new i.Observable((!1)),this.canRead=!1,this.canWrite=!1,this.canEdit=!1,this.enabled=new i.Observable((!0)),!e.id&&!e.grant)throw new Error('MonikerModel: parameter "id" or "grant" is required.');e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.iconUri&&(this.iconUri=e.iconUri),e.isGlobal&&(this.isGlobal=e.isGlobal),e.isPublic&&(this.isPublic=e.isPublic),e.grant&&(this.id=e.grant.globalId,e.grant.subject&&(this.name=e.grant.subject.title),this.addGrant(e.grant))}return e.prototype.addGrant=function(e){switch(this.grants.push(e),e.kind){case r.GrantKind.READER:this.canRead=!0;break;case r.GrantKind.WRITER:this.canWrite=!0;break;case r.GrantKind.OWNER:this.canEdit=!0}},e}();t.MonikerModel=n})},"geocortex/infrastructure/documents/MonikerKindDesc":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/documents/GrantEditorViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/essentials/documents/DocumentConstants","geocortex/framework/observables","geocortex/infrastructure/documents/MonikerModel","geocortex/framework/utils/ArrayUtils","geocortex/essentials/documents/BatchRequestBuilder"],function(e,t,i,r,n,a,o,s){"use strict";var l=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a._supportedGrantKinds=[r.GrantKind.READER,r.GrantKind.WRITER],a._globalGrantIds=[r.GrantID.PUBLIC,r.GrantID.USER],a._allowPublicAccess=!1,a._lastSearchResults=[],a.defaultGrantKind=r.GrantKind.READER,a.userIconUri="Resources/Images/Icons/user-inactive-16.png",a.roleIconUri="Resources/Images/Icons/team-16.png",a.document=null,a.grants=[],a.monikers=new n.ObservableCollection,a.isValidMoniker=new n.Observable((!1)),a.monikerKinds=new n.ObservableCollection,a.selectedMonikerKind=new n.Observable,a.selectedMoniker=new n.Observable,a.searchText=new n.Observable,a.enabled=new n.Observable((!0)),a.editOwnership=new n.Observable((!1)),a.searchText.syncTransform(a.selectedMonikerKind,function(){return""}),a.isValidMoniker.syncTransform(a.selectedMoniker,function(e){return!!e}),a.enabled.bind(a,function(){return a._setMonikerEnableds()}),a._setMonikerKinds(),a.app.site&&a.app.site.isInitialized?a.onSiteInitialized():a.app.event("SiteInitializedEvent").once(a,a.onSiteInitialized),a}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&t.editOwnership&&(this._supportedGrantKinds=[r.GrantKind.READER,r.GrantKind.WRITER,r.GrantKind.OWNER],this.editOwnership.set(!0))},t.prototype.onSiteInitialized=function(){var e=this;this.app.site.documentStore.onInitialized().then(function(){e._allowPublicAccess=e.app.site.documentStore.hasPolicyGrant(function(e){return e.globalId===r.GrantID.PUBLIC&&e.kind===r.GrantKind.GLOBAL_READER})})},t.prototype.loadById=function(e){var t=this;return this.app.waitUntilSiteInitialized().then(function(){return t.app.site.documentStore.getById(e)}).then(function(e){return t._updateModel(e)})["catch"](function(e){t.app.trace.error("Error loading document: {0}".format(e),e),t.reset()})},t.prototype.addMoniker=function(){var e=this._getSelectedMoniker();if(!e)return void this.app.trace.error("GrantEditorViewModel: Could not find moniker with title {0}.".format(this.searchText.get()));if(this._monikerExists(e))return void this.app.trace.warning("GrantEditorViewModel: Could not add the grant as it already exists.");var t;t=this.app.site.documentStore.userMonikers.some(function(t){return t.id===e.id})&&this._supportedGrantKinds.some(function(e){return e===r.GrantKind.OWNER})?this.addGrant(e.globalId,r.GrantKind.OWNER):this.addGrant(e.globalId,this.defaultGrantKind),this.monikers.addItem(new a.MonikerModel({grant:t,name:e.title,iconUri:this._isUserKind(this.selectedMonikerKind.get())?this.userIconUri:this.roleIconUri})),this._setMonikerEnableds()},t.prototype.addGrant=function(e,t){var i={globalId:e,kind:t,assert:!0};return this.grants.push(i),i},t.prototype.updateMoniker=function(e,t){switch(e.grants.forEach(function(e){e.assert=!1,e.revoke=!0}),t){case r.GrantKind.READER:case r.GrantKind.WRITER:case r.GrantKind.OWNER:var i=o.firstOrDefault(e.grants,function(e){return e.kind===t});i||(i=this.addGrant(e.id,t),e.addGrant(i)),i.assert=!0,i.revoke=!1,this._globalGrantIds.some(function(t){return t===e.id})||e.isRevoked.set(!1);break;default:this._globalGrantIds.some(function(t){return t===e.id})||e.isRevoked.set(!0)}},t.prototype.searchMonikers=function(e){var t,i=this;return t=this._isUserKind(this.selectedMonikerKind.get())?s.searchUsers(e):s.searchRoles(e),this.app.waitUntilSiteInitialized().then(function(){return i.app.site.documentStore.perform(t)}).then(function(e){return i._lastSearchResults=e.monikers})},t.prototype.validateSearchInput=function(){var e=this;this.selectedMoniker.get()&&this.searchText.get()&&this.isValidMoniker.set(this._lastSearchResults.some(function(t){return t.title===e.searchText.get()}))},t.prototype.resetOptions=function(){this.searchText.set(null),this.selectedMoniker.set(null)},t.prototype.reset=function(){this._updateModel(null)},t.prototype._getSelectedMoniker=function(){var e=this;return this.selectedMoniker.get().title===this.searchText.get()?this.selectedMoniker.get():this._lastSearchResults.filter(function(t){return t.title===e.searchText.get()})[0]},t.prototype._isUserKind=function(e){return e===r.MonikerKind.USER},t.prototype._updateModel=function(e){this.document=e,this.grants=e&&e.grants?e.grants:[],this.resetOptions(),this._updateMonikers(this.grants)},t.prototype._updateMonikers=function(e){this.monikers.clear();for(var t=[],i=0;i<this._globalGrantIds.length;i++){var n=this._globalGrantIds[i];t.push(new a.MonikerModel({id:n,name:this.app.getResource(this.libraryId,"language-grant-editor-global-grant-name-{0}".format(n)),iconUri:this.roleIconUri,isGlobal:!0,isPublic:n===r.GrantID.PUBLIC}))}for(var i=0;i<this._supportedGrantKinds.length;i++)for(var s=0;s<e.length;s++){var l=e[s];if(l.kind===this._supportedGrantKinds[i]){var c=o.firstOrDefault(t,function(e){return e.id===l.globalId});c?c.addGrant(l):t.push(new a.MonikerModel({grant:l,iconUri:this._isUserKind(l.subject.kind)?this.userIconUri:this.roleIconUri}))}}this._allowPublicAccess||(t=t.filter(function(e){return!e.isPublic})),this.monikers.addItems(t),this._setMonikerEnableds()},t.prototype._monikerExists=function(e){if(!e)return!1;var t=this.monikers.getItems();if(t.some(function(t){return t.id===e.globalId}))return!0;if(e.aliases)for(var i=0;i<e.aliases.length;i++){var r=e.aliases[i];if(t.some(function(e){return e.id===r}))return!0}return!1},t.prototype._setMonikerKinds=function(){this.monikerKinds.addItems([{kind:r.MonikerKind.USER,displayName:this.app.getResource(this.libraryId,"language-grant-editor-moniker-type-user")},{kind:r.MonikerKind.ROLE,displayName:this.app.getResource(this.libraryId,"language-grant-editor-moniker-type-role")}]),this.selectedMonikerKind.set(this.monikerKinds.getAt(0).kind)},t.prototype._setMonikerEnableds=function(){for(var e=this.enabled.get(),t=0,i=this.monikers.get();t<i.length;t++){var n=i[t],a=this.app.site.documentStore.userMonikers.some(function(e){return e.id===n.id}),o=n.grants.some(function(e){return e.kind===r.GrantKind.OWNER&&!e.revoke});a&&o?n.enabled.set(!1):n.enabled.set(e)}},t}(i.ViewModelBase);t.GrantEditorViewModel=l})},"geocortex/infrastructure/documents/GrantEditorView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.autoCompleteMinLength=0,t.autoCompleteMaxEntries=10,t}return __extends(t,e),t.prototype.added=function(t){e.prototype.added.call(this,t),this._setupJQueryAutocomplete()},t.prototype.handleInputChanged=function(e,t,i){this.viewModel.validateSearchInput()},t.prototype.handleAddMonikerButtonClick=function(e,t,i){this.viewModel.addMoniker(),this.viewModel.resetOptions()},t.prototype.handleUpdateMoniker=function(e,t,i){return this.viewModel.updateMoniker(i,t.value),!0},t.prototype.handleAutoCompleteBlur=function(e,t,i){$(t).autocomplete("widget").hide()},t.prototype.getSuggestions=function(e,t){var i=this;this.viewModel.searchMonikers(e.term).then(function(e){return i._processMonikers(e)}).then(function(e){return t(e)})["catch"](function(e){return t([])})},t.prototype._processMonikers=function(e){var t=[];return e.length>0&&(t=e.slice(0,this.autoCompleteMaxEntries).map(function(e){return{label:e.title,moniker:e}})),Promise.resolve(t)},t.prototype._setupJQueryAutocomplete=function(){var e=this,t=!(!dojo.isIE&&!navigator.userAgent.match(/Trident\/7\./)),i={minLength:this.autoCompleteMinLength,source:function(i,r){t&&!$(e.autoCompleteInput).is(":focus")||e.getSuggestions(i,r)},select:function(t,i){return e._handleAutoCompleteSelect(t,i),!1}};$(this.autoCompleteInput).autocomplete(i)},t.prototype._handleAutoCompleteSelect=function(e,t){this.viewModel.searchText.set(t.item.label),this.viewModel.selectedMoniker.set(t.item.moniker)},t}(i.ViewBase);t.GrantEditorView=r})},"geocortex/infrastructure/documents/GuestLinkModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/documents/GuestLinkModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r=function(){function e(e){this.name=new i.Observable,this.linkUrl=new i.Observable,e.kind&&(this.kind=e.kind),e.name&&this.name.set(e.name)}return e.prototype.reset=function(){this.grant=null,this.link=null,this.linkUrl.set(null)},e}();t.GuestLinkModel=r})},"geocortex/infrastructure/eventArgs/ActiveToolChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/AuthenticationEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.result=null,this.username=null,this.token=null}return e}();t.AuthenticationEventArgs=i})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlItemInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/FilterControlEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/FilterControlQueryChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GeolocationEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.mapPoint=null,this.projectedMapPoint=null,this.location=null,this.typeOfGeolocation=null,this.accuracyThreshold=null,this.timedOut=!1}return e}();t.GeolocationEventArgs=i})},"geocortex/infrastructure/eventArgs/GeometryEditCompletedEventArg":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GraphicAttributesChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GraphicEditingDoneEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/GraphicRemovedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/LayerDefinitionExpressionAppliedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/MapExtentEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.centerLatLon=null,this.currentScale=null,this.currentResolution=null}return e}();t.MapExtentEventArgs=i})},"geocortex/infrastructure/eventArgs/MapServiceLayersChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/MarkerDragEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/MarkerPointerEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/OfflineMapEditorFinishedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/OfflineMapEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/PlotCoordinatesEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/PlotCoordinatesIdUpdatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/ProjectEditorFinishedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/QueryCompletedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/ReportResultEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/ResultsPageChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();t.ResultsPageChangedEventArgs=i})},"geocortex/infrastructure/eventArgs/SelectionEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/SelectionChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/StateChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/toolbarGroup/types/ToolbarToggleButton":function(){define(["require","exports","geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase","geocortex/infrastructure/CommandViewModel","geocortex/framework/observables","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(e,t,i,r,n,a){"use strict";var o;!function(e){e[e.TOGGLE_BUTTON_OFF=0]="TOGGLE_BUTTON_OFF",e[e.TOGGLE_BUTTON_ON=1]="TOGGLE_BUTTON_ON"}(o=t.ToggleButtonState||(t.ToggleButtonState={}));var s=function(e){function t(t,i,a){var s=e.call(this,t,i,a)||this;return s.state=new n.Observable(null),s.toggleButtonEntry=a,s.toggleOnCommand=new r.CommandViewModel(s.app,i,a.toggleOn.command,a.toggleOn.commandParameter),s.toggleOffCommand=new r.CommandViewModel(s.app,i,a.toggleOff.command,a.toggleOff.commandParameter),s.isToggledOn=new n.Observable((!1)),s.iconUri=new n.Observable(null),s.state.bind(s,function(e){return s.setState(e)}),s.toggleButtonEntry.toggleStateName&&""!==s.toggleButtonEntry.toggleStateName?(s.app.event("StateEnteredEvent").subscribe(s,function(e){e.stateDefinition.name===s.toggleButtonEntry.toggleStateName&&s.state.set(o.TOGGLE_BUTTON_ON),s.isToggledOn.get()&&"TransientActiveState"===e.stateDefinition.name&&s.activeTransient.set(!0)}),s.app.event("StateExitedEvent").subscribe(s,function(e){e.stateDefinition.name===s.toggleButtonEntry.toggleStateName&&s.state.set(o.TOGGLE_BUTTON_OFF),"TransientActiveState"===e.stateDefinition.name&&s.activeTransient.set(!1)})):s._setUpBindings(),s.app.site&&s.app.site.isInitialized||s.app.event("SiteInitializedEvent").once(s,function(){s.toggleOffCommand.commandName&&s.app.command(s.toggleOffCommand.commandName).raiseCanExecuteChanged(),s.toggleOnCommand.commandName&&s.app.command(s.toggleOnCommand.commandName).raiseCanExecuteChanged(),s.state.get()===o.TOGGLE_BUTTON_OFF?s.disabled.set(!s.toggleOffCommand.canExecute.get()):s.disabled.set(!s.toggleOnCommand.canExecute.get())}),a.toggleStateName&&s.app.stateManager.isCurrentlyActive(a.toggleStateName)?s.state.set(o.TOGGLE_BUTTON_ON):s.state.set(o.TOGGLE_BUTTON_OFF),s}return __extends(t,e),t.prototype.execute=function(){this.command&&this.command.commandName&&(this.command.commandParameter?this.app.commandRegistry.command(this.command.commandName).execute(this.command.commandParameter):this.app.commandRegistry.command(this.command.commandName).execute())},t.prototype.setState=function(e){if(e===o.TOGGLE_BUTTON_OFF)var t=this.toggleButtonEntry.toggleOn.name||this.toggleButtonEntry.name||"",i=this.toggleButtonEntry.toggleOn.iconUri||this.toggleButtonEntry.iconUri||null,r=this.toggleButtonEntry.toggleOn.tooltip||this.toggleButtonEntry.tooltip||null,n=void 0!=this.toggleButtonEntry.toggleOn.hideOnDisable?!!this.toggleButtonEntry.toggleOn.hideOnDisable:!!this.toggleButtonEntry.hideOnDisable,a=!1;else var t=this.toggleButtonEntry.toggleOff.name||this.toggleButtonEntry.name||"",i=this.toggleButtonEntry.toggleOff.iconUri||this.toggleButtonEntry.iconUri||null,r=this.toggleButtonEntry.toggleOff.tooltip||this.toggleButtonEntry.tooltip||null,n=void 0!=this.toggleButtonEntry.toggleOff.hideOnDisable?!!this.toggleButtonEntry.toggleOff.hideOnDisable:!!this.toggleButtonEntry.hideOnDisable,a=!0;this.name.set(t),this.isToggledOn.set(a),this.iconUri.set(i),this.tooltip.set(r),this.command=e===o.TOGGLE_BUTTON_OFF?this.toggleOnCommand:this.toggleOffCommand,this.disabled.set(!this.command.canExecute.get()),this.hideOnDisable.set(n),this.setHidden(),this.app.event("ToggleButtonStateChangedEvent").publish({toggleButtonEntry:this.toggleButtonEntry,state:e})},t.prototype.onDestroy=function(){this._disconnectBindings()},t.prototype._setUpBindings=function(){var e=this;this._toggleOnCommandCanExecuteBindingToken=this.toggleOnCommand.canExecute.bind(this,function(t){return e._handleCommandCanExecuteChanged(e.toggleOnCommand,t)}),this._toggleOnCommandPostExecSubscriptionToken=this.app.command(this.toggleButtonEntry.toggleOn.command).postExecute.subscribe(this,this._handleToggleOnCommandPostExecute),this._toggleOffCommandCanExecuteBindingToken=this.toggleOffCommand.canExecute.bind(this,function(t){return e._handleCommandCanExecuteChanged(e.toggleOffCommand,t)}),this._toggleOffCommandPostExecSubscriptionToken=this.app.command(this.toggleButtonEntry.toggleOff.command).postExecute.subscribe(this,this._handleToggleOffCommandPostExecute)},t.prototype._disconnectBindings=function(){this.toggleOnCommand.canExecute.unbind(this._toggleOnCommandCanExecuteBindingToken),this.app.command(this.toggleButtonEntry.toggleOn.command).postExecute.unsubscribe(this._toggleOnCommandPostExecSubscriptionToken),this.toggleOffCommand.canExecute.unbind(this._toggleOffCommandCanExecuteBindingToken),this.app.command(this.toggleButtonEntry.toggleOff.command).postExecute.unsubscribe(this._toggleOffCommandPostExecSubscriptionToken)},t.prototype._handleToggleOnCommandPostExecute=function(e){e&&this.command.commandParameter!==e||this.state.get()!==o.TOGGLE_BUTTON_ON&&this.state.set(o.TOGGLE_BUTTON_ON)},t.prototype._handleToggleOffCommandPostExecute=function(e){e&&this.command.commandParameter!==e||this.state.get()!==o.TOGGLE_BUTTON_OFF&&this.state.set(o.TOGGLE_BUTTON_OFF)},t.prototype._handleCommandCanExecuteChanged=function(e,t){this.command===e&&(this.disabled.set(!t),this.setHidden())},t}(i.ToolbarGroupItemBase);t.ToolbarToggleButton=s,a.registerToolbarFactoryMethod("toggleButton",function(e,t,i){return new s(e,t,i)})})},"geocortex/infrastructure/eventArgs/ToggleButtonStateChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/ToolbarButtonClickedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/ToolbarTabChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/TransientActivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/UndoRedoEventArgs":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/eventArgs/UserEventArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.isCancelled=!1}return e}();t.UserEventArgs=i})},"geocortex/infrastructure/featureDetails/FeatureProviderConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/featureDetails/FeatureProviderBase":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.currentFeature=new r.Observable(null),n.providerEnabled=new r.Observable((!1)),n.currentFeature.bind(n,n.handleCurrentFeatureChanged),n}return __extends(t,e),t.prototype.initialize=function(e){},t.prototype.handleCurrentFeatureChanged=function(e){},t.prototype.updateProviderState=function(e){var t=!!this.currentFeature.get()&&!!e;this.providerEnabled.get()!==t&&this.providerEnabled.set(t)},t.prototype.createAttachedViews=function(e,t,i,r){var n=this,a=[];if(e.viewType&&e.markup&&t){var o=function(i,o,s){var l=t[o];if(null!==l)if(l){var c=n.app.viewManager.createView({viewId:s,markupResource:i,typeName:e.viewType,iconUri:e.iconUri,title:e.title||"",regionName:l,isVisible:!0,libraryId:e.libraryId||n.libraryId,configuration:e.viewConfig});c.attach(r||n),a.push(c)}else n.app.trace.warning("FeatureProviderBase: Could not resolve target region for view mode {0}. Failed to create view with id {1}".format(o,s))};if("string"==typeof e.markup)o(e.markup,"default",e.viewId||null);else for(var s in e.markup)if(e.markup.hasOwnProperty(s)){var l=e.viewId?"{0}-{1}".format(e.viewId,s):null;o(e.markup[s],s,l)}i&&"function"==typeof i&&i(a)}else this.app.trace.warning("FeatureProviderBase: View type, markup or region not specified. Cannot create view for {0}".format(e.type))},t}(i.ViewModelBase);t.FeatureProviderBase=n})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelState":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t,i,n){for(var a=!0,c=null,u=o(e),d=function(e){if(a){var r=document.getElementById(n+"_layer");c=document.createElementNS("http://www.w3.org/2000/svg","text"),c.setAttributeNS(null,"font-size",i),c.setAttributeNS(null,"font-family",t),c.setAttributeNS(null,"visibility","hidden"),c.textContent=e,r.appendChild(c),a=!1}else c.textContent=e;var o=c.getBBox();return s=null===s?o.height:s,l[e]=c.getComputedTextLength(),l[e]},p=r(e),h=0,m=0;p&&m<p.length;m++){for(var f=e.length,g=0,y=0;y<f;y++){var b=p[m].charAt(y);b=" "===b?".":b,g+=l.hasOwnProperty(b)?l[b]:d(b)}g>h&&(h=g)}return{width:Math.ceil(h),height:Math.ceil(s*u)}}function r(e){return e.split(c)}function n(e,t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=e/5);var a="";return a=0===i?"M1,0h"+e+"v"+t:"M1,0h"+(e-i)+"a"+i+","+i+" 0 0 1 "+i+","+i+"v"+(t-2*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i,a+=r?"h"+(i-(e-n))/2+"l"+-(n/2)+","+n/2+"l"+-(n/2)+","+-(n/2)+"h"+(i-(e-n))/2:"h"+(i-e),a+=0===i?"z":"a"+i+","+i+" 0 0 1 "+-i+","+-i+"v"+(2*i-t)+"a"+i+","+i+" 0 0 1 "+i+","+-i+"z"}function a(e){var t="";if(!e)throw new Error("HighlightLabelUtils: Cannot generate SVG circle path. Radius cannot be zero or undefined.");return t="M0,0a"+e+","+e+" 0 0 1 "+e+","+e+"a"+e+","+e+" 0 0 1 "+-e+","+e+"a"+e+","+e+" 0 0 1 "+-e+","+-e+"a"+e+","+e+" 0 0 1 "+e+","+-e+"z"}function o(e){return(c.test(e)?e.match(c).length:0)+1}var s=null,l={},c=/\r\n|\r|\n/g;t.getLabelSize=i,t.getTextLines=r,t.generateSvgHighlightLabelPath=n,t.generateSvgCirclePath=a})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic":function(){define(["require","exports","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/highlightedLabel/HighlightedLabelUtils"],function(e,t,i,r){"use strict";var n;!function(e){e[e.BOTTOM_LEFT=0]="BOTTOM_LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.CALLOUT=2]="CALLOUT"}(n=t.HighlightedLabelAnchor||(t.HighlightedLabelAnchor={}));var a=function(){function e(e,t){if(this.textGraphics=[],
this.textSymbols=[],this._height=0,this._width=0,this._padding=0,this._calloutSizeWidthFraction=5,this._tagHeightPercentage=.6,!t||!this._processConfig(e))throw new Error("HighlightedLabelGraphic: Initialization failed.");this.app=t,this.graphicsLayer=i.getInternalGraphicsLayer(this._config.layerId,this.app,i.GraphicsLayerType.Label),e._isRestoringState||this._executeSetupRoutine()}return e.prototype.getTextFontFamily=function(){return this.textSymbols&&this.textSymbols.length>0?this.textSymbols[0].font.family:this._config.fontFamily},e.prototype.getTextFontSize=function(){return this.textSymbols&&this.textSymbols.length>0?this.textSymbols[0].font.size+"px":this._config.fontSize},e.prototype.getWidth=function(){return this._width},e.prototype.getTotalWidth=function(){return this._width+this._padding},e.prototype.getHeight=function(){return this._height},e.prototype.getTotalHeight=function(){return this._height+this._padding},e.prototype.getMapPoint=function(){return this._config.mapPoint},e.prototype.getConfig=function(){return this._config},e.prototype.addToLayer=function(e){var t=this;void 0===e&&(e=!0),i.addGraphicToLayer(this.highlightGraphic,this._config.layerId,this.app),i.addGraphicToLayer(this.highlightIdTagGraphic,this._config.layerId,this.app),this.textGraphics.forEach(function(e){i.addGraphicToLayer(e,t._config.layerId,t.app)}),e?this.show():this.hide()},e.prototype.removeFromLayer=function(e){this.hide();var t=function(e){var t=e.getLayer();t&&t.remove(e)};this.textGraphics&&this.textGraphics.length>0&&(this.textGraphics.forEach(function(e){return t(e)}),e&&(this.textGraphics.length=0,this.textSymbols.length=0)),this.highlightIdTagGraphic&&(t(this.highlightIdTagGraphic),e&&(this.highlightIdTagGraphic=null,this.highlightIdTagSymbol=null)),this.highlightGraphic&&(t(this.highlightGraphic),e&&(this.highlightGraphic=null,this.highlightIdTagSymbol=null))},e.prototype.isVisible=function(){return!!this.highlightGraphic&&(this.highlightGraphic.visible&&(!this._config.calloutWithIdTag||this.highlightIdTagGraphic.visible)&&this.textGraphics.filter(function(e){return e.visible}).length>0)},e.prototype.show=function(){return this.highlightGraphic&&this.highlightGraphic.show(),this.highlightIdTagGraphic&&this.highlightIdTagGraphic.show(),this.textGraphics&&this.textGraphics.length>0&&this.textGraphics.forEach(function(e){e.show()}),this},e.prototype.hide=function(){return this.textGraphics&&this.textGraphics.length>0&&this.textGraphics.forEach(function(e){e.hide()}),this.highlightIdTagGraphic&&this.highlightIdTagGraphic.hide(),this.highlightGraphic&&this.highlightGraphic.hide(),this},e.prototype.update=function(e,t){if(this.highlightGraphic&&this.textGraphics.length){var i=this.isVisible(),r=this._key?this.highlightGraphic[this._key]:null;this._config.text=t||"",this._config.mapPoint=e&&e instanceof esri.geometry.Point?e:this._config.mapPoint,this.removeFromLayer(!0),this._executeSetupRoutine(),this.addToLayer(i),r&&this.assignGraphicIdentifierKey(this._key,r)}},e.prototype.refresh=function(e){if(this.highlightGraphic&&this.textGraphics.length){var t=this.isVisible(),i=this._key?this.highlightGraphic[this._key]:null;this._config.text=e||"",this.removeFromLayer(!0),this._executeSetupRoutine(),this.addToLayer(t),i&&this.assignGraphicIdentifierKey(this._key,i)}},e.prototype.moveToTop=function(){var e=this.highlightGraphic.getDojoShape();if(e&&e.moveToFront(),this.highlightIdTagGraphic){var t=this.highlightIdTagGraphic.getDojoShape();t&&t.moveToFront()}for(var i,r=0;r<this.textGraphics.length;r++)i=this.textGraphics[r].getDojoShape(),i&&i.moveToFront()},e.prototype.assignGraphicIdentifierKey=function(e,t){this._key=e,this.highlightGraphic[e]=t,this.highlightIdTagGraphic&&(this.highlightIdTagGraphic[e]=t),this.textGraphics.forEach(function(i){i[e]=t})},e.prototype.updateIdTagText=function(e){if(e&&this._config.calloutWithIdTag){this._config.idTagText=e;var t=this.textGraphics[this.textGraphics.length-1];t&&t.symbol&&(t.symbol.setText(e),t.setSymbol(t.symbol))}},e.prototype.setHighlightColor=function(e){if(e&&e instanceof esri.Color&&this.highlightSymbol&&(this._config.highlightColor=e,this.highlightSymbol&&this.highlightGraphic&&(this.highlightSymbol.setColor(e),this.highlightGraphic.setSymbol(this.highlightSymbol))),this._config.calloutWithIdTag){var t=this.textGraphics[this.textGraphics.length-1];this.highlightIdTagSymbol&&this.highlightIdTagGraphic&&(this.highlightIdTagSymbol.outline.setColor(e),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)),t&&(t.symbol.setColor(e),t.setSymbol(t.symbol))}},e.prototype.setTextColor=function(e){if(e&&e instanceof esri.Color){this._config.textColor=e;var t=this.textGraphics.length;this._config.calloutWithIdTag&&(this.highlightIdTagSymbol&&this.highlightIdTagGraphic&&(this.highlightIdTagSymbol.setColor(e),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)),t--);for(var i=0;i<t;i++){var r=this.textGraphics[i];r&&(r.symbol.setColor(e),r.setSymbol(r.symbol))}}},e.prototype.exportState=function(e){var t=e.project.convert,i=this.getConfig();return{highlightGraphic:t.fromEsriGraphic(this.highlightGraphic),highlightSymbol:t.fromEsriSymbol(this.highlightSymbol),textGraphics:this.textGraphics.map(function(e){return t.fromEsriGraphic(e)}),textSymbols:this.textSymbols.map(function(e){return t.fromEsriSymbol(e)}),layerId:i.layerId,mapPoint:t.fromEsriGeometry(this.getMapPoint()),labelXoffset:i.labelXoffset,labelYoffset:i.labelYoffset,text:i.text,fontFamily:i.fontFamily,fontSize:i.fontSize,cornerRadius:i.cornerRadius,angle:i.angle,anchor:i.anchor,textColor:t.fromEsriColor(i.textColor),highlightColor:t.fromEsriColor(i.highlightColor),highlightOutlineSymbol:t.fromEsriSymbol(i.highlightOutlineSymbol)}},e.fromExportedState=function(t,i,r){return Promise["try"](function(){if(!t||!t.highlightGraphic)throw new Error("HighlightedLabelGraphic.fromExportedState: Invalid state.");if(!i)throw new Error('HighlightedLabelGraphic.fromExportedState: Parameter "app" is required.');var n=i.project.convert,a={highlightGraphic:n.toEsriGraphic(t.highlightGraphic),textGraphics:Promise.map(t.textGraphics,function(e){return n.toEsriGraphic(e)})};return Promise.props(a).then(function(a){var o={layerId:t.layerId,mapPoint:n.toEsriGeometry(t.mapPoint),text:t.text,labelXoffset:t.labelXoffset,labelYoffset:t.labelYoffset,fontFamily:t.fontFamily,fontSize:t.fontSize,cornerRadius:t.cornerRadius,angle:t.angle,anchor:t.anchor,textColor:n.toEsriColor(t.textColor),highlightColor:n.toEsriColor(t.highlightColor),highlightOutlineSymbol:n.toEsriSymbol(t.highlightOutlineSymbol)};o._isRestoringState=!0,r=r||e.prototype;var s=Object.create(r);return s.constructor.call(s,o,i),s.initializeHighlightDimensions(),s.highlightGraphic=a.highlightGraphic,s.highlightSymbol=n.toEsriSymbol(t.highlightSymbol),s.textGraphics=a.textGraphics,s.textSymbols=t.textSymbols.map(function(e){return n.toEsriSymbol(e)}),s})})},e.prototype._executeSetupRoutine=function(){this.initializeHighlightDimensions(),this.initializeHighlightGraphic(),this.initializeHighlighteIdTagGraphic(),this.initializeTextGraphicsAndSymbols()},e.prototype.setHighlightAnchor=function(){switch(this._config.anchor){case n.BOTTOM_LEFT:this.highlightSymbol.setOffset(this.getTotalWidth()/2,this.getTotalHeight()/2);break;case n.CALLOUT:this.highlightSymbol.setOffset(0,this.getTotalHeight()/2+this._config.calloutPixelSize/4);break;default:this.highlightSymbol.setOffset(0,0)}this.highlightSymbol.setOffset(this.highlightSymbol.xoffset+this._config.labelXoffset,this.highlightSymbol.yoffset+this._config.labelYoffset)},e.prototype.setTextAnchor=function(e,t){switch(this._config.anchor){case n.MIDDLE:this.textSymbols[e].setOffset(0,t);break;case n.BOTTOM_LEFT:this.textSymbols[e].setOffset(this.getTotalWidth()/2,t+this.getTotalHeight()/2);break;case n.CALLOUT:this.textSymbols[e].setOffset(0,t+this.getTotalHeight()/2+this._config.calloutPixelSize/2)}},e.prototype.initializeHighlightDimensions=function(){var e=r.getLabelSize(this._config.text,this._config.fontFamily,this._config.fontSize,this._config.layerId),t=.5*e.height,i=this._config.calloutWithIdTag?e.height+t:0;this._height=e.height,this._width=e.width+i,this._padding=t,this._config.calloutPixelSize=this._config.calloutPixelSize||Math.floor(this._width/this._calloutSizeWidthFraction)},e.prototype.initializeHighlightGraphic=function(){this.highlightGraphic=new esri.Graphic,this.highlightGraphic.highlightedTextLabel=!0,this.highlightSymbol=new esri.symbol.SimpleMarkerSymbol,this.highlightGraphic.setGeometry(this._config.mapPoint),this.configureHighlightSymbol(this._config.highlightColor,this._config.highlightOutlineSymbol,this._config.fontSize)},e.prototype.initializeHighlighteIdTagGraphic=function(){this._config.calloutWithIdTag&&(this.highlightIdTagGraphic=new esri.Graphic,this.highlightIdTagSymbol=new esri.symbol.SimpleMarkerSymbol,this.highlightIdTagGraphic.setGeometry(this._config.mapPoint),this.configureHighlightIdTagSymbol(this._config.textColor,this._config.fontSize))},e.prototype.configureHighlightSymbol=function(e,t,i){this.setHighlightAnchor(),this.highlightSymbol.setStyle("STYLE_PATH");var n=r.generateSvgHighlightLabelPath(this.getTotalWidth(),this.getTotalHeight(),this._config.cornerRadius,this._config.calloutWithIdTag,this._config.calloutPixelSize);this.highlightSymbol.setPath(n),this.highlightSymbol.setColor(e),this.highlightSymbol.setOutline(t),this.highlightSymbol.setAngle(this._config.angle),this.highlightSymbol.setSize(i),this.highlightGraphic.setSymbol(this.highlightSymbol)},e.prototype.configureHighlightIdTagSymbol=function(e,t){var i=-(this.getTotalWidth()/2-this.getTotalHeight()/2),n=this.getTotalHeight()/2+this._config.calloutPixelSize/2;this.highlightIdTagSymbol.setStyle("STYLE_PATH"),this.highlightIdTagSymbol.setPath(r.generateSvgCirclePath(this.getTotalHeight()*this._tagHeightPercentage/2)),this.highlightIdTagSymbol.setColor(e),this.highlightIdTagSymbol.outline&&this.highlightIdTagSymbol.outline.setColor(e),this.highlightIdTagSymbol.setOffset(i+this._config.labelXoffset,n+this._config.labelYoffset),this.highlightIdTagSymbol.setSize(this.getTotalHeight()*this._tagHeightPercentage),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)},e.prototype.initializeTextGraphicsAndSymbols=function(){if(this._config.text){var e=r.getTextLines(this._config.text);if(e&&e.length&&0!==e.length){var t=e.length,i=new esri.symbol.Font;i.setSize(this._config.fontSize),i.setFamily(this._config.fontFamily);var n=this.getHeight()/t,a=Math.abs(i.size-n),o=this.getHeight()/2/n;this.textGraphics=[],this.textSymbols=[];for(var s=0;e&&e.length>0&&s<e.length;s++){this.textGraphics[s]||(this.textGraphics[s]=new esri.Graphic),this.textSymbols[s]||(this.textSymbols[s]=new esri.symbol.TextSymbol("")),this.textGraphics[s].geometry!==this._config.mapPoint&&this.textGraphics[s].setGeometry(this._config.mapPoint);var l=(o-(s+1))*n+a;if(this.configureTextSymbol(s,e[s],this._config.textColor,i,this._config.angle,l),1===t){this.textSymbols[s].setHorizontalAlignment(esri.symbol.TextSymbol.ALIGN_MIDDLE);var c=this._config.angle*(Math.PI/180);this.textSymbols[s].setOffset(-(n/2/2*Math.sin(c)),-Math.abs(n/2/2*Math.cos(c)));var u={customVerticalAlignment:"middle",numberOfLines:1};this.textGraphics[s].setAttributes(u)}else{this.textSymbols[s].setHorizontalAlignment(esri.symbol.TextSymbol.ALIGN_START),this.textSymbols[s].setVerticalAlignment(esri.symbol.TextSymbol.ALIGN_START);var u={customVerticalAlignment:"middle",numberOfLines:t};this.textGraphics[s].setAttributes(u)}var d=this._config.calloutWithIdTag?this.getTotalHeight()/2:0;this.textSymbols[s].setOffset(this.textSymbols[s].xoffset+this._config.labelXoffset+d,this.textSymbols[s].yoffset+this._config.labelYoffset),this.textGraphics[s].setSymbol(this.textSymbols[s])}if(this._config.calloutWithIdTag){var p=new esri.symbol.Font;p.setSize(this._config.fontSize),p.setSize(Math.floor(1.25*p.size)),p.setFamily(this._config.fontFamily),p.setWeight(esri.symbol.Font.WEIGHT_BOLD);var h=new esri.Graphic;h.setGeometry(this._config.mapPoint),this.textGraphics.push(h);var m=new esri.symbol.TextSymbol(this._config.idTagText);this.textSymbols.push(m),this.configureTextSymbol(t,this._config.idTagText,this._config.highlightColor,p,0,0);var f=-(this.getTotalWidth()/2-this.getTotalHeight()/2),g=-(p.size/3);m.setOffset(m.xoffset+f,m.yoffset+g),h.setSymbol(m)}}}},e.prototype.configureTextSymbol=function(e,t,i,r,n,a){this.textSymbols&&e<this.textSymbols.length&&(this.textSymbols[e].setText(t),this.textSymbols[e].setFont(r),this.textSymbols[e].setColor(i),this.textSymbols[e].setAngle(n),this.setTextAnchor(e,a))},e.prototype._processConfig=function(e){return!!(e&&e.layerId&&e.mapPoint)&&(e.calloutWithIdTag=void 0!=e.calloutWithIdTag&&!!e.calloutWithIdTag,e.idTagText=e.idTagText||"",e.calloutPixelSize=e.calloutPixelSize||0,e.labelXoffset=e.calloutWithIdTag?0:e.labelXoffset||0,e.labelYoffset=e.calloutWithIdTag?0:e.labelYoffset||0,e.layerId=e.layerId,e.mapPoint=e.mapPoint,e.text=e.text||"",e.fontFamily=e.fontFamily||"Arial",e.fontSize=e.fontSize||"12px",e.cornerRadius=void 0==e.cornerRadius?5:e.cornerRadius,e.angle=e.calloutWithIdTag?0:e.angle||0,e.anchor=e.calloutWithIdTag?n.CALLOUT:void 0!=e.anchor?e.anchor:n.MIDDLE,e.textColor=e.textColor&&e.textColor instanceof esri.Color?e.textColor:new esri.Color("white"),e.highlightColor=e.highlightColor&&e.highlightColor instanceof esri.Color?e.highlightColor:new esri.Color("black"),e.highlightOutlineSymbol=e.highlightOutlineSymbol&&e.highlightOutlineSymbol instanceof esri.symbol.SimpleLineSymbol?e.highlightOutlineSymbol:new esri.symbol.SimpleLineSymbol,this._config=e,!0)},e}();t.HighlightedLabelGraphic=a})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/identify/IdentifyProviderBase":function(){define(["require","exports","geocortex/infrastructure/GeometryUtils"],function(e,t,i){"use strict";var r=function(){function e(e,t){this.pixelTolerance=5,this.polygonPixelTolerance=2,this.app=e,this.libraryId=t}return e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e.prototype.applyTolerance=function(e,t){return e&&"point"===e.type?i.createToleranceEnvelope(this.app.map,e,t):e},e}();t.IdentifyProviderBase=r})},"geocortex/infrastructure/identify/GraphicsLayerIdentifyProvider":function(){define(["require","exports","geocortex/infrastructure/identify/IdentifyProviderBase","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/FeatureAttribute","geocortex/essentials/Field","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/GraphicUtils","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/PresentableDelegateFactory","geocortex/infrastructure/GraphicsLayerIds"],function(e,t,i,r,n,a,o,s,l,c,u){"use strict";var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._cancelled=!1,t._searching=!1,t._delayedFscOpen=null,t._numFractionalDigits=null,t._fscCollectionOpen=!1,t}return __extends(t,e),t.prototype.initialize=function(e){var t=this.app.configModel.moduleConfigs.filter(function(e){return"Measurement"===e.moduleName});t&&t[0]&&t[0].configuration?this._numFractionalDigits=t[0].configuration.measurementFractionalDigits:this._numFractionalDigits=null},t.prototype.cancelSearch=function(){this._searching&&(this._cancelled=!0),this._searching=!1},t.prototype.search=function(e,t){var i=this,r=new Promise(function(r,n){if(i._fscCollectionOpen=!1,i._delayedFscOpen=null,t.delayFSCOpen){var a=e.id,o=!1;i._delayedFscOpen=function(){o||(o=!0,i.app.featureSetManager.openCollection(a),i._fscCollectionOpen=!0)}}else i.app.featureSetManager.openCollection(e.id),i._fscCollectionOpen=!0;i._searching=!0,Promise.resolve({featureSetCollection:e,identifyArgs:t,layerInfos:void 0,graphicsLayers:void 0,featureSets:void 0}).then(function(e){return i._getClickableLayers(e)}).then(function(e){return i._processLayerInfos(e)}).then(function(e){return i._performSearch(e)})["catch"](function(e){i.app.trace.warning("Unable to search within clickable layers: "+e.message)})["finally"](function(){i._searching=!1,i._clear(),i._fscCollectionOpen&&(i.app.featureSetManager.tryCloseCollection(e.id),i._fscCollectionOpen=!1),r()})});return r},t.prototype._getClickableLayers=function(e){return this._verifyNotCancelled(),e.layerInfos=this.app.clickableGraphics.getLayerInfos(),this._delayedFscOpen&&e.layerInfos.length>0&&this._delayedFscOpen(),e},t.prototype._processLayerInfos=function(e){var t=this;this._verifyNotCancelled();var i=(e.layerInfos||[]).map(function(e){return t.app.map.getLayer(e.graphicsLayerId)}).filter(function(e){return null!=e&&e instanceof esri.layers.GraphicsLayer&&e.visible&&e.visibleAtMapScale});return e.graphicsLayers=i,e},t.prototype._performSearch=function(e){var t=this,i=function(i,r,n){t._verifyNotCancelled();var a=e.featureSetCollection;return t._searchGraphicsLayer(r,e).then(function(e){return t._addToResultsCollection(e,a)})};return Promise.reduce(e.graphicsLayers,i,null)["return"](e)},t.prototype._searchGraphicsLayer=function(e,t){var i=this,r=e.graphics.slice(0).reverse();return Promise.resolve(r).then(function(e){return i._findIntersectedGraphics(e,t)}).then(function(t){return i._createFeatureSet(t,e)}).then(function(r){return i._processFeatureSet(r,e,t)})},t.prototype._findIntersectedGraphics=function(e,t){var i=this,r=t.identifyArgs;return Promise.filter(e,function(e){return i._intersects(e,r)})},t.prototype._intersects=function(e,t){var i="polygon"===e.geometry.type?t.polygonPixelTolerance:t.pixelTolerance,r=this.applyTolerance(t.geometry,i);return s.geometryIntersectsGraphic(r,e,this.app)["catch"](function(){return!1})},t.prototype._createFeatureSet=function(e,t){if(e&&e.length>0){var i=new esri.tasks.FeatureSet;i.features=e;var n=null;if(t.id!==u.MARKUP_LAYER_ID&&this.app.site&&this.app.site.essentialsMap){var a=this.app.site.essentialsMap.mapServices.filter(function(e){return e.serviceLayer===t});1===a.length&&1===a[0].layers.length&&(n=a[0].layers[0])}var o,s;return n||(o=t.id,s=l.NumberFormat.NUMBER+this._numFractionalDigits),new r.FeatureSet({esriFeatureSet:i,app:this.app,defaultNumberFormat:s,id:o,layer:n})}return null},t.prototype._processFeatureSet=function(e,t,i){if(!e)return null;if(!e.layer){var r=this._getLayerInfoFromContext(t,i),n=r?r.displayName:"",a=this._createAttributes();e.displayName.set(n),e.attributes.set(a),this._addFeatureSetAttributes(a),e.attributes.set(a);for(var o=0;o<e.features.length();o++){var s=e.features.getAt(o);this._processFeature(s,r)}}return e},t.prototype._createAttributes=function(){var e=[];return e.push(new n.FeatureAttribute("","Name","Name",null,(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString)),e},t.prototype._processFeature=function(e,t){if(!e||!t)return e;var i=this._getDisplayNameForGraphic(e.esriFeature.get(),t),r=this._createAttributes();e.labelFormat.set(i),e.descriptionFormat.set(""),e.attributes.set(r);for(var n=0;n<e.attributes.length();n++){var a=e.attributes.getAt(n),o=a.name.get();a.value.get();switch(o){case"Name":a.value.set(i),a.presentableValue.set(i)}}return this._isMeasurement(e.esriFeature.get())?this._populateAttributesForMeasurementMarkup(e):this._populateFeatureAttributes(e,t),e},t.prototype._addFeatureSetAttributes=function(e){var t=new n.FeatureAttribute("","Length","Length",this.getResource("language-common-measurement-results-field-length"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString);e.push(t),t=new n.FeatureAttribute("","Units","Units",this.getResource("language-common-measurement-results-field-units"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString),e.push(t),t=new n.FeatureAttribute("","Area","Area",this.getResource("language-common-measurement-results-field-area"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString),e.push(t),t=new n.FeatureAttribute("","Area Units","Area Units",this.getResource("language-common-measurement-results-field-area-units"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString),e.push(t)},t.prototype._populateFeatureAttributes=function(e,t){var i=e.esriFeature.get().attributes,r="";for(var o in i)if(t&&t.aliases&&t.aliases[o]){var s=new n.FeatureAttribute(e.esriFeature.get().attributes[o],o,t.aliases[o],t.aliases[o],(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString);e.attributes.addItem(s),r=r+t.aliases[o]+": {"+o+"}\n"}else if(!o.startsWith("_")){var s=new n.FeatureAttribute(e.esriFeature.get().attributes[o],o,o,o,(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString);e.attributes.addItem(s),r=r+o+": {"+o+"}\n"}e.descriptionFormat.set(r)},t.prototype._populateAttributesForMeasurementMarkup=function(e){var t=e.attributes.get(),i=e.esriFeature.get().geometry.type;switch(i){case"polyline":e.descriptionFormat.set(this.getResource("language-clickable-graphics-measurement-description-polyline"));var r=new n.FeatureAttribute(e.esriFeature.get().attributes.Length,"Length","Length",this.getResource("language-common-measurement-results-field-length"),(!0),c.PresentableDelegateFactory.valuePresenterDelegate(null,e),a.EssentialsFieldTypes.essentialsFieldTypeString);t.push(r),r=new n.FeatureAttribute(e.esriFeature.get().attributes.Units,"Units","Units",this.getResource("language-common-measurement-results-field-units"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString),t.push(r);break;case"polygon":e.descriptionFormat.set(this.getResource("language-clickable-graphics-measurement-description-polygon"));var r=new n.FeatureAttribute(e.esriFeature.get().attributes.Length,"Length","Length",this.getResource("language-common-measurement-results-field-length"),(!0),c.PresentableDelegateFactory.valuePresenterDelegate(null,e),a.EssentialsFieldTypes.essentialsFieldTypeString);t.push(r),r=new n.FeatureAttribute(e.esriFeature.get().attributes.Units,"Units","Units",this.getResource("language-common-measurement-results-field-units"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString),t.push(r),r=new n.FeatureAttribute(e.esriFeature.get().attributes.Area,"Area","Area",this.getResource("language-common-measurement-results-field-area"),(!0),c.PresentableDelegateFactory.valuePresenterDelegate(null,e),a.EssentialsFieldTypes.essentialsFieldTypeString),t.push(r),r=new n.FeatureAttribute(e.esriFeature.get().attributes["Area Units"],"Area Units","Area Units",this.getResource("language-common-measurement-results-field-area-units"),(!0),null,a.EssentialsFieldTypes.essentialsFieldTypeString),t.push(r)}},t.prototype._addToResultsCollection=function(e,t){e&&t.featureSets.addItem(e)},t.prototype._getLayerInfoFromContext=function(e,t){var i=null;return e&&t&&(i=o.firstOrDefault(t.layerInfos||[],function(t){return t.graphicsLayerId&&t.graphicsLayerId===e.id})),i},t.prototype._getDisplayNameForGraphic=function(e,t){if(!e)return null;var i,r=this.getResource("language-clickable-graphics-label-format");t&&(i=t.displayName),this._isMeasurement(e)&&(i=this.getResource("language-clickable-graphics-label-measurement")),i||(i=this.getResource("language-clickable-graphics-label-default"));var n=e.getLayer(),a=n&&n.graphics?n.graphics.indexOf(e)+1:-1,o=a>0?a.toString():"",s=r.format(i,o);return s},t.prototype._isMeasurement=function(e){var t=e.measurementId;return null!==t&&void 0!==t},t.prototype._clear=function(){this._searching=!1,this._cancelled=!1},t.prototype._verifyNotCancelled=function(){if(this._cancelled)throw new Error("GraphicsLayerIdentifyProvider: Operation cancelled")},t}(i.IdentifyProviderBase);t.GraphicsLayerIdentifyProvider=d})},"geocortex/infrastructure/identify/IdentifiableLayersInMapService":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/identify/IdentifyUtils":function(){define(["require","exports","geocortex/essentials/LayerType","geocortex/infrastructure/FeatureSetCollection","geocortex/essentials/Field","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/GraphicUtils","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/Feature","geocortex/infrastructure/KmlFeature","geocortex/infrastructure/NumberFormat","geocortex/infrastructure/DateFormat"],function(e,t,i,r,n,a,o,s,l,c,u,d){"use strict";function p(e,t,r,n,a,o,s,l){var c=new Array;if(a===!1||e.isVisible())for(var u=e.essentialsMap.site.essentialsMap.calculateScale(),d=0;d<e.layers.length;d++){var p=e.layers[d];if(!l||p.type!==i.LayerType.RASTER_LAYER){var h=p.identifiableAtAllScales||o===!1||p.withinScaleRange(u),m=p.isVisible()&&p.areAllAncestorsVisible(),f=null==s||$.inArray(p.id,s)!==-1;f&&(m||n===!1)&&h&&t(p)&&(null==r||0==r.length||dojo.indexOf(r,p.featureType)>=0)&&c.push(p.id)}}return c}function h(e,t){var i=[];if(e.serviceLayer.layerDefinitions)for(var r=e.serviceLayer.layerDefinitions,n=0;n<r.length;n++)if(r[n])for(var a=0;a<t.length;a++)if(t[a]==n.toString()){i[n]=r[n];break}return i}function m(e,t){for(var i=[],r=0;r<t.length;r++){var n=e.getDynamicLayerInfoById(t[r]);n&&i.push(n)}return i}function f(e,t,p,h){var m="Pixel value";null==t&&(t=new r.FeatureSetCollection);for(var f=new Object,g=0;g<e.length;g++){var y=e[g],b=f[y.layerId];if(null==b){var v=p.findLayerById(y.layerId.toString());if(v&&v.type===i.LayerType.RASTER_LAYER){if(y.feature&&y.feature.attributes&&$.isEmptyObject(y.feature.attributes))return;var S=0,_=0;for(var I in y.feature.attributes)if(y.feature.attributes.hasOwnProperty(I)){_++;var w=y.feature.attributes[I];"NoValue"!==w&&"NoData"!==w||S++}if(S===_)continue}var x=new Object;if(v)for(var L=0;L<v.fields.length;L++){var C=v.fields[L];x[C.alias]=C}if(v&&v.type===i.LayerType.RASTER_LAYER&&v.fields)if(0===v.fields.length){if(y.feature.attributes)for(var I in y.feature.attributes){var w=y.feature.attributes[I];v.fields.push(new n.Field({layer:v,displayName:I,dataType:n.EssentialsFieldTypes.essentialsFieldTypeString,alias:I,hyperlinkLabel:"",name:I,searchable:!0,visible:!0}))}}else for(var M in y.feature.attributes)if(M===m)for(var g=0;g<v.fields.length;g++)if("VALUE"===v.fields[g].name){v.fields[g].name=m;break}var F=null;if(y.displayFieldName){var E=x[y.displayFieldName];E&&E.name&&(F=E.name)}F||(F=v&&v.displayField?v.displayField.name:v&&v.primaryKeyField&&v.primaryKeyField.name?v.primaryKeyField.name:y.displayFieldName);var T=new esri.tasks.FeatureSet({displayFieldName:F,features:[]});y.feature.geometry&&(T.geometryType=y.feature.geometry.type,T.spatialReference=y.feature.geometry.spatialReference),b=new a.FeatureSet({esriFeatureSet:T,layer:v,app:this.app}),v?b.displayName.set(v.displayName):b.displayName.set(y.layerName),f[y.layerId]=b}b.layer&&o.sanitizeAttributeNames(y.feature,b.layer),b.esriFeatureSet.features.push(y.feature);var R={graphic:y.feature,layer:b.layer,resolveLayerFields:!0,allowUnsafeContent:!1};p.drawingBehavior===s.DrawingBehavior.KML_SERVICE&&(R.allowUnsafeContent=h.configuration.allowUnsafeContent),y.feature._graphicsLayer&&(R.featureLayer=y.feature._graphicsLayer);var k;p.drawingBehavior===s.DrawingBehavior.KML_SERVICE?(k=new c.KmlFeature(R),k.defaultNumberFormat=p.defaultNumberFormat?p.defaultNumberFormat:u.NumberFormat.DEFAULT,k.defaultDateFormat=p.defaultDateFormat?p.defaultDateFormat:d.DateFormat.DEFAULT):k=new l.Feature(R),b.features.addItem(k)}for(var G in f)if(f.hasOwnProperty(G)){var b=f[G];t.featureSets.addItem(b),b.resolveDataLinks(function(e){h.event("FeatureChangedEvent").publish(e)})}return t}t.getIdentifyLayerIds=p,t.getLayerDefinitions=h,t.getDynamicLayerInfos=m,t.appendToFeatureSetCollection=f})},"geocortex/infrastructure/identify/LayerDescriptor":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/identify/MapIdentifyTask":function(){define(["require","exports","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/identify/IdentifyUtils","geocortex/infrastructure/TaskUtils","geocortex/essentials/LayerType","geocortex/essentials/MapServiceConstants"],function(e,t,i,r,n,a,o,s){"use strict";var l=function(){function e(e,t){this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1,this._isCancelled=!1,this.app=null,this.map=null,this.tag=null,this.extent=null,this.width=null,this.height=null,this.topMostLayerOnly=!1,this.returnGeometry=!1,this.visibleLayersOnly=!0,this.visibleMapServicesOnly=!0,this.layersInVisibleScaleRangeOnly=!0,this.pixelTolerance=5,this.polygonPixelTolerance=2,this.allServicesInError=!1,this.mapServicesAndLayersToIdentify=null,this.restrictRasterIdentifyToPoint=!0,this.delayedFSCOpen=null,this.layerRestriction=null,this.app=t||null,this.map=e}return e.prototype._checkAndReturnLayerRestriction=function(){var e=this.layerRestriction;return e||(e=function(e){return e.identifiable&&e.supportsIdentify}),e},e.prototype.execute=function(e,t,n,a,o){var s=this,l=this._checkAndReturnLayerRestriction();if(this.app&&e&&"polygon"==e.type&&i.isSelfIntersectingPolygon(e)&&!o){var c=function(e){s.execute(e,t,n,a,!0)},u=function(e){s.app.trace.warning("An error occurred while attempting to simplify the identify geometry. Make sure that your proxy is configured correctly."),a(s,e,null)};return void r.simplifyPolygon(e,c,u,this.app)}this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1,this.allServicesInError=!1;var d=new esri.tasks.IdentifyParameters;d.tolerance=this.pixelTolerance,d.returnGeometry=this.returnGeometry,this.topMostLayerOnly?d.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_TOP:d.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_ALL,d.width=this.width||this.map.width,d.height=this.height||this.map.height,d.mapExtent=this.extent||this.map.extent,d.geometry=e,this.app.map.timeExtent&&(this.app.map.timeExtent.startTime||this.app.map.timeExtent.endTime)&&(d.timeExtent=new esri.TimeExtent(this.app.map.timeExtent.startTime,this.app.map.timeExtent.endTime));for(var p=0;p<this.app.site.essentialsMap.mapServices.length;p++){var h=this.app.site.essentialsMap.mapServices[p];if(!(h.serviceLayer&&h.serviceLayer instanceof esri.layers.StreamLayer))if(h.serviceLayer&&h.serviceLayer instanceof esri.layers.FeatureLayer)this._handleFeatureLayer(e,h,h.serviceLayer,d,l,t,n,a);else if(h.serviceLayer instanceof esri.layers.KMLLayer)for(var m=h.serviceLayer.getLayers(),f=0;f<m.length;f++)m[f]instanceof esri.layers.FeatureLayer&&this._handleFeatureLayer(e,h,m[f],d,l,t,n,a);else h.serviceLayer instanceof esri.layers.WMSLayer||h.serviceLayer instanceof esri.layers.WFSLayer?this._handleWMSLayer(h,d,l,t,n,a):h.serviceLayer instanceof esri.layers.ArcGISImageServiceLayer||this._handleLayer(h,d,l,t,n,a)}this._taskExecutionComplete=!0,this._conditionallyInvokeCompleteCallback(this,n)},e.prototype._handleWMSLayer=function(e,t,i,r,n,a){for(var o=this._getLayersToIdentifyForMapService(e,null,i,!0),s=o.length>0,l=0,c=o;l<c.length;l++){var u=c[l],d=e.findLayerById(u.toString());if(!d.supportsQuery){s=!1;break}}s?this._handleLayer(e,t,i,r,n,a):this._handleLayerLegacy(e,t,i,r,n,a)},e.prototype._handleLayerLegacy=function(e,t,i,r,o,s){var l=this,c=(e.serviceUrl,dojo.clone(t));c.layerIds=n.getIdentifyLayerIds(e,i,["Polygon"],this.visibleLayersOnly,this.visibleMapServicesOnly),c.tolerance=this.polygonPixelTolerance;var u=dojo.clone(t);u.layerIds=n.getIdentifyLayerIds(e,i,["None","Point","Multipoint","Line"],this.visibleLayersOnly,this.visibleMapServicesOnly);var d=[c,u];this.delayedFSCOpen&&(c.layerIds.length>0||u.layerIds.length>0)&&this.delayedFSCOpen();for(var p=[],h=0;h<d.length;h++){var m=d[h];if(m.layerIds.length>0){this._identifyTaskExecutedCount++;var f=m.layerIds.map(function(e){return e.toString()});m.layerDefinitions=n.getLayerDefinitions(e,f),m.dynamicLayerInfos=n.getDynamicLayerInfos(e,f),m.spatialReference=this.app.map.extent.spatialReference;var g=a.getIdentifyTask(e);
p.push(g.execute(m).then(function(t){l._isCancelled||r(l,t,e)}))}}Promise.all(p).then(function(){l._identifyTaskCompletedCount++,l._conditionallyInvokeCompleteCallback(l,o)})["catch"](function(t){l._isCancelled||(l._identifyTaskCompletedCount++,l._identifyTaskErrorCount++,s(l,t,e))})},e.prototype._handleLayer=function(e,t,i,s,l,c){var u=this,d=this._getLayersToIdentifyForMapService(e,null,i,!0);this._identifyTaskExecutedCount++,this.delayedFSCOpen&&this.delayedFSCOpen();for(var p,h,m,f=[],g=[],y=Promise.defer(),b=d.map(function(e){return e.toString()}),v=n.getLayerDefinitions(e,b),S=function(t,i,r){if(!u._isCancelled){var n=u._queryResultToIdentifyResults(t,i,r,t.displayFieldName);s(u,n,e)}},_=function(i){return p=e.findLayerById(i.toString()),h=a.getQueryTask(p),m=new esri.tasks.Query,p.supportsQuery?(m.outFields=["*"],m.outSpatialReference=I.app.map.spatialReference,m.returnGeometry=t.returnGeometry,m.where=v[i],I.app.map.timeExtent&&(I.app.map.timeExtent.startTime||I.app.map.timeExtent.endTime)&&(m.timeExtent=new esri.TimeExtent(I.app.map.timeExtent.startTime,I.app.map.timeExtent.endTime)),void("Polygon"===p.featureType?(m.geometry=r.createToleranceEnvelope(I.map,t.geometry,I.polygonPixelTolerance),g.push(h.execute(m).then(function(e){return y.promise.then(function(){return S(e,i,p.name)})}))):(m.geometry=r.createToleranceEnvelope(I.map,t.geometry,I.pixelTolerance),f.push(h.execute(m).then(function(e){return S(e,i,p.name)}))))):"continue"},I=this,w=0,x=d;w<x.length;w++){var L=x[w];_(L)}var C="point"===t.geometry.type||!this.restrictRasterIdentifyToPoint;if(C){var M=dojo.clone(t);if(M.layerIds=this._getLayersToIdentifyForMapService(e,null,i,!1),M.layerIds=M.layerIds.filter(function(t){return e.findLayerById(t.toString()).type===o.LayerType.RASTER_LAYER}),M.layerIds.length>0){M.spatialReference=this.app.map.extent.spatialReference;var F=a.getIdentifyTask(e);f.push(F.execute(M).then(function(t){u._isCancelled||(u._assignSpatialReferences(t),s(u,t,e))}))}}Promise.all(f).then(function(){return y.resolve(),Promise.all(g).then(function(){u._identifyTaskCompletedCount++,u._conditionallyInvokeCompleteCallback(u,l)})})["catch"](function(t){u._isCancelled||(u._identifyTaskCompletedCount++,u._identifyTaskErrorCount++,c(u,t,e))})},e.prototype._assignSpatialReferences=function(e){for(var t=0;t<e.length;++t){var i=e[t];i.feature.geometry&&(i.feature.geometry.spatialReference=this.app.map.extent.spatialReference)}},e.prototype._getLayersToIdentifyForMapService=function(e,t,i,r){if(!this.mapServicesAndLayersToIdentify)return n.getIdentifyLayerIds(e,i,t,this.visibleLayersOnly,this.visibleMapServicesOnly,this.layersInVisibleScaleRangeOnly,null,r);for(var a=0;a<this.mapServicesAndLayersToIdentify.length;a++)if(this.mapServicesAndLayersToIdentify[a].mapServiceId===e.id)return n.getIdentifyLayerIds(e,i,t,this.visibleLayersOnly,this.visibleMapServicesOnly,this.layersInVisibleScaleRangeOnly,this.mapServicesAndLayersToIdentify[a].layerIds,r)},e.prototype._handleFeatureLayer=function(e,t,i,n,o,l,c,u){var d=this;if(n.layerIds=this._getLayersToIdentifyForMapService(t,null,o,!1),n.layerIds.length>0||t.drawingBehavior==s.DrawingBehavior.KML_SERVICE){this.delayedFSCOpen&&this.delayedFSCOpen();var p=new esri.tasks.Query;p.geometry=e,"point"===e.type?t.heatMap&&t.heatMap.enabled?p.geometry=r.createToleranceEnvelope(this.map,e,t.heatMap.intensity):p.geometry=r.createToleranceEnvelope(this.map,e,this.pixelTolerance):t.drawingBehavior===s.DrawingBehavior.KML_SERVICE&&(p.geometry=e.getExtent()),p.outFields=["*"],p.outSpatialReference=this.app.map.spatialReference,p.returnGeometry=!0,this.app.map.timeExtent&&(this.app.map.timeExtent.startTime||this.app.map.timeExtent.endTime)&&(p.timeExtent=new esri.TimeExtent(this.app.map.timeExtent.startTime,this.app.map.timeExtent.endTime)),this._identifyTaskExecutedCount++;var h=function(e,t){var r;if(t.essentialsMap&&t.essentialsMap.getMap&&e.isVisibleAtScale(t.essentialsMap.getMap().getScale()))r=e.queryFeatures(p);else{var n=a.getQueryTask(e,t);r=n.execute(p)}var o=d;r.then(dojo.hitch(t,function(e){if(!o._isCancelled){var t=this,r=o._queryResultToIdentifyResults(e,i.layerId,i.name,i.displayField);r.forEach(function(e){e.feature._graphicsLayer=i}),o._identifyTaskCompletedCount++,l(o,r,t),o._conditionallyInvokeCompleteCallback(o,c)}}),dojo.hitch(t,function(e){if(!o._isCancelled){var t=this;o._identifyTaskCompletedCount++,o._identifyTaskErrorCount++,u(o,e,t),o._conditionallyInvokeCompleteCallback(o,c)}}))};if(i.updating)var m=dojo.connect(i,"onUpdateEnd",function(){h(i,t),dojo.disconnect(m)});else h(i,t)}},e.prototype._queryResultToIdentifyResults=function(e,t,i,r){var n=[];if(e&&e.features&&e.features.length>0)for(var a=0;a<e.features.length;a++)n.push({feature:e.features[a],displayFieldName:r,layerId:t,layerName:i});return n},e.prototype._conditionallyInvokeCompleteCallback=function(e,t){e._taskExecutionComplete&&e._identifyTaskExecutedCount==e._identifyTaskCompletedCount&&(e.allServicesInError=e._identifyTaskExecutedCount==e._identifyTaskErrorCount,t(e))},e.prototype.cancel=function(){this._isCancelled=!0},e}();t.MapIdentifyTask=l})},"geocortex/infrastructure/identify/MapIdentifyTaskIdentifyProvider":function(){define(["require","exports","geocortex/infrastructure/identify/IdentifyProviderBase","geocortex/infrastructure/identify/MapIdentifyTask","geocortex/infrastructure/identify/IdentifyUtils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._identifyTask=null,t.defaultPixelTolerance=5,t.defaultPolygonPixelTolerance=2,t._pixelTolerance=null,t._polygonPixelTolerance=null,t._topMostLayerOnly=null,t._returnGeometry=null,t._visibleLayersOnly=null,t._layersInVisibleScaleRangeOnly=null,t}return __extends(t,e),t.prototype.initialize=function(e){null!=e.pixelTolerance&&(this._pixelTolerance=e.pixelTolerance),null!=e.polygonPixelTolerance&&(this._polygonPixelTolerance=e.polygonPixelTolerance),null!=e.visibleLayersOnly&&(this._visibleLayersOnly=!!e.visibleLayersOnly),null!=e.layersInVisibleScaleRangeOnly&&(this._layersInVisibleScaleRangeOnly=!!e.layersInVisibleScaleRangeOnly),null!=e.topMostLayerOnly&&(this._topMostLayerOnly=!!e.topMostLayerOnly),null!=e.returnGeometry&&(this._returnGeometry=!!e.returnGeometry)},t.prototype.search=function(e,t){var i=this,n=new Promise(function(n,a){var o=null;if(t.delayFSCOpen){var s=e.id,l=!1;o=function(){l||(l=!0,i.app.featureSetManager.openCollection(s))}}else i.app.featureSetManager.openCollection(e.id);i._identifyTask=new r.MapIdentifyTask(i.app.map,i.app),i._identifyTask.tag=e,i._identifyTask.pixelTolerance=null!=i._pixelTolerance?i._pixelTolerance:t.pixelTolerance,i._identifyTask.polygonPixelTolerance=null!=i._polygonPixelTolerance?i._polygonPixelTolerance:t.polygonPixelTolerance,i._identifyTask.topMostLayerOnly=null!=i._topMostLayerOnly?i._topMostLayerOnly:!!t.topMostLayerOnly,i._identifyTask.returnGeometry=null!=i._returnGeometry?i._returnGeometry:!!t.returnGeometry,i._identifyTask.layersInVisibleScaleRangeOnly=null!=i._layersInVisibleScaleRangeOnly?i._layersInVisibleScaleRangeOnly:!!t.layersInVisibleScaleRangeOnly,i._identifyTask.restrictRasterIdentifyToPoint=!!t.restrictRasterIdentifyToPoint,t.identifiableLayerInfo&&(i._identifyTask.mapServicesAndLayersToIdentify=t.identifiableLayerInfo),isNaN(i._identifyTask.pixelTolerance)&&(i._identifyTask.pixelTolerance=i.defaultPixelTolerance),isNaN(i._identifyTask.polygonPixelTolerance)&&(i._identifyTask.polygonPixelTolerance=i.defaultPolygonPixelTolerance),t.extent&&(i._identifyTask.extent=t.extent),t.width&&(i._identifyTask.width=t.width),t.height&&(i._identifyTask.height=t.height),null!==t.visibleLayersOnly&&(i._identifyTask.visibleLayersOnly=t.visibleLayersOnly),null!==t.visibleMapServicesOnly&&(i._identifyTask.visibleMapServicesOnly=t.visibleMapServicesOnly),t.layerRestriction&&(i._identifyTask.layerRestriction=t.layerRestriction),o&&(i._identifyTask.delayedFSCOpen=o),i._identifyTask.execute(t.geometry,function(e,t,r){i.identifyTaskProgress(e,t,r)},function(e){i.identifyTaskComplete(e),n()},function(e,t,r){i.identifyTaskError(e,t,r)})});return n},t.prototype.identifyTaskProgress=function(e,t,i){var r=e.tag;n.appendToFeatureSetCollection(t,r,i,this.app)},t.prototype.identifyTaskComplete=function(e){var t=e.tag;this.app.featureSetManager.tryCloseCollection(t.id)},t.prototype.identifyTaskError=function(e,t,i){var r=e.tag;this.app.featureSetManager.tryCloseCollection(r.id);var n=this.getResource("language-identify-error-message",null).format(t.message,t.details);this.app.command("Alert").execute(n),i&&this.app.trace.error("Error performing identify operation on service {0}. Message: {1}. Error details: {2}.".format(i.serviceLayer.url,t.message,t.details))},t.prototype.cancelSearch=function(){this._identifyTask&&this._identifyTask.cancel()},t}(i.IdentifyProviderBase);t.MapIdentifyTaskIdentifyProvider=a})},"geocortex/infrastructure/identify/RasterIdentifyTask":function(){define(["require","exports","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r,n){"use strict";var a=function(){function e(e,t){this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1,this._isCancelled=!1,this._featureLayers={},this.app=null,this.map=null,this.tag=null,this.delayedFSCOpen=null,this.mapServicesAndLayersToIdentify=null,this.app=t||null,this.map=e}return e.prototype.getFeatureLayer=function(e){return e?this._featureLayers[e.id]:null},e.prototype.execute=function(e,t,n,a,o){var s=this,l=this.app.site.essentialsMap.mapServices.filter(function(e){if(e.mapServiceType===i.MapServiceType.IMAGE&&e.isVisible()){var t=e.identifiable;if(s.mapServicesAndLayersToIdentify)for(var r in s.mapServicesAndLayersToIdentify)s.mapServicesAndLayersToIdentify.hasOwnProperty(r)&&s.mapServicesAndLayersToIdentify[r].mapServiceId===e.id&&(t=s.mapServicesAndLayersToIdentify[r].mapServiceIdentifiable);return t}return!1});this.delayedFSCOpen&&l&&l.length>0&&this.delayedFSCOpen(),this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1;var c=new esri.tasks.ImageServiceIdentifyParameters,u=this._getIdentifyGeometry(e);c.geometry=u,c.returnGeometry=!0;for(var d=0;d<l.length;d++){var p=l[d],h=p.serviceLayer;c.returnCatalogItems=p.includeCatalogItems||p.includeMosaicDatasetValues,h.mosaicRule&&(c.mosaicRule=h.mosaicRule),h.renderingRule&&(c.renderingRule=h.renderingRule),this._identifyTaskExecutedCount++;var m=this,f=new esri.tasks.ImageServiceIdentifyTask(r.getTokenizedUrl(p.serviceUrl,p));this._fetchFieldMetadata(p)["catch"](function(e){}).then(function(){f.execute(c,dojo.hitch(p,function(e){if(!m._isCancelled){e.location=u;var i=this;m._identifyTaskCompletedCount++,t(m,e,i),m._conditionallyInvokeCompleteCallback(m,n)}}),dojo.hitch(p,function(e){if(!m._isCancelled){var t=this;m._identifyTaskCompletedCount++,m._identifyTaskErrorCount++,a(m,e,t),m._conditionallyInvokeCompleteCallback(m,n)}}))})}this._taskExecutionComplete=!0,this._conditionallyInvokeCompleteCallback(this,n)},e.prototype._getIdentifyGeometry=function(e){return e instanceof esri.geometry.Point?e:e instanceof esri.geometry.Polygon?e.getCentroid():e instanceof esri.geometry.Polyline?n.getMiddle(e):void 0},e.prototype._conditionallyInvokeCompleteCallback=function(e,t){e._taskExecutionComplete&&e._identifyTaskExecutedCount==e._identifyTaskCompletedCount&&t(e)},e.prototype.cancel=function(){this._isCancelled=!0},e.prototype._fetchFieldMetadata=function(e){var t=this;return this._featureLayers[e.id]?Promise.resolve():e.getFeatureLayer().then(function(i){t._featureLayers[e.id]=i})},e}();t.RasterIdentifyTask=a})},"geocortex/infrastructure/identify/RasterIdentifyUtils":function(){define(["require","exports","geocortex/infrastructure/FeatureSetCollection","geocortex/essentials/Field","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/Feature","geocortex/infrastructure/TimeZoneUtils","geocortex/infrastructure/GeometryUtils"],function(e,t,i,r,n,a,o,s){"use strict";var l=function(){function e(e,t,i){this.includeCatalogItems=!1,this.includeMosaicDatasetValues=!1,this._libraryId=i,this._mapService=e,this._app=t}return e.prototype.appendToFeatureSetCollection=function(e,t){if(e){if(null==t&&(t=new i.FeatureSetCollection),"NoData"!==e.value){var n=this._mapService.serviceLayer.fields;if(e.location){var a=[],o={geometryType:"esriGeometryPoint",fields:[]},s=this._mapService.serviceLayer.bandCount;if((s&&s>0||!s)&&e.value){var l=[e.value];if(this.includeMosaicDatasetValues&&e.properties&&e.properties.Values.length>0&&(l=l.concat(e.properties.Values)),l&&l.length>0)for(var c=0;c<l.length;c++){var u=new esri.Graphic(e.location);u.attributes=[];var d;d=l[c].indexOf(",")!==-1?l[c].replace(/ /g,""):l[c].replace(/ /g,",");var p={};if(!s||s>1){var h="value";p[h]=d,0===c&&o.fields.push({name:h,alias:h,type:r.EsriFieldTypes.esriFieldTypeString})}for(var m=function(){var e=d.indexOf(",");e=e!==-1?e:0;var t=0!=e?d.substring(0,e):d,i=s>1?"value"+(g+1).toString():"value";d=d.substring(0!==e?e+1:e,d.length);var r=null;0===c?(r=f._getFieldTypeInformation(t),o.fields.push({name:i,alias:i,type:r})):r=o.fields.filter(function(e){return e.name===i})[0].type,p[i]=f._parseAttributeValue(t,r)},f=this,g=0;g<s;g++)m();u.setAttributes(p),a.push(u)}}this._createAndAddGcxFeatureSet("value",t,a,e.location.type,e.location.spatialReference,this._mapService.displayName+", {value}",o.fields)}if(this.includeCatalogItems&&e.catalogItems&&e.catalogItems.features){var y=e.catalogItems;y.displayFieldName=y.displayFieldName?n.length>0?n[0].name:y.displayFieldName:y.objectIdFieldName,y.features=y.features.filter(function(t,i){return!(!e.catalogItems||1!==e.catalogItemVisibilities[i])});var b=this._app.getResource(this._libraryId,"language-rasterIdentify-catalogItem-labelFormat").format(this._mapService.displayName,"{"+y.displayFieldName+"}");this._createAndAddGcxFeatureSetFromEsriFeatureSet(y,b,t,null)}}return t}},e.prototype._parseAttributeValue=function(e,t){switch(t){case r.EsriFieldTypes.esriFieldTypeSingle:case r.EsriFieldTypes.esriFieldTypeDouble:return parseFloat(e);case r.EsriFieldTypes.esriFieldTypeSmallInteger:case r.EsriFieldTypes.esriFieldTypeInteger:return parseInt(e);default:return null}},e.prototype._getFieldTypeInformation=function(e){if($.isNumeric(e)){var t=-32768,i=32767,n=-2147483648,a=2147483647,o=-3.4e38,s=1.2e38,l=-Infinity,c=Infinity,u=Number(e);if(0!==Math.abs(u%1)){if(u>=o&&u<=s)return r.EsriFieldTypes.esriFieldTypeSingle;if(u>=l&&u<=c)return r.EsriFieldTypes.esriFieldTypeDouble}else{if(u>=t&&u<=i)return r.EsriFieldTypes.esriFieldTypeSmallInteger;if(u>=n&&u<=a)return r.EsriFieldTypes.esriFieldTypeInteger}}return r.EsriFieldTypes.esriFieldTypeString},e.prototype._createAndAddGcxFeatureSet=function(e,t,i,r,n,a,o){var s=new esri.tasks.FeatureSet({displayFieldName:e});s.geometryType=r,s.spatialReference=n,s.features=i,this._createAndAddGcxFeatureSetFromEsriFeatureSet(s,a,t,o)},e.prototype._createAndAddGcxFeatureSetFromEsriFeatureSet=function(e,t,i,r){var a,l=this,c=this.featureLayer.fields;try{r&&(this.featureLayer.fields=r);var a=new n.FeatureSet({esriFeatureSet:e,featureLayer:this.featureLayer,defaultDateFormat:this._mapService.defaultDateFormat,defaultNumberFormat:this._mapService.defaultNumberFormat})}finally{r&&(this.featureLayer.fields=c)}a.displayName.set(this._mapService.displayName),a.iconUri.set(this._mapService.iconUri),a.features.get().forEach(function(e){e.labelFormat.set(t),e.timeZoneId=o.getTimeZoneFromMapService(l._mapService),e.displayTimeZoneId=o.getDisplayTimeZoneFromMapService(l._mapService)});var u=a.features.get().filter(function(e){return s.needsProjection(e.esriFeature.get().geometry,l._app)}).length>0;if(u&&i){var d=a.features.get().map(function(e){return e.esriFeature.get().geometry}),p=new esri.tasks.ProjectParameters;p.geometries=d,p.outSR=this._app.map.extent.spatialReference,s.project(p,function(e){a.features.get().forEach(function(t,i){t.esriFeature.get().setGeometry(e[i])}),i.featureSets.addItem(a)},function(e){i.featureSets.addItem(a)},this._app)}else i.featureSets.addItem(a)},e.prototype._convertEsriFeatureToGcxFeature=function(e,t,i,r,n){var o={graphic:t,layer:i,resolveLayerFields:!!r,allowUnsafeContent:!!n},s=new a.Feature(o);return s.labelFormat.set(e),s},e}();t.RasterIdentifyUtils=l})},"geocortex/infrastructure/identify/RasterIdentifyTaskIdentifyProvider":function(){define(["require","exports","geocortex/infrastructure/identify/IdentifyProviderBase","geocortex/infrastructure/identify/RasterIdentifyTask","geocortex/infrastructure/identify/RasterIdentifyUtils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._identifyTask=null,t}return __extends(t,e),t.prototype.initialize=function(e){},t.prototype.search=function(e,t){var i=this,n=new Promise(function(n,a){var o=null;if(t.restrictRasterIdentifyToPoint&&"point"!==t.geometry.type)return n();if(t.delayFSCOpen){var s=e.id,l=!1;o=function(){l||(l=!0,i.app.featureSetManager.openCollection(s))}}else i.app.featureSetManager.openCollection(e.id);i._identifyTask=new r.RasterIdentifyTask(i.app.map,i.app),i._identifyTask.tag=e,t.identifiableLayerInfo&&(i._identifyTask.mapServicesAndLayersToIdentify=t.identifiableLayerInfo),o&&(i._identifyTask.delayedFSCOpen=o),i._identifyTask.execute(t.geometry,function(e,t,r){i.identifyTaskProgress(e,t,r)},function(e){i.identifyTaskComplete(e),n()},function(e,t,r){i.identifyTaskError(e,t,r)})});return n},t.prototype.identifyTaskProgress=function(e,t,i){var r=e.tag,a=new n.RasterIdentifyUtils(i,this.app,this.libraryId);a.featureLayer=this._identifyTask.getFeatureLayer(i),a.includeCatalogItems=i.includeCatalogItems,a.includeMosaicDatasetValues=i.includeMosaicDatasetValues,a.appendToFeatureSetCollection(t,r)},t.prototype.identifyTaskComplete=function(e){var t=e.tag;this.app.featureSetManager.tryCloseCollection(t.id)},t.prototype.identifyTaskError=function(e,t,i){var r=e.tag;this.app.featureSetManager.tryCloseCollection(r.id);var n=this.getResource("language-identify-error-message",null).format(t.message,t.details);this.app.command("Alert").execute(n),i&&this.app.trace.error("Error performing identify operation on service {0}. Message: {1}. Error details: {2}.".format(i.serviceLayer.url,t.message,t.details))},t.prototype.cancelSearch=function(){this._identifyTask&&this._identifyTask.cancel()},t}(i.IdentifyProviderBase);t.RasterIdentifyTaskIdentifyProvider=a})},"geocortex/infrastructure/integration/ComponentFrameInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/integration/MapPosition":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/integration/MapViewpointMessage":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/integration/ComponentInitializationMessage":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/integration/ComponentViewpointMessage":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/integration/ComponentStateMessage":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerCatalog/LayerCatalogFilterProviderBase":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){},e.prototype.filter=function(e,t){return Promise.resolve()},e}();t.LayerCatalogFilterProviderBase=i})},"geocortex/infrastructure/legend/LegendItem":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r=function(){function e(e,t){var r=this;this.esriLayer=e,this.templateType="single-item",this.swatchElement=null,this.label=new i.Observable(""),this.description=new i.Observable(""),this.isVisible=new i.Observable((!0)),this.isVisibleInLayerListLegend=new i.Observable((!0)),this.isCluster=!1,this.expanded=new i.Observable((!0)),this.expanderClass=new i.Observable,this.children=new i.ObservableCollection,this.children.useThrottling=!!t,this.expanderClass.syncTransform(this.expanded,function(e){return e?"tree-expander expanded":"tree-expander collapsed"}),this.expanded.pulse(),this.isVisibleInLayerListLegend.syncTransform(this.isVisible,function(e){return!r.isCluster||e})}return e}();t.LegendItem=r})},"geocortex/infrastructure/layerList/LayerListFolderItem":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListItem","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(t,r,n){var a=e.call(this,t,i.LayerListItemType.FOLDER,n)||this;return a.layerThemeSettings=[],a.containedMapServices=[],a.configuredVisible=!1,a.isUserCreated=!1,a._layerVisibilityHandle=null,a._themeChangingHandle=null,a._themeChangedHandle=null,a.name.set(r||a.layerList.appInfo.gcxApp.getResource(a.layerList._libraryId,"language-layerlist-default-folder-title")),a._setTooltips(),a.layerList&&a.layerList.mapInfo&&a.layerList.mapInfo.gcxMap&&a.layerList.mapInfo.gcxMap.layerThemesInfo&&(a._themeChangingHandle=dojo.connect(a.layerList.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangingEvent",dojo.hitch(a,a._handleLayerThemeChangingEvent)),a._themeChangedHandle=dojo.connect(a.layerList.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangedEvent",dojo.hitch(a,a._handleLayerThemeChangedEvent))),n._addedFolderReferences.push(a),a}return __extends(t,e),t.prototype.setVisibility=function(t){e.prototype.setVisibility.call(this,t),void 0==this._deferredVisibilitySetting&&(this.currentUserClickOriginator=!1,this.mapService&&this.mapService.setVisibility(t&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.mapService.isUserCreated)))},t.prototype.refreshOnDemandItemCollection=function(t){e.prototype.refreshOnDemandItemCollection.call(this,t),this.displayItem.set(this.displayInLayerList()&&this.layerList.filterControlComponent.queryMatched(this))},t.prototype.linkWithMapService=function(e){var t=this;e&&(this.mapService=e,this.layerList._handledMapServiceReferences.push(this.mapService),this.layerList._allMapServiceReferences.indexOf(this.mapService)===-1&&this.layerList._allMapServiceReferences.push(this.mapService),this._setupOpacityBindings(),this._layerVisibilityHandle=this.mapService.serviceLayer.on("visibility-change",function(e){if(void 0!=t._deferredVisibilitySetting||t.isEffectivelyVisible.get()!==e.visible||t.isEffectivelyVisible.get()&&!t.inActiveTheme.get()&&!t.mapService.isUserCreated){var i=e.visible&&(t.inActiveTheme.get()||t.mapService.isUserCreated);t.isVisible.set(i)}}))},t.prototype._setupOpacityBindings=function(){var t=this;1===this.containedMapServices.length?e.prototype._setupOpacityBindings.call(this):this.containedMapServices.length>1&&(this.canAdjustOpacity.set(!0),this.opacity=new r.Observable(1),this.opacity.bind(this,function(e){for(var i=0;i<t.containedMapServices.length;i++)if(t.containedMapServices[i].gcxMapService){var r=t.containedMapServices[i].gcxMapService;r.setOpacityFilter(e)}}))},t.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(this._layerVisibilityHandle.remove(),this._layerVisibilityHandle=null),this._themeChangingHandle&&(dojo.unsubscribe(this._themeChangingHandle),this._themeChangingHandle=null),this._themeChangedHandle&&(dojo.unsubscribe(this._themeChangedHandle),this._themeChangedHandle=null)},t.prototype._handleLayerThemeChangingEvent=function(e){e.currTheme&&(this.isUserCreated||this.isVisible.get()||this.isVisible.set(!0))},t.prototype._handleLayerThemeChangedEvent=function(e){var t=this;if(e.currTheme){var i=e.currTheme,r=function(){t._refreshMutuallyExclusiveItemVisibilities(),t.refreshOnDemandItemCollection(),t._updateDisplayItem()};if(this.isUserCreated)return this._setInActiveThemeIfChildrenPresent(),void r();if(i.isDefaultTheme)return this.isVisible.get()!==this.configuredVisible&&this.isVisible.set(this.configuredVisible),this._setInActiveThemeIfChildrenPresent(),void r();if(this.layerThemeSettings.length)for(var n=0;n<this.layerThemeSettings.length;n++){var a=this.layerThemeSettings[n];if(i.id===a.theme.id){var o=void 0==a.visible?this.configuredVisible:a.visible;return this.isVisible.get()!==o&&this.isVisible.set(o),this._setInActiveThemeIfChildrenPresent(),void r()}}this.isVisible.set(!1),this.inActiveTheme.set(!1),r()}},t.prototype._refreshMutuallyExclusiveItemVisibilities=function(){this.children.get().forEach(function(e){e.isMutuallyExclusive.get()&&e.isVisible.get()&&e.isVisible.pulse()})},t.prototype._setInActiveThemeIfChildrenPresent=function(){var e=this._recursivelyConfirmChildrenInActiveTheme(this.children.get());!e&&this.inActiveTheme.get()&&this.inActiveTheme.set(!1),e&&!this.inActiveTheme.get()&&this.inActiveTheme.set(!0)},t.prototype._recursivelyConfirmChildrenInActiveTheme=function(e){for(var t=this,r=function(e){return e.type===i.LayerListItemType.FOLDER?!(!e.children||!e.children.length())&&t._recursivelyConfirmChildrenInActiveTheme(e.children.get()):e.inActiveTheme.get()},n=0;n<e.length;n++)if(r(e[n]))return!0;return!1},t}(i.LayerListItem);t.LayerListFolderItem=n})},"geocortex/infrastructure/layerList/LayerListItem":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListNode","geocortex/framework/observables","geocortex/infrastructure/layerList/LayerListItemCollection","geocortex/essentials/MapServiceConstants"],function(e,t,i,r,n,a){"use strict";var o;!function(e){e[e.FOLDER=0]="FOLDER",e[e.MAPSERVICE=1]="MAPSERVICE",e[e.LAYER=2]="LAYER",e[e.GRAPHICSLAYER=3]="GRAPHICSLAYER",e[e.KMLFOLDER=4]="KMLFOLDER"}(o=t.LayerListItemType||(t.LayerListItemType={}));var s=function(e){function t(t,i,a){var o=e.call(this,t)||this;if(o.mapService=null,o.opacity=null,o._opacityChangeHandle=null,o._parentExpandedStateBeforeFilter=null,!t)throw new Error("LayerListItem: Initialization failed. Layer list item id cannot be null");if(!a)throw new Error("LayerListItem: Initialization failed. LayerList cannot be null");return o.type=i,o.layerList=a,o.allAncestorsVisible=!0,o.isVisible=new r.Observable((!1)),o.isEffectivelyVisible=new r.Observable((!1)),o.parentEffectivelyVisible=new r.Observable((!0)),o.inVisibleScaleRange=new r.Observable((!0)),o.isEffectivelyVisible.syncTransform(o.isVisible,function(e){return e&&!!o.allAncestorsVisible}),o.name=new r.Observable(""),o.isExpanded=new r.Observable((!1)),o.expandLegend=new r.Observable((!1)),o.canNotAssignVisibility=new r.Observable((!1)),o.canAdjustOpacity=new r.Observable((!1)),o.inActiveTheme=new r.Observable((!0)),o.canDisplayItem=new r.Observable((!0)),o.displayItem=new r.Observable((!0)),o.hasDisplayedChildren=new r.Observable((!1)),o.children=new n.LayerListItemCollection(o),o.onDemandItemCollection=new r.ObservableCollection([]),o.legendItems=new r.ObservableCollection([]),o.legendSwatch=new r.Observable(""),o.legendHasMultipleItems=new r.Observable((!1)),o.enableLayerActions=!1,o.enableMapServiceActions=!1,o.iconUri=new r.Observable(""),o.iconTooltip=new r.Observable(""),o.legendTooltip=new r.Observable(""),o.layerFolderToggleTooltip=new r.Observable(""),o.layerActionsTooltip=new r.Observable(""),o.layerToggleTooltip=new r.Observable(""),o.mapServiceActionsTooltip=new r.Observable(""),o.isMutuallyExclusive=new r.Observable((!1)),o.hasRadioToggle=new r.Observable((!1)),o.radioGroup=new r.Observable(""),o.isVisible.bind(o,o.setVisibility),o.isExpanded.bind(o,o.refreshOnDemandItemCollection),o.inActiveTheme.bind(o,o._onActiveThemeChanged),o.canDisplayItem.bind(o,o._updateDisplayItem),o.currentUserClickOriginator=!1,o.legendIsVisible=new r.Observable((!1)),o.layerList.onlyShowSwatchesOnVisibleLayers&&(o.isEffectivelyVisible.bind(o,o._processLegendVisibility),o.inVisibleScaleRange.bind(o,o._processLegendVisibility),o.legendItems.bind(o,o._processLegendVisibility)),o.displayItem.bind(o,o._processLegendVisibility),o.legendSwatch.bind(o,function(e){o.layerList.enableLegendIntegration&&o._processLegendVisibility()}),o.name.bind(o,o._updateFilterControlComponent),o.canDisplayItem.bind(o,o._updateFilterControlComponent),o}return __extends(t,e),t.prototype.bindToActiveTheme=function(){},t.prototype.unbindFromActiveTheme=function(){},t.prototype.cleanUp=function(){this._opacityChangeHandle&&(this._opacityChangeHandle.remove(),this._opacityChangeHandle=null),this.unbindFromActiveTheme(),this.layerList.filterControlComponent.removeRegisteredItem(this)},t.prototype.notifyActiveThemeChanged=function(e){e&&!this.inActiveTheme.get()&&this.inActiveTheme.set(!0),this.type===o.FOLDER&&!e&&this.inActiveTheme.get()&&this.children&&dojo.every(this.children.get(),function(e){return!e.inActiveTheme.get()})&&this.inActiveTheme.set(!1)},t.prototype.setItemVisibility=function(e){this.currentUserClickOriginator=!0,this.isVisible.set(e)},t.prototype.setVisibility=function(e){if(void 0!==this.allAncestorsVisible){if(void 0!=this._deferredVisibilitySetting)return void(this._deferredVisibilitySetting=e);if(e&&this.isMutuallyExclusive.get()&&this.parent&&!this.layerList.mapInfo.gcxMap.layerThemesInfo.themeChangeInProgress)for(var t=0;t<this.parent.children.length();t++){var i=this.parent.children.getAt(t);i!==this&&i.isVisible.get()&&i.isVisible.set(!1)}}},t.prototype.setAncestorVisibility=function(e){this.allAncestorsVisible=e,this.isVisible.pulse()},t.prototype.refreshOnDemandItemCollection=function(e){var t=void 0==e?this.isExpanded.get():e;if(this.onDemandItemCollection.clear(),this.children&&this.children.length()&&t)for(var i=0,r=this.children.length();i<r;i++){var n=this.children.getAt(i);this.displayInLayerList(n)&&this.onDemandItemCollection.addItem(n)}},t.prototype.populateMapServicesInParentFolders=function(){var e=this;if(this.type!==o.FOLDER&&this.mapService){for(var t=[],i=this.parent,r=!0;i;){if(i.type===o.MAPSERVICE&&i.mapService===this.mapService)return;i.type===o.FOLDER&&(r=!1,i.containedMapServices.indexOf(this.mapService)===-1&&i.id.get().indexOf(this.layerList.id.get())===-1&&t.push(i)),i=i.parent}r?this.layerList._outOfFolderMapServiceReferences.push(this.mapService):dojo.forEach(t,function(t){t.containedMapServices.push(e.mapService)})}},t.prototype.updateDisplayItem=function(){this._updateDisplayItem()},t.prototype.displayInLayerList=function(e){if(void 0===e&&(e=this),!e.inActiveTheme.get())return!1;if(e.type!==o.FOLDER)return e.canDisplayItem.get();var t=!1;if(e.children&&e.children.length())for(var i=0,r=e.children.length();i<r;i++){var n=e.children.getAt(i);if(this.displayInLayerList(n))return!0;if(n.inActiveTheme.get()&&!n.canDisplayItem.get()){t=!0;break}}return t&&e.canDisplayItem.get()},t.prototype._applyDeferredInitialVisibility=function(){if(void 0!=this._deferredVisibilitySetting&&!this.layerList.suspendMapUpdates){var e=this._deferredVisibilitySetting;delete this._deferredVisibilitySetting,this.setVisibility(e)}},t.prototype._setupOpacityBindings=function(){var e=this;if(this.type!==o.LAYER&&this.type!==o.GRAPHICSLAYER&&this.mapService&&this.mapService.serviceLayer&&void 0!=this.mapService.serviceLayer.opacity&&void 0!=this.mapService.serviceLayer.setOpacity&&this.mapService.serviceType!==a.MapServiceType.FEATURE){this.canAdjustOpacity.set(!0),this.opacity=new r.Observable(this.mapService.serviceLayer.opacity);this.opacity.bind(this,function(t){e.mapService.setOpacity(t)}),this._opacityChangeHandle=this.mapService.serviceLayer.on("opacity-change",function(t){var i=!!e.layerList.appInfo.gcxApp.project.isLoading,r=i&&e.mapService.gcxMapService?e.mapService.gcxMapService.opacity:t.opacity;!i&&e.mapService.gcxMapService&&t.opacity===e.mapService.gcxMapService.opacity*e.mapService.gcxMapService.opacityFilter||e.opacity.set(r)});
}},t.prototype._updateDisplayItem=function(){var e=this.displayInLayerList();e=e&&this.layerList.filterControlComponent.queryMatched(this),this.displayItem.set(e);var t=this.getSiblings(!0);if(t&&t.length){for(var i=0,r=0;r<t.length;r++){var n=t[r];n.displayItem.get()&&i++}for(var r=0;r<t.length;r++){var n=t[r];n.hasRadioToggle.set(n.isMutuallyExclusive.get()&&1!==i)}}},t.prototype._onActiveThemeChanged=function(e){this._updateDisplayItem();var t=this.parent;t&&t.id!==this.layerList.id&&t.notifyActiveThemeChanged(e)},t.prototype._processLegendVisibility=function(){this.layerList.onlyShowSwatchesOnVisibleLayers?this.legendIsVisible.set(this.isEffectivelyVisible.get()&&this.inVisibleScaleRange.get()&&!!this.legendItems.length()&&!!this.legendSwatch.get()&&this.displayItem.get()):this.legendIsVisible.set(!!this.legendItems.length()&&!!this.legendSwatch.get()&&this.displayItem.get()),1==this.legendItems.length()&&this.expandLegend.set(!1)},t.prototype._setTooltips=function(){var e=this,t=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-toggle").format(this.name.get()),i=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layer-actions-tooltip").format(this.name.get()),r=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-visible-at-extent"),n=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-not-visible-at-extent"),a=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-expand").format(this.name.get());this.layerActionsTooltip.set(i),this.layerFolderToggleTooltip.set(a),this.inVisibleScaleRange.get()?this.layerToggleTooltip.set(t+" "+r):this.layerToggleTooltip.set(t+" "+n),this.inVisibleScaleRange.bind(this,function(i){i?e.layerToggleTooltip.set(t+" "+r):e.layerToggleTooltip.set(t+" "+n)})},t.prototype._updateFilterControlComponent=function(){var e=this.canDisplayItem.get()&&!!this.name.get(),t=null!==this.layerList.filterControlComponent.getFilterableItem(this);e?(!t&&this.layerList.filterControlComponent.registerFilterableItem(this),this.layerList.filterControlComponent.setFilterData(this,[this.name.get()])):t&&this.layerList.filterControlComponent.removeRegisteredItem(this)},t}(i.LayerListNode);t.LayerListItem=s})},"geocortex/infrastructure/legend/LegendItemProviderResponse":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r;!function(e){e[e.NotFound=0]="NotFound",e[e.Rendered=1]="Rendered",e[e.Show=2]="Show",e[e.Hide=3]="Hide",e[e.Pending=4]="Pending",e[e.Error=5]="Error"}(r=t.LegendItemProviderResponseCode||(t.LegendItemProviderResponseCode={}));var n=function(){function e(e,t){this.code=new i.Observable(e),this.item=t}return e}();t.LegendItemProviderResponse=n})},"geocortex/infrastructure/legend/LegendItemProvider":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/legend/LegendItemProviderFactory":function(){define(["require","exports","geocortex/infrastructure/legend/LegendItemProviderResponse"],function(e,t,i){"use strict";var r=function(){function e(){}return e.registerLegendItemProvider=function(e){var t=this,r=function(e,i){for(var r=0;r<t._legendItemCallbacks.length;r++)if(e===t._legendItemCallbacks[r].uniqueId){t._legendItemCallbacks[r].callback(i),t._legendItemCallbacks.splice(r,1);break}},n=function(e){var t=e.children.get();if(t.length)for(var i,r=0;r<t.length;r++){var n=t[r].sublayerId||t[r].essLayer&&t[r].essLayer.id;if(0===r&&(i=n),n!==i||"single-item"!==t[r].templateType)return!1}return!0},a=function(e){if(e.children&&e.children.length())for(var t=0,i=e.children.length();t<i;t++){var r=e.children.getAt(t);l(r)}},o=function(e,i){t._legendItemInfos.push({uniqueId:e,legendItem:i}),r(e,i)},s=function(e){var t=e.essLayer&&e.essLayer.mapService&&e.essLayer.mapService.id||e.children&&e.children.length()&&e.children.getAt(0).essLayer&&e.children.getAt(0).essLayer.mapService&&e.children.getAt(0).essLayer.mapService.id||e.esriLayer.id,i=e.essLayer&&e.essLayer.id||e.sublayerId||null;return t+(null!=i?"."+i:"")},l=function(e){if(e){if("group"===e.templateType){if(e.children.length()&&n(e)){var t=e.children.getAt(0);return void o(s(t),e)}a(e)}"single-item"===e.templateType&&o(s(e),e)}};dojo.aspect.after(e,"provide",function(e){var r=e.code.get();if(r===i.LegendItemProviderResponseCode.Pending||r===i.LegendItemProviderResponseCode.Show){var n=function(){e.item&&l(e.item)};if(r===i.LegendItemProviderResponseCode.Show)n();else var a=e.code.bind(t,function(t){e.code.unbind(a),t===i.LegendItemProviderResponseCode.Show&&n()})}return e}),this._providers.push(e)},e.getProviders=function(){return this._providers},e.getLegendItemWhenAvailable=function(e,t){this.getLegendItemByIdWhenAvailable(e.uniqueId,t)},e.getLegendItemByIdWhenAvailable=function(e,t){if(e&&t){for(var i=null,r=0,n=this._legendItemInfos.length;r<n;r++){var a=this._legendItemInfos[r];a.uniqueId===e&&(i=a.legendItem)}i?t(i):this._legendItemCallbacks.push({uniqueId:e,callback:t})}},e}();r._providers=[],r._legendItemInfos=[],r._legendItemCallbacks=[],t.LegendItemProviderFactory=r})},"geocortex/infrastructure/layerList/LayerListLayerItem":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListItem","geocortex/infrastructure/legend/LegendItemProviderFactory"],function(e,t,i,r){"use strict";var n=function(e){function t(t,r,n,a){var o=e.call(this,t,a||i.LayerListItemType.LAYER,n)||this;if(o._themeSyncHandle=null,o._layerVisibilityHandle=null,o._zoomEndHandle=null,o._deferRefreshTimeoutMs=200,o._forceSetAncestorVisibilityOperationActive=!1,!r)throw new Error("LayerListLayerItem Initialization failed. Layer cannot be null");if(o.isUserCreated=r.isUserCreated,o.layer=r,o._updateVisibilityAtCurrentScale(),o._zoomEndHandle=o.layerList.appInfo.mapInfo.map.on("zoom-end",dojo.hitch(o,o._updateVisibilityAtCurrentScale)),o.type===i.LayerListItemType.LAYER){var s=!r.gcxLayer||(r.gcxLayer.isVisible()||r.gcxLayer.configuredVisible);o.canNotAssignVisibility.set(!o.layer.serviceLayerInfo.supportsLayerVisibility()),o._deferredVisibilitySetting=s,o.isVisible.set(s)}return o.name.set(r.displayName||r.name),o._setTooltips(),o.mapService=r.serviceLayerInfo,n._allMapServiceReferences.indexOf(o.mapService)===-1&&n._allMapServiceReferences.push(o.mapService),o.enableLayerActions=!0,o._subscribeEvents(),o._setupGcxBindingsIfAvailable(),o}return __extends(t,e),t.prototype.setVisibility=function(t,i){if(e.prototype.setVisibility.call(this,t),this._forceSetAncestorVisibilityOperationActive=this._forceSetAncestorVisibilityOperationActive||i,!(this.canNotAssignVisibility&&this.canNotAssignVisibility.get()||void 0===this.allAncestorsVisible||void 0!=this._deferredVisibilitySetting)){if((this._forceSetAncestorVisibilityOperationActive||this.layerList.autoActivateAncestorVisibilities&&this.currentUserClickOriginator)&&t===!0&&!this.allAncestorsVisible){this.isVisible.get()!==t&&this.isVisible.set(t);for(var r=this.parent;r&&r.id!==this.layerList.id&&r.isVisible.get();)r=r.parent;if(r&&r.id!==this.layerList.id)return void r.isVisible.set(!0)}var n=!this.currentUserClickOriginator&&this.mapService.supportsLayerVisibility();this.currentUserClickOriginator=!1,this._forceSetAncestorVisibilityOperationActive=!1;var a=t&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.layer.isUserCreated);this.layer.isVisible()!==a&&this.layer.setVisibility(a,!1,n,this._deferRefreshTimeoutMs)}},t.prototype.updateLegendItems=function(){var e=this;r.LegendItemProviderFactory.getLegendItemWhenAvailable(this.layer,dojo.hitch(this,function(t){e.legendItems.clear(),e._populateLegendItem(t)}))},t.prototype.bindToActiveTheme=function(){var t=this;e.prototype.bindToActiveTheme.call(this),this._themeSyncHandle=dojo.subscribe("LayerInActiveThemeChangedEvent",function(e){e&&e===t.layer.gcxLayer&&t.inActiveTheme.set(e.inActiveTheme)})},t.prototype.unbindFromActiveTheme=function(){e.prototype.unbindFromActiveTheme.call(this),this._themeSyncHandle&&dojo.unsubscribe(this._themeSyncHandle),this._themeSyncHandle=null},t.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(dojo.unsubscribe(this._layerVisibilityHandle),this._layerVisibilityHandle=null),this._zoomEndHandle&&(this._zoomEndHandle.remove(),this._zoomEndHandle=null)},t.prototype._subscribeEvents=function(){this._layerVisibilityHandle=dojo.subscribe("LayerVisibilityChange",dojo.hitch(this,this._handleLayerVisibilityChange))},t.prototype._onServiceLayerProcessed=function(){this._setupIconUri(),this.layerList.enableLegendIntegration&&!this.layer.serviceLayerInfo.serviceLayer.loadError&&r.LegendItemProviderFactory.getLegendItemWhenAvailable(this.layer,dojo.hitch(this,this._populateLegendItem))},t.prototype._handleLayerVisibilityChange=function(e){if(e&&e.length&&e[0].mapServiceId===this.layer.serviceLayerInfo.id)for(var t=0;t<e.length;t++)if(e[t].layerId===this.layer.id){if(void 0==this._deferredVisibilitySetting&&this.isEffectivelyVisible.get()===e[t].visibility&&(!this.isEffectivelyVisible.get()||this.inActiveTheme.get()||this.layer.isUserCreated))break;var i=e[t].visibility&&(this.inActiveTheme.get()||this.layer.isUserCreated);this.isVisible.set(i);break}},t.prototype._populateLegendItem=function(e){"single-item"===e.templateType?(this.expandLegend.set(!1),this.legendItems.addItem(e),this.legendSwatch.set(e.swatchElement)):(this.legendItems.addItems(e.children.get()),1===this.legendItems.length()?this.legendSwatch.set(this.legendItems.getAt(0).swatchElement):this.legendItems.length()&&this.legendSwatch.set(this.layerList.multiLegendSwatchElement||this.legendItems.getAt(0).swatchElement)),this.legendItems.length()>1?this.legendHasMultipleItems.set(!0):this.legendHasMultipleItems.set(!1),this.legendItems.length()&&(this.iconUri.set(""),this.legendTooltip.set(1===this.legendItems.length()?this.layerList.singleLegendIconTooltip.format(this.name.get()):this.layerList.multiLegendIconTooltip),this.legendTooltip.set(this.legendTooltip.get().format(this.name.get())))},t.prototype._setupIconUri=function(){var e=this.layer.gcxLayer,t=e?e.mapService:null;this.layer.serviceLayerInfo.serviceLayer.loadError&&this.layerList.serviceLoadFailureIconUri?(this.iconUri.set(this.layerList.serviceLoadFailureIconUri),this.iconTooltip.set(this.layerList.serviceLoadFailureIconTooltip?this.layerList.serviceLoadFailureIconTooltip:"")):this.layerList&&this.layerList.enableLayerIcons&&(e&&e.iconUri||t&&this.type===i.LayerListItemType.GRAPHICSLAYER&&t.iconUri)&&(this.iconUri.set(e.iconUri||t.iconUri),this.iconTooltip.set(this.name.get()))},t.prototype._setupGcxBindingsIfAvailable=function(){var e=this;if(this.layer.gcxLayer)if(this.bindToActiveTheme(),this.layer.serviceLayerInfo.serviceLayer.loaded||this.layer.serviceLayerInfo.serviceLayer.loadError)this._onServiceLayerProcessed();else{var t=null,i=null,r=function(){t&&dojo.disconnect(t),i&&dojo.disconnect(i),t=i=null};t=dojo.connect(this.mapService.serviceLayer,"onLoad",function(){r(),e._onServiceLayerProcessed()}),i=dojo.connect(this.mapService.serviceLayer,"onError",function(){r(),e._onServiceLayerProcessed()})}},t.prototype._updateVisibilityAtCurrentScale=function(){var e=!1,t=esri.geometry.getScale(this.layerList.appInfo.mapInfo.map);(0==this.layer.getMaxScale()&&this.layer.getMinScale()==1/0||isNaN(this.layer.getMaxScale())&&isNaN(this.layer.getMinScale()))&&(e=!0),this.inVisibleScaleRange.set(e||this.layer.getMaxScale()<t&&t<this.layer.getMinScale())},t}(i.LayerListItem);t.LayerListLayerItem=n})},"geocortex/infrastructure/layerList/LayerListItemCollection":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/layerList/LayerListItem"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){void 0===i&&(i=[]);var r=e.call(this,i||[])||this;return r._parent=t,r}return __extends(t,e),t.prototype.addItem=function(t){if(!t)throw new Error("Layer list item not defined. Cannot insert in collection.");this._prepItemForAddition(t),e.prototype.addItem.call(this,t),this._processItemPostAddition(t)},t.prototype.validateAndAddItem=function(e){return!!e&&(this._validateCanAdd(e)?(this.addItem(e),!0):(console.error("LayerListItemCollection: Cannot add item with id: {0} in collection. Validation failed.".format(e.id.get())),!1))},t.prototype.addItems=function(t){if(!t)throw new Error("Layer list items are not defined. Cannot insert in collection.");this._prepItemsForAddition(t),e.prototype.addItems.call(this,t),this._processItemsPostAddition(t)},t.prototype.validateAndAddItems=function(e){if(!e||!e.length)return!1;for(var t=0;t<e.length;t++)if(!this._validateCanAdd(e[t]))return console.error("LayerListItemCollection: Cannot add items in collection. Validation failed."),!1;return this.addItems(e),!0},t.prototype.insertItem=function(t,i){if(!i)throw new Error("Layer list item not defined. Cannot insert at index "+t+" in collection.");this._prepItemForAddition(i),e.prototype.insertItem.call(this,t,i),this._processItemPostAddition(i)},t.prototype.insertItems=function(t,i){if(!i)throw new Error("Layer list items are not defined. Cannot insert at index "+t+" in collection.");this._prepItemsForAddition(i),e.prototype.insertItems.call(this,t,i),this._processItemsPostAddition(i)},t.prototype.validateAndInsertItem=function(e,t){return this._validateCanAdd(t)?(this.insertItem(e,t),!0):(console.error("LayerListItemCollection: Could not insert item with id: {0} in collection. Validation failed.".format(t.id.get())),!1)},t.prototype.validateAndInsertItems=function(e,t){if(!t||!t.length)return!1;for(var i=0;i<t.length;i++)if(!this._validateCanAdd(t[i]))return console.error("Could not insert items in collection. Validation failed."),!1;return this.insertItems(e,t),!0},t.prototype.removeItem=function(t){if(!t)throw new Error("LayerListItemCollection: Cannot remove item at index from collection.");this._prepItemForRemoval(t),e.prototype.removeItem.call(this,t)},t.prototype.removeAt=function(t){var i=this.getAt(t);if(!i)throw new Error("LayerListItemCollection: Cannot remove item at index "+t+" from collection.");this._prepItemForRemoval(i),e.prototype.removeAt.call(this,t)},t.prototype.removeRange=function(t,i){t=void 0!=t?Math.max(0,t):0,i=void 0!=i?Math.min(i,this.getLength()-1):this.getLength()-1,this._prepItemsForRemoval(this.get().slice(t,i+1)),e.prototype.removeRange.call(this,t,i)},t.prototype.clear=function(){this._prepItemsForRemoval(this.get()),e.prototype.clear.call(this)},t.prototype._prepItemForAddition=function(e){var t=this;this._parent&&(e.parent=this._parent,e.parentEffectivelyVisible.sync(e.parent.isEffectivelyVisible),e.setAncestorVisibility(this._parent.isVisible.get()),e._visibilityBindingToken=this._parent.isVisible.bind(e,function(i){e.setAncestorVisibility(i&&t._parent.allAncestorsVisible)}),this.length()&&this.getAt(0).isMutuallyExclusive.get()&&(e.isMutuallyExclusive.set(!0),e.hasRadioToggle.set(!0),e.radioGroup.set(this.getAt(0).radioGroup.get())),e._displayItemBindingToken=e.displayItem.bind(e,function(e){if(e)t._parent.hasDisplayedChildren.set(!0);else{for(var i=!1,r=0;r<t.length();r++)if(t.getAt(r).displayItem.get()){i=!0;break}t._parent.hasDisplayedChildren.set(i)}}),e.displayItem.pulse())},t.prototype._processItemPostAddition=function(e){e.type!==r.LayerListItemType.MAPSERVICE&&e.type!==r.LayerListItemType.LAYER&&e.type!==r.LayerListItemType.GRAPHICSLAYER||e.populateMapServicesInParentFolders()},t.prototype._prepItemForRemoval=function(e){if(e.parentEffectivelyVisible.removeSync(),e.parent=null,e._visibilityBindingToken&&this._parent&&(this._parent.isVisible.unbind(e._visibilityBindingToken),e._visibilityBindingToken=null),e._displayItemBindingToken&&this._parent&&(e.displayItem.unbind(e._displayItemBindingToken),e._displayItemBindingToken=null,e.displayItem)){for(var t=!1,i=0;i<this.length();i++)if(this.getAt(i)!==e&&this.getAt(i).displayItem.get()){t=!0;break}this._parent.hasDisplayedChildren.set(t)}e.cleanUp()},t.prototype._prepItemsForAddition=function(e){var t=this;dojo.forEach(e,function(e){t._prepItemForAddition(e)})},t.prototype._processItemsPostAddition=function(e){var t=this;dojo.forEach(e,function(e){t._processItemPostAddition(e)})},t.prototype._prepItemsForRemoval=function(e){var t=this;dojo.forEach(e,function(e){t._prepItemForRemoval(e)})},t.prototype._validateCanAdd=function(e){var t=this,i=this.layerList||this._parent.layerList,n=i.getDescendants(),a=n.filter(function(t){return t===e});if(a.length)return!1;if(e.type===r.LayerListItemType.FOLDER){var o=e;return o.children.getItems().every(function(e){return t._validateCanAdd(e)})}if(e.type===r.LayerListItemType.MAPSERVICE)return!!e.mapService&&!n.some(function(t){return t.mapService&&(t.mapService===e.mapService||t.mapService.serviceLayer===e.mapService.serviceLayer)});if(e.type===r.LayerListItemType.LAYER){var s=e;return!!s.layer&&!n.some(function(e){return e.layer&&e.layer===s.layer})}return!0},t}(i.ObservableCollection);t.LayerListItemCollection=n})},"geocortex/infrastructure/layerList/LayerListNode":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r=function(){function e(e,t){this.id=new i.Observable(""),this.children=null,this.parent=null,e&&this.id.set(e),t&&(this.parent=t)}return e.prototype.getRoot=function(){for(var e=this;null!=e.parent;)e=e.parent;return e},e.prototype.getAncestors=function(){var e=null;if(this.parent){e=[];for(var t=this.parent;null!=t;)e.push(t),t=t.parent}return e},e.prototype.getSelfAndAncestors=function(){var e=this.getAncestors();return e=e&&e.length?e:[],e.unshift(this),e},e.prototype.getSiblings=function(e){void 0===e&&(e=!1);var t=null;if(this.parent&&this.parent.children&&(t=this.parent.children.get(),!e)){t=t.slice(0);for(var i=0;i<t.length;i++)if(t[i]===this){t.splice(i,1);break}}return t},e.prototype.getDescendants=function(){if(this.children){for(var e=[],t=this.children.get(),i=0;i<t.length;i++){var r=t[i];e.push(r);for(var n=r.getDescendants(),a=0;a<n.length;a++)e.push(n[a])}return e}},e.prototype.getSelfAndDescendants=function(){var e=this.getDescendants();return e=e&&e.length?e:[],e.unshift(this),e},e}();t.LayerListNode=r})},"geocortex/infrastructure/layerList/LayerListConfigurationParams":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerList/LayerListKmlFolderItem":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListItem"],function(e,t,i){"use strict";var r=function(e){function t(t,r,n,a){var o=e.call(this,t,i.LayerListItemType.KMLFOLDER,r)||this;if(!n)throw new Error("LayerListKmlFolderItem: Initialization failed. KML layer object cannot be null.");if(!a)throw new Error("LayerListKmlFolderItem: Initialization failed. KML folder object cannot be null.");return o._kmlLayer=n,o._kmlFolder=a,o.name.set(a.name),o._setTooltips(),o.isVisible.set(!!a.visibility),o}return __extends(t,e),t.prototype.setItemVisibility=function(t){e.prototype.setItemVisibility.call(this,t),this._kmlLayer.setFolderVisibility(this._kmlFolder,t)},t}(i.LayerListItem);t.LayerListKmlFolderItem=r})},"geocortex/infrastructure/layerList/LayerListMapServiceItem":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListItem","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/layerList/LayerListKmlFolderItem"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,r,n){var a=e.call(this,t,i.LayerListItemType.MAPSERVICE,n)||this;if(a._themeSyncHandle=null,a._layerVisibilityHandle=null,a._forceSetAncestorVisibilityOperationActive=!1,!r)throw new Error("LayerListMapServiceItem Initialization failed. MapService cannot be null");var o;o=a.layerList&&a.layerList.mapInfo&&a.layerList.mapInfo.gcxMap&&a.layerList.mapInfo.gcxMap.layerThemesInfo&&a.layerList.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured?!r.gcxMapService||!r.gcxMapService.serviceLayer||r.gcxMapService.serviceLayer.visible:!r.gcxMapService||r.gcxMapService.configuredVisible,a.name.set(r.displayName?r.displayName:""),a._setTooltips(),a.mapService=r,n._handledMapServiceReferences.push(r),n._allMapServiceReferences.indexOf(r)===-1&&n._allMapServiceReferences.push(r),a._deferredVisibilitySetting=o,a.isVisible.set(o);a.mapService.serviceType;if(a.isUserCreated=r.isUserCreated,a.enableMapServiceActions=r.isUserCreated,a._setupOpacityBindings(),a._subscribeEvents(),a._setupBindings(),r.serviceLayer instanceof esri.layers.KMLLayer){var s=r.serviceLayer;s.loaded?a._kmlLayerLoadHandler(s):s.on("load",function(e){return a._kmlLayerLoadHandler(e.layer)})}return a}return __extends(t,e),t.prototype.setVisibility=function(t,i){if(e.prototype.setVisibility.call(this,t),this._forceSetAncestorVisibilityOperationActive=this._forceSetAncestorVisibilityOperationActive||i,this._syncChildVisibilitiesIfApplicable(t),void 0!==this.allAncestorsVisible&&void 0==this._deferredVisibilitySetting){if((this._forceSetAncestorVisibilityOperationActive||this.layerList.autoActivateAncestorVisibilities&&this.currentUserClickOriginator)&&t===!0&&!this.allAncestorsVisible){this.isVisible.get()!==t&&this.isVisible.set(t);for(var r=this.parent;r&&r.id!==this.layerList.id&&r.isVisible.get();)r=r.parent;if(r&&r.id!==this.layerList.id)return void r.isVisible.set(!0)}this.currentUserClickOriginator=!1,this._forceSetAncestorVisibilityOperationActive=!1,this.mapService.setVisibility(t&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.mapService.isUserCreated))}},t.prototype.bindToActiveTheme=function(){var t=this;e.prototype.bindToActiveTheme.call(this),this._themeSyncHandle=dojo.subscribe("MapServiceInActiveThemeChangedEvent",function(e){e&&e===t.mapService.gcxMapService&&t.inActiveTheme.set(e.inActiveTheme)})},t.prototype.unbindFromActiveTheme=function(){e.prototype.unbindFromActiveTheme.call(this),this._themeSyncHandle&&dojo.unsubscribe(this._themeSyncHandle),this._themeSyncHandle=null},t.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(this._layerVisibilityHandle.remove(),this._layerVisibilityHandle=null)},t.prototype._subscribeEvents=function(){var e=this;this._layerVisibilityHandle=this.mapService.serviceLayer.on("visibility-change",function(t){if(void 0!=e._deferredVisibilitySetting||e.isEffectivelyVisible.get()!==t.visible||e.isEffectivelyVisible.get()&&!e.inActiveTheme.get()&&!e.mapService.isUserCreated){var i=t.visible&&(e.inActiveTheme.get()||e.mapService.isUserCreated);e.isVisible.set(i)}})},t.prototype._setupIconUri=function(){this.mapService.serviceLayer.loadError&&this.layerList.serviceLoadFailureIconUri?(this.iconUri.set(this.layerList.serviceLoadFailureIconUri),this.iconTooltip.set(this.layerList.serviceLoadFailureIconTooltip?this.layerList.serviceLoadFailureIconTooltip:"")):this.mapService.gcxMapService&&this.mapService.gcxMapService.iconUri&&(this.iconUri.set(this.mapService.gcxMapService.iconUri),this.iconTooltip.set(this.name.get()))},t.prototype._syncChildVisibilitiesIfApplicable=function(e){var t=this;switch(this.mapService.serviceType){case r.MapServiceType.BING:case r.MapServiceType.TILED:case r.MapServiceType.WMTS:case r.MapServiceType.IMAGE:case r.MapServiceType.WEBTILED:if(this.children.length()>0){var n=this.getDescendants();n.forEach(function(r){r.type===i.LayerListItemType.LAYER&&r.mapService.id===t.mapService.id&&r.isVisible.get()!==e&&r.isVisible.set(e)})}break;default:return}},t.prototype._setupBindings=function(){var e=this;if(this.mapService.gcxMapService&&this.bindToActiveTheme(),this.mapService.serviceLayer.loaded||this.mapService.serviceLayer.loadError)this._setupIconUri();else{var t=null,i=null,r=function(){t&&dojo.disconnect(t),i&&dojo.disconnect(i),t=i=null};t=dojo.connect(this.mapService.serviceLayer,"onLoad",function(){r(),e._setupIconUri()}),i=dojo.connect(this.mapService.serviceLayer,"onError",function(){r(),e._setupIconUri()})}if(!this.mapService.serviceLayer.loaded&&!this.mapService.serviceLayer.loadError)var n=this.mapService.serviceLayer.on("load",function(){e._updateVisibilityAtCurrentScale(),n.remove()});if(!this.mapService.serviceLayer.getMap())var a=this.layerList.appInfo.map.on("layer-add",function(t){t.layer===e.mapService.serviceLayer&&(e._updateVisibilityAtCurrentScale(),a.remove())});this._updateVisibilityAtCurrentScale(),this.mapService.serviceLayer.on("scale-visibility-change",function(){return e._updateVisibilityAtCurrentScale()})},t.prototype._kmlLayerLoadHandler=function(e){e.folders&&e.folders.length>1&&(this._createKmlFolders(this,e.folders[1],e),this.refreshOnDemandItemCollection())},t.prototype._createKmlFolders=function(e,t,i){for(var r=i.folders,a=0;a<t.subFolderIds.length;a++){for(var o=t.subFolderIds[a],s=null,l=0;l<r.length;l++)if(r[l].id===o){s=r[l];break}if(!s)throw new Error("Could not find KML folder with ID '{0}'.".format(o));var c=new n.LayerListKmlFolderItem(this.mapService.id+o,this.layerList,i,s);this._createKmlFolders(c,s,i),e.children.addItem(c)}},t.prototype._updateVisibilityAtCurrentScale=function(){this.mapService.serviceLayer.loaded&&this.mapService.serviceLayer.getMap()&&this.inVisibleScaleRange.set(this.mapService.serviceLayer.visibleAtMapScale)},t.prototype._setTooltips=function(){e.prototype._setTooltips.call(this);var t=this.layerList.appInfo.gcxApp;if(t){var i=t.getResource(this.layerList._libraryId,"language-mapservice-actions-tooltip").format(this.name.get());this.mapServiceActionsTooltip.set(i)}},t}(i.LayerListItem);t.LayerListMapServiceItem=a})},"geocortex/infrastructure/layerList/LayerListGraphicsLayerItem":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListLayerItem","geocortex/infrastructure/layerList/LayerListItem"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i,n){var a=e.call(this,t,i,n,r.LayerListItemType.GRAPHICSLAYER)||this;if(!i)throw new Error("LayerListGraphicsLayerItem Initialization failed. Layer cannot be null.");var o=i.gcxLayer?i.gcxLayer.isVisible()||i.gcxLayer.configuredVisible:i.serviceLayerInfo.serviceLayer.defaultVisibility||i.isVisible();return a.canNotAssignVisibility.set(!1),a._deferredVisibilitySetting=o,a.isVisible.set(o),a}return __extends(t,e),t}(i.LayerListLayerItem);t.LayerListGraphicsLayerItem=n})},"geocortex/infrastructure/layerList/LayerVisibilityType":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();i.Default="default",i.MutuallyExclusive="mutuallyExclusive",t.LayerVisibilityType=i})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlViewModelBase":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i,n){var a=e.call(this,t,i)||this;return a.filterText=new r.Observable(""),a.showBusyIcon=new r.Observable((!1)),a.filterInputPlaceholder=new r.Observable(""),a.filterButtonText=new r.Observable(""),a._filterTextSettleDelayMs=600,a._filterTextTimeoutToken=null,a.filterText.bind(a,a._processFilterTextChanged),n&&(a._filterControlComponent=n),a}return __extends(t,e),t.prototype.setFilterControlComponent=function(e){return!!e&&(this._filterControlComponent=e,this.app.event("FilterControlQueryChangedEvent").subscribe(this,this._handleFilterQueryChangedEvent),!0)},t.prototype.getFilterControlComponent=function(){return this._filterControlComponent},t.prototype.handleFilterTextInput=function(e){return!!this._filterControlComponent&&(this._filterControlComponent.applyQuery(e),!0)},t.prototype._processFilterTextChanged=function(e){var t=this;this.showBusyIcon.set(!0),this._filterTextTimeoutToken&&clearTimeout(this._filterTextTimeoutToken),this._filterTextTimeoutToken=setTimeout(function(){t.handleFilterTextInput(e),t.showBusyIcon.set(!1)},this._filterTextSettleDelayMs)},t.prototype._handleFilterQueryChangedEvent=function(e){var t=this._filterControlComponent;t&&e.filterControlId===t.filterControlId&&this.filterText.get()!==e.query&&this.filterText.set(e.query)},t}(i.ViewModelBase);t.FilterControlViewModelBase=n})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlComponent":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){return this._filterableItems=[],this._currentQuery="",t?(this.app=e,this.filterControlId=t,void this.app.command("ApplyFilterControlQuery").register(this,this._applyFilterControlQueryImpl)):void this.app.trace.error("FilterControlViewModel: Failed to initialize. Filter Control Id must be specified.")}return e.prototype.registerFilterableItem=function(e,t){if(!e)return void this.app.trace.error("FilterControlViewModel: No item to register. Could not add to {0} filter.".format(this.filterControlId));var i={};i.filterData=t&&t.length?t:null,i.filterQuery=null,i.item=e,i.queryMatched=!0,this._filterableItems.push(i)},e.prototype.removeRegisteredItem=function(e){var t=this._filterableItems.filter(function(t){return t.item===e})[0],i=this._filterableItems.indexOf(t);return!(!t||i<0)&&(this._filterableItems.splice(i,1),!0)},e.prototype.clear=function(){this._filterableItems.length=0},e.prototype.getFilterableItem=function(e){var t=this._filterableItems.filter(function(t){return t.item===e})[0];return t?t:null},e.prototype.setFilterData=function(e,t){var i=this.getFilterableItem(e);return i?void(i.filterData=t):void this.app.trace.error("FilterControlViewModel: Could not update filter data for {0} filter.".format(this.filterControlId))},e.prototype.queryMatched=function(e){var t=this._filterableItems.filter(function(t){return t.item===e})[0];return!(!t||!t.queryMatched)},e.prototype.filter=function(e,t){if(!e)return void this.app.trace.error("FilterControlViewModel: Filterable Item Info not provided.");var i=!0;return t&&e.filterData&&e.filterData.length&&(i=e.filterData.some(function(e){return!!e&&e.toLowerCase().indexOf(t.toLowerCase())!==-1})),i},e.prototype.applyQuery=function(e){var t=this,i=!1;if(this._currentQuery!==e){this._currentQuery=e;var r={filterControlId:this.filterControlId,query:this._currentQuery};this.app.event("FilterControlQueryChangedEvent").publish(r)}if(this._filterableItems.forEach(function(r){var n=t.filter(r,e);i=i===!1?r.queryMatched!==n:i,r.filterQuery=e,r.queryMatched=n}),i){var n={filterControlId:this.filterControlId,filterableItems:this._filterableItems};this.app.event("FilterControlResultChangedEvent").publish(n)}},e.prototype._applyFilterControlQueryImpl=function(e){e.filterControlId===this.filterControlId&&e.query!==this._currentQuery&&this.applyQuery(e.query)},e}();t.FilterControlComponent=i})},"geocortex/infrastructure/layerList/LayerList":function(){define(["require","exports","geocortex/infrastructure/layerList/LayerListNode","geocortex/infrastructure/layerList/LayerListFolderItem","geocortex/infrastructure/gis/ServiceLayerInfo","geocortex/framework/utils/utils","geocortex/infrastructure/layerList/LayerListItemCollection","geocortex/geocortex","geocortex/essentials/MapService","geocortex/infrastructure/layerList/LayerListItem","geocortex/infrastructure/layerList/LayerListLayerItem","geocortex/infrastructure/gis/LayerInfo","geocortex/infrastructure/layerList/LayerListMapServiceItem","geocortex/infrastructure/layerList/LayerListGraphicsLayerItem","geocortex/essentials/LayerThemeSetting","geocortex/essentials/RestHelper","geocortex/infrastructure/layerList/LayerVisibilityType","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/ui/components/FilterControl/FilterControlComponent"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m,f,g,y,b){"use strict";var v=function(e){function t(t,i,r,n){var o=e.call(this,"GCXLayerListRootNode-".concat(a.alphaNumericToken()))||this;if(o.layerListInitialized=!1,o.layerListInitializationFailure=null,o.onLayerListInitializationFailed=function(e){},o.onLayerListInitialized=function(e){},
o.enableLegendIntegration=!1,o.onlyShowSwatchesOnVisibleLayers=!1,o.autoActivateAncestorVisibilities=!1,o._addedFolderReferences=[],o._handledMapServiceReferences=[],o._allMapServiceReferences=[],o._outOfFolderMapServiceReferences=[],o._initializing=!1,o._groupByOperationalAndBase=!0,o._layerListRestEndpoint=null,o._suspendMapUpdates=!1,o._itemsExpandedByFilter=[],o._filterControlId="LayerListFilterControl",!t||!t.mapInfo)throw new Error("LayerList: Initialization failed. AppInfo/MapInfo cannot be null");return o.appInfo=t,o.mapInfo=t.mapInfo,o.url=i||"",o._libraryId="Mapping.Infrastructure",o._layerListRestEndpoint=r||null,o.enableLegendIntegration=!(!n||void 0==n.enableLegendIntegration)&&n.enableLegendIntegration,o.onlyShowSwatchesOnVisibleLayers=!(!n||void 0==n.onlyShowSwatchesOnVisibleLayers)&&n.onlyShowSwatchesOnVisibleLayers,o.autoActivateAncestorVisibilities=!(!n||void 0==n.autoActivateAncestorVisibilities)&&n.autoActivateAncestorVisibilities,o._groupByOperationalAndBase=!n||void 0==n.groupByOperationalAndBase||n.groupByOperationalAndBase,o.enableLayerIcons=!(!n||void 0==n.enableLayerIcons)&&n.enableLayerIcons,o.serviceLoadFailureIconUri=n?n.serviceLoadFailureIconUri||"":"",o.serviceLoadFailureIconTooltip=n?n.serviceLoadFailureIconTooltip||"":"",o.multiLegendSwatchElement=n?n.multiLegendSwatchElement||"":"",o.singleLegendIconTooltip=n?n.singleLegendIconTooltip||"":"",o.multiLegendIconTooltip=n?n.multiLegendIconTooltip||"":"",o.filterControlComponent=new b.FilterControlComponent(o.appInfo.gcxApp,o._filterControlId),o.appInfo.gcxApp.event("FilterControlResultChangedEvent").subscribe(o,o._handleFilterChanged),dojo.connect(o.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangingEvent",dojo.hitch(o,function(){return o.suspendMapUpdates=!0})),dojo.connect(o.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangedEvent",dojo.hitch(o,function(){return o.suspendMapUpdates=!1})),o}return __extends(t,e),Object.defineProperty(t.prototype,"suspendMapUpdates",{get:function(){return this._suspendMapUpdates},set:function(e){e!==this._suspendMapUpdates&&(this._suspendMapUpdates=e,this._suspendMapUpdates?this._enableDeferredItemVisibilities(this.children.get()):this._applyDeferredItemVisibilities(this.children.get()))},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.layerListInitialized||this._initializing||(this._initializing=!0,this.children=new o.LayerListItemCollection(null),this.children.layerList=this,this._layerListRestEndpoint?this._layerListInitializationHandler(this._layerListRestEndpoint):this.url&&this.appInfo.essentialsVersion&&this.appInfo.essentialsVersion>=4.02?s.request({url:this.url,content:{f:"json"},load:dojo.hitch(this,this._layerListInitializationHandler),error:dojo.hitch(this,this._layerListInitializationErrorHandler),callbackParamName:"CallBack"}):this._layerListInitializationHandler(null))},t.prototype.addUserAddedServiceLayer=function(e,t){var i=e;if(!this.layerListInitialized)return!1;if(!(i instanceof n.ServiceLayerInfo))if(i instanceof l.MapService)i=n.ServiceLayerInfo.fromGcxMapService(i);else{if(!(i instanceof esri.layers.Layer))return this.appInfo.gcxApp.trace.error("addUserAddedServiceLayer: Could not add layer. Invalid layer type."),!1;i=n.ServiceLayerInfo.fromEsriLayer(i)}i.isUserCreated=!0;var r=this._generateLayerListItemsFromServiceLayer(i,this,!0);return!(!r||!r.length)&&(null!==t&&void 0!==t?this._addItemsToUserAddedFolder(r,t):this._addItemsToUserAddedFolder(r))},t.prototype.removeServiceLayer=function(e){var t=e;if(!this.layerListInitialized)return!1;if(!(t instanceof esri.layers.Layer)){if(!(t instanceof l.MapService||t instanceof n.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("removeServiceLayer: Could not remove layer. Invalid layer type."),!1;t=t.serviceLayer}var i=this.getDescendants();if(i.length){for(var r=0;r<i.length;r++){var a=i[r];if(a.mapService&&a.mapService.serviceLayer===t&&this._isItemSafeToBeRemoved(a,t)){var o=a.parent;o?(o.children.removeItem(a),o instanceof c.LayerListItem&&o.refreshOnDemandItemCollection()):this.children.removeItem(a)}}return!0}return!1},t.prototype._isItemSafeToBeRemoved=function(e,t){if(e.type===c.LayerListItemType.MAPSERVICE||e.type===c.LayerListItemType.LAYER||e.type===c.LayerListItemType.GRAPHICSLAYER)return!0;if(e.children){if(0==e.children.length())return!0;var i=e.getDescendants();if(i&&i.length>0)for(var r=0;r<i.length;r++)if((i[r].type===c.LayerListItemType.LAYER||i[r].type===c.LayerListItemType.GRAPHICSLAYER||i[r].type===c.LayerListItemType.MAPSERVICE)&&i[r].mapService&&i[r].mapService.serviceLayer!=t)return!1;return!0}return!0},t.prototype.updateServiceLayer=function(e,t,i){if(!this.layerListInitialized||!e)return!1;t=t||[],i=i||[];var r;if(e instanceof l.MapService)r=n.ServiceLayerInfo.fromGcxMapService(e);else{if(!(e instanceof n.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("updateServiceLayer: Could not update layer. Invalid layer type."),!1;r=e}var a=this.getDescendants(),o=a.filter(function(e){return e.mapService&&e.mapService&&e.mapService.gcxMapService===r.gcxMapService});if(!o.length)return this.addUserAddedServiceLayer(r);if(i&&i.length)for(var a=this.getDescendants(),s=0;s<a.length;s++){var p=a[s];if(p.type===c.LayerListItemType.LAYER){var h=p,m=h.layer&&h.layer.gcxLayer?h.layer.gcxLayer:null;if(m&&m.isUserCreated&&i.indexOf(m)>=0){var f=h.parent;f?(f.children.removeItem(h),f instanceof c.LayerListItem&&f.refreshOnDemandItemCollection()):(this.children.removeItem(h),this.children.pulse())}}}if(t&&t.length){for(var a=this.getDescendants(),g=new Array,s=0;s<t.length;s++){var y=t[s],b=r.findLayerById(y.id);b||(b=d.LayerInfo.fromGcxLayer(y),b.serviceLayerInfo=r,r.layers.push(b));var v=a.filter(function(e){return e.layer&&e.layer.gcxLayer===b.gcxLayer});if(!v.length){var S=new u.LayerListLayerItem(b.id,b,this,c.LayerListItemType.LAYER);g.push(S)}}if(g.length)return this._addItemsToUserAddedFolder(g)}return!1},t.prototype.updateServiceLayerLegendSwatch=function(e){if(!this.layerListInitialized)return!1;var t=e.serviceLayer;if(!t)return this.appInfo.gcxApp.trace.error("updateServiceLayerLegendSwatch: Could not update layer swatch. Invalid layer type."),!1;var i=this.getDescendants(),r=i.filter(function(e){return e.mapService&&e.mapService.serviceLayer.id===t.id});if(r.length>0){for(var n=0;n<r.length;n++){var a=r[n];a&&a instanceof u.LayerListLayerItem&&a.updateLegendItems()}return!0}return!1},t.prototype.getUserAddedLayersFolderIndex=function(e){var t=e;if(!this.layerListInitialized)return null;if(!(t instanceof esri.layers.Layer)){if(!(t instanceof l.MapService||t instanceof n.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("removeServiceLayer: Could not remove layer. Invalid layer type."),null;t=t.serviceLayer}var i=this._userAddedLayersFolder||this;if(i.children&&i.children.length)for(var r=i.children.get(),a=0;a<r.length;a++){var o=r[a];if(o.mapService&&o.mapService.serviceLayer===t)return a}return null},t.prototype._applyDeferredItemVisibilities=function(e){var t=this;dojo.forEach(e,function(e){e._applyDeferredInitialVisibility(),e.children&&e.children.length()&&t._applyDeferredItemVisibilities(e.children.get())})},t.prototype._enableDeferredItemVisibilities=function(e){var t=this;e.forEach(function(e){a.isNullOrUndefined(e._deferredVisibilitySetting)&&(e._deferredVisibilitySetting=e.isVisible.get()),t._enableDeferredItemVisibilities(e.children.get())})},t.prototype._layerListInitializationErrorHandler=function(e){this.layerListInitializationFailure=e,this.onLayerListInitializationFailed&&this.onLayerListInitializationFailed(e),this._initializing=!1},t.prototype._layerListInitializationHandler=function(e){var t=this,i=function(){t.layerListInitialized=!0,t._initializing=!1,t._processEligibleSingleMapServiceFolders(),t._processUnhandledMapServices(),t._setupOpacityBindingsForParentsOfHiddenItemsWithOpacityBindings(),t._applyInitialLayerTheme(),t._applyDeferredItemVisibilities(t.children.get()),t.onLayerListInitialized&&t.onLayerListInitialized(t)};e?this._configureLayerListFromRestResponse(e,i,this._layerListInitializationErrorHandler):this._configureLayerListFromMapInfo(this.mapInfo,i,this._layerListInitializationErrorHandler)},t.prototype._configureLayerListFromMapInfo=function(e,t,i){if(!e)return void this._layerListInitializationErrorHandler(new Error("Error initializing layer list from MapInfo."));if(e.gcxMap&&e.serviceLayers.length&&void 0!=e.serviceLayers[0].serviceLayerFunction&&this._groupByOperationalAndBase)var n=new r.LayerListFolderItem(this.id.get()+":Operational",this.appInfo.gcxApp.getResource(this._libraryId,"language-layerlist-operational-maps-folder-title"),this),a=new r.LayerListFolderItem(this.id.get()+":Base",this.appInfo.gcxApp.getResource(this._libraryId,"language-layerlist-base-maps-folder-title"),this);try{for(var o=0;o<e.serviceLayers.length;o++){var s=e.serviceLayers[o],l=this._generateLayerListItemsFromServiceLayer(s,this);if(l&&l.length)if(this._groupByOperationalAndBase)switch(s.serviceLayerFunction){case"Operational":n.children.addItems(l);break;case"Base":a.children.addItems(l);break;default:throw new Error("ServiceLayerFunction undefined or not recognized: {0}".format(s.serviceLayerFunction))}else this.children.addItems(l)}this._groupByOperationalAndBase&&(n.children.length()&&(this._generateThemeSettingsForCoreFolder(n),this.children.addItem(n),n.isExpanded.set(!0),n.isVisible.set(!0),n.configuredVisible=!0),a.children.length()&&(this._generateThemeSettingsForCoreFolder(a),this.children.addItem(a),a.isExpanded.set(!0),a.isVisible.set(!0),a.configuredVisible=!0))}catch(c){return console.error("Layer List Configuration Error: {0}".format(c&&c.message||"Unknown Error")),void i(c)}t()},t.prototype._configureLayerListFromRestResponse=function(e,t,i){try{if(!e||!e.items)throw new Error("Layer list failed to load (general data failure).");this._userAddedLayersDestinationId=e.userAddedLayersDestinationId;for(var r=0,n=e.items;r<n.length;r++){var a=n[r],o=this._createLayerListItemFromRestResult(a,this);o&&this.children.addItem(o)}}catch(s){return s.name="LayerListConfigurationError/"+s.name,this._layerListInitializationErrorHandler(s),void i(s)}t()},t.prototype._generateLayerListItemsFromServiceLayer=function(e,t,i){var r=this;void 0===i&&(i=!1);var n=[],a=null,o=function(t,i){var n=t.subLayerIds||[];if(n.length>0)for(var a=0;a<n.length;a++){var l=e.findLayerById(n[a]);if(l&&(l.processed=!0,l.includeInLayerList)){var c=new u.LayerListLayerItem(l.id,l,r);s(c),i.children.addItem(c),o(l,c)}}i.isExpanded.set(t.isExpanded&&!(!t.subLayerIds||!t.subLayerIds.length))},s=function(e){e&&i&&(e.unbindFromActiveTheme(),e.inActiveTheme.set(!0))};return e.includeInLayerList&&(a=new p.LayerListMapServiceItem(e.id,e,this),s(a)),e.serviceLayer instanceof esri.layers.GraphicsLayer&&1===e.layers.length?(a=this._handleGraphicsLayerItem(e,a),s(a&&a.children.length()?a.children.getAt(0):a)):e.layers.length&&(dojo.forEach(e.layers,function(e){if((e.includeInLayerList||e.isUserCreated)&&!e.processed){var t=new u.LayerListLayerItem(e.id,e,r);s(t),a?a.children.addItem(t):n.push(t),o(e,t)}}),a&&a.isExpanded.set(e.isExpanded&&!!e.layers.length)),a&&(n.push(a),t&&(a.parent=t)),n},t.prototype._handleGraphicsLayerItem=function(e,t){var i=t;if(e.layers[0].includeInLayerList||e.layers[0].isUserCreated){var r=e.layers[0],n=new h.LayerListGraphicsLayerItem(r.id,e.layers[0],this);n.isExpanded.set(r.isExpanded&&!(!r.subLayerIds||!r.subLayerIds.length)),i?(i.isVisible.set(n.isVisible.get()),n.isVisible.set(!0),n.canNotAssignVisibility.set(!0),i.children.addItem(n),i.isExpanded.set(e.isExpanded&&!!e.layers.length)):i=n}return i},t.prototype._createLayerListItemFromRestResult=function(e,t){var i=this,n=null,a=function(t){var i=t===c.LayerListItemType.MAPSERVICE?"MapService":t===c.LayerListItemType.LAYER?"Map Layer":"Object";console.error("Layer List Error: {0} with ID: {1} not available. Excluding from layer list. Please check your security settings.".format(i,e.mapServiceID))};switch(e.type){case"folder":n=new r.LayerListFolderItem(e.id,e.name,this),e.items&&e.items.length&&this._subItemIncludedInLayerList(e.items)||(n.displayItem.set(!1),n.isExpanded.set(!1)),this._userAddedLayersDestinationId&&e.id===this._userAddedLayersDestinationId&&(this._userAddedLayersFolder=n);break;case"mapService":var o=this.mapInfo.findMapServiceById(e.mapServiceID);o||a(c.LayerListItemType.MAPSERVICE),o&&o.includeInLayerList&&(n=new p.LayerListMapServiceItem(e.id,o,this));break;case"layer":var o=this.mapInfo.findMapServiceById(e.mapServiceID);if(o||a(c.LayerListItemType.MAPSERVICE),o){var s=o.findLayerById(e.layerID);s||a(c.LayerListItemType.LAYER),s&&s.includeInLayerList&&(n=o.serviceLayer instanceof esri.layers.GraphicsLayer?new h.LayerListGraphicsLayerItem(e.id,s,this):new u.LayerListLayerItem(e.id,s,this))}break;default:throw new Error("Unknown layer list item type. Reported type: {0}".format(e.type))}return n&&(t&&(n.parent=t),null!=e.items&&e.items.length&&dojo.forEach(e.items,function(e){var t=i._createLayerListItemFromRestResult(e,n);t&&n.children.addItem(t)}),this._processItem(n,e)),n},t.prototype._subItemIncludedInLayerList=function(e){for(var t=this,i=function(e){if("folder"===e.type)return!(!e.items||!e.items.length)&&t._subItemIncludedInLayerList(e.items);if("mapService"===e.type){var i=t.mapInfo.findMapServiceById(e.mapServiceID);return!!i&&!!i.includeInLayerList}if("layer"===e.type){var i=t.mapInfo.findMapServiceById(e.mapServiceID),r=i.findLayerById(e.layerID);return!!r&&!!r.includeInLayerList}},r=0;r<e.length;r++){var n=e[r];if(i(n))return!0}return!1},t.prototype._processItem=function(e,t){if(e.type===c.LayerListItemType.FOLDER){if(this.mapInfo.gcxMap&&t.themeSettings&&t.themeSettings.length)for(var i=0;i<t.themeSettings.length;i++){var r=t.themeSettings[i],n=this.mapInfo.gcxMap.layerThemesInfo.getTheme(r.themeID);if(n){var o=void 0!=r.visible?r.visible:t.isVisible;e.layerThemeSettings.push(new m.LayerThemeSetting(n,o))}}if(e.id.get()===this._userAddedLayersDestinationId)for(var s=0;s<this.mapInfo.gcxMap.layerThemesInfo.themes.length;s++){var l=this.mapInfo.gcxMap.layerThemesInfo.themes[s];e.layerThemeSettings.push(new m.LayerThemeSetting(l,(!0)))}e._deferredVisibilitySetting=t.isVisible,e.isVisible.set(t.isVisible),e.configuredVisible=t.isVisible,e.isExpanded.set(t.isExpanded&&!(!t.items||!t.items.length)),this._disableFolderIfParentTiled(e)}if(e.type===c.LayerListItemType.MAPSERVICE&&e.isExpanded.set(e.mapService.isExpanded),e.type===c.LayerListItemType.LAYER&&e.isExpanded.set(e.layer.isExpanded&&!(!e.layer.subLayerIds||!e.layer.subLayerIds.length)),e.type===c.LayerListItemType.FOLDER){var u=t.iconUri;u&&(this.mapInfo.gcxMap&&this.mapInfo.gcxMap.site&&(u=f.RestHelper.processClientSideTokens(this.mapInfo.gcxMap.site,u)),e.iconUri.set(u),e.iconTooltip.set(e.name.get()))}if(e.canDisplayItem.set(t.isVisibleInLayerList!==!1),t.layerVisibilityType===g.LayerVisibilityType.MutuallyExclusive&&t.items&&t.items.length>1)for(var d=a.alphaNumericToken(32),p=0;p<e.children.length();p++)e.children.getAt(p).isMutuallyExclusive.set(!0),e.children.getAt(p).hasRadioToggle.set(!0),e.children.getAt(p).radioGroup.set(d)},t.prototype._disableFolderIfParentTiled=function(e){for(var t=e.parent;t&&t.id!==this.id&&(t.type===c.LayerListItemType.MAPSERVICE||t.type===c.LayerListItemType.FOLDER);){if(t.type===c.LayerListItemType.FOLDER&&t.canNotAssignVisibility.get()||t.type===c.LayerListItemType.MAPSERVICE&&t.mapService.serviceType===y.MapServiceType.TILED){e.canNotAssignVisibility.set(!0);break}t=t.parent}},t.prototype._generateThemeSettingsForCoreFolder=function(e,t){if(void 0===t&&(t=!1),t){if(this.mapInfo.gcxMap&&this.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured)for(var i=this.mapInfo.gcxMap.layerThemesInfo.themes,r=0;r<i.length;r++)e.layerThemeSettings.push(new m.LayerThemeSetting(i[r],(!0)));return void e.inActiveTheme.set(!0)}for(var n={},r=0,a=e.children.length();r<a;r++){var o=e.children.getAt(r),s=null;switch(o.type){case c.LayerListItemType.FOLDER:s=o.layerThemeSettings;break;case c.LayerListItemType.MAPSERVICE:s=o.mapService.gcxMapService?o.mapService.gcxMapService.layerThemeSettings:null;break;case c.LayerListItemType.LAYER:case c.LayerListItemType.GRAPHICSLAYER:s=o.layer.gcxLayer?o.layer.gcxLayer.layerThemeSettings:null}if(s&&s.length)for(var l=0;l<s.length;l++){var u=s[l].theme.id;void 0==n[u]&&(e.layerThemeSettings.push(new m.LayerThemeSetting(s[l].theme,(!0))),n[u]=!0)}}},t.prototype._applyInitialLayerTheme=function(){this.mapInfo.gcxMap&&this.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured&&this.mapInfo.gcxMap.applyStartupTheme()},t.prototype._processEligibleSingleMapServiceFolders=function(){var e=this._handledMapServiceReferences.slice(0),t=this._getFoldersContainingSingleMapService();t=this._filterEligibleSingleMsFolders(t),t=this._selectDeepestLevelSingleMapServiceFolders(t);for(var i=0;i<t.length;i++){var r=t[i];r.containedMapServices[0].serviceLayer instanceof esri.layers.GraphicsLayer||e.indexOf(r.containedMapServices[0])!==-1||this._outOfFolderMapServiceReferences.indexOf(r.containedMapServices[0])!==-1||(r.linkWithMapService(r.containedMapServices[0]),e.push(r.containedMapServices[0]))}},t.prototype._setupOpacityBindingsForParentsOfHiddenItemsWithOpacityBindings=function(){var e=this.getDescendants();e=dojo.filter(e,function(e){return e.canAdjustOpacity.get()});for(var t=0;t<e.length;t++){var i=e[t];if(!this.isEffectivelyDisplayed(i)){for(var r=i.parent;r instanceof c.LayerListItem&&!this.isEffectivelyDisplayed(r);)r=r.parent;r instanceof c.LayerListItem&&r._setupOpacityBindings()}}},t.prototype.isEffectivelyDisplayed=function(e){return!!e.displayItem.get()&&(!(e.parent instanceof c.LayerListItem)||this.isEffectivelyDisplayed(e.parent))},t.prototype._getFoldersContainingSingleMapService=function(){for(var e=[],t=0;t<this._addedFolderReferences.length;t++)1===this._addedFolderReferences[t].containedMapServices.length&&e.push(this._addedFolderReferences[t]);return e},t.prototype._filterEligibleSingleMsFolders=function(e){var t=this;if(e){for(var i=[],r=this._filterTopLevelFolders(e),n=0;n<e.length;n++){var a=e[n],o=dojo.filter(this._addedFolderReferences,function(e){return e.id!==a.id&&e.containedMapServices.length>0&&e.containedMapServices.indexOf(a.containedMapServices[0])!==-1})||[],s=o.filter(function(e){return e.containedMapServices.length>1})||[];this._noChildItemsWithMapService(a.containedMapServices[0],s)&&this._allFoldersAncestorsOrDescendantsOf(a,o)&&(r.some(function(e){return e.containedMapServices[0]===a.containedMapServices[0]&&!t._allFoldersAncestorsOf(a,[e])&&a.id!==e.id})||i.push(a))}return i}},t.prototype._filterTopLevelFolders=function(e){return this.children.get().filter(function(t){return t.type===c.LayerListItemType.FOLDER&&e.indexOf(t)!==-1})},t.prototype._selectDeepestLevelSingleMapServiceFolders=function(e){if(e){for(var t=[],i=[],r=0;r<e.length;r++){var n=e[r];if(i.indexOf(n.containedMapServices[0])===-1){var a=dojo.filter(e,function(e){return e.id!==n.id&&e.containedMapServices.indexOf(n.containedMapServices[0])!==-1})||[];if(a.length){var o,s=n;for(o=0;o<a.length;o++){if(!this._onlyFolderItems(s.children.get())||!this._allFoldersDescendantsOf(s,a.slice(o))){s=o>=1?a[o-1]:s;break}if(s.children.length()>1)break;s=a[o]}this._allFoldersDescendantsOf(s,a.slice(o))&&(t.push(s),i.push(s.containedMapServices[0]))}else t.push(n),i.push(n.containedMapServices[0])}}return t}},t.prototype._allFoldersDescendantsOf=function(e,t){for(var i=0;i<t.length;i++){var r=t[i].getAncestors();if(!r||r.indexOf(e)===-1)return!1}return!0},t.prototype._allFoldersAncestorsOf=function(e,t){var i=e.getAncestors();if(i){for(var r=0;r<t.length;r++)if(i.indexOf(t[r])===-1)return!1;return!0}return!1},t.prototype._allFoldersAncestorsOrDescendantsOf=function(e,t){var i=Array.prototype.concat(e.getAncestors()||[],e.getDescendants()||[]);if(i){for(var r=0;r<t.length;r++)if(i.indexOf(t[r])===-1)return!1;return!0}return!1},t.prototype._noChildItemsWithMapService=function(e,t){for(var i=0;i<t.length;i++)for(var r=t[i].children.get(),n=0;n<r.length;n++)if(r[n].mapService&&r[n].mapService===e)return!1;return!0},t.prototype._onlyFolderItems=function(e){for(var t=0;t<e.length;t++)if(e[t].type!==c.LayerListItemType.FOLDER)return!1;return!0},t.prototype._processUnhandledMapServices=function(){var e=this,t=dojo.filter(this._allMapServiceReferences,function(t){return e._handledMapServiceReferences.indexOf(t)===-1});t.forEach(function(e){(e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer||e.serviceLayer instanceof esri.layers.WMSLayer)&&e.serviceLayer.on("visibility-change",function(t){t.visible?e._esriLayerStateBackup&&(e.serviceLayer.setVisibleLayers(e._esriLayerStateBackup),e._esriLayerStateBackup=null):e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer?(e._esriLayerStateBackup=e.serviceLayer.visibleLayers?e.serviceLayer.visibleLayers.slice(0):[-1],e.serviceLayer.setVisibleLayers(["-1"])):(e._esriLayerStateBackup=e.serviceLayer.visibleLayers?e.serviceLayer.visibleLayers.slice(0):[],e.serviceLayer.setVisibleLayers([]))})})},t.prototype._addItemsToUserAddedFolder=function(e,t){var i=this._userAddedLayersFolder||this;if(e[0].type===c.LayerListItemType.LAYER&&this.children.getLength()){var n=e[0].layer.gcxLayer;if(n&&n.catalogId)for(var a=this._addedFolderReferences,o=0;o<a.length;o++){var s=a[o];if(s.canAdjustOpacity&&s.mapService&&s.mapService.gcxMapService===n.mapService){i=s;break}}}var l=t||0,u=e.reduceRight(function(e,t,r){return i.children.validateAndInsertItem(l,t)&&e},!0);return i===this._userAddedLayersFolder?(this._userAddedLayersFolder.displayItem.set(!0),this._userAddedLayersFolder.isExpanded.set(!0),this._userAddedLayersFolder.isVisible.set(!0),this._userAddedLayersFolder.parent instanceof r.LayerListFolderItem&&this._userAddedLayersFolder.parent.refreshOnDemandItemCollection()):i instanceof r.LayerListFolderItem&&i.refreshOnDemandItemCollection(),this._applyDeferredItemVisibilities(i.children.get()),u},t.prototype._handleFilterChanged=function(e){var t=this;if(e.filterControlId===this._filterControlId){this._itemsExpandedByFilter&&this._itemsExpandedByFilter.length&&(this._itemsExpandedByFilter.forEach(function(e){return e.isExpanded.set(!1)}),this._itemsExpandedByFilter.length=0);var i=function(e){for(var i=e.parent;i;){var r=t.filterControlComponent.getFilterableItem(i);!i.isExpanded||i.isExpanded.get()&&r.queryMatched||(r.queryMatched=!0,i.updateDisplayItem(),i.isExpanded.get()||(i.isExpanded.set(!0),t._itemsExpandedByFilter.push(i))),i=i.parent}};e.filterableItems.forEach(function(e){var t=e.item;t.updateDisplayItem(),e.filterQuery&&e.queryMatched&&i(t),t.refreshOnDemandItemCollection()})}},t}(i.LayerListNode);t.LayerList=v})},"geocortex/infrastructure/layerselector/LayerSelectorItem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerselector/LayerSelectorLayerItem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerselector/LayerSelectorServiceLayerItem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerselector/LayerSelectorFolderItem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerselector/LayerSelectorConfiguration":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/layerselector/LayerSelector":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/gis/ServiceLayerInfo","geocortex/infrastructure/gis/LayerInfo","geocortex/framework/utils/utils"],function(e,t,i,r,n,a){"use strict";var o=function(){function e(e,t){this.filteredLayerSelectorLayerItems=[],this.unfilteredLayerSelectorLayerItems=[],this.itemTypes={FOLDER:"folder",LAYER:"layer",SERVICELAYER:"serviceLayer"},this._infrastructureLibraryId="Mapping.Infrastructure",this._unfilteredItems=[],this._userAddedLayersFolder=null,this.appInfo=e,t&&(t.layerFilter&&dojo.isFunction(t.layerFilter)&&(this.layerFilter=t.layerFilter),t.layerStateChangeHandler&&dojo.isFunction(t.layerStateChangeHandler)&&(this.layerStateChangeHandler=t.layerStateChangeHandler),t.enableAllLayersHandler&&dojo.isFunction(t.enableAllLayersHandler)&&(this.enableAllLayersHandler=t.enableAllLayersHandler),t.disableAllLayersHandler&&dojo.isFunction(t.disableAllLayersHandler)&&(this.disableAllLayersHandler=t.disableAllLayersHandler),t.onInitializedHandler&&dojo.isFunction(t.onInitializedHandler)&&(this.onInitializedHandler=t.onInitializedHandler),t.onLayerSelectorFolderItemCreated&&dojo.isFunction(t.onLayerSelectorFolderItemCreated)&&(this.onLayerSelectorFolderItemCreated=t.onLayerSelectorFolderItemCreated),t.onLayerSelectorLayerItemCreated&&dojo.isFunction(t.onLayerSelectorLayerItemCreated)&&(this.onLayerSelectorLayerItemCreated=t.onLayerSelectorLayerItemCreated),t.onLayerSelectorServiceLayerItemCreated&&dojo.isFunction(t.onLayerSelectorServiceLayerItemCreated)&&(this.onLayerSelectorServiceLayerItemCreated=t.onLayerSelectorServiceLayerItemCreated)),this.items=new i.ObservableCollection,this.initialized=!1,this._suspendLayerStateChangeHandler=!1,this.initialize()}return e.prototype.initialize=function(){this._loadLayerSelectorItems(),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),this.setEnableAllLayersHandler(this.enableAllLayersHandler),this.setDisableAllLayersHandler(this.disableAllLayersHandler),this.onInitializedHandler&&!this.initialized&&this.onInitializedHandler(this),this.initialized=!0},e.prototype.applyFilter=function(e){var t=this;if(this.layerFilter=e&&dojo.isFunction(e)?e:null,this.items.clear(),this.filteredLayerSelectorLayerItems=[],!this.layerFilter)return this.items.set(this._unfilteredItems),void(this.filteredLayerSelectorLayerItems=this.unfilteredLayerSelectorLayerItems.slice(0));var i=function(e){var r=null;return e.itemType===t.itemTypes.FOLDER?(r=t._generateItemCloneForFilter(e),e.items.get().forEach(function(e){var t=i(e);t&&(!t.isFolder||t.isFolder&&t.items.length())&&r.items.addItem(t)}),r):(e.itemType===t.itemTypes.SERVICELAYER&&e.items.getLength()>0?(t.layerFilter(e)?(r=t._generateItemCloneForFilter(e),t.filteredLayerSelectorLayerItems.push(r)):r=t._creatFolderItemFromServiceLayer(e,!0,!0),e.items.get().forEach(function(e){var t=i(e);t&&(!t.isFolder||t.isFolder&&t.items.length())&&r.items.addItem(t)})):t.layerFilter(e)&&(r=e,t.filteredLayerSelectorLayerItems.push(r)),r)};this._unfilteredItems.forEach(function(e){var r=i(e);r&&(!r.isFolder||r.isFolder&&r.items.length())&&t.items.addItem(r)})},e.prototype.reapplyFilter=function(){this.applyFilter(this.layerFilter)},e.prototype.setLayerStateChangeHandler=function(e){var t=this,i=function(){t.unfilteredLayerSelectorLayerItems.forEach(function(e){e._isEnabledBindingToken&&(e.isEnabled.unbind(e._isEnabledBindingToken),delete e._isEnabledBindingToken)})};i(),this.layerStateChangeHandler=e&&dojo.isFunction(e)?e:null,this.layerStateChangeHandler&&this.unfilteredLayerSelectorLayerItems.forEach(function(e){e._isEnabledBindingToken=e.isEnabled.bind(t,function(){t._suspendLayerStateChangeHandler||t.layerStateChangeHandler(e)})})},e.prototype.setEnableAllLayersHandler=function(e){this.enableAllLayersHandler=e&&dojo.isFunction(e)?e:null},e.prototype.setDisableAllLayersHandler=function(e){this.disableAllLayersHandler=e&&dojo.isFunction(e)?e:null},e.prototype.enableAllLayers=function(){this._suspendLayerStateChangeHandler=!0,this.filteredLayerSelectorLayerItems.forEach(function(e){return e.isEnabled.set(!0)}),this._suspendLayerStateChangeHandler=!1,this.enableAllLayersHandler&&this.enableAllLayersHandler()},e.prototype.disableAllLayers=function(){this._suspendLayerStateChangeHandler=!0,this.filteredLayerSelectorLayerItems.forEach(function(e){return e.isEnabled.set(!1)}),this._suspendLayerStateChangeHandler=!1,this.disableAllLayersHandler&&this.disableAllLayersHandler()},e.prototype.addUserAddedServiceLayer=function(e){var t=this;if(e instanceof r.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;var i=this.unfilteredLayerSelectorLayerItems.filter(function(t){return t.serviceLayer&&t.serviceLayer.gcxMapService===e});if(i.length)return!1;var a=r.ServiceLayerInfo.fromGcxMapService(e),o=this._createServiceLayerItemFromServiceLayer(a,!0,!0);return this.unfilteredLayerSelectorLayerItems.push(o),e.layers.forEach(function(e){var i=t.unfilteredLayerSelectorLayerItems.filter(function(t){return t.layer&&t.layer.gcxLayer===e});if(i.length)return!1;var r=a.findLayerById(e.id);r||(r=n.LayerInfo.fromGcxLayer(e),r.serviceLayerInfo=a,a.layers.push(r));var s=t._createLayerItemFromLayer(r,!0,!0);s&&(o.items.addItem(s),t.unfilteredLayerSelectorLayerItems.push(s))}),this._unfilteredItems.push(o),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},e.prototype.removeServiceLayer=function(e){var t=this;if(e instanceof r.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;var i=this.unfilteredLayerSelectorLayerItems.filter(function(t){return t.serviceLayer&&t.serviceLayer.gcxMapService===e});return i.length&&i.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)}),e.layers.forEach(function(e){var i=t.unfilteredLayerSelectorLayerItems.filter(function(t){return t.layer&&t.layer.gcxLayer===e});return!!i.length&&void i.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)})}),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},e.prototype.updateServiceLayer=function(e,t,i){var o=this;if(t=t||[],i=i||[],e instanceof r.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;for(var s=r.ServiceLayerInfo.fromGcxMapService(e),l=0;i&&l<i.length;l++){var c=i[l],u=this.unfilteredLayerSelectorLayerItems.filter(function(e){return e.layer&&e.layer.gcxLayer===c});u.length&&u.forEach(function(e){return o._removeItemFromUnfilteredCollections(e)})}if(!this._userAddedLayersFolder){var d={id:a.alphaNumericToken()+":UserAdded",name:this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerlist-user-added-layers-folder-title"),isExpanded:!0,isVisible:!0,items:[],canToggleVisibility:null,iconUri:null,isVisibleInLayerList:null,layerID:null,mapServiceID:null,layerVisibilityType:null,themeSettings:null,type:null};this._userAddedLayersFolder=this._createFolderItemFromRestItem(d,!0,!0)}for(var p=0;t&&p<t.length;p++){var c=t[p],u=this.unfilteredLayerSelectorLayerItems.filter(function(e){return e.layer&&e.layer.gcxLayer===c});if(!u.length){var h=s.findLayerById(c.id);h||(h=n.LayerInfo.fromGcxLayer(c),h.serviceLayerInfo=s,s.layers.push(h));var m=this._createLayerItemFromLayer(h,!0,!0);m&&(this._userAddedLayersFolder.items.addItem(m),this.unfilteredLayerSelectorLayerItems.push(m))}}return this._userAddedLayersFolder&&this._userAddedLayersFolder.items.length()>0&&this._unfilteredItems.indexOf(this._userAddedLayersFolder)<0&&this._unfilteredItems.unshift(this._userAddedLayersFolder),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},e.prototype._removeItemFromUnfilteredCollections=function(e){var t=this;if(e){var i=[],r=function(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)},n=function(e,t){for(var a=e.length-1;a>=0;a--){var o=e[a];o===t?e.splice(a,1):o.isFolder&&o.items.length()&&(r(o.items.get(),t),o.items.pulse(),n(o.items.get(),t),0===o.items.length()&&i.push(o))}};e.isFolder||r(this.unfilteredLayerSelectorLayerItems,e),n(this._unfilteredItems,e),i.length&&i.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)})}},e.prototype._loadLayerSelectorItems=function(){var e=this,t=this.appInfo.gcxApp.site.layerListRestEndpoint,i=this.appInfo.mapInfo;this._unfilteredItems=[],this.unfilteredLayerSelectorLayerItems=[];var r=function(t){var n,a=void 0==t.isExpanded||t.isExpanded;switch(t.type){
case"folder":n=e._createFolderItemFromRestItem(t,!0,a);break;case"mapService":var o=i.findMapServiceById(t.mapServiceID);n=e._createServiceLayerItemFromServiceLayer(o,!0,a),e.unfilteredLayerSelectorLayerItems.push(n);break;case"layer":var o=i.findMapServiceById(t.mapServiceID),s=o&&o.findLayerById(t.layerID);n=e._createLayerItemFromLayer(s,!0,a),e.unfilteredLayerSelectorLayerItems.push(n)}if(n&&t.items)for(var l=0;l<t.items.length;l++){var c=r(t.items[l]);c&&n.items.addItem(c)}return"folder"===t.type&&n&&0===n.items.getLength()?null:n};t.items&&t.items.length&&t.items.forEach(function(t){var i=r(t);i&&e._unfilteredItems.push(i)}),this._loadSelectorItemsNotInLayerList()},e.prototype._loadSelectorItemsNotInLayerList=function(){for(var e=0;e<this.appInfo.mapInfo.serviceLayers.length;e++){var t=null,i=this.appInfo.mapInfo.serviceLayers[e];i&&!i.includeInLayerList&&(t=this._createServiceLayerItemFromServiceLayer(i,!0,!0),this._unfilteredItems.push(t),this.unfilteredLayerSelectorLayerItems.push(t));for(var r=0;r<i.layers.length;r++){var n=i.layers[r];if(!(!n||n&&n.includeInLayerList)){var a=this._createLayerItemFromLayer(n,!0,!0);t&&a?(t.items.addItem(a),this.unfilteredLayerSelectorLayerItems.push(a)):null==t&&a&&(this._unfilteredItems.push(a),this.unfilteredLayerSelectorLayerItems.push(a))}}}},e.prototype._createFolderItemFromRestItem=function(e,t,r){if(!e)return null;var n={};return n.itemType=this.itemTypes.FOLDER,n.name=new i.Observable(e.name||"Layers"),n.isFolder=!0,n.isEnabled=new i.Observable((!!t)),n.isExpanded=new i.Observable((!!r)),n.iconUri=new i.Observable(""),n.items=new i.ObservableCollection,this._setTooltips(n),this.onLayerSelectorFolderItemCreated&&this.onLayerSelectorFolderItemCreated(n),n},e.prototype._creatFolderItemFromServiceLayer=function(e,t,r){var n={};return n.itemType=this.itemTypes.FOLDER,n.name=new i.Observable(e.name.get()||"Layers"),n.isFolder=!0,n.isEnabled=new i.Observable((!!t)),n.isExpanded=new i.Observable((!!r)),n.iconUri=new i.Observable(e.iconUri.get()||""),n.items=new i.ObservableCollection,this._setTooltips(n),this.onLayerSelectorFolderItemCreated&&this.onLayerSelectorFolderItemCreated(n),n},e.prototype._createLayerItemFromLayer=function(e,t,r){if(!e)return null;var n={};return n.itemType=this.itemTypes.LAYER,n.isEnabled=new i.Observable((!!t)),n.isExpanded=new i.Observable((!!r)),n.name=new i.Observable(e.gcxLayer.displayName),n.isFolder=!1,n.iconUri=new i.Observable(e.gcxLayer.iconUri),n.layer=e,n.items=new i.ObservableCollection([]),this._setTooltips(n),this.onLayerSelectorLayerItemCreated&&this.onLayerSelectorLayerItemCreated(n),n},e.prototype._createServiceLayerItemFromServiceLayer=function(e,t,r){if(!e)return null;var n={};return n.itemType=this.itemTypes.SERVICELAYER,n.isEnabled=new i.Observable((!!t)),n.isExpanded=new i.Observable((!!r)),n.name=new i.Observable(e.gcxMapService.displayName),n.isFolder=!1,n.iconUri=new i.Observable(e.gcxMapService.iconUri),n.serviceLayer=e,n.items=new i.ObservableCollection([]),this._setTooltips(n),this.onLayerSelectorServiceLayerItemCreated&&this.onLayerSelectorServiceLayerItemCreated(n),n},e.prototype._generateItemCloneForFilter=function(e){var t=dojo.mixin({},e);return t.isEnabled=new i.Observable((!0)),t.items=new i.ObservableCollection,void 0!=e.serviceLayer&&(t.serviceLayer=e.serviceLayer),t},e.prototype._setTooltips=function(e){var t=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-item-expand").format(e.name.get()),r=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-state-toggle").format(e.name.get()),n=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-icon-tooltip").format(e.name.get());e.expanderTooltip=new i.Observable(t),e.stateToggleTooltip=new i.Observable(r),e.iconTooltip=new i.Observable(n)},e}();t.LayerSelector=o})},"geocortex/infrastructure/layerselector/LayerSelectorViewModelBase":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/gis/AppInfo","geocortex/infrastructure/layerselector/LayerSelector","geocortex/framework/observables"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._layerSelectorInitialized=new a.Observable((!1)),r.selectAllButtonText=new a.Observable(r.app.getResource(i,"language-layer-selector-default-select-all-text")),r.clearAllButtonText=new a.Observable(r.app.getResource(i,"language-layer-selector-default-clear-all-text")),r.selectAllButtonTitle=new a.Observable(r.app.getResource(i,"language-layer-selector-default-select-all-tooltip")),r.clearAllButtonTitle=new a.Observable(r.app.getResource(i,"language-layer-selector-default-clear-all-tooltip")),r.items=new a.ObservableCollection([]),r}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this._subscribeEvents(),this.app.site&&this.app.site.isInitialized?this._setupLayerSelector():this.app.event("SiteInitializedEvent").once(this,this._setupLayerSelector)},t.prototype.onInitialized=function(e){},t.prototype.onLayerSelectorFolderItemCreated=function(e){},t.prototype.onLayerSelectorLayerItemCreated=function(e){},t.prototype.onLayerSelectorServiceLayerItemCreated=function(e){},t.prototype.filter=function(e){return!0},t.prototype.handleLayerStateChange=function(e){},t.prototype.handleAllLayersEnabled=function(){},t.prototype.handleAllLayersDisabled=function(){},t.prototype.getAllItems=function(){return t._expandItems(this.items.get())},t._expandItems=function(e){return e.concat.apply(e,e.map(function(e){return t._expandItems(e.items.get())}))},t.prototype._setupLayerSelector=function(){var e=this;this.appInfo=r.AppInfo.fromGeocortexApp(this.app);var t={onInitializedHandler:function(t){return e.onInitialized(t)},layerFilter:function(t){return e.filter(t)},layerStateChangeHandler:function(t){return e.handleLayerStateChange(t)},enableAllLayersHandler:function(){return e.handleAllLayersEnabled()},disableAllLayersHandler:function(){return e.handleAllLayersDisabled()},onLayerSelectorFolderItemCreated:function(t){return e.onLayerSelectorFolderItemCreated(t)},onLayerSelectorLayerItemCreated:function(t){return e.onLayerSelectorLayerItemCreated(t)},onLayerSelectorServiceLayerItemCreated:function(t){return e.onLayerSelectorServiceLayerItemCreated(t)}};this.layerSelector=new n.LayerSelector(this.appInfo,t),this._layerSelectorInitialized.set(!0),this.items.sync(this.layerSelector.items),this.items.pulse()},t.prototype._subscribeEvents=function(){this.app.event("MapServiceAddedEvent").subscribe(this,this._handleMapServicesAdded),this.app.event("MapServiceRemovedEvent").subscribe(this,this._handleMapServiceRemoved),this.app.event("MapServiceLayersChangedWithResultEvent").subscribe(this,this._handleMapServiceLayersChanged)},t.prototype._handleMapServicesAdded=function(e){var t=this;this._waitUntilLayerSelectorInitialized().then(function(){t.layerSelector.addUserAddedServiceLayer(e)})},t.prototype._handleMapServiceRemoved=function(e){var t=this;this._waitUntilLayerSelectorInitialized().then(function(){t.layerSelector.removeServiceLayer(e)})},t.prototype._handleMapServiceLayersChanged=function(e){var t=this;this._waitUntilLayerSelectorInitialized().then(function(){e&&t.layerSelector.updateServiceLayer(e.mapService,e.newItems,e.oldItems)})},t.prototype._waitUntilLayerSelectorInitialized=function(){var e=this;return new Promise(function(t,i){e._layerSelectorInitialized.get()?t():e._layerSelectorInitialized.once(e,function(){return t()})})},t}(i.ViewModelBase);t.LayerSelectorViewModelBase=o})},"geocortex/infrastructure/layerselector/LayerSelectorViewBase":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.selectAllLayers=function(e,t,i){this.viewModel.layerSelector.enableAllLayers()},t.prototype.clearAllLayers=function(e,t,i){this.viewModel.layerSelector.disableAllLayers()},t.prototype.handleExpanderClick=function(e,t,i){i.isExpanded.set(!i.isExpanded.get())},t}(i.ViewBase);t.LayerSelectorViewBase=r})},"geocortex/infrastructure/project/CoordinateSystem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/results/ResultsState":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/results/ResultsModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/validation/NumberValidator","geocortex/infrastructure/PromiseUtils","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/geocortex","geocortex/infrastructure/FeatureSet","geocortex/essentials/Field","geocortex/infrastructure/FormatUtils"],function(e,t,i,r,n,a,o,s,l,c,u){"use strict";var d=function(){function e(){}return e.prototype.toJSONString=function(){return JSON.stringify({name:this.name,featureSet:this.featureSet.toJson()})},e}(),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._supportedFormats=["csv","xlsx","shp"],t._showInvisibleAttributes=!1,t._enableDataLinkObjectIdFieldOnExport=!0,t._featureIndexName="GCX_OID",t._featureIndexRoundUpPerFeatureSet=1e3,t._includeDataLinksOnExport=!0,t}return __extends(t,e),t.prototype.initialize=function(t){var i=this;e.prototype.initialize.call(this,t),t&&(this.resultMappings=t.resultMappings,t.customSearchSuggestions&&this.app.featureSetManager.addSearchSuggestions(t.customSearchSuggestions),t.showInvisibleAttributesOnExport&&(this._showInvisibleAttributes=t.showInvisibleAttributesOnExport),void 0!==t.includeDataLinksOnExport&&null!==t.includeDataLinksOnExport&&(this._includeDataLinksOnExport=!!t.includeDataLinksOnExport),void 0!==t.enableDataLinkObjectIdFieldOnExport&&null!==t.enableDataLinkObjectIdFieldOnExport&&(this._enableDataLinkObjectIdFieldOnExport=!!t.enableDataLinkObjectIdFieldOnExport),"string"==typeof t.gcxObjectIdFieldNameOnExport&&""!==t.gcxObjectIdFieldNameOnExport&&(this._featureIndexName=t.gcxObjectIdFieldNameOnExport.trim())),this.wireUpResultMapping(),this.app.command("ExportResultsTo").register(this,function(e){var t="csv";if(e.fsc instanceof l.FeatureSet){var n=new r.FeatureSetCollection;n.featureSets.addItem(e.fsc),e.fsc=n}e.fsc?(e.format?i._supportedFormats.indexOf(e.format)===-1?i.app.trace.warning("ExportResultsTo: {0} file format not recognized. Defaulting to csv.".format(e.format)):t=e.format:i.app.trace.warning("ExportResultsTo: file format not specified. Defaulting to csv."),i.exportTo({fsc:e.fsc,format:t})):i.app.trace.error("ExportResultsTo: Cannot export, no feature set collection specified.")},this.exportToCanExecute)},t.prototype.getStateFilter=function(){var e=this,t=new n.NumberValidator;return function(i){var r={};return r.serialVersion=!0,r.featureSetCollections={item:e.app.project.filter.featureSetCollection},r.results=e.app.project.filter.featureSetCollection,r.viewMode=!0,r.page=t,r.tableOptions={sortColumn:t,sortDirection:!0},2==i.serialVersion?r.openedFeatureSet=e.app.project.filter.featureSet:r.tableOptions.selectedFeatureSet=e.app.project.filter.featureSet,r}},t.prototype.exportState=function(){var e=this,t={featureSetCollections:this.app.featureSetManager.featureSetCollections.get().map(function(t){return e.app.project.convert.fromGcxFeatureSetCollection(t)})};return Promise["try"](function(){return e.app.command("_ExportResultsViewState").execute(t),t.serialVersion=2,t})},t.prototype.applyState=function(e){var t=this;return a.PromiseUtils.mapSkipRejected(e.featureSetCollections,function(e){return t.app.project.convert.toGcxFeatureSetCollection(e)}).then(function(){return t.app.waitUntilAllLibrariesLoaded()}).then(function(){var i={state:e,promises:[]};return t.app.command("_ClearIsSelected").execute(),t.app.command("_ApplyResultsViewState").execute(i),Promise.all(i.promises)["return"]()})},t.prototype.wireUpResultMapping=function(){this.app.event("FSMCollectionOpenedEvent").subscribe(this,this.fsmCollectionOpenedHandler),this.app.command("_setResultMappingCommand").register(this,this.fsmCollectionSetCommand),this.app.command("FSMCollectionSetCommand").register(this,this.fsmCollectionSetCommand)},t.prototype.fsmCollectionOpenedHandler=function(e){var t=e.featureSetCollection;if(this.resultMappings){var i=this.resultMappings[t.sourceName];if(i)for(var r=0;r<i.length;r++){var n=i[r];this.app.command(n).execute(t.id),this._lastCommand=n}}},t.prototype.fsmCollectionSetCommand=function(e,t){if(t){var i=null;if("ShowResultsList"===t?i="ShowResultsTable":"ShowResultsTable"===t&&(i="ShowResultsList"),i&&this.resultMappings&&this.resultMappings[e]){var r=this.resultMappings[e],n=r.indexOf(i);n>-1?r[n]=t:r.indexOf(t)===-1&&r.push(t)}}},t.prototype.exportTo=function(e){var t=this,i=new o.AddStatusArgs(this.app.getResource(this.libraryId,"language-results-export-to-status-message").format(e.format)),r="exportTo "+e.format+"StatusMessage";i.id=r,i.showBusyIcon=!0,this.app.command("AddStatus").execute(i);var n=this.app.site.url,a=n.substring(0,n.toLowerCase().lastIndexOf("/sites/")),l=a+"/Utilities/Extract";this.fscToJson(e.fsc,this._includeDataLinksOnExport).then(function(i){s.request({url:l,content:{format:e.format,featureSets:i,f:"json"},load:dojo.hitch(t,function(i){return t.exportToSuccess(i,e.format)}),error:dojo.hitch(t,function(i){return t.exportToError(i,r,e.format)})})},function(i){t.exportToError(i,r,e.format)})},t.prototype.exportToSuccess=function(e,t){var i=this;if(e&&e.hasOwnProperty("href")){var r=e.href,n=this.app.getResource(this.libraryId,"language-results-export-to-confirm-content").format(t),a=this.app.getResource(this.libraryId,"language-results-export-to-confirm-title").format(t),o="exportTo "+t+"StatusMessage";this.app.command("RemoveStatus").execute(o),this.app.commandRegistry.command("Confirm").execute(n,a,function(e){e&&(i.app.isNative.get()?window.open(r,"_blank"):window.location.assign(r))})}},t.prototype.exportToError=function(e,t,i){this.app.command("RemoveStatus").execute(t),this.app.commandRegistry.command("Alert").execute(e.message,this.app.getResource(this.libraryId,"language-results-export-to-alert-error-message").format(i))},t.prototype.exportToCanExecute=function(e){var t=null;if(e)if(e instanceof r.FeatureSetCollection)t=e;else if(e.fsc&&e.fsc instanceof r.FeatureSetCollection)t=e.fsc;else if(e instanceof l.FeatureSet){var i=new r.FeatureSetCollection;i.featureSets.addItem(e),t=i}else if(e.fsc instanceof l.FeatureSet){var i=new r.FeatureSetCollection;i.featureSets.addItem(e.fsc),t=i}return t&&t.featureSets.get()&&t.featureSets.get().length>0},t.prototype.getFields=function(e){var t=[];return e.esriFeatureSet&&e.esriFeatureSet.features&&e.esriFeatureSet.features.length>0&&(t=this.getFieldsFromEsriLayer(e.esriFeatureSet.features[0].getLayer(),e)),0===t.length&&(e.layer&&e.layer.fields&&e.layer.fields.length>0?t=this.getFieldsFromEssentialsLayer(e.layer):e.attributes.get()&&e.attributes.get().length>0?t=this.getFieldsFromGcxFeatureSetAttributes(e.attributes.get(),e):e.features.get()&&e.features.get().length>0&&e.features.getAt(0).attributes.get()&&e.features.getAt(0).attributes.get().length>0?t=this.getFieldsFromGcxFeatureAttributes(e.features.getAt(0).attributes.get(),e):e.esriFeatureSet&&e.esriFeatureSet.features&&e.esriFeatureSet.features.length>0&&e.esriFeatureSet.features[0].attributes&&e.esriFeatureSet.features[0].attributes.length>0?t=this.getFieldsFromEsriFeatureAttributeValues(e.esriFeatureSet.features):e.features.get()&&e.features.get().length>0&&e.features.getAt(0).attributes.get()&&e.features.getAt(0).attributes.get().length>0&&(t=this.getFieldsFromGcxFeatureAttributeValues(e.features.get()))),t},t.prototype.getFieldsFromEsriLayer=function(e,t){var i=[];if(e&&e.fields&&(i=e.fields.slice(0),t&&t.features.get()&&t.features.getAt(0).attributes.get())){var r=t.features.getAt(0).attributes.get();r.length===i.length&&r.forEach(function(e,t){i[t].alias=e.displayName.get()?e.displayName.get():i[t].alias})}return i},t.prototype.getFieldsFromEssentialsLayer=function(e){var t=[],i=new esri.layers.Field;return e.fields.forEach(function(e){i=new esri.layers.Field,i.name=e.name,i.alias=e.displayName,i.type=c.Field.convertToEsriFieldType(e.dataType),t.push(i)}),t},t.prototype.getFieldsFromGcxFeatureSetAttributes=function(e,t){var i=this,r=[],n=new esri.layers.Field;return e.forEach(function(e,a){n=new esri.layers.Field,n.name=e.name.get(),n.alias=e.displayName.get(),e.type.get()?n.type=c.Field.convertToEsriFieldType(e.type.get()):t.features.get().length>0&&t.features.getAt(0).attributes.get()&&t.features.getAt(0).attributes.get().length>0?n.type=i.getTypeFromGcxFeatures(t.features.get(),a):n.type=i.getEsriTypeFromValue(null),r.push(n)}),r},t.prototype.getFieldsFromGcxFeatureAttributes=function(e,t){var i=this,r=[],n=new esri.layers.Field;return e.forEach(function(e,a){n=new esri.layers.Field,n.name=e.name.get(),n.alias=e.displayName.get(),e.type.get()?n.type=c.Field.convertToEsriFieldType(e.type.get()):n.type=i.getTypeFromGcxFeatures(t.features.get(),a),r.push(n)}),r},t.prototype.getFieldsFromEsriFeatureAttributeValues=function(e){var t=0,i=[],r=new esri.layers.Field,n=e[0].attributes,e=e;for(var a in n)n.hasOwnProperty(a)&&(r=new esri.layers.Field,r.name=a,r.alias=a,r.type=this.getTypeFromEsriFeatures(e,t),i.push(r),t++);return i},t.prototype.getFieldsFromGcxFeatureAttributeValues=function(e){var t=0,i=[],r=new esri.layers.Field,n=e[0].attributes.get(),e=e;for(var a in n)n.hasOwnProperty(a)&&(r=new esri.layers.Field,r.name=a,r.alias=a,r.type=this.getTypeFromGcxFeatures(e,t),i.push(r),t++);return i},t.prototype.getTypeFromEsriFeatures=function(e,t){var i=this,r=this.getEsriTypeFromValue(null);return e.forEach(function(e){var n=e.attributes[t];n&&(r=i.getEsriTypeFromValue(n))}),r},t.prototype.getTypeFromGcxFeatures=function(e,t){var i=this,r=this.getEsriTypeFromValue(null);return e.forEach(function(e){var n=e.attributes.getAt(t).value.get();n&&(r=i.getEsriTypeFromValue(n))}),r},t.prototype.getEsriTypeFromValue=function(e){var t="esriFieldTypeString";return"number"==typeof e?t="esriFieldTypeDouble":e instanceof Date&&(t="esriFieldTypeDate"),t},t.prototype._getDataLinksAsFscItems=function(e){var t=this;return new Promise(function(i,r){if(!e.layer||!e.layer.hasDataLinks||!e.layer.dataLinks.some(function(e){return!e.isOneToOne}))return void r(new Error("This feature set either does not contain data links or only contains one-to-one datalinks."));var n=[],a=function(e){if(!e||!e.dataLink||!e.dataLink.get()||e.dataLink.get().isOneToOne)return null;var i=n.filter(function(t){return t.name===e.dataLink.get().displayName})[0];if(i)return i;var r=t._enableDataLinkObjectIdFieldOnExport?t._featureIndexName:null;return t._generateFscCollItem(e.dataLink.get().displayName,e.table.get(),n,r)},o=function(e){e.features.get().forEach(function(e,i){for(var r=e.dataLinkingResults.get(),o=function(){var i=r[s],o=a(i);if(o&&i.dataLink&&i.dataLink.get()&&!i.dataLink.get().isOneToOne){var l=i.table.get();l.rows.forEach(function(i){var r={},a=0;void 0!==e[t._featureIndexName]&&null!==e[t._featureIndexName]&&(r[t._getFieldName(t._featureIndexName)]=e[t._featureIndexName],a=1);var d=i.row;l.columns.forEach(function(e,i){var o=t._getFieldName(e),l=u.format(d[i]),p=n[s].featureSet.fields;if(p&&p[i+a]){var h=p[i+a].type;h===c.EsriFieldTypes.esriFieldTypeDouble?r[o]=u.parseNumber(l):h===c.EsriFieldTypes.esriFieldTypeDate?r[o]=u.parseUtcDate(l):r[o]=l}});var p=new esri.Graphic(null,null,r,null);o.featureSet.features.push(p)})}},s=0;s<r.length;s++)o()}),i(n)};e.dataLinksResolved.get()===!0?o(e):(t.app.trace.info("Waiting for feature set {0} datalinks to resolve before processing export command.".format(e.displayName.get()?"("+e.displayName.get()+")":"")),e.doWhenDataLinkingCompleted(o),e.dataLinksState===l.DataLinksState.Unresolved&&e.resolveDataLinks(null,!0,null,null,function(e,t){r(new Error("Error resolving datalinks for feature set {0} while processing export command.".format(e&&e.displayName.get()?"("+e.displayName.get()+")":"")))}))})},t.prototype._generateFscCollItem=function(e,t,i,r){var n=this,a=t.columns,o=t.rows[0].row,s=new d;s.name=e,s.featureSet=new esri.tasks.FeatureSet;var l=[];if(r){var c=new esri.layers.Field;c.name=this._getFieldName(r),c.alias=r,c.type="esriFieldTypeDouble",l.push(c)}a.forEach(function(e,t){var i=new esri.layers.Field;i.name=n._getFieldName(e),i.alias=e,i.type=n.getEsriTypeFromValue(o[t]),l.push(i)}),s.featureSet.fields=l,s.featureSet.displayFieldName=this._getFieldName(a[0]);var u=0;return i.forEach(function(e){s.name===e.name&&(u+=1)}),u>0&&(s.name=s.name+u),i.push(s),s},t.prototype._getFieldName=function(e){return e.toUpperCase().replace(/ /g,"_").trim()},t.prototype.getFeatureSets=function(e,t){var i=this;return void 0===t&&(t=!1),new Promise(function(n,a){if(!(e&&e instanceof r.FeatureSetCollection))return void a(new Error("ResultsModule: getFeatureSets error. Invalid input arguments."));var o=new esri.tasks.FeatureSet,s=new esri.Graphic,l=[],p=e.featureSets.get().filter(function(e){return!!e.layer&&e.layer.hasDataLinks&&e.layer.dataLinks.some(function(e){return!e.isOneToOne})}).length,h=0,m=0,f=function(){t&&h!==p||n(l)};e.featureSets.get().forEach(function(r,n){var a=i.getFields(r);o=new esri.tasks.FeatureSet;var p=!1,g=!!r.layer&&r.layer.hasDataLinks&&r.layer.dataLinks.some(function(e){return!e.isOneToOne});if(r&&r.features.get()&&r.features.get().length>0){var y=[],b=[];r.features.getAt(0).attributes.get().forEach(function(e){var t=e.visible.get()||i._showInvisibleAttributes;t?y.push(e.name.get()):b.push(e.name.get())}),p=y.some(function(e){return e===i._featureIndexName}),r.features.get().forEach(function(e,n){var l={},d=e.esriFeature.get().attributes;e.getAttributes().forEach(function(e){var t=e.visible.get()||i._showInvisibleAttributes;if(t){var r,n=e.name.get(),o=e.presentableValue.get();for(var s in a){var p=a[s];if(p.name===e.name.get()){r=p.type;var h=a.filter(function(e){return e.name.indexOf(".Name()",e.name.length-".Name()".length)!==-1&&e.name.substr(0,e.name.length-".Name()".length)===p.name});if(h&&h.length>0){var m=h[0].name;if(m&&d&&d.hasOwnProperty(m)){var f=d[p.name],g=f;f=o,o=g,l[m]=f}}break}}o&&n&&(p&&p.domain&&"codedValue"==p.domain.type?(p.type=c.EsriFieldTypes.esriFieldTypeString,l[n]=e.presentableValue.get()):!p||p.type!==c.EsriFieldTypes.esriFieldTypeDouble&&p.type!==c.EsriFieldTypes.esriFieldTypeSingle?r===c.EsriFieldTypes.esriFieldTypeInteger||p&&p.type===c.EsriFieldTypes.esriFieldTypeSmallInteger?l[n]=Math.floor(u.parseNumber(e.value.get())):r===c.EsriFieldTypes.esriFieldTypeDate?l[n]=u.parseDate(e.value.get()):l[n]=o:l[n]=u.parseNumber(e.value.get()))}}),o.displayFieldName=r.esriFeatureSet.displayFieldName,s=new esri.Graphic(e.esriFeature.get().geometry,null,l,null),o.features.push(s),t&&g&&!p&&i._enableDataLinkObjectIdFieldOnExport&&(0===n&&(m=Math.ceil(m/i._featureIndexRoundUpPerFeatureSet)*i._featureIndexRoundUpPerFeatureSet),e[i._featureIndexName]=m,s.attributes[i._featureIndexName]=m,m++)})}if(o.features.length>0){if(a&&a.length>0){var v=[];a.forEach(function(e){$.inArray(e.name,b)==-1&&v.push(e)}),o.fields=v}var S=new d;S.name=e.featureSets.getAt(n).displayName.get(),S.featureSet=o;var _=0;l.forEach(function(e){S.name===e.name&&(_+=1)}),_>0&&(S.name=S.name+_),l.push(S),t&&g&&(!p&&i._enableDataLinkObjectIdFieldOnExport&&S.featureSet.fields.unshift({name:i._getFieldName(i._featureIndexName),alias:i._featureIndexName,type:"esriFieldTypeDouble"}),i._getDataLinksAsFscItems(r).then(function(e){e&&e.length&&l.push.apply(l,e),h++,f()},function(e){i.app.trace.error(e.message),h++,f()}))}}),(!t||t&&0===p)&&f()})},t.prototype.fscToJson=function(e,t){var i=this;return void 0===t&&(t=!0),new Promise(function(r,n){i.getFeatureSets(e,t).then(function(e){var t="[";e.forEach(function(e,i,r){var n=new d;n.featureSet=e.featureSet,n.name=e.name,t+=n.toJSONString(),i!==r.length-1&&(t+=",")}),t+="]",r(t)},function(e){n(e)})})},t}(i.ModuleBase);t.ResultsModule=p})},"geocortex/infrastructure/results/FeatureSetCollectionResultsLabelViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.featureSet=new r.Observable,n.featuresCount=new r.Observable,n.featureSetLabel=new r.Observable,n.iconUri=new r.Observable,n.featureSet.bind(n,function(e){n.featuresCount.set("("+e.features.getLength()+")");var t=""!==e.displayName.get()?e.displayName.get():e.id;n.featureSetLabel.set(t),n.iconUri.set(e.iconUri.get())}),n}return __extends(t,e),t}(i.ViewModelBase);t.FeatureSetCollectionResultsLabelViewModel=n})},"geocortex/infrastructure/results/FeatureSetCollectionResultsLabelView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/results/FeatureSetCollectionResultsLabelViewModel"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){return this.viewModel=new r.FeatureSetCollectionResultsLabelViewModel(this.app,this.libraryId),this.viewModel.featureSet.set(t),e.prototype.attach.call(this,this.viewModel),Promise.resolve()},t.prototype.handleClick=function(e,t,i){var r=e.target,n=!("IMG"!==r.tagName||!r.parentElement||"A"!==r.parentElement.tagName||!r.parentElement.href);return!("A"!==r.tagName&&!n)||(this.app.event("FeatureSetClickedEvent").publish(i.featureSet.get()),!1)},t}(i.ViewBase);t.FeatureSetCollectionResultsLabelView=n})},"geocortex/infrastructure/results/ResultsViewBase":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework-ui/ViewContainer/ViewContainerView","geocortex/infrastructure/ShellUtils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.isCollapsed=!0,r.isContainerCollapsed=!0,r._longPressTimer=null,r._pressStartTime=null,r._pressLengthMs=1500,r._hoverTimerToken=null,r._hoverDelayMs=0,r._hoveredFeature=null,r._firedTouchOrPress=!1,r._pressYStart=null,r._lastTouchY=null,r._scrollYDeltaThreshold=35,r._firstEvent=null,r.app.event("ViewContainerActivatedEvent").subscribe(r,function(e){!r.isCollapsed&&r._isViewHostedInContainer(e)&&(r.app.event("ResultsViewOpenedEvent").publish(r),r.viewModel.resultsPage&&r.app.behavior("ResultsPageChangedBehavior").run(r.viewModel.resultsPage.get()),r.isContainerCollapsed=!1)}),r.app.event("ViewContainerDeactivatedEvent").subscribe(r,function(e){!r.isCollapsed&&r._isViewHostedInContainer(e)&&(r.app.event("ResultsViewCollapsedEvent").publish(r),r.isContainerCollapsed=!0)}),r.app.event("ViewContainerViewClosedEvent").subscribe(r,function(e){e.viewId===r.id&&(r.app.event("ResultsViewClosedEvent").publish(r),r.isContainerCollapsed=!0)}),r}return __extends(t,e),t.prototype.activated=function(){e.prototype.activated.call(this),this.isCollapsed=!1,this.app.event("ResultsViewOpenedEvent").publish(this)},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.isCollapsed=!0,this.app.event("ResultsViewCollapsedEvent").publish(this)},t.prototype.handleTouchStart=function(e,t,i){return this._firstEvent||(this._firstEvent="touch start",this._beginLongPress(i)),!0},t.prototype.handleTouchMove=function(e,t,i){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},t.prototype.handleTouchEnd=function(e,t,i){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},t.prototype.handleTouchCancel=function(e,t,i){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},t.prototype.handleMouseDown=function(e,t,i){return this._firstEvent||(this._firstEvent="mouse down",this._beginLongPress(i)),!0},t.prototype.handleClick=function(e,t,i){this._cancelHover(),this._hoveredFeature=null,this._firstEvent&&(this._firstEvent=null,this._cancelLongPress());var r=e.target,n=!("IMG"!==r.tagName||!r.parentElement||"A"!==r.parentElement.tagName||!r.parentElement.href);return!("A"!==r.tagName&&!n)||(this.app.command("ClearFeatureInformation").execute(),this.app.event(this.featureClickedEventName).publish(i),!1)},t.prototype.handleMouseUp=function(e,t,i){return this._cancelHover(),"mouse down"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},t.prototype.handleMouseOver=function(e,t,i){(n.hasClass(e.currentTarget,this.itemClass)||e instanceof FocusEvent)&&this._beginHover(i)},t.prototype.handleMouseOut=function(e,t,i){(n.hasClass(e.currentTarget,this.itemClass)||e instanceof FocusEvent)&&(this._cancelHover(),this._tryFireHoverStop(i),"mouse down"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()))},t.prototype._beginHover=function(e){var t=this;this._hoverTimerToken&&clearTimeout(this._hoverTimerToken),this._hoverTimerToken=setTimeout(function(){t._hoveredFeature!==e&&(t._hoveredFeature=e),t.app.event(t.featureHoveredEventName).publish(e)},this._hoverDelayMs)},t.prototype._cancelHover=function(){this._hoverTimerToken&&(clearTimeout(this._hoverTimerToken),this._hoverTimerToken=null)},t.prototype._tryFireHoverStop=function(e){this._hoveredFeature===e&&(this._hoveredFeature=null,this.app.event(this.featureHoverEndEventName).publish(e))},t.prototype._beginLongPress=function(e){var t=this;this._longPressTimer&&clearTimeout(this._longPressTimer),this._longPressTimer=setTimeout(function(){t.app.event(t.featurePressedEventName).publish(e)},this._pressLengthMs)},t.prototype._cancelLongPress=function(){this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null)},t.prototype._isViewHostedInContainer=function(e){if(e instanceof r.ViewContainerView){var t=e.viewModel.regionName.get(),i=this.app.viewManager.getRegionForViewId(this.id);if(i&&i.name===t)return!0}return!1},t.prototype.scrollView=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},t}(i.ViewBase);t.ResultsViewBase=a,a.prototype.featureClickedEventName="ResultsListFeatureClickedEvent",a.prototype.featurePressedEventName="ResultsListFeaturePressedEvent"})},"geocortex/infrastructure/results/ResultsViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/Dictionary","geocortex/framework/observables"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._emptyFeatureSetCollection=null,r._watchHandles=new n.Dictionary,r.featureSetCollection=new a.Observable,r.featureActions=new a.ObservableCollection,r.currentFeature=new a.Observable,r.hasFeatureSets=new a.Observable((!1)),r.isBusy=new a.Observable((!1)),r.isModified=new a.Observable((!1)),r.defaultIsPaged=!0,r.defaultPageSize=50,r.headerText=new a.Observable(r.app.getResource(r.libraryId,"language-common-results")),r.searchSuggestion=new a.Observable(r.app.getResource(r.libraryId,"language-common-no-results-desc")),r.featureSetCollection.bind(r,r.handleCollectionChanged),r.registerCommands(),r.subscribeEvents(),r}return __extends(t,e),t.prototype.subscribeEvents=function(){this.app.event("FSMCollectionOpenedEvent").subscribe(this,this._openFSC),this.app.event("FSMCollectionClosedEvent").subscribe(this,this._closeFSC),this.app.event("FSMCollectionRemovedEvent").subscribe(this,this._removeFSC),this.app.event("FSMCollectionChangedEvent").subscribe(this,this._changeFSC),this.app.event("FeatureEditedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("FeatureDeletedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("RelatedRecordEditedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("GraphicRemovedEvent").subscribe(this,this._pulseFeatureSetsInCollection);
},t.prototype.handleCollectionChanged=function(e){var t=e&&this.app.featureSetManager.getCollectionById(e.id);!t&&e&&e.featureSets&&(t=e),t?(t===this._emptyFeatureSetCollection?this.isBusy.set(!1):this.isBusy.set(this.app.featureSetManager.isCollectionOpen(t.id)),this.updateHeaderText(t.countFeatures()),this.hasFeatureSets.set(this._featureSetsHaveFeatures(t.featureSets)),this._watchDisplayNameChanges(),this._watchIsModifiedChanges()):(this.isBusy.set(!1),this._unwatchDisplayNameChanges(),this._unwatchIsModifiedChanges()),null!=this.presentableResults&&this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)},t.prototype.handleFeatureSetsChanged=function(e){var t=e.sender,i=this._featureSetsHaveFeatures(t);this.hasFeatureSets.get()!==i&&this.hasFeatureSets.set(i)},t.prototype.updateHeaderText=function(e){var t=null,i="",r=!1,n="*";e&&(i=" ("+e+")"),this.featureSetCollection.get()&&(t=this.featureSetCollection.get().displayName.get(),r=this.featureSetCollection.get().isModified.get()),this._count=e;var a="{0}{1}{2}".format(t?t:this.app.getResource(this.libraryId,"language-common-results"),i,r?n:"");this.headerText.set(a)},t.prototype._featureSetsHaveFeatures=function(e){if(e)for(var t=0;t<e.length();t++)if(e.getAt(t).features&&e.getAt(t).features.length()>0||e.getAt(t).esriFeatureSet&&e.getAt(t).esriFeatureSet.features&&e.getAt(t).esriFeatureSet.features.length>0)return!0;return!1},t.prototype._openFSC=function(e){if(this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id){this.isBusy.set(!0),this.hasFeatureSets.set(!1);var t=this.app.featureSetManager.getSearchSuggestion(this.featureSetCollection.get().sourceName);this.searchSuggestion.set(t?t:this.app.getResource(this.libraryId,"language-common-no-results-desc"))}},t.prototype._closeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&(this.isBusy.set(!1),this.featureSetCollection.pulse())},t.prototype._removeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.featureSetCollection.set(this._getEmptyFeatureSetCollection())},t.prototype._changeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.featureSetCollection.pulse()},t.prototype._getEmptyFeatureSetCollection=function(){return null==this._emptyFeatureSetCollection?this._emptyFeatureSetCollection=new r.FeatureSetCollection:this._emptyFeatureSetCollection.clear(),this._emptyFeatureSetCollection},t.prototype.registerCommands=function(){var e=this;this.app.command("ShowResultsListFeatureAction").register(this,function(t){e.currentFeature.set(t),e.getResultsFeatureActions(),e.app.command("ActivateView").execute("ResultsFeatureActionsView")}),this.app.command("RemoveUserAddedLayer").register(this,function(t){if(e.featureSetCollection.get()){for(var i=e.featureSetCollection.get().featureSets.get(),r=e.featureSetCollection.get(),n=0;n<i.length;n++)if(i[n].layer===t){r.featureSets.removeItem(i[n]);break}e.featureSetCollection.set(r)}}),this.app.command("ClearSelection").register(this,function(){e.app.command("RemoveFeatureSetCollection").execute(e.featureSetCollection.get())})},t.prototype.getResultsFeatureActions=function(){this.featureActions.clear();var e=this.app.menuRegistry.getMenu("ResultsListFeatureAction");this.app.menuRegistry.getDefaultIconUri("ResultsListFeatureAction");if(!e)throw new Error("Results Feature Actions not found");this.featureActions.addItems(e.items)},t.prototype._pulseFeatureSetsInCollection=function(){this.featureSetCollection&&this.featureSetCollection.get()&&this.featureSetCollection.get().featureSets&&this.featureSetCollection.get().featureSets.length()>0&&this.featureSetCollection.get().featureSets.pulse()},t.prototype._watchDisplayNameChanges=function(){var e=this;this._unwatchDisplayNameChanges();var t=this.featureSetCollection.get()?this.featureSetCollection.get().displayName:null;if(!t)return null;var i=t.bind(this,function(){return e.updateHeaderText(e._count)}),r={remove:function(){return t.unbind(i)}};return this._watchHandles.set("displayName",r),r},t.prototype._unwatchDisplayNameChanges=function(){var e=this._watchHandles.get("displayName");e&&e.remove(),this._watchHandles.remove("displayName")},t.prototype._watchIsModifiedChanges=function(){var e=this;this._unwatchIsModifiedChanges();var t=this.featureSetCollection.get()?this.featureSetCollection.get().isModified:null;if(!t)return null;var i=t.bind(this,function(){return e.updateHeaderText(e._count)}),r={remove:function(){return t.unbind(i)}};return this._watchHandles.set("isModified",r),r},t.prototype._unwatchIsModifiedChanges=function(){var e=this._watchHandles.get("isModified");e&&e.remove(),this._watchHandles.remove("isModified")},t}(i.ViewModelBase);t.ResultsViewModel=o})},"geocortex/infrastructure/results/ResultsUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t){t&&t>0?e.command("AddResultsStatus").execute(t+" "+e.getResource("Mapping.Infrastructure","language-common-results-found")):e.command("AddResultsStatus").execute(e.getResource("Mapping.Infrastructure","language-common-no-results"))}function r(e){return e?e.firstElementChild:null}function n(e,t){var i=r(e);i&&i.classList.contains(u)&&(t.app.event("FlyoutDeactivated").publish(t),i.classList.remove(d),i.classList.remove(u),i.classList.add(c))}function a(e,t){if(!t||!e)return!0;var i=t.getBoundingClientRect(),r=e.getBoundingClientRect();return r.bottom<=i.bottom}function o(e,t,i){if(!t||!e)return!0;var r=t.getBoundingClientRect(),n=e.getBoundingClientRect();return r.top<=n.top-n.height-i.clientHeight}function s(e,t,i,n){var s=r(e);s&&s.classList.contains(c)&&(s.classList.remove(c),s.classList.add(u),!a(s,t)&&o(s,t,i)&&s.classList.add(d),n.app.event("FlyoutActivated").publish(n))}function l(e,t,i,a,o){var l=t.parentElement;if(i&&i!==l&&n(i,o),i=l,r(i)&&r(i).classList.contains(c)){var u={view:o,onOtherInteracted:function(e){n(i,o)},onElementInteracted:function(e){($(e.srcElement||e.target).hasClass("gcx-list-menu")||$(e.srcElement||e.target).hasClass("paging-buttons"))&&n(i,o)}};o.app.command("TapToDismiss").execute(u),s(i,a,t,o)}else n(i,o)}var c="bound-invisible",u="bound-visible",d="inline-menu-open-up";t.showResultsStatusMessage=i,t.handleInlineMenuActionClick=l})},"geocortex/infrastructure/results/FeatureSetCollectionResultsViewModel":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewModel","geocortex/framework/observables","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/eventArgs/FeatureSetManagerEventArgs","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/results/ResultsUtils"],function(e,t,i,r,n,a,o,s){"use strict";var l=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.isViewActive=new r.Observable((!1)),n._automaticDrillIn=!0,n._featureSetsBindingToken=null,n._boundFeatureSetCollection=null,n._featureViewMap={},n._featureSetsLoadTimer=0,n._performAutomaticDrillInDelay=300,n._loadingMessageDismissed=!1,n.detectAutomaticDrillInDelay=null,n.featureSets=new r.ObservableCollection,n.searchSuggestion=new r.Observable(n.app.getResource(n.libraryId,"language-common-no-results-desc")),n.app.command("ShowResultsList").register(n,n._showResultsList),n.app.command("SwitchToTabularResultsView").register(n,n._switchToTabularResultsViewImpl,n._canExecuteSwitchToTabularResultsView),n.app.command("RemoveFeatureSetFromResults").register(n,n._executeRemoveFeatureSetFromResults,n._canRemoveFeatureSetFromResults),n.isViewActive.bind(n,function(e){n._featuresInCollectionCount&&n.updateHeaderText(n._featuresInCollectionCount)}),n.featureSets.bind(n,function(e){n.app.event("_underlyingFeatureSetsChanged").publish(e)}),n.isBusy.bind(n,function(e){e?n.isViewActive.get()&&(n.detectAutomaticDrillInDelay&&n._startAutomaticDrillInTimer(),n._showLoadingMessage()):(n._loadingMessageDismissed=!1,n.isViewActive.get()&&(s.showResultsStatusMessage(n.app,n.featureSetCollection.get().countFeatures()),n.detectAutomaticDrillInDelay&&(n._clearAutomaticDrillInTimer(),n._tryAutomaticDrillIn())))}),n}return __extends(t,e),t.prototype.handleCollectionChanged=function(t){if(e.prototype.handleCollectionChanged.call(this,t),this._clearResetUnderlyingCollection(!0),t&&t.featureSets){this._featureSetsBindingToken=t.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSetCollection=t;for(var i=0,r=t.featureSets.length();i<r;i++)t.featureSets.getAt(i).features.length()<=0||this.featureSets.addItem(t.featureSets.getAt(i))}},t.prototype._showLoadingMessage=function(){this._loadingMessageDismissed||this.app.command("AddResultsStatus").execute(new o.AddStatusArgs(this.app.getResource(this.libraryId,"language-common-loading-results"),null,this._onLoadingMessageDismissed))},t.prototype._onLoadingMessageDismissed=function(){this._loadingMessageDismissed=!0},t.prototype._startAutomaticDrillInTimer=function(){var e=this;this._automaticDrillIn=!0,this._featureSetsLoadTimer||(this._featureSetsLoadTimer=setTimeout(function(){e._automaticDrillIn=!1},this.detectAutomaticDrillInDelay))},t.prototype._clearAutomaticDrillInTimer=function(){this._featureSetsLoadTimer&&(clearTimeout(this._featureSetsLoadTimer),this._featureSetsLoadTimer=0)},t.prototype._tryAutomaticDrillIn=function(){var e=this;this._automaticDrillIn&&1===this.featureSets.length()&&setTimeout(function(){e._performAutomaticDrillIn()},this._performAutomaticDrillInDelay)},t.prototype._performAutomaticDrillIn=function(){1===this.featureSets.length()&&(this.app.command("RemoveResultsStatus").execute(),this.app.event("FeatureSetClickedEvent").publish(this.featureSets.getAt(0)))},t.prototype.updateHeaderText=function(t){this.isViewActive.get()?(e.prototype.updateHeaderText.call(this,t),this._featuresInCollectionCount=null):(this._featuresInCollectionCount=t,e.prototype.updateHeaderText.call(this,0))},t.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},t.prototype._showResultsList=function(e){var t=this._loadFeatureSetCollection(e);t&&this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsList")},t.prototype._loadFeatureSetCollection=function(e){var t;if("string"==typeof e)t=this.app.featureSetManager.getCollectionById(e);else{if(!(e instanceof n.FeatureSetCollection))return;t=e}return t&&t!==this.featureSetCollection.get()&&(this._clearResetUnderlyingCollection(!0),this.featureSetCollection.set(t)),t},t.prototype._switchToTabularResultsViewImpl=function(){this.app.command("ShowResultsTable").execute(this.featureSetCollection.get())},t.prototype._canExecuteSwitchToTabularResultsView=function(){return!!this.featureSetCollection.get()},t.prototype._executeRemoveFeatureSetFromResults=function(e){if(this._canRemoveFeatureSetFromResults(e))return this._removeFeatureSetFromResults(e)},t.prototype._canRemoveFeatureSetFromResults=function(e){var t=this._boundFeatureSetCollection;return!(!t||!e)&&this._existsInCollection(e,t)},t.prototype._removeFeatureSetFromResults=function(e){var t=null;if(e&&this._boundFeatureSetCollection){for(var i=0;i<this._boundFeatureSetCollection.featureSets.getLength();i++)e.id===this._boundFeatureSetCollection.featureSets.getAt(i).id&&(t=i,this._boundFeatureSetCollection.featureSets.removeAt(i));null!=t&&this._notifyFeatureSetCollectionChanged(t);var r=this.getResource("language-common-results-removed-confirmation").format(e.features.length(),this._boundFeatureSetCollection.displayName.get());this.app.command("AddResultsStatus").execute(r)}},t.prototype._existsInCollection=function(e,t){if(!e)return!1;if(!t)throw new Error("FeatureSetCollection is required");for(var i=0;i<t.featureSets.getLength();i++)if(e.id===t.featureSets.getAt(i).id)return!0;return!1},t.prototype._notifyFeatureSetCollectionChanged=function(e){var t={sender:this._boundFeatureSetCollection.featureSets,type:"remove",rangeStart:e,rangeEnd:e},i=new a.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._boundFeatureSetCollection,featureSetCollectionId:this._boundFeatureSetCollection.id,collectionChangedEventArgs:t});this.app.event("FSMCollectionChangedEvent").publish(i)},t.prototype.getFeatureView=function(e){return this._featureViewMap[e]},t.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},t.prototype.unbindFeatureSet=function(){this._featureSetsBindingToken&&this._boundFeatureSetCollection&&(this._boundFeatureSetCollection.featureSets.unbind(this._featureSetsBindingToken),this._featureSetsBindingToken=null,this._boundFeatureSetCollection=null)},t.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.viewMode="grouplist"},t.prototype.applyState=function(e){var t=this;e.promises.push(this.app.project.convert.toGcxFeatureSetCollection(e.state.results).then(function(i){i&&(t._loadFeatureSetCollection(i),"grouplist"!==e.state.viewMode&&"list"!==e.state.viewMode||t.app.command("_setResultMappingCommand").execute(i.sourceName,"ShowResultsList"))}))},t.prototype._pulseFeatureSetsInCollection=function(){e.prototype._pulseFeatureSetsInCollection.call(this)},t.prototype._clearResetUnderlyingCollection=function(e){this.featureSets.clear(),e&&(this.unbindFeatureSet(),this._featureViewMap={})},t}(i.ResultsViewModel);t.FeatureSetCollectionResultsViewModel=l})},"geocortex/infrastructure/results/FeatureSetCollectionResultsView":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewBase","geocortex/infrastructure/results/ResultsUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._invisibleClassName="bound-invisible",r._visibleClassName="bound-visible",r._openUpActionsMenuClassName="inline-menu-open-up",r._defaultDetectAutomaticDrillInDelay=300,r._subscriptions=null,r.app.command("ShowResultsList").register(r,r.showResultsList),r.app.command("ShowResultsTable").register(r,r._handleShowResultsTable,function(){return!r.app.configuration.mobileMode}),r.app.command("SwitchToTabularResultsView").register(r,r._switchToTabularResultsViewImpl,r._canExecuteSwitchToTabularResultsView),r.app.command("_ExportResultsViewState").register(r,r._exportState),r.app.command("_ClearIsSelected").register(r,r._clearIsSelected),r.app.command("_ApplyResultsViewState").register(r,r._applyState),r.app.event("ViewContainerViewClosedEvent").subscribe(r,function(e){e.viewId===r.id&&r.configuration.clearCollectionOnClose!==!1&&r.viewModel.featureSetCollection.get().clear()}),r}return __extends(t,e),t.prototype.activated=function(){if(this.app.command("HideFeatureSetResultsView").execute(),e.prototype.activated.call(this),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var t=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),i=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:t},{eventName:"DataFrameClosedEvent",token:i}]}if(this.resultsList){var r=this.resultsList;setTimeout(function(){dojo.style(r,{display:"block"})},1)}this.app.project.isLoading||this.viewModel.featureSetCollection.get().featureSets.get().forEach(function(e){e.isSelectedInCollection.set(!1)}),this.viewModel.isViewActive.set(!0)},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.viewModel.isViewActive.set(!1),this.app.command("RemoveResultsStatus").execute(),this._unsubscribeFromEvents()},t.prototype.attach=function(t){if(this.configuration.automaticDrillInDelay){var i=this.configuration.automaticDrillInDelay;i<0&&(i=this._defaultDetectAutomaticDrillInDelay),t.detectAutomaticDrillInDelay=i}this.title.sync(t.headerText),this.isBusy.sync(t.isBusy),e.prototype.attach.call(this,t)},t.prototype.showResultsList=function(e){this.app.viewManager.activateView(this)},t.prototype.getDescription=function(e,t,i){t.title=i.description.get()},t.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},t.prototype.handleFeatureSetCollectionFeatureSetActionsClick=function(e,t,i){r.handleInlineMenuActionClick(e,t,this.currentActiveFeatureSetElement,this.scrollContainerElement,this),this.currentActiveFeatureSetElement=t.parentElement},t.prototype.resolveWidget=function(t,i,r){switch(e.prototype.resolveWidget.call(this,t,i),t){case"FeatureSetCollectionActionsWidget":case"FeatureSetActionsWidget":var n=this.app.menuRegistry.createMenuWidget(this,i,r);if(n)return n;break;case"GetFeatureSetLabel":var a=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/results/FeatureSetCollectionResultsLabelView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.results.FeatureSetCollectionResultsLabelView"});return a.attach(i),a;default:return}},t.prototype._handleShowResultsTable=function(){this.app.viewManager.deactivateView(this)},t.prototype._switchToTabularResultsViewImpl=function(){this.app.command("CloseDataFrame").execute()},t.prototype._canExecuteSwitchToTabularResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},t.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},t.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},t.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},t.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},t.prototype._clearIsSelected=function(){this.viewModel&&this.viewModel.featureSetCollection.get()&&this.viewModel.featureSetCollection.get().featureSets.get()&&this.viewModel.featureSetCollection.get().featureSets.get().length>0&&this.viewModel.featureSetCollection.get().featureSets.get().forEach(function(e){e.isSelectedInCollection.set(!1)})},t.prototype._applyState=function(e){this.viewModel.applyState(e)},t}(i.ResultsViewBase);t.FeatureSetCollectionResultsView=n})},"geocortex/infrastructure/results/FeatureSetResultsViewModel":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewModel","geocortex/framework-ui/ObservableCollectionAggregator","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/eventArgs/ResultsPageChangedEventArgs","geocortex/framework/utils/utils","geocortex/infrastructure/FeatureSet"],function(e,t,i,r,n,a,o,s,l){"use strict";var c=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.pageControlsEnabled=new n.Observable((!1)),o.resultsList=new n.Observable("results-list"),o.pagingControlClassName=new n.Observable("paging-control no-pages"),o.contentField=new n.Observable("description"),o._featureViewMap={},o.featureSet=new n.Observable(new l.FeatureSet),o.results=new r.ObservableCollectionAggregator(new n.ObservableCollection),o.presentableResults=new a.PresentableCollection(o.results),o.presentableResults.items.useThrottling=!0,o.resultsPage=o.presentableResults.items,o.presentableResults.pageSize.set(o.defaultPageSize),o.defaultIsPaged!=o.presentableResults.isPaginated.get()&&o.presentableResults.isPaginated.set(o.defaultIsPaged),o.app.command("ShowFeatureSetResultsView").register(o,o.showFeaturesList,function(e){return!!o.app.featureSetManager.findFeatureSetByUniqueId(e.uniqueId)}),o}return __extends(t,e),t.prototype._updateHeaderText=function(e){var t=null,i="";e&&(i=" ("+e+")"),this.featureSet.get()&&(t=this.featureSet.get().displayName.get());var r="{0}{1}".format(t?t:this.app.getResource(this.libraryId,"language-common-results"),i);this.headerText.set(r)},t.prototype.subscribeEvents=function(){},t.prototype.handlePageResultsChange=function(e){var t=this;if(e=e?e:{type:null},"clear"===e.type)Object.keys(this._featureViewMap).map(function(e){return t._featureViewMap[e]}).forEach(function(e){return t.app.viewManager.destroyView(e)}),this._featureViewMap={};else if("remove"===e.type&&e.sender.value.length>e.rangeStart){var i=e.sender.getAt(e.rangeStart);this._destroyViewForToken(i.token),this._destroyViewForToken(i.token+"-label")}var r="clear"===e.type||"remove"===e.type&&e.sender.value.length<=1,a=new o.ResultsPageChangedEventArgs;a.featureSetCollection=this.app.featureSetManager.findOpenFeatureSetCollectionByFeatureSetUniqueId(this.featureSet.get().uniqueId),a.newValue=r?new n.ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(a),this.app.behavior("ResultsPageChangedBehavior").run(a.newValue.get())},t.prototype.handleFeatureChanged=function(e){if(e&&this._featureViewMap.hasOwnProperty(e.token)){var t=this._featureViewMap[e.token],i=this._featureViewMap[e.token+"-label"];i.destroyBindings(),t.destroyBindings(),i.attach(e),t.attach(e)}},t.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},t.prototype.showFeaturesList=function(e){this._clearResetUnderlyingCollection();var t=this.results.getCollectionSource();t.addItem(e.features),e&&e!==this.featureSet.get()?(this.featureSet.set(e),this._updateHeaderText(e.features.length())):this.handlePageResultsChange(),this._presentableResultsNumberOfItemsBindingToken||(this._presentableResultsNumberOfItemsBindingToken=this.presentableResults.numberOfItems.bind(this,this._updateHeaderText))},t.prototype.clearCurrentHighlights=function(){var e=this.featureSet.get();e&&e.esriFeatureSet&&this.app.command("ClearFeatureHighlight").execute(e.esriFeatureSet.features)},t.prototype._clearSpecificHighlight=function(e){this.app.command("ClearFeatureHighlight").execute(e)},t.prototype.getFeatureView=function(e){return this._featureViewMap[e]},t.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},t.prototype.exportState=function(e){var t=this.app.project.convert.fromGcxFeatureSet(this.featureSet.get());e.openedFeatureSet=t,e.page=this.presentableResults.currPageNumber.get()},t.prototype.applyState=function(e){var t=this;"list"!==e.state.viewMode&&e.promises.push(this.app.project.convert.toGcxFeatureSet(e.state.openedFeatureSet).then(function(i){i&&(t.showFeaturesList(i),s.isNullOrUndefined(e.state.page)||t.presentableResults.currPageNumber.set(e.state.page))}))},t.prototype._hideIfNoFeaturesLeft=function(e){if(this.featureSet.get()&&this.featureSet.get().features.get()){var t=this.featureSet.get().features.get();if(0===t.length)this._clearSpecificHighlight(e);else{if(1!==t.length||!e.featureSet||e.featureSet.id!==this.featureSet.get().id)return;this.clearCurrentHighlights()}this.app.command("HideFeatureSetResultsView").execute(),this.featureSet.set(null)}},t.prototype._pulseUnderlyingCollection=function(){var e=this.presentableResults.currPageNumber.get();this.results.getCollectionSource().pulse(),this.presentableResults.currPageNumber.set(e)},t.prototype._clearResetUnderlyingCollection=function(){var e=this.results.getCollectionSource();e.clear(),this.presentableResults.currPageNumber.set(1),this._featureViewMap={}},t.prototype.updateHeaderText=function(e){},t.prototype.bindUnderlyingCollection=function(){this._bindObservables(),this._pulseUnderlyingCollection()},t.prototype.unbindUndelryingCollection=function(){this._unbindObservables()},t.prototype._bindObservables=function(){var e=this;this._resultsPageBindingToken||(this._resultsPageBindingToken=this.resultsPage.bind(this,this.handlePageResultsChange)),this._presentableResultsBindingToken||(this._presentableResultsBindingToken=this.presentableResults.numberOfItems.bind(this,function(t){t>0?e.pagingControlClassName.set("paging-control has-pages"):e.pagingControlClassName.set("paging-control no-pages"),e._updateHeaderText(t)}))},t.prototype._unbindObservables=function(){this._resultsPageBindingToken&&(this.resultsPage.unbind(this._resultsPageBindingToken),this._resultsPageBindingToken=null),this._presentableResultsBindingToken&&(this.presentableResults.numberOfItems.unbind(this._presentableResultsBindingToken),this._presentableResultsBindingToken=null)},t.prototype.subscribeToEvents=function(){this._featureChangedEventSubscriptionToken||(this._featureChangedEventSubscriptionToken=this.app.event("FeatureChangedEvent").subscribe(this,this.handleFeatureChanged)),this._underlyingFeatureSetsChangedSubscriptionToken||(this._underlyingFeatureSetsChangedSubscriptionToken=this.app.event("_underlyingFeatureSetsChanged").subscribe(this,this._pulseUnderlyingCollection)),this._featureRemovedFromResultsSubscriptionToken||(this._featureRemovedFromResultsSubscriptionToken=this.app.event("_featureRemovedFromResults").subscribe(this,this._hideIfNoFeaturesLeft)),this._featureDeletedEventSubscriptionToken||(this._featureDeletedEventSubscriptionToken=this.app.event("FeatureDeletedEvent").subscribe(this,this._hideIfNoFeaturesLeft))},t.prototype.unsubscribeFromEvents=function(){this._featureChangedEventSubscriptionToken&&(this.app.event("FeatureChangedEvent").unsubscribe(this._featureChangedEventSubscriptionToken),this._featureChangedEventSubscriptionToken=null),this._underlyingFeatureSetsChangedSubscriptionToken&&(this.app.event("_underlyingFeatureSetsChanged").unsubscribe(this._underlyingFeatureSetsChangedSubscriptionToken),this._underlyingFeatureSetsChangedSubscriptionToken=null),this._featureRemovedFromResultsSubscriptionToken&&(this.app.event("_featureRemovedFromResults").unsubscribe(this._featureRemovedFromResultsSubscriptionToken),this._featureRemovedFromResultsSubscriptionToken=null),this._featureDeletedEventSubscriptionToken&&(this.app.event("FeatureDeletedEvent").unsubscribe(this._featureDeletedEventSubscriptionToken),this._featureDeletedEventSubscriptionToken=null)},t}(i.ResultsViewModel);t.FeatureSetResultsViewModel=c})},"geocortex/infrastructure/results/FeatureSetResultsView":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewBase","geocortex/infrastructure/FeatureDescriptionPresenterView","geocortex/infrastructure/results/ResultsUtils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._invisibleClassName="bound-invisible",r._visibleClassName="bound-visible",r._openUpActionsMenuClassName="inline-menu-open-up",r.featureClickedEventName="ResultsListFeatureClickedEvent",r.featurePressedEventName="ResultsListFeaturePressedEvent",r.featureHoveredEventName="ResultsListFeatureHoveredEvent",r.featureHoverEndEventName="ResultsListFeatureHoverEndedEvent",r.itemClass="gcx-list-item",r._subscriptions=null,r._scrollTop=0,r.app.command("ShowFeatureSetResultsView").register(r,r._showFeaturesList,function(e){return!!r.app.featureSetManager.findFeatureSetByUniqueId(e.uniqueId)}),r.app.command("HideFeatureSetResultsView").register(r,r._hideFeatureSetResults),r.app.command("ShowResultsTable").register(r,r._handleShowResultsTable,function(){return!r.app.configuration.mobileMode}),r.app.command("_ExportResultsViewState").register(r,r._exportState),r.app.command("_ApplyResultsViewState").register(r,r._applyState),r}return __extends(t,e),t.prototype.activated=function(){var t=this;if(this.viewModel.featureSet.get()&&this.viewModel.featureSet.get().features.get()&&0===this.viewModel.featureSet.get().features.get().length)var i=this.app.event("ViewActivatedEvent").subscribe(this,function(e){e.id===t.id&&(t.app.viewManager.deactivateView(t),t.app.event("ViewActivatedEvent").unsubscribe(i),i=null)});else if(!this.isActive){if(e.prototype.activated.call(this),this.viewModel.clearCurrentHighlights(),"all"!==this._highlightMode?this.app.behavior("ResultsPageChangedBehavior").run(this.viewModel.resultsPage.get()):this.app.behavior("AllResultsPageChangedBehavior").run(this.viewModel.featureSet.get()),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var r=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),n=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:r},{eventName:"DataFrameClosedEvent",token:n}]}if(this.resultsList){var a=this.resultsList;setTimeout(function(){dojo.style(a,{display:"block"})},1)}this._viewModelFSCBindingToken||(this._viewModelFSCBindingToken=this.viewModel.featureSetCollection.bind(this,function(e){t.app.trace.debug("View focused in results list: "+t.id),t.app.command("FocusOnFirstInputInView").execute(t)})),this.app.command("RemoveResultsStatus").execute(),this.viewModel.subscribeToEvents(),this.viewModel.bindUnderlyingCollection()}},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.isActive=!1,this.viewModel.clearCurrentHighlights(),this.viewModel.unbindUndelryingCollection(),this._viewModelFSCBindingToken&&(this.viewModel.featureSetCollection.unbind(this._viewModelFSCBindingToken),this._viewModelFSCBindingToken=null),this.viewModel.unsubscribeFromEvents(),this._unsubscribeFromEvents()},t.prototype.attach=function(t){var i=this;this.title.sync(t.headerText),void 0!=this.configuration.highlightMode&&(this._highlightMode=this.configuration.highlightMode),void 0!=this.configuration.isPaged&&t.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&t.presentableResults.pageSize.set(this.configuration.pageSize),this.configuration.contentField&&t.contentField.set(this.configuration.contentField),t.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){i.scrollViewTop()}),this.scrollViewTop(this._scrollTop),e.prototype.attach.call(this,t)},t.prototype._showFeaturesList=function(e){this.viewModel.featureSet.get()&&this.viewModel.featureSet.get().isSelectedInCollection.set(!0),this.app.viewManager.activateView(this)},t.prototype.handlePageFirst=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(1))},t.prototype.handlePagePrev=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()-1))},t.prototype.handlePageNext=function(e,t,i){this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()+1))},t.prototype.handlePageLast=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.lastPageNumber.get()))},t.prototype.handleScrollChange=function(e,t,i){i&&(this._scrollTop=t.scrollTop)},t.prototype.getDescription=function(e,t,i){t.title=i.description.get()},t.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},t.prototype.resolveWidget=function(t,i,n){switch(e.prototype.resolveWidget.call(this,t,i),t){case"GetLabel":
var a=new r.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField="label",a.root=dojo.create("div"),a.root.className="feature-label",a.attach(i),this.viewModel.setFeatureView(i.token+"-label",a),a;case"GetDescription":var a=new r.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField=this.viewModel.contentField.get(),a.root=dojo.create("div"),a.root.className="feature-description",a.attach(i),this.viewModel.setFeatureView(i.token,a),a;case"FeatureSetActionsWidget":case"FeatureActionsWidget":var o=this.app.menuRegistry.createMenuWidget(this,i,n);if(o)return o;break;default:return}},t.prototype._handleShowResultsTable=function(){this._hideFeatureSetResults()},t.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},t.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},t.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},t.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},t.prototype._applyState=function(e){this.viewModel.applyState(e)},t.prototype._hideFeatureSetResults=function(){this.isActive&&this.app.viewManager.deactivateView(this)},t.prototype.handleFeatureSetFeatureActionClick=function(e,t,i){n.handleInlineMenuActionClick(e,t,this.currentActiveFeatureElement,this.scrollContainerElement,this),this.currentActiveFeatureElement=t.parentElement},t}(i.ResultsViewBase);t.FeatureSetResultsView=a})},"geocortex/infrastructure/results/FlatResultsViewModel":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewModel","geocortex/framework-ui/ObservableCollectionAggregator","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/eventArgs/ResultsPageChangedEventArgs","geocortex/framework/utils/utils"],function(e,t,i,r,n,a,o,s){"use strict";var l=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.pageControlsEnabled=new n.Observable((!1)),o.resultsList=new n.Observable("results-list"),o.pagingControlClassName=new n.Observable("paging-control no-pages"),o.contentField=new n.Observable("description"),o._featureSetsBindingToken=null,o._boundFeatureSetCollection=null,o._featureViewMap={},o.results=new r.ObservableCollectionAggregator(new n.ObservableCollection),o.presentableResults=new a.PresentableCollection(o.results),o.presentableResults.items.useThrottling=!0,o.resultsPage=o.presentableResults.items,o.presentableResults.pageSize.set(o.defaultPageSize),o.defaultIsPaged!=o.presentableResults.isPaginated.get()&&o.presentableResults.isPaginated.set(o.defaultIsPaged),o.app.command("ShowResultsList").register(o,o.showResultsList),o.app.command("SwitchToTabularResultsView").register(o,o._switchToTabularResultsViewImpl,o._canExecuteSwitchToTabularResultsView),o}return __extends(t,e),t.prototype.subscribeEvents=function(){e.prototype.subscribeEvents.call(this),this.app.event("FeatureChangedEvent").subscribe(this,this.handleFeatureChanged)},t.prototype.handleCollectionChanged=function(t){if(e.prototype.handleCollectionChanged.call(this,t),this._clearResetUnderlyingCollection(!0),t&&t.featureSets){this._featureSetsBindingToken=t.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSetCollection=t;for(var i=this.results.getCollectionSource(),r=0,n=t.featureSets.length();r<n;r++)i.addItem(t.featureSets.getAt(r).features)}},t.prototype.handleFeatureSetsChanged=function(t){e.prototype.handleFeatureSetsChanged.call(this,t);var i=this.results.getCollectionSource();if("append"===t.type)for(var r=t.sender.getRange(t.rangeStart,t.rangeEnd),n=0;n<r.length;n++)i.addItem(r[n].features);else if("remove"===t.type)for(var a=t.sender.getRange(t.rangeStart,t.rangeEnd),n=0;n<a.length;n++)i.removeItem(a[n].features);else"clear"===t.type&&(this._clearResetUnderlyingCollection(!1),this.results.bindingEvent.publish(t))},t.prototype.handlePageResultsChange=function(e){var t=this;if(e=e?e:{type:null},"clear"===e.type)Object.keys(this._featureViewMap).map(function(e){return t._featureViewMap[e]}).forEach(function(e){return t.app.viewManager.destroyView(e)}),this._featureViewMap={};else if("remove"===e.type&&e.sender.value.length>e.rangeStart){var i=e.sender.getAt(e.rangeStart);this._destroyViewForToken(i.token),this._destroyViewForToken(i.token+"-label")}var r="clear"===e.type||"remove"===e.type&&e.sender.value.length<=1,a=new o.ResultsPageChangedEventArgs;a.featureSetCollection=this.featureSetCollection.get(),a.newValue=r?new n.ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(a),this.app.behavior("ResultsPageChangedBehavior").run(a.newValue.get())},t.prototype.handleFeatureChanged=function(e){if(e&&this._featureViewMap.hasOwnProperty(e.token)){var t=this._featureViewMap[e.token],i=this._featureViewMap[e.token+"-label"];i.destroyBindings(),t.destroyBindings(),i.attach(e),t.attach(e)}},t.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},t.prototype.showResultsList=function(e){var t;t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e,t&&t!==this.featureSetCollection.get()?(this.unbindFeatureSet(),this.featureSetCollection.set(t)):this.handlePageResultsChange(),this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsList"),this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)},t.prototype.clearCurrentHighlights=function(){if(this.featureSetCollection.get()){var e=this.presentableResults.items.get();this.app.command("ClearFeatureHighlight").execute(e)}},t.prototype._switchToTabularResultsViewImpl=function(){this.app.command("ShowResultsTable").execute(this.featureSetCollection.get())},t.prototype._canExecuteSwitchToTabularResultsView=function(){return!!this.featureSetCollection.get()},t.prototype.getFeatureView=function(e){return this._featureViewMap[e]},t.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},t.prototype.unbindFeatureSet=function(){this._featureSetsBindingToken&&this._boundFeatureSetCollection&&(this._boundFeatureSetCollection.featureSets.unbind(this._featureSetsBindingToken),this._featureSetsBindingToken=null,this._boundFeatureSetCollection=null)},t.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.page=this.presentableResults.currPageNumber.get(),e.viewMode="list"},t.prototype.applyState=function(e){var t=this;e.promises.push(this.app.project.convert.toGcxFeatureSetCollection(e.state.results).then(function(i){i&&(i!==t.featureSetCollection.get()&&(t.unbindFeatureSet(),t.featureSetCollection.set(i)),s.isNullOrUndefined(e.state.page)||("grouplist"===e.state.viewMode&&(e.state.page=1),t.presentableResults.currPageNumber.set(e.state.page)),"list"!==e.state.viewMode&&"grouplist"!==e.state.viewMode||t.app.command("_setResultMappingCommand").execute(i.sourceName,"ShowResultsList"))}))},t.prototype._pulseFeatureSetsInCollection=function(){var t=this.presentableResults.currPageNumber.get();e.prototype._pulseFeatureSetsInCollection.call(this),this.presentableResults.currPageNumber.set(t)},t.prototype._clearResetUnderlyingCollection=function(e){var t=this.results.getCollectionSource();t.clear(),this.presentableResults.currPageNumber.set(1),e&&(this.unbindFeatureSet(),this._featureViewMap={})},t.prototype.bindUnderlyingCollection=function(){this._bindObservables(),this._pulseFeatureSetsInCollection()},t.prototype.unbindUndelryingCollection=function(){this._unbindObservables()},t.prototype._bindObservables=function(){var e=this;this._resultsPageBindingToken=this.resultsPage.bind(this,this.handlePageResultsChange),this._presentableResultsBindingToken=this.presentableResults.numberOfItems.bind(this,function(t){t>0?e.pagingControlClassName.set("paging-control has-pages"):e.pagingControlClassName.set("paging-control no-pages"),e.updateHeaderText(t)})},t.prototype._unbindObservables=function(){this._resultsPageBindingToken&&this.resultsPage.unbind(this._resultsPageBindingToken),this._presentableResultsBindingToken&&this.presentableResults.numberOfItems.unbind(this._presentableResultsBindingToken)},t}(i.ResultsViewModel);t.FlatResultsViewModel=l})},"geocortex/infrastructure/results/ResultsAttributeHeaderViewModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r=function(){function e(e,t,r,n){this.sortState=new i.Observable(0),this.sortClass=new i.Observable(""),this._sortingPredicate=null,this._reverseSortingPredicate=null,this.displayName=t.displayName,this._sharedState=e,"DateTime"===r?(this._sortingPredicate=this.buildDateSortingFunction(n),this._reverseSortingPredicate=this.buildReverseDateSortingFunction(n)):(this._sortingPredicate=this.buildSortingFunction(n),this._reverseSortingPredicate=this.buildReverseSortingFunction(n)),this.sortClass.syncTransform(this.sortState,function(t){switch(t){case 0:return e.unsortedClass;case 1:return e.sortedClass;case 2:return e.reverseSortedClass}return e.unsortedClass}),this.sortState.bind(this,this.onSortStateChange)}return e.prototype.buildSortingFunction=function(e){return function(i,r){return t.collator(i.attributes.getAt(e).presentableValue.get(),r.attributes.getAt(e).presentableValue.get())}},e.prototype.buildReverseSortingFunction=function(e){return function(i,r){return t.collator(r.attributes.getAt(e).presentableValue.get(),i.attributes.getAt(e).presentableValue.get())}},e.prototype.buildDateSortingFunction=function(e){return function(i,r){var n=i.attributes.getAt(e).value.get(),a=r.attributes.getAt(e).value.get(),o=new Date(n),s=new Date(a),l="Invalid Date"!=o,c="Invalid Date"!=s;return l!==c?l?-1:1:l?o.getTime()-s.getTime():t.collator(n,a)}},e.prototype.buildReverseDateSortingFunction=function(e){return function(i,r){var n=r.attributes.getAt(e).value.get(),a=i.attributes.getAt(e).value.get(),o=new Date(n),s=new Date(a),l="Invalid Date"!=o,c="Invalid Date"!=s;return l!==c?l?-1:1:l?o.getTime()-s.getTime():t.collator(n,a)}},e.prototype.onSortStateChange=function(e){if(!this._sharedState.ignoreStateChange){if(e<0||e>2)throw new Error("Illegal column sort state: "+e);if(0==e){if(this._sharedState.lastSortedColumn!=this)throw new Error("Column sort state out of sync");this._sharedState.lastSortedColumn=null,this._sharedState.presentableResults.sortingPredicate=null,this._sharedState.presentableResults.unsortCollection()}else{if(null!=this._sharedState.lastSortedColumn&&this._sharedState.lastSortedColumn!=this&&(this._sharedState.ignoreStateChange=!0,this._sharedState.lastSortedColumn.sortState.set(0),this._sharedState.ignoreStateChange=!1),this._sharedState.lastSortedColumn=this,1==e)this._sharedState.presentableResults.sortingPredicate=this._sortingPredicate;else{if(2!=e)throw new Error("Invalid column sort state.");this._sharedState.presentableResults.sortingPredicate=this._reverseSortingPredicate}this._sharedState.presentableResults.sortCollection()}}},e}();t.ResultsAttributeHeaderViewModel=r,t.manualCollator=function(e,t){return isNaN(e)||isNaN(t)?e<t?-1:e>t?1:0:+e-t},t.collator="object"==typeof Intl&&"function"==typeof Intl.Collator?new Intl.Collator((void 0),{numeric:!0}).compare:t.manualCollator;var n=function(){function e(e,t,i,r){this.lastSortedColumn=null,this.presentableResults=e,this.unsortedClass=t,this.sortedClass=i,this.reverseSortedClass=r,this.reset()}return e.prototype.reset=function(){this.ignoreStateChange=!1,this.lastSortedColumn=null},e}();t.SharedState=n})},"geocortex/infrastructure/results/ResultsFeatureActionsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleMenuItemClick=function(e,t,i){i.execute(this.viewModel.currentFeature.get())},t.prototype.handleGetDescription=function(e,t,i){t.title=i.description.get()},t}(i.ViewBase);t.ResultsFeatureActionsView=r})},"geocortex/infrastructure/results/ResultsListView":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewBase","geocortex/infrastructure/FeatureDescriptionPresenterView"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.featureClickedEventName="ResultsListFeatureClickedEvent",r.featurePressedEventName="ResultsListFeaturePressedEvent",r.featureHoveredEventName="ResultsListFeatureHoveredEvent",r.featureHoverEndEventName="ResultsListFeatureHoverEndedEvent",r.itemClass="list-menu-item",r._subscriptions=null,r._scrollTop=0,r.app.command("ShowResultsList").register(r,r.showResultsList),r.app.command("ShowResultsTable").register(r,r._handleShowResultsTable,function(){return!r.app.configuration.mobileMode}),r.app.command("SwitchToTabularResultsView").register(r,r._switchToTabularResultsViewImpl,r._canExecuteSwitchToTabularResultsView),r.app.command("_ExportResultsViewState").register(r,r._exportState),r.app.command("_ApplyResultsViewState").register(r,r._applyState),r.app.event("ViewContainerViewClosedEvent").subscribe(r,function(e){e.viewId===r.id&&r.configuration.clearCollectionOnClose&&r.viewModel.featureSetCollection.get().clear()}),r}return __extends(t,e),t.prototype.activated=function(){var t=this;if(e.prototype.activated.call(this),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var i=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),r=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:i},{eventName:"DataFrameClosedEvent",token:r}]}if(this.resultsList){var n=this.resultsList;setTimeout(function(){dojo.style(n,{display:"block"})},1)}this.viewModel.featureSetCollection.bind(this,function(e){t.app.trace.debug("View focused in results list: "+t.id),t.app.command("FocusOnFirstInputInView").execute(t)}),this.viewModel.bindUnderlyingCollection()},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.viewModel.clearCurrentHighlights(),this.viewModel.unbindUndelryingCollection(),this._unsubscribeFromEvents()},t.prototype.attach=function(t){var i=this;this.title.sync(t.headerText),this.isBusy.sync(t.isBusy),void 0!=this.configuration.isPaged&&t.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&t.presentableResults.pageSize.set(this.configuration.pageSize),this.configuration.contentField&&t.contentField.set(this.configuration.contentField),t.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){i.scrollViewTop()}),this.scrollViewTop(this._scrollTop),e.prototype.attach.call(this,t)},t.prototype.showResultsList=function(e){this.app.viewManager.activateView(this)},t.prototype.handlePageFirst=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.presentableResults.currPageNumber.set(1)},t.prototype.handlePagePrev=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()-1)},t.prototype.handlePageNext=function(e,t,i){this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()+1)},t.prototype.handlePageLast=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.lastPageNumber.get())},t.prototype.handleScrollChange=function(e,t,i){i&&(this._scrollTop=t.scrollTop)},t.prototype.getDescription=function(e,t,i){t.title=i.description.get()},t.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},t.prototype.resolveWidget=function(t,i,n){switch(e.prototype.resolveWidget.call(this,t,i),t){case"GetLabel":var a=new r.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField="label",a.root=dojo.create("div"),a.root.className="feature-label",a.attach(i),this.viewModel.setFeatureView(i.token+"-label",a),a;case"GetDescription":var a=new r.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField=this.viewModel.contentField.get(),a.root=dojo.create("div"),a.root.className="feature-description",a.attach(i),this.viewModel.setFeatureView(i.token,a),a;case"ResultsListActionsWidget":var o=this.app.menuRegistry.createMenuWidget(this,i,n);if(o)return o;break;default:return}},t.prototype._handleShowResultsTable=function(){this.app.viewManager.deactivateView(this)},t.prototype._switchToTabularResultsViewImpl=function(){this.app.command("CloseDataFrame").execute()},t.prototype._canExecuteSwitchToTabularResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},t.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},t.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},t.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},t.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},t.prototype._applyState=function(e){this.viewModel.applyState(e)},t}(i.ResultsViewBase);t.ResultsListView=n})},"geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModelInterface":function(){define(["require","exports","geocortex/infrastructure/ui/components/Table/TableColumnViewModelInterface"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(i.TableColumnViewModelInterface);t.TableColumnHeaderViewModelInterface=r})},"geocortex/infrastructure/ui/components/Table/SortState":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e[e.UNSORTED=0]="UNSORTED",e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=2]="DESCENDING"}(i=t.SortState||(t.SortState={}))})},"geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModel":function(){define(["require","exports","geocortex/framework/observables","geocortex/infrastructure/ui/components/Table/SortState","geocortex/infrastructure/FormatUtils"],function(e,t,i,r,n){"use strict";var a=function(){function e(e,t,n,a,o,s){this.visible=new i.Observable((!0)),this.value=new i.Observable(""),this.presentableValue=new i.Observable(""),this.columnDescriptor=new i.Observable(""),this.sortState=new i.Observable(r.SortState.UNSORTED),this.sortClass=new i.Observable(""),this._sortingPredicate=null,this._reverseSortingPredicate=null,this.app=e,this.libraryId=t,this.value.set(a),this.presentableValue.set(a),this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-unsorted").format(this.presentableValue.get())),this._sharedState=n,"DateTime"===o?(this._sortingPredicate=this.buildDateSortingFunction(s),this._reverseSortingPredicate=this.buildReverseDateSortingFunction(s)):(this._sortingPredicate=this.buildSortingFunction(s),this._reverseSortingPredicate=this.buildReverseSortingFunction(s)),this.sortClass.syncTransform(this.sortState,function(e){switch(e){case 0:return n.unsortedClass;case 1:return n.sortedClass;case 2:return n.reverseSortedClass}return n.unsortedClass}),this.sortState.bind(this,this.onSortStateChange)}return e.prototype.buildSortingFunction=function(e){return function(i,r){return t.collator(i.attributes.getAt(e).presentableValue.get(),r.attributes.getAt(e).presentableValue.get())}},e.prototype.buildReverseSortingFunction=function(e){return function(i,r){return t.collator(r.attributes.getAt(e).presentableValue.get(),i.attributes.getAt(e).presentableValue.get())}},e.prototype.buildDateSortingFunction=function(e){return function(i,r){var a=i.attributes.getAt(e).value.get(),o=r.attributes.getAt(e).value.get(),s=n.parseDate(a),l=n.parseDate(o),c="Invalid Date"!=s,u="Invalid Date"!=l;return c!==u?c?-1:1:c?s.getTime()-l.getTime():t.collator(a,o)}},e.prototype.buildReverseDateSortingFunction=function(e){return function(i,r){var a=r.attributes.getAt(e).value.get(),o=i.attributes.getAt(e).value.get(),s=n.parseDate(a),l=n.parseDate(o),c="Invalid Date"!=s,u="Invalid Date"!=l;return c!==u?c?-1:1:c?s.getTime()-l.getTime():t.collator(a,o)}},e.prototype.onSortStateChange=function(e){if(!this._sharedState.ignoreStateChange){if(e<r.SortState.UNSORTED||e>r.SortState.DESCENDING)throw new Error("Illegal column sort state: "+e);if(0==e){if(this._sharedState.lastSortedColumn!=this)throw new Error("Column sort state out of sync");this._sharedState.lastSortedColumn=null,this._sharedState.presentableResults.sortingPredicate=null,this._sharedState.presentableResults.unsortCollection(),this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-unsorted").format(this.presentableValue.get()))}else{if(null!=this._sharedState.lastSortedColumn&&this._sharedState.lastSortedColumn!=this&&(this._sharedState.ignoreStateChange=!0,this._sharedState.lastSortedColumn.sortState.set(r.SortState.UNSORTED),this._sharedState.ignoreStateChange=!1),this._sharedState.lastSortedColumn=this,e==r.SortState.ASCENDING)this._sharedState.presentableResults.sortingPredicate=this._sortingPredicate,this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-sorted-ascending").format(this.presentableValue.get()));else{if(e!=r.SortState.DESCENDING)throw new Error("Invalid column sort state.");this._sharedState.presentableResults.sortingPredicate=this._reverseSortingPredicate,this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-sorted-descending").format(this.presentableValue.get()))}this._sharedState.presentableResults.sortCollection()}}},e}();t.TableColumnHeaderViewModel=a,t.manualCollator=function(e,t){return isNaN(e)||isNaN(t)?e<t?-1:e>t?1:0:+e-t},t.collator="object"==typeof Intl&&"function"==typeof Intl.Collator?new Intl.Collator((void 0),{numeric:!0}).compare:t.manualCollator;var o=function(){function e(e,t,i,r){this.lastSortedColumn=null,this.presentableResults=e,this.unsortedClass=t,this.sortedClass=i,this.reverseSortedClass=r,this.reset()}return e.prototype.reset=function(){this.ignoreStateChange=!1,this.lastSortedColumn=null},e}();t.SharedState=o})},"geocortex/infrastructure/results/TabbedResultsViewModel":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewModel","geocortex/framework/observables","geocortex/infrastructure/FeatureSet","geocortex/framework-ui/PresentableCollection","geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModel","geocortex/infrastructure/FeatureSetCollection","geocortex/framework/utils/ArrayUtils","geocortex/infrastructure/ui/components/Table/SortState","geocortex/framework/utils/utils","geocortex/infrastructure/eventArgs/ResultsPageChangedEventArgs","geocortex/infrastructure/results/ResultsUtils"],function(e,t,i,r,n,a,o,s,l,c,u,d,p){"use strict";var h=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.curFeatureSet=new r.Observable(null),o.currPageWithinTab={},o.currScrollPosWithinTab={},o.presentableResults=new a.PresentableCollection,o.pageControlsEnabled=new r.Observable((!1)),o.tabControlsEnabled=new r.Observable((!1)),o.resultsTable=new r.Observable("results-table"),o.columnSharedState=null,o.columnHeaders=new r.ObservableCollection([]),o.leftScrollTabDisabled=new r.Observable((!1)),o.rightScrollTabDisabled=new r.Observable((!1)),o._firstVisibleTab=0,o._emptyFeatureSet=new n.FeatureSet({app:o.app}),o._boundFeatureSets=null,o._featureSetsBindingToken=null,o._curFeatureSetBindingToken=null,o._presentableResultsBindingToken=null,o._resultsPageBindingToken=null,o.presentableResults.items.useThrottling=!0,o.resultsPage=o.presentableResults.items,o.presentableResults.pageSize.set(o.defaultPageSize),o.defaultIsPaged!=o.presentableResults.isPaginated.get()&&o.presentableResults.isPaginated.set(o.defaultIsPaged),o.app.command("ShowResultsTable").register(o,o.showResultsTable,function(){return!o.app.configuration.mobileMode}),o.app.command("SwitchToListResultsView").register(o,o._switchToListResultsViewImpl,o._canExecuteSwitchToListResultsView),o}return __extends(t,e),t.prototype.handleCollectionChanged=function(t){if(e.prototype.handleCollectionChanged.call(this,t),this.unbindFeatureSets(),t&&t.featureSets){this._featureSetsBindingToken=t.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSets=t.featureSets,this._firstVisibleTab=0;for(var i=null,r=0;r<t.featureSets.length();r++)if(t.featureSets.getAt(r).isSelectedInCollection.get()){i=t.featureSets.getAt(r);break}!i&&t.featureSets.length()>0&&(i=t.featureSets.getAt(0)),i!==this.curFeatureSet.get()&&(this.setCurrentSelectedFeatureSet(i),this.currPageWithinTab={},this.currScrollPosWithinTab={}),e.prototype.updateHeaderText.call(this,i?i.features.length():this.featureSetCollection.get().countFeatures())}},t.prototype.handleCurrentFeatureSetChanged=function(e){this.presentableResults.sortingPredicate=null,e&&this.presentableResults.items!==e.features&&(this.presentableResults.attachToCollection(e.features),this.buildColumnHeaders(e))},t.prototype.handleFeatureSetsChanged=function(t){e.prototype.handleFeatureSetsChanged.call(this,t);var i=t.sender;if("append"===t.type){0===t.rangeStart&&this.setCurrentSelectedFeatureSet(i.getAt(0));for(var r=t.rangeStart;r<=t.rangeEnd;r++)i.getAt(r).isSelectedInCollection.get()&&this.setCurrentSelectedFeatureSet(i.getAt(r))}else if("remove"===t.type){var n=this.curFeatureSet.get();if(n){var a=i.indexOf(n);a>=t.rangeStart&&a<=t.rangeEnd&&(t.rangeEnd+1<i.length()?this.setCurrentSelectedFeatureSet(i.getAt(t.rangeEnd+1)):t.rangeStart>0?this.setCurrentSelectedFeatureSet(i.getAt(t.rangeStart-1)):this.setCurrentSelectedFeatureSet(null))}}},t.prototype.showResultsTable=function(e){var t;if(e instanceof s.FeatureSetCollection)t=e;else{if("string"!=typeof e)return;t=this.app.featureSetManager.getCollectionById(e)}if(t){if(t!==this.featureSetCollection.get())this.unbindFeatureSets(),this.featureSetCollection.set(t);else{var i=this.featureSetCollection.get().featureSets.get().filter(function(e){return e.isSelectedInCollection.get()})[0];i?this.setCurrentSelectedFeatureSet(i):this.featureSetCollection.get().featureSets.length()>0&&this.setCurrentSelectedFeatureSet(this.featureSetCollection.get().featureSets.getAt(0)),this._handlePageResultsChange()}this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsTable")}this.currPageWithinTab={},this.currScrollPosWithinTab={}},t.prototype.clearCurrentHighlights=function(){if(this.curFeatureSet.get()){var e=this.curFeatureSet.get().features.getItems();this.app.command("ClearFeatureHighlight").execute(e)}},t.prototype._switchToListResultsViewImpl=function(){this.curFeatureSet.get()?this.curFeatureSet.get().isSelectedInCollection.get()?(this.app.command("ShowResultsList").execute(this.featureSetCollection.get()),this.app.command("ShowFeatureSetResultsView").execute(this.curFeatureSet.get())):(this.app.command("ShowResultsList").execute(this.featureSetCollection.get()),0===this.featureSetCollection.get().countFeatures()&&p.showResultsStatusMessage(this.app,0)):(this.app.command("ShowResultsList").execute(this.featureSetCollection.get()),p.showResultsStatusMessage(this.app,this.featureSetCollection.get().countFeatures()))},t.prototype._canExecuteSwitchToListResultsView=function(){return!!this.featureSetCollection.get()},t.prototype.setCurrentSelectedFeatureSet=function(e){for(var t=this.featureSetCollection.get().featureSets,i=0;i<t.length();i++)t.getAt(i).isSelectedInCollection.set(t.getAt(i)===e);e&&this.curFeatureSet.get()!==e&&this.curFeatureSet.set(e)},t.prototype.unbindFeatureSets=function(){this._featureSetsBindingToken&&this._boundFeatureSets&&this._boundFeatureSets.unbind(this._featureSetsBindingToken),this._boundFeatureSets=null,this._featureSetsBindingToken=null},t.prototype.buildColumnHeaders=function(e){this.columnHeaders.clear(),this.columnSharedState?this.columnSharedState.reset():this.columnSharedState=new o.SharedState(this.presentableResults,"sort","sort-up","sort-down");var t,i={};if(e.layer&&e.layer.fields)for(t=0;t<e.layer.fields.length;t++){var r=e.layer.fields[t];i[r.name]=r.dataType}var n=e.attributes.length();for(n||(e.loadAttributes(),n=e.attributes.length()),t=0;t<n;t++){var a=e.attributes.getAt(t);a.visible&&!a.visible.get()||this.columnHeaders.addItem(new o.TableColumnHeaderViewModel(this.app,this.libraryId,this.columnSharedState,a.displayName.get(),i[a.name.get()],t))}},t.prototype.setCurrentPageWithinTab=function(e){this.currPageWithinTab[e]?this.currPageWithinTab[e]!==this.presentableResults.currPageNumber.get()&&this.presentableResults.currPageNumber.set(this.currPageWithinTab[e]):this.currPageWithinTab[e]=this.presentableResults.currPageNumber.get()},t.prototype.updateCurrentPageAndScrollPosWithinTab=function(e,t){this.currScrollPosWithinTab[this.curFeatureSet.get().uniqueId]=t,this.currPageWithinTab[this.curFeatureSet.get().uniqueId]=e},t.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.viewMode="table",e.page=this.presentableResults.currPageNumber.get();var i=l.firstOrDefault(t.featureSets.get(),function(e){return e.isSelectedInCollection.get()});if(i){e.openedFeatureSet=this.app.project.convert.fromGcxFeatureSet(i);var r=l.firstOrDefault(this.columnHeaders.get(),function(e){return e.sortState.get()!==c.SortState.UNSORTED});r&&(e.tableOptions={},e.tableOptions.sortColumn=this.columnHeaders.get().indexOf(r),e.tableOptions.sortDirection=r.sortState.get()===c.SortState.ASCENDING?"asc":"desc")}},t.prototype.applyState=function(e){var t=this;if(2==e.state.serialVersion)var i={results:this.app.project.convert.toGcxFeatureSetCollection(e.state.results),selectedFeatureSet:e.state.openedFeatureSet?this.app.project.convert.toGcxFeatureSet(e.state.openedFeatureSet)["catch"](function(e){}):null};else var i={results:this.app.project.convert.toGcxFeatureSetCollection(e.state.results),selectedFeatureSet:e.state.tableOptions?this.app.project.convert.toGcxFeatureSet(e.state.tableOptions.selectedFeatureSet)["catch"](function(e){}):null};e.promises.push(Promise.props(i).then(function(i){if(i.results){i.results!==t.featureSetCollection.get()&&(t.unbindFeatureSets(),t.featureSetCollection.set(i.results)),"table"===e.state.viewMode&&t.app.command("_setResultMappingCommand").execute(i.results.sourceName,"ShowResultsTable");var r=l.firstOrDefault(i.results.featureSets.get(),function(e){return e===i.selectedFeatureSet});if(r&&(t.setCurrentSelectedFeatureSet(r),u.isNullOrUndefined(e.state.page)||(t.updateCurrentPageAndScrollPosWithinTab(t.presentableResults.currPageNumber.get(),0),t.presentableResults.currPageNumber.set(e.state.page)),e.state.tableOptions&&!u.isNullOrUndefined(e.state.tableOptions.sortColumn))){var n=t.columnHeaders.getAt(e.state.tableOptions.sortColumn);n&&n.sortState.set("desc"===e.state.tableOptions.sortDirection?c.SortState.DESCENDING:c.SortState.ASCENDING)}}}))},t.prototype._handlePageResultsChange=function(e){e=e?e:{type:null};var t="clear"===e.type||"remove"===e.type&&e.sender.value.length<=1,i=new d.ResultsPageChangedEventArgs;
i.featureSetCollection=this.featureSetCollection.get(),i.newValue=t?new r.ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(i),this.app.behavior("ResultsPageChangedBehavior").run(i.newValue.get())},t.prototype._pulseUnderlyingCollection=function(){if(this.curFeatureSet.get()){var e=this.presentableResults.currPageNumber.get();this.curFeatureSet.pulse(),this.presentableResults.currPageNumber.set(e)}},t.prototype.bindUnderlyingCollections=function(){this._bindObservables(),this._pulseUnderlyingCollection()},t.prototype.unbindUnderlyingCollections=function(){this._unbindObservables()},t.prototype._bindObservables=function(){this._curFeatureSetBindingToken||(this._curFeatureSetBindingToken=this.curFeatureSet.bind(this,this.handleCurrentFeatureSetChanged)),this._presentableResultsBindingToken||(this._presentableResultsBindingToken=this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)),this._resultsPageBindingToken||(this._resultsPageBindingToken=this.resultsPage.bind(this,this._handlePageResultsChange))},t.prototype._unbindObservables=function(){this._curFeatureSetBindingToken&&(this.curFeatureSet.unbind(this._curFeatureSetBindingToken),this._curFeatureSetBindingToken=null),this._presentableResultsBindingToken&&(this.presentableResults.numberOfItems.unbind(this._presentableResultsBindingToken),this._presentableResultsBindingToken=null),this._resultsPageBindingToken&&(this.resultsPage.unbind(this._resultsPageBindingToken),this._resultsPageBindingToken=null)},t}(i.ResultsViewModel);t.TabbedResultsViewModel=h})},"geocortex/infrastructure/ui/components/Table/TableViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.columnHeaders=new r.ObservableCollection([]),n.records=new r.ObservableCollection([]),n.presentableRecordCollection=null,n.recordClickEvents=[],n.recordLongPressEvents=[],n.recordHoverEvents=[],n.recordHoverEndEvents=[],n.recordLongPressDuration=1e3,n.recordHoverDuration=0,n}return __extends(t,e),t.prototype.attachToPresentableCollection=function(e){e&&e instanceof n.PresentableCollection&&(this.presentableRecordCollection=e,this.records=this.presentableRecordCollection.items)},t.prototype.addRecordClickEvents=function(e){this._executeAddEvents(e,0)},t.prototype.addRecordLongPressEvents=function(e){this._executeAddEvents(e,1)},t.prototype.addRecordHoverEvents=function(e){this._executeAddEvents(e,2)},t.prototype.addRecordHoverEndEvents=function(e){this._executeAddEvents(e,3)},t.prototype._executeAddEvents=function(e,t){var i=this,r=function(e){e&&"string"==typeof e&&(0===t?(i.recordClickEvents=i.recordClickEvents.filter(function(t){return t!==e}),i.recordClickEvents.push(e)):1===t?(i.recordLongPressEvents=i.recordLongPressEvents.filter(function(t){return t!==e}),i.recordLongPressEvents.push(e)):2===t?(i.recordHoverEvents=i.recordHoverEvents.filter(function(t){return t!==e}),i.recordHoverEvents.push(e)):3===t&&(i.recordHoverEndEvents=i.recordHoverEndEvents.filter(function(t){return t!==e}),i.recordHoverEndEvents.push(e)))};e&&dojo.isArray(e)?e.forEach(function(e){return r(e)}):r(e)},t}(i.ViewModelBase);t.TableViewModel=a})},"geocortex/infrastructure/ui/components/Table/TableView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/ShellUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tableContainerElement=null,t._itemClass="results-table-row-item",t._longPressTimer=null,t._pressStartTime=null,t._firedTouchOrPress=!1,t._hoverTimerToken=null,t._hoveredFeature=null,t._pressYStart=null,t._lastTouchY=null,t._scrollYDeltaThreshold=35,t._firstEvent=null,t}return __extends(t,e),t.prototype.handleColumnHeadClick=function(e,t,i){i.sortState.set((i.sortState.get()+1)%3)},t.prototype.handleMouseDown=function(e,t,i){return this._beginLongPressIfNoEventsInProgress(i,"mouse-down"),!0},t.prototype.handleMouseUp=function(e,t,i){return this._cancelLongPressIfEventInProgress("mouse-down"),!0},t.prototype.handleMouseOver=function(e,t,i){r.hasClass(e.currentTarget,this._itemClass)&&this._beginHover(i)},t.prototype.handleMouseOut=function(e,t,i){r.hasClass(e.currentTarget,this._itemClass)&&(this._cancelHover(),this._tryFireHoverStop(i),this._cancelLongPressIfEventInProgress("mouse-down"))},t.prototype.handleTouchStart=function(e,t,i){return this._beginLongPressIfNoEventsInProgress(i,"touch-start"),!0},t.prototype.handleTouchMove=function(e,t,i){return this.handleTouchEnd(e,t,i)},t.prototype.handleTouchEnd=function(e,t,i){return this._cancelLongPressIfEventInProgress("touch-start"),!0},t.prototype.handleClick=function(e,t,i){var r=this;return this.viewModel&&this.viewModel.recordClickEvents.length&&this.viewModel.recordClickEvents.forEach(function(e){return r.app.event(e).publish(i)}),!0},t.prototype.handleClickAttributelink=function(e,t,i){return this.app.followNavigationLink({url:i.value.get(),element:t})},t.prototype._beginLongPressIfNoEventsInProgress=function(e,t){this._firstEvent||(this._firstEvent=t,this._beginLongPress(e))},t.prototype._cancelLongPressIfEventInProgress=function(e){this._firstEvent===e&&(this._firstEvent=null,this._cancelLongPress())},t.prototype._beginLongPress=function(e){var t=this;this._cancelLongPress(),this.viewModel&&this.viewModel.recordLongPressEvents.length&&(this._longPressTimer=setTimeout(function(){t.viewModel.recordLongPressEvents.forEach(function(i){t.app.event(i).publish(e)},t.viewModel.recordLongPressDuration||1e3)}))},t.prototype._cancelLongPress=function(){this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null)},t.prototype._beginHover=function(e){var t=this;this._hoverTimerToken&&clearTimeout(this._hoverTimerToken),this._hoverTimerToken=setTimeout(function(){t._hoveredFeature!==e&&(t._hoveredFeature=e),t.viewModel.recordHoverEvents.forEach(function(i){t.app.event(i).publish(e)})},this.viewModel.recordHoverDuration||0)},t.prototype._cancelHover=function(){this._hoverTimerToken&&(clearTimeout(this._hoverTimerToken),this._hoverTimerToken=null)},t.prototype._tryFireHoverStop=function(e){var t=this;this._hoveredFeature===e&&(this._hoveredFeature=null,this.viewModel.recordHoverEndEvents.forEach(function(i){t.app.event(i).publish(e)}))},t}(i.ViewBase);t.TableView=n})},"geocortex/infrastructure/results/ResultsTableView":function(){define(["require","exports","geocortex/infrastructure/results/ResultsViewBase","geocortex/infrastructure/ui/components/Table/TableViewModel"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.featureClickedEventName="ResultsTableFeatureClickedEvent",r.featurePressedEventName="ResultsTableFeaturePressedEvent",r.featureHoveredEventName="ResultsTableFeatureHoveredEvent",r.featureHoverEndEventName="ResultsTableFeatureHoverEndedEvent",r.scrollContainerElement=null,r.tabContainerElement=null,r.tabElements=null,r.scrollTabLeftElement=null,r.scrollTabRightElement=null,r._fsBindingToken=null,r._boundFs=null,r.app.command("ShowResultsTable").register(r,r.showResultsTable,function(){return!r.app.configuration.mobileMode}),r.app.command("ShowResultsList").register(r,r._handleShowResultsList),r.app.command("_ExportResultsViewState").register(r,r._exportState),r.app.command("_ApplyResultsViewState").register(r,r._applyState),r.app.event("ViewContainerViewClosedEvent").subscribe(r,function(e){e.viewId===r.id&&r.configuration.clearCollectionOnClose!==!1&&r.viewModel.featureSetCollection.get().clear()}),r}return __extends(t,e),t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.viewModel.clearCurrentHighlights(),this.viewModel.unbindUnderlyingCollections()},t.prototype.activated=function(){this.viewModel.bindUnderlyingCollections()},t.prototype.attach=function(t){var i=this;this.title.sync(t.headerText),this.isBusy.sync(t.isBusy),void 0!=this.configuration.isPaged&&t.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&t.presentableResults.pageSize.set(this.configuration.pageSize),t.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){var e=i.viewModel.curFeatureSet.get(),t=e?i.viewModel.currScrollPosWithinTab[e.uniqueId]||0:0;i.scrollView(t)}),e.prototype.attach.call(this,t)},t.prototype.resolveWidget=function(t,i,n){switch(e.prototype.resolveWidget.call(this,t,i),t){case"ResultsTableActionsWidget":return this.app.menuRegistry.createMenuWidget(this,i,n);case"TableViewWidget":var a=this.viewModel,o=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableView",markupResource:"Mapping/infrastructure/ui/components/Table/TableView.html",libraryId:this.libraryId,isVisible:!0});if(o){var s=new r.TableViewModel(this.app,this.libraryId);s.addRecordClickEvents(this.featureClickedEventName),s.addRecordLongPressEvents(this.featurePressedEventName),s.addRecordHoverEvents(this.featureHoveredEventName),s.addRecordHoverEndEvents(this.featureHoverEndEventName),s.columnHeaders=this.viewModel.columnHeaders,s.attachToPresentableCollection(a.presentableResults),o.attach(s),this.scrollContainerElement=o.tableContainerElement}return o;default:this.app.trace.warning("ResultsTableView: Unknown Widget")}},t.prototype.showResultsTable=function(e){var t=this;this.app.viewManager.activateView(this),this.viewModel.featureSetCollection.get()&&(this._unbindFromPrevFeatureSet(),this._boundFs=this.viewModel.featureSetCollection.get().featureSets,this._boundFs&&(this._fsBindingToken=this.viewModel.featureSetCollection.get().featureSets.bind(this,this._refreshTabControlVisibility)));var i=null,r=this.app.event("ApplicationResizedEvent").subscribe(this,function(){t.isActive?(i&&(clearTimeout(i),i=null),i=setTimeout(function(){t._refreshTabControlVisibility()},200)):(t.app.event("ApplicationResizedEvent").unsubscribe(r),r=null)});this._refreshTabControlVisibility()},t.prototype._refreshTabControlVisibility=function(){var e=this;setTimeout(function(){e.tabContainerElement&&e.tabElements&&(e.viewModel.tabControlsEnabled.set(e.tabElements.offsetWidth>e.tabContainerElement.offsetWidth),e._updateScrollTabDisabledStatus())},100)},t.prototype.handleTabClick=function(e,t,i){this.scrollContainerElement&&(this.viewModel.currScrollPosWithinTab[this.viewModel.curFeatureSet.get().uniqueId]=this.scrollContainerElement.scrollTop);var r=dojo.filter(this.viewModel.featureSetCollection.get().featureSets.get(),function(e){return e.uniqueId===i.uniqueId});r&&r[0]&&this.viewModel.curFeatureSet.get()!==r[0]&&(this.viewModel.clearCurrentHighlights(),this.viewModel.setCurrentSelectedFeatureSet(r[0]),this.viewModel.setCurrentPageWithinTab(i.uniqueId)),this.app.command("FocusOnFirstInputInView").execute(this)},t.prototype.handlePageFirst=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&(this.viewModel.updateCurrentPageAndScrollPosWithinTab(1,0),this.viewModel.presentableResults.currPageNumber.set(1))},t.prototype.handlePagePrev=function(e,t,i){if(this.viewModel.presentableResults.currPageNumber.get()>1){var r=this.viewModel.presentableResults.currPageNumber.get()-1;this.viewModel.updateCurrentPageAndScrollPosWithinTab(r,0),this.viewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handlePageNext=function(e,t,i){if(this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()){var r=this.viewModel.presentableResults.currPageNumber.get()+1;this.viewModel.updateCurrentPageAndScrollPosWithinTab(r,0),this.viewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handlePageLast=function(e,t,i){if(this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()){var r=this.viewModel.presentableResults.lastPageNumber.get();this.viewModel.updateCurrentPageAndScrollPosWithinTab(r,0),this.viewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handleTabScrollBack=function(e,t,i){var r=$(this.tabContainerElement),n=r.scrollLeft()-2*this.scrollTabLeftElement.offsetWidth;r.scrollLeft(n<0?0:n),this._updateScrollTabDisabledStatus()},t.prototype.handleTabScrollForward=function(e,t,i){var r=$(this.tabContainerElement),n=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth,a=r.scrollLeft()+2*this.scrollTabRightElement.offsetWidth;r.scrollLeft(a>n?n:a),this._updateScrollTabDisabledStatus()},t.prototype.handleClickFeature=function(e,t,i){this.app.event("ResultsTableFeatureClickedEvent").publish(i)},t.prototype.handleColumnHeadClick=function(e,t,i){i.sortState.set((i.sortState.get()+1)%3)},t.prototype._handleShowResultsList=function(){this.app.viewManager.deactivateView(this)},t.prototype._canExecuteSwitchToListResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},t.prototype._updateScrollTabDisabledStatus=function(){if(this.tabContainerElement){var e=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth;this.viewModel.leftScrollTabDisabled.set(0===this.tabContainerElement.scrollLeft),this.viewModel.rightScrollTabDisabled.set(this.tabContainerElement.scrollLeft>e-1)}},t.prototype._unbindFromPrevFeatureSet=function(){this._fsBindingToken&&this._boundFs&&this._boundFs.unbind(this._fsBindingToken),this._fsBindingToken=this._boundFs=null},t.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},t.prototype._applyState=function(e){this.viewModel.applyState(e)},t}(i.ResultsViewBase);t.ResultsTableView=n})},"geocortex/infrastructure/selection/CombineMode":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e.REPLACE="replace",e.UNION="union",e.SUBTRACT="subtract",e.INTERSECT="intersect"}(i=t.CombineMode||(t.CombineMode={}))})},"geocortex/infrastructure/selection/SelectionMetadataQuery":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/selection/SelectionMetadataStore":function(){define(["require","exports","geocortex/infrastructure/Dictionary","geocortex/framework/utils/ArrayUtils","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(){function e(e){this._store=new i.Dictionary,this.app=e}return e.prototype.findByName=function(e){var t={name:e},i=this.find(t);return r.firstOrDefault(i)},e.prototype.findByCollectionId=function(e){var t={featureSetCollectionIds:[e]},i=this.find(t);return r.firstOrDefault(i)},e.prototype.findById=function(e){var t={ids:[e]},i=this.find(t);return r.firstOrDefault(i)},e.prototype.findAll=function(){return this.find()},e.prototype.find=function(e){e=e||{};var t=this._store.values();if(e.ids&&e.ids.length>0&&(t=t.filter(function(t){return e.ids.indexOf(t.id)>-1})),e.featureSetCollectionIds&&e.featureSetCollectionIds.length>0&&(t=t.filter(function(t){return e.featureSetCollectionIds.indexOf(t.featureSetCollectionId)>-1})),e.name&&(t=t.filter(function(t){return t.name&&t.name==e.name})),e.dateCreatedMin&&e.dateCreatedMin instanceof Date){var i=e.dateCreatedMin.getTime();t=t.filter(function(e){return"undefined"!=typeof e.timeCreated&&e.timeCreated>=i})}if(e.dateCreatedMax&&e.dateCreatedMax instanceof Date){var r=e.dateCreatedMax.getTime();t=t.filter(function(e){return"undefined"!=typeof e.timeCreated&&e.timeCreated<=r})}if(e.dateModifiedMin&&e.dateModifiedMin instanceof Date){var n=e.dateModifiedMin.getTime();t=t.filter(function(e){return"undefined"!=typeof e.timeModified&&e.timeModified>=n})}if(e.dateModifiedMax&&e.dateModifiedMax instanceof Date){var a=e.dateModifiedMax.getTime();t=t.filter(function(e){return"undefined"!=typeof e.timeModified&&e.timeModified<=a})}if(e.dateExpirationMin&&e.dateExpirationMin instanceof Date){var o=e.dateExpirationMin.getTime();t=t.filter(function(e){return"undefined"!=typeof e.timeExpiration&&e.timeExpiration>=o})}if(e.dateExpirationMax&&e.dateExpirationMax instanceof Date){var s=e.dateExpirationMax.getTime();t=t.filter(function(e){return"undefined"!=typeof e.timeExpiration&&e.timeExpiration<=s})}return t.map(function(e){return dojo.mixin({},e)})},e.prototype.add=function(e){if(!e)throw new Error("The selection metadata cannot be null.");var t=dojo.mixin({},e),i=t.id=this._generateId();return this._store.set(i,t),i},e.prototype.updateById=function(e,t){if(!e)throw new Error("The metadata ID must be set.");if(!t)throw new Error("The selection metadata cannot be null.");if(!this._store.containsKey(e))throw new Error("Selection metadata with ID '{0}' not found.".format(e));var i=this._store.get(e);this._update(i,t)},e.prototype.removeById=function(e){if(!e)throw new Error("The metadata ID must be set.");this._store.remove(e)},e.prototype.clear=function(){this._store.clear()},e.prototype._update=function(e,t){e.name=t.name,e.count=t.count,e.timeCreated=t.timeCreated,e.timeModified=t.timeModified,e.timeExpiration=e.timeExpiration,e.featureSetCollectionId=t.featureSetCollectionId,e.modified=t.modified},e.prototype._generateId=function(){return n.alphaNumericToken()},e}();t.SelectionMetadataStore=a})},"geocortex/infrastructure/sharing/SharingLinkProviderBase":function(){define(["require","exports"],function(e,t){"use strict";var i;!function(e){e[e.SCALE=0]="SCALE",e[e.CENTER=1]="CENTER",e[e.EXTENT=2]="EXTENT"}(i=t.ExtentLinkPriority||(t.ExtentLinkPriority={}));var r;!function(e){e[e.LAYERTHEME=0]="LAYERTHEME",e[e.LAYERS=1]="LAYERS"}(r=t.LayerListLinkPriority||(t.LayerListLinkPriority={}));var n=function(){function e(e,t){this.acceptParameter=!0,this.generateParameter=!0,this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){},e.prototype.generate=function(){return""},e.prototype.apply=function(e){},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();t.SharingLinkProviderBase=n})},"geocortex/infrastructure/snapping/SnappingLocations":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/snapping/SnappingProvider":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/NumericInput/RangeConfiguration":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/ColorPicker/ColorPickerViewModel":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/NumericInput/NumericInputViewModel":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/widgets/SimpleSymbolWidgetViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/ColorUtils","geocortex/infrastructure/SymbolUtils"],function(e,t,i,r,n,a,o){"use strict";var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configuring=!1,t.isPoint=new r.Observable((!1)),t.isLine=new r.Observable((!1)),t.isPolygon=new r.Observable((!1)),t.showLineStyles=new r.Observable((!1)),t.showOutlineColor=new r.Observable((!1)),t.noOutlineSymbol=new r.Observable((!1)),t.markerSize=new r.Observable(10),t.markerSizeViewModel={range:{min:1,max:25,value:t.markerSize,step:1},showSlider:!0,updateOnDrag:!0},t.lineWidth=new r.Observable(2),t.lineWidthViewModel={range:{min:0,max:5,value:t.lineWidth,step:1},showSlider:!0,updateOnDrag:!0},t.fill={color:new r.Observable},t.outline={color:new r.Observable},t.initialized=!1,t.markerStyleIdLookup={circle:"esriSMSCircle",cross:"esriSMSCross",diamond:"esriSMSDiamond",square:"esriSMSSquare",x:"esriSMSX"},t.lineStyleIdLookup={solid:"esriSLSSolid",dash:"esriSLSDash",dashdot:"esriSLSDashDot",longdashdotdot:"esriSLSDashDotDot",dot:"esriSLSDot",longdash:"esriSLSLongDash",longdashdot:"esriSLSLongDashDot",shortdash:"esriSLSShortDash",shortdashdot:"esriSLSShortDashDot",shortdashdotdot:"esriSLSShortDashDotDot",shortdot:"esriSLSShortDot"},t.fillStyleIdLookup={solid:"esriSFSSolid",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical",cross:"esriSFSCross",diagonalcross:"esriSFSDiagonalCross",forwarddiagonal:"esriSFSForwardDiagonal",backwarddiagonal:"esriSFSBackwardDiagonal","null":"esriSFSNull"},t.markerStyles=new r.ObservableCollection([{style:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,label:t.getResource("language-symbology-settings-marker-style-circle")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_CROSS,label:t.getResource("language-symbology-settings-marker-style-cross")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,label:t.getResource("language-symbology-settings-marker-style-diamond")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,label:t.getResource("language-symbology-settings-marker-style-square")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_X,label:t.getResource("language-symbology-settings-marker-style-x")}]),t.lineStyles=new r.ObservableCollection([{style:esri.symbol.SimpleLineSymbol.STYLE_SOLID,label:t.getResource("language-symbology-settings-line-style-solid"),styleId:"esriSLSSolid"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASH,label:t.getResource("language-symbology-settings-line-style-dash"),styleId:"esriSLSDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,label:t.getResource("language-symbology-settings-line-style-dashdot"),styleId:"esriSLSDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT,label:t.getResource("language-symbology-settings-line-style-dashdotdot"),styleId:"esriSLSDashDotDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_DOT,label:t.getResource("language-symbology-settings-line-style-dot"),styleId:"esriSLSDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_LONGDASH,label:t.getResource("language-symbology-settings-line-style-longdash"),styleId:"esriSLSLongDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_LONGDASHDOT,label:t.getResource("language-symbology-settings-line-style-longdashdot"),styleId:"esriSLSLongDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASH,label:t.getResource("language-symbology-settings-line-style-shortdash"),styleId:"esriSLSShortDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASHDOT,label:t.getResource("language-symbology-settings-line-style-shortdashdot"),styleId:"esriSLSShortDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASHDOTDOT,label:t.getResource("language-symbology-settings-line-style-shortdashdotdot"),styleId:"esriSLSShortDashDotDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,label:t.getResource("language-symbology-settings-line-style-shortdot"),styleId:"esriSLSShortDot"}]),t.fillStyles=new r.ObservableCollection([{style:esri.symbol.SimpleFillSymbol.STYLE_SOLID,label:t.getResource("language-symbology-settings-fill-style-solid"),styleId:"esriSFSSolid"},{style:esri.symbol.SimpleFillSymbol.STYLE_HORIZONTAL,label:t.getResource("language-symbology-settings-fill-style-horizontal"),styleId:"esriSFSHorizontal"},{style:esri.symbol.SimpleFillSymbol.STYLE_VERTICAL,label:t.getResource("language-symbology-settings-fill-style-vertical"),styleId:"esriSFSVertical"},{style:esri.symbol.SimpleFillSymbol.STYLE_CROSS,label:t.getResource("language-symbology-settings-fill-style-cross"),styleId:"esriSFSCross"},{style:esri.symbol.SimpleFillSymbol.STYLE_DIAGONAL_CROSS,label:t.getResource("language-symbology-settings-fill-style-diagonal-cross"),styleId:"esriSFSDiagonalCross"},{style:esri.symbol.SimpleFillSymbol.STYLE_FORWARD_DIAGONAL,label:t.getResource("language-symbology-settings-fill-style-forward-diagonal"),styleId:"esriSFSForwardDiagonal"},{style:esri.symbol.SimpleFillSymbol.STYLE_BACKWARD_DIAGONAL,label:t.getResource("language-symbology-settings-fill-style-backward-diagonal"),styleId:"esriSFSBackwardDiagonal"}]),t}return __extends(t,e),t.prototype.initialize=function(e){var t=this;void 0===e&&(e={}),this.initialized&&(this.initialized=!1);var i=this.app.configModel.widgetConfigs.filter(function(e){return"SimpleSymbolWidget"===e.id})[0],r={};i?($.extend(r,i.configuration,e),this.config=r):this.config=e,null==this.config.showSliders&&(this.config.showSliders=!0),null==this.config.adaptOutlineToFill&&(this.config.adaptOutlineToFill=!0),this.isLine.bind(this,function(e){t.showLineStyles.set(e||t.isPolygon.get()),t.config.userSelectedOutlineColor&&t.showOutlineColor.set(e||t.isPolygon.get())}),this.isPolygon.bind(this,function(e){t.showLineStyles.set(e||t.isLine.get()),t.config.userSelectedOutlineColor&&t.showOutlineColor.set(e||t.isPoint.get())}),this.isPoint.bind(this,function(e){t.showLineStyles.set(!e||t.isLine.get()||t.isPolygon.get()),t.config.userSelectedOutlineColor&&t.showOutlineColor.set(!e||t.isPolygon.get()||t.isPoint.get())}),this.config.markerSize=this.config.markerSize||{min:1,max:25,value:10,step:1},this.markerSize.set(this.config.markerSize.value),this.markerSizeViewModel={range:{min:this.config.markerSize.min,max:this.config.markerSize.max,value:this.markerSize,step:this.config.markerSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.lineWidth=this.config.lineWidth||{min:0,max:5,value:2,step:1},this.lineWidth.set(this.config.lineWidth.value),this.lineWidthViewModel={range:{min:this.config.lineWidth.min,max:this.config.lineWidth.max,value:this.lineWidth,step:this.config.lineWidth.step},showSlider:this.config.showSliders,updateOnDrag:!0},void 0!==this.config.markerStyles&&(this.markerStyles.set(this.config.markerStyles),this.markerStyleIndex=0),void 0!==this.config.lineStyles&&(this.lineStyles.set(this.config.lineStyles),this.lineStyleIndex=0),void 0!==this.config.fillStyles&&(this.fillStyles.set(this.config.fillStyles),this.fillStyleIndex=0),void 0!==this.config.userSelectedOutlineColor&&this.showOutlineColor.set(this.config.userSelectedOutlineColor),this.fill.color.set(a.generateRandomColor()),this.outline.color.set(this.fill.color.get().value>=.7?this.fill.color.get().darken(.6):this.fill.color.get().lighten(.8)),this.initialized=!0},t.prototype._reset=function(){this.configuring=!0,this.markerSize.set(this.config.markerSize.value),this.lineWidth.set(this.config.lineWidth.value),this.markerStyleIndex=0,this.lineStyleIndex=0,this.fillStyleIndex=0,this.fill.color.set(a.generateRandomColor()),this.outline.color.set(this.fill.color.get().value>=.7?this.fill.color.get().darken(.6):this.fill.color.get().lighten(.8)),this.configuring=!1},t.prototype._setFeatureType=function(e){e=e.toLowerCase(),e.indexOf("point")>-1?(this.isPoint.set(!0),this.isLine.set(!1),this.isPolygon.set(!1)):e.indexOf("line")>-1?(this.isLine.set(!0),this.isPoint.set(!1),this.isPolygon.set(!1)):(this.isPolygon.set(!0),this.isPoint.set(!1),this.isLine.set(!1))},t.prototype._getRenderer=function(){var e=null;return e=this.isPoint.get()?new esri.renderer.SimpleRenderer(this.symbols.marker):this.isLine.get()?new esri.renderer.SimpleRenderer(this.symbols.line):new esri.renderer.SimpleRenderer(this.symbols.fill),JSON.stringify(e.toJson())},t.prototype._getSymbol=function(){var e=null;return e=this.isPoint.get()?this.symbols.marker:this.isLine.get()?this.symbols.line:this.symbols.fill,JSON.stringify(e.toJson())},t.prototype._setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&"esriPMS"!==t.symbol.type&&this._setFromSymbolObject(t.symbol)},t.prototype._setFromSymbol=function(e){!e||e instanceof esri.symbol.PictureMarkerSymbol||this._setFromSymbolObject(e.toJson())},t.prototype._setFromSymbolObject=function(e){var t=this;this.configuring=!0,e.color&&this.fill.color.set(new n.SymbolColor({r:e.color[0]/255,g:e.color[1]/255,b:e.color[2]/255,a:e.color[3]/255}));var i;for(var r in this.markerStyleIdLookup)if(this.markerStyleIdLookup.hasOwnProperty(r)&&e.style===this.markerStyleIdLookup[r]){i=r;break}e.outline&&(this.outline.color.set(new n.SymbolColor({r:e.outline.color[0]/255,g:e.outline.color[1]/255,b:e.outline.color[2]/255,a:e.outline.color[3]/255})),i!==esri.symbol.SimpleMarkerSymbol.STYLE_CROSS&&i!==esri.symbol.SimpleMarkerSymbol.STYLE_X||this.fill.color.set(this.outline.color.get()));var a=this.markerStyles.getItems().filter(function(e){return e.style===i})[0];this.markerSize.set($.isNumeric(e.size)?Math.floor(e.size*o.POINTS_TO_PIXELS):this.config.markerSize.value),this.markerStyleIndex=a?this.markerStyles.indexOf(a):0;var s=this.isLine.get()?e:e.outline;s?(this.lineWidth.set($.isNumeric(s.width)?Math.floor(s.width*o.POINTS_TO_PIXELS):this.config.lineWidth.value),this.lineStyleIndex=s.style?this.lineStyles.indexOf(this.lineStyles.getItems().filter(function(e){return t.lineStyleIdLookup[e.style]===s.style})[0]):0):(this.lineWidth.set(0),this.lineStyleIndex=0);var l=this.fillStyles.getItems().filter(function(i){return t.fillStyleIdLookup[i.style]===e.style})[0];this.fillStyleIndex=l?this.fillStyles.indexOf(l):0,this.configuring=!1},t}(i.ViewModelBase);t.SimpleSymbolWidgetViewModel=s})},"geocortex/infrastructure/symbology/widgets/SymbologyWidget":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/widgets/SimpleSymbolWidget":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbologySettingsView"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName=t.app.getResource(t.libraryId,"language-symbology-settings-symbol-displayname"),t}return __extends(t,e),t.prototype.attach=function(t){var i=this;t.initialized||t.initialize(this.configuration),e.prototype.attach.call(this,t),this.viewModel.fill.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.outline.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.lineWidth.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.markerSize.bind(this,function(){i.viewModel.configuring||i.applySettings()})},t.prototype.added=function(t){t&&(t.symbologyWidget=this,e.prototype.added.call(this,t))},t.prototype.activated=function(){var e=this;setTimeout(function(){e.viewModel.configuring=!0,e.viewModel.fill.color.pulse(),e.viewModel.outline.color.pulse(),e.viewModel.lineWidth.pulse(),e.viewModel.markerSize.pulse(),e.viewModel.configuring=!1},0)},t.prototype.reset=function(){this.viewModel._reset()},t.prototype.getSymbol=function(){return(!this.viewModel.symbols||this.viewModel.symbols.marker instanceof esri.symbol.PictureMarkerSymbol)&&this.applySettings(),this.viewModel._getSymbol()},t.prototype.setFromSymbol=function(e,t){void 0===t&&(t=!0),this.viewModel._setFromSymbol(e),t&&this.applySettings()},t.prototype.getRenderer=function(){return this.viewModel._getRenderer()},t.prototype.setFromRenderer=function(e){this.viewModel._setFromRenderer(e)},t.prototype.setFeatureType=function(e){this.viewModel._setFeatureType(e)},t.prototype.handleMarkerStyle=function(){this.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex,this.applySettings()},t.prototype.handleLineStyle=function(){this.viewModel.lineStyleIndex=this.lineStyleInput.selectedIndex,this.applySettings()},t.prototype.handleFillStyle=function(){this.viewModel.fillStyleIndex=this.fillStyleInput.selectedIndex,this.applySettings()},t.prototype.applySettings=function(){if(this.viewModel.initialized&&!this.viewModel.configuring){this.viewModel.configuring=!0,this.viewModel.markerStyleIndex<0&&(this.viewModel.markerStyleIndex=0),this.viewModel.lineStyleIndex<0&&(this.viewModel.lineStyleIndex=0),this.viewModel.fillStyleIndex<0&&(this.viewModel.fillStyleIndex=0),this.markerStyleInput&&(this.markerStyleInput.selectedIndex=this.viewModel.markerStyleIndex||0),this.lineStyleInput&&(this.lineStyleInput.selectedIndex=this.viewModel.lineStyleIndex||0),this.fillStyleInput&&(this.fillStyleInput.selectedIndex=this.viewModel.fillStyleIndex||0);var e=this.viewModel.fill.color.get(),t=this.viewModel.outline.color.get(),i=this.viewModel.markerStyles.getAt(this.viewModel.markerStyleIndex||0).style,n=i===esri.symbol.SimpleMarkerSymbol.STYLE_CROSS||i===esri.symbol.SimpleMarkerSymbol.STYLE_X;
n&&this.viewModel.isPoint.get()&&!this.viewModel.isLine.get()&&!this.viewModel.isPolygon.get()?this.viewModel.noOutlineSymbol.set(!0):this.viewModel.noOutlineSymbol.set(!1);var a=this.viewModel.lineStyles.getAt(this.viewModel.lineStyleIndex||0).style,o=this.viewModel.fillStyles.getAt(this.viewModel.fillStyleIndex||0).style,s=this.viewModel.markerSize.get(),l=this.viewModel.lineWidth.get(),c=new esri.symbol.SimpleLineSymbol;n?c.setColor(e.toEsriColor()):c.setColor(this._getOutlineColor(e,t)),c.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID),c.setWidth(n?l||1:l);var u=new esri.symbol.SimpleMarkerSymbol;u.setColor(e.toEsriColor()),u.setStyle(i),u.setSize(s),u.setOutline(c);var d=new esri.symbol.SimpleLineSymbol;d.setColor(e.toEsriColor()),d.setStyle(a),d.setWidth(l||1);var p=new esri.symbol.SimpleLineSymbol;p.setColor(this._getOutlineColor(e,t)),p.setStyle(a),p.setWidth(l);var h=new esri.symbol.SimpleFillSymbol;h.setColor(e.toEsriColor()),h.setStyle(o),h.setOutline(p),this.viewModel.symbols={marker:u,line:d,fill:h},this.onChange&&this.isActive&&(!this.viewModel.parentSymbologyView||this.viewModel.parentSymbologyView.isActive)&&(this.viewModel.isLine.get()?this.onChange(JSON.stringify(d.toJson())):this.viewModel.isPolygon.get()?this.onChange(JSON.stringify(h.toJson())):this.viewModel.isPoint.get()&&this.onChange(JSON.stringify(u.toJson()))),this.viewModel.parentSymbologyView instanceof r.SymbologySettingsView&&this.viewModel.parentSymbologyView.applySettings(!1),this.viewModel.configuring=!1}},t.prototype._getOutlineColor=function(e,t){var i;return i=this.viewModel.showOutlineColor.get()?t.toEsriColor():this.viewModel.config.adaptOutlineToFill?e.value>=.7?e.darken(.5).toEsriColor(!1):e.lighten(.9).toEsriColor(!1):e.darken(.5).toEsriColor(!1)},t}(i.ViewBase);t.SimpleSymbolWidget=n})},"geocortex/infrastructure/symbology/MarkupTemplates":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/widgets/PictureSymbolWidgetConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/widgets/PictureSymbolWidgetViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/SymbolUtils","geocortex/framework-ui/LazyObservable","geocortex/essentials/utilities/UrlUtilities"],function(e,t,i,r,n,a,o){"use strict";var s=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.initialized=!1,n.imageLibraries=new r.ObservableCollection(["Shapes"]),n.currentLibrary=new r.Observable(""),n.noLibraries=new r.Observable((!1)),n.imageTemplates={},n.currentImages=new r.ObservableCollection([]),n.showLibrarySwitcher=new r.Observable((!1)),n.loading=!1,n.imageSize=new r.Observable(32),n.imageSizeViewModel={range:{min:16,max:64,value:n.imageSize,step:1},showSlider:!0,updateOnDrag:!0},n.imageRotation=new r.Observable(0),n.imageRotationViewModel={range:{min:0,max:360,value:n.imageRotation,step:1},showSlider:!0,updateOnDrag:!0},n.imageHeight=new r.Observable(32),n.imageWidth=new r.Observable(32),n.imageSwatchIdBase="__IMAGESWATCH__",n.currentImage=new r.Observable(null),n}return __extends(t,e),t.prototype.initialize=function(e){var t=this;if(void 0===e&&(e={}),!this.initialized){var i=this.app.configModel.widgetConfigs.filter(function(e){return"PictureSymbolWidget"===e.id})[0],r={};i?($.extend(r,i.configuration,e),this.config=r):this.config=e,void 0!==this.config.imageLibraries&&$.isArray(this.config.imageLibraries)&&this.imageLibraries.set(this.config.imageLibraries),this.imageLibraries.getLength()>1&&this.showLibrarySwitcher.set(!0),this.currentLibrary.set(this.imageLibraries.getAt(0)),this.config.imageSize=this.config.imageSize||{min:16,max:64,value:32,step:1},this.imageSize.set(this.config.imageSize.value),this.imageSizeViewModel={range:{min:this.config.imageSize.min,max:this.config.imageSize.max,value:this.imageSize,step:this.config.imageSize.step},showSlider:null==this.config.showSliders||this.config.showSliders,updateOnDrag:!0},this.imageRotationViewModel.showSlider=null==this.config.showSliders||this.config.showSliders,this.imageHeight.sync(this.imageSize),this.imageWidth.syncTransform(this.imageSize,function(e){return e*(t.currentImage.get()?t.currentImage.get().widthRatio:1)}),this.currentLibrary.bind(this,function(e){var i=function(e){t.currentImage.set(null);for(var i=0;i<e.length;i++)if(e[i].selected.get()){t.currentImage.set(e[i]);break}t.currentImage.get()||(e[0].selected.set(!0),t.currentImage.set(e[0])),t.currentImages.set(e)},r=t.imageTemplates[e];r?i(r):t._loadImages(e).then(function(e){e&&e.length>0?i(e):t.imageLibraries.getLength()>0&&t.currentLibrary.set(t.imageLibraries.getAt(0))})}),this.initialized=!0}},t.prototype.loadAllLibraries=function(){var e=this,t=new Promise(function(t,i){for(var r=[],n=0;n<e.imageLibraries.getLength();n++){var a=e.imageLibraries.getAt(n);e.imageTemplates[a]||r.push(e._loadImages(a))}r.length>0?Promise.all(r).then(function(){t()}):t()});return t},t.prototype._setFromSymbol=function(e){var t=this,i=new Promise(function(i,r){var n=t._checkForSymbol(e);n?i():t._addNewTemplateFromSymbol(e).then(function(){return i()})});return i},t.prototype._checkForSymbol=function(e){for(var t,i=this,r=null,n=this._getHashForSymbol(e),a=[],o=0;o<this.imageLibraries.getLength()&&(t=this.imageLibraries.getAt(o),a=this.imageTemplates[t],!a||!(r=a.filter(function(e){return e.hash.get()===n})[0]));o++);if(r){this.currentLibrary.set(t),this.currentImage.set(r);for(var s=0,l=a;s<l.length;s++){var c=l[s];c.selected.set(!1)}r.selected.set(!0),this.imageSize.set(e.height),this.imageRotation.set(e.angle),setTimeout(function(){var e=$("#"+r.id,i.viewRoot)[0];e&&e.scrollIntoView()},200)}return r},t.prototype._addNewTemplateFromSymbol=function(e){var t=this,i=new Promise(function(i,o){var s=new Image,l=t._getHashForSymbol(e);s.onload=function(){var o=t.imageSwatchIdBase+t.currentImages.getLength(),c=n.webMapAngleToJSAPIAngle(e.angle),u={type:"image",name:"",selected:new r.Observable((!0)),url:e.url,size:s.height,widthRatio:s.width/s.height,xoffset:e.xoffset/e.width,yoffset:e.yoffset/e.height,angle:c,id:o,hash:new a.LazyObservable(l),toSymbol:function(){return t._imageTemplateToSymbol(u)},toJsonString:function(){return JSON.stringify(u.toSymbol().toJson())}};t.imageTemplates[t.currentLibrary.get()].push(u),t.currentImages.addItem(u),t.currentImage.set(u),t.imageSize.set(e.height);var d=$("#"+o,t.viewRoot)[0];d&&d.scrollIntoView(),i()},s.src=e.url});return i},t.prototype._loadImages=function(e){var t=this;this.loading=!0;var i=[],s=new Promise(function(s,l){if(t.app.site.getEssentialsVersion()<4.07)return t._handleInvalidLibrary(e),t.loading=!1,t.app.trace.debug("Could not load symbol library '{0}'. Essentials 4.7 or newer is required.".format(e)),void s(null);var c=/^(.*?)(\/*)$/.exec(t.app.site.originalUrl)[1],u=o.UrlUtilities.simplify(c+"/../../symbols/image/{0}".format(e));esri.request({url:u,content:{f:"json"},handleAs:"json"}).then(function(o){var l=o&&o.symbols;if(!$.isArray(l))throw new Error(t.getResource("language-symbology-errors-malformed-library").format(e));for(var c=function(o){var s=esri.symbol.fromJson(l[o]);if(s&&s instanceof esri.symbol.PictureMarkerSymbol){var c=n.webMapAngleToJSAPIAngle(s.angle);"Images"==e&&s.url&&(s.url=u+s.url);var d={type:"image",name:l[o].name||"",selected:new r.Observable((!o)),url:s.url,size:s.height,widthRatio:s.width/s.height,xoffset:s.xoffset/s.width,yoffset:s.yoffset/s.height,angle:c,id:t.imageSwatchIdBase+o,hash:new a.LazyObservable(null,function(){return t._getHashForSymbol(d.toSymbol())},(!0)),toSymbol:function(){return t._imageTemplateToSymbol(d)},toJsonString:function(){return JSON.stringify(d.toSymbol().toJson())}};i.push(d)}},d=0;d<l.length;d++)c(d);0===i.length?t._handleInvalidLibrary(e):t.imageTemplates[e]=i,t.loading=!1,s(i)},function(i){t._handleInvalidLibrary(e),t.loading=!1,l(i)})});return s},t.prototype._handleInvalidLibrary=function(e){this.imageLibraries.removeItem(e),1===this.imageLibraries.getLength()&&this.showLibrarySwitcher.set(!1),0===this.imageLibraries.getLength()&&(this.showLibrarySwitcher.set(!1),this.currentImages.set([]),this.currentImage.set(null),this.noLibraries.set(!0))},t.prototype._getRenderer=function(){var e=null;return e=new esri.renderer.SimpleRenderer(this.currentImage.get().toSymbol()),JSON.stringify(e.toJson())},t.prototype._reset=function(){this.currentLibrary.set(this.imageLibraries.getAt(0));var e=this.imageTemplates[this.currentLibrary.get()];if(e&&e.length>0){for(var t=0,i=e;t<i.length;t++){var r=i[t];r.selected.set(!1)}e[0].selected.set(!0),this.currentImage.set(e[0])}},t.prototype._getHashForSymbol=function(e){var t="";return t=0===e.url.indexOf("data")?e.url.substring(e.url.indexOf(",")+1):e.url,n.stringToHash(t)},t.prototype._imageTemplateToSymbol=function(e){var t=new esri.symbol.PictureMarkerSymbol(e.url,this.imageWidth.get(),this.imageHeight.get());t.setAngle(this.imageRotation.get());var i=n.rotate(0,0,e.xoffset*t.width,e.yoffset*t.height,t.angle);return t.setOffset(i.x,i.y),t},t}(i.ViewModelBase);t.PictureSymbolWidgetViewModel=s})},"geocortex/infrastructure/symbology/SymbologySettingsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/widgets/PictureSymbolWidgetViewModel","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.displayName=r.app.getResource(r.libraryId,"language-symbology-settings-symbol-displayname"),r}return __extends(t,e),t.prototype.attach=function(t){e.prototype.attach.call(this,t),this.viewModel=t,this.pictureSymbologyWidget&&(this.pictureSymbologyWidget.viewModel.parentSymbologyView=this),this.symbologyWidget.viewModel.parentSymbologyView=this,this.viewModel.imageSelector=this.pictureSymbologyWidget,this.viewModel.symbolSelector=this.symbologyWidget,this.viewModel.initialize(this.configuration)},t.prototype.added=function(t){t&&(t.symbologySettingsWidget=this,e.prototype.added.call(this,t))},t.prototype.resolveWidget=function(t,i,a){if(e.prototype.resolveWidget.call(this,t,i),"CustomizedPictureSymbolWidget"===t&&this.configuration.enableImageSelector){var o="PictureSymbolWidget-"+n.alphaNumericToken();this.pictureSymbologyWidget=this.app.viewManager.createView({viewId:o,markupResource:"Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.PictureSymbolWidget",isVisible:!0,libraryId:"Mapping.Infrastructure"}),this.pictureSymbologyWidget.configuration=this.configuration.pictureSymbologyConfig;var s=new r.PictureSymbolWidgetViewModel(this.app,"Mapping.Infrastructure");return this.pictureSymbologyWidget.attach(s),this.pictureSymbologyWidget}return this.pictureSymbologyWidget=null,"<div/>"},t.prototype.applySettings=function(e){void 0===e&&(e=!0),e&&(this.viewModel.symbolSelector.applySettings(),this.viewModel.imageSelector&&this.viewModel.imageSelector.applySettings()),this.viewModel.symbols=this.viewModel.symbolSelector.viewModel.symbols;var t=this._getCurrentWidget();if(this.viewModel.imageSelector&&t&&"Image"===t.displayName){var i=this.viewModel.imageSelector.getSymbol();i&&(this.viewModel.symbols.marker=new esri.symbol.PictureMarkerSymbol(JSON.parse(i)))}},t.prototype.setFeatureType=function(e){this.viewModel._setFeatureType(e)},t.prototype.getSymbol=function(){return this.viewModel._getSymbol()},t.prototype.setFromSymbol=function(e){this.viewModel._setFromSymbol(e)},t.prototype.setFromRenderer=function(e){this.viewModel._setFromRenderer(e)},t.prototype.reset=function(){this.viewModel._reset()},t.prototype._getCurrentWidget=function(){var e=this.viewModel.currentWidget.get(),t=e?e.id:this.symbologyWidget.id;return this.viewModel.symbologyWidgets.getItems().filter(function(e){return e.id===t})[0]},t}(i.ViewBase);t.SymbologySettingsView=a})},"geocortex/infrastructure/symbology/widgets/MarkupStyleWidget":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/widgets/PictureSymbolWidget":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/symbology/SymbologySettingsView"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName=t.app.getResource(t.libraryId,"language-symbology-settings-image-displayname"),t.isMarkupView=!1,t}return __extends(t,e),t.prototype.attach=function(t){var i=this;t.initialize(this.configuration),e.prototype.attach.call(this,t),t.viewRoot=this.root,this.viewModel.currentImage.bind(this,function(e){i.viewModel.imageSize.unbind(i._imageSizeToken),i.viewModel.imageRotation.unbind(i._imageRotationToken),e&&e!==i.viewModel.currentImage.get()?(i.viewModel.imageSize.set(e.size),i.viewModel.imageRotation.set(e.angle||0)):(i.viewModel.imageSize.pulse(),i.viewModel.imageRotation.pulse()),i.applySettings(),i.bindSymbolSettings()}),this.app.event("MarkupSymbolChangedEvent").subscribe(this,function(e){i.viewModel.markupSymbol=e}),this.bindSymbolSettings()},t.prototype.bindSymbolSettings=function(){var e=this;this._imageSizeToken=this.viewModel.imageSize.bind(this,function(t){t&&e.applySettings()}),this._imageRotationToken=this.viewModel.imageRotation.bind(this,function(t){$.isNumeric(t)&&e.applySettings()})},t.prototype.added=function(t){t&&(t.pictureSymbologyWidget=this,e.prototype.added.call(this,t))},t.prototype.activated=function(){var e=this;if(!this.viewModel.loading){var t=function(){0===e.viewModel.currentImages.getLength()&&e.viewModel.currentLibrary.pulse(),setTimeout(function(){e.viewModel.currentImage.pulse()},100);var t=e.viewModel.currentImage.get();if(t){var i=$("#"+t.id,e.root)[0];i&&!e._isSwatchVisible(i)&&i.scrollIntoView()}},i=this.app.site;i&&i.isInitialized?t():this.app.event("SiteInitializedEvent").once(this,t)}},t.prototype.updateSymbol=function(e){return e instanceof esri.symbol.PictureMarkerSymbol?(this.setFromSymbol(e),Promise.resolve(!0)):(this.applySettings(),Promise.resolve(!1))},t.prototype.reset=function(){this.viewModel._reset()},t.prototype.getSymbol=function(){return this.viewModel.currentImage.get()?this.viewModel.currentImage.get().toJsonString():""},t.prototype.setFromSymbol=function(e){var t=this;if(e instanceof esri.symbol.PictureMarkerSymbol){var i=this.viewModel._checkForSymbol(e);i||this.viewModel.loadAllLibraries().then(function(){t.viewModel._setFromSymbol(e).then(function(){t.viewModel.imageSize.pulse()})})}},t.prototype.getRenderer=function(){return this.viewModel._getRenderer()},t.prototype.setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&"esriPMS"===t.symbol.type&&this.setFromSymbol(new esri.symbol.PictureMarkerSymbol(t.symbol))},t.prototype.applySettings=function(){var e=this.viewModel.currentImage.get();if(0!==this.viewModel.imageLibraries.getLength()&&e){var t=$("#"+e.id,this.root)[0];t&&!this._isSwatchVisible(t)&&t.scrollIntoView(),this.onChange&&this.isActive&&(!this.viewModel.parentSymbologyView||this.viewModel.parentSymbologyView.isActive)&&this.onChange(e.toJsonString()),this.viewModel.parentSymbologyView instanceof r.SymbologySettingsView&&this.viewModel.parentSymbologyView.applySettings(!1)}},t.prototype.handleClickSwatch=function(e){var t=e.target,i=this.viewModel.currentImages.getItems().filter(function(e){return(t.id||t.parentElement.id)===e.id})[0];if(i){for(var r=0,n=this.viewModel.currentImages.getItems();r<n.length;r++){var a=n[r];a.selected.set(!1)}i.selected.set(!0),this.viewModel.currentImage.set(i)}},t.prototype._isSwatchVisible=function(e){var t=e.getBoundingClientRect(),i=function(e,t){return document.elementFromPoint(e,t)};return e.contains(i(t.left,t.top))||e.contains(i(t.right,t.top))||e.contains(i(t.right,t.bottom))||e.contains(i(t.left,t.bottom))},t}(i.ViewBase);t.PictureSymbolWidget=n})},"geocortex/infrastructure/symbology/SymbologySettingsViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.noMarker=new r.Observable((!1)),t.noFill=new r.Observable((!1)),t.isPoint=new r.Observable((!1)),t.isLine=new r.Observable((!1)),t.isPolygon=new r.Observable((!1)),t.showSymbologySelectorMenu=new r.Observable((!1)),t.symbolizeWithImagery=new r.Observable((!1)),t.symbologyWidgets=new r.ObservableCollection([]),t.currentWidget=new r.Observable(null),t}return __extends(t,e),t.prototype.initialize=function(e){var t=this;void 0===e&&(e={});var i=this.app.configModel.widgetConfigs.filter(function(e){return"SymbologySettings"===e.id})[0],r={};i?($.extend(r,i.configuration,e),this.config=r):this.config=e,(null==this.config.enableImageSelector||this.config.enableImageSelector)&&(this.imageSelector.viewModel.initialize(this.config.pictureSymbologyConfig||{}),this.symbologyWidgets.addItem(this.imageSelector),this.isPoint.bind(this,function(e){e?t.showSymbologySelectorMenu.set(!0):(t.showSymbologySelectorMenu.set(!1),t.currentWidget.set(t.symbolSelector))})),this.symbolSelector.viewModel.initialize(this.config.symbologyConfig),this.symbologyWidgets.addItem(this.symbolSelector),this.currentWidget.set(this.symbolSelector),this.isPoint.bind(this,function(e){t.symbolSelector.viewModel.isPoint.set(e)}),this.isLine.bind(this,function(e){t.symbolSelector.viewModel.isLine.set(e)}),this.isPolygon.bind(this,function(e){t.symbolSelector.viewModel.isPolygon.set(e)}),this.noFill.bind(this,function(e){t.isLine.set(e),t.isPoint.set(!t.noMarker.get()&&!e),t.isPolygon.set(!e)}),this.noMarker.bind(this,function(e){t.isPoint.set(!e),t.isLine.set(t.noFill.get()&&e),t.isPolygon.set(e)}),this.symbolizeWithImagery.syncTransform(this.currentWidget,function(e){return!(!e||!t.imageSelector||e.id!==t.imageSelector.id)&&(setTimeout(function(){t.imageSelector.activated()},100),!0)})},t.prototype._reset=function(){for(var e=0,t=this.symbologyWidgets.getItems();e<t.length;e++){var i=t[e];i.reset()}this.currentWidget.set(this.symbolSelector)},t.prototype._setFeatureType=function(e){e=e.toLowerCase(),e.indexOf("point")>-1?(this.isPoint.set(!0),this.isLine.set(!1),this.isPolygon.set(!1)):e.indexOf("line")>-1?(this.isLine.set(!0),this.isPoint.set(!1),this.isPolygon.set(!1)):(this.isPolygon.set(!0),this.isPoint.set(!1),this.isLine.set(!1))},t.prototype._getRenderer=function(){var e=null;return e=new esri.renderer.SimpleRenderer(esri.symbol.fromJson(JSON.parse(this._getSymbol()))),JSON.stringify(e.toJson())},t.prototype._getSymbol=function(){if(this.currentWidget.get())return this.currentWidget.get().getSymbol()},t.prototype._setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&this._setFromSymbol(esri.symbol.fromJson(t.symbol))},t.prototype._setFromSymbol=function(e){e instanceof esri.symbol.PictureMarkerSymbol&&this.imageSelector&&this.currentWidget.set(this.imageSelector),this.currentWidget&&this.currentWidget.get().setFromSymbol(e)},t}(i.ViewModelBase);t.SymbologySettingsViewModel=n})},"geocortex/infrastructure/symbology/widgets/SimpleSymbolWidgetConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/SymbologySettingsConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/AttributeSymbologySettingsConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/DataClassificationUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t){if(t>e.length)return[];for(var i=e.slice().sort(function(e,t){return e-t}),a=(n(i),r(t,i.length)),o=r(t,i.length),s=0;s<t;s++)for(var l=i[0],c=Math.max(s,1);c<i.length;c++)if(0===s){var u=Math.pow(i[c]-l,2);a[s][c]=a[s][c-1]+c/(c+1)*u;var d=c*l+i[c];l=d/(c+1)}else for(var p=0,h=0,m=c;m>=s;m--)p+=(c-m)/(c-m+1)*Math.pow(i[m]-h,2),h=(i[m]+(c-m)*h)/(c-m+1),m===c?(a[s][c]=p,o[s][c]=m,m>0&&(a[s][c]+=a[s-1][m-1])):p+a[s-1][m-1]<a[s][c]&&(a[s][c]=p+a[s-1][m-1],o[s][c]=m);for(var f=[],g=o[0].length-1,s=o.length-1;s>=0;s--){var y=o[s][g];f[s]=i.slice(y,g+1),s>0&&(g=y-1)}return f}function r(e,t){for(var i=[],r=0;r<e;r++){for(var n=[],a=0;a<t;a++)n.push(0);i.push(n)}return i}function n(e){for(var t,i=0,r=0;r<e.length;r++)0!==r&&e[r]==t||(t=e[r],i++);return i}function a(e){var t,i=o(),r=e.filter(function(e){return null!==e}).map(function(e){var t=e.toString().split(i)[1];return t?parseFloat(t)/Math.pow(10,t.length):0}),n=e.filter(function(e){return null!==e}).map(function(e){return Math.floor(e)}),a=Math.min.apply(Math,n.filter(function(e){return 0!==e}));t=0===a||a===1/0?0:Math.floor(Math.log(Math.abs(a))/Math.LN10);var s,l=Math.max.apply(Math,n);0===l?t=0:s=Math.floor(Math.log(Math.abs(l))/Math.LN10);var c=s-t,u=Math.max.apply(Math,r.filter(function(e){return 0!==e}));if(0===u||Math.abs(u)===1/0){var d=l-a,p=Math.floor(Math.log(Math.abs(d))/Math.LN10);return Math.pow(10,c-p<0?0:c-p)}var h,m=Math.floor(Math.log(Math.abs(u))/Math.LN10),f=Math.min.apply(Math,r.filter(function(e){return 0!==e}));h=0===f||Math.abs(f)===1/0?0:Math.floor(Math.log(Math.abs(f))/Math.LN10);var g=m-h;if(g<=1){var y=r.map(function(e){var t=e.toString().split(i)[1];return t?t.length:0}),b=Math.max.apply(Math,y);return Math.pow(10,-b)}return Math.pow(10,h+c)}function o(){var e=1.1,t=e.toLocaleString().substring(1,2);return t}t.ckmeans=i,t.createMatrix=r,t.uniqueCountSorted=n,t.findSignificanceFactor=a,t.getDecimalSeparator=o})},"geocortex/infrastructure/symbology/AttributeSymbologySettingsViewModel":function(){define(["require","exports","geocortex/essentials/Field","geocortex/infrastructure/gis/FieldInfo","geocortex/infrastructure/symbology/SymbologySettingsViewModel","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/ColorUtils","geocortex/infrastructure/symbology/DataClassificationUtils","geocortex/infrastructure/symbology/AttributeSymbologySettingsView","geocortex/infrastructure/LayerIntegrationUtils","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/SymbolUtils"],function(e,t,i,r,n,a,o,s,l,c,u,d,p,h,m){"use strict";var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attributes=new o.ObservableCollection,t.currentAttribute=new o.Observable(""),t.classBreaksMode=new o.Observable((!1)),t.isNumericAttribute=new o.Observable((!1)),t.symbologyClasses=new o.ObservableCollection([]),t.classSymbolWidgets=[],t.startColor={color:new o.Observable},t.endColor={color:new o.Observable},t.numBreaks=new o.Observable(5),t.markerSize=new o.Observable(10),t.lineWidth=new o.Observable(2),t.transparency=new o.Observable(10),t.noMarker=new o.Observable((!1)),t.markerStyles=new o.ObservableCollection([{style:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,label:t.getResource("language-symbology-settings-marker-style-circle")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_CROSS,label:t.getResource("language-symbology-settings-marker-style-cross")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,label:t.getResource("language-symbology-settings-marker-style-diamond")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,label:t.getResource("language-symbology-settings-marker-style-square")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_X,label:t.getResource("language-symbology-settings-marker-style-x")}]),t.markerStyleIdLookup={circle:"esriSMSCircle",cross:"esriSMSCross",diamond:"esriSMSDiamond",square:"esriSMSSquare",x:"esriSMSX"},t.configuring=!1,t.creatingClasses=!1,t.numericAttributeIsUniqueValue=!1,t.queryResults=[],t}return __extends(t,e),t.prototype.initialize=function(e){void 0===e&&(e={}),this.config=e;var t=this.app.configModel.widgetConfigs.filter(function(e){return"AttributeSymbologySettings"===e.id})[0],i={};t?($.extend(i,t.configuration,e),this.config=i):this.config=e;var r=this.config.classSymbolizationConfig||{};r.symbologyConfig||(r.symbologyConfig={}),r.pictureSymbologyConfig||(r.pictureSymbologyConfig={}),this.maxRenderClasses=this.config.maxRenderClasses>1?this.config.maxRenderClasses:12,this.maxSamples=this.config.maxSamples||1e3,this.classBreaksInput={range:{min:2,max:this.maxRenderClasses,value:this.numBreaks,step:1},showSlider:this.config.showSliders,updateOnDrag:!1},this.config.transparency=this.config.transparency||{min:0,max:100,value:10,step:5},this.transparency.set(this.config.transparency.value),this.transparencyInput={range:{min:this.config.transparency.min,max:this.config.transparency.max,value:this.transparency,step:this.config.transparency.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.classSymbolizationConfig.symbologyConfig.markerSize=this.config.classSymbolizationConfig.symbologyConfig.markerSize||{min:0,max:50,value:16,step:1},this.markerSize.set(this.config.classSymbolizationConfig.symbologyConfig.markerSize.value),this.markerSizeInput={range:{min:this.config.classSymbolizationConfig.symbologyConfig.markerSize.min,max:this.config.classSymbolizationConfig.symbologyConfig.markerSize.max,value:this.markerSize,step:this.config.classSymbolizationConfig.symbologyConfig.markerSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.classSymbolizationConfig.symbologyConfig.lineWidth=this.config.classSymbolizationConfig.symbologyConfig.lineWidth||{min:0,max:10,value:2,step:1},this.lineWidth.set(this.config.classSymbolizationConfig.symbologyConfig.lineWidth.value),this.lineWidthInput={range:{min:this.config.classSymbolizationConfig.symbologyConfig.lineWidth.min,max:this.config.classSymbolizationConfig.symbologyConfig.lineWidth.max,value:this.lineWidth,step:this.config.classSymbolizationConfig.symbologyConfig.lineWidth.step},showSlider:this.config.showSliders,updateOnDrag:!0};for(var a=0;a<this.maxRenderClasses;a++){var o=void 0;o=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/symbology/SymbologySettingsView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.SymbologySettingsView",isVisible:!0,libraryId:"Mapping.Infrastructure"});var s=new n.SymbologySettingsViewModel(this.app,"Mapping.Infrastructure");o.configuration=this.config.classSymbolizationConfig,o.attach(s),o.applySettings(),this.classSymbolWidgets.push(o)}this.markerStyles.set(this.classSymbolWidgets[0].symbologyWidget.viewModel.markerStyles.getItems()),this.markerStyleIndex=0;var c=l.generateRandomColor();this.startColor.color.set(c.lighten(.9)),this.endColor.color.set(c.darken(.6)),this.defaultLineSymbol=new esri.symbol.SimpleLineSymbol,this.defaultLineSymbol.setColor(new esri.Color(this.config.defaultLineColor||[75,75,75,1])),this.defaultLineSymbol.setWidth(this.config.defaultLineWidth||2),this.defaultPointSymbol=new esri.symbol.SimpleMarkerSymbol,this.defaultPointSymbol.setColor(new esri.Color(this.config.defaultPointColor||[150,150,150,.8])),this.defaultPointSymbol.setSize(this.config.defaultPointSize||12),this.defaultPointSymbol.setOutline(this.defaultLineSymbol),this.defaultPolygonSymbol=new esri.symbol.SimpleFillSymbol,this.defaultPolygonSymbol.setColor(new esri.Color(this.config.defaultFillColor||[150,150,150,.3])),this.defaultPolygonSymbol.setOutline(this.defaultLineSymbol)},t.prototype._reset=function(){this.attributes.set([]),this.currentAttribute.set(""),this.classBreaksMode.set(!1),this.isNumericAttribute.set(!1),this.symbologyClasses.set([]),this.selectedClass="",this.transparency.set(this.config.transparency.value),this.markerSize.set(this.config.classSymbolizationConfig.symbologyConfig.markerSize.value),this.lineWidth.set(this.config.classSymbolizationConfig.symbologyConfig.lineWidth.value),this.markerStyleIndex=0;var e=l.generateRandomColor();this.startColor.color.set(e.lighten(.9)),this.endColor.color.set(e.darken(.6));for(var t=0,i=this.classSymbolWidgets;t<i.length;t++){var r=i[t];r.reset()}this.queryResults=[]},t.prototype._getRenderer=function(){var e,t,i=this;if(0===this.symbologyClasses.getLength())return"";t="point"===this.featureType.toLowerCase().trim()?this.defaultPointSymbol:"polyline"===this.featureType.toLowerCase().trim()?this.defaultLineSymbol:this.defaultPolygonSymbol;var r=this.attributes.getItems().filter(function(e){return e.displayName===i.currentAttribute.get()})[0],n="";if(r&&(n=r.name,r.layer.mapService.serviceLayer instanceof esri.layers.WFSLayer)){var a=r.name.indexOf(":");n=a>-1?r.name.substring(a+1).trim():r.name.trim()}if(this.classBreaksMode.get()){e=new esri.renderer.ClassBreaksRenderer(t,n);for(var o=0;o<this.symbologyClasses.getLength();o++){var s=this.symbologyClasses.getAt(o),l=this.classSymbolWidgets[o];e.addBreak({minValue:s.min,maxValue:s.max,symbol:esri.symbol.fromJson(JSON.parse(l.getSymbol())),label:s.name})}}else{e=new esri.renderer.UniqueValueRenderer(t,n);for(var o=0;o<this.symbologyClasses.getLength();o++){var s=this.symbologyClasses.getAt(o),l=this.classSymbolWidgets[o];e.addValue({value:s.value,symbol:esri.symbol.fromJson(JSON.parse(l.getSymbol())),label:s.name})}}return JSON.stringify(e.toJson())},t.prototype._setFromRenderer=function(e){var t=this,r=e.toJson();this.creatingClasses=!0;var n=this.attributes.getItems().filter(function(e){return e.name===r.field||e.name===r.field1})[0];this._getFieldInfo(n).then(function(e){t.configuring=!0,t.isNumericAttribute.set(n.dataType!==i.EssentialsFieldTypes.essentialsFieldTypeString&&!t._hasCodedDomain(e)),"classBreaks"===r.type?t._setFromClassBreaksRenderer(r,e):"uniqueValue"===r.type&&t._setFromUniqueValueRenderer(r,e),t.configuring=!1,t.symbologyClasses.pulse(),t.creatingClasses=!1})},t.prototype._setFromClassBreaksRenderer=function(e,t){this.classBreaksMode.set(!0);var i=e.minValue;this.numBreaks.set(e.classBreakInfos.length);for(var r=0;r<e.classBreakInfos.length;r++){var n=e.classBreakInfos[r],a=new esri.Color(n.symbol.color||"#FFFFFF"),l=this.classSymbolWidgets[r],c=esri.symbol.fromJson(n.symbol);this._configureSymbolWidget(l,c),n.classMinValue&&(i=n.classMinValue),c instanceof esri.symbol.PictureMarkerSymbol?this.symbologyClasses.addItem({name:t.formatValue(i)+" - "+t.formatValue(n.classMaxValue),min:i,max:n.classMaxValue,displayColor:a.toHex(),selected:!1,isImage:new o.Observable((!0)),imageSrc:c.url,widgetId:u.WIDGET_ID_BASE+r.toString()}):this.symbologyClasses.addItem({name:t.formatValue(i)+" - "+t.formatValue(n.classMaxValue),min:i,max:n.classMaxValue,displayColor:a.toHex(),selected:!1,isImage:new o.Observable((!1)),imageSrc:"",widgetId:u.WIDGET_ID_BASE+r.toString()}),i=n.classMaxValue,0===r&&(this.startColor.color.set(new s.SymbolColor(a)),this._setFromSymbol(n.symbol)),r===e.classBreakInfos.length-1&&this.endColor.color.set(new s.SymbolColor(a))}},t.prototype._setFromUniqueValueRenderer=function(e,t){this.classBreaksMode.set(!1);for(var i=0;i<e.uniqueValueInfos.length;i++){var r=e.uniqueValueInfos[i],n=new esri.Color(r.symbol.color||"#FFFFFF"),a=this.classSymbolWidgets[i],l=esri.symbol.fromJson(r.symbol);this._configureSymbolWidget(a,l);var c=void 0;(t.isCodedValueDomain()||t.hasSubtypeCodedValueDomains())&&(c=t.esriField.domain.getName(r.value)),c||(c=t.formatValue(r.value)),l instanceof esri.symbol.PictureMarkerSymbol?this.symbologyClasses.addItem({name:c,value:r.value,displayColor:n.toHex(),selected:!1,isImage:new o.Observable((!0)),imageSrc:l.url,widgetId:u.WIDGET_ID_BASE+i.toString()}):this.symbologyClasses.addItem({name:c,value:r.value,displayColor:n.toHex(),selected:!1,isImage:new o.Observable((!1)),imageSrc:"",widgetId:u.WIDGET_ID_BASE+i.toString()}),0===i&&(this.startColor.color.set(new s.SymbolColor(n)),this._setFromSymbol(r.symbol)),i===e.uniqueValueInfos.length-1&&this.endColor.color.set(new s.SymbolColor(n))}},t.prototype._setFromSymbol=function(e){var t=this;if(this._isPictureMarkerSymbol(e))return void this._setFromPictureMarkerSymbol(e);
this.transparency.set(Math.floor(Math.ceil((255-e.color[3])/255*100)/this.config.transparency.step)*this.config.transparency.step),this.markerSize.set($.isNumeric(e.size)?Math.floor(e.size*m.POINTS_TO_PIXELS):this.config.classSymbolizationConfig.symbologyConfig.markerSize.value);var i=this.markerStyles.getItems().filter(function(i){return t.markerStyleIdLookup[i.style]===e.style})[0];this.markerStyleIndex=i?this.markerStyles.indexOf(i):0;var r="Point"!==this.featureType&&"Polygon"!==this.featureType?e:e.outline;this.lineWidth.set($.isNumeric(r.width)?Math.floor(r.width*m.POINTS_TO_PIXELS):this.config.classSymbolizationConfig.symbologyConfig.lineWidth.value)},t.prototype._setFromPictureMarkerSymbol=function(e){this.transparency.set(this.transparencyInput.range.min),this.markerSize.set(Math.max(e.width,e.height)*m.POINTS_TO_PIXELS),this.markerStyleIndex=0},t.prototype._createClassBreaks=function(e){var t=this;this.symbologyClasses.set([]);var i=this.app.map.extent;this._executeExtentQuery(e.field,i).then(function(i){t._executeQuery(e.field,i).then(function(i){var r=t._findDistinctValues(i,e.field.name).length;if(r<=t.numBreaks.get())return t.classBreaksMode.set(!1),t.numericAttributeIsUniqueValue=!0,void t._createUniqueValues(e);t.numericAttributeIsUniqueValue=!1;var n=i.features.map(function(t){return t.attributes[e.field.name]}),a=c.findSignificanceFactor(n),s=c.ckmeans(n,t.numBreaks.get());if(0!==a&&1!==a)for(var l=0;l<s.length;l++)s[l]=s[l].map(function(e){return e/a});for(var l=0;l<s.length;l++){var d=void 0,p=void 0;if(0===l)d=Math.floor(Math.min.apply(Math,s[l]));else{var h=Math.min.apply(Math,s[l]);h>Math.max.apply(Math,s[l-1])+1?(d=Math.floor(h-(h-Math.max.apply(Math,s[l-1]))/2),1===a&&d++):d=Math.floor(h)}if(l===s.length-1)p=Math.ceil(Math.max.apply(Math,s[l]));else{var m=Math.max.apply(Math,s[l]),f=Math.min.apply(Math,s[l+1]);p=m<f-1?Math.floor(m+(f-m)/2):a<=1?Math.floor(m):Math.floor(f)}0!==a&&1!==a&&(d*=a,p*=a);var g=void 0;g=p-d===0?e.fieldInfo.formatValue(d):e.fieldInfo.formatValue(d)+" - "+e.fieldInfo.formatValue(p),t.symbologyClasses.addItem({name:g,min:d,max:p,count:s[l].length,displayColor:"#FFFFFF",selected:!1,isImage:new o.Observable((!1)),imageSrc:"",widgetId:u.WIDGET_ID_BASE+t.symbologyClasses.getLength().toString()})}t._createRendererClasses()},function(e){var i=new h.AddStatusArgs(e.message);i.regionName="VisualisationStatusRegion",i.id="VisualizationStatusMessageView",t.app.command("AddStatus").execute(i)})})},t.prototype._createUniqueValues=function(e){var t=this;this.symbologyClasses.set([]);var i=this.app.map.extent;this._executeExtentQuery(e.field,i).then(function(i){t._executeQuery(e.field,i).then(function(i){for(var r=function(i){var r=null!=i.attributes[e.field.name]&&""!==i.attributes[e.field.name].toString().trim()?i.attributes[e.field.name].toString():null;if(r){var n=void 0;t._hasCodedDomain(e.fieldInfo)&&(n=e.fieldInfo.esriField.domain.getName(i.attributes[e.field.name])),n||(n=e.fieldInfo.formatValue(r));var a=t.symbologyClasses.getItems().filter(function(e){return e.value===r})[0];a?a.count++:t.symbologyClasses.addItem({name:n,value:r,count:1,displayColor:"#FFFFFF",selected:!1,isImage:new o.Observable((!1)),imageSrc:"",widgetId:u.WIDGET_ID_BASE+t.symbologyClasses.getLength().toString()})}},n=0,a=i.features;n<a.length;n++){var s=a[n];r(s)}if(0===t.symbologyClasses.getLength()){var l=new h.AddStatusArgs(t.app.getResource(t.libraryId,"language-symbology-settings-nodata"));return l.regionName="VisualizationStatusRegion",l.id="VisualizationStatusMessageView",t.app.command("AddResultsStatus").execute(l),void t.currentAttribute.set("")}t._constrainToMaxClasses(e.field).then(function(){t.isNumericAttribute.get()?t.symbologyClasses.getItems().sort(function(e,t){return Number(e.value)-Number(t.value)}):t.symbologyClasses.getItems().sort(),t._createRendererClasses()})},function(e){var i=new h.AddStatusArgs(e.message);i.regionName="VisualisationStatusRegion",i.id="VisualizationStatusMessageView",t.app.command("AddResultsStatus").execute(i)})})},t.prototype._createRendererClasses=function(){var e,t=[],i=this.symbologyClasses.getLength();if(this.isNumericAttribute.get()){for(var r=0;r<i;r++){var n=i>1?r/(i-1):.5;t.push(this.startColor.color.get().blend(n,this.endColor.color.get()))}e=this.startColor.color.get().value>=.7?this.startColor.color.get().darken(.6,!1):this.startColor.color.get().lighten(.9,!1)}else t=l.generateRandomColors(i),e=new s.SymbolColor(this.defaultLineSymbol.color.toHex());for(var r=0;r<i;r++){var a=this.symbologyClasses.getAt(r);a.displayColor=t[r].toHex();var o=this.classSymbolWidgets[r];o.symbologyWidget.viewModel.fill.color.set(t[r]),o.symbologyWidget.viewModel.outline.color.set(e),o.setFeatureType(this.featureType),o.applySettings()}this.symbologyClasses.pulse(),this.numBreaks.set(this.symbologyClasses.getLength()),this.creatingClasses=!1},t.prototype._executeQuery=function(e,t){var i=this,r=new Promise(function(r,n){if(e.layer instanceof d.LocalLayer){var a=e.layer.mapService.serviceLayer.graphics,o=new esri.tasks.FeatureSet;o.features=a,r(o)}else{var s=new esri.tasks.Query,l=p.getQueryTask(e.layer);s.returnGeometry=!1,s.geometry=t,s.outFields=[e.name];var c=m.stringToHash(l.url+e.name+t.toJson()),u=i.queryResults[c];u?r(u):l.execute(s,function(e){i.queryResults[c]=e,r(e)},function(e){i.app.trace.error(e.message),n(e)})}});return r},t.prototype._executeExtentQuery=function(e,t){return e.layer instanceof d.LocalLayer?Promise.resolve(t):this.classBreaksMode.get()?this._executeClassBreaksExtentQuery(e,t):this._executeUniqueValueExtentQuery(e,t)},t.prototype._executeUniqueValueExtentQuery=function(e,t){var i=this,r=new Promise(function(r,n){var a=-1,o=function(n){var o=i._findDistinctValues(n,e.name),l=o.length,c=i.isNumericAttribute.get()?i.numBreaks.get():i.maxRenderClasses;l>=c||l===a||n.exceededTransferLimit?r(t):(a=l,t=t.expand(2),s())},s=function(){var n=new esri.tasks.Query,a=p.getQueryTask(e.layer);n.returnGeometry=!1,n.geometry=t,n.outFields=[e.name];var s=m.stringToHash(a.url+e.name+JSON.stringify(t.toJson())),l=i.queryResults[s];l?o(l):a.execute(n).then(function(e){i.queryResults[s]=e,o(e)},function(e){r(t)})};s()});return r},t.prototype._executeClassBreaksExtentQuery=function(e,t){var i=this,r=new Promise(function(r,n){var a=-1,o=function(){var n=new esri.tasks.Query,s=p.getQueryTask(e.layer);n.returnGeometry=!1,n.geometry=t,s.executeForCount(n).then(function(e){e>=i.maxSamples||e===a?r(t):(a=e,t=t.expand(2),o())},function(e){r(t)})};o()});return r},t.prototype._constrainToMaxClasses=function(e){var t=this,i=new Promise(function(i,r){if(t.symbologyClasses.getLength()>t.maxRenderClasses||t.symbologyClasses.getLength()>t.numBreaks.get()||t.isNumericAttribute.get()){if(t.symbologyClasses.getLength()>t.maxRenderClasses&&!t.isNumericAttribute.get()){var n=new h.AddStatusArgs(t.app.getResource(t.libraryId,"language-symbology-settings-exceeded-max-classes").format(t.maxRenderClasses));n.regionName="VisualizationStatusRegion",n.id="VisualizationStatusMessageView",t.app.command("AddResultsStatus").execute(n)}var a=t.isNumericAttribute.get()?t.numBreaks.get():t.maxRenderClasses;if(e.layer instanceof d.LocalLayer){var o=t.symbologyClasses.getItems().sort(function(e,t){return e.count<t.count?1:e.count>t.count?-1:0});t.symbologyClasses.set(o.slice(0,a)),i()}else{var s=t.app.map.extent,l=new esri.tasks.Query,c=p.getQueryTask(e.layer);l.returnGeometry=!1,l.geometry=s,l.outFields=[e.name],c.execute(l,function(r){var n=t._findDistinctValues(r,e.name),o=t.symbologyClasses.getItems().sort(function(e,t){return n.indexOf(e.name)===-1&&n.indexOf(t.name)>-1?1:n.indexOf(e.name)>-1&&n.indexOf(t.name)===-1?-1:e.count<t.count?1:e.count>t.count?-1:0});t.symbologyClasses.set(o.slice(0,a)),i()},function(e){i()})}}else i()});return i},t.prototype._configureSymbolWidget=function(e,t){e.reset(),e.setFeatureType(this.featureType),e.setFromSymbol(t)},t.prototype._findDistinctValues=function(e,t){for(var i={},r=[],n=e.features.map(function(e){return e.attributes[t]}),a=0;a<n.length;a++)i[n[a]]||r.push(n[a]),i[n[a]]=!0;return r},t.prototype._getFieldInfo=function(e){var t,i=new Promise(function(i,n){if(e.layer.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var a=e.layer.mapService.serviceLayer;t=a.getField(e.name),i(r.FieldInfo.fromEsriField(t,a,e))}else e.layer.getFeatureLayer().then(function(n){t=n.getField(e.name),i(r.FieldInfo.fromEsriField(t,n,e))})});return i},t.prototype._hasCodedDomain=function(e){return!(!e.esriField||!e.esriField.domain)},t.prototype._isPictureMarkerSymbol=function(e){return!(!e.url&&!e.imageData||!e.width||!e.height)},t}(a.ViewModelBase);t.AttributeSymbologySettingsViewModel=f})},"geocortex/infrastructure/symbology/AttributeSymbologySettingsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/Field"],function(e,t,i,r){"use strict";t.WIDGET_ID_BASE="__CLASSWIDGET__";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName=t.app.getResource(t.libraryId,"language-symbology-settings-attribute-displayname"),t}return __extends(t,e),t.prototype.attach=function(t){t.initialize(this.configuration),e.prototype.attach.call(this,t),this.viewModel.startColor.color.bind(this,this.applySettings),this.viewModel.endColor.color.bind(this,this.applySettings);for(var i=function(e){e.symbologyWidget.viewModel.markerSize.sync(r.viewModel.markerSize),e.symbologyWidget.viewModel.lineWidth.sync(r.viewModel.lineWidth),e.symbologyWidget.viewModel.fill.color.syncTransform(r.viewModel.transparency,function(t){return e.symbologyWidget.viewModel.fill.color.get().setAlpha((100-t)/100)}),e.pictureSymbologyWidget&&e.pictureSymbologyWidget.viewModel.imageSize.sync(r.viewModel.markerSize)},r=this,n=0,a=this.viewModel.classSymbolWidgets;n<a.length;n++){var o=a[n];i(o)}this.viewModel.classBreaksInput.range.value.bind(this,this.applySettings),this.viewModel.startColor.color.bind(this,this._updateColorGradient),this.viewModel.endColor.color.bind(this,this._updateColorGradient)},t.prototype.added=function(t){t.attributeSettingsView=this,e.prototype.added.call(this,t),this.viewModel.classBreaksInput.range.value.pulse()},t.prototype.getRenderer=function(){return this.viewModel._getRenderer()},t.prototype.setFromRenderer=function(e){this.viewModel._setFromRenderer(e)},t.prototype.reset=function(){if(this.viewModel.configuring=!0,this.viewModel._reset(),!this.viewModel.currentAttribute.get()){var e=document.createElement("option");e.disabled=!0,e.selected=!0,e.hidden=!0,e.value="",e.text=this.app.getResource(this.libraryId,"language-symbology-settings-attribute-select"),this.attributeInput.add(e,0)}this.viewModel.configuring=!1},t.prototype.handleMarkerStyle=function(){this.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex;for(var e=0,t=this.viewModel.classSymbolWidgets;e<t.length;e++){var i=t[e];i.symbologyWidget.viewModel.markerStyleIndex=this.viewModel.markerStyleIndex}this.applySettings()},t.prototype.applySettings=function(){if(!this.viewModel.configuring){this.viewModel.configuring=!0;var e;e=this.viewModel.attributes.getLength()<this.attributeInput.length?this.viewModel.attributes.getAt(this.attributeInput.selectedIndex-1):this.viewModel.attributes.getAt(this.attributeInput.selectedIndex),!this.viewModel.creatingClasses&&e&&(e.displayName!==this.viewModel.currentAttribute.get()?this._updateClasses(e):(this.viewModel.isNumericAttribute.get()||0!==this.viewModel.symbologyClasses.getLength())&&(this.viewModel.numericAttributeIsUniqueValue||this.viewModel.symbologyClasses.getLength()===this.viewModel.numBreaks.get())?this.viewModel.symbologyClasses.getLength()>this.viewModel.numBreaks.get()&&this._updateClasses(e):this._updateClasses(e)),this.markerStyleInput.selectedIndex=this.viewModel.markerStyleIndex;for(var t=0,i=this.viewModel.classSymbolWidgets;t<i.length;t++){var r=i[t];r.applySettings()}this.viewModel.configuring=!1}},t.prototype._updateClasses=function(e){var t=this;setTimeout(function(){t.viewModel.configuring=!0,t.viewModel.lineWidth.pulse(),t.viewModel.markerSize.pulse(),t.viewModel.transparency.pulse(),t.viewModel.startColor.color.pulse(),t.viewModel.endColor.color.pulse(),t.viewModel.configuring=!1},0);for(var i=0,n=this.viewModel.classSymbolWidgets;i<n.length;i++){var a=n[i];a.reset()}this.viewModel.creatingClasses=!0,this.app.command("RemoveResultsStatus").execute(),this.viewModel._getFieldInfo(e).then(function(i){var n={field:e,fieldInfo:i};e.dataType===r.EssentialsFieldTypes.essentialsFieldTypeString||n.fieldInfo.isCodedValueDomain()||n.fieldInfo.hasSubtypeCodedValueDomains()?(t.viewModel.classBreaksMode.set(!1),t.viewModel.isNumericAttribute.set(!1),t.viewModel._createUniqueValues(n)):(t.viewModel.classBreaksMode.set(!0),t.viewModel.isNumericAttribute.set(!0),t.viewModel._createClassBreaks(n))}),this.viewModel.currentAttribute.set(e.displayName)},t.prototype._updateColorGradient=function(){if(!this.viewModel.configuring&&!this.viewModel.creatingClasses){this.viewModel.startColor.color.get(),this.viewModel.endColor.color.get();this.viewModel._createRendererClasses()}},t.prototype.handleSymbolClassSelected=function(e){var t=this,i=e.currentTarget.children[0],r=i.textContent||i.innerText,n=this.viewModel.symbologyClasses.getItems().filter(function(e){return e.name===r})[0],a=this.viewModel.symbologyClasses.indexOf(n),o=function(e,t){var i=esri.symbol.fromJson(JSON.parse(t.getSymbol()));i instanceof esri.symbol.PictureMarkerSymbol?(e.isImage.set(!0),e.imageSrc=i.url):(e.isImage.set(!1),e.imageSrc="",e.displayColor=t.symbologyWidget.viewModel.fill.color.get().toHex())};if(r===this.viewModel.selectedClass)this.viewModel.selectedClass=null,n.selected=!1,o(n,this.viewModel.classSymbolWidgets[a]);else{var s=this.viewModel.symbologyClasses.getItems().filter(function(e){return e.name===t.viewModel.selectedClass})[0],l=this.viewModel.symbologyClasses.indexOf(s),c=this.viewModel.classSymbolWidgets[l];s&&(s.selected=!1,o(s,c)),this.viewModel.selectedClass=r,n.selected=!0}this.viewModel.symbologyClasses.pulse(),$(this.viewModel.classSymbolWidgets[a].container).appendTo($("#"+n.widgetId,this.root)),this.viewModel.classSymbolWidgets[a].symbologyWidget.activated(),this.viewModel.classSymbolWidgets[a].pictureSymbologyWidget&&this.viewModel.classSymbolWidgets[a].pictureSymbologyWidget.activated()},t}(i.ViewBase);t.AttributeSymbologySettingsView=n})},"geocortex/infrastructure/tools/DisablingMapTool":function(){define(["require","exports","geocortex/infrastructure/tools/MapTool","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var n=e.call(this,t,i)||this;if(n.enabled=new r.Observable((!0)),i.command){var a=t.command(i.command);n.enabled.set(a.canExecute()),a.canExecuteChanged.subscribe(n,function(){var e=a.canExecute();!e&&n.isActive&&n.setActive(!1),n.enabled.set(e)})}return n}return __extends(t,e),t}(i.MapTool);t.DisablingMapTool=n})},"geocortex/infrastructure/visualization/VisualizationProviderConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/visualization/VisualizationProviderBase":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";var r=function(){function e(e,t){this.visualizations=[],this.enabledVisualization=null,this.currentLayer=new i.Observable(null),this.isEnabled=new i.Observable((!1)),this.isSupported=new i.Observable((!1)),this.app=e,this.libraryId=t,this.currentLayer.bind(this,this.handleCurrentLayerChanged)}return e.prototype.initialize=function(e){e.viewId&&(this.viewId=e.viewId),e.displayName&&(this.displayName=e.displayName)},e.prototype.canSupport=function(e){return!1},e.prototype.handleCurrentLayerChanged=function(e){throw new Error("Not implemented")},e.prototype.handleActivate=function(e){throw new Error("Not implemented")},e.prototype.handleApply=function(){throw new Error("Not implemented")},e}();t.VisualizationProviderBase=r})},"geocortex/infrastructure/webMap/LocationInfo":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/CsvLayer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webMap/WmsLayer":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webSocket/Protocol":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webSocket/SendMessageOptions":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/webSocket/WebSocketConnection":function(){define(["require","exports","geocortex/infrastructure/webSocket/WebSocketCommand","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(){function e(e){this.app=e,this.reconnectionMin=250,this.reconnectionMax=3e4,this.reconnectionGrowthFactor=4,this.maxMessageQueueLength=8,this._commands={},this._connectionString="",this._queuedMessages=[],this._reconnectionWait=this.reconnectionMin,this._ws=null,this.isConnected=new r.Observable((!1))}return e.hasBrowserSupport=function(){return"WebSocket"in window},e.prototype.connect=function(e){var t=this;return e?e.startsWith("ws://")||e.startsWith("wss://")?this._ws?void this.app.trace.error("WebSocketServer already connected."):(this._connectionString=e,void(this.app.site&&this.app.site.isInitialized?this._connectWebSocket():this.app.event("SiteInitializedEvent").once(this,function(){t._connectWebSocket()}))):void this.app.trace.error("WebSocketServer connection string must start with ws:// or wss://."):void this.app.trace.error("WebSocketServer connection string missing.")},e.prototype.sendMessage=function(e,t){if(!e)throw new Error("Message cannot be null.");if(!e.type)throw new Error("Message missing type.  This is not a proper message.");if(this._ws&&this._ws.readyState==this._ws.OPEN){try{var i=JSON.stringify(e)}catch(r){return void this.app.trace.error("WebSocketServer can't serialize message: "+r.message)}this._ws.send(i)}else if(!t||t.queue!==!1)for(this._queuedMessages.push({msg:e,expirationTime:t&&t.maxAgeQueuedMillis?new Date(Date.now()+t.maxAgeQueuedMillis):null});this._queuedMessages.length>this.maxMessageQueueLength;)this._queuedMessages.shift()},e.prototype.command=function(e){return this._commands.hasOwnProperty(e)||(this._commands[e]=new i.WebSocketCommand(e,this)),this._commands[e]},e.prototype._connectWebSocket=function(){var t=this;if(!e.hasBrowserSupport())return void this.app.trace.warning("Web sockets are not supported on this browser.");if(this._ws&&(this._ws.readyState==this._ws.CONNECTING||this._ws.readyState==this._ws.OPEN))return void this.app.trace.debug("WebSocketServer already connected, aborting reconnect.");if(this.app.isOffline.get())return this.app.trace.debug("WebSocketServer connect attempt skipped because the application is in offline mode."),void this._reconnectWebSocket();try{this._ws=new WebSocket(this._connectionString)}catch(i){this.app.trace.error("WebSocketServer error opening socket: "+i.message)}this._ws.onopen=function(e){return t._onOpen(e)},this._ws.onclose=function(e){return t._onClose(e)},this._ws.onerror=function(e){return t._onError(e)},this._ws.onmessage=function(e){return t._onMessage(e)}},e.prototype._reconnectWebSocket=function(){var e=this;this.app.trace.debug("WebSocketServer reconnecting in "+this._reconnectionWait+"..."),setTimeout(function(){return e._connectWebSocket()},this._reconnectionWait),this._reconnectionWait=Math.ceil(Math.min(this._reconnectionWait*this.reconnectionGrowthFactor,this.reconnectionMax))},e.prototype._onOpen=function(e){this.isConnected.set(!0),this.app.trace.debug("WebSocketServer connected.");var t=this._queuedMessages;this._queuedMessages=[];for(var i=Date.now();t.length>0;){var r=t.shift();r.expirationTime&&r.expirationTime.getTime()>i||this.sendMessage(r.msg)}},e.prototype._onClose=function(e){this.isConnected.set(!1),this.app.trace.debug("WebSocketServer disconnected."),this._reconnectWebSocket()},e.prototype._onError=function(e){this.isConnected.set(!1),this.app.trace.error("WebSocketServer web socket error: "+e.message)},e.prototype._onMessage=function(e){try{var t=JSON.parse(e.data)}catch(i){return this.app.trace.error("WebSocketServer error deserializing inbound message: "+i.message),void(this.app.debugMode&&this.app.trace.error(e.data))}if(!t.type)return this.app.trace.error("WebSocketServer incoming message missing type."),void(this.app.debugMode&&this.app.trace.error(e.data));switch(t.type){case"Event":this._onEventMessage(t);break;case"Error":this._onErrorMessage(t);break;default:this.app.trace.error("WebSocketServer unknown message type '"+t.type+"'."),this.app.debugMode&&this.app.trace.error(e.data)}},e.prototype._onEventMessage=function(e){if(!e.name||"string"!=typeof e.name)return void this.app.trace.error("WebSocketServer message missing name.");var t=this.app.event(e.name);t.publish.apply(t,e.args||[])},e.prototype._onErrorMessage=function(e){return e.message&&"string"==typeof e.message?void this.app.trace.error("WebSocketServer remote error: "+e.message):void this.app.trace.error("WebSocketServer error from server with missing message.")},e}();t.WebSocketConnection=n})},"geocortex/infrastructure/webSocket/WebSocketCommand":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.name=e,this.ws=t,this.queue=void 0,this._syncedCommands=[]}return e.prototype.execute=function(e){var t={type:"Command",name:this.name,args:e},i={queue:this.queue,maxAgeQueuedMillis:this.maxAgeQueuedMillis};this.ws.sendMessage(t,i)},e.prototype.sync=function(e){if(!this._syncedCommands.some(function(t){return t.command===e})){var t=e.register(this,this.execute);this._syncedCommands.push({command:e,token:t})}},e}();t.WebSocketCommand=i;var r=function(){function e(e,t){this.impl=e,this.scope=t}return e}();t.CommandRegistrationEntry=r})},"geocortex/infrastructure/legend/LegendItemProviderEntry":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.identifier=e,this._provider=t}return e}();t.LegendItemProviderEntry=i})},"geocortex/infrastructure/symbology/widgets/TextSymbolWidgetConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/symbology/widgets/TextSymbolWidgetViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/ColorUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/BrowserUtils"],function(e,t,i,r,n,a,o,s,l){"use strict";var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fontFamily=new r.Observable("sans-serif"),t.symbolText=new r.Observable(""),t.fontColor={color:new r.Observable},t.fontHalo={color:new r.Observable},t.fontFamilies=new r.ObservableCollection(["serif","sans-serif"]),t.fontIsBold=new r.Observable((!1)),t.fontIsItalic=new r.Observable((!1)),t.fontIsUnderline=new r.Observable((!1)),t.isIE9or11=!1,t.showHaloSize=new r.Observable((!0)),t.showHaloColor=new r.Observable((!0)),t.showFontStyle=new r.Observable((!0)),t.showFontSize=new r.Observable((!0)),t.showFontColor=new r.Observable((!0)),t.showFontFamilies=new r.Observable((!0)),t.showTextAngle=new r.Observable((!0)),t.showText=new r.Observable((!0)),t.initialized=!1,t.configuring=!1,t}return __extends(t,e),t.prototype.initialize=function(e){void 0===e&&(e={});var t=l.isIE();this.isIE9or11=9===t||11===t,this.showHaloSize.set(!this.isIE9or11),this.showHaloColor.set(!this.isIE9or11);var i=this.app.configModel.widgetConfigs.filter(function(e){return"TextSymbolWidget"===e.id})[0];if(i){var n={};$.extend(n,i.configuration,e),this.config=n}else this.config=e;null==this.config.showSliders&&(this.config.showSliders=!0),this.config.fontSize=this.config.fontSize||{min:10,max:64,value:18,step:1},this.fontSize=new r.Observable(this.config.fontSize.value),this.fontSizeViewModel={range:{min:this.config.fontSize.min,max:this.config.fontSize.max,value:this.fontSize,step:this.config.fontSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.haloSize=this.config.haloSize||{min:0,max:5,value:2,step:1},this.haloSize=new r.Observable(this.config.haloSize.value),this.haloSizeViewModel={range:{min:this.config.haloSize.min,max:this.config.haloSize.max,value:this.haloSize,step:this.config.haloSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.textAngle=new r.Observable(0),this.textAngleViewModel={range:{min:0,max:360,value:this.textAngle,step:1},showSlider:this.config.showSliders,updateOnDrag:!0},void 0!==this.config.fontFamilies&&(this.fontFamilies.set(this.config.fontFamilies),this.fontFamily.set(this.fontFamilies.getAt(0))),void 0!==this.config.haloSizeIsVisible&&this.showHaloSize.set(this.config.haloSizeIsVisible&&!this.isIE9or11),void 0!==this.config.haloColorIsVisible&&this.showHaloColor.set(this.config.haloColorIsVisible&&!this.isIE9or11),void 0!==this.config.fontSizeIsVisible&&this.showFontSize.set(this.config.fontSizeIsVisible),void 0!==this.config.fontStyleIsVisible&&this.showFontStyle.set(this.config.fontStyleIsVisible),void 0!==this.config.fontColorIsVisible&&this.showFontColor.set(this.config.fontColorIsVisible),void 0!==this.config.fontFamiliesIsVisible&&this.showFontFamilies.set(this.config.fontFamiliesIsVisible),void 0!==this.config.textAngleIsVisible&&this.showTextAngle.set(this.config.textAngleIsVisible),void 0!==this.config.textIsVisible&&this.showText.set(this.config.textIsVisible),this._setFromSymbol(s.defaultTextSymbol(this.isIE9or11)),this.initialized=!0},t.prototype.reset=function(){this.symbolText.set(""),this.fontSize.set(this.config.fontSize.value),this.haloSize.set(this.config.haloSize.value),this.textAngle.set(0),this.fontFamily.set(this.fontFamilies.getAt(0)),this.fontColor.color.set(o.generateRandomColor()),this.fontHalo.color.set(this.fontColor.color.get().value>=.7?this.fontColor.color.get().darken(.6):this.fontColor.color.get().lighten(.8))},t.prototype._getSymbol=function(){return this.symbol?JSON.stringify(this.symbol.toJson()):""},t.prototype._setFromSymbol=function(e){e instanceof esri.symbol.TextSymbol&&this._setFromSymbolObject(e.toJson())},t.prototype._setFromSymbolObject=function(e){this.configuring=!0,e.text&&this.symbolText.set(e.text),e.angle?this.textAngle.set(Math.ceil(a.webMapAngleToJSAPIAngle(e.angle)/this.textAngleViewModel.range.step)*this.textAngleViewModel.range.step):this.textAngle.set(0),this.fontColor.color.set(new n.SymbolColor({r:e.color[0]/255,g:e.color[1]/255,b:e.color[2]/255,a:e.color[3]/255})),e.haloColor?this.fontHalo.color.set(new n.SymbolColor({r:e.haloColor[0]/255,g:e.haloColor[1]/255,b:e.haloColor[2]/255,a:e.haloColor[3]/255})):this.fontHalo.color.set(new n.SymbolColor("#FFFFFF")),e.haloSize?this.haloSize.set(e.haloSize*a.POINTS_TO_PIXELS):this.haloSize.set(0);var t=e.font.family.split(",")[0];this.fontFamilies.contains(t)||this.fontFamilies.addItem(t),this.fontFamily.set(t),this.fontSize.set(Math.ceil(e.font.size/this.fontSizeViewModel.range.step)*this.fontSizeViewModel.range.step||16),this.fontIsBold.set("bold"===e.font.weight),this.fontIsItalic.set("italic"===e.font.style),this.fontIsUnderline.set("underline"===e.font.decoration),this.configuring=!1},t}(i.ViewModelBase);t.TextSymbolWidgetViewModel=c})},"geocortex/infrastructure/symbology/widgets/TextSymbolWidget":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName=t.app.getResource(t.libraryId,"language-symbology-settings-text-displayname"),t.editingMarkup=!1,t}return __extends(t,e),t.prototype.attach=function(t){var i=this;t.initialized||t.initialize(this.configuration),e.prototype.attach.call(this,t),this.viewModel.fontColor.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontHalo.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.haloSize.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontSize.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.textAngle.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.symbolText.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontFamily.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontIsBold.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontIsItalic.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontIsUnderline.bind(this,function(){i.viewModel.configuring||i.applySettings()})},t.prototype.added=function(t){t&&(t.textSymbologySettingsWidget=this,e.prototype.added.call(this,t))},t.prototype.activated=function(){var e=this;setTimeout(function(){e.viewModel.configuring=!0,e.viewModel.fontColor.color.pulse(),e.viewModel.fontHalo.color.pulse(),e.viewModel.haloSize.pulse(),e.viewModel.fontSize.pulse(),e.viewModel.textAngle.pulse(),e.viewModel.configuring=!1},0)},t.prototype.reset=function(){this.viewModel.reset()},t.prototype.getSymbol=function(e){return void 0===e&&(e=!0),this.viewModel.symbol||this.applySettings(e),this.viewModel._getSymbol()},t.prototype.setFromSymbol=function(e,t){void 0===t&&(t=!0),e instanceof esri.symbol.TextSymbol&&(this.viewModel._setFromSymbol(e),!this.editingMarkup&&t&&this.applySettings())},t.prototype.applySettings=function(e){if(void 0===e&&(e=!0),this.viewModel.initialized){this.viewModel.configuring=!0;var t=this.viewModel.fontColor.color.get().toEsriColor(),i=this.viewModel.fontHalo.color.get().toEsriColor(),r=this.viewModel.fontSize.get(),n=this.viewModel.haloSize.get(),a=this.viewModel.fontIsBold.get(),o=this.viewModel.fontIsItalic.get(),s=this.viewModel.fontIsUnderline.get(),l=new esri.symbol.TextSymbol(this.viewModel.symbolText.get());l.setFont(new esri.symbol.Font(r+"pt",o?esri.symbol.Font.STYLE_ITALIC:esri.symbol.Font.STYLE_NORMAL,esri.symbol.Font.VARIANT_NORMAL,a?esri.symbol.Font.WEIGHT_BOLD:esri.symbol.Font.WEIGHT_NORMAL,this.viewModel.fontFamily.get())),l.setColor(t),l.setHaloColor(i),l.setHaloSize(n),l.setDecoration(s?"underline":"none"),l.setAngle(this.viewModel.textAngle.get()),l.setAlign(esri.symbol.TextSymbol.ALIGN_START),this.viewModel.symbol=l,e&&this.onChange&&this.isActive&&(!this.parentView||this.parentView.isActive)&&this.onChange(JSON.stringify(l.toJson())),this.viewModel.configuring=!1}},t}(i.ViewBase);t.TextSymbolWidget=r})},"geocortex/infrastructure/toolbarGroup/types/ToolbarButton":function(){define(["require","exports","geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase","geocortex/framework/observables","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(require,exports,ToolbarGroupItemBase_2,observables_54,ToolbarGroupBase_3){"use strict";var ToolbarButton=function(_super){function ToolbarButton(app,libraryId,entry){var _this=_super.call(this,app,libraryId,entry)||this,commandName=entry.command,commandParameter=entry.commandParameter,cvmCtor=eval("geocortex.essentialsHtmlViewer.mapping.modules.command.CommandViewModel");return _this.command=new cvmCtor(_this.app,(void 0),commandName,commandParameter),_this.disabled.set(!_this.command.canExecute.get()),_this.setHidden(),_this.command.canExecute.bind(_this,function(e){_this.disabled.set(!e),_this.setHidden()}),_this.iconUri=new observables_54.Observable(entry.iconUri),_this.app.site&&_this.app.site.isInitialized||_this.app.event("SiteInitializedEvent").once(_this,_this._raiseCommandCanExecuteChanged),_this}return __extends(ToolbarButton,_super),ToolbarButton.prototype.execute=function(){
this.command&&this.command.commandName&&(this.command.commandParameter?this.app.commandRegistry.command(this.command.commandName).execute(this.command.commandParameter):this.app.commandRegistry.command(this.command.commandName).execute());var e={commandName:this.command.commandName,commandParameter:this.command.commandParameter,id:this.id,name:this.name.get(),libraryId:this.libraryId};this.app.event("ToolbarButtonClickedEvent").publish(e)},ToolbarButton.prototype._raiseCommandCanExecuteChanged=function(){this.command.commandName&&this.app.command(this.command.commandName).raiseCanExecuteChanged()},ToolbarButton}(ToolbarGroupItemBase_2.ToolbarGroupItemBase);exports.ToolbarButton=ToolbarButton,ToolbarGroupBase_3.registerToolbarFactoryMethod("button",function(e,t,i){return new ToolbarButton(e,t,i)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarGroup":function(){define(["require","exports","geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase","geocortex/framework/observables","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i,n){var a=e.call(this,t,i,n)||this;n.layout&&"small"===n.layout.toLowerCase()&&a.hasSmallLayout.set(!0),a.items=new r.ObservableCollection;for(var o=0;o<n.items.length;o++){var s=a.getToolbarItemType(n.items[o]);s&&a.items.addItem(s)}return a.disabled.set(a.areAllHidden(a.items)),a.setHidden(),a.disabled.bind(a,function(e){a.setHidden()}),a}return __extends(t,e),t.prototype.getToolbarItemType=function(e){return n.createToolbarItem(this.app,this.libraryId,e)},t}(i.ToolbarGroupItemBase);t.ToolbarGroup=a,n.registerToolbarFactoryMethod("toolbarGroup",function(e,t,i){return new a(e,t,i)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarFlyout":function(){define(["require","exports","geocortex/infrastructure/toolbarGroup/types/ToolbarGroup","geocortex/framework/observables","geocortex/infrastructure/tools/MapTool","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i,n){var a=e.call(this,t,i,n)||this;return a.flyoutButtonDescription=new r.Observable(""),a.selectedTool.set(a.items.getAt(0)),a.flyoutButtonDescription.set(a.app.getResource(a.libraryId,"language-toolbar-flyout-description").format(a.name.get())),a.app.event("ActiveToolChangedEvent").subscribe(a,function(e){var t=a.items.get().filter(function(t){return a._seeIfActiveToolIsInFlyout(t,e)});t.length>0&&a.selectedTool.set(t[0])}),a}return __extends(t,e),t.prototype._seeIfActiveToolIsInFlyout=function(e,t){if(!(e.tool instanceof n.MapTool))return!1;var i=e.tool;if(t.tool instanceof n.MapTool){var r=t.tool;return i.command===r.command&&i.drawMode===r.drawMode}return!1},t.prototype.toggleFlyout=function(){this.toolChangeActive.set(!this.toolChangeActive.get())},t.prototype.switchActiveFlyoutTool=function(e){"tool"===e.type&&this.selectedTool.set(e),e.execute()},t.prototype.getToolbarItemType=function(e){return a.createToolbarItem(this.app,this.libraryId,e)},t}(i.ToolbarGroup);t.ToolbarFlyout=o,a.registerToolbarFactoryMethod("flyout",function(e,t,i){return new o(e,t,i)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarRegion":function(){define(["require","exports","geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.regionName=r.regionName,n}return __extends(t,e),t}(i.ToolbarGroupItemBase);t.ToolbarRegion=n,r.registerToolbarFactoryMethod("region",function(e,t,i){return new n(e,t,i)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarTool":function(){define(["require","exports","geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase","geocortex/framework/observables","geocortex/infrastructure/toolbarGroup/ToolbarGroupBase"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i,n){var a=e.call(this,t,i,n)||this;if(!n)return a;var o={};for(var s in n){if(!s)break;o[s]=n[s]}o.name=n.id;var l=[];return l.push(o),a.app.allLibrariesLoaded?a._initializeTool(l):(a.disabled.set(!0),a.setHidden(),a.app.event("ViewerLibrariesDownloadedEvent").once(a,function(){a.disabled.set(!1),a.setHidden(),a._initializeTool(l)})),a.isActive.set(!1),a.iconUri=new r.Observable(n.iconUri),a.app.event("StateEnteredEvent").subscribe(a,function(e){a.isActive.get()&&"TransientActiveState"===e.stateDefinition.name&&a.activeTransient.set(!0)}),a.app.event("StateExitedEvent").subscribe(a,function(e){"TransientActiveState"===e.stateDefinition.name&&a.activeTransient.set(!1)}),a}return __extends(t,e),t.prototype.execute=function(){this.isActive.get()||this.tool.isActive?this.app.commandRegistry.command("ClearActiveTool").execute():this.tool.enabled&&!this.tool.enabled.get()||this.app.commandRegistry.command("SetActiveTool").execute(this.tool.id)},t.prototype._initializeTool=function(e){var t=this;this.tool=this.app.toolRegistry.createTools(e,!0)[0],this.tool?this.tool.enabled&&(this.disabled.set(!this.tool.enabled.get()),this.setHidden(),this.tool.enabled.bind(this,function(e){t.disabled.set(!e),t.setHidden(),e||!t.isActive.get()&&!t.tool.isActive||t.app.commandRegistry.command("ClearActiveTool").execute()})):(this.disabled.set(!0),this.setHidden())},t}(i.ToolbarGroupItemBase);t.ToolbarTool=a,n.registerToolbarFactoryMethod("tool",function(e,t,i){return new a(e,t,i)})})},"geocortex/infrastructure/ui/components/ProviderConfiguration":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/ColorPicker/ColorPickerWidget":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.added=function(){this.initialize(this.configuration)},t.prototype.initialize=function(e){var t;return(t=dojo.getObject(e.provider))?(this.provider=new t(this.app,this.libraryId),this.provider.initialize(this),void(this.bindingToken=this.viewModel.color.bind(this.provider,this.provider.setColor))):void this.app.trace.error("{0} can't find color picker provider typed {1}".format(this.id,e.provider))},t.prototype.updateColor=function(e){this.viewModel.color.set(e)},t}(i.ViewBase);t.ColorPickerWidget=r})},"geocortex/infrastructure/ui/components/ColorPicker/ColorPickerProviderBase":function(){define(["require","exports","geocortex/infrastructure/symbology/SymbolColor"],function(e,t,i){"use strict";var r=function(){function e(e,t){this.color=new i.SymbolColor("#000000"),this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){throw new Error("Not implemented")},e.prototype.setColor=function(e){throw new Error("Not implemented")},e}();t.ColorPickerProviderBase=r})},"geocortex/infrastructure/ui/components/ColorPicker/KendoColorPickerProvider":function(){define(["require","exports","geocortex/infrastructure/symbology/SymbolColor","geocortex/infrastructure/ui/components/ColorPicker/ColorPickerProviderBase"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.initialize=function(e){this.widget=e},t.prototype.instantiate=function(){this.colorpicker=$(this.widget.colorInput).kendoColorPicker({buttons:!1,opacity:!0,preview:!0,select:this.updateColor.bind(this)}).data("kendoColorPicker"),this.colorpicker&&this.colorpicker.value(this.color.toRGBAString())},t.prototype.setColor=function(e){this.color=e,this.colorpicker?this.colorpicker.value(e.toRGBAString()):this.instantiate()},t.prototype.updateColor=function(e){this.color=new i.SymbolColor(e.value),this.widget.updateColor(this.color)},t}(r.ColorPickerProviderBase);t.KendoColorPickerProvider=n})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlViewBase":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleFilterTextClear=function(e,t,i){throw new Error("Not Implemented. Please extend this class to implement.")},t.prototype.handleFilterButtonClick=function(e,t,i){throw new Error("Not Implemented. Please extend this class to implement.")},t}(i.ViewBase);t.FilterControlViewBase=r})},"geocortex/infrastructure/ui/components/Forms/FormItemViewBase":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));this.viewModel=t,this.addDisposableBinding(t.isValid,t.isValid.bind(this,function(e){this.calculateIndicatorDisplay()})),this.addDisposableBinding(t.isRequired,t.isRequired.bind(this,function(e){this.calculateIndicatorDisplay()})),this.calculateIndicatorDisplay(),e.prototype.attach.call(this,t)},t.prototype.calculateIndicatorDisplay=function(){this.viewModel.attached_showIndicator&&(this.viewModel.attached_showIndicator.set(this.viewModel.isRequired.get()===!0||this.viewModel.isValid.get()===!1),0==this.viewModel.isValid.get()?this.viewModel.attached_indicatorClass.set("form-item invalid"):this.viewModel.attached_indicatorClass.set("form-item required"))},t}(i.ViewBase);t.FormItemViewBase=r})},"geocortex/infrastructure/ui/components/Forms/FormsUtils":function(){define(["require","exports","geocortex/essentials/Field","geocortex/infrastructure/FormatUtils"],function(e,t,i,r){"use strict";var n=function(){function e(){}return e.convertToHTMLSyntax=function(t){if(null===t.get()||void 0===t.get())return null;for(var i in e.patterns){if(!i||void 0===i||null===i)break;var r=new RegExp(i,"g");t.set(t.get().replace(r,e.patterns[i]))}},e.formatListItem=function(e,t){switch(t){case i.EsriFieldTypes.esriFieldTypeDate:return r.formatDate(r.parseDate(e));case i.EsriFieldTypes.esriFieldTypeOID:case i.EsriFieldTypes.esriFieldTypeSmallInteger:case i.EsriFieldTypes.esriFieldTypeInteger:case i.EsriFieldTypes.esriFieldTypeSingle:case i.EsriFieldTypes.esriFieldTypeDouble:return r.formatNumber(r.parseNumber(e));default:return e}},e}();n.patterns={"\\n":"<br />","\\t":"&nbsp; &nbsp; &nbsp; &nbsp;"},t.FormsUtils=n})},"geocortex/infrastructure/ui/components/Forms/AutoCompleteBoxFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/infrastructure/ui/components/Forms/FormsUtils"],function(require,exports,FormItemViewBase_1,observables_58,utils_32,FormsUtils_1){"use strict";var AutoCompleteBoxFormItemView=function(_super){function AutoCompleteBoxFormItemView(e,t){var i=_super.call(this,e,t)||this;return i.textElement=null,i.dropDownContainerElement=null,i.dropDownListElement=null,i.timer=null,i.positionIndex=null,i.lastKeyEvent=null,i.keyTraverseInterval=null,i.closeTimer=null,i._queryCancelled=!1,i._searchFocus=!1,i.isBusy=new observables_58.Observable((!1)),i.positionIndex=0,i.keyTraverseInterval=25,i}return __extends(AutoCompleteBoxFormItemView,_super),AutoCompleteBoxFormItemView.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.isDropDownOpen=new observables_58.Observable((!1)),e.attached_controlId=new observables_58.Observable("textbox-{0}".format(utils_32.alphaNumericToken())),e.queryTaskRunner&&(e.queryTaskRunner.formatCallback=FormsUtils_1.FormsUtils.formatListItem),_super.prototype.attach.call(this,e),this.lastKeyEvent=(new Date).getTime(),this.addDisposableBinding(this.viewModel.dataItems,this.viewModel.dataItems.bind(this,function(e){if(this.isBusy.set(!1),this.viewModel.dataItems.getLength()>0){if(this.positionIndex=0,this._queryCancelled)return;this.openDropDown()}else this.closeDropDown()}))},AutoCompleteBoxFormItemView.prototype.handleInputBlurEvent=function(e,t,i){var r=this;this.isBusy.set(!1),this._searchFocus=!1,this.closeTimer=setTimeout(function(){r._searchFocus||(r._queryCancelled=!0,r.viewModel.queryTaskRunner.triggerCascading(i.text.get()),r.closeDropDown())},750)},AutoCompleteBoxFormItemView.prototype.handleInputClickEvent=function(e,t,i){t.focus()},AutoCompleteBoxFormItemView.prototype.handleInputFocusEvent=function(e,t,i){this._queryCancelled=!1,this._searchFocus=!0},AutoCompleteBoxFormItemView.prototype.handleDropdownFocusEvent=function(e,t,i){var r=this;return setTimeout(function(){r._searchFocus=!0},100),null!=this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),!0},AutoCompleteBoxFormItemView.prototype.handleDropdownBlurEvent=function(e,t,i){return this.closeDropDown(),!0},AutoCompleteBoxFormItemView.prototype.handleClickItem=function(e,t,i){this.viewModel.text.set(i.display),this.viewModel.queryTaskRunner.triggerCascading(i.display),this.closeDropDown()},AutoCompleteBoxFormItemView.prototype.openDropDown=function(){eval('geocortex.essentialsHtmlViewer["___userInAutoComplete"] = true'),this.viewModel.isDropDownOpen.set(!0),this.positionIndex=-1,$(this.dropDownContainerElement).removeClass("inactive").addClass("active")},AutoCompleteBoxFormItemView.prototype.closeDropDown=function(){eval('geocortex.essentialsHtmlViewer["___userInAutoComplete"] = false'),this.viewModel.isDropDownOpen.set(!1),$(this.dropDownContainerElement).removeClass("active").addClass("inactive")},AutoCompleteBoxFormItemView.prototype.setDropDownPosition=function(e){e=Math.min(e,this.viewModel.dataItems.getLength()-1),dojo.removeClass(this.dropDownListElement,"autocomplete-highlight"),this.positionIndex=Math.max(0,e);var t=$("li",this.dropDownListElement).eq(this.positionIndex);$(t).addClass("autocomplete-highlight");var i=this.viewModel.dataItems.getAt(this.positionIndex);i&&this.viewModel.text.set(i.display),t.length>0&&$(this.dropDownContainerElement).scrollTop($(this.dropDownContainerElement).scrollTop()+$(t).position().top-$(this.dropDownContainerElement).height()/2+$(t).height()/2)},AutoCompleteBoxFormItemView.prototype.handleDropdownKeyDown=function(e,t,i){return 13!==e.which||this.handleKeyEvent(e,t,i)},AutoCompleteBoxFormItemView.prototype.handleKeyEvent=function(e,t,i){var r=(new Date).getTime();if(r-this.lastKeyEvent>this.keyTraverseInterval)if(this.lastKeyEvent=r,38===e.which||40===e.which)this.viewModel.isDropDownOpen.get()&&(40===e.which?this.setDropDownPosition(this.positionIndex+1):38===e.which&&this.setDropDownPosition(this.positionIndex-1));else{if(this.viewModel.isDropDownOpen.get()&&13===e.which){var n=this.viewModel.dataItems.getAt(this.positionIndex);return n&&(this.viewModel.text.set(n.display),this.viewModel.queryTaskRunner.triggerCascading(n.display)),this.closeDropDown(),null!=this.timer&&clearInterval(this.timer),!1}if(this.viewModel.isDropDownOpen.get()&&8===e.which)return this.closeDropDown(),this.viewModel.queryTaskRunner.triggerCascading(null),8==e.which&&this.trigger(),!1;if(9===e.which||37===e.which||39===e.which)return!0;if(13===e.which)return this.viewModel.queryTaskRunner.triggerCascading(i.display),!1;this.trigger()}return!0},AutoCompleteBoxFormItemView.prototype.trigger=function(){var e=this;null!=this.timer&&clearInterval(this.timer),this.textElement.value.length>=this.viewModel.minimumPrefixLength.get()&&(this.timer=setTimeout(function(){e.filter(!1)},this.viewModel.minimumPopulateDelay.get()))},AutoCompleteBoxFormItemView.prototype.filter=function(e){null!=this.timer&&(clearInterval(this.timer),this.timer=null),this.closeDropDown(),this.viewModel.queryTaskRunner.performQuery(this.textElement.value,e)},AutoCompleteBoxFormItemView}(FormItemViewBase_1.FormItemViewBase);exports.AutoCompleteBoxFormItemView=AutoCompleteBoxFormItemView})},"geocortex/infrastructure/ui/components/Forms/CheckBoxFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.attached_textOnLeft=new r.Observable((!1)),this.addDisposableBinding(t.textLocation,t.textLocation.bind(this,function(e){t.attached_textOnLeft.set("left"===e.toLowerCase())})),t.textLocation.pulse(),t.attached_controlId=new r.Observable("checkbox-{0}".format(n.alphaNumericToken())),t.attached_labelText=null!=t.text?new r.Observable(t.text.get()):"",e.prototype.attach.call(this,t)},t}(i.FormItemViewBase);t.CheckBoxFormItemView=a})},"geocortex/infrastructure/ui/components/Forms/ContainerFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/infrastructure/ui/components/Forms/FormsUtils","geocortex/infrastructure/FilterUtils","geocortex/framework/events/ViewDimensionsChangedArgs"],function(e,t,i,r,n,a,o){"use strict";var s=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.attached_style=new r.Observable(""),n.attached_isHorizontal=new r.Observable((!1)),n}return __extends(t,e),t.prototype.attach=function(t){var i=this;if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));if(t.attached_style=this.attached_style,t.attached_isHorizontal=this.attached_isHorizontal,t.hasOwnProperty("description")){n.FormsUtils.convertToHTMLSyntax(t.description);var r={allowFrames:!0,uriTransformer:function(e){return e}};t.description.set(a.sanitize(t.description.get(),r))}var o=this.configuration&&void 0!==this.configuration.allowHorizontal;this.auto(t.orientation,this,function(e){var r,n="Horizontal"===t.orientation.get();i.attached_style.set(r),i.attached_isHorizontal.set(n&&o)}),t.orientation.pulse(),this._attachVisibilityControls(t),e.prototype.attach.call(this,t)},t.prototype._attachVisibilityControls=function(e){var t=this;if(!e)throw new Error("A view model must be specified to attach to.");if(e.visibleControlID.get()){var i=e.formDefinition.getFormItemById(e.visibleControlID.get());i&&(e.applyVisibility(i),this.resultChangeSubscription||(this.resultChangeSubscription=dojo.subscribe("FormItemResultChangedEvent",function(r){if(r===i){var n=e.isVisible.get();if(e.applyVisibility(i),n!==e.isVisible.get()){var a=t.app.viewManager.getRegionForViewId(t.id);t.app.event("ViewDimensionsChangedEvent").publish(new o.ViewDimensionsChangedArgs(t,a));var s=e.getDisplayName(),l="language-accessibility-form-{0}-container-{1}".format(s?"named":"unnamed",n?"hidden":"shown"),c=t.app.getResource(t.libraryId,l).format(s);t.app.command("ScreenReaderNarrate").execute(c)}}})))}},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.resultChangeSubscription&&dojo.unsubscribe(this.resultChangeSubscription)},t}(i.FormItemViewBase);t.ContainerFormItemView=s})},"geocortex/infrastructure/ui/components/Forms/TimePickerFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.attached_seconds=null,r.attached_minutes=null,r.attached_hours=null,r.attached_second=null,r.attached_minute=null,r.attached_hour=null,r._lastClearedTime=null,r}return __extends(t,e),t.prototype.attach=function(t){var i=this;if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.attached_controlId=new r.Observable("timepicker-{0}".format(n.alphaNumericToken())),t.attached_time=this.attached_time=new r.Observable,t.attached_timeIsNull=new r.Observable((!1)),t.attached_timeIsNull.syncTransform(t.time,function(e){return null==e}),this._buildComboBoxes(t),e.prototype.attach.call(this,t),setTimeout(function(){i.viewModel.date?i.setPickerDateTime(i.viewModel.date.get()):i.viewModel.time&&i.setPickerDateTime(i.viewModel.time.get())},1)},t.prototype._buildComboBoxes=function(e){this.attached_seconds=new r.ObservableCollection([]),this.attached_minutes=new r.ObservableCollection([]),this.attached_hours=new r.ObservableCollection([]),this.attached_second=new r.Observable(0),this.attached_minute=new r.Observable(0),this.attached_hour=new r.Observable(0);for(var t=[],i=[],n=[],a=0;a<24;++a)t.push({val:a,desc:"{0}".format(a)});for(this.attached_hours.addItems(t),a=0;a<60;++a)i.push(a),n.push(a);this.attached_minutes.addItems(i),this.attached_seconds.addItems(n),e.attached_seconds=this.attached_seconds,e.attached_minutes=this.attached_minutes,e.attached_hours=this.attached_hours,e.attached_second=this.attached_second,e.attached_minute=this.attached_minute,e.attached_hour=this.attached_hour},t.prototype.setPickerDateTime=function(e){null!=e?(this.attached_second.set(e.getSeconds()),this.attached_minute.set(e.getMinutes()),this.attached_hour.set(e.getHours())):(this.attached_second.set(null),this.attached_minute.set(null),this.attached_hour.set(null),$(this.selectContainerElement).find("select").val([]))},t.prototype.handleChangeComboBoxTime=function(){var e;e=this.viewModel.time?this.viewModel.time.get():this.viewModel.date?this.viewModel.date.get():new Date,null!=this.attached_hour.get()||null!=this.attached_minute.get()||null!=this.attached_second.get()?(null==e&&(e=new Date,e.setMilliseconds(0)),null==this.attached_hour.get()&&this.attached_hour.set(e.getHours()),null==this.attached_minute.get()&&this.attached_minute.set(e.getMinutes()),null==this.attached_second.get()&&this.attached_second.set(e.getSeconds()),e.setHours(this.attached_hour.get()),e.setMinutes(this.attached_minute.get()),e.setSeconds(this.attached_second.get())):e=null,this.viewModel.time?this.viewModel.time.set(e):this.viewModel.date&&this.viewModel.date.set(e)},t.prototype.handleClickSetNull=function(){this.viewModel.time.get()&&(this._lastClearedTime=this.viewModel.time.get()),this.viewModel.time.set(null),this.setPickerDateTime(null)},t.prototype.handleClickSetNotNull=function(){if(null!=this._lastClearedTime)this.viewModel.time.set(this._lastClearedTime),this.setPickerDateTime(this._lastClearedTime),this._lastClearedTime=null;else{var e=new Date;this.viewModel.time.set(e),this.setPickerDateTime(e)}},t}(i.FormItemViewBase);t.TimePickerFormItemView=a})},"geocortex/infrastructure/ui/components/Forms/DatePickerFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/TimePickerFormItemView","geocortex/framework/observables","geocortex/infrastructure/DateFormat","geocortex/framework/utils/utils","geocortex/infrastructure/FormatUtils"],function(e,t,i,r,n,a,o){"use strict";var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attached_pickerType=new r.Observable,t.attached_days=null,t.attached_months=null,t.attached_years=null,t.attached_day=null,t.attached_month=null,t.attached_year=null,t.selectElementCount=11,t._jQueryPickerInitialized=!1,t._lastClearedDate=null,t._daysPerMonth={0:31,1:28,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31},t._dateTimePickerType={comboPicker:"combos",comboDateTimePicker:"combos_datetime",nativePicker:"native",nativeDateTimePicker:"native_datetime",nativeDateComboTimePicker:"native_date_combo_time",jQueryPicker:"jQuery",nativeDateJQueryTimePicker:"native_date_jQuery_time"},t._dateFormat=n.DateFormat.DATE_TIME_SHORT,t}return __extends(t,e),t.prototype.attach=function(t){var i=this;if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.attached_controlId=new r.Observable("datepicker-{0}".format(a.alphaNumericToken())),t.attached_isNull=new r.Observable((!1)),t.attached_isNull.syncTransform(t.date,function(e){return null==e});var n=navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Mobile Safari")>-1&&!(navigator.userAgent.indexOf("Chrome")>-1),o=navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Firefox")>-1,s=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/gi);!Modernizr||!Modernizr.inputtypes.date||navigator.userAgent.indexOf("Chrome")>-1||n||o?Modernizr.touch?t.includeTimePicker.get()===!0?this.attached_pickerType.set(this._dateTimePickerType.comboDateTimePicker):this.attached_pickerType.set(this._dateTimePickerType.comboPicker):this.attached_pickerType.set(this._dateTimePickerType.jQueryPicker):t.includeTimePicker.get()===!0?Modernizr.inputtypes.datetime&&!s?this.attached_pickerType.set(this._dateTimePickerType.nativeDateTimePicker):this.attached_pickerType.set(this._dateTimePickerType.nativeDateComboTimePicker):this.attached_pickerType.set(this._dateTimePickerType.nativePicker),t.attached_pickerType=this.attached_pickerType,this.viewModel=t,this.attached_days=new r.ObservableCollection([]),this.attached_months=new r.ObservableCollection([]),this.attached_years=new r.ObservableCollection([]),this.attached_day=new r.Observable(1),this.attached_month=new r.Observable(1),this.attached_year=new r.Observable(2e3),t.attached_days=this.attached_days,t.attached_months=this.attached_months,t.attached_years=this.attached_years,t.attached_day=this.attached_day,t.attached_month=this.attached_month,t.attached_year=this.attached_year,this._buildComboBoxes(t),setTimeout(function(){i.viewModel.date?i.setPickerDateTime(i.viewModel.date.get()):i.viewModel.time&&i.setPickerDateTime(i.viewModel.time.get())},1),t._dateTimePickerBindingToken&&t.date.unbind(t._dateTimePickerBindingToken),t._dateTimePickerBindingToken=t.date.bind(this,function(e){if(i.attached_pickerType.get()===i._dateTimePickerType.jQueryPicker){var t=$(i.jQueryPicker,i.root).datepicker("getDate");if(null===e||void 0===e)return void i.app.trace.warning("Date parameter is null.");if(t&&e.getTime()===t.getTime())return}i.setPickerDateTime(e)}),this._syncComboBoxes(),e.prototype.attach.call(this,t)},t.prototype._syncComboBoxes=function(){for(var e=[this.attached_day,this.attached_month,this.attached_year],t=0;t<e.length;++t)e[t].bind(this,dojo.hitch(this,this._calcTime))},t.prototype._isLeapYear=function(e){return e%400===0||e%100!==0&&e%4===0},t.prototype._calcTime=function(){var e=this.attached_month.get();if(null!=e){var t=this._daysPerMonth[e];if(1===e&&(t=29),this.attached_days.getLength()<t)for(var i=this.attached_days.getLength();i<t;++i)this.attached_days.addItem(i+1);else this.attached_days.removeRange(t)}},t.prototype.setPickerDateTime=function(t){if(e.prototype.setPickerDateTime.call(this,t),t)this.attached_day.set(t.getDate()),this.attached_month.set(t.getMonth()),this.attached_year.set(t.getFullYear());else{this.attached_day.set(null),this.attached_month.set(null),this.attached_year.set(null);for(var i=0;i<=this.selectElementCount;i++)this["select"+i]&&(this["select"+i].selectedIndex=-1)}this.native_datetime_element&&(this.native_datetime_element.valueAsDate=t),this.native_date_element&&(this.native_datetime_element.valueAsDate=t),this.attached_pickerType.get()!==this._dateTimePickerType.jQueryPicker&&this.attached_pickerType.get()!==this._dateTimePickerType.nativeDateJQueryTimePicker||(this._jQueryPickerInitialized&&$(this.jQueryPicker,this.root).datetimepicker("setDate",t),this._updatejQueryFormattedInput(t))},t.prototype.handleChangeComboBoxTime=function(){var e=this.viewModel.date.get();null!=this.attached_year.get()||null!=this.attached_month.get()||null!=this.attached_day.get()||this.viewModel.includeTimePicker.get()&&(null!=this.attached_hour.get()||null!=this.attached_minute.get()||null!=this.attached_second.get())?(e||(e=new Date,this.viewModel.includeTimePicker.get()||(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0))),null==this.attached_year.get()&&this.attached_year.set(e.getFullYear()),null==this.attached_month.get()&&this.attached_month.set(e.getMonth()),null==this.attached_day.get()&&this.attached_day.set(e.getDate()),e.setFullYear(this.attached_year.get()),e.setMonth(this.attached_month.get()),e.setDate(this.attached_day.get()),this.viewModel.includeTimePicker.get()&&(null==this.attached_hour.get()&&this.attached_hour.set(e.getHours()),null==this.attached_minute.get()&&this.attached_minute.set(e.getMinutes()),null==this.attached_second.get()&&this.attached_second.set(e.getSeconds()),e.setHours(this.attached_hour.get()),e.setMinutes(this.attached_minute.get()),e.setSeconds(this.attached_second.get()))):e=null,this.viewModel.date.set(e)},t.prototype.handleChangeComboBoxTimeWithNativeDate=function(){var e=this.viewModel.date.get();e||(e=new Date),null==this.attached_hour.get()&&this.attached_hour.set(e.getHours()),null==this.attached_minute.get()&&this.attached_minute.set(e.getMinutes()),null==this.attached_second.get()&&this.attached_second.set(e.getSeconds()),e.setHours(this.attached_hour.get()),e.setMinutes(this.attached_minute.get()),e.setSeconds(this.attached_second.get()),this.viewModel.date.set(e)},t.prototype._createjQueryPicker=function(){var e=this;t.localizedJqueryDatepicker||this._localizeJqueryDatepicker(),$(this.jQueryPicker,this.root).blur();var i={dateFormat:"yy-mm-dd",showOn:"button",changeYear:!0,yearRange:"c-50:c+50",onClose:function(t,i){e.disabled=!0,e.readOnly=!0},onChangeMonthYear:function(t,i,r){var n=r.selectedDay,a=null;if(e.viewModel.date.get())a=new Date(t,i-1,n,e.viewModel.date.get().getHours(),e.viewModel.date.get().getMinutes(),e.viewModel.date.get().getSeconds());else{var o=new Date;a=new Date(t,i-1,n,o.getHours(),o.getMinutes(),o.getSeconds())}e.viewModel.date.set(a)},beforeShow:function(t,i){e.disabled=!0,e.readOnly=!0,$(i.input).siblings(".ui-datepicker-trigger").attr("aria-label",e.getResource("language-accessibility-datepicker-trigger-button-aria-label"));var r=$(window).width(),n=r-$(i.input).siblings(".ui-datepicker-trigger").offset().left,a=parseFloat($(i.dpDiv).css("width")),o=0;o=!isNaN(n)&&!isNaN(a)&&a>n?$(e.jQueryFormattedInput,e.root).offset().left-(r-a):$(e.jQueryFormattedInput,e.root).offset().left-$(i.input).siblings(".ui-datepicker-trigger").offset().left,$(i.dpDiv).css("marginLeft",o)}};if(this.attached_pickerType.get()===this._dateTimePickerType.jQueryPicker?(i.onSelect=function(t,i){var r=$(e.jQueryPicker,e.root).datepicker("getDate");e.viewModel.date.set(r),e._updatejQueryFormattedInput(r)},this.viewModel.includeTimePicker.get()?("Long"===this.viewModel.dateFormat.get()?this._dateFormat=n.DateFormat.DATE_TIME_LONG:"Short"===this.viewModel.dateFormat.get()?this._dateFormat=n.DateFormat.DATE_TIME_SHORT:this.viewModel.dateFormat.get()?this._dateFormat=this.viewModel.dateFormat.get():this._dateFormat=n.DateFormat.DATE_TIME_SHORT,i.timeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?"HH:mm":"HH:mm:ss",i.gcxTimeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?n.DateFormat.TIME_SHORT:n.DateFormat.TIME_LONG,i.showSecond="LongTime"===this.viewModel.timePickerItem.timeFormat.get(),i.gcxTimeStyle=this.viewModel.timePickerItem.jQueryPickerTimeAsInfoMsg.get(),$(this.jQueryPicker,this.root).datetimepicker(i)):("Long"===this.viewModel.dateFormat.get()?this._dateFormat=n.DateFormat.DATE_LONG:"Short"===this.viewModel.dateFormat.get()?this._dateFormat=n.DateFormat.DATE_SHORT:this.viewModel.dateFormat.get()?this._dateFormat=this.viewModel.dateFormat.get():this._dateFormat=n.DateFormat.DATE_SHORT,i.hourMin=0,i.hourMax=0,i.minuteMin=0,i.minuteMax=0,i.showHour=!1,i.showMinute=!1,i.showTime=!1,i.timeFormat="",$(this.jQueryPicker,this.root).datetimepicker(i)),$(this.jQueryPicker,this.root).datetimepicker("setDate",this.viewModel.date.get()),this._jQueryPickerInitialized=!0):this.attached_pickerType.get()===this._dateTimePickerType.nativeDateJQueryTimePicker&&(this._dateFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?n.DateFormat.TIME_SHORT:n.DateFormat.TIME_LONG,i.timeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?"HH:mm":"HH:mm:ss",
i.gcxTimeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?n.DateFormat.TIME_SHORT:n.DateFormat.TIME_LONG,i.showSecond="LongTime"===this.viewModel.timePickerItem.timeFormat.get(),i.onSelect=function(t,i){var r=$(e.jQueryPicker,e.root).datepicker("getDate"),n=e.viewModel.date.get();n.setHours(r.getHours()),n.setMinutes(r.getMinutes()),n.setSeconds(r.getSeconds()),e.viewModel.date.set(n),e.setPickerDateTime(n)},$(this.jQueryPicker,this.root).timepicker(i),$(this.jQueryPicker,this.root).timepicker("setDate",this.viewModel.date.get()),this._jQueryPickerInitialized=!0),this._updatejQueryFormattedInput(this.viewModel.date.get()),$.datepicker._doKeyDown){var r=$(this.jQueryFormattedInput,this.root);r.data("datepicker",$(this.jQueryPicker,this.root).data("datepicker")),r.keydown($.datepicker._doKeyDown),r.keypress($.datepicker._doKeyPress),r.keyup($.datepicker._doKeyUp)}},t.prototype._updatejQueryFormattedInput=function(e){if(e){var t=o.formatDate(e,this._dateFormat);$(this.jQueryFormattedInput,this.root).val(t)}else $(this.jQueryFormattedInput,this.root).val("")},t.prototype._localizeJqueryDatepicker=function(){var e=this.getResource("datepicker.regional"),i=this.getResource("timepicker.regional");e&&$.datepicker.setDefaults(e),i&&$.timepicker.setDefaults(i),t.localizedJqueryDatepicker=!0},t.prototype._buildComboBoxes=function(t){e.prototype._buildComboBoxes.call(this,t);for(var i=1900,r=2100,n=[],a=i;a<=r;++a)n.push(a);this.attached_years.set(n);for(var o=[],s=0;s<12;++s){var l="language-months-{0}".format(s);o.push({value:s,name:this.app.getResource(this.libraryId,l)})}this.attached_months.set(o);for(var c=[],u=1;u<32;++u)c.push(u);this.attached_days.set(c)},t.prototype.handleClickSetNull=function(){this.viewModel.date.get()&&(this._lastClearedDate=this.viewModel.date.get()),this.viewModel.date.set(null),this.setPickerDateTime(null)},t.prototype.handleClickSetNotNull=function(){if(null!=this._lastClearedDate)this.viewModel.date.set(this._lastClearedDate),this.setPickerDateTime(this._lastClearedDate),this._lastClearedDate=null;else{var e=new Date;this.viewModel.date.set(e),this.setPickerDateTime(e)}},t.prototype.handleJqueryDatePickerTextChanged=function(e,t,i){var r="";if(r=e.currentTarget?e.currentTarget.value:e.target.value){var a,s=[this._dateFormat];this.viewModel.includeTimePicker.get()?s.concat([n.DateFormat.DATE_TIME_LONG,n.DateFormat.DATE_TIME_SHORT]):s.concat([n.DateFormat.DATE_LONG,n.DateFormat.DATE_SHORT]),a=o.parseDate(r,s),isNaN(a.getTime())&&(a=new Date),this.viewModel.date.get()&&a.getTime()==this.viewModel.date.get().getTime()||(this.viewModel.date.set(a),this.setPickerDateTime(a),this.handleChangeComboBoxTime())}},t.prototype.handleJqueryTimePickerTextChanged=function(e,t,i){var r="";if(r=e.currentTarget?e.currentTarget.value:e.target.value){var a=o.parseDate(r,[n.DateFormat.TIME_LONG,n.DateFormat.TIME_SHORT]);isNaN(a.getTime())&&(a=new Date);var s=this.viewModel.date.get();s||(s=new Date),s.setHours(a.getHours()),s.setMinutes(a.getMinutes()),s.setSeconds(a.getSeconds()),this.viewModel.date.set(s),this.setPickerDateTime(s)}},t.prototype.handleJqueryDatePickerInitializeClick=function(e,t,i){$(t).remove(),this._jQueryPickerInitialized||this._createjQueryPicker(),this.attached_pickerType.get()===this._dateTimePickerType.jQueryPicker?$(this.jQueryPicker,this.root).datetimepicker("show"):this.attached_pickerType.get()===this._dateTimePickerType.nativeDateJQueryTimePicker&&$(this.jQueryPicker,this.root).timepicker("show")},t}(i.TimePickerFormItemView);s.localizedJqueryDatepicker=!1,t.DatePickerFormItemView=s})},"geocortex/infrastructure/ui/components/Forms/FilePickerFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/forms/FileItem"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.attached_controlId=new r.Observable("filepicker-{0}".format(n.alphaNumericToken())),e.prototype.attach.call(this,t)},t.prototype.handleChange=function(e,t,i){var r=this;this.viewModel.files.clear();for(var n=function(e){var t=e.name,i=e.size,n=e.type,o=new FileReader;o.onload=function(e){var o=new a.FileItem;o.fileName=t,o.fileSize=i,o.fileType=n,o.fileDataBase64=decodeURIComponent(e.target.result.substring(e.target.result.indexOf("base64,")+7)),r.viewModel.files.addItem(o)},o.readAsDataURL(e)},o=0;o<e.currentTarget.files.length;o++)n(e.currentTarget.files[o])},t.prototype.handleClearClick=function(e,t,i){this.viewModel.clear()},t}(i.FormItemViewBase);t.FilePickerFormItemView=o})},"geocortex/infrastructure/ui/components/Forms/GroupBoxFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/ContainerFormItemView"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.prototype.attach.call(this,t)},t}(i.ContainerFormItemView);t.GroupBoxFormItemView=r})},"geocortex/infrastructure/ui/components/Forms/HyperlinkFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.prototype.attach.call(this,t)},t.prototype.handleClick=function(e,t,i){return this.viewModel.wasClicked.set(!0),this.app.followNavigationLink({url:i.uri,element:t})},t}(i.FormItemViewBase);t.HyperlinkFormItemView=r})},"geocortex/infrastructure/ui/components/Forms/ListBoxFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/infrastructure/ui/components/Forms/FormsUtils"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.selectionChangedTimer=null,r.selectedBindingToken=null,r.selectionBindingToken=null,r}return __extends(t,e),t.prototype.attach=function(t){var i=this;if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));if(t.attached_controlId=new r.Observable("formitem-{0}".format(n.alphaNumericToken())),t.selectionMode){var o=t.selectionMode.get().toLowerCase();t.attached_isMultiple=new r.Observable("multiple"===o.toLowerCase()||"extended"==o.toLowerCase())}t.selected&&!this.selectedBindingToken?this.selectedBindingToken=t.selected.bind(this,function(){t.selected.get()>=0&&this.handleSelectionChanged()}):t.selection&&!this.selectionBindingToken&&(this.selectionBindingToken=t.selection.bind(this,function(){t.selection.length()>0&&this.handleSelectionChanged()})),t.queryTaskRunner&&(t.queryTaskRunner.formatCallback=a.FormsUtils.formatListItem),e.prototype.attach.call(this,t),$(this.selectElement).dblclick(function(){i.app.command("SubmitWorkflowForm").execute(i.viewModel.formDefinition)})},t.prototype.handleSelectionChanged=function(e,t,i){var r=this;return null!=this.selectionChangedTimer&&(clearInterval(this.selectionChangedTimer),this.selectionChangedTimer=null),this.selectionChangedTimer=setTimeout(function(){r.viewModel.queryTaskRunner.isBusy.get()===!1&&(r.viewModel.triggerCascading(null),r.selectionChangedTimer=null)},450),!0},t}(i.FormItemViewBase);t.ListBoxFormItemView=o})},"geocortex/infrastructure/ui/components/Forms/MarkdownFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/infrastructure/FilterUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.markdownElement=null,r}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.prototype.attach.call(this,t);var i=new Remarkable({breaks:!0}),n=i.render(t.plainText.get()),a=r.sanitize(n,{uriTransformer:function(e){return e}});this.markdownElement.innerHTML=a},t}(i.FormItemViewBase);t.MarkdownFormItemView=n})},"geocortex/infrastructure/ui/components/Forms/RadioButtonFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){var i=this;if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));return t.attached_textOnLeft=new r.Observable((!1)),this.addDisposableBinding(t.textLocation,t.textLocation.bind(this,function(e){t.attached_textOnLeft.set("left"===e.toLowerCase())})),t.textLocation.pulse(),t.attached_controlId=new r.Observable("radio-{0}".format(n.alphaNumericToken())),t.attached_labelText=null!=t.text?new r.Observable(t.text.get()):"",e.prototype.attach.call(this,t),this.radioElement&&(this.radioElement.checked=t.checked.get(),$(this.radioElement).change(function(){t.checked.set(this.checked)})),this.viewModel.__getRadioValueClosure=function(){var e=i.radioElement;return!!e&&e.checked},!0},t}(i.FormItemViewBase);t.RadioButtonFormItemView=a})},"geocortex/infrastructure/ui/components/Forms/TextEntryFormItemView":function(){define(["require","exports","geocortex/infrastructure/ui/components/Forms/FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){if(!t)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.attached_controlId=new r.Observable("formitem-{0}".format(n.alphaNumericToken())),null!=t.inputScope&&("Password"===t.inputScope.get()?t.attached_type=new r.Observable("password"):t.attached_type=new r.Observable("text")),e.prototype.attach.call(this,t)},t.prototype.handleBlurControl=function(){this.app.event("WorkflowFormTextInputBlurredEvent").publish(this)},t}(i.FormItemViewBase);t.TextEntryFormItemView=a})},"geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel":function(){define(["require","exports","geocortex/framework-ui/ViewContainer/ViewContainerViewModel","geocortex/infrastructure/menus/MenuViewModel","geocortex/framework/observables"],function(e,t,i,r,n){"use strict";var a=function(e){function t(i,a){var o=e.call(this,i,a)||this;return o.hoistedMenuViewModel=new n.Observable(t.emptyMenuViewModel),o.hasHoistedMenu=new n.Observable((!1)),o.hasExecutableMenuItems=new n.Observable((!1)),o.inlineMenuIsOpen=new n.Observable((!1)),o.panelMaximized=new n.Observable((!1)),o.showingMaximizeButton=new n.Observable((!1)),o.resizeX=!1,o.resizeY=!1,t.emptyMenuViewModel||(t.emptyMenuViewModel=new r.MenuViewModel(i,a)),o}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.statusRegion=t.statusRegionName,this.statusRegionType=t.statusRegionType||"geocortex.framework.ui.DivRegionAdapter",t.resizeX&&(this.resizeX=t.resizeX),t.resizeY&&(this.resizeY=t.resizeY),this.menuRegion=t.menuRegion||null,void 0!=t.showMaximizeButton&&this.showingMaximizeButton.set(t.showMaximizeButton)},t}(i.ViewContainerViewModel);t.SmartPanelViewModel=a})},"geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView":function(){define(["require","exports","geocortex/framework-ui/ViewContainer/ViewContainerView","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel","geocortex/infrastructure/menus/MenuViewModel"],function(e,t,i,r,n){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resizeY=!1,t.resizeX=!1,t._menuViews={},t._menuItemInvokedSubscriptionToken=null,t}return __extends(t,e),t.prototype.attach=function(t){var i=this;if(e.prototype.attach.call(this,t),this.configuration.resizableParentRegion)if(this.app.site&&this.app.site.isInitialized){var r=this.app.viewManager.getExistingRegionByName(this.configuration.resizableParentRegion);this.resizableRegion=r.domElement}else this.app.event("SiteInitializedEvent").once(this,function(){var e=i.app.viewManager.getExistingRegionByName(i.configuration.resizableParentRegion);i.resizableRegion=e.domElement});else if(this.app.site&&this.app.site.isInitialized){var r=this.app.viewManager.getExistingRegionByName(this.regionName);this.resizableRegion=r.domElement}else this.app.event("SiteInitializedEvent").once(this,function(){var e=i.app.viewManager.getExistingRegionByName(i.regionName);i.resizableRegion=e.domElement});this.viewModel.resizeX?this.resizeX=this.viewModel.resizeX:this.configuration.resizeX&&(this.resizeX=this.configuration.resizeX),this.viewModel.resizeY?this.resizeY=this.viewModel.resizeY:this.configuration.resizeY&&(this.resizeY=this.configuration.resizeY),$(this.app.getHostElement()).on("onclick.handle-resize-error",function(e){$(i.app.getHostElement()).off("mousemove.header-resize touchmove.header-resize"),null!=i.resizePreviewElement.parentNode&&i.resizableRegion.parentNode.removeChild(i.resizePreviewElement)}),this.viewModel.panelMaximized.bind(this,function(e){e?$(i.resizableRegion).attr("data-maximized","true"):$(i.resizableRegion).attr("data-maximized","false")}),this.viewModel.statusRegion?($(this.statusRegionElement).attr("data-region-name",this.viewModel.statusRegion),$(this.statusRegionElement).attr("data-region-adapter",this.viewModel.statusRegionType)):this.statusRegionElement&&this.statusRegionElement.parentNode&&(this.statusRegionElement.parentNode.removeChild(this.statusRegionElement),this.statusRegionElement=null),this._initializeEvents(),this.app.command("MaximizePanel").register(this,function(e){return i._togglePanelMaximized(e,"maximize")},this._canExecuteMaximizeRestoreOperations),this.app.command("RestorePanel").register(this,function(e){return i._togglePanelMaximized(e,"restore")},this._canExecuteMaximizeRestoreOperations)},t.prototype._initializeEvents=function(){var e=this,t=this.app.event("PanelRegionRestoredEvent").subscribe(this,function(t){t===e.resizableRegion&&e.viewModel.panelMaximized.set(!1)}),i=this.app.event("PanelRegionMaximizedEvent").subscribe(this,function(t){t===e.resizableRegion&&e.viewModel.panelMaximized.set(!0)});if(this.trackSubscription(this.app.event("PanelRegionRestoredEvent"),t),this.trackSubscription(this.app.event("PanelRegionMaximizedEvent"),i),this.viewModel.statusRegion){var r=this.app.event("RegionActivatedEvent").subscribe(this,this._handleRegionActivatedOrDeactivated),n=this.app.event("RegionDeactivatedEvent").subscribe(this,this._handleRegionActivatedOrDeactivated);this.trackSubscription(this.app.event("RegionActivatedEvent"),r),this.trackSubscription(this.app.event("RegionDeactivatedEvent"),n)}},t.prototype._handleRegionActivatedOrDeactivated=function(e){var t=this.viewModel?this.viewModel.statusRegion:null;e&&e.name===t&&this.delayedResize()},t.prototype._togglePanelMaximized=function(e,t){e===this.id&&"maximize"===t&&this.maximizePanel(),e===this.id&&"restore"===t&&this.minimizePanel()},t.prototype._canExecuteMaximizeRestoreOperations=function(){return!!this.viewModel.showingMaximizeButton.get()},t.prototype._handleViewActivatedInContainerEvent=function(i){if(e.prototype._handleViewActivatedInContainerEvent.call(this,i),this.viewModel&&this.viewModel.getDescriptorForActiveView(i))if(i instanceof t==!0){i.setParentPanel(this);var r=i.viewModel.currentView;r&&r.viewModel&&r.isActive&&this.hoistMenuForView(r)}else{for(var n,a=this._parentPanel;a;)a.viewModel.headerIsVisible.get()&&(n=a),a=a._parentPanel;if(n)return void n.hoistMenuForView(i);this.hoistMenuForView(i)}},t.prototype.activated=function(){e.prototype.activated.call(this)},t.prototype.deactivated=function(){e.prototype.deactivated.call(this)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._unsubscribeMenuItemInvokedSubscription();for(var t in this._menuViews)this._menuViews.hasOwnProperty(t)&&this.app.viewManager.destroyView(this._menuViews[t]);this._menuViews=null,this._parentPanel=null},t.prototype.openHoistedMenuInRegion=function(e){this._destroyHoistedMenuOwnerViewIfExists(),this.hoistedMenuOwnerView=this.createMenuView(this.viewModel.hoistedMenuViewModel.get()),this.hoistedMenuOwnerView.regionName=e,this.app.viewManager.activateView(this.hoistedMenuOwnerView)},t.prototype.resolveWidget=function(e,t,i){if("SmartPanelHoistedMenu"===e){if(!this.hoistedMenuId)return;return this._destroyHoistedMenuOwnerViewIfExists(),this.hoistedMenuOwnerView=this.createMenuView(t),this.viewModel.menuRegion?null:this.hoistedMenuOwnerView}return null},t.prototype.createMenuView=function(e){var t=this,i=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/menus/MenuView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.menus.MenuView",libraryId:"Mapping.Infrastructure"});i.libraryId=this.libraryId,i.configuration.menuId=this.hoistedMenuId,e&&(i.attach(e),this.auto(e.hasExecutableMenuItems,this,function(e){e||t.viewModel.menuRegion||t.viewModel.inlineMenuIsOpen.set(!1)})),this._menuViews[i.id]=i,this._unsubscribeMenuItemInvokedSubscription(),this._menuItemInvokedSubscriptionToken=this.app.event("MenuItemInvokedEvent").subscribe(this,function(e){e.menuView.id in t._menuViews&&(t.viewModel.menuRegion||t.viewModel.inlineMenuIsOpen.set(!1),t.app.viewManager.deactivateView(e.menuView))});var r=this.app.event("ViewDeactivatedEvent").subscribe(this,function(e){e===i&&(t.app.event("ViewDeactivatedEvent").unsubscribe(r),e.viewModel=null,t.app.viewManager.destroyView(e),delete t._menuViews[i.id])});return e.menuContext.pulse(),i},t.prototype.handleTapMenuButton=function(){var e=this;if(this.viewModel.menuRegion)if(this.hoistedMenuOwnerView&&this.hoistedMenuOwnerView.regionName===this.viewModel.menuRegion&&this.hoistedMenuOwnerView.isActive){var t=this.hoistedMenuOwnerView.viewModel&&this.hoistedMenuOwnerView.viewModel.menuSourceView;this._destroyHoistedMenuOwnerViewIfExists(),t&&this.app.viewManager.activateView(t)}else this.openHoistedMenuInRegion(this.viewModel.menuRegion);else if(this.viewModel.inlineMenuIsOpen.set(!this.viewModel.inlineMenuIsOpen.get()),this.viewModel.inlineMenuIsOpen.get()){this.app.event("FlyoutActivated").publish(this);var i={view:this.hoistedMenuOwnerView,onOtherInteracted:function(t){$(t.srcElement||t.target).hasClass("menu-button")||(e.viewModel.inlineMenuIsOpen.set(!1),e.app.event("FlyoutDeactivated").publish(e))}};this.app.command("TapToDismiss").execute(i)}},t.prototype.hoistMenuForView=function(e){var i=this;if(e!==this.hoistedMenuOwnerView){var a=this.app.menuRegistry.getMenuWidgetsForView(e);if(a&&(a=a.filter(function(e){return e.hoistMenu})),!a||!a.length)return this.viewModel.inlineMenuIsOpen.get()&&this.viewModel.inlineMenuIsOpen.set(!1),this.viewModel.hasHoistedMenu.set(!1),this.viewModel.hoistedMenuViewModel.set(r.SmartPanelViewModel.emptyMenuViewModel),this.viewModel.hasExecutableMenuItems.removeSync(),void this.viewModel.hasExecutableMenuItems.set(!1);var o=a[0],s=new n.MenuViewModel(this.app,this.libraryId);s.menuSourceView=e,o.context&&o.context.isObservable?s.menuContext.sync(o.context):s.menuContext.sync(o.widgetViewModel.menuContext),this.hoistedMenuId=o.menuId,this.viewModel.hoistedMenuViewModel.set(s),this.viewModel.hasHoistedMenu.set(!0),this.viewModel.hasExecutableMenuItems.sync(s.hasExecutableMenuItems);var l=$(o.domElement);l.addClass(t.HoistedClassName);var c=this.app.event("ViewUnhostedEvent").subscribe(this,function(t){t.view===e&&(i.app.event("ViewUnhostedEvent").unsubscribe(c),l.removeClass("hidden-hoisted-menu"))})}},t.prototype.setParentPanel=function(e){this._parentPanel=e},t.prototype.handleMaximizeToggleClick=function(e,t,i){this.viewModel.panelMaximized.get()?this.minimizePanel():this.maximizePanel()},t.prototype.maximizePanel=function(){this.viewModel.panelMaximized.set(!0),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish(),this.app.event("PanelRegionMaximizedEvent").publish(this.resizableRegion)},t.prototype.minimizePanel=function(){this.viewModel.panelMaximized.set(!1),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish(),this.app.event("PanelRegionRestoredEvent").publish(this.resizableRegion)},t.prototype._unsubscribeMenuItemInvokedSubscription=function(){this._menuItemInvokedSubscriptionToken&&(this.app.event("MenuItemInvokedEvent").unsubscribe(this._menuItemInvokedSubscriptionToken),this._menuItemInvokedSubscriptionToken=null)},t.prototype.handleHeaderMouseDown=function(e,t,i){var r=this;if(this.viewModel.panelMaximized.get())return!0;if(e.target!==e.currentTarget)return!0;$(this.app.getHostElement()).off("mouseup.header-click touchend.header-click");var n=250,a=!0;return $(this.app.getHostElement()).one("mouseup.header-click touchend.header-click",function(){a=!1}),setTimeout(function(){a&&r.resizableRegion&&($(r.app.getHostElement()).off("mouseup.header-click touchend.header-click"),r.resizeSmartPanel(e.pageX,e.pageY),e.preventDefault())},n),e.preventDefault(),e.stopImmediatePropagation(),!0},t.prototype.handleHeaderTouchStart=function(e,t,i){var r=this;if(this.viewModel.panelMaximized.get())return!0;for(var n=e.target||e.srcElement;n!=this.root;){if($(n).is("button")&&!$(n).hasClass("resize-handle"))return!0;n=n.parentElement}$(this.app.getHostElement()).off("touchend.header-click");var a=250,o=!0;return $(this.app.getHostElement()).one("touchend.header-click",function(){o=!1}),setTimeout(function(){o&&r.resizableRegion&&(e.preventDefault(),$(r.app.getHostElement()).off("touchend.header-click"),r.resizeSmartPanel(e.targetTouches[0].pageX,e.targetTouches[0].pageY))},a),e.preventDefault(),!0},t.prototype.resize=function(){if(this.headerElement&&this.scrollRegionElement&&this.containerElement){var e=$(this.statusRegionElement),t=$(this.headerElement),i=$(this.footerElement),r=$(this.scrollRegionElement),n=e.length&&"none"!==e.css("display")?e.outerHeight():0,a=t.length&&"none"!==t.css("display")?t.outerHeight():0,o=i.length&&"none"!==i.css("display")?i.outerHeight():0;a+=n,"relative"!==r.css("position")&&r.css("top",a+"px"),r.css("bottom",o+"px")}},t.prototype.resizeSmartPanel=function(e,t){var i=this;if(!this.resizeX&&!this.resizeY)return void this.app.trace.debug("This panel is not configured to be resizable!");var r={};r.initialX=e,r.initialY=t,this.app.event("PanelResizeStartEvent").publish({viewId:this.id,resizeInformation:r}),null!==this.resizePreviewElement&&void 0!==this.resizePreviewElement||(this.resizePreviewElement=document.createElement("div"),this.resizePreviewElement.className="resize-hint"),null===this.resizePreviewElement.parentElement&&(this.app.getHostElement().appendChild(this.resizePreviewElement),$(this.resizePreviewElement).css("left",this.root.getBoundingClientRect().left)),r.initialPanelHeight=$(this.resizableRegion).height(),r.initialPanelWidth=$(this.resizableRegion).width(),(0===r.initialPanelHeight||r.initialPanelHeight>$(this.resizableRegion.parentElement).height())&&(r.initialPanelHeight=$(this.resizableRegion.parentElement).height()),(0===r.initialPanelWidth||r.initialPanelWidth>$(this.resizableRegion.parentElement).width())&&(r.initialPanelWidth=$(this.resizableRegion.parentElement).width()),this.resizeX?($(this.resizePreviewElement).width(r.initialPanelWidth),$(this.resizePreviewElement).height(r.initialPanelHeight),r.minWidth=parseInt($(this.resizableRegion).css("min-width")),r.maxWidth=parseInt($(this.resizableRegion).css("max-width"))):this.resizeY&&($(this.resizePreviewElement).width(r.initialPanelWidth),$(this.resizePreviewElement).height(r.initialPanelHeight),r.minHeight=parseInt($(this.resizableRegion).css("min-height")),r.maxHeight=parseInt($(this.resizableRegion).css("max-height"))),this._resizeAccordingToSizeConstraints(r,this.resizePreviewElement),$(this.app.getHostElement()).one("mouseup.header-resize touchend.header-resize",function(e){return i._handleResizeEnd(e,r)}),$(this.app.getHostElement()).on("mousemove.header-resize ",function(e){return i.app.event("PanelResizingEvent").publish({viewId:i.id,resizeInformation:r}),r.currentX=e.pageX,r.currentY=e.pageY,i._resizeAccordingToSizeConstraints(r,i.resizePreviewElement),e.preventDefault(),!1}),$(this.app.getHostElement()).on("touchmove.header-resize",function(e){i.app.event("PanelResizingEvent").publish({viewId:i.id,resizeInformation:r});var t=e.originalEvent;return r.currentX=t.targetTouches[0].pageX,r.currentY=t.targetTouches[0].pageY,i._resizeAccordingToSizeConstraints(r,i.resizePreviewElement),e.preventDefault(),!1})},t.prototype._handleResizeEnd=function(e,t){$(this.app.getHostElement()).off("mousemove.header-resize touchmove.header-resize"),this.resizePreviewElement.parentNode&&this.resizePreviewElement.parentNode.removeChild(this.resizePreviewElement),this._resizeAccordingToSizeConstraints(t,this.resizableRegion),this.app.event("PanelResizeEndEvent").publish({viewId:this.id,resizeInformation:t}),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish()},t.prototype._resizeAccordingToSizeConstraints=function(e,t){if(this.resizeX){var i=e.initialPanelWidth+(e.currentX-e.initialX);i<e.minWidth?$(t).width(e.minWidth):i>e.maxWidth?$(t).width(e.maxWidth):$(t).width(i)}if(this.resizeY){var r=e.initialPanelHeight+(e.initialY-e.currentY);r<e.minHeight?$(t).height(e.minHeight):r>e.maxHeight?$(t).height(e.maxHeight):$(t).height(r)}},t.prototype._destroyHoistedMenuOwnerViewIfExists=function(){if(this.hoistedMenuOwnerView){var e=this.hoistedMenuOwnerView;this.hoistedMenuOwnerView=null,e.viewModel=null,this.app.viewManager.destroyView(e),delete this._menuViews[e.id]}},t}(i.ViewContainerView);a.HoistedClassName="hidden-hoisted-menu",t.SmartPanelView=a})},"geocortex/infrastructure/ui/components/MultiPane/PaneViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/MultiPane/PaneViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentPaneItem=new r.Observable(null),t.headerIsVisible=new r.Observable((!0)),t.showXButton=new r.Observable((!0)),t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(t.hasOwnProperty("headerIsVisible")&&this.headerIsVisible.set(!!t.headerIsVisible),t.hasOwnProperty("showXButton")&&this.showXButton.set(!!t.showXButton))},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.currentPaneItem.set(null),this.currentPaneItem=null,this.app=null},t}(i.ViewModelBase);t.PaneViewModel=n})},"geocortex/infrastructure/ui/components/MultiPane/PaneView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isDestroyed=!1,t}return __extends(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this._isDestroyed=!0},t.prototype.onClose=function(e){},t.prototype.handleClickClose=function(e,t,i){this.viewModel&&this.onClose&&this.onClose(this.viewModel.currentPaneItem.get()),this._isDestroyed||this.app.command("DestroyView").execute(this.id)},t}(i.ViewBase);t.PaneView=r})},"geocortex/infrastructure/ui/components/MultiPane/MultiPaneViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/MultiPane/MultiPaneViewModel":function(){define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel","geocortex/framework/observables","geocortex/framework/utils/ArrayUtils"],function(e,t,i,r,n){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.paneItems=new r.ObservableCollection,t.defaultPaneItems=new r.ObservableCollection,t.displayedPaneItems=new r.ObservableCollection,t.expanded=new r.Observable((!1)),t.headerIsVisible=new r.Observable((!0)),t.showXButton=new r.Observable((!0)),t.selectorIconUri=new r.Observable(""),t.selectorText=new r.Observable(""),t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(t.hasOwnProperty("headerIsVisible")&&this.headerIsVisible.set(!!t.headerIsVisible),t.hasOwnProperty("showXButton")&&this.showXButton.set(!!t.showXButton),t.hasOwnProperty("selectorIconUri")&&this.selectorIconUri.set(t.selectorIconUri),t.hasOwnProperty("selectorText")&&this.selectorText.set(t.selectorText))},t.prototype.findPaneItemById=function(e){return n.firstOrDefault(this.paneItems.getItems(),function(t){return t.id&&t.id===e})},t.prototype.findDisplayedPaneItemById=function(e){return n.firstOrDefault(this.displayedPaneItems.getItems(),function(t){return t.id&&t.id===e})},t}(i.SmartPanelViewModel);t.MultiPaneViewModel=a})},"geocortex/infrastructure/ui/components/MultiPane/MultiPaneView":function(){define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView","geocortex/framework/utils/ArrayUtils"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._panes=[],r.app.event("ApplicationResizedEvent").subscribe(r,r.handleApplicationResizedEvent),r.app.event("ViewDeactivatedEvent").subscribe(r,r.handleViewDeactivatedEvent),r}return __extends(t,e),t.prototype.activated=function(){var t=this;e.prototype.activated.call(this),this.viewModel&&this.viewModel.expanded.set(!0),setTimeout(function(){t.handleApplicationResizedEvent()},0)},t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.viewModel&&this.viewModel.expanded.set(!1)},t.prototype.addDefaultPanes=function(){if(!(this.viewModel.displayedPaneItems.getLength()>0))for(var e=0;e<this.viewModel.defaultPaneItems.getLength();e++){var t=this.viewModel.defaultPaneItems.getAt(e);this.addPaneItem(t)}},t.prototype.addPaneItemById=function(e){var t=this.viewModel.findPaneItemById(e);this.addPaneItem(t)},t.prototype.addPaneItem=function(e){throw new Error("Not implemented")},t.prototype.canAddPaneItem=function(e){return!(!e||!this.viewModel)&&!this.viewModel.displayedPaneItems.contains(e)},t.prototype.destroyPaneItemById=function(e){var t=this.viewModel.findDisplayedPaneItemById(e);this.destroyPaneItem(t)},t.prototype.destroyPaneItem=function(e){if(e&&this.canDestroyPaneItem(e)){var t=this.findPaneForPaneItem(e);return!!t&&(this.viewModel.displayedPaneItems.removeItem(e),this.selector.unselectItem(e),this.app.command("DestroyView").execute(t.id),0!=this.viewModel.displayedPaneItems.length()||this.viewModel.headerIsVisible.get()||this.app.command("DeactivateView").execute(this.id),!0)}return!1},t.prototype.canDestroyPaneItem=function(e){return!(!e||!this.viewModel)&&this.viewModel.displayedPaneItems.contains(e)},t.prototype.clearPaneItems=function(){for(var e=this.viewModel.displayedPaneItems.getLength();e--;){var t=this.viewModel.displayedPaneItems.getAt(e);this.destroyPaneItem(t)}},t.prototype.handleSelectPane=function(e){this.addPaneItem(e)},t.prototype.handleUnSelectPane=function(e){this.destroyPaneItem(e)},t.prototype.handleClickClose=function(){this.deactivateContainer()},t.prototype.handleApplicationResizedEvent=function(){if(this.viewModel){var e=this.viewModel.regionType.get().indexOf("Stack")>-1,t=this.scrollRegionElement,i=$(".view .pane",t);if(e&&0!==i.length){
var r=t.clientWidth,n=5,a=r/i.length-n;$(i).width(a)}}},t.prototype.handleViewDeactivatedEvent=function(e){r.firstOrDefault(this._panes,function(t){return e===t})&&(r.removeItem(this._panes,e),this.handleApplicationResizedEvent())},t.prototype.findPaneForPaneItem=function(e){for(var t=0;t<this._panes.length;t++){var i=this._panes[t];if(i.viewModel.currentPaneItem.get()===e)return i}return null},t.prototype._executeShowMultiPaneView=function(){this.app.command("ActivateView").execute(this.id),this.addDefaultPanes(),this.viewModel.displayedPaneItems.getLength()>0&&this.handleApplicationResizedEvent()},t}(i.SmartPanelView);t.MultiPaneView=n})},"geocortex/infrastructure/ui/components/NumericInput/NumericInputWidget":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){e.prototype.attach.call(this,t),this.initialize(this.configuration)},t.prototype.initialize=function(e){var t;return(t=dojo.getObject(e.provider))?(this.provider=new t(this.app,this.libraryId),this.provider.initialize(this),void(this.bindingToken=this.viewModel.range.value.bind(this,this.setValue))):void this.app.trace.error("{0} can't find numeric input provider typed {1}".format(this.id,e.provider))},t.prototype.updateValue=function(e){this.bindingToken&&this.viewModel.range.value.unbind(this.bindingToken),this.viewModel.range.value.set(e),this.bindingToken=this.viewModel.range.value.bind(this,this.setValue)},t.prototype.setValue=function(e){e=this.validate(e),this.provider.setValue(e),this.nativeInput.value=e.toString()},t.prototype.validate=function(e){return e=Number(e),isNaN(e)?this.viewModel.range.min:e>this.viewModel.range.max?this.viewModel.range.max:e<this.viewModel.range.min?this.viewModel.range.min:Math.ceil(e/this.viewModel.range.step)*this.viewModel.range.step},t.prototype.validateInput=function(){this.viewModel.range.value.set(this.validate(this.viewModel.range.value.get()))},t}(i.ViewBase);t.NumericInputWidget=r})},"geocortex/infrastructure/ui/components/NumericInput/SliderProviderBase":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.value=0,this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){throw new Error("Not implemented")},e.prototype.setValue=function(e){throw new Error("Not implemented")},e}();t.SliderProviderBase=i})},"geocortex/infrastructure/ui/components/NumericInput/KendoSliderProvider":function(){define(["require","exports","geocortex/infrastructure/ui/components/NumericInput/SliderProviderBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.initialize=function(e){this.widget=e},t.prototype.instantiate=function(){this.widget.viewModel.updateOnDrag?this.slider=$(this.widget.numericInput).kendoSlider({showButtons:!1,tickPlacement:"none",slide:this.updateValue.bind(this),change:this.updateValue.bind(this)}).data("kendoSlider"):this.slider=$(this.widget.numericInput).kendoSlider({showButtons:!1,tickPlacement:"none",change:this.updateValue.bind(this)}).data("kendoSlider"),this.slider&&this.slider.value(this.value)},t.prototype.setValue=function(e){this.value=e,this.slider?(this.slider.resize(),this.slider.value(e)):this.instantiate()},t.prototype.updateValue=function(e){this.widget.updateValue(e.value)},t}(i.SliderProviderBase);t.KendoSliderProvider=r})},"geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase"],function(e,t,i){"use strict";var r=function(e){function t(t,i){var r=e.call(this,t,"Mapping.Infrastructure")||this;return r.libraryId="Mapping.Infrastructure",r.collectionViewModel=i,r.presentableResults=r.collectionViewModel.presentableResults,r.numberOfItems=r.presentableResults.items.length(),r}return __extends(t,e),t}(i.ViewModelBase);t.PagingControlsViewModel=r})},"geocortex/infrastructure/ui/components/PagingControls/PagingControlsView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.libraryId="Mapping.Infrastructure",t}return __extends(t,e),t.prototype.attach=function(e){this.viewModel=e},t.prototype.handlePageFirst=function(e,t,i){this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(1)},t.prototype.handlePagePrev=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()>1){var r=this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()-1;this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handlePageNext=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get()>this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()){var r=this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()+1;this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handlePageLast=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()<this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get()){var r=this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get();this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(r)}},t}(i.ViewBase);t.PagingControlsView=r})},"geocortex/infrastructure/ui/components/Slider/SliderConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/Slider/SliderItem":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/Slider/SliderViewModelBase":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/TimeUnits","geocortex/infrastructure/TimeSliderUtils"],function(e,t,i,r,n,a){"use strict";var o=function(e){function t(t,i,n){var a=e.call(this,t,i)||this;return a.items=new r.ObservableCollection([]),a.sliderMinLabel=new r.Observable(""),a.sliderMaxLabel=new r.Observable(""),a.sliderMinHandleLabel=new r.Observable(""),a.sliderMaxHandleLabel=new r.Observable(""),a.sliderMinHandleCurrentItem=new r.Observable(null),a.sliderMaxHandleCurrentItem=new r.Observable(null),a.range=!1,a.disableSnappingForNumericValues=!0,a.lockMinSliderHandleAtMinVal=!1,a.animate=!1,a.isNumeric=null,a.isDateMode=null,a.numericSliderStep=null,a.numericSliderMinVal=null,a.numericSliderMaxVal=null,a.labelGenerator=null,a.itemActivePredicate=null,a.sliderHandleStartLabels=[],a.numericSliderHandleStartValues=[],a.sliderTicks=new r.ObservableCollection,a.isEnabled=new r.Observable((!1)),a.sliderMinHandleAriaLabel=null,a.sliderMaxHandleAriaLabel=null,a.sliderSingleHandleAriaLabel=null,a._underlyingCollection=null,a._underlyingCollectionBindingToken=null,a._config=null,a._defaultNumericLabelGenerator=function(e,t){return e+""},a._defaultItemActivePredicate=function(e,t){return!0},a._numericSliderItemCache={},a._maxSliderTicks=50,a._defaultSliderDivisions=5,a._snappableDatePoints=[],a.itemActivePredicate=a._defaultItemActivePredicate,n&&a.initialize(n),a}return __extends(t,e),t.prototype.initialize=function(e){this._applyConfig(e)},t.prototype.sliderHandleSlide=function(e,t){},t.prototype.setNextSliderItem=function(e){return this._setNextOrPreviousSliderItem(e,"next")},t.prototype.setPreviousSliderItem=function(e){return this._setNextOrPreviousSliderItem(e,"previous")},t.prototype.setSelectedSliderItem=function(e,t){if(0!==e&&1!==e||!t)throw new Error("SliderViewModelBase: Could not set selected slider item.");var i=0===e?this.sliderMinHandleCurrentItem.get():this.sliderMaxHandleCurrentItem.get();i&&i.value===t.value||(0===e?(this.sliderMinHandleLabel.set(t.label),this.sliderMinHandleCurrentItem.set(t)):(this.sliderMaxHandleLabel.set(t.label),this.sliderMaxHandleCurrentItem.set(t)),this.sliderHandleSlide(t,e))},t.prototype.attachToCollection=function(e,t,i,n){var a=this;if(this.cleanUp(),this.isNumeric=!1,!(e&&e instanceof r.ObservableCollection))throw new Error("SliderViewModelBase: Could not attach to collection.");t&&dojo.isFunction(t)&&(this.labelGenerator=t),n&&n.length&&(this.sliderHandleStartLabels=n.slice(0)),this.itemActivePredicate=i&&dojo.isFunction(i)?i:this._defaultItemActivePredicate,this._underlyingCollection=e,this.items.set(this._underlyingCollection.get().map(function(e,t){return a._createSliderItem(e,t)})),this._underlyingCollectionBindingToken=this._underlyingCollection.bind(this,this._handleUnderlyingCollectionChanges),this._initializeUIObservables()},t.prototype.setupNumericSlider=function(e,t,i,r,n,a){if(this.cleanUp(),this.isNumeric=!0,e=parseFloat(e),t=parseFloat(t),i=parseFloat(i),isNaN(e)||isNaN(t))throw new Error("SliderViewModelBase: Could not set numeric slider range. Minimum and/or maximum values invalid.");if(a&&a.length&&(this.numericSliderHandleStartValues=a.slice(0)),this.numericSliderMinVal=e,this.numericSliderMaxVal=t,this.labelGenerator=r&&dojo.isFunction(r)?r:this._defaultNumericLabelGenerator,this.itemActivePredicate=n&&dojo.isFunction(n)?n:this._defaultItemActivePredicate,this.numericSliderStep=i&&!isNaN(i)&&i<t-e?i:null,null===this.numericSliderStep){var o=t-e;o&&(this.numericSliderStep=o<=1?o/this._defaultSliderDivisions:Math.round(o/this._defaultSliderDivisions),this.isDateMode&&this._resetTimeIntervalBasedOnSliderStep())}this._initializeUIObservables()},t.prototype.setupDateSlider=function(e,t,i,r,n,o,s){this.isDateMode=!0,this.dateModeTimeInterval=i,this.dateModeTimeIntervalUnit=r,this.setupNumericSlider(e,t,a.computeTimeIntervalInMs(i,r),n,o,s),this.disableSnappingForNumericValues||this._generateDateModeSnappablePoints()},t.prototype.getSliderItemByRawSliderValue=function(e,t){if(void 0===t&&(t=!1),void 0===e||null===e)return null;var i=null,r=this.isNumeric?e-this.numericSliderMinVal:e;return this.isNumeric?(t&&(e=e>this.numericSliderMaxVal?this.numericSliderMaxVal:e,e=e<this.numericSliderMinVal?this.numericSliderMinVal:e),e>=this.numericSliderMinVal&&e<=this.numericSliderMaxVal&&(i=this._getUpdatedNumericItemAndUpdateCache(e,r))):r>-1&&r<this.items.length()&&(i=this.items.getAt(r),this._updateSliderItem(i,r)),i},t.prototype.getSliderItemByItemLabel=function(e){if(!e)return null;var t=null;if(this.isNumeric){if(this.labelGenerator)for(var i=this.numericSliderMinVal,r=0;i<=this.numericSliderMaxVal;i+=this.numericSliderStep,r++){var n=this.labelGenerator(i,r);if(n===e){t=this._getUpdatedNumericItemAndUpdateCache(i,r);break}}}else for(var a=0,o=this.items.length();a<o;a++){var s=this.items.getAt(a);if(this._updateSliderItem(s,a),s.label===e){t=s;break}}return t},t.prototype.getSliderItemByItemValue=function(e){var t=this;if(void 0===e||null===e||this.isNumeric&&"number"!=typeof e)return null;var i=null;if(this.isNumeric){var r=e-this.numericSliderMinVal;i=this._getUpdatedNumericItemAndUpdateCache(e,r)}else i=this.items.get().filter(function(i,r){return i.value===e&&(t._updateSliderItem(i,r),!0)})[0],i=i||null;return i},t.prototype.getNextSliderItem=function(e){return this._getAdjacentSliderItem(e,"next")},t.prototype.getNextActiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"next","active")},t.prototype.getNextInactiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"next","inactive")},t.prototype.getPreviousSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev")},t.prototype.getPreviousActiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev","active")},t.prototype.getPreviousInactiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev","inactive")},t.prototype.getClosestDateItemSnappedToInterval=function(e,t,i){void 0===t&&(t="next"),void 0===i&&(i=!1);var r=this.getRawSliderValueForItem(e);return r=this._getClosestDateItemRawValueSnappedToInterval(r,t,i),null===r?null:this.getSliderItemByRawSliderValue(r,!0)},t.prototype.getRawSliderValueForItem=function(e){var t=null;if(e)if(this.isNumeric){var i=e.value;i>=this.numericSliderMinVal&&i<=this.numericSliderMaxVal&&(t=i)}else{var r=this.items.get().map(function(e){return e.value}).indexOf(e.value);r>-1&&r<this.items.length()&&(t=r)}return t},t.prototype.cleanUp=function(){this.isEnabled.set(!1),this.labelGenerator=null,this.items.clear(),this.isNumeric=null,this.sliderMaxHandleCurrentItem.set(null),this.sliderMinHandleCurrentItem.set(null),this.sliderMinHandleLabel.set(""),this.sliderMaxHandleLabel.set(""),this.sliderMaxLabel.set(""),this.sliderMinLabel.set(""),this.numericSliderStep=null,this.numericSliderMinVal=null,this.numericSliderMaxVal=null,this._numericSliderItemCache={},this.numericSliderHandleStartValues.length=0,this.sliderHandleStartLabels.length=0,this._snappableDatePoints.length=0,this.itemActivePredicate=this._defaultItemActivePredicate,this.sliderTicks.clear(),this._underlyingCollection&&(this._underlyingCollectionBindingToken&&(this._underlyingCollection.unbind(this._underlyingCollectionBindingToken),this._underlyingCollectionBindingToken=null),this._underlyingCollection=null)},t.prototype._setNextOrPreviousSliderItem=function(e,t){if(0!==e&&1!==e)return this.app.trace.error("SliderViewModelBase: Could not set "+t+" slider item. Invalid handle index.Handle index must be 0 or 1."),!1;var i=0===e?this.sliderMinHandleCurrentItem.get():this.sliderMaxHandleCurrentItem.get(),r=0===e?this.sliderMaxHandleCurrentItem.get():this.sliderMinHandleCurrentItem.get();if(!i)return this.app.trace.error("SliderViewModelBase: Could not set "+t+" slider item. Please set current item first."),!1;var n="next"===t?this.getNextActiveSliderItem(i):this.getPreviousActiveSliderItem(i);return!(!n||r&&(!r||r.value===n.value)||n.value===i.value)&&(!(r&&0===e&&"next"===t&&n.value>=r.value)&&(!(r&&1===e&&"next"!==t&&n.value<=r.value)&&((!this.range||!this.lockMinSliderHandleAtMinVal||0!==e)&&(this.setSelectedSliderItem(e,n),!0))))},t.prototype._initializeUIObservables=function(){this._setupSliderTicks(),this._setupSliderMinMaxLabels(),this.isEnabled.set(!0)},t.prototype._setupSliderTicks=function(){this.sliderTicks.clear();var e=this.isNumeric?(this.numericSliderMaxVal-this.numericSliderMinVal)/this.numericSliderStep:this.items.length();e=e>this._maxSliderTicks?this._maxSliderTicks:e;for(var t=100/e,i=0,r=0;r<e;r++)i<=100&&(this.sliderTicks.addItem({position:i+"%"}),i+=t)},t.prototype._setupSliderMinMaxLabels=function(){var e=this.isNumeric?this.getSliderItemByItemValue(this.numericSliderMinVal):this.items.getAt(0),t=this.isNumeric?this.getSliderItemByItemValue(this.numericSliderMaxVal):this.items.getAt(this.items.length()-1);this.sliderMinLabel.set(e?e.label:""),this.sliderMaxLabel.set(t?t.label:"")},t.prototype._getAdjacentSliderItem=function(e,t,i){void 0===t&&(t="next"),void 0===i&&(i="any");var r=this.getRawSliderValueForItem(e);if(null===r)return null;var n=null,a=null;do if(r=this.isNumeric?this._getAdjacentNumericItemRawValue(r,t):"prev"===t?r-1:r+1,a=this.getSliderItemByRawSliderValue(r,this.isNumeric))switch(i){case"active":n=a.active?a:null;break;case"inactive":n=a.active?null:a;break;default:n=a}while(a&&!n);return n},t.prototype._getAdjacentNumericItemRawValue=function(e,t,i){var r=this;void 0===t&&(t="next"),void 0===i&&(i=!1);var a=null,o=function(e){return e&&!isNaN(e)&&i&&(e=e>r.numericSliderMaxVal?r.numericSliderMaxVal:e,e=e<r.numericSliderMinVal?r.numericSliderMinVal:e),e},s=function(){return"prev"===t?e-r.numericSliderStep:e+r.numericSliderStep};if(!this.isDateMode||!this.dateModeTimeInterval||!this.dateModeTimeIntervalUnit)return o(s());var l=function(e){return"next"===t?e:-1*e};switch(this.dateModeTimeIntervalUnit){case n.TimeUnits.UNIT_MILLISECONDS:return e+l(this.dateModeTimeInterval);case n.TimeUnits.UNIT_SECONDS:return e+l(1e3*this.dateModeTimeInterval);case n.TimeUnits.UNIT_MINUTES:return e+l(60*this.dateModeTimeInterval*1e3);case n.TimeUnits.UNIT_HOURS:return e+l(60*this.dateModeTimeInterval*60*1e3);case n.TimeUnits.UNIT_DAYS:return e+l(24*this.dateModeTimeInterval*60*60*1e3);case n.TimeUnits.UNIT_WEEKS:return e+l(7*this.dateModeTimeInterval*24*60*60*1e3);case n.TimeUnits.UNIT_MONTHS:a=new Date(e),a.setUTCMonth(a.getUTCMonth()+l(this.dateModeTimeInterval));break;case n.TimeUnits.UNIT_YEARS:a=new Date(e),a.setUTCFullYear(a.getUTCFullYear()+l(this.dateModeTimeInterval));break;case n.TimeUnits.UNIT_DECADES:a=new Date(e),a.setUTCFullYear(a.getUTCFullYear()+l(10*this.dateModeTimeInterval));break;case n.TimeUnits.UNIT_CENTURIES:a=new Date(e),a.setUTCFullYear(a.getUTCFullYear()+l(100*this.dateModeTimeInterval))}var c=a&&!isNaN(a.getTime())?a.getTime():s();return o(c)},t.prototype._resetTimeIntervalBasedOnSliderStep=function(){if(this.dateModeTimeInterval&&this.dateModeTimeIntervalUnit&&this.numericSliderStep&&!isNaN(this.numericSliderStep)&&!(this.numericSliderStep<=0)){var e=1970,t=new Date(this.numericSliderStep);if(!isNaN(t.getTime()))for(var i=[t.getUTCFullYear()-e,t.getUTCMonth(),t.getUTCDate()-1,t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()],r=[n.TimeUnits.UNIT_YEARS,n.TimeUnits.UNIT_MONTHS,n.TimeUnits.UNIT_DAYS,n.TimeUnits.UNIT_HOURS,n.TimeUnits.UNIT_MINUTES,n.TimeUnits.UNIT_SECONDS,n.TimeUnits.UNIT_MILLISECONDS],o=0;o<i.length;o++)if(i[o]>0){this.dateModeTimeIntervalUnit=r[o],this.dateModeTimeInterval=i[o],this.numericSliderStep=a.computeTimeIntervalInMs(this.dateModeTimeInterval,this.dateModeTimeIntervalUnit);break}}},t.prototype._getClosestDateItemRawValueSnappedToInterval=function(e,t,i){if(void 0===t&&(t="next"),void 0===i&&(i=!1),!this._snappableDatePoints.length)return i?this._getAdjacentNumericItemRawValue(e,t):e;for(var r,n,a,o=0,s=this._snappableDatePoints.length-1;o<=s;){if(r=Math.floor((o+s)/2),n=this._snappableDatePoints[r],n===e)return i?this._getAdjacentNumericItemRawValue(e,t):e;var l="next"===t?e>n&&e<this._snappableDatePoints[r+1]:e<n&&e>this._snappableDatePoints[r-1];if(l){a=n;break}n<e?o=r+1:n>e&&(s=r-1)}return a?this._getAdjacentNumericItemRawValue(a,t):null},t.prototype._generateDateModeSnappablePoints=function(){if(this.isDateMode&&this.dateModeTimeInterval&&this.dateModeTimeIntervalUnit&&this.numericSliderMinVal&&this.numericSliderMaxVal){this._snappableDatePoints.length=0;var e=this.numericSliderMinVal;if(this.dateModeTimeIntervalUnit===n.TimeUnits.UNIT_WEEKS||this.dateModeTimeIntervalUnit===n.TimeUnits.UNIT_MONTHS||this.dateModeTimeIntervalUnit===n.TimeUnits.UNIT_YEARS||this.dateModeTimeIntervalUnit===n.TimeUnits.UNIT_DECADES||this.dateModeTimeIntervalUnit===n.TimeUnits.UNIT_CENTURIES){this._snappableDatePoints.push(e);do e=this._getAdjacentNumericItemRawValue(e,"next"),this._snappableDatePoints.push(e);while(e<this.numericSliderMaxVal);this._snappableDatePoints.push(this.numericSliderMaxVal)}}},t.prototype._applyConfig=function(e){this._config=e||{},this.range=void 0!==this._config.range&&!!this._config.range,this.animate=void 0!==this._config.animate&&!!this._config.animate,this.disableSnappingForNumericValues=void 0===this._config.disableSnappingForNumericValues||!!this._config.disableSnappingForNumericValues,this.lockMinSliderHandleAtMinVal=void 0!==this._config.lockMinSliderHandleAtMinVal&&!!this._config.lockMinSliderHandleAtMinVal,this.sliderMinHandleAriaLabel=e.sliderMinHandleAriaLabel||null,this.sliderMaxHandleAriaLabel=e.sliderMaxHandleAriaLabel||null,this.sliderSingleHandleAriaLabel=e.sliderSingleHandleAriaLabel||null},t.prototype._handleUnderlyingCollectionChanges=function(e){var t,i=this;switch(e.type){case"clear":this.items.clear();break;case"insert":t=e.sender.getRange(e.rangeStart,e.rangeEnd),this.items.insertItems(e.rangeStart,t.map(function(t,r){return i._createSliderItem(t,e.rangeStart+r)}));break;case"append":t=e.sender.getRange(e.rangeStart,e.rangeEnd),this.items.addItems(t.map(function(t,r){return i._createSliderItem(t,e.rangeStart+r)}));break;case"remove":this.items.removeRange(e.rangeStart,e.rangeEnd)}this._initializeUIObservables()},t.prototype._createSliderItem=function(e,t){return{value:e,label:this._getItemLabel(e,t),active:this.itemActivePredicate(e,t)}},t.prototype._getItemLabel=function(e,t){var i="";return this.labelGenerator&&(i=this.labelGenerator(e,t),i=null===i||void 0===i?"":i+""),i},t.prototype._updateSliderItem=function(e,t){return e.label=this._getItemLabel(e.value,t),e.active=this.itemActivePredicate(e.value,t),e},t.prototype._getUpdatedNumericItemAndUpdateCache=function(e,t){if(null===e||void 0===e||null===t||void 0===t)return null;var i=this._numericSliderItemCache[e+""];return i?this._updateSliderItem(i,t):i=this._createSliderItem(e,t),this._numericSliderItemCache[e+""]=i,i},t}(i.ViewModelBase);t.SliderViewModelBase=o})},"geocortex/infrastructure/ui/components/Slider/SliderViewBase":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sliderElement=null,t.sliderMinLabelElement=null,t.sliderMaxLabelElement=null,t._sliderCurrentRawValues=[],t._sliderCurrentHandlePos=[],t._widgetHostElement=null,t._minHandleBindingToken=null,t._maxHandleBindingToken=null,t._isEnabledBindingToken=null,t._isAdded=!1,t._minHnadleLocked=!1,t._maxHandleLocked=!1,t._minHandleTag="gcx_timeslider_handle0",t._maxHandleTag="gcx_timeslider_handle1",t._currPosForComputedDirection=[],t}return __extends(t,e),t.prototype.attach=function(t){t&&(e.prototype.attach.call(this,t),this._isAdded&&this._initializeIfEnabled(this.viewModel.isEnabled.get()))},t.prototype.added=function(t){e.prototype.added.call(this,t),this._isAdded=!0,this._widgetHostElement=t,this._cleanUp(!0),this._isEnabledBindingToken=this.viewModel.isEnabled.bind(this,this._initializeIfEnabled),this._initializeIfEnabled(this.viewModel.isEnabled.get())},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this._cleanUp(!0)},t.prototype.refreshLabelPositions=function(){this._updateLabelPosition(0),this._updateLabelPosition(1)},t.prototype._setupViewModelBindings=function(){var e=this;this._minHandleBindingToken=this.viewModel.sliderMinHandleCurrentItem.bind(this,function(t){return e._setSliderValueAndUpdateLabels(0,e.viewModel.getRawSliderValueForItem(t))}),this.viewModel.range&&(this._maxHandleBindingToken=this.viewModel.sliderMaxHandleCurrentItem.bind(this,function(t){return e._setSliderValueAndUpdateLabels(1,e.viewModel.getRawSliderValueForItem(t))}))},t.prototype._generateJQuerySlider=function(){var e=this,t=this.viewModel,i={animate:t.animate,min:t.isNumeric?t.numericSliderMinVal:0,max:t.isNumeric?t.numericSliderMaxVal:t.items.length()-1,step:t.isNumeric?t.isDateMode||t.disableSnappingForNumericValues?1:t.numericSliderStep:1,orientation:"horizontal",range:t.range,slide:function(t,i){return e._handleSliderRawValueSlide(t,i)},change:function(t,i){return e._handleSliderRawValueChange(t,i)}};this.viewModel.isDateMode&&(i.slide=function(t,i){return e._dateModeRawValueSlide(t,i)});var r=function(){i.range?i.values=[i.min,i.min+i.step]:i.value=i.min},n=function(){if(i.values[0]===i.values[1]){var e=i.values[0]+i.step,t=i.values[0]-i.step;e<=i.max?i.values[1]=e:i.values[0]=t}};if(t.isNumeric&&t.numericSliderHandleStartValues.length)!i.range||isNaN(t.numericSliderHandleStartValues[0])||isNaN(t.numericSliderHandleStartValues[1])?i.range||isNaN(t.numericSliderHandleStartValues[0])?r():i.value=t.numericSliderHandleStartValues[0]:(i.values=t.numericSliderHandleStartValues.slice(0,2),t.lockMinSliderHandleAtMinVal&&(i.values[0]=i.min),n());else if(!t.isNumeric&&t.sliderHandleStartLabels.length){var a=t.getSliderItemByItemLabel(t.sliderHandleStartLabels[0]),o=t.getSliderItemByItemLabel(t.sliderHandleStartLabels[1]);i.range&&a&&o?(i.values=[t.items.indexOf(a)-1,t.items.indexOf(o)-1],t.lockMinSliderHandleAtMinVal&&(i.values[0]=i.min),n()):!i.range&&a?i.value=t.items.indexOf(a)-1:r()}else r();i.range?this._sliderCurrentRawValues=i.values.slice(0):this._sliderCurrentRawValues[0]=i.value;var s=$(this.sliderElement);s.slider(i),this._wireInKeyboardSupport();var l=this._widgetHostElement?this._widgetHostElement:this;if(l.isActive)this._applyInitViewModelState(i);else var c=this.app.event("ViewActivatedEvent").subscribe(this,function(t){t===l&&(e.app.event("ViewActivatedEvent").unsubscribe(c),c=null,e._applyInitViewModelState(i))})},t.prototype._applyInitViewModelState=function(e){e.range?(this.viewModel.setSelectedSliderItem(0,this.viewModel.getSliderItemByRawSliderValue(e.values[0])),this.viewModel.setSelectedSliderItem(1,this.viewModel.getSliderItemByRawSliderValue(e.values[1]))):this.viewModel.setSelectedSliderItem(0,this.viewModel.getSliderItemByRawSliderValue(e.value))},t.prototype._handleSliderRawValueChange=function(e,t){var i=this._getSliderHandleIndex(t);return this._sliderCurrentRawValues[i]=t.value,this._minHnadleLocked=!1,this._maxHandleLocked=!1,!0},t.prototype._dateModeRawValueSlide=function(e,t){if(!e||37===e.which||39===e.which||!e.originalEvent||!$(e.originalEvent.target).hasClass("ui-slider-handle"))return this._handleSliderRawValueSlide(e,t);var i=this._getSliderHandleIndex(t);if(void 0!==this._currPosForComputedDirection[i]&&this._currPosForComputedDirection[i]!==t.value){var r=t.value>this._currPosForComputedDirection[i];if(r&&void 0!==this._sliderCurrentRawValues[i]&&t.value>this._sliderCurrentRawValues[i]||!r&&void 0!==this._sliderCurrentRawValues[i]&&t.value<this._sliderCurrentRawValues[i])return this._currPosForComputedDirection.length=0,this._handleSliderRawValueSlide(e,t,r)}return this._currPosForComputedDirection[i]=t.value,!1},t.prototype._handleSliderRawValueSlide=function(e,t,i){if(!t||!t.handle||void 0===t.value)return!1;var r=this._getSliderHandleIndex(t);if(this._currPosForComputedDirection.length=0,this.viewModel.range&&this.viewModel.lockMinSliderHandleAtMinVal&&0===r&&(r=1),!this.viewModel.range&&1===r)return!1;if(0===r&&this._minHnadleLocked)return!1;if(1===r&&this._maxHandleLocked)return!1;0===r?this._maxHandleLocked=!0:this._minHnadleLocked=!0;var n=this.viewModel.getSliderItemByRawSliderValue(t.value),a=t.value,o=this._sliderCurrentRawValues[r],s=void 0===i?void 0===o||t.value>o:i;if(this.viewModel.isDateMode&&!this.viewModel.disableSnappingForNumericValues&&(n=s?this.viewModel.getClosestDateItemSnappedToInterval(n,"next",37===e.which||39===e.which):this.viewModel.getClosestDateItemSnappedToInterval(n,"prev",37===e.which||39===e.which),a=this.viewModel.getRawSliderValueForItem(n)),n&&!n.active){this._sliderCurrentRawValues[r];n=s?this.viewModel.getNextActiveSliderItem(n):this.viewModel.getPreviousActiveSliderItem(n),a=this.viewModel.getRawSliderValueForItem(n)}if(n&&this.viewModel.range){var l=0===r?this.viewModel.sliderMaxHandleCurrentItem.get():this.viewModel.sliderMinHandleCurrentItem.get(),c=0===r?n.value>l.value:n.value<l.value;if(l&&(c||n.value===l.value||this.viewModel.isDateMode&&n.label===l.label)){if(this.viewModel.isDateMode){if(this.viewModel.disableSnappingForNumericValues)return!1;n=0===r?this.viewModel.getClosestDateItemSnappedToInterval(n,"prev",!0):this.viewModel.getClosestDateItemSnappedToInterval(n,"next",!0)}else n=0===r?this.viewModel.getPreviousActiveSliderItem(n):this.viewModel.getNextActiveSliderItem(n);a=this.viewModel.getRawSliderValueForItem(n)}}if(!n)return!1;var u=0===r?this.viewModel.sliderMinHandleCurrentItem.get():this.viewModel.sliderMaxHandleCurrentItem.get();return u&&n.value===u.value&&(this._minHnadleLocked=!1,this._maxHandleLocked=!1),this.viewModel.setSelectedSliderItem(r,n),!1},t.prototype._getSliderHandleIndex=function(e){if($(e.handle).hasClass(this._minHandleTag))return 0;if($(e.handle).hasClass(this._maxHandleTag))return 1;var t=0;return this.viewModel.range&&(t=null===e.handle.nextElementSibling||void 0===e.handle.nextElementSibling?1:0),$(e.handle).addClass(0===t?this._minHandleTag:this._maxHandleTag),t},t.prototype._setSliderValueAndUpdateLabels=function(e,t){if(null!==t){if(0!==e&&1!==e||isNaN(parseInt(t,10)))return void this.app.trace.error("SliderViewBase: Could not set slider values and update UI. Required arguments invalid.");this._setSliderRawValue(e,t),this._updateLabelPosition(e)}},t.prototype._setSliderRawValue=function(e,t){if(this.viewModel.range){var i=$(this.sliderElement).slider("values");i[e]!==t&&$(this.sliderElement).slider("values",e,t)}else{var r=$(this.sliderElement).slider("value");r!==t&&$(this.sliderElement).slider("value",t)}},t.prototype._updateSliderHandleAttributes=function(e){var t=0===e?this.viewModel.sliderMinHandleCurrentItem.get():this.viewModel.sliderMaxHandleCurrentItem.get(),i=$(".ui-slider-handle",this.sliderElement).toArray()[e];if(i&&t&&t.label){var r=0===e?this.viewModel.range?this.viewModel.sliderMinHandleAriaLabel||"":this.viewModel.sliderSingleHandleAriaLabel||"":this.viewModel.sliderMaxHandleAriaLabel||"";void 0==$(i).attr("tabindex")&&$(i).attr("tabindex",0),void 0==$(i).attr("role")&&$(i).attr("role","slider"),$(i).attr("aria-label",r||t.label),$(i).attr("aria-valuenow",t.label),$(i).attr("aria-valuetext",t.label),$(i).attr("title",t.label)}},t.prototype._updateLabelPosition=function(e){var t=this;this._updateLabelPositionImpl(e),setTimeout(function(){return t._updateLabelPositionImpl(e)},this.viewModel.animate?400:100)},t.prototype._updateLabelPositionImpl=function(e){if(null!==e&&void 0!==e&&(0===e||1===e)&&(this.viewModel.range||1!==e)){var t=$(".ui-slider-handle",this.sliderElement).toArray();if(0!==t.length){var i=5,r=0===e?$(this.sliderMinLabelElement).width()+i:$(this.sliderMaxLabelElement).width(),n=$(this.sliderElement).width(),a=$(t[e]).width(),o=$(t[e]).position().left+$(this.sliderElement).position().left+.5*a-.5*r;o=Math.max($(this.sliderElement).position().left-.5*a,o),o=Math.min(n+$(this.sliderElement).position().left+.5*a-r,o);var s=this._sliderCurrentHandlePos[(e+1)%2],l=(0===e?$(this.sliderMaxLabelElement).width()+i:$(this.sliderMinLabelElement).width())+i;l=l<.5*r?r:l,s=isNaN(s)&&this.viewModel.range?n+$(this.sliderElement).position().left+.5*a-l:s,isNaN(s)||(0===e?(o=s>=r?Math.min(s-r,o):o,o=Math.min(n+$(this.sliderElement).position().left+.5*a-(l+r-i),o)):1===e&&(o=Math.max(s+l+.5*a,o))),this._sliderCurrentHandlePos[e]=o,0===e?this.sliderMinLabelElement.style.left=o+"px":this.sliderMaxLabelElement.style.left=o+"px",this._updateSliderHandleAttributes(e)}}},t.prototype._processInitRoutine=function(){this._cleanUp(),this._setupViewModelBindings(),this._generateJQuerySlider()},t.prototype._initializeIfEnabled=function(e){e&&this._processInitRoutine()},t.prototype._cleanUp=function(e){void 0===e&&(e=!1),this.sliderElement&&$(this.sliderElement).hasClass("ui-slider")&&$(this.sliderElement).slider("destroy"),this.viewModel&&(this._isEnabledBindingToken&&e&&(this.viewModel.isEnabled.unbind(this._isEnabledBindingToken),this._isEnabledBindingToken=null),this._minHandleBindingToken&&this.viewModel.sliderMinHandleCurrentItem.unbind(this._minHandleBindingToken),this._maxHandleBindingToken&&this.viewModel.sliderMaxHandleCurrentItem.unbind(this._maxHandleBindingToken)),this._sliderCurrentHandlePos=[],this._sliderCurrentRawValues=[],this._currPosForComputedDirection=[],this._minHandleBindingToken=null,this._maxHandleBindingToken=null},t.prototype._wireInKeyboardSupport=function(){var e=this,t=$(".ui-slider-handle",this.sliderElement).toArray();if(0!==t.length){var i=function(i,r,n){var a={which:n},o={handle:t[r],value:"prev"===i?e._sliderCurrentRawValues[r]-1:e._sliderCurrentRawValues[r]+1};e._handleSliderRawValueSlide(a,o)};t.forEach(function(t,r){$(t).unbind("keydown"),$(t).keydown(function(t){var n=!1;switch(t.which){case 38:case 39:case 33:i("next",r,39);break;case 37:case 40:case 34:i("prev",r,37);break;default:n=!0}e.refreshLabelPositions(),n||(t.preventDefault(),
t.stopPropagation())})})}},t}(i.ViewBase);t.SliderViewBase=r})},"geocortex/infrastructure/ui/components/WizardPanel/ValidationHandler":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentViewModel":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/infrastructure/ui/components/WizardPanel/WizardPanelViewModel":function(){define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.showOrHideCloseButtons=function(){var e=this.viewDescriptors.getAt(0);if(e){var t=this.currentView===e.view;this.showingBackButton.set(!t),this.showingXButton.set(!0)}},t.prototype.closeAllViews=function(e){for(var t=0;t<this.viewDescriptors.length();t++){var i=this.viewDescriptors.getAt(t),r=i.view,n=r.viewModel;this._isWizardFragment(n)&&n.reset(),this.app.viewManager.deactivateView(r)}},t.prototype._isWizardFragment=function(e){return void 0!==e.reset},t}(i.SmartPanelViewModel);t.WizardPanelViewModel=r})},"geocortex/infrastructure/ui/components/WizardPanel/WizardPanelView":function(){define(["require","exports","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.finish=function(){this.viewModel.closeAllViews()},t.prototype.cancel=function(){this.viewModel.closeAllViews(!0)},t.prototype.handleClickBack=function(t,i,r){e.prototype.handleClickBack.call(this,t,i,r)},t.prototype.handleClickClose=function(t,i,r){e.prototype.handleClickClose.call(this,t,i,r),this.cancel()},t}(i.SmartPanelView);t.WizardPanelView=r})},"geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework-ui/ViewContainer/ViewContainerView"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.attach=function(t){var i=this;e.prototype.attach.call(this,t),this._viewContainerActivatedEventToken||(this._viewContainerActivatedEventToken=this.app.event("ViewContainerActivatedEvent").subscribe(this,function(e){null==i.parentContainer&&i._isViewHostedInContainer(e)&&(i.parentContainer=e)}))},t.prototype._isViewHostedInContainer=function(e){if(e instanceof r.ViewContainerView){var t=e.viewModel.regionName.get(),i=this.app.viewManager.getRegionForViewId(this.id);if(i&&i.name===t)return!0}return!1},t.prototype.finishWizard=function(){this.parentContainer&&this.parentContainer.finish()},t.prototype.cancelWizard=function(){this.parentContainer&&this.parentContainer.cancel()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._viewContainerActivatedEventToken&&(this.app.event("ViewContainerActivatedEvent").unsubscribe(this._viewContainerActivatedEventToken),this._viewContainerActivatedEventToken=null),this.parentContainer&&(this.parentContainer=null)},t.prototype._validator=function(){return[]},t.prototype.validate=function(e){return this.validationProblems=this._validator(),this.validationProblems.length<1},t.prototype.reset=function(){this.viewModel.reset()},t.prototype.loadState=function(){},t.prototype.saveState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.goNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("This method is abstract")},t.prototype.goBack=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("This method is abstract")},t}(i.ViewBase);t.WizardFragmentView=n})},"url:/Mapping/infrastructure/documents/GrantEditorView.html":'<div class="grant-editor">\r\n    <div class="grant-editor-options">\r\n        <div class="grant-editor-search-options">\r\n            <select data-binding="{@enabled: enabled}{@source: monikerKinds}{@value: selectedMonikerKind}">\r\n                <option data-binding="{@template-for: monikerKinds}{@text: displayName}{value: kind}" />\r\n            </select>\r\n            <input class="grant-editor-search" type="text" data-binding="{@enabled: enabled}{@value: searchText}{@var: autoCompleteInput}{@event-oninput: handleInputChanged}{placeholder: @language-grant-editor-search-placeholder}{title: @language-grant-editor-search-title}{@event-blur: handleAutoCompleteBlur}" />\r\n        </div>\r\n        <div class="form-btns">\r\n            <button class="button add-button" data-binding="{@enabled: isValidMoniker}{title: @language-grant-editor-add-button-title}{@text: @language-grant-editor-add-button-text}{@event-onclick: handleAddMonikerButtonClick}"></button>\r\n        </div>\r\n    </div>\r\n    <div class="grant-editor-table" data-binding="{@class-show-owner: editOwnership}">\r\n        <table>\r\n            <thead>\r\n                <tr>\r\n                    <th class="grant-name-column"></th>\r\n                    <th data-binding="{@text: @language-grant-editor-table-header-none}"></th>\r\n                    <th data-binding="{@text: @language-grant-editor-table-header-view}"></th>\r\n                    <th data-binding="{@text: @language-grant-editor-table-header-edit}"></th>\r\n                    <th class="owner-column" data-binding="{@text: @language-grant-editor-table-header-owner}"></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody data-binding="{@source: monikers}">\r\n                <tr data-binding="{@template-for: monikers}{@class-global-grant: isGlobal}{@class-disabled-grant: isRevoked}">\r\n                    <td class="grant-name-column">\r\n                        <img data-binding="{src: iconUri}" />\r\n                        <span class="grant-name-label" data-binding="{@text: name}{title: name}"></span>\r\n                    </td>\r\n                    <td>\r\n                        <input type="radio" data-binding="{@enabled: enabled}{name: id}{checked: isGlobal}{@event-onclick: handleUpdateMoniker}" />\r\n                    </td>\r\n                    <td>\r\n                        <input type="radio" value="reader" data-binding="{@enabled: enabled}{name: id}{checked: canRead}{@event-onclick: handleUpdateMoniker}" />\r\n                    </td>\r\n                    <td>\r\n                        <input type="radio" value="writer" data-binding="{@enabled: enabled}{@hidden: isPublic}{name: id}{checked: canWrite}{@event-onclick: handleUpdateMoniker}" />\r\n                    </td>\r\n                    <td class="owner-column">\r\n                        <input type="radio" value="owner" data-binding="{@enabled: enabled}{@hidden: isPublic}{name: id}{checked: canEdit}{@event-onclick: handleUpdateMoniker}" />\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/menus/IconMenuView.html":'<div class="menu-no-items" data-binding="{@hidden: visibleMenuItems}{@text: @language-menu-no-items}"><!-- No Items. --></div>\r\n\r\n<div class="list-menu active has-icon icon-menu" data-binding="{@visible: visibleMenuItems}{@source: visibleMenuItems}">\r\n    <div class="list-menu-item" data-binding="{@template-for: visibleMenuItems}{@enabled: canExecute}{@event-onclick: handleMenuItemClick}">\r\n        <button class="list-menu-details" data-binding="{@event-onclick: handleMenuItemClick}{title: description}">\r\n            <img class="list-menu-icon" data-binding="{@visible: iconUri}{src: iconUri}" alt=" " />\r\n            <strong class="list-menu-name" data-binding="{@text: text}"></strong>\r\n        </button>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/menus/MenuHyperlinkView.html":'<div class="menu-hyperlinks">\r\n    <ul class="list-menu active" data-binding="{@visible: visibleMenuItems}{@source: visibleMenuItems}">\r\n        <li class="list-menu-item" data-binding="{@template-for: visibleMenuItems}">\r\n            <button class="list-menu-button" data-binding="{title: description}{@text: text}{@event-onclick: handleMenuItemClick}{@enabled: canExecute}"></button>\r\n        </li>\r\n    </ul>\r\n</div>\r\n',"url:/Mapping/infrastructure/menus/MenuView.html":'<div class="menu-no-items" data-binding="{@hidden: visibleMenuItems}{@text: @language-menu-no-items}"><!-- No Items. --></div>\r\n\r\n<div class="list-menu active has-icon" data-binding="{@visible: visibleMenuItems}{@source: visibleMenuItems}">\r\n    <div class="list-menu-item" data-binding="{@template-for: visibleMenuItems}{@enabled: canExecute}{@event-onclick: handleMenuItemClick}">\r\n        <img class="list-menu-icon" data-binding="{@visible: iconUri}{src: iconUri}{alt: text}" />\r\n        <button class="list-menu-details" data-binding="{@event-onclick: handleMenuItemClick}{title: description}">\r\n            <strong class="list-menu-name" data-binding="{@text: text}"></strong>\r\n            <span class="list-menu-desc" data-binding="{@visible: description}{@text: description}"></span>\r\n        </button>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/results/FeatureSetCollectionResultsLabelView.html":'<button class="gcx-list-button gcx-list-button-poc icon-right chevron-right-24" data-binding="{@event-onclick: handleClick}">\r\n    <img class="list-menu-icon list-menu-icon-poc" data-binding="{src: iconUri}{@visible: iconUri}" alt=" " aria-hidden="true" />\r\n    <img class="list-menu-icon list-menu-icon-poc" data-binding="{@hidden: iconUri}" src="Resources/Images/Icons/map-default-24.png" alt=" " aria-hidden="true" />\r\n\r\n    <strong class="gcx-list-label gcx-list-label-poc"><span data-binding="{@var: featuresCount}{@text: featuresCount}"></span> <span data-binding="{@var: featureSetLabel}{@text: featureSetLabel}"></span></strong>\r\n</button>',"url:/Mapping/infrastructure/results/FeatureSetCollectionResultsView.html":'<div class="results-list-actions-widget" data-binding="{@visible: featureSetCollection}{@widget: FeatureSetCollectionActionsWidget}{@widget-context: featureSetCollection}{@widget-required: false}"\r\n     data-menu-id="FeatureSetCollectionResultsActions" data-menu-template="Mapping/infrastructure/menus/MenuHyperlinkView.html"></div>\r\n\r\n<!--<div class="results">-->\r\n<div class="layer-addition map-services-dialog">\r\n    <!-- BEGIN: No Results -->\r\n    <div class="no-results" data-binding="{@hidden: featureSets}{@text: searchSuggestion}" tabindex="0"></div>\r\n\r\n    <div class="panel-group" data-binding="{@visible: featureSets}{@var: scrollContainerElement}">\r\n\r\n        <!--NOTE: the logic to open and close the inline flyout menu as defined in ResultsUtils \r\n            relies on this class being gcx-list-menu. If this needs to be changed make sure that \r\n            ResultsUtils is updated as well.-->\r\n        <ul class="gcx-list-menu" data-binding="{@source: featureSets}">\r\n            <li class="gcx-list-item has-action-1" data-binding="{title: @language-results-feature-set-element-title}{@template-for: featureSets}">\r\n                \r\n                <!--  NOTE: The view requires that this div is the FIRST child of the <li>. If needs to be changed let\'s make sure that the\r\n                    access to firstElementChild in ResultsUtils is updated as well. -->\r\n                <div class="smart-panel-hoisted-menu-inline feature-sets-actions bound-invisible" data-binding="{@widget: FeatureSetActionsWidget}{@widget-context: @context}{@widget-required: false}"\r\n                     data-menu-id="FeatureSetCollectionResultsFeatureSetActions" data-menu-hoist-disabled></div>\r\n                <div data-binding="{@widget: GetFeatureSetLabel}{@widget-context: @context}{@widget-replace: true}"></div>\r\n\r\n                <!--  NOTE: When dealing with the click event the view requires that this button is an immediate child of <li>.\r\n                    If this needs to be updated make sure that the part of code that access the parentElement in handleFeatureSetFeatureActionClick\r\n                    is updated as well. -->\r\n                <button class="gcx-action-button icon more-24" data-binding="{title: @language-menu-feature-set-actions-title}{@event-click: handleFeatureSetCollectionFeatureSetActionsClick}"></button>\r\n            </li>\r\n        </ul>\r\n\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/results/FeatureSetResultsView.html":'<div class="results-list-actions-widget" data-binding="{@visible: featureSet}{@widget: FeatureSetActionsWidget}{@widget-context: featureSet}{@widget-required: false}" \r\n     data-menu-id="FeatureSetResultsActions" data-menu-template="Mapping/infrastructure/menus/MenuHyperlinkView.html"></div>\r\n\r\n<div class="layer-addition map-services-dialog">\r\n    <!-- BEGIN: No Results -->\r\n    <div class="no-results" data-binding="{@hidden: presentableResults}{@text: searchSuggestion}" tabindex="0"></div>\r\n    <!-- END: No Results -->\r\n\r\n    <!-- BEGIN: Feature set features List -->\r\n    <div class="results-list" data-binding="{@var: scrollContainerElement}{@event-onscroll: handleScrollChange}" tabindex="-1">\r\n\r\n        <!--NOTE: the logic to open and close the inline flyout menu as defined in ResultsUtils\r\n        relies on this class being gcx-list-menu. If this needs to be changed make sure that\r\n        ResultsUtils is updated as well.-->\r\n        <ul class="gcx-list-menu" data-binding="{@source: resultsPage}{@visible: resultsPage}">\r\n            <li class="gcx-list-item has-action-1" data-binding="{title: @language-results-feature-element-title}{@event-mouseenter: handleMouseOver}{@event-mouseleave: handleMouseOut}{@template-for: resultsPage}">\r\n\r\n                <!--  NOTE: The view requires that this div is the FIRST child of the <li>. If needs to be changed let\'s make sure that the \r\n                    access to firstElementChild in ResultsUtils is updated as well. -->\r\n                <div class="smart-panel-hoisted-menu-inline feature-set-actions bound-invisible" data-binding="{@widget: FeatureActionsWidget}{@widget-context: @context}{@widget-required: false}"\r\n                     data-menu-id="FeatureSetResultsFeatureActions" data-menu-hoist-disabled></div>\r\n                <button class="gcx-list-button gcx-list-button-poc icon-right chevron-right-24" data-binding="{@event-onfocus: handleMouseOver}{@event-onblur: handleMouseOut}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}">\r\n                    <span class="list-menu-details">\r\n                        <strong class="gcx-list-label" data-binding="{@widget: GetLabel}{@widget-context: @context}{@visible: label}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-mouseout: handleMouseOut}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}"></strong>\r\n                        <span class="gcx-list-desc" data-binding="{@widget: GetDescription}{@widget-context: @context}"></span>\r\n                    </span>\r\n                </button>\r\n\r\n                <!--  NOTE: When dealing with the click event the view requires that this button is an immediate child of <li>.\r\n                    If this needs to be updated make sure that the part of code that access the parentElement in handleFeatureSetFeatureActionClick\r\n                    is updated as well. -->\r\n                <button class="gcx-action-button icon more-24" data-binding="{title: @language-menu-feature-actions-title}{@event-onfocus: handleMouseOver}{@event-onblur: handleMouseOut}{@event-click: handleFeatureSetFeatureActionClick}"></button>\r\n            </li>\r\n        </ul>\r\n\r\n    </div>\r\n\r\n    <!-- If the below \'results-list\' div is tabbable, then shift+tab gets stuck in FireFox. -->\r\n    <!-- BEGIN: Paging Controls -->\r\n    <div class="paging-control" data-binding="{@source: presentableResults}{className: pagingControlClassName}">\r\n        <div class="paging-control-inner" data-binding="{@template-for: presentableResults}">\r\n            <div class="paging-result-info">\r\n                <span class="paging-results-total" data-binding="{@hidden: numberOfItems}{@text: @language-common-no-results}"></span>\r\n                <span data-binding="{@visible: numberOfItems}">\r\n                    <span data-binding="{@text: @language-results-displaying}"></span>&nbsp;<span data-binding="{@text: currIndexStartFromOne}"></span>&nbsp;-&nbsp;<span data-binding="{@text: currIndexEnd}"></span>&nbsp;(<span data-binding="{@text: @language-results-total}"></span>:&nbsp;<span data-binding="{@text: numberOfItems}"></span>)\r\n                </span>\r\n            </div>\r\n            <div class="paging-buttons" data-binding="{@visible: numberOfItems}">\r\n                <button class="first" data-binding="{@event-onclick: handlePageFirst}{title: @language-page-first}"><img src="Resources/Images/Icons/paging-control-first-44.png" alt=" " /></button>\r\n                <button class="prev" data-binding="{@event-onclick: handlePagePrev}{title: @language-page-prev}"><img src="Resources/Images/Icons/paging-control-previous-44.png" alt=" " /></button>\r\n                <span class="paging-buttons-info" tabindex="0">\r\n                    <span data-binding="{@text: @language-results-page}"></span>&nbsp;<span data-binding="{@text: currPageNumber}"></span>&nbsp;<span data-binding="{@text: @language-results-page-of}"></span>&nbsp;<span data-binding="{@text: lastPageNumber}"></span>\r\n                </span>\r\n                <button class="next" data-binding="{@event-onclick: handlePageNext}{title: @language-page-next}"><img src="Resources/Images/Icons/paging-control-next-44.png" alt=" " /></button>\r\n                <button class="last" data-binding="{@event-onclick: handlePageLast}{title: @language-page-last}"><img src="Resources/Images/Icons/paging-control-last-44.png" alt=" " /></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- END: Paging Controls -->\r\n</div>',"url:/Mapping/infrastructure/results/ResultsFeatureActionsView.html":'<div class="list-menu" data-binding="{@source: featureActions}">\r\n    <div class="list-menu-item" data-binding="{@template-for: featureActions}{@event-onmouseover: handleGetDescription}{@event-onclick: handleMenuItemClick}">\r\n        <button class="list-menu-details">\r\n            <strong class="list-menu-name" data-binding="{@text: text}"></strong>\r\n            <span class="list-menu-desc" data-binding="{@text: description}"></span>\r\n        </button>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/results/ResultsListView.html":'<div class="results-list-actions-widget" data-binding="{@visible: featureSetCollection}{@widget: ResultsListActionsWidget}{@widget-context: featureSetCollection}{@widget-required: false}" data-menu-id="ResultsListActions" data-menu-template="Mapping/infrastructure/menus/MenuHyperlinkView.html"></div>\r\n\r\n<div class="results">\r\n    <!-- BEGIN: No Results -->\r\n    <div class="no-results" data-binding="{@hidden: hasFeatureSets}{@text: searchSuggestion}" tabindex="0"></div>\r\n    <!-- END: No Results -->\r\n    <!-- BEGIN: Results List -->\r\n    <!-- If the below \'results-list\' div is tabbable, then shift+tab gets stuck in FireFox. -->\r\n    <div class="results-list" data-binding="{@var: scrollContainerElement}{@event-onscroll: handleScrollChange}" tabindex="-1">\r\n\r\n        <div class="list-menu active has-icon" data-binding="{@source: resultsPage}{@visible: resultsPage}{@var: resultsList}">\r\n            <div class="list-menu-item" data-binding="{@template-for: resultsPage}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-onfocus: handleMouseOver}{@event-onblur: handleMouseOut}{@event-mouseenter: handleMouseOver}{@event-mouseleave: handleMouseOut}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}" tabindex="0">\r\n                <img class="list-menu-icon" data-binding="{src: iconUri}{alt: label}{@visible: iconUri}" alt=" " aria-hidden="true" />\r\n                <img class="list-menu-icon" data-binding="{alt: label}{@hidden: iconUri}" src="Resources/Images/Icons/map-default-24.png" alt=" " aria-hidden="true" />\r\n                <span class="list-menu-details">\r\n                    <button class="list-menu-name" data-binding="{@widget: GetLabel}{@widget-context: @context}{@visible: label}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-mouseout: handleMouseOut}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}"></button>\r\n                    <span class="list-menu-desc" data-binding="{@widget: GetDescription}{@widget-context: @context}"></span>\r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- END: Results List -->\r\n    <!-- BEGIN: Paging Controls -->\r\n    <div class="paging-control" data-binding="{@source: presentableResults}{className: pagingControlClassName}">\r\n        <div class="paging-control-inner" data-binding="{@template-for: presentableResults}">\r\n            <div class="paging-result-info">\r\n                <span class="paging-results-total" data-binding="{@hidden: numberOfItems}{@text: @language-common-no-results}"></span>\r\n                <span data-binding="{@visible: numberOfItems}">\r\n                    <span data-binding="{@text: @language-results-displaying}"></span>&nbsp;<span data-binding="{@text: currIndexStartFromOne}"></span>&nbsp;-&nbsp;<span data-binding="{@text: currIndexEnd}"></span>&nbsp;(<span data-binding="{@text: @language-results-total}"></span>:&nbsp;<span data-binding="{@text: numberOfItems}"></span>)\r\n                </span>\r\n            </div>\r\n            <div class="paging-buttons" data-binding="{@visible: numberOfItems}">\r\n                <button class="first" data-binding="{@event-onclick: handlePageFirst}{title: @language-page-first}"><img src="Resources/Images/Icons/paging-control-first-44.png" alt=" " /></button>\r\n                <button class="prev" data-binding="{@event-onclick: handlePagePrev}{title: @language-page-prev}"><img src="Resources/Images/Icons/paging-control-previous-44.png" alt=" " /></button>\r\n                <span class="paging-buttons-info" tabindex="0">\r\n                    <span data-binding="{@text: @language-results-page}"></span>&nbsp;<span data-binding="{@text: currPageNumber}"></span>&nbsp;<span data-binding="{@text: @language-results-page-of}"></span>&nbsp;<span data-binding="{@text: lastPageNumber}"></span>\r\n                </span>\r\n                <button class="next" data-binding="{@event-onclick: handlePageNext}{title: @language-page-next}"><img src="Resources/Images/Icons/paging-control-next-44.png" alt=" " /></button>\r\n                <button class="last" data-binding="{@event-onclick: handlePageLast}{title: @language-page-last}"><img src="Resources/Images/Icons/paging-control-last-44.png" alt=" " /></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- END: Paging Controls -->\r\n</div>',"url:/Mapping/infrastructure/results/ResultsTableView.html":'<div class="results-table-actions-widget" data-binding="{@visible: featureSetCollection}{@widget: ResultsTableActionsWidget}{@widget-context: featureSetCollection}{@widget-required: false}"\r\n     data-menu-id="ResultsTableActions" data-menu-template="Mapping/infrastructure/menus/MenuHyperlinkView.html"></div>\r\n\r\n<div class="results">\r\n\r\n    <!-- BEGIN: No Results -->\r\n    <div class="no-results" data-binding="{@hidden: hasFeatureSets}{@text: searchSuggestion}"></div>\r\n    <!-- END: No Results -->\r\n\r\n    <!-- BEGIN: Scrolling Tab Container Area -->\r\n    <div class="tab-container" data-binding="{@visible: hasFeatureSets}{@var: scrollingTabContainerElement}">\r\n        <table>\r\n            <tr>\r\n                <td class="tab-left-scroll" data-binding="{@visible: tabControlsEnabled}{@class-disabled: leftScrollTabDisabled}{@var: scrollTabLeftElement}">\r\n                    <button data-binding="{@event-onclick: handleTabScrollBack}{title: @language-tab-scroll-prev}">\r\n                        <img src="Resources/Images/Icons/chevron-left-16.png" alt="">\r\n                    </button>\r\n                </td>\r\n                <td data-binding="{@source: featureSetCollection}">\r\n                    <div class="tab-container" data-binding="{@template-for: featureSetCollection}{@var: tabContainerElement}">\r\n                        <ul class="tab-control" data-binding="{@source: featureSets}{@var: tabElements}">\r\n                            <li data-binding="{@template-for: featureSets}">\r\n                                <button class="tab" data-binding="{@class-tab-active: isSelectedInCollection}{@noclass-tab: isSelectedInCollection}{@event-onclick: handleTabClick}">\r\n                                    <strong data-binding="{@text: displayName}{title: displayName}"></strong>\r\n                                </button>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                </td>\r\n                <td class="tab-right-scroll" data-binding="{@visible: tabControlsEnabled}{@class-disabled: rightScrollTabDisabled}{@var: scrollTabRightElement}">\r\n                    <button data-binding="{@event-onclick: handleTabScrollForward}{title: @language-tab-scroll-next}">\r\n                        <img src="Resources/Images/Icons/chevron-right-16.png">\r\n                    </button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <!-- END: Scrolling Tab Container Area -->\r\n\r\n\r\n    <!-- BEGIN: Results Table -->\r\n    <div class="widget" data-binding="{@visible: hasFeatureSets}{@widget: TableViewWidget}{@widget-context: @context}{@widget-required: false}"></div>\r\n    <!-- END: Results Table -->\r\n\r\n    <!-- BEGIN: Paging Controls -->\r\n    <div class="paging-control" data-binding="{@source: presentableResults}">\r\n        <div class="paging-control-inner" data-binding="{@template-for: presentableResults}">\r\n            <div class="paging-result-info">\r\n                <span data-binding="{@hidden: numberOfItems}{@text: @language-common-no-results}"></span>\r\n                <span data-binding="{@visible: numberOfItems}">\r\n                    <span data-binding="{@text: @language-results-displaying}"></span>&nbsp;<span data-binding="{@text: currIndexStartFromOne}"></span>&nbsp;-&nbsp;<span data-binding="{@text: currIndexEnd}"></span>&nbsp;(<span data-binding="{@text: @language-results-total}"></span>:&nbsp;<span data-binding="{@text: numberOfItems}"></span>)\r\n                </span>\r\n            </div>\r\n\r\n            <div class="paging-buttons" data-binding="{@visible: numberOfItems}">\r\n                <button class="first" data-binding="{@event-onclick: handlePageFirst}{title: @language-results-page-first}"><img src="Resources/Images/Icons/paging-control-first-44.png" alt=" "/></button>\r\n                <button class="prev" data-binding="{@event-onclick: handlePagePrev}{title: @language-results-page-prev}"><img src="Resources/Images/Icons/paging-control-previous-44.png" alt=" "/></button>\r\n                <span class="paging-buttons-info" tabindex="0">\r\n                    <span data-binding="{@text: @language-results-page}"></span>&nbsp;<span data-binding="{@text: currPageNumber}"></span>&nbsp;<span data-binding="{@text: @language-results-page-of}"></span>&nbsp;<span data-binding="{@text: lastPageNumber}"></span>\r\n                </span>\r\n                <button class="next" data-binding="{@event-onclick: handlePageNext}{title: @language-results-page-next}"><img src="Resources/Images/Icons/paging-control-next-44.png" alt=" "/></button>\r\n                <button class="last" data-binding="{@event-onclick: handlePageLast}{title: @language-results-page-last}"><img src="Resources/Images/Icons/paging-control-last-44.png" alt=" "/></button>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    <!-- END: Paging Controls -->\r\n</div>',"url:/Mapping/infrastructure/symbology/AttributeSymbologySettingsView.html":'<div class="attribute-symbology-settings" data-binding="{@var: container}">\r\n\r\n    <!-- Attribute selector drop-down. -->\r\n    <div class="symbology-drop-down" data-binding="{@event-onchange: applySettings}{@event-oninput: applySettings}">\r\n        <label class="symbology-label" data-binding="{@text: @language-symbology-settings-pick-attribute}"></label>\r\n        <select data-binding="{@source: attributes}{@var: attributeInput}">\r\n            <option data-binding="{@template-for: attributes}{@text: displayName}{@value name}"></option>\r\n        </select>\r\n    </div>\r\n\r\n    <!-- Class breaks slider. -->\r\n    <div class="symbology-sliders" data-binding="{@visible: isNumericAttribute}">\r\n        <div class="symbology-numberinput">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-breaks}"></label>\r\n            <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: classBreaksInput}"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Group: Class Breaks gradient colors -->\r\n    <div class="symbology-colors"  data-binding="{@visible: isNumericAttribute}">\r\n        <!-- Start Color -->\r\n        <div class="color-picker inline-block">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-startcolor}"></label>\r\n            <div data-binding="{@widget: ColorPickerWidget}{@widget-context: startColor}"></div>\r\n        </div>\r\n        <!-- End Color -->\r\n        <div class="color-picker inline-block">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-endcolor}"></label>\r\n            <div data-binding="{@widget: ColorPickerWidget}{@widget-context: endColor}"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Group: Attribute Renderer Global Controls. -->\r\n    <div class="symbology-sliders" data-binding="{@visible: currentAttribute}">\r\n\r\n        <!-- Transparency slider. -->\r\n        <div class="symbology-numberinput">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-transparency}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: transparencyInput}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-percent-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Marker size slider. -->\r\n        <div class="symbology-numberinput" data-binding="{@hidden: noMarker}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-marker-size}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: markerSizeInput}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-pixel-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Line width slider. -->\r\n        <div class="symbology-numberinput">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-line-width}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: lineWidthInput}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-pixel-suffix}"></span>\r\n            </div>  \r\n        </div>\r\n\r\n        <!-- Marker style drop-down. -->\r\n        <div class="symbology-drop-down" data-binding="{@hidden: noMarker}{@event-onchange: handleMarkerStyle}{@event-oninput: handleMarkerStyle}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-marker-style}"></label>\r\n            <select data-binding="{@source: markerStyles}{@var: markerStyleInput}">\r\n                <option data-binding="{@template-for: markerStyles}{@text: label}"></option>\r\n            </select>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Symbolization Classes -->\r\n    <div class="symbology-classes" data-binding="{@source: symbologyClasses}">\r\n        <div data-binding="{@template-for: symbologyClasses}{@var: symbologyClassContainer}">\r\n            <button class="button symbology-class" data-binding="{@class-selected: selected}{@event-onclick: handleSymbolClassSelected}{title: name}">\r\n                <div class="symbology-text" data-binding="{@text: name}"></div>\r\n                <div class="symbology-color" data-binding="{@style-background-color: displayColor}{@hidden: isImage}"></div>\r\n                <img class="symbology-image" data-binding="{@visible: isImage}{src: imageSrc}"></img>\r\n            </button>\r\n            <!-- Simple symbology settings widget will be attached here -->\r\n            <div data-binding="{@visible: selected}{id: widgetId}"></div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n',
"url:/Mapping/infrastructure/symbology/SymbologySettingsView.html":'<div class="symbology-settings panel-group-contents" data-binding="{@var: container}">\r\n\r\n    <!-- Symbology type selector -->\r\n    <div class="symbology-settings-selector form-item" data-binding="{@visible: showSymbologySelectorMenu}">\r\n        <label class="symbology-label" data-binding="{@text: @language-symbology-settings-select}"></label>\r\n        <select data-binding="{@source: symbologyWidgets}{@value: currentWidget}">\r\n            <option data-binding="{@template-for: symbologyWidgets}{@text: displayName}{@attach: @context}"></option>\r\n        </select>\r\n    </div>\r\n\r\n    <!-- Symbology settings widget. -->\r\n    <div data-binding="{@hidden: symbolizeWithImagery}">\r\n        <div data-binding="{@widget: SimpleSymbolWidget}{@widget-replace: true}"></div>\r\n    </div>\r\n\r\n    <!-- Image symbology widget. -->\r\n    <div data-binding="{@visible: symbolizeWithImagery}">\r\n        <div data-binding="{@widget: CustomizedPictureSymbolWidget}{@widget-replace: true}"></div>\r\n    </div>\r\n\r\n</div>\r\n',"url:/Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html":'<div class="style-selector markup image" data-binding="{@hidden: noLibraries}">\r\n\r\n    <div data-binding="{@source: currentImage}">\r\n        <span class="symbol-name" data-binding="{@template-for: currentImage}{@text: name}"></span>\r\n    </div>\r\n\r\n    <!-- Image Container -->\r\n    <div class="swatch-container image-container" data-binding="{@source: currentImages}">\r\n        <button class="markup-swatch markup-swatch-image" data-binding="{@template-for: currentImages}{@class-selected: selected}{id: id}{@event-onclick: handleClickSwatch}">\r\n            <span class="symbol-button-label" data-binding="{@text: name}"></span>\r\n            <img class="markup-swatch-image" data-binding="{src: url}" />\r\n        </button>\r\n    </div>\r\n\r\n    <!-- Library Switcher -->\r\n    <span class="image-library-selector form-item inline-block" data-binding="{@visible: showLibrarySwitcher}">\r\n        <label class="symbology-label" data-binding="{@text: @language-common-library}"></label>\r\n        <select data-binding="{@source: imageLibraries}{@value: currentLibrary}">\r\n            <option data-binding="{@template-for: imageLibraries}{@text: @context}{@attach: @context}"></option>\r\n        </select>\r\n    </span>\r\n\r\n    <div class="symbology-sliders">\r\n\r\n        <!-- Size Slider -->\r\n        <div class="symbology-numberinput">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-image-size}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: imageSizeViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-pixel-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Rotation Slider -->\r\n        <div class="symbology-numberinput">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-angle}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: imageRotationViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-degree-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</div>\r\n<div class="no-symbol-library" data-binding="{@visible: noLibraries}">\r\n    <span data-binding="{@text:  @language-symbology-settings-no-image-libraries}" />\r\n</div>',"url:/Mapping/infrastructure/symbology/widgets/SimpleSymbolWidget.html":'<div class="symbology-settings" data-binding="{@var: container}">\r\n\r\n    <!-- Group: Colors. -->\r\n    <div class="symbology-colors inline-block">\r\n\r\n        <!-- Fill color input -->\r\n        <div class="color-picker inline-block">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-color}"></label>\r\n            <div data-binding="{@widget: ColorPickerWidget}{@widget-context: fill}"></div>\r\n        </div>\r\n        <!-- Outline color input -->\r\n        <div class="inline-block" data-binding="{@hidden: noOutlineSymbol}">\r\n            <div class="color-picker inline-block" data-binding="{@visible: showOutlineColor}">\r\n                <label class="symbology-label" data-binding="{@text: @language-symbology-settings-outline}"></label>\r\n                <div data-binding="{@widget: ColorPickerWidget}{@widget-context: outline}"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Group: Sliders. -->\r\n    <div class="symbology-sliders">\r\n\r\n        <div class="symbology-numberinput" data-binding="{@visible: isPoint}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-marker-size}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: markerSizeViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-pixel-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="symbology-numberinput">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-line-width}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: lineWidthViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-pixel-suffix}"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Group: Drop-downs. -->\r\n    <div class="symbology-drop-downs">\r\n\r\n        <!-- Marker style drop-down. -->\r\n        <div class="symbology-drop-down" data-binding="{@visible: isPoint}{@event-onchange: handleMarkerStyle}{@event-oninput: handleMarkerStyle}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-marker-style}"></label>\r\n            <select data-binding="{@source: markerStyles}{@var: markerStyleInput}">\r\n                <option data-binding="{@template-for: markerStyles}{@text: label}"></option>\r\n            </select>\r\n        </div>\r\n\r\n        <!-- Line style drop-down. -->\r\n        <div class="symbology-drop-down" data-binding="{@visible: showLineStyles}{@event-onchange: handleLineStyle}{@event-oninput: handleLineStyle}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-line-style}"></label>\r\n            <select data-binding="{@source: lineStyles}{@var: lineStyleInput}">\r\n                <option data-binding="{@template-for: lineStyles}{@text: label}"></option>\r\n            </select>\r\n        </div>\r\n\r\n        <!-- Fill style drop-down. -->\r\n        <div class="symbology-drop-down" data-binding="{@visible: isPolygon}{@event-onchange: handleFillStyle}{@event-oninput: handleFillStyle}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-fill-style}"></label>\r\n            <select data-binding="{@source: fillStyles}{@var: fillStyleInput}">\r\n                <option data-binding="{@template-for: fillStyles}{@text: label}"></option>\r\n            </select>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html":'<div class="symbology-settings text-symbology-settings">\r\n\r\n    <!-- Symbol Text -->\r\n    <div class="symbology-textinput" data-binding="{@visible: showText}">\r\n        <div class="form-item">\r\n            <label class="symbology-label" data-binding="{@text: @language-common-text}"></label>\r\n            <input type="text" data-binding="{@value: symbolText}" />\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Group: Colors. -->\r\n    <div class="symbology-colors inline-block">\r\n\r\n        <!-- Font color input -->\r\n        <div class="color-picker inline-block" data-binding="{@visible: showFontColor}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-color}"></label>\r\n            <div data-binding="{@widget: ColorPickerWidget}{@widget-context: fontColor}"></div>\r\n        </div>\r\n\r\n        <!-- Halo color input -->\r\n        <div class="color-picker inline-block" data-binding="{@visible: showHaloColor}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-halo}"></label>\r\n            <div data-binding="{@widget: ColorPickerWidget}{@widget-context: fontHalo}"></div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <!--Font Family-->\r\n    <div class="symbology-drop-downs">\r\n        <div class="symbology-drop-down" data-binding="{@visible: showFontFamilies}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-font-family}"></label>\r\n            <div class="symbology-form-control">\r\n                <select data-binding="{@source: fontFamilies}{@var: fontFamilyInput}{@value: fontFamily}">\r\n                    <option data-binding="{@template-for: fontFamilies}{@text: @context}"></option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!--Font Style-->\r\n    <div class="symbology-form-control inline-block" data-binding="{@enabled: showLabels}{@visible: showFontStyle}">\r\n        <label class="symbology-checkbox">\r\n            <input type="checkbox" data-binding="{@value: fontIsBold}">\r\n            <span data-binding="{@text: @language-symbology-settings-bold}"></span>\r\n        </label>\r\n        <label class="symbology-checkbox">\r\n            <input type="checkbox" data-binding="{@value: fontIsItalic}">\r\n            <span data-binding="{@text: @language-symbology-settings-italic}"></span>\r\n        </label>\r\n        <label class="symbology-checkbox">\r\n            <input type="checkbox" data-binding="{@value: fontIsUnderline}">\r\n            <span data-binding="{@text: @language-symbology-settings-underline}"></span>\r\n        </label>\r\n    </div>\r\n\r\n    <!--Font Size-->\r\n    <div class="symbology-sliders">\r\n\r\n        <div class="symbology-numberinput" data-binding="{@visible: showFontSize}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-font-size}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: fontSizeViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-point-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="symbology-numberinput" data-binding="{@visible: showHaloSize}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-halo-size}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: haloSizeViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-pixel-suffix}"></span>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="symbology-numberinput" data-binding="{@visible: showTextAngle}">\r\n            <label class="symbology-label" data-binding="{@text: @language-symbology-settings-angle}"></label>\r\n            <div class="numeric-input-wrapper">\r\n                <div class="numeric-input" data-binding="{@widget: NumericInputWidget}{@widget-context: textAngleViewModel}"></div>\r\n                <span class="numeric-units" data-binding="{@text: @language-symbology-settings-degree-suffix}"></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/ui/components/ColorPicker/ColorPickerWidget.html":'<input type="color" value="#0000ff" data-binding="{@var: colorInput}"/>',"url:/Mapping/infrastructure/ui/components/FilterControl/FilterControlView.html":'<div class="filter-control">\r\n    <div class="filter-control-search">\r\n        <input class="search-field" type="text" data-binding="{@value: filterText}{placeholder: filterInputPlaceholder}" />\r\n        <div class="status-img" alt=" " aria-hidden="true" data-binding="{@visible: showBusyIcon}"></div>\r\n        <button class="clear-button" data-binding="{@event-onclick: handleFilterTextClear}"></button>\r\n        <button class="filter-button" data-binding="{@event-onclick: handleFilterButtonClick}{@text: filterButtonText}"></button>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/AutoCompleteBoxFormItemView.html":'<div class="autocomplete-inner">              \r\n    \r\n    <label data-binding="{for: attached_controlId}" class=" form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n\r\n    <div class="form-control">\r\n\r\n        <!-- Textbox -->\r\n        <div class="autocomplete-input">\r\n            <div class="loader" data-binding="{@visible: isBusy}"></div>\r\n            <input type="text" data-binding="{@var: textElement}{@event-onkeyup: handleKeyEvent}{@event-onblur: handleInputBlurEvent}{@event-onclick: handleInputClickEvent}{@event-onfocus: handleInputFocusEvent}{@value: text}{@style-width: textboxWidth}{title: toolTip}{id: attached_controlId}{data-gcx-form-item: itemID}" />\r\n        </div>\r\n\r\n        <!-- Dropdown -->\r\n        <div class="autocomplete-menu" data-binding="{@var: dropDownContainerElement}{@visible: isDropDownOpen}{@style-minWidth: textboxWidth}{@event-onkeydown: handleDropdownKeyDown}{@event-onmousedown: handleDropdownFocusEvent}{@event-onfocus: handleDropdownFocusEvent}{@event-onblur: handleDropdownBlurEvent}">\r\n            <ul class="list-menu" data-binding="{@var: dropDownListElement}{@visible: dataItems}{@source: dataItems}">\r\n                <li class="list-menu-item" data-binding="{@template-for: dataItems}{@text: value}{@event-onclick: handleClickItem}"></li>\r\n            </ul>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/CheckBoxFormItemView.html":'<div class="checkbox-inner">\r\n    <table>\r\n        <tr>\r\n            <td class="form-label left" data-binding="{@visible: attached_textOnLeft}">\r\n                <label data-binding="{for: attached_controlId}{@text: attached_labelText}{title: toolTip}"></label>\r\n            </td>\r\n            <td>\r\n                <input type="checkbox" data-binding="{@value: checked}{id: attached_controlId}{title: toolTip}{data-gcx-form-item: itemID}" />\r\n            </td>\r\n            <td class="form-label left" data-binding="{@hidden: attached_textOnLeft}">\r\n                <label data-binding="{for: attached_controlId}{@text: attached_labelText}{title: toolTip}"></label>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/ComboBoxFormItemView.html":'<div class="inner">\r\n    <label data-binding="{for: attached_controlId}" class=" form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n    <div class="form-control">\r\n        <div class="loader" data-binding="{@visible: isBusy}"></div>\r\n        <select data-binding="{id: attached_controlId}{@source: dataItems}{@value: selected}{@event-onchange: handleSelectionChanged}{disabled: isBusy}{title: toolTip}{data-gcx-form-item: itemID}">\r\n            <option data-binding="{@template-for: dataItems}{@text: display}{@attach: @context}"></option>\r\n        </select>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/ContainerFormItemView.html":'<div class="form-container" data-binding="{@visible: isVisible}{@class-form-horizontal: attached_isHorizontal}{data-gcx-form-item: itemID}">\r\n    <p class="form-item form-desc" data-binding="{@visible: description}{innerHTML: description}"></p>\r\n    <div class="form label-left" data-binding="{style: attached_style}{@style-maxWidth: maxWidth}{@source: formItems}{@template: Mapping/infrastructure/ui/components/Forms/FormItemView.html}"></div><!-- here -->\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/DatePickerFormItemView.html":'<div class="inner">\r\n\r\n    <label data-binding="{for: attached_controlId}" class=" form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n\r\n    <div class="form-control" data-binding="{data-gcx-form-item: itemID}">\r\n        <!-- The view codebehind will calculate a picker type to use. -->\r\n        <div class="inline-block" data-binding="{@source: @context}{@template-selector: attached_pickerType}">\r\n\r\n            <!-- Ideal! Date and time pickers supported natively in the browser. -->\r\n            <input class="date-time" data-binding="{id: attached_controlId}{@var: native_datetime_element}{@template-select: native_datetime}{title: toolTip}{@value: date}" type="datetime" />\r\n\r\n            <!-- No date picker supported. Use jQuery if not on a touch device. -->\r\n            <div class="date-picker-container" data-binding="{@template-select: jQuery}">\r\n                <input data-binding="{id: attached_controlId}{@var: jQueryFormattedInput}{title: toolTip}{@event-onchange: handleJqueryDatePickerTextChanged}" type="text" class="hasDatepicker gcxDatepicker"/>\r\n                <input data-binding="{id: attached_controlId}{@var: jQueryPicker}" type="hidden" />\r\n                <button class="ui-datepicker-trigger" data-binding="{@event-onclick: handleJqueryDatePickerInitializeClick}{aria-label: @language-accessibility-datepicker-trigger-button-aria-label}">...</button>\r\n            </div>\r\n\r\n            <!-- Native date picker supported and no time picker needed. -->\r\n            <input data-binding="{id: attached_controlId}{@var: native_datetime_element}{@template-select: native}{title: toolTip}{@value: date}" type="date" />\r\n\r\n            <!-- Native date picker supported, but need jQuery for time picker. Non-touch device -->\r\n            <div class="date-picker-container" data-binding="{@template-select: native_date_jQuery_time}{title: toolTip}">\r\n                <input data-binding="{id: attached_controlId}{@value: date}" type="date" />\r\n                <input data-binding="{id: attached_controlId}{@var: jQueryFormattedInput}{title: toolTip}{@event-onchange: handleJqueryTimePickerTextChanged}" type="text" class="hasDatepicker gcxDatepicker"/>\r\n                <input data-binding="{id: attached_controlId}{@var: jQueryPicker}" type="hidden" />\r\n                <button class="ui-datepicker-trigger" data-binding="{@event-onclick: handleJqueryDatePickerInitializeClick}{aria-label: @language-accessibility-datepicker-trigger-button-aria-label}">...</button>\r\n            </div>\r\n\r\n            <!-- Native date picker supported, but need a time picker and we\'re on a touch device. -->\r\n            <div class="datetime-select datetime-picker" data-binding="{@template-select: native_date_combo_time}{title: toolTip}">\r\n                <span class="native-date-picker">\r\n                    <input data-binding="{id: attached_controlId}{@var: native_datetime_element}{@value: date}" type="date" />\r\n                </span>\r\n                <span class="time-selectors">\r\n                    <label class="time-select">\r\n                        <span class="time-select-label" data-binding="{@text: @language-hours-abbr}"></span>\r\n                        <select data-binding="{id: attached_controlId}{@source: attached_hours}{@value: attached_hour}{@event-onchange: handleChangeComboBoxTimeWithNativeDate}{@var: select0}">\r\n                            <option data-binding="{@template-for: attached_hours}{@attached-value: val}{@text: desc}"></option>\r\n                        </select>\r\n                    </label>\r\n                    <label class="time-select">\r\n                        <span class="time-select-label" data-binding="{@text: @language-minutes-abbr}"></span>\r\n                        <select data-binding="{id: attached_controlId}{@source: attached_minutes}{@value: attached_minute}{@event-onchange: handleChangeComboBoxTimeWithNativeDate}{@var: select1}">\r\n                            <option data-binding="{@template-for: attached_minutes}{@text: @context}{@attached-value: @context}"></option>\r\n                        </select>\r\n                    </label>\r\n                    <label class="time-select">\r\n                        <span class="time-select-label" data-binding="{@text: @language-seconds-abbr}"></span>\r\n                        <select data-binding="{id: attached_controlId}{@source: attached_seconds}{@value: attached_second}{@event-onchange: handleChangeComboBoxTimeWithNativeDate}{@var: select2}">\r\n                            <option data-binding="{@template-for: attached_seconds}{@text: @context}{@attached-value: @context}"></option>\r\n                        </select>\r\n                    </label>\r\n                </span>\r\n            </div>\r\n            \r\n            <!-- Touch device, no date/time pickers supported natively. Need combo box date picker. -->\r\n            <div class="datetime-select" data-binding="{@template-select: combos}{title: toolTip}">\r\n                <select class="dp-yy" data-binding="{id: attached_controlId}{@source: attached_years}{@value: attached_year}{@event-onchange: handleChangeComboBoxTime}{@var: select3}">\r\n                    <option data-binding="{@template-for: attached_years}{@text: @context}{@attached-value: @context}"></option>\r\n                </select>\r\n                <select class="dp-mm" data-binding="{@value: attached_month}{@event-onchange: handleChangeComboBoxTime}{@var: select4}">\r\n                    <option value="0" data-binding="{@text: @language-months-0}"></option>\r\n                    <option value="1" data-binding="{@text: @language-months-1}"></option>\r\n                    <option value="2" data-binding="{@text: @language-months-2}"></option>\r\n                    <option value="3" data-binding="{@text: @language-months-3}"></option>\r\n                    <option value="4" data-binding="{@text: @language-months-4}"></option>\r\n                    <option value="5" data-binding="{@text: @language-months-5}"></option>\r\n                    <option value="6" data-binding="{@text: @language-months-6}"></option>\r\n                    <option value="7" data-binding="{@text: @language-months-7}"></option>\r\n                    <option value="8" data-binding="{@text: @language-months-8}"></option>\r\n                    <option value="9" data-binding="{@text: @language-months-9}"></option>\r\n                    <option value="10" data-binding="{@text: @language-months-10}"></option>\r\n                    <option value="11" data-binding="{@text: @language-months-11}"></option>\r\n                </select>\r\n                <select class="dp-dd" data-binding="{@source: attached_days}{@value: attached_day}{@event-onchange: handleChangeComboBoxTime}{@var: select5}">\r\n                    <option data-binding="{@template-for: attached_days}{@text: @context}{@attached-value: @context}"></option>\r\n                </select>\r\n            </div>\r\n\r\n            <!-- Need date and time picker using comboboxes. -->\r\n            <div class="dp-tp-select" data-binding="{@template-select: combos_datetime}{title: toolTip}">\r\n                <div class="datetime-select">\r\n                    <select class="year-select" data-binding="{id: attached_controlId}{@source: attached_years}{@value: attached_year}{@event-onchange: handleChangeComboBoxTime}{@var: select6}">\r\n                        <option data-binding="{@template-for: attached_years}{@text: @context}{@attached-value: @context}"></option>\r\n                    </select>\r\n                    <select class="month-select" data-binding="{id: attached_controlId}{@value: attached_month}{@event-onchange: handleChangeComboBoxTime}{@var: select7}">\r\n                        <option value="0" data-binding="{@text: @language-months-0}"></option>\r\n                        <option value="1" data-binding="{@text: @language-months-1}"></option>\r\n                        <option value="2" data-binding="{@text: @language-months-2}"></option>\r\n                        <option value="3" data-binding="{@text: @language-months-3}"></option>\r\n                        <option value="4" data-binding="{@text: @language-months-4}"></option>\r\n                        <option value="5" data-binding="{@text: @language-months-5}"></option>\r\n                        <option value="6" data-binding="{@text: @language-months-6}"></option>\r\n                        <option value="7" data-binding="{@text: @language-months-7}"></option>\r\n                        <option value="8" data-binding="{@text: @language-months-8}"></option>\r\n                        <option value="9" data-binding="{@text: @language-months-9}"></option>\r\n                        <option value="10" data-binding="{@text: @language-months-10}"></option>\r\n                        <option value="11" data-binding="{@text: @language-months-11}"></option>\r\n                    </select>\r\n                    <select class="day-select" data-binding="{@source: attached_days}{@value: attached_day}{@event-onchange: handleChangeComboBoxTime}{@var: select8}">\r\n                        <option data-binding="{@template-for: attached_days}{@text: @context}{@attached-value: @context}"></option>\r\n                    </select>\r\n                </div>\r\n                <div class="datetime-select time">\r\n                    <label class="time-select">\r\n                        <span class="time-select-label" data-binding="{@text: @language-hours-abbr}"></span>\r\n                        <select data-binding="{id: attached_controlId}{@source: attached_hours}{@value: attached_hour}{@event-onchange: handleChangeComboBoxTime}{@var: select9}">\r\n                            <option data-binding="{@template-for: attached_hours}{@attached-value: val}{@text: desc}"></option>\r\n                        </select>\r\n                    </label>\r\n                    <label class="time-select">\r\n                        <span class="time-select-label" data-binding="{@text: @language-minutes-abbr}"></span>\r\n                        <select data-binding="{@source: attached_minutes}{@value: attached_minute}{@event-onchange: handleChangeComboBoxTime}{@var: select10}">\r\n                            <option data-binding="{@template-for: attached_minutes}{@text: @context}{@attached-value: @context}"></option>\r\n                        </select>\r\n                    </label>\r\n                    <label class="time-select">\r\n                        <span class="time-select-label" data-binding="{@text: @language-seconds-abbr}"></span>\r\n                        <select data-binding="{@source: attached_seconds}{@value: attached_second}{@event-onchange: handleChangeComboBoxTime}{@var: select11}">\r\n                            <option data-binding="{@template-for: attached_seconds}{@text: @context}{@attached-value: @context}"></option>\r\n                        </select>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \r\n        <div class="inline-block" data-binding="{@visible: nullable}">\r\n            <button class="datetime-btn un-nullify" data-binding="{@visible: attached_isNull}{@event-onclick: handleClickSetNotNull}"></button>\r\n            <button class="datetime-btn nullify" data-binding="{@hidden: attached_isNull}{@event-onclick: handleClickSetNull}"></button>\r\n        </div>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/FilePickerFormItemView.html":'<div class="inner">\r\n    <label data-binding="{for: attached_controlId}" class="form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n    <div class="form-control">\r\n        <div data-binding="{@visible: isSupported}">\r\n            <div class="file-input">\r\n                <div class="file-input-browser">\r\n                    <input type="file" data-binding="{id: attached_controlId}{@visible: isSupported}{title: toolTip}{multiple: allowMultiple}{accept: acceptFileTypes}{@event-change: handleChange}{data-gcx-form-item: itemID}" />\r\n                </div>\r\n            </div>\r\n            <input class="file-input-clear" type="button" value="X" data-binding="{@visible: files}{@event-onclick: handleClearClick}" />\r\n        </div>\r\n        <span data-binding="{@hidden: isSupported}{@text: @language-file-picker-not-supported}"></span>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/FormItemView.html":'<div class="form-item" data-binding="{@visible: isVisible}{className: attached_indicatorClass}{@source: @context}{@template-selector: formItemType}">\r\n    <div class="autocomplete" data-binding="{@template-select: AutoCompleteBoxFormItem}{@widget: AutoCompleteBoxFormItem}{@visible: isVisible}"></div>\r\n    <div class="checkbox" data-binding="{@template-select: CheckBoxFormItem}{@widget: CheckBoxFormItem}{@visible: isVisible}"></div>\r\n    <div class="combobox" data-binding="{@template-select: ComboBoxFormItem}{@widget: ComboBoxFormItem}{@visible: isVisible}"></div>\r\n    <div class="container" data-binding="{@template-select: ContainerFormItem}{@widget: ContainerFormItem}{@visible: isVisible}"></div>\r\n    <div class="datepicker" data-binding="{@template-select: DatePickerFormItem}{@widget: DatePickerFormItem}{@visible: isVisible}"></div>\r\n    <div class="filepicker" data-binding="{@template-select: FilePickerFormItem}{@widget: FilePickerFormItem}{@visible: isVisible}"></div>\r\n    <div class="groupbox" data-binding="{@template-select: GroupBoxFormItem}{@widget: GroupBoxFormItem}{@visible: isVisible}"></div>\r\n    <div class="link" data-binding="{@template-select: HyperlinkFormItem}{@widget: HyperlinkFormItem}{@visible: isVisible}"></div>\r\n    <div class="image" data-binding="{@template-select: ImageFormItem}{@widget: ImageFormItem}{@visible: isVisible}"></div>\r\n    <div class="label" data-binding="{@template-select: LabelFormItem}{@widget: LabelFormItem}{@visible: isVisible}"></div>\r\n    <div class="listbox" data-binding="{@template-select: ListBoxFormItem}{@widget: ListBoxFormItem}{@visible: isVisible}"></div>\r\n    <div class="markdown" data-binding="{@template-select: MarkdownFormItem}{@widget: MarkdownFormItem}{@visible: isVisible}"></div>\r\n    <div class="radiobtn" data-binding="{@template-select: RadioButtonFormItem}{@widget: RadioButtonFormItem}{@visible: isVisible}"></div>\r\n    <div class="textarea" data-binding="{@template-select: TextAreaFormItem}{@widget: TextAreaFormItem}{@visible: isVisible}"></div>\r\n    <div class="textbox" data-binding="{@template-select: TextBoxFormItem}{@widget: TextBoxFormItem}{@visible: isVisible}"></div>\r\n    <div class="textarea" data-binding="{@template-select: TimePickerFormItem}{@widget: TimePickerFormItem}{@visible: isVisible}"></div>\r\n</div>',
"url:/Mapping/infrastructure/ui/components/Forms/GroupBoxFormItemView.html":'<fieldset data-binding="{data-gcx-form-item: itemID}">\r\n    <legend data-binding="{@text: header}"></legend>\r\n\r\n    <p class="form-item form-desc" data-binding="{@visible: description}{innerHTML: description}"></p>\r\n\r\n    <!-- Dynamically bound table of elements -->\r\n    <div class="form label-left" data-binding="{style: attached_style}{@class-form-horizontal: attached_isHorizontal}{@source: formItems}{@template: Mapping/infrastructure/ui/components/Forms/FormItemView.html}"></div>\r\n\r\n</fieldset>',"url:/Mapping/infrastructure/ui/components/Forms/HyperlinkFormItemView.html":'<div class="hyperlink">\r\n    <a data-binding="{@event-onclick: handleClick}{href: uri}{@text: hyperlinkText}{target:target}{title: toolTip}{data-gcx-form-item: itemID}"></a>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/ImageFormItemView.html":'<div class="inner">\r\n    <img data-binding="{src: source}{@style-width: width}{@style-height: height}{alt: toolTip}{data-gcx-form-item: itemID}" />\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/ListBoxFormItemView.html":'<div class="inner">\r\n    <label data-binding="{for: attached_controlId}" class="form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n    <div class="form-control">\r\n        <div class="loader" data-binding="{@visible: isBusy}"></div>\r\n        <select data-binding="{id: attached_controlId}{@source: dataItems}{@var: selectElement}{multiple: attached_isMultiple}{@value: selection}{@event-onchange: handleSelectionChanged}{title: toolTip}{disabled: isBusy}{size: size}{data-gcx-form-item: itemID}">\r\n            <option data-binding="{@template-for: dataItems}{@text: display}{@attach: @context}"></option>\r\n        </select>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/MarkdownFormItemView.html":'<div class="inner" data-binding="{@var: markdownElement}{data-gcx-form-item: itemID}"></div>',"url:/Mapping/infrastructure/ui/components/Forms/RadioButtonFormItemView.html":'<div class="radiobtn-inner">\r\n    <table>\r\n        <tr>\r\n            <td class="form-label left" data-binding="{@visible: attached_textOnLeft}">\r\n                <label data-binding="{for: attached_controlId}{@text: attached_labelText}{title: toolTip}"></label>\r\n            </td>\r\n            <td>\r\n                <input type="radio" data-binding="{@var: radioElement}{id: attached_controlId}{name: groupName}{title: toolTip}{data-gcx-form-item: itemID}" />\r\n            </td>\r\n            <td class="form-label right" data-binding="{@hidden: attached_textOnLeft}">\r\n                <label data-binding="{for: attached_controlId}{@text: attached_labelText}{title: toolTip}"></label>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/TextAreaFormItemView.html":'<div class="inner">\r\n    <label data-binding="{for: attached_controlId}" class="form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n    <div class="form-control">\r\n        <textarea data-binding="{id: attached_controlId}{@value: text}{@style-width: textboxWidth}{@style-height: textboxHeight}{title: toolTip}{@event-onblur: handleBlurControl}{readonly: readOnly}{data-gcx-form-item: itemID}"></textarea>\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/TextBoxFormItemView.html":'<div class="inner">\r\n    <label data-binding="{for: attached_controlId}" class="form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n    <div class="form-control">\r\n        <input data-binding="{id: attached_controlId}{type: attached_type}{@value: text}{@style-width: textboxWidth}{title: toolTip}{readonly: readOnly}{data-gcx-form-item: itemID}" />\r\n    </div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/Forms/TimePickerFormItemView.html":'<div class="form-item time-picker">\r\n    <label data-binding="{for: attached_controlId}" class="form-label">\r\n        <span data-binding="{@source: label}{@visible: label}">\r\n            <span data-binding="{@template-for: label}{@text: text}"></span>\r\n        </span>\r\n        <span class="indicator" data-binding="{@visible: attached_showIndicator}">*</span>\r\n    </label>\r\n\r\n    <div class="datetime-select inline-block" data-binding="{title: toolTip}{@var: selectContainerElement}{data-gcx-form-item: itemID}">\r\n        <div>\r\n            <select data-binding="{id: attached_controlId}{@source: attached_hours}{@value: attached_hour}{@event-onchange: handleChangeComboBoxTime}">\r\n                <option data-binding="{@template-for: attached_hours}{@attached-value: val}{@text: desc}"></option>\r\n            </select>\r\n            <select data-binding="{@source: attached_minutes}{@value: attached_minute}{@event-onchange: handleChangeComboBoxTime}">\r\n                <option data-binding="{@template-for: attached_minutes}{@text: @context}{@attached-value: @context}"></option>\r\n            </select>\r\n            <select data-binding="{@source: attached_seconds}{@value: attached_second}{@event-onchange: handleChangeComboBoxTime}">\r\n                <option data-binding="{@template-for: attached_seconds}{@text: @context}{@attached-value: @context}"></option>\r\n            </select>\r\n        </div>\r\n        <div class="inline-block" data-binding="{@visible: nullable}">\r\n            <button class="datetime-btn un-nullify" data-binding="{@visible: attached_timeIsNull}{@event-onclick: handleClickSetNotNull}"></button>\r\n            <button class="datetime-btn nullify" data-binding="{@hidden: attached_timeIsNull}{@event-onclick: handleClickSetNull}"></button>\r\n        </div>\r\n    </div>\r\n    <div class="clear"></div>\r\n</div>',"url:/Mapping/infrastructure/ui/components/NumericInput/NumericInputWidget.html":'<span data-binding="{@source: range}{@visible: showSlider}" class="gcx-slider-width">\r\n    <input type="number" data-binding="{@template-for: range}{@var: numericInput}{min: min}{max: max}{value: value}{step: step}" />\r\n</span>\r\n<span class="inline-block" data-binding="{@source: range}">\r\n    <input type="number" data-binding="{@template-for: range}{@var: nativeInput}{min: min}{max: max}{@value: value}{step: step}{@event-onchange: validateInput}" />\r\n</span>\r\n',"url:/Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html":'<div class="paging-control" data-binding="{@source: presentableResults}">\r\n    <div class="paging-control-inner" data-binding="{@template-for: presentableResults}">\r\n        <div class="paging-result-info">\r\n            <span data-binding="{@hidden: numberOfItems}{@text: @language-common-no-results}"></span>\r\n            <span data-binding="{@visible: numberOfItems}">\r\n                <span data-binding="{@text: @language-page-displaying}"></span>&nbsp;<span data-binding="{@text: currIndexStartFromOne}"></span>&nbsp;-&nbsp;<span data-binding="{@text: currIndexEnd}"></span>&nbsp;(<span data-binding="{@text: @language-page-total}"></span>:&nbsp;<span data-binding="{@text: numberOfItems}"></span>)\r\n            </span>\r\n        </div>\r\n\r\n        <div class="paging-buttons" data-binding="{@visible: numberOfItems}">\r\n            <button class="first" data-binding="{@event-onclick: handlePageFirst}{title: @language-page-first}"><img src="Resources/Images/Icons/paging-control-first-44.png" alt=" " /></button>\r\n            <button class="prev" data-binding="{@event-onclick: handlePagePrev}{title: @language-page-prev}"><img src="Resources/Images/Icons/paging-control-previous-44.png" alt=" " /></button>\r\n            <span class="paging-buttons-info" tabindex="0">\r\n                <span data-binding="{@text: @language-page-page}"></span>&nbsp;<span data-binding="{@text: currPageNumber}"></span>&nbsp;<span data-binding="{@text: @language-page-of}"></span>&nbsp;<span data-binding="{@text: lastPageNumber}"></span>\r\n            </span>\r\n            <button class="next" data-binding="{@event-onclick: handlePageNext}{title: @language-page-next}"><img src="Resources/Images/Icons/paging-control-next-44.png" alt=" " /></button>\r\n            <button class="last" data-binding="{@event-onclick: handlePageLast}{title: @language-page-last}"><img src="Resources/Images/Icons/paging-control-last-44.png" alt=" " /></button>\r\n        </div>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/ui/components/Slider/SliderView.html":'<div class="gcx-slider-container">\r\n    <div class="gcx-slider-current-label-container">\r\n        <div class="gcx-slider-label gcx-slider-label-current-min" data-binding="{@visible: sliderMinHandleLabel}{@var: sliderMinLabelElement}{@text: sliderMinHandleLabel}"></div>\r\n        <div class="gcx-slider-label gcx-slider-label-current-max" data-binding="{@visible: sliderMaxHandleLabel}{@var: sliderMaxLabelElement}{@text: sliderMaxHandleLabel}"></div>\r\n    </div>\r\n    <div class="gcx-slider-range-container">\r\n        <div class="gcx-slider-ticks" data-binding="{@source: sliderTicks}">\r\n            <div class="gcx-tick" data-binding="{@template-for: sliderTicks}{@style-left: position}"></div>\r\n        </div>\r\n        <div class="gcx-slider" data-binding="{@var: sliderElement}"></div>\r\n    </div>\r\n    <div class="gcx-slider-label-container">\r\n        <span class="gcx-slider-label gcx-slider-label-min" data-binding="{@text: sliderMinLabel}"></span>\r\n        <span class="gcx-slider-label gcx-slider-label-max" data-binding="{@text: sliderMaxLabel}"></span>\r\n    </div>\r\n</div>\r\n',"url:/Mapping/infrastructure/ui/components/SmartPanel/SmartPanelView.html":'<div class="view-container-view smart-panel" data-binding="{@var: containerElement}">\r\n    <!-- BEGIN: Header -->\r\n    <button class="bottom-panel-resize resize-handle" tabindex="-1" data-binding="{@visible: resizeY}{@event-mousedown: handleHeaderMouseDown}{@event-touchstart: handleHeaderTouchStart}{title: @language-smart-panel-resize}">\r\n        <span class="icon-drag"></span>\r\n    </button>\r\n    <div class="panel-header banner-noselect"  data-binding="{@visible: headerIsVisible}{@var: headerElement}{@event-mousedown: handleHeaderMouseDown}\r\n                                                                {@event-touchstart: handleHeaderTouchStart}{@class-resize-horizontal-hint: resizeX}\r\n                                                                {@class-resize-vertical-hint: resizeY}">\r\n        <div class="panel-header-contents" data-binding="{@visible: titleBarIsVisible}">\r\n            <button class="panel-header-button right close-16" data-binding="{@visible: showingXButton}{@event-onclick: handleClickClose}{title: @language-smart-panel-close}"></button>\r\n            <button class="panel-header-button right" data-binding="{@visible: showingMaximizeButton}{@class-minimize-16: panelMaximized}{@noclass-maximize-16: panelMaximized}{@event-onclick: handleMaximizeToggleClick}{title: @language-smart-panel-maximize-restore}"></button>\r\n            <button class="panel-header-button menu-button" data-binding="{@enabled: hasExecutableMenuItems}{@visible: hasHoistedMenu}{@event-onclick: handleTapMenuButton}{@var: menuButtonElement}{title: @language-smart-panel-menu}"></button>\r\n            <button class="panel-header-button left back-16" data-binding="{@visible: showingBackButton}{@event-click: handleClickBack}{title: @language-smart-panel-back}"></button>\r\n\r\n            <h2 class="panel-title banner-noselect">\r\n                <img src="Resources/Images/loader-small.gif" data-binding="{@visible: showBusyIndicator}" alt=" " />\r\n                <span class="panel-title-contents" data-binding="{@text: containerTitle}{@visible: containerTitle}"></span>\r\n                <span class="panel-title-contents" data-binding="{@visible: containerTitle}">&nbsp;-&nbsp;</span>\r\n                <span class="panel-title-contents" data-binding="{@text: viewTitle}{@visible: viewTitle}{title: viewTitle}"></span>\r\n            </h2>\r\n        </div>\r\n\r\n        <div class="smart-panel-hoisted-menu-inline" data-binding="{@visible: inlineMenuIsOpen}{@widget: SmartPanelHoistedMenu}{@widget-required: false}{@widget-context: hoistedMenuViewModel}"></div>\r\n\r\n        <div data-binding="{@dom: headerInsertDomElement}"></div>\r\n    </div>\r\n    <!-- END: Header -->\r\n\r\n    <!-- BEGIN: Optional status messages -->\r\n    <div class="region panel-status-region" data-binding="{@var: statusRegionElement}"></div>\r\n    <!-- END: Optional status messages -->\r\n\r\n    <!-- BEGIN: Content region -->\r\n    <div class="panel-scroll-container" data-binding="{data-region-name: regionName}{data-region-adapter: regionType}{@var: scrollRegionElement}{@event-onscroll: handleScrollChange}" tabindex="-1"></div>\r\n    <!-- END: Content region -->\r\n\r\n    <!-- BEGIN: Optional footer content -->\r\n    <div class="panel-footer" data-binding="{@var: footerElement}{@visible: footerInsertDomElement}" style="position: absolute">\r\n        <div class="panel-footer-inner" data-binding="{@dom: footerInsertDomElement}"></div>\r\n    </div>\r\n    <!-- END: Optional header content -->\r\n\r\n</div>',"url:/Mapping/infrastructure/ui/components/Table/TableView.html":'<div class="results-table" data-binding="{@var: tableContainerElement}">\r\n    <table>\r\n        <thead>\r\n            <tr data-binding="{@source: columnHeaders}">\r\n                <th data-binding="{@template-for: columnHeaders}{@visible: visible}{@event-onclick: handleColumnHeadClick}" scope="col">\r\n                    <button data-binding="{aria-label: columnDescriptor}">\r\n                        <span data-binding="{class: sortClass}{title: @language-results-sort}"></span>\r\n                        <span class="result-heading" data-binding="{@text: presentableValue}"></span>\r\n                    </button>\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody data-binding="{@source: records}">\r\n            <tr class="results-table-row-item" data-binding="{@template-for: records}\r\n                                    {@source: attributes}\r\n                                    {@event-mousedown: handleMouseDown}\r\n                                    {@event-mouseup: handleMouseUp}\r\n                                    {@event-touchstart: handleTouchStart}\r\n                                    {@event-touchmove: handleTouchMove}\r\n                                    {@event-touchend: handleTouchEnd}\r\n                                    {@event-click: handleClick}\r\n                                    {@event-mouseenter: handleMouseOver}\r\n                                    {@event-mouseleave: handleMouseOut}">\r\n                <td data-binding="{@template-for: attributes}{@visible: visible}">\r\n                    <a data-binding="{@visible: displayAsUrl}{@event-onclick: handleClickAttributelink}{href: value}{@text: presentableValue}" target="_blank"></a>\r\n                    <button data-binding="{@hidden: displayAsUrl}{@text: presentableValue}" tabindex="0"></button>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</div>\r\n\r\n'}}),geocortex||(geocortex={}),geocortex.essentialsHtmlViewer||(geocortex.essentialsHtmlViewer={}),geocortex.essentialsHtmlViewer.version="2.8.0.0974",require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping.Infrastructure","inv","Invariant","json","eyJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWFjdGl2YXRlLXZpZXciOiJBY3RpdmF0ZXMgYSB2aWV3LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZGVhY3RpdmF0ZS12aWV3IjoiRGVhY3RpdmF0ZXMgYSB2aWV3LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdG9nZ2xlLXZpZXciOiJBY3RpdmF0ZXMgb3IgZGVhY3RpdmF0ZXMgYSB2aWV3LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdG9nZ2xlLWxvZy12aWV3IjoiQWN0aXZhdGVzIG9yIGRlYWN0aXZhdGVzIGxvZyB2aWV3LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdG9nZ2xlLXJlc3VsdHMtZnJhbWUiOiJBY3RpdmF0ZXMgb3IgZGVhY3RpdmF0ZXMgUmVzdWx0cyBmcmFtZS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXRvZ2dsZS1kYXRhLWZyYW1lIjoiQWN0aXZhdGVzIG9yIGRlYWN0aXZhdGVzIGRhdGEgZnJhbWUuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1kZXN0cm95LXZpZXciOiJEZXN0cm95cyBhIHZpZXcsIHdpcGluZyBvdXQgaXRzIGJpbmRpbmcgYW5kIERPTSBzdWJzdHJ1Y3R1cmVzLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xvc2UtbW9kYWwtcmVnaW9uIjoiQ2xvc2VzIHRoZSBNb2RhbFdpbmRvd1JlZ2lvbi4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLW9wZW4td2ViLXBhZ2UiOiJPcGVucyBhIHdlYiBwYWdlIGluIGFub3RoZXIgdGFiL3dpbmRvdy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWFsZXJ0IjoiRGlzcGxheXMgYW4gYWxlcnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jb25maXJtIjoiRGlzcGxheXMgYSBjb25maXJtLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24taWRlbnRpZnkiOiJFeGVjdXRlcyBhbiBpZGVudGlmeSBvcGVyYXRpb24gb24gYSBnZW9tZXRyeS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXByb21wdCI6IkRpc3BsYXlzIGEgcHJvbXB0LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc3RlcC16b29tLWluIjoiWm9vbXMgaW4gYSBzdGVwIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zdGVwLXpvb20tb3V0IjoiWm9vbXMgb3V0IGEgc3RlcCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVjZW50ZXItbWFwLW9uLW5leHQtbWFwLXJlc2l6ZSI6IlJlY2VudGVycyB0aGUgbWFwIHRvIGl0cyBleGlzdGluZyBwb3NpdGlvbiB0aGUgbmV4dCB0aW1lIHRoZSBtYXAgaXMgcmVzaXplZC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXBhbi10by1wb2ludCI6IlBhbnMgdG8gYSBwb2ludCBvciBvdGhlciB0eXBlIG9mIEdlb21ldHJ5LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tem9vbS10by1leHRlbnQiOiJab29tcyB0byB0aGUgZ2l2ZW4gZXh0ZW50LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tem9vbS1vdXQtdG8tZXh0ZW50IjoiWm9vbXMgb3V0IHRvIHRoZSBnaXZlbiBleHRlbnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi16b29tLXRvLWVzcmktZmVhdHVyZS1zZXQiOiJab29tcyB0byB0aGUgZXh0ZW50IG9mIGFsbCB0aGUgZmVhdHVyZXMgaW4gdGhlIGZlYXR1cmUgc2V0LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24taW5pdGlhbGl6ZS1zaXRlIjoiVGVsbHMgdGhlIEdlb2NvcnRleCBFc3NlbnRpYWxzIFNpdGUgb2JqZWN0IHRvIGJlZ2luIGluaXRpYWxpemF0aW9uLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tem9vbS10by1pbml0aWFsLWV4dGVudCI6Ilpvb21zIHRvIHRoZSBpbml0aWFsIGV4dGVudCBvZiB0aGUgY3VycmVudCBTaXRlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tbWFwLXJlc2l6ZSI6IlRlbGxzIHRoZSBtYXAgY29udHJvbCB0byByZXNpemUgaXRzZWxmLiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgYWx0ZXJpbmcgdGhlIG1hcCBjb250YWluZXIncyBkaW1lbnNpb25zLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tYWRkLXRlbXBvcmFyeS1tYXJrdXAtZ2VvbWV0cnkiOiJBZGRzIGEgdGVtcG9yYXJ5IG1hcmt1cCBncmFwaGljIHRvIHRoZSBtYXAuIFRoZSBDbGVhclRlbXBvcmFyeU1hcmt1cCBjb21tYW5kIHdpbGwgY2xlYXIgdGhpcyBtYXJrdXAuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci10ZW1wb3JhcnktbWFya3VwIjoiUmVtb3ZlcyB0ZW1wb3JhcnkgbWFya3VwIGNyZWF0ZWQgYnkgQWRkVGVtcG9yYXJ5TWFya3VwR2VvbWV0cnkuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi16b29tLXRvLWZlYXR1cmUiOiJab29tcyB0byBhIGZlYXR1cmUuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zaG93LW1hcCI6IkFjdGl2YXRlcyBtYXAgdmlldy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwLWVsZW1lbnQiOiJEaXNwbGF5cyBhbiBlbGVtZW50IGFuY2hvcmVkIHRvIGEgc3BlY2lmaWMgcG9pbnQgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwLWNhbGxvdXQiOiJEaXNwbGF5cyBhIG1hcCBjYWxsb3V0IGFuY2hvcmVkIHRvIGEgZ2l2ZW4gcG9pbnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWRlLW1hcC1lbGVtZW50IjoiUmVtb3ZlcyBhbiBlbGVtZW50IHByZXZpb3VzbHkgYW5jaG9yZWQgdG8gdGhlIG1hcCB1c2luZyBTaG93TWFwRWxlbWVudC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwLXRpcC1yZXN1bHRzIjoiU2hvd3MgbWFwIHRpcCByZXN1bHRzIGZvciBhIEZlYXR1cmVTZXRDb2xsZWN0aW9uIHByZXZpb3VzbHkgYWRkZWQgdG8gdGhlIEZlYXR1cmVTZXRNYW5hZ2VyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tb3Blbi1kYXRhLWZyYW1lIjoiT3BlbnMgdGhlIERhdGFSZWdpb24sIGlmIHByZXNlbnQgaW4gdGhlIGN1cnJlbnQgc2hlbGwuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbG9zZS1kYXRhLWZyYW1lIjoiQ2xvc2VzIHRoZSBEYXRhUmVnaW9uLCBpZiBpdCBpcyBwcmVzZW50IGluIHRoZSBjdXJyZW50IHNoZWxsLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcnVuLXdvcmtmbG93LWJ5LWlkIjoiUnVucyBhIHdvcmtmbG93LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcnVuLXdvcmtmbG93LXdpdGgtZ2VvbWV0cnkiOiJSdW5zIGEgd29ya2Zsb3cgd2l0aCBhIGdlb21ldHJ5IHVzZWQgYXMgYW4gaW5wdXQgYXJndW1lbnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1ydW4td29ya2Zsb3ctd2l0aC1hcmd1bWVudHMiOiJSdW5zIGEgd29ya2Zsb3cgd2l0aCBhIHNldCBvZiBpbnB1dCBhcmd1bWVudHMuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1kaXNwbGF5LXdvcmtmbG93LWNvbnRhaW5lci1jb250ZW50IjoiRGlzcGxheXMgYSB2aWV3IGluIGEgd29ya2Zsb3cgY29udGFpbmVyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tYWN0aXZhdGUtY29udGFpbmVycy1mb3Itd29ya2Zsb3ciOiJBY3RpdmF0ZXMgYW55IHdvcmtmbG93IGNvbnRhaW5lciB2aWV3cyBhc3NvY2lhdGVkIHdpdGggYSBnaXZlbiB3b3JrZmxvdy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlYWN0aXZhdGUtY29udGFpbmVycy1mb3Itd29ya2Zsb3ciOiJEZWFjdGl2YXRlcyBhbnkgd29ya2Zsb3cgdmlld3MgYXNzb2NpYXRlZCB3aXRoIGEgZ2l2ZW4gd29ya2Zsb3cuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci1hY3RpdmUtdG9vbCI6IkNsZWFycyB0aGUgYWN0aXZlIHRvb2wuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zZXQtYWN0aXZlLXRvb2wiOiJTZXRzIHRoZSBhY3RpdmUgdG9vbC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWdlb2xvY2F0ZSI6Ilpvb21zIHRvIHRoZSBjdXJyZW50IGxvY2F0aW9uIG9mIHRoZSBkZXZpY2UuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi10YWtlLWFwcGxpY2F0aW9uLW9mZmxpbmUiOiJQdXRzIHRoZSBhcHBsaWNhdGlvbiBpbiBhbiBvZmZsaW5lIHN0YXRlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdGFrZS1hcHBsaWNhdGlvbi1vbmxpbmUiOiJDb25uZWN0cyB0aGUgYXBwbGljYXRpb24gdG8gdGhlIGludGVybmV0LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tb3Blbi1mZWF0dXJlLXNldC1jb2xsZWN0aW9uIjoiT3BlbnMgdGhlIGZlYXR1cmUgc2V0IGNvbGxlY3Rpb24uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbG9zZS1mZWF0dXJlLXNldC1jb2xsZWN0aW9uIjoiQ2xvc2VzIHRoZSBmZWF0dXJlIHNldCBjb2xsZWN0aW9uLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVtb3ZlLWZlYXR1cmUtc2V0LWNvbGxlY3Rpb24iOiJSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbiBmcm9tIHRoZSBmZWF0dXJlIHNldCBtYW5hZ2VyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVtb3ZlLWZlYXR1cmUtc2V0LWNvbGxlY3Rpb24tYnktaWQiOiJSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbiBmcm9tIHRoZSBmZWF0dXJlIHNldCBtYW5hZ2VyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVnaXN0ZXItc2VhcmNoLXByb3ZpZGVyIjoiUmVnaXN0ZXJzIGEgc2VhcmNoIHByb3ZpZGVyIGlmIG5vdCBhbHJlYWR5IHJlZ2lzdGVyZWQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zZWFyY2giOiJQZXJmb3JtcyBhIHNlYXJjaCBvbiBhbGwgYWN0aXZlIHByb3ZpZGVycy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWdsb2JhbC1zZWFyY2giOiJQZXJmb3JtcyBhIHNlYXJjaCBvbiBhbGwgYWN0aXZlIHByb3ZpZGVycy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNhbmNlbC1zZWFyY2giOiJDYW5jZWwgdGhlIHNlYXJjaCBvbiBhbGwgcHJvdmlkZXJzLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZ2V0LWZlYXR1cmUtZGV0YWlscy1wcm92aWRlcnMiOiJDcmVhdGVzIHZpZXcgZm9yIGFsbCBjb25maWd1cmVkIGZlYXR1cmUgZGV0YWlscyBwcm92aWRlcnMgYW5kIGVtYmVkcyB0aGVtIGludG8gZmVhdHVyZSBkZXRhaWxzIGRpYWxvZy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctZmVhdHVyZS1kZXRhaWxzIjoiQ3JlYXRlcyBhbmQgZGlzcGxheXMgdGhlIEZlYXR1cmUgRGV0YWlscyBkaWFsb2cgZm9yIHRoZSBmZWF0dXJlIG9yIGZlYXR1cmUgc2V0IGNvbGxlY3Rpb24gc3BlY2lmaWVkLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc3RhcnQtZWRpdGluZy1mZWF0dXJlIjoiQmVnaW5zIGVkaXRpbmcgYW4gZXhpc3RpbmcgZmVhdHVyZS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXN0YXJ0LWVkaXRpbmctbmV3LWZlYXR1cmUiOiJCZWdpbnMgZWRpdGluZyBhIG5ldyBmZWF0dXJlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc3RhcnQtZWRpdGluZy1lZGl0LWxvZy1lbnRyeSI6IkNyZWF0ZXMgYSBhdmlldyB0byBjaGFuZ2UgYW4gZXhpc3RpbmcgZWRpdC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIiOiJTaG93cyB0aGUgZmVhdHVyZSB0ZW1wbGF0ZSBwaWNrZXIgdXNlZCB0byBjcmVhdGUgbmV3IGZlYXR1cmVzLiBJZiBhIGxheWVyIGlzIHN1cHBsaWVkLCBzaG93cyB0aGUgdGVtcGxhdGVzIGZvciB0aGUgbGF5ZXIuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1mZWF0dXJlLWxheWVyLWNsZWFyLWRhdGEiOiJDbGVhcnMgdGhlIGRhdGEgZm9yIGEgZ2l2ZW4gbWFwIHNlcnZpY2UgVVJMLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZmVhdHVyZS1sYXllci1jYWNoZS1kYXRhIjoiQ2FjaGVzIHRoZSBkYXRhIGZvciBhIGdpdmVuIG1hcCBzZXJ2aWNlIFVSTC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWZlYXR1cmUtbGF5ZXItY2xlYXItY2FjaGUtc3BlYyI6IlNwZWNpZnkgdGhpcyBsYXllciBhcyBub3QgdG8gYmUgY2FjaGVkIG9uIG5leHQgc3luYy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctZmVhdHVyZS1sYXllci1tb2RhbC1tZXNzYWdlIjoiQ3JlYXRlcyBhIE1vZGVsTWVzc2FnZVZpZXcgdmlldyBhbmQgZGlzcGxheXMgdGhlIGdpdmVuIG1lc3NhZ2UuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi11cGRhdGUtZmVhdHVyZS1sYXllci1tb2RhbC1tZXNzYWdlIjoiVXBkYXRlIHRoZSB2aXNpYmxlIE1vZGVsTWVzc2FnZVZpZXcgdG8gYWxzbyBpbmNsdWRlIHRoZSBnaXZlbiBtZXNzYWdlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tYWxsb3ctaGlkZS1mZWF0dXJlLWxheWVyLW1vZGFsLW1lc3NhZ2UiOiJTaG93IHRoZSBjbG9zZSBidXR0b24gb24gdGhlIE1vZGFsTWVzc2FnZVZpZXcgYWxsb3dpbmcgdGhlIHVzZXIgdG8gY2xvc2UgaXQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWRlLWZlYXR1cmUtbGF5ZXItbW9kYWwtbWVzc2FnZSI6IlJlbW92ZXMgYSBtb2RhbCBtZXNzYWdlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY3JlYXRlLWZlYXR1cmUiOiJDcmVhdGVzIGEgbmV3IGZlYXR1cmUuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi11cGRhdGUtZmVhdHVyZSI6IlVwZGF0ZXMgZWl0aGVyIGEgbmV3IG9yIGV4aXN0aW5nIGZlYXR1cmUuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1kZWxldGUtZmVhdHVyZSI6IkRlbGV0ZXMgZWl0aGVyIGEgbmV3IG9yIGV4aXN0aW5nIGZlYXR1cmUuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jcmVhdGUtcmVsYXRlZC1yZWNvcmQiOiJDcmVhdGVzIGEgcmVsYXRlZCB0YWJsZSByZWNvcmQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi11cGRhdGUtcmVsYXRlZC1yZWNvcmQiOiJVcGRhdGVzIGEgcmVsYXRlZCB0YWJsZSByZWNvcmQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1kZWxldGUtcmVsYXRlZC1yZWNvcmQiOiJEZWxldGVzIGEgcmVsYXRlZCB0YWJsZSByZWNvcmQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jcmVhdGUtYXR0YWNobWVudCI6IkNyZWF0ZXMgYSBmZWF0dXJlIGF0dGFjaG1lbnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi11cGRhdGUtYXR0YWNobWVudCI6IlVwZGF0ZXMgYSBmZWF0dXJlIGF0dGFjaG1lbnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1kZWxldGUtYXR0YWNobWVudCI6IkRlbGV0ZXMgYSBmZWF0dXJlIGF0dGFjaG1lbnQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jaGFuZ2UtZWRpdC1sb2ctZW50cnkiOiJDaGFuZ2UgYW4gZXhpc3RpbmcgZWRpdCBsb2cgZW50cnkuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1nZXQtcmVsYXRlZC1mZWF0dXJlIjoiR2V0cyBmZWF0dXJlcyByZWxhdGVkIHRvIHRoZSBmZWF0dXJlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZ2V0LWVkaXQtbG9nIjoiR2V0cyB0aGUgZWRpdCBsb2csIHBhc3NpbmcgaXQgaW50byBhIGNhbGxiYWNrLiBJZiBhbiBlcnJvciBvY2N1cnMsIHRoZSBlcnJvciBpcyBwYXNzZWQgaW50byB0aGUgY2FsbGJhY2suIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zZXQtZWRpdC1sb2ciOiJTZXRzIHRoZSBlZGl0IGxvZywgcGFzc2luZyBpdCBpbnRvIGEgY2FsbGJhY2suIElmIGFuIGVycm9yIG9jY3VycywgdGhlIGVycm9yIGlzIHBhc3NlZCBpbnRvIHRoZSBjYWxsYmFjay4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlbGV0ZS1mcm9tLWVkaXQtbG9nIjoiUmVtb3ZlcyB0aGUgZ2l2ZW4gZW50cnkgZnJvbSB0aGUgZWRpdCBsb2csIHRoZW4gc2V0cyB0aGUgZWRpdCBsb2cuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1mZWF0dXJlLWxheWVyLW1vZHVsZS1yZWZyZXNoLWRhdGEiOiJSZWZyZXNoZXMgbGF5ZXIgZWRpdCBzdW1tYXJpZXMgYW5kIHRoZSBcInN5bmMgbmVlZGVkXCIgZmxhZy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNldC1lZGl0b3ItZmVhdHVyZS1nZW9tZXRyeSI6IlNldHMgdGhlIGdlb21ldHJ5IG9mIHRoZSBmZWF0dXJlIHRoYXQgaXMgY3VycmVudGx5IGJlaW5nIGVkaXRlZCBpbiB0aGUgQXR0cmlidXRlIEVkaXRvciwgYW5kIGFjdGl2YXRlcyB0aGUgQXR0cmlidXRlRWRpdG9yIFZpZXcuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1mZWF0dXJlLWxheWVyLW1vZHVsZS1zdGFydC1zeW5jIjoiU3RhcnRzIHN5bmNocm9uaXplcyB0aGUgZmVhdHVyZSBlZGl0cyB0byB0aGUgc2VydmVyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcGFuLXRvLWZlYXR1cmUiOiJQYW5zIHRvIHRoZSBHZW9jb3J0ZXggZmVhdHVyZS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXByb2plY3QiOiJDYWxscyBhIGdlb21ldHJ5IHNlcnZpY2UgdG8gcHJvamVjdCBnZW9tZXRyaWVzIGJldHdlZW4gZGlmZmVyZW50IGNvb3JkaW5hdGUgc3lzdGVtcy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWludm9rZS1tYXAtdGlwIjoiRXhlY3V0ZXMgYW4gSWRlbnRpZnkgb3BlcmF0aW9uIG9uIHRoZSBnaXZlbiBnZW9tZXRyeSBhbmQgXCJNYXBUaXBcIiBhcyBpdHMgc291cmNlIHRhZy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwLXRpcCI6IkNyZWF0ZXMgYSBNYXAgVGlwIFZpZXcgYW5kIGRpc3BsYXlzIHRoZSBmZWF0dXJlIGluIGl0LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xlYXItc3RvcmFnZS1mb3ItYXBwbGljYXRpb24iOiJDbGVhcnMgdGhlIG9mZmxpbmUgZGF0YSBmb3IgdGhlIGN1cnJlbnQgYXBwbGljYXRpb24uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci1zdG9yYWdlLWZvci1kb21haW4iOiJDbGVhcnMgYWxsIG9mZmxpbmUgZGF0YSBmb3IgdGhlIGN1cnJlbnQgZG9tYWluLiBUaGlzIGluY2x1ZGVzIGRhdGEgZm9yIGFsbCBhcHBsaWNhdGlvbnMgbG9hZGVkIGZyb20gdGhlIGN1cnJlbnQgZG9tYWluLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1yZXN1bHRzLWxpc3QiOiJEaXNwbGF5cyB0aGUgbGlzdCBvZiBmZWF0dXJlcyBpbiB0aGUgZ2l2ZW4gZmVhdHVyZSBzZXQgY29sbGVjdGlvbiBhcyBhIGxpc3QuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zaG93LXJlc3VsdHMtdGFibGUiOiJEaXNwbGF5cyB0aGUgbGlzdCBvZiBmZWF0dXJlcyBpbiB0aGUgZ2l2ZW4gZmVhdHVyZSBzZXQgY29sbGVjdGlvbiBpbiBhIHRhYnVsYXIgdmlldy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctcmVzdWx0cy1mZWF0dXJlLWFjdGlvbiI6IkNyZWF0ZXMgUmVzdWx0c0xpc3RGZWF0dXJlQWN0aW9uc1ZpZXcgYW5kIGRpc3BsYXlzIHRoZSBGZWF0dXJlIEFjdGlvbnMuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1vcGVuLXJlc3VsdHMtZnJhbWUiOiJBY3RpdmF0ZXMgdGhlIFJlc3VsdHNSZWdpb24uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbG9zZS1yZXN1bHRzLWZyYW1lIjoiRGVhY3RpdmF0ZXMgdGhlIFJlc3VsdHNSZWdpb24uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zaG93LWxheWVyLWxpc3QiOiJBY3RpdmF0ZXMgdGhlIExheWVyTGlzdCBWaWV3LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcHVsc2Utc3RhdHVzIjoiUmVzZXRzIHRoZSB0aW1lciBvZiB0aGUgc3RhdHVzIHZpZXdNb2RlbC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXJlbW92ZS1zdGF0dXMiOiJSZW1vdmVzIHRoZSBzdGF0dXMgaW5kaWNhdG9yIGZyb20gdGhlIHNjcmVlbiB3aXRoIHRoZSBzcGVjaWZpZWQgSUQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1hZGQtc3RhdHVzIjoiQWRkcyBhIHN0YXR1cyBpbmRpY2F0b3IgdG8gdGhlIHNjcmVlbi4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNyZWF0ZS1oaWdobGlnaHQtbGF5ZXIiOiJDcmVhdGVzIGEgbmV3IGhpZ2hsaWdodCBsYXllciB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNldC1hY3RpdmUtaGlnaGxpZ2h0LWxheWVyIjoiU2V0cyB0aGUgbGF5ZXIgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYXMgYWN0aXZlLCBpZiB0aGVyZSBpcyBvbmUuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWdobGlnaHQtZXNyaS1mZWF0dXJlLXNldCI6IkhpZ2hsaWdodHMgYWxsIG9mIHRoZSBmZWF0dXJlcyBpbiB0aGUgc3BlY2lmaWVkIGZlYXR1cmUgc2V0IGluIHRoZSBhY3RpdmUgaGlnaGxpZ2h0IGxheWVyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWhpZ2hsaWdodC1ib3JkZXItY29sb3IiOiJTZXRzIHRoZSBib3JkZXIgY29sb3IgdXNlZCBmb3IgbmV3IGhpZ2hsaWdodHMsIHNwZWNpZmllZCBpbiA2IG9yIDggZGlnaXQgaGV4IGluIFJHQiBvciBBUkdCIGZvcm0uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zZXQtaGlnaGxpZ2h0LWZpbGwtY29sb3IiOiJTZXRzIHRoZSBmaWxsIGNvbG9yIHVzZWQgZm9yIG5ldyBoaWdobGlnaHRzLCBzcGVjaWZpZWQgaW4gNiBvciA4IGRpZ2l0IGhleCBpbiBSR0Igb3IgQVJHQiBmb3JtLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVtb3ZlLWhpZ2hsaWdodC1sYXllciI6IlJlbW92ZXMgdGhlIGhpZ2hsaWdodCBsYXllciB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSwgaWYgdGhlcmUgaXMgb25lLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xlYXItaGlnaGxpZ2h0cyI6IlJlbW92ZXMgdGhlIGhpZ2hsaWdodHMgZnJvbSB0aGUgYWN0aXZlIGhpZ2hsaWdodCBsYXllci4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNsZWFyLWRlZmF1bHQtaGlnaGxpZ2h0cyI6IlJlbW92ZXMgdGhlIGhpZ2hsaWdodHMgZnJvbSB0aGUgZGVmYXVsdCBoaWdobGlnaHQgbGF5ZXIuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWdobGlnaHQtZmVhdHVyZS1zZXQiOiJIaWdobGlnaHRzIGFsbCBvZiB0aGUgZmVhdHVyZXMgaW4gdGhlIHNwZWNpZmllZCBmZWF0dXJlIHNldCBpbiB0aGUgYWN0aXZlIGhpZ2hsaWdodCBsYXllci4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWhpZ2hsaWdodC1mZWF0dXJlIjoiSGlnaGxpZ2h0cyB0aGUgZmVhdHVyZSBpbiB0aGUgYWN0aXZlIGhpZ2hsaWdodCBsYXllci4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWhpZ2hsaWdodC1mZWF0dXJlLWRlZmF1bHQiOiJIaWdobGlnaHRzIHRoZSBmZWF0dXJlIGluIHRoZSBkZWZhdWx0IGhpZ2hsaWdodCBsYXllci4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWFkZC1tYXJrdXAiOiJBZGRzIHRoZSBnaXZlbiBnZW9tZXRyeSB0byB0aGUgbWFya3VwIGxheWVyLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tYWRkLXRleHQtbWFya3VwIjoiUHJvbXB0cyB0aGUgdXNlciBmb3IgdGV4dCB0byBhZGQgYXMgbWFya3VwLiBXaGVuIGNvbXBsZXRlZCwgdGV4dCBtYXJrdXAgaXMgYWRkZWQgYXQgdGhlIHByb3ZpZGVkIGdlb21ldHJ5LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xlYXItbWFya3VwIjoiUHJvbXB0cyB0aGUgdXNlciBmb3IgY29uZmlybWF0aW9uLCBhbmQgaWYgYXBwcm92ZWQsIGNsZWFycyBhbGwgb2YgdGhlIG1hcmt1cCBmcm9tIHRoZSBtYXJrdXAgbGF5ZXIuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci1tYXJrdXAtcXVpZXQiOiJDbGVhcnMgYWxsIG9mIHRoZSBtYXJrdXAgZnJvbSB0aGUgbWFya3VwIGxheWVyIHdpdGhvdXQgcHJvbXB0aW5nIGZvciBjb25maXJtYXRpb24uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1mc20tY29sbGVjdGlvbi1zZXQtY29tbWFuZCI6IlNldCB0aGUgcHJlZmVycmVkIGNvbW1hbmQgdG8gb3BlbiB0aGUgZmVhdHVyZSBzZXQgY29sbGVjdGlvbiBmb3IgdGhlIGdpdmVuIHNvdXJjZSBuYW1lLiIsImxhbmd1YWdlLWNvbW1vbi1jYW5jZWwiOiJDYW5jZWwiLCJsYW5ndWFnZS1jb21tb24tc2F2ZSI6IlNhdmUiLCJsYW5ndWFnZS1jb21tb24tc2F2ZS1hcyI6IlNhdmUgQXMiLCJsYW5ndWFnZS1jb21tb24tc2F2aW5nIjoiU2F2aW5nLi4uIiwibGFuZ3VhZ2UtY29tbW9uLWRlbGV0ZSI6IkRlbGV0ZSIsImxhbmd1YWdlLWNvbW1vbi1kb25lIjoiRG9uZSIsImxhbmd1YWdlLWNvbW1vbi1lZGl0IjoiRWRpdCIsImxhbmd1YWdlLWNvbW1vbi1jbGVhciI6IkNsZWFyIiwibGFuZ3VhZ2UtY29tbW9uLWNsb3NlIjoiQ2xvc2UiLCJsYW5ndWFnZS1jb21tb24tY3JlYXRlIjoiQ3JlYXRlIiwibGFuZ3VhZ2UtY29tbW9uLWFwcGx5IjoiQXBwbHkiLCJsYW5ndWFnZS1jb21tb24tcmV2ZXJ0IjoiUmV2ZXJ0IiwibGFuZ3VhZ2UtY29tbW9uLWRlYnVnLWxvZy1rZXlzIjoiVG8gdmlldyB0aGUgbG9nIG9uIGEgZGVza3RvcCBtYWNoaW5lLCBwcmVzcyBDdHJsICsgU2hpZnQgKyB+LiBPbiBhIG1vYmlsZSBkZXZpY2UsIHByZXNzIGFuZCBob2xkIHRoZSB0b29sYmFyLiIsImxhbmd1YWdlLWNvbW1vbi1lZGl0aW5nIjoiRWRpdGluZyIsImxhbmd1YWdlLWNvbW1vbi13ZWxjb21lIjoiSG9tZSIsImxhbmd1YWdlLXRvb2xiYXItdGl0bGUiOiJUb29sYmFyIiwibGFuZ3VhZ2UtY29tbW9uLXF1ZXJ5LXJlc3VsdHMiOiJRdWVyeSBSZXN1bHRzIiwibGFuZ3VhZ2UtY29tbW9uLWlkZW50aWZ5LXJlc3VsdHMiOiJJZGVudGlmeSBSZXN1bHRzIiwibGFuZ3VhZ2UtY29tbW9uLW9rIjoiT0siLCJsYW5ndWFnZS1jb21tb24tbG9naW4iOiJMb2cgSW4iLCJsYW5ndWFnZS1jb21tb24tYmFjayI6IkJhY2siLCJsYW5ndWFnZS1jb21tb24tc2hvdyI6IlNob3ciLCJsYW5ndWFnZS1jb21tb24taGlkZSI6IkhpZGUiLCJsYW5ndWFnZS1jb21tb24tbG9hZGluZy1yZXN1bHRzIjoiTG9hZGluZyBSZXN1bHRzLi4uIiwibGFuZ3VhZ2UtY29tbW9uLXJlc3VsdHMtZm91bmQiOiJSZXN1bHRzIEZvdW5kIiwibGFuZ3VhZ2UtY29tbW9uLW5vLXJlc3VsdHMiOiJObyByZXN1bHRzIHRvIGRpc3BsYXkiLCJsYW5ndWFnZS1jb21tb24tbm8tcmVzdWx0cy1kZXNjIjoiSXRlbXMgYXBwZWFyIGFmdGVyIHlvdSBwZXJmb3JtIGEgdmFsaWQgc2VhcmNoIG9yIG90aGVyIHRhc2sgdGhhdCByZXR1cm5zIHJlc3VsdHMuIiwibGFuZ3VhZ2UtY29tbW9uLW5vLXJlc3VsdHMtc2hvcnQiOiJObyByZXN1bHRzIiwibGFuZ3VhZ2UtY29tbW9uLWxvYWQiOiJMb2FkIiwibGFuZ3VhZ2UtY29tbW9uLWxvYWRpbmciOiJMb2FkaW5nLi4uIiwibGFuZ3VhZ2UtY29tbW9uLXJlZnJlc2giOiJSZWZyZXNoIiwibGFuZ3VhZ2UtY29tbW9uLWV4dHJhY3QtZGF0YSI6IkV4dHJhY3QgRGF0YSIsImxhbmd1YWdlLWNvbW1vbi1wYW4iOiJQYW4iLCJsYW5ndWFnZS1jb21tb24tcGFuLWRlc2NyaXB0aW9uIjoiUGFuIHRoZSBtYXAgdG8gY2VudGVyIHRoaXMgZmVhdHVyZSIsImxhbmd1YWdlLWNvbW1vbi12YWxpZGF0aW9uLXN5bWJvbCI6IioiLCJsYW5ndWFnZS1jb21tb24tcmVzdWx0cyI6IlJlc3VsdHMiLCJsYW5ndWFnZS1jb21tb24td29ya2Zsb3ciOiJXb3JrZmxvdyIsImxhbmd1YWdlLWNvbW1vbi1zaG93LWRldGFpbHMiOiJTZWUgRGV0YWlscyIsImxhbmd1YWdlLWNvbW1vbi1zaG93LWRldGFpbHMtZGVzY3JpcHRpb24iOiJTZWUgYWRkaXRpb25hbCBkZXRhaWxzIGZvciB0aGlzIGZlYXR1cmUuIiwibGFuZ3VhZ2UtY29tbW9uLXZpZXctbG9nIjoiVmlldyBMb2ciLCJsYW5ndWFnZS1jb21tb24tc3luYy1jb21wbGV0ZSI6IlN5bmNocm9uaXphdGlvbiBjb21wbGV0ZSIsImxhbmd1YWdlLWNvbW1vbi1sYXllci1kYXRhIjoiTGF5ZXIgRGF0YSIsImxhbmd1YWdlLWNvbW1vbi1ub3RpZmljYXRpb24iOiJOb3RpZmljYXRpb24iLCJsYW5ndWFnZS1jb21tb24tbm90LWF2YWlsYWJsZS1vZmZsaW5lIjoiVGhpcyBmdW5jdGlvbiBpcyBub3QgYXZhaWxhYmxlIHdoZW4gb2ZmbGluZS4iLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1vZmZsaW5lLXRvb2xzIjoiTWFuYWdlIE9mZmxpbmUgRGF0YSIsImxhbmd1YWdlLWNvbW1vbi1mZWF0dXJlLXN5bmMtc2V0dGluZ3MiOiJNYW5hZ2UgU3luYyBTZXR0aW5ncyIsImxhbmd1YWdlLWNvbW1vbi1mZWF0dXJlLXN5bmMtc2V0dGluZ3MtZGVzYyI6IkRpc3BsYXlzIGEgbGlzdCBvZiBmZWF0dXJlIGxheWVycyB0byBjaG9vc2UgZnJvbS4iLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIiOiJDcmVhdGUgTmV3IEZlYXR1cmUiLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXItZGVzYyI6IlNlbGVjdCBhIGZlYXR1cmUgdHlwZS4iLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1lZGl0aW5nIjoiRmVhdHVyZSBBdHRyaWJ1dGVzIiwibGFuZ3VhZ2UtY29tbW9uLWZlYXR1cmUtZWRpdGluZy1kZXNjIjoiRWRpdCB0aGUgYXR0cmlidXRlcyBvZiB0aGUgZmVhdHVyZSBhbmQgc2F2ZSB0aGVtLiIsImxhbmd1YWdlLWNvbW1vbi1mZWF0dXJlLWxheWVyLWRldGFpbHMiOiJTeW5jIFNldHRpbmdzIGZvciB7MH0iLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1sYXllci1kZXRhaWxzLWRlc2MiOiJNYW5hZ2UgY2FjaGluZyBvZiBhIGZlYXR1cmUgbGF5ZXIgZm9yIG9mZmxpbmUgdXNlLiIsImxhbmd1YWdlLWNvbW1vbi1mZWF0dXJlLWVkaXRsb2ciOiJWaWV3IEVkaXQgTG9nIiwibGFuZ3VhZ2UtY29tbW9uLWZlYXR1cmUtZWRpdGxvZy1kZXNjIjoiRGlzcGxheXMgaW5mb3JtYXRpb24gYWJvdXQgZWRpdGluZyBoaXN0b3J5IG9mIHRoZSBmZWF0dXJlIGxheWVyLiIsImxhbmd1YWdlLWxheWVyLWFjdGlvbnMiOiJQZXJmb3JtIGFuIGFjdGlvbiBvbiB7MH0iLCJsYW5ndWFnZS1sYXllci1hY3Rpb25zLWRlc2MiOiJEaXNwbGF5IGEgbGlzdCBvZiBsYXllciBhY3Rpb25zIiwibGFuZ3VhZ2UtbGF5ZXItYWN0aW9ucy10aXRsZSI6IkxheWVyIEFjdGlvbnMiLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMiOiJQZXJmb3JtIGFuIGFjdGlvbiBvbiB7MH0iLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMtZGVzYyI6IkRpc3BsYXkgYSBsaXN0IG9mIG1hcCBzZXJ2aWNlIGFjdGlvbnMiLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMtdGl0bGUiOiJNYXAgU2VydmljZSBBY3Rpb25zIiwibGFuZ3VhZ2UtbW9udGhzLTAiOiJKYW51YXJ5IiwibGFuZ3VhZ2UtbW9udGhzLTEiOiJGZWJydWFyeSIsImxhbmd1YWdlLW1vbnRocy0yIjoiTWFyY2giLCJsYW5ndWFnZS1tb250aHMtMyI6IkFwcmlsIiwibGFuZ3VhZ2UtbW9udGhzLTQiOiJNYXkiLCJsYW5ndWFnZS1tb250aHMtNSI6Ikp1bmUiLCJsYW5ndWFnZS1tb250aHMtNiI6Ikp1bHkiLCJsYW5ndWFnZS1tb250aHMtNyI6IkF1Z3VzdCIsImxhbmd1YWdlLW1vbnRocy04IjoiU2VwdGVtYmVyIiwibGFuZ3VhZ2UtbW9udGhzLTkiOiJPY3RvYmVyIiwibGFuZ3VhZ2UtbW9udGhzLTEwIjoiTm92ZW1iZXIiLCJsYW5ndWFnZS1tb250aHMtMTEiOiJEZWNlbWJlciIsImxhbmd1YWdlLWhvdXJzLWFiYnIiOiJIIiwibGFuZ3VhZ2UtbWludXRlcy1hYmJyIjoiTSIsImxhbmd1YWdlLXNlY29uZHMtYWJiciI6IlMiLCJsYW5ndWFnZS1leHRyYWN0LWRhdGEiOiJFeHRyYWN0IGRhdGEiLCJsYW5ndWFnZS1leHRyYWN0LWRhdGEtZGVzY3JpcHRpb24iOiJFeHRyYWN0IGZlYXR1cmUgZGF0YSBmcm9tIHRoZSBtYXAuIiwibGFuZ3VhZ2Utc2VhcmNoLWZzYy1kaXNwbGF5LW5hbWUiOiJTZWFyY2ggUmVzdWx0czogezB9IiwibGFuZ3VhZ2Utc2VhcmNoLXdvcmxkLXBsYWNlLW5hbWVzIjoiV29ybGQgUGxhY2UgTmFtZXMiLCJsYW5ndWFnZS1jb21tb24tc2hhcmUiOiJTaGFyZSIsImxhbmd1YWdlLWNvbW1vbi1kZWFjdGl2YXRlLXRvb2wiOiJEZWFjdGl2YXRlIFRvb2wiLCJsYW5ndWFnZS1mcmFtZXdvcmstdWktdmlldy1jb250YWluZXItdmlldy1iYWNrIjoiR28gQmFjayB7MH0iLCJsYW5ndWFnZS1mcmFtZXdvcmstdWktdmlldy1jb250YWluZXItdmlldy1jbG9zZSI6IkNsb3NlIHswfSIsImxhbmd1YWdlLXJlc3VsdHMtdG9nZ2xlLWxpc3QtdmlldyI6IlN3aXRjaCB0byBMaXN0IiwibGFuZ3VhZ2UtcmVzdWx0cy10b2dnbGUtbGlzdC12aWV3LWRlc2MiOiJWaWV3IHJlc3VsdHMgaW4gbGlzdCBmb3JtYXQiLCJsYW5ndWFnZS1yZXN1bHRzLXRvZ2dsZS10YWJsZS12aWV3IjoiU3dpdGNoIHRvIFRhYmxlIiwibGFuZ3VhZ2UtcmVzdWx0cy10b2dnbGUtdGFibGUtdmlldy1kZXNjIjoiVmlldyByZXN1bHRzIGluIHRhYmxlIGZvcm1hdCIsImxhbmd1YWdlLWNvbW1vbi1yZXN1bHRzLWFkZGVkLWNvbmZpcm1hdGlvbiI6InswfSByZXN1bHQocykgYWRkZWQgdG8gJ3sxfSciLCJsYW5ndWFnZS1jb21tb24tcmVzdWx0cy1yZW1vdmVkLWNvbmZpcm1hdGlvbiI6InswfSByZXN1bHQocykgcmVtb3ZlZCBmcm9tICd7MX0nIiwibGFuZ3VhZ2UtY29tbW9uLXJlc3VsdHMtdW5pb24tY29uZmlybWF0aW9uIjoiJ3swfScgdW5pb25lZCB3aXRoIHsxfSIsImxhbmd1YWdlLWNvbW1vbi1yZXN1bHRzLWludGVyc2VjdC1jb25maXJtYXRpb24iOiInezB9JyBpbnRlcnNlY3RlZCB3aXRoIHsxfSIsImxhbmd1YWdlLWNvbW1vbi1yZXN1bHRzLXN1YnRyYWN0LWNvbmZpcm1hdGlvbiI6InsxfSBzdWJ0cmFjdGVkIGZyb20gJ3swfSciLCJsYW5ndWFnZS1jb21tb24tcmVzdWx0cy1yZXBsYWNlLWNvbmZpcm1hdGlvbiI6Iid7MH0nIHJlcGxhY2VkIHdpdGggezF9IiwibGFuZ3VhZ2UtY29tbW9uLXJlc3VsdHMtY29tYmluZS1uby1yZXN1bHRzIjoiTm8gcmVzdWx0cyB0byBwZXJmb3JtIHRoZSBvcGVyYXRpb24iLCJsYW5ndWFnZS1jb21tb24tbWVhc3VyZW1lbnQtcmVzdWx0cy1maWVsZC1sZW5ndGgiOiJMZW5ndGgiLCJsYW5ndWFnZS1jb21tb24tbWVhc3VyZW1lbnQtcmVzdWx0cy1maWVsZC11bml0cyI6IlVuaXRzIiwibGFuZ3VhZ2UtY29tbW9uLW1lYXN1cmVtZW50LXJlc3VsdHMtZmllbGQtYXJlYSI6IkFyZWEiLCJsYW5ndWFnZS1jb21tb24tbWVhc3VyZW1lbnQtcmVzdWx0cy1maWVsZC1hcmVhLXVuaXRzIjoiQXJlYSBVbml0cyIsImxhbmd1YWdlLWNvbW1vbi1saWJyYXJ5IjoiTGlicmFyeSIsImxhbmd1YWdlLWNvbW1vbi1jdXN0b21pemUiOiJDdXN0b21pemUiLCJsYW5ndWFnZS1jb21tb24tdGV4dCI6IlRleHQiLCJsYW5ndWFnZS1tZW51LWRlZmF1bHQtdGl0bGUiOiJPcHRpb25zIiwibGFuZ3VhZ2UtbWVudS1uby1pdGVtcyI6Ik5vIG1lbnUgb3B0aW9ucy4iLCJsYW5ndWFnZS1tZW51LXRpdGxlIjoiSSB3YW50IHRvLi4uIiwibGFuZ3VhZ2UtbWVudS1kb25lIjoiRG9uZSIsImxhbmd1YWdlLW1lbnUtZGVzY3JpcHRpb24iOiJRdWljayBhY2Nlc3MgdG8gY29tbW9uIHRhc2tzIiwibGFuZ3VhZ2UtbWVudS1tZW51cy1kZXNjcmlwdGlvbiI6IkkgV2FudCBUby4uLiBNZW51cyIsImxhbmd1YWdlLW1lbnUtc2V0dGluZ3MtZGVzY3JpcHRpb24iOiJNb2JpbGUgU2V0dGluZ3MiLCJsYW5ndWFnZS1tZW51LXNob3ctbG9nIjoiU2hvdyBMb2ciLCJsYW5ndWFnZS1tZW51LXNob3ctbG9nLWRlc2MiOiJEaXNwbGF5IHRoZSB2aWV3ZXIncyBsb2csIGluY2x1ZGluZyBkaWFnbm9zdGljIGVycm9ycyBhbmQgdGhlIHZlcnNpb24gbnVtYmVyLiIsImxhbmd1YWdlLW1lbnUtYWRkLWEtZmVhdHVyZSI6IkNyZWF0ZSBhIGZlYXR1cmUiLCJsYW5ndWFnZS1tZW51LWFkZC1hLWZlYXR1cmUtZGVzYyI6IkNyZWF0ZSBhIG5ldyBmZWF0dXJlIG9uIHRoaXMgbGF5ZXIuIiwibGFuZ3VhZ2UtbWVudS1lZGl0LWZlYXR1cmUiOiJFZGl0IHRoaXMgRmVhdHVyZSIsImxhbmd1YWdlLW1lbnUtZWRpdC1mZWF0dXJlLWRlc2NyaXB0aW9uIjoiRWRpdCB0aGUgZGV0YWlscyBhYm91dCB0aGlzIGZlYXR1cmUuIiwibGFuZ3VhZ2UtbWVudS1lbnRlci1vZmZsaW5lIjoiR28gdG8gb2ZmbGluZSBtb2RlIiwibGFuZ3VhZ2UtbWVudS1lbnRlci1vZmZsaW5lLWRlc2MiOiJHbyB0byBvZmZsaW5lIG1vZGUgYW5kIHZpZXcgY2FjaGVkIG1hcCBkYXRhLiIsImxhbmd1YWdlLW1lbnUtZW50ZXItb25saW5lIjoiR28gdG8gb25saW5lIG1vZGUiLCJsYW5ndWFnZS1tZW51LWVudGVyLW9ubGluZS1kZXNjIjoiR28gdG8gb25saW5lIG1vZGUgYW5kIHZpZXcgbGl2ZSBtYXAgZGF0YSBmcm9tIHRoZSB3ZWIuIiwibGFuZ3VhZ2UtbWVudS1ydW4tYS13b3JrZmxvdyI6IlBlcmZvcm0gYSB0YXNrIiwibGFuZ3VhZ2UtbWVudS16b29tLWluIjoiWm9vbSBpbiIsImxhbmd1YWdlLW1lbnUtem9vbS1vdXQiOiJab29tIG91dCIsImxhbmd1YWdlLW1lbnUtcnVuLXdvcmtmbG93IjoiUGVyZm9ybSBhIHRhc2siLCJsYW5ndWFnZS1tZW51LXJ1bi13b3JrZmxvdy1kZXNjIjoiU2VsZWN0IGZyb20gYSBsaXN0IG9mIGF2YWlsYWJsZSB0YXNrcy4iLCJsYW5ndWFnZS1tZW51LW1hcC1sYXllcnMiOiJDaGFuZ2UgdmlzaWJsZSBtYXAgbGF5ZXJzIiwibGFuZ3VhZ2UtbWVudS1tYXAtbGF5ZXJzLWRlc2MiOiJBbHRlciB2aXNpYmlsaXR5IG9mIG1hcCBsYXllcnMsIHBlcmZvcm0gbGF5ZXIgYWN0aW9ucywgYW5kIHZpZXcgdGhlIGxlZ2VuZC4iLCJsYW5ndWFnZS1tZW51LW1hcC1sYXllcnMtZXhwYW5kIjoiRXhwYW5kIGFuZCBjb2xsYXBzZSB7MH0gbGF5ZXIgZ3JvdXAiLCJsYW5ndWFnZS1tZW51LW1hcHRpcC1hY3Rpb25zIjoiQWN0aW9ucyIsImxhbmd1YWdlLW1lbnUtbWFwdGlwLWFjdGlvbnMtZGVzYyI6Ik1hcFRpcCBBY3Rpb25zIiwibGFuZ3VhZ2UtbWVudS1tYXB0aXAtYWN0aW9ucy12aWV3LWRldGFpbHMiOiJWaWV3IEFkZGl0aW9uYWwgRGV0YWlscyIsImxhbmd1YWdlLW1lbnUtbWFwdGlwLWFjdGlvbnMtdmlldy1kZXRhaWxzLWRlc2MiOiJWaWV3IGFkZGl0aW9uYWwgZGV0YWlscyBhYm91dCB0aGlzIGZlYXR1cmUiLCJsYW5ndWFnZS1tZW51LWxpc3Qtb2ZmbGluZS1tYXBzLWFjdGlvbnMtZGVzYyI6Ik9mZmxpbmUgUHJvZmlsZSBBY3Rpb25zIiwibGFuZ3VhZ2UtbWVudS1saXN0LW9mZmxpbmUtbWFwcy1hY3Rpb25zLXJlZnJlc2giOiJSZWZyZXNoIiwibGFuZ3VhZ2UtbWVudS1saXN0LW9mZmxpbmUtbWFwcy1hY3Rpb25zLXJlZnJlc2gtZGVzYyI6IlJlZnJlc2ggdGhlIGxpc3Qgb2Ygb2ZmbGluZSBtYXBzLiIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZGVzYyI6Ikdlb21ldHJ5IEFjdGlvbnMiLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWNsZWFyIjoiQ2xlYXIiLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWNsZWFyLWRlc2MiOiJDbGVhciB0aGUgYXJlYSBvZiBpbnRlcmVzdCBnZW9tZXRyeS4iLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWN1cnJlbnRleHRlbnQiOiJDdXJyZW50IEV4dGVudCIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtY3VycmVudGV4dGVudC1kZXNjIjoiVXNlIHRoZSBjdXJyZW50IGV4dGVudCBmb3IgdGhlIGFyZWEgb2YgaW50ZXJlc3QgZ2VvbWV0cnkuIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1wb2x5Z29uIjoiUG9seWdvbiIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtcG9seWdvbi1kZXNjIjoiRHJhdyBhIHBvbHlnb24gZm9yIHRoZSBhcmVhIG9mIGludGVyZXN0IGdlb21ldHJ5LiIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZnJlZWhhbmRwb2x5Z29uIjoiRnJlZWhhbmQgUG9seWdvbiIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZnJlZWhhbmRwb2x5Z29uLWRlc2MiOiJEcmF3IGEgZnJlZWhhbmQgcG9seWdvbiBmb3IgdGhlIGFyZWEgb2YgaW50ZXJlc3QgZ2VvbWV0cnkuIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1jaXJjbGUiOiJDaXJjbGUiLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWNpcmNsZS1kZXNjIjoiRHJhdyBhIGNpcmNsZSBmb3IgdGhlIGFyZWEgb2YgaW50ZXJlc3QgZ2VvbWV0cnkuIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1lbGxpcHNlIjoiRWxsaXBzZSIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZWxsaXBzZS1kZXNjIjoiRHJhdyBhbiBlbGxpcHNlIGZvciB0aGUgYXJlYSBvZiBpbnRlcmVzdCBnZW9tZXRyeS4iLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLXJlY3RhbmdsZSI6IlJlY3RhbmdsZSIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtcmVjdGFuZ2xlLWRlc2MiOiJEcmF3IGEgcmVjdGFuZ2xlIGZvciB0aGUgYXJlYSBvZiBpbnRlcmVzdCBnZW9tZXRyeS4iLCJsYW5ndWFnZS1tZW51LXJlc3VsdHMtbGlzdC1hY3Rpb25zLWRlc2MiOiJSZXN1bHRzIExpc3QgQWN0aW9ucyIsImxhbmd1YWdlLW1lbnUtc2hvdy1yZXN1bHRzLXRhYmxlIjoiVGFibGUgVmlldyIsImxhbmd1YWdlLW1lbnUtc2hvdy1yZXN1bHRzLXRhYmxlLWRlc2MiOiJTd2l0Y2ggdG8gVGFibGUgVmlldyIsImxhbmd1YWdlLW1lbnUtcmVzdWx0cy10YWJsZS1hY3Rpb25zLWRlc2MiOiJSZXN1bHRzIFRhYmxlIEFjdGlvbnMiLCJsYW5ndWFnZS1tZW51LXNob3ctcmVzdWx0cy1saXN0IjoiTGlzdCBWaWV3IiwibGFuZ3VhZ2UtbWVudS1zaG93LXJlc3VsdHMtbGlzdC1kZXNjIjoiU3dpdGNoIHRvIExpc3QgVmlldyIsImxhbmd1YWdlLW1lbnUtc2hvdy1jaGFydGluZy12aWV3IjoiQ2hhcnRpbmcgVmlldyIsImxhbmd1YWdlLW1lbnUtc2hvdy1jaGFydGluZy12aWV3LWRlc2MiOiJTd2l0Y2ggdG8gY2hhcnRpbmcgdmlldyIsImxhbmd1YWdlLW1lbnUtem9vbS10by1hbGwiOiJab29tIHRvIEFsbCIsImxhbmd1YWdlLW1lbnUtem9vbS10by1hbGwtZGVzYyI6Ilpvb20gdG8gZXh0ZW50IG9mIGFsbCByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1ydW4tcmVwb3J0IjoiUnVuIGEgUmVwb3J0IiwibGFuZ3VhZ2UtbWVudS1ydW4tcmVwb3J0LWRlc2MiOiJSdW4gYSBSZXBvcnQgb24gdGhlIHNlbGVjdGVkIHJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWV4cG9ydC1yZXN1bHRzLXRvLWNzdiI6IkV4cG9ydCB0byBDU1YiLCJsYW5ndWFnZS1tZW51LWV4cG9ydC1yZXN1bHRzLXRvLWNzdi1kZXNjIjoiRXhwb3J0IHJlc3VsdHMgdG8gQ1NWIiwibGFuZ3VhZ2UtbWVudS1leHBvcnQtcmVzdWx0cy10by14bHN4IjoiRXhwb3J0IHRvIFhMU1giLCJsYW5ndWFnZS1tZW51LWV4cG9ydC1yZXN1bHRzLXRvLXhsc3gtZGVzYyI6IkV4cG9ydCByZXN1bHRzIHRvIFhMU1giLCJsYW5ndWFnZS1tZW51LWV4cG9ydC1yZXN1bHRzLXRvLXNocCI6IkV4cG9ydCB0byBTaGFwZWZpbGUiLCJsYW5ndWFnZS1tZW51LWV4cG9ydC1yZXN1bHRzLXRvLXNocC1kZXNjIjoiRXhwb3J0IHJlc3VsdHMgdG8gU2hhcGVmaWxlIiwibGFuZ3VhZ2UtbWVudS1pZGVudGlmeS1idWZmZXJlZC1mZWF0dXJlLXNldC1jb2xsZWN0aW9uIjoiU2hvdyBCdWZmZXIgT3B0aW9ucyIsImxhbmd1YWdlLW1lbnUtaWRlbnRpZnktYnVmZmVyZWQtZmVhdHVyZS1zZXQtY29sbGVjdGlvbi1kZXNjIjoiSWRlbnRpZnkgZmVhdHVyZXMgbmVhciB0aGVzZSByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1idWZmZXItaWRlbnRpZnktZmVhdHVyZSI6IlNob3cgQnVmZmVyIE9wdGlvbnMiLCJsYW5ndWFnZS1tZW51LWJ1ZmZlci1pZGVudGlmeS1mZWF0dXJlLWRlc2MiOiJJZGVudGlmeSBuZWFyYnkgZmVhdHVyZXMiLCJsYW5ndWFnZS1tZW51LWdsb2JhbC1vcGVuIjoiT3BlbiIsImxhbmd1YWdlLW1lbnUtZ2xvYmFsLW9wZW4tZGVzYyI6IkNob29zZSBhIHByZXZpb3VzbHkgc2F2ZWQgcHJvamVjdCB0byByZXN0b3JlIHRoZSBzYXZlZCBzdGF0ZSIsImxhbmd1YWdlLW1lbnUtZ2xvYmFsLXNhdmUiOiJTYXZlIiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2F2ZS1kZXNjIjoiU2F2ZSB0aGUgc3RhdGUgb2YgeW91ciB2aWV3ZXIgaW4gYSBwcm9qZWN0IiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2F2ZS1hcyI6IlNhdmUgYXMiLCJsYW5ndWFnZS1tZW51LWdsb2JhbC1zYXZlLWFzLWRlc2MiOiJTYXZlIHRoZSBzdGF0ZSBvZiB5b3VyIHZpZXdlciBpbiBhIG5ldyBwcm9qZWN0IiwibGFuZ3VhZ2UtbWVudS1ob21lLXBhbmVsIjoiVmlldyB0aGUgaG9tZSBwYW5lbCIsImxhbmd1YWdlLW1lbnUtaG9tZS1wYW5lbC1kZXNjIjoiVmlldyBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIGFwcGxpY2F0aW9uLiIsImxhbmd1YWdlLW1lbnUtYWNjZXNzaWJpbGl0eS1wYW5lbCI6IlZpZXcgdGhlIGFjY2Vzc2liaWxpdHkgcGFuZWwiLCJsYW5ndWFnZS1tZW51LWFjY2Vzc2liaWxpdHktcGFuZWwtZGVzYyI6IlZpZXcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGFjY2Vzc2liaWxpdHkgb2YgdGhpcyBhcHBsaWNhdGlvbi4iLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5IjoiRmluZCBkYXRhIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LWRlc2MiOiJDbGljaywgdGFwLCBvciBkcmF3IGEgcmVjdGFuZ2xlIG9uIHRoZSBtYXAgdG8gaWRlbnRpZnkgZmVhdHVyZXMuIiwibGFuZ3VhZ2UtbWVudS1pZGVudGlmeS1yZWN0YW5nbGUiOiJJZGVudGlmeSBieSByZWN0YW5nbGUiLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LXJlY3RhbmdsZS1kZXNjIjoiRHJhdyBhIHJlY3RhbmdsZSB0byB2aWV3IGluZm9ybWF0aW9uIGFib3V0IHRoYXQgYXJlYS4iLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LWZyZWVoYW5kIjoiSWRlbnRpZnkgYnkgZnJlZWhhbmQgc2hhcGUiLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LWZyZWVoYW5kLWRlc2MiOiJEcmF3IGEgc2hhcGUgdG8gdmlldyBpbmZvcm1hdGlvbiBhYm91dCB0aGF0IGFyZWEuIiwibGFuZ3VhZ2UtbWVudS1pZGVudGlmeS1wb2ludCI6IklkZW50aWZ5IGJ5IHBvaW50IiwibGFuZ3VhZ2UtbWVudS1pZGVudGlmeS1wb2ludC1kZXNjIjoiRHJhdyBhIHBvaW50IG9uIHRoZSBtYXAgdG8gdmlldyBpbmZvcm1hdGlvbiBhdCB0aGF0IHBvaW50IG9uIHRoZSBtYXAuIiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2VhcmNoIjoiU2VhcmNoIiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2VhcmNoLWRlc2MiOiJTZWFyY2ggZm9yIGZlYXR1cmVzIG9uIHRoZSBtYXAuIiwibGFuZ3VhZ2UtbWVudS16b29tIjoiWm9vbSB0byBGZWF0dXJlIiwibGFuZ3VhZ2UtbWVudS16b29tLWRlc2NyaXB0aW9uIjoiWm9vbSB0byB0aGlzIGZlYXR1cmUgb24gdGhlIG1hcCIsImxhbmd1YWdlLW1lbnUtem9vbS1pbml0aWFsLWV4dGVudCI6IlJldHVybiB0byBpbml0aWFsIG1hcCBleHRlbnQiLCJsYW5ndWFnZS1tZW51LXpvb20taW5pdGlhbC1leHRlbnQtZGVzYyI6IlJldHVybiB0byB0aGUgaW5pdGlhbCBtYXAgcG9zaXRpb24gYW5kIHpvb20gbGV2ZWwuIiwibGFuZ3VhZ2UtbWVudS16b29tLXRvLWxheWVyIjoiWm9vbSB0byBmdWxsIGV4dGVudCIsImxhbmd1YWdlLW1lbnUtem9vbS10by1sYXllci1kZXNjIjoiWm9vbSB0aGUgbWFwIHRvIHRoZSBmdWxsIGV4dGVudCBvZiB0aGUgbGF5ZXIuIiwibGFuZ3VhZ2UtbWVudS16b29tLXRvLXZpc2libGUtc2NhbGUiOiJab29tIHRvIHZpc2libGUgc2NhbGUiLCJsYW5ndWFnZS1tZW51LXpvb20tdG8tdmlzaWJsZS1zY2FsZS1kZXNjIjoiWm9vbSB0aGUgbWFwIHRvIGEgc2NhbGUgd2hlcmUgdGhlIGxheWVyIGlzIHZpc2libGUuIiwibGFuZ3VhZ2UtbWVudS1mb290ZXItbWVudS1kZXNjIjoiRm9vdGVyIE1lbnUiLCJsYW5ndWFnZS1tZW51LWxhdGl0dWRlLWdlb2dyYXBoaWNzIjoiTGF0aXR1ZGUgR2VvZ3JhcGhpY3MgR3JvdXAgTHRkLiIsImxhbmd1YWdlLW1lbnUtbGF0aXR1ZGUtZ2VvZ3JhcGhpY3MtZGVzYyI6IkxhdGl0dWRlIEdlb2dyYXBoaWNzIEdyb3VwIEx0ZC4iLCJsYW5ndWFnZS1tZW51LXBvd2VyZWQtYnktZ2VvY29ydGV4IjoiUG93ZXJlZCBieSBHZW9jb3J0ZXgiLCJsYW5ndWFnZS1tZW51LXBvd2VyZWQtYnktZ2VvY29ydGV4LWRlc2MiOiJQb3dlcmVkIGJ5IEdlb2NvcnRleCIsImxhbmd1YWdlLW1lbnUtc29jaWFsLWxpbmtzLW1lbnUtZGVzYyI6IlNvY2lhbCBMaW5rcyIsImxhbmd1YWdlLW1lbnUtYm9va21hcmstYWRkIjoiQm9va21hcmsgY3VycmVudCBtYXAgZXh0ZW50IiwibGFuZ3VhZ2UtbWVudS1ib29rbWFyay1hZGQtZGVzYyI6IkFkZCB0aGUgY3VycmVudCBtYXAgZXh0ZW50IHRvIHRoZSBsaXN0IG9mIGJvb2ttYXJrcywgc28gdGhhdCBJIGNhbiByZXR1cm4gdG8gaXQgbGF0ZXIuIiwibGFuZ3VhZ2UtbWVudS1zd2l0Y2gtdG8tbGF5ZXJsaXN0IjoiU2hvdyBMYXllciBMaXN0IiwibGFuZ3VhZ2UtbWVudS1zd2l0Y2gtdG8tbGF5ZXJsaXN0LWRlc2MiOiJEaXNwbGF5IHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBsYXllcnMiLCJsYW5ndWFnZS1tZW51LXN3aXRjaC10by1sZWdlbmQiOiJTaG93IExlZ2VuZCIsImxhbmd1YWdlLW1lbnUtc3dpdGNoLXRvLWxlZ2VuZC1kZXNjIjoiRGlzcGxheSB0aGUgbGVnZW5kIGZvciB2aXNpYmxlIGxheWVycyIsImxhbmd1YWdlLW1lbnUtdmlzdWFsaXphdGlvbiI6IlR1cm4gb24vb2ZmIGxheWVyIHZpc3VhbGl6YXRpb25zIiwibGFuZ3VhZ2UtbWVudS12aXN1YWxpemF0aW9uLWRlc2MiOiJDcmVhdGUgYW5kIHZpZXcgY3VzdG9tIGxheWVyIHZpc3VhbGl6YXRpb25zIHN1Y2ggYXMgaGVhdCBtYXBzLCBjbHVzdGVyaW5nLCBhbmQgbGF5ZXIgc3R5bGVzLiIsImxhbmd1YWdlLW1lbnUtcmVtb3ZlLXVzZXItYWRkZWQtbGF5ZXIiOiJSZW1vdmUgbGF5ZXIiLCJsYW5ndWFnZS1tZW51LXJlbW92ZS11c2VyLWFkZGVkLWxheWVyLWRlc2MiOiJSZW1vdmUgdGhpcyB1c2VyIGFkZGVkIGxheWVyIGZyb20gdGhlIG1hcC4iLCJsYW5ndWFnZS1tZW51LXJlbW92ZS11c2VyLWFkZGVkLW1hcHNlcnZpY2UiOiJSZW1vdmUgc2VydmljZSIsImxhbmd1YWdlLW1lbnUtcmVtb3ZlLXVzZXItYWRkZWQtbWFwc2VydmljZS1kZXNjIjoiUmVtb3ZlIHRoaXMgdXNlciBhZGRlZCBzZXJ2aWNlIGZyb20gdGhlIG1hcC4iLCJsYW5ndWFnZS1tZW51LWxhYmVsLW9wdGlvbnMiOiJDdXN0b21pemUgbGFiZWxzIiwibGFuZ3VhZ2UtbWVudS1sYWJlbC1vcHRpb25zLWRlc2MiOiJUb2dnbGUgYW5kIGN1c3RvbWl6ZSB0aGUgbGF5ZXIncyBsYWJlbHMuIiwibGFuZ3VhZ2UtbWVudS1sYWJlbC1vcHRpb25zLXRvZ2dsZSI6IlRvZ2dsZSBsYWJlbHMiLCJsYW5ndWFnZS1tZW51LWxhYmVsLW9wdGlvbnMtdG9nZ2xlLWRlc2MiOiJUdXJuIHRoZSBsYXllcidzIGxhYmVscyBvbiBvciBvZmYuIiwibGFuZ3VhZ2UtbWVudS1kcmF3LXBvaW50IjoiRHJhdyBhIFBvaW50IiwibGFuZ3VhZ2UtbWVudS1kcmF3LXBvaW50LWRlc2MiOiJEcmF3IGEgcG9pbnQgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS1tZW51LXBsb3QtY29vcmRpbmF0ZSI6IlBsb3QgYSBDb29yZGluYXRlIiwibGFuZ3VhZ2UtbWVudS1wbG90LWNvb3JkaW5hdGUtZGVzYyI6IlBsb3QgYSBjb29yZGluYXRlIG9uIHRoZSBtYXAuIiwibGFuZ3VhZ2UtbWVudS1hZGQtdGV4dCI6IkFkZCBTb21lIFRleHQiLCJsYW5ndWFnZS1tZW51LWFkZC10ZXh0LWRlc2MiOiJBZGQgc29tZSB0ZXh0IHRvIHRoZSBtYXAuIiwibGFuZ3VhZ2UtbWVudS1jZW50ZXItbWFwIjoiQ2VudGVyIHRoZSBNYXAgSGVyZSIsImxhbmd1YWdlLW1lbnUtY2VudGVyLXRleHRtYXAtZGVzYyI6IkNlbnRlciB0aGUgbWFwIG9uIHRoZSBwb2ludCBzcGVjaWZpZWQuIiwibGFuZ3VhZ2UtbWVudS1tYXAtY29udGV4dC1tZW51LXRpdGxlIjoiUG9pbnQgT3B0aW9ucyIsImxhbmd1YWdlLW1lbnUtbWFwLWNvbnRleHQtbWVudS10aXRsZS1kZXNjIjoiT3B0aW9ucyByZWxhdGVkIHRvIGEgZ2l2ZW4gcG9pbnQgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS1tZW51LXByb2plY3QtYWN0aW9ucy1kZXNjIjoiVmlldyBvcHRpb25zIHJlbGF0ZWQgdG8gdGhlIHByb2plY3QuIiwibGFuZ3VhZ2UtbWVudS1wcm9qZWN0cy1hY3Rpb25zLWRlc2MiOiJQcm9qZWN0cyBBY3Rpb25zIiwibGFuZ3VhZ2UtbWVudS1wcm9qZWN0cy1hY3Rpb25zLXJlZnJlc2gtZGVzYyI6IlJlZnJlc2ggdGhlIGxpc3Qgb2YgcHJvamVjdHMuIiwibGFuZ3VhZ2UtbWVudS1wcm9qZWN0LXNoYXJlLXByb2plY3QtZGVzYyI6IlNoYXJlIHRoZSBjdXJyZW50IHByb2plY3QiLCJsYW5ndWFnZS1tZW51LXByb2plY3QtZWRpdC1wcm9qZWN0LWRlc2MiOiJFZGl0IHRoZSBjdXJyZW50IHByb2plY3QiLCJsYW5ndWFnZS1tZW51LXByb2plY3QtZGVsZXRlLXByb2plY3QtZGVzYyI6IkRlbGV0ZSB0aGUgY3VycmVudCBwcm9qZWN0IiwibGFuZ3VhZ2UtbWVudS1zYXZlLXJlc3VsdHMiOiJTYXZlIFJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LXNhdmUtcmVzdWx0cy1kZXNjIjoiU2F2ZSB0aGUgbGlzdCBvZiByZXN1bHRzIGZvciBmdXR1cmUgdXNlIiwibGFuZ3VhZ2UtbWVudS1icm93c2Utc2F2ZWQtcmVzdWx0cyI6Ik9wZW4gU2F2ZWQgUmVzdWx0cyIsImxhbmd1YWdlLW1lbnUtYnJvd3NlLXNhdmVkLXJlc3VsdHMtZGVzYyI6IkNob29zZSBmcm9tIGEgbGlzdCBvZiBzYXZlZCByZXN1bHRzIHRvIHZpZXcgdGhlbSIsImxhbmd1YWdlLW1lbnUtcmVzdWx0cy1hZGQtZmVhdHVyZSI6IkFkZCB0byBSZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1yZXN1bHRzLWFkZC1mZWF0dXJlLWRlc2MiOiJBZGQgdGhpcyBmZWF0dXJlIHRvIHRoZSBjdXJyZW50IHNldCBvZiByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1yZXN1bHRzLXJlbW92ZS1mZWF0dXJlIjoiUmVtb3ZlIGZyb20gUmVzdWx0cyIsImxhbmd1YWdlLW1lbnUtcmVzdWx0cy1yZW1vdmUtZmVhdHVyZS1kZXNjIjoiUmVtb3ZlIHRoaXMgZmVhdHVyZSBmcm9tIHRoZSBjdXJyZW50IHNldCBvZiByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1yZXN1bHRzLXJlbW92ZS1mZWF0dXJlLXNldCI6IlJlbW92ZSBmcm9tIFJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LXJlc3VsdHMtcmVtb3ZlLWZlYXR1cmUtc2V0LWRlc2MiOiJSZW1vdmUgdGhpcyBmZWF0dXJlIHNldCBmcm9tIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24gb2YgcmVzdWx0cyIsImxhbmd1YWdlLW1lbnUtY29tYmluZS1yZXN1bHRzIjoiQ29tYmluZSBSZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtZGVzYyI6IlBlcmZvcm0gYWR2YW5jZWQgb3BlcmF0aW9ucyB3aXRoIG11bHRpcGxlIGxpc3RzIG9mIHJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWNvbWJpbmUtcmVzdWx0cy11bmlvbiI6IkFkZCB0byByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtdW5pb24tZGVzYyI6IkNvbWJpbmUgYSBzYXZlZCBzZXQgb2YgcmVzdWx0cyB3aXRoIHlvdXIgY3VycmVudCByZXN1bHRzIGxpc3QiLCJsYW5ndWFnZS1tZW51LWNvbWJpbmUtcmVzdWx0cy1zdWJ0cmFjdCI6IlN1YnRyYWN0IHNhdmVkIHJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWNvbWJpbmUtcmVzdWx0cy1zdWJ0cmFjdC1kZXNjIjoiUmVtb3ZlIGEgc2F2ZWQgc2V0IG9mIHJlc3VsdHMgZnJvbSB5b3VyIGN1cnJlbnQgbGlzdCBvZiByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtaW50ZXJzZWN0IjoiTWF0Y2ggaW50ZXJzZWN0aW5nIHJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWNvbWJpbmUtcmVzdWx0cy1pbnRlcnNlY3QtZGVzYyI6Ik9ubHkgc2hvdyByZXN1bHRzIHRoYXQgYXJlIGluIGJvdGggeW91ciBjdXJyZW50IGxpc3QgYW5kIGEgc2F2ZWQgc2V0IG9mIHJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWNvcHktdG8tZHJhd2luZ3MiOiJDb3B5IHRvIERyYXdpbmcgTGF5ZXIiLCJsYW5ndWFnZS1tZW51LWNvcHktdG8tZHJhd2luZ3MtZGVzYyI6IkNvcHkgdGhpcyBmZWF0dXJlIHRvIHRoZSBkcmF3aW5nIGxheWVyIiwibGFuZ3VhZ2UtbWVudS1ncm91cGVkLXJlc3VsdHMtbGlzdC1hY3Rpb25zIjoiR3JvdXBlZCBSZXN1bHRzIExpc3QgQWN0aW9ucyIsImxhbmd1YWdlLW1lbnUtZ3JvdXBlZC1yZXN1bHRzLWxpc3QtYWN0aW9ucy1kZXNjIjoiR3JvdXBlZCBSZXN1bHRzIExpc3QgQWN0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItdGFiLW5hdmlnYXRpb24iOiJOYXZpZ2F0aW9uIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLWhvbWUtc3ViIjoiSG9tZSIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1ob21lIjoiSG9tZSIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1ob21lLXRvb2x0aXAiOiJSZXR1cm5zIHRvIGludHJvZHVjdG9yeSBwYWdlIiwibGFuZ3VhZ2UtdG9vbGJhci10YWItdGFza3MiOiJUYXNrcyIsImxhbmd1YWdlLXRvb2xiYXItdGFiLWVkaXRpbmciOiJFZGl0aW5nIiwibGFuZ3VhZ2UtdG9vbGJhci10YWItb2ZmbGluZSI6Ik9mZmxpbmUiLCJsYW5ndWFnZS10b29sYmFyLXRhYi1hbmFseXNpcyI6IkFuYWx5c2lzIiwibGFuZ3VhZ2UtdG9vbGJhci10YWItZmlsZSI6IkZpbGUiLCJsYW5ndWFnZS10b29sYmFyLXRhYi1ob21lIjoiSG9tZSIsImxhbmd1YWdlLXRvb2xiYXItdGFiLW1hcCI6Ik1hcCIsImxhbmd1YWdlLXRvb2xiYXItdGFiLXRvb2xzIjoiVG9vbHMiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWFyY2dpcyI6IkFyY0dJUyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtdG9vbHMiOiJUb29scyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtaG9tZSI6IkJhc2ljIFRvb2xzIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1nbG9iYWwtdGFza3MiOiJHbG9iYWwgVGFza3MiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLW5hdmlnYXRpb24iOiJOYXZpZ2F0aW9uIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC10YXNrcyI6IlRhc2tzIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1maW5kLWRhdGEiOiJGaW5kIERhdGEiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWZpbmQtZGF0YS10b29scyI6IkZpbmQiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLW1lYXN1cmVtZW50IjoiTWVhc3VyZSIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtbWVhc3VyZW1lbnQtdG9vbHMiOiJNZWFzdXJlIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1hZHZhbmNlZC1tZWFzdXJlbWVudCI6IkFkdmFuY2VkIE1lYXN1cmVtZW50IiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1wbG90Y29vcmRpbmF0ZXMiOiJDb29yZGluYXRlcyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtZWRpdGluZyI6IkVkaXQgRHJhd2luZ3MiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWVkaXQiOiJFZGl0IiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1vZmZsaW5lLW1hbmFnZW1lbnQiOiJPZmZsaW5lIE1hbmFnZW1lbnQiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWVkaXQtZmVhdHVyZXMiOiJFZGl0IEZlYXR1cmVzIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1hbmFseXNpcyI6IkFuYWx5c2lzIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC0zcmQtcGFydHktbWFwcyI6IkxpbmtlZCBNYXBzIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1sYXllcnMiOiJMYXllcnMiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWRyYXciOiJEcmF3IiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1uYXRpdmUiOiJOYXRpdmUiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLXRpbWUtc2xpZGVyIjoiVGltZSBTbGlkZXIiLCJsYW5ndWFnZS10b29sYmFyLWFyY2dpcy1leHBvcnQtd2ViLW1hcCI6IlNhdmUgdG8gQXJjR0lTIiwibGFuZ3VhZ2UtdG9vbGJhci1hcmNnaXMtZXhwb3J0LXdlYi1tYXAtdG9vbHRpcCI6IlNhdmUgdGhlIGN1cnJlbnQgbWFwIHRvIEFyY0dJUyIsImxhbmd1YWdlLXRvb2xiYXItYXJjZ2lzLXZpZXctbXktY29udGVudCI6IlZpZXcgTXkgQ29udGVudCIsImxhbmd1YWdlLXRvb2xiYXItYXJjZ2lzLXZpZXctbXktY29udGVudC10b29sdGlwIjoiVmlldyB5b3VyIGNvbnRlbnQgc3RvcmVkIGluIEFyY0dJUyIsImxhbmd1YWdlLXRvb2xiYXItYm9va21hcmsiOiJCb29rbWFya3MiLCJsYW5ndWFnZS10b29sYmFyLWJvb2ttYXJrLW9wZW4iOiJPcGVuIHRoZSBib29rbWFya3MgdmlldyIsImxhbmd1YWdlLXRvb2xiYXItY2hhcnRpbmctc2hvdy1jaGFydHMiOiJWaWV3IENoYXJ0cyIsImxhbmd1YWdlLXRvb2xiYXItY2hhcnRpbmctc2hvdy1jaGFydHMtdG9vbHRpcCI6IkxhdW5jaCB0aGUgY2hhcnRpbmcgdmlldyIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy1kYXRhIjoiRGF0YSIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy1lZGl0IjoiRWRpdCIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy1jcmVhdGUtbmV3LWZlYXR1cmUiOiJDcmVhdGUgTmV3IEZlYXR1cmUiLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctY3JlYXRlLW5ldy1mZWF0dXJlLXRvb2x0aXAiOiJDcmVhdGUgYSBuZXcgZmVhdHVyZSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1lZGl0aW5nLW1hbmFnZS1vZmZsaW5lLWRhdGEiOiJNYW5hZ2UgT2ZmbGluZSBEYXRhIiwibGFuZ3VhZ2UtdG9vbGJhci1lZGl0aW5nLW1hbmFnZS1vZmZsaW5lLWRhdGEtdG9vbHRpcCI6IlNlbGVjdCwgc3luYywgYW5kIGNsZWFyIG9mZmxpbmUgZGF0YSIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy1jcmVhdGUtbmV3LWZlYXR1cmUtZ2VvbG9jYXRpb24iOiJVc2UgR2VvbG9jYXRpb24iLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctY3JlYXRlLW5ldy1mZWF0dXJlLWdlb2xvY2F0aW9uLXRvb2x0aXAiOiJDcmVhdGUgYSBwb2ludC1iYXNlZCBmZWF0dXJlIHVzaW5nIGdlb2xvY2F0aW9uIiwibGFuZ3VhZ2UtdG9vbGJhci1lZGl0aW5nLXRvb2xzIjoiRWRpdCBGZWF0dXJlcyIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbiI6Ik5hdmlnYXRpb24iLCJsYW5ndWFnZS10b29sYmFyLWhvbWUtc3ViIjoiSG9tZSIsImxhbmd1YWdlLXRvb2xiYXItaG9tZS10b29sdGlwIjoiT3BlbiB0aGUgSG9tZSBQYW5lbCIsImxhbmd1YWdlLXRvb2xiYXItbmF0aXZlLXNob3dvZmZsaW5lbWFwcyI6Ik9mZmxpbmUgTWFwcyIsImxhbmd1YWdlLXRvb2xiYXItbmF0aXZlLXNob3dvZmZsaW5lbWFwcy10b29sdGlwIjoiT3BlbiB0aGUgbGlzdCBvZiBvZmZsaW5lIG1hcHMiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tcGFuIjoiUGFuIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLXBhbi10b29sdGlwIjoiQ2FuY2VsIGFueSBhY3RpdmUgdG9vbHMgYW5kIHB1dCB0aGUgbWFwIGludG8gcGFuIG1vZGUiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tem9vbS1pbiI6Ilpvb20gSW4iLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tem9vbS1pbi1kZXNjIjoiQ2xpY2sgb3IgdGFwLCB0aGVuIGRyYWcgYXJlYSBvZiBpbnRlcmVzdCBvbiB0aGUgbWFwLiBNYXAgd2lsbCB6b29tIHRvIHRoYXQgbG9jYXRpb24uIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLXpvb20taW4tdG9vbHRpcCI6IkRyYXcgYW4gYXJlYSBvbiB0aGUgbWFwIHRvIHpvb20gdG8iLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tem9vbS1vdXQiOiJab29tIE91dCIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi16b29tLW91dC1kZXNjIjoiRHJhZyBhIHJlY3RhbmdsZSBvbiB0aGUgbWFwIHRvIHpvb20gb3V0IHdoaWxlIGtlZXBpbmcgdGhhdCBhcmVhIGNlbnRlcmVkIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLXpvb20tb3V0LXRvb2x0aXAiOiJEcmF3IGFuIGFyZWEgb2YgaW50ZXJlc3Qgb24gdGhlIG1hcCBhbmQgem9vbSBvdXQsIGtlZXBpbmcgdGhlIGFyZWEgY2VudGVyZWQiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24taW5pdGlhbC1leHRlbnQiOiJJbml0aWFsIFZpZXciLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24taW5pdGlhbC1leHRlbnQtdG9vbHRpcCI6IlJldHVybiB0byB0aGUgaW5pdGlhbCBwb3NpdGlvbiBvZiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLWZ1bGwtZXh0ZW50IjoiRnVsbCBFeHRlbnQiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tZnVsbC1leHRlbnQtdG9vbHRpcCI6IlJldHVybiB0byB0aGUgZnVsbCBleHRlbnQgb2YgdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1wcmV2aW91cy1leHRlbnQiOiJQcmV2aW91cyBFeHRlbnQiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tcHJldmlvdXMtZXh0ZW50LXRvb2x0aXAiOiJab29tIHRvIHRoZSBwcmV2aW91cyBleHRlbnQiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tbmV4dC1leHRlbnQiOiJOZXh0IEV4dGVudCIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1uZXh0LWV4dGVudC10b29sdGlwIjoiWm9vbSB0byB0aGUgbmV4dCBleHRlbnQiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1kcmF3aW5nIjoiQ3JlYXRlIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZHJhd2luZy10b29scyI6IkRyYXciLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1kcmF3aW5nLWVkaXQtdG9vbHMiOiJFZGl0IiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9pbnQiOiJQb2ludCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBvaW50LWRlc2MiOiJDbGljayBvciB0YXAgYSBtYXAgbG9jYXRpb24gdG8gYWRkIGEgcG9pbnQuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9pbnQtZGVzYy1rZXlib2FyZCI6IlVzZSBhcnJvd3MgdG8gbW92ZSB0aGUgcG9pbnQuIEhpdCBFTlRFUiB0byBhZGQgaXQgdG8gdGhlIG1hcC4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2ludC10b29sdGlwIjoiQWRkIGEgcG9pbnQgdG8gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWZyZWVoYW5kIjoiRnJlZWhhbmQiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1mcmVlaGFuZC1kZXNjIjoiSG9sZCB0aGUgbW91c2UgYnV0dG9uIG9yIHlvdXIgZmluZ2VydGlwIGRvd24sIHRoZW4gZHJhdyBhIGZyZWVoYW5kIGxpbmUuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZnJlZWhhbmQtdG9vbHRpcCI6IkRyYXcgYSBmcmVlaGFuZCBsaW5lIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1mcmVlaGFuZC1wb2x5Z29uIjoiRnJlZWhhbmQgU2hhcGUiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1mcmVlaGFuZC1wb2x5Z29uLWRlc2MiOiJIb2xkIHRoZSBtb3VzZSBidXR0b24gb3IgeW91ciBmaW5nZXJ0aXAgZG93biwgdGhlbiBkcmF3IGEgZnJlZWhhbmQgc2hhcGUuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZnJlZWhhbmQtcG9seWdvbi10b29sdGlwIjoiRHJhdyBhIGZyZWVoYW5kIHNoYXBlIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2x5bGluZSI6IkxpbmUiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2x5bGluZS1kZXNjIjoiQ2xpY2sgb3IgdGFwIGxvY2F0aW9ucyBhbG9uZyB0aGUgbWFwIHRvIGNyZWF0ZSBhIGxpbmUuIERvdWJsZSBjbGljay90YXAgdG8gZmluaXNoLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBvbHlsaW5lLWRlc2Mta2V5Ym9hcmQiOiJVc2UgYXJyb3dzIHRvIG1vdmUgdGhlIHBvaW50LiBIaXQgRU5URVIgdG8gcGxvdCBhbmQgYmVnaW4gbW92aW5nIHRoZSBuZXh0IHBvaW50LiBIaXQgRU5URVIgdHdpY2UgdG8gZmluaXNoLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBvbHlsaW5lLXRvb2x0aXAiOiJEcmF3IGEgbGluZSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWdvbiI6IlBvbHlnb24iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2x5Z29uLWRlc2MiOiJDbGljayBvciB0YXAgbG9jYXRpb25zIHRvIGRlZmluZSBhIHBvbHlnb24uIERvdWJsZS1jbGljay90YXAgdG8gZmluaXNoLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBvbHlnb24tZGVzYy1rZXlib2FyZCI6IlVzZSBhcnJvd3MgdG8gbW92ZSB0aGUgcG9pbnQuIEhpdCBFTlRFUiB0byBwbG90IGFuZCBiZWdpbiBtb3ZpbmcgdGhlIG5leHQgcG9pbnQuIEhpdCBFTlRFUiB0d2ljZSB0byBmaW5pc2guIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWdvbi10b29sdGlwIjoiRHJhdyBhIGN1c3RvbSBzaGFwZSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWxsaXBzZSI6IkVsbGlwc2UiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lbGxpcHNlLWRlc2MiOiJDbGljayBhbmQgZHJhZyB0byBkcmF3IGFuIGVsbGlwc2Ugb24gdGhlIG1hcC4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lbGxpcHNlLXRvb2x0aXAiOiJEcmF3IGFuIGVsbGlwc2Ugb24gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWNpcmNsZSI6IkNpcmNsZSIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWNpcmNsZS1kZXNjIjoiRHJhZyBhIGNpcmNsZSBvbiB0byB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtY2lyY2xlLXRvb2x0aXAiOiJEcmF3IGEgY2lyY2xlIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1yZWN0YW5nbGUiOiJSZWN0YW5nbGUiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1yZWN0YW5nbGUtZGVzYyI6IkNsaWNrIGFuZCBkcmFnIHRvIGRyYXcgYSByZWN0YW5nbGUgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1yZWN0YW5nbGUtdG9vbHRpcCI6IkRyYXcgYSByZWN0YW5nbGUgb24gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWNsZWFyIjoiQ2xlYXIiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1jbGVhci10b29sdGlwIjoiQ2xlYXIgYWxsIGRyYXdpbmdzIGZyb20gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXRleHQiOiJUZXh0IiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtdGV4dC1kZXNjIjoiQ2xpY2sgYSBsb2NhdGlvbiB3aGVyZSB5b3Ugd2FudCB0byBhZGQgdGV4dCBvbiB0aGUgbWFwLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXRleHQtdG9vbHRpcCI6IkFkZCB5b3VyIG93biB0ZXh0IHRvIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0IjoiRWRpdCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWVkaXQtZGVzYyI6IkNsaWNrIG9yIHRhcCBhbiBleGlzdGluZyBkcmF3aW5nIHRvIGJlZ2luIGVkaXRpbmcgaXQuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWRpdC1kZXNjLWtleWJvYXJkIjoiVXNlIGFycm93cyB0byBtb3ZlIHRoZSBwb2ludC4gSGl0IEVOVEVSIHRvIGJlZ2luIGVkaXRpbmcgYW4gZXhpc3RpbmcgZHJhd2luZy4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0LWRlc2Mtc2hvcnRjdXRzIjoiVXNlIGFycm93cyB0byBtb3ZlLCBSIHRvIHJvdGF0ZSwgUyB0byBzY2FsZSwgViB0byBzZWxlY3QgdmVydGV4LiBDb21iaW5lIHdpdGggQUxUIGZvciBmaW5lciBjb250cm9sLiBDb21iaW5lIHdpdGggU0hJRlQgdG8gcmV2ZXJzZS4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0LXRvb2x0aXAiOiJFZGl0IGFuIGV4aXN0aW5nIGRyYXdpbmciLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1kZWxldGUiOiJFcmFzZSIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWRlbGV0ZS1kZXNjIjoiQ2xpY2sgb3IgdGFwIHRvIGltbWVkaWF0ZWx5IGFuZCBwZXJtYW5lbnRseSBkZWxldGUgYSBkcmF3aW5nLiBUaGlzIGNhbm5vdCBiZSB1bmRvbmUuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZGVsZXRlLWRlc2Mta2V5Ym9hcmQiOiJVc2UgYXJyb3dzIHRvIG1vdmUgdGhlIHBvaW50LiBIaXQgRU5URVIgdG8gaW1tZWRpYXRlbHkgYW5kIHBlcm1hbmVudGx5IGRlbGV0ZSBhIGRyYXdpbmcuIFRoaXMgY2Fubm90IGJlIHVuZG9uZS4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1kZWxldGUtdG9vbHRpcCI6IkRlbGV0ZSBhbiBleGlzdGluZyBkcmF3aW5nIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWRpdC16b29taW4tdG9vbCI6Ilpvb21JblRvb2wiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0LXpvb21vdXQtdG9vbCI6Ilpvb21PdXRUb29sIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZXhwb3J0IjoiRXhwb3J0IERyYXdpbmdzIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZXhwb3J0LXRvb2x0aXAiOiJFeHBvcnQgZHJhd2luZ3MgdG8gc2hhcGVmaWxlIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcGFsZXR0ZS1zbWFsbC1jaGFuZ2Utc3R5bGUiOiJTdHlsZXMiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wYWxldHRlLXNtYWxsLWRlbGV0ZSI6IkRlbGV0ZSIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBhbGV0dGUtc21hbGwtZWRpdCI6IkVkaXQiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wYWxldHRlLXNtYWxsLWNsZWFyLWFsbCI6IkNsZWFyIEFsbCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWNoYW5nZS1tYXJrdXAtc3R5bGUiOiJTdHlsZXMiLCJsYW5ndWFnZS10b29sYmFyLW1lbnUtZ2xvYmFsLW9wZW4iOiJPcGVuIiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1vcGVuLWRlc2MiOiJDaG9vc2UgYSBwcmV2aW91c2x5IHNhdmVkIHByb2plY3QgdG8gcmVzdG9yZSB0aGUgc2F2ZWQgc3RhdGUiLCJsYW5ndWFnZS10b29sYmFyLW1lbnUtZ2xvYmFsLXNhdmUiOiJTYXZlIiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1zYXZlLWRlc2MiOiJTYXZlIHRoZSBzdGF0ZSBvZiB5b3VyIHZpZXdlciBpbiBhIHByb2plY3QiLCJsYW5ndWFnZS10b29sYmFyLW1lbnUtZ2xvYmFsLXNhdmUtYXMiOiJTYXZlIGFzIiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1zYXZlLWFzLWRlc2MiOiJTYXZlIHRoZSBzdGF0ZSBvZiB5b3VyIHZpZXdlciBpbiBhIG5ldyBwcm9qZWN0IiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1zYXZlLXNhdmUtYXMiOiJTYXZlL1NhdmUgYXMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWNvbWJpbmUtdW5pb24tZW5hYmxlIjoiRW5hYmxlIEFkZCBSZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1jb21iaW5lLXVuaW9uLWVuYWJsZS10b29sdGlwIjoiRW5hYmxlIGFkZGluZyByZXN1bHRzIHRvIHRoZSBleGlzdGluZyBpZGVudGlmeSByZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1jb21iaW5lLXVuaW9uLWRpc2FibGUiOiJEaXNhYmxlIEFkZCBSZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1jb21iaW5lLXVuaW9uLWRpc2FibGUtdG9vbHRpcCI6IkRpc2FibGUgYWRkaW5nIHJlc3VsdHMgdG8gdGhlIGV4aXN0aW5nIGlkZW50aWZ5IHJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWNvbWJpbmUtc3VidHJhY3QtZW5hYmxlIjoiRW5hYmxlIFN1YnRyYWN0IFJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWNvbWJpbmUtc3VidHJhY3QtZW5hYmxlLXRvb2x0aXAiOiJFbmFibGUgc3VidHJhY3RpbmcgcmVzdWx0cyBmcm9tIHRoZSBleGlzdGluZyBpZGVudGlmeSByZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1jb21iaW5lLXN1YnRyYWN0LWRpc2FibGUiOiJEaXNhYmxlIFN1YnRyYWN0IFJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWNvbWJpbmUtc3VidHJhY3QtZGlzYWJsZS10b29sdGlwIjoiRGlzYWJsZSBzdWJ0cmFjdGluZyByZXN1bHRzIGZyb20gdGhlIGV4aXN0aW5nIGlkZW50aWZ5IHJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvaW50LWRlc2MiOiJDbGljayBvciB0YXAgYSBsb2NhdGlvbiBvbiB0aGUgbWFwIHRvIGxlYXJuIHdoYXTigJlzIHRoZXJlLiIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9pbnQtZGVzYy1rZXlib2FyZCI6IlVzZSBhcnJvd3MgdG8gbW92ZSB0aGUgcG9pbnQuIEhpdCBFTlRFUiB0byBsZWFybiB3aGF04oCZcyB0aGVyZS4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvaW50IjoiUG9pbnQiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvaW50LXRvb2x0aXAiOiJGaW5kIG91dCBhYm91dCBhIGxvY2F0aW9uIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWZyZWVoYW5kIjoiRnJlZWhhbmQiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWZyZWVoYW5kLWRlc2MiOiJDbGljay90YXAgYW5kIGhvbGQgZG93biwgdGhlbiBkcmF3IGEgZnJlZWhhbmQgc2hhcGUgdG8gbGVhcm4gd2hhdOKAmXMgdGhlcmUuIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1mcmVlaGFuZC10b29sdGlwIjoiRmluZCBvdXQgYWJvdXQgYW4gYXJlYSBvbiB0aGUgbWFwIGRlZmluZWQgYnkgYSBmcmVlaGFuZCBzaGFwZSIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktZnJlZWhhbmQtcG9seWdvbiI6IkZyZWVoYW5kIFNoYXBlIElkZW50aWZ5IiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1mcmVlaGFuZC1wb2x5Z29uLWRlc2MiOiJEcmF3IGEgZnJlZWhhbmQgc2hhcGUgb24gdGhlIG1hcCB0byBzZWUgd2hhdCdzIHRoZXJlIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1mcmVlaGFuZC1wb2x5Z29uLXRvb2x0aXAiOiJJZGVudGlmeSB0aGluZ3Mgb24gdGhlIG1hcCBieSBkcmF3aW5nIGEgZnJlZWhhbmQgc2hhcGUiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvbHlsaW5lIjoiTGluZSIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9seWxpbmUtZGVzYyI6IlRvIGxlYXJuIHdoYXTigJlzIHRoZXJlLCBkcmF3IGEgbGluZSBvZiBpbnRlcmVzdCBhbG9uZyB0aGUgbWFwLiBEb3VibGUtY2xpY2svdGFwIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvbHlsaW5lLWRlc2Mta2V5Ym9hcmQiOiJUbyBsZWFybiB3aGF04oCZcyB0aGVyZSwgdXNlIGFycm93cyB0byBtb3ZlIHRoZSBwb2ludC4gSGl0IEVOVEVSIHRvIHBsb3QgYW5kIGJlZ2luIG1vdmluZyB0aGUgbmV4dCBwb2ludC4gSGl0IEVOVEVSIHR3aWNlIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvbHlsaW5lLXRvb2x0aXAiOiJGaW5kIG91dCBhYm91dCBhbiBhcmVhIG9uIHRoZSBtYXAgZGVmaW5lZCBieSBhIGxpbmUiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvbHlnb24iOiJQb2x5Z29uIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1wb2x5Z29uLWRlc2MiOiJUbyBsZWFybiB3aGF04oCZcyB0aGVyZSwgZHJhdyBhIHNoYXBlIG9uIHRoZSBtYXAuIERvdWJsZS1jbGljay90YXAgdG8gZmluaXNoLiIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9seWdvbi1kZXNjLWtleWJvYXJkIjoiVG8gbGVhcm4gd2hhdOKAmXMgdGhlcmUsIHVzZSBhcnJvd3MgdG8gbW92ZSB0aGUgcG9pbnQuIEhpdCBFTlRFUiB0byBwbG90IGFuZCBiZWdpbiBtb3ZpbmcgdGhlIG5leHQgcG9pbnQuIEhpdCBFTlRFUiB0d2ljZSB0byBmaW5pc2guIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1wb2x5Z29uLXRvb2x0aXAiOiJEcmF3IGEgY3VzdG9tIHNoYXBlIG9uIHRoZSBtYXAgdG8gZmluZCBvdXQgYWJvdXQgYW4gYXJlYSIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcmVjdGFuZ2xlIjoiUmVjdGFuZ2xlIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1yZWN0YW5nbGUtZGVzYyI6IlRvIGxlYXJuIHdoYXTigJlzIHRoZXJlLCBjbGljayBvciB0YXAgYW5kIGRyYWcgdG8gZHJhdyBhIHJlY3RhbmdsZSBvbiB0aGUgbWFwLiIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcmVjdGFuZ2xlLXRvb2x0aXAiOiJGaW5kIG91dCBhYm91dCBhbiBhcmVhIG9uIHRoZSBtYXAgZGVmaW5lZCBieSBhIHJlY3RhbmdsZSIsImxhbmd1YWdlLXRvb2xiYXItaW5mb3JtYXRpb24tYWN0aW9ucyI6IkluZm9ybWF0aW9uICYgQWN0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtYWRkLWxheWVycyI6IkFkZCBMYXllcnMiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWFkZC1sYXllcnMtdG9vbHRpcCI6IkFkZCBsYXllcnMgdG8gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtbGF5ZXItY2F0YWxvZyI6IkxheWVyIENhdGFsb2ciLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWxheWVyLWNhdGFsb2ctdG9vbHRpcCI6IkFkZCBsYXllcnMgdG8gdGhlIG1hcCBmcm9tIGEgbGF5ZXIgY2F0YWxvZyIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtaWRlbnRpZnkiOiJJZGVudGlmeSIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtaWRlbnRpZnktdG9vbHRpcCI6IkZpbmQgZGF0YSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1wcmludGluZyI6IlByaW50aW5nIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1wcmludC1tYXAiOiJQcmludCIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtcHJpbnQtbWFwLXRvb2x0aXAiOiJDcmVhdGUgYSBwcmludGFibGUgdmVyc2lvbiBvZiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1leHBvcnQtbWFwIjoiRXhwb3J0IiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1leHBvcnQtbWFwLXRvb2x0aXAiOiJTYXZlIGEgbWFwIGltYWdlIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1zaGFyZSI6IlNoYXJlIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1zaGFyZS10b29sdGlwIjoiU2hhcmUgdGhlIGN1cnJlbnQgbWFwIG9uIHRoZSBtb3N0IGNvbW1vbiBzb2NpYWwgbWVkaWEiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLXVwbG9hZC1kYXRhIjoiVXBsb2FkIERhdGEiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLXVwbG9hZC1kYXRhLXRvb2x0aXAiOiJVcGxvYWQgbGF5ZXJzIGZyb20geW91ciBjb21wdXRlciBvbnRvIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLWZpbmQtZGF0YSI6IkZpbmQgRGF0YSIsImxhbmd1YWdlLXRvb2xiYXItZmluZC1kYXRhLXRvb2xzIjoiRmluZCBEYXRhIFRvb2xzIiwibGFuZ3VhZ2UtdG9vbGJhci1hbmFseXNpcy1sb2NhdGlvbi1pbmZvIjoiTG9jYXRpb24gSW5mbyIsImxhbmd1YWdlLXRvb2xiYXItYW5hbHlzaXMtbG9jYXRpb24taW5mb3JtYXRpb24iOiJMb2NhdGlvbiBJbmZvcm1hdGlvbiIsImxhbmd1YWdlLXRvb2xiYXItYW5hbHlzaXMtbWVhc3VyZW1lbnQtdG9vbHMiOiJNZWFzdXJlIiwibGFuZ3VhZ2UtdG9vbGJhci1ub3QtYXZhaWxhYmxlIjoiVG9vbGJhciBpcyBub3QgYXZhaWxhYmxlIiwibGFuZ3VhZ2UtdG9vbGJhci1lcmFzZSI6IkVyYXNlIiwibGFuZ3VhZ2UtdG9vbGJhci1jbGVhci1hbGwiOiJDbGVhciIsImxhbmd1YWdlLXRvb2xiYXItdG9vbGJhciI6IlRvb2xiYXIiLCJsYW5ndWFnZS10b29sYmFyLW11bHRpdG9vbCI6Ik11bHRpLXRvb2wiLCJsYW5ndWFnZS10b29sYmFyLW9wZW4tdG9vbGJhciI6Ik9wZW4gdG9vbGJhciIsImxhbmd1YWdlLXRvb2xiYXItY2xvc2UtdG9vbGJhciI6IkNsb3NlIHRvb2xiYXIiLCJsYW5ndWFnZS10b29sYmFyLTNyZC1wYXJ0eS1tYXBzLXNob3ctbWFwcyI6IkxpbmtlZCBNYXBzIiwibGFuZ3VhZ2UtdG9vbGJhci0zcmQtcGFydHktbWFwcy1zaG93LW1hcHMtdG9vbHRpcCI6IkRpc3BsYXkgbGlua2VkIG1hcHMgaW4gdGhlIGV4dGVybmFsIGNvbXBvbmVudCB2aWV3IiwibGFuZ3VhZ2UtdG9vbGJhci1idWZmZXItdG9nZ2xlLXRvb2x0aXAiOiJCdWZmZXIgYW4gYXJlYSBhcm91bmQgeW91ciBzZWxlY3Rpb24iLCJsYW5ndWFnZS10b29sYmFyLXRvZ2dsZS1idWZmZXItb24tbmFtZSI6IkJ1ZmZlciBPcHRpb25zIiwibGFuZ3VhZ2UtdG9vbGJhci10b2dnbGUtYnVmZmVyLW9mZi1uYW1lIjoiQnVmZmVyaW5nIE9uIiwibGFuZ3VhZ2UtdG9vbGJhci1zZWxlY3QtbGF5ZXJzLXRvZ2dsZS10b29sdGlwIjoiRmlsdGVyIGxheWVycyBmb3IgSWRlbnRpZnkgcmVzdWx0cyIsImxhbmd1YWdlLXRvb2xiYXItc2VsZWN0LWxheWVycy10b2dnbGUtb24tbmFtZSI6IkZpbHRlciBMYXllcnMiLCJsYW5ndWFnZS10b29sYmFyLXNlbGVjdC1sYXllcnMtdG9nZ2xlLW9mZi1uYW1lIjoiTGF5ZXJzIGFyZSBGaWx0ZXJlZCIsImxhbmd1YWdlLXRvb2xiYXItYnVmZmVyaW5nLWVuYWJsZSI6IkVuYWJsZSBidWZmZXJpbmciLCJsYW5ndWFnZS10b29sYmFyLWJ1ZmZlcmluZy1kaXNhYmxlIjoiRGlzYWJsZSBidWZmZXJpbmciLCJsYW5ndWFnZS10b29sYmFyLXNuYXBwaW5nLWVuYWJsZSI6IkVuYWJsZSBTbmFwcGluZyIsImxhbmd1YWdlLXRvb2xiYXItc25hcHBpbmctZGlzYWJsZSI6IkRpc2FibGUgU25hcHBpbmciLCJsYW5ndWFnZS10b29sYmFyLXNuYXBwaW5nLXNlbGVjdC1sYXllcnMiOiJTZWxlY3QgU25hcHBpbmcgTGF5ZXJzIiwibGFuZ3VhZ2UtdG9vbGJhci1zbmFwcGluZy1zZWxlY3QtbGF5ZXJzLXRvb2x0aXAiOiJDaGFuZ2Ugd2hpY2ggbGF5ZXJzIGFyZSBzbmFwcGFibGUiLCJsYW5ndWFnZS10b29sYmFyLXNuYXBwaW5nLWFsdC1kaXNhYmxlIjoiRGlzYWJsZSBzbmFwcGluZyBmb3IgYWN0aXZlIHRvb2wiLCJsYW5ndWFnZS10b29sYmFyLXNuYXBwaW5nLWFsdC1lbmFibGUiOiJFbmFibGUgc25hcHBpbmcgZm9yIGFjdGl2ZSB0b29sIiwibGFuZ3VhZ2UtdG9vbGJhci1idWZmZXJpbmctYWx0LWRpc2FibGUiOiJEaXNhYmxlIGJ1ZmZlcmluZyBmb3IgYWN0aXZlIHRvb2wiLCJsYW5ndWFnZS10b29sYmFyLWJ1ZmZlcmluZy1hbHQtZW5hYmxlIjoiRW5hYmxlIGJ1ZmZlcmluZyBmb3IgYWN0aXZlIHRvb2wiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXNuYXBwaW5nLXRvb2x0aXAiOiJFbmFibGUvRGlzYWJsZSBzbmFwcGluZyB3aGlsZSBpZGVudGlmeWluZyIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktbGF5ZXJzLWNoYW5nZSI6IklkZW50aWZpYWJsZSBMYXllcnMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWxheWVycy1jaGFuZ2UtdG9vbHRpcCI6IkVuYWJsZS9EaXNhYmxlIGxheWVycyBzZWxlY3RlZCBmb3IgaWRlbnRpZnkgb3BlcmF0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItc2hvdy1sYXllcmxpc3QiOiJMYXllciBMaXN0IiwibGFuZ3VhZ2UtdG9vbGJhci1zaG93LWxheWVybGlzdC1kZXNjIjoiRGlzcGxheSB0aGUgbGlzdCBvZiBhdmFpbGFibGUgbGF5ZXJzIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC10aW1lc2xpZGVyIjoiVGltZSBTbGlkZXIiLCJsYW5ndWFnZS10b29sYmFyLXRpbWVzbGlkZXItc2hvd3RpbWVzbGlkZXIiOiJUaW1lIFNsaWRlciIsImxhbmd1YWdlLXRvb2xiYXItdGltZXNsaWRlci1zaG93dGltZXNsaWRlci10b29sdGlwIjoiQWN0aXZhdGUgdGhlIHRpbWUgc2xpZGVyIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1jb2xsYWJvcmF0aW9uIjoiQ29sbGFib3JhdGlvbiIsImxhbmd1YWdlLXRvb2xiYXItb3Blbi1jb2xsYWJvcmF0aW9uIjoiQ29sbGFib3JhdGlvbiIsImxhbmd1YWdlLXRvb2xiYXItb3Blbi1jb2xsYWJvcmF0aW9uLXRvb2x0aXAiOiJPcGVuIHRoZSBDb2xsYWJvcmF0aW9uIGludGVyZmFjZS4iLCJsYW5ndWFnZS10b29sYmFyLW9wZW4tYWZ0ZXItYWN0aW9uIjoiQWZ0ZXIgQWN0aW9uIFBsYXliYWNrIiwibGFuZ3VhZ2UtdG9vbGJhci1vcGVuLWFmdGVyLWFjdGlvbi10b29sdGlwIjoiT3BlbiB0aGUgQWZ0ZXIgQWN0aW9uIFBsYXliYWNrIGludGVyZmFjZS4iLCJsYW5ndWFnZS10b29sYmFyLXRhYi1jb2xsYWJvcmF0aW9uIjoiQ29sbGFib3JhdGlvbiIsImxhbmd1YWdlLXN0YXRlcy1kZWZhdWx0LWRlc2NyaXB0aW9uIjoiVGhlIHZpZXdlciBjdXJyZW50bHkgaGFzIG5vdGhpbmcgYWN0aXZlLiIsImxhbmd1YWdlLXN0YXRlcy10cmFuc2llbnQtYWN0aXZlLWRlc2NyaXB0aW9uIjoiQXQgbGVhc3Qgb25lIHRyYW5zaWVudCB0b29sYmFyIGlzIGN1cnJlbnRseSBvcGVuLiIsImxhbmd1YWdlLXN0YXRlcy1pZGVudGlmeS1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSBpZGVudGlmeSB0b29sIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2Utc3RhdGVzLWlkZW50aWZ5LWNvbWJpbmUtZGVzY3JpcHRpb24iOiJDb21iaW5pbmcgaXMgZW5hYmxlZCBmb3IgdGhlIGlkZW50aWZ5IHRvb2wuIiwibGFuZ3VhZ2Utc3RhdGVzLXBsb3Rjb29yZGluYXRlcy1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSBQbG90IENvb3JkaW5hdGVzIHRvb2wgaXMgY3VycmVudGx5IGFjdGl2ZS4iLCJsYW5ndWFnZS1zdGF0ZXMtZHJhdy1tYXJrdXAtc3RhdGUtZGVzY3JpcHRpb24iOiJUaGUgZHJhdyB0b29sIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2Utc3RhdGVzLW1lYXN1cmUtc3RhdGUtZGVzY3JpcHRpb24iOiJUaGUgbWVhc3VyaW5nIHRvb2wgaXMgY3VycmVudGx5IGFjdGl2ZS4iLCJsYW5ndWFnZS1zdGF0ZXMtZWRpdC1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSB0b29sIHRvIHNlbGVjdCBhbiBpdGVtIGZvciBlZGl0aW5nIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2Utc3RhdGVzLWVkaXRpbmctc3RhdGUtZGVzY3JpcHRpb24iOiJBIGRyYXdpbmcgaXMgYWN0aXZlbHkgYmVpbmcgZWRpdGVkLiIsImxhbmd1YWdlLXN0YXRlcy1mZWF0dXJlLWVkaXRpbmctc3RhdGUtZGVzY3JpcHRpb24iOiJUaGUgY3JlYXRlIGEgZmVhdHVyZSB0b29sIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2Utc3RhdGVzLWZlYXR1cmUtZWRpdGluZy1zdGF0ZS1ncmFwaGljLWRlc2NyaXB0aW9uIjoiVGhlIGNyZWF0ZSBhIGZlYXR1cmUgdG9vbCBpcyBjdXJyZW50bHkgZWRpdGluZyBhIGdyYXBoaWMuIiwibGFuZ3VhZ2Utc3RhdGVzLWZlYXR1cmUtZWRpdGluZy1zdGF0ZS1wb2ludC1ncmFwaGljLWRlc2NyaXB0aW9uIjoiVGhlIGNyZWF0ZSBhIGZlYXR1cmUgdG9vbCBpcyBjdXJyZW50bHkgZWRpdGluZyBhIHBvaW50LWJhc2VkIGdyYXBoaWMuIiwibGFuZ3VhZ2Utc3RhdGVzLWVkaXRpbmctYWN0aXZlLXN0YXRlLWRlc2NyaXB0aW9uIjoiVGhlIGZlYXR1cmUgZWRpdG9yIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2Utc3RhdGVzLWJ1ZmZlcmluZy1kZXNjcmlwdGlvbiI6IkJ1ZmZlcmluZyBpcyBlbmFibGVkIGZvciB0aGUgY3VycmVudCB0b29sLiIsImxhbmd1YWdlLXN0YXRlcy1zbmFwcGluZy1kZXNjcmlwdGlvbiI6IlNuYXBwaW5nIGlzIGVuYWJsZWQgZm9yIHRoZSBjdXJyZW50IHRvb2wuIn0=");
});