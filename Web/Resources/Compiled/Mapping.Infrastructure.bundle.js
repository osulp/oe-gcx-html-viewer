require({cache:{"geocortex/infrastructure/accessibility/AccessibilityManager":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._registeredComponentTypes={"esri.toolbars.draw":"esri.toolbars.Draw","esri.toolbars.edit":"esri.toolbars.Edit","geocortex.accessibility.draw":"geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Draw","geocortex.accessibility.edit":"geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Edit"},this._stack=[],this.app=e,this.app.event("AccessibleComponentStartedEvent").subscribe(this,this._handleAccessibleComponentStarted),this.app.event("AccessibleComponentCompletedEvent").subscribe(this,this._handleAccessibleComponentCompleted)}return e.prototype.registerComponent=function(e,t){if(null==e||null==t)throw new Error("[AccessibilityManager::registerComponent] Null name or typeName passed to registerComponent");this._registeredComponentTypes[e]=t},e.prototype.unregisterComponent=function(e){return!(!e||!this._registeredComponentTypes.hasOwnProperty(e))&&(delete this._registeredComponentTypes[e],!0)},e.prototype.createComponent=function(e,t,o){if(e&&this._registeredComponentTypes.hasOwnProperty(e)){var i=this._registeredComponentTypes[e],s=dojo.getObject(i);if(s)return new s(t,o,this.app);this.app.trace.warning("Could not create component '{0}' from type name '{1}'".format(e,i))}return null},e.prototype._handleAccessibleComponentStarted=function(e){if(e&&this._stack){var t=this._stack.indexOf(e);t>-1&&this._stack.splice(t,1),this._stack.forEach(function(e){return!e.suspended&&e.suspend()}),this._stack.push(e),e.resume()}},e.prototype._handleAccessibleComponentCompleted=function(e){if(e&&this._stack&&0!=this._stack.length){var t=this._stack.indexOf(e);t>-1&&(this._stack.splice(t,1),!e.suspended&&e.suspend()),this._stack.length>0&&this._stack[this._stack.length-1].resume()}},e}();t.AccessibilityManager=o})},"geocortex/infrastructure/accessibility/AccessibilityProviderBase":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){e.id&&(this.id=e.id)},e}();t.AccessibilityProviderBase=o})},"geocortex/infrastructure/accessibility/AccessibleMapComponent":function(){define(["require","exports","geocortex/framework/utils/utils","./InputMethod"],function(e,t,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.inputMethod=null,this.suspended=!1,this.isKeyboardActive=!1,this.id=o.alphaNumericToken(),this._map=null,this._mapNavState=null,this._mouseDownHandle=null,this._keyDownHandle=null,this._keyUpHandle=null,this.setMap(e),this.setApp(t)}return e.prototype.setMap=function(e){this._map=e},e.prototype.setApp=function(e){this.app=e},e.prototype.setInputMethod=function(e){if(e!==this.inputMethod){var t=this.inputMethod;this.inputMethod=e,this.onInputMethodChange({previousMethod:t,newMethod:this.inputMethod})}},e.prototype.setKeyboardActive=function(e){this.isKeyboardActive=e},e.prototype.suspend=function(){this.suspended=!0},e.prototype.resume=function(){this.suspended=!1},e.prototype.disableMapNavigation=function(e,t,o){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===o&&(o=!0);var i=this._map;return this._mapNavState={isDoubleClickZoom:i.isDoubleClickZoom,isClickRecenter:i.isClickRecenter,isPan:i.isPan,isRubberBandZoom:i.isRubberBandZoom,isKeyboardNavigation:i.isKeyboardNavigation,isScrollWheelZoom:i.isScrollWheelZoom,isShiftDoubleClickZoom:i.isShiftDoubleClickZoom,isPanArrows:i.isPanArrows,isZoomSlider:i.isZoomSlider},i.disableDoubleClickZoom(),i.disableClickRecenter(),i.disablePan(),i.disableRubberBandZoom(),i.disableKeyboardNavigation(),i.disableScrollWheelZoom(),i.disableShiftDoubleClickZoom(),e&&i.isZoomSlider&&i.hideZoomSlider(),t&&i.isPanArrows&&i.hidePanArrows(),o&&i.graphics.disableMouseEvents(),this._mapNavState},e.prototype.enableMapNavigation=function(e,t,o,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===o&&(o=!0);var s=this._map,n=i||this._mapNavState;n&&(n.isDoubleClickZoom&&s.enableDoubleClickZoom(),n.isClickRecenter&&s.enableClickRecenter(),n.isPan&&s.enablePan(),n.isRubberBandZoom&&s.enableRubberBandZoom(),n.isKeyboardNavigation&&s.enableKeyboardNavigation(),n.isScrollWheelZoom&&s.enableScrollWheelZoom(),n.isShiftDoubleClickZoom&&s.enableShiftDoubleClickZoom(),e&&n.isZoomSlider&&s.showZoomSlider(),t&&n.isPanArrows&&s.showPanArrows(),o&&s.graphics.enableMouseEvents())},e.prototype.getMapState=function(){return this._mapNavState},e.prototype.activateMouseControls=function(e){var t=this;void 0===e&&(e=!0),this.deactivateMouseControls(e),this._mouseDownHandle=this.app.map.on("mouse-down",function(){t._mouseDownHandle.remove(),t._mouseDownHandle=null,t.setInputMethod(i.InputMethod.MOUSE)})},e.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),this._mouseDownHandle&&(this._mouseDownHandle.remove(),this._mouseDownHandle=null),e&&this.inputMethod===i.InputMethod.MOUSE&&this.setInputMethod(null)},e.prototype.activateKeyboardControls=function(e){void 0===e&&(e=!0),this.isKeyboardActive&&this.deactivateKeyboardControls(e),this.setKeyboardActive(!0),this._keyDownHandle=dojo.on(this._map.root,"keydown",dojo.hitch(this,"_onKeyDown")),this._keyUpHandle=dojo.on(this._map.root,"keyup",dojo.hitch(this,"_onKeyUp")),this.app.event("AccessibleComponentStartedEvent").publish(this)},e.prototype.deactivateKeyboardControls=function(e){void 0===e&&(e=!0),this.setKeyboardActive(!1),this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null),e&&this.inputMethod===i.InputMethod.KEYBOARD&&this.setInputMethod(null),this.app.event("AccessibleComponentCompletedEvent").publish(this)},e.prototype.toggleKeyboardMode=function(){this.inputMethod===i.InputMethod.KEYBOARD?this.onKeyboardStop():this.onKeyboardStart()},e.prototype.onInputMethodChange=function(e){this.app.event("InputMethodChangedEvent").publish(e)},e.prototype.onKeyboardStart=function(){this._mouseDownHandle&&(this._mouseDownHandle.remove(),this._mouseDownHandle=null),this.setInputMethod(i.InputMethod.KEYBOARD)},e.prototype.onKeyboardStop=function(e){void 0===e&&(e=!1),this.setInputMethod(null)},e.prototype._onKeyDown=function(e){},e.prototype._onKeyUp=function(e){},e}();t.AccessibleMapComponent=s})},"geocortex/infrastructure/accessibility/BoxEditor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./EditCapabilityBase","./../GeometryUtils","geocortex/framework/utils/utils","./../MatrixUtils"],function(t,o,i,s,n,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(e,o,i,s,n){var r=t.call(this,e,o,i)||this;r._options={rotateEnabled:!1,scaleEnabled:!1,uniformScaling:!1,rotationAngle:15,preciseRotationAngle:1,scaleFactor:.2,preciseScaleFactor:.01},r._scaleEnabled=!1,r._rotateEnabled=!1,r._uniformScaling=!1,r._isTextPoint=!1,r._modified=!1,r._isRotating=!1,r._isScaling=!1,r._lineSymbol=null,r._markerSymbol=null,r._transform=null,r._keyDownHandle=null,r._keyUpHandle=null,r._options=dojo.mixin(r._options,n||{});var a=i.getOptions();return r._markerSymbol=r._options.boxHandleSymbol?r._options.boxHandleSymbol:a.boxHandleSymbol,r._lineSymbol=r._options.boxLineSymbol?r._options.boxLineSymbol:a.boxLineSymbol,r._scaleEnabled=!!r._options.scaleEnabled,r._rotateEnabled=!!r._options.rotateEnabled,r._uniformScaling=!!r._options.uniformScaling,r._isTextPoint=s,r._init(),r}return e(o,t),o.prototype.destroy=function(){t.prototype.destroy.call(this),this._cleanUp()},o.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler")),this._keyUpHandle=dojo.on(this.map.root,"keyup",dojo.hitch(this,"_onKeyUpHandler"))},o.prototype._cleanUp=function(){this._scaleEnabled=this._rotateEnabled=this._uniformScaling=this._isTextPoint=!1,this._isRotating=this._isScaling=this._modified=!1,this._lineSymbol=this._markerSymbol=this._transform=null,this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null)},o.prototype._onKeyDownHandler=function(e){if(!this.suspended){var t=e.altKey,o=e.shiftKey,i=!1,s=t?this._options.preciseScaleFactor:this._options.scaleFactor,n=t?this._options.preciseRotationAngle:this._options.rotationAngle,r=e.keyCode||e.which;if(this._scaleEnabled)switch(r){case 83:s=o?-1*s:s,this._scaleGraphic(1+s,1+s),i=!0}if(this._rotateEnabled)switch(r){case 82:n=o?-1*n:n,this._rotateGraphic(n),i=!0}i&&(e.preventDefault(),e.stopPropagation())}},o.prototype._onKeyUpHandler=function(e){if(!this.suspended){e.altKey;var t=e.keyCode||e.which,o=!1;if(this._scaleEnabled)switch(t){case 83:this._isScaling=!1,this.owner.onScaleStop(this.graphic,this._transform),o=!0}if(this._rotateEnabled)switch(t){case 82:this._isRotating=!1,this.owner.onRotateStop(this.graphic,this._transform),o=!0}o&&(e.preventDefault(),e.stopPropagation())}},o.prototype._rotateGraphic=function(e,t){this._isRotating||(this.owner.onRotateStart(this.graphic),this.owner.onRotateFirstMove(this.graphic),this._isRotating=!0);var o=this.graphic.geometry,i=t||s.getMiddle(o);if(s.isValidGeometry(o)&&!n.isNullOrUndefined(i)){var a=r.MatrixUtils.rotate(o,this.map,e,i);if(this._transform=a.transform,this._modified=!0,this._isTextPoint){var p=this.graphic.symbol;p.angle+=e,this.graphic.setSymbol(p)}else this.graphic.setGeometry(a.geometry);var h={transform:a.transform,angle:e,scaleX:1,scaleY:1,around:this.map.toScreen(i)};this.owner.refresh(),this.owner.onRotate(this.graphic,h)}},o.prototype._scaleGraphic=function(e,t){this._isScaling||(this.owner.onScaleStart(this.graphic),this.owner.onScaleFirstMove(this.graphic),this._isScaling=!0),null!==t&&void 0!==t||(t=e);var o=this.graphic.geometry,i=r.MatrixUtils.scale(o,this.map,e,t);if(this._transform=i.transform,this._modified=!0,this._isTextPoint){var s=this.graphic.symbol;s.font.setSize(Math.round(100*s.font.size*e)/100),this.graphic.setSymbol(s)}else this.graphic.setGeometry(i.geometry);var n={transform:i.transform,angle:0,scaleX:e,scaleY:t,around:null};this.owner.refresh(),this.owner.onScale(this.graphic,n)},o}(i.EditCapabilityBase);o.BoxEditor=a})},"geocortex/infrastructure/accessibility/BoxEditorOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/Draw":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./AccessibleMapComponent","./Edit","./InputMethod","./../GeometryUtils"],function(t,o,i,s,n,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(o){function i(e,t,i){var s=o.call(this,e,i)||this;s.respectDrawingVertexOrder=!1,s._arrowShapeTemplate=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],s._leftArrowShapeTemplate=[[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],s._rightArrowShapeTemplate=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],s._upArrowShapeTemplate=[[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],s._downArrowShapeTemplate=[[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],s._triangleShapeTemplate=[[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],s._rectangleShapeTemplate=[[0,-48],[96,-48],[96,0],[0,0],[0,-48]],s._drawObject=null,s._editObject=null,s._options=null,s._defaultOptions=null,s._active=!1,s._graphic=null,s._createGeometryDeferred=null,s._isPlottingPolyGeometry=!1,s._lastVertexPosition=null,s._vertexAnchor=null,s._ghostLine=null,s._handles=[],s._polyGeometryKeyDownHandle=null,s._editCompletedHandle=null,s._dblClickHandlerToken=null,s._lastSnappingPoint=null;var n=Modernizr&&!!Modernizr.touch,r={enableEditing:!0,vertexOffsetX:10,vertexOffsetY:10,preciseVertexOffsetX:1,preciseVertexOffsetY:1,vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([128,128,128])),selectedVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?25:15,null,new esri.Color([0,0,255,.75]))};return s._defaultOptions=dojo.mixin(r,t||{}),s._points=[],s._drawObject=new esri.toolbars.Draw(e,t),s._twoClicksWithin300MsFixup(),s._editObject=new p(e,null,i),s.fillSymbol=s._drawObject.fillSymbol,s.lineSymbol=s._drawObject.lineSymbol,s.markerSymbol=s._drawObject.markerSymbol,s.respectDrawingVertexOrder=s._drawObject.respectDrawingVertexOrder,s.setVertexSymbol(s._defaultOptions.vertexSymbol),s.setSelectedVertexSymbol(s._defaultOptions.selectedVertexSymbol),s.app&&s.app.event("SnappingFeedbackEvent").subscribe(s,s._handleSnappingEvent),s}return e(i,o),i.createEllipse=function(e){for(var t=e.center,o=e.longAxis||48,i=e.shortAxis||24,s=e.numberOfPoints||60,n=e.map,r=[],a=2*Math.PI/s,p=0;p<s;p++){var h=Math.cos(p*a),l=Math.sin(p*a),c=n.toMap(new esri.geometry.ScreenPoint({x:o*h+t.x,y:i*l+t.y}));r.push(c)}r.push(r[0]);var d=new esri.geometry.Polygon(n.spatialReference);return d.addRing(r),d},i.createCircle=function(e){return i.createEllipse({center:e.center,longAxis:e.radius,shortAxis:e.radius,numberOfPoints:e.numberOfPoints,map:e.map})},i.prototype.activate=function(e,t){var o=this;(this._active||this._geometryType)&&this.deactivate(),this._handles.push(this.app.map.on("click",function(e){return o.app.trace.debug("[DrawTool] map-click")})),this._handles.push(this.app.map.on("dbl-click",function(e){return o.app.trace.debug("[DrawTool] map-double-click")})),this._active=!0,this._geometryType=e,this._options=dojo.mixin(dojo.mixin({},this._defaultOptions),t||{}),e===i.MULTI_POINT&&(this._options.enableEditing=!1),this.setVertexSymbol(this._options.vertexSymbol),this.setSelectedVertexSymbol(this._options.selectedVertexSymbol),this._handles.push(dojo.aspect.after(this._drawObject,"onDrawEnd",dojo.hitch(this,"onDrawEnd"),!0)),this._handles.push(dojo.aspect.after(this._drawObject,"onDrawComplete",dojo.hitch(this,"onDrawComplete"),!0)),this._drawObject&&"function"==typeof this._drawObject._onClickHandler&&this._handles.push(dojo.aspect.after(this._drawObject,"_onClickHandler",dojo.hitch(this,"_onClickHandler"),!0)),this._extraPointOnTouchDevicesFixup(),this.activateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.activateKeyboardControls(),this.onActivate(),this.raiseGraphicDrawActivated({sender:this,geometryType:e})},i.prototype.deactivate=function(){var e=this._geometryType;this._active=!1,this._clear(),this.setInputMethod(null),this._dblClickHandlerToken&&(this._dblClickHandlerToken.remove(),this._dblClickHandlerToken=null),this._handles.forEach(function(e){e.remove()}),this._handles.length=0,this._geometryType=this.vertexSymbol=this.selectedVertexSymbol=null,this.onDeactivate(),this.raiseGraphicDrawDeactivated({sender:this,geometryType:e})},i.prototype.finishDrawing=function(){switch(this.inputMethod){case n.InputMethod.MOUSE:this._drawObject.finishDrawing(),this._syncPointsCollection();break;case n.InputMethod.KEYBOARD:this._finishKeyboardDrawing()}},i.prototype.setFillSymbol=function(e){this.fillSymbol=e,this._drawObject.setFillSymbol(e)},i.prototype.setLineSymbol=function(e){this.lineSymbol=e,this._drawObject.setLineSymbol(e)},i.prototype.setMarkerSymbol=function(e){this.markerSymbol=e,this._drawObject.setMarkerSymbol(e)},i.prototype.setRespectDrawingVertexOrder=function(e){this.respectDrawingVertexOrder=e,this._drawObject.setRespectDrawingVertexOrder(e)},i.prototype.setVertexSymbol=function(e){this.vertexSymbol=e},i.prototype.setSelectedVertexSymbol=function(e){this.selectedVertexSymbol=e},i.prototype.activateMouseControls=function(e){void 0===e&&(e=!0),o.prototype.activateMouseControls.call(this,e),this._geometryType&&(this._drawObject.__attached_stopEvent=!0,this._drawObject.activate(this._geometryType,this._options))},i.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),o.prototype.deactivateMouseControls.call(this,e),this._drawObject.__attached_stopEvent=!0,this._drawObject.deactivate()},i.prototype.raiseGraphicDrawActivated=function(e){this.app.event("GraphicDrawActivatedEvent").publish(e)},i.prototype.raiseGraphicDrawDeactivated=function(e){this.app.event("GraphicDrawDeactivatedEvent").publish(e)},i.prototype.raiseGraphicVertexAdded=function(e){this.app.event("GraphicVertexAddedEvent").publish(e)},i.prototype.raiseGraphicVertexMoved=function(e){this.app.event("GraphicVertexMovedEvent").publish(e)},i.prototype.on=function(e,t){throw new Error("[geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibilit.Draw::on] On style events not implemented yet. Use connect instead.")},i.prototype.onActivate=function(){},i.prototype.onDeactivate=function(){},i.prototype.onDrawComplete=function(e){this.inputMethod==n.InputMethod.MOUSE&&this._clear()},i.prototype.onDrawEnd=function(e){this.app.trace.debug("[DrawTool] Number of vertices drawn "+this._vertexCount(e)),this.inputMethod==n.InputMethod.MOUSE&&this._clear(),this.app.event("GraphicDrawCompletedEvent").publish(e)},i.prototype.onKeyboardStart=function(){var e=this;o.prototype.onKeyboardStart.call(this),this.deactivateMouseControls();var t=this._map.extent.getCenter();this._plotShape(t,this._geometryType).then(function(t){return e._editShape(t)})},i.prototype.onKeyboardStop=function(e){if(void 0===e&&(e=!1),o.prototype.onKeyboardStop.call(this,e),this._graphic&&!e){var t=this._graphic.geometry;this._clear(),this._drawEnd(t)}else this._clear()},i.prototype._onKeyDown=function(e){if(o.prototype._onKeyDown.call(this,e),!this.suspended&&this._active&&this.inputMethod!==n.InputMethod.MOUSE){var t=!1;switch(e.keyCode||e.which){case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:this.toggleKeyboardMode(),t=!0;break;case dojo.keys.ESCAPE:this.onKeyboardStop(!0),t=!0}t&&(e.preventDefault(),e.stopPropagation())}},i.prototype._onClickHandler=function(e){this.inputMethod===n.InputMethod.MOUSE&&this._syncPointsCollection()},i.prototype._supportsKeyboardInput=function(e){switch(e){case i.ARROW:case i.CIRCLE:case i.DOWN_ARROW:case i.ELLIPSE:case i.EXTENT:case i.LEFT_ARROW:case i.MULTI_POINT:case i.POINT:case i.POLYGON:case i.POLYLINE:case i.RECTANGLE:case i.RIGHT_ARROW:case i.TRIANGLE:case i.UP_ARROW:return!0}return!1},i.prototype._finishKeyboardDrawing=function(e){if(void 0===e&&(e=!0),this._active){var t,o=this._map.spatialReference,s=this._points.slice(0,this._points.length);switch(this._geometryType){case i.POLYLINE:if(!this._graphic||s.length<2)return;(t=new esri.geometry.Polyline(o)).addPath(s),this._graphic.setGeometry(t);break;case i.POLYGON:if(!this._graphic||s.length<2)return;s.push(s[0].offset(0,0)),esri.geometry.Polygon.prototype.isClockwise(s)||this.respectDrawingVertexOrder||(this.app.trace.debug("Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),s.reverse()),(t=new esri.geometry.Polygon(o)).addRing(s),this._graphic.setGeometry(t);break;case i.MULTI_POINT:t=new esri.geometry.Multipoint(o),s.forEach(function(e){t.addPoint(e)}),this._graphic.setGeometry(t);break;default:if(!this._graphic||!this._graphic.geometry)return;t=this._graphic.geometry}e&&this.onKeyboardStop()}},i.prototype._clear=function(){this._graphic&&this._map.graphics.remove(this._graphic),this._ghostLine&&this._map.graphics.remove(this._ghostLine),this._vertexAnchor&&this._map.graphics.remove(this._vertexAnchor),this._editCompletedHandle&&this._editCompletedHandle.remove(),this._polyGeometryKeyDownHandle&&this._polyGeometryKeyDownHandle.remove(),this._editObject&&this._editObject.deactivate(),this._polyGeometryKeyDownHandle=this._editCompletedHandle=this._createGeometryDeferred=this._graphic=this._vertexAnchor=this._ghostLine=null,this._isPlottingPolyGeometry=!1,this._lastVertexPosition=null,this.suspended=!1,this._points.length=0,this.deactivateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.deactivateKeyboardControls(),this.setInputMethod(null),this._active&&(this.activateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.activateKeyboardControls())},i.prototype._drawEnd=function(e){if(e){this.onDrawEnd(e);var t,o=this._map.spatialReference;o&&(o.isWebMercator()?t=esri.geometry.webMercatorToGeographic(e):4326===o.wkid&&(t=esri.geometry.fromJson(e.toJson()))),this.onDrawComplete({geometry:e,geographicGeometry:t})}},i.prototype._moveVertexAnchor=function(e,t){if(this._vertexAnchor&&!isNaN(e)&&!isNaN(t)){var o=this._vertexAnchor.geometry,s=this._map.toMap(this._map.toScreen(o).offset(e,t)),n=s.x-o.x,r=s.y-o.y,a=o.offset(n,r);[i.POLYLINE,i.POLYGON].indexOf(this._geometryType)>-1&&this._updateGhostLine(a),this._vertexAnchor.setGeometry(a).setSymbol(this.selectedVertexSymbol),this._vertexAnchor.getDojoShape().moveToFront();var p={sender:this,mapPoint:a,screenPoint:this._map.toScreen(a),snappingPoint:this._lastSnappingPoint};this.raiseGraphicVertexMoved(p)}},i.prototype._handleSnappingEvent=function(e){this._active&&this._editObject.isActive()||(this._lastSnappingPoint=e.snappingPoint,this._lastSnappingPoint&&this._ghostLine&&this._updateGhostLine(this._lastSnappingPoint))},i.prototype._updateGhostLine=function(e){if(this._points&&this._points.length>0){var t=this._points[this._points.length-1],o=this._ghostLine.geometry;o.setPoint(0,0,t.offset(0,0)),o.setPoint(0,1,e),this._ghostLine.setGeometry(o)}},i.prototype._addVertex=function(e){var t=e;this._lastSnappingPoint&&(e=this._lastSnappingPoint);var o,s,n,r;switch(this._points.push(e.offset(0,0)),this._geometryType){case i.POLYLINE:1===this._points.length?((o=new esri.geometry.Polyline(this._map.spatialReference)).addPath(this._points),this._graphic=this._map.graphics.add(new esri.Graphic(o,this.lineSymbol)),(r=new esri.geometry.Polyline(this._map.spatialReference)).addPath([e.offset(0,0),e.offset(0,0)]),this._ghostLine=this._map.graphics.add(new esri.Graphic(r,this.lineSymbol))):((o=this._graphic.geometry).insertPoint(0,o.paths[0].length,e.offset(0,0)),this._graphic.setGeometry(o).setSymbol(this.lineSymbol),(r=this._ghostLine.geometry).setPoint(0,0,e.offset(0,0)),r.setPoint(0,1,e.offset(0,0)),this._ghostLine.setGeometry(r));break;case i.POLYGON:1===this._points.length?((s=new esri.geometry.Polygon(this._map.spatialReference)).addRing(this._points),this._graphic=this._map.graphics.add(new esri.Graphic(s,this.fillSymbol)),(r=new esri.geometry.Polyline(this._map.spatialReference)).addPath([e.offset(0,0),e.offset(0,0)]),this._ghostLine=this._map.graphics.add(new esri.Graphic(r,this.fillSymbol))):((s=this._graphic.geometry).insertPoint(0,s.rings[0].length,e.offset(0,0)),this._graphic.setGeometry(s).setSymbol(this.fillSymbol),(r=this._ghostLine.geometry).setPoint(0,0,e.offset(0,0)),r.setPoint(0,1,e.offset(0,0)),this._ghostLine.setGeometry(r));break;case i.MULTI_POINT:1===this._points.length?((n=new esri.geometry.Multipoint(this._map.spatialReference)).addPoint(e.offset(0,0)),this._graphic=this._map.graphics.add(new esri.Graphic(n,this.markerSymbol))):((n=this._graphic.geometry).addPoint(e.offset(0,0)),this._graphic.setGeometry(n).setSymbol(this.markerSymbol))}this._lastVertexPosition=t.offset(0,0),this._vertexAnchor.setGeometry(t.offset(0,0)).setSymbol(this.selectedVertexSymbol),this._vertexAnchor.getDojoShape().moveToFront()},i.prototype._drawPolyGeometry=function(e,t){var o=this;if(!e||this._isPlottingPolyGeometry)return Promise.resolve(null);this._lastSnappingPoint&&(e=this._lastSnappingPoint),this._isPlottingPolyGeometry=!0,this.app.map.disableMapNavigation(),this.suspend(),this._lastVertexPosition=null,this._vertexAnchor=this._map.graphics.add(new esri.Graphic(e.offset(0,0),this.selectedVertexSymbol));var i={sender:this,mapPoint:e,screenPoint:this._map.toScreen(e),snappingPoint:this._lastSnappingPoint};this.raiseGraphicVertexMoved(i),this._polyGeometryKeyDownHandle&&(this._polyGeometryKeyDownHandle.remove(),this._polyGeometryKeyDownHandle=null);var s=null;return new Promise(function(e,t){return o._polyGeometryKeyDownHandle=o._drawPolyGeometry_handleKeyDown(e,t)}).then(function(e){return s=e}).catch(function(){return o.onKeyboardStop(!0),s=null}).lastly(function(){return o._isPlottingPolyGeometry=!1,o.app.map.enableMapNavigation(),o._polyGeometryKeyDownHandle&&(o._polyGeometryKeyDownHandle.remove(),o._polyGeometryKeyDownHandle=null),o.resume(),s})},i.prototype._drawPolyGeometry_handleKeyDown=function(e,t){var o=this;return dojo.on(this._map.root,"keydown",function(i){var s=i.altKey,n=s?o._options.preciseVertexOffsetX:o._options.vertexOffsetX,a=s?o._options.preciseVertexOffsetY:o._options.vertexOffsetY;switch(i.keyCode||i.which){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:o._moveVertexAnchor(0,-a);break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:o._moveVertexAnchor(n,0);break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:o._moveVertexAnchor(0,a);break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:o._moveVertexAnchor(-n,0);break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:o._moveVertexAnchor(n,-a);break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:o._moveVertexAnchor(n,a);break;case dojo.keys.END:case dojo.keys.NUMPAD_1:o._moveVertexAnchor(-n,a);break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:o._moveVertexAnchor(-n,-a);break;case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:if(r.pointsAreEqual(o._vertexAnchor.geometry,o._lastVertexPosition))o._graphic&&o._map.graphics.remove(o._graphic),o._vertexAnchor&&o._map.graphics.remove(o._vertexAnchor),o._finishKeyboardDrawing(!1),e(o._graphic?o._graphic.geometry:null);else{var p=o._vertexAnchor.geometry;o._addVertex(p);var h={sender:o,mapPoint:p,screenPoint:o._map.toScreen(p),snappingPoint:o._lastSnappingPoint};o.raiseGraphicVertexAdded(h)}break;case dojo.keys.ESCAPE:t(null);break;default:return}i.preventDefault(),i.stopPropagation()})},i.prototype._plotShape=function(e,t){var o=this._map.toScreen(e);switch(t){case i.POINT:return Promise.resolve(e.offset(0,0));case i.POLYLINE:case i.POLYGON:case i.MULTI_POINT:return this._drawPolyGeometry(e,t);case i.ARROW:return Promise.resolve(this._toPolygon(this._arrowShapeTemplate,o.x,o.y));case i.LEFT_ARROW:return Promise.resolve(this._toPolygon(this._leftArrowShapeTemplate,o.x,o.y));case i.RIGHT_ARROW:return Promise.resolve(this._toPolygon(this._rightArrowShapeTemplate,o.x,o.y));case i.UP_ARROW:return Promise.resolve(this._toPolygon(this._upArrowShapeTemplate,o.x,o.y));case i.DOWN_ARROW:return Promise.resolve(this._toPolygon(this._downArrowShapeTemplate,o.x,o.y));case i.TRIANGLE:return Promise.resolve(this._toPolygon(this._triangleShapeTemplate,o.x,o.y));case i.RECTANGLE:case i.EXTENT:return Promise.resolve(this._toPolygon(this._rectangleShapeTemplate,o.x-48,o.y+24));case i.CIRCLE:var s=i.createCircle({center:o,radius:48,numberOfPoints:60,map:this._map});return Promise.resolve(s);case i.ELLIPSE:var n=i.createEllipse({center:o,longAxis:48,shortAxis:24,numberOfPoints:60,map:this._map});return Promise.resolve(n)}return Promise.resolve(null)},i.prototype._editShape=function(e){if(e){if(!1===this._options.enableEditing)return this._clear(),void this._drawEnd(e);this.suspend();var t;switch(e.type){case"point":case"multipoint":t=this.markerSymbol;break;case"polyline":t=this.lineSymbol;break;case"polygon":case"extent":t=this.fillSymbol}var o=this._getEditMode(this._geometryType);this._graphic=this._map.graphics.add(new esri.Graphic(e,t)),this._editCompletedHandle&&(this._editCompletedHandle.remove(),this._editCompletedHandle=null),this._editCompletedHandle=dojo.aspect.after(this._editObject,"onDeactivate",dojo.hitch(this,"_onEditShapeCompleted"),!0),this._editObject.activate(o.mode,this._graphic,o.options)}},i.prototype._onEditShapeCompleted=function(e,t,o){var i=!!o&&!!o.isModified,s=!!o&&!!o.cancelled;t&&i&&(this._graphic=t),this.resume(),this.onKeyboardStop(s)},i.prototype._toPolygon=function(e,t,o){var i=this._map,s=e.map(function(e){return i.toMap(new esri.geometry.ScreenPoint(e[0]+t,e[1]+o))}),n=new esri.geometry.Polygon(i.spatialReference);return n.addRing(s),n},i.prototype._syncPointsCollection=function(){this._points=this._drawObject._points},i.prototype._getEditMode=function(e){var t={mode:0,options:{}};switch(e){case i.POINT:t.mode=s.Edit.MOVE;break;case i.MULTI_POINT:t.mode=s.Edit.EDIT_VERTICES,t.options.allowAddVertices=!1,t.options.allowDeleteVertices=!0;break;case i.POLYLINE:case i.ARROW:case i.LEFT_ARROW:case i.RIGHT_ARROW:case i.UP_ARROW:case i.DOWN_ARROW:case i.TRIANGLE:case i.RECTANGLE:case i.POLYGON:t.mode=s.Edit.MOVE|s.Edit.ROTATE|s.Edit.SCALE|s.Edit.EDIT_VERTICES,t.options.allowAddVertices=!0,t.options.allowDeleteVertices=!0,t.options.uniformScaling=!1;break;case i.EXTENT:t.mode=s.Edit.MOVE|s.Edit.SCALE,t.options.allowAddVertices=!1,t.options.allowDeleteVertices=!1,t.options.uniformScaling=!1;break;case i.CIRCLE:t.mode=s.Edit.MOVE|s.Edit.SCALE,t.options.uniformScaling=!0;break;case i.ELLIPSE:t.mode=s.Edit.MOVE|s.Edit.ROTATE|s.Edit.SCALE,t.options.uniformScaling=!1}return t},i.prototype._vertexCount=function(e){return e&&"polyline"===e.type?e.paths[0].length:e&&"polygon"===e.type?e.rings[0].length-1:e&&"multipoint"===e.type?e.points.length:0},i.prototype._twoClicksWithin300MsFixup=function(){var e=this,t=this._drawObject;if(t&&"function"==typeof t._onClickHandler){var o=t._onClickHandler;t._onClickHandler=function(t){return e._twoClicksWithin300MsFixup_handleClick(t,o)}}else this.app.trace.warning("The _drawObject _onClickHandler hook is dysfunctional. Markup and Measurement (tool) functionality may be affected on touch devices.")},i.prototype._twoClicksWithin300MsFixup_handleClick=function(e,t){var o=!1,s=0,n=0;if(this._geometryType===i.POLYLINE||this._geometryType===i.POLYGON||this._geometryType===i.POINT||this._geometryType===i.MULTI_POINT){if(!o&&(e.mapPoint.x!==s||e.mapPoint.y!==n)){o=!0,setTimeout(function(){o=!1},300);var r={sender:this,mapPoint:e.mapPoint,screenPoint:e.screenPoint,snappingPoint:this._lastSnappingPoint};t.apply(this._drawObject,arguments),this.raiseGraphicVertexAdded(r)}!function(e){s=e[0].mapPoint.x,n=e[0].mapPoint.y}(arguments)}else t.apply(this._drawObject,arguments)},i.prototype._extraPointOnTouchDevicesFixup=function(){var e=this;this._dblClickHandlerToken?this.app.trace.debug("[DrawTool] No double click subscribed"):this._dblClickHandlerToken=this.app.map.on("dbl-click",function(o){var i=e._drawObject,s=!!(t&&t.has&&t.has("esri-touch"));e.app.trace.debug("[DrawTool] IsTouch = "+s);var n=i?i._points:null;if(n)if(s){if(n.length>=2){var r=n.push;n.push=function(){e.app.trace.debug("[DrawTool] points.length "+n.length),n.push=r}}}else if(n.length<2||n[n.length-1].x!==o.mapPoint.x&&n[n.length-1].y!==o.mapPoint.y){if(e._lastSnappingPoint)return void e.app.trace.debug("[DrawTool] Bailout due to snapping");n.push(o.mapPoint),e.raiseGraphicVertexAdded({sender:e,mapPoint:o.mapPoint,screenPoint:o.screenPoint,snappingPoint:e._lastSnappingPoint})}})},i}(i.AccessibleMapComponent);a._draw=void t(["esri/toolbars/draw"],function(e){a.ARROW=e.ARROW,a.CIRCLE=e.CIRCLE,a.DOWN_ARROW=e.DOWN_ARROW,a.ELLIPSE=e.ELLIPSE,a.EXTENT=e.EXTENT,a.FREEHAND_POLYGON=e.FREEHAND_POLYGON,a.FREEHAND_POLYLINE=e.FREEHAND_POLYLINE,a.LEFT_ARROW=e.LEFT_ARROW,a.LINE=e.LINE,a.MULTI_POINT=e.MULTI_POINT,a.POINT=e.POINT,a.POLYGON=e.POLYGON,a.POLYLINE=e.POLYLINE,a.RECTANGLE=e.RECTANGLE,a.RIGHT_ARROW=e.RIGHT_ARROW,a.TRIANGLE=e.TRIANGLE,a.UP_ARROW=e.UP_ARROW}),o.Draw=a;var p=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.raiseGraphicEditActivated=function(e){this.app.event("GraphicDrawAccessibleEditActivatedEvent").publish(e)},o.prototype.raiseGraphicEditDeactivated=function(e){this.app.event("GraphicDrawAccessibleEditDeactivatedEvent").publish(e)},o}(s.Edit);o.EditInternal=p})},"geocortex/infrastructure/accessibility/Edit":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./AccessibleMapComponent","./GraphicMover","./BoxEditor","./../tools/MapTool","./../tools/DrawMode","geocortex/framework/utils/utils","./InputMethod","./VertexEditorFactory","./../GraphicUtils"],function(t,o,i,s,n,r,a,p,h,l,c){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var d=function(t){function o(e,o,i){var s=t.call(this,e,i)||this;s._editObject=null,s._options=null,s._defaultOptions=null,s._tool=0,s._isTextPoint=!1,s._editHandle=[],s._isGeo=!1,s._active=!1,s._modified=!1,s._cancelled=!1,s._needsRefresh=!1,s._handles=[],s._snappingFeedbackEventToken=null,s._lastSnapPoint=null,s._graphicMover=null,s._vertexEditor=null,s._boxEditor=null,s._symbolChangeHandle=null,s._editNotificationViewId="edit-notification-view";var n=Modernizr&&!!Modernizr.touch,r={vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([128,128,128])),ghostVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?18:10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([255,255,255,.75])),ghostLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DOT,new esri.Color([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,narrateKeyboardShortcuts:!0,rotateHandleOffset:n?24:16,boxLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new esri.Color([64,64,64]),1),boxHandleSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,n?16:9,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([255,255,255,.75])),textAnchorSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,null,new esri.Color([255,0,0])),selectedVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?25:15,null,new esri.Color([0,0,255,.75]))};return s._defaultOptions=dojo.mixin(r,o||{}),s._editObject=new esri.toolbars.Edit(e,o),s._addPointerEventsOnRedraw(),s}return e(o,t),o.prototype._addPointerEventsOnRedraw=function(){var e=this;(this.app.site?this.app.site.getMap().graphics:this.app.map.graphics).on("graphic-draw",function(t){if(e._editHandle&&e._editHandle.length>0)for(var o=0;o<e._editHandle.length;o++)t.graphic===e._editHandle[o]&&$(e._editHandle[o].getNode()).css("pointer-events","none")})},o.prototype.activate=function(e,t,i){var s=this;if(this.deactivate(),this.app&&(this._snappingFeedbackEventToken=this.app.event("SnappingFeedbackEvent").subscribe(this,function(e){e&&e.snappingPoint?s._lastSnapPoint=e.snappingPoint:s._lastSnapPoint=null})),this._active=!0,this._graphic=t,this._tool=e,this._options=dojo.mixin(dojo.mixin({},this._defaultOptions),i||{}),e>0){var n=this._map.spatialReference,r=t&&t.geometry?t.geometry.spatialReference:null;if(this._isGeo=n&&r&&!n.equals(r)&&n.isWebMercator()&&4326===r.wkid,t&&t.geometry&&"point"===t.geometry.type){var a=this._getSymbol(t);this._isTextPoint=a&&"textsymbol"===a.type}else this._isTextPoint=!1;t&&t.geometry&&"multipoint"===t.geometry.type&&(this._options.allowAddVertices=!1),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicClick",dojo.hitch(this,"_onGraphicClickImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicFirstMove",dojo.hitch(this,"_onGraphicFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMove",dojo.hitch(this,"_onGraphicMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMoveStart",dojo.hitch(this,"_onGraphicMoveStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMoveStop",dojo.hitch(this,"_onGraphicMoveStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotate",dojo.hitch(this,"_onRotateImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateFirstMove",dojo.hitch(this,"_onRotateFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateStart",dojo.hitch(this,"_onRotateStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateStop",dojo.hitch(this,"_onRotateStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScale",dojo.hitch(this,"_onScaleImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleFirstMove",dojo.hitch(this,"_onScaleFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleStart",dojo.hitch(this,"_onScaleStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleStop",dojo.hitch(this,"_onScaleStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexAdd",dojo.hitch(this,"_onVertexAddImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexClick",dojo.hitch(this,"_onVertexClickImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexDelete",dojo.hitch(this,"_onVertexDeleteImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexFirstMove",dojo.hitch(this,"_onVertexFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMouseOut",dojo.hitch(this,"_onVertexMouseOutImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMouseOver",dojo.hitch(this,"_onVertexMouseOverImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMove",dojo.hitch(this,"_onVertexMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMoveStart",dojo.hitch(this,"_onVertexMoveStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMoveStop",dojo.hitch(this,"_onVertexMoveStopImpl"),!0)),this._symbolChangeHandle=this.app.event("GraphicSymbolChangedEvent").subscribe(this,this._updateSizePointEditHandles),this.activateMouseControls(),this.activateKeyboardControls();var p=!1,h=!1,l=!1;(e&o.MOVE)===o.MOVE&&(p=this._enableMove(t));var c=(e&o.SCALE)===o.SCALE,d=(e&o.ROTATE)===o.ROTATE;if((c||d)&&(h=this._enableBoxEditing(t,c,d)),(e&o.EDIT_VERTICES)===o.EDIT_VERTICES&&(l=this._enableVertexEditing(t)),!p&&!h&&!l)throw new Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");this.onKeyboardStart(),this._updateToolStatusMessage(),this._addPointEditHandles(t),this.onActivate(e,t);var _={sender:this,graphic:t,tool:e};this.raiseGraphicEditActivated(_)}},o.prototype._addPointEditHandles=function(e){if(e.getLayer()!=this.app.map.graphics&&this._graphic==e&&this._tool>0&&("point"===e.geometry.type||"multipoint"===e.geometry.type)){var t,o,i=e.getLayer().renderer;if("textsymbol"===(t=e.symbol?e.symbol:i.getSymbol(e)).type)return;o=c.getBoundingBoxSize(e,this.app),(o*=1.5)<44&&(o=44);var s=o/4;this._editHandle.push(this._getTargetGraphic(e,t,o,s,esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color("#FFFFFF"))),this._editHandle.push(this._getTargetGraphic(e,t,o,s,esri.symbol.SimpleLineSymbol.STYLE_DASH,new esri.Color("#000000")));var n=this.app.site.getMap().graphics;n.add(this._editHandle[0]),n.add(this._editHandle[1]),$(this._editHandle[0].getNode()).css("pointer-events","none"),$(this._editHandle[1].getNode()).css("pointer-events","none")}},o.prototype._calculatePath=function(e,t){var o=e/2;return"M 0 0 "+e+" 0 "+e+" "+e+" 0 "+e+" 0 0M "+(0-t)+" "+o+" 0 "+o+"M "+o+" "+(e+t)+" "+o+" "+e+"M "+(e+t)+" "+o+" "+e+" "+o+"M "+o+" 0 "+o+" "+(0-t)},o.prototype._getTargetGraphic=function(e,t,o,i,s,n){var r=new esri.Graphic;r.setGeometry(esri.geometry.fromJson(e.geometry.toJson()));var a=new esri.symbol.SimpleMarkerSymbol;if(a.setOutline(new esri.symbol.SimpleLineSymbol(s,n,2)),a.setColor(new esri.Color([0,0,0,0])),a.setPath(this._calculatePath(o,i)),a.setSize(o),t){var p=t.xoffset||0,h=t.yoffset||0;a.setOffset(p,h)}return r.setSymbol(a),r},o.prototype.deactivate=function(){var e=this._tool;if(this._active=!1,this.app&&this._snappingFeedbackEventToken&&(this.app.event("SnappingFeedbackEvent").unsubscribe(this._snappingFeedbackEventToken),this._snappingFeedbackEventToken=null),e>0){var t=this._modified,o=this._cancelled,i=this._graphic;if(this._graphicMover&&this._graphicMover.hasMoved()&&this._adjustGraphicMoverPoint(i,this._lastSnapPoint),this._symbolChangeHandle&&this.app.event("GraphicSymbolChangedEvent").unsubscribe(this._symbolChangeHandle),this._symbolChangeHandle=null,this._removePointEditHandles(i),this._clear(),this._graphic=null,this._isGeo=this._isTextPoint=!1,this.deactivateMouseControls(),this.deactivateKeyboardControls(),this.app.toolRegistry&&this.app.toolRegistry.getActiveTool){var s=this.app.toolRegistry.getActiveTool();s instanceof r.MapTool&&s.drawMode===a.DrawMode.EXTENT&&i.setGeometry(this._convertPolygonToExtent(i.geometry))}this.onDeactivate(e,i,{isModified:t,cancelled:o});var n={sender:this,graphic:i,tool:e,isModified:t,cancelled:o};this.raiseGraphicEditDeactivated(n)}},o.prototype._removePointEditHandles=function(e){if(this._graphic===e&&0!=this._editHandle.length){var t=this.app.site.getMap().graphics;this._editHandle.forEach(function(e){return t.remove(e)}),this._editHandle=[]}},o.prototype._hidePointEditHandles=function(e){this._graphic===e&&0!=this._editHandle.length&&this._editHandle.forEach(function(e){return e.hide()})},o.prototype._showPointEditHandles=function(e){this._graphic===e&&0!=this._editHandle.length&&(this._editHandle.forEach(function(e){return e.show()}),$(this._editHandle[0].getNode()).css("pointer-events","none"),$(this._editHandle[1].getNode()).css("pointer-events","none"))},o.prototype._updateLocationPointEditHandles=function(e){this._graphic===e&&0!=this._editHandle.length&&this._editHandle.forEach(function(t){t.setGeometry(esri.geometry.fromJson(e.geometry.toJson()))})},o.prototype._updateSizePointEditHandles=function(e){this._graphic===e&&(e.symbol instanceof esri.symbol.TextSymbol||(this._removePointEditHandles(e),this._addPointEditHandles(e)))},o.prototype._convertPolygonToExtent=function(e){return e.getExtent?e.getExtent():(this.app.trace.warning("Tried to convert polygon to extent, but failed. Polygon object lacks getExtent() method."),null)},o.prototype.getOptions=function(){return this._options||this._defaultOptions||{}},o.prototype.getCurrentState=function(){return{tool:this._tool,graphic:this._graphic,isModified:this._modified}},o.prototype.getEnabledTools=function(){return[this._graphicMover,this._boxEditor,this._vertexEditor].filter(function(e){return!p.isNullOrUndefined(e)})},o.prototype.refresh=function(){this._editObject.refresh(),this._needsRefresh=!1,this._updateLocationPointEditHandles(this._graphic)},o.prototype.setNeedsRefresh=function(e){this._needsRefresh=e},o.prototype.suspend=function(){t.prototype.suspend.call(this),this.getEnabledTools().forEach(function(e){return e.suspend()})},o.prototype.resume=function(){t.prototype.resume.call(this),this.getEnabledTools().forEach(function(e){return e.resume()})},o.prototype.isActive=function(){return this._active},o.prototype.activateMouseControls=function(e){if(void 0===e&&(e=!0),t.prototype.activateMouseControls.call(this,e),!(this._tool>0))throw new Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");this._editObject.__attached_stopEvent=!0,this._editObject.activate(this._tool,this._graphic,this._options)},o.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),t.prototype.deactivateMouseControls.call(this,e),this._editObject.__attached_stopEvent=!0,this._editObject.deactivate()},o.prototype.on=function(e,t){throw new Error("[geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Edit] On style events not implemented yet. Use connect instead.")},o.prototype.onActivate=function(e,t){},o.prototype.onDeactivate=function(e,t,o){},o.prototype.onGraphicClick=function(e,t){},o.prototype._onGraphicClickImpl=function(e,t){this.onGraphicClick(e,t)},o.prototype.onGraphicFirstMove=function(e){this._modified=!0},o.prototype._onGraphicFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onGraphicFirstMove(e)},o.prototype.onGraphicMove=function(e,t){},o.prototype._onGraphicMoveImpl=function(e,t){this.onGraphicMove(e,t)},o.prototype.onGraphicMoveStart=function(e){},o.prototype._onGraphicMoveStartImpl=function(e){e&&e.geometry&&"point"==e.geometry.type&&this._hidePointEditHandles(e),this.onGraphicMoveStart(e)},o.prototype.onGraphicMoveStop=function(e,t){var o={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(o)},o.prototype._onGraphicMoveStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),e&&e.geometry&&"point"==e.geometry.type&&(this._updateLocationPointEditHandles(e),this._showPointEditHandles(e)),this.onGraphicMoveStop(e,t)},o.prototype.onRotate=function(e,t){},o.prototype._onRotateImpl=function(e,t){this.onRotate(e,t)},o.prototype.onRotateFirstMove=function(e){this._modified=!0},o.prototype._onRotateFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onRotateFirstMove(e)},o.prototype.onRotateStart=function(e){},o.prototype._onRotateStartImpl=function(e){this.onRotateStart(e)},o.prototype.onRotateStop=function(e,t){var o={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(o)},o.prototype._onRotateStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onRotateStop(e,t)},o.prototype.onScale=function(e,t){},o.prototype._onScaleImpl=function(e,t){this.onScale(e,t)},o.prototype.onScaleFirstMove=function(e){this._modified=!0},o.prototype._onScaleFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onScaleFirstMove(e)},o.prototype.onScaleStart=function(e){},o.prototype._onScaleStartImpl=function(e){this.onScaleStart(e)},o.prototype.onScaleStop=function(e,t){var o={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(o)},o.prototype._onScaleStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onScaleStop(e,t)},o.prototype.onVertexAdd=function(e,t){this._modified=!0,null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this._vertexEditor.refresh(!0),this._vertexEditor.onVertexAdd(t),this._vertexEditor.showVertexHandle())},o.prototype._onVertexAddImpl=function(e,t){this.onVertexAdd(e,t)},o.prototype.onVertexClick=function(e,t){},o.prototype._onVertexClickImpl=function(e,t){this.onVertexClick(e,t)},o.prototype.onVertexDelete=function(e,t){this._modified=!0,null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this._vertexEditor.refresh(!0),this._vertexEditor.onVertexDelete(t),this._vertexEditor.showVertexHandle())},o.prototype._onVertexDeleteImpl=function(e,t){this.onVertexDelete(e,t)},o.prototype.onVertexFirstMove=function(e,t){this._modified=!0},o.prototype._onVertexFirstMoveImpl=function(e,t){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onVertexFirstMove(e,t)},o.prototype.onVertexMouseOut=function(e,t){},o.prototype._onVertexMouseOutImpl=function(e,t){this.onVertexMouseOut(e,t)},o.prototype.onVertexMouseOver=function(e,t){},o.prototype._onVertexMouseOverImpl=function(e,t){this.onVertexMouseOver(e,t)},o.prototype.onVertexMove=function(e,t,o){t&&t.graphic&&this.app.event("EditVertexHandleMovedEvent").publish(t.graphic)},o.prototype._onVertexMoveImpl=function(e,t,o){this.onVertexMove(e,t,o)},o.prototype.onVertexMoveStart=function(e,t){},o.prototype._onVertexMoveStartImpl=function(e,t){e&&e.geometry&&"multipoint"==e.geometry.type&&this._hidePointEditHandles(e),this.onVertexMoveStart(e,t)},o.prototype.onVertexMoveStop=function(e,t,o){null!==this._vertexEditor&&this._vertexEditor.isActive()&&!t.isGhost&&(this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle());var i={graphic:e};this.app.eventRegistry.event("GeometryChangedEvent").publish(i)},o.prototype._onVertexMoveStopImpl=function(e,t,o){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume()),e&&e.geometry&&"multipoint"==e.geometry.type&&(this._updateLocationPointEditHandles(e),this._showPointEditHandles(e)),this.onVertexMoveStop(e,t,o)},o.prototype.onKeyboardStart=function(){t.prototype.onKeyboardStart.call(this)},o.prototype.onKeyboardStop=function(e){void 0===e&&(e=!1),t.prototype.onKeyboardStop.call(this,e),this._cancelled=e,this.deactivate()},o.prototype._onKeyDown=function(e){if(t.prototype._onKeyDown.call(this,e),!this.suspended&&this._active&&this.inputMethod!==h.InputMethod.MOUSE){var o=!1;switch(e.keyCode||e.which){case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:this.toggleKeyboardMode(),o=!0;break;case dojo.keys.ESCAPE:this.onKeyboardStop(!0),o=!0}o&&(e.preventDefault(),e.stopPropagation())}},o.prototype.raiseGraphicEditActivated=function(e){this.app.event("GraphicEditActivatedEvent").publish(e)},o.prototype.raiseGraphicEditDeactivated=function(e){this.app.event("GraphicEditDeactivatedEvent").publish(e)},o.prototype._updateToolStatusMessage=function(){if(this._graphic&&this._graphic.geometry&&"point"!==this._graphic.geometry.type){var e=null;if(this.app.toolRegistry&&this.app.toolRegistry.getActiveTool()){var t=this.app.toolRegistry.getActiveTool(),o=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-zoomin-tool"),i=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-zoomout-tool");t.name!==o&&t.name!==i||(e=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-desc-shortcuts-zoom"))}if(e){var s={id:this._editNotificationViewId,text:e,closeButton:{}};this.app.command("DisplayNotification").execute(s),this._options.narrateKeyboardShortcuts&&this.app.command("ScreenReaderNarrate").execute(e)}}},o.prototype._clear=function(){this._disableMove(),this._disableBoxEditing(),this._disableVertexEditing(),this._tool=0,this._modified=!1,this._cancelled=!1,this.suspended=!1,this.setInputMethod(null)},o.prototype._getSymbol=function(e){if(e){var t=e.symbol;if(t)return t;var o=e.getLayer()?e.getLayer().renderer:null;if(o)return o.getSymbol(e)}return null},o.prototype._enableMove=function(e){switch(e.geometry.type){case"point":var t=this._isTextPoint&&this._editObject._textAnchor?this._editObject._textAnchor:null;return this._graphicMover=new s.GraphicMover(e,this._map,this,t),!0;case"polyline":case"polygon":return this._graphicMover=new s.GraphicMover(e,this._map,this,null),!0}return!1},o.prototype._enableBoxEditing=function(e,t,o){var i={scaleEnabled:t,rotateEnabled:o,uniformScaling:this._options.uniformScaling,boxHandleSymbol:this._options.boxHandleSymbol,boxLineSymbol:this._options.boxLineSymbol};return!!(this._isTextPoint||["polyline","polygon"].indexOf(e.geometry.type)>-1)&&(this._boxEditor=new n.BoxEditor(e,this._map,this,this._isTextPoint,i),!0)},o.prototype._enableVertexEditing=function(e){var t={allowAddVertices:this._options.allowAddVertices,allowDeleteVertices:this._options.allowDeleteVertices,selectedVertexSymbol:this._options.selectedVertexSymbol};switch(e.geometry.type){case"multipoint":case"polyline":case"polygon":return this._vertexEditor=l.createVertexEditor(e,this._map,this,t),!0}return!1},o.prototype._adjustGraphicMoverPoint=function(e,t){t&&e&&t instanceof esri.geometry.Point&&e.geometry instanceof esri.geometry.Point&&e.setGeometry(t)},o.prototype._disableMove=function(){this._graphicMover&&(this._graphicMover.destroy(),this._graphicMover=null)},o.prototype._disableBoxEditing=function(){this._boxEditor&&(this._boxEditor.destroy(),this._boxEditor=null)},o.prototype._disableVertexEditing=function(){this._vertexEditor&&(this._vertexEditor.destroy(),this._vertexEditor=null)},o}(i.AccessibleMapComponent);d._edit=void t(["esri/toolbars/edit"],function(e){d.EDIT_TEXT=e.EDIT_TEXT,d.EDIT_VERTICES=e.EDIT_VERTICES,d.MOVE=e.MOVE,d.ROTATE=e.ROTATE,d.SCALE=e.SCALE}),o.Edit=d})},"geocortex/infrastructure/accessibility/EditCapability":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/EditCapabilityBase":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,o){this.owner=null,this.graphic=null,this.map=null,this.suspended=!1,this.graphic=e,this.map=t,this.owner=o}return e.prototype.destroy=function(){this.suspended=!1,this.graphic=this.map=this.owner=null},e.prototype.refresh=function(e){void 0===e&&(e=!1)},e.prototype.suspend=function(){this.suspended=!0},e.prototype.resume=function(){this.suspended=!1},e}();t.EditCapabilityBase=o})},"geocortex/infrastructure/accessibility/EditInterface":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/ExtendedDrawOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/ExtendedEditOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/GraphicMover":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./EditCapabilityBase","./../MatrixUtils"],function(t,o,i,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(e,o,i,s,n){var r=t.call(this,e,o,i)||this;return r._options={offsetX:10,offsetY:10,preciseOffsetX:1,preciseOffsetY:1},r._modified=!1,r._isMoving=!1,r._transform=null,r._textAnchor=null,r._keyDownHandle=null,r._keyUpHandle=null,r._options=dojo.mixin(r._options,n||{}),r._textAnchor=s,r._init(),r}return e(o,t),o.prototype.hasMoved=function(){return this._modified},o.prototype.destroy=function(){t.prototype.destroy.call(this),this._cleanUp()},o.prototype.refresh=function(e){void 0===e&&(e=!1),t.prototype.refresh.call(this,e),this.graphic&&(e||this._needsRefresh())&&(this._cleanUp(),this._init())},o.prototype._needsRefresh=function(){return null==this._keyDownHandle},o.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler")),this._keyUpHandle=dojo.on(this.map.root,"keyup",dojo.hitch(this,"_onKeyUpHandler"))},o.prototype._cleanUp=function(){this._modified=!1,this._isMoving=!1,this._textAnchor=this._transform=null,this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null)},o.prototype._onKeyDownHandler=function(e){if(!this.suspended){var t=e.altKey,o=t?this._options.preciseOffsetX:this._options.offsetX,i=t?this._options.preciseOffsetY:this._options.offsetY,s=0,n=0;switch(e.keyCode||e.which){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:n=-1;break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:s=1;break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:n=1;break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:s=-1;break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:s=1,n=-1;break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:s=1,n=1;break;case dojo.keys.END:case dojo.keys.NUMPAD_1:s=-1,n=1;break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:s=-1,n=-1;break;default:return}this._moveGraphic(s*o,n*i),e.preventDefault(),e.stopPropagation()}},o.prototype._onKeyUpHandler=function(e){if(!this.suspended){e.altKey;switch(e.keyCode||e.which){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:case dojo.keys.END:case dojo.keys.NUMPAD_1:case dojo.keys.HOME:case dojo.keys.NUMPAD_7:this._isMoving=!1,this.map.enableMapNavigation(),this.owner.onGraphicMoveStop(this.graphic,this._transform);break;default:return}e.preventDefault(),e.stopPropagation()}},o.prototype._moveGraphic=function(e,t){this._isMoving||(this.owner.onGraphicMoveStart(this.graphic),this.owner.onGraphicFirstMove(this.graphic),this._isMoving=!0,this.map.disableMapNavigation());var o=s.MatrixUtils.translate(this.graphic.geometry,this.map,e,t);if(this._transform=o.transform,this._modified=!0,this.graphic.setGeometry(o.geometry),this._textAnchor&&this._textAnchor.setGeometry(new esri.geometry.Point(this.graphic.geometry.toJson())),this.owner.refresh(),this.owner.onGraphicMove(this.graphic,o.transform),this.graphic.geometry instanceof esri.geometry.Point){var i=this.graphic.geometry.offset(0,0),n={sender:this,mapPoint:i,screenPoint:this.map.toScreen(i)};this._raiseEditVertexMoved(n)}},o.prototype._raiseEditVertexMoved=function(e){this.owner&&this.owner.app&&this.owner.app.event("EditVertexMovedEvent").publish(e)},o}(i.EditCapabilityBase);o.GraphicMover=n})},"geocortex/infrastructure/accessibility/GraphicMoverOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/InputMethod":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(){}}();o.MOUSE="mouse",o.KEYBOARD="keyboard",t.InputMethod=o})},"geocortex/infrastructure/accessibility/MapNavigationState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/MultipointVertexEditor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./VertexEditor"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype._getSegments=function(e){for(var t=0,o=[];t<e.points.length;t++)o.push(e.getPoint(t));return[o]},o.prototype._getMidpointSegments=function(e){return[]},o.prototype._insertGraphicVertex=function(e,t,o){},o.prototype._updateGraphicVertex=function(e,t,o){var i=this.graphic.geometry;i.setPoint(o,e.offset(0,0)),this.graphic.setGeometry(i)},o.prototype._deleteGraphicVertex=function(e,t){var o=this.graphic.geometry;o.removePoint(t),this.graphic.setGeometry(o)},o}(i.VertexEditor);o.MultipointVertexEditor=s})},"geocortex/infrastructure/accessibility/PolygonVertexEditor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./VertexEditor","./../GeometryUtils"],function(t,o,i,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype._getSegments=function(e){for(var t=[],o=0;o<e.rings.length;o++){for(var i=e.rings[o].length,s=[],n=0;n<i-1;n++)s.push(e.getPoint(o,n));t.push(s)}return t},o.prototype._getMidpointSegments=function(e){for(var t=[],o=0;o<e.rings.length;o++){for(var i=e.rings[o].length,n=[],r=0;r<i-1;r++){var a=e.getPoint(o,r),p=e.getPoint(o,r+1),h=s.getMidpoint(a,p);n.push(h)}t.push(n)}return t},o.prototype._insertGraphicVertex=function(e,t,o){var i=this.graphic.geometry;i.insertPoint(t,o,e.offset(0,0)),this.graphic.setGeometry(i)},o.prototype._updateGraphicVertex=function(e,t,o){var i=this.graphic.geometry;if(i.setPoint(t,o,e.offset(0,0)),0===o){var s=i.rings[t];i.setPoint(t,s.length-1,e.offset(0,0))}this.graphic.setGeometry(i)},o.prototype._deleteGraphicVertex=function(e,t){var o=this.graphic.geometry;if(o.removePoint(e,t),0===t){var i=o.rings[e],s=o.getPoint(e,0);o.setPoint(e,i.length-1,s.offset(0,0))}this.graphic.setGeometry(o)},o}(i.VertexEditor);o.PolygonVertexEditor=n})},"geocortex/infrastructure/accessibility/PolylineVertexEditor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./VertexEditor","./../GeometryUtils"],function(t,o,i,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype._getSegments=function(e){for(var t=[],o=0;o<e.paths.length;o++){for(var i=e.paths[o].length,s=[],n=0;n<i;n++)s.push(e.getPoint(o,n));t.push(s)}return t},o.prototype._getMidpointSegments=function(e){for(var t=[],o=0;o<e.paths.length;o++){for(var i=e.paths[o].length,n=[],r=0;r<i-1;r++){var a=e.getPoint(o,r),p=e.getPoint(o,r+1),h=s.getMidpoint(a,p);n.push(h)}t.push(n)}return t},o.prototype._insertGraphicVertex=function(e,t,o){var i=this.graphic.geometry;i.insertPoint(t,o,e.offset(0,0)),this.graphic.setGeometry(i)},o.prototype._updateGraphicVertex=function(e,t,o){var i=this.graphic.geometry;i.setPoint(t,o,e.offset(0,0)),this.graphic.setGeometry(i)},o.prototype._deleteGraphicVertex=function(e,t){var o=this.graphic.geometry;o.removePoint(e,t),this.graphic.setGeometry(o)},o}(i.VertexEditor);o.PolylineVertexEditor=n})},"geocortex/infrastructure/accessibility/VertexEditor":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","./EditCapabilityBase","./../GeometryUtils","./../MatrixUtils"],function(t,o,i,s,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){function o(e,o,i,s){var n=t.call(this,e,o,i)||this;return n._keyDownHandle=null,n._keyUpHandle=null,n._keyDx=0,n._keyDy=0,n._transform=null,n._isMoving=!1,n._isActive=!1,n._vertexControls=null,n._midpointControls=null,n._allControls=null,n._selectedControl=null,n._vertexHandleGraphic=null,n._options={offsetX:10,offsetY:10,preciseOffsetX:1,preciseOffsetY:1,allowAddVertices:!0,allowDeleteVertices:!0},n._snappingInputMovedToken=null,n._options=dojo.mixin(n._options,s||{}),n._init(),n.owner&&n.owner.app&&(n._snappingInputMovedToken=n.owner.app.event("SnappingFeedbackEvent").subscribe(n,n._handleSnappingInputMovedEvent)),n}return e(o,t),o.create=function(e,t,o,i){var s="This method is obsolete. Call createVertexEditor in VertexEditorFactory instead.";throw console.log(s),new Error(s)},o.prototype._handleSnappingInputMovedEvent=function(e){e&&e.snappingPoint&&this.graphic&&this.getSelectedVertex()&&this._vertexHandleGraphic&&this._vertexHandleGraphic.visible&&(this._updateGraphicVertex(e.snappingPoint,this.getSelectedVertex().segmentIndex,this.getSelectedVertex().pointIndex),this.owner.refresh())},o.prototype.isActive=function(){return this._isActive},o.prototype.hideVertexHandle=function(){this._vertexHandleGraphic&&(this._vertexHandleGraphic.hide(),this.owner&&this.owner.app&&this.owner.app.event("VertexHandleHiddenEvent").publish())},o.prototype.showVertexHandle=function(){if(this._selectedControl){var e=this._selectedControl.point.offset(0,0);this._vertexHandleGraphic?(this._vertexHandleGraphic.setGeometry(e).setSymbol(this._options.selectedVertexSymbol),this._vertexHandleGraphic.show()):this._vertexHandleGraphic=this.map.graphics.add(new esri.Graphic(e,this._options.selectedVertexSymbol)),this.owner&&this.owner.app&&this.owner.app.event("VertexHandleShownEvent").publish(e);var t=this._vertexHandleGraphic.getDojoShape();t&&t.moveToFront()}},o.prototype.destroy=function(){this._cleanUp(),t.prototype.destroy.call(this)},o.prototype.refresh=function(e){void 0===e&&(e=!1),this._transform=null,e?(this._removeControllers(),this._addControllers()):this._refreshControllers()},o.prototype.getSelectedVertex=function(){return this._selectedControl},o.prototype.onVertexAdd=function(e){if(e&&e.segmentIndex===this._selectedControl.segmentIndex){var t=null,o=this._selectedControl.segmentIndex,i=this._selectedControl.pointIndex;this._selectedControl.isGhost?(t=this._midpointControls,e.pointIndex<i+1?i+=1:e.pointIndex===i+1&&(i=e.pointIndex,t=this._vertexControls)):(t=this._vertexControls,i+=e.pointIndex<=i?1:0),this._selectedControl=t[o][i]}},o.prototype.onVertexDelete=function(e){if(e&&e.segmentIndex===this._selectedControl.segmentIndex){var t=null,o=this._selectedControl.segmentIndex,i=this._selectedControl.pointIndex;this._selectedControl.isGhost?(t=this._midpointControls,i-=e.pointIndex<=i?1:0):(t=this._vertexControls,i-=e.pointIndex<=i&&i>0?1:0),this._selectedControl=t[o][i]}},o.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler"))},o.prototype._cleanUp=function(){this._isMoving=this._isActive=!1,this._transform=null,this._selectedControl=null,this._removeControllers(),this._vertexHandleGraphic&&(this.map.graphics.remove(this._vertexHandleGraphic),this._vertexHandleGraphic=null),this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null),this.owner.app&&this.owner.app&&this._snappingInputMovedToken&&this.owner.app.event("SnappingFeedbackEvent").unsubscribe(this._snappingInputMovedToken)},o.prototype._getSegments=function(e){throw new Error("This method is abstract")},o.prototype._getMidpointSegments=function(e){throw new Error("This method is abstract")},o.prototype._updatePoints=function(e){throw new Error("This method is abstract")},o.prototype._insertGraphicVertex=function(e,t,o){throw new Error("This method is abstract")},o.prototype._updateGraphicVertex=function(e,t,o){throw new Error("This method is abstract")},o.prototype._deleteGraphicVertex=function(e,t){throw new Error("This method is abstract")},o.prototype._findVertex=function(e,t){for(var o=t?t.length:0,i=0;i<o;i++)for(var n=t[i],r=0;r<n.length;r++){var a=n[r];if(a&&s.pointsAreEqual(a.point,e))return a}return null},o.prototype._addControllers=function(){var e=this;this._vertexControls=this._add(this._getSegments(this.graphic.geometry)),this._options.allowAddVertices&&(this._midpointControls=this._add(this._getMidpointSegments(this.graphic.geometry),!0)),this._allControls=[],this._vertexControls.forEach(function(t,o){t.forEach(function(t,i){e._allControls.push(t),e._midpointControls&&e._midpointControls[o]&&i<e._midpointControls[o].length&&e._allControls.push(e._midpointControls[o][i])})})},o.prototype._removeControllers=function(){this._remove(this._vertexControls),this._remove(this._midpointControls),this._vertexControls=this._midpointControls=this._allControls=null},o.prototype._refreshControllers=function(){this._refresh(this._vertexControls,this._getSegments(this.graphic.geometry)),this._options.allowAddVertices&&this._refresh(this._midpointControls,this._getMidpointSegments(this.graphic.geometry),!0)},o.prototype._add=function(e,t){void 0===t&&(t=!1);for(var o=[],i=0;i<e.length;i++){for(var s=e[i],n=[],r=0;r<s.length;r++)n.push({isGhost:t,segmentIndex:i,pointIndex:r,point:s[r]});o.push(n)}return o},o.prototype._remove=function(e){e&&(e.forEach(function(e){e.length=0}),e.length=0)},o.prototype._refresh=function(e,t,o){void 0===o&&(o=!1),e&&t&&e.forEach(function(e,o){e.forEach(function(e,i){e.point=t[o][i]})})},o.prototype._previous=function(){var e=this._allControls.indexOf(this._selectedControl);this._selectedControl=0==e?this._allControls[this._allControls.length-1]:this._allControls[e-1],this.showVertexHandle(),this._refreshControllers()},o.prototype._next=function(){var e=this._allControls.indexOf(this._selectedControl);this._selectedControl=this._allControls[(e+1)%this._allControls.length],this.showVertexHandle(),this._refreshControllers()},o.prototype._onKeyDownHandler=function(e){this.suspended||(this._isActive?this._onKeyDownWhenActive(e):86===(e.keyCode||e.which)&&(e.preventDefault(),e.stopImmediatePropagation(),this._isActive=!0,this.owner.suspend(),this.resume(),this._addControllers(),this._selectedControl=this._vertexControls[0][0],this.showVertexHandle()))},o.prototype._onKeyDownWhenActive=function(e){var t=e.altKey,o=t?this._options.preciseOffsetX:this._options.offsetX,i=t?this._options.preciseOffsetY:this._options.offsetY;switch(e.keyCode||e.which){case 86:return e.preventDefault(),e.stopImmediatePropagation(),void(e.shiftKey?this._previous():this._next());case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:return e.preventDefault(),e.stopImmediatePropagation(),this.owner.resume(),this._isActive=this._isMoving=!1,this._selectedControl=null,void(this._vertexHandleGraphic&&(this.hideVertexHandle(),this.map.graphics.remove(this._vertexHandleGraphic),this._vertexHandleGraphic=null));case 68:return void(this._options.allowDeleteVertices&&(this._delete(this.getSelectedVertex()),e.preventDefault(),e.stopImmediatePropagation()));case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:this._keyDy-=i;break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:this._keyDx+=o;break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:this._keyDy+=i;break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:this._keyDx-=o;break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:this._keyDx+=o,this._keyDy-=i;break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:this._keyDx+=o,this._keyDy+=i;break;case dojo.keys.END:case dojo.keys.NUMPAD_1:this._keyDx-=o,this._keyDy+=i;break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:this._keyDx-=o,this._keyDy-=i;break;default:return}e.preventDefault(),e.stopImmediatePropagation(),this._move(this.getSelectedVertex(),this._keyDx,this._keyDy),this._moveStop(this.getSelectedVertex(),this._keyDx,this._keyDy),this._keyDx=this._keyDy=0},o.prototype._move=function(e,t,o){var i={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex};this._isMoving||(this._isMoving=!0,this.owner.onVertexMoveStart(this.graphic,i),this.owner.onVertexFirstMove(this.graphic,i));var s=this.map.toScreen(e.point).offset(t,o);this._vertexHandleGraphic.setGeometry(this.map.toMap(s)),this.owner.onVertexMove(this.graphic,i,this._transform);var n={sender:this,mapPoint:this.map.toMap(s),screenPoint:s};this._raiseEditVertexMoved(n)},o.prototype._raiseEditVertexMoved=function(e){this.owner&&this.owner.app&&this.owner.app.event("EditVertexMovedEvent").publish(e)},o.prototype._moveStop=function(e,t,o){if(this._isMoving=!1,e&&e.point){var i={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex},s=n.MatrixUtils.translate(e.point,this.map,t,o);this._transform=s.transform,i.isGhost?(i.pointIndex+=1,this._insertGraphicVertex(s.geometry,i.segmentIndex,i.pointIndex)):this._updateGraphicVertex(s.geometry,i.segmentIndex,i.pointIndex),this.owner.refresh(),this.owner.onVertexMoveStop(this.graphic,i,this._transform),i.isGhost&&(i.isGhost=!1,this.owner.onVertexAdd(this.graphic,i))}},o.prototype._delete=function(e){if(e&&!e.isGhost){var t={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex};this._deleteGraphicVertex(e.segmentIndex,e.pointIndex),this.owner.refresh(),this.owner.onVertexDelete(this.graphic,t)}},o}(i.EditCapabilityBase);o.VertexEditor=r})},"geocortex/infrastructure/accessibility/VertexEditorFactory":function(){define(["require","exports","./MultipointVertexEditor","./PolylineVertexEditor","./PolygonVertexEditor"],function(e,t,o,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVertexEditor=function(e,t,n,r){if(!e||!e.geometry)return null;switch(e.geometry.type){case"multipoint":return new o.MultipointVertexEditor(e,t,n,r);case"polyline":return new i.PolylineVertexEditor(e,t,n,r);case"polygon":return new s.PolygonVertexEditor(e,t,n,r)}return null}})},"geocortex/infrastructure/accessibility/VertexEditorOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/accessibility/VertexInfo":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/AreaOfInterestMask":function(){define(["require","exports","./GeometryUtils","geocortex/framework/utils/utils","./GraphicsLayerIds","./GraphicsLayerUtils"],function(e,i,r,o,l,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,i){this.app=e,this._enabled=!0,this.matchMapBackground=!1,this.fillColor=null,this.boundaryColor=new esri.Color("red"),this.boundaryWidth=2,this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.layerId=l.AOI_MASK_LAYER_ID}return e.prototype.show=function(e){var i=this;this._aoi=e,this.app.waitUntilSiteServiceLayersLoaded().then(function(){if(i._enabled){var o=i._getLayer();if(o.clear(),(i.fillColor||i.boundaryStyle!==esri.symbol.SimpleFillSymbol.STYLE_NULL)&&o.show(),i.fillColor){for(var l=new esri.geometry.Polygon(e.spatialReference),a=i.app.map.getLayer(i.app.map.layerIds[0]),n=r.toRing(a.fullExtent.expand(1.5)),t=0;t<e.rings.length;t++){var s=e.rings[t];l.rings.push(dojo.clone(s).reverse())}l.rings.push(n);var y=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL),i.fillColor),d=new esri.Graphic({geometry:l});d.setSymbol(y),i.app.map.graphics.add(d)}if(i.boundaryStyle!==esri.symbol.SimpleFillSymbol.STYLE_NULL){var p=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL,new esri.symbol.SimpleLineSymbol(i.boundaryStyle,i.boundaryColor,i.boundaryWidth),new esri.Color("white")),u=new esri.Graphic({geometry:e});u.setSymbol(p),o.add(u)}if(i.matchMapBackground&&i.fillColor){var b=i._getMapNode();i._originalMapBackground=b.css("background-color"),b.css("background-color","rgba("+i.fillColor.r+","+i.fillColor.g+","+i.fillColor.b+","+i.fillColor.a+")")}}})},e.prototype.hide=function(){this._aoi=null,a.removeInternalGraphicsLayer(this.layerId,this.app,a.GraphicsLayerType.Pushpin),this.matchMapBackground&&this._getMapNode().css("background-color",this._originalMapBackground)},e.prototype.enable=function(){this._enabled=!0,this._aoi&&this.show(this._aoi)},e.prototype.disable=function(){this._enabled=!1},e.prototype.configure=function(e){e&&(o.isNullOrUndefined(e.boundaryColor)||(this.boundaryColor=new esri.Color(e.boundaryColor)),o.isNullOrUndefined(e.boundaryWidth)||(this.boundaryWidth=e.boundaryWidth),o.isNullOrUndefined(e.boundaryStyle)||("null"==e.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_NULL:"solid"==e.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_SOLID:"dash"==e.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_DASH:"dot"==e.boundaryStyle&&(this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_DOT)),o.isNullOrUndefined(e.enabled)||(e.enabled?this.enable():this.disable()),o.isNullOrUndefined(e.fillColor)||(this.fillColor=new esri.Color(e.fillColor)),o.isNullOrUndefined(e.layerId)||(this.layerId=e.layerId),o.isNullOrUndefined(e.matchMapBackground)||(this.matchMapBackground=e.matchMapBackground))},e.prototype._getLayer=function(){return a.getInternalGraphicsLayer(this.layerId,this.app,a.GraphicsLayerType.Pushpin)},e.prototype._getMapNode=function(){return $(".esriMapContainer").first().parent()},e}();i.AreaOfInterestMask=n})}}});require({cache:{"geocortex/infrastructure/ArrayUtils":function(){define(["require","exports"],function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=function(){function r(){}return r.sortBy=function(r,n){return r.sort(function(r,t){var e=n(r),u=n(t);return e==u?0:e<u?-1:1}),r},r.sum=function(r,n){for(var t=0,e=0;e<r.length;e++)t+=n(r[e]);return t},r.max=function(r,n){for(var t=null,e=0;e<r.length;e++){var u=n(r[e]);(null==t||t<u)&&(t=u)}return t},r.mapWithErrorCallback=function(r,n,t,e){if("function"!=typeof n)throw new Error("Callback required.");if("function"!=typeof t)throw new Error("Error callback required.");if(!r)return r;for(var u=[],o=0;o<r.length;o++){var i=r[o];try{u.push(n.call(e,i,o,r))}catch(r){t.call(e,i,r,u)}}return u},r.findIndex=function(r,n){for(var t=0;t<r.length;t++)if(n(r[t]))return t;return-1},r.unique=function(r){for(var n={},t=new Array,e=0;e<r.length;e++)null!=r[e]&&(n[r[e].toString()]||t.push(r[e]),n[r[e].toString()]=!0);return t},r}();n.ArrayUtils=t})}}});require({cache:{"geocortex/infrastructure/AttachmentInfo":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){this.id=new r.Observable,this.contentType=new r.Observable,this.size=new r.Observable,this.name=new r.Observable,this.url=new r.Observable}}();t.AttachmentInfo=n})}}});require({cache:{"geocortex/infrastructure/AttributeGroup":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){return function(){}}();r.AttributeGroup=t})}}});require({cache:{"geocortex/infrastructure/Bookmark":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/BookmarkManager":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.Site=0]="Site",e[e.User=1]="User",e[e.Project=2]="Project"}(r=t.BookmarkSource||(t.BookmarkSource={}));var o=function(){function e(e){if(this._projectBookmarks=[],!e)throw new Error('Parameter "app" required.');this.app=e}return e.prototype.getAll=function(){var e=this;return Promise.join(this.getSiteBookmarks(),this.getUserBookmarks()).spread(function(t,r){return(t||[]).concat(r).concat(e._projectBookmarks)})},e.prototype.getUserBookmarks=function(){var e=this;return new Promise(function(t,r){e.app.store.get("bookmarks",function(r){var o=[];if(r)try{o=JSON.parse(r)}catch(t){e.app.trace.warning("Unable to parse user bookmarks: {0}".format(t))}var n=o.map(function(t){return e._deserialize(t)});t(n)},r)})},e.prototype.getSiteBookmarks=function(){var e=this;return this.app.waitUntilSiteInitialized().then(function(){return(e.app.site.namedExtents||[]).map(function(e){return{name:e.displayName,extent:e.extent,source:r.Site}})})},e.prototype.getProjectBookmarks=function(){return Promise.resolve(this._projectBookmarks)},e.prototype.add=function(e){var t=this;if(!e)throw new Error('Parameter "bookmark" required.');return e.source=e.source||r.User,e.source===r.Project?(this._projectBookmarks.push(e),this.app.event("BookmarksModifiedEvent").publish(""),Promise.resolve()):this.getUserBookmarks().then(function(r){return r.push(e),t._save(r)})},e.prototype.remove=function(e){var t=this;if(e)return"string"==typeof e?this._projectBookmarks=this._projectBookmarks.filter(function(t){return t.name!==e}):"object"==typeof e&&(this._projectBookmarks=this._projectBookmarks.filter(function(t){return t!==e})),this.getUserBookmarks().then(function(r){return"string"==typeof e?r=r.filter(function(t){return t.name!==e}):"object"==typeof e&&(r=r.filter(function(t){return t!==e})),t._save(r)})},e.prototype.export=function(e){var t=this;return e=e||[r.Site,r.User,r.Project],this.getAll().then(function(r){return r.filter(function(t){return e.indexOf(t.source)>=0}).map(function(e){return{name:e.name,extent:t.app.project.convert.fromEsriGeometry(e.extent)}})})},e.prototype._save=function(e){var t=this;return new Promise(function(r,o){var n=JSON.stringify((e||[]).map(function(e){return t._serialize(e)}));t.app.store.set("bookmarks",n,function(e,o){r(),t.app.event("BookmarksModifiedEvent").publish(n)},o)})},e.prototype._serialize=function(e){return{displayName:e.name,extent:this.app.webMap.convert.fromEsriGeometry(e.extent),isUserDefined:!0}},e.prototype._deserialize=function(e){return{name:e.displayName,extent:this.app.webMap.convert.toEsriGeometry(e.extent),source:r.User}},e}();t.BookmarkManager=o})}}});require({cache:{"geocortex/infrastructure/BrowserUtils":function(){define(["require","exports"],function(e,r){"use strict";function n(){var e=window.navigator.userAgent,r=-1,n=e.indexOf("Trident/");if(n>0){var t=parseInt(e.substring(n+8,e.indexOf(".",n)),10);4===t&&(r=8),5===t&&(r=9),6===t&&(r=10),7===t&&(r=11)}if(-1===r){var i=e.indexOf("MSIE ");i>0&&(r=parseInt(e.substring(i+5,e.indexOf(".",i)),10))}if(-1===r){var s=e.indexOf("Edge/");s>0&&(r=parseInt(e.substring(s+5,e.indexOf(".",s)),10))}return r}Object.defineProperty(r,"__esModule",{value:!0}),r.isIE=function(){var e=n();return-1!==e&&e<12?e:-1},r.isEdge=function(){var e=n();return-1!==e&&e>=12?e:-1},r.isChrome=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},r.isInternetExplorerOrEdge=n})}}});require({cache:{"geocortex/infrastructure/buffer/BufferArgsBase":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferDistanceChangedEventArgs":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferGeometriesArgs":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferGeometryArgs":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferOperationError":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferOperationResult":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferResultBase":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferUnitDesc":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferUnits":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/buffer/BufferUtils":function(){define(["require","exports","./../GeometryUtils","geocortex/essentials/DistanceUnit"],function(e,r,t,i){"use strict";function n(i,n){var c=function(t){var f=null;e(["esri/tasks/BufferParameters"],function(e){(f=new esri.tasks.BufferParameters).geometries=t,f.unit=u(n.bufferUnit),f.bufferSpatialReference=n.bufferSpatialReference||n.outSpatialReference||n.geometries[0].spatialReference||i.map.spatialReference,f.outSpatialReference=n.outSpatialReference||i.map.spatialReference||n.geometries[0].spatialReference||n.bufferSpatialReference,f.distances=[n.bufferDistance],f.unionResults=void 0==n.unionResults||!!n.unionResults,f.geodesic=!!n.geodesic,f.unit==r.GCX_UNIT_YARDS&&(f.unit=esri.tasks.GeometryService.UNIT_FOOT,f.distances=[o(n.bufferDistance,r.GCX_UNIT_YARDS,esri.tasks.GeometryService.UNIT_FOOT)])});return new Promise(function(e,r){s(i,f).then(e,r)})};return new Promise(function(e,r){var i=[];f(n.geometries).forEach(function(e){i.push(c(e))}),Promise.all(i).then(function(i){var s=i[0];if(s.bufferId=n.bufferId,s.sourceCommand=n.sourceCommand,1===i.length)e(s);else{for(var u=1;u<i.length;u++){var o=i[u].geometries;o.length&&(s.geometries=s.geometries.concat(o))}n.unionResults?t.unionGeometries(s.geometries).then(function(r){t.isValidGeometry(r)&&(s.geometries=[r],s.geometry=r,e(s))},function(e){var t={};t.error=e,t.bufferId=n.bufferId,t.sourceCommand=n.sourceCommand,r(t)}):e(s)}},function(e){e.bufferId=n.bufferId,e.sourceCommand=n.sourceCommand,r(e)})})}function s(e,r){var i=function(e,r){var t={};return e&&(t.geometries=e),r&&(t.error=r),t};return new Promise(function(n,s){var u=t.getGeometryService(e);if(!u){var o="BufferUtils: Buffer operation failed. Could not retrieve geometry service.";return e.trace.error(o),void s(i(null,new Error(o)))}var f=function(){0===r.distances[0]?n(i(r.geometries,null)):u.buffer(r,function(e){return n(i(e,null))},function(e){return s(i(null,e))})};esri.geometry.normalizeCentralMeridian(r.geometries).then(function(e){"polygon"===e[0].type?u.simplify(r.geometries,function(e){r.geometries=e,f()},function(e){s(i(null,e))}):(r.geometries=e,f())})})}function u(e,t){if(!e)return null;var n=null;switch(e){case"feet":case i.DistanceUnitType.FEET:case esri.tasks.GeometryService.UNIT_FOOT.toString():case esri.Units.FEET:n=esri.tasks.GeometryService.UNIT_FOOT;break;case"kilometer":case i.DistanceUnitType.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER.toString():case esri.Units.KILOMETERS:n=esri.tasks.GeometryService.UNIT_KILOMETER;break;case"meter":case i.DistanceUnitType.METERS:case esri.tasks.GeometryService.UNIT_METER.toString():case esri.Units.METERS:n=esri.tasks.GeometryService.UNIT_METER;break;case"mile":case i.DistanceUnitType.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE.toString():case esri.Units.MILES:n=esri.tasks.GeometryService.UNIT_STATUTE_MILE;break;case"nauticalmile":case i.DistanceUnitType.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE.toString():case esri.Units.NAUTICAL_MILES:n=esri.tasks.GeometryService.UNIT_NAUTICAL_MILE;break;case"yard":case i.DistanceUnitType.YARDS:case esri.Units.YARDS:n=r.GCX_UNIT_YARDS;break;default:n=t||e}return n}function o(e,t,i){var n=0;switch(t){case esri.tasks.GeometryService.UNIT_METER:n=3.280839895013*e;break;case esri.tasks.GeometryService.UNIT_KILOMETER:n=3280.839895013123*e;break;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:n=5280*e;break;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:n=6076.12*e;break;case r.GCX_UNIT_YARDS:n=3*e;break;default:n=e}switch(i){case esri.tasks.GeometryService.UNIT_METER:return n/3.280839895013;case esri.tasks.GeometryService.UNIT_KILOMETER:return n/3280.839895013123;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:return n/5280;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:return n/6076.12;case r.GCX_UNIT_YARDS:return n/3;default:return n}}function f(e){var r=[];return e.forEach(function(e){for(var t=!1,i=0;i<r.length;i++)if(r[i].length&&r[i][0].type===e.type){r[i].push(e),t=!0;break}if(!t){var n=r.length;r[n]=[],r[n].push(e)}}),r}Object.defineProperty(r,"__esModule",{value:!0}),r.SUPPORTED_BUFFER_UNITS={feet:null,yard:null,meter:null,kilometer:null,mile:null,nauticalmile:null};var c=[3819,3821,3824,3889,3906,5013,5233,5246,5252,5264,5324,5340,5354,5360,5365,5371,5373,5381,5393,5451,5464,5467,5489,5524,5527,5546,5561,37257,104e3,104020,104023,104199,104223,104896],a=[[4001,4999],[5228,5229],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700],[37001,37008],[37201,37208],[37211,37235],[37237,37243],[37245,37247],[37249,37255],[37259,37260],[104100,104145],[104256,104259],[104260,104261],[104286,104287],[104304,104305],[104700,104786],[104800,104871],[104900,104970],[104990,104992]];r.GCX_UNIT_YARDS=12345,r.bufferGeometry=function(e,r){var t={bufferId:r.bufferId,geometries:[r.geometry],callback:r.callback,geodesic:r.geodesic,bufferSpatialReference:r.bufferSpatialReference,outSpatialReference:r.outSpatialReference,bufferDistance:r.bufferDistance,bufferUnit:r.bufferUnit,unionResults:r.unionResults,sourceCommand:r.sourceCommand};return new Promise(function(r,i){n(e,t).then(function(e){e.geometry=e.geometries[0]||null,r(e)},function(e){i(e)})})},r.bufferGeometries=n,r.buffer=s,r.isGeographicWkid=function(e){var r=parseInt(e,10);if(isNaN(r))return!1;if(c.indexOf(r)>-1)return!0;for(var t=0;t<a.length;t++)if(r>=a[t][0]&&r<=a[t][1])return!0;return!1},r.getUnitDescFromConfig=function(e){for(var t in r.SUPPORTED_BUFFER_UNITS)if(r.SUPPORTED_BUFFER_UNITS.hasOwnProperty(t)&&r.SUPPORTED_BUFFER_UNITS[t]&&r.SUPPORTED_BUFFER_UNITS[t].config===e)return r.SUPPORTED_BUFFER_UNITS[t];return null},r.getGeometryServiceUnitConstant=u,r.convertLength=o})},"geocortex/infrastructure/buffer/DisplayBufferOptionsArgs":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/CancellationToken":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/CancellationTokenSource":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._tokenImpl=new o}return e.prototype.token=function(){return this._tokenImpl},e.prototype.cancel=function(){this._tokenImpl.cancel()},e.prototype.dispose=function(){this._tokenImpl.dispose()},e.none=function(){return this._none||(this._none={isCancellationRequested:!1,register:function(e){}}),this._none},e}();t.CancellationTokenSource=n;var o=function(){function e(){this._listeners=new Array,this.isCancellationRequested=!1}return e.prototype.register=function(e){this._listeners.push(e)},e.prototype.cancel=function(){this.isCancellationRequested=!0;for(var e=0;e<this._listeners.length;e++)this._listeners[e]()},e.prototype.dispose=function(){this._listeners.length=0},e}()})}}});require({cache:{"geocortex/infrastructure/clickableGraphics/ClickableGraphicsRegistry":function(){define(["require","exports","../Dictionary"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e){this._clickableGraphicLayers=new t.Dictionary,this._defaultOptions={displayName:null,autoEditable:!0,aliases:{},canEdit:this._defaultCallback,canDelete:this._defaultCallback,canChangeStyles:this._defaultCallback},this.app=e,this.app.event("LayerRemovedEvent").subscribe(this,this._handleLayerRemoved)}return e.prototype._defaultCallback=function(e){return!0},e.prototype.register=function(e,i){if(e instanceof esri.layers.GraphicsLayer){var t=$.extend({},this._defaultOptions,i||{}),a={};a.graphicsLayerId=e.id,a.displayName=t.displayName?t.displayName:"",a.aliases=t.aliases,a.autoEditable=t.autoEditable,a.canEdit=t.canEdit,a.canDelete=t.canDelete,a.canChangeStyles=t.canChangeStyles,this._clickableGraphicLayers.containsKey(e.id)&&this.app.trace.debug("Graphic layer with id '"+e.id+"' was already registered. ClickableLayerInfo will be overridden."),this._clickableGraphicLayers.set(e.id,a)}},e.prototype.unregister=function(e){if(this._clickableGraphicLayers.containsKey(e.id)){var i=this._clickableGraphicLayers.get(e.id);this._disposeLayerInfoObject(i),this._clickableGraphicLayers.remove(e.id)}else this.app.trace.debug("Graphic layer with id '"+e.id+"' was not found.")},e.prototype.getLayerInfo=function(e){if(this._clickableGraphicLayers.containsKey(e.id)){var i=this._clickableGraphicLayers.get(e.id);return $.extend({},i)}return this.app.trace.debug("Graphic layer with id '"+e.id+"' is not registered."),null},e.prototype.getLayerInfos=function(){var e=this,i=this.app.map.graphicsLayerIds.slice(0);return i.reverse(),i.map(function(i){return e._clickableGraphicLayers.get(i)}).filter(function(e){return null!=e}).map(function(e){return $.extend({},e)})},e.prototype.clear=function(){this._clickableGraphicLayers.clear()},e.prototype.isLayerRegistered=function(e){return!!this._clickableGraphicLayers.containsKey(e.id)},e.prototype._disposeLayerInfoObject=function(e){e.canEdit=null,e.canDelete=null,e.canChangeStyles=null},e.prototype._handleLayerRemoved=function(e){e instanceof esri.layers.GraphicsLayer&&this.isLayerRegistered(e)&&this.unregister(e)},e}();i.ClickableGraphicsRegistry=a})},"geocortex/infrastructure/clickableGraphics/ClickableLayerInfo":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"geocortex/infrastructure/clickableGraphics/ClickableOptions":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/ClusterLayer":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}();define(["require","exports","geocortex/framework/observables","./Feature","./FeatureSet","./FeatureSetCollection","./BrowserUtils"],function(t,r,s,i,a,n,l){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ClusterHidingOptions={none:0,unselected:1};var u=function(t){function u(e,i){var a=t.call(this)||this;if(a.gcxLayer=null,a.featureLayer=null,a.singleFeatureLayer=null,a.clusterRadius=new s.Observable(null),a.maxFeaturesInCluster=new s.Observable(null),a.hideClusters=new s.Observable(r.ClusterHidingOptions.none),a.renderer=null,a.rendererInformation=[],a.featureLayerRenderer=null,a._featureLayerGraphics=[],a._clusters=[],a._hiddenClusters=[],a._clusterLabelColor=null,a._clusterBackgroundColor=null,a._featureSetName=null,a._esriEventHandlers=[],a._gcxEventHandlers=[],a._fontSize="10pt",a._fontFamily="Segoe UI, sans-serif",a._clusterExploded=!1,a._mapClickEnabled=!0,a.MAP_CLICK_PREVENTION_DELAY=300,a._isChrome=!1,!(e.mapService.serviceLayer instanceof esri.layers.FeatureLayer))throw new Error("ClusterLayers require an Esri FeatureLayer to be passed in as a parameter.");a.app=i,a.id=e.mapService.id+"-cluster",a._featureSetName=a.id+"FeatureSet",a.gcxLayer=e,a.featureLayer=e.mapService.serviceLayer,a.singleFeatureLayer=new esri.layers.GraphicsLayer,a.url=a.featureLayer.url,a.setVisibility(a.featureLayer.visible&&a.featureLayer.visibleAtMapScale),a.setOpacity(a.featureLayer.opacity),a.featureLayerRenderer=a.featureLayer.renderer,a.featureLayer.setRenderer(null),a.featureLayer.redraw(),a.singleFeatureLayer.id=e.mapService.id+"-explodedClusterLayer",a.singleFeatureLayer.setRenderer(a.featureLayerRenderer),a.singleFeatureLayer.setOpacity(a.featureLayer.opacity),a.singleFeatureLayer.url=a.url,a.clusterRadius.set(e.mapService.featureClustering.radius||50),a.maxFeaturesInCluster.set(e.mapService.featureClustering.maximumFeatures||0),a._clusterLabelColor=new esri.Color(e.mapService.featureClustering.labelColor),a._clusterBackgroundColor=new esri.Color(e.mapService.featureClustering.backgroundColor);for(var n=0;n<4;n++)a.rendererInformation.push({isVisible:new s.Observable(!1),rangeString:new s.Observable("")});return a.maxFeaturesInCluster.bind(a,function(e){a.gcxLayer.mapService.featureClustering.maximumFeatures=e,a._loadRenderer()}),a.clusterRadius.bind(a,function(e){a.gcxLayer.mapService.featureClustering.radius=e}),a.maxFeaturesInCluster.get()>0&&a._loadRenderer(),a.app.map&&a.app.map.loaded?a._setupEventListeners(a.app.map):a.app.event("MapLoadedEvent").once(a,function(e){a._setupEventListeners(e)}),a._isChrome=l.isChrome(),a.recluster(),a}return e(u,t),u.prototype.recluster=function(){this.singleFeatureLayer.clear(),this._clusterExploded=!1,this._featureLayerGraphics=this.featureLayer.graphics.slice(0,this.featureLayer.graphics.length),this._generateClusters(),this.redraw()},u.prototype.destroy=function(){this.app.map.getLayer(this.singleFeatureLayer.id)===this.singleFeatureLayer&&this.app.map.removeLayer(this.singleFeatureLayer),this.app.featureSetManager.getCollectionById(this._featureSetName)&&(this.app.featureSetManager.closeCollection(this._featureSetName),this.app.featureSetManager.removeCollectionById(this._featureSetName)),this.app.map.removeLayer(this),this.featureLayer.setRenderer(this.featureLayerRenderer),this.featureLayer.redraw();for(e=0;e<this._esriEventHandlers.length;e++)this._esriEventHandlers[e].remove();for(var e=0;e<this._gcxEventHandlers.length;e++)this.app.event(this._gcxEventHandlers[e].eventName).unsubscribe(this._gcxEventHandlers[e].token)},u.prototype.onFeatureClicked=function(e){if(e.graphic instanceof esri.Graphic&&!this.app.toolRegistry.getActiveTool()){var t=e.graphic,r=this.isClusterExploded();this.singleFeatureLayer.clear(),this._addClusterToMapTip(t.attributes.clusterId,r)}},u.prototype.isClusterExploded=function(){return this.singleFeatureLayer.graphics.length>0},u.prototype._addClusterToMapTip=function(e,t){var s=this;this._hiddenClusters=[];var l=[],u=[];this.hideClusters.get()===r.ClusterHidingOptions.none&&t&&this.recluster();for(var o=0;o<this._featureLayerGraphics.length;o++)if(this._featureLayerGraphics[o].attributes.clusterId===e){var h={graphic:this._featureLayerGraphics[o],layer:this.gcxLayer,resolveLayerFields:!0};h.symbol=this._getRenderedSymbol(this._featureLayerGraphics[o]),l.push(new i.Feature(h)),u.push(this._featureLayerGraphics[o])}u.length>1?this._explodeCluster(e,u,t):this.app.command("EnableMapClick").execute();var p=new a.FeatureSet;p.features.set(l),p.layer=this.gcxLayer,p.esriFeatureSet=new esri.tasks.FeatureSet,p.esriFeatureSet.features=u,p.resolveDataLinks(function(e){s.app.event("FeatureChangedEvent").publish(e)});var c=new n.FeatureSetCollection;c.featureSets.addItem(p),c.id=this._featureSetName,c.sourceName="ClusterFeatures",p.features.length()>1&&this.app.command("ScreenReaderNarrate").execute("Cluster with "+p.features.length()+" features exploded"),this.app.featureSetManager.getCollectionById(this._featureSetName)&&this.app.featureSetManager.removeCollectionById(this._featureSetName),this.app.featureSetManager.addCollection(c),this.app.featureSetManager.openCollection(this._featureSetName),this.app.featureSetManager.closeCollection(this._featureSetName)},u.prototype._explodeCluster=function(e,t,s){for(var i=this,a=0;a<t.length;a++)this.singleFeatureLayer.add(t[a]);if(this.hideClusters.get()===r.ClusterHidingOptions.unselected)this._hiddenClusters=this.graphics.slice(0,this.graphics.length),this.clear(),this.redraw();else{for(var n=0;n<this.graphics.length;n++)this.graphics[n].attributes.clusterId==e&&this._hiddenClusters.push(this.graphics[n]);this._hiddenClusters.forEach(function(e){i.remove(e)})}var l=this.app.map.graphicsLayerIds.indexOf(this.featureLayer.id),u=this.app.map.graphicsLayerIds.indexOf(this.id),o=Math.max(l,u);this.app.map.getLayer(this.singleFeatureLayer.id)||this.app.map.addLayer(this.singleFeatureLayer,o+1),this.singleFeatureLayer.redraw(),this._clusterExploded=!0,this._disableMapClick()},u.prototype._implodeCluster=function(){this.app.stateManager.getActiveStates().filter(function(e){return"EditorActiveState"===e.stateDefinition.name}).length>0?this.singleFeatureLayer.redraw():(this.recluster(),this.app.command("ScreenReaderNarrate").execute("Exploded cluster was collapsed"),this._clusterExploded=!1)},u.prototype._setupEventListeners=function(e){var t=this;this._isChrome?this._gcxEventHandlers.push({eventName:"MapMouseDownEvent",token:this.app.event("MapMouseDownEvent").subscribe(this,function(e){return t._mapMouseDownEvent(e)})}):this._esriEventHandlers.push(e.on("click",function(e){t._mapClickedEvent(e)})),this._gcxEventHandlers.push({eventName:"MapExtentChangedEvent",token:this.app.event("MapExtentChangedEvent").subscribe(this,function(e,r){return t._mapExtentChangedEvent(e,r)})}),this._gcxEventHandlers.push({eventName:"MapTipClosedEvent",token:this.app.event("MapTipClosedEvent").subscribe(this,function(){return t._mapTipClosedEvent()})}),this._gcxEventHandlers.push({eventName:"ClusterLayerRemovedEvent",token:this.app.event("ClusterLayerRemovedEvent").subscribe(this,function(e){return t._clusterLayerRemovedEvent(e)})}),this._gcxEventHandlers.push({eventName:"LayerVisibilityChangedEvent",token:this.app.event("LayerVisibilityChangedEvent").subscribe(this,function(e){return t._layerVisibilityChangedEvent(e)})}),this._gcxEventHandlers.push({eventName:"GeometryEditInvokedEvent",token:this.app.event("GeometryEditInvokedEvent").subscribe(this,function(e){t.isClusterExploded()||t.recluster()})}),this._gcxEventHandlers.push({eventName:"GeometryEditCompletedEvent",token:this.app.event("GeometryEditCompletedEvent").subscribe(this,function(e){return t._handleGeometryChange()})}),this._gcxEventHandlers.push({eventName:"EditorClosedEvent",token:this.app.event("EditorClosedEvent").subscribe(this,function(){return t._handleEditorClosedEvent()})}),this._esriEventHandlers.push(this.featureLayer.on("update-end",function(e){t.isClusterExploded()||t.recluster()}))},u.prototype._handleGeometryChange=function(){this.isClusterExploded()?this.singleFeatureLayer.redraw():this.recluster()},u.prototype._handleEditorClosedEvent=function(){this.isClusterExploded()?this.singleFeatureLayer.redraw():this.recluster()},u.prototype._mapMouseDownEvent=function(e){var t=this;if(this.visible&&(!e.button||0===e.button)){var r=!1,s=!1,i=this.app.event("MapMouseUpEvent").once(this,function(e){r=!0}),a=dojo.connect(this.app.map,"onDblClick",function(e){s=!0});setTimeout(function(){t.app.event("MapMouseUpEvent").unsubscribe(i),dojo.disconnect(a),r&&!s&&t._mapClickedEvent(e)},300)}},u.prototype._mapClickedEvent=function(e){if(this.visible&&null===this.app.toolRegistry.getActiveTool()){if(this._clusterExploded)return this._implodeCluster(),void this._enableMapClick();if(this._mapClickEnabled){this._isChrome&&this.recluster();var t=e&&e.graphic?e.graphic:null;return t&&t.getLayer()===this&&t.attributes&&t.geometry instanceof esri.geometry.Point?(this.app.command("CancelSearch").execute(),this.app.command("DisableMapClick").execute(),t.attributes.clusterId&&t.attributes.clusterCount?void this.onFeatureClicked(e):void this.app.command("ShowMapTip").execute(new i.Feature({graphic:t,layer:this.gcxLayer}))):void 0}this._enableMapClick()}},u.prototype._mapExtentChangedEvent=function(e,t){if(!this._currExtent||JSON.stringify(e.toJson())!==JSON.stringify(this._currExtent.toJson())){if(this._currExtent=e,!this.featureLayer.visibleAtMapScale||!this.featureLayer.visible)return this.setVisibility(!1),void this._enableMapClick();this.setVisibility(!0),!this.visible||!this.featureLayer.visibleAtMapScale||this.isClusterExploded()&&this.hideClusters.get()!==r.ClusterHidingOptions.none||(this.isClusterExploded()&&this._enableMapClick(),this.recluster()),this._loadRenderer()}},u.prototype._mapTipClosedEvent=function(){this.visible&&(this._enableMapClick(),this.recluster())},u.prototype._clusterLayerRemovedEvent=function(e){e===this&&this.destroy()},u.prototype._layerVisibilityChangedEvent=function(e){var t=this;e.forEach(function(e){e.layer===t.gcxLayer&&(t.setVisibility(e.visibility&&t.featureLayer.visibleAtMapScale),t._loadRenderer())})},u.prototype._loadRenderer=function(){var e=new esri.renderer.ClassBreaksRenderer(null,"clusterCount"),t=null;if(this.maxFeaturesInCluster.get()>0)t=this.maxFeaturesInCluster.get();else{for(var r=0,s=0;s<this._clusters.length;s++)this._clusters[s].attributes.clusterCount>r&&(r=this._clusters[s].attributes.clusterCount);t=r}var i=Math.ceil(.309999999999*t);1===i&&i++;var a=Math.ceil(.31*t);a<=i&&(a=i+1);var n=Math.ceil(.609999999999*t);n<a&&(n=a);var l=Math.ceil(.61*t);l<=n&&(l=n+1);var u=Math.ceil(.909999999999*t);u<l&&(u=l);var o=Math.ceil(.91*t);o<=u&&(o=u+1),this._addBreak(e,21,2,i,t,0),this._addBreak(e,28,a,n,t,1),this._addBreak(e,35,l,u,t,2),this._addBreak(e,42,o,1/0,t,3),this.setRenderer(e)},u.prototype._addBreak=function(e,t,r,s,i,a){i>=r&&this.visible&&this.featureLayer.visibleAtMapScale?(r!==s?s!==1/0?this.rendererInformation[a].rangeString.set(r+" - "+s):this.rendererInformation[a].rangeString.set(r+"+"):this.rendererInformation[a].rangeString.set(r.toString()),this.rendererInformation[a].isVisible.set(!0)):this.rendererInformation[a].isVisible.set(!1);var n=null;n=8===dojo.isIE?new esri.symbol.SimpleMarkerSymbol({color:this._clusterBackgroundColor.toRgba(),size:t,type:"esriSMS",style:"esriSMSCircle",outline:{color:this._makeTransparent(this._clusterBackgroundColor.toRgba()),width:8,type:"esriSLS",style:"esriSLSSolid"}}):new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(this._makeTransparent(this._clusterBackgroundColor.toRgba())),8),this._clusterBackgroundColor),e.addBreak(r,s,n)},u.prototype._makeTransparent=function(e){return 4===e.length&&(e[3]=.25),e},u.prototype._isValidCluster=function(e,t,r){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/r<=this.clusterRadius.get()&&this._isClusterFull(t)},u.prototype._isClusterFull=function(e){return e.attributes.clusterCount<this.maxFeaturesInCluster.get()||0==this.maxFeaturesInCluster.get()||""==this.maxFeaturesInCluster.get().toString()},u.prototype._generateClusters=function(){this.clear(),this._clusters=[],this._addGraphicsToClusters(!1);for(var e=[],t=0;t<this._clusters.length;t++)e[t]={x:this._clusters[t].x,y:this._clusters[t].y,attributes:{clusterCount:0,clusterId:this._clusters[t].attributes.clusterId,extent:this._clusters[t].attributes.extent}};this._clusters=e,this._addGraphicsToClusters(!0),this._showAllClusters()},u.prototype._addGraphicsToClusters=function(e){for(var t=this._featureLayerGraphics.length,r=this.app.map.extent.getWidth()/this.app.map.width,s=0;s<t;s++){var i=null;if(this._featureLayerGraphics[s].geometry instanceof esri.geometry.Point&&this._featureLayerGraphics[s].visible)if(i=this._featureLayerGraphics[s].geometry,this.app.map.extent.contains(i)){for(var a=this._featureLayerGraphics[s],n=[],l=0;l<this._clusters.length;l++){var u=this._clusters[l];this._isValidCluster(i,u,r)&&n.push(u)}if(1===n.length)this._clusterAddPoint(a,i,n[0],e);else if(n.length>1){for(var o=[],l=0;l<n.length;l++)o[l]=Math.sqrt(Math.pow(n[l].x-i.x,2)+Math.pow(n[l].y-i.y,2));for(var h=null,p=null,l=0;l<o.length;l++)(null===p||p>o[l])&&(p=o[l],h=n[l]);this._clusterAddPoint(a,i,h,e)}else this._createCluster(a,i)}else this._featureLayerGraphics[s].attributes.clusterId=-1}},u.prototype._showAllClusters=function(){0!=this.maxFeaturesInCluster.get()&&""!=this.maxFeaturesInCluster.get().toString()||this._loadRenderer();for(var e=0,t=this._clusters.length;e<t;e++)this._showCluster(this._clusters[e])},u.prototype._showCluster=function(e){var t=new esri.geometry.Point(e.x,e.y,this.app.map.spatialReference),r=new esri.Graphic(t,null,e.attributes);if(r.setSymbol(this._getRenderedSymbol(r)),this.add(r),!(e.attributes.clusterCount<2)){var s=null;8===dojo.isIE?(s=new esri.symbol.TextSymbol({type:"esriTS",color:this._clusterLabelColor.toRgba(),xoffset:0,yoffset:-5,font:{family:this._fontFamily,size:this._fontSize,weight:"bold"}})).setText(e.attributes.clusterCount.toString()):((s=new esri.symbol.TextSymbol(e.attributes.clusterCount)).setColor(this._clusterLabelColor),s.setOffset(0,-5),s.setFont(new esri.symbol.Font(this._fontSize).setFamily(this._fontFamily).setWeight(esri.symbol.Font.WEIGHT_BOLD)));var i=new esri.Graphic(t,s,e.attributes);this.add(i)}},u.prototype._getRenderedSymbol=function(e){if(1!==e.attributes.clusterCount)return null;var t=this.featureLayerRenderer;if(!t)return null;if(t instanceof esri.renderer.SimpleRenderer)return t.getSymbol(e);for(var r=0;r<this._featureLayerGraphics.length;r++){var s=this._featureLayerGraphics[r];if(s.attributes.clusterId===e.attributes.clusterId)return t.getSymbol(s)}},u.prototype._clusterAddPoint=function(e,t,r,s){var i,a,n;s||(i=r.attributes.clusterCount,a=(t.x+r.x*i)/(i+1),n=(t.y+r.y*i)/(i+1),r.x=a,r.y=n),t.x<r.attributes.extent[0]?r.attributes.extent[0]=t.x:t.x>r.attributes.extent[2]&&(r.attributes.extent[2]=t.x),t.y<r.attributes.extent[1]?r.attributes.extent[1]=t.y:t.y>r.attributes.extent[3]&&(r.attributes.extent[3]=t.y),r.attributes.clusterCount++,t.hasOwnProperty("attributes")||(t.attributes={}),e.attributes.clusterId=t.attributes.clusterId=r.attributes.clusterId},u.prototype._createCluster=function(e,t){var r=this._clusters.length+1;e.attributes.clusterId=r;var s={x:t.x,y:t.y,attributes:{clusterCount:1,clusterId:r,extent:[t.x,t.y,t.x,t.y]}};this._clusters.push(s)},u.prototype._enableMapClick=function(){var e=this;this.visible&&setTimeout(function(){e.app.command("CancelSearch").execute(),e.app.command("EnableMapClick").execute(),e._mapClickEnabled=!0},this.MAP_CLICK_PREVENTION_DELAY)},u.prototype._disableMapClick=function(){var e=this;this.visible&&setTimeout(function(){e.app.command("DisableMapClick").execute(),e._mapClickEnabled=!1},this.MAP_CLICK_PREVENTION_DELAY)},u}(esri.layers.GraphicsLayer);r.ClusterLayer=u})}}});require({cache:{"geocortex/infrastructure/collaboration/GroupedMarkupFeatures":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/ICollaborationEventViewModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/ICollaborationHandler":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/ImageRestEvent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/MessageRestEvent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/QueryOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/QueryResponse":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/RestEvent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/RestEventRequestArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/RestRoom":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/RestRoomRequestArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/RoomQueryOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/collaboration/ShareMarkupRestEvent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/ColorUtils":function(){define(["require","exports","./symbology/SymbolColor"],function(r,e,t){"use strict";function o(r){if("string"==typeof r){var e=n(r);if(e)return new dojo.Color({r:e.r,g:e.g,b:e.b,a:e.a})}return dojo.isArray(r)&&4===r.length?(r[3]>1&&(r[3]=r[3]/255),new dojo.Color(r)):new dojo.Color(r)}function n(r){if(dojo.isArray(r))return new esri.Color(o(r));if("string"==typeof r&&r.startsWith("#")&&9===r.length){var e=parseInt(r.slice(1,3),16),t=parseInt(r.slice(3,5),16),n=parseInt(r.slice(5,7),16),i=parseInt(r.slice(7,9),16);return e/=255,new esri.Color([t,n,i,e])}return new esri.Color(r)}Object.defineProperty(e,"__esModule",{value:!0}),e.getColorFromList=o,e.getColorFromString=n,e.getStringFromList=function(r){if(r)return 4===r.length?(r[3]>1&&(r[3]=r[3]/255),"rgba({0}, {1}, {2}, {3})".format(r[0],r[1],r[2],r[3])):3===r.length?"rgb({0}, {1}, {2})".format(r[0],r[1],r[2]):void 0},e.getStringFromHex=function(r){if("string"==typeof r&&r.startsWith("#")){if(9===r.length){var e=parseInt(r.slice(1,3),16),t=parseInt(r.slice(3,5),16),o=parseInt(r.slice(5,7),16),n=parseInt(r.slice(7,9),16);return e/=255,"rgba({0}, {1}, {2}, {3})".format(t,o,n,e)}if(7===r.length){var t=parseInt(r.slice(1,3),16),o=parseInt(r.slice(3,5),16),n=parseInt(r.slice(5,7),16);return"rgb({0}, {1}, {2})".format(t,o,n)}}},e.generateRandomColors=function(r){void 0===r&&(r=6);for(var e=[],o=Math.random(),n=0;n<r;n++){var i=o+1/r*n;i-=Math.floor(i);var a=new t.SymbolColor({h:i,s:.8,v:1});n%3==0&&(a=a.darken(Math.random()/1.8)),n%3==1&&(a=a.lighten(Math.random()/1.1)),e.push(a)}return e.sort(function(r){return.5-Math.random()})},e.generateRandomColor=function(){var r=Math.random();return new t.SymbolColor({h:r,s:.8,v:1})},e.isColorInputSupported=function(){if(window.navigator.userAgent.indexOf("GeocortexApp.Windows")>-1)return!1;var r=document.createElement("input");return r.setAttribute("type","color"),"text"!==r.type}})}}});require({cache:{"geocortex/infrastructure/commandArgs/AddStatusArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,n,i,o){this.text=e,this.imageProperties=t,this.userClosedCallback=r,this.id=n,this.timeoutMS=i||3e4,this.showBusyIcon=!!o}}();t.AddStatusArgs=r})},"geocortex/infrastructure/commandArgs/ClusterLayerArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.ClusterLayerArgs=r})},"geocortex/infrastructure/commandArgs/CombineResultsArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/ConfirmOptionArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/ContextMenuArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/CreateOrEditFeatureFromBarcodeScanArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/CutGraphicsArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/DeleteAttachmentsArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/DisplayNotificationArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/DownloadOfflineResourcesArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/EditAttachmentArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/EditFeatureArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/EditInMemoryArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/EditRelatedRecordArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/ExportGraphicsLayerArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/FindAllSelectionMetadataArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/FindMetadataForSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/FindSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/GeolocateArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/HeatMapArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/HighlightFeatureArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/IdentifyArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/ImageProperties":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/MarkerArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/ProjectArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,n,i){this.geometries=e,this.outputSpatialReference=n,this.callback=t,this.errback=r,this.transformation=i}}();t.ProjectArgs=r})},"geocortex/infrastructure/commandArgs/PushpinArgs":function(){define(["require","exports","./../Feature"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPushpinArgs=function(e){return!!(e&&e.feature&&e.feature instanceof r.Feature&&e.tag)}})},"geocortex/infrastructure/commandArgs/RenameSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/RunReportArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/SelectionArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/ShowMapElementArgs":function(){define(["require","exports","geocortex/framework/ui/ViewBase","./../FilterUtils"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r,n){this.destroyContentView=!1,this.delay=0,this.elementID=e||null,this.mapPoint=t||null,this.content=r||null,this.title=n||null}return e.prototype.getNode=function(){if(this.content){if(this.contentIsView())return this.content.root;if(this.content.nodeName)return this.content;if("string"==typeof this.content){var e=document.createElement("div");return e.innerHTML=new n.UnsafeHtml(this.content).safeHtml,e}}return null},e.prototype.getTitleNode=function(){if(this.title){if(this.titleIsView())return this.title.root;if(this.title.nodeName)return this.title;if("string"==typeof this.title){var e=document.createElement("div");return e.innerHTML=new n.UnsafeHtml(this.title).safeHtml,e}}return null},e.prototype.contentIsView=function(){return this.content&&this.content instanceof r.ViewBase},e.prototype.titleIsView=function(){return this.title&&this.title instanceof r.ViewBase},e}();t.ShowMapElementArgs=i})},"geocortex/infrastructure/commandArgs/ShowOfflineProfileEditorArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/TapToDismissArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/UpdateGraphicsArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/UpdateMetadataForSelectionArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/commandArgs/VisualizationArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/commands.meta":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});!function(e){e.commandsMetadata=[{name:"ActivateView",metadata:{arguments:"string",description:"Activates a view.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateView",metadata:{arguments:"string",description:"Deactivates a view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleView",metadata:{arguments:"string",description:"Activates or deactivates a view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleLogView",metadata:{arguments:"none",description:"Activates or deactivates log view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLog",metadata:{arguments:"boolean",description:"Shows the log view if the parameter is true.",isHyperlinkable:!0,visibility:"public"}},{name:"HideLog",metadata:{arguments:"none",description:"Hides the log view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleResultsFrame",metadata:{arguments:"none",description:"Activates or deactivates Results frame.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleDataFrame",metadata:{arguments:"none",description:"Activates or deactivates data frame.",isHyperlinkable:!0,visibility:"public"}},{name:"DestroyView",metadata:{arguments:"string",description:"Destroys a view, wiping out its bindings and DOM substructure.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseModalRegion",metadata:{arguments:"none",description:"Closes the ModalWindowRegion.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenWebPage",metadata:{arguments:"string",description:"Opens a web page in another tab/window.",isHyperlinkable:!0,visibility:"public"}},{name:"Alert",metadata:{arguments:"string",description:"Displays an alert.",isHyperlinkable:!0,visibility:"public"}},{name:"Confirm",metadata:{arguments:"list",description:"Displays a confirm.",isHyperlinkable:!0,visibility:"private"}},{name:"ConsoleDir",metadata:{arguments:"object",description:"Displays a representation of the specified parameter object in the browser's debugging console.",isHyperlinkable:!0,visibility:"public"}},{name:"Identify",metadata:{arguments:"esri.geometry.Geometry",description:"Executes an identify operation on a geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedGeometry",metadata:{arguments:"esri.geometry.Geometry",description:"Activates the Buffer Options dialog, buffers input geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedFeature",metadata:{arguments:"esri.Graphic|essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Activates the Buffer Options dialog, buffers input feature geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedFeatureSet",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSet|essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection|string",description:"Activates the Buffer Options dialog, buffers input feature set geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"IdentifyBufferedFeatureSetCollection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection|string",description:"Activates the Buffer Options dialog, buffers input feature set collection geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"Prompt",metadata:{arguments:"object",description:"Displays a prompt.",isHyperlinkable:!0,visibility:"private"}},{name:"StartOfflineSyncAndShowProgress",metadata:{arguments:"string",description:"Starts downloading or syncing an offline map an displays the progress to the user.",isHyperlinkable:!0,visibility:"public"}},{name:"StepZoomIn",metadata:{arguments:"none",description:"Zooms in a step.",isHyperlinkable:!0,visibility:"public"}},{name:"StepZoomOut",metadata:{arguments:"none",description:"Zooms out a step.",isHyperlinkable:!0,visibility:"public"}},{name:"RecenterMapOnNextMapResize",metadata:{arguments:"none",description:"Recenters the map to its existing position the next time the map is resized.",isHyperlinkable:!0,visibility:"public"}},{name:"PanToPoint",metadata:{arguments:"esri.geometry.Geometry",description:"Pans to a point or other type of Geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"PanUp",metadata:{arguments:"none",description:"Pans the map up.",isHyperlinkable:!0,visibility:"public"}},{name:"PlotCoordinates",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateBase|essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateBase[]",description:"Plots a coordinate (or a number of coordinates) on the map.",isHyperlinkable:!1,visibility:"public"}},{name:"PanDown",metadata:{arguments:"none",description:"Pans the map down.",isHyperlinkable:!0,visibility:"public"}},{name:"PanLeft",metadata:{arguments:"none",description:"Pans the map left.",isHyperlinkable:!0,visibility:"public"}},{name:"PanRight",metadata:{arguments:"none",description:"Pans the map right.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToExtent",metadata:{arguments:"esri.geometry.Extent",description:"Zooms to the given extent.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToScale",metadata:{arguments:"number",description:"Zooms to the given scale.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomOutToExtent",metadata:{arguments:"esri.geometry.Extent",description:"Zooms out to the given extent.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToLayerExtent",metadata:{arguments:"geocortex.essentials.Layer",description:"Zooms to the extent of all the features in a layer.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToLayerVisibleScale",metadata:{arguments:"geocortex.essentials.Layer",description:"Zooms to the scale at which features in a layer become visible.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToInitialExtent",metadata:{arguments:"none",description:"Zooms to the initial extent of the current Site.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToPreviousExtent",metadata:{arguments:"none",description:"Zooms to the previous recorded map extent if any.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToNamedExtent",metadata:{arguments:"string",description:"Zooms to the bookmarked extent with the specified name.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToNextExtent",metadata:{arguments:"none",description:"Zooms to the next recorded map extent if any.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToOfflineMapExtent",metadata:{arguments:"none",description:"Zooms to the extent of the currently active offline map.",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToFullExtent",metadata:{arguments:"none",description:"Zooms to the full extent of the current Site.",isHyperlinkable:!0,visibility:"public"}},{name:"MapResize",metadata:{arguments:"none",description:"Tells the map control to resize itself. This should be called after altering the map container's dimensions.",isHyperlinkable:!0,visibility:"public"}},{name:"MaximizePanel",metadata:{arguments:"string",description:"Instructs the region hosting a view to maximize itself if it supports this action. As of v2.4, only the BottomPanelRegion and its sub regions support this action.",isHyperlinkable:!0,visibility:"public"}},{name:"RestorePanel",metadata:{arguments:"string",description:"Instructs the region hosting a view to restore itself to default dimensions if it supports this action. As of v2.4, only the BottomPanelRegion and its sub regions support this action.",isHyperlinkable:!0,visibility:"public"}},{name:"AddTemporaryMarkupGeometry",metadata:{arguments:"esri.geometry.Geometry",description:"Adds a temporary markup graphic to the map. The {@link Commands.ClearTemporaryMarkup} command will clear this piece of markup.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearTemporaryMarkup",metadata:{arguments:"none",description:"Removes temporary markup created by the command 'AddTemporaryMarkupGeometry'",isHyperlinkable:!0,visibility:"public"}},{name:"RippleClick",metadata:{arguments:"MouseEvent",description:"Creates a ripple feedback effect when clicking on the map",isHyperlinkable:!1,visibility:"private"}},{name:"ToggleRippleClick",metadata:{arguments:"none",description:"Toggles the visibility of the ripple feedback given for map clicks",isHyperlinkable:!0,visibility:"private"}},{name:"ClearTrustedUrls",metadata:{arguments:"none",description:"Clears list of trusted URLs which are added by clicking 'yes' on potentially untrusted content popup",isHyperlinkable:!0,visibility:"public"}},{name:"ZoomToFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Zooms to a feature.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToFeatureIfOutsideMapExtent",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Zooms to a feature if the it's outside of the map's extent, otherwise nothing happens.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSet",description:"Zooms to the extent of all the features in the feature set.",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToFeatureSetCollection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Shows all of the features in the Feature Set Collection on the map",isHyperlinkable:!0,visibility:"private"}},{name:"ZoomToAllFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Zooms to the extent of all the features.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMap",metadata:{arguments:"none",description:"Activates map view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapElement",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs",description:"Displays an element anchored to a specific point on the map.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapCallout",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs",description:"Displays a map callout anchored to a given point.",isHyperlinkable:!0,visibility:"private"}},{name:"HideMapElement",metadata:{arguments:"string",description:"Removes an element previously anchored to the map using {@link Commands.ShowMapElement}.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapTipResults",metadata:{arguments:"string",description:"Shows map tip results for a FeatureSetCollection previously added to the FeatureSetManager.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapTipResultsInCallout",metadata:{arguments:"string",description:"Shows map tip results for a FeatureSetCollection previously added to the FeatureSetManager, in a floating callout window on the map (the default behavior prior to version 2.4).",isHyperlinkable:!0,visibility:"public"}},{name:"OpenDataFrame",metadata:{arguments:"none",description:"Opens the DataRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseDataFrame",metadata:{arguments:"none",description:"Closes the DataRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"ChangeDataFramePosition",metadata:{arguments:"args: {position: PanelPosition; callback?: () => void",description:"Change the DataRegion position to desidered one, if it is present in the current shell.",isHyperlinkable:!1,visibility:"private"}},{name:"OpenBottomRegion",metadata:{arguments:"none",description:"Opens the BottomPanelRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseBottomRegion",metadata:{arguments:"none",description:"Closes the BottomPanelRegion, if it is present in the current shell.",isHyperlinkable:!0,visibility:"public"}},{name:"RunWorkflowById",metadata:{arguments:"string",description:"Runs a workflow.",isHyperlinkable:!0,visibility:"public"}},{name:"RunWorkflowWithGeometry",metadata:{arguments:"object",description:"Runs a workflow with a geometry used as an input argument.",isHyperlinkable:!0,visibility:"private"}},{name:"RunWorkflowWithArguments",metadata:{arguments:"object",description:"Runs a workflow with a set of input arguments.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayWorkflowContainerContent",metadata:{arguments:"object",description:"Displays a view in a workflow container.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearActiveTool",metadata:{arguments:"none",description:"Clears the active tool.",isHyperlinkable:!0,visibility:"public"}},{name:"SetActiveTool",metadata:{arguments:"string",description:"Sets the active tool.",isHyperlinkable:!0,visibility:"public"}},{name:"Geolocate",metadata:{arguments:"object",description:"Zooms to the current location of the device when it becomes available.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateTrack",metadata:{arguments:"none",description:"Enables the tracking of the device's location when it is available, without panning the map.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateFollow",metadata:{arguments:"none",description:"Enables the following of the device's location when it is available, panning the map.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateStop",metadata:{arguments:"none",description:"Stops the tracking and following of the device's location.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateShowBuffer",metadata:{arguments:"none",description:"Display a circular buffer showing the accuracy of the latest GPS reading.",isHyperlinkable:!0,visibility:"public"}},{name:"GeolocateHideBuffer",metadata:{arguments:"none",description:"Hide a circular buffer showing the accuracy of the latest GPS reading.",isHyperlinkable:!0,visibility:"public"}},{name:"TakeApplicationOffline",metadata:{arguments:"none",description:"Puts the application in an offline state.",isHyperlinkable:!1,visibility:"public"}},{name:"TapToDismiss",metadata:{arguments:"args: {view: framework.ui.ViewBase; onOtherInteracted?: (evt?: Event) => void ; onElementInteracted?: (evt?: Event) => void}",description:"Dismisses the specified view on the next tap anywhere on the screen. Optionally fires specified callbacks.",isHyperlinkable:!1,visibility:"private"}},{name:"TakeApplicationOnline",metadata:{arguments:"none",description:"Connects the application to the internet.",isHyperlinkable:!1,visibility:"public"}},{name:"SetGMAFOfflineButtonState",metadata:{arguments:"string",description:"Sets the visibility of the online/offline button in the GMAF app.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleConnectivity",metadata:{arguments:"none",description:"Toggles the connectivity of the app, from offline to online or viceversa",isHyperlinkable:!0,visibility:"public"}},{name:"RefreshOfflineMapsList",metadata:{arguments:"string",description:"Refresh the list of offline maps on the OfflineMapsList view.",isHyperlinkable:!1,visibility:"public"}},{name:"OpenFeatureSetCollection",metadata:{arguments:"string",description:"Opens the FeatureSetCollection.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenPortalMyContentWindow",metadata:{arguments:"none",description:"Opens a new browser window to the authenticated users ArcGIS Portal 'My Content' page.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseFeatureSetCollection",metadata:{arguments:"string",description:"Closes the FeatureSetCollection.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveFeatureSetCollection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Removes the specified collection from the FeatureSetManager.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveFeatureSetCollectionById",metadata:{arguments:"string",description:"Removes the collection specified by ID from the FeatureSetManager.",isHyperlinkable:!0,visibility:"public"}},{name:"Search",metadata:{arguments:"string",description:"Performs a search on all active providers.",isHyperlinkable:!0,visibility:"public"}},{name:"GlobalSearch",metadata:{arguments:"string",description:"Performs a search on all active providers.",isHyperlinkable:!0,visibility:"public"}},{name:"BufferGeometry",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.buffer.BufferGeometryArgs",description:"Buffers input geometry, adds buffer markup to the map, and fires the callback and event with the buffered geometry. When the source command is specified, buffers using current settings for the command.",isHyperlinkable:!0,visibility:"private"}},{name:"CancelEditCoordinate",metadata:{arguments:"none",description:"Cancels editing of a coordinate if currently active.",isHyperlinkable:!0,visibility:"public"}},{name:"CancelSearch",metadata:{arguments:"none",description:"Cancel the search on all providers.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearSearch",metadata:{arguments:"none",description:"Clear the search results.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearSelection",metadata:{arguments:"none",description:"Clears the open identify results/selection.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowExportWebMapDialog",metadata:{arguments:"none",description:"Activates the export web map view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowFeatureDetails",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays the Feature Details dialog for the Feature or FeatureSetCollection specified.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowFeatureDetailsCompact",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays the Feature Details dialog for the {@link geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature} in Compact View mode. If the feature is not specified, details for the last feature will be displayed.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowFeatureDetailsExpanded",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays the Feature Details dialog for the {@link geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature} in Expanded View mode. If the feature is not specified, details for the last feature will be displayed.",isHyperlinkable:!0,visibility:"private"}},{name:"SetFeatureDetailsMode",metadata:{arguments:"string",description:"Sets the feature details dialog to the specified view mode.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowFeatureParentDetails",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Shows the previously opened feature when browsing related features in the feature details view.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowFeatureAttributeEditor",metadata:{arguments:"none",description:"Shows the feature attribute editor used to set feature attributes.",isHyperlinkable:!0,visibility:"public"}},{name:"HideFeatureAttributeEditor",metadata:{arguments:"none",description:"Hides the feature attribute editor used to set feature attributes.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowFeatureTemplatePicker",metadata:{arguments:"layer",description:"Shows the feature template picker used to create new features. If a layer is supplied, shows the templates for the layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HideFeatureTemplatePicker",metadata:{arguments:"none",description:"Hides the feature template picker used to create new features.",isHyperlinkable:!0,visibility:"public"}},{name:"FSMCollectionSetCommand",metadata:{arguments:"string, string",description:"Set the preferred command to open the FeatureSetCollection for the given source name.",isHyperlinkable:!0,visibility:"private"}},{name:"PanToAllFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Pans to the extent of all the features.",isHyperlinkable:!0,visibility:"private"}},{name:"PanToFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Pans to a Geocortex feature.",isHyperlinkable:!0,visibility:"private"}},{name:"PanToFeatureIfOutsideMapExtent",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Pans to a Geocortex feature if the feature is outside of the map's extent, otherwise nothing happens.",isHyperlinkable:!0,visibility:"private"}},{name:"Project",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ProjectArgs",description:"Calls a geometry service to project geometries between different coordinate systems.",isHyperlinkable:!1,visibility:"private"}},{name:"InvokeMapTip",metadata:{arguments:"esri.geometry.Geometry",description:'Executes an Identify operation on the given geometry and sets "MapTip" as its source tag.',isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapTip",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Displays a feature in the map tip view.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapTipInCallout",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Displays a feature in a map tip callout anchored to the map.",isHyperlinkable:!0,visibility:"private"}},{name:"SuspendMapTips",metadata:{arguments:"none",description:"Suspends the display of map tips, allowing other components the opportunity to interact with the map without invoking map tips on click/tap events.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToLayerTheme",metadata:{arguments:"string",description:"Switches to the specified layer theme, identified by ID or display name.",isHyperlinkable:!0,visibility:"public"}},{name:"ResumeMapTips",metadata:{arguments:"none",description:"Resumes the previously suspended display of map tips.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearStorageForApplication",metadata:{arguments:"none",description:"Clears the offline data for the current application.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearStorageForDomain",metadata:{arguments:"none",description:"Clears all offline data for the current domain. This includes data for all applications loaded from the current domain.",isHyperlinkable:!0,visibility:"public"}},{name:"ListReports",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Presents a user interface for choosing to run a report from a list of reports that are available to the given reportable input (group of features).",isHyperlinkable:!1,visibility:"public"}},{name:"RunFeatureReport",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Alias to 'ListReports' for backwards compatibility with the Silverlight viewer.",isHyperlinkable:!0,visibility:"public"}},{name:"RunFeaturesReport",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Alias to 'ListReports' for backwards compatibility with the Silverlight viewer.",isHyperlinkable:!1,visibility:"public"}},{name:"RunReport",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.RunReportArgs",description:"Runs a given report on the provided features, and displays the result (a download link to the report file) to the user.",isHyperlinkable:!1,visibility:"public"}},{name:"ShowResultsList",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Displays the list of features in the given FeatureSetCollection as a list.",isHyperlinkable:!1,visibility:"private"}},{name:"ShowResultsTable",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection",description:"Displays the list of features in the given FeatureSetCollection in a tabular view.",isHyperlinkable:!1,visibility:"private"}},{name:"SwitchToListResultsView",metadata:{arguments:"none",description:"Switches from Results Table to Results List view if the Results Table view is currently active.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToTabularResultsView",metadata:{arguments:"none",description:"Switches from Results List to Results Table view if the Results List view is currently active.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenResultsFrame",metadata:{arguments:"none",description:"Activates the ResultsRegion.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseResultsFrame",metadata:{arguments:"none",description:"Deactivates the ResultsRegion.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLayerList",metadata:{arguments:"none",description:"Displays the layer list.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToLayerView",metadata:{arguments:"none",description:"Displays the layer list.",isHyperlinkable:!0,visibility:"public"}},{name:"SwitchToLegendView",metadata:{arguments:"none",description:"Displays the legend view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLayerActions",metadata:{arguments:"geocortex.essentials.Layer",description:"Shows available actions for a given layer.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowMapServiceActions",metadata:{arguments:"geocortex.essentials.MapService",description:"Shows available actions for a given map service.",isHyperlinkable:!0,visibility:"private"}},{name:"HideMapServiceActions",metadata:{arguments:"none",description:"Closes the map service actions view.",isHyperlinkable:!0,visibility:"private"}},{name:"PulseStatus",metadata:{arguments:"string",description:"Resets the timer of the status view model.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveStatus",metadata:{arguments:"string",description:"Removes the status indicator from the screen with the specified ID.",isHyperlinkable:!0,visibility:"public"}},{name:"AddStatus",metadata:{arguments:"string",description:"Adds a status indicator to the screen.",isHyperlinkable:!0,visibility:"public"}},{name:"CreateHighlightLayer",metadata:{arguments:"string",description:"Creates a new highlight layer with the specified name.",isHyperlinkable:!0,visibility:"private"}},{name:"SetActiveHighlightLayer",metadata:{arguments:"string",description:"Sets the layer with the specified name as active, if there is one.",isHyperlinkable:!0,visibility:"private"}},{name:"SetActiveHighlightLayerDefault",metadata:{arguments:"none",description:"Sets the default highlight layer as the active highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HighlightEsriFeatureSet",metadata:{arguments:"esri.tasks.FeatureSet",description:"Highlights all of the features in the specified Esri feature set in the active highlight layer.",isHyperlinkable:!1,visibility:"private"}},{name:"SetHighlightBorderColor",metadata:{arguments:"string",description:"Sets the border color used for new highlights, specified in 6 or 8 digit hex in RGB or ARGB form.",isHyperlinkable:!0,visibility:"public"}},{name:"SetHighlightBorderWidth",metadata:{arguments:"number",description:"Sets the border width (in pixels) used for new highlights.",isHyperlinkable:!0,visibility:"public"}},{name:"SetHighlightFillColor",metadata:{arguments:"string",description:"Sets the current highlight fill color to use for a highlighted feature.",isHyperlinkable:!0,visibility:"public"}},{name:"SetFocusedBorderColor",metadata:{arguments:"string",description:"Sets the border color used for an focused feature.",isHyperlinkable:!0,visibility:"public"}},{name:"SetFocusedFillColor",metadata:{arguments:"string",description:"Sets the current highlight fill color to use, if the feature does not specify one.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveHighlightLayer",metadata:{arguments:"string",description:"Removes the highlight layer with the specified name, if there is one.",isHyperlinkable:!0,visibility:"public"}},{name:"AddMapService",metadata:{arguments:"essentials.MapService",description:"Integrate a map service and its sub-components into the viewer and onto the map.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveMapService",metadata:{arguments:"essentials.MapService",description:"Removes a user added map service off of the map and out of the viewer.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveUserAddedLayer",metadata:{arguments:"essentials.Layer",description:"Remove a user added layer (and its parent map service) off of the map and out of the viewer.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearHighlights",metadata:{arguments:"string",description:"Removes the highlights from the default highlight layer (no parameter), or from the highlight layer with the supplied name",isHyperlinkable:!0,visibility:"public"}},{name:"ClearDefaultHighlights",metadata:{arguments:"none",description:"Removes the highlights from the default highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HighlightFeatureSet",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.FeatureSet",description:"Highlights all of the features in the specified feature set in the active highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"HighlightFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Highlights the feature (or array of features) in the active highlight layer.",isHyperlinkable:!0,visibility:"public"}},{name:"HighlightFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Highlights the feature (or array of features) in the active highlight layer.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearAndHighlightFeatures",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature[]",description:"Clears existing highlights and highlights all specified features on the active highlight layer.",isHyperlinkable:!1,visibility:"public"}},{name:"FocusFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Focuses the specified feature on the active highlight layer.",isHyperlinkable:!1,visibility:"public"}},{name:"ClearFeatureHighlight",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Clears the highlight from a feature if it's currently highlighted.",isHyperlinkable:!1,visibility:"public"}},{name:"ClearFeatureFocus",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Clears the feature emphasis from a feature if it's currently focused, returning it to the highlighted state.",isHyperlinkable:!1,visibility:"public"}},{name:"HighlightFeatureDefault",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Highlights the feature in the default highlight layer.",isHyperlinkable:!0,visibility:"private"}},{name:"AddMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Adds the given geometry to the markup layer.",isHyperlinkable:!0,visibility:"private"}},{name:"AddMarkupGeometry",metadata:{arguments:"esri.geometry.Geometry",description:"Adds the given geometry to the markup layer.  (Identical to the AddMarkup command.)",isHyperlinkable:!0,visibility:"private"}},{name:"AddTextMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Prompts the user for text to add as markup. When completed, text markup is added at the provided geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"ClearMarkup",metadata:{arguments:"none",description:"Prompts the user for confirmation, and if approved, clears all of the markup from the markup layer.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearMarkupQuiet",metadata:{arguments:"none",description:"Clears all of the markup from the markup layer without prompting for confirmation.",isHyperlinkable:!0,visibility:"public"}},{name:"MeasureDistance",metadata:{arguments:"esri.geometry.Polyline",description:"Computes the total and segment distance measurements for the specified Polyline geometry and plots it on the map along with its measurements. NOTE: An Esri or Geocortex feature may also be provided as arguments in lieu of a polyline geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"MeasureArea",metadata:{arguments:"esri.geometry.Polygon",description:"Computes the area, perimeter and individual segment distances for the specified Polylgon geometry and plots it on the map along with its measurements. NOTE: An Esri or Geocortex feature may also be provided as arguments in lieu of a polygon geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteMeasurement",metadata:{arguments:"esri.geometry.Geometry",description:"Deletes measurement markup within the given geometry",isHyperlinkable:!0,visibility:"private"}},{name:"SetMeasurementUnits",metadata:{arguments:"string, string",description:"Sets the measurement units for the measurements performed by the measurement module. Also updates existing measurements already on the map.",isHyperlinkable:!1,visibility:"private"}},{name:"ResizeShell",metadata:{arguments:"none",description:"Recalculate the size and layout of the shell and refresh the shell accordingly.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateHomePanel",metadata:{arguments:"none",description:"Activates Home Panel if it is configured to be included.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivatePlotCoordinatesView",metadata:{arguments:"none",description:"Activates the Plot Coordinates view.",isHyperlinkable:!0,visibility:"public"}},{name:"ApplyFilterControlQuery",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.eventArgs.FilterControlQueryChangedEventArgs",description:"Applies the current query to the specified Filter Control.",isHyperlinkable:!1,visibility:"public"}},{name:"ShowHomePanel",metadata:{arguments:"none",description:"Activates Home Panel if it is configured to be included.",isHyperlinkable:!0,visibility:"public"}},{name:"HideHomePanel",metadata:{arguments:"none",description:"Deactivates/hides the Home Panel if it is configured to be included.",isHyperlinkable:!0,visibility:"public"}},{name:"AttachFileToFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Checks for HTML5 FileReader / Cordova support and activates File Attachments if supported.",isHyperlinkable:!0,visibility:"private"}},{name:"ToggleToolbar",metadata:{arguments:"none",description:"Toggles the visibility of the toolbar if present.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenToolbar",metadata:{arguments:"none",description:"Opens the toolbar, if present.",isHyperlinkable:!0,visibility:"public"}},{name:"CloseToolbar",metadata:{arguments:"none",description:"Closes the toolbar, if present.",isHyperlinkable:!0,visibility:"public"}},{name:"PrintMap",metadata:{arguments:"none",description:"Displays a dialog to create a printable map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowExportMapDialog",metadata:{arguments:"none",description:"Displays a dialog to save a map image.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowLayerCatalog",metadata:{arguments:"none",description:"Shows the layer catalog view.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateTimeSlider",metadata:{arguments:"none",description:"Activates and shows the Time Slider if time slider profiles are available in the site.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateTimeSlider",metadata:{arguments:"none",description:"Deactivates time settings applied to the map and hides the Time Slider.",isHyperlinkable:!0,visibility:"public"}},{name:"HideTimeSlider",metadata:{arguments:"none",description:"Hides the time slider if currently visible but does not deactivate time settings applied to the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowTimeSliderSettings",metadata:{arguments:"none",description:"Shows the time slider settings view.",isHyperlinkable:!0,visibility:"public"}},{name:"HideTimeSliderSettings",metadata:{arguments:"none",description:"Hides the time slider settings view.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleTimeSliderActions",metadata:{arguments:"none",description:"Toggles the time slider actions container visibility.",isHyperlinkable:!0,visibility:"public"}},{name:"StartTimeSliderPlayback",metadata:{arguments:"none",description:"Starts playback for an open time slider.",isHyperlinkable:!0,visibility:"public"}},{name:"StopTimeSliderPlayback",metadata:{arguments:"none",description:"Stops playback for an open time slider.",isHyperlinkable:!0,visibility:"public"}},{name:"StepTimeSliderForward",metadata:{arguments:"none",description:"Steps the time slider forward in an open time slider.",isHyperlinkable:!0,visibility:"public"}},{name:"StepTimeSliderBack",metadata:{arguments:"none",description:"Steps the time slider backward in an open time slider.",isHyperlinkable:!0,visibility:"public"}},{name:"SetTimeSliderProfile",metadata:{arguments:"geocortex.essentials.TimeSliderProfile",description:"Sets a specified time slider profile or updates the existing profile if only a partial profile is specified.",isHyperlinkable:!0,visibility:"public"}},{name:"AddCatalogLayers",metadata:{arguments:"Comma seperated string of layer ids.",description:"Adds catalog layers.",isHyperlinkable:!1,visibility:"public"}},{name:"AppendCatalogLayers",metadata:{arguments:"Comma seperated string of layer ids.",description:"Appends catalog layers.",isHyperlinkable:!1,visibility:"public"}},{name:"ClearLayerCatalogLayers",metadata:{arguments:"none",description:"Clears all catalog layers.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveLayerCatalogIds",metadata:{arguments:"A string array of CatalogIds to be removed",description:"Removes specific catalog layers",isHyperlinkable:!1,visibility:"public"}},{name:"ShowBookmarks",metadata:{arguments:"none",description:"Displays the Bookmarked Locations menu if the BookmarkViewModel's property, bookmarksEnabled, is set to true.",isHyperlinkable:!0,visibility:"public"}},{name:"AddBookmark",metadata:{arguments:"string",description:"Bookmark the current extent with the given name.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowAddBookmark",metadata:{arguments:"none",description:"Prompts the user to bookmark the current extent by entering a name.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowCoordinateActions",metadata:{arguments:"string",description:"Shows the configured coordinate actions.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveBookmark",metadata:{arguments:"string",description:"Removes a bookmark with the given name if exists.",isHyperlinkable:!0,visibility:"public"}},{name:"SelectBaseMap",metadata:{arguments:"string",description:"A map can have a number of basemaps associated with it. SelectBaseMap allows you to programmatically select one of the basemaps to display. All other basemaps are then faded out.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateSelectLayersForIdentify",metadata:{arguments:"none",description:"Activates the Layer Selector for Identify and applies current settings.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateSelectLayersForIdentify",metadata:{arguments:"none",description:"Deactivates the Layer Selector for Identify and enables all default identifiable layers.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateBuffering",metadata:{arguments:"string|string[]",description:"Activates buffering for the specified command(s). Uses currently configured settings for the command.",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateBufferingAndDisplayOptions",metadata:{arguments:"string",description:"Activates buffering for the specified command and displays the associated Buffer Options dialog. ",isHyperlinkable:!0,visibility:"public"}},{name:"ActivateTransientElements",metadata:{arguments:"string",description:"Activates any transient elements configured against a specific ID in the toolbar module.",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateBuffering",metadata:{arguments:"string|string[]",description:"Deactivates buffering, if active, for the specified command(s).",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateBufferingAndDismissOptions",metadata:{arguments:"string",description:"Deactivates buffering for the specified command and dismisses the associated Buffer Options dialog if its active. ",isHyperlinkable:!0,visibility:"public"}},{name:"DeactivateTransientElements",metadata:{arguments:"string",description:"Deactivates any transient elements configured against a specific ID in the toolbar module.",isHyperlinkable:!0,visibility:"public"}},{name:"DeleteAllCoordinates",metadata:{arguments:"none",description:"Deletes all plotted Coordinates from the map.",isHyperlinkable:!0,visibility:"public"}},{name:"DeleteCoordinates",metadata:{arguments:"string|string[]",description:"Deletes one or many plotted Coordinates from the map.",isHyperlinkable:!0,visibility:"public"}},{name:"EditCoordinate",metadata:{arguments:"string|null",description:"Edits a plotted Coordinate on the map or creates a new coordinate in edit mode if no descriptor Id is provided.",isHyperlinkable:!0,visibility:"public"}},{name:"EditMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Edits markup that intersects the extent of the provided geometry.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteMarkup",metadata:{arguments:"esri.geometry.Geometry",description:"Deletes markup within the given geometry",isHyperlinkable:!0,visibility:"private"}},{name:"CreateMarkupStyleView",metadata:{arguments:"string",description:"Activates the style picker if 'point', 'polyline', 'polygon', or 'text' is the string provided. If it is null, then the app will try and detect what style selector to activate.",isHyperlinkable:!0,visibility:"public"}},{name:"ChangeMarkupStyle",metadata:{arguments:"MarkupTemplate",description:"Takes a MarkupTemplate, PointTemplate, PolylineTemplate, PolygonTemplate, or TextTemplate. It will change the style of the markup to suit the template provided.",isHyperlinkable:!0,visibility:"private"}},{name:"StopEditingMarkup",metadata:{arguments:"boolean",description:"Stops editing. If arg is true, clears the active tool, if arg is false, doesn't clear active tool.",isHyperlinkable:!0,visibility:"public"}},{name:"StartEditingFeature",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Shows the editing form.",isHyperlinkable:!0,visibility:"private"}},{name:"EnableSearchRefinement",metadata:{arguments:"boolean",description:"Enables or disables the refinement of a global search from within search hints (if any).",isHyperlinkable:!0,visibility:"public"}},{name:"ExportResultsTo",metadata:{arguments:"{ format: string, fsc: geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection }",description:"Enables or disables the refinement of a global search from within search hints (if any).",isHyperlinkable:!0,visibility:"private"}},{name:"ExportMarkupLayer",metadata:{arguments:"none",description:"Exports markup layer.",isHyperlinkable:!0,visibility:"public"}},{name:"ExportGraphicsLayer",metadata:{arguments:"{ args:  geocortex.essentialsHtmlViewer.mapping.infrastructure.commandArgs.ExportGraphicsLayerArgs}",description:"Exports graphics layer.",isHyperlinkable:!1,visibility:"public"}},{name:"HideAllCoordinates",metadata:{arguments:"none",description:"Hides all plotted Coordinates temporarily.",isHyperlinkable:!0,visibility:"public"}},{name:"HideCoordinates",metadata:{arguments:"string|string[]",description:"Hides one or many plotted Coordinates temporarily.",isHyperlinkable:!0,visibility:"public"}},{name:"HideCoordinateActions",metadata:{arguments:"none",description:"Hide any coordinate actions view that is currently open.",isHyperlinkable:!0,visibility:"public"}},{name:"SignIn",metadata:{arguments:"string",description:"Navigates to the sign-in page. The sign in experience can be customized by crafting a custom sign-in URL, otherwise the default sign-in URL for the site will be used.",isHyperlinkable:!0,visibility:"public"}},{name:"SignOut",metadata:{arguments:"string",description:"Navigates to the sign-out page, which will sign the current user out.",isHyperlinkable:!0,visibility:"public"}},{name:"LogOptimizerEvent",metadata:{arguments:"string, string",description:"Logs an event for Geocortex Optimizer.",isHyperlinkable:!0,visibility:"private"}},{name:"AddPushpin",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Creates and displays a pushpin for the Feature specified.",isHyperlinkable:!0,visibility:"private"}},{name:"AddPushpins",metadata:{arguments:"string",description:"Creates and displays pushpins for the FeatureSetCollection specified.",isHyperlinkable:!0,visibility:"public"}},{name:"RemovePushpin",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Removes the pushpin from the map for the given feature, if there is one.",isHyperlinkable:!0,visibility:"private"}},{name:"RemovePushpins",metadata:{arguments:"none",description:"Removes all pushpins from the map.",isHyperlinkable:!0,visibility:"public"}},{name:"EnablePushpins",metadata:{arguments:"none",description:"Enables the display of pushpins/markers on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"DisablePushpins",metadata:{arguments:"none",description:"Disables the display of pushpins/markers on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowPushpins",metadata:{arguments:"none",description:"Displays pushpins by setting their visibility to true, for each result in the results list or results table.  Pushpins must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"StopFeaturePlacementState",metadata:{arguments:"none",description:"Cancels any feature placement while a feature is being created or edited.",isHyperlinkable:!0,visibility:"public"}},{name:"HidePushpins",metadata:{arguments:"none",description:"Prevents the display of pushpins by setting their visibility to false.  Pushpins must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"SetCollectionOfInterest",metadata:{arguments:"string",description:"Sets the FeatureSetCollection of interest that will be used to generate data for Charts.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowChartingView",metadata:{arguments:"none",description:"Activates the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayBufferOptions",metadata:{arguments:"string",description:"Displays the Buffer Options dialog for the specified target command",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayChartById",metadata:{arguments:"string",description:"Opens the specified chart in the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveChartById",metadata:{arguments:"string",description:"Removes the specified chart from the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearCharts",metadata:{arguments:"none",description:"Removes all charts from the charting view.",isHyperlinkable:!0,visibility:"public"}},{name:"ClearFeatureInformation",metadata:{arguments:"none",description:"Used to 'reset' the information stored within RelatedFeatures (which features are currently open, etc.)",isHyperlinkable:!0,visibility:"public"}},{name:"DisableMapClick",metadata:{arguments:"none",description:"Prevents the commands configured to execute on map click from executing and also prevents the MapClickedEvent from firing.",isHyperlinkable:!0,visibility:"public"}},{name:"DisableMapTips",metadata:{arguments:"none",description:"Disables the display of map tips on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableAllLayersForIdentify",metadata:{arguments:"none",description:"Enables all identifiable layers such that they participate in Identify operations",isHyperlinkable:!0,visibility:"public"}},{name:"DisableAllLayersForIdentify",metadata:{arguments:"none",description:"Disables all identifiable layers such that they do not participate in Identify operations",isHyperlinkable:!0,visibility:"public"}},{name:"EnableLayerForIdentify",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.identify.LayerDescriptor",description:"Enables the specified layer, if it's identifiable, such that it participates in Identify operations.",isHyperlinkable:!0,visibility:"public"}},{name:"DisableLayerForIdentify",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.identify.LayerDescriptor",description:"Disables the specified layer, if it's in the list of identifiable layers, such that it does not participate in Identify operations.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableMapClick",metadata:{arguments:"none",description:"Enables all configured commands to execute on map click and also wires up the MapClickEvent to fire when the map is clicked.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableMapTips",metadata:{arguments:"none",description:"Enables the display of map tips on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"HideAllMapTips",metadata:{arguments:"none",description:"Prevents the display of map tips by setting their visibility to `false`.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"HideMapTips",metadata:{arguments:"none",description:"Prevents the display of map tips by setting their visibility to `false`, and suspends displaying map tips.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"RestoreAllMapTips",metadata:{arguments:"none",description:"Displays previously hidden map tips by setting their visibility to `true`.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowAllCoordinates",metadata:{arguments:"none",description:"Shows all plotted coordinates (including temporarily hidden ones) on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowCoordinates",metadata:{arguments:"string|string[]",description:"Shows one or many plotted, hidden Coordinates on the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMapTips",metadata:{arguments:"none",description:"Displays previously hidden map tips by setting their visibility to `true`, and resumes displaying map tips.  Map tips must be enabled for this command to work.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleMouseCoordinates",metadata:{arguments:"none",description:"Toggles the visibility of the mouse coordinates widget if present.",isHyperlinkable:!0,visibility:"public"}},{name:"SetTimeExtent",metadata:{arguments:"esri.TimeExtent",description:"Sets the time extent for the map.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowShareView",metadata:{arguments:"none",description:"Activates the share view",isHyperlinkable:!0,visibility:"public"}},{name:"ShareOn",metadata:{arguments:"string",description:"Shares the Viewer url on the specified platform",isHyperlinkable:!0,visibility:"public"}},{name:"ScreenReaderNarrate",metadata:{arguments:"string",description:"If a user has screenreader software enabled, then the provided string is immediately spoken to them.",isHyperlinkable:!0,visibility:"public"}},{name:"DisableScreenReaderNarrate",metadata:{arguments:"none",description:"Disables the 'ScreenReaderNarrate' command temporarily.",isHyperlinkable:!0,visibility:"public"}},{name:"EnableScreenReaderNarrate",metadata:{arguments:"none",description:"Enables screen reader narration if it was previously disabled using DisableScreenReaderNarrate.",isHyperlinkable:!0,visibility:"public"}},{name:"BroadcastCurrentViewpoint",metadata:{arguments:"string",description:"Broadcasts the viewers current viewpoint to the specified external component.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateStatus",metadata:{arguments:"string",description:"Updates the message shown on the status indicator.",isHyperlinkable:!0,visibility:"public"}},{name:"UploadData",metadata:{arguments:"none",description:"Prompt the user to upload layers onto the map straight from their own computer.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowExternalComponentView",metadata:{arguments:"none",description:"Activates the external component view.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayDockedExternalComponentById",metadata:{arguments:"string",description:"Opens the specified external component in the external components view. If this component is open in a separate window, it will be closed.",isHyperlinkable:!0,visibility:"public"}},{name:"DisplayUndockedExternalComponentById",metadata:{arguments:"string",description:"Opens the specified external component in a separate window from the viewer. If this component is open in the viewer, it will be closed.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveExternalComponentById",metadata:{arguments:"string",description:"Removes the specified external component from the viewer. If the component is in a separate window, that window will be closed.",isHyperlinkable:!0,visibility:"public"}},{name:"ToggleExternalComponentSyncById",metadata:{arguments:"string",description:"Toggle whether the specified external component is synchronized with the viewer.",isHyperlinkable:!0,visibility:"private"}},{name:"ListenToExternalComponentFrame",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.integration.ComponentFrameInfo",description:"Wires up a PostMessage Transport and enables bi-directional communication with the component.",isHyperlinkable:!0,visibility:"private"}},{name:"CreateOrEditFeatureFromBarcodeScan",metadata:{arguments:"object",description:"Launch the barcode scanner, and use the result to create a new feature or edit an existing one.",isHyperlinkable:!0,visibility:"public"}},{name:"LaunchBarcodeScannerWithCallback",metadata:{arguments:"none",description:"Lauches a QR scan, then calls the provided callback with the result.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowMarkers",metadata:{arguments:"none",description:"Displays markers by setting their visibility to `true`.",isHyperlinkable:!0,visibility:"private"}},{name:"HideMarkers",metadata:{arguments:"none",description:"Prevents the display of markers by setting their visibility to `false`.",isHyperlinkable:!0,visibility:"private"}},{name:"AddMarker",metadata:{arguments:"string",description:"Creates and displays a marker on the map.",isHyperlinkable:!0,visibility:"private"}},{name:"RemoveMarker",metadata:{arguments:"string",description:"Removes the marker from the map.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateMarker",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.MarkerArgs",description:"Updates the marker with the given marker arguments.",isHyperlinkable:!0,visibility:"private"}},{name:"ShowAccessibilityView",metadata:{arguments:"none",description:"Activates the accessibility view.",isHyperlinkable:!0,visibility:"public"}},{name:"AddClusterLayer",metadata:{arguments:"string",description:"Adds a cluster layer to an existing Geocortex Layer that holds an Esri FeatureLayer.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveClusterLayer",metadata:{arguments:"string",description:"Removes a cluster layer from an existing Geocortex Layer that holds an Esri FeatureLayer.",isHyperlinkable:!0,visibility:"public"}},{name:"AddHeatMap",metadata:{arguments:"string",description:"Adds a heat map visualization to a given Geocortex layer.",isHyperlinkable:!0,visibility:"public"}},{name:"Redo",metadata:{arguments:"none",description:"Reverses the last recorded undo operation or transaction.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveHeatMap",metadata:{arguments:"string",description:"Removes a heat map visualization from a Geocortex layer.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveVisualization",metadata:{arguments:"string",description:"Removes the visualization from a Geocortex layer, if one is enabled.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowVisualizationView",metadata:{arguments:"string",description:"Shows the visualization options view for a given Geocortex layer if the layer supports any visualizations.",isHyperlinkable:!0,visibility:"public"}},{name:"Undo",metadata:{arguments:"none",description:"Invokes the last recorded undo operation or transaction.",isHyperlinkable:!0,visibility:"public"}},{name:"CreateGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Creates new graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.UpdateGraphicsArgs",description:"Updates existing graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Deletes graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"CutGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.CutGraphicsArgs",description:"Cut graphics using a polyline. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"ExplodeGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Separates multi-part graphics into individual graphics. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"UnionGraphicsInMemory",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs",description:"Merge graphics into a single graphic. These edits are only applied to the graphics layer in memory.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteProject",metadata:{arguments:"string",description:"Deletes a project.",isHyperlinkable:!0,visibility:"public"}},{name:"LoadProject",metadata:{arguments:"string",description:"Loads a project and applies it to the viewer.",isHyperlinkable:!0,visibility:"public"}},{name:"ListSelections",metadata:{arguments:"none",description:"List the available selections.",isHyperlinkable:!0,visibility:"public"}},{name:"RefreshProjectsList",metadata:{arguments:"none",description:"Refresh the list of browsable projects.",isHyperlinkable:!0,visibility:"public"}},{name:"RegisterChartPointAdapter",metadata:{arguments:"object",description:"Register the chart point adapter.",isHyperlinkable:!0,visibility:"private"}},{name:"SaveAsProject",metadata:{arguments:"none",description:"Displays the user interface to fill in details about a project to be saved.",isHyperlinkable:!0,visibility:"public"}},{name:"SaveProject",metadata:{arguments:"none",description:"Save the current state of the viewer as a project or displays the user interface to fill in details about the project to be saved.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowProjectEditor",metadata:{arguments:"string",description:"Shows the user interface for editing a project.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowProjects",metadata:{arguments:"none",description:"Shows the user interface for browsing and loading projects.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowShareProject",metadata:{arguments:"string",description:"Shows the user interface for sharing projects.",isHyperlinkable:!0,visibility:"public"}},{name:"HideFeatureDetails",metadata:{arguments:"none",description:"Hides the Feature Details dialog.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowSaveSelectionDialog",metadata:{arguments:"string",description:"Displays a dialog to save a FeatureSetCollection as a named selection.",isHyperlinkable:!0,visibility:"public"}},{name:"CreateSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Creates a new named, saved selection based on the supplied FeatureSetCollection.",isHyperlinkable:!0,visibility:"private"}},{name:"DeleteSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Deletes a named selection.",isHyperlinkable:!0,visibility:"private"}},{name:"FindSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindSelectionArgs",description:"Looks up a particular named selection.",isHyperlinkable:!0,visibility:"private"}},{name:"RenameSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.RenameSelectionArgs",description:"Assigns a new name to a saved selection.",isHyperlinkable:!0,visibility:"private"}},{name:"RestoreSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Loads a named, saved selection into the results view.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs",description:"Updates an existing named, saved selection with the supplied FeatureSetCollection.",isHyperlinkable:!0,visibility:"private"}},{name:"UpdateSelectionFindAllSelectionMetadata",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindAllSelectionMetadataArgs",description:"Lists all the available metadata for named selections.",isHyperlinkable:!0,visibility:"private"}},{name:"FindMetadataForSelection",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindMetadataForSelectionArgs",description:"Looks up metadata about a particular named selection.",isHyperlinkable:!0,visibility:"private"}},{name:"AddFeatureToResults",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Adds an individual feature to the current FeatureSetCollection displayed in the results view.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveFeatureFromResults",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Removes an individual feature from the current FeatureSetCollection displayed in the results view.",isHyperlinkable:!0,visibility:"public"}},{name:"CombineResults",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.commandArgs.CombineResultsArgs",description:"Performs advanced set operations with multiple lists of results.",isHyperlinkable:!0,visibility:"public"}},{name:"CombineResultsInteractive",metadata:{arguments:"object",description:"Performs advanced set operations with multiple lists of results.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsIntersect",metadata:{arguments:"string",description:"Only keeps results from the current set of results that also appear in the supplied FeatureSetCollection.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsReplace",metadata:{arguments:"string",description:"Replaces the current set of results with the FeatureSetCollection supplied as argument.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsSubtract",metadata:{arguments:"string",description:"Removes the supplied FeatureSetCollection from the current set of results.",isHyperlinkable:!0,visibility:"public"}},{name:"ResultsUnion",metadata:{arguments:"string",description:"Adds the supplied FeatureSetCollection to the current set of results.",isHyperlinkable:!0,visibility:"public"}},{name:"AddResultsStatus",metadata:{arguments:"string",description:"Displays a status indicator that can relay short messages in the results list or table.",isHyperlinkable:!0,visibility:"public"}},{name:"RemoveResultsStatus",metadata:{arguments:"none",description:"Removes the status indicator from the results list or table.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowCopyDialogForEvent",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.collaboration.RestEvent",description:"Opens the Collaboration event copy view.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenCollaboration",metadata:{arguments:"none",description:"Opens the Collaboration view.",isHyperlinkable:!0,visibility:"public"}},{name:"OpenAfterActionPlayback",metadata:{arguments:"none",description:"Opens the After Action Playback view.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowEditCollaborationGraphicMessageView",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.Feature",description:"Edit the associated message for a collaboration event using one of its drawn features.",isHyperlinkable:!0,visibility:"public"}},{name:"ShowEditCollaborationMessageView",metadata:{arguments:"essentialsHtmlViewer.mapping.infrastructure.collaboration.RestEvent",description:"Edit the associated message for a collaboration event using its rest event",isHyperlinkable:!0,visibility:"public"}},{name:"AutoJoinCollaborationRoom",metadata:{arguments:"string",description:"Add a collaboration room to the auto join list.",isHyperlinkable:!0,visibility:"public"}}],e.metadataForCommandName=function(i){for(var t=0;t<e.commandsMetadata.length;t++){var a=e.commandsMetadata[t];if(a.name===i)return a.metadata}return null},e.publicCommands=function(){for(var i=[],t=0;t<e.commandsMetadata.length;t++){var a=e.commandsMetadata[t];"public"===a.metadata.visibility&&i.push(a)}return i}}(i.Commands||(i.Commands={}))})}}});require({cache:{"geocortex/infrastructure/commands":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/CommandViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])};return function(n,t){function o(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(n,t,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(n){function t(e,t,o,c){var i=n.call(this,e,t)||this;return i.commandName="",i.commandParameter=null,i.canExecute=new a.Observable(!0),i.notExecuteHidden=new a.Observable(!1),o&&i._bindToCommand(o,c),i}return e(t,n),t.prototype.applyContext=function(e){this._command&&e&&this.canExecute.set(this._command.canExecute(e))},t.prototype._bindToCommand=function(e,n){this._canExecuteChangedBindingToken&&this._command&&this._command.canExecuteChanged.unsubscribe(this._canExecuteChangedBindingToken),this.commandName=e,this.commandParameter=n||null,this._command=this.app.command(e),this._canExecuteChangedBindingToken=this._command.canExecuteChanged.subscribe(this,this._handleCanExecuteChanged),this.canExecute.set(this._command.canExecute(n))},t.prototype._handleCanExecuteChanged=function(){this.canExecute.set(this._command.canExecute(this.commandParameter))},t}(o.ViewModelBase);t.CommandViewModel=c;var i;!function(e){!function(e){!function(e){!function(e){!function(e){e.CommandViewModel=e.CommandViewModel}(e.command||(e.command={}))}(e.modules||(e.modules={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(i||(i={}))})}}});require(["geocortex/framework/resourceManager"],function(I){I.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/common.css","css","LyogQ1NTIFJFU0VUIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpib2R5LCBkaXYsIGRsLCBkdCwgZGQsIGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIHByZSwgZm9ybSwgZmllbGRzZXQsIHAsIGJsb2NrcXVvdGUsIHRoLCB0ZCB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCnRhYmxlIHsNCiAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOw0KICAgIGJvcmRlci1zcGFjaW5nOiAwOw0KfQ0KDQpmaWVsZHNldCwgaW1nIHsNCiAgICBib3JkZXI6IDA7DQp9DQoNCmJ1dHRvbiB7DQogICAgYm9yZGVyOiAwOw0KICAgIGJveC1zaGFkb3c6IG5vbmU7DQogICAgYmFja2dyb3VuZDogbm9uZTsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICBmb250LXdlaWdodDogbm9ybWFsOw0KICAgIGZvbnQtZmFtaWx5OiAiU2Vnb2UgVUkiLCJIZWx2ZXRpY2EgTmV1ZSIsIkRyb2lkIFNhbnMiLEhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmOw0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgZm9udC1zaXplOiAxZW07DQp9DQoNCmJvZHkgPiAqIHsNCiAgICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6IHJnYmEoMCwwLDAsMCk7DQogICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiB0cmFuc3BhcmVudDsgLyogRm9yIHNvbWUgQW5kcm9pZHMgKi8NCn0NCg0KLyogR0xPQkFMIFNUWUxJTkcgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCmJvZHkgew0KICAgIGZvbnQtZmFtaWx5OiAiU2Vnb2UgVUkiLCAiSGVsdmV0aWNhIE5ldWUiLCAiRHJvaWQgU2FucyIsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7DQogICAgZm9udC1zaXplOiAwLjhlbTsNCn0NCg0KaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEgew0KICAgIGZvbnQtZmFtaWx5OiAiU2Vnb2UgVUkiLCAiSGVsdmV0aWNhIE5ldWUiLCAiRHJvaWQgU2FucyIsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7DQogICAgZm9udC1zaXplOiAxZW07DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQogICAgaW5wdXQ6Oi13ZWJraXQtaW5wdXQtcGxhY2Vob2xkZXIgeyAvKiBDaHJvbWUvT3BlcmEvU2FmYXJpICovDQogICAgICAgIGNvbG9yOiAjNzY3Njc2Ow0KICAgICAgICBmb250LXN0eWxlOiBpdGFsaWM7DQogICAgICAgIGZvbnQtc2l6ZTogMC44ZW07DQogICAgfQ0KDQogICAgaW5wdXQ6Oi1tb3otcGxhY2Vob2xkZXIgeyAvKiBGaXJlZm94IDE5KyAqLw0KICAgICAgICBjb2xvcjogIzc2NzY3NjsNCiAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOw0KICAgICAgICBmb250LXNpemU6IDAuOGVtOw0KICAgICAgICBvcGFjaXR5OiAxOw0KICAgIH0NCg0KICAgIGlucHV0Oi1tcy1pbnB1dC1wbGFjZWhvbGRlciB7IC8qIElFIDEwKyAqLw0KICAgICAgICBjb2xvcjogIzc2NzY3NjsNCiAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOw0KICAgICAgICBmb250LXNpemU6IDAuOGVtOw0KICAgIH0NCg0KICAgIGlucHV0Oi1tb3otcGxhY2Vob2xkZXIgeyAvKiBGaXJlZm94IDE4LSAqLw0KICAgICAgICBjb2xvcjogIzc2NzY3NjsNCiAgICAgICAgZm9udC1zdHlsZTogaXRhbGljOw0KICAgICAgICBmb250LXNpemU6IDAuOGVtOw0KICAgICAgICBvcGFjaXR5OiAxOw0KICAgIH0NCg0KYSwgYTphY3RpdmUsIGE6dmlzaXRlZCwgYTpmb2N1cyB7DQogICAgb3V0bGluZTogbm9uZTsNCiAgICBjb2xvcjogIzFBNzJDNDsNCiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQp9DQoNCiAgICBhOmhvdmVyIHsNCiAgICAgICAgb3V0bGluZTogbm9uZTsNCiAgICAgICAgY29sb3I6ICM2NjY2NjY7DQogICAgICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KICAgIH0NCg0KLyogS2lsbGluZyBicm93c2VyIGZvY3VzIHN0YXRlcyBPTkxZIGJlY2F1c2UgDQogICB3ZSBhcmUgcmVseWluZyBvbiB0aGUgZm9jdXMgc3RhdGVzIGluY2x1ZGVkIHdpdGggdGhlDQogICAgZm9jdXMgc3RhdGVzIGluY2x1ZGVkIGluIHRoZSBhY2Nlc3NpYmlsaXR5IG1vZHVsZSAqLw0KKjpmb2N1cyB7DQogICAgb3V0bGluZTogMDsNCn0NCg0Kc2VsZWN0LA0KaW5wdXRbdHlwZT0idGV4dCJdIHsNCiAgICBtaW4td2lkdGg6IDgwcHg7DQp9DQoNCmlucHV0W3R5cGU9Im51bWJlciJdIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiAwIDAgMCAwLjNlbTsNCn0NCg0KaW5wdXRbdHlwZT0idGV4dCJdLmRpc2FibGVkLA0KaW5wdXRbdHlwZT0idGV4dCJdLmJvdW5kLWRpc2FibGVkIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGRkOw0KfQ0KDQp0ZXh0YXJlYSB7DQogICAgcmVzaXplOiBub25lOw0KfQ0KDQpwIHsNCiAgICBtYXJnaW46IDAgMCAxZW0gMDsNCn0NCg0KLyogQlJPV1NFUi1TUEVDSUZJQyBCRUhBVklPVVIgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi8qIFByZXZlbnRzIGRvdWJsZS10YXAgem9vbWluZyBvbiB0YXBhYmJsZSBlbGVtZW50cywgcmVzdWx0aW5nIGluIGEgbm9uLWRlbGF5ZWQgY2xpY2sgZXZlbnQuICovDQphLCBpbnB1dCwgYnV0dG9uIHsNCiAgICAtbXMtdG91Y2gtYWN0aW9uOiBub25lICFpbXBvcnRhbnQ7DQp9DQoNCiAgICAvKiBSZW1vdmVzIENsZWFyIGZpZWxkIGljb24gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQogICAgaW5wdXQ6Oi1tcy1jbGVhciB7DQogICAgICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsNCiAgICB9DQoNCi8qIE1PREFMIEZPUk1TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLmZvcm0tbW9kYWwgew0KICAgIGhlaWdodDogMTAwJTsNCiAgICBwYWRkaW5nOiAwLjYyNWVtOw0KfQ0KDQogICAgLmZvcm0tbW9kYWwgbGFiZWwgew0KICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgbWFyZ2luOiAuNzVlbSAwIDAuMjVlbSAwOw0KICAgIH0NCg0KICAgIC5mb3JtLW1vZGFsIGlucHV0LA0KICAgIC5mb3JtLW1vZGFsIHNlbGVjdCwNCiAgICAuZm9ybS1tb2RhbCB0ZXh0YXJlYSB7DQogICAgICAgIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7DQogICAgfQ0KDQovKiBVVElMSVRZIENMQVNTRVMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5pbmFjdGl2ZSwNCi52aWV3LmluYWN0aXZlLA0KLnJlZ2lvbiAudmlldy5pbmFjdGl2ZSwNCi5ib3VuZC1pbnZpc2libGUsDQoudmlldyAuYm91bmQtaW52aXNpYmxlLA0KLnJlZ2lvbiAudmlldyAuYm91bmQtaW52aXNpYmxlIHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouaGlkZGVuIHsNCiAgICBkaXNwbGF5OiBub25lOw0KfQ0KDQouYWN0aXZlLA0KLmFjdGl2YXRpbmcgew0KfQ0KDQouYWN0aXZhdGluZyB7DQogICAgb3BhY2l0eTogMDsNCn0NCg0KLmxlZnQgew0KICAgIGZsb2F0OiBsZWZ0Ow0KfQ0KDQoucmlnaHQgew0KICAgIGZsb2F0OiByaWdodDsNCn0NCg0KLmNsZWFyIHsNCiAgICBjbGVhcjogYm90aDsNCn0NCg0KLmJsb2NrIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCn0NCg0KLmlubGluZSB7DQogICAgZGlzcGxheTogaW5saW5lOw0KfQ0KDQouaW5saW5lLWJsb2NrIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi51bnNlbGVjdGFibGUgew0KICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgIC1tb3otdXNlci1zZWxlY3Q6IC1tb3otbm9uZTsNCiAgICAta2h0bWwtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgLW1zLXVzZXItc2VsZWN0OiBub25lOw0KICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQp9DQoNCi5zcGFjZXItdmVydGljYWwuc21hbGwgew0KICAgIGhlaWdodDogMC42ZW07DQp9DQoNCi5ib3VuZC1kaXNhYmxlZCwNCi5kaXNhYmxlZCB7DQogICAgb3BhY2l0eTogMC41Ow0KICAgIGZpbHRlcjogYWxwaGEob3BhY2l0eT01MCk7DQogICAgY3Vyc29yOiBkZWZhdWx0Ow0KfQ0KDQoNCi8qIE1PREFMIFdJTkRPVyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLm1vZGFsLmFjdGl2ZSB7DQogICAgcG9zaXRpb246IGZpeGVkOw0KICAgIHotaW5kZXg6IDk5OTsNCn0NCg0KLm1vZGFsLW92ZXJsYXksDQoubW9kYWwtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgei1pbmRleDogOTk5Ow0KfQ0KDQoubW9kYWwuYWN0aXZlLA0KLm1vZGFsLW92ZXJsYXkgew0KICAgIHRvcDogMDsNCiAgICByaWdodDogMDsNCiAgICBib3R0b206IDA7DQogICAgbGVmdDogMDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEwMCU7DQp9DQoNCi5tb2RhbC5hY3RpdmUgew0KICAgIC1tb3otdHJhbnNpdGlvbjogb3BhY2l0eSAwLjI1czsNCn0NCg0KLm1vZGFsLW92ZXJsYXkuYWN0aXZlIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMDAwOw0KICAgIG9wYWNpdHk6IDAuNzU7DQogICAgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTc1KTsNCn0NCg0KLm1vZGFsLWNvbnRhaW5lciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjNjY2NjY2Ow0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQogICAgb3ZlcmZsb3c6IHZpc2libGU7DQp9DQoNCg0KLyogVklFVyBDT05UQUlORVJTIC8gTU9EVUxFIENPTlRBSU5FUlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5wYW5lbC1oZWFkZXIgew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBoZWlnaHQ6IDMuNzVlbTsNCiAgICBsaW5lLWhlaWdodDogMy41ZW07DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0Q5RDlEOTsNCn0NCg0KLm5vLXRvdWNoIC5wYW5lbC1oZWFkZXIgew0KICAgIGxpbmUtaGVpZ2h0OiAyLjc1ZW07DQogICAgaGVpZ2h0OiAzZW07DQp9DQoNCi5wYW5lbC1oZWFkZXIgaDIgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgY29sb3I6ICM5NTkzOTg7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBjdXJzb3I6IGRlZmF1bHQ7DQp9DQoNCi5wYW5lbC10aXRsZSBpbWcgew0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQogICAgbWFyZ2luLWJvdHRvbTogM3B4Ow0KfQ0KDQoucGFuZWwtaGVhZGVyLWJ1dHRvbiB7DQogICAgd2lkdGg6IDMuNWVtOw0KICAgIGhlaWdodDogMy41ZW07DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIG9wYWNpdHk6IDAuNzU7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KICAgIGZpbHRlcjogbm9uZTsgLyogSUU5ICovDQp9DQoNCi5uby10b3VjaCAucGFuZWwtaGVhZGVyLWJ1dHRvbiB7DQogICAgaGVpZ2h0OiAyLjc1ZW07DQogICAgd2lkdGg6IDIuNzVlbTsNCn0NCg0KLnBhbmVsLWhlYWRlci1idXR0b24ubGVmdCB7DQogICAgbGVmdDogMDsNCn0NCg0KLnBhbmVsLWhlYWRlci1idXR0b24ucmlnaHQgew0KICAgIHJpZ2h0OiAwOw0KfQ0KDQoucGFuZWwtaGVhZGVyLWJ1dHRvbjpob3ZlciB7DQogICAgb3BhY2l0eTogMTsNCn0NCg0KLnJlc2l6ZS12ZXJ0aWNhbC1oaW50IC5wYW5lbC10aXRsZSB7DQogICAgY3Vyc29yOiBucy1yZXNpemU7DQp9DQoNCi5yZXNpemUtaG9yaXpvbnRhbC1oaW50IC5wYW5lbC10aXRsZSB7DQogICAgY3Vyc29yOiBldy1yZXNpemU7DQp9DQoNCi5wYW5lbC1maWx0ZXItd2lkZ2V0IHsNCiAgICBoZWlnaHQ6IDMuNWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICB0b3A6IDA7DQp9DQoNCi5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBvdmVyZmxvdzogYXV0bzsNCiAgICBvdmVyZmxvdy14OiBoaWRkZW47DQogICAgYmFja2dyb3VuZDogd2hpdGU7DQp9DQoNCi5wYW5lbC1mb290ZXIgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBib3R0b206IDA7DQogICAgb3ZlcmZsb3c6IGF1dG87DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0U4RThFODsNCiAgICBib3gtc2hhZG93OiAxcHggMXB4IDFweCAjRDlEOUQ5IGluc2V0Ow0KICAgIG92ZXJmbG93OiBoaWRkZW47DQp9DQoNCi5wYW5lbC1ub3RpZmljYXRpb24sDQoucGFuZWwtZ3JvdXAtY29udGVudHMgew0KICAgIHBhZGRpbmc6IDFlbTsNCn0NCg0KLnBhbmVsLW5vdGlmaWNhdGlvbiB7DQogICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQp9DQoNCi5wYW5lbC1ncm91cCBoMyB7DQogICAgcGFkZGluZzogLjc1ZW07DQogICAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNFRUVFRUU7DQogICAgZm9udC1zaXplOiAxZW07DQp9DQoNCiAgICAucGFuZWwtZ3JvdXAgaDMuZXhwYW5kZXIgew0KICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB9DQoNCiAgICAgICAgLnBhbmVsLWdyb3VwIGgzLmV4cGFuZGVyIGJ1dHRvbiB7DQogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICAgICAgICB0b3A6IDA7DQogICAgICAgICAgICByaWdodDogMDsNCiAgICAgICAgICAgIHdpZHRoOiA0MHB4Ow0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgYmFja2dyb3VuZDogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvZXhwYW5kZXItY2xvc2VkLTI0LnBuZykgbm8tcmVwZWF0IGNlbnRlciBjZW50ZXI7DQogICAgICAgIH0NCg0KLm1vZGFsIC5wYW5lbC1oZWFkZXIgew0KICAgIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDAuMjVyZW07DQogICAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDAuMjVyZW07DQp9DQoNCi5tb2R1bGUgew0KICAgIHBhZGRpbmc6IDAuNzVlbTsNCn0NCg0KLnZpZXcgLnBhZGRlZC12aWV3IHsNCiAgICBwYWRkaW5nOiA4cHg7DQp9DQoNCi8qIEJVVFRPTlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQouYnV0dG9uLA0KaW5wdXRbdHlwZT0ic3VibWl0Il0gew0KICAgIHBhZGRpbmc6IC41ZW07DQogICAgb3V0bGluZTogbm9uZTsNCiAgICBiYWNrZ3JvdW5kOiAjRjVGNUY1Ow0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNDQ0NDQ0M7DQogICAgYm9yZGVyLXJhZGl1czogMC4yNXJlbTsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KICAgIGJveC1zaGFkb3c6IDA7DQp9DQoNCiAgICAuYnV0dG9uOmhvdmVyIHsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzFBNzJDNDsNCiAgICAgICAgY29sb3I6ICNmZmZmZmY7DQogICAgfQ0KDQpidXR0b24gaW1nIHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOw0KfQ0KDQouYnV0dG9uLXRleHQtbGluayB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KfQ0KDQogICAgLmJ1dHRvbi10ZXh0LWxpbms6Zm9jdXMsDQogICAgLmJ1dHRvbi10ZXh0LWxpbms6aG92ZXIgew0KICAgICAgICBjb2xvcjogIzY2NjY2NjsNCiAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7DQogICAgfQ0KDQovKiBCVVRUT04gVEFCIFNUUklQIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLmJ1dHRvbi10YWItc3RyaXAgew0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IHsNCiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOw0KICAgICAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7DQogICAgICAgIG1hcmdpbjogLTFweCAuNWVtIDAuMWVtIC41ZW07DQogICAgICAgIG92ZXJmbG93OiBhdXRvOw0KICAgICAgICBvdmVyZmxvdy15OiBoaWRkZW47DQogICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgIH0NCg0KICAgIC5idXR0b24tdGFiLXN0cmlwIGJ1dHRvbiB7DQogICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgICAgcGFkZGluZzogLjZlbTsNCiAgICAgICAgYm9yZGVyLXJhZGl1czogMCAwIDAuMjVyZW0gMC4yNXJlbTsNCiAgICAgICAgb3BhY2l0eTogMC41Ow0KICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgICBib3JkZXItdG9wOiBub25lOw0KICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogYm90dG9tOw0KICAgICAgICBtaW4taGVpZ2h0OiAzLjVlbTsNCiAgICAgICAgbWluLXdpZHRoOiAzLjVlbTsNCiAgICB9DQoNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDEpIHsNCiAgICAgICAgbWF4LXdpZHRoOiAxMDAlOw0KICAgIH0NCg0KICAgIC8qIHR3byBpdGVtcyAqLw0KICAgIC5idXR0b24tdGFiLXN0cmlwIGRpdiBidXR0b246Zmlyc3QtY2hpbGQ6bnRoLWxhc3QtY2hpbGQoMiksDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCgyKSB+IGJ1dHRvbiB7DQogICAgICAgIG1heC13aWR0aDogNTAlOw0KICAgIH0NCg0KICAgIC8qIHRocmVlIGl0ZW1zICovDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCgzKSwNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDMpIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAzMy4zMzMzJTsNCiAgICB9DQoNCiAgICAvKiBmb3VyIGl0ZW1zICovDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCg0KSwNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDQpIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAyNSU7DQogICAgfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCg1KSwNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDUpIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAyMCU7DQogICAgfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCg2KSwNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDYpIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAxNi42NyU7DQogICAgfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCg3KSwNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDcpIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAxNC4yOSU7DQogICAgfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAgZGl2IGJ1dHRvbjpmaXJzdC1jaGlsZDpudGgtbGFzdC1jaGlsZCg4KSwNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDgpIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAxMi41JTsNCiAgICB9DQoNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBkaXYgYnV0dG9uOmZpcnN0LWNoaWxkOm50aC1sYXN0LWNoaWxkKDkpLA0KICAgIC5idXR0b24tdGFiLXN0cmlwIGRpdiBidXR0b246Zmlyc3QtY2hpbGQ6bnRoLWxhc3QtY2hpbGQoOSkgfiBidXR0b24gew0KICAgICAgICBtYXgtd2lkdGg6IDExLjElOw0KICAgIH0NCg0KICAgIC5idXR0b24tdGFiLXN0cmlwIGRpdiBidXR0b246Zmlyc3QtY2hpbGQ6bnRoLWxhc3QtY2hpbGQoMTApLA0KICAgIC5idXR0b24tdGFiLXN0cmlwIGRpdiBidXR0b246Zmlyc3QtY2hpbGQ6bnRoLWxhc3QtY2hpbGQoMTApIH4gYnV0dG9uIHsNCiAgICAgICAgbWF4LXdpZHRoOiAxMCU7DQogICAgfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAgYnV0dG9uOmhvdmVyIHsNCiAgICAgICAgb3BhY2l0eTogMTsNCiAgICAgICAgZmlsdGVyOiBhbHBoYShvcGFjaXR5ID0gMTAwKTsNCiAgICB9DQoNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBhLA0KICAgIC5idXR0b24tdGFiLXN0cmlwIGltZyB7DQogICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICBtYXJnaW46IDAgYXV0bzsNCiAgICB9DQoNCiAgICAuYnV0dG9uLXRhYi1zdHJpcCBpbWcgew0KICAgICAgICB3aWR0aDogMjRweDsNCiAgICAgICAgaGVpZ2h0OiAyNHB4Ow0KICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgfQ0KDQogICAgLmJ1dHRvbi10YWItc3RyaXAubm8tbGFiZWwgaW1nIHsNCiAgICAgICAgcG9zaXRpb246IHN0YXRpYzsNCiAgICB9DQoNCi50YWItc3RyaXAtbGFiZWwgew0KICAgIGZvbnQtc2l6ZTogMC45ZW07DQogICAgcGFkZGluZy1sZWZ0OiAyLjZlbTsNCiAgICBtYXJnaW46IDAuNWVtIDAgMCAwOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICB3aGl0ZS1zcGFjZTogbm9ybWFsOw0KICAgIGNvbG9yOiAjMzMzMzMzOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0NCg0KLmJ1dHRvbi10YWItc3RyaXAubm8tbGFiZWwgLnRhYi1zdHJpcC1sYWJlbCB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLmJ1dHRvbi10YWItc3RyaXAgLnRhYi1hY3RpdmUgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBib3JkZXItdG9wOiBub25lOw0KICAgIG9wYWNpdHk6IDE7DQogICAgY3Vyc29yOiBkZWZhdWx0Ow0KfQ0KDQoNCg0KDQovKiBMSVNUIE1FTlUgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoubWVudS1uby1pdGVtcyB7DQogICAgcGFkZGluZy1sZWZ0OiAuNTRlbTsNCiAgICBwYWRkaW5nLXJpZ2h0OiAuNTRlbTsNCn0NCg0KLmxpc3QtbWVudSB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgbGlzdC1zdHlsZS10eXBlOiBub25lOw0KfQ0KDQoubGlzdC1tZW51LWl0ZW0gew0KICAgIHBhZGRpbmc6IC41NGVtOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0VFRUVFRTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCiAgICAubGlzdC1tZW51LWl0ZW06YWZ0ZXIgew0KICAgICAgICBjb250ZW50OiAiICI7DQogICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICBoZWlnaHQ6IDA7DQogICAgICAgIGNsZWFyOiBib3RoOw0KICAgICAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQogICAgfQ0KDQoubGlzdC1tZW51LWljb24gew0KICAgIGZsb2F0OiBsZWZ0Ow0KfQ0KDQoubGlzdC1tZW51LWRldGFpbHMgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmctbGVmdDogMi41ZW07DQp9DQoNCiAgICAubGlzdC1tZW51LWRldGFpbHMgc3BhbiB7DQogICAgICAgIGRpc3BsYXk6IGlubGluZTsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQgIWltcG9ydGFudDsNCiAgICB9DQoNCiAgICAubGlzdC1tZW51LWRldGFpbHMgLmxpc3QtbWVudS1kZXNjIHNwYW4gew0KICAgICAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgfQ0KDQoubGlzdC1tZW51LWl0ZW0gc3Bhbi5saXN0LW1lbnUtbmFtZSwNCi5saXN0LW1lbnUtbmFtZSB7DQogICAgbWFyZ2luLWJvdHRvbTogLjFlbTsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGZvbnQtc2l6ZTogMWVtOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGxpbmUtaGVpZ2h0OiBub3JtYWw7DQp9DQoNCmEubGlzdC1tZW51LWl0ZW0gew0KICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgICBjb2xvcjogIzMzMzMzMzsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5saXN0LW1lbnUtZGVzYyB7DQogICAgY29sb3I6ICM2NjY2NjY7DQp9DQoNCmEubGlzdC1tZW51LWl0ZW0gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQovKi5oYXMtaWNvbiAubGlzdC1tZW51LWRldGFpbHMgew0KICAgIHBhZGRpbmctbGVmdDogMi41ZW07DQp9Ki8NCg0KLyouTGF5ZXJBY3Rpb25zVmlldyAubGlzdC1tZW51LWRldGFpbHMgew0KICAgIHBhZGRpbmctbGVmdDogMi41ZW07DQp9Ki8NCg0KLnN0YXRpYyAubGlzdC1tZW51LWl0ZW0gew0KICAgIGN1cnNvcjogZGVmYXVsdDsNCn0NCg0KDQovKiBHQ1ggTGlzdCBNZW51IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQouaWNvbi1yaWdodCB7DQogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiByaWdodCBjZW50ZXI7DQp9DQoNCi5pY29uLXJpZ2h0LA0KLmdjeC1saXN0LWJ1dHRvbi5pY29uLXJpZ2h0IHsNCiAgICBwYWRkaW5nLXJpZ2h0OiAwLjVlbTsNCn0NCg0KICAgIC5nY3gtbGlzdC1idXR0b24uaWNvbi1yaWdodC5jaGV2cm9uLXJpZ2h0LTI0IHsNCiAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogbm9uZTsNCiAgICB9DQoNCiAgICAuZ2N4LWxpc3QtYnV0dG9uLmljb24tcmlnaHQ6YWZ0ZXIgew0KICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgY29udGVudDogIiAiOw0KICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICAgIHRvcDogMC4zZW07DQogICAgICAgIHJpZ2h0OiAwOw0KICAgICAgICAvKmJvdHRvbTogMDsqLw0KICAgICAgICB3aWR0aDogMy41ZW07DQogICAgICAgIGhlaWdodDogMi41MGVtOw0KICAgICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDA7DQogICAgICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgfQ0KDQogICAgLmdjeC1saXN0LWJ1dHRvbi5pY29uLXJpZ2h0OmFmdGVyIHsNCiAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2NoZXZyb24tcmlnaHQtMjQucG5nIik7DQogICAgfQ0KDQogICAgLmhhcy1hY3Rpb24tMSAuZ2N4LWxpc3QtYnV0dG9uLmljb24tcmlnaHQ6YWZ0ZXIgew0KICAgICAgICByaWdodDogMy41MDBlbTsNCiAgICAgICAgd2lkdGg6IDJlbTsNCiAgICB9DQoNCi5nY3gtbGlzdC1tZW51LA0KLmdjeC1saXN0LW1lbnUgKiB7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLmdjeC1saXN0LW1lbnUgew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCi5nY3gtbGlzdC1pdGVtIHsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0VFRUVFRTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoNCi5nY3gtbGlzdC1pdGVtIC5saXN0LW1lbnUtZGV0YWlscyB7DQogICAgbWFyZ2luLWxlZnQ6IDAgIWltcG9ydGFudDsNCiAgICBwYWRkaW5nLWxlZnQ6IDAuNWVtOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KfQ0KLmdjeC1saXN0LWl0ZW0gLmdjeC1saXN0LWRlc2Mgew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwIDAuNWVtIDAuNWVtIDAuNWVtOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouZ2N4LWxpc3QtY29udGVudCwNCi5nY3gtbGlzdC1idXR0b24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICBtaW4taGVpZ2h0OiAyLjUwZW07DQogICAgcGFkZGluZzogMC41ZW07DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouZ2N4LWxpc3QtbGFiZWwsDQouZ2N4LWxpc3QtZGVzYyB7DQogICAgd29yZC1icmVhazogYnJlYWstYWxsOw0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCn0NCg0KLmdjeC1saXN0LWxhYmVsIHsNCiAgICBtYXJnaW4tYm90dG9tOiAuMWVtOw0KICAgIHBhZGRpbmctcmlnaHQ6IDUuNWVtOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgZm9udC1zaXplOiAxZW07DQogICAgZGlzcGxheTogYmxvY2s7DQp9DQoNCi5oYXMtaWNvbiAuZ2N4LWxpc3QtbGFiZWwgew0KICAgIHBhZGRpbmctbGVmdDogMi41ZW07DQp9DQouZ2N4LWxpc3QtbWVudS5oYXMtaWNvbiAubGlzdC1tZW51LWljb24gew0KICAgIG1heC13aWR0aDogMS44NWVtOw0KfQ0KDQouZ2N4LWxpc3QtZGVzYyB7DQogICAgY29sb3I6ICM2NjY2NjY7DQp9DQoNCiAgICAuZ2N4LWxpc3QtZGVzYyBpbWcgew0KICAgICAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgICAgIGhlaWdodDogYXV0bzsNCiAgICAgICAgcGFkZGluZy10b3A6IDAuOTM4ZW07DQogICAgICAgIHBhZGRpbmctYm90dG9tOiAwLjMxM2VtOw0KICAgICAgICBwYWRkaW5nLXJpZ2h0OiAwLjNlbTsNCiAgICB9DQoNCi5nY3gtbGlzdC1pdGVtLmhhcy1hY3Rpb24tMSB7DQogICAgLypwYWRkaW5nLXJpZ2h0OiAzLjVlbTsqLw0KfQ0KDQoubGlzdC1tZW51LWRldGFpbHMgLmdjeC1saXN0LWRlc2MgLmZlYXR1cmUtZGVzY3JpcHRpb24gew0KICAgIC8qIFByZXNlcnZlIHdoaXRlIHNwYWNlIGFuZCBuZXcgbGluZXMqLw0KICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsNCn0NCg0KLmdjeC1hY3Rpb24tYnV0dG9uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiAwOw0KICAgIC8qYm90dG9tOiAwOyovDQogICAgd2lkdGg6IDMuNWVtOw0KICAgIGhlaWdodDogMi41MGVtOw0KfQ0KDQogICAgLmdjeC1hY3Rpb24tYnV0dG9uOmJlZm9yZSB7DQogICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICBjb250ZW50OiAnJzsNCiAgICAgICAgd2lkdGg6IDAuMDYzZW07DQogICAgICAgIGhlaWdodDogMS41NjNlbTsNCiAgICAgICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjYWVhZWFlOw0KICAgIH0NCg0KICAgIC5nY3gtYWN0aW9uLWJ1dHRvbi5pY29uIHsNCiAgICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIGNlbnRlcjsNCiAgICB9DQoNCiAgICAuZ2N4LWxpc3QtYnV0dG9uOmhvdmVyLA0KICAgIC5nY3gtYWN0aW9uLWJ1dHRvbjpob3ZlciB7DQogICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNERUYyRkY7DQogICAgfQ0KDQouYm91bmQtZGlzYWJsZWQuZ2N4LWxpc3QtYnV0dG9uOmhvdmVyLA0KLmJvdW5kLWRpc2FibGVkLmdjeC1hY3Rpb24tYnV0dG9uOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBpbmhlcml0Ow0KfQ0KDQovKiBFUlJPUlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5nY3gtZXJyb3ItbWVzc2FnZSB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgcGFkZGluZzogMC44NWVtIDFlbSAxZW0gM2VtOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMTgzLDI5LDI5LDAuMDUpIHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9zdGF0dXMtZXJyb3ItMTYucG5nIikgbm8tcmVwZWF0IDFlbSAxZW07DQogICAgYm9yZGVyOiAxcHggc29saWQgI0I3MUQxRDsNCn0NCg0KLmdjeC1lcnJvci10ZXh0IHsNCiAgICBjb2xvcjogI0I3MUQxRDsNCn0NCg0KDQovKiAtLS0tLS0gU1RBUlQ6IENoZWNrYm94IFRvZ2dsZSAtLS0tLS0gKi8NCi5nY3gtdG9nZ2xlIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgcGFkZGluZy1sZWZ0OiAzZW07DQogICAgYmFja2dyb3VuZDogIzFBNzJDNCB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2hlY2std2hpdGUtMTYucG5nIikgMC4xMjVlbSBjZW50ZXIgbm8tcmVwZWF0Ow0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCiAgICAuZ2N4LXRvZ2dsZSAuaW5wdXQtbGFiZWwgew0KICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgcGFkZGluZzogMC4yNWVtIDAgMC4yNWVtIDAuNWVtOw0KICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICB9DQoNCi50b3VjaCAuZ2N4LXRvZ2dsZSAuaW5wdXQtbGFiZWwgew0KICAgIHBvaW50ZXItZXZlbnRzOiBub25lOw0KfQ0KDQouZ2N4LXRvZ2dsZSAuaW5wdXQtY2hlY2tib3ggew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgbGVmdDogMDsNCiAgICB6b29tOiAxOw0KICAgIGZpbHRlcjogYWxwaGEob3BhY2l0eT0wKTsNCiAgICBvcGFjaXR5OiAwOw0KfQ0KDQouZ2N4LXRvZ2dsZSAuaW5wdXQtbGFiZWw6YmVmb3JlIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICB3aWR0aDogM2VtOw0KICAgIGhlaWdodDogMS43NWVtOw0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0NDQ0NDQzsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjQUFBQUFBOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQogICAgYm94LXNoYWRvdzogMCAwIDAgMC4yNWVtICNGRkZGRkY7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjFzIGxpbmVhciAwczsNCn0NCg0KLmdjeC10b2dnbGUudG9nZ2xlLXJvdW5kIC5pbnB1dC1sYWJlbDpiZWZvcmUgew0KICAgIGJvcmRlci1yYWRpdXM6IDAuODc1ZW07DQogICAgYm94LXNoYWRvdzogMCAwIDAgMC41ZW0gI0ZGRkZGRjsNCn0NCg0KLmdjeC10b2dnbGUgLmlucHV0LWNoZWNrYm94OmNoZWNrZWQgKyAuaW5wdXQtbGFiZWw6YmVmb3JlIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsNCiAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yIDAuMXMgbGluZWFyIDBzOw0KfQ0KDQouZ2N4LXRvZ2dsZSAuaW5wdXQtbGFiZWw6YWZ0ZXIgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGNvbnRlbnQ6ICIgIjsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgbWFyZ2luOiAwLjI1ZW07DQogICAgd2lkdGg6IDEuMjVlbTsNCiAgICBoZWlnaHQ6IDEuMjVlbTsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNBQUFBQUE7DQogICAgYm9yZGVyLXJhZGl1czogMC4xMjVyZW07DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMXMgZWFzZS1vdXQgMHM7DQp9DQoNCi5nY3gtdG9nZ2xlLnRvZ2dsZS1yb3VuZCAuaW5wdXQtbGFiZWw6YWZ0ZXIgew0KICAgIGJvcmRlci1yYWRpdXM6IDAuNjI1ZW07DQp9DQoNCi5nY3gtdG9nZ2xlIC5pbnB1dC1jaGVja2JveDpjaGVja2VkICsgLmlucHV0LWxhYmVsOmFmdGVyIHsNCiAgICBsZWZ0OiAxLjI1ZW07DQogICAgdHJhbnNpdGlvbjogYWxsIDAuMXMgZWFzZS1vdXQgMHM7DQp9DQovKiAtLS0tLS0gRU5EOiBDaGVja2JveCBUb2dnbGUgLS0tLS0tICovDQovKiAtLS0tLS0gU1RBUlQ6IFN0aWNreSBIZWFkZXIgLyBTdGlja3kgRm9vdGVyIC0tLS0tLSAqLw0KLmdjeC1zdGlja3ktY29udGVudCB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICBib3R0b206IDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBvdmVyZmxvdzogYXV0bzsNCn0NCg0KICAgIC5nY3gtc3RpY2t5LWNvbnRlbnQuaGFzLWhlYWRlciB7DQogICAgICAgIHRvcDogNWVtOyAvKiBNYXRjaGVzIHN0aWNreSBoZWFkZXIgaGVpZ2h0ICovDQogICAgfQ0KDQogICAgLmdjeC1zdGlja3ktY29udGVudC5oYXMtZm9vdGVyIHsNCiAgICAgICAgYm90dG9tOiA0LjI1ZW07IC8qIE1hdGNoZXMgc3RpY2t5IGZvb3RlciBoZWlnaHQgKi8NCiAgICB9DQoNCi5nY3gtc3RpY2t5LWhlYWRlciwNCi5nY3gtc3RpY2t5LWZvb3RlciB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5nY3gtc3RpY2t5LWhlYWRlciB7DQogICAgdG9wOiAwOw0KICAgIGhlaWdodDogNWVtOyAvKiBNYXRjaGVzIHN0aWNreSBjb250ZW50IHRvcCBvZmZzZXQgKi8NCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0Q5RDlEOTsNCiAgICBiYWNrZ3JvdW5kOiAjRjhGOEY4Ow0KfQ0KDQouZ2N4LXN0aWNreS1mb290ZXIgew0KICAgIGJvdHRvbTogMDsNCiAgICBoZWlnaHQ6IDQuMjVlbTsgLyogTWF0Y2hlcyBzdGlja3kgY29udGVudCBib3R0b20gb2Zmc2V0ICovDQogICAgcGFkZGluZzogMC43NWVtOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQp9DQovKiAtLS0tLS0gRU5EOiBTdGlja3kgSGVhZGVyIC8gU3RpY2t5IEZvb3RlciAtLS0tLS0gKi8NCi8qIFRBQiBDT05UUk9MIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoudGFiLWNvbnRhaW5lciwNCi50YWItbGVmdC1zY3JvbGwsDQoudGFiLXJpZ2h0LXNjcm9sbCwNCi50YWItY29udHJvbCB7DQogICAgaGVpZ2h0OiAyLjJlbTsNCn0NCg0KICAgIC50YWItbGVmdC1zY3JvbGwsDQogICAgLnRhYi1yaWdodC1zY3JvbGwsDQogICAgLnRhYi1sZWZ0LXNjcm9sbCBhLA0KICAgIC50YWItcmlnaHQtc2Nyb2xsIGEgew0KICAgICAgICBoZWlnaHQ6IDEuNWVtOw0KICAgIH0NCg0KICAgICAgICAudGFiLXJpZ2h0LXNjcm9sbCAubmV4dCB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgLTUwcHg7DQogICAgICAgIH0NCg0KICAgICAgICAudGFiLWxlZnQtc2Nyb2xsIC5wcmV2IHsNCiAgICAgICAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciAtMjZweDsNCiAgICAgICAgfQ0KDQoudGFiLWNvbnRhaW5lciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0VFRUVFRTsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2NjY2NjYzsNCn0NCg0KICAgIC50YWItY29udGFpbmVyIC5uby1yZXN1bHRzIHsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgICB9DQoNCi50YWItY29udHJvbCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwIDAuM2VtIDAgMC4zZW07DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7DQogICAgd2lkdGg6IDEwMCU7DQp9DQoNCiAgICAudGFiLWNvbnRyb2wgbGkgew0KICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICAgIG1hcmdpbjogMC40ZW0gNHB4IDAgMDsNCiAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgICB6LWluZGV4OiAyMDA7DQogICAgfQ0KDQogICAgLnRhYi1jb250cm9sLA0KICAgIC50YWItY29udHJvbCBhLA0KICAgIC50YWItY29udHJvbCBidXR0b24sDQogICAgLnRhYi1jb250cm9sIGE6aG92ZXIgew0KICAgICAgICBsaW5lLWhlaWdodDogMS43NWVtOw0KICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICAgIGNvbG9yOiAjMzMzMzMzOw0KICAgIH0NCg0KLnRhYiwNCi50YWItYWN0aXZlIHsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgYm9yZGVyLXJhZGl1czogMC4yNXJlbSAwLjI1cmVtIDAgMDsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBwYWRkaW5nOiAwIC43NWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KLnRhYi1pbmFjdGl2ZSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQoudGFiIHsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjQ0NDQ0NDOw0KICAgIGJvcmRlci1ib3R0b206IDA7DQogICAgb3BhY2l0eTogMC43NTsNCiAgICBtYXgtd2lkdGg6IDIwZW07DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHRyYW5zaXRpb246IG1heC13aWR0aCAwLjNzIGVhc2UtaW4tb3V0Ow0KfQ0KDQogICAgLnRhYjpob3ZlciwNCiAgICAudGFiLWFjdGl2ZSB7DQogICAgICAgIG9wYWNpdHk6IDE7DQogICAgfQ0KDQogICAgLnRhYi1hY3RpdmUsDQogICAgLnRhYjpob3ZlciB7DQogICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgICAgIGJvcmRlci1ib3R0b206IDA7DQogICAgfQ0KDQoudGFiLWFjdGl2ZSB7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBvcGFjaXR5OiAxOw0KICAgIHotaW5kZXg6IDEwMDsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgbWF4LXdpZHRoOiA0MGVtOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICB0cmFuc2l0aW9uOiBtYXgtd2lkdGggMC4zcyBlYXNlLWluLW91dDsNCn0NCg0KICAgIC50YWItYWN0aXZlIHNwYW4gew0KICAgICAgICBjb2xvcjogIzAwMDAwMDsNCiAgICB9DQoNCi50YWItY29udHJvbCAudGFiLWFjdGl2ZSB7DQogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNGRkZGRkY7DQp9DQoNCi50YWIgc3BhbiwNCi50YWItYWN0aXZlIHNwYW4gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1heC13aWR0aDogMTIwcHg7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCn0NCg0KLnRhYi1sZWZ0LXNjcm9sbCwNCi50YWItcmlnaHQtc2Nyb2xsIHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KfQ0KDQogICAgLnRhYi1sZWZ0LXNjcm9sbCBhLA0KICAgIC50YWItcmlnaHQtc2Nyb2xsIGEgew0KICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAgIHotaW5kZXg6IDMwMDsNCiAgICB9DQoNCi5tdWx0aS1yZWdpb24tdmlldyAucmVnaW9uLWFjdGl2ZSB7DQp9DQovKiBMT0FERVIgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5sb2FkZXIgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgcmlnaHQ6IDEwcHg7DQogICAgd2lkdGg6IDIwcHg7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9sb2FkZXItc21hbGwuZ2lmIikgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7DQp9DQoNCg0KLyogTUVTU0FHRVMgJiBOT1RJRklDQVRJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoubm90aWZpY2F0aW9uIHRleHRhcmVhIHsNCiAgICBtYXgtd2lkdGg6IDMwMHB4Ow0KICAgIG1heC1oZWlnaHQ6IDMwMHB4Ow0KICAgIHJlc2l6ZTogbm9uZTsNCn0NCg0KLm5vdGlmaWNhdGlvbiAuZGVzYyB7DQogICAgcGFkZGluZy1ib3R0b206IDAuNWVtOw0KICAgIHdoaXRlLXNwYWNlOiBwcmU7IC8qIENTUyAyLjAgKi8NCiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7IC8qIENTUyAyLjEgKi8NCiAgICB3aGl0ZS1zcGFjZTogcHJlLWxpbmU7IC8qIENTUyAzLjAgKi8NCiAgICB3aGl0ZS1zcGFjZTogLXByZS13cmFwOyAvKiBPcGVyYSA0LTYgKi8NCiAgICB3aGl0ZS1zcGFjZTogLW8tcHJlLXdyYXA7IC8qIE9wZXJhIDcgKi8NCiAgICB3aGl0ZS1zcGFjZTogLW1vei1wcmUtd3JhcDsgLyogTW96aWxsYSAqLw0KICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsgLyogSUUgNSsgKi8NCn0NCg0KDQovKiBTUExBU0ggU0NSRUVOIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLnNoZWxsLW92ZXJsYXkgew0KICAgIGRpc3BsYXk6IHRhYmxlOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgYm90dG9tOiAwOw0KICAgIHotaW5kZXg6IDIwMDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgdHJhbnNpdGlvbjogb3BhY2l0eTsNCiAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgIC1tcy1maWx0ZXI6ICJwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQWxwaGEoT3BhY2l0eT05NSkiOw0KICAgIGZpbHRlcjogcHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LkFscGhhKE9wYWNpdHk9OTUpOw0KICAgIG9wYWNpdHk6IDAuOTU7DQp9DQoNCi5zaGVsbC1zcGxhc2ggew0KICAgIGRpc3BsYXk6IHRhYmxlLWNlbGw7DQogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi5zaGVsbC1zcGxhc2gtY29udGVudCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHBhZGRpbmc6IDNlbSAxZW0gMmVtIDFlbTsNCiAgICBtYXJnaW46IDAgYXV0bzsNCiAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7DQogICAgLW1vei1ib3gtc2hhZG93OiAwIDAgMTVweCAjQ0NDQ0NDOw0KICAgIC13ZWJraXQtYm94LXNoYWRvdzogMCAwIDE1cHggI0NDQ0NDQzsNCiAgICBib3gtc2hhZG93OiAwIDAgMTVweCAjQ0NDQ0NDOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQp9DQoNCiAgICAuc2hlbGwtc3BsYXNoLWNvbnRlbnQgaW1nIHsNCiAgICAgICAgbWF4LXdpZHRoOiAyNjBweDsgLyogcmVzdHJpY3QgdGhlIHdpZHRoIGZvciB1c2Ugb24gaGFuZGhlbGQgZGV2aWNlcyAqLw0KICAgIH0NCg0KICAgIC5zaGVsbC1zcGxhc2gtY29udGVudCBwIHsNCiAgICAgICAgZm9udC1zaXplOiAwLjhlbTsNCiAgICAgICAgY29sb3I6ICNBRkFEQjM7DQogICAgICAgIHdpZHRoOiAyN2VtOw0KICAgICAgICBtYXJnaW46IDEuNWVtIGF1dG8gMCBhdXRvOw0KICAgIH0NCg0KICAgICAgICAuc2hlbGwtc3BsYXNoLWNvbnRlbnQgcCBzdXAgew0KICAgICAgICAgICAgZm9udC1zaXplOiAwLjZlbTsNCiAgICAgICAgfQ0KDQouc2hlbGwuc3BsYXNoLm92ZXJsYXkuc3BsYXNoLWZhZGUgew0KICAgIG9wYWNpdHk6IDA7DQogICAgdHJhbnNpdGlvbjogb3BhY2l0eSAyNTBtcywgb3BhY2l0eSAyNTBtcyBlYXNlLWluIDEwbXM7DQogICAgLXdlYmtpdC10cmFuc2l0aW9uOiBvcGFjaXR5IDI1MG1zLCBvcGFjaXR5IDI1MG1zIGVhc2UtaW4gMTBtczsNCiAgICAtbW96LXRyYW5zaXRpb246IG9wYWNpdHkgMjUwbXMsIG9wYWNpdHkgMjUwbXMgZWFzZS1pbiAxMG1zOw0KICAgIC1vLXRyYW5zaXRpb246IG9wYWNpdHkgMjUwbXMsIG9wYWNpdHkgMjUwbXMgZWFzZS1pbiAxMG1zOw0KfQ0KDQpAbWVkaWEgYWxsIGFuZCAobWluLXdpZHRoOiA3MDBweCkgew0KICAgIC5zaGVsbC1zcGxhc2gtY29udGVudCB7DQogICAgICAgIHBhZGRpbmc6IDNlbSAzZW0gMmVtIDNlbTsNCiAgICB9DQoNCiAgICAgICAgLnNoZWxsLXNwbGFzaC1jb250ZW50IGltZyB7DQogICAgICAgICAgICBtYXgtd2lkdGg6IDk5OTk5cHg7IC8qIFJlbW92aW5nIHRoZSByZXN0cmljdGlvbiBvbiB0aGUgd2lkdGggZm9yIGxhcmdlciBzY3JlZW5zICovDQogICAgICAgIH0NCn0NCg0KLyogSUNPTiBDTEFTU0VTIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQouYWRkLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9hZGQtMjQucG5nKTsNCn0NCg0KLmNoZWNrLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9jaGVjay0yNC5wbmcpOw0KfQ0KDQouY2xlYXItMjQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvY2xlYXItMjQucG5nKTsNCn0NCg0KLmVkaXQtMjQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvZWRpdC0yNC5wbmcpOw0KfQ0KDQouZWRpdC1hbHQtMjQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2VkaXQtbWFya3VwLTI0LnBuZyk7DQp9DQoNCi5lcnJvci0yNCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9lcnJvci0yNC5wbmcpOw0KfQ0KDQouZmlsZS1hZGQtMjQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvZmlsZS1hZGQtMjQucG5nKTsNCn0NCg0KLmZpbGUtY2xlYXItMjQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvZmlsZS1jbGVhci0yNC5wbmcpOw0KfQ0KDQouZ2VvbWV0cnktdHlwZS1tYXBwb2ludCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9kcmF3LXBvaW50LTI0LnBuZyk7DQp9DQoNCi5nZW9tZXRyeS10eXBlLW11bHRpcG9pbnQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvZHJhdy1tdWx0aXBvaW50LTI0LnBuZyk7DQp9DQoNCi5nZW9tZXRyeS10eXBlLXBvbHlsaW5lIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9Ub29sYmFyL2RyYXctcG9seWxpbmUtMjQucG5nKTsNCn0NCg0KLmdlb21ldHJ5LXR5cGUtcG9seWdvbiB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9kcmF3LXBvbHlnb24tMjQucG5nKTsNCn0NCg0KLmdlb21ldHJ5LXR5cGUtZnJlZWhhbmRwb2x5bGluZSB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9kcmF3LWZyZWVoYW5kLTI0LnBuZyk7DQp9DQoNCi5nZW9tZXRyeS10eXBlLWV4dGVudCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9kcmF3LXJlY3RhbmdsZS0yNC5wbmcpOw0KfQ0KDQouZ2VvbWV0cnktdHlwZS1jdXJyZW50ZXh0ZW50IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9Ub29sYmFyL2RyYXctZXh0ZW50LTI0LnBuZyk7DQp9DQoNCi5tb3JlLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9tb3JlLTI0LnBuZyIpOw0KfQ0KDQouem9vbS1pbiB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL21hcC1uYXYtem9vbS1pbi0xNi5wbmciKTsNCn0NCg0KLnpvb20tb3V0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvbWFwLW5hdi16b29tLW91dC0xNi5wbmciKTsNCn0NCg0KLmNsb3NlLTE2IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvcGFuZWwtY2xvc2UucG5nIik7DQp9DQoNCi5iYWNrLTE2IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvYXJyb3ctbGVmdC0yNC5wbmciKTsNCn0NCg0KLmNsb3NlLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2xvc2UtMjQucG5nIik7DQp9DQoNCi5jaGV2cm9uLXVwLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2hldnJvbi11cC0yNC5wbmciKTsNCn0NCg0KLmNoZXZyb24tZG93bi0yNCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2NoZXZyb24tZG93bi0yNC5wbmciKTsNCn0NCg0KLmNoZXZyb24tcmlnaHQtMjQgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9jaGV2cm9uLXJpZ2h0LTI0LnBuZyIpOw0KfQ0KDQouY2hldnJvbi1yaWdodC0xNiB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2NoZXZyb24tcmlnaHQtMTYucG5nIik7DQp9DQoNCi50cmFzaGNhbi0yNCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci90cmFzaC0yNC5wbmcpOw0KfQ0KDQoNCi8qIE1JU0NFTExBTkVPVVMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5lc3JpTWFwVG9vbHRpcCB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCg0KLnVpLXJlc2l6YWJsZS1oZWxwZXIgew0KICAgIGJvdHRvbTogMDsNCiAgICBiYWNrZ3JvdW5kOiAjMDAwMDAwOw0KICAgIHpvb206IDE7DQogICAgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTMwKTsNCiAgICBvcGFjaXR5OiAwLjM7DQogICAgY3Vyc29yOiBldy1yZXNpemU7DQp9DQoNCi8qIFByZXZlbnQgY2FsbG91dHMgZnJvbSBvcGVuaW5nIHdoaWxlIGhvbGRpbmcgZG93biBvbiB0aGUgYmFubmVyLiAqLw0KLmJhbm5lciwgLmJhbm5lciAqIHsNCiAgICAtd2Via2l0LXRvdWNoLWNhbGxvdXQ6IG5vbmUgIWltcG9ydGFudDsNCn0NCg0KLyogRVNSSSBTdHlsZSBPdmVycmlkZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQouZXNyaUNvbnRyb2xzQlIgew0KICAgIHJpZ2h0OiAwLjFlbTsNCiAgICBib3R0b206IDA7DQp9DQoNCi5lc3JpQXR0cmlidXRpb24gew0KICAgIGxpbmUtaGVpZ2h0OiAxLjVlbTsNCiAgICBib3JkZXItcmFkaXVzOiAwLjA1cmVtOw0KICAgIGZvbnQtc2l6ZTogMWVtOw0KICAgIG1hcmdpbjogMC40ZW07DQp9DQoNCi52aWV3IC5qaW11LXdpZGdldCB7DQogICAgbWFyZ2luOiAxMHB4Ow0KfQ0KLyogalF1ZXJ5IFVpIGNvbG91ciBvdmVycmlkZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoudWktc3RhdGUtaG92ZXIsDQoudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWhvdmVyLA0KLnVpLXN0YXRlLWZvY3VzLA0KLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1mb2N1cyB7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzA1OTNlOCAhaW1wb3J0YW50Ow0KICAgIGJhY2tncm91bmQ6ICNlZGY4ZmYgIWltcG9ydGFudDsNCiAgICBjb2xvcjogIzAzNTQ4NCAhaW1wb3J0YW50Ow0KfQ0KDQovKiBGUkFNRVdPUksuVUkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQouZnVpLXNlbGVjdG9yIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IDIwMHB4Ow0KICAgIGhlaWdodDogMTAwJTsNCn0NCg0KLmZ1aS1zZWxlY3Rvci1ib2R5IHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgei1pbmRleDogMjAwOw0KICAgIG1heC1oZWlnaHQ6IDIwMHB4Ow0KICAgIHdpZHRoOiAyMGVtOyAvKiBNYXRjaGVzIHdpZHRoIG9mIHRoZSBzZWxlY3RvciBoZWFkZXIgKi8NCiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOw0KICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICBvdmVyZmxvdy15OiBzY3JvbGw7DQp9DQoNCiAgICAuZnVpLXNlbGVjdG9yLWJvZHkgbGkgZGl2IHsNCiAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICAgICAgbGluZS1oZWlnaHQ6IDFlbTsNCiAgICB9DQoNCnVsLmZ1aS1zZWxlY3Rvci1ib2R5IGxpLA0KdWwuZnVpLXNlbGVjdG9yLWJvZHkgbGkgc3BhbiB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCn0NCg0KICAgIHVsLmZ1aS1zZWxlY3Rvci1ib2R5IGxpOmhvdmVyIHsNCiAgICAgICAgYmFja2dyb3VuZDogI2RkZDsNCiAgICB9DQoNCiAgICB1bC5mdWktc2VsZWN0b3ItYm9keSBsaSAuc2VsZWN0b3ItY2hlY2tib3ggew0KICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KICAgICAgICBtYXJnaW4tcmlnaHQ6IDAuNWVtOw0KICAgIH0NCg0KLmZ1aS1zZWxlY3Rvci1ib2R5LmV4cGFuZGVkIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KfQ0KDQouZnVpLXNlbGVjdG9yLWhlYWRlciB7DQogICAgYmFja2dyb3VuZDogI2ZmZmZmZjsNCiAgICB3aWR0aDogMjAwcHg7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIGJvcmRlcjogMDsNCiAgICBwYWRkaW5nLWxlZnQ6IDAuNWVtOw0KfQ0KDQogICAgLmZ1aS1zZWxlY3Rvci1oZWFkZXIgYnV0dG9uIHsNCiAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIHdpZHRoOiAyMGVtOyAvKiBNYXRjaGVzIHdpZHRoIG9mIHRoZSBzZWxlY3RvciBsaXN0ICovDQogICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgYmFja2dyb3VuZDogdXJsKCdSZXNvdXJjZXMvSW1hZ2VzL2ljb25zL2Fycm93LWRvd24tc21hbGwtMjQucG5nJykgcmlnaHQgbm8tcmVwZWF0Ow0KICAgIH0NCg0KICAgIC5mdWktc2VsZWN0b3ItaGVhZGVyLm5vLXNlbGVjdG9yLWl0ZW1zIGJ1dHRvbiB7DQogICAgICAgIGJhY2tncm91bmQ6IG5vbmU7DQogICAgfQ0KDQoNCi8qI3JlZ2lvbiBQb3BvdmVyICovDQoucG9wb3ZlciB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMmVtOw0KICAgIGxlZnQ6IDUwJTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7DQogICAgei1pbmRleDogOTk5OTk7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgICB0cmFuc2l0aW9uOiBib3gtc2hhZG93IC4yNXM7DQogICAgYm94LXNoYWRvdzogMCAycHggNXB4IDAgcmdiYSgwLCAwLCAwLCAwLjE2KSwgMCAycHggMTBweCAwIHJnYmEoMCwgMCwgMCwgMC4xMik7DQp9DQoNCiAgICAucG9wb3ZlcjpiZWZvcmUsDQogICAgLnBvcG92ZXI6YWZ0ZXIgew0KICAgICAgICBib3R0b206IDEwMCU7DQogICAgICAgIGxlZnQ6IDUwJTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOw0KICAgICAgICBib3JkZXI6IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgICBjb250ZW50OiAiICI7DQogICAgICAgIGhlaWdodDogMDsNCiAgICAgICAgd2lkdGg6IDA7DQogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgfQ0KDQogICAgLnBvcG92ZXI6YmVmb3JlIHsNCiAgICAgICAgYm9yZGVyLXdpZHRoOiAxMXB4Ow0KICAgIH0NCg0KICAgIC5wb3BvdmVyOmFmdGVyIHsNCiAgICAgICAgYm9yZGVyLXdpZHRoOiAxMXB4Ow0KICAgIH0NCg0KICAgIC5wb3BvdmVyLnBvcG92ZXItcmlnaHQsDQogICAgLnBvcG92ZXIucG9wb3Zlci1sZWZ0LA0KICAgIC5wb3BvdmVyLnBvcG92ZXItcmlnaHQ6YmVmb3JlLA0KICAgIC5wb3BvdmVyLnBvcG92ZXItcmlnaHQ6YWZ0ZXIsDQogICAgLnBvcG92ZXIucG9wb3Zlci1sZWZ0OmJlZm9yZSwNCiAgICAucG9wb3Zlci5wb3BvdmVyLWxlZnQ6YWZ0ZXIgew0KICAgICAgICB0b3A6IDUwJTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOw0KICAgIH0NCg0KICAgIC5wb3BvdmVyLnBvcG92ZXItbGVmdCB7DQogICAgICAgIGxlZnQ6IGluaXRpYWw7DQogICAgICAgIHJpZ2h0OiAxMDAlOw0KICAgICAgICBtYXJnaW4tcmlnaHQ6IDExcHg7DQogICAgfQ0KDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItbGVmdDpiZWZvcmUsDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItbGVmdDphZnRlciB7DQogICAgICAgICAgICBsZWZ0OiBpbml0aWFsOw0KICAgICAgICAgICAgYm9yZGVyLXJpZ2h0LXdpZHRoOiAwOw0KICAgICAgICB9DQoNCiAgICAgICAgLnBvcG92ZXIucG9wb3Zlci1sZWZ0OmJlZm9yZSB7DQogICAgICAgICAgICByaWdodDogLTExcHg7DQogICAgICAgICAgICBib3JkZXItbGVmdC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjI1KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItbGVmdDphZnRlciB7DQogICAgICAgICAgICByaWdodDogLTEwcHg7DQogICAgICAgICAgICBib3JkZXItbGVmdC1jb2xvcjogI2ZmZjsNCiAgICAgICAgfQ0KDQogICAgLnBvcG92ZXIucG9wb3Zlci1yaWdodCB7DQogICAgICAgIGxlZnQ6IDEwMCU7DQogICAgICAgIG1hcmdpbi1sZWZ0OiAxMXB4Ow0KICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLXJpZ2h0OmJlZm9yZSwNCiAgICAgICAgLnBvcG92ZXIucG9wb3Zlci1yaWdodDphZnRlciB7DQogICAgICAgICAgICBib3JkZXItbGVmdC13aWR0aDogMDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItcmlnaHQ6YmVmb3JlIHsNCiAgICAgICAgICAgIGxlZnQ6IC0xMXB4Ow0KICAgICAgICAgICAgYm9yZGVyLXJpZ2h0LWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuMjUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLnBvcG92ZXIucG9wb3Zlci1yaWdodDphZnRlciB7DQogICAgICAgICAgICBsZWZ0OiAtMTBweDsNCiAgICAgICAgICAgIGJvcmRlci1yaWdodC1jb2xvcjogI2ZmZjsNCiAgICAgICAgfQ0KDQogICAgLnBvcG92ZXIucG9wb3Zlci10b3A6YmVmb3JlLA0KICAgIC5wb3BvdmVyLnBvcG92ZXItdG9wOmFmdGVyLA0KICAgIC5wb3BvdmVyLnBvcG92ZXItYm90dG9tOmJlZm9yZSwNCiAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbTphZnRlciB7DQogICAgICAgIGxlZnQ6IDUwJTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpOw0KICAgIH0NCg0KICAgIC5wb3BvdmVyLnBvcG92ZXItdG9wIHsNCiAgICAgICAgdG9wOiAtMTFweDsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTEwMCUpOw0KICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLXRvcDpiZWZvcmUsDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItdG9wOmFmdGVyIHsNCiAgICAgICAgICAgIGJvcmRlci1ib3R0b20td2lkdGg6IDA7DQogICAgICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLXRvcDpiZWZvcmUgew0KICAgICAgICAgICAgYm90dG9tOiAtMTFweDsNCiAgICAgICAgICAgIGJvcmRlci10b3AtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4yNSk7DQogICAgICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLXRvcDphZnRlciB7DQogICAgICAgICAgICBib3R0b206IC0xMHB4Ow0KICAgICAgICAgICAgYm9yZGVyLXRvcC1jb2xvcjogI2ZmZjsNCiAgICAgICAgfQ0KDQogICAgLnBvcG92ZXIucG9wb3Zlci1ib3R0b20gew0KICAgICAgICB0b3A6IDEwMCU7DQogICAgICAgIG1hcmdpbi10b3A6IDExcHg7DQogICAgfQ0KDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItYm90dG9tLnBvcG92ZXItYm90dG9tLWxlZnQgew0KICAgICAgICAgICAgbGVmdDogYXV0bzsNCiAgICAgICAgICAgIHJpZ2h0OiAwOw0KICAgICAgICAgICAgdHJhbnNmb3JtOiBub25lOw0KICAgICAgICB9DQoNCiAgICAgICAgLnBvcG92ZXIucG9wb3Zlci1ib3R0b20ucG9wb3Zlci1ib3R0b20tcmlnaHQgew0KICAgICAgICAgICAgbGVmdDogMDsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogbm9uZTsNCiAgICAgICAgfQ0KDQogICAgICAgICAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbS5wb3BvdmVyLWJvdHRvbS1sZWZ0OmJlZm9yZSwNCiAgICAgICAgICAgIC5wb3BvdmVyLnBvcG92ZXItYm90dG9tLnBvcG92ZXItYm90dG9tLWxlZnQ6YWZ0ZXIsDQogICAgICAgICAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbS5wb3BvdmVyLWJvdHRvbS1yaWdodDpiZWZvcmUsDQogICAgICAgICAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbS5wb3BvdmVyLWJvdHRvbS1yaWdodDphZnRlciB7DQogICAgICAgICAgICAgICAgbGVmdDogYXV0bzsNCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IG5vbmU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgLnBvcG92ZXIucG9wb3Zlci1ib3R0b20ucG9wb3Zlci1ib3R0b20tbGVmdDpiZWZvcmUsDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItYm90dG9tLnBvcG92ZXItYm90dG9tLWxlZnQ6YWZ0ZXIgew0KICAgICAgICAgICAgcmlnaHQ6IDA7DQogICAgICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbTpiZWZvcmUsDQogICAgICAgIC5wb3BvdmVyLnBvcG92ZXItYm90dG9tOmFmdGVyIHsNCiAgICAgICAgICAgIGJvcmRlci10b3Atd2lkdGg6IDA7DQogICAgICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbTpiZWZvcmUgew0KICAgICAgICAgICAgdG9wOiAtMTFweDsNCiAgICAgICAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4yNSk7DQogICAgICAgIH0NCg0KICAgICAgICAucG9wb3Zlci5wb3BvdmVyLWJvdHRvbTphZnRlciB7DQogICAgICAgICAgICB0b3A6IC0xMHB4Ow0KICAgICAgICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZmZjsNCiAgICAgICAgfQ0KDQoucG9wb3Zlci10aXRsZSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHBhZGRpbmc6IDAuNGVtIDAuOGVtOw0KICAgIG1hcmdpbjogMDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjdmN2Y3Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWJlYmViOw0KICAgIG1heC13aWR0aDogMjBlbTsNCn0NCg0KLnBvcG92ZXItY29udGVudCB7DQogICAgcGFkZGluZzogMC44ZW07DQp9DQoNCi5wb3BvdmVyLWJ1dHRvbiB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQovKiNlbmRyZWdpb24gKi8NCg==")});require({cache:{"geocortex/infrastructure/ContentPolicy":function(){define(["require","exports","./FilterUtils","./validation/SiteUrlValidator","./UrlUtilities"],function(t,e,r,i,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=[],o=!1;!function(t){t[t.DisableSecurityPrompt=1]="DisableSecurityPrompt",t[t.DisablePromptOnImages=2]="DisablePromptOnImages",t[t.TrustExactUrl=4]="TrustExactUrl"}(e.PolicyFlags||(e.PolicyFlags={}));var u=function(){function t(t){this._debounceInterval=250,this._flags=0,this._app=t}return t.prototype.hasFlag=function(t){return(this._flags&t)===t},t.prototype.setFlag=function(t){this._flags|=t},t.prototype.screenUris=function(t){this._siteValidator||(this._siteValidator=new i.SiteUrlValidator(this._app));for(var e=[],r=0,a=t;r<a.length;r++){var n=a[r];n.uri;n.uri=this._screenDataUri(n.uri),null!==n.uri?e.push(n):this._app.trace.debug("Skipped unknown, untrusted data URI.")}return this._validateUris(e)},t.prototype.tryScreenNavLinkSynchronously=function(t){if(!this._siteValidator)return!1;var e=this._siteValidator.tryValidateSynchronously(t.uri);return e||(this._getMemoizedResult(t)||!1)},t.prototype._validateUris=function(t){var e=this,i=[],a=[];return a=t.map(function(t){return new Promise(function(a,n){var o=t.uri;if(e.hasFlag(2)&&t.type===r.UriType.Markup){var u=t;if("img"===u.tag&&"src"===u.attribute)return a(t)}return e._validateUriAgainstSite(t).then(function(e){return null==e.validatedValue||""===e.validatedValue?(t.uri=o,i.push(t),a(null)):(t.type===r.UriType.NavigableLink&&t.forcePrompt&&i.push(t),a(t))},function(e){return t.uri=o,i.push(t),a(t)})})}),Promise.all(a).then(function(){return e._promptForUris(i)}).then(function(){return t})},t.prototype._validateUriAgainstSite=function(t){if(!this._siteValidator){t.uri="";var e={validatedValue:null};return Promise.resolve(e)}return this._siteValidator.validate(t.uri)},t.prototype._promptForUris=function(t){var e=this;return Promise.map(t,function(t,r){return new Promise(function(r,i){e._enqueueConfirmation({uriDetails:t,resolve:r})})})},t.prototype._enqueueConfirmation=function(t){n.push(t),this._processConfirmationQueue()},t.prototype._processConfirmationQueue=function(){if(!o){o=!0;try{for(;n.length;){var t=n.shift();if(this._getConfirmation(t))return}}catch(t){throw o=!1,t}o=!1}},t.prototype._getConfirmation=function(t){var e=this;if(!t.uriDetails.forcePrompt&&this.hasFlag(1))return t.resolve(t.uriDetails),!1;var i=t.uriDetails.type===r.UriType.NavigableLink,a=this._getMemoizedResult(t.uriDetails);if(i||!0!==a){if(i||!1!==a){var n=function(r){o=!1,e._memoizeResult(t.uriDetails,r),!0===r?t.resolve(t.uriDetails):(t.uriDetails.uri="",t.resolve(t.uriDetails));try{if(i){var a=t.uriDetails.linkChallengeCallback;a&&a(r,t.uriDetails)}}finally{e._processConfirmationQueue()}},u={okLabel:this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-accept-btn"),cancelLabel:this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-reject-btn")},s=this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-title"),l=this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-desc");return l=l.format(t.uriDetails.uri),this._app.command("Confirm").canExecute(l,s,n,u)?(this._app.command("Confirm").execute(l,s,n,u),!0):(n(window.confirm(l)),!1)}return t.uriDetails.uri="",t.resolve(t.uriDetails),!1}return t.resolve(t.uriDetails),!1},t.prototype._getMemoizationKey=function(t){var e;e=this.hasFlag(4)?a.parseUrl(t.uri):a.getFolder(t.uri);var i=String.quickHashCode(e.toString());return"uri."+r.UriType[t.type].toLowerCase()+"."+i},t.prototype._memoizeResult=function(t,e){var r=this._getMemoizationKey(t);window.localStorage.setItem(r,e.toString())},t.prototype._getMemoizedResult=function(t){var e=this._getMemoizationKey(t),r=window.localStorage.getItem(e);return null===r?null:"true"===r},t.prototype._screenDataUri=function(t){var e=!!r.DataUri.parseDataUri(t),i=r.DataUri.isDataUriSafe(t);return!e||i?t:""},t}();e.ContentPolicy=u})}}});require({cache:{"geocortex/infrastructure/coordinates/AngleDirectionSystem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POLAR="polar",t.NORTH_AZIMUTH="north_azimuth",t.SOUTH_AZIMUTH="south_azimuth"})},"geocortex/infrastructure/coordinates/AngleFormat":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DD="dd",t.DDM="ddm",t.DMS="dms"})},"geocortex/infrastructure/coordinates/Coordinate":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/coordinates/CoordinateBase":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/coordinates/CoordinatesManager":function(){define(["require","exports","./CoordinatesModel","./CoordinateUtils"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.featureSetExtendedProperty="containsCoordinates",t.coordinateIdentifierProperty="coordinateId";var n=function(){function e(e){this._registeredCoordinateModels=[],this.app=e}return e.prototype.registerModel=function(e,t){return void 0===t&&(t=!1),!!this._validateModelRegistration(e)&&(this._processCoordinatesModel(e),(0===this._registeredCoordinateModels.length||t)&&(this._defaultCoordinatesModel=e),this._registeredCoordinateModels.push(e.id),!0)},e.prototype.getCoordinate=function(e,t,r){var n=this;if(!this.hasRegisteredCoordinatesModel(r)){return Promise.reject(new Error("Coordinates Manager: Could not resolve coordinates. Target coordinates model incorrectly configured or not registered."))}var i=e instanceof esri.geometry.Point?e:new esri.geometry.Point(e.x,e.y,e.spatialReference),a=this._defaultCoordinatesModel;if(!r||a.id===r)return o.getCoordinate(this.app,i,t||a.currentCoordinateSystem.get(),a.fractionalDigits,a.defaultGcsWkid);this.getCoordinatesModel(r).then(function(e){return o.getCoordinate(n.app,i,t||e.currentCoordinateSystem.get(),e.fractionalDigits,e.defaultGcsWkid)},function(e){return Promise.reject(e)})},e.prototype.getCoordinatesModel=function(e){var t=this;return new Promise(function(o,n){t.app.getFrameworkObjectByIdAsync(e,function(t){t instanceof r.CoordinatesModel?o(t):n(new Error("CoordinatesManager: getCoordinatesModel - {0} is not an instance of a Coordinates Model.".format(e)))},function(e){return n(e)})})},e.prototype.hasRegisteredCoordinatesModel=function(e){return!(e||!this._defaultCoordinatesModel||!this._defaultCoordinatesModel.isRegistered)||!!e&&this._registeredCoordinateModels.indexOf(e)>-1},e.prototype._validateModelRegistration=function(e){if(!(e&&e.id&&e.coordinateSystems.length()&&e.currentCoordinateSystem.get()))return!1;if(this._registeredCoordinateModels.filter(function(t){return e.id===t}).length)return!1;for(var t=0;t<e.coordinateSystems.length();t++){var r=e.coordinateSystems.getAt(t);if(!this._validateCoordinateSystem(r))return!1}return!0},e.prototype._validateCoordinateSystem=function(e){return null!=e.displayName&&null!=e.output&&(null!=e.wkid||null!=e.wkt||"mgrs"===e.output.trim().toLowerCase()||"usng"===e.output.trim().toLowerCase())},e.prototype._processCoordinatesModel=function(e){var t=this;this._addModelSubscriptionHooks(e);var r=!1;e.inputStream.bind(this,function(n){if(r||!e.isActive.get()||t._prevCoord&&t._prevCoord.x==n.x&&t._prevCoord.y==n.y&&t._prevCoord.spatialReference&&n.spatialReference&&(t._prevCoord.spatialReference.wkid===n.spatialReference.wkid||t._prevCoord.spatialReference.wkt==n.spatialReference.wkt))t._prevCoord=n;else{t._prevCoord=n;var i=n instanceof esri.geometry.Point?n:new esri.geometry.Point(n.x,n.y,n.spatialReference);r=!0,o.getCoordinate(t.app,i,e.currentCoordinateSystem.get(),e.fractionalDigits,e.defaultGcsWkid).then(function(t){e.outputStream.set(t),r=!1},function(o){t.app.trace.error("CoordinatesManager: An error occurred while attempting to map from input to output coordinate streams for model: {0}".format(e.id)),r=!1})}}),e.isRegistered=!0},e.prototype._addModelSubscriptionHooks=function(e){var t=this,r=e.outputStream.bindingEvent;dojo.aspect.after(r,"subscribe",function(o){return t._handleModelSubscriptionsChanged(e,r.subscriptions),o}),dojo.aspect.after(r,"unsubscribe",function(o){return t._handleModelSubscriptionsChanged(e,r.subscriptions),o}),dojo.aspect.after(r,"clear",function(){return t._handleModelSubscriptionsChanged(e,r.subscriptions)}),this._handleModelSubscriptionsChanged(e,r.subscriptions)},e.prototype._handleModelSubscriptionsChanged=function(e,t){var r=!1;for(var o in t)if(t.hasOwnProperty(o)){r=!0;break}r!==e.isActive.get()&&e.isActive.set(r)},e}();t.CoordinatesManager=n})},"geocortex/infrastructure/coordinates/CoordinatesModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,r,o,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.isActive=new n.Observable(!1),e.coordinateSystems=new n.ObservableCollection([]),e.currentCoordinateSystem=new n.Observable(null),e.fractionalDigits=5,e.defaultGcsWkid=4326,e.inputStream=new n.Observable(null),e.outputStream=new n.Observable(null),e.isRegistered=!1,e}return e(r,t),r.prototype.initialize=function(e){this.configuration=e},r}(o.ViewModelBase);r.CoordinatesModel=i})},"geocortex/infrastructure/coordinates/CoordinatesModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/coordinates/CoordinateSystem":function(){define(["require","exports","./GeoCoordinateString"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CoordinateSystemType={DD:"dd",DDM:"ddm",DMS:"dms",XY:"xy",MGRS:r.GeoCoordinateStringType.MGRS,USNG:r.GeoCoordinateStringType.USNG}})},"geocortex/infrastructure/coordinates/CoordinateUtils":function(){define(["require","exports","./CoordinateSystem","./../GeometryUtils","./AngleFormat","./../FormatUtils","./../NumberFormat"],function(e,t,r,o,n,i,a){"use strict";function s(e,t,r,n,i,a){void 0===n&&(n=5),void 0===i&&(i=!0),void 0===a&&(a=!0);return new Promise(function(s,u){if(!t||!t.spatialReference||void 0==t.x||void 0==t.y)return u(new Error("toGeoCoordinateString: Could not convert to GeoCoordinate string. Required parameters missing."));var d=o.getGeometryService(e);if(!d){var c="toGeoCoordinateString: Could not convert to GeoCoordinate string. Geometry service not available."+(e.isOffline.get()?" Please ensure the viewer is online before attempting this operation.":"");return u(new Error(c))}var f={addSpaces:a,conversionType:r.output.toUpperCase(),coordinates:[[t.x,t.y]],numOfDigits:n,rounding:i,sr:t.spatialReference};d.toGeoCoordinateString(f,function(e){return s(e[0]||"N/A")},function(e){return u(e)})})}function u(e,t){return new Promise(function(r,n){if(!t||!t.coordinateType||!t.coordinateValue)return n(new Error("fromGeoCoordinateString: Could not convert from GeoCoordinate string. Required parameters missing."));var i=o.getGeometryService(e);if(!i){var a="toGeoCoordinateString: Could not convert to GeoCoordinate string. Geometry service not available."+(e.isOffline.get()?" Please ensure the viewer is online before attempting this operation.":"");return n(new Error(a))}var s=new esri.SpatialReference(e.map.spatialReference.wkid||e.map.spatialReference.wkt),u={conversionType:t.coordinateType.toUpperCase(),sr:s,strings:[t.coordinateValue]};i.fromGeoCoordinateString(u,function(e){var t=e[0];if(2!==t.length)return n(new Error("fromCoordinateString: Could not convert from coordinate string to map point. Unexpected server response."));r(new esri.geometry.Point(t[0],t[1],s))},function(e){return n(e)})})}function d(e,t,r,o){switch(null!=o&&void 0!==o||(o=4),t||(t=n.DD),t=t.toLowerCase()){case n.DDM:return m(e,r,o);case n.DMS:return g(e,r,o);default:return p(e,r,o)}}function c(e,t,r,o,n){var i=null,a=null;return i=e>0?f(o,"north-abbrev"):f(o,"south-abbrev"),a=t>0?f(o,"east-abbrev"):f(o,"west-abbrev"),{latitude:"{0} {1}".format(d(Math.abs(e),r,o,n),i),longitude:"{0} {1}".format(d(Math.abs(t),r,o,n),a)}}function f(e,t){return t=t.startsWith("language-coordinates-")?t:"language-coordinates-"+t,e.getResource("Mapping.Infrastructure",t)}function l(e,t,o,n){void 0===n&&(n=5);var s={},u="string"==typeof t;if(s.targetCoordinateSystem=o,u?s.geoCoordinateString={coordinateValue:t,coordinateType:o.output}:(s.x=t.x,s.y=t.y),s.spatialReference=u?new esri.SpatialReference(o.wkid||o.wkt):t.spatialReference,u)s.formattedGeoCoordString=$.extend({},s.geoCoordinateString);else if(o.output==r.CoordinateSystemType.XY)s.formattedLatitudeOrX=i.formatNumber(t.x,a.NumberFormat.DEFAULT,{fractionalDigits:n}),s.formattedLongitudeOrY=i.formatNumber(t.y,a.NumberFormat.DEFAULT,{fractionalDigits:n});else{var d=c(t.y,t.x,o.output,e,n);s.formattedLatitudeOrX=d.latitude,s.formattedLongitudeOrY=d.longitude}return s}function p(e,t,r){return"{0}{1}".format(i.formatNumber(e,a.NumberFormat.NUMBER,{fractionalDigits:r}),f(t,"degrees"))}function g(e,t,r){var o=Math.floor(Math.abs(e)),n=Math.floor(60*(Math.abs(e)-o)),s=60*(Math.abs(e)-o-n/60)*60;return"{0}{1} {2}{3} {4}{5}".format(o*v(e),f(t,"degrees"),n,f(t,"minutes"),i.formatNumber(s,a.NumberFormat.NUMBER,{fractionalDigits:r}),f(t,"seconds"))}function m(e,t,r){var o=Math.floor(Math.abs(e)),n=60*(Math.abs(e)-o);return"{0}{1} {2}{3}".format(o*v(e),f(t,"degrees"),i.formatNumber(n,a.NumberFormat.NUMBER,{fractionalDigits:r}),f(t,"minutes"))}function v(e){return"number"!=typeof e?NaN:e>0?1:e<0?-1:e}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoordinate=function(e,t,n,i,a){void 0===i&&(i=5),void 0===a&&(a=4326);return new Promise(function(d,c){var f=esri.geometry,p=t instanceof esri.geometry.Point?t.spatialReference:null,g=(e.map.spatialReference.wkt?n.wkt!==e.map.spatialReference.wkt:n.wkid!==e.map.spatialReference.wkid)||n.output===r.CoordinateSystemType.XY?new esri.SpatialReference(n.wkid||n.wkt):new esri.SpatialReference(a),m=function(t){var r=l(e,t,n,i);d(r)};if(t instanceof esri.geometry.Point&&n.output!==r.CoordinateSystemType.MGRS&&n.output!==r.CoordinateSystemType.USNG){var v=function(){o.projectGeometry(t,g,function(e){m(e)},function(e){c(new Error("Unable to project geometry for coordinate tracking: {0}".format(e.message)))},e)};if(f.canProject(p,g)){var b=f.project(t,g);m(b)}else e.isOffline.get()?e.command("NativeHasCapability").execute("project",function(e){e?v():c(new Error("Offline Mode. Unable to project geometry for coordinate tracking."))}):v()}else t instanceof esri.geometry.Point?s(e,t,n,i).then(function(e){return m(e)},function(e){return c(e)}):u(e,t).then(function(e){return m(e)},function(e){return c(e)})})},t.toGeoCoordinateString=s,t.fromGeoCoordinateString=u,t.convertDmsToDecimalDegrees=function(e,t,r,o,n){var i=f(e,"west-abbrev").toUpperCase(),a=f(e,"east-abbrev").toUpperCase(),s=f(e,"north-abbrev").toUpperCase(),u=f(e,"south-abbrev").toUpperCase();n=n.toUpperCase();var d=parseFloat(t),c=parseFloat(r),l=parseFloat(o);if(isNaN(d)||isNaN(c)||isNaN(l)||d<0||d>180||c<0||c>60||l<0||l>60||n!=i&&n!=a&&n!=s&&n!=u)return null;var p=d+c/60+l/3600;return n!==u&&n!==i||(p=-p),p},t.formatAngle=d,t.formatLatLon=c,t.formatXYCoordinate=function(e,t,r){return null!=r&&void 0!==r||(r=4),i.formatNumber(e,a.NumberFormat.NUMBER,{fractionalDigits:r})},t.formatBearing=function(e,t,r,o){if(0===e)return f(r,"north-abbrev");if(90===e)return f(r,"east-abbrev");if(180===e)return f(r,"south-abbrev");if(270===e)return f(r,"west-abbrev");var n=f(r,"north-abbrev"),i=f(r,"east-abbrev");return e>=90&&e<180?(n=f(r,"south-abbrev"),e=180-e):e>=180&&e<270?(n=f(r,"south-abbrev"),i=f(r,"west-abbrev"),e-=180):e>=270&&e<360&&(i=f(r,"west-abbrev"),e=360-e),"{0} {1} {2}".format(n,d(e,t,r,o),i)},t.getResource=f})},"geocortex/infrastructure/coordinates/GeoCoordinateString":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCoordinateStringType={MGRS:"mgrs",USNG:"usng"}})}}});require({cache:{"geocortex/infrastructure/DataLinkingResult":function(){define(["require","exports","./AttributeGroup","geocortex/framework/observables"],function(t,e,r,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.dataLink=new u.Observable,this.table=new u.Observable}return t.prototype.toAttributes=function(){var t=this.table.get();if(!t)return null;for(var e={},r=0;r<t.columns.length;r++){var u=t.columns[r],i=t.rows.length>0?t.rows[0].row[r]:null;e[u]=i}return e},t.prototype.asAttributeGroup=function(){return this._attributeGroup||(this._attributeGroup=new r.AttributeGroup,this._attributeGroup.owner=this,this._attributeGroup.attributes=this.toAttributes()),this._attributeGroup},t}();e.DataLinkingResult=i})}}});require({cache:{"geocortex/infrastructure/DateFormat":function(){define(["require","exports"],function(T,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(){return function(){}}();_.DATE_SHORT="d",_.DATE_LONG="D",_.TIME_SHORT="t",_.TIME_LONG="T",_.DATE_TIME_SHORT="g",_.DATE_TIME_LONG="G",_.FULL="f",_.ISO_8601="u",_.ROUND_TRIP="u",_.DEFAULT="g",_.DEFAULT_PARSING_FORMATS=[_.ISO_8601,_.DATE_TIME_SHORT,_.DATE_TIME_LONG,_.DATE_SHORT,_.DATE_LONG],e.DateFormat=_})}}});require({cache:{"geocortex/infrastructure/DatumTransformParameters":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/DatumTransformRegistryItem":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/Dictionary":function(){define(["require","exports"],function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var e=function(){function t(){this._backingStore={}}return t.prototype.containsKey=function(t){return this._backingStore.hasOwnProperty(t)},t.prototype.get=function(t){return this._backingStore[t]},t.prototype.set=function(t,r){this._backingStore[t]=r},t.prototype.remove=function(t){return!!this.containsKey(t)&&(delete this._backingStore[t],!0)},t.prototype.clear=function(){this._backingStore={}},t.prototype.values=function(){var t=[];for(var r in this._backingStore)this._backingStore.hasOwnProperty(r)&&t.push(this._backingStore[r]);return t},t.prototype.keys=function(){var t=[];for(var r in this._backingStore)this._backingStore.hasOwnProperty(r)&&t.push(r+"");return t},t}();r.Dictionary=e,r.toDictionary=function(t,r,n){for(var o=new e,i=0,c=t;i<c.length;i++){var a=c[i];o.set(r(a),n(a))}return o}})}}});require({cache:{"geocortex/infrastructure/DistanceConverter":function(){define(["require","exports","geocortex/essentials/DistanceUnit"],function(e,n,t){"use strict";function i(e){var n=a[e];if(n)return n;throw new Error("Units cannot be converted because are not supported")}function r(e,n){return n/i(e)}function c(e,n){return n*i(e)}Object.defineProperty(n,"__esModule",{value:!0});Math.PI;var a={};a[t.DistanceUnitType.METERS]=1,a[t.DistanceUnitType.MILLIMETERS]=.001,a[t.DistanceUnitType.CENTIMETERS]=.01,a[t.DistanceUnitType.DECIMETERS]=.1,a[t.DistanceUnitType.KILOMETERS]=1e3,a[t.DistanceUnitType.INCHES]=.0254,a[t.DistanceUnitType.FEET]=.3048,a[t.DistanceUnitType.US_SURVEY_FEET]=.3048006096012192,a[t.DistanceUnitType.YARDS]=.9144,a[t.DistanceUnitType.MILES]=1609.344,a[t.DistanceUnitType.NAUTICAL_MILES]=1852,a[t.DistanceUnitType.DEGREES]=111319.49079327357,a[t.DistanceUnitType.GRADS]=100187.54171394621,a[t.DistanceUnitType.RADIANS]=6378136.999999998,n.canConvert=function(e,n){var i=!1,r=!1;if(e===n)return!0;for(var c in t.DistanceUnitType)t.DistanceUnitType.hasOwnProperty(c)&&(t.DistanceUnitType[c]===e?i=!0:t.DistanceUnitType[c]===n&&(r=!0));return r&&i},n.convert=function(e,n,t){return n&&e!==t?r(e,c(t,n)):n}})}}});!function(){var e="<div class='grant-editor'>    <div class='grant-editor-options'>        <div class='grant-editor-search-options'>            <select data-binding='{@enabled: enabled}{@source: monikerKinds}{@value: selectedMonikerKind}'>                <option data-binding='{@template-for: monikerKinds}{@text: displayName}{value: kind}' />            </select>            <input class='grant-editor-search' type='text' data-binding='{@enabled: enabled}{@value: searchText}{@var: autoCompleteInput}{@event-oninput: handleInputChanged}{placeholder: @language-grant-editor-search-placeholder}{title: @language-grant-editor-search-title}{@event-blur: handleAutoCompleteBlur}' />        </div>        <div class='form-btns'>            <button class='button add-button' data-binding='{@enabled: isValidMoniker}{title: @language-grant-editor-add-button-title}{@text: @language-grant-editor-add-button-text}{@event-onclick: handleAddMonikerButtonClick}'></button>        </div>    </div>    <div class='grant-editor-table' data-binding='{@class-show-owner: editOwnership}'>        <table>            <thead>                <tr>                    <th class='grant-name-column'></th>                    <th data-binding='{@text: @language-grant-editor-table-header-none}'></th>                    <th data-binding='{@text: @language-grant-editor-table-header-view}'></th>                    <th data-binding='{@text: @language-grant-editor-table-header-edit}'></th>                    <th class='owner-column' data-binding='{@text: @language-grant-editor-table-header-owner}'></th>                </tr>            </thead>            <tbody data-binding='{@source: monikers}'>                <tr data-binding='{@template-for: monikers}{@class-global-grant: isGlobal}{@class-disabled-grant: isRevoked}'>                    <td class='grant-name-column'>                        <img data-binding='{src: iconUri}' />                        <span class='grant-name-label' data-binding='{@text: name}{title: name}'></span>                    </td>                    <td>                        <input type='radio' data-binding='{@enabled: enabled}{name: id}{checked: isGlobal}{@event-onclick: handleUpdateMoniker}' />                    </td>                    <td>                        <input type='radio' value='reader' data-binding='{@enabled: enabled}{name: id}{checked: canRead}{@event-onclick: handleUpdateMoniker}' />                    </td>                    <td>                        <input type='radio' value='writer' data-binding='{@enabled: enabled}{@hidden: isPublic}{name: id}{checked: canWrite}{@event-onclick: handleUpdateMoniker}' />                    </td>                    <td class='owner-column'>                        <input type='radio' value='owner' data-binding='{@enabled: enabled}{@hidden: isPublic}{name: id}{checked: canEdit}{@event-onclick: handleUpdateMoniker}' />                    </td>                </tr>            </tbody>        </table>    </div></div>";require({cache:{"geocortex/infrastructure/documents/DocumentCollection":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/FrameworkObject","geocortex/framework/observables","geocortex/essentials/documents/DocumentConstants"],function(t,i,n,r,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i,n){var s=t.call(this,e,i)||this;return s._pageSize=10,s._queryParams={},s.isInitialized=!1,s.stopFetching=!1,s.items=new r.ObservableCollection,s.numberOfItems=new r.Observable(0),s.currIndexStart=new r.Observable(0),s.currIndexStartFromOne=new r.Observable(1),s.currIndexEnd=new r.Observable(0),s.currPageNumber=new r.Observable(1),s.firstPageNumber=new r.Observable(1),s.lastPageNumber=new r.Observable(1),s.statusFetching=new r.Observable(!1),s.statusOffline=new r.Observable(!1),s._mapCallback=n,s}return e(i,t),i.prototype.initialize=function(e){var t=this;void 0===e&&(e={}),e.pageSize&&(this._pageSize=e.pageSize),e.queryParams&&(this._queryParams=dojo.mixin(this._queryParams,e.queryParams)),e.fileType&&this.addFilter({field:s.DocumentField.FILE_TYPE,method:s.FilterMethod.VALUES,range:[{string:e.fileType}]}),this.isInitialized=!0,this.currIndexStartFromOne.syncTransform(this.currIndexStart,function(e){return e+1}),this.currPageNumber.bind(this,function(){return t._handlePageChanged()}),this._populateFromDocStore()},i.prototype.getLength=function(){return this.numberOfItems.get()},i.prototype.nextPage=function(){this.currPageNumber.set(this.currPageNumber.get()+1)},i.prototype.prevPage=function(){this.currPageNumber.set(this.currPageNumber.get()-1)},i.prototype.refresh=function(){this._populateFromDocStore()},i.prototype.destroy=function(){t.prototype.destroy.call(this),this.items&&this.items.clear()},i.prototype.setQueryParameters=function(e){this._queryParams=e,this.currPageNumber.set(1)},i.prototype.getQueryParameters=function(){return this._queryParams},i.prototype.addFilter=function(e,t){void 0===t&&(t=s.FilterType.REQUIRE),this._queryParams.filters||(this._queryParams.filters={}),this._queryParams.filters[t]||(this._queryParams.filters[t]=[]),this._queryParams.filters[t]=this._queryParams.filters[t].filter(function(t){return t.field!==e.field}),this._queryParams.filters[t].push(e),this.currPageNumber.set(1)},i.prototype.removeFilter=function(e,t){void 0===t&&(t=s.FilterType.REQUIRE),this._queryParams.filters&&this._queryParams.filters[t]&&(this._queryParams.filters[t]=this._queryParams.filters[t].filter(function(t){return t.field!==e}),0===this._queryParams.filters[t].length&&delete this._queryParams.filters[t],this.currPageNumber.set(1))},i.prototype.sortBy=function(e){e.fields&&0!==e.fields.length&&(e.descending?(delete this._queryParams.sort,this._queryParams.sortDescending=e.fields):(delete this._queryParams.sortDescending,this._queryParams.sort=e.fields),this.currPageNumber.set(1))},i.prototype._handlePageChanged=function(){this.currPageNumber.value=Math.max(1,Number(this.currPageNumber.get())),this.currPageNumber.get()>this.lastPageNumber.get()&&this.lastPageNumber.get()>0?this.currPageNumber.set(this.lastPageNumber.get()):(this.currIndexStart.set((this.currPageNumber.get()-1)*this._pageSize),this.currIndexEnd.set(Math.min(this.numberOfItems.get(),this.currIndexStart.get()+this._pageSize)),this._populateFromDocStore())},i.prototype._populateFromDocStore=function(){var e=this;if(this.app.site.documentStore.supported&&this.isInitialized&&!this.stopFetching){this.statusFetching.set(!0);var t=this._buildQueryParams();this.app.waitUntilSiteInitialized().then(function(){return e.statusOffline.set(!1)}).then(function(){return e.app.site.documentStore.query(t)}).then(function(t){return e._handleQueryResult(t)}).catch(function(t){e.items.clear(),e.numberOfItems.set(0),e.statusOffline.set(!0),e.app.trace.error("Error fetching documents: {0}".format(t),t)}).finally(function(){return e.statusFetching.set(!1)})}},i.prototype._buildQueryParams=function(){var e=dojo.mixin({},this._queryParams);return e.start=this.currIndexStart.get(),e.limit=this._pageSize,e},i.prototype._handleQueryResult=function(e){this.items.set(e.results.map(this._mapCallback));var t=e.total?e.total:0;this.numberOfItems.set(t);var i=Math.ceil(t/this._pageSize);this.lastPageNumber.set(i),this.firstPageNumber.set(1),this.currIndexStart.set((this.currPageNumber.get()-1)*this._pageSize),this.currIndexEnd.set(Math.min(this.numberOfItems.get(),this.currIndexStart.get()+this._pageSize))},i}(n.FrameworkObject);i.DocumentCollection=o})},"geocortex/infrastructure/documents/DocumentCollectionConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/documents/DocumentFieldSorter":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/documents/GrantEditorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.autoCompleteMinLength=0,e.autoCompleteMaxEntries=10,e}return e(i,t),i.prototype.added=function(e){t.prototype.added.call(this,e),this._setupJQueryAutocomplete()},i.prototype.handleInputChanged=function(e,t,i){this.viewModel.validateSearchInput()},i.prototype.handleAddMonikerButtonClick=function(e,t,i){this.viewModel.addMoniker(),this.viewModel.resetOptions()},i.prototype.handleUpdateMoniker=function(e,t,i){return this.viewModel.updateMoniker(i,t.value),!0},i.prototype.handleAutoCompleteBlur=function(e,t,i){$(t).autocomplete("widget").hide()},i.prototype.getSuggestions=function(e,t){var i=this;this.viewModel.searchMonikers(e.term).then(function(e){return i._processMonikers(e)}).then(function(e){return t(e)}).catch(function(e){return t([])})},i.prototype._processMonikers=function(e){var t=[];return e.length>0&&(t=e.slice(0,this.autoCompleteMaxEntries).map(function(e){return{label:e.title,moniker:e}})),Promise.resolve(t)},i.prototype._setupJQueryAutocomplete=function(){var e=this,t=!(!dojo.isIE&&!navigator.userAgent.match(/Trident\/7\./)),i={minLength:this.autoCompleteMinLength,source:function(i,n){t&&!$(e.autoCompleteInput).is(":focus")||e.getSuggestions(i,n)},select:function(t,i){return e._handleAutoCompleteSelect(t,i),!1}};$(this.autoCompleteInput).autocomplete(i)},i.prototype._handleAutoCompleteSelect=function(e,t){this.viewModel.searchText.set(t.item.label),this.viewModel.selectedMoniker.set(t.item.moniker)},i}(n.ViewBase);i.GrantEditorView=r})},"geocortex/infrastructure/documents/GrantEditorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/essentials/documents/DocumentConstants","geocortex/framework/observables","./MonikerModel","geocortex/framework/utils/ArrayUtils","geocortex/essentials/documents/BatchRequestBuilder"],function(t,i,n,r,s,o,a,u){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var d=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n._supportedGrantKinds=[r.GrantKind.READER,r.GrantKind.WRITER],n._globalGrantIds=[r.GrantID.PUBLIC,r.GrantID.USER],n._allowPublicAccess=!1,n._lastSearchResults=[],n.defaultGrantKind=r.GrantKind.READER,n.userIconUri="Resources/Images/Icons/user-inactive-16.png",n.roleIconUri="Resources/Images/Icons/team-16.png",n.document=null,n.grants=[],n.monikers=new s.ObservableCollection,n.isValidMoniker=new s.Observable(!1),n.monikerKinds=new s.ObservableCollection,n.selectedMonikerKind=new s.Observable,n.selectedMoniker=new s.Observable,n.searchText=new s.Observable,n.enabled=new s.Observable(!0),n.editOwnership=new s.Observable(!1),n.searchText.syncTransform(n.selectedMonikerKind,function(){return""}),n.isValidMoniker.syncTransform(n.selectedMoniker,function(e){return!!e}),n.enabled.bind(n,function(){return n._setMonikerEnableds()}),n._setMonikerKinds(),n.app.site&&n.app.site.isInitialized?n.onSiteInitialized():n.app.event("SiteInitializedEvent").once(n,n.onSiteInitialized),n}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&e.editOwnership&&(this._supportedGrantKinds=[r.GrantKind.READER,r.GrantKind.WRITER,r.GrantKind.OWNER],this.editOwnership.set(!0))},i.prototype.onSiteInitialized=function(){var e=this;this.app.site.documentStore.onInitialized().then(function(){e._allowPublicAccess=e.app.site.documentStore.hasPolicyGrant(function(e){return e.globalId===r.GrantID.PUBLIC&&e.kind===r.GrantKind.GLOBAL_READER})})},i.prototype.loadById=function(e){var t=this;return this.app.waitUntilSiteInitialized().then(function(){return t.app.site.documentStore.getById(e)}).then(function(e){return t._updateModel(e)}).catch(function(e){t.app.trace.error("Error loading document: {0}".format(e),e),t.reset()})},i.prototype.addMoniker=function(){var e=this._getSelectedMoniker();if(e)if(this._monikerExists(e))this.app.trace.warning("GrantEditorViewModel: Could not add the grant as it already exists.");else{var t;t=this.app.site.documentStore.userMonikers.some(function(t){return t.id===e.id})&&this._supportedGrantKinds.some(function(e){return e===r.GrantKind.OWNER})?this.addGrant(e.globalId,r.GrantKind.OWNER):this.addGrant(e.globalId,this.defaultGrantKind),this.monikers.addItem(new o.MonikerModel({grant:t,name:e.title,iconUri:this._isUserKind(this.selectedMonikerKind.get())?this.userIconUri:this.roleIconUri})),this._setMonikerEnableds()}else this.app.trace.error("GrantEditorViewModel: Could not find moniker with title {0}.".format(this.searchText.get()))},i.prototype.addGrant=function(e,t){var i={globalId:e,kind:t,assert:!0};return this.grants.push(i),i},i.prototype.updateMoniker=function(e,t){switch(e.grants.forEach(function(e){e.assert=!1,e.revoke=!0}),t){case r.GrantKind.READER:case r.GrantKind.WRITER:case r.GrantKind.OWNER:var i=a.firstOrDefault(e.grants,function(e){return e.kind===t});i||(i=this.addGrant(e.id,t),e.addGrant(i)),i.assert=!0,i.revoke=!1,this._globalGrantIds.some(function(t){return t===e.id})||e.isRevoked.set(!1);break;default:this._globalGrantIds.some(function(t){return t===e.id})||e.isRevoked.set(!0)}},i.prototype.searchMonikers=function(e){var t,i=this;return t=this._isUserKind(this.selectedMonikerKind.get())?u.searchUsers(e):u.searchRoles(e),this.app.waitUntilSiteInitialized().then(function(){return i.app.site.documentStore.perform(t)}).then(function(e){return i._lastSearchResults=e.monikers,e.monikers})},i.prototype.validateSearchInput=function(){var e=this;this.selectedMoniker.get()&&this.searchText.get()&&this.isValidMoniker.set(this._lastSearchResults.some(function(t){return t.title===e.searchText.get()}))},i.prototype.resetOptions=function(){this.searchText.set(null),this.selectedMoniker.set(null)},i.prototype.reset=function(){this._updateModel(null)},i.prototype._getSelectedMoniker=function(){var e=this;return this.selectedMoniker.get().title===this.searchText.get()?this.selectedMoniker.get():this._lastSearchResults.filter(function(t){return t.title===e.searchText.get()})[0]},i.prototype._isUserKind=function(e){return e===r.MonikerKind.USER},i.prototype._updateModel=function(e){this.document=e,this.grants=e&&e.grants?e.grants:[],this.resetOptions(),this._updateMonikers(this.grants)},i.prototype._updateMonikers=function(e){this.monikers.clear();for(var t=[],i=0;i<this._globalGrantIds.length;i++){var n=this._globalGrantIds[i];t.push(new o.MonikerModel({id:n,name:this.app.getResource(this.libraryId,"language-grant-editor-global-grant-name-{0}".format(n)),iconUri:this.roleIconUri,isGlobal:!0,isPublic:n===r.GrantID.PUBLIC}))}for(i=0;i<this._supportedGrantKinds.length;i++)for(var s=0;s<e.length;s++){var u=e[s];if(u.kind===this._supportedGrantKinds[i]){var d=a.firstOrDefault(t,function(e){return e.id===u.globalId});d?d.addGrant(u):t.push(new o.MonikerModel({grant:u,iconUri:this._isUserKind(u.subject.kind)?this.userIconUri:this.roleIconUri}))}}this._allowPublicAccess||(t=t.filter(function(e){return!e.isPublic})),this.monikers.addItems(t),this._setMonikerEnableds()},i.prototype._monikerExists=function(e){if(!e)return!1;var t=this.monikers.getItems();if(t.some(function(t){return t.id===e.globalId}))return!0;if(e.aliases)for(var i=0;i<e.aliases.length;i++){var n=e.aliases[i];if(t.some(function(e){return e.id===n}))return!0}return!1},i.prototype._setMonikerKinds=function(){this.monikerKinds.addItems([{kind:r.MonikerKind.USER,displayName:this.app.getResource(this.libraryId,"language-grant-editor-moniker-type-user")},{kind:r.MonikerKind.ROLE,displayName:this.app.getResource(this.libraryId,"language-grant-editor-moniker-type-role")}]),this.selectedMonikerKind.set(this.monikerKinds.getAt(0).kind)},i.prototype._setMonikerEnableds=function(){for(var e=this.enabled.get(),t=this,i=0,n=this.monikers.get();i<n.length;i++)!function(i){var n=t.app.site.documentStore.userMonikers.some(function(e){return e.id===i.id}),s=i.grants.some(function(e){return e.kind===r.GrantKind.OWNER&&!e.revoke});n&&s?i.enabled.set(!1):i.enabled.set(e)}(n[i])},i}(n.ViewModelBase);i.GrantEditorViewModel=d})},"geocortex/infrastructure/documents/GuestLinkModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.name=new i.Observable,this.linkUrl=new i.Observable,e.kind&&(this.kind=e.kind),e.name&&this.name.set(e.name)}return e.prototype.reset=function(){this.grant=null,this.link=null,this.linkUrl.set(null)},e}();t.GuestLinkModel=n})},"geocortex/infrastructure/documents/GuestLinkModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/documents/MonikerKindDesc":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/documents/MonikerModel":function(){define(["require","exports","geocortex/framework/observables","geocortex/essentials/documents/DocumentConstants"],function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){if(this.grants=[],this.isGlobal=!1,this.isPublic=!1,this.isRevoked=new i.Observable(!1),this.canRead=!1,this.canWrite=!1,this.canEdit=!1,this.enabled=new i.Observable(!0),!e.id&&!e.grant)throw new Error('MonikerModel: parameter "id" or "grant" is required.');e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.iconUri&&(this.iconUri=e.iconUri),e.isGlobal&&(this.isGlobal=e.isGlobal),e.isPublic&&(this.isPublic=e.isPublic),e.grant&&(this.id=e.grant.globalId,e.grant.subject&&(this.name=e.grant.subject.title),this.addGrant(e.grant))}return e.prototype.addGrant=function(e){switch(this.grants.push(e),e.kind){case n.GrantKind.READER:this.canRead=!0;break;case n.GrantKind.WRITER:this.canWrite=!0;break;case n.GrantKind.OWNER:this.canEdit=!0}},e}();t.MonikerModel=r})},"geocortex/infrastructure/documents/MonikerModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"url:/Mapping/infrastructure/documents/GrantEditorView.html":e}}),require(["geocortex/framework/resourceManager"],function(t){t.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/documents/CSS/common.css","css","LmdyYW50LWVkaXRvci1vcHRpb25zIHsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLmdyYW50LWVkaXRvci1zZWFyY2gtb3B0aW9ucyB7DQogICAgcGFkZGluZzogMCAwLjFlbSAwLjVlbSAwOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGRpc3BsYXk6aW5saW5lLWJsb2NrOw0KfQ0KDQouZ3JhbnQtZWRpdG9yLXNlYXJjaC1vcHRpb25zIHNlbGVjdCB7DQogICAgd2lkdGg6IDI5LjUlOw0KICAgIG1hcmdpbi10b3A6IDAuM2VtOw0KICAgIHBhZGRpbmc6IDAuM2VtIDAgMC4zZW0gMDsNCiAgICBtaW4td2lkdGg6IDA7DQogICAgaGVpZ2h0OiAyLjNlbTsNCiAgICBmbG9hdDogbGVmdDsNCn0NCg0KLmdyYW50LWVkaXRvci1vcHRpb25zLWJ0bnMgew0KICAgIHdpZHRoOiAxMCU7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQouZ3JhbnQtZWRpdG9yIC5jbGVhci0yNCB7DQogICAgYmFja2dyb3VuZC1zaXplOiBjb250YWluOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOw0KICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQp9DQoNCi5ncmFudC1lZGl0b3Itc2VhcmNoLW9wdGlvbnMgLmdyYW50LWVkaXRvci1zZWFyY2ggew0KICAgIHdpZHRoOiA2OS41JTsNCiAgICBtYXJnaW4tdG9wOiAwLjNlbTsNCiAgICBtaW4td2lkdGg6IDEwMHB4Ow0KICAgIGhlaWdodDogMi4zZW07DQogICAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQouZ3JhbnQtZWRpdG9yLXNlYXJjaC1vcHRpb25zIC5hZGQtYnV0dG9uIHsNCiAgICBwYWRkaW5nOiAwLjNlbSAwLjVlbSAwLjNlbSAwLjVlbTsNCiAgICBsaW5lLWhlaWdodDogMS41ZW07DQp9DQoNCg0KLyotLS1TVEFSVDogR3JhbnQgRWRpdG9yIFRhYmxlLS0tKi8NCi5ncmFudC1lZGl0b3ItdGFibGUgew0KICAgIG1hcmdpbi10b3A6IDEuNWVtOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQouZ3JhbnQtZWRpdG9yLXRhYmxlIHRoIHsNCiAgICBwYWRkaW5nOiAwIDAgMC41ZW0gMDsNCn0NCg0KLmdyYW50LWVkaXRvci10YWJsZSB0cjpudGgtY2hpbGQoMikgew0KICAgIGJvcmRlci1ib3R0b206IHNvbGlkIDNweCAjRkZGRkZGOw0KfQ0KDQouZ3JhbnQtZWRpdG9yLXRhYmxlIHRkIHsNCiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsNCiAgICBwYWRkaW5nOiAwJTsNCiAgICB3aWR0aDoxMDAlDQp9DQoNCi5ncmFudC1lZGl0b3ItdGFibGUgLmdyYW50LW5hbWUtY29sdW1uIHsNCiAgICB3aWR0aDogNTUlOw0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgcGFkZGluZzogMGVtIDAuNGVtOw0KfQ0KDQouZ3JhbnQtZWRpdG9yLXRhYmxlIC5ncmFudC1uYW1lLWxhYmVsIHsNCiAgICBtYXJnaW4tbGVmdDogMS45ZW07DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIG92ZXJmbG93LXg6IGhpZGRlbjsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHdpZHRoOiBjYWxjKDEwMCUgLSAxLjllbSk7DQp9DQoNCi5ncmFudC1lZGl0b3ItdGFibGUgLmdsb2JhbC1ncmFudCB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRjsNCn0NCg0KLmdyYW50LWVkaXRvci10YWJsZSAuZGlzYWJsZWQtZ3JhbnQgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNFRUVFRUU7DQogICAgdGV4dC1kZWNvcmF0aW9uOiBsaW5lLXRocm91Z2g7DQp9DQoNCi5ncmFudC1lZGl0b3ItdGFibGUgaW1nIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgaGVpZ2h0OiAxOHB4Ow0KICAgIG1hcmdpbi1sZWZ0OiAwLjJlbTsNCn0NCg0KLmdyYW50LWVkaXRvci10YWJsZSB0YWJsZSB7DQogICAgdGFibGUtbGF5b3V0OiBmaXhlZDsNCiAgICB3aWR0aDogMTAwJTsNCn0NCg0KLmdyYW50LWVkaXRvci10YWJsZSB0ZCB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHBhZGRpbmc6IDAuNGVtIDAuMmVtOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICB3aWR0aDogNSU7DQp9DQoNCi5ncmFudC1lZGl0b3ItdGFibGUgdGgub3duZXItY29sdW1uLA0KLmdyYW50LWVkaXRvci10YWJsZSB0ZC5vd25lci1jb2x1bW4gew0KICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsNCn0NCg0KLmdyYW50LWVkaXRvci10YWJsZS5zaG93LW93bmVyIHRoLm93bmVyLWNvbHVtbiwNCi5ncmFudC1lZGl0b3ItdGFibGUuc2hvdy1vd25lciB0ZC5vd25lci1jb2x1bW4gew0KICAgIGRpc3BsYXk6IHRhYmxlLWNlbGwgIWltcG9ydGFudDsNCn0NCg0KLyotLS1FTkQ6IEdyYW50IEVkaXRvciBUYWJsZS0tLSovDQoNCi8qLS0tU1RBUlQ6IFByb2plY3QgU3RhdHVzLS0tKi8NCg0KLnByb2plY3Qtc3RhdHVzLWNvbXBsZXRlIHsNCiAgICBtYXJnaW46IDFlbTsNCn0NCg0KLnByb2plY3Qtc3RhdHVzLWNvbXBsZXRlIC5mb3JtLWl0ZW0gew0KICAgIHBhZGRpbmctdG9wOiAwOw0KfQ=="),t.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/documents/GrantEditorView.html","html",e)})}();require({cache:{"geocortex/infrastructure/eventArgs/ActiveToolChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/AuthenticationEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.result=null,this.username=null,this.token=null}}();t.AuthenticationEventArgs=r})},"geocortex/infrastructure/eventArgs/EditVertexMovedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/FeatureSetManagerEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e){dojo.safeMixin(this,e)}}();t.FeatureSetManagerEventArgs=r})},"geocortex/infrastructure/eventArgs/FilterControlEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/FilterControlQueryChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GeolocationEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.mapPoint=null,this.projectedMapPoint=null,this.location=null,this.typeOfGeolocation=null,this.accuracyThreshold=null,this.timedOut=!1}}();t.GeolocationEventArgs=r})},"geocortex/infrastructure/eventArgs/GeometryChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GeometryEditCompletedEventArg":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicAttributesChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicDrawActivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicDrawDeactivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicEditActivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicEditDeactivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicEditingDoneEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicRemovedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicVertexAddedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/GraphicVertexMovedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/LayerDefinitionExpressionAppliedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/MapExtentEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.centerLatLon=null,this.currentScale=null,this.currentResolution=null}}();t.MapExtentEventArgs=r})},"geocortex/infrastructure/eventArgs/MapServiceLayersChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/MarkerDragEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/MarkerPointerEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/OfflineMapEditorFinishedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/OfflineMapEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/PlotCoordinatesEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/PlotCoordinatesIdUpdatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ProjectEditorFinishedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/QueryCompletedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ReportResultEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ResultsPageChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.ResultsPageChangedEventArgs=r})},"geocortex/infrastructure/eventArgs/SearchProgressEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.status=null,this.searchType=null,this.endpointUrl=null,this.error=null,this.message=null,this.results=null,this.query=null}}();t.SearchProgressEventArgs=r})},"geocortex/infrastructure/eventArgs/SelectionChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/SelectionEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/SnappingFeedbackEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.SnappingFeedbackEventArgs=r})},"geocortex/infrastructure/eventArgs/StateChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/SyncInfoRefreshedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/TimeSliderProfileChangingEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ToggleButtonStateChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ToolbarButtonClickedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ToolbarTabChangedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/ToolInputMethodChangedEvent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/TransientActivatedEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/UndoRedoEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/eventArgs/UserEventArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.isCancelled=!1}}();t.UserEventArgs=r})}}});require({cache:{"geocortex/infrastructure/events":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/ExportTilesUtils":function(){define(["require","exports"],function(e,t){"use strict";function n(e,t,r){var s=e+"/"+t;return u.hasOwnProperty(e)&&(s+="/submitjob"),esri.request({callbackParamName:"callback",content:dojo.mixin({f:"json"},r),handleAs:"json",url:s}).then(function(s){return!s.jobStatus&&s.executionType&&s.parameters?(u[e]=!0,n(e,t,r)):s})}function r(e,t,n,s,o){switch(void 0===s&&(s=null),void 0===o&&(o=1e3),n.jobStatus){case esri.tasks.JobInfo.STATUS_CANCELLED:case esri.tasks.JobInfo.STATUS_DELETED:case esri.tasks.JobInfo.STATUS_FAILED:case esri.tasks.JobInfo.STATUS_TIMED_OUT:return Promise.reject(i(n));case esri.tasks.JobInfo.STATUS_SUCCEEDED:return Promise.resolve(n);default:return Promise.delay(o).then(function(){return esri.request({callbackParamName:"callback",content:s?{f:"json",token:s}:{f:"json"},handleAs:"json",url:e+"/"+t+"/jobs/"+n.jobId})}).then(function(n){return r(e,t,n,s,Math.min(2*o,6e4))})}}function s(e,t,n,r,s){return void 0===s&&(s=null),esri.request({callbackParamName:"callback",content:s?{f:"json",token:s}:{f:"json"},handleAs:"json",url:e+"/"+t+"/jobs/"+n+"/"+r})}function o(e){return esri.request({callbackParamName:"callback",content:{f:"json"},handleAs:"json",url:e})}function i(e){if(!e||!e.messages)return"";var t=e.messages.filter(function(e){return e.type===esri.tasks.GPMessage.TYPE_ERROR}),n=t.filter(function(e){return/^ERROR \d+:/.test(e.description)});return n.length>0&&(t=n),t.reduce(function(e,t){return t.description.length>e.length?t.description:e},"")}Object.defineProperty(t,"__esModule",{value:!0});var u={};t.exportTiles=function(e,t){for(var i="string"==typeof e?e:e.url;"/"===i[i.length-1];)i=i.substring(0,i.length-1);return n(i,"exportTiles",t).then(function(e){return r(i,"exportTiles",e,t.token)}).then(function(e){return s(i,"exportTiles",e.jobId,e.results.out_service_url.paramUrl,t.token)}).then(function(e){return o(e.value)}).then(function(e){return e.files})},t.estimateExportTilesSize=function(e,t){for(var o="string"==typeof e?e:e.url;"/"===o[o.length-1];)o=o.substring(0,o.length-1);return n(o,"estimateExportTilesSize",t).then(function(e){return r(o,"estimateExportTilesSize",e,t.token)}).then(function(e){return s(o,"estimateExportTilesSize",e.jobId,e.results.out_service_url.paramUrl,t.token)}).then(function(e){return"string"==typeof e.value?{totalSize:+e.value,totalTilesToExport:null}:e.value})}})}}});require({cache:{"geocortex/infrastructure/Feature":function(){define(["require","exports","geocortex/essentials/Layer","geocortex/framework-ui/LazyObservable","geocortex/framework/observables","./FeatureAttribute","./AttachmentInfo","./AttributeGroup","./NumberFormat","./DateFormat","geocortex/framework/utils/utils","./GeometryUtils","./FilterUtils","geocortex/essentials/Field","./PresentableDelegateFactory","./gis/FieldInfo","./MapUtils","geocortex/essentials/utilities/StringUtilities","geocortex/essentials/RestHelperHTTPService"],function(e,t,r,a,i,s,n,l,o,u,h,c,y,d,f,g,p,m,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e){var t=this;this._isAttachmentInfosLoaded=!1,this._defaultFieldFormatString="{0}: {1}",this.token=null,this.featureLayer=null,this.featureSet=null,this.featureSetUniqueIds=[],this.labelFormat=new a.LazyObservable,this.minScale=new a.LazyObservable,this.maxScale=new a.LazyObservable,this.zoomScale=new a.LazyObservable,this.zoomFactor=new a.LazyObservable,this.zoomExtent=new i.Observable,this.borderColor=new a.LazyObservable,this.borderWidth=new a.LazyObservable,this.fillColor=new a.LazyObservable,this.id=new a.LazyObservable,this.attributes=new i.ObservableCollection,this.label=new a.LazyObservable,this.plainLabel=new a.LazyObservable,this.description=new a.LazyObservable,this.descriptionFormat=new a.LazyObservable,this.longDescription=new a.LazyObservable,this.longDescriptionFormat=new a.LazyObservable,this.hyperlinks=new i.ObservableCollection,this.extendedProperties=new i.ObservableCollection,this.attachmentInfos=null,this.attachmentInfosInitialized=new i.Observable(!1),this.hasAttachments=new i.Observable(!1),this.hasRelationships=new i.Observable(!1),this.hasVisibleRelationships=new i.Observable(!1),this.hasGeometry=new a.LazyObservable,this.hasValidGeometry=new a.LazyObservable,this.iconUri=new a.LazyObservable,this.linkedAttributes=new i.ObservableCollection,this.dataLinkingResults=new i.ObservableCollection,this.defaultNumberFormat=o.NumberFormat.DEFAULT,this.defaultDateFormat=u.DateFormat.DEFAULT,this.isModified=!1,this.timeZoneId=null,this.displayTimeZoneId=null,this._allowUnsafeContent=!1,this._resolveLayerFields=!1,this._attributeValueBindingTokens={};var r=null;if(e&&e.hasOwnProperty("graphic")&&(this._graphic=e.graphic),e&&e.hasOwnProperty("featureLayer")&&(this.featureLayer=e.featureLayer),e&&e.hasOwnProperty("layer")&&(r=e.layer)&&!this.featureLayer&&r.getFeatureLayer().then(function(e){t.featureLayer=e,e&&t._refreshPresentableValues()},function(e){console.debug(e.message)}),e&&e.hasOwnProperty("resolveLayerFields")?this._resolveLayerFields=e.resolveLayerFields:r&&r.fields&&(this._resolveLayerFields=!0),e&&e.hasOwnProperty("allowUnsafeContent")?this._allowUnsafeContent=e.allowUnsafeContent:this._allowUnsafeContent=!1,e&&e.hasOwnProperty("timeZoneId")&&(this.timeZoneId=e.timeZoneId),e&&e.hasOwnProperty("displayTimeZoneId")&&(this.displayTimeZoneId=e.displayTimeZoneId),this.token=h.alphaNumericToken(),this.esriFeature=new i.Observable(this._graphic),this.esriFeature.bind(this,function(){t._graphic=t.esriFeature.get(),t.loadAttributes(t._resolveLayerFields),t._setupLinkedAttributes(),t.attachmentInfos.clear(),t._isAttachmentInfosLoaded=!1,t.attachmentInfosInitialized.set(!1),t._refreshPresentableValues()}),this.connectDelegates(),r){if(this.layer=r,this.hasAttachments.set(this.layer.hasAttachments),this.layer.relationships&&this.layer.relationships.length>0){this.hasRelationships.set(!0);for(var s=0;s<this.layer.relationships.length;s++)if(this.layer.relationships[s].visible){this.hasVisibleRelationships.set(!0);break}}null!=r.featureHyperlinks&&this.hyperlinks.addItems(r.featureHyperlinks)}this.loadAttributes(this._resolveLayerFields),this.isModified=!1,this._prepAttachmentInfos(),this._graphic&&this._setupLinkedAttributes()}return e.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var r=this.extendedProperties.getAt(t);if(r&&r.name==e)return r.value}return null},e.prototype.setExtendedProperty=function(e,t){for(var r=0;r<this.extendedProperties.getLength();r++){var a=this.extendedProperties.getAt(r);if(a&&a.name==e)return void(a.value=t)}this.extendedProperties.addItem({name:e,value:t})},e.prototype.connectDelegates=function(){var e=this;this.hasGeometry.delegateGetter=function(){return!(!e._graphic||!e._graphic.geometry)},this.hasValidGeometry.delegateGetter=function(){return!(!e._graphic||!e._graphic.geometry)&&c.isValidGeometry(e._graphic.geometry)},this.id.cacheDelegateResults=!0,this.id.delegateGetter=function(){var t="";if(e._graphic&&e.layer){var r=null;e.layer&&(r=e.layer.getObjectIdFieldName()),r&&e._graphic.attributes&&e._graphic.attributes.hasOwnProperty(r)&&(t=e._graphic.attributes[r])}return t},this.label.delegateGetter=function(){var t=null,r=e.labelFormat.get();null!=(t=e.formatTemplateString(r))&&void 0!=t&&t.toString().trim()||void 0!=(t=e._getDefaultFieldValue())&&null!=t&&e.layer&&(t=e.layer.displayName&&e.layer.displayName.toString().trim()?e.layer.displayName+(t.toString().trim()?", "+t:""):t.toString().trim()?t:"");var a={allowFrames:!1,uriTransformer:function(e,t){return t.type!==y.UriType.NavigableLink?e:/^mailto\:/.test(e)?e:"command:OpenWebPage?"+e}};return y.sanitize(t,a)},this.plainLabel.delegateGetter=function(){return y.stripHtml(e.label.get())},this.labelFormat.delegateGetter=function(){return e.layer&&e.layer.featureLabel?e.layer.featureLabel:e.layer&&e.layer.displayField?"{"+e._sanitizeFieldName(e.layer.displayField.name)+"}":e.featureSet&&e.featureSet.esriFeatureSet&&e.featureSet.esriFeatureSet.displayFieldName&&e.featureSet.layer&&e.featureSet.layer.displayName?e.featureSet.layer.displayName+", {"+e.featureSet.esriFeatureSet.displayFieldName+"}":e.featureSet&&e.featureSet.esriFeatureSet&&e.featureSet.esriFeatureSet.displayFieldName?"{"+e._sanitizeFieldName(e.featureSet.esriFeatureSet.displayFieldName)+"}":""},this.borderColor.delegateGetter=function(){return e.layer&&e.layer.featureBorderColor?e.layer.featureBorderColor:null},this.borderWidth.delegateGetter=function(){return e.layer&&"number"==typeof e.layer.featureBorderWidth&&e.layer.featureBorderWidth>=0?e.layer.featureBorderWidth:null},this.fillColor.delegateGetter=function(){return e.layer&&e.layer.featureFillColor?e.layer.featureFillColor:null},this.description.delegateGetter=function(){var t=e.descriptionFormat.get();return e.formatTemplateString(t)},this.descriptionFormat.delegateGetter=function(){return e.layer&&e.layer.featureDescription?e.layer.featureDescription:null},this.longDescription.delegateGetter=function(){var t=e.longDescriptionFormat.get();return e.formatTemplateString(t)},this.longDescriptionFormat.delegateGetter=function(){return e.layer&&e.layer.featureLongDescription?e.layer.featureLongDescription:e.descriptionFormat.get()},this.minScale.delegateGetter=function(){return e.layer&&!isNaN(e.layer.minScale)?e.layer.minScale:1/0},this.maxScale.delegateGetter=function(){return e.layer&&!isNaN(e.layer.maxScale)?e.layer.maxScale:0},this.iconUri.delegateGetter=function(){return e.layer&&e.layer.iconUri?e.layer.iconUri:e.featureSet&&e.featureSet.iconUri&&e.featureSet.iconUri.get()?e.featureSet.iconUri.get():null},this.zoomScale.delegateGetter=function(){return e.layer&&e.layer.featureZoomScale?e.layer.featureZoomScale:null},this.zoomFactor.delegateGetter=function(){return e.layer&&e.layer.featureZoomFactor?e.layer.featureZoomFactor:null}},e.prototype.withinScaleRange=function(e){return!!(0==this.maxScale.get()&&this.minScale.get()==1/0||isNaN(this.maxScale.get())&&isNaN(this.minScale.get()))||!!e&&(this.maxScale.get()<=e&&e<=this.minScale.get())},e.prototype.calculateScaleToMakeVisible=function(e){return this.withinScaleRange(e)?e:e<this.maxScale.get()?this.maxScale.get():this.minScale.get()},e.prototype._sanitizeFieldName=function(e){return e?e.replace(/\W/g,""):""},e.prototype._getDefaultFieldValue=function(){var e="",t=this.esriFeature.get();if(t&&this.layer&&this.layer.displayField&&null!==(e=t.attributes[this.layer.displayField.name])&&void 0!==e&&(e=e.toString().trim()),null!=e&&void 0!=e&&e||!t||!t.attributes||null!==(e=t.attributes.OBJECTID)&&void 0!==e&&(e=e.toString().trim()),(null==e||void 0==e||!e)&&t&&t.attributes)for(var r in t.attributes)if(null!==(e=t.attributes[r])&&void 0!==e&&(e=e.toString().trim()),e)break;return String.escapeHtmlEncode(e)},e.prototype.resetAttachmentInfos=function(){this.attachmentInfos.clear(),this._isAttachmentInfosLoaded=!1,this.attachmentInfosInitialized.set(!1)},e.prototype._prepAttachmentInfos=function(){var e=this,t=new i.ObservableCollection,r=t.get;t.get=function(){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),r.call(t)};var a=t.getItems;t.getItems=function(){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),a.call(t)};var s=t.getAt;t.getAt=function(r){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),s.call(t,r)},this.attachmentInfos=t},e.prototype.loadAttributes=function(e){var t=this,r={};if(this.attributes.get().forEach(function(e){r[e.name.get()]=e.value.get();var a=t._attributeValueBindingTokens[e.name.get()];a&&e.value.unbind(a)}),this.attributes.clear(),this._attributeValueBindingTokens={},this._graphic&&this._graphic.attributes){var a=this.getAttributesFromEsriFeature(this._graphic.attributes,e);a.forEach(function(e){var a=e.name.get(),i=e.value.get();t._attributeValueBindingTokens[a]=e.value.bind(t,function(){t.isModified=!0}),t.isModified=t.isModified||r.hasOwnProperty(a)&&i!==r[a]||!r.hasOwnProperty(a)});var i=this._graphic.attributes||{};this.isModified=this.isModified||Object.keys(r).some(function(e){return!i.hasOwnProperty(e)}),this.attributes.addItems(a)}},e.prototype.getAttributesFromEsriFeature=function(e,t){var r=this,a=[];if(!1!==t&&this.layer&&this.layer.fields){var i=null;this.layer.mapService&&(i=this.layer.mapService.serviceLayer);for(var n=[],l=0;l<this.layer.fields.length;l++){var o,u=this.layer.fields[l];e&&(u.name||u.alias)&&(o=e.hasOwnProperty(u.name)?e[u.name]:e[u.alias]),s.FeatureAttribute.ignoreAttribute(u.name)?n.push(u):void 0===o||null==o?a.push(new s.FeatureAttribute("",u.name,u.alias,u.displayName,u.visible,f.PresentableDelegateFactory.valuePresenterDelegate(u,this),u.dataType)):a.push(new s.FeatureAttribute(o,u.name,u.alias,u.displayName,u.visible,f.PresentableDelegateFactory.valuePresenterDelegate(u,this),u.dataType))}for(v=0;v<n.length;v++){var h=n[v];if(h.visible){var c=a.filter(function(e){return e.name.get()===h.name.substr(0,h.name.length-".Name()".length)}),y=1===c.length?c[0]:null;y&&(y.visible.get()||y.visible.set(!0),y.alias.set(h.alias),y.displayName.set(h.displayName))}}if(i instanceof esri.layers.WMSLayer)for(var p in e){for(var m=!1,b=e[p],v=0;v<this.layer.fields.length;v++)if(p===this.layer.fields[v].name){m=!0;break}m||a.push(new s.FeatureAttribute(b,p))}}else if(this.featureLayer)this.featureLayer.fields.forEach(function(t){var i=t.alias?t.alias:t.name;if(t.type===d.EsriFieldTypes.esriFieldTypeDate){var n=g.FieldInfo.fromEsriField(t,r.featureLayer);n.timeZoneId||(n.timeZoneId=r.timeZoneId),n.displayTimeZoneId||(n.displayTimeZoneId=r.displayTimeZoneId),!r.layer&&r.defaultDateFormat&&(n.format="{0:"+r.defaultDateFormat+"}"),a.push(new s.FeatureAttribute(e[t.name],t.name,i,i,!0,f.PresentableDelegateFactory.valuePresenterDelegate(n,null)))}else a.push(new s.FeatureAttribute(e[t.name],t.name,i,i,!0,f.PresentableDelegateFactory.valuePresenterDelegate(t.name,r)))});else if(this.featureSet&&this.featureSet.attributes&&this.featureSet.attributes.length()>0&&e)for(v=0;v<this.featureSet.attributes.length();v++){var F=this.featureSet.attributes.getAt(v),S=F.name.get();s.FeatureAttribute.ignoreAttribute(S)||e.hasOwnProperty(S)&&a.push(new s.FeatureAttribute(e[S],S,F.alias.get(),F.displayName.get(),F.visible.get(),f.PresentableDelegateFactory.valuePresenterDelegate(S,this)))}else if(e)for(var L in e)a.push(new s.FeatureAttribute(e[L],L,L,L,!0,f.PresentableDelegateFactory.valuePresenterDelegate(L,this)));return a},e.prototype.getAttributes=function(e){for(var t=this.linkedAttributes.get(),r=[],a=0;a<t.length;a++){var i=t[a];if(0===a)for(var n=this.attributes.get(),l=0;l<n.length;l++)r.push(n[l]);else{var o=i.attributes;for(var u in o)o.hasOwnProperty(u)&&r.push(new s.FeatureAttribute(o[u],u,u,u,!0,f.PresentableDelegateFactory.valuePresenterDelegate(null,null)))}}return r},e.prototype.getPrimaryKeyValue=function(){var e=null;if(this.layer&&this.layer.primaryKeyField){var t=this.layer.primaryKeyField;t&&(e=this._graphic.attributes[t.name])}return e},e.prototype.getFeatureUrl=function(){var e=null,t=this.layer.getLayerUrl?this.layer.getLayerUrl():this.layer.url,a=null;if(this.layer instanceof r.Layer)a=this.getPrimaryKeyValue();else if(this.layer instanceof esri.layers.Layer){var i=this.layer;a=this.esriFeature.get().attributes[i.objectIdField]}return t&&a&&(e=t+"/"+a),e},e.prototype.getType=function(){if(!this.featureLayer)return null;var e=f.PresentableDelegateFactory.typeIdForLayerAndAttributes(this.featureLayer,this._graphic.attributes);return null!==e?f.PresentableDelegateFactory.typeFromLayerAndId(this.featureLayer,e):void 0},e.prototype.structurallyEquals=function(t){return!!(t&&t instanceof e)&&(this===t||(!(!this._graphic||!t._graphic||this._graphic!==t._graphic)||null!=this._graphic&&(null!=t._graphic&&(this._getLayerUniqueId()==t._getLayerUniqueId()&&this.id.get()===t.id.get()&&(!String.isNullOrEmpty(this.id.get())||p.esriFeaturesEqual(this._graphic,t._graphic))))))},e.prototype.equals=function(t){if(!(t&&t instanceof e&&this._graphic&&t._graphic))return!1;if(this===t)return!0;var r=this._graphic.geometry,a=t._graphic.geometry,i=this.id.get()===t.id.get()||this.id.get()&&t.id.get()&&this.id.get()==t.id.get(),s=this.layer===t.layer||this.layer&&t.layer&&this.layer.id==t.layer.id,n=this.layer===t.layer||this.layer&&t.layer&&this.layer.mapService===t.layer.mapService||this.layer&&t.layer&&this.layer.mapService&&t.layer.mapService&&this.layer.mapService.id==t.layer.mapService.id,l=r===a||r&&a&&r.declaredClass==a.declaredClass;if(!(i&&s&&n&&l))return!1;if(!p.esriFeaturesEqual(this._graphic,t._graphic))return!1;if(r===a)return!0;switch(r.declaredClass){case"esri.geometry.Point":case"esri.geometry.ScreenPoint":return p.esriPointsEqual(r,a);case"esri.geometry.MultiPoint":return p.esriMultipointsEqual(r,a);case"esri.geometry.Polyline":return p.esriPolylinesEqual(r,a);case"esri.geometry.Polygon":return p.esriPolygonsEqual(r,a);case"esri.geometry.Extent":return p.esriExtentsEqual(r,a);default:throw new Error("Warning: equals() in Feature.ts - declared class does not match known geometry.")}},e.prototype._loadAttachmentsInfos=function(){var e=this;if(this._isAttachmentInfosLoaded=!0,!this.layer)throw new Error("Error fetching attachment infos: Feature was not associated with any known layer.");var t={url:this.getFeatureUrl()+"/attachments/?f=json&ts={0}".format((new Date).getTime()),handleAs:"json"},r=this.layer.mapService&&this.layer.mapService.serviceToken?this.layer.mapService.serviceToken:null,a=this.layer;!this.layer.mapService&&a.credential&&a.credential.token&&(r=a.credential.token),r&&(t.url=b.RestHelperHTTPService.appendTokenToUrl(t.url,r));var i=null;try{var s=this.layer.mapService.serviceLayer;i=s.queryAttachmentInfos(parseInt(this.id.get()))}catch(e){i=esri.request(t)}i.then(function(t){if(t.length>0&&!t.attachmentInfos&&t instanceof Array){t.attachmentInfos=[];for(var a=0;a<t.length;a++)t.attachmentInfos[a]=t[a]}if(t&&t.attachmentInfos&&t.attachmentInfos.length>0){var i;for(i=0;i<t.attachmentInfos.length;i++){var s=t.attachmentInfos[i],l=new n.AttachmentInfo;l.id.set(s.id),l.contentType.set(s.contentType),l.size.set(s.size),l.name.set(s.name);var o="{0}/attachments/{1}".format(e.getFeatureUrl(),s.id);r&&(o=b.RestHelperHTTPService.appendTokenToUrl(o,r)),l.url.set(o),e.attachmentInfos.addItem(l)}}e.attachmentInfosInitialized.set(!0)},function(t){e.attachmentInfosInitialized.set(!0)})},e.prototype.formatTemplateString=function(e){var t=this;return e?e.replace(/{{.+?}}|{.+?}/g,function(e){if(e.match(/{{.+?}}/g))return e.substring(1,e.length-1);var r=e.substring(1,e.length-1),a="",i=r.match(/(.*)\.Name\(\)$/);i&&(r=i[1]);for(var s=t.getAttributes(),n=0;n<s.length;n++)if(s[n].name&&s[n].name.get()===r||s[n].alias&&s[n].alias.get()===r){if(t.layer&&t.layer.getFieldByName(r)&&h.isUrl(s[n].value.get())){a=s[n].value.get();break}a=s[n].presentableValue.get();break}if(!a&&t.layer&&(a=m.StringUtilities.replaceLayerTokens(r,t.layer)),!a&&t.layer&&t.layer.mapService&&(a=m.StringUtilities.replaceMapServicetokens(r,t.layer.mapService)),!a){var l={};if(t.parseDataLinkId(r,l)&&t.dataLinkingResults.get())for(n=0;n<t.dataLinkingResults.length();n++){var o=t.dataLinkingResults.getAt(n);if(o.dataLink.get()&&o.dataLink.get().id===l.dataLinkId){if("_rowcount"===l.attributeName.toLowerCase())a=o.table?o.table.get().rows.length:0;else if(o.table.get())for(var u=o.table.get(),c=0;c<u.columns.length;c++)if(u.columns[c].toLowerCase()===l.attributeName.toLowerCase()){u.rows.length>0&&(a=u.rows[0].row[c]);break}break}}}return a||"RestToken"!==r||(a=b.RestHelperHTTPService.token),t._allowUnsafeContent?null==a&&(a=""):a=a||0===a?y.sanitize(a.toString()):"",null!==a&&void 0!==a||(a=""),a}):""},e.prototype.parseDataLinkId=function(e,t){var r=e.indexOf(".");return!(r<0)&&(t.dataLinkId=e.substring(0,r),t.attributeName=e.substring(r+1),!0)},e.prototype._getLayerUniqueId=function(){var e="";return this.layer&&(e=this.layer.id,this.layer.mapService&&(e=this.layer.mapService.id+"/"+e)),e},e.prototype._setupLinkedAttributes=function(){var e=new l.AttributeGroup;e.owner=this._graphic,e.attributes=this._graphic.attributes,this.linkedAttributes.clear(),this.linkedAttributes.addItem(e)},e.prototype._refreshPresentableValues=function(){this.attributes.get().forEach(function(e){e.presentableValue.clear(),e.presentableValue.pulse()}),this.label.clear(),this.plainLabel.clear(),this.description.clear(),this.longDescription.clear(),this.label.pulse(),this.plainLabel.pulse(),this.description.pulse(),this.longDescription.pulse()},e}();t.Feature=v})}}});require({cache:{"geocortex/infrastructure/FeatureAttribute":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework-ui/LazyObservable","./PresentableDelegateFactory","geocortex/framework/utils/utils"],function(e,t,r,i,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t,l,n,o,u,b){this.value=new r.Observable(void 0===e?"":e),this.name=new r.Observable(void 0===t?"":t),this.alias=new r.Observable(void 0===l?this.name.get():l),this.displayName=new r.Observable(void 0===n?this.alias.get()?this.alias.get():this.name.get():n),this.visible=new r.Observable(void 0===o||o),this.type=new r.Observable(void 0===b?"":b),u=u||a.PresentableDelegateFactory.valuePresenterDelegate(null,null),this.presentableValue=new i.LazyObservable(null,u(e),!0),this.displayAsUrl=s.isUrl(e)}return e.ignoreAttribute=function(t){return t&&e.ignoreAttributeMatcher.test(t)},e}();l.ignoreAttributeMatcher=/.*\.Name\(\)$/,t.FeatureAttribute=l})}}});require({cache:{"geocortex/infrastructure/FeatureDescriptionPresenterView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./validation/XssHtmlValidator","./Feature","geocortex/framework/utils/utils","./FilterUtils","geocortex/essentials/utilities/StringUtilities","./commands.meta"],function(t,r,n,i,a,o,s,l,u){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n._xssHtmlValidator=new i.XssHtmlValidator({contentPolicy:e.defaultContentPolicy}),n}return e(r,t),r.prototype.attach=function(e){return this._attach(e)},r.prototype.reattach=function(e){var t=this;return this._attach(e,function(){return t.destroyBindings()})},r.prototype._attach=function(e,r){var n=this;return e&&e instanceof a.Feature?this.descriptionApply(e,this.root).then(function(){return r&&r(),t.prototype.attach.call(n,e)}):(t.prototype.attach.call(this,e),Promise.resolve())},r.prototype.hasContent=function(){if(this.viewModel&&this.contentField){var e=this.viewModel[this.contentField];return e&&e.get&&!!e.get()}return!1},r.prototype.descriptionGet=function(e){return this.getDescriptionContent(e)},r.prototype.getContentFieldFormat=function(e){switch(this.contentField){case"label":return e.labelFormat.get();case"description":return e.descriptionFormat.get();case"longDescription":default:return e.longDescriptionFormat.get()}},r.prototype.getDescriptionContent=function(e,t){var r=this,n=t;n||(n=this.getContentFieldFormat(e));var i=this._extractCommandHyperlinks(n);n=i.html;var a=e.formatTemplateString(n);return a||"label"!==this.contentField||(a=e.label.get()),this._sanitizeHtml(a).then(function(e){return i.html=e,e=r._injectCommandHyperlinks(i),e=r.insertLinkAndImageBindings(e)})},r.prototype.descriptionApply=function(e,t){return this.applyDescriptiveTemplate(e,t)},r.prototype.applyDescriptiveTemplate=function(e,t){var r=this,n=[],i=this.getContentFieldFormat(e);if(i&&e.hasRelationships){var a=i.match(/{{.[^}]+?\..+?}}|{.[^}]+?\..+?}/g),o=[];for(var s in a)if(a.hasOwnProperty(s)){var l=a[s];l=l.substr(1,l.length-2),o.push(l.match(/[^.].[^.]*/g))}if(o.length&&e.layer&&e.layer.relationships)for(var s in e.layer.relationships)if(e.layer.relationships.hasOwnProperty(s)){var u=e.layer.relationships[s];-1==o.toString().indexOf(u.name)&&-1==o.toString().indexOf(u.displayName)||n.push(new Promise(function(n,s){r.app.command("GetRelatedFeatures").execute({mapService:e.layer.mapService,currentFeature:e,relationshipId:u.id,objectId:e.id.get(),successCallback:function(s){return function(l){if(l.length>0){for(var u in o)if(o.hasOwnProperty(u)){var c=l[0],p=o[u],m=p[0].trim(),f=p[1].trim();if(-1!==s.indexOf(m)&&void 0!==c.attributes[f])for(var u in a)if(a.hasOwnProperty(u)){var h=a[u];-1!==i.indexOf(h)&&-1!==h.indexOf(m)&&-1!==h.indexOf(f)&&(i=i.replace(h,c.attributes[f]),r.getDescriptionContent(e,i).then(function(e){return t.innerHTML=e}).then(function(){return n()}))}}}else n()}}("{0}-{1}".format(u.name,u.displayName)),errorCallback:function(e){e.message="There was an error retrieving related features: "+e.message,r.app.trace.warning(e.message),n(e)}})}))}}return n.push(this.getDescriptionContent(e).then(function(e){return t.innerHTML=e})),Promise.all(n).then(function(){return null})},r.prototype._extractCommandHyperlinks=function(e){var t=[];return e?(e=e.replace(/\bhref="#?command:.*?"/gi,function(e){var r='href="mailto:'+o.alphaNumericToken()+'"';return t.push({commandHyperlink:e,placeholder:r}),r}),{html:e,commandHyperlinkPlaceholders:t}):{html:e,commandHyperlinkPlaceholders:t}},r.prototype._injectCommandHyperlinks=function(e){var t=e.html,r=e.commandHyperlinkPlaceholders;if(!t)return"";return t.replace(/\bhref="mailto:.*?"/gi,function(e){for(var t=0,n=r;t<n.length;t++){var i=n[t];if(e===i.placeholder)return i.commandHyperlink}return e})},r.prototype._sanitizeHtml=function(e){var t={allowFrames:!0,allowArbitraryHyperlinks:!0,uriTransformer:function(e,t){return t.type!==s.UriType.NavigableLink?e:/^mailto\:/.test(e)?e:"command:OpenWebPage?"+e}};return this._xssHtmlValidator.validate(e,{sanitizeOptions:t}).then(function(e){return e.validatedValue})},r.prototype.cleansedFormatForFormat=function(e){return this.insertLinkAndImageBindings(e)},r.prototype.insertLinkAndImageBindings=function(e){var t=this;if(null===e)return null;if(e in this._descFormats)return this._descFormats[e];var r=/<a[^>]*(\/?>)/g,n=/(<a.*?href\s*?=\s*?")(command:.+?)(".*?)(\/?>)/,i=e.replace(r,function(e,r,i,a){var o=e.match(n);if(o){var s="",l=e.match(/(title|aria-label)\s*?=\s*?"[^"]*?"/g);return l&&(s=" "+l.join(" ")),'<a _key="'+t.keyForUri(o[2])+'" href="javascript:void(0)" data-binding="{@event-onclick: handleHyperlinkClick}{@event-mouseup: ignoreEvent}{@event-mousedown: ignoreEvent}"'+s+o[4]}return e});return i=i.replace(/<img/g,'<img data-binding="{@event-load: handleImgLoad}"'),this._descFormats[e]=i,i},r.prototype.handleImgLoad=function(e){},r.prototype.keyForUri=function(e){var t=dojo.indexOf(this._uris,e);return t>=0||(t=this._uris.length,this._uris.push(e)),t},r.prototype.parseArguments=function(e,t,r){var n={};if("none"===t)return null;if("string"===t)return this.tryPerformTokenSubstitution(e,r,n)?[n.value]:[e];if("list"===t){var i;try{i=JSON.parse(e)}catch(t){i=e.split("&")}for(var a=0;a<i.length;a++)this.tryPerformTokenSubstitution(i[a],r,n)&&(i[a]=n.value);return i}var o;try{o=JSON.parse(e)}catch(t){if(e.indexOf("=")<0)return this.tryPerformTokenSubstitution(e,r,n)?[n.value]:(this.app.trace.warning("The specified parameter could not be parsed to a valid Object in JSON or Query String format."),[null]);o=dojo.queryToObject(e)}for(var s in o)o.hasOwnProperty(s)&&"function"!=typeof o[s]&&this.tryPerformTokenSubstitution(o[s],r,n)&&(o[s]=n.value);var l=null;if("object"!==t){var u=dojo.getObject(t)();l=o,o=dojo.safeMixin(u,o)}return l&&o.spatialReference&&!l.spatialReference&&(o.spatialReference=null),[o]},r.prototype.tryPerformTokenSubstitution=function(e,t,r){var n=this;if(!(null!==e&&void 0!==e&&t&&t instanceof a.Feature))return r.value=null,!1;var i=t.esriFeature&&t.esriFeature.get&&t.esriFeature.get()||null;if("{$Feature}"===e)return r.value=t,!0;if("{$Graphic}"===e)return r.value=i||null,null!==r.value;if("{$Geometry}"===e)return r.value=i&&i.geometry||null,null!==r.value;if("string"==typeof e){var o=!1,s=e.replace(/{.+?}/g,function(e){o=!0;var r=e.substring(1,e.length-1),a=i&&i.attributes[r];return a||(!a&&t.layer&&(a=l.StringUtilities.replaceLayerTokens(r,t.layer)),!a&&t.layer&&t.layer.mapService&&(a=l.StringUtilities.replaceMapServicetokens(r,t.layer.mapService)),a.length>0?a:(n.app.trace.warning("The token syntax {"+r+"} was detected, but could not be matched to a valid replacement value."),e))});return r.value=s,o}return!1},r.prototype.decodeHtmlQuotes=function(e){return e=e.replace(/&quot;/g,'"'),e=e.replace(/&39;/g,"'")},r.prototype.decodeHtmlAmpersands=function(e){return e=e.replace(/&amp;/g,"&")},r.prototype.handleHyperlinkClick=function(e,t,r){var n=t.getAttribute("_key"),i=this._uris[n];if(i){var a=new dojo._Url(i);if("command"===a.scheme){var o=a.path,s=a.query,l=a.fragment;return l&&(s+="#"+l),this.runCommand(o,s,r),!1}}return!1},r.prototype.ignoreEvent=function(e,t,r){return!1},r.prototype.runCommand=function(e,t,r){var n=this.app.command(e),i=u.Commands.metadataForCommandName(e);if(null!==i)if(i.isHyperlinkable){a=[];if(t){t=this.decodeHtmlQuotes(t),t=this.decodeHtmlAmpersands(t);var a=this.parseArguments(t,i.arguments,r)}if("OpenWebPage"==e){var o={url:a[0],isLink:!0},s=[];s.push(o),n.execute.apply(n,s)}else n.execute.apply(n,a)}else this.app.trace.warning('The specified command "{0}" is not able to be hyperlinked.'.format(e));else this.app.trace.warning('The specified command "{0}" has no associated metadata.'.format(e))},r}(n.ViewBase);r.FeatureDescriptionPresenterView=c,c.prototype._uris=[],c.prototype._descFormats={},c.prototype.contentField=null})}}});require({cache:{"geocortex/infrastructure/featureDetails/FeatureProviderBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(r,t,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(r){function t(e,t){var i=r.call(this,e,t)||this;return i.currentFeature=new o.Observable(null),i.providerEnabled=new o.Observable(!1),i.currentFeature.bind(i,i.handleCurrentFeatureChanged),i}return e(t,r),t.prototype.initialize=function(e){},t.prototype.handleCurrentFeatureChanged=function(e){},t.prototype.updateProviderState=function(e){var r=!!this.currentFeature.get()&&!!e;this.providerEnabled.get()!==r&&this.providerEnabled.set(r)},t.prototype.createAttachedViews=function(e,r,t,i){var o=this,a=[];if(e.viewType&&e.markup&&r){var n=function(t,n,u){var c=r[n];if(null!==c)if(c){var p=o.app.viewManager.createView({viewId:u,markupResource:t,typeName:e.viewType,iconUri:e.iconUri,title:e.title||"",regionName:c,isVisible:!0,libraryId:e.libraryId||o.libraryId,configuration:e.viewConfig});p.attach(i||o),a.push(p)}else o.app.trace.warning("FeatureProviderBase: Could not resolve target region for view mode {0}. Failed to create view with id {1}".format(n,u))};if("string"==typeof e.markup)n(e.markup,"default",e.viewId||null);else for(var u in e.markup)if(e.markup.hasOwnProperty(u)){var c=e.viewId?"{0}-{1}".format(e.viewId,u):null;n(e.markup[u],u,c)}t&&"function"==typeof t&&t(a)}else this.app.trace.warning("FeatureProviderBase: View type, markup or region not specified. Cannot create view for {0}".format(e.type))},t}(i.ViewModelBase);t.FeatureProviderBase=a})},"geocortex/infrastructure/featureDetails/FeatureProviderConfig":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/FeatureSet":function(){define(["require","exports","geocortex/framework-ui/LazyObservable","geocortex/framework/observables","./Feature","./FeatureAttribute","./NumberFormat","./DateFormat","./Dictionary","geocortex/framework/utils/utils","geocortex/framework/events/CollectionChangedArgs","geocortex/framework/utils/ArrayUtils","geocortex/geocortex","./TaskUtils","./MapUtils","./KmlFeature","./PresentableDelegateFactory","./DataLinkingResult"],function(e,t,r,a,i,s,n,u,o,l,f,h,d,p,g,c,y,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m;!function(e){e[e.Unresolved=0]="Unresolved",e[e.Resolving=1]="Resolving",e[e.Resolved=2]="Resolved"}(m=t.DataLinksState||(t.DataLinksState={}));var F=function(){function e(e){var t=this;this.id="",this.featureLayer=null,this.displayName=new r.LazyObservable,this.features=new a.ObservableCollection,this.attributes=new a.ObservableCollection,this.iconUri=new r.LazyObservable,this.extendedProperties=new a.ObservableCollection,this.isSelectedInCollection=new a.Observable(!1),this.dataLinksResolved=new a.Observable(!1),this.defaultNumberFormat=n.NumberFormat.DEFAULT,this.defaultDateFormat=u.DateFormat.DEFAULT,this._objectIds=new o.Dictionary,this._watchHandles={},this._dataLinksState=m.Unresolved;var i=null,s=null;(e=e||{}).hasOwnProperty("esriFeatureSet")&&(i=e.esriFeatureSet),e.hasOwnProperty("featureLayer")&&(this.featureLayer=e.featureLayer),e.hasOwnProperty("layer")&&(s=e.layer),e.hasOwnProperty("allowUnsafeContent")?this._allowUnsafeContent=e.allowUnsafeContent:this._allowUnsafeContent=!1,e.hasOwnProperty("app")&&(this.app=e.app),this.defaultDateFormat=e.defaultDateFormat||u.DateFormat.DEFAULT,this.defaultNumberFormat=e.defaultNumberFormat||n.NumberFormat.DEFAULT,this.uniqueId="fs_"+l.alphaNumericToken(),this.esriFeatureSet=i,s&&(this.layer=s),e.hasOwnProperty("id")&&!String.isNullOrEmpty(e.id)&&(this.id=e.id),String.isNullOrEmpty(this.id)&&this.layer&&this.layer.mapService&&(this.id="{0}/{1}".format(this.layer.mapService.id,this.layer.id)),this.displayName.delegateGetter=function(){return t.layer&&t.layer.displayName?t.layer.displayName:""},this.iconUri.delegateGetter=function(){return t.layer&&t.layer.iconUri?t.layer.iconUri:""},this.loadFeatures(),this.loadAttributes()}return Object.defineProperty(e.prototype,"dataLinksState",{get:function(){return this._dataLinksState},enumerable:!0,configurable:!0}),e.prototype.setDataLinksState=function(e){this._dataLinksState=e,this.dataLinksResolved.set(e===m.Resolved)},e.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var r=this.extendedProperties.getAt(t);if(r&&r.name==e)return r.value}return null},e.prototype.setExtendedProperty=function(e,t){for(var r=0;r<this.extendedProperties.getLength();r++){var a=this.extendedProperties.getAt(r);if(a&&a.name==e)return void(a.value=t)}this.extendedProperties.addItem({name:e,value:t})},e.prototype.addFeature=function(e,t){var r=new f.CollectionChangedArgs,a=this.features.length();return r.type="append",r.rangeStart=a,r.rangeEnd=a,r.sender=this.features,!!this._addFeatureWithoutNotification(e,t)&&(this.features.bindingEvent.publish(r),!0)},e.prototype._addFeatureWithoutNotification=function(e,t){if(!e)throw new Error("Feature cannot be null.");var r=this.features.getItems();return!(!t&&this.containsFeature(e))&&(e.featureSet=this,r.push(e),this.esriFeatureSet&&this.esriFeatureSet.features&&this.esriFeatureSet.features.push(e.esriFeature.get()),!0)},e.prototype.removeFeature=function(e){if(!e)throw new Error("Feature cannot be null.");var t=e.id.get();if(!String.isNullOrEmpty(t)&&!this._objectIds.containsKey(t))return!1;var r=new f.CollectionChangedArgs;r.type="remove";for(var a=this.features.length();a--;){var i=this.features.getAt(a);if(i&&i.structurallyEquals(e))return r.rangeStart=a,r.rangeEnd=a,r.sender=this.features,this.features.bindingEvent.publish(r),this._removeWithoutNotificationAt(a),!0}return!1},e.prototype._removeWithoutNotificationAt=function(e){var t=this.features.getItems();if(0<=e&&e<t.length){var r=t[e],a=r.esriFeature.get();return a&&this.esriFeatureSet&&this.esriFeatureSet.features&&h.removeItem(this.esriFeatureSet.features,a),r.featureSet=null,h.remove(t,e,e),this._objectIds.remove(r.id.get()),!0}return!1},e.prototype.containsFeature=function(e){if(!e)throw new Error("Feature cannot be null.");var t=e.id.get();if(t&&this._objectIds.containsKey(t))return!0;for(var r=0;r<this.features.length();r++)if(this.features.getAt(r).structurallyEquals(e))return!0;return!1},e.prototype.clearFeatures=function(){if(0!=this.features.length()){var e=new f.CollectionChangedArgs;for(e.type="clear",e.rangeStart=0,e.rangeEnd=this.features.length()-1,e.sender=this.features,this.features.bindingEvent.publish(e);this.features.length()>0;)this._removeWithoutNotificationAt(0)}},e.prototype.loadGeometries=function(e,t,r){var a=this,i=new dojo.Deferred;if(!this.layer){s=new Error("loadGeometries: Layer must be present.");return d.deferredReject(i,s),"function"==typeof r&&r(s),i}if(!this.layer.primaryKeyField){var s=new Error("loadGeometries: Layer must have a PrimaryKeyField to load geometries.");return d.deferredReject(i,s),"function"==typeof r&&r(s),i}var n=this.layer.primaryKeyField.name;e||(e=this.features.getItems());var u=[];if(e){var o;for(o=0;o<e.length;o++){var l=e[o];if(!l.hasGeometry.get()){var f=l.esriFeature.get();f&&f.attributes[n]&&u.push(l)}}}if(u.length>0){var h=[];for(o=0;o<u.length;o++)h.push(u[o].esriFeature.get().attributes[n]);var g=p.getQueryTask(this.layer),c=new esri.tasks.Query;c.objectIds=h,c.returnGeometry=!0,c.outFields=[n],this.layer&&this.layer.mapService&&this.layer.mapService.essentialsMap&&this.layer.mapService.essentialsMap.site&&this.layer.mapService.essentialsMap.site.getMap()&&(c.outSpatialReference=this.layer.mapService.essentialsMap.site.getMap().spatialReference),g.execute(c).then(function(e){if(e&&e.features&&e.features.length>0)for(var r=0;r<e.features.length;r++){var s=e.features[r],o=a._findFeature(s.attributes[n],n,u);o&&(o.esriFeature.get().geometry=s.geometry)}d.deferredResolve(i,void 0),"function"==typeof t&&t()},function(e){var t=new Error("loadGeometries: Query error: "+e.message);d.deferredReject(i,t),"function"==typeof r&&r(t)})}else d.deferredResolve(i,void 0),"function"==typeof t&&t();return i},e.prototype.findFeatureById=function(e){return this._objectIds.get(e)},e.prototype.findFeatureByEsriFeature=function(e){var t=null,r=e.getLayer();if(r&&this.layer&&this.layer.mapService&&this.layer.mapService.serviceLayer!==r)return null;for(var a=0;a<this.features.length();a++){var i=this.features.getAt(a);if(i.esriFeature&&(i.esriFeature.get()===e||g.esriFeaturesEqual(i.esriFeature.get(),e))){t=i;break}}return t},e.prototype._findFeature=function(e,t,r){var a,i,s=null;if(r&&r.length>0)for(a=0;a<r.length;a++)if((i=r[a].esriFeature.get())&&i.attributes&&i.attributes[t]==e){s=r[a];break}return s},e.prototype.loadFeatures=function(){this._watchFeatureSetChanges(),this.features.clear();var e,t=[];if(this.esriFeatureSet&&this.esriFeatureSet.features)for(var r=0;r<this.esriFeatureSet.features.length;++r){var a=this.esriFeatureSet.features[r],s={graphic:a,layer:this.layer,featureLayer:this.featureLayer,resolveLayerFields:!0,allowUnsafeContent:this._allowUnsafeContent};(e=a&&a[c.isKmlProperty]?new c.KmlFeature(s):new i.Feature(s)).featureSet=this,e.defaultDateFormat=this.defaultDateFormat,e.defaultNumberFormat=this.defaultNumberFormat,t.push(e)}this.features.useThrottling=!1,this.features.addItems(t)},e.prototype.loadAttributes=function(){this.attributes.clear();var e=[],t=[];if(this.layer&&this.layer.fields){for(var r=0;r<this.layer.fields.length;r++){var a=this.layer.fields[r];s.FeatureAttribute.ignoreAttribute(a.name)?t.push(a):e.push(new s.FeatureAttribute("",a.name,a.alias,a.displayName,a.visible,y.PresentableDelegateFactory.valuePresenterDelegate(a,null)))}for(var i=0;i<t.length;i++){var n=t[i];if(n.visible){var u=e.filter(function(e){return e.name.get()===n.name.substr(0,n.name.length-".Name()".length)}),o=1===u.length?u[0]:null;o&&(o.visible.get()||o.visible.set(!0),o.alias.set(n.alias),o.displayName.set(n.displayName))}}}else if(this.features&&this.features.getLength()>0)for(var l=this.features.getAt(0),f=0;f<l.attributes.getLength();f++){var h=l.attributes.getAt(f);e.push(new s.FeatureAttribute("",h.name.get(),h.alias.get(),h.displayName.get()))}else if(this.esriFeatureSet&&this.esriFeatureSet.features&&this.esriFeatureSet.features.length>0){var d=this.esriFeatureSet.features[0];for(var p in d.attributes)d.attributes.hasOwnProperty(p)&&e.push(new s.FeatureAttribute("",p,p,p))}this.attributes.addItems(e)},e.prototype.featureSetChanged=function(e){if("append"==e.type||"insert"==e.type)for(t=e.rangeStart;t<=e.rangeEnd;t++)(a=(r=this.features.getAt(t)).featureSetUniqueIds.indexOf(this.uniqueId))>=0&&r.featureSetUniqueIds.splice(a,1),r.featureSet=this,r.featureSetUniqueIds.push(this.uniqueId),(i=r.id.get())&&this._objectIds.set(i,r);if("remove"==e.type||"clear"==e.type)for(var t=e.rangeStart;t<=e.rangeEnd;t++){var r=this.features.getAt(t),a=r.featureSetUniqueIds.indexOf(this.uniqueId);a>=0&&r.featureSetUniqueIds.splice(a,1),r.featureSet===this&&(r.featureSet=null);var i=r.id.get();i&&this._objectIds.remove(i)}},e.prototype._applyDataLinks=function(e,t,r,a,i){for(var s=0;s<e.features.length();s++)if((p=e.features.getAt(s)).linkedAttributes.length()>0){var n=p.linkedAttributes.getAt(0);p.linkedAttributes.clear(),p.linkedAttributes.addItem(n),p.dataLinkingResults.clear()}for(var u=0;u<r.length;u++)for(var o=a[u],l=r[u],f=0;f<o.length;f++){var h=o[f],d=new v.DataLinkingResult;d.table.set(h.linkedData),d.dataLink.set(l);var p=t[h.index];p.dataLinkingResults.addItem(d),i&&i(p),l.isOneToOne&&p.linkedAttributes.addItem(d.asAttributeGroup())}},e.prototype.resolveDataLinks=function(e,t,r,a,i){var s=this,n=this;if(this.dataLinksState!==m.Resolving)if(void 0===t&&(t=!0),n.layer&&n.layer.hasDataLinks&&n.features.length()>0){n.setDataLinksState(m.Resolving);var u=this.features.get().slice(),o=[];o=t?dojo.filter(n.layer.dataLinks,function(e){return e.visible}):n.layer.dataLinks,o=dojo.filter(o,function(e){return!!(e&&e.parameters&&e.parameters.length)});for(var l=[],f=0,h=0,d=!1,p=0;p<o.length&&!d;p++){var g=function(t){return function(i){if(!d&&(l[t]=i,++f>=o.length)){if(s._applyDataLinks(n,u,o,l,e),n.setDataLinksState(m.Resolved),void 0!==s.app)for(var h=0;h<o.length;h++)s.app.event("DatalinkResolutionCompletedEvent").publish(o[h].id,n);a&&a(n,r)}}},c=g(p),y=function(e){return function(t){++h>=o.length?(console.error("There was an error in resolving {0} datalink. Message : {1}".format(o[e].displayName,t.message)),d=!0,n.setDataLinksState(m.Unresolved),i&&i(n,t,r)):(console.error("There was an error in resolving {0} datalink. Message : {1}".format(o[e].displayName,t.message)),g(e)(new v.DataLinkingResult))}}(p);void 0!==this.app&&this.app.event("DatalinkResolutionStartedEvent").publish(o[p].id,n),o[p].performDataLinking(n.esriFeatureSet,c,y)}}else n.setDataLinksState(m.Resolved),a&&a(n,r);else i&&i(this,new Error("Currently performing data linking"),r)},e.prototype.doWhenDataLinkingCompleted=function(e){var t=this;if("function"==typeof e)if(this.dataLinksResolved.get())e(this);else var r=this.dataLinksResolved.bind(this,function(a){a&&(t.dataLinksResolved.unbind(r),e(t))})},e.prototype.append=function(e){for(var t=new Object,r=0;r<this.features.length();r++){i=this.features.getAt(r);this.layer&&this.layer.primaryKeyField&&(a=this.layer.primaryKeyField.name),a&&(t[s=i.esriFeature.get().attributes[a]]=i)}for(r=0;r<e.features.length();r++){var a,i=e.features.getAt(r);if(e.layer&&e.layer.primaryKeyField&&(a=e.layer.primaryKeyField.name),a){var s=i.esriFeature.get().attributes[a];t[s]||this.features.addItem(i)}else this.features.addItem(i)}},e.prototype.union=function(e){for(var t=this.clone(),r=e&&e.features?e.features.length():0,a=0;a<r;a++)t.containsFeature(e.features.getAt(a))||t.addFeature(e.features.getAt(a),!0);return t},e.prototype.unionInPlace=function(e){if(!e||!e.features||0===e.features.length())return!1;var t=new f.CollectionChangedArgs;t.type="append",t.rangeStart=this.features.length();for(var r=!1,a=0,i=0;i<e.features.length();i++){var s=e.features.getAt(i);this.containsFeature(s)||this._addFeatureWithoutNotification(s,!0)&&(r=!0,a++)}return r&&(t.rangeEnd=t.rangeStart+a-1,t.sender=this.features,this.features.bindingEvent.publish(t)),r},e.prototype.subtract=function(e){for(var t=this.cloneStructure(),r=0;null!=e&&r<this.features.length();r++)e.containsFeature(this.features.getAt(r))||t.addFeature(this.features.getAt(r));return t},e.prototype.subtractInPlace=function(e){if(!e||!e.features||0===e.features.length())return!1;for(var t=!1,r=this.features.length();r--;){var a=this.features.getAt(r);e.containsFeature(a)&&(this._removeWithoutNotificationAt(r),t=!0)}return t&&this.features.pulse(),t},e.prototype.intersect=function(e){for(var t=this.cloneStructure(),r=0;null!=e&&r<this.features.length();r++)e.containsFeature(this.features.getAt(r))&&t.addFeature(this.features.getAt(r));return t},e.prototype.intersectInPlace=function(e){if(!e||!e.features)return!1;for(var t=!1,r=this.features.length();r--;){var a=this.features.getAt(r);e.containsFeature(a)||(this._removeWithoutNotificationAt(r),t=!0)}return t&&this.features.pulse(),t},e.prototype.clone=function(){for(var e=this.cloneStructure(),t=0;t<this.features.length();t++)e.addFeature(this.features.getAt(t),!0);return e},e.prototype.cloneStructure=function(){var t=new e({app:this.app,layer:this.layer,featureLayer:this.featureLayer,allowUnsafeContent:this._allowUnsafeContent,defaultDateFormat:this.defaultDateFormat,defaultNumberFormat:this.defaultNumberFormat,id:this.id});return t.id=this.id,t.isSelectedInCollection.set(this.isSelectedInCollection.get()),t.setDataLinksState(this.dataLinksState),t.displayName.set(this.displayName.get()),t.iconUri.set(this.iconUri.get()),t.attributes.set(this.attributes.get()),t.extendedProperties.set(this.extendedProperties.get()),t.esriFeatureSet=this._cloneEsriStructure(this.esriFeatureSet),t},e.prototype._cloneEsriStructure=function(e){if(!e)return null;var t=new esri.tasks.FeatureSet;return t.displayFieldName=e.displayFieldName,t.exceededTransferLimit=e.exceededTransferLimit,t.fieldAliases=e.fieldAliases,t.geometryType=e.geometryType,t.spatialReference=e.spatialReference,e.fields&&(t.fields=e.fields),t},e.prototype._watchFeatureSetChanges=function(){var e=this;this._unwatchFeatureSetChanges();var t=this.features.bind(this,this.featureSetChanged),r={remove:function(){return e.features.unbind(t)}};return this._watchHandles.features=r,r},e.prototype._unwatchFeatureSetChanges=function(){var e=this._watchHandles.features;e&&e.remove(),this._watchHandles.features=null},e}();t.FeatureSet=F})}}});require({cache:{"geocortex/infrastructure/FeatureSetCollection":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework/utils/utils","./Dictionary"],function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.displayName=new r.Observable(""),this.isModified=new r.Observable(!1),this.featureSets=new r.ObservableCollection,this.extendedProperties=new r.ObservableCollection,this.id="FSC-{0}".format(i.alphaNumericToken()),this.featureSets.useThrottling=!1}return e.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var r=this.extendedProperties.getAt(t);if(r&&r.name==e)return r.value}return null},e.prototype.setExtendedProperty=function(e,t){for(var r=0;r<this.extendedProperties.getLength();r++){var i=this.extendedProperties.getAt(r);if(i&&i.name==e)return void(i.value=t)}this.extendedProperties.addItem({name:e,value:t})},e.prototype.getFeatureSetById=function(e){return this._getFeatureSetByIdImpl(e)},e.prototype.getFeatureSetByUniqueId=function(e){return this._getFeatureSetByIdImpl(e,!0)},e.prototype.getFeatureSetByLayer=function(e){if(!e)return null;for(var t=0;t<this.featureSets.getLength();++t){var r=this.featureSets.getAt(t),i=r.layer,a=e===i||e&&i&&e.id==i.id,n=e===i||e&&i&&e.mapService===i.mapService||e&&i&&e.mapService&&i.mapService&&e.mapService.id==i.mapService.id;if(a&&n)return r}return null},e.prototype.getFeatureSetbyEsriLayer=function(e){if(!e)return null;for(var t=0;t<this.featureSets.getLength();++t){var r=this.featureSets.getAt(t);if(r.esriFeatureSet&&r.esriFeatureSet.features&&r.esriFeatureSet.features.length>0&&r.esriFeatureSet.features[0].getLayer()&&r.esriFeatureSet.features[0].getLayer()===e)return r}return null},e.prototype.findFeatureByEsriFeature=function(e){for(var t=0;t<this.featureSets.getLength();t++){var r=this.featureSets.getAt(t).findFeatureByEsriFeature(e);if(r)return r}return null},e.prototype.firstFeature=function(){for(var e=0;e<this.featureSets.getLength();e++){var t=this.featureSets.getAt(e);if(t.features.getLength()>0)return t.features.getAt(0)}return null},e.prototype.countFeatures=function(){for(var e=0,t=0;t<this.featureSets.length();t++)e+=this.featureSets.getAt(t).features.length();return e},e.prototype.clear=function(){for(var e=0;e<this.featureSets.getLength();e++)this.featureSets.getAt(e).features.clear();this.featureSets.clear()},e.prototype.clone=function(e){void 0===e&&(e=!1);for(var t=this.cloneStructure(),r=0;r<this.featureSets.length();r++){var i=e?this.featureSets.getAt(r).clone():this.featureSets.getAt(r);t.featureSets.addItem(i)}return t},e.prototype.cloneStructure=function(){var t=new e;return t.sourceName=this.sourceName,t.displayName.set(this.displayName.get()),t.isModified.set(this.isModified.get()),t.tag=this.tag,this.extendedProperties.getItems().forEach(function(e){return t.setExtendedProperty(e.name,e.value)}),t},e.prototype.unionInPlace=function(e){if(!e||0===e.featureSets.length())return!1;for(var t=this._buildFeatureSetLookup(),r=this._buildLayerLookup(),i=!1,a=0;a<e.featureSets.length();a++){var n=e.featureSets.getAt(a),u=n.id,o=n.layer,s=null;if(u&&t.containsKey(u)&&(s=t.get(u)),!s&&o&&o.mapService){var f=this._generateLayerKey(o.mapService.id,o.id);s=r.get(f)}s?s.unionInPlace(n)&&(i=!0):(this.featureSets.addItem(n),i=!0)}return i},e.prototype.unionManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,r=0;r<e.length;r++)this.unionInPlace(e[r])&&(t=!0);return t},e.prototype.subtractInPlace=function(e){if(!e||0===e.featureSets.length())return!1;for(var t=e._buildFeatureSetLookup(),r=e._buildLayerLookup(),i=!1,a=this.featureSets.length();a--;){var n=this.featureSets.getAt(a),u=n.id,o=n.layer,s=null;if(u&&t.containsKey(u)&&(s=t.get(u)),!s&&o&&o.mapService){var f=this._generateLayerKey(o.mapService.id,o.id);s=r.get(f)}s&&(n.subtractInPlace(s)&&(i=!0),0==n.features.length()&&(this.featureSets.removeAt(a),i=!0))}return i},e.prototype.subtractManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,r=0;r<e.length;r++)this.subtractInPlace(e[r])&&(t=!0);return t},e.prototype.intersectInPlace=function(e){if(!e)return!1;for(var t=e._buildFeatureSetLookup(),r=e._buildLayerLookup(),i=!1,a=this.featureSets.length();a--;){var n=this.featureSets.getAt(a),u=n.id,o=n.layer,s=null;if(u&&t.containsKey(u)&&(s=t.get(u)),!s&&o&&o.mapService){var f=this._generateLayerKey(o.mapService.id,o.id);s=r.get(f)}s?(n.intersectInPlace(s)&&(i=!0),0==n.features.length()&&(this.featureSets.removeAt(a),i=!0)):(this.featureSets.removeAt(a),i=!0)}return i},e.prototype.intersectManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,r=0;r<e.length;r++)this.intersectInPlace(e[r])&&(t=!0);return t},e.prototype._generateLayerKey=function(e,t){return"{0}/{1}".format(e,t)},e.prototype._buildLayerLookup=function(){for(var e=new a.Dictionary,t=0;t<this.featureSets.length();t++){var r=this.featureSets.getAt(t);if(r&&r.layer&&r.layer.mapService){var i=this._generateLayerKey(r.layer.mapService.id,r.layer.id);e.containsKey(i)||e.set(i,r)}}return e},e.prototype._buildFeatureSetLookup=function(){for(var e=new a.Dictionary,t=0;t<this.featureSets.length();t++){var r=this.featureSets.getAt(t);r&&r.id&&!e.containsKey(r.id)&&e.set(r.id,r)}return e},e.prototype._getFeatureSetByIdImpl=function(e,t){void 0===t&&(t=!1);for(var r=0;r<this.featureSets.getLength();++r){var i=this.featureSets.getAt(r);if(t){if(i.uniqueId==e)return i}else if(i.id==e)return i}return null},e}();t.FeatureSetCollection=n})}}});require({cache:{"geocortex/infrastructure/FeatureSetManager":function(){define(["require","exports","geocortex/framework/observables","./eventArgs/FeatureSetManagerEventArgs"],function(e,t,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.featureSetCollections=new o.ObservableCollection,this._featureSetCollectionsMap={},this._collectionChangedEventMap={},this._collectionOpenCount={},this._searchSuggestions={},this.app=e,this._registerCommands()}return e.prototype._registerCommands=function(){this.app.command("OpenFeatureSetCollection").register(this,this.openCollection),this.app.command("CloseFeatureSetCollection").register(this,this.closeCollection),this.app.command("RemoveCollection").register(this,this.removeCollection),this.app.command("RemoveFeatureSetCollection").register(this,this.removeCollection),this.app.command("RemoveCollectionById").register(this,this.removeCollectionById),this.app.command("RemoveFeatureSetCollectionById").register(this,this.removeCollectionById)},e.prototype.openCollection=function(e){if(!this._featureSetCollectionsMap.hasOwnProperty(e))return this.app.trace.warning("Cannot open feature set collection '{0}': No feature set collection with matching ID found.".format(e)),null;if(this._collectionOpenCount.hasOwnProperty(e)||(this._collectionOpenCount[e]=0),1==++this._collectionOpenCount[e]){var t=this._featureSetCollectionsMap[e],o=new n.FeatureSetManagerEventArgs({sender:this,featureSetCollection:t,featureSetCollectionId:e});this.app.event("FSMCollectionOpenedEvent").publish(o)}return this._featureSetCollectionsMap[e]},e.prototype.closeCollection=function(e){if(!this._featureSetCollectionsMap.hasOwnProperty(e))return this.app.trace.warning("Cannot close feature set collection '{0}': No feature set collection with matching ID found.".format(e)),!1;if(!this._collectionOpenCount.hasOwnProperty(e)||0==this._collectionOpenCount[e])return this.app.trace.warning("Attempted to close an already-closed FeatureSetCollection."),!1;if(0==--this._collectionOpenCount[e]){var t=new n.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[e],featureSetCollectionId:e});this.app.event("FSMCollectionClosedEvent").publish(t)}return!0},e.prototype.tryCloseCollection=function(e){return!!this._featureSetCollectionsMap.hasOwnProperty(e)&&(!this.isCollectionOpen(e)||this.closeCollection(e))},e.prototype.isCollectionOpen=function(e){return this._featureSetCollectionsMap.hasOwnProperty(e)?this._collectionOpenCount.hasOwnProperty(e)&&this._collectionOpenCount[e]>0:(this.app.trace.warning("Cannot check open state of feature set collection '{0}': No feature set collection with matching ID found.".format(e)),!1)},e.prototype.addCollection=function(e){return this._addCollectionImpl(e)},e.prototype._addCollectionImpl=function(e){if(!e)throw new Error("FeatureSetManager.addCollection: Parameter 'fsc' required.");var t=this._featureSetCollectionsMap[e.id];if(e===t)return!0;if(t)return this.app.trace.warning("Cannot add feature set collection '{0}': A feature set collection with that ID already exists.".format(e.id)),!1;this._featureSetCollectionsMap[e.id]=e,this.featureSetCollections.addItem(e);var o=e.featureSets.bind(this,dojo.hitch(this,function(t){this.handleCollectionChanged(e,t)}));this._collectionChangedEventMap[e.id]=o;var r=new n.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[e.id],featureSetCollectionId:e.id});return this.app.event("FSMCollectionAddedEvent").publish(r),!0},e.prototype.handleCollectionChanged=function(e,t){var o=new n.FeatureSetManagerEventArgs({sender:this,featureSetCollection:e,featureSetCollectionId:e.id,collectionChangedEventArgs:t});this.app.event("FSMCollectionChangedEvent").publish(o)},e.prototype.removeCollection=function(e){return!!this.canRemoveCollection(e)&&this.removeCollectionById(e.id)},e.prototype.removeCollectionById=function(e){if(!this._featureSetCollectionsMap.hasOwnProperty(e))return this.app.trace.warning("Cannot remove feature set collection '{0}': Collection not found.".format(e)),!1;this.isCollectionOpen(e)&&this.closeCollection(e);var t=this._featureSetCollectionsMap[e],o=this._collectionChangedEventMap[e];t.featureSets.unbind(o),this.featureSetCollections.removeItem(this._featureSetCollectionsMap[e]),delete this._collectionOpenCount[e],delete this._collectionChangedEventMap[e];var r=new n.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[e],featureSetCollectionId:e});return this.app.event("FSMCollectionRemovedEvent").publish(r),t.featureSets.get().forEach(function(e){e.features.get().forEach(function(t){if(!(t.featureSet&&t.featureSet.uniqueId!==e.uniqueId||t.featureSetUniqueIds.length>1||t.getExtendedPropertyByName("isShownInMaptip")||t.getExtendedPropertyByName("isShownInFeaturedetails"))){for(var o in t)t.hasOwnProperty(o)&&null!==t[o]&&void 0!==t[o]&&(t[o].isObservableCollection&&(t[o].clear(),t[o].bindingEvent.clear()),t[o].delegateGetter&&(t[o].delegateGetter=null));t.esriFeature.get()&&(t.esriFeature.bindingEvent.clear(),t.esriFeature.set(null))}}),e.features.clear(),e.features.bindingEvent.clear(),e.esriFeatureSet&&(e.esriFeatureSet.features=[],e.esriFeatureSet=null)}),t.featureSets.clear(),delete this._featureSetCollectionsMap[e],!0},e.prototype.canRemoveCollection=function(e){return null!=e&&null!=this.getCollectionById(e.id)},e.prototype.getCollectionById=function(e){return this._featureSetCollectionsMap[e]},e.prototype.getCollectionIds=function(){var e=[];for(var t in this._featureSetCollectionsMap)this._featureSetCollectionsMap.hasOwnProperty(t)&&e.push(t);return e},e.prototype.findFeatureSetByUniqueId=function(e){for(var t=0,o=this.featureSetCollections.length();t<o;t++){var n=this.featureSetCollections.getAt(t).getFeatureSetByUniqueId(e);if(n)return n}return null},e.prototype.findFeaturesByEsriFeature=function(e){var t=[];return this.featureSetCollections.get().forEach(function(o){var n=o.findFeatureByEsriFeature(e);n&&t.push(n)}),t},e.prototype.addSearchSuggestions=function(e){for(var t in e)if(e.hasOwnProperty(t)){if(this._searchSuggestions.hasOwnProperty(t)){this.app.trace.warning("Cannot add search suggestion '{0}': A search suggestion for that feature set type already exists.".format(e[t]));continue}e[t]&&(this._searchSuggestions[t]=e[t])}},e.prototype.getSearchSuggestion=function(e){return this._searchSuggestions[e]},e.prototype.updateCollectionsOnFeatureDeletion=function(e,t){void 0===t&&(t=!0),(this.featureSetCollections.get()||[]).forEach(function(o){for(var n=o.featureSets.length();n--;){var r=o.featureSets.getAt(n),i=r.findFeatureByEsriFeature(e);i&&(r.removeFeature(i),t&&0===r.features.length()&&o.featureSets.removeItem(r))}})},e.prototype.findOpenFeatureSetCollectionByFeatureSetUniqueId=function(e){for(var t=0,o=this.featureSetCollections.length();t<o;t++){var n=this.featureSetCollections.getAt(t);if(this.isCollectionOpen(n.id)&&n.getFeatureSetByUniqueId(e))return n}return null},e}();t.FeatureSetManager=r})}}});require({cache:{"geocortex/infrastructure/FilterUtils":function(){define(["require","exports"],function(e,t){"use strict";function r(e,t){return void 0===t&&(t={}),html4.ATTRIBS["*::aria-label"]=0,html4.ATTRIBS["*::data-replacement-token"]=0,html4.ATTRIBS["a::target"]=0,t.allowFrames&&(html4.ATTRIBS["iframe::src"]=1),html.sanitize(e,function(e,r,n,a){if(t.uriTransformer){e=e.toString();var u=void 0;if("MARKUP"===a.TYPE){var s=a;u={uri:e,type:"a"===s.XML_TAG&&"href"===s.XML_ATTR?i.NavigableLink:i.Markup,tag:s.XML_TAG,attribute:s.XML_ATTR}}else{if("CSS"!==a.TYPE)throw new Error("Unknown URI hint type: '"+a.TYPE+"'");var o=a;u={uri:e,type:i.Css,property:o.CSS_PROP}}return t.uriTransformer(e,u)}return""})}Object.defineProperty(t,"__esModule",{value:!0}),t.sanitize=r,t.stripHtml=function(e){var t=r(e=String.unescapeHtml(e)),i=document.createElement("div");return i.innerHTML=t,i.innerText||i.textContent};var i;!function(e){e[e.Markup=0]="Markup",e[e.Css=1]="Css",e[e.NavigableLink=2]="NavigableLink"}(i=t.UriType||(t.UriType={}));var n=function(){function e(e,t){void 0===t&&(t={}),this.sanitize(e,t)}return e.prototype.sanitize=function(e,t){void 0===t&&(t={}),this._unsafeHtml=e,this._safeHtml=r(this._unsafeHtml,t)},Object.defineProperty(e.prototype,"unsafeHtml",{get:function(){return this._unsafeHtml},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"safeHtml",{get:function(){return this._safeHtml},enumerable:!0,configurable:!0}),e}();t.UnsafeHtml=n;!function(e){function t(e){var t=e.match(/^\s*data:(.*?),.+/i);if(!t)return null;for(var r,i,n,a=t[1],u=0,s=a.split(";");u<s.length;u++){var o=s[u];if(/^charset=(.+)$/i.test(o)){if(i)return null;i=o}else if(/^base64$/i.test(o)){if(n)return null;n=o}else if(/^.+$/i.test(o)){if(r)return null;r=o}}return{uri:e,meta:a,mediaType:r,charset:i,extension:n,payloadIndex:e.indexOf(",")+1}}e.dataUriMediaTypeWhitelist=["image/jpeg","image/png","image/gif","image/svg+xml"],e.parseDataUri=t,e.isDataUriSafe=function(r){var i=t(r);if(!i)return!1;var n=i.mediaType;return n||(n="text/plain"),!!e.dataUriMediaTypeWhitelist.some(function(e){return n.toLowerCase()===e.toLowerCase()})}}(t.DataUri||(t.DataUri={}))})}}});require({cache:{"geocortex/infrastructure/FocusUtils":function(){define(["require","exports","geocortex/framework-ui/animation/AnimationSequence"],function(e,t,o){"use strict";function n(e){e&&o.runWhenIdle(function(){try{if(e===document.activeElement)return;e.focus(),setTimeout(function(){r(e)},0)}catch(e){}})}function r(e){if(e.value&&e.value.length&&"checkbox"!==e.type&&"number"!==e.type){var t=e.value.length;if(e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}else e.selectionStart&&(e.selectionStart=t,e.selectionEnd=t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.focusOnFirstInput=function(e){if(e&&e.root&&!(e.app&&e.app.modalRegionSingleton&&e.app.modalRegionSingleton.isActive&&"ModalViewContainerView"!==e.id)){var t=Modernizr&&!!Modernizr.touch;try{for(var o=$(e.root).find("input, a, button, select, textarea, [tabindex]").not(".inactive, .bound-invisible, .disabled, .close-16, .back-16, [tabindex=-1], [readonly]:not(.control-readonly)"),r=0;r<o.length;r++){var a=o[r];if(!($(a).parentsUntil(e.root,".inactive, .bound-invisible, .disabled, .invisible, .hidden-hoisted-menu").length>=1)){var c=["select","input","textarea"];if(-1!==$.inArray(a.tagName.toLowerCase(),c)){if(a===document.activeElement)return;t&&($(a).addClass("control-readonly"),a.setAttribute("readonly","true")),n(a),$(a).one("blur",function(e){a.removeAttribute("readonly"),$(a).removeClass("control-readonly")}),$(document).off("keypress.focus-control mousedown.focus-control touchstart.focus-control"),$(document).off("keydown.focus-control"),$(document).on("keydown.focus-control",function(e){return function(e,t){t.getAttribute("readonly")?8===e.keyCode&&e.preventDefault():$(document).off("keydown.focus-control")}(e,a)}),$(document).one("keypress.focus-control mousedown.focus-control touchstart.focus-control",function(e){return function(e,t){if(t.removeAttribute("readonly"),$(t).removeClass("control-readonly"),(e.target||e.srcElement)!==t)t.blur();else{t.blur(),n(t);var o=t.getAttribute("type");o&&o.toLowerCase&&(o=o.toLowerCase()),function(e){return"textarea"===e.tagName.toLowerCase()||"true"===e.contentEditable||!!o&&["date","datetime","datetime-local","email","month","number","password","search","text","tel","time","week"].indexOf(o)>=0}(t)&&"keypress"===e.type&&(0!=e.keyCode&&$(t).val($(t).val()+String.fromCharCode(e.keyCode)),/Edge\/\d+/i.test(navigator.userAgent)&&setTimeout(function(){t.setSelectionRange(1,1)},10))}$(document).off("keypress.focus-control mousedown.focus-control touchstart.focus-control"),$(document).off("keydown.focus-control")}(e,a)})}else n(a);break}}}catch(t){e.app&&e.app.trace.debug("Could not focus: "+t)}}},t.focusOnMap=function(e){if(e){var t=function(e){var t=e.root;$(t).find("svg").attr("focusable","false"),t.tabIndex=0,n(t)};if(e.loaded)t(e);else var o=e.on("load",function(e){o.remove(),t(e.map)})}},t.focus=n})}}});require({cache:{"geocortex/infrastructure/FormatUtils":function(){define(["require","exports","./TimeZoneUtils","geocortex/framework/index","./NumberFormat"],function(r,e,t,i,a){"use strict";function n(r,e,t){void 0===e&&(e=l.DEFAULT);var i=null;if(!r||!r.getTime||isNaN(r.getTime()))return"";if(!moment)throw new Error('Error: The "moment.js" library is required for formatting dates.');var a=o(r,t);if(t){var n=moment(r.toISOString());t.displayTimeZoneId&&(i=n.tz(t.displayTimeZoneId).format("Z"))}return moment(a).format(c(e,i))}function o(r,e){return e&&(e.timeZoneId||e.displayTimeZoneId)?e.displayTimeZoneId?e.timeZoneId?t.correctDatesForDisplayInDisplayTimeZone(r,e.timeZoneId,e.displayTimeZoneId):t.correctDatesForDisplayInDisplayTimeZone(r,t.UTC_ZONE_ID,e.displayTimeZoneId):t.correctDatesForDisplayInLocalTime(r,e.timeZoneId):r}function s(r,e,t){if(void 0===e&&(e=f.DEFAULT),void 0===t&&(t={}),null===r||void 0===r||isNaN(r))return"";if(e=e||f.DEFAULT,t=t||{},e===f.ROUND_TRIP)return r.toString();if(!_globalize)throw new Error('Error: The "globalize.js" library is required for formatting numbers.');var i=e.toLowerCase();i===f.CURRENCY||i===f.ACCOUNTING?(e=i,e+=void 0!==t.fractionalDigits?t.fractionalDigits:"",e+=t.currency?"$"+t.currency.toUpperCase():""):i!==f.NUMBER&&i!==f.FIXED_POINT&&i!==f.PERCENT||(e=i,e+=void 0!==t.fractionalDigits?t.fractionalDigits:"");var a=(_globalize.locale()?_globalize.locale().locale:"en")+"|"+e,n=T[a];if(!n){n=[];var o=e.split(";",3);1===o.length?(n[0]=u(o[0]),n[1]=n[0],n[2]=n[0]):2===o.length?(n[0]=u(o[0]),n[1]=u(o[1]),n[2]=n[0]):3===o.length&&(n[0]=u(o[0]),n[1]=u(o[1]),n[2]=u(o[2])),T[a]=n}return r>0?n[0](r):r<0?n[1](r):n[2](r)}function m(r,e,t){if(r instanceof Date)return r;if("number"==typeof r)return new Date(r);if(!r||"string"!=typeof r)return g;if((void 0===t||null===t)&&a.isNumeric(r))return new Date(parseFloat(r));if(!moment)throw new Error('Error: The "moment.js" library is required for parsing dates.');t=t||l.DEFAULT_PARSING_FORMATS;var i=[].concat(t);i=i.map(function(r){var e=c(r);return void 0===e?moment.ISO_8601:e});var n;return(n=e?moment.utc(r,i):moment(r,i)).isValid()?n.toDate():g}function c(r,e){var t=(r=r||l.DEFAULT)+(e||"");switch(r){case l.DATE_SHORT:return"L";case l.DATE_LONG:return"LL";case l.TIME_SHORT:return"LT";case l.TIME_LONG:return"LTS";case l.DATE_TIME_SHORT:return"lll";case l.DATE_TIME_LONG:return"LLL";case l.FULL:return"LLLL";case l.ISO_8601:return;default:var i=N[t];if(i)return i;var a=/%?([dfFghHKmMstyz])\1*|\\.|(["'])[^\2]+\2|[^dfFghHKmMstyz\\'"]+/g,n=r.match(a);i="";for(var o=0;o<n.length;o++){var s=n[o];switch(s.startsWith("%")&&(s=s.slice(1)),s[0]){case"y":s.length<=2?i+="YY":s.length<=4?i+="YYYY":i+="YYYYY";break;case"d":s.length<=2?i+=s.slice(0,2).toUpperCase():i+=s.slice(0,4);break;case"f":case"F":i+=s.slice(0,3).replace(/[Ff]/g,"S");break;case"t":i+="A";break;case"z":i+=e?"["+e+"]":"Z";break;case"M":i+=s.slice(0,4);break;case"h":case"H":case"m":case"s":i+=s.slice(0,2);break;case"g":case"K":console.warn('The "{0}" date format specifier is not supported.'.format(s));break;default:s.startsWith('"')||s.startsWith("'")?s=s.slice(1,-1):s.startsWith("\\")&&(s=s.slice(1)),i+="["+s+"]"}}return N[t]=i,i}}function u(r,e){var t=e||{},a=/^([acfnp])(\d*)(?:\$([a-zA-Z]{3}))?$/i;if(u=r.match(a)){var n=u[1].toLowerCase(),o=Math.min(20,parseInt(u[2])),s=u[3];if(n===f.CURRENCY||n===f.ACCOUNTING){if(!s){var m=i.applications[0];s=m&&m.configuration&&m.configuration.defaultCurrency?m.configuration.defaultCurrency:"USD"}}else s="",void 0===t.minimumFractionDigits&&(t.minimumFractionDigits=0),void 0===t.maximumFractionDigits&&(t.maximumFractionDigits=Math.max(4,t.minimumFractionDigits));return n===f.PERCENT?t.style="percent":n===f.ACCOUNTING?t.style="accounting":n===f.FIXED_POINT&&(t.useGrouping=!1),isNaN(o)||(t.minimumFractionDigits=o,t.maximumFractionDigits=o),s?_globalize.currencyFormatter(s,t):_globalize.numberFormatter(t)}var c=/[0#]+|\.|,|%|\\.|(["'])[^\1]+\1|[^0#.,\\'"]+/g,u=r.match(c),l=!1,g="",T="",D="",N="";t.minimumFractionDigits=0,t.maximumFractionDigits=0,t.useGrouping=!1;for(var d=0;d<u.length;d++){var E=u[d];switch(E[0]){case".":l=!0;break;case",":t.useGrouping=!0;break;case"%":t.style="percent";break;case"0":case"#":l?T+=E:g+=E;break;default:E.startsWith('"')||E.startsWith("'")?E=E.slice(1,-1):E.startsWith("\\")&&(E=E.slice(1)),g||T?N+=E:D+=E}}if(g){var _=g.indexOf("0");_>=0&&(t.minimumIntegerDigits=g.length-_)}if(T){var I=T.lastIndexOf("0");t.minimumFractionDigits=I>=0?I+1:0,t.maximumFractionDigits=Math.min(20,T.length)}if(g||T){var v=_globalize.numberFormatter(t);return function(r){return void 0!==t.minimumIntegerDigits&&r<0?D+"-"+v(-1*r)+N:D+v(r)+N}}return function(r){return D+N}}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){return function(){}}();l.DATE_SHORT="d",l.DATE_LONG="D",l.TIME_SHORT="t",l.TIME_LONG="T",l.DATE_TIME_SHORT="g",l.DATE_TIME_LONG="G",l.FULL="f",l.ISO_8601="u",l.ROUND_TRIP="u",l.DEFAULT="g",l.DEFAULT_PARSING_FORMATS=[l.ISO_8601,l.DATE_TIME_SHORT,l.DATE_TIME_LONG,l.DATE_SHORT,l.DATE_LONG],e.DateFormat=l;var f=function(){return function(){}}();f.NUMBER="n",f.FIXED_POINT="f",f.CURRENCY="c",f.ACCOUNTING="a",f.PERCENT="p",f.ROUND_TRIP="r",f.DEFAULT=f.FIXED_POINT,e.NumberFormat=f;var g=new Date(NaN);e.format=function(r){return r instanceof Date?n(r):"number"==typeof r?s(r):null===r||void 0===r?"":r.toString()},e.formatDate=n,e.formatDateFromNow=function(r,e){if(!r||!r.getTime||isNaN(r.getTime()))return"";if(!moment)throw new Error('Error: The "moment.js" library is required for formatting dates.');var t=o(r,e);return moment(t).fromNow()},e.formatNumber=s,e.parseDate=function(r,e){return m(r,!1,e)},e.parseUtcDate=function(r,e){return m(r,!0,e)},e.parseNumber=function(r,e){if("number"==typeof r)return r;if("boolean"==typeof r)return r?1:0;if(null===r||void 0===r)return NaN;if(!_globalize)throw new Error('Error: The "globalize.js" library is required for parsing numbers.');r=r.toString().trim(),r=r.replace(" "," ");var t=_globalize.locale()?_globalize.locale().locale:"en",i=D[t];i||(i=_globalize.numberParser(),D[t]=i);var a=1;r&&"("===r[0]&&")"===r[r.length-1]&&(a=-1,r=r.slice(1,-1));var n=i(r);if(isNaN(n)&&(n=parseFloat(r)),isNaN(n))return n;n*=a;var o=[].concat(e||[]),s=/^([acfnp])(?:\$([a-zA-Z]{3}))?$/i;return!o.length||o.some(function(e){if(i=u(e,{minimumFractionDigits:0,maximumFractionDigits:20}),r===i(n))return!0;if(e.match(s))for(var t=0;t<=20;t++){var i=u(e,{minimumFractionDigits:t,maximumFractionDigits:t});if(r===i(n))return!0}return!1})?n:NaN};var T={},D={},N={}})}}});require({cache:{"geocortex/infrastructure/GeometryUtils":function(){define(["require","exports","geocortex/framework/utils/utils","geocortex/essentials/GeometryUtilities","geocortex/essentials/RestHelperHTTPService","./buffer/BufferUtils"],function(e,r,t,n,i,o){"use strict";function a(e){var r=t.isNullOrUndefined;if(r(e))return!1;switch(e.type){case"point":var n=e;return!r(n.x)&&!r(n.y);case"multipoint":var i=e.points;return i&&i.length>0;case"polyline":var o=e.paths;return o&&o.length>0;case"polygon":var a=e.rings;return a&&a.length>0;case"extent":var s=e;return!(r(s.xmin)||r(s.xmax)||r(s.ymin)||r(s.ymax));default:return!1}}function s(e,r){var t=r.x-e.x,n=r.y-e.y;return Math.sqrt(t*t+n*n)}function c(e){if(!e||!e.configuration)return null;if(y&&y.url&&y.url.startsWith(e.configuration.geometryServiceUrl))return y;var r=e.configuration.geometryServiceUrl,t=e.configuration.geometryServiceToken;if(t){r=i.RestHelperHTTPService.appendTokenToUrl(r,t);var n=dojo.subscribe("ServiceTokenRefreshed",function(r){r.serviceUrl===e.configuration.geometryServiceUrl&&(e.configuration.geometryServiceToken=r.token,y=null,h=null,dojo.unsubscribe(n))})}return"https:"!=window.location.protocol||/^(https|\/\/)/.test(r)||e.trace.warning("Mixed Content Warning: This Viewer was loaded over HTTPS but the geometry service was loaded over HTTP. This may limit functionality. Please configure the geometry service to be served securely."),y=new esri.tasks.GeometryService(r)}function l(e,r,t,i){if(e&&(!esri.tasks.hasOwnProperty("ProjectParameters")||e instanceof esri.tasks.ProjectParameters)&&e.hasOwnProperty("outSR")&&e.hasOwnProperty("geometries")){if(r&&dojo.isFunction(r)){if(e.outSR){var o=e.geometries,a=!1;if(o&&o.length>0&&(n.spatialRefsAreEqual(o[0].spatialReference,e.outSR,!1)||(a=!0)),a){var s=this._getGeometryService(i);if(e.outSR.isWebMercator()&&4326===o[0].spatialReference.wkid||4326===e.outSR.wkid&&o[0].spatialReference.isWebMercator())return void this._projectLocally(e.geometries,e.outSR,r,t);if(!s){if(t&&dojo.isFunction(t)){l="Unable to get the geometry service. Make sure a geometry service url is configured in the application.";t(new Error(l))}return}var c=f(o[0].spatialReference,e.outSR);c&&!e.transformation&&(e.transformation=c.transformation,e.transformForward=c.transformForward),esri.tasks.hasOwnProperty("ProjectParameters")?s.project(e,r,t):s.project(e.geometries,e.outSR,r,t)}else r(o)}else if(t&&dojo.isFunction(t)){l="output spatial reference is required.";t(new Error(l))}}else if(t&&dojo.isFunction(t)){l="callback required.";t(new Error(l))}}else if(t&&dojo.isFunction(t)){var l="projectParameters required.";t(new Error(l))}}function u(e){e.forEach(function(e){var r=null;e.fromWkid&&e.fromWkid>0?r=new esri.SpatialReference(e.fromWkid):e.fromWkt&&(r=new esri.SpatialReference(e.fromWkt));var t=null;e.toWkid&&e.toWkid>0?t=new esri.SpatialReference(e.toWkid):e.toWkt&&(t=new esri.SpatialReference(e.toWkt));var n=null;if(e.transformWkid&&e.transformWkid>0?n=new esri.SpatialReference(e.transformWkid):e.transformWkt&&(n=new esri.SpatialReference(e.transformWkt)),!r||!t||!n)throw new Error("Invalid or missing spatial reference. Cannot register datum transform.");p.push({fromSR:r,toSR:t,transformation:n})})}function f(e,r){if(!e||!r||0==p.length)return null;for(var t=0;t<p.length;t++){var i=p[t];if(n.spatialRefsAreEqual(e,i.fromSR)&&n.spatialRefsAreEqual(r,i.toSR))return{transformation:i.transformation,transformForward:!0};if(n.spatialRefsAreEqual(e,i.toSR)&&n.spatialRefsAreEqual(r,i.fromSR))return{transformation:i.transformation,transformForward:!1}}return null}function g(e,r){if(e.length<3)return e;for(var t=1,n=0,i=1;i<e.length-1;i++){var o=m(e[i],e[0],e[e.length-1]);o>n&&(n=o,t=i)}if(n>r){var a=g(e.slice(0,t+1),r),s=g(e.slice(t),r);return a.slice(0,a.length-1).concat(s)}return[e[0],e[e.length-1]]}function m(e,r,t){var n,i,o;return r[0]===t[0]?n=Math.abs(e[0]-r[0]):(i=(t[1]-r[1])/(t[0]-r[0]),o=r[1]-i*r[0],n=Math.abs(i*e[0]-e[1]+o)/Math.sqrt(Math.pow(i,2)+1)),n}Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_GEOMETRY_SERVICE_URI="http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/Geometry/GeometryServer";var p=[],y=null,h=null;r.isValidGeometry=a,r.getMiddle=function(e){if(!e||!e.type||!a(e))return null;var r;if("point"==e.type)return e;if("multipoint"==e.type)return(r=e.getExtent())?r.getCenter():null;if("polyline"==e.type){for(var t=e,n=0,i=0;i<t.paths.length;i++)for(var o=0;o<t.paths[i].length-1;o++)n+=s(l=new esri.geometry.Point(t.paths[i][o]),u=new esri.geometry.Point(t.paths[i][o+1]));var c=0;for(i=0;i<t.paths.length;i++)for(o=0;o<t.paths[i].length-1;o++){var l=new esri.geometry.Point(t.paths[i][o]),u=new esri.geometry.Point(t.paths[i][o+1]),f=s(l,u);if(c+f>n/2){var g=f/(n/2-c),m=(u.x-l.x)/g,p=(u.y-l.y)/g;return new esri.geometry.Point(l.x+m,l.y+p,e.spatialReference)}c+=f}}else{if("polygon"==e.type)return(r=e.getExtent())?r.getCenter():null;if("extent"==e.type)return e.getCenter()}return null},r.getMidpoint=function(e,r){if(!e||!r)throw new Error("The beginning and ending points are required.");return new esri.geometry.Point({x:(e.x+r.x)/2,y:(e.y+r.y)/2,spatialReference:e.spatialReference.toJson()})},r.getEsriGeometryType=function(e,r){if(!e)return null;var t=null;switch(e.toLowerCase()){case"rectangle":t=esri.toolbars.Draw.EXTENT;break;case"freehandpolygon":t=esri.toolbars.Draw.FREEHAND_POLYGON;break;case"freehandpolyline":t=esri.toolbars.Draw.FREEHAND_POLYLINE;break;case"mappoint":t=esri.toolbars.Draw.POINT;break;case"multipoint":t=esri.toolbars.Draw.MULTI_POINT;break;case"polygon":t=esri.toolbars.Draw.POLYGON;break;case"polyline":t=esri.toolbars.Draw.POLYLINE;break;default:t=r||esri.toolbars.Draw.EXTENT}return t},r._getGeometryService=function(e){return c(e)},r.getGeometryService=c,r.getGeometryServiceArcGisVersion=function(e,r){return new Promise(function(t,n){if(null!==h)return t(h);if(!e||!e.configuration)return t(null);var o=r||e.configuration.geometryServiceUrl;if(!r){var a=e.configuration.geometryServiceToken;a&&(o=i.RestHelperHTTPService.appendTokenToUrl(o,a))}if(!o)return t(null);var s=o.indexOf("/rest/services/");if(s>-1){var c=o.slice(0,s+"/rest/services/".length);try{var l={url:c+"?f=json",handleAs:"json"};esri&&!esri.config.defaults.io.proxyUri&&e.configuration.proxyUri&&(esri.config.defaults.io.proxyUrl=e.configuration.proxyUri);var u=esri.config.defaults.io.httpsDomains;esri.config.defaults.io.httpsDomains=[],esri.request(l).then(function(e){e&&e.currentVersion&&(h=parseFloat(e.currentVersion)),t(h)},function(e){t(null)}),esri.config.defaults.io.httpsDomains=u}catch(e){t(null)}}else t(null)})},r.needsProjection=function(e,r){return!n.spatialRefsAreEqual(e.spatialReference,r.map.spatialReference,!1)},r.projectGeometry=function(e,r,t,n,i){if(e&&e.spatialReference)if(e.spatialReference.equals(r))t&&t(e);else{var o=new esri.tasks.ProjectParameters;o.outSR=r,o.geometries=[e],this.project(o,function(e){e&&e.length>0&&t&&t(e[0])},n,i)}else n&&n(new Error("Invalid geometry or spatial reference."))},r.projectGeometryWithTransform=function(e,r,t,n,i,o){if(t)if(e&&e.spatialReference)if(e.spatialReference.equals(r))n&&n(e);else{var a=new esri.tasks.ProjectParameters;a.outSR=r,a.geometries=[e],a.transformation={wkid:t},this.project(a,function(e){e&&e.length>0&&n&&n(e[0])},i,o)}else i&&i(new Error("Invalid geometry or spatial reference."));else this.projectGeometry(e,r,n,i)},r.project=l,r.simplifyPolygons=function(e,r,t,n){this._getGeometryService(n).simplify(e,r,t)},r.simplifyPolygon=function(e,r,t,n){this.simplifyPolygons([e],function(e){e&&e.length>0?r(e[0]):t()},t,n)},r._projectLocally=function(e,r,t,n){for(var i=[],o=0;o<e.length;o++)e[o].spatialReference.isWebMercator()&&4326===r.wkid?i[o]=esri.geometry.webMercatorToGeographic(e[o]):4326===e[o].spatialReference.wkid&&r.isWebMercator()?i[o]=esri.geometry.geographicToWebMercator(e[o]):(n&&dojo.isFunction(n)&&n(new Error("Unable to get the geometry service. Make sure a geometry service url is configured in the application.")),this.app.trace.error("An operation requiring projection attempted to project while offline, but was not between WebMercator and WGS84"));t(i)},r.createCircle=function(e,r,t,n){var i=[],o=null,a=n||40,s=new esri.geometry.Polygon(e);o=360/a;for(var c=1;c<=a;c++){var l=c*o*Math.PI/180;i.push([r.x+t*Math.cos(l),r.y+t*Math.sin(l)])}return i.push(i[0]),s.addRing(i),s},r.fixAspectRatio=function(e,r){var t=r.getWidth()/r.getHeight(),n=e.getWidth()/e.getHeight(),i=e.getWidth(),o=e.getHeight();n<t?i=t*o:o=1/t*i;var a=e.getCenter();return new esri.geometry.Extent(a.x-i/2,a.y-o/2,a.x+i/2,a.y+o/2,e.spatialReference)},r.extentToPolygon=function(e){var r=new esri.geometry.Polygon(e.spatialReference),t=new Array;return t.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),t.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y+e.getHeight()/2)),t.push(new esri.geometry.Point(e.getCenter().x+e.getWidth()/2,e.getCenter().y+e.getHeight()/2)),t.push(new esri.geometry.Point(e.getCenter().x+e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),t.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),r.addRing(t),r},r.pointsAreEqual=function(e,r){return!(e&&!r||!e&&r||e&&(e.x!==r.x||e.y!==r.y||!e.spatialReference&&r.spatialReference||e.spatialReference&&!r.spatialReference||!e.spatialReference.equals(r.spatialReference)))},r.registerDefaultDatumTransforms=function(){var e=[];e.push({transformWkid:108457,fromWkid:28992,toWkid:4326}),e.push({transformWkid:1195,fromWkid:27700,toWkid:4326}),e.push({transformWkid:1623,fromWkid:102067,toWkid:4326}),u(e)},r.registerDatumTransforms=u,r.getDatumTransformParameters=f,r.intersects=function(r,t){return new Promise(function(n,i){e(["esri/geometry/geometryEngine"],function(e){try{n(e.intersects(r,t))}catch(e){i(e)}})})},r.unionGeometries=function(r){return new Promise(function(t,n){e(["esri/geometry/geometryEngine"],function(e){try{t(e.union(r))}catch(e){n(e)}})})},r.convertMetersToMapPoints=function(r,t){var n=this;return new Promise(function(i,a){e(["esri/geometry/geometryEngine"],function(e){var s=new esri.SpatialReference(r.spatialReference.toJson()),c=r.units;try{if(c&&!c.isLinear()||s.wkid&&o.isGeographicWkid(s.wkid))i(t/111319.4907932738);else{var u=new esri.geometry.Point(0,0,s),f=new esri.geometry.Point(0,100,s),g=new esri.tasks.ProjectParameters;g.geometries=[u,f],g.outSR=new esri.SpatialReference(102100),l(g,function(r){var n=e.distance(r[0],r[1],"meters");i(100/n*t)},function(e){return a(e)},n.app)}}catch(e){a(e)}})})},r.explodeGeometry=function(e){switch(e.type){case"polygon":return e.rings.map(function(r){return new esri.geometry.Polygon(r).setSpatialReference(e.spatialReference)});case"polyline":return e.paths.map(function(r){return new esri.geometry.Polyline(r).setSpatialReference(e.spatialReference)});case"multipoint":return e.points.map(function(r){return new esri.geometry.Point(r,e.spatialReference)})}return[e]},r.cutGeometries=function(e,r,t){var n=this;return new Promise(function(i,o){var a=n.getGeometryService(t);if(!a)return Promise.reject(new Error("Unable to get the geometry service. Make sure a geometry service url is configured in the application."));try{a.cut(e,r).then(function(e){for(var r=[],t=0;t<e.geometries.length;t++){var n=e.cutIndexes[t];r[n]||(r[n]=[]),r[n].push(e.geometries[t])}i(r)})}catch(e){o(e)}})},r.toRing=function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]},r.createToleranceEnvelope=function(e,r,t){if(r&&"point"===r.type){var n=t*(e.extent.getWidth()/e.width),i=r;return new esri.geometry.Extent(i.x-n,i.y-n,i.x+n,i.y+n,e.spatialReference)}return r},r.getRamerDouglasPeuckerSimplifiedGeometry=function(e,r){var t=function(r,t){return void 0===r&&(r=!1),void 0===t&&(t=""),r&&console.log("An error occurred during the Ramer Douglas Pecker geometry simplification process."+t+". Using original geometry. This may have performance implications."),esri.geometry.fromJson(e.toJson())};if(!(e instanceof esri.geometry.Polygon||e instanceof esri.geometry.Polyline))return t();try{for(var n=[],i=e.rings||e.paths,o=0;o<i.length;o++)n.push(g(i[o],r));if(e instanceof esri.geometry.Polygon){var s=new esri.geometry.Polygon(e.spatialReference);return n.forEach(function(e){return s.addRing(e)}),a(s)?s:t(!0)}var c=new esri.geometry.Polyline(e.spatialReference);return n.forEach(function(e){return c.addPath(e)}),a(c)?c:t(!0)}catch(e){return t(!0,e.message)}}})}}});require({cache:{"geocortex/infrastructure/gis/AppInfo":function(){define(["require","exports","./MapInfo","./../GeometryUtils"],function(e,r,i,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(){}return e.fromGeocortexApp=function(r){var a=new e;return a.gcxApp=r,a.urlParameters=r.urlParameters,r.isArcGisWebApp?a.mapInfo=i.MapInfo.fromEsriMap(r.map):(a.essentialsVersion=r.site.getEssentialsVersion(),a.mapInfo=i.MapInfo.fromViewerApp(r)),a.map=a.mapInfo.map,a},e.prototype.getGeometryService=function(){return this._geometryService?this._geometryService:this.geometryServiceUrl?(this._geometryService=new esri.tasks.GeometryService(this.geometryServiceUrl),this._geometryService):this.gcxApp?a.getGeometryService(this.gcxApp):null},e}();r.AppInfo=s})},"geocortex/infrastructure/gis/DatumTransform":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/gis/DomainInfo":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.create=function(r){var i=new e;return i.domain=r,i},e.prototype.isCodedValueDomain=function(){return this.domain&&"codedValue"==this.domain.type},e.prototype.getCodedValueDomain=function(){return this.domain},e.prototype.getName=function(e){if(this.isCodedValueDomain())for(var r=0;r<this.getCodedValueDomain().codedValues.length;r++){var i=this.getCodedValueDomain().codedValues[r];if(i.code+""==e+"")return i.name}return null},e}();r.DomainInfo=i})},"geocortex/infrastructure/gis/FieldInfo":function(){define(["require","exports","./DomainInfo","geocortex/essentials/Field","./../TimeZoneUtils","./../FormatUtils"],function(e,r,i,a,s,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){this.subtypeDomains={},this.subtypeDomainInfos={},this.isVisible=!0}return e.fromEsriField=function(r,a,t){var n=new e;if(n.name=r.name,n.type=r.type,n.alias=t?t.displayName||r.alias:r.alias,n.isVisible=!t||t.visible,n.searchable=!t||t.searchable,n.editable=r.editable,n.nullable=r.nullable,n.length=r.length,n.esriField=r,n.isTypeField=a&&a.typeIdField===r.name,a){if(n.isTypeField&&!r.domain){var o=new esri.layers.CodedValueDomain;o.codedValues=[],o.type="codedValue",a.types.forEach(function(e){o.codedValues.push({name:e.name,code:e.id})}),n.domainInfo=i.DomainInfo.create(o),n.domain=o}else n.domainInfo=i.DomainInfo.create(r.domain),n.domain=r.domain;a.types&&a.types.forEach(function(e){for(var a in e.domains)if(e.domains.hasOwnProperty(a)&&a===r.name&&null!==e.id){var s=e.domains[a];n.subtypeDomains[e.id.toString()]=s,n.subtypeDomainInfos[e.id.toString()]=i.DomainInfo.create(s);break}})}if(t){if(n.format=t.format,!n.format)if(n._isNumericFormat()){var y=[t.layer.defaultNumberFormat,t.layer.mapService.defaultNumberFormat].filter(function(e){return!!e})[0];y&&(n.format="{0:"+y+"}")}else if(n.isDate()){var c=[t.layer.defaultDateFormat,t.layer.mapService.defaultDateFormat].filter(function(e){return!!e})[0];c&&(n.format="{0:"+c+"}")}n.timeZoneId||(n.timeZoneId=s.getTimeZoneFromLayer(t.layer)),n.displayTimeZoneId||(n.displayTimeZoneId=s.getDisplayTimeZoneFromMapService(t.layer.mapService))}return n},e.fromGcxField=function(r){var i=new esri.layers.Field;new e;return i.name=r.name,i.type=a.Field.convertToEsriFieldType(r.dataType),i.alias=r.displayName,i.editable=!1,i.nullable=!0,e.fromEsriField(i,null,r)},e.prototype.isNumeric=function(){var e=[a.EsriFieldTypes.esriFieldTypeOID,a.EsriFieldTypes.esriFieldTypeSmallInteger,a.EsriFieldTypes.esriFieldTypeInteger,a.EsriFieldTypes.esriFieldTypeSingle,a.EsriFieldTypes.esriFieldTypeDouble];return dojo.indexOf(e,this.type)>=0},e.prototype.isDate=function(){var e=[a.EsriFieldTypes.esriFieldTypeDate];return dojo.indexOf(e,this.type)>=0},e.prototype.isText=function(){var e=[a.EsriFieldTypes.esriFieldTypeString];return dojo.indexOf(e,this.type)>=0},e.prototype.isCodedValueDomain=function(){return this.domainInfo&&this.domainInfo.isCodedValueDomain()},e.prototype.hasSubtypeCodedValueDomains=function(){for(var e in this.subtypeDomainInfos)if(this.subtypeDomainInfos.hasOwnProperty(e)&&this.subtypeDomainInfos[e].isCodedValueDomain())return!0;return!1},e.prototype.getCodedValueDomain=function(){return this.domain},e.prototype.getSubtypeCodedValueDomains=function(){var e={};for(var r in this.subtypeDomainInfos)this.subtypeDomainInfos.hasOwnProperty(r)&&this.subtypeDomainInfos[r].isCodedValueDomain()&&(e[r]=this.subtypeDomainInfos[r].domain);return e},e.prototype.resolveCodedDomainValue=function(e,r){var i=null;if(this.domainInfo&&(i=this.domainInfo.getName(e)),null==i){var a=this.subtypeDomainInfos[r];a&&(i=a.getName(e))}return i},e.prototype.formatValue=function(e,r){var i=this;if(this.isCodedValueDomain()||this.hasSubtypeCodedValueDomains()){var a=this.resolveCodedDomainValue(e,r);if(null!=a)return a}if(this.format)return this.format.replace(/\{0(?::([^}]*))?\}/,function(r,a){if(i.isDate()){var s={timeZoneId:i.timeZoneId,displayTimeZoneId:i.displayTimeZoneId};return t.formatDate(t.parseDate(e),a,s)}return i._isNumericFormat()?t.formatNumber(t.parseNumber(e),a):null===e||void 0===e?e:e.toString()});if(this.isDate()){var s={timeZoneId:this.timeZoneId,displayTimeZoneId:this.displayTimeZoneId};return t.formatDate(t.parseDate(e),null,s)}return this._isNumericFormat()?t.formatNumber(t.parseNumber(e)):null===e||void 0===e?e:e.toString()},e.prototype._isNumericFormat=function(){return this.isNumeric()&&this.type!==a.EsriFieldTypes.esriFieldTypeOID&&(!this.name||"OBJECTID"!==this.name.toUpperCase())},e}();r.FieldInfo=n})},"geocortex/infrastructure/gis/GisUtils":function(){define(["require","exports","geocortex/essentials/MapServiceConstants"],function(e,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getServiceLayerType=function(e){return e instanceof esri.layers.DynamicMapServiceLayer?e instanceof esri.layers.ArcGISDynamicMapServiceLayer?i.MapServiceType.DYNAMIC:e instanceof esri.layers.ArcGISImageServiceLayer?i.MapServiceType.IMAGE:e instanceof esri.layers.WMSLayer?i.MapServiceType.WMS:i.MapServiceType.DYNAMIC:e instanceof esri.layers.TiledMapServiceLayer?e instanceof esri.layers.WMTSLayer?i.MapServiceType.WMTS:e instanceof esri.layers.WebTiledLayer?i.MapServiceType.WEBTILED:e instanceof esri.virtualearth.VETiledLayer?i.MapServiceType.BING:i.MapServiceType.TILED:e instanceof esri.layers.GraphicsLayer?e instanceof esri.layers.FeatureLayer?esri.layers.StreamLayer&&e instanceof esri.layers.StreamLayer?i.MapServiceType.STREAM:e instanceof esri.layers.CSVLayer?i.MapServiceType.CSV:i.MapServiceType.FEATURE:esri.layers.LabelLayer&&e instanceof esri.layers.LabelLayer?i.MapServiceType.LABEL:e instanceof esri.layers.WFSLayer?i.MapServiceType.WFS:i.MapServiceType.GRAPHICS:e instanceof esri.layers.GeoRSSLayer?i.MapServiceType.GEORSS:e instanceof esri.layers.KMLLayer?i.MapServiceType.KML:e instanceof esri.layers.MapImageLayer?i.MapServiceType.MAPIMAGE:i.MapServiceType.UNKNOWN}})},"geocortex/infrastructure/gis/LayerInfo":function(){define(["require","exports","./FieldInfo","geocortex/essentials/utilities/DecomposedUri","geocortex/essentials/MapServiceConstants","geocortex/essentials/Field","../ArrayUtils"],function(e,r,i,a,s,t,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(){this.fields=new Array,this.isUserCreated=!1,this.includeInLayerList=!0,this.isExpanded=!0,this._visible=!1,this._fieldsRetrieved=!1}return e.fromEsriLayerInfo=function(r,i){var s=new e;return s.esriLayerInfo=r,s.id=r.id+"",s.name=r.name,s.displayName=r.name,s.parentLayerId=r.parentLayerId?r.parentLayerId.toString():null,s.subLayerIds=r.subLayerIds?dojo.map(r.subLayerIds,function(e){return e.toString()}):null,s.uniqueId=i.id.replace(".","..")+"."+r.id,s.url=a.DecomposedUri.appendToPath(i.url,"/"+r.id),s.queryable=!0,s.dataProvider="Default",s._visible=r.defaultVisibility,s},e.fromEsriFeatureLayer=function(r){var i=new e;return i.id=r.id+"",i.name=r.name,i.displayName=r.name,i.uniqueId=r.id,i.url=r.url,i.queryable=!0,i.dataProvider="Default",i._featureLayer=r,i._visible=r.defaultVisibility,i.subLayerIds=null,i.parentLayerId=null,i.relationships=r.relationships,i},e.fromGcxLayer=function(r){var i=new e;return i.gcxLayer=r,i.id=r.id,i.name=r.name,i.displayName=r.displayName||r.name,i.uniqueId=r.mapService.id+"."+r.id,i.dataProvider=r.dataProvider||"Default",i.isExpanded=r.isExpanded,i.isUserCreated=r.isUserCreated,i.relationships=r.relationships,r.mapService.drawingBehavior==s.DrawingBehavior.FEATURE_LAYER?i.url=r.mapService.serviceLayer.url:r.mapService.mapServiceType==s.MapServiceType.DYNAMIC||r.mapService.mapServiceType==s.MapServiceType.TILED?i.url=a.DecomposedUri.appendToPath(r.mapService.serviceLayer.url,"/"+r.id):(r.mapService.serviceLayer instanceof esri.layers.WMSLayer||r.mapService.serviceLayer instanceof esri.layers.WFSLayer)&&(i.url=r.url),r.parentLayerId&&(i.parentLayerId=r.parentLayerId),i.subLayerIds=r.subLayerIds?r.subLayerIds:null,i.includeInLayerList=r.includeInLayerList,i.queryable=r.queryable&&r.fields.length>0&&r.supportsQuery,i._visible=r.configuredVisible,i},e.prototype.getUrlWithoutParameters=function(){var e=this.url.indexOf("?");return e>=0?this.url.substr(0,e):this.url},e.prototype.getFields=function(){var e=this,r=new dojo.Deferred;return this._fieldsRetrieved?r.resolve(this.fields):this.getInitializedFeatureLayer().then(function(a){for(var s=0;s<a.fields.length;s++){var t=a.fields[s],n=e.gcxLayer?e.gcxLayer.getFieldByName(t.name):null,o=i.FieldInfo.fromEsriField(t,a,n);e.fields.push(o)}e._fieldsRetrieved=!0,r.isCanceled()||r.resolve(e.fields)},function(e){r.errback(e)}),r},e.prototype.getInitializedFeatureLayer=function(){var e=this;return this.gcxLayer?this.gcxLayer.getFeatureLayer():new Promise(function(r,i){if(e._featureLayer||(e._featureLayer=new esri.layers.FeatureLayer(e.url)),e._featureLayer.loaded)return r(e._featureLayer);if(e._featureLayer.__attached_error)return i(e._featureLayer.__attached_error);var a=e._featureLayer.on("load",function(){if(a.remove(),s.remove(),e.gcxLayer.wmsLayerName||e.gcxLayer.wfsLayerName)for(var i=e.gcxLayer.fields,n=e._featureLayer.fields.length-1;n>=0;n--){var o=e._featureLayer.fields[n];"gml:id"===o.name&&e._featureLayer.fields.splice(n,1),o.type=t.Field.convertToEsriFieldType(i[n].dataType)}return r(e._featureLayer)}),s=e._featureLayer.on("error",function(r){return a.remove(),s.remove(),e._featureLayer.__attached_error=r,i(r)})})},e.prototype.setDefinitionExpression=function(e){var r=this.serviceLayerInfo.serviceLayer;if(r instanceof esri.layers.ArcGISDynamicMapServiceLayer){var i=r,a=i.layerDefinitions||[];e&&"1 = 1"!=e?a[parseInt(this.id)]=e:delete a[parseInt(this.id)],i.setLayerDefinitions(a)}else if(r instanceof esri.layers.FeatureLayer){var s=r;e&&"1 = 1"!=e?s.setDefinitionExpression(e):s.setDefinitionExpression(null)}},e.prototype.getDefinitionExpression=function(){var e=this.serviceLayerInfo.serviceLayer;return e instanceof esri.layers.ArcGISDynamicMapServiceLayer?(e.layerDefinitions||[])[parseInt(this.id)]:e instanceof esri.layers.FeatureLayer?e.getDefinitionExpression():null},e.prototype.isVisible=function(){return this.gcxLayer?this.gcxLayer.isVisible():this._visible},e.prototype.areAllAncestorsVisible=function(){for(var e=this.serviceLayerInfo.findLayerById(this.parentLayerId);null!==e&&void 0!==e;){if(!e.isVisible())return!1;e=this.serviceLayerInfo.findLayerById(e.parentLayerId)}return!0},e.prototype.setVisibility=function(e,r,i,a){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=150);var s=!1;i&&this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer&&(s=this.serviceLayerInfo.supportsLayerVisibility()),this.gcxLayer?this.gcxLayer.setVisibility(e,r||s):this.setEsriLayerVisibility(e,r||s),s&&this.serviceLayerInfo.refresh(a)},e.prototype.setEsriLayerVisibility=function(e,r){var i=this;if(void 0===r&&(r=!1),this._visible=e,e||this.serviceLayerInfo.serviceLayer.visible){var a,t,o={mapServiceId:this.serviceLayerInfo.id,layerId:this.id,visibility:e},y=this.serviceLayerInfo.serviceLayer;switch(this.serviceLayerInfo.serviceType){case s.MapServiceType.DYNAMIC:if(y instanceof esri.layers.FeatureLayer)e?y.show():y.hide(),dojo.publish("LayerVisibilityChange",[new Array(o)]);else{var c=this.serviceLayerInfo.serviceLayer.visibleLayers.slice(0).map(function(e){return e.toString()});if(c&&c.length||y.layerInfos&&y.layerInfos.length){1===c.length&&"-1"==c[0]&&c.pop();var l=n.ArrayUtils.findIndex(c,function(e){return e==i.id});if(e){if(-1!==l)return;if(this.subLayerIds&&this.subLayerIds.length)return;c.push(this.id)}else{if(-1===l)return;c.splice(l,1)}c.length||c.push("-1"),c.InternallyChangedLayer=o,this.serviceLayerInfo.serviceLayer.setVisibleLayers(c,r)}else y.setVisibility(e),dojo.publish("LayerVisibilityChange",[new Array(o)])}break;case s.MapServiceType.WMS:if(null!==y){var p=[];for(p.InternallyChangedLayer=o,a=0,t=0;t<this.serviceLayerInfo.layers.length;t++){var u=this.serviceLayerInfo.layers[t];if(u.isVisible()&&(null===u.subLayerIds||0===u.subLayerIds.length)&&u.areAllAncestorsVisible()){var f=u.gcxLayer?u.gcxLayer.wmsLayerName:u.serviceLayerInfo.serviceLayer.id;(this.gcxLayer&&this.gcxLayer.wmsLayerName===f||this.serviceLayerInfo.serviceLayer.id===f||null!==f&&""!==f)&&(p[a]=f,a++)}}r?(this.serviceLayerInfo.serviceLayer.visibleLayers=p.slice(0),dojo.publish("LayerVisibilityChange",[new Array(o)])):this.serviceLayerInfo.serviceLayer.setVisibleLayers(p)}break;case s.MapServiceType.FEATURE:case s.MapServiceType.GEORSS:case s.MapServiceType.KML:case s.MapServiceType.BING:case s.MapServiceType.TILED:case s.MapServiceType.WMTS:case s.MapServiceType.IMAGE:case s.MapServiceType.WEBTILED:case s.MapServiceType.WFS:if(null!==y){if(1!==this.serviceLayerInfo.layers.length)throw new Error("Visibility of individual layers cannot be set for this Map Service: {0}".format(this.displayName));e?y.show():y.hide(),dojo.publish("LayerVisibilityChange",[new Array(o)])}break;default:throw new Error("Cannot set layer visibility. Unknown MapService type.")}}},e.prototype.getMinScale=function(){var e;return e=this.gcxLayer?this.gcxLayer.minScale:this._featureLayer?this._featureLayer.minScale:this.esriLayerInfo.minScale,this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer.minScale?Math.min(e,this.serviceLayerInfo.serviceLayer.minScale):e},e.prototype.getMaxScale=function(){var e;return e=this.gcxLayer?this.gcxLayer.maxScale:this._featureLayer?this._featureLayer.maxScale:this.esriLayerInfo.maxScale,this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer.maxScale?Math.max(e,this.serviceLayerInfo.serviceLayer.maxScale):e},e}();r.LayerInfo=o})},"geocortex/infrastructure/gis/MapInfo":function(){define(["require","exports","./ServiceLayerInfo","geocortex/framework/observables"],function(e,r,i,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(){this.serviceLayers=[],this.markupLayer=new a.Observable}return e.fromEsriMap=function(r){var a=new e;a.map=r,a.markupLayer.set(r.graphics);for(var s=r.layerIds.concat(r.graphicsLayerIds),t=0;t<s.length;t++){var n=r.getLayer(s[t]),o=i.ServiceLayerInfo.fromEsriLayer(n);a.serviceLayers.push(o)}return a},e.fromViewerApp=function(r){var i=e.fromEssentialsMap(r.site.essentialsMap);return i.markupLayer.sync(r.markupLayer),i},e.fromEssentialsMap=function(r){var a=new e;a.gcxMap=r,a.map=r.getMap(),a.markupLayer.set(r.getMap().graphics);for(var s=0;s<r.mapServices.length;s++){var t=r.mapServices[s],n=i.ServiceLayerInfo.fromGcxMapService(t);a.serviceLayers.push(n)}return a},e.prototype.getLayerInfos=function(){for(var e=new Array,r=0;r<this.serviceLayers.length;r++)for(var i=this.serviceLayers[r].layers,a=0;a<i.length;a++)e.push(i[a]);return e},e.prototype.getTableInfos=function(){for(var e=new Array,r=0;r<this.serviceLayers.length;r++)for(var i=this.serviceLayers[r].tables,a=0;a<i.length;a++)e.push(i[a]);return e},e.prototype.getGraphicsLayers=function(){var e=new Array;e.push(this.map.graphics);for(var r=0;r<this.map.graphicsLayerIds.length;r++)e.push(this.map.getLayer(this.map.graphicsLayerIds[r]));return e},e.prototype.findMapServiceById=function(e){for(var r,i=null,a=0,s=this.serviceLayers.length;a<s;a++){var t=this.serviceLayers[a];if(null==i&&(i=!(!t||!t.gcxMapService)),(r=i?t.gcxMapService:t.serviceLayer)&&r.id===e)return t}return null},e}();r.MapInfo=s})},"geocortex/infrastructure/gis/ServiceLayerInfo":function(){define(["require","exports","./LayerInfo","./GisUtils","geocortex/essentials/LayerType","geocortex/essentials/MapServiceConstants"],function(e,r,i,a,s,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){this.layers=[],this.tables=[],this.isUserCreated=!1,this.includeInLayerList=!0,this.isExpanded=!0,this._delayedRefreshToken=null}return e.fromEsriLayer=function(r){var s=new e;if(s.serviceLayer=r,s.serviceType=a.getServiceLayerType(r),s.id=r.id,r instanceof esri.layers.ArcGISDynamicMapServiceLayer||r instanceof esri.layers.ArcGISTiledMapServiceLayer){var t=r;s.capabilities=t.capabilities.split(",");for(var n=0;n<t.layerInfos.length;n++){var o=t.layerInfos[n];(c=i.LayerInfo.fromEsriLayerInfo(o,r)).serviceLayerInfo=s,s.layers.push(c)}}else if(r instanceof esri.layers.FeatureLayer){var y=r;s.displayName=y.name,s.capabilities=y.capabilities.split(",");var c=i.LayerInfo.fromEsriFeatureLayer(y);c.serviceLayerInfo=s,"Table"===y.type?s.tables.push(c):s.layers.push(c)}return s},e.fromGcxMapService=function(r){var a=new e;a.gcxMapService=r,a.serviceType=r.mapServiceType,a.serviceLayerFunction=r.mapServiceFunction,a.serviceLayer=r.serviceLayer,a.id=r.id,a.isExpanded=r.isExpanded,a.isUserCreated=r.isUserCreated,a.includeInLayerList=r.includeInLayerList,a.displayName=r.displayName,r.serviceLayer.capabilities&&(a.capabilities=r.serviceLayer.capabilities.split(","));for(o=0;o<r.layers.length;o++){var t=r.layers[o],n=i.LayerInfo.fromGcxLayer(t);n.serviceLayerInfo=a,t.type===s.LayerType.TABLE_LAYER?a.tables.push(n):a.layers.push(n)}for(var o=0;o<r.tables.length;o++){var y=r.tables[o],c=i.LayerInfo.fromGcxLayer(y);c.serviceLayerInfo=a,a.tables.push(c)}return a},e.prototype.findLayerById=function(e){for(var r=0,i=this.layers.length;r<i;r++){var a=this.layers[r];if(e===a.id.toString())return a}return null},e.prototype.isVisible=function(){var e=!1;return this.serviceLayer&&"boolean"==typeof this.serviceLayer.visible&&(e=this.serviceLayer.visible),e},e.prototype.setVisibility=function(e){this.gcxMapService?this.gcxMapService.setVisibility(e):null!==this.serviceLayer&&this.serviceLayer.setVisibility(e)},e.prototype.opacity=function(){return this.gcxMapService?this.gcxMapService.opacity:this.serviceLayer?this.serviceLayer.opacity:null},e.prototype.setOpacity=function(e){this.gcxMapService?this.gcxMapService.setOpacity(e):this.serviceLayer&&((null==e||isNaN(e))&&(e=1),e=Math.min(1,Math.max(0,e)),this.serviceLayer.setOpacity(e))},e.prototype.refresh=function(e,r){var i=this,a=this.serviceLayer;if(a&&"function"==typeof a.refresh){var s=function(){if(i._delayedRefreshToken=null,!0===e&&"function"==typeof a.setDisableClientCaching){var e=a.disableClientCaching;a.setDisableClientCaching(!0),a.refresh(),a.setDisableClientCaching(e)}else a.refresh()};this._delayedRefreshToken&&clearTimeout(this._delayedRefreshToken),"number"!=typeof e?s():this._delayedRefreshToken=setTimeout(s,e)}},e.prototype.supportsLayerVisibility=function(){switch(this.serviceType){case t.MapServiceType.WMS:return!0;case t.MapServiceType.DYNAMIC:return null!==this.serviceLayer&&!!this.serviceLayer.visibleLayers;case t.MapServiceType.GRAPHICS:case t.MapServiceType.FEATURE:case t.MapServiceType.CSV:case t.MapServiceType.LABEL:case t.MapServiceType.STREAM:case t.MapServiceType.GEORSS:case t.MapServiceType.KML:case t.MapServiceType.BING:case t.MapServiceType.TILED:case t.MapServiceType.WMTS:case t.MapServiceType.WFS:case t.MapServiceType.IMAGE:case t.MapServiceType.WEBTILED:case t.MapServiceType.VECTORTILE:case t.MapServiceType.MAPIMAGE:case t.MapServiceType.UNKNOWN:default:return!1}},e.prototype.loaded=function(){var e=this;if(this._loadedDeferred)return this._loadedDeferred;if(this._loadedDeferred=new dojo.Deferred,this.serviceLayer.loaded)this._loadedDeferred.resolve(this.serviceLayer);else if(this.serviceLayer.loadError)this._loadedDeferred.resolve(this.serviceLayer.loadError);else var r=this.serviceLayer.on("load",function(){r.remove(),i.remove(),e._loadedDeferred.resolve(e.serviceLayer)}),i=this.serviceLayer.on("error",function(a){r.remove(),i.remove(),e._loadedDeferred.errback(a)});return this._loadedDeferred},e}();r.ServiceLayerInfo=n})}}});require({cache:{"geocortex/infrastructure/GraphicsLayerIds":function(){define(["require","exports"],function(_,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MARKUP_LAYER_ID="Drawings",e.COORDINATES_LAYER_ID=e.MARKUP_LAYER_ID+"_coordinates",e.MEASUREMENT_LAYER_ID=e.MARKUP_LAYER_ID+"_measurement",e.PUSHPINS_LAYER_ID="DefaultPushpinsLayer",e.HIGHLIGHT_LAYER_ID="DefaultHighlightLayer",e.COLLABORATION_LAYER_ID="__CollaborationGraphicsLayer",e.COLLABORATION_SCRATCH_LAYER_ID="CollaborationScratch",e.SNAPPING_GRAPHICS_LAYER_ID="snapping_graphics",e.SNAPPING_HELPER_GRAPHICS_LAYER_ID="snapping_helper_graphics",e.TEMP_SNAPPING_EDITOR_LAYER_ID="temp_snapping_graphics_editing",e.AOI_MASK_LAYER_ID="AreaOfInterestMask",e.EDITING_LAYER_ID="editing_layer",e.EDITOR_CLONE_LAYER_ID="editor_clone_layer",e.GEOLOCATION_LAYER_ID="geolocation_layer",e.VIEWPOINT_INDICATOR_GRAPHICS_LAYER_ID="viewpointIndicatorGraphicsLayer",e.INTEGRATION_GRAPHICS_LAYER_ID="integrationGraphicsLayer",e.MARKER_GRAPHICS_LAYER_ID="MarkerGraphicsLayer",e.TEMP_GRAPHICS_LAYER_ID="TemporaryMarkup",e.changeGraphicsLayerIdBase=function(_){e.MARKUP_LAYER_ID=_,e.COORDINATES_LAYER_ID=_+"_coordinates",e.MEASUREMENT_LAYER_ID=_+"_measurement"}})}}});require({cache:{"geocortex/infrastructure/GraphicsLayerUtils":function(){define(["require","exports","./ClusterLayer","geocortex/essentials/utilities/GraphicsLayerUtilities"],function(e,r,a,i){"use strict";function t(e,r,a,i){var t=a.map.getLayer(e);return!t&&r?($.isNumeric(i)||(i=a.map.graphicsLayerIds.length-y-l-u),(t=new esri.layers.GraphicsLayer).id=e,a.map.addLayer(t,i)):r=!1,{layer:t,create:r}}function s(e,r,a,i){var t=r.map.getLayer(e);return t||($.isNumeric(i)||(i=r.map.graphicsLayerIds.length-1),(t=new esri.layers.GraphicsLayer).id=e,r.map.addLayer(t,i),!0),a&&n(t,r),t}function n(e,r){p(r,e,{autoEditable:!0,displayName:r.getResource("Mapping.Infrastructure","language-clickable-graphics-label-drawing")})}function c(e,r,a){p(r,e,{displayName:a,autoEditable:!1,canEdit:function(){return!1},canDelete:function(){return!1},canChangeStyles:function(){return!1}})}function p(e,r,a){return!(!(e&&r&&r instanceof esri.layers.GraphicsLayer)||e.clickableGraphics.isLayerRegistered(r))&&(e.clickableGraphics.register(r,a),!0)}Object.defineProperty(r,"__esModule",{value:!0}),r.ExcludeFromEnum={WebMapName:"WebMap",ExportApplyStateName:"ExportApplyState",ExportMapTaskName:i.excludeFromExportMapTaskName},r.GraphicsLayerType={Pushpin:"Pushpin",Label:"Label",Highlight:"Highlight",Markup:"Markup"};var y=0,l=0,u=0;r.getInternalGraphicsLayer=function(e,a,i,n){if(void 0===n&&(n=!1),!i)return(c=t(e,!1,a,a.map.graphicsLayerIds.length-y-l-u)).layer;if(i===r.GraphicsLayerType.Pushpin)return(c=t(e,!0,a,a.map.graphicsLayerIds.length)).create&&y++,c.layer;if(i===r.GraphicsLayerType.Label)return(c=t(e,!0,a,a.map.graphicsLayerIds.length-y)).create&&l++,c.layer;if(i===r.GraphicsLayerType.Highlight){var c=t(e,!0,a,a.map.graphicsLayerIds.length-y-l);return c.create&&u++,c.layer}return i===r.GraphicsLayerType.Markup?s(e,a,n,a.map.graphicsLayerIds.length-y-l-u):void 0},r.removeInternalGraphicsLayer=function(e,a,i){var t=a.map.getLayer(e);t&&(a.map.removeLayer(t),i===r.GraphicsLayerType.Pushpin&&(0===y||y--),i===r.GraphicsLayerType.Highlight&&(0===u||u--),i===r.GraphicsLayerType.Label&&(0===l||l--))},r.registerMarkupLayerAsClickable=n,r.registerStreamLayerAsClickable=c,r.registerWfsLayerAsClickable=function(e,r,a){c(e,r,a)},r.tryRegisterClickableLayer=p,r.getGraphicsLayersExceptExcluded=function(e,r){var t=function(r){return e.site.essentialsMap.mapServices.some(function(e){return e.serviceLayer===r||e.serviceLayer instanceof esri.layers.KMLLayer&&e.serviceLayer.getLayers().indexOf(r)>=0})},s=[];return e.map.graphicsLayerIds.forEach(function(n){var c=e.map.getLayer(n);t(c)||c instanceof a.ClusterLayer||c.id.endsWith("-explodedClusterLayer")||i.getGraphicsLayerIdsToExclude(r).indexOf(n)>=0||s.push(c)}),s},r.addGraphicToLayer=function(e,r,a){if(e){var i=t(r,!1,a);if(i.layer)return i.layer.add(e),i.layer.visible||i.layer.setVisibility(!0),!0}return!1}})}}});require({cache:{"geocortex/infrastructure/GraphicUtils":function(){define(["require","exports","./GeometryUtils","./GraphicsLayerUtils","./ArrayUtils"],function(e,r,t,n,i){"use strict";function o(e,r){if(r&&e&&e.name){if(-1!==e.name.indexOf(".Name()",e.name.length-".Name()".length))return!0;if(r.getFieldByName(e.name+".Name()"))return!0}return!1}function a(e,r,t,n,i,o,a,l){void 0===i&&(i=!1),void 0===l&&(l="Mapping");var u=[],y=[],c=0,g={},f=function(e){n&&n(e)},m=function(){for(var e=0;e<u.length;e++)if(u[e].visible){if(i&&!u[e].hasOwnProperty("measurementId")){u.splice(e,1);continue}var r=u[e].getLayer();r&&r.remove(u[e])}else u.splice(e,1)};if(!(e&&r&&r.length&&t)){var p="Error deleting markup. Required parameters missing.";return t?t.trace.error(p):console.log(p),void f(u)}for(var h=0;h<r.length;h++){var d=t.map.getLayer(r[h]);d&&y.push(d)}if(!y.length)return t.trace.error("Error deleting markup. No graphics layer(s) found."),void f(u);for(var v=0;v<y.length;v++){var b=s(e,y[v],t);b&&b.length&&(u=u.concat(b))}for(var x=0;x<u.length;x++){var P=u[x];if(P.visible&&(P.hasOwnProperty("measurementId")?g.hasOwnProperty(P.measurementId)||(g[P.measurementId]=!0,c++):i||c++),c>1)break}if(0===c)f(u);else if(1!==c&&o){var M=t.getResource(l,o),w=a?t.getResource(l,a):null;t.command("Confirm").execute(M,w,function(e){e?m():u=[],f(u)})}else m(),f(u)}function s(e,r,t,n,i){void 0===i&&(i=6);var o=null,a=[];if(!e||!r||!t){var s="Error retrieving markup. Required parameters missing.";return t?t.trace.error(s):console.log(s),a}if(!r.graphics.length)return a;if(null==(o=l(e,t,i)))return t.trace.error("Error retrieving markup. Could not compute extent."),a;for(var y=r.graphics,m=0;m<y.length;m++)if(o.intersects(y[m].geometry))a.push(r.graphics[m]);else if(y[m].symbol instanceof esri.symbol.SimpleMarkerSymbol||y[m].symbol instanceof esri.symbol.PictureMarkerSymbol){if(y[m].geometry instanceof esri.geometry.Point)o.intersects(u(y[m],y[m].symbol,t,n||f(y[m],t)))&&a.push(r.graphics[m]);else if(y[m].geometry instanceof esri.geometry.Multipoint)for(var p=c(y[m],t,n||f(y[m],t)),h=0;h<p.length;h++)if(o.intersects(p[h])){a.push(r.graphics[m]);break}}else y[m].symbol instanceof esri.symbol.TextSymbol&&o.intersects(g(y[m],y[m].symbol,t))&&a.push(r.graphics[m]);return a}function l(e,r,t){var n=null;return"point"==e.type?n=h(e,t,r).getExtent():"polyline"==e.type?n=e.getExtent():"polygon"==e.type&&(n=e.getExtent()),null==n&&r.trace.error("Could not compute extent."),n}function u(e,r,t,n){return h(e.geometry,n,t,r.xoffset,r.yoffset)}function y(e,r,t,n){var i=e.geometry,o=(new Array,i.spatialReference),a=new esri.geometry.Polygon(o);return i.points.forEach(function(e){h(new esri.geometry.Point(e,o),n,t,r.xoffset,r.yoffset).rings.forEach(function(e){a.addRing(e)})}),a}function c(e,r,t){e.symbol;for(var n=e.geometry,i=new Array,o=0;o<n.points.length;o++){var a=new esri.geometry.Point(n.points[o],n.spatialReference);i.push(h(a,t,r,e.symbol.xoffset,e.symbol.yoffset))}return i}function g(e,r,t){var n=t.map.toScreen(e.geometry),i=d(r.text,r.font.family,r.font.size,r.font.weight),o=i.height,a=i.width;switch(n.x+=r.xoffset,n.y-=r.yoffset,r.align){case esri.symbol.TextSymbol.ALIGN_START:var s=new esri.geometry.Point(n.x,n.y-o,null),l=new esri.geometry.Point(n.x+a,n.y-o,null),u=new esri.geometry.Point(n.x,n.y,null),y=new esri.geometry.Point(n.x+a,n.y,null);break;case esri.symbol.TextSymbol.ALIGN_MIDDLE:var s=new esri.geometry.Point(n.x-a/2,n.y-o,null),l=new esri.geometry.Point(n.x+a/2,n.y-o,null),u=new esri.geometry.Point(n.x-a/2,n.y,null),y=new esri.geometry.Point(n.x+a/2,n.y,null);break;case esri.symbol.TextSymbol.ALIGN_END:var s=new esri.geometry.Point(n.x-a,n.y-o,null),l=new esri.geometry.Point(n.x,n.y-o,null),u=new esri.geometry.Point(n.x-a,n.y,null),y=new esri.geometry.Point(n.x,n.y,null)}s=t.map.toMap(s),l=t.map.toMap(l),u=t.map.toMap(u),y=t.map.toMap(y);var c=new esri.geometry.Polygon({rings:[[[s.x,s.y],[l.x,l.y],[y.x,y.y],[u.x,u.y]]],spatialReference:s.spatialReference});return c=p(r.angle,e.geometry,c)}function f(e,r){if(!e)return r&&r.trace.error("cound not compute size of bounding box."),null;var t,n=0,i=0;if(!(t=e.symbol)&&e.getLayer()&&e.getLayer().renderer){var o=e.getLayer().renderer;t=o.getSymbol(e),n=o.getSize(e);try{i=o.getRotationAngle(e)}catch(e){}}if(t instanceof esri.symbol.SimpleMarkerSymbol)n||(n=t.size),n+=t.outline?t.outline.width:0;else{if(!(t instanceof esri.symbol.PictureMarkerSymbol))return r&&r.trace.error("cound not compute size of bounding box"),null;n||(n=Math.max(t.height,t.width))}return!i&&t.angle&&(i=t.angle),i&&(i=m(i),n*=Math.abs(Math.sin(i))+Math.abs(Math.cos(i))),n}function m(e){return e*(Math.PI/180)}function p(e,r,t){for(var n=new esri.geometry.Polygon(t.toJson()),i=(360-(e<0?360+e:e)%360)*(Math.PI/180),o=0;o<n.rings.length;o++)for(var a=0;a<n.rings[o].length;a++){var s=n.getPoint(o,a),l=(s.x-r.x)*Math.cos(i)-(s.y-r.y)*Math.sin(i)+r.x,u=(s.x-r.x)*Math.sin(i)+(s.y-r.y)*Math.cos(i)+r.y;s.setX(l),s.setY(u),n.setPoint(o,a,s)}return n}function h(e,r,t,n,i){r=parseFloat(r);var o=t.map.toScreen(e),a=r/2;o.x+=n||0,o.y-=i||0;var s=new esri.geometry.Point(o.x-a,o.y-a,null),l=new esri.geometry.Point(o.x+a,o.y-a,null),u=new esri.geometry.Point(o.x-a,o.y+a,null),y=new esri.geometry.Point(o.x+a,o.y+a,null);return s=t.map.toMap(s),l=t.map.toMap(l),u=t.map.toMap(u),y=t.map.toMap(y),new esri.geometry.Polygon({rings:[[[s.x,s.y],[l.x,l.y],[y.x,y.y],[u.x,u.y],[s.x,s.y]]],spatialReference:s.spatialReference})}function d(e,r,t,n){void 0===n&&(n="normal");var i=document.body,o=document.createElement("div"),a={fontFamily:r,fontSize:void 0!=t&&"number"==typeof t?t+"px":t,fontWeight:n,padding:"0",position:"absolute",lineHeight:"1",visibility:"hidden"};for(var s in a)o.style[s]=a[s];o.appendChild(document.createTextNode(e)),i.appendChild(o);var l={width:o.clientWidth,height:o.clientHeight};return i.removeChild(o),l}function v(e,r){var t=null,n=r?r.getLayer():null;return n&&n instanceof esri.layers.GraphicsLayer&&e.clickableGraphics.isLayerRegistered(n)&&(t=e.clickableGraphics.getLayerInfo(n)),t}function b(e,r,t){var n=[];return t||(t=v(e,r)),t&&"function"==typeof t.canEdit&&t.canEdit(r)&&n.push("edit"),t&&"function"==typeof t.canDelete&&t.canDelete(r)&&n.push("delete"),t&&"function"==typeof t.canChangeStyles&&t.canChangeStyles(r)&&n.push("style"),n}function x(e,r){return r&&r.some(function(r){return r==e})}Object.defineProperty(r,"__esModule",{value:!0});var P={};r.sanitizeAttributeNames=function(e,r){var t,n=r.mapService?"{0}.{1}".format(r.mapService.id,r.id):null;if(n&&P[n])t=P[n];else{t={};for(var i=0;i<r.fields.length;i++){var a=r.fields[i];o(a,r)||(t[a.alias]=a.name)}n&&(P[n]=t)}var s=[];for(var l in t)if(t.hasOwnProperty(l)&&e.attributes.hasOwnProperty(l)){"Null"===e.attributes[l]&&(e.attributes[l]=null);var u=e.attributes[l];if(void 0!==u){var y={alias:l,name:t[l],value:u};y.alias!=y.name&&s.push(y)}}for(var c=0;c<s.length;c++){var g=s[c];delete e.attributes[g.alias],e.attributes[g.name]=g.value}},r._isSEPCodedDomainField=o,r.deleteMarkupSilently=function(e,r,t,n,i){void 0===i&&(i=!1),a(e,r,t,n,i)},r.deleteMarkup=a,r.getMarkupFromGeometry=s,r.getExtentFromGeometry=l,r.geometryIntersectsGraphic=function(e,r,n){return new Promise(function(i,o){t.intersects(e,r.geometry).then(function(a){if(a)i(!0);else{var s=r.symbol;if(!s&&r.getLayer()&&r.getLayer().renderer&&(s=r.getLayer().renderer.getSymbol(r)),s instanceof esri.symbol.SimpleMarkerSymbol||s instanceof esri.symbol.PictureMarkerSymbol){if(r.geometry instanceof esri.geometry.Point)t.intersects(e,u(r,s,n,f(r,n))).then(function(e){i(e)},function(e){o(e)});else if(r.geometry instanceof esri.geometry.Multipoint){var l=y(r,s,n,f(r,n));t.intersects(e,l).then(function(e){i(e)},function(e){o(e)})}}else s instanceof esri.symbol.TextSymbol?t.intersects(e,g(r,s,n)).then(function(e){i(e)},function(e){o(e)}):i(!1)}},function(e){o(e)})})},r._getEnhancedGeometryOfPointGraphic=u,r._getenhancedPolygonGeometryOfMultipoint=y,r._getEnhancedGeometriesOfMultiPoint=c,r._getEnhancedGeometryOfTextGraphic=g,r.getBoundingBoxSize=f,r._toRadians=m,r.rotatePolygon=p,r.getPolygonFromPoint=h,r.getRenderedTextMarkupSize=d,r.moveGraphicToTop=function(e){if(e){var r=e.getDojoShape();r&&r.moveToFront()}},r.isClickableGraphic=function(e,r){if(r){var t=r.getLayer();if(t&&t instanceof esri.layers.GraphicsLayer&&e.clickableGraphics.isLayerRegistered(t))return!0}return!1},r.isEditableButNotAutoEditableClickableFeature=function(e,r){if(r&&r.esriFeature.get()&&r.esriFeature.get().geometry){var t=v(e,r.esriFeature.get()),n=x("edit",b(e,r.esriFeature.get(),t)),i=t&&t.autoEditable;return n&&!i}return!1},r.isAutoEditableClickableFeature=function(e,r){if(r&&r.esriFeature.get()&&r.esriFeature.get().geometry){var t=v(e,r.esriFeature.get()),n=x("edit",b(e,r.esriFeature.get(),t)),i=t&&t.autoEditable;return n&&i}return!1},r.getClickableLayerInfo=v,r.getCapabilitiesForGraphic=b,r.getGraphicsLayer=function(e,r,t){return r?n.getInternalGraphicsLayer(e,t,n.GraphicsLayerType.Markup):n.getInternalGraphicsLayer(e,t)},r.getMarkupLayer=function(e,r){return n.getInternalGraphicsLayer(e,r,n.GraphicsLayerType.Markup)},r.getUserGraphicsLayers=function(e){var r=["snapping_graphics","snapping_helper_graphics","DefaultPushpinsLayer"],t=e.highlightManager.getInternalHighlightLayers(),o=Object.keys(t).map(function(e){return t[e].graphicsLayer.id}),a=i.ArrayUtils.unique(o);for(var s in a)r.push(s);return n.getGraphicsLayersExceptExcluded(e,r)},r.addGraphicToLayer=function(e,r,t){return n.addGraphicToLayer(e,r,t)}})}}});require({cache:{"geocortex/infrastructure/highlightedLabel/HighlightedLabelConfig":function(){define(["require","exports"],function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic":function(){define(["require","exports","./../GraphicsLayerUtils","./HighlightedLabelUtils"],function(t,i,h,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o;!function(t){t[t.BOTTOM_LEFT=0]="BOTTOM_LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.CALLOUT=2]="CALLOUT"}(o=i.HighlightedLabelAnchor||(i.HighlightedLabelAnchor={}));var s=function(){function t(t,i){if(this.textGraphics=[],this.textSymbols=[],this._height=0,this._width=0,this._padding=0,this._calloutSizeWidthFraction=5,this._tagHeightPercentage=.6,!i||!this._processConfig(t))throw new Error("HighlightedLabelGraphic: Initialization failed.");this.app=i,this.graphicsLayer=h.getInternalGraphicsLayer(this._config.layerId,this.app,h.GraphicsLayerType.Label),t._isRestoringState||this._executeSetupRoutine()}return t.prototype.getTextFontFamily=function(){return this.textSymbols&&this.textSymbols.length>0?this.textSymbols[0].font.family:this._config.fontFamily},t.prototype.getTextFontSize=function(){return this.textSymbols&&this.textSymbols.length>0?this.textSymbols[0].font.size+"px":this._config.fontSize},t.prototype.getWidth=function(){return this._width},t.prototype.getTotalWidth=function(){return this._width+this._padding},t.prototype.getHeight=function(){return this._height},t.prototype.getTotalHeight=function(){return this._height+this._padding},t.prototype.getMapPoint=function(){return this._config.mapPoint},t.prototype.getConfig=function(){return this._config},t.prototype.addToLayer=function(t){var i=this;void 0===t&&(t=!0),h.addGraphicToLayer(this.highlightGraphic,this._config.layerId,this.app),h.addGraphicToLayer(this.highlightIdTagGraphic,this._config.layerId,this.app),this.textGraphics.forEach(function(t){h.addGraphicToLayer(t,i._config.layerId,i.app)}),t?this.show():this.hide()},t.prototype.removeFromLayer=function(t){this.hide();var i=function(t){var i=t.getLayer();i&&i.remove(t)};this.textGraphics&&this.textGraphics.length>0&&(this.textGraphics.forEach(function(t){return i(t)}),t&&(this.textGraphics.length=0,this.textSymbols.length=0)),this.highlightIdTagGraphic&&(i(this.highlightIdTagGraphic),t&&(this.highlightIdTagGraphic=null,this.highlightIdTagSymbol=null)),this.highlightGraphic&&(i(this.highlightGraphic),t&&(this.highlightGraphic=null,this.highlightIdTagSymbol=null))},t.prototype.isVisible=function(){return!!this.highlightGraphic&&(this.highlightGraphic.visible&&(!this._config.calloutWithIdTag||this.highlightIdTagGraphic.visible)&&this.textGraphics.filter(function(t){return t.visible}).length>0)},t.prototype.show=function(){return this.highlightGraphic&&this.highlightGraphic.show(),this.highlightIdTagGraphic&&this.highlightIdTagGraphic.show(),this.textGraphics&&this.textGraphics.length>0&&this.textGraphics.forEach(function(t){t.show()}),this},t.prototype.hide=function(){return this.textGraphics&&this.textGraphics.length>0&&this.textGraphics.forEach(function(t){t.hide()}),this.highlightIdTagGraphic&&this.highlightIdTagGraphic.hide(),this.highlightGraphic&&this.highlightGraphic.hide(),this},t.prototype.update=function(t,i){if(this.highlightGraphic&&this.textGraphics.length){var h=this.isVisible(),e=this._key?this.highlightGraphic[this._key]:null;this._config.text=i||"",this._config.mapPoint=t&&t instanceof esri.geometry.Point?t:this._config.mapPoint,this.removeFromLayer(!0),this._executeSetupRoutine(),this.addToLayer(h),e&&this.assignGraphicIdentifierKey(this._key,e)}},t.prototype.refresh=function(t){if(this.highlightGraphic&&this.textGraphics.length){var i=this.isVisible(),h=this._key?this.highlightGraphic[this._key]:null;this._config.text=t||"",this.removeFromLayer(!0),this._executeSetupRoutine(),this.addToLayer(i),h&&this.assignGraphicIdentifierKey(this._key,h)}},t.prototype.moveToTop=function(){var t=this.highlightGraphic.getDojoShape();if(t&&t.moveToFront(),this.highlightIdTagGraphic){var i=this.highlightIdTagGraphic.getDojoShape();i&&i.moveToFront()}for(var h,e=0;e<this.textGraphics.length;e++)(h=this.textGraphics[e].getDojoShape())&&h.moveToFront()},t.prototype.assignGraphicIdentifierKey=function(t,i){this._key=t,this.highlightGraphic[t]=i,this.highlightIdTagGraphic&&(this.highlightIdTagGraphic[t]=i),this.textGraphics.forEach(function(h){h[t]=i})},t.prototype.updateIdTagText=function(t){if(t&&this._config.calloutWithIdTag){this._config.idTagText=t;var i=this.textGraphics[this.textGraphics.length-1];i&&i.symbol&&(i.symbol.setText(t),i.setSymbol(i.symbol))}},t.prototype.setHighlightColor=function(t){if(t&&t instanceof esri.Color&&this.highlightSymbol&&(this._config.highlightColor=t,this.highlightSymbol&&this.highlightGraphic&&(this.highlightSymbol.setColor(t),this.highlightGraphic.setSymbol(this.highlightSymbol))),this._config.calloutWithIdTag){var i=this.textGraphics[this.textGraphics.length-1];this.highlightIdTagSymbol&&this.highlightIdTagGraphic&&(this.highlightIdTagSymbol.outline.setColor(t),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)),i&&(i.symbol.setColor(t),i.setSymbol(i.symbol))}},t.prototype.setTextColor=function(t){if(t&&t instanceof esri.Color){this._config.textColor=t;var i=this.textGraphics.length;this._config.calloutWithIdTag&&(this.highlightIdTagSymbol&&this.highlightIdTagGraphic&&(this.highlightIdTagSymbol.setColor(t),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)),i--);for(var h=0;h<i;h++){var e=this.textGraphics[h];e&&(e.symbol.setColor(t),e.setSymbol(e.symbol))}}},t.prototype.exportState=function(t){var i=t.project.convert,h=this.getConfig();return{highlightGraphic:i.fromEsriGraphic(this.highlightGraphic),highlightSymbol:i.fromEsriSymbol(this.highlightSymbol),textGraphics:this.textGraphics.map(function(t){return i.fromEsriGraphic(t)}),textSymbols:this.textSymbols.map(function(t){return i.fromEsriSymbol(t)}),layerId:h.layerId,mapPoint:i.fromEsriGeometry(this.getMapPoint()),labelXoffset:h.labelXoffset,labelYoffset:h.labelYoffset,text:h.text,fontFamily:h.fontFamily,fontSize:h.fontSize,cornerRadius:h.cornerRadius,angle:h.angle,anchor:h.anchor,textColor:i.fromEsriColor(h.textColor),highlightColor:i.fromEsriColor(h.highlightColor),highlightOutlineSymbol:i.fromEsriSymbol(h.highlightOutlineSymbol)}},t.fromExportedState=function(i,h,e){return Promise.try(function(){if(!i||!i.highlightGraphic)throw new Error("HighlightedLabelGraphic.fromExportedState: Invalid state.");if(!h)throw new Error('HighlightedLabelGraphic.fromExportedState: Parameter "app" is required.');var o=h.project.convert,s={highlightGraphic:o.toEsriGraphic(i.highlightGraphic),textGraphics:Promise.map(i.textGraphics,function(t){return o.toEsriGraphic(t)})};return Promise.props(s).then(function(s){var l={layerId:i.layerId,mapPoint:o.toEsriGeometry(i.mapPoint),text:i.text,labelXoffset:i.labelXoffset,labelYoffset:i.labelYoffset,fontFamily:i.fontFamily,fontSize:i.fontSize,cornerRadius:i.cornerRadius,angle:i.angle,anchor:i.anchor,textColor:o.toEsriColor(i.textColor),highlightColor:o.toEsriColor(i.highlightColor),highlightOutlineSymbol:o.toEsriSymbol(i.highlightOutlineSymbol)};l._isRestoringState=!0,e=e||t.prototype;var r=Object.create(e);return r.constructor.call(r,l,h),r.initializeHighlightDimensions(),r.highlightGraphic=s.highlightGraphic,r.highlightSymbol=o.toEsriSymbol(i.highlightSymbol),r.textGraphics=s.textGraphics,r.textSymbols=i.textSymbols.map(function(t){return o.toEsriSymbol(t)}),r})})},t.prototype._executeSetupRoutine=function(){this.initializeHighlightDimensions(),this.initializeHighlightGraphic(),this.initializeHighlighteIdTagGraphic(),this.initializeTextGraphicsAndSymbols()},t.prototype.setHighlightAnchor=function(){switch(this._config.anchor){case o.BOTTOM_LEFT:this.highlightSymbol.setOffset(this.getTotalWidth()/2,this.getTotalHeight()/2);break;case o.CALLOUT:this.highlightSymbol.setOffset(0,this.getTotalHeight()/2+this._config.calloutPixelSize/4);break;default:this.highlightSymbol.setOffset(0,0)}this.highlightSymbol.setOffset(this.highlightSymbol.xoffset+this._config.labelXoffset,this.highlightSymbol.yoffset+this._config.labelYoffset)},t.prototype.setTextAnchor=function(t,i){switch(this._config.anchor){case o.MIDDLE:this.textSymbols[t].setOffset(0,i);break;case o.BOTTOM_LEFT:this.textSymbols[t].setOffset(this.getTotalWidth()/2,i+this.getTotalHeight()/2);break;case o.CALLOUT:this.textSymbols[t].setOffset(0,i+this.getTotalHeight()/2+this._config.calloutPixelSize/2)}},t.prototype.initializeHighlightDimensions=function(){var t=e.getLabelSize(this._config.text,this._config.fontFamily,this._config.fontSize,this._config.layerId),i=.5*t.height,h=this._config.calloutWithIdTag?t.height+i:0;this._height=t.height,this._width=t.width+h,this._padding=i,this._config.calloutPixelSize=this._config.calloutPixelSize||Math.floor(this._width/this._calloutSizeWidthFraction)},t.prototype.initializeHighlightGraphic=function(){this.highlightGraphic=new esri.Graphic,this.highlightGraphic.highlightedTextLabel=!0,this.highlightSymbol=new esri.symbol.SimpleMarkerSymbol,this.highlightGraphic.setGeometry(this._config.mapPoint),this.configureHighlightSymbol(this._config.highlightColor,this._config.highlightOutlineSymbol,this._config.fontSize)},t.prototype.initializeHighlighteIdTagGraphic=function(){this._config.calloutWithIdTag&&(this.highlightIdTagGraphic=new esri.Graphic,this.highlightIdTagSymbol=new esri.symbol.SimpleMarkerSymbol,this.highlightIdTagGraphic.setGeometry(this._config.mapPoint),this.configureHighlightIdTagSymbol(this._config.textColor,this._config.fontSize))},t.prototype.configureHighlightSymbol=function(t,i,h){this.setHighlightAnchor(),this.highlightSymbol.setStyle("STYLE_PATH");var o=e.generateSvgHighlightLabelPath(this.getTotalWidth(),this.getTotalHeight(),this._config.cornerRadius,this._config.calloutWithIdTag,this._config.calloutPixelSize);this.highlightSymbol.setPath(o),this.highlightSymbol.setColor(t),this.highlightSymbol.setOutline(i),this.highlightSymbol.setAngle(this._config.angle),this.highlightSymbol.setSize(h),this.highlightGraphic.setSymbol(this.highlightSymbol)},t.prototype.configureHighlightIdTagSymbol=function(t,i){var h=-(this.getTotalWidth()/2-this.getTotalHeight()/2),o=this.getTotalHeight()/2+this._config.calloutPixelSize/2;this.highlightIdTagSymbol.setStyle("STYLE_PATH"),this.highlightIdTagSymbol.setPath(e.generateSvgCirclePath(this.getTotalHeight()*this._tagHeightPercentage/2)),this.highlightIdTagSymbol.setColor(t),this.highlightIdTagSymbol.outline&&this.highlightIdTagSymbol.outline.setColor(t),this.highlightIdTagSymbol.setOffset(h+this._config.labelXoffset,o+this._config.labelYoffset),this.highlightIdTagSymbol.setSize(this.getTotalHeight()*this._tagHeightPercentage),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)},t.prototype.initializeTextGraphicsAndSymbols=function(){if(this._config.text){var t=e.getTextLines(this._config.text);if(t&&t.length&&0!==t.length){var i=t.length,h=new esri.symbol.Font;h.setSize(this._config.fontSize),h.setFamily(this._config.fontFamily);var o=this.getHeight()/i,s=Math.abs(h.size-o),l=this.getHeight()/2/o;this.textGraphics=[],this.textSymbols=[];for(var r=0;t&&t.length>0&&r<t.length;r++){this.textGraphics[r]||(this.textGraphics[r]=new esri.Graphic),this.textSymbols[r]||(this.textSymbols[r]=new esri.symbol.TextSymbol("")),this.textGraphics[r].geometry!==this._config.mapPoint&&this.textGraphics[r].setGeometry(this._config.mapPoint);var g=(l-(r+1))*o+s;if(this.configureTextSymbol(r,t[r],this._config.textColor,h,this._config.angle,g),1===i){this.textSymbols[r].setHorizontalAlignment(esri.symbol.TextSymbol.ALIGN_MIDDLE);var a=this._config.angle*(Math.PI/180);this.textSymbols[r].setOffset(-o/2/2*Math.sin(a),-Math.abs(o/2/2*Math.cos(a)));n={customVerticalAlignment:"middle",numberOfLines:1};this.textGraphics[r].setAttributes(n)}else{this.textSymbols[r].setHorizontalAlignment(esri.symbol.TextSymbol.ALIGN_START),this.textSymbols[r].setVerticalAlignment(esri.symbol.TextSymbol.ALIGN_START);var n={customVerticalAlignment:"middle",numberOfLines:i};this.textGraphics[r].setAttributes(n)}var c=this._config.calloutWithIdTag?this.getTotalHeight()/2:0;this.textSymbols[r].setOffset(this.textSymbols[r].xoffset+this._config.labelXoffset+c,this.textSymbols[r].yoffset+this._config.labelYoffset),this.textGraphics[r].setSymbol(this.textSymbols[r])}if(this._config.calloutWithIdTag){var f=new esri.symbol.Font;f.setSize(this._config.fontSize),f.setSize(Math.floor(1.25*f.size)),f.setFamily(this._config.fontFamily),f.setWeight(esri.symbol.Font.WEIGHT_BOLD);var p=new esri.Graphic;p.setGeometry(this._config.mapPoint),this.textGraphics.push(p);var y=new esri.symbol.TextSymbol(this._config.idTagText);this.textSymbols.push(y),this.configureTextSymbol(i,this._config.idTagText,this._config.highlightColor,f,0,0);var m=-(this.getTotalWidth()/2-this.getTotalHeight()/2),u=-f.size/3;y.setOffset(y.xoffset+m,y.yoffset+u),p.setSymbol(y)}}}},t.prototype.configureTextSymbol=function(t,i,h,e,o,s){this.textSymbols&&t<this.textSymbols.length&&(this.textSymbols[t].setText(i),this.textSymbols[t].setFont(e),this.textSymbols[t].setColor(h),this.textSymbols[t].setAngle(o),this.setTextAnchor(t,s))},t.prototype._processConfig=function(t){return!!(t&&t.layerId&&t.mapPoint)&&(t.calloutWithIdTag=void 0!=t.calloutWithIdTag&&!!t.calloutWithIdTag,t.idTagText=t.idTagText||"",t.calloutPixelSize=t.calloutPixelSize||0,t.labelXoffset=t.calloutWithIdTag?0:t.labelXoffset||0,t.labelYoffset=t.calloutWithIdTag?0:t.labelYoffset||0,t.layerId=t.layerId,t.mapPoint=t.mapPoint,t.text=t.text||"",t.fontFamily=t.fontFamily||"Arial",t.fontSize=t.fontSize||"12px",t.cornerRadius=void 0==t.cornerRadius?5:t.cornerRadius,t.angle=t.calloutWithIdTag?0:t.angle||0,t.anchor=t.calloutWithIdTag?o.CALLOUT:void 0!=t.anchor?t.anchor:o.MIDDLE,t.textColor=t.textColor&&t.textColor instanceof esri.Color?t.textColor:new esri.Color("white"),t.highlightColor=t.highlightColor&&t.highlightColor instanceof esri.Color?t.highlightColor:new esri.Color("black"),t.highlightOutlineSymbol=t.highlightOutlineSymbol&&t.highlightOutlineSymbol instanceof esri.symbol.SimpleLineSymbol?t.highlightOutlineSymbol:new esri.symbol.SimpleLineSymbol,this._config=t,!0)},t}();i.HighlightedLabelGraphic=s})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelState":function(){define(["require","exports"],function(t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"geocortex/infrastructure/highlightedLabel/HighlightedLabelUtils":function(){define(["require","exports"],function(t,i){"use strict";function h(t){return t.split(l)}function e(t){return(l.test(t)?t.match(l).length:0)+1}Object.defineProperty(i,"__esModule",{value:!0});var o=null,s={},l=/\r\n|\r|\n/g;i.getLabelSize=function(t,i,l,r){for(var g=!0,a=null,n=e(t),c=h(t),f=0,p=0;c&&p<c.length;p++){for(var y=t.length,m=0,u=0;u<y;u++){var b=c[p].charAt(u);b=" "===b?".":b,m+=s.hasOwnProperty(b)?s[b]:function(t){if(g){var h=document.getElementById(r+"_layer");(a=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttributeNS(null,"font-size",l),a.setAttributeNS(null,"font-family",i),a.setAttributeNS(null,"visibility","hidden"),a.textContent=t,h.appendChild(a),g=!1}else a.textContent=t;var e=a.getBBox();return o=null===o?e.height:o,s[t]=a.getComputedTextLength(),s[t]}(b)}m>f&&(f=m)}return{width:Math.ceil(f),height:Math.ceil(o*n)}},i.getTextLines=h,i.generateSvgHighlightLabelPath=function(t,i,h,e,o){void 0===e&&(e=!1),void 0===o&&(o=t/5);var s="";return s=0===h?"M1,0h"+t+"v"+i:"M1,0h"+(t-h)+"a"+h+","+h+" 0 0 1 "+h+","+h+"v"+(i-2*h)+"a"+h+","+h+" 0 0 1 "+-h+","+h,s+=e?"h"+(h-(t-o))/2+"l"+-o/2+","+o/2+"l"+-o/2+","+-o/2+"h"+(h-(t-o))/2:"h"+(h-t),s+=0===h?"z":"a"+h+","+h+" 0 0 1 "+-h+","+-h+"v"+(2*h-i)+"a"+h+","+h+" 0 0 1 "+h+","+-h+"z"},i.generateSvgCirclePath=function(t){if(!t)throw new Error("HighlightLabelUtils: Cannot generate SVG circle path. Radius cannot be zero or undefined.");return"M0,0a"+t+","+t+" 0 0 1 "+t+","+t+"a"+t+","+t+" 0 0 1 "+-t+","+t+"a"+t+","+t+" 0 0 1 "+-t+","+-t+"a"+t+","+t+" 0 0 1 "+t+","+-t+"z"}})}}});require({cache:{"geocortex/infrastructure/HighlightLayer":function(){define(["require","exports","./SimpleRenderer"],function(e,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(e,r){this.graphics=[],this.innerHighlightBorderRenderer=new i.SimpleRenderer,this.outerHighlightBorderRenderer=new i.SimpleRenderer,this.innerFocusBorderRenderer=new i.SimpleRenderer,this.outerFocusBorderRenderer=new i.SimpleRenderer,this.name=e,this.graphicsLayer=r}return e.prototype.add=function(e){-1===this.graphics.indexOf(e)&&(this.graphics.push(e),this.graphicsLayer.add(e))},e.prototype.remove=function(e){this.graphics.indexOf(e)>-1&&(this.graphics.splice(this.graphics.indexOf(e),1),this.graphicsLayer.remove(e))},e}();r.HighlightLayer=t})}}});require({cache:{"geocortex/infrastructure/HighlightManager":function(){define(["require","exports","./ColorUtils","./Feature","./PromiseUtils","./GraphicUtils","./GraphicsLayerUtils","./symbology/SymbolColor","./SymbolUtils","geocortex/essentials/utilities/GraphicsLayerUtilities","./GeometryUtils","./HighlightLayer","./GraphicsLayerIds","./ArrayUtils"],function(e,r,t,i,h,a,o,g,n,s,l,c,u,d){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_HIGHLIGHT_LAYER_NAME="Default",r.EDITOR_HIGHLIGHT_LAYER_NAME="Editor",r.HIGHLIGHT_ID_PROPERTY="__gcxHlId";var p=function(){function e(e){this.activeHighlightLayerName=null,this.onMaxGeometryVerticesExceeded=function(){},this._highlightLayers={},this._managedGraphics={},this._minBorder=1,this._defaultBorderOffset=3,this._ramerGeomGeneralizationDisabled=!0,this._ramerDeviationInMeters=100,this._ramerEpsilon=0,this._ramerGeomVerticesThreshold=0,this._maxHighlightableGeometryVertices=0,this._geometryCache=[],this._maxGeomCacheItems=50,this._supressedHighlightIds=[],this.app=e}return e.prototype.getHighlightFillColor=function(e){e||(e=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var t;return t=e instanceof c.HighlightLayer?e:this.getOrCreateInternalHighlightLayer(e),this._toARGBHex(t.innerHighlightBorderRenderer.fillColor)},e.prototype.getHighlightBorderColor=function(e){e||(e=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var t;return t=e instanceof c.HighlightLayer?e:this.getOrCreateInternalHighlightLayer(e),this._toARGBHex(t.outerHighlightBorderRenderer.borderColor)},e.prototype.getHighlightBorderWidth=function(e){e||(e=r.DEFAULT_HIGHLIGHT_LAYER_NAME);return(e instanceof c.HighlightLayer?e:this.getOrCreateInternalHighlightLayer(e)).outerHighlightBorderRenderer.borderWidth},e.prototype.setHighlightFillColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a;a=e instanceof esri.Color?e:t.getColorFromString(e),h.outerHighlightBorderRenderer.fillColor=a,h.innerHighlightBorderRenderer.fillColor=new esri.Color("transparent")},e.prototype.setHighlightBorderColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a;a=e instanceof esri.Color?e:t.getColorFromString(e),this.setInnerHighlightBorderColor(a,h),this.setOuterHighlightBorderColor(new g.SymbolColor(a).darken(.4,!0).toEsriColor(),h)},e.prototype.setOuterHighlightBorderColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a;a=e instanceof esri.Color?e:t.getColorFromString(e),h.outerHighlightBorderRenderer.borderColor=a},e.prototype.setInnerHighlightBorderColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a;a=e instanceof esri.Color?e:t.getColorFromString(e),h.innerHighlightBorderRenderer.borderColor=a},e.prototype.setBorderWidth=function(e,t){t||(t=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var i;i=t instanceof c.HighlightLayer?t:this.getOrCreateInternalHighlightLayer(t),e<this._minBorder&&(e=this._minBorder),this.setOuterBorderWidth(e,i),(e-=this._defaultBorderOffset)<this._minBorder&&(e=this._minBorder),this.setInnerBorderWidth(e,i)},e.prototype.setInnerBorderWidth=function(e,t){t||(t=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var i;(i=t instanceof c.HighlightLayer?t:this.getOrCreateInternalHighlightLayer(t)).innerHighlightBorderRenderer.borderWidth=e,i.innerFocusBorderRenderer.borderWidth=e},e.prototype.setOuterBorderWidth=function(e,t){t||(t=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var i;(i=t instanceof c.HighlightLayer?t:this.getOrCreateInternalHighlightLayer(t)).outerHighlightBorderRenderer.borderWidth=e,i.outerFocusBorderRenderer.borderWidth=e},e.prototype.getFocusedFillColor=function(e){e||(e=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var t;return t=e instanceof c.HighlightLayer?e:this.getOrCreateInternalHighlightLayer(e),this._toARGBHex(t.outerFocusBorderRenderer.fillColor)},e.prototype.getFocusedBorderColor=function(e){e||(e=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var t;return t=e instanceof c.HighlightLayer?e:this.getOrCreateInternalHighlightLayer(e),this._toARGBHex(t.innerFocusBorderRenderer.borderColor)},e.prototype.setFocusedFillColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a=t.getColorFromString(e);h.outerFocusBorderRenderer.fillColor=a,h.innerFocusBorderRenderer.fillColor=new esri.Color("transparent")},e.prototype.setFocusedBorderColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a=t.getColorFromString(e);this.setInnerFocusedBorderColor(a,h),this.setOuterFocusedBorderColor(new g.SymbolColor(a).darken(.4,!0).toEsriColor(),h)},e.prototype.setOuterFocusedBorderColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a;a=e instanceof esri.Color?e:t.getColorFromString(e),h.outerFocusBorderRenderer.borderColor=a},e.prototype.setInnerFocusedBorderColor=function(e,i){i||(i=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var h;h=i instanceof c.HighlightLayer?i:this.getOrCreateInternalHighlightLayer(i);var a;a=e instanceof esri.Color?e:t.getColorFromString(e),h.innerFocusBorderRenderer.borderColor=a},e.prototype.setHighlightLineOpacity=function(e,t){t||(t=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var i;(i=t instanceof c.HighlightLayer?t:this.getOrCreateInternalHighlightLayer(t)).outerHighlightBorderRenderer.polylineOpacity=e,i.innerHighlightBorderRenderer.polylineOpacity=e},e.prototype.applyHighlightConfiguration=function(e){this.config.borderColor&&this.setInnerHighlightBorderColor(this.config.borderColor,e),this.config.outerBorderColor&&this.setOuterHighlightBorderColor(this.config.outerBorderColor,e),this.config.borderWidth&&this.setInnerBorderWidth(this.config.borderWidth,e),this.config.fillColor&&this.setHighlightFillColor(this.config.fillColor,e),this.config.focusedBorderColor&&this.setFocusedBorderColor(this.config.focusedBorderColor,e),this.config.outerBorderWidth&&this.setOuterBorderWidth(this.config.outerBorderWidth,e),this.config.focusedFillColor&&this.setFocusedFillColor(this.config.focusedFillColor,e),this.config.outerFocusedBorderColor&&this.setOuterFocusedBorderColor(this.config.outerFocusedBorderColor,e),this.config.highlightLineOpacity&&this.setHighlightLineOpacity(this.config.highlightLineOpacity,e)},e.prototype.getHighlightLayers=function(){var e=this;this.app.trace.warning("highlightManager.getHighlightLayers() is deprecated. Use highlightManager.getInternalHighlightLayers() to return a collection of infrastructure.HighlightLayer instead.");var r={};return this._getUniqueHighlightGraphicsLayerIds().forEach(function(t){var i=e.app.map.getLayer(t);r[t]=i}),r},e.prototype.getInternalHighlightLayers=function(){return this._highlightLayers},e.prototype.getMaxHighlightableGeometryVertices=function(){return this._maxHighlightableGeometryVertices},e.prototype.setMaxHighlightableGeometryVertices=function(e){var r=parseInt(e.toString(),10);this._maxHighlightableGeometryVertices=r&&!isNaN(r)?r:0},e.prototype.getOrCreateHighlightLayer=function(e,r,t){return this.app.trace.warning("highlightManager.getOrCreateHighlightLayer is deprecated. Please use highlightManager.getOrCreateInternalHighlightLayer instead."),this.getOrCreateInternalHighlightLayer(e,r,t,!1).graphicsLayer},e.prototype.getOrCreateInternalHighlightLayer=function(e,t,i,h){if(void 0===h&&(h=!0),!e)return this._highlightLayers[r.DEFAULT_HIGHLIGHT_LAYER_NAME];if(this._highlightLayers.hasOwnProperty(e))return this._highlightLayers[e];var a;return h?a=o.getInternalGraphicsLayer(u.HIGHLIGHT_LAYER_ID,this.app,o.GraphicsLayerType.Highlight):(a=o.getInternalGraphicsLayer(e,this.app,o.GraphicsLayerType.Highlight),s.addToGraphicsLayerIdsToExclude([o.ExcludeFromEnum.ExportApplyStateName,o.ExcludeFromEnum.WebMapName],a.id)),this._highlightLayers[e]=new c.HighlightLayer(e,a),this.applyHighlightConfiguration(e),null!=t&&this.setHighlightFillColor(t,e),null!=i&&this.setHighlightBorderColor(i,e),this.activeHighlightLayerName&&""!==this.activeHighlightLayerName||(this.activeHighlightLayerName=e),this.app.event("HighlightLayerCreated").publish(e),this._highlightLayers[e]},e.prototype.setActiveHighlightLayer=function(e){e&&(this._highlightLayers.hasOwnProperty(e)||this.getOrCreateInternalHighlightLayer(e),this.activeHighlightLayerName=e)},e.prototype.setGeometryGeneralizationParams=function(e,r){var t=this;return this._ramerGeomVerticesThreshold=e>=0?e:0,this._ramerDeviationInMeters=r>=0?r:0,0===this._ramerGeomVerticesThreshold||0===this._ramerDeviationInMeters?(this._ramerEpsilon=0,this._ramerGeomGeneralizationDisabled=!0,Promise.resolve()):(this._ramerGeomGeneralizationDisabled=!1,l.convertMetersToMapPoints(this.app.site.essentialsMap,this._ramerDeviationInMeters).then(function(e){t._clearGeometryCache(),t._ramerEpsilon=e},function(e){return e}))},e.prototype.getGeometryGeneralizationParams=function(){return{thresholdVertices:this._ramerGeomVerticesThreshold,maxDeviationMeters:this._ramerDeviationInMeters}},e.prototype.highlightEsriFeatureSet=function(e,t){if(e&&e.features&&0!=e.features.length){t||(t=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var i=this.getInternalHighlightLayerOrActive(t);i||(i=this.getOrCreateInternalHighlightLayer(t));for(var h=[],o=0;o<e.features.length;o++){var g=this._highlightGraphic(e.features[o],i);g&&h.push(g)}for(o=0;o<h.length;o++)a.moveGraphicToTop(h[o])}},e.prototype.highlightFeatures=function(e,r){this._highlightFeaturesImpl(e,r)},e.prototype.highlightGraphics=function(e,r){this.app.trace.warning("highlightManager.highlightGraphics is deprecated, use highlightManager.highlightFeatures with the graphics array instead."),this.highlightFeatures(e,r)},e.prototype.focusFeatures=function(e,r){this._highlightFeaturesImpl(e,r,!0)},e.prototype.emphasizeFeatures=function(e,r){this.app.trace.warning("highlightManager.emphasizeFeatures is deprecated. Use highlightManager.focusFeatures instead."),this.focusFeatures(e,r)},e.prototype.clearHighlight=function(e,t){var h=this;if(e&&e.length&&e[0]){t||(t=r.DEFAULT_HIGHLIGHT_LAYER_NAME);var a=null;t&&(a=this.getInternalHighlightLayerOrActive(t)),e[0]instanceof i.Feature?e.filter(function(e){return!!e&&!!e.esriFeature}).forEach(function(e){return h._clearFeatureHighlight(e.esriFeature.get(),a)}):e.filter(function(e){return!!e}).forEach(function(e){return h._clearFeatureHighlight(e,a)})}},e.prototype.suppressHighlight=function(e){this._supressedHighlightIds.push(this._getHighlightId(e)),this.redrawHighlights()},e.prototype.enableHighlight=function(e){var r=this._getHighlightId(e),t=this._supressedHighlightIds.indexOf(r);t>-1&&(this._supressedHighlightIds.splice(t,1),this.updateHighlightId(e,r))},e.prototype.updateHighlightId=function(e,t){var i=this;t||(t=this._getHighlightId(e));var h=this._managedGraphics[t];if(h){var a=this._refreshHighlightId(e,t);a!==t&&h.forEach(function(t){t.managedGraphic.geometry=e.geometry,t.outerBorderGraphic.geometry=e.geometry,t.innerBorderGraphic.geometry=e.geometry,t.gcxFeature&&t.gcxFeature.esriFeature&&t.gcxFeature.esriFeature.get()&&(t.gcxFeature.esriFeature.get()[r.HIGHLIGHT_ID_PROPERTY]=a)}),h.map(function(e){return e.highlightLayer}).forEach(function(e){return i.redrawHighlights(e)})}},e.prototype.clearFocus=function(e,r){var t=this;if(e&&e.length&&e[0]){var h=null;r&&(h=this.getInternalHighlightLayerOrActive(r)),e[0]instanceof i.Feature?e.filter(function(e){return!!e&&!!e.esriFeature}).forEach(function(e){return t._clearFeatureFocus(e.esriFeature.get(),h)}):e.filter(function(e){return!!e}).forEach(function(e){return t._clearFeatureFocus(e,h)})}},e.prototype.clearEmphasis=function(e,r){this.app.trace.warning("highlightManager.clearEmphasis is deprecated. Use highlightManager.clearFocus instead."),this.clearFocus(e,r)},e.prototype.removeHighlightLayer=function(e){if(e&&this._highlightLayers.hasOwnProperty(e)){var r=this._highlightLayers[e];this.clearHighlights(r),r.graphicsLayer.id!==u.HIGHLIGHT_LAYER_ID&&(this.app.map.removeLayer(r.graphicsLayer),s.removeFromGraphicsLayerIdsToExclude([o.ExcludeFromEnum.ExportApplyStateName,o.ExcludeFromEnum.WebMapName],r.graphicsLayer.id)),delete this._highlightLayers[e],this.activeHighlightLayerName===e&&(this.activeHighlightLayerName=null)}},e.prototype.clearHighlights=function(e){var t;if(e||(e=r.DEFAULT_HIGHLIGHT_LAYER_NAME),t=e instanceof c.HighlightLayer||e instanceof esri.layers.GraphicsLayer?e:this.getInternalHighlightLayer(e))for(var i in this._managedGraphics)if(this._managedGraphics.hasOwnProperty(i)){for(var h=this._managedGraphics[i].length-1;h>=0;h--){var a=this._managedGraphics[i][h];(t instanceof c.HighlightLayer&&a.highlightLayer===t.name||t instanceof esri.layers.GraphicsLayer&&this._highlightLayers[a.highlightLayer].graphicsLayer.id===t.id)&&(a.gcxFeature&&this.app.command("RemovePushpin").execute({feature:a.gcxFeature,tag:this._highlightLayers[a.highlightLayer].name}),this._highlightLayers[a.highlightLayer].remove(this._managedGraphics[i][h].outerBorderGraphic),this._highlightLayers[a.highlightLayer].remove(this._managedGraphics[i][h].innerBorderGraphic),this._managedGraphics[i].splice(h,1))}0==this._managedGraphics[i].length&&delete this._managedGraphics[i]}},e.prototype.refreshHighlights=function(e){var r=[];for(var h in this._managedGraphics)if(this._managedGraphics.hasOwnProperty(h))for(var a,o=this._managedGraphics[h],g=this,n=0;n<o.length;n++)!function(h){var n=o[h];if(e&&n.highlightLayer!==e)return"continue";var s=new i.Feature({graphic:n.managedGraphic}),l=void 0,c=g._highlightLayers[n.highlightLayer];if(!c)return"continue";var u=c.outerHighlightBorderRenderer.borderColor,d=c.innerHighlightBorderRenderer.borderColor,p=c.outerHighlightBorderRenderer.fillColor,y=c.outerHighlightBorderRenderer.borderWidth;s.borderColor&&s.borderColor.get()&&(l=t.getColorFromList(s.borderColor.get()))&&g.setHighlightBorderColor(l,n.highlightLayer),s.fillColor&&s.fillColor.get()&&(l=t.getColorFromList(s.fillColor.get()))&&g.setHighlightFillColor(l,n.highlightLayer),s.borderWidth&&s.borderWidth.get()&&(a=s.borderWidth.get())>0&&g.setBorderWidth(a,n.highlightLayer);var f=c.outerHighlightBorderRenderer.getSymbol(n.managedGraphic,n.originalSymbol);n.outerBorderGraphic.setSymbol(f),0===r.filter(function(e){return e===c.graphicsLayer.id}).length&&r.push(c.graphicsLayer.id),g.setOuterHighlightBorderColor(u,c),g.setInnerHighlightBorderColor(d,c),g.setHighlightFillColor(p,c),g.setBorderWidth(y,c)}(n);for(var s=0,l=r;s<l.length;s++){var c=l[s],u=this.app.map.getLayer(c);u&&u.redraw()}},e.prototype.redrawHighlights=function(e){var r=this;setTimeout(function(){var t={};for(var i in r._managedGraphics)if(r._managedGraphics.hasOwnProperty(i)){var h=r._managedGraphics[i];if(h)for(var a=0;a<h.length;a++){var o=h[a];!o||e&&o.highlightLayer!==e||(t[o.highlightLayer]||(t[o.highlightLayer]=[]),t[o.highlightLayer].push({feature:o.gcxFeature||o.managedGraphic,isFocused:o.highlightFocused}))}}for(var g in t)if(t.hasOwnProperty(g)){var n=t[g];r._highlightFeaturesImpl(n.filter(function(e){return!e.isFocused}).map(function(e){return e.feature}),g,!1),r._highlightFeaturesImpl(n.filter(function(e){return e.isFocused}).map(function(e){return e.feature}),g,!0),r._highlightLayers[g].graphicsLayer.redraw()}},0)},e.prototype.getInternalHighlightLayer=function(e){return e?this._highlightLayers[e]:this._highlightLayers[r.DEFAULT_HIGHLIGHT_LAYER_NAME]},e.prototype.getHighlightLayer=function(e){return this.app.trace.warning("highlightManager.getHighlightLayer is deprecated. Please use highlightManager.getInternalHighlightLayer instead to return the infrastructure.HighlightLayer object"),e?this._highlightLayers[e]?this._highlightLayers[e].graphicsLayer:null:this._highlightLayers[r.DEFAULT_HIGHLIGHT_LAYER_NAME].graphicsLayer},e.prototype.getInternalHighlightLayerOrActive=function(e){return e?this.getInternalHighlightLayer(e):this._activeHighlightLayer()},e.prototype.getHighlightLayerOrActive=function(e){this.app.trace.warning("highlightManager.getHighlightLayerOrActive is deprecated. Please use highlightManager.getInternalHighlightLayerOrActive instead to return the infrastructure.HighlightLayer instance.");var r;return(r=e?this.getInternalHighlightLayer(e):this._activeHighlightLayer())?r.graphicsLayer:null},e.prototype.activeHighlightLayerGraphics=function(){var e=this._activeHighlightLayer();return e&&e.graphics?e.graphics.slice(0):null},e.prototype.defaultHighlightLayerGraphics=function(){var e=this.getInternalHighlightLayer(r.DEFAULT_HIGHLIGHT_LAYER_NAME);return e?e.graphics.slice(0):null},e.prototype._highlightFeaturesImpl=function(e,h,o){if(void 0===h&&(h=""),void 0===o&&(o=!1),e&&e.length&&e[0]){h=h||r.DEFAULT_HIGHLIGHT_LAYER_NAME;var g=this.getOrCreateInternalHighlightLayer(h);if(g){for(var n=g.outerHighlightBorderRenderer.borderColor,s=g.innerHighlightBorderRenderer.borderColor,l=g.outerHighlightBorderRenderer.fillColor,c=g.outerHighlightBorderRenderer.borderWidth,u=[],d=0;d<e.length;d++){var p=e[d];if(p instanceof i.Feature){var y;if(p.borderColor&&p.borderColor.get()&&(y=t.getColorFromList(p.borderColor.get()))&&this.setHighlightBorderColor(y),p.fillColor&&p.fillColor.get()&&(y=t.getColorFromList(p.fillColor.get()))&&this.setHighlightFillColor(y),p.borderWidth&&p.borderWidth.get()){var f=p.borderWidth.get();f>=0&&this.setBorderWidth(f)}(H=this._highlightGraphic(p.esriFeature.get(),g,o,p))&&u.push(H),this.setOuterHighlightBorderColor(n,g),this.setInnerHighlightBorderColor(s,g),this.setHighlightFillColor(l,g),this.setBorderWidth(c,g)}else{var H=this._highlightGraphic(p,g,o);H&&u.push(H)}}for(var L=0;L<u.length;L++)a.moveGraphicToTop(u[L]);this._moveFocusGraphicsToTop()}}},e.prototype._highlightGraphic=function(e,r,t,i){if(void 0===t&&(t=!1),e&&e.geometry&&r){var h=this._getOrCreateMangedGraphic(e,r,i);if(!h)return null;var a=t?r.innerFocusBorderRenderer:r.innerHighlightBorderRenderer,o=t?r.outerFocusBorderRenderer:r.outerHighlightBorderRenderer;if(h.outerBorderGraphic.hide(),h.innerBorderGraphic.hide(),h.outerBorderGraphic.geometry){if(h.highlightFocused&&!t&&(h.highlightFocused=!1),t?h.highlightFocused=!0:h.highlightStandard=!0,this._supressedHighlightIds.indexOf(this._getHighlightId(h.managedGraphic))>-1)return h.gcxFeature&&this.app.command("RemovePushpin").execute({feature:h.gcxFeature,tag:r.name}),h.outerBorderGraphic.hide(),void h.innerBorderGraphic.hide();var g=o.getSymbol(h.outerBorderGraphic,h.originalSymbol),n=a.getSymbol(h.outerBorderGraphic,h.originalSymbol,!0);h.outerBorderGraphic.setSymbol(g),h.innerBorderGraphic.setSymbol(n),-1===r.graphics.indexOf(h.outerBorderGraphic)&&r.add(h.outerBorderGraphic),-1===r.graphics.indexOf(h.innerBorderGraphic)&&r.add(h.innerBorderGraphic),h.outerBorderGraphic.show(),h.innerBorderGraphic.show();var s=h.outerBorderGraphic.getNode();s&&s.setAttribute("style","pointer-events: none");var l=h.innerBorderGraphic.getNode();l&&l.setAttribute("style","pointer-events: none"),t&&this._addPushpinIfNeeded(h,r,i)}return h.innerBorderGraphic}},e.prototype._clearFeatureFocus=function(e,r){var i=this;if(e){var h=[];if(r)h.push(r);else for(var a in this._highlightLayers)this._highlightLayers.hasOwnProperty(a)&&h.push(this._highlightLayers[a]);h.forEach(function(h){i._refreshHighlightId(e);var a=i._retrieveManagedGraphic(e,h);if(a&&a.highlightFocused){if(a.gcxFeature&&i.app.command("RemovePushpin").execute({feature:a.gcxFeature,tag:a.highlightLayer}),!a.highlightStandard)return a.highlightFocused=!1,void i._clearFeatureHighlight(e,h);a.outerBorderGraphic,a.innerBorderGraphic;a.highlightFocused=!1;var o=h.outerHighlightBorderRenderer.borderColor,g=h.innerHighlightBorderRenderer.borderColor,n=h.outerHighlightBorderRenderer.fillColor,s=h.outerHighlightBorderRenderer.borderWidth;if(a.gcxFeature&&a.gcxFeature.borderColor&&a.gcxFeature.borderColor.get()&&(l=t.getColorFromList(a.gcxFeature.borderColor.get()))&&i.setHighlightBorderColor(l),a.gcxFeature&&a.gcxFeature.fillColor&&a.gcxFeature.fillColor.get()){var l=t.getColorFromList(a.gcxFeature.fillColor.get());l&&i.setHighlightFillColor(l)}if(a.gcxFeature&&a.gcxFeature.borderWidth&&a.gcxFeature.borderWidth.get()){var c=a.gcxFeature.borderWidth.get();c>=0&&i.setBorderWidth(c)}a.outerBorderGraphic.setSymbol(h.outerHighlightBorderRenderer.getSymbol(a.outerBorderGraphic,a.originalSymbol)),a.innerBorderGraphic.setSymbol(h.innerHighlightBorderRenderer.getSymbol(a.innerBorderGraphic,a.originalSymbol,!0)),i.setOuterHighlightBorderColor(o,r),i.setInnerHighlightBorderColor(g,r),i.setHighlightFillColor(n,r),i.setBorderWidth(s,r)}})}},e.prototype._clearFeatureHighlight=function(e,r){var t=this;if(e){var i=[];if(r)i.push(r);else for(var h in this._highlightLayers)this._highlightLayers.hasOwnProperty(h)&&i.push(this._highlightLayers[h]);i.forEach(function(r){var i=t._retrieveManagedGraphic(e,r);if(i)if(i.highlightFocused&&i.highlightStandard)i.highlightStandard=!1;else{i.highlightFocused&&i.gcxFeature&&t.app.command("RemovePushpin").execute({feature:i.gcxFeature,tag:r.name}),r.remove(i.outerBorderGraphic),r.remove(i.innerBorderGraphic);var h=t._getHighlightId(e);if(1===t._managedGraphics[h].length)delete t._managedGraphics[h];else{var a=t._managedGraphics[h].filter(function(e){return e.highlightLayer===r.name})[0];if(a){var o=t._managedGraphics[h].indexOf(a);t._managedGraphics[h].splice(o,1)}}}})}},e.prototype._getOrCreateMangedGraphic=function(e,r,t){var i=this._retrieveManagedGraphic(e,r);if(i)return i;var h=this._getHighlightId(e),a=this._getOrCreateHighlightGeometry(e.geometry,h);if(!a)return null;if(this._geometryExceedsMaxVertices(a))return dojo.isFunction(this.onMaxGeometryVerticesExceeded)&&this.onMaxGeometryVerticesExceeded(e),null;var o=new esri.Graphic(a,e.symbol?esri.symbol.fromJson(e.symbol.toJson()):null),g=new esri.Graphic(a,e.symbol?esri.symbol.fromJson(e.symbol.toJson()):null);this._setHighlightId(o,h),this._setHighlightId(g,h);var n=e.getLayer(),s=null;return s=n&&n.renderer?n.renderer.getSymbol(e):e.symbol,this._trackGraphic(e,o,g,r,s,null,t)},e.prototype._trackGraphic=function(e,r,t,i,h,a,o){var g,n=this._getHighlightId(e);this._managedGraphics.hasOwnProperty(n)?g=this._managedGraphics[n]:(g=[],this._managedGraphics[n]=g);for(var s=0;s<g.length;s++)if(g[s].highlightLayer===i.name)return g[s];o&&o.layer&&(a=o.layer.id);var l={originalLayer:a,highlightLayer:i.name,managedGraphic:e,outerBorderGraphic:r,innerBorderGraphic:t,originalSymbol:h,highlightStandard:!1,highlightFocused:!1,gcxFeature:o};return g.push(l),l},e.prototype._moveFocusGraphicsToTop=function(){var e=this;Object.keys(this._managedGraphics).forEach(function(r){e._managedGraphics[r].forEach(function(e){e.highlightFocused&&(a.moveGraphicToTop(e.outerBorderGraphic),a.moveGraphicToTop(e.innerBorderGraphic))})})},e.prototype._addPushpinIfNeeded=function(e,r,t){var h=e.innerBorderGraphic,a=h.geometry instanceof esri.geometry.Point||h.geometry instanceof esri.geometry.Multipoint;if(!a){var o=this.app.site.essentialsMap.allLayers().filter(function(r){return r.id===e.originalLayer})[0];o&&o.minScale&&o.minScale<this.app.map.getScale()?a=!0:e.gcxFeature&&this.app.command("RemovePushpin").execute({feature:e.gcxFeature,tag:r.name})}if(a){var g=t||new i.Feature({graphic:h});e.gcxFeature=g,e.gcxFeature.esriFeature.get().geometry=h.geometry,this.app.command("AddPushpin").execute({feature:g,tag:r.name}),this.app.command("ShowPushpins").execute()}},e.prototype._toARGBHex=function(e){return"#"+("00"+Math.floor(255*e.a).toString(16)).slice(-2)+("00"+e.r.toString(16)).slice(-2)+("00"+e.g.toString(16)).slice(-2)+("00"+e.b.toString(16)).slice(-2)},e.prototype._getHighlightId=function(e){if(e&&e.geometry){if(e[r.HIGHLIGHT_ID_PROPERTY])return e[r.HIGHLIGHT_ID_PROPERTY];var t=this._getGeometryHash(e.geometry);return e[r.HIGHLIGHT_ID_PROPERTY]=t,t}},e.prototype._getGeometryHash=function(e){return n.stringToHash(JSON.stringify(e,["rings","paths","points","x","y","xmax","ymax","xmin","ymin"])).toString()},e.prototype._getCachedGeometry=function(e){var r=this._geometryCache.filter(function(r){return r.highlightId===e});return r.length?r[0].geometry:null},e.prototype._cacheGeometry=function(e,r){this._geometryCache.unshift({highlightId:e,geometry:r}),this._geometryCache.length>this._maxGeomCacheItems&&(this._geometryCache.length=this._maxGeomCacheItems)},e.prototype._clearGeometryCache=function(){this._geometryCache.length=0},e.prototype._setHighlightId=function(e,t){e[r.HIGHLIGHT_ID_PROPERTY]=t},e.prototype._refreshHighlightId=function(e,t){t||(t=this._getHighlightId(e)),e[r.HIGHLIGHT_ID_PROPERTY]=null;var i=this._getHighlightId(e);if(i!==t&&this._managedGraphics[t]){this._managedGraphics[i]=this._managedGraphics[t],delete this._managedGraphics[t],this._managedGraphics[i].forEach(function(e){return e.managedGraphic[r.HIGHLIGHT_ID_PROPERTY]=i});var h=this._supressedHighlightIds.indexOf(t);h>-1&&(this._supressedHighlightIds.splice(h,1),this._supressedHighlightIds.push(i))}return i},e.prototype._activeHighlightLayer=function(){return this.activeHighlightLayerName?this.getInternalHighlightLayer(this.activeHighlightLayerName):null},e.prototype._shouldGeneralizeGeometry=function(e){if(this._ramerGeomGeneralizationDisabled)return!1;if(!e||!e.rings&&!e.paths)return!1;var r=0;return e instanceof esri.geometry.Polygon?e.rings.forEach(function(e){return r+=e.length}):e.paths.forEach(function(e){return r+=e.length}),r>this._ramerGeomVerticesThreshold&&this._ramerEpsilon>0},e.prototype._getOrCreateHighlightGeometry=function(e,r){if(!e)return null;if(!this._shouldGeneralizeGeometry(e)||!r)return esri.geometry.fromJson(e.toJson());var t=this._getCachedGeometry(r);return t||(t=l.getRamerDouglasPeuckerSimplifiedGeometry(e,this._ramerEpsilon),this._cacheGeometry(r,t)),t},e.prototype._geometryExceedsMaxVertices=function(e){if(!e||!e.rings&&!e.paths||0===this._maxHighlightableGeometryVertices)return!1;var r=0;return e instanceof esri.geometry.Polygon?e.rings.forEach(function(e){return r+=e.length}):e.paths.forEach(function(e){return r+=e.length}),r>this._maxHighlightableGeometryVertices},e.prototype._retrieveManagedGraphic=function(e,r){var t=null,i=this._getHighlightId(e);if(this._managedGraphics.hasOwnProperty(i))for(var h=0;h<this._managedGraphics[i].length;h++)if(this._managedGraphics[i][h].highlightLayer===r.name){t=this._managedGraphics[i][h];break}return t},e.prototype._getUniqueHighlightGraphicsLayerIds=function(){var e=this,r=Object.keys(this._highlightLayers).map(function(r){return e._highlightLayers[r].graphicsLayer.id});return d.ArrayUtils.unique(r)},e.prototype.exportState=function(){var e=this;return Promise.try(function(){for(var r=e.app.project.convert,t={highlightLayers:{},activeHighlightLayerName:e.activeHighlightLayerName,highlights:[]},i=0,h=e._getUniqueHighlightGraphicsLayerIds();i<h.length;i++){var a=h[i],o=e.app.map.getLayer(a);o&&(t.highlightLayers[a]=r.fromEsriLayer(o),t.highlightLayers[a].layers=[],t.highlightLayers[a].featureCollection.layers=[])}for(var g in e._managedGraphics)e._managedGraphics[g].forEach(function(i){i.highlightFocused&&!i.highlightStandard||t.highlights.push({feature:r.fromEsriGraphic(i.managedGraphic),originalLayer:i.originalLayer,highlightLayer:i.highlightLayer,useDefaultHighlightLayer:e._highlightLayers[i.highlightLayer].graphicsLayer.id===u.HIGHLIGHT_LAYER_ID})});return t})},e.prototype.applyState=function(e){var r=this,t=this.app.project.convert,i={};for(var g in e.highlightLayers)i[g]=t.toEsriLayer(e.highlightLayers[g]);var n={highlightLayers:h.PromiseUtils.propsSkipRejected(i),highlights:h.PromiseUtils.mapSkipRejected(e.highlights,function(e){return Promise.props({graphic:t.toEsriGraphic(e.feature),originalLayer:e.originalLayer,highlightLayer:e.highlightLayer,useDefaultHighlightLayer:e.useDefaultHighlightLayer})})};return Promise.props(n).then(function(t){d.ArrayUtils.unique(Object.keys(r._highlightLayers).map(function(e){return r._highlightLayers[e].graphicsLayer.id})).forEach(function(e){var t=r.app.map.getLayer(e);t&&t.clear()}),r._highlightLayers={},r._managedGraphics={};for(var i in t.highlightLayers)t.highlightLayers.hasOwnProperty(i)&&s.addToGraphicsLayerIdsToExclude([o.ExcludeFromEnum.ExportApplyStateName,o.ExcludeFromEnum.WebMapName],i);r.activeHighlightLayerName=e.activeHighlightLayerName;for(var h=[],g=0;g<t.highlights.length;g++)!function(e){var i=t.highlights[e],a=i.useDefaultHighlightLayer?u.HIGHLIGHT_LAYER_ID:i.highlightLayer,g=o.getInternalGraphicsLayer(a,r.app,o.GraphicsLayerType.Highlight);r._highlightLayers[i.highlightLayer]||r.getOrCreateInternalHighlightLayer(i.highlightLayer,null,null,i.useDefaultHighlightLayer);r._getHighlightId(i.graphic);var n=g.graphics.filter(function(e){return r._getHighlightId(e)===r._getHighlightId(i.graphic)});if(n.length>0){var s=n[0],l=n[1]||new esri.Graphic(s.toJson());r._trackGraphic(i.graphic,s,l,r._highlightLayers[i.highlightLayer],null).highlightStandard=!0}else{var c=r._highlightGraphic(i.graphic,r._highlightLayers[i.highlightLayer]);c&&h.push(c)}}(g);for(var n=0;n<h.length;n++)a.moveGraphicToTop(h[n])})},e}();r.HighlightManager=p})}}});require({cache:{"geocortex/infrastructure/HtmlUtils":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pollUntil=function(e,t,n){return new Promise(function(r,i){if((void 0===t||null===t||t<1)&&(t=500),(void 0===n||null===n||n<1)&&(n=2e4),e())r();else var l=(new Date).getTime(),u=setInterval(function(){e()?(clearInterval(u),r()):(new Date).getTime()-l>n&&(clearInterval(u),i("timeout"))},t)})}})}}});require({cache:{"geocortex/infrastructure/identify/GraphicsLayerIdentifyProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","./IdentifyProviderBase","../FeatureSet","../FeatureAttribute","geocortex/essentials/Field","geocortex/framework/utils/ArrayUtils","../GraphicUtils","../NumberFormat","../PresentableDelegateFactory","../GraphicsLayerIds"],function(t,i,r,a,n,s,o,l,u,c,p){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var f=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._cancelled=!1,e._searching=!1,e._delayedFscOpen=null,e._numFractionalDigits=null,e._fscCollectionOpen=!1,e}return e(i,t),i.prototype.initialize=function(e){var t=this.app.configModel.moduleConfigs.filter(function(e){return"Measurement"===e.moduleName});t&&t[0]&&t[0].configuration?this._numFractionalDigits=t[0].configuration.measurementFractionalDigits:this._numFractionalDigits=null},i.prototype.cancelSearch=function(){this._searching&&(this._cancelled=!0),this._searching=!1},i.prototype.search=function(e,t){var i=this;return new Promise(function(r,a){if(i._fscCollectionOpen=!1,i._delayedFscOpen=null,t.delayFSCOpen){var n=e.id,s=!1;i._delayedFscOpen=function(){s||(s=!0,i.app.featureSetManager.openCollection(n),i._fscCollectionOpen=!0)}}else i.app.featureSetManager.openCollection(e.id),i._fscCollectionOpen=!0;i._searching=!0,Promise.resolve({featureSetCollection:e,identifyArgs:t,layerInfos:void 0,graphicsLayers:void 0,featureSets:void 0}).then(function(e){return i._getClickableLayers(e)}).then(function(e){return i._processLayerInfos(e)}).then(function(e){return i._performSearch(e)}).catch(function(e){i.app.trace.warning("Unable to search within clickable layers: "+e.message)}).finally(function(){i._searching=!1,i._clear(),i._fscCollectionOpen&&(i.app.featureSetManager.tryCloseCollection(e.id),i._fscCollectionOpen=!1),r()})})},i.prototype._getClickableLayers=function(e){return this._verifyNotCancelled(),e.layerInfos=this.app.clickableGraphics.getLayerInfos(),this._delayedFscOpen&&e.layerInfos.length>0&&this._delayedFscOpen(),e},i.prototype._processLayerInfos=function(e){var t=this;this._verifyNotCancelled();var i=(e.layerInfos||[]).map(function(e){return t.app.map.getLayer(e.graphicsLayerId)}).filter(function(i){return null!=i&&i instanceof esri.layers.GraphicsLayer&&i.visible&&i.visibleAtMapScale&&t._checkAndReturnLayerRestriction(i,e)});return e.graphicsLayers=i,e},i.prototype._checkAndReturnLayerRestriction=function(e,t){var i=this._findMatchingEssentialsLayer(e);switch(t.identifyArgs.source){case"Identify":return!i||i.identifiable;case"MapTip":return!i||i.showMapTips;default:return!1}},i.prototype._performSearch=function(e){var t=this;return Promise.reduce(e.graphicsLayers,function(i,r,a){t._verifyNotCancelled();var n=e.featureSetCollection;return t._searchGraphicsLayer(r,e).then(function(e){return t._addToResultsCollection(e,n)})},null).return(e)},i.prototype._searchGraphicsLayer=function(e,t){var i=this,r=e.graphics.slice(0).reverse();return Promise.resolve(r).then(function(e){return i._findIntersectedGraphics(e,t)}).then(function(t){return i._createFeatureSet(t,e)}).then(function(r){return i._processFeatureSet(r,e,t)})},i.prototype._findIntersectedGraphics=function(e,t){var i=this,r=t.identifyArgs;return Promise.filter(e,function(e){return i._intersects(e,r)})},i.prototype._intersects=function(e,t){var i="polygon"===e.geometry.type?t.polygonPixelTolerance:t.pixelTolerance,r=this.applyTolerance(t.geometry,i);return l.geometryIntersectsGraphic(r,e,this.app).catch(function(){return!1})},i.prototype._findMatchingEssentialsLayer=function(e){if(e.id!==p.MARKUP_LAYER_ID&&this.app.site&&this.app.site.essentialsMap){var t=this.app.site.essentialsMap.mapServices.filter(function(t){return t.serviceLayer===e});if(1===t.length&&1===t[0].layers.length)return t[0].layers[0]}return null},i.prototype._createFeatureSet=function(e,t){if(e&&e.length>0){var i=new esri.tasks.FeatureSet;i.features=e;var r,n,s=null;return(s=this._findMatchingEssentialsLayer(t))||(r=t.id,n=u.NumberFormat.NUMBER+this._numFractionalDigits),new a.FeatureSet({esriFeatureSet:i,app:this.app,defaultNumberFormat:n,id:r,layer:s})}return null},i.prototype._processFeatureSet=function(e,t,i){if(!e)return null;if(!e.layer){var r=this._getLayerInfoFromContext(t,i),a=r?r.displayName:"",n=this._createAttributes();e.displayName.set(a),e.attributes.set(n),this._addFeatureSetAttributes(n),e.attributes.set(n);for(var s=0;s<e.features.length();s++){var o=e.features.getAt(s);this._processFeature(o,r)}}return t instanceof esri.layers.WFSLayer&&e.features.get().forEach(function(e){var t=e.attributes.getAt(0);t&&"gml:id"===t.name.get()&&!t.value.get()&&t.visible.set(!1)}),e},i.prototype._createAttributes=function(){var e=[];return e.push(new n.FeatureAttribute("","Name","Name",null,!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString)),e},i.prototype._processFeature=function(e,t){if(!e||!t)return e;var i=this._getDisplayNameForGraphic(e.esriFeature.get(),t),r=this._createAttributes();e.labelFormat.set(i),e.descriptionFormat.set(""),e.attributes.set(r);for(var a=0;a<e.attributes.length();a++){var n=e.attributes.getAt(a),s=n.name.get();n.value.get();switch(s){case"Name":n.value.set(i),n.presentableValue.set(i)}}return this._isMeasurement(e.esriFeature.get())?this._populateAttributesForMeasurementMarkup(e):this._populateFeatureAttributes(e,t),e},i.prototype._addFeatureSetAttributes=function(e){var t=new n.FeatureAttribute("","Length","Length",this.getResource("language-common-measurement-results-field-length"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString);e.push(t),t=new n.FeatureAttribute("","Units","Units",this.getResource("language-common-measurement-results-field-units"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString),e.push(t),t=new n.FeatureAttribute("","Area","Area",this.getResource("language-common-measurement-results-field-area"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString),e.push(t),t=new n.FeatureAttribute("","Area Units","Area Units",this.getResource("language-common-measurement-results-field-area-units"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString),e.push(t)},i.prototype._populateFeatureAttributes=function(e,t){var i=e.esriFeature.get().attributes,r="";for(var a in i)if(t&&t.aliases&&t.aliases[a]){o=new n.FeatureAttribute(e.esriFeature.get().attributes[a],a,t.aliases[a],t.aliases[a],!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString);e.attributes.addItem(o),r=r+t.aliases[a]+": {"+a+"}\n"}else if(!a.startsWith("_")){var o=new n.FeatureAttribute(e.esriFeature.get().attributes[a],a,a,a,!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString);e.attributes.addItem(o),r=r+a+": {"+a+"}\n"}e.descriptionFormat.set(r)},i.prototype._populateAttributesForMeasurementMarkup=function(e){var t=e.attributes.get();switch(e.esriFeature.get().geometry.type){case"polyline":e.descriptionFormat.set(this.getResource("language-clickable-graphics-measurement-description-polyline"));i=new n.FeatureAttribute(e.esriFeature.get().attributes.Length,"Length","Length",this.getResource("language-common-measurement-results-field-length"),!0,c.PresentableDelegateFactory.valuePresenterDelegate(null,e),s.EssentialsFieldTypes.essentialsFieldTypeString);t.push(i),i=new n.FeatureAttribute(e.esriFeature.get().attributes.Units,"Units","Units",this.getResource("language-common-measurement-results-field-units"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString),t.push(i);break;case"polygon":e.descriptionFormat.set(this.getResource("language-clickable-graphics-measurement-description-polygon"));var i=new n.FeatureAttribute(e.esriFeature.get().attributes.Length,"Length","Length",this.getResource("language-common-measurement-results-field-length"),!0,c.PresentableDelegateFactory.valuePresenterDelegate(null,e),s.EssentialsFieldTypes.essentialsFieldTypeString);t.push(i),i=new n.FeatureAttribute(e.esriFeature.get().attributes.Units,"Units","Units",this.getResource("language-common-measurement-results-field-units"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString),t.push(i),i=new n.FeatureAttribute(e.esriFeature.get().attributes.Area,"Area","Area",this.getResource("language-common-measurement-results-field-area"),!0,c.PresentableDelegateFactory.valuePresenterDelegate(null,e),s.EssentialsFieldTypes.essentialsFieldTypeString),t.push(i),i=new n.FeatureAttribute(e.esriFeature.get().attributes["Area Units"],"Area Units","Area Units",this.getResource("language-common-measurement-results-field-area-units"),!0,null,s.EssentialsFieldTypes.essentialsFieldTypeString),t.push(i)}},i.prototype._addToResultsCollection=function(e,t){e&&t.featureSets.addItem(e)},i.prototype._getLayerInfoFromContext=function(e,t){var i=null;return e&&t&&(i=o.firstOrDefault(t.layerInfos||[],function(t){return t.graphicsLayerId&&t.graphicsLayerId===e.id})),i},i.prototype._getDisplayNameForGraphic=function(e,t){if(!e)return null;var i,r=this.getResource("language-clickable-graphics-label-format");t&&(i=t.displayName),this._isMeasurement(e)&&(i=this.getResource("language-clickable-graphics-label-measurement")),i||(i=this.getResource("language-clickable-graphics-label-default"));var a=e.getLayer(),n=a&&a.graphics?a.graphics.indexOf(e)+1:-1,s=n>0?n.toString():"";return r.format(i,s)},i.prototype._isMeasurement=function(e){var t=e.measurementId;return null!==t&&void 0!==t},i.prototype._clear=function(){this._searching=!1,this._cancelled=!1},i.prototype._verifyNotCancelled=function(){if(this._cancelled)throw new Error("GraphicsLayerIdentifyProvider: Operation cancelled")},i}(r.IdentifyProviderBase);i.GraphicsLayerIdentifyProvider=f})},"geocortex/infrastructure/identify/IdentifiableLayerInfo":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/identify/IdentifiableLayersInMapService":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/identify/IdentifyProviderBase":function(){define(["require","exports","./../GeometryUtils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.pixelTolerance=5,this.polygonPixelTolerance=2,this.app=e,this.libraryId=t}return e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e.prototype.applyTolerance=function(e,t){return e&&"point"===e.type?i.createToleranceEnvelope(this.app.map,e,t):e},e}();t.IdentifyProviderBase=r})},"geocortex/infrastructure/identify/IdentifyUtils":function(){define(["require","exports","geocortex/essentials/LayerType","../FeatureSetCollection","geocortex/essentials/Field","../FeatureSet","../GraphicUtils","geocortex/essentials/MapServiceConstants","../Feature","../KmlFeature","../NumberFormat","../DateFormat"],function(e,t,i,r,a,n,s,o,l,u,c,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIdentifyLayerIds=function(e,t,r,a,n,s,o,l){var u=new Array;if(!1===n||e.isVisible())for(var c=e.essentialsMap.site.essentialsMap.calculateScale(),p=0;p<e.layers.length;p++){var f=e.layers[p];if(!l||f.type!==i.LayerType.RASTER_LAYER){var y=f.identifiableAtAllScales||!1===s||f.withinScaleRange(c),d=f.isVisible()&&f.areAllAncestorsVisible();(null==o||-1!==$.inArray(f.id,o))&&(d||!1===a)&&y&&t(f)&&(null==r||0==r.length||dojo.indexOf(r,f.featureType)>=0)&&u.push(f.id)}}return u},t.getLayerDefinitions=function(e,t){var i=[];if(e.serviceLayer.layerDefinitions)for(var r=e.serviceLayer.layerDefinitions,a=0;a<r.length;a++)if(r[a])for(var n=0;n<t.length;n++)if(t[n]==a.toString()){i[a]=r[a];break}return i},t.getDynamicLayerInfos=function(e,t){for(var i=[],r=0;r<t.length;r++){var a=e.getDynamicLayerInfoById(t[r]);a&&i.push(a)}return i},t.appendToFeatureSetCollection=function(e,t,f,y){null==t&&(t=new r.FeatureSetCollection);for(var d=new Object,h=0;h<e.length;h++){var m=e[h];if(null==(M=d[m.layerId])){var g=f.findLayerById(m.layerId.toString());if(g&&g.type===i.LayerType.RASTER_LAYER){if(m.feature&&m.feature.attributes&&$.isEmptyObject(m.feature.attributes))return;var v=0,_=0;for(var T in m.feature.attributes)m.feature.attributes.hasOwnProperty(T)&&(_++,"NoValue"!==(k=m.feature.attributes[T])&&"NoData"!==k||v++);if(v===_)continue}var F=new Object;if(g)for(var I=0;I<g.fields.length;I++){var S=g.fields[I];F[S.alias]=S}if(g&&g.type===i.LayerType.RASTER_LAYER&&g.fields)if(0===g.fields.length){if(m.feature.attributes)for(var T in m.feature.attributes){var k=m.feature.attributes[T];g.fields.push(new a.Field({layer:g,displayName:T,dataType:a.EssentialsFieldTypes.essentialsFieldTypeString,alias:T,hyperlinkLabel:"",name:T,searchable:!0,visible:!0}))}}else for(var b in m.feature.attributes)if("Pixel value"===b)for(h=0;h<g.fields.length;h++)if("VALUE"===g.fields[h].name){g.fields[h].name="Pixel value";break}var L=null;if(m.displayFieldName){var C=F[m.displayFieldName];C&&C.name&&(L=C.name)}L||(L=g&&g.displayField?g.displayField.name:g&&g.primaryKeyField&&g.primaryKeyField.name?g.primaryKeyField.name:m.displayFieldName);var x=new esri.tasks.FeatureSet({displayFieldName:L,features:[]});m.feature.geometry&&(x.geometryType=m.feature.geometry.type,x.spatialReference=m.feature.geometry.spatialReference),M=new n.FeatureSet({esriFeatureSet:x,layer:g,app:this.app}),g?M.displayName.set(g.displayName):M.displayName.set(m.layerName),d[m.layerId]=M}M.layer&&s.sanitizeAttributeNames(m.feature,M.layer),M.esriFeatureSet.features.push(m.feature);var w={graphic:m.feature,layer:M.layer,resolveLayerFields:!0,allowUnsafeContent:!1};f.drawingBehavior===o.DrawingBehavior.KML_SERVICE&&(w.allowUnsafeContent=y.configuration.allowUnsafeContent),m.feature._graphicsLayer&&(w.featureLayer=m.feature._graphicsLayer);var E;f.drawingBehavior===o.DrawingBehavior.KML_SERVICE?((E=new u.KmlFeature(w)).defaultNumberFormat=f.defaultNumberFormat?f.defaultNumberFormat:c.NumberFormat.DEFAULT,E.defaultDateFormat=f.defaultDateFormat?f.defaultDateFormat:p.DateFormat.DEFAULT):E=new l.Feature(w),M.features.addItem(E)}for(var O in d)if(d.hasOwnProperty(O)){var M=d[O];t.featureSets.addItem(M),M.resolveDataLinks(function(e){y.event("FeatureChangedEvent").publish(e)})}return t}})},"geocortex/infrastructure/identify/LayerDescriptor":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/identify/MapIdentifyTask":function(){define(["require","exports","geocortex/essentials/GeometryUtilities","../GeometryUtils","./IdentifyUtils","../TaskUtils","geocortex/essentials/LayerType","geocortex/essentials/MapServiceConstants"],function(e,t,i,r,a,n,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1,this._isCancelled=!1,this.app=null,this.map=null,this.tag=null,this.extent=null,this.width=null,this.height=null,this.topMostLayerOnly=!1,this.returnGeometry=!1,this.visibleLayersOnly=!0,this.visibleMapServicesOnly=!0,this.layersInVisibleScaleRangeOnly=!0,this.pixelTolerance=5,this.polygonPixelTolerance=2,this.allServicesInError=!1,this.mapServicesAndLayersToIdentify=null,this.restrictRasterIdentifyToPoint=!0,this.delayedFSCOpen=null,this.layerRestriction=null,this.app=t||null,this.map=e}return e.prototype._checkAndReturnLayerRestriction=function(){var e=this.layerRestriction;return e||(e=function(e){return e.identifiable&&e.supportsIdentify}),e},e.prototype.execute=function(e,t,a,n,s){var l=this,u=this._checkAndReturnLayerRestriction();if(this.app&&e&&"polygon"==e.type&&i.isSelfIntersectingPolygon(e)&&!s){r.simplifyPolygon(e,function(e){l.execute(e,t,a,n,!0)},function(e){l.app.trace.warning("An error occurred while attempting to simplify the identify geometry. Make sure that your proxy is configured correctly."),n(l,e,null)},this.app)}else{this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1,this.allServicesInError=!1;var c=new esri.tasks.IdentifyParameters;c.tolerance=this.pixelTolerance,c.returnGeometry=this.returnGeometry,this.topMostLayerOnly?c.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_TOP:c.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_ALL,c.width=this.width||this.map.width,c.height=this.height||this.map.height,c.mapExtent=this.extent||this.map.extent,c.geometry=e,this.app.map.timeExtent&&(this.app.map.timeExtent.startTime||this.app.map.timeExtent.endTime)&&(c.timeExtent=new esri.TimeExtent(this.app.map.timeExtent.startTime,this.app.map.timeExtent.endTime));for(var p=0;p<this.app.site.essentialsMap.mapServices.length;p++){var f=this.app.site.essentialsMap.mapServices[p];if(!(f.serviceLayer&&f.serviceLayer instanceof esri.layers.StreamLayer)&&!(f.serviceLayer&&f.serviceLayer instanceof esri.layers.WFSLayer&&f.userLayerType==o.UserLayerType.LAYER_ADDITION))if(f.serviceLayer&&f.serviceLayer instanceof esri.layers.FeatureLayer)this._handleFeatureLayer(e,f,f.serviceLayer,c,u,t,a,n);else if(f.serviceLayer instanceof esri.layers.KMLLayer)for(var y=f.serviceLayer.getLayers(),d=0;d<y.length;d++)y[d]instanceof esri.layers.FeatureLayer&&this._handleFeatureLayer(e,f,y[d],c,u,t,a,n);else f.serviceLayer instanceof esri.layers.WMSLayer||f.serviceLayer instanceof esri.layers.WFSLayer?this._handleWMSLayer(f,c,u,t,a,n):f.serviceLayer instanceof esri.layers.ArcGISImageServiceLayer||this._handleLayer(f,c,u,t,a,n)}this._taskExecutionComplete=!0,this._conditionallyInvokeCompleteCallback(this,a)}},e.prototype._handleWMSLayer=function(e,t,i,r,a,n){for(var s=this._getLayersToIdentifyForMapService(e,null,i,!0),o=s.length>0,l=0,u=s;l<u.length;l++){var c=u[l];if(!e.findLayerById(c.toString()).supportsQuery){o=!1;break}}o?this._handleLayer(e,t,i,r,a,n):this._handleLayerLegacy(e,t,i,r,a,n)},e.prototype._handleLayerLegacy=function(e,t,i,r,s,o){var l=this,u=(e.serviceUrl,dojo.clone(t));u.layerIds=a.getIdentifyLayerIds(e,i,["Polygon"],this.visibleLayersOnly,this.visibleMapServicesOnly),u.tolerance=this.polygonPixelTolerance;var c=dojo.clone(t);c.layerIds=a.getIdentifyLayerIds(e,i,["None","Point","Multipoint","Line"],this.visibleLayersOnly,this.visibleMapServicesOnly);var p=[u,c];this.delayedFSCOpen&&(u.layerIds.length>0||c.layerIds.length>0)&&this.delayedFSCOpen();for(var f=[],y=0;y<p.length;y++){var d=p[y];if(d.layerIds.length>0){this._identifyTaskExecutedCount++;var h=d.layerIds.map(function(e){return e.toString()});d.layerDefinitions=a.getLayerDefinitions(e,h),d.dynamicLayerInfos=a.getDynamicLayerInfos(e,h),d.spatialReference=this.app.map.extent.spatialReference;var m=n.getIdentifyTask(e);f.push(m.execute(d).then(function(t){l._isCancelled||r(l,t,e)}))}}Promise.all(f).then(function(){l._identifyTaskCompletedCount++,l._conditionallyInvokeCompleteCallback(l,s)}).catch(function(t){l._isCancelled||(l._identifyTaskCompletedCount++,l._identifyTaskErrorCount++,o(l,t,e))})},e.prototype._handleLayer=function(e,t,i,o,l,u){var c=this,p=this._getLayersToIdentifyForMapService(e,null,i,!0);this._identifyTaskExecutedCount++,this.delayedFSCOpen&&this.delayedFSCOpen();for(var f,y,d,h=[],m=[],g=Promise.defer(),v=p.map(function(e){return e.toString()}),_=a.getLayerDefinitions(e,v),T=function(t,i,r){if(!c._isCancelled){var a=c._queryResultToIdentifyResults(t,i,r,t.displayFieldName);o(c,a,e)}},F=this,I=0,S=p;I<S.length;I++)!function(i){if(f=e.findLayerById(i.toString()),y=n.getQueryTask(f),d=new esri.tasks.Query,!f.supportsQuery)return"continue";d.outFields=["*"],d.outSpatialReference=F.app.map.spatialReference,d.returnGeometry=t.returnGeometry,d.where=_[i],F.app.map.timeExtent&&(F.app.map.timeExtent.startTime||F.app.map.timeExtent.endTime)&&(d.timeExtent=new esri.TimeExtent(F.app.map.timeExtent.startTime,F.app.map.timeExtent.endTime)),"Polygon"===f.featureType?(d.geometry=r.createToleranceEnvelope(F.map,t.geometry,F.polygonPixelTolerance),m.push(y.execute(d).then(function(e){return g.promise.then(function(){return T(e,i,f.name)})}))):(d.geometry=r.createToleranceEnvelope(F.map,t.geometry,F.pixelTolerance),h.push(y.execute(d).then(function(e){return T(e,i,f.name)})))}(S[I]);if("point"===t.geometry.type||!this.restrictRasterIdentifyToPoint){var k=dojo.clone(t);if(k.layerIds=this._getLayersToIdentifyForMapService(e,null,i,!1),k.layerIds=k.layerIds.filter(function(t){return e.findLayerById(t.toString()).type===s.LayerType.RASTER_LAYER}),k.layerIds.length>0){k.spatialReference=this.app.map.extent.spatialReference;var b=n.getIdentifyTask(e);h.push(b.execute(k).then(function(t){c._isCancelled||(c._assignSpatialReferences(t),o(c,t,e))}))}}Promise.all(h).then(function(){return g.resolve(),Promise.all(m).then(function(){c._identifyTaskCompletedCount++,c._conditionallyInvokeCompleteCallback(c,l)})}).catch(function(t){c._isCancelled||(c._identifyTaskCompletedCount++,c._identifyTaskErrorCount++,u(c,t,e))})},e.prototype._assignSpatialReferences=function(e){for(var t=0;t<e.length;++t){var i=e[t];i.feature.geometry&&(i.feature.geometry.spatialReference=this.app.map.extent.spatialReference)}},e.prototype._getLayersToIdentifyForMapService=function(e,t,i,r){if(!this.mapServicesAndLayersToIdentify)return a.getIdentifyLayerIds(e,i,t,this.visibleLayersOnly,this.visibleMapServicesOnly,this.layersInVisibleScaleRangeOnly,null,r);for(var n=0;n<this.mapServicesAndLayersToIdentify.length;n++)if(this.mapServicesAndLayersToIdentify[n].mapServiceId===e.id)return a.getIdentifyLayerIds(e,i,t,this.visibleLayersOnly,this.visibleMapServicesOnly,this.layersInVisibleScaleRangeOnly,this.mapServicesAndLayersToIdentify[n].layerIds,r)},e.prototype._handleFeatureLayer=function(e,t,i,a,s,l,u,c){var p=this;if(a.layerIds=this._getLayersToIdentifyForMapService(t,null,s,!1),a.layerIds.length>0||t.drawingBehavior==o.DrawingBehavior.KML_SERVICE){this.delayedFSCOpen&&this.delayedFSCOpen();var f=new esri.tasks.Query;f.geometry=e,"point"===e.type?t.heatMap&&t.heatMap.enabled?f.geometry=r.createToleranceEnvelope(this.map,e,t.heatMap.intensity):f.geometry=r.createToleranceEnvelope(this.map,e,this.pixelTolerance):t.drawingBehavior===o.DrawingBehavior.KML_SERVICE&&(f.geometry=e.getExtent()),f.outFields=["*"],f.outSpatialReference=this.app.map.spatialReference,f.returnGeometry=!0,this.app.map.timeExtent&&(this.app.map.timeExtent.startTime||this.app.map.timeExtent.endTime)&&(f.timeExtent=new esri.TimeExtent(this.app.map.timeExtent.startTime,this.app.map.timeExtent.endTime)),this._identifyTaskExecutedCount++;var y=function(e,t){var r;r=t.essentialsMap&&t.essentialsMap.getMap&&e.isVisibleAtScale(t.essentialsMap.getMap().getScale())?e.queryFeatures(f):n.getQueryTask(e,t).execute(f);var a=p;r.then(dojo.hitch(t,function(e){if(!a._isCancelled){var t=this,r=a._queryResultToIdentifyResults(e,i.layerId,i.name,i.displayField);r.forEach(function(e){e.feature._graphicsLayer=i}),a._identifyTaskCompletedCount++,l(a,r,t),a._conditionallyInvokeCompleteCallback(a,u)}}),dojo.hitch(t,function(e){if(!a._isCancelled){var t=this;a._identifyTaskCompletedCount++,a._identifyTaskErrorCount++,c(a,e,t),a._conditionallyInvokeCompleteCallback(a,u)}}))};if(i.updating)var d=dojo.connect(i,"onUpdateEnd",function(){y(i,t),dojo.disconnect(d)});else y(i,t)}},e.prototype._queryResultToIdentifyResults=function(e,t,i,r){var a=[];if(e&&e.features&&e.features.length>0)for(var n=0;n<e.features.length;n++)a.push({feature:e.features[n],displayFieldName:r,layerId:t,layerName:i});return a},e.prototype._conditionallyInvokeCompleteCallback=function(e,t){e._taskExecutionComplete&&e._identifyTaskExecutedCount==e._identifyTaskCompletedCount&&(e.allServicesInError=e._identifyTaskExecutedCount==e._identifyTaskErrorCount,t(e))},e.prototype.cancel=function(){this._isCancelled=!0},e}();t.MapIdentifyTask=l})},"geocortex/infrastructure/identify/MapIdentifyTaskIdentifyProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","./IdentifyProviderBase","./MapIdentifyTask","./IdentifyUtils"],function(t,i,r,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._identifyTask=null,e.defaultPixelTolerance=5,e.defaultPolygonPixelTolerance=2,e._pixelTolerance=null,e._polygonPixelTolerance=null,e._topMostLayerOnly=null,e._returnGeometry=null,e._visibleLayersOnly=null,e._layersInVisibleScaleRangeOnly=null,e}return e(i,t),i.prototype.initialize=function(e){null!=e.pixelTolerance&&(this._pixelTolerance=e.pixelTolerance),null!=e.polygonPixelTolerance&&(this._polygonPixelTolerance=e.polygonPixelTolerance),null!=e.visibleLayersOnly&&(this._visibleLayersOnly=!!e.visibleLayersOnly),null!=e.layersInVisibleScaleRangeOnly&&(this._layersInVisibleScaleRangeOnly=!!e.layersInVisibleScaleRangeOnly),null!=e.topMostLayerOnly&&(this._topMostLayerOnly=!!e.topMostLayerOnly),null!=e.returnGeometry&&(this._returnGeometry=!!e.returnGeometry)},i.prototype.search=function(e,t){var i=this;return new Promise(function(r,n){var s=null;if(t.delayFSCOpen){var o=e.id,l=!1;s=function(){l||(l=!0,i.app.featureSetManager.openCollection(o))}}else i.app.featureSetManager.openCollection(e.id);i._identifyTask=new a.MapIdentifyTask(i.app.map,i.app),i._identifyTask.tag=e,i._identifyTask.pixelTolerance=null!=i._pixelTolerance?i._pixelTolerance:t.pixelTolerance,i._identifyTask.polygonPixelTolerance=null!=i._polygonPixelTolerance?i._polygonPixelTolerance:t.polygonPixelTolerance,i._identifyTask.topMostLayerOnly=null!=i._topMostLayerOnly?i._topMostLayerOnly:!!t.topMostLayerOnly,i._identifyTask.returnGeometry=null!=i._returnGeometry?i._returnGeometry:!!t.returnGeometry,i._identifyTask.layersInVisibleScaleRangeOnly=null!=i._layersInVisibleScaleRangeOnly?i._layersInVisibleScaleRangeOnly:!!t.layersInVisibleScaleRangeOnly,i._identifyTask.restrictRasterIdentifyToPoint=!!t.restrictRasterIdentifyToPoint,t.identifiableLayerInfo&&(i._identifyTask.mapServicesAndLayersToIdentify=t.identifiableLayerInfo),isNaN(i._identifyTask.pixelTolerance)&&(i._identifyTask.pixelTolerance=i.defaultPixelTolerance),isNaN(i._identifyTask.polygonPixelTolerance)&&(i._identifyTask.polygonPixelTolerance=i.defaultPolygonPixelTolerance),t.extent&&(i._identifyTask.extent=t.extent),t.width&&(i._identifyTask.width=t.width),t.height&&(i._identifyTask.height=t.height),null!==t.visibleLayersOnly&&(i._identifyTask.visibleLayersOnly=t.visibleLayersOnly),null!==t.visibleMapServicesOnly&&(i._identifyTask.visibleMapServicesOnly=t.visibleMapServicesOnly),t.layerRestriction&&(i._identifyTask.layerRestriction=t.layerRestriction),s&&(i._identifyTask.delayedFSCOpen=s),i._identifyTask.execute(t.geometry,function(e,t,r){i.identifyTaskProgress(e,t,r)},function(e){i.identifyTaskComplete(e),r()},function(e,t,r){i.identifyTaskError(e,t,r)})})},i.prototype.identifyTaskProgress=function(e,t,i){var r=e.tag;n.appendToFeatureSetCollection(t,r,i,this.app)},i.prototype.identifyTaskComplete=function(e){var t=e.tag;this.app.featureSetManager.tryCloseCollection(t.id)},i.prototype.identifyTaskError=function(e,t,i){var r=e.tag;this.app.featureSetManager.tryCloseCollection(r.id);var a=this.getResource("language-identify-error-message",null).format(t.message,t.details);this.app.command("Alert").execute(a),i&&this.app.trace.error("Error performing identify operation on service {0}. Message: {1}. Error details: {2}.".format(i.serviceLayer.url,t.message,t.details))},i.prototype.cancelSearch=function(){this._identifyTask&&this._identifyTask.cancel()},i}(r.IdentifyProviderBase);i.MapIdentifyTaskIdentifyProvider=s})},"geocortex/infrastructure/identify/RasterIdentifyTask":function(){define(["require","exports","geocortex/essentials/MapServiceConstants","../TaskUtils","../GeometryUtils"],function(e,t,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1,this._isCancelled=!1,this._featureLayers={},this.app=null,this.map=null,this.tag=null,this.delayedFSCOpen=null,this.mapServicesAndLayersToIdentify=null,this.app=t||null,this.map=e}return e.prototype.getFeatureLayer=function(e){return e?this._featureLayers[e.id]:null},e.prototype.execute=function(e,t,a,n,s){var o=this,l=this.app.site.essentialsMap.mapServices.filter(function(e){if(e.mapServiceType===i.MapServiceType.IMAGE&&e.isVisible()){var t=e.identifiable;if(o.mapServicesAndLayersToIdentify)for(var r in o.mapServicesAndLayersToIdentify)o.mapServicesAndLayersToIdentify.hasOwnProperty(r)&&o.mapServicesAndLayersToIdentify[r].mapServiceId===e.id&&(t=o.mapServicesAndLayersToIdentify[r].mapServiceIdentifiable);return t}return!1});this.delayedFSCOpen&&l&&l.length>0&&this.delayedFSCOpen(),this._identifyTaskExecutedCount=0,this._identifyTaskCompletedCount=0,this._identifyTaskErrorCount=0,this._taskExecutionComplete=!1;var u=new esri.tasks.ImageServiceIdentifyParameters,c=this._getIdentifyGeometry(e);u.geometry=c,u.returnGeometry=!0;for(var p=0;p<l.length;p++){var f=l[p],y=f.serviceLayer;u.returnCatalogItems=f.includeCatalogItems||f.includeMosaicDatasetValues,y.mosaicRule&&(u.mosaicRule=y.mosaicRule),y.renderingRule&&(u.renderingRule=y.renderingRule),this._identifyTaskExecutedCount++;var d=this,h=new esri.tasks.ImageServiceIdentifyTask(r.getTokenizedUrl(f.serviceUrl,f));this._fetchFieldMetadata(f).catch(function(e){}).then(function(){h.execute(u,dojo.hitch(f,function(e){if(!d._isCancelled){e.location=c;var i=this;d._identifyTaskCompletedCount++,t(d,e,i),d._conditionallyInvokeCompleteCallback(d,a)}}),dojo.hitch(f,function(e){if(!d._isCancelled){var t=this;d._identifyTaskCompletedCount++,d._identifyTaskErrorCount++,n(d,e,t),d._conditionallyInvokeCompleteCallback(d,a)}}))})}this._taskExecutionComplete=!0,this._conditionallyInvokeCompleteCallback(this,a)},e.prototype._getIdentifyGeometry=function(e){return e instanceof esri.geometry.Point?e:e instanceof esri.geometry.Polygon?e.getCentroid():e instanceof esri.geometry.Polyline?a.getMiddle(e):void 0},e.prototype._conditionallyInvokeCompleteCallback=function(e,t){e._taskExecutionComplete&&e._identifyTaskExecutedCount==e._identifyTaskCompletedCount&&t(e)},e.prototype.cancel=function(){this._isCancelled=!0},e.prototype._fetchFieldMetadata=function(e){var t=this;return this._featureLayers[e.id]?Promise.resolve():e.getFeatureLayer().then(function(i){t._featureLayers[e.id]=i})},e}();t.RasterIdentifyTask=n})},"geocortex/infrastructure/identify/RasterIdentifyTaskIdentifyProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","./IdentifyProviderBase","./RasterIdentifyTask","./RasterIdentifyUtils"],function(t,i,r,a,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._identifyTask=null,e}return e(i,t),i.prototype.initialize=function(e){},i.prototype.search=function(e,t){var i=this;return new Promise(function(r,n){var s=null;if(t.restrictRasterIdentifyToPoint&&"point"!==t.geometry.type)return r();if(t.delayFSCOpen){var o=e.id,l=!1;s=function(){l||(l=!0,i.app.featureSetManager.openCollection(o))}}else i.app.featureSetManager.openCollection(e.id);i._identifyTask=new a.RasterIdentifyTask(i.app.map,i.app),i._identifyTask.tag=e,t.identifiableLayerInfo&&(i._identifyTask.mapServicesAndLayersToIdentify=t.identifiableLayerInfo),s&&(i._identifyTask.delayedFSCOpen=s),i._identifyTask.execute(t.geometry,function(e,t,r){i.identifyTaskProgress(e,t,r)},function(e){i.identifyTaskComplete(e),r()},function(e,t,r){i.identifyTaskError(e,t,r)})})},i.prototype.identifyTaskProgress=function(e,t,i){var r=e.tag,a=new n.RasterIdentifyUtils(i,this.app,this.libraryId);a.featureLayer=this._identifyTask.getFeatureLayer(i),a.includeCatalogItems=i.includeCatalogItems,a.includeMosaicDatasetValues=i.includeMosaicDatasetValues,a.appendToFeatureSetCollection(t,r)},i.prototype.identifyTaskComplete=function(e){var t=e.tag;this.app.featureSetManager.tryCloseCollection(t.id)},i.prototype.identifyTaskError=function(e,t,i){var r=e.tag;this.app.featureSetManager.tryCloseCollection(r.id);var a=this.getResource("language-identify-error-message",null).format(t.message,t.details);this.app.command("Alert").execute(a),i&&this.app.trace.error("Error performing identify operation on service {0}. Message: {1}. Error details: {2}.".format(i.serviceLayer.url,t.message,t.details))},i.prototype.cancelSearch=function(){this._identifyTask&&this._identifyTask.cancel()},i}(r.IdentifyProviderBase);i.RasterIdentifyTaskIdentifyProvider=s})},"geocortex/infrastructure/identify/RasterIdentifyUtils":function(){define(["require","exports","../FeatureSetCollection","geocortex/essentials/Field","../FeatureSet","../Feature","../TimeZoneUtils","../GeometryUtils"],function(e,t,i,r,a,n,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t,i){this.includeCatalogItems=!1,this.includeMosaicDatasetValues=!1,this._libraryId=i,this._mapService=e,this._app=t}return e.prototype.appendToFeatureSetCollection=function(e,t){if(e){if(null==t&&(t=new i.FeatureSetCollection),"NoData"!==e.value){var a=this._mapService.serviceLayer.fields;if(e.location){var n=[],s={geometryType:"esriGeometryPoint",fields:[]},o=this._mapService.serviceLayer.bandCount;if((o&&o>0||!o)&&e.value){var l=[e.value];if(this.includeMosaicDatasetValues&&e.properties&&e.properties.Values.length>0&&(l=l.concat(e.properties.Values)),l&&l.length>0)for(var u=0;u<l.length;u++){var c=new esri.Graphic(e.location);c.attributes=[];var p;p=-1!==l[u].indexOf(",")?l[u].replace(/ /g,""):l[u].replace(/ /g,",");var f={};if(!o||o>1){f.value=p,0===u&&s.fields.push({name:"value",alias:"value",type:r.EsriFieldTypes.esriFieldTypeString})}for(var y=this,d=0;d<o;d++)!function(){var e=p.indexOf(","),t=0!=(e=-1!==e?e:0)?p.substring(0,e):p,i=o>1?"value"+(d+1).toString():"value";p=p.substring(0!==e?e+1:e,p.length);var r=null;0===u?(r=y._getFieldTypeInformation(t),s.fields.push({name:i,alias:i,type:r})):r=s.fields.filter(function(e){return e.name===i})[0].type,f[i]=y._parseAttributeValue(t,r)}();c.setAttributes(f),n.push(c)}}this._createAndAddGcxFeatureSet("value",t,n,e.location.type,e.location.spatialReference,this._mapService.displayName+", {value}",s.fields)}if(this.includeCatalogItems&&e.catalogItems&&e.catalogItems.features){var h=e.catalogItems;h.displayFieldName=h.displayFieldName?a.length>0?a[0].name:h.displayFieldName:h.objectIdFieldName,h.features=h.features.filter(function(t,i){return!(!e.catalogItems||1!==e.catalogItemVisibilities[i])});var m=this._app.getResource(this._libraryId,"language-rasterIdentify-catalogItem-labelFormat").format(this._mapService.displayName,"{"+h.displayFieldName+"}");this._createAndAddGcxFeatureSetFromEsriFeatureSet(h,m,t,null)}}return t}},e.prototype._parseAttributeValue=function(e,t){switch(t){case r.EsriFieldTypes.esriFieldTypeSingle:case r.EsriFieldTypes.esriFieldTypeDouble:return parseFloat(e);case r.EsriFieldTypes.esriFieldTypeSmallInteger:case r.EsriFieldTypes.esriFieldTypeInteger:return parseInt(e);default:return null}},e.prototype._getFieldTypeInformation=function(e){if($.isNumeric(e)){var t=Number(e);if(0!==Math.abs(t%1)){if(t>=-3.4e38&&t<=1.2e38)return r.EsriFieldTypes.esriFieldTypeSingle;if(t>=-1/0&&t<=1/0)return r.EsriFieldTypes.esriFieldTypeDouble}else{if(t>=-32768&&t<=32767)return r.EsriFieldTypes.esriFieldTypeSmallInteger;if(t>=-2147483648&&t<=2147483647)return r.EsriFieldTypes.esriFieldTypeInteger}}return r.EsriFieldTypes.esriFieldTypeString},e.prototype._createAndAddGcxFeatureSet=function(e,t,i,r,a,n,s){var o=new esri.tasks.FeatureSet({displayFieldName:e});o.geometryType=r,o.spatialReference=a,o.features=i,this._createAndAddGcxFeatureSetFromEsriFeatureSet(o,n,t,s)},e.prototype._createAndAddGcxFeatureSetFromEsriFeatureSet=function(e,t,i,r){var n=this,l=this.featureLayer.fields;try{r&&(this.featureLayer.fields=r);var u=new a.FeatureSet({esriFeatureSet:e,featureLayer:this.featureLayer,defaultDateFormat:this._mapService.defaultDateFormat,defaultNumberFormat:this._mapService.defaultNumberFormat})}finally{r&&(this.featureLayer.fields=l)}if(u.displayName.set(this._mapService.displayName),u.iconUri.set(this._mapService.iconUri),u.features.get().forEach(function(e){e.labelFormat.set(t),e.timeZoneId=s.getTimeZoneFromMapService(n._mapService),e.displayTimeZoneId=s.getDisplayTimeZoneFromMapService(n._mapService)}),u.features.get().filter(function(e){return o.needsProjection(e.esriFeature.get().geometry,n._app)}).length>0&&i){var c=u.features.get().map(function(e){return e.esriFeature.get().geometry}),p=new esri.tasks.ProjectParameters;p.geometries=c,p.outSR=this._app.map.extent.spatialReference,o.project(p,function(e){u.features.get().forEach(function(t,i){t.esriFeature.get().setGeometry(e[i])}),i.featureSets.addItem(u)},function(e){i.featureSets.addItem(u)},this._app)}else i.featureSets.addItem(u)},e.prototype._convertEsriFeatureToGcxFeature=function(e,t,i,r,a){var s={graphic:t,layer:i,resolveLayerFields:!!r,allowUnsafeContent:!!a},o=new n.Feature(s);return o.labelFormat.set(e),o},e}();t.RasterIdentifyUtils=l})},"geocortex/infrastructure/identify/WorkflowIdentifyTask":function(){define(["require","exports","./../FeatureSet","geocortex/framework/utils/utils"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,i){this.app=null,this.delayFSCOpen=!1,this.fsc=null,this.guid="",this._isCancelled=!1,this._featureLayers={},this.app=e,this._workflows=t.slice(),this.fsc=i,this.guid=r.alphaNumericToken()}return e.prototype.execute=function(e,t,r,a){var n=this;this.delayFSCOpen||this.app.featureSetManager.openCollection(this.fsc.id);this.app.event("WorkflowCompletedEvent").subscribe(this,function(e,s){if(n._workflows.some(function(t){return t.id===e.id})&&!n._isCancelled){var o=function(e){for(var t=0,i=s;t<i.length;t++){var r=i[t];if(r.name===e&&r.value)return r.value}return null},l=function(e){for(var t={},i=0,r=e||{};i<r.length;i++){var a=r[i];a.Key&&a.Value&&(t[a.Key]=a.Value)}return t},u=o("guid");if(u&&u===n.guid){var c=o("featureSet"),p=o("displayName"),f=l(o("formats")),y=l(o("aliases"));if(c){var d=new i.FeatureSet({esriFeatureSet:new esri.tasks.FeatureSet(c)});d.displayName.set(p||e.displayName),f&&f.iconUri&&d.iconUri.set(f.iconUri);var h=function(e){var t=e.name.get();y&&y.hasOwnProperty(t)?(e.alias.set(y[t]),e.displayName.set(y[t])):e.name.get().startsWith("_")&&e.visible.set(!1)};d.attributes.get().forEach(h),d.features.getItems().forEach(function(e){e.attributes.get().forEach(h),f&&(e.labelFormat.set(f.labelFormat||e.labelFormat.get()),e.descriptionFormat.set(f.descriptionFormat||e.descriptionFormat.get()),e.longDescriptionFormat.set(f.longDescriptionFormat||e.longDescriptionFormat.get()))}),n.app.featureSetManager.isCollectionOpen(n.fsc.id)||n.app.featureSetManager.openCollection(n.fsc.id),t(n,d,e)}n._workflows=n._workflows.filter(function(t){return t.id!==e.id}),n._workflows.length||r(n)}else u||(n._workflows=n._workflows.filter(function(t){return t.id!==e.id}),a(n,new Error("Workflow failed to return a guid."),e))}});for(var s=0,o=this._workflows;s<o.length;s++){var l=o[s];this.app.command("RunWorkflowWithArguments").execute({geometry:e,guid:this.guid,workflowId:l.id})}},e.prototype.cancel=function(){this._isCancelled=!0,this.app.featureSetManager.tryCloseCollection(this.fsc.id)},e}();t.WorkflowIdentifyTask=a})},"geocortex/infrastructure/identify/WorkflowIdentifyTaskIdentifyProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();define(["require","exports","./IdentifyProviderBase","./WorkflowIdentifyTask"],function(t,i,r,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._identifyTask=null,e._workflows=[],e._workflowSuffix="_Identifier",e}return e(i,t),i.prototype.initialize=function(e){var t=this;e&&e.workflowSuffix&&(this._workflowSuffix=e.workflowSuffix),this.app.waitUntilSiteInitialized().then(function(){t._workflows=t.app.site.workflows.filter(function(e){return e.id.endsWith(t._workflowSuffix)})})},i.prototype.search=function(e,t){var i=this;return this._workflows.length?(this._identifyTask=new a.WorkflowIdentifyTask(this.app,this._workflows,e),this._identifyTask.delayFSCOpen=!!t.delayFSCOpen,new Promise(function(e,r){i._identifyTask.execute(t.geometry,function(e,t,r){i.identifyTaskProgress(e,t,r)},function(t){i.identifyTaskComplete(t),e()},function(e,t,r){i.identifyTaskError(e,t,r)})})):Promise.resolve()},i.prototype.identifyTaskProgress=function(e,t,i){t.features.length()&&e.fsc.featureSets.addItem(t)},i.prototype.identifyTaskComplete=function(e){this.app.featureSetManager.tryCloseCollection(e.fsc.id)},i.prototype.identifyTaskError=function(e,t,i){this.app.featureSetManager.tryCloseCollection(e.fsc.id);var r=this.getResource("language-identify-error-message",null).format(t.message,t.details);this.app.command("Alert").execute(r),i&&this.app.trace.error('Error performing identify operation with workflow "{0}". Message: {1}. Error details: {2}.'.format(i.id,t.message,t.details))},i.prototype.cancelSearch=function(){this._identifyTask&&this._identifyTask.cancel()},i}(r.IdentifyProviderBase);i.WorkflowIdentifyTaskIdentifyProvider=n})}}});require({cache:{"geocortex/infrastructure/integration/ComponentFrameInfo":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/ComponentIndicatorUpdatedMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/ComponentInitializationMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/ComponentStateMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/ComponentUpdateGraphicMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/ComponentViewpointMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/MapPosition":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/integration/MapViewpointMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/KmlFeature":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();define(["require","exports","./Feature"],function(e,r,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isKmlProperty="__isKml";var n=function(e){function o(t){var o=e.call(this,t)||this,n=o.esriFeature.get(),i=n?n.attributes||{}:{};return o.labelFormat.set(i.hasOwnProperty("name")?"{name}":"{id}"),o.descriptionFormat.set("{snippet}"),o.longDescriptionFormat.set(i.hasOwnProperty("balloonStyleText")?"{balloonStyleText}":"{description}"),n&&!n[r.isKmlProperty]&&(n[r.isKmlProperty]=!0),o}return t(o,e),o}(o.Feature);r.KmlFeature=n})}}});require(["geocortex/framework/resourceManager"],function(g){g.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/large.css","css","DQovKiBHTE9CQUwgU1RZTElORyAoTEFSR0UgKS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpodG1sLA0KYm9keSB7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBjb2xvcjogIzMzMzMzMzsNCn0NCg0KYnV0dG9uIHsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCg0KLyogTU9EQUwgV0lORE9XIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5tb2RhbC1jb250YWluZXIgew0KICAgIG1pbi13aWR0aDogMzYwcHg7DQp9DQoNCi5tb2RhbC1jb250YWluZXIgLnBhbmVsLXNjcm9sbC1jb250YWluZXIgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQovKiBWSUVXIENPTlRBSU5FUlMgLyBNT0RVTEUgQ09OVEFJTkVSUyAoTEFSR0UpIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLmxhcmdlLXNoZWxsLWJvdHRvbSB7DQogICAgei1pbmRleDogMTAwMDsNCn0NCg0KLmxhcmdlLXNoZWxsLWxlZnQgLnBhbmVsLXNjcm9sbC1jb250YWluZXIsDQoubGFyZ2Utc2hlbGwtYm90dG9tIC5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQp9DQoNCi5sYXJnZS1zaGVsbC1ib3R0b20gLnBhbmVsLWhlYWRlciB7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZWU7DQp9DQoNCi5wYW5lbC1oZWFkZXIgaDIgew0KICAgIG1hcmdpbjogMCA0MHB4OyAvKiBBbGxvd3Mgc3BhY2UgZm9yIGljb25zIG9uIGVpdGhlciBzaWRlIG9mIHRoZSBoZWFkaW5nICovDQogICAgZm9udC1zaXplOiAxLjNlbTsNCn0NCg0KDQovKiBCVVRUT05TIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCmJ1dHRvbiB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQpidXR0b246Oi1tb3otZm9jdXMtaW5uZXIgeyAvKiBSZW1vdmUgYnV0dG9uIHBhZGRpbmcgaW4gRkYgKi8NCiAgICBib3JkZXI6IDA7DQogICAgcGFkZGluZzogMDsNCn0NCg0KDQovKiBMSVNUIE1FTlUgKExBUkdFKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLmxpc3QtbWVudS5hY3RpdmUgew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KLmxpc3QtbWVudS1pdGVtOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjREVGMkZGOw0KfQ0KDQoubGlzdC1tZW51LmFjdGl2ZSAubGlzdC1tZW51LWl0ZW06YWN0aXZlIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUVFRUVFOw0KfQ0KDQphLmxpc3QtbWVudS1pdGVtIHsNCiAgICBjb2xvcjogIzMzMzMzMzsNCn0NCg0KLmxpc3QtbWVudS1jbG9zZWQgew0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9leHBhbmRlci1jbG9zZWQtMjQucG5nIikgcmlnaHQgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg0KLmxpc3QtbWVudS1vcGVuIHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvZXhwYW5kZXItb3Blbi0yNC5wbmciKSByaWdodCBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KDQoNCi8qIExPQURJTkcgSU5ESUNBVE9SIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5sb2FkaW5nLWNvbnRhaW5lciB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHBhZGRpbmc6IDAuNWVtOw0KfQ0KDQoubG9hZGluZy1pbWcsDQoubG9hZGluZy1tc2cgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoubG9hZGluZy1pbWcgew0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMjRweDsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9sb2FkZXItc21hbGwuZ2lmKTsNCn0NCg0KDQovKiBUUkVFVklFVyAoTEFSR0UpIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoudHJlZS1leHBhbmRlciB7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMTAwJTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgbWFyZ2luLWxlZnQ6IDFweDsgLyogVG8gbWF0Y2ggdGhlIGFsaWdubWVudCB3aXRoIHRoZSBsZWdlbmQgZXhwYW5kZXIgKi8NCn0NCg0KLnRyZWUtZXhwYW5kZXIuZXhwYW5kZWQgew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL3RyZWUtZXhwYW5kZXItb3Blbi0xNi5wbmcpIDAuM2VtIGNlbnRlciBuby1yZXBlYXQ7DQp9DQoNCi50cmVlLWV4cGFuZGVyLmNvbGxhcHNlZCB7DQogICAgYmFja2dyb3VuZDogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvdHJlZS1leHBhbmRlci1jbG9zZWQtMTYucG5nKSAwLjNlbSBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KDQovKiBOT1RJRklDQVRJT05TIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5ub3RpZmljYXRpb24gdGV4dGFyZWEgew0KICAgIG1heC13aWR0aDogMzAwcHg7DQogICAgbWF4LWhlaWdodDogMzAwcHg7DQogICAgcmVzaXplOiBub25lOw0KfQ0KDQoNCi8qIE1FRElBIFFVRVJJRVMgKExBUkdFKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KQG1lZGlhIHNjcmVlbiBhbmQgKG1heC1oZWlnaHQ6IDc2OHB4KSB7DQoNCiAgICAubW9kYWwtY29udGFpbmVyIC5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICAgICAgbWF4LWhlaWdodDogNDgwcHg7DQogICAgfQ0KfQ0KDQpAbWVkaWEgc2NyZWVuIGFuZCAobWluLWhlaWdodDogNzY5cHgpIHsNCg0KICAgIC5tb2RhbC1jb250YWluZXIgLnBhbmVsLXNjcm9sbC1jb250YWluZXIgew0KICAgICAgICBtYXgtaGVpZ2h0OiA2MDBweDsNCiAgICB9DQp9DQoNCg0KLyogQU5JTUFUSU9OUyAoTEFSR0UpIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpAa2V5ZnJhbWVzIGFuaW0tem9vbS1pbiB7DQogICAgMCUgew0KICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOSwwLjkpOw0KICAgICAgICBvcGFjaXR5OiAwOw0KICAgIH0NCg0KICAgIDEwMCUgew0KICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEsMSk7DQogICAgICAgIG9wYWNpdHk6IDEwMDsNCiAgICB9DQp9DQoNCkAtd2Via2l0LWtleWZyYW1lcyBhbmltLXpvb20taW4gew0KICAgIDAlIHsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHNjYWxlKDAuOSwwLjkpOw0KICAgICAgICBvcGFjaXR5OiAwOw0KICAgIH0NCg0KICAgIDEwMCUgew0KICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogc2NhbGUoMSwxKTsNCiAgICAgICAgb3BhY2l0eTogMTAwOw0KICAgIH0NCn0NCg0KLmFuaW0tem9vbS1pbiB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHRyYW5zZm9ybTogc2NhbGUoMCwwKTsNCiAgICB0cmFuc2Zvcm0tb3JpZ2luOiA1MCUgNTAlOw0KICAgIC13ZWJraXQtdHJhbnNmb3JtOiBzY2FsZSgwLDApOw0KICAgIC13ZWJraXQtdHJhbmZvcm0tb3JpZ2luOiA1MCUgNTAlOw0KfQ0KDQouYW5pbS16b29tLWluIHsNCiAgICBhbmltYXRpb24tbmFtZTogYW5pbS16b29tLWluOw0KICAgIGFuaW1hdGlvbi1kdXJhdGlvbjogMjUwbXM7DQogICAgYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogZWFzZS1vdXQ7DQogICAgYW5pbWF0aW9uLWRlbGF5OiAwczsNCiAgICBhbmltYXRpb24taXRlcmF0aW9uLWNvdW50OiAxOw0KICAgIGFuaW1hdGlvbi1kaXJlY3Rpb246IG5vcm1hbDsNCiAgICBhbmltYXRpb24tZmlsbC1tb2RlOiBmb3J3YXJkczsNCiAgICAtd2Via2l0LWFuaW1hdGlvbi1uYW1lOiBhbmltLXpvb20taW47DQogICAgLXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246IDI1MG1zOw0KICAgIC13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjogZWFzZS1vdXQ7DQogICAgLXdlYmtpdC1hbmltYXRpb24tZGVsYXk6IDBzOw0KICAgIC13ZWJraXQtYW5pbWF0aW9uLWl0ZXJhdGlvbi1jb3VudDogMTsNCiAgICAtd2Via2l0LWFuaW1hdGlvbi1kaXJlY3Rpb246IG5vcm1hbDsNCiAgICAtd2Via2l0LWFuaW1hdGlvbi1maWxsLW1vZGU6IGZvcndhcmRzOw0KfQ0K")});require({cache:{"geocortex/infrastructure/layerCatalog/LayerCatalogFilterProviderBase":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(e,r){this.app=e,this.libraryId=r}return e.prototype.initialize=function(e){},e.prototype.filter=function(e,r){return Promise.resolve()},e}();r.LayerCatalogFilterProviderBase=t})}}});require({cache:{"geocortex/infrastructure/LayerIntegrationUtils":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();define(["require","exports","geocortex/essentials/FeatureLayerService","geocortex/framework/utils/utils","geocortex/essentials/MapServiceConstants","geocortex/essentials/Layer","geocortex/essentials/LayerType","geocortex/essentials/KmlService","./GeometryUtils"],function(r,t,n,i,a,o,s,y,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.discoverFeatureServices=function(e){return new Promise(function(r,t){esri.request({url:e,content:{f:"json"},handleAs:"json"}).then(function(n){if("layers"in n){for(var i=[],a=0,o=n.layers;a<o.length;a++){var s=o[a];s.subLayerIds||i.push(e+"/"+s.id)}r(i)}else"fields"in n?r([e]):t(new Error("Unknown response type from url ("+e+")."))},t)})},t.buildFeatureLayerService=function(e){var r=new n.FeatureLayerService;return r._createFrom({id:i.alphaNumericToken(),displayName:i.alphaNumericToken(),serviceType:a.MapServiceType.FEATURE,serviceFunction:a.MapServiceFunction.OPERATIONAL,connectionString:e}),r.serviceUrl=e,r.outFields="*",r.isUserCreated=!0,r.userLayerType=a.UserLayerType.UPLOAD,r._createServiceLayer(),new Promise(function(e,t){r.serviceLayer.on("load",function(t){r.displayName=r.serviceLayer.name;var n=new o.Layer;n._createFrom(r.serviceLayer),n.id=r.serviceLayer.layerId.toString(),n.type=s.LayerType.FEATURE_LAYER,n.userLayerType=a.UserLayerType.UPLOAD,n.isUserCreated=!0;var i=r.serviceLayer;"esriGeometryPoint"===i.geometryType&&(n.featureType="Point"),"esriGeometryPolyline"===i.geometryType&&(n.featureType="Line"),"esriGeometryPolygon"===i.geometryType&&(n.featureType="Polygon"),n.mapService=r,r.layers.push(n),e(r)})})},t.buildKmlService=function(e,r){void 0===r&&(r={});var t=new y.KmlService;return r=$.extend({id:i.alphaNumericToken(),serviceType:a.MapServiceType.KML,serviceFunction:a.MapServiceFunction.OPERATIONAL,serviceUrl:e,drawingBehavior:a.DrawingBehavior.KML_SERVICE,connectionString:e},r),t._createFrom(r),t.isUserCreated=!0,t.userLayerType=a.UserLayerType.UPLOAD,t._createServiceLayer(),new Promise(function(e,r){t.serviceLayer.on("load",function(r){e(t)})})},t.buildLocalFeatureLayerService=function(e,r){void 0===r&&(r={});var t=new l;r=$.extend({id:i.alphaNumericToken()+":Local",displayName:e.layerDefinition.name,serviceType:a.MapServiceType.FEATURE,serviceFunction:a.MapServiceFunction.OPERATIONAL,connectionString:t.url},r),t._createFrom(r),t.isUserCreated=!0,t.userLayerType=a.UserLayerType.UPLOAD;var n=t.serviceLayer=new u(dojo.clone(e));n.id=t.id,n.layerId=0,n.name=e.layerDefinition.name,n.graphics.length&&(n.fullExtent=esri.graphicsExtent(n.graphics)),n.setEditable(!1);var o=new p;if(o._createFrom(n),o.id=n.layerId.toString(),o.primaryKeyField=o.getFieldByName(n.objectIdField),o.mapService=t,o.type=s.LayerType.FEATURE_LAYER,o.userLayerType=a.UserLayerType.UPLOAD,o.isUserCreated=!0,e.layerDefinition&&e.layerDefinition.geometryType){var y=e.layerDefinition.geometryType.toLowerCase();y.indexOf("point")>-1?o.featureType="Point":y.indexOf("line")>-1?o.featureType="Line":y.indexOf("polygon")>-1&&(o.featureType="Polygon")}return o.queryable=!1,o.supportsQuery=!1,o.supportsIdentify=!0,o.identifiable=!0,o.searchable=!0,o.showMapTips=!0,o.snappable=!0,o.snappingEnabled=!0,t.layers.push(o),Promise.resolve(t)};var u=function(r){function t(e){return r.call(this,e,{mode:esri.layers.FeatureLayer.MODE_SNAPSHOT})||this}return e(t,r),t.prototype.queryFeatures=function(e,t,n){var i=new esri.tasks.Query;e.hasOwnProperty("geometry")&&(i.geometry="extent"!==e.geometry.type?e.geometry.getExtent():e.geometry);for(var a=0,o=["num","objectIds","returnGeometry","spatialRelationship"];a<o.length;a++){var s=o[a];i[s]=e[s]}return r.prototype.queryFeatures.call(this,i,t,n).then(function(r){return Promise.all(r.features.map(function(r){return c.intersects(e.geometry,r.geometry)})).then(function(e){return r.features.filter(function(r,t){return!!e[t]})}).then(function(e){return r.features=e,r})})},t}(esri.layers.FeatureLayer);t.LocalFeatureLayer=u;var l=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return e(t,r),t}(n.FeatureLayerService);t.LocalFeatureLayerService=l;var p=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return e(t,r),t}(o.Layer);t.LocalLayer=p})}}});require({cache:{"geocortex/infrastructure/layerList/LayerList":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListNode","./LayerListFolderItem","./../gis/ServiceLayerInfo","geocortex/framework/utils/utils","./LayerListItemCollection","geocortex/geocortex","geocortex/essentials/MapService","./LayerListItem","./LayerListLayerItem","./../gis/LayerInfo","./LayerListMapServiceItem","./LayerListGraphicsLayerItem","geocortex/essentials/LayerThemeSetting","geocortex/essentials/RestHelper","./LayerVisibilityType","geocortex/essentials/MapServiceConstants","./../ui/components/FilterControl/FilterControlComponent"],function(i,t,r,n,s,a,o,l,c,p,d,y,h,f,u,v,m,L,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=function(i){function t(e,t,r,n){var s=i.call(this,"GCXLayerListRootNode-".concat(a.alphaNumericToken()))||this;if(s.layerListInitialized=!1,s.layerListInitializationFailure=null,s.onLayerListInitializationFailed=function(e){},s.onLayerListInitialized=function(e){},s.enableLegendIntegration=!1,s.onlyShowSwatchesOnVisibleLayers=!1,s.autoActivateAncestorVisibilities=!1,s._addedFolderReferences=[],s._handledMapServiceReferences=[],s._allMapServiceReferences=[],s._outOfFolderMapServiceReferences=[],s._initializing=!1,s._groupByOperationalAndBase=!0,s._layerListRestEndpoint=null,s._suspendMapUpdates=!1,s._itemsExpandedByFilter=[],s._filterControlId="LayerListFilterControl",!e||!e.mapInfo)throw new Error("LayerList: Initialization failed. AppInfo/MapInfo cannot be null");return s.appInfo=e,s.mapInfo=e.mapInfo,s.url=t||"",s._libraryId="Mapping.Infrastructure",s._layerListRestEndpoint=r||null,s.enableLegendIntegration=!(!n||void 0==n.enableLegendIntegration)&&n.enableLegendIntegration,s.onlyShowSwatchesOnVisibleLayers=!(!n||void 0==n.onlyShowSwatchesOnVisibleLayers)&&n.onlyShowSwatchesOnVisibleLayers,s.autoActivateAncestorVisibilities=!(!n||void 0==n.autoActivateAncestorVisibilities)&&n.autoActivateAncestorVisibilities,s._groupByOperationalAndBase=!n||void 0==n.groupByOperationalAndBase||n.groupByOperationalAndBase,s.enableLayerIcons=!(!n||void 0==n.enableLayerIcons)&&n.enableLayerIcons,s.serviceLoadFailureIconUri=n?n.serviceLoadFailureIconUri||"":"",s.serviceLoadFailureIconTooltip=n?n.serviceLoadFailureIconTooltip||"":"",s.multiLegendSwatchElement=n?n.multiLegendSwatchElement||"":"",s.singleLegendIconTooltip=n?n.singleLegendIconTooltip||"":"",s.multiLegendIconTooltip=n?n.multiLegendIconTooltip||"":"",s.filterControlComponent=new g.FilterControlComponent(s.appInfo.gcxApp,s._filterControlId),s.appInfo.gcxApp.event("FilterControlResultChangedEvent").subscribe(s,s._handleFilterChanged),dojo.connect(s.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangingEvent",dojo.hitch(s,function(){return s.suspendMapUpdates=!0})),dojo.connect(s.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangedEvent",dojo.hitch(s,function(){return s.suspendMapUpdates=!1})),s}return e(t,i),Object.defineProperty(t.prototype,"suspendMapUpdates",{get:function(){return this._suspendMapUpdates},set:function(e){e!==this._suspendMapUpdates&&(this._suspendMapUpdates=e,this._suspendMapUpdates?this._enableDeferredItemVisibilities(this.children.get()):this._applyDeferredItemVisibilities(this.children.get()))},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){this.layerListInitialized||this._initializing||(this._initializing=!0,this.children=new o.LayerListItemCollection(null),this.children.layerList=this,this._layerListRestEndpoint?this._layerListInitializationHandler(this._layerListRestEndpoint):this.url&&this.appInfo.essentialsVersion&&this.appInfo.essentialsVersion>=4.02?l.request({url:this.url,content:{f:"json"},load:dojo.hitch(this,this._layerListInitializationHandler),error:dojo.hitch(this,this._layerListInitializationErrorHandler),callbackParamName:"CallBack"}):this._layerListInitializationHandler(null))},t.prototype.addUserAddedServiceLayer=function(e,i){var t=e;if(!this.layerListInitialized)return!1;if(!(t instanceof s.ServiceLayerInfo))if(t instanceof c.MapService)t=s.ServiceLayerInfo.fromGcxMapService(t);else{if(!(t instanceof esri.layers.Layer))return this.appInfo.gcxApp.trace.error("addUserAddedServiceLayer: Could not add layer. Invalid layer type."),!1;t=s.ServiceLayerInfo.fromEsriLayer(t)}t.isUserCreated=!0;var r=this._generateLayerListItemsFromServiceLayer(t,this,!0);return!(!r||!r.length)&&(null!==i&&void 0!==i?this._addItemsToUserAddedFolder(r,i):this._addItemsToUserAddedFolder(r))},t.prototype.removeServiceLayer=function(e){var i=e;if(!this.layerListInitialized)return!1;if(!(i instanceof esri.layers.Layer)){if(!(i instanceof c.MapService||i instanceof s.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("removeServiceLayer: Could not remove layer. Invalid layer type."),!1;i=i.serviceLayer}var t=this.getDescendants();if(t.length){for(var r=0;r<t.length;r++){var n=t[r];if(n.mapService&&n.mapService.serviceLayer===i&&this._isItemSafeToBeRemoved(n,i)){var a=n.parent;a?(a.children.removeItem(n),a instanceof p.LayerListItem&&a.refreshOnDemandItemCollection()):this.children.removeItem(n)}}return!0}return!1},t.prototype._isItemSafeToBeRemoved=function(e,i){if(e.type===p.LayerListItemType.MAPSERVICE||e.type===p.LayerListItemType.LAYER||e.type===p.LayerListItemType.GRAPHICSLAYER)return!0;if(e.children){if(0==e.children.length())return!0;var t=e.getDescendants();if(t&&t.length>0)for(var r=0;r<t.length;r++)if((t[r].type===p.LayerListItemType.LAYER||t[r].type===p.LayerListItemType.GRAPHICSLAYER||t[r].type===p.LayerListItemType.MAPSERVICE)&&t[r].mapService&&t[r].mapService.serviceLayer!=i)return!1;return!0}return!0},t.prototype.updateServiceLayer=function(e,i,t){if(!this.layerListInitialized||!e)return!1;i=i||[],t=t||[];var r;if(e instanceof c.MapService)r=s.ServiceLayerInfo.fromGcxMapService(e);else{if(!(e instanceof s.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("updateServiceLayer: Could not update layer. Invalid layer type."),!1;r=e}if(!(n=this.getDescendants()).filter(function(e){return e.mapService&&e.mapService&&e.mapService.gcxMapService===r.gcxMapService}).length)return this.addUserAddedServiceLayer(r);if(t&&t.length)for(var n=this.getDescendants(),a=0;a<n.length;a++){var o=n[a];if(o.type===p.LayerListItemType.LAYER){var l=o,h=l.layer&&l.layer.gcxLayer?l.layer.gcxLayer:null;if(h&&h.isUserCreated&&t.indexOf(h)>=0){var f=l.parent;f?(f.children.removeItem(l),f instanceof p.LayerListItem&&f.refreshOnDemandItemCollection()):(this.children.removeItem(l),this.children.pulse())}}}if(i&&i.length){for(var n=this.getDescendants(),u=new Array,a=0;a<i.length;a++){var v=i[a],m=r.findLayerById(v.id);if(m||((m=y.LayerInfo.fromGcxLayer(v)).serviceLayerInfo=r,r.layers.push(m)),!n.filter(function(e){return e.layer&&e.layer.gcxLayer===m.gcxLayer}).length){var L=new d.LayerListLayerItem(m.id,m,this,p.LayerListItemType.LAYER);u.push(L)}}if(u.length)return this._addItemsToUserAddedFolder(u)}return!1},t.prototype.updateServiceLayerLegendSwatch=function(e){if(!this.layerListInitialized)return!1;var i=e.serviceLayer;if(!i)return this.appInfo.gcxApp.trace.error("updateServiceLayerLegendSwatch: Could not update layer swatch. Invalid layer type."),!1;var t=this.getDescendants().filter(function(e){return e.mapService&&e.mapService.serviceLayer.id===i.id});if(t.length>0){for(var r=0;r<t.length;r++){var n=t[r];n&&n instanceof d.LayerListLayerItem&&n.updateLegendItems()}return!0}return!1},t.prototype.getUserAddedLayersFolderIndex=function(e){var i=e;if(!this.layerListInitialized)return null;if(!(i instanceof esri.layers.Layer)){if(!(i instanceof c.MapService||i instanceof s.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("removeServiceLayer: Could not remove layer. Invalid layer type."),null;i=i.serviceLayer}var t=this._userAddedLayersFolder||this;if(t.children&&t.children.length)for(var r=t.children.get(),n=0;n<r.length;n++){var a=r[n];if(a.mapService&&a.mapService.serviceLayer===i)return n}return null},t.prototype._applyDeferredItemVisibilities=function(e){var i=this;dojo.forEach(e,function(e){e._applyDeferredInitialVisibility(),e.children&&e.children.length()&&i._applyDeferredItemVisibilities(e.children.get())})},t.prototype._enableDeferredItemVisibilities=function(e){var i=this;e.forEach(function(e){a.isNullOrUndefined(e._deferredVisibilitySetting)&&(e._deferredVisibilitySetting=e.isVisible.get()),i._enableDeferredItemVisibilities(e.children.get())})},t.prototype._layerListInitializationErrorHandler=function(e){this.layerListInitializationFailure=e,this.onLayerListInitializationFailed&&this.onLayerListInitializationFailed(e),this._initializing=!1},t.prototype._layerListInitializationHandler=function(e){var i=this,t=function(){i.layerListInitialized=!0,i._initializing=!1,i._processEligibleSingleMapServiceFolders(),i._processUnhandledMapServices(),i._setupOpacityBindingsForParentsOfHiddenItemsWithOpacityBindings(),i._applyInitialLayerTheme(),i._applyDeferredItemVisibilities(i.children.get()),i.onLayerListInitialized&&i.onLayerListInitialized(i)};e?this._configureLayerListFromRestResponse(e,t,this._layerListInitializationErrorHandler):this._configureLayerListFromMapInfo(this.mapInfo,t,this._layerListInitializationErrorHandler)},t.prototype._configureLayerListFromMapInfo=function(e,i,t){if(e){if(e.gcxMap&&e.serviceLayers.length&&void 0!=e.serviceLayers[0].serviceLayerFunction&&this._groupByOperationalAndBase)var r=new n.LayerListFolderItem(this.id.get()+":Operational",this.appInfo.gcxApp.getResource(this._libraryId,"language-layerlist-operational-maps-folder-title"),this),s=new n.LayerListFolderItem(this.id.get()+":Base",this.appInfo.gcxApp.getResource(this._libraryId,"language-layerlist-base-maps-folder-title"),this);try{for(var a=0;a<e.serviceLayers.length;a++){var o=e.serviceLayers[a],l=this._generateLayerListItemsFromServiceLayer(o,this);if(l&&l.length)if(this._groupByOperationalAndBase)switch(o.serviceLayerFunction){case"Operational":r.children.addItems(l);break;case"Base":s.children.addItems(l);break;default:throw new Error("ServiceLayerFunction undefined or not recognized: {0}".format(o.serviceLayerFunction))}else this.children.addItems(l)}this._groupByOperationalAndBase&&(r.children.length()&&(this._generateThemeSettingsForCoreFolder(r),this.children.addItem(r),r.isExpanded.set(!0),r.isVisible.set(!0),r.configuredVisible=!0),s.children.length()&&(this._generateThemeSettingsForCoreFolder(s),this.children.addItem(s),s.isExpanded.set(!0),s.isVisible.set(!0),s.configuredVisible=!0))}catch(e){return console.error("Layer List Configuration Error: {0}".format(e&&e.message||"Unknown Error")),void t(e)}i()}else this._layerListInitializationErrorHandler(new Error("Error initializing layer list from MapInfo."))},t.prototype._configureLayerListFromRestResponse=function(e,i,t){try{if(!e||!e.items)throw new Error("Layer list failed to load (general data failure).");this._userAddedLayersDestinationId=e.userAddedLayersDestinationId;for(var r=0,n=e.items;r<n.length;r++){var s=n[r],a=this._createLayerListItemFromRestResult(s,this);a&&this.children.addItem(a)}}catch(e){return e.name="LayerListConfigurationError/"+e.name,this._layerListInitializationErrorHandler(e),void t(e)}i()},t.prototype._generateLayerListItemsFromServiceLayer=function(e,i,t){var r=this;void 0===t&&(t=!1);var n=[],s=null,a=function(i,t){var n=i.subLayerIds||[];if(n.length>0)for(var s=0;s<n.length;s++){var l=e.findLayerById(n[s]);if(l&&(l.processed=!0,l.includeInLayerList)){var c=new d.LayerListLayerItem(l.id,l,r);o(c),t.children.addItem(c),a(l,c)}}t.isExpanded.set(i.isExpanded&&!(!i.subLayerIds||!i.subLayerIds.length))},o=function(e){e&&t&&(e.unbindFromActiveTheme(),e.inActiveTheme.set(!0))};return e.includeInLayerList&&(s=new h.LayerListMapServiceItem(e.id,e,this),o(s)),e.serviceLayer instanceof esri.layers.GraphicsLayer&&1===e.layers.length?(s=this._handleGraphicsLayerItem(e,s),o(s&&s.children.length()?s.children.getAt(0):s)):e.layers.length&&(dojo.forEach(e.layers,function(e){if((e.includeInLayerList||e.isUserCreated)&&!e.processed){var i=new d.LayerListLayerItem(e.id,e,r);o(i),s?s.children.addItem(i):n.push(i),a(e,i)}}),s&&s.isExpanded.set(e.isExpanded&&!!e.layers.length)),s&&(n.push(s),i&&(s.parent=i)),n},t.prototype._handleGraphicsLayerItem=function(e,i){var t=i;if(e.layers[0].includeInLayerList||e.layers[0].isUserCreated){var r=e.layers[0],n=new f.LayerListGraphicsLayerItem(r.id,e.layers[0],this);n.isExpanded.set(r.isExpanded&&!(!r.subLayerIds||!r.subLayerIds.length)),t?(t.isVisible.set(n.isVisible.get()),n.isVisible.set(!0),n.canNotAssignVisibility.set(!0),t.children.addItem(n),t.isExpanded.set(e.isExpanded&&!!e.layers.length)):t=n}return t},t.prototype._createLayerListItemFromRestResult=function(e,i){var t=this,r=null,s=function(i){var t=i===p.LayerListItemType.MAPSERVICE?"MapService":i===p.LayerListItemType.LAYER?"Map Layer":"Object";console.error("Layer List Error: {0} with ID: {1} not available. Excluding from layer list. Please check your security settings.".format(t,e.mapServiceID))};switch(e.type){case"folder":r=new n.LayerListFolderItem(e.id,e.name,this),e.items&&e.items.length&&this._subItemIncludedInLayerList(e.items)||(r.displayItem.set(!1),r.isExpanded.set(!1)),this._userAddedLayersDestinationId&&e.id===this._userAddedLayersDestinationId&&(this._userAddedLayersFolder=r);break;case"mapService":(a=this.mapInfo.findMapServiceById(e.mapServiceID))||s(p.LayerListItemType.MAPSERVICE),a&&a.includeInLayerList&&(r=new h.LayerListMapServiceItem(e.id,a,this));break;case"layer":var a=this.mapInfo.findMapServiceById(e.mapServiceID);if(a||s(p.LayerListItemType.MAPSERVICE),a){var o=a.findLayerById(e.layerID);o||s(p.LayerListItemType.LAYER),o&&o.includeInLayerList&&(r=a.serviceLayer instanceof esri.layers.GraphicsLayer?new f.LayerListGraphicsLayerItem(e.id,o,this):new d.LayerListLayerItem(e.id,o,this))}break;default:throw new Error("Unknown layer list item type. Reported type: {0}".format(e.type))}return r&&(i&&(r.parent=i),null!=e.items&&e.items.length&&dojo.forEach(e.items,function(e){var i=t._createLayerListItemFromRestResult(e,r);i&&r.children.addItem(i)}),this._processItem(r,e)),r},t.prototype._subItemIncludedInLayerList=function(e){for(var i=this,t=0;t<e.length;t++)if(function(e){if("folder"===e.type)return!(!e.items||!e.items.length)&&i._subItemIncludedInLayerList(e.items);if("mapService"===e.type)return!!(t=i.mapInfo.findMapServiceById(e.mapServiceID))&&!!t.includeInLayerList;if("layer"===e.type){var t=i.mapInfo.findMapServiceById(e.mapServiceID),r=t.findLayerById(e.layerID);return!!r&&!!r.includeInLayerList}}(e[t]))return!0;return!1},t.prototype._processItem=function(e,i){if(e.type===p.LayerListItemType.FOLDER){if(this.mapInfo.gcxMap&&i.themeSettings&&i.themeSettings.length)for(var t=0;t<i.themeSettings.length;t++){var r=i.themeSettings[t],n=this.mapInfo.gcxMap.layerThemesInfo.getTheme(r.themeID);if(n){var s=void 0!=r.visible?r.visible:i.isVisible;e.layerThemeSettings.push(new u.LayerThemeSetting(n,s))}}if(e.id.get()===this._userAddedLayersDestinationId)for(var o=0;o<this.mapInfo.gcxMap.layerThemesInfo.themes.length;o++){var l=this.mapInfo.gcxMap.layerThemesInfo.themes[o];e.layerThemeSettings.push(new u.LayerThemeSetting(l,!0))}e._deferredVisibilitySetting=i.isVisible,e.isVisible.set(i.isVisible),e.configuredVisible=i.isVisible,e.isExpanded.set(i.isExpanded&&!(!i.items||!i.items.length)),this._disableFolderIfParentTiled(e)}if(e.type===p.LayerListItemType.MAPSERVICE&&e.isExpanded.set(e.mapService.isExpanded),e.type===p.LayerListItemType.LAYER&&e.isExpanded.set(e.layer.isExpanded&&!(!e.layer.subLayerIds||!e.layer.subLayerIds.length)),e.type===p.LayerListItemType.FOLDER){var c=i.iconUri;c&&(this.mapInfo.gcxMap&&this.mapInfo.gcxMap.site&&(c=v.RestHelper.processClientSideTokens(this.mapInfo.gcxMap.site,c)),e.iconUri.set(c),e.iconTooltip.set(e.name.get()))}if(e.canDisplayItem.set(!1!==i.isVisibleInLayerList),i.layerVisibilityType===m.LayerVisibilityType.MutuallyExclusive&&i.items&&i.items.length>1)for(var d=a.alphaNumericToken(32),y=0;y<e.children.length();y++)e.children.getAt(y).isMutuallyExclusive.set(!0),e.children.getAt(y).hasRadioToggle.set(!0),e.children.getAt(y).radioGroup.set(d)},t.prototype._disableFolderIfParentTiled=function(e){for(var i=e.parent;i&&i.id!==this.id&&(i.type===p.LayerListItemType.MAPSERVICE||i.type===p.LayerListItemType.FOLDER);){if(i.type===p.LayerListItemType.FOLDER&&i.canNotAssignVisibility.get()||i.type===p.LayerListItemType.MAPSERVICE&&i.mapService.serviceType===L.MapServiceType.TILED){e.canNotAssignVisibility.set(!0);break}i=i.parent}},t.prototype._generateThemeSettingsForCoreFolder=function(e,i){if(void 0===i&&(i=!1),i){if(this.mapInfo.gcxMap&&this.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured)for(var t=this.mapInfo.gcxMap.layerThemesInfo.themes,r=0;r<t.length;r++)e.layerThemeSettings.push(new u.LayerThemeSetting(t[r],!0));e.inActiveTheme.set(!0)}else for(var n={},r=0,s=e.children.length();r<s;r++){var a=e.children.getAt(r),o=null;switch(a.type){case p.LayerListItemType.FOLDER:o=a.layerThemeSettings;break;case p.LayerListItemType.MAPSERVICE:o=a.mapService.gcxMapService?a.mapService.gcxMapService.layerThemeSettings:null;break;case p.LayerListItemType.LAYER:case p.LayerListItemType.GRAPHICSLAYER:o=a.layer.gcxLayer?a.layer.gcxLayer.layerThemeSettings:null}if(o&&o.length)for(var l=0;l<o.length;l++){var c=o[l].theme.id;void 0==n[c]&&(e.layerThemeSettings.push(new u.LayerThemeSetting(o[l].theme,!0)),n[c]=!0)}}},t.prototype._applyInitialLayerTheme=function(){this.mapInfo.gcxMap&&this.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured&&this.mapInfo.gcxMap.applyStartupTheme()},t.prototype._processEligibleSingleMapServiceFolders=function(){var e=this._handledMapServiceReferences.slice(0),i=this._getFoldersContainingSingleMapService();i=this._filterEligibleSingleMsFolders(i),i=this._selectDeepestLevelSingleMapServiceFolders(i);for(var t=0;t<i.length;t++){var r=i[t];r.containedMapServices[0].serviceLayer instanceof esri.layers.GraphicsLayer||-1!==e.indexOf(r.containedMapServices[0])||-1!==this._outOfFolderMapServiceReferences.indexOf(r.containedMapServices[0])||(r.linkWithMapService(r.containedMapServices[0]),e.push(r.containedMapServices[0]))}},t.prototype._setupOpacityBindingsForParentsOfHiddenItemsWithOpacityBindings=function(){var e=this.getDescendants();e=dojo.filter(e,function(e){return e.canAdjustOpacity.get()});for(var i=0;i<e.length;i++){var t=e[i];if(!this.isEffectivelyDisplayed(t)){for(var r=t.parent;r instanceof p.LayerListItem&&!this.isEffectivelyDisplayed(r);)r=r.parent;r instanceof p.LayerListItem&&r._setupOpacityBindings()}}},t.prototype.isEffectivelyDisplayed=function(e){return!!e.displayItem.get()&&(!(e.parent instanceof p.LayerListItem)||this.isEffectivelyDisplayed(e.parent))},t.prototype._getFoldersContainingSingleMapService=function(){for(var e=[],i=0;i<this._addedFolderReferences.length;i++)1===this._addedFolderReferences[i].containedMapServices.length&&e.push(this._addedFolderReferences[i]);return e},t.prototype._filterEligibleSingleMsFolders=function(e){var i=this;if(e){for(var t=[],r=this._filterTopLevelFolders(e),n=0;n<e.length;n++){var s=e[n],a=dojo.filter(this._addedFolderReferences,function(e){return e.id!==s.id&&e.containedMapServices.length>0&&-1!==e.containedMapServices.indexOf(s.containedMapServices[0])})||[],o=a.filter(function(e){return e.containedMapServices.length>1})||[];this._noChildItemsWithMapService(s.containedMapServices[0],o)&&this._allFoldersAncestorsOrDescendantsOf(s,a)&&(r.some(function(e){return e.containedMapServices[0]===s.containedMapServices[0]&&!i._allFoldersAncestorsOf(s,[e])&&s.id!==e.id})||t.push(s))}return t}},t.prototype._filterTopLevelFolders=function(e){return this.children.get().filter(function(i){return i.type===p.LayerListItemType.FOLDER&&-1!==e.indexOf(i)})},t.prototype._selectDeepestLevelSingleMapServiceFolders=function(e){if(e){for(var i=[],t=[],r=0;r<e.length;r++){var n=e[r];if(-1===t.indexOf(n.containedMapServices[0])){var s=dojo.filter(e,function(e){return e.id!==n.id&&-1!==e.containedMapServices.indexOf(n.containedMapServices[0])})||[];if(s.length){var a,o=n;for(a=0;a<s.length;a++){if(!this._onlyFolderItems(o.children.get())||!this._allFoldersDescendantsOf(o,s.slice(a))){o=a>=1?s[a-1]:o;break}if(o.children.length()>1)break;o=s[a]}this._allFoldersDescendantsOf(o,s.slice(a))&&(i.push(o),t.push(o.containedMapServices[0]))}else i.push(n),t.push(n.containedMapServices[0])}}return i}},t.prototype._allFoldersDescendantsOf=function(e,i){for(var t=0;t<i.length;t++){var r=i[t].getAncestors();if(!r||-1===r.indexOf(e))return!1}return!0},t.prototype._allFoldersAncestorsOf=function(e,i){var t=e.getAncestors();if(t){for(var r=0;r<i.length;r++)if(-1===t.indexOf(i[r]))return!1;return!0}return!1},t.prototype._allFoldersAncestorsOrDescendantsOf=function(e,i){var t=Array.prototype.concat(e.getAncestors()||[],e.getDescendants()||[]);if(t){for(var r=0;r<i.length;r++)if(-1===t.indexOf(i[r]))return!1;return!0}return!1},t.prototype._noChildItemsWithMapService=function(e,i){for(var t=0;t<i.length;t++)for(var r=i[t].children.get(),n=0;n<r.length;n++)if(r[n].mapService&&r[n].mapService===e)return!1;return!0},t.prototype._onlyFolderItems=function(e){for(var i=0;i<e.length;i++)if(e[i].type!==p.LayerListItemType.FOLDER)return!1;return!0},t.prototype._processUnhandledMapServices=function(){var e=this;dojo.filter(this._allMapServiceReferences,function(i){return-1===e._handledMapServiceReferences.indexOf(i)}).forEach(function(e){(e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer||e.serviceLayer instanceof esri.layers.WMSLayer)&&e.serviceLayer.on("visibility-change",function(i){i.visible?e._esriLayerStateBackup&&(e.serviceLayer.setVisibleLayers(e._esriLayerStateBackup),e._esriLayerStateBackup=null):e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer?(e._esriLayerStateBackup=e.serviceLayer.visibleLayers?e.serviceLayer.visibleLayers.slice(0):[-1],e.serviceLayer.setVisibleLayers(["-1"])):(e._esriLayerStateBackup=e.serviceLayer.visibleLayers?e.serviceLayer.visibleLayers.slice(0):[],e.serviceLayer.setVisibleLayers([]))})})},t.prototype._addItemsToUserAddedFolder=function(e,i){var t=this._userAddedLayersFolder||this;if(e[0].type===p.LayerListItemType.LAYER&&this.children.getLength()){var r=e[0].layer.gcxLayer;if(r&&r.catalogId)for(var s=this._addedFolderReferences,a=0;a<s.length;a++){var o=s[a];if(o.canAdjustOpacity&&o.mapService&&o.mapService.gcxMapService===r.mapService){t=o;break}}}var l=i||0,c=e.reduceRight(function(e,i,r){return t.children.validateAndInsertItem(l,i)&&e},!0);return t===this._userAddedLayersFolder?(this._userAddedLayersFolder.inActiveTheme.set(!0),this._userAddedLayersFolder.displayItem.set(!0),this._userAddedLayersFolder.isExpanded.set(!0),this._userAddedLayersFolder.isVisible.set(!0),this._userAddedLayersFolder.parent instanceof n.LayerListFolderItem&&this._userAddedLayersFolder.parent.refreshOnDemandItemCollection()):t instanceof n.LayerListFolderItem&&t.refreshOnDemandItemCollection(),this._applyDeferredItemVisibilities(t.children.get()),c},t.prototype._handleFilterChanged=function(e){var i=this;if(e.filterControlId===this._filterControlId){this._itemsExpandedByFilter&&this._itemsExpandedByFilter.length&&(this._itemsExpandedByFilter.forEach(function(e){return e.isExpanded.set(!1)}),this._itemsExpandedByFilter.length=0);var t=function(e){for(var t=e.parent;t;){var r=i.filterControlComponent.getFilterableItem(t);!t.isExpanded||t.isExpanded.get()&&r.queryMatched||(r.queryMatched=!0,t.updateDisplayItem(),t.isExpanded.get()||(t.isExpanded.set(!0),i._itemsExpandedByFilter.push(t))),t=t.parent}};e.filterableItems.forEach(function(e){var i=e.item;i.updateDisplayItem(),e.filterQuery&&e.queryMatched&&t(i),i.refreshOnDemandItemCollection()})}},t}(r.LayerListNode);t.LayerList=I})},"geocortex/infrastructure/layerList/LayerListConfigurationParams":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})},"geocortex/infrastructure/layerList/LayerListFolderItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListItem","geocortex/framework/observables"],function(i,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(i){function t(e,t,n){var s=i.call(this,e,r.LayerListItemType.FOLDER,n)||this;return s.layerThemeSettings=[],s.containedMapServices=[],s.configuredVisible=!1,s.isUserCreated=!1,s._layerVisibilityHandle=null,s._themeChangingHandle=null,s._themeChangedHandle=null,s.name.set(t||s.layerList.appInfo.gcxApp.getResource(s.layerList._libraryId,"language-layerlist-default-folder-title")),s._setTooltips(),s.layerList&&s.layerList.mapInfo&&s.layerList.mapInfo.gcxMap&&s.layerList.mapInfo.gcxMap.layerThemesInfo&&(s._themeChangingHandle=dojo.connect(s.layerList.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangingEvent",dojo.hitch(s,s._handleLayerThemeChangingEvent)),s._themeChangedHandle=dojo.connect(s.layerList.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangedEvent",dojo.hitch(s,s._handleLayerThemeChangedEvent))),n._addedFolderReferences.push(s),s}return e(t,i),t.prototype.setVisibility=function(e){i.prototype.setVisibility.call(this,e),void 0==this._deferredVisibilitySetting&&(this.currentUserClickOriginator=!1,this.mapService&&this.mapService.setVisibility(e&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.mapService.isUserCreated)))},t.prototype.refreshOnDemandItemCollection=function(e){i.prototype.refreshOnDemandItemCollection.call(this,e),this.displayItem.set(this.displayInLayerList()&&this.layerList.filterControlComponent.queryMatched(this))},t.prototype.linkWithMapService=function(e){var i=this;e&&(this.mapService=e,this.layerList._handledMapServiceReferences.push(this.mapService),-1===this.layerList._allMapServiceReferences.indexOf(this.mapService)&&this.layerList._allMapServiceReferences.push(this.mapService),this._setupOpacityBindings(),this._layerVisibilityHandle=this.mapService.serviceLayer.on("visibility-change",function(e){if(void 0!=i._deferredVisibilitySetting||i.isEffectivelyVisible.get()!==e.visible||i.isEffectivelyVisible.get()&&!i.inActiveTheme.get()&&!i.mapService.isUserCreated){var t=e.visible&&(i.inActiveTheme.get()||i.mapService.isUserCreated);i.isVisible.set(t)}}))},t.prototype._setupOpacityBindings=function(){var e=this;1===this.containedMapServices.length?i.prototype._setupOpacityBindings.call(this):this.containedMapServices.length>1&&(this.canAdjustOpacity.set(!0),this.opacity=new n.Observable(1),this.opacity.bind(this,function(i){for(var t=0;t<e.containedMapServices.length;t++)e.containedMapServices[t].gcxMapService&&e.containedMapServices[t].gcxMapService.setOpacityFilter(i)}))},t.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(this._layerVisibilityHandle.remove(),this._layerVisibilityHandle=null),this._themeChangingHandle&&(dojo.unsubscribe(this._themeChangingHandle),this._themeChangingHandle=null),this._themeChangedHandle&&(dojo.unsubscribe(this._themeChangedHandle),this._themeChangedHandle=null)},t.prototype._handleLayerThemeChangingEvent=function(e){e.currTheme&&(this.isUserCreated||this.isVisible.get()||this.isVisible.set(!0))},t.prototype._handleLayerThemeChangedEvent=function(e){var i=this;if(e.currTheme){var t=e.currTheme,r=function(){i._refreshMutuallyExclusiveItemVisibilities(),i.refreshOnDemandItemCollection(),i._updateDisplayItem()};if(this.isUserCreated)return this._setInActiveThemeIfChildrenPresent(),void r();if(t.isDefaultTheme)return this.isVisible.get()!==this.configuredVisible&&this.isVisible.set(this.configuredVisible),this._setInActiveThemeIfChildrenPresent(),void r();if(this.layerThemeSettings.length)for(var n=0;n<this.layerThemeSettings.length;n++){var s=this.layerThemeSettings[n];if(t.id===s.theme.id){var a=void 0==s.visible?this.configuredVisible:s.visible;return this.isVisible.get()!==a&&this.isVisible.set(a),this._setInActiveThemeIfChildrenPresent(),void r()}}this.isVisible.set(!1),this.inActiveTheme.set(!1),r()}},t.prototype._refreshMutuallyExclusiveItemVisibilities=function(){this.children.get().forEach(function(e){e.isMutuallyExclusive.get()&&e.isVisible.get()&&e.isVisible.pulse()})},t.prototype._setInActiveThemeIfChildrenPresent=function(){var e=this._recursivelyConfirmChildrenInActiveTheme(this.children.get());!e&&this.inActiveTheme.get()&&this.inActiveTheme.set(!1),e&&!this.inActiveTheme.get()&&this.inActiveTheme.set(!0)},t.prototype._recursivelyConfirmChildrenInActiveTheme=function(e){for(var i=this,t=0;t<e.length;t++)if(function(e){return e.type===r.LayerListItemType.FOLDER?!(!e.children||!e.children.length())&&i._recursivelyConfirmChildrenInActiveTheme(e.children.get()):e.inActiveTheme.get()}(e[t]))return!0;return!1},t}(r.LayerListItem);t.LayerListFolderItem=s})},"geocortex/infrastructure/layerList/LayerListGraphicsLayerItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListLayerItem","./LayerListItem"],function(i,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(i){function t(e,t,r){var s=i.call(this,e,t,r,n.LayerListItemType.GRAPHICSLAYER)||this;if(!t)throw new Error("LayerListGraphicsLayerItem Initialization failed. Layer cannot be null.");var a=t.gcxLayer?t.gcxLayer.isVisible()||t.gcxLayer.configuredVisible:t.serviceLayerInfo.serviceLayer.defaultVisibility||t.isVisible();return s.canNotAssignVisibility.set(!1),s._deferredVisibilitySetting=a,s.isVisible.set(a),s}return e(t,i),t}(r.LayerListLayerItem);t.LayerListGraphicsLayerItem=s})},"geocortex/infrastructure/layerList/LayerListItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListNode","geocortex/framework/observables","./LayerListItemCollection","geocortex/essentials/MapServiceConstants"],function(i,t,r,n,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o;!function(e){e[e.FOLDER=0]="FOLDER",e[e.MAPSERVICE=1]="MAPSERVICE",e[e.LAYER=2]="LAYER",e[e.GRAPHICSLAYER=3]="GRAPHICSLAYER",e[e.KMLFOLDER=4]="KMLFOLDER"}(o=t.LayerListItemType||(t.LayerListItemType={}));var l=function(i){function t(e,t,r){var a=i.call(this,e)||this;if(a.mapService=null,a.opacity=null,a._opacityChangeHandle=null,a._parentExpandedStateBeforeFilter=null,!e)throw new Error("LayerListItem: Initialization failed. Layer list item id cannot be null");if(!r)throw new Error("LayerListItem: Initialization failed. LayerList cannot be null");return a.type=t,a.layerList=r,a.allAncestorsVisible=!0,a.isVisible=new n.Observable(!1),a.isEffectivelyVisible=new n.Observable(!1),a.parentEffectivelyVisible=new n.Observable(!0),a.inVisibleScaleRange=new n.Observable(!0),a.isEffectivelyVisible.syncTransform(a.isVisible,function(e){return e&&!!a.allAncestorsVisible}),a.name=new n.Observable(""),a.isExpanded=new n.Observable(!1),a.expandLegend=new n.Observable(!1),a.canNotAssignVisibility=new n.Observable(!1),a.canAdjustOpacity=new n.Observable(!1),a.inActiveTheme=new n.Observable(!0),a.canDisplayItem=new n.Observable(!0),a.displayItem=new n.Observable(!0),a.hasDisplayedChildren=new n.Observable(!1),a.children=new s.LayerListItemCollection(a),a.onDemandItemCollection=new n.ObservableCollection([]),a.legendItems=new n.ObservableCollection([]),a.legendSwatch=new n.Observable(""),a.legendHasMultipleItems=new n.Observable(!1),a.enableLayerActions=!1,a.enableMapServiceActions=!1,a.iconUri=new n.Observable(""),a.iconTooltip=new n.Observable(""),a.legendTooltip=new n.Observable(""),a.layerFolderToggleTooltip=new n.Observable(""),a.layerActionsTooltip=new n.Observable(""),a.layerToggleTooltip=new n.Observable(""),a.mapServiceActionsTooltip=new n.Observable(""),a.isMutuallyExclusive=new n.Observable(!1),a.hasRadioToggle=new n.Observable(!1),a.radioGroup=new n.Observable(""),a.isVisible.bind(a,a.setVisibility),a.isExpanded.bind(a,a.refreshOnDemandItemCollection),a.inActiveTheme.bind(a,a._onActiveThemeChanged),a.canDisplayItem.bind(a,a._updateDisplayItem),a.currentUserClickOriginator=!1,a.legendIsVisible=new n.Observable(!1),a.layerList.onlyShowSwatchesOnVisibleLayers&&(a.isEffectivelyVisible.bind(a,a._processLegendVisibility),a.inVisibleScaleRange.bind(a,a._processLegendVisibility),a.legendItems.bind(a,a._processLegendVisibility)),a.displayItem.bind(a,a._processLegendVisibility),a.legendSwatch.bind(a,function(e){a.layerList.enableLegendIntegration&&a._processLegendVisibility()}),a.name.bind(a,a._updateFilterControlComponent),a.canDisplayItem.bind(a,a._updateFilterControlComponent),a}return e(t,i),t.prototype.bindToActiveTheme=function(){},t.prototype.unbindFromActiveTheme=function(){},t.prototype.cleanUp=function(){this._opacityChangeHandle&&(this._opacityChangeHandle.remove(),this._opacityChangeHandle=null),this.unbindFromActiveTheme(),this.layerList.filterControlComponent.removeRegisteredItem(this)},t.prototype.notifyActiveThemeChanged=function(e){e&&!this.inActiveTheme.get()&&this.inActiveTheme.set(!0),this.type===o.FOLDER&&!e&&this.inActiveTheme.get()&&this.children&&dojo.every(this.children.get(),function(e){return!e.inActiveTheme.get()})&&this.inActiveTheme.set(!1)},t.prototype.setItemVisibility=function(e){this.currentUserClickOriginator=!0,this.isVisible.set(e)},t.prototype.setVisibility=function(e){if(void 0!==this.allAncestorsVisible)if(void 0==this._deferredVisibilitySetting){if(e&&this.isMutuallyExclusive.get()&&this.parent&&!this.layerList.mapInfo.gcxMap.layerThemesInfo.themeChangeInProgress)for(var i=0;i<this.parent.children.length();i++){var t=this.parent.children.getAt(i);t!==this&&t.isVisible.get()&&t.isVisible.set(!1)}}else this._deferredVisibilitySetting=e},t.prototype.setAncestorVisibility=function(e){this.allAncestorsVisible=e,this.isVisible.pulse()},t.prototype.refreshOnDemandItemCollection=function(e){var i=void 0==e?this.isExpanded.get():e;if(this.onDemandItemCollection.clear(),this.children&&this.children.length()&&i)for(var t=0,r=this.children.length();t<r;t++){var n=this.children.getAt(t);this.displayInLayerList(n)&&this.onDemandItemCollection.addItem(n)}},t.prototype.populateMapServicesInParentFolders=function(){var e=this;if(this.type!==o.FOLDER&&this.mapService){for(var i=[],t=this.parent,r=!0;t;){if(t.type===o.MAPSERVICE&&t.mapService===this.mapService)return;t.type===o.FOLDER&&(r=!1,-1===t.containedMapServices.indexOf(this.mapService)&&-1===t.id.get().indexOf(this.layerList.id.get())&&i.push(t)),t=t.parent}r?this.layerList._outOfFolderMapServiceReferences.push(this.mapService):dojo.forEach(i,function(i){i.containedMapServices.push(e.mapService)})}},t.prototype.updateDisplayItem=function(){this._updateDisplayItem()},t.prototype.displayInLayerList=function(e){if(void 0===e&&(e=this),!e.inActiveTheme.get())return!1;if(e.type!==o.FOLDER)return e.canDisplayItem.get();var i=!1;if(e.children&&e.children.length())for(var t=0,r=e.children.length();t<r;t++){var n=e.children.getAt(t);if(this.displayInLayerList(n))return!0;if(n.inActiveTheme.get()&&!n.canDisplayItem.get()){i=!0;break}}return i&&e.canDisplayItem.get()},t.prototype._applyDeferredInitialVisibility=function(){if(void 0!=this._deferredVisibilitySetting&&!this.layerList.suspendMapUpdates){var e=this._deferredVisibilitySetting;delete this._deferredVisibilitySetting,this.setVisibility(e)}},t.prototype._setupOpacityBindings=function(){var e=this;if(this.type!==o.LAYER&&this.type!==o.GRAPHICSLAYER&&this.mapService&&this.mapService.serviceLayer&&void 0!=this.mapService.serviceLayer.opacity&&void 0!=this.mapService.serviceLayer.setOpacity&&this.mapService.serviceType!==a.MapServiceType.FEATURE){this.canAdjustOpacity.set(!0),this.opacity=new n.Observable(this.mapService.serviceLayer.opacity);this.opacity.bind(this,function(i){e.mapService.setOpacity(i)}),this._opacityChangeHandle=this.mapService.serviceLayer.on("opacity-change",function(i){var t=!!e.layerList.appInfo.gcxApp.project.isLoading,r=t&&e.mapService.gcxMapService?e.mapService.gcxMapService.opacity:i.opacity;!t&&e.mapService.gcxMapService&&i.opacity===e.mapService.gcxMapService.opacity*e.mapService.gcxMapService.opacityFilter||e.opacity.set(r)})}},t.prototype._updateDisplayItem=function(){var e=this.displayInLayerList();e=e&&this.layerList.filterControlComponent.queryMatched(this),this.displayItem.set(e);var i=this.getSiblings(!0);if(i&&i.length){for(var t=0,r=0;r<i.length;r++)(n=i[r]).displayItem.get()&&t++;for(r=0;r<i.length;r++){var n=i[r];n.hasRadioToggle.set(n.isMutuallyExclusive.get()&&1!==t)}}},t.prototype._onActiveThemeChanged=function(e){this._updateDisplayItem();var i=this.parent;i&&i.id!==this.layerList.id&&i.notifyActiveThemeChanged(e)},t.prototype._processLegendVisibility=function(){this.layerList.onlyShowSwatchesOnVisibleLayers?this.legendIsVisible.set(this.isEffectivelyVisible.get()&&this.inVisibleScaleRange.get()&&!!this.legendItems.length()&&!!this.legendSwatch.get()&&this.displayItem.get()):this.legendIsVisible.set(!!this.legendItems.length()&&!!this.legendSwatch.get()&&this.displayItem.get()),1==this.legendItems.length()&&this.expandLegend.set(!1)},t.prototype._setTooltips=function(){var e=this,i=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-toggle").format(this.name.get()),t=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layer-actions-tooltip").format(this.name.get()),r=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-visible-at-extent"),n=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-not-visible-at-extent"),s=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-expand").format(this.name.get());this.layerActionsTooltip.set(t),this.layerFolderToggleTooltip.set(s),this.inVisibleScaleRange.get()?this.layerToggleTooltip.set(i+" "+r):this.layerToggleTooltip.set(i+" "+n),this.inVisibleScaleRange.bind(this,function(t){t?e.layerToggleTooltip.set(i+" "+r):e.layerToggleTooltip.set(i+" "+n)})},t.prototype._updateFilterControlComponent=function(){var e=this.canDisplayItem.get()&&!!this.name.get(),i=null!==this.layerList.filterControlComponent.getFilterableItem(this);e?(!i&&this.layerList.filterControlComponent.registerFilterableItem(this),this.layerList.filterControlComponent.setFilterData(this,[this.name.get()])):i&&this.layerList.filterControlComponent.removeRegisteredItem(this)},t}(r.LayerListNode);t.LayerListItem=l})},"geocortex/infrastructure/layerList/LayerListItemCollection":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","geocortex/framework/observables","./LayerListItem"],function(i,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(i){function t(e,t){void 0===t&&(t=[]);var r=i.call(this,t||[])||this;return r._parent=e,r}return e(t,i),t.prototype.addItem=function(e){if(!e)throw new Error("Layer list item not defined. Cannot insert in collection.");this._prepItemForAddition(e),i.prototype.addItem.call(this,e),this._processItemPostAddition(e)},t.prototype.validateAndAddItem=function(e){return!!e&&(this._validateCanAdd(e)?(this.addItem(e),!0):(console.error("LayerListItemCollection: Cannot add item with id: {0} in collection. Validation failed.".format(e.id.get())),!1))},t.prototype.addItems=function(e){if(!e)throw new Error("Layer list items are not defined. Cannot insert in collection.");this._prepItemsForAddition(e),i.prototype.addItems.call(this,e),this._processItemsPostAddition(e)},t.prototype.validateAndAddItems=function(e){if(!e||!e.length)return!1;for(var i=0;i<e.length;i++)if(!this._validateCanAdd(e[i]))return console.error("LayerListItemCollection: Cannot add items in collection. Validation failed."),!1;return this.addItems(e),!0},t.prototype.insertItem=function(e,t){if(!t)throw new Error("Layer list item not defined. Cannot insert at index "+e+" in collection.");this._prepItemForAddition(t),i.prototype.insertItem.call(this,e,t),this._processItemPostAddition(t)},t.prototype.insertItems=function(e,t){if(!t)throw new Error("Layer list items are not defined. Cannot insert at index "+e+" in collection.");this._prepItemsForAddition(t),i.prototype.insertItems.call(this,e,t),this._processItemsPostAddition(t)},t.prototype.validateAndInsertItem=function(e,i){return this._validateCanAdd(i)?(this.insertItem(e,i),!0):(console.error("LayerListItemCollection: Could not insert item with id: {0} in collection. Validation failed.".format(i.id.get())),!1)},t.prototype.validateAndInsertItems=function(e,i){if(!i||!i.length)return!1;for(var t=0;t<i.length;t++)if(!this._validateCanAdd(i[t]))return console.error("Could not insert items in collection. Validation failed."),!1;return this.insertItems(e,i),!0},t.prototype.removeItem=function(e){if(!e)throw new Error("LayerListItemCollection: Cannot remove item at index from collection.");this._prepItemForRemoval(e),i.prototype.removeItem.call(this,e)},t.prototype.removeAt=function(e){var t=this.getAt(e);if(!t)throw new Error("LayerListItemCollection: Cannot remove item at index "+e+" from collection.");this._prepItemForRemoval(t),i.prototype.removeAt.call(this,e)},t.prototype.removeRange=function(e,t){e=void 0!=e?Math.max(0,e):0,t=void 0!=t?Math.min(t,this.getLength()-1):this.getLength()-1,this._prepItemsForRemoval(this.get().slice(e,t+1)),i.prototype.removeRange.call(this,e,t)},t.prototype.clear=function(){this._prepItemsForRemoval(this.get()),i.prototype.clear.call(this)},t.prototype._prepItemForAddition=function(e){var i=this;this._parent&&(e.parent=this._parent,e.parentEffectivelyVisible.sync(e.parent.isEffectivelyVisible),e.setAncestorVisibility(this._parent.isVisible.get()),e._visibilityBindingToken=this._parent.isVisible.bind(e,function(t){e.setAncestorVisibility(t&&i._parent.allAncestorsVisible)}),this.length()&&this.getAt(0).isMutuallyExclusive.get()&&(e.isMutuallyExclusive.set(!0),e.hasRadioToggle.set(!0),e.radioGroup.set(this.getAt(0).radioGroup.get())),e._displayItemBindingToken=e.displayItem.bind(e,function(e){if(e)i._parent.hasDisplayedChildren.set(!0);else{for(var t=!1,r=0;r<i.length();r++)if(i.getAt(r).displayItem.get()){t=!0;break}i._parent.hasDisplayedChildren.set(t)}}),e.displayItem.pulse())},t.prototype._processItemPostAddition=function(e){e.type!==n.LayerListItemType.MAPSERVICE&&e.type!==n.LayerListItemType.LAYER&&e.type!==n.LayerListItemType.GRAPHICSLAYER||e.populateMapServicesInParentFolders()},t.prototype._prepItemForRemoval=function(e){if(e.parentEffectivelyVisible.removeSync(),e.parent=null,e._visibilityBindingToken&&this._parent&&(this._parent.isVisible.unbind(e._visibilityBindingToken),e._visibilityBindingToken=null),e._displayItemBindingToken&&this._parent&&(e.displayItem.unbind(e._displayItemBindingToken),e._displayItemBindingToken=null,e.displayItem)){for(var i=!1,t=0;t<this.length();t++)if(this.getAt(t)!==e&&this.getAt(t).displayItem.get()){i=!0;break}this._parent.hasDisplayedChildren.set(i)}e.cleanUp()},t.prototype._prepItemsForAddition=function(e){var i=this;dojo.forEach(e,function(e){i._prepItemForAddition(e)})},t.prototype._processItemsPostAddition=function(e){var i=this;dojo.forEach(e,function(e){i._processItemPostAddition(e)})},t.prototype._prepItemsForRemoval=function(e){var i=this;dojo.forEach(e,function(e){i._prepItemForRemoval(e)})},t.prototype._validateCanAdd=function(e){var i=this,t=(this.layerList||this._parent.layerList).getDescendants();if(t.filter(function(i){return i===e}).length)return!1;if(e.type===n.LayerListItemType.FOLDER)return e.children.getItems().every(function(e){return i._validateCanAdd(e)});if(e.type===n.LayerListItemType.MAPSERVICE)return!!e.mapService&&!t.some(function(i){return i.mapService&&(i.mapService===e.mapService||i.mapService.serviceLayer===e.mapService.serviceLayer)});if(e.type===n.LayerListItemType.LAYER){var r=e;return!!r.layer&&!t.some(function(e){return e.layer&&e.layer===r.layer})}return!0},t}(r.ObservableCollection);t.LayerListItemCollection=s})},"geocortex/infrastructure/layerList/LayerListKmlFolderItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListItem"],function(i,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(i){function t(e,t,n,s){var a=i.call(this,e,r.LayerListItemType.KMLFOLDER,t)||this;if(!n)throw new Error("LayerListKmlFolderItem: Initialization failed. KML layer object cannot be null.");if(!s)throw new Error("LayerListKmlFolderItem: Initialization failed. KML folder object cannot be null.");return a._kmlLayer=n,a._kmlFolder=s,a.name.set(s.name),a._setTooltips(),a.isVisible.set(!!s.visibility),a}return e(t,i),t.prototype.setItemVisibility=function(e){i.prototype.setItemVisibility.call(this,e),this._kmlLayer.setFolderVisibility(this._kmlFolder,e)},t}(r.LayerListItem);t.LayerListKmlFolderItem=n})},"geocortex/infrastructure/layerList/LayerListLayerItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListItem","./../legend/LegendItemProviderFactory"],function(i,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(i){function t(e,t,n,s){var a=i.call(this,e,s||r.LayerListItemType.LAYER,n)||this;if(a._themeSyncHandle=null,a._layerVisibilityHandle=null,a._zoomEndHandle=null,a._deferRefreshTimeoutMs=200,a._forceSetAncestorVisibilityOperationActive=!1,!t)throw new Error("LayerListLayerItem Initialization failed. Layer cannot be null");if(a.isUserCreated=t.isUserCreated,a.layer=t,a._updateVisibilityAtCurrentScale(),a._zoomEndHandle=a.layerList.appInfo.mapInfo.map.on("zoom-end",dojo.hitch(a,a._updateVisibilityAtCurrentScale)),a.type===r.LayerListItemType.LAYER){var o=!t.gcxLayer||(t.gcxLayer.isVisible()||t.gcxLayer.configuredVisible);a.canNotAssignVisibility.set(!a.layer.serviceLayerInfo.supportsLayerVisibility()),a._deferredVisibilitySetting=o,a.isVisible.set(o)}return a.name.set(t.displayName||t.name),a._setTooltips(),a.mapService=t.serviceLayerInfo,-1===n._allMapServiceReferences.indexOf(a.mapService)&&n._allMapServiceReferences.push(a.mapService),a.enableLayerActions=!0,a._subscribeEvents(),a._setupGcxBindingsIfAvailable(),a}return e(t,i),t.prototype.setVisibility=function(e,t){if(i.prototype.setVisibility.call(this,e),this._forceSetAncestorVisibilityOperationActive=this._forceSetAncestorVisibilityOperationActive||t,!(this.canNotAssignVisibility&&this.canNotAssignVisibility.get()||void 0===this.allAncestorsVisible||void 0!=this._deferredVisibilitySetting)){if((this._forceSetAncestorVisibilityOperationActive||this.layerList.autoActivateAncestorVisibilities&&this.currentUserClickOriginator)&&!0===e&&!this.allAncestorsVisible){this.isVisible.get()!==e&&this.isVisible.set(e);for(var r=this.parent;r&&r.id!==this.layerList.id&&r.isVisible.get();)r=r.parent;if(r&&r.id!==this.layerList.id)return void r.isVisible.set(!0)}var n=!this.currentUserClickOriginator&&this.mapService.supportsLayerVisibility();this.currentUserClickOriginator=!1,this._forceSetAncestorVisibilityOperationActive=!1;var s=e&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.layer.isUserCreated);this.layer.isVisible()!==s&&this.layer.setVisibility(s,!1,n,this._deferRefreshTimeoutMs)}},t.prototype.updateLegendItems=function(){var e=this;n.LegendItemProviderFactory.getLegendItemWhenAvailable(this.layer,dojo.hitch(this,function(i){e.legendItems.clear(),e._populateLegendItem(i)}))},t.prototype.bindToActiveTheme=function(){var e=this;i.prototype.bindToActiveTheme.call(this),this._themeSyncHandle=dojo.subscribe("LayerInActiveThemeChangedEvent",function(i){i&&i===e.layer.gcxLayer&&e.inActiveTheme.set(i.inActiveTheme)})},t.prototype.unbindFromActiveTheme=function(){i.prototype.unbindFromActiveTheme.call(this),this._themeSyncHandle&&dojo.unsubscribe(this._themeSyncHandle),this._themeSyncHandle=null},t.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(dojo.unsubscribe(this._layerVisibilityHandle),this._layerVisibilityHandle=null),this._zoomEndHandle&&(this._zoomEndHandle.remove(),this._zoomEndHandle=null)},t.prototype._subscribeEvents=function(){this._layerVisibilityHandle=dojo.subscribe("LayerVisibilityChange",dojo.hitch(this,this._handleLayerVisibilityChange))},t.prototype._onServiceLayerProcessed=function(){this._setupIconUri(),this.layerList.enableLegendIntegration&&!this.layer.serviceLayerInfo.serviceLayer.loadError&&n.LegendItemProviderFactory.getLegendItemWhenAvailable(this.layer,dojo.hitch(this,this._populateLegendItem))},t.prototype._handleLayerVisibilityChange=function(e){if(e&&e.length&&e[0].mapServiceId===this.layer.serviceLayerInfo.id)for(var i=0;i<e.length;i++)if(e[i].layerId===this.layer.id){if(void 0==this._deferredVisibilitySetting&&this.isEffectivelyVisible.get()===e[i].visibility&&(!this.isEffectivelyVisible.get()||this.inActiveTheme.get()||this.layer.isUserCreated))break;var t=e[i].visibility&&(this.inActiveTheme.get()||this.layer.isUserCreated);this.isVisible.set(t);break}},t.prototype._populateLegendItem=function(e){"single-item"===e.templateType?(this.expandLegend.set(!1),this.legendItems.addItem(e),this.legendSwatch.set(e.swatchElement)):(this.legendItems.addItems(e.children.get()),1===this.legendItems.length()?this.legendSwatch.set(this.legendItems.getAt(0).swatchElement):this.legendItems.length()&&this.legendSwatch.set(this.layerList.multiLegendSwatchElement||this.legendItems.getAt(0).swatchElement)),this.legendItems.length()>1?this.legendHasMultipleItems.set(!0):this.legendHasMultipleItems.set(!1),this.legendItems.length()&&(this.iconUri.set(""),this.legendTooltip.set(1===this.legendItems.length()?this.layerList.singleLegendIconTooltip.format(this.name.get()):this.layerList.multiLegendIconTooltip),this.legendTooltip.set(this.legendTooltip.get().format(this.name.get())))},t.prototype._setupIconUri=function(){var e=this.layer.gcxLayer,i=e?e.mapService:null;this.layer.serviceLayerInfo.serviceLayer.loadError&&this.layerList.serviceLoadFailureIconUri?(this.iconUri.set(this.layerList.serviceLoadFailureIconUri),this.iconTooltip.set(this.layerList.serviceLoadFailureIconTooltip?this.layerList.serviceLoadFailureIconTooltip:"")):this.layerList&&this.layerList.enableLayerIcons&&(e&&e.iconUri||i&&this.type===r.LayerListItemType.GRAPHICSLAYER&&i.iconUri)&&(this.iconUri.set(e.iconUri||i.iconUri),this.iconTooltip.set(this.name.get()))},t.prototype._setupGcxBindingsIfAvailable=function(){var e=this;if(this.layer.gcxLayer)if(this.bindToActiveTheme(),this.layer.serviceLayerInfo.serviceLayer.loaded||this.layer.serviceLayerInfo.serviceLayer.loadError)this._onServiceLayerProcessed();else{var i=null,t=null,r=function(){i&&dojo.disconnect(i),t&&dojo.disconnect(t),i=t=null};i=dojo.connect(this.mapService.serviceLayer,"onLoad",function(){r(),e._onServiceLayerProcessed()}),t=dojo.connect(this.mapService.serviceLayer,"onError",function(){r(),e._onServiceLayerProcessed()})}},t.prototype._updateVisibilityAtCurrentScale=function(){var e=!1,i=esri.geometry.getScale(this.layerList.appInfo.mapInfo.map);(0==this.layer.getMaxScale()&&this.layer.getMinScale()==1/0||isNaN(this.layer.getMaxScale())&&isNaN(this.layer.getMinScale()))&&(e=!0),this.inVisibleScaleRange.set(e||this.layer.getMaxScale()<i&&i<this.layer.getMinScale())},t}(r.LayerListItem);t.LayerListLayerItem=s})},"geocortex/infrastructure/layerList/LayerListMapServiceItem":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./LayerListItem","geocortex/essentials/MapServiceConstants","./LayerListKmlFolderItem"],function(i,t,r,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(i){function t(e,t,n){var s=i.call(this,e,r.LayerListItemType.MAPSERVICE,n)||this;if(s._themeSyncHandle=null,s._layerVisibilityHandle=null,s._forceSetAncestorVisibilityOperationActive=!1,!t)throw new Error("LayerListMapServiceItem Initialization failed. MapService cannot be null");var a;a=s.layerList&&s.layerList.mapInfo&&s.layerList.mapInfo.gcxMap&&s.layerList.mapInfo.gcxMap.layerThemesInfo&&s.layerList.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured?!t.gcxMapService||!t.gcxMapService.serviceLayer||t.gcxMapService.serviceLayer.visible:!t.gcxMapService||t.gcxMapService.configuredVisible,s.name.set(t.displayName?t.displayName:""),s._setTooltips(),s.mapService=t,n._handledMapServiceReferences.push(t),-1===n._allMapServiceReferences.indexOf(t)&&n._allMapServiceReferences.push(t),s._deferredVisibilitySetting=a,s.isVisible.set(a);s.mapService.serviceType;if(s.isUserCreated=t.isUserCreated,s.enableMapServiceActions=t.isUserCreated,s._setupOpacityBindings(),s._subscribeEvents(),s._setupBindings(),t.serviceLayer instanceof esri.layers.KMLLayer){var o=t.serviceLayer;o.loaded?s._kmlLayerLoadHandler(o):o.on("load",function(e){return s._kmlLayerLoadHandler(e.layer)})}return s}return e(t,i),t.prototype.setVisibility=function(e,t){if(i.prototype.setVisibility.call(this,e),this._forceSetAncestorVisibilityOperationActive=this._forceSetAncestorVisibilityOperationActive||t,this._syncChildVisibilitiesIfApplicable(e),void 0!==this.allAncestorsVisible&&void 0==this._deferredVisibilitySetting){if((this._forceSetAncestorVisibilityOperationActive||this.layerList.autoActivateAncestorVisibilities&&this.currentUserClickOriginator)&&!0===e&&!this.allAncestorsVisible){this.isVisible.get()!==e&&this.isVisible.set(e);for(var r=this.parent;r&&r.id!==this.layerList.id&&r.isVisible.get();)r=r.parent;if(r&&r.id!==this.layerList.id)return void r.isVisible.set(!0)}this.currentUserClickOriginator=!1,this._forceSetAncestorVisibilityOperationActive=!1,this.mapService.setVisibility(e&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.mapService.isUserCreated))}},t.prototype.bindToActiveTheme=function(){var e=this;i.prototype.bindToActiveTheme.call(this),this._themeSyncHandle=dojo.subscribe("MapServiceInActiveThemeChangedEvent",function(i){i&&i===e.mapService.gcxMapService&&e.inActiveTheme.set(i.inActiveTheme)})},t.prototype.unbindFromActiveTheme=function(){i.prototype.unbindFromActiveTheme.call(this),this._themeSyncHandle&&dojo.unsubscribe(this._themeSyncHandle),this._themeSyncHandle=null},t.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(this._layerVisibilityHandle.remove(),this._layerVisibilityHandle=null)},t.prototype._subscribeEvents=function(){var e=this;this._layerVisibilityHandle=this.mapService.serviceLayer.on("visibility-change",function(i){if(void 0!=e._deferredVisibilitySetting||e.isEffectivelyVisible.get()!==i.visible||e.isEffectivelyVisible.get()&&!e.inActiveTheme.get()&&!e.mapService.isUserCreated){var t=i.visible&&(e.inActiveTheme.get()||e.mapService.isUserCreated);e.isVisible.set(t)}})},t.prototype._setupIconUri=function(){this.mapService.serviceLayer.loadError&&this.layerList.serviceLoadFailureIconUri?(this.iconUri.set(this.layerList.serviceLoadFailureIconUri),this.iconTooltip.set(this.layerList.serviceLoadFailureIconTooltip?this.layerList.serviceLoadFailureIconTooltip:"")):this.mapService.gcxMapService&&this.mapService.gcxMapService.iconUri&&(this.iconUri.set(this.mapService.gcxMapService.iconUri),this.iconTooltip.set(this.name.get()))},t.prototype._syncChildVisibilitiesIfApplicable=function(e){var i=this;switch(this.mapService.serviceType){case n.MapServiceType.BING:case n.MapServiceType.TILED:case n.MapServiceType.WMTS:case n.MapServiceType.IMAGE:case n.MapServiceType.WEBTILED:this.children.length()>0&&this.getDescendants().forEach(function(t){t.type===r.LayerListItemType.LAYER&&t.mapService.id===i.mapService.id&&t.isVisible.get()!==e&&t.isVisible.set(e)});break;default:return}},t.prototype._setupBindings=function(){var e=this;if(this.mapService.gcxMapService&&this.bindToActiveTheme(),this.mapService.serviceLayer.loaded||this.mapService.serviceLayer.loadError)this._setupIconUri();else{var i=null,t=null,r=function(){i&&dojo.disconnect(i),t&&dojo.disconnect(t),i=t=null};i=dojo.connect(this.mapService.serviceLayer,"onLoad",function(){r(),e._setupIconUri()}),t=dojo.connect(this.mapService.serviceLayer,"onError",function(){r(),e._setupIconUri()})}if(!this.mapService.serviceLayer.loaded&&!this.mapService.serviceLayer.loadError)var n=this.mapService.serviceLayer.on("load",function(){e._updateVisibilityAtCurrentScale(),n.remove()});if(!this.mapService.serviceLayer.getMap())var s=this.layerList.appInfo.map.on("layer-add",function(i){i.layer===e.mapService.serviceLayer&&(e._updateVisibilityAtCurrentScale(),s.remove())});this._updateVisibilityAtCurrentScale(),this.mapService.serviceLayer.on("scale-visibility-change",function(){return e._updateVisibilityAtCurrentScale()})},t.prototype._kmlLayerLoadHandler=function(e){e.folders&&e.folders.length>1&&(this._createKmlFolders(this,e.folders[1],e),this.refreshOnDemandItemCollection())},t.prototype._createKmlFolders=function(e,i,t){for(var r=t.folders,n=0;n<i.subFolderIds.length;n++){for(var a=i.subFolderIds[n],o=null,l=0;l<r.length;l++)if(r[l].id===a){o=r[l];break}if(!o)throw new Error("Could not find KML folder with ID '{0}'.".format(a));var c=new s.LayerListKmlFolderItem(this.mapService.id+a,this.layerList,t,o);this._createKmlFolders(c,o,t),e.children.addItem(c)}},t.prototype._updateVisibilityAtCurrentScale=function(){this.mapService.serviceLayer.loaded&&this.mapService.serviceLayer.getMap()&&this.inVisibleScaleRange.set(this.mapService.serviceLayer.visibleAtMapScale)},t.prototype._setTooltips=function(){i.prototype._setTooltips.call(this);var e=this.layerList.appInfo.gcxApp;if(e){var t=e.getResource(this.layerList._libraryId,"language-mapservice-actions-tooltip").format(this.name.get());this.mapServiceActionsTooltip.set(t)}},t}(r.LayerListItem);t.LayerListMapServiceItem=a})},"geocortex/infrastructure/layerList/LayerListNode":function(){define(["require","exports","geocortex/framework/observables"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,i){this.id=new t.Observable(""),this.children=null,this.parent=null,e&&this.id.set(e),i&&(this.parent=i)}return e.prototype.getRoot=function(){for(var e=this;null!=e.parent;)e=e.parent;return e},e.prototype.getAncestors=function(){var e=null;if(this.parent){e=[];for(var i=this.parent;null!=i;)e.push(i),i=i.parent}return e},e.prototype.getSelfAndAncestors=function(){var e=this.getAncestors();return(e=e&&e.length?e:[]).unshift(this),e},e.prototype.getSiblings=function(e){void 0===e&&(e=!1);var i=null;if(this.parent&&this.parent.children&&(i=this.parent.children.get(),!e)){i=i.slice(0);for(var t=0;t<i.length;t++)if(i[t]===this){i.splice(t,1);break}}return i},e.prototype.getDescendants=function(){if(this.children){for(var e=[],i=this.children.get(),t=0;t<i.length;t++){var r=i[t];e.push(r);for(var n=r.getDescendants(),s=0;s<n.length;s++)e.push(n[s])}return e}},e.prototype.getSelfAndDescendants=function(){var e=this.getDescendants();return(e=e&&e.length?e:[]).unshift(this),e},e}();i.LayerListNode=r})},"geocortex/infrastructure/layerList/LayerVisibilityType":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t=function(){return function(){}}();t.Default="default",t.MutuallyExclusive="mutuallyExclusive",i.LayerVisibilityType=t})}}});require({cache:{"geocortex/infrastructure/layerselector/LayerSelector":function(){define(["require","exports","geocortex/framework/observables","./../gis/ServiceLayerInfo","./../gis/LayerInfo","geocortex/framework/utils/utils"],function(e,t,r,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){this.filteredLayerSelectorLayerItems=[],this.unfilteredLayerSelectorLayerItems=[],this.itemTypes={FOLDER:"folder",LAYER:"layer",SERVICELAYER:"serviceLayer"},this._infrastructureLibraryId="Mapping.Infrastructure",this._unfilteredItems=[],this._userAddedLayersFolder=null,this.appInfo=e,t&&(t.layerFilter&&dojo.isFunction(t.layerFilter)&&(this.layerFilter=t.layerFilter),t.layerStateChangeHandler&&dojo.isFunction(t.layerStateChangeHandler)&&(this.layerStateChangeHandler=t.layerStateChangeHandler),t.enableAllLayersHandler&&dojo.isFunction(t.enableAllLayersHandler)&&(this.enableAllLayersHandler=t.enableAllLayersHandler),t.disableAllLayersHandler&&dojo.isFunction(t.disableAllLayersHandler)&&(this.disableAllLayersHandler=t.disableAllLayersHandler),t.onInitializedHandler&&dojo.isFunction(t.onInitializedHandler)&&(this.onInitializedHandler=t.onInitializedHandler),t.onLayerSelectorFolderItemCreated&&dojo.isFunction(t.onLayerSelectorFolderItemCreated)&&(this.onLayerSelectorFolderItemCreated=t.onLayerSelectorFolderItemCreated),t.onLayerSelectorLayerItemCreated&&dojo.isFunction(t.onLayerSelectorLayerItemCreated)&&(this.onLayerSelectorLayerItemCreated=t.onLayerSelectorLayerItemCreated),t.onLayerSelectorServiceLayerItemCreated&&dojo.isFunction(t.onLayerSelectorServiceLayerItemCreated)&&(this.onLayerSelectorServiceLayerItemCreated=t.onLayerSelectorServiceLayerItemCreated)),this.items=new r.ObservableCollection,this.initialized=!1,this._suspendLayerStateChangeHandler=!1,this.initialize()}return e.prototype.initialize=function(){this._loadLayerSelectorItems(),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),this.setEnableAllLayersHandler(this.enableAllLayersHandler),this.setDisableAllLayersHandler(this.disableAllLayersHandler),this.onInitializedHandler&&!this.initialized&&this.onInitializedHandler(this),this.initialized=!0},e.prototype.applyFilter=function(e){var t=this;if(this.layerFilter=e&&dojo.isFunction(e)?e:null,this.items.clear(),this.filteredLayerSelectorLayerItems=[],!this.layerFilter)return this.items.set(this._unfilteredItems),void(this.filteredLayerSelectorLayerItems=this.unfilteredLayerSelectorLayerItems.slice(0));var r=function(e){var a=null;return e.itemType===t.itemTypes.FOLDER?(a=t._generateItemCloneForFilter(e),e.items.get().forEach(function(e){var t=r(e);t&&(!t.isFolder||t.isFolder&&t.items.length())&&a.items.addItem(t)}),a):(e.itemType===t.itemTypes.SERVICELAYER&&e.items.getLength()>0?(t.layerFilter(e)?(a=t._generateItemCloneForFilter(e),t.filteredLayerSelectorLayerItems.push(a)):a=t._creatFolderItemFromServiceLayer(e,!0,!0),e.items.get().forEach(function(e){var t=r(e);t&&(!t.isFolder||t.isFolder&&t.items.length())&&a.items.addItem(t)})):t.layerFilter(e)&&(a=e,t.filteredLayerSelectorLayerItems.push(a)),a)};this._unfilteredItems.forEach(function(e){var a=r(e);a&&(!a.isFolder||a.isFolder&&a.items.length())&&t.items.addItem(a)})},e.prototype.reapplyFilter=function(){this.applyFilter(this.layerFilter)},e.prototype.setLayerStateChangeHandler=function(e){var t=this;t.unfilteredLayerSelectorLayerItems.forEach(function(e){e._isEnabledBindingToken&&(e.isEnabled.unbind(e._isEnabledBindingToken),delete e._isEnabledBindingToken)}),this.layerStateChangeHandler=e&&dojo.isFunction(e)?e:null,this.layerStateChangeHandler&&this.unfilteredLayerSelectorLayerItems.forEach(function(e){e._isEnabledBindingToken=e.isEnabled.bind(t,function(){t._suspendLayerStateChangeHandler||t.layerStateChangeHandler(e)})})},e.prototype.setEnableAllLayersHandler=function(e){this.enableAllLayersHandler=e&&dojo.isFunction(e)?e:null},e.prototype.setDisableAllLayersHandler=function(e){this.disableAllLayersHandler=e&&dojo.isFunction(e)?e:null},e.prototype.enableAllLayers=function(){this._suspendLayerStateChangeHandler=!0,this.filteredLayerSelectorLayerItems.forEach(function(e){return e.isEnabled.set(!0)}),this._suspendLayerStateChangeHandler=!1,this.enableAllLayersHandler&&this.enableAllLayersHandler()},e.prototype.disableAllLayers=function(){this._suspendLayerStateChangeHandler=!0,this.filteredLayerSelectorLayerItems.forEach(function(e){return e.isEnabled.set(!1)}),this._suspendLayerStateChangeHandler=!1,this.disableAllLayersHandler&&this.disableAllLayersHandler()},e.prototype.addUserAddedServiceLayer=function(e){var t=this;if(e instanceof a.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;if(this.unfilteredLayerSelectorLayerItems.filter(function(t){return t.serviceLayer&&t.serviceLayer.gcxMapService===e}).length)return!1;var r=a.ServiceLayerInfo.fromGcxMapService(e),n=this._createServiceLayerItemFromServiceLayer(r,!0,!0);return this.unfilteredLayerSelectorLayerItems.push(n),e.layers.forEach(function(e){if(t.unfilteredLayerSelectorLayerItems.filter(function(t){return t.layer&&t.layer.gcxLayer===e}).length)return!1;var a=r.findLayerById(e.id);a||((a=i.LayerInfo.fromGcxLayer(e)).serviceLayerInfo=r,r.layers.push(a));var l=t._createLayerItemFromLayer(a,!0,!0);l&&(n.items.addItem(l),t.unfilteredLayerSelectorLayerItems.push(l))}),this._unfilteredItems.push(n),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},e.prototype.removeServiceLayer=function(e){var t=this;if(e instanceof a.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;var r=this.unfilteredLayerSelectorLayerItems.filter(function(t){return t.serviceLayer&&t.serviceLayer.gcxMapService===e});return r.length&&r.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)}),e.layers.forEach(function(e){var r=t.unfilteredLayerSelectorLayerItems.filter(function(t){return t.layer&&t.layer.gcxLayer===e});if(!r.length)return!1;r.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)})}),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},e.prototype.updateServiceLayer=function(e,t,r){var l=this;if(t=t||[],r=r||[],e instanceof a.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;for(var o=a.ServiceLayerInfo.fromGcxMapService(e),s=0;r&&s<r.length;s++){d=r[s];(u=this.unfilteredLayerSelectorLayerItems.filter(function(e){return e.layer&&e.layer.gcxLayer===d})).length&&u.forEach(function(e){return l._removeItemFromUnfilteredCollections(e)})}if(!this._userAddedLayersFolder){var c={id:n.alphaNumericToken()+":UserAdded",name:this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerlist-user-added-layers-folder-title"),isExpanded:!0,isVisible:!0,items:[],canToggleVisibility:null,iconUri:null,isVisibleInLayerList:null,layerID:null,mapServiceID:null,layerVisibilityType:null,themeSettings:null,type:null};this._userAddedLayersFolder=this._createFolderItemFromRestItem(c,!0,!0)}for(var y=0;t&&y<t.length;y++){var d=t[y],u=this.unfilteredLayerSelectorLayerItems.filter(function(e){return e.layer&&e.layer.gcxLayer===d});if(!u.length){var p=o.findLayerById(d.id);p||((p=i.LayerInfo.fromGcxLayer(d)).serviceLayerInfo=o,o.layers.push(p));var f=this._createLayerItemFromLayer(p,!0,!0);f&&(this._userAddedLayersFolder.items.addItem(f),this.unfilteredLayerSelectorLayerItems.push(f))}}return this._userAddedLayersFolder&&this._userAddedLayersFolder.items.length()>0&&this._unfilteredItems.indexOf(this._userAddedLayersFolder)<0&&this._unfilteredItems.unshift(this._userAddedLayersFolder),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},e.prototype._removeItemFromUnfilteredCollections=function(e){var t=this;if(e){var r=[],a=function(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)},i=function(e,t){for(var n=e.length-1;n>=0;n--){var l=e[n];l===t?e.splice(n,1):l.isFolder&&l.items.length()&&(a(l.items.get(),t),l.items.pulse(),i(l.items.get(),t),0===l.items.length()&&r.push(l))}};e.isFolder||a(this.unfilteredLayerSelectorLayerItems,e),i(this._unfilteredItems,e),r.length&&r.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)})}},e.prototype._loadLayerSelectorItems=function(){var e=this,t=this.appInfo.gcxApp.site.layerListRestEndpoint,r=this.appInfo.mapInfo;this._unfilteredItems=[],this.unfilteredLayerSelectorLayerItems=[];var a=function(t){var i,n=void 0==t.isExpanded||t.isExpanded;switch(t.type){case"folder":i=e._createFolderItemFromRestItem(t,!0,n);break;case"mapService":var l=r.findMapServiceById(t.mapServiceID);i=e._createServiceLayerItemFromServiceLayer(l,!0,n),e.unfilteredLayerSelectorLayerItems.push(i);break;case"layer":var o=(l=r.findMapServiceById(t.mapServiceID))&&l.findLayerById(t.layerID);i=e._createLayerItemFromLayer(o,!0,n),e.unfilteredLayerSelectorLayerItems.push(i)}if(i&&t.items)for(var s=0;s<t.items.length;s++){var c=a(t.items[s]);c&&i.items.addItem(c)}return"folder"===t.type&&i&&0===i.items.getLength()?null:i};t.items&&t.items.length&&t.items.forEach(function(t){var r=a(t);r&&e._unfilteredItems.push(r)}),this._loadSelectorItemsNotInLayerList()},e.prototype._loadSelectorItemsNotInLayerList=function(){for(var e=0;e<this.appInfo.mapInfo.serviceLayers.length;e++){var t=null,r=this.appInfo.mapInfo.serviceLayers[e];r&&!r.includeInLayerList&&(t=this._createServiceLayerItemFromServiceLayer(r,!0,!0),this._unfilteredItems.push(t),this.unfilteredLayerSelectorLayerItems.push(t));for(var a=0;a<r.layers.length;a++){var i=r.layers[a];if(!(!i||i&&i.includeInLayerList)){var n=this._createLayerItemFromLayer(i,!0,!0);t&&n?(t.items.addItem(n),this.unfilteredLayerSelectorLayerItems.push(n)):null==t&&n&&(this._unfilteredItems.push(n),this.unfilteredLayerSelectorLayerItems.push(n))}}}},e.prototype._createFolderItemFromRestItem=function(e,t,a){if(!e)return null;var i={};return i.itemType=this.itemTypes.FOLDER,i.name=new r.Observable(e.name||"Layers"),i.isFolder=!0,i.isEnabled=new r.Observable(!!t),i.isExpanded=new r.Observable(!!a),i.iconUri=new r.Observable(""),i.items=new r.ObservableCollection,this._setTooltips(i),this.onLayerSelectorFolderItemCreated&&this.onLayerSelectorFolderItemCreated(i),i},e.prototype._creatFolderItemFromServiceLayer=function(e,t,a){var i={};return i.itemType=this.itemTypes.FOLDER,i.name=new r.Observable(e.name.get()||"Layers"),i.isFolder=!0,i.isEnabled=new r.Observable(!!t),i.isExpanded=new r.Observable(!!a),i.iconUri=new r.Observable(e.iconUri.get()||""),i.items=new r.ObservableCollection,this._setTooltips(i),this.onLayerSelectorFolderItemCreated&&this.onLayerSelectorFolderItemCreated(i),i},e.prototype._createLayerItemFromLayer=function(e,t,a){if(!e)return null;var i={};return i.itemType=this.itemTypes.LAYER,i.isEnabled=new r.Observable(!!t),i.isExpanded=new r.Observable(!!a),i.name=new r.Observable(e.gcxLayer.displayName),i.isFolder=!1,i.iconUri=new r.Observable(e.gcxLayer.iconUri),i.layer=e,i.items=new r.ObservableCollection([]),this._setTooltips(i),this.onLayerSelectorLayerItemCreated&&this.onLayerSelectorLayerItemCreated(i),i},e.prototype._createServiceLayerItemFromServiceLayer=function(e,t,a){if(!e)return null;var i={};return i.itemType=this.itemTypes.SERVICELAYER,i.isEnabled=new r.Observable(!!t),i.isExpanded=new r.Observable(!!a),i.name=new r.Observable(e.gcxMapService.displayName),i.isFolder=!1,i.iconUri=new r.Observable(e.gcxMapService.iconUri),i.serviceLayer=e,i.items=new r.ObservableCollection([]),this._setTooltips(i),this.onLayerSelectorServiceLayerItemCreated&&this.onLayerSelectorServiceLayerItemCreated(i),i},e.prototype._generateItemCloneForFilter=function(e){var t=dojo.mixin({},e);return t.isEnabled=new r.Observable(!0),t.items=new r.ObservableCollection,void 0!=e.serviceLayer&&(t.serviceLayer=e.serviceLayer),t},e.prototype._setTooltips=function(e){var t=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-item-expand").format(e.name.get()),a=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-state-toggle").format(e.name.get()),i=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-icon-tooltip").format(e.name.get());e.expanderTooltip=new r.Observable(t),e.stateToggleTooltip=new r.Observable(a),e.iconTooltip=new r.Observable(i)},e}();t.LayerSelector=l})},"geocortex/infrastructure/layerselector/LayerSelectorConfiguration":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/layerselector/LayerSelectorFolderItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/layerselector/LayerSelectorItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/layerselector/LayerSelectorLayerItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/layerselector/LayerSelectorServiceLayerItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/layerselector/LayerSelectorViewBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.selectAllLayers=function(e,t,r){this.viewModel.layerSelector.enableAllLayers()},r.prototype.clearAllLayers=function(e,t,r){this.viewModel.layerSelector.disableAllLayers()},r.prototype.handleExpanderClick=function(e,t,r){r.isExpanded.set(!r.isExpanded.get())},r}(a.ViewBase);r.LayerSelectorViewBase=i})},"geocortex/infrastructure/layerselector/LayerSelectorViewModelBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","./../gis/AppInfo","./LayerSelector","geocortex/framework/observables"],function(t,r,a,i,n,l){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){function r(e,r){var a=t.call(this,e,r)||this;return a._layerSelectorInitialized=new l.Observable(!1),a.selectAllButtonText=new l.Observable(a.app.getResource(r,"language-layer-selector-default-select-all-text")),a.clearAllButtonText=new l.Observable(a.app.getResource(r,"language-layer-selector-default-clear-all-text")),a.selectAllButtonTitle=new l.Observable(a.app.getResource(r,"language-layer-selector-default-select-all-tooltip")),a.clearAllButtonTitle=new l.Observable(a.app.getResource(r,"language-layer-selector-default-clear-all-tooltip")),a.items=new l.ObservableCollection([]),a}return e(r,t),r.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this._subscribeEvents(),this.app.site&&this.app.site.isInitialized?this._setupLayerSelector():this.app.event("SiteInitializedEvent").once(this,this._setupLayerSelector)},r.prototype.onInitialized=function(e){},r.prototype.onLayerSelectorFolderItemCreated=function(e){},r.prototype.onLayerSelectorLayerItemCreated=function(e){},r.prototype.onLayerSelectorServiceLayerItemCreated=function(e){},r.prototype.filter=function(e){return!0},r.prototype.handleLayerStateChange=function(e){},r.prototype.handleAllLayersEnabled=function(){},r.prototype.handleAllLayersDisabled=function(){},r.prototype.getAllItems=function(){return r._expandItems(this.items.get())},r._expandItems=function(e){return e.concat.apply(e,e.map(function(e){return r._expandItems(e.items.get())}))},r.prototype._setupLayerSelector=function(){var e=this;this.appInfo=i.AppInfo.fromGeocortexApp(this.app);var t={onInitializedHandler:function(t){return e.onInitialized(t)},layerFilter:function(t){return e.filter(t)},layerStateChangeHandler:function(t){return e.handleLayerStateChange(t)},enableAllLayersHandler:function(){return e.handleAllLayersEnabled()},disableAllLayersHandler:function(){return e.handleAllLayersDisabled()},onLayerSelectorFolderItemCreated:function(t){return e.onLayerSelectorFolderItemCreated(t)},onLayerSelectorLayerItemCreated:function(t){return e.onLayerSelectorLayerItemCreated(t)},onLayerSelectorServiceLayerItemCreated:function(t){return e.onLayerSelectorServiceLayerItemCreated(t)}};this.layerSelector=new n.LayerSelector(this.appInfo,t),this._layerSelectorInitialized.set(!0),this.items.sync(this.layerSelector.items),this.items.pulse()},r.prototype._subscribeEvents=function(){this.app.event("MapServiceAddedEvent").subscribe(this,this._handleMapServicesAdded),this.app.event("MapServiceRemovedEvent").subscribe(this,this._handleMapServiceRemoved),this.app.event("MapServiceLayersChangedWithResultEvent").subscribe(this,this._handleMapServiceLayersChanged)},r.prototype._handleMapServicesAdded=function(e){var t=this;this._waitUntilLayerSelectorInitialized().then(function(){t.layerSelector.addUserAddedServiceLayer(e)})},r.prototype._handleMapServiceRemoved=function(e){var t=this;this._waitUntilLayerSelectorInitialized().then(function(){t.layerSelector.removeServiceLayer(e)})},r.prototype._handleMapServiceLayersChanged=function(e){var t=this;this._waitUntilLayerSelectorInitialized().then(function(){e&&t.layerSelector.updateServiceLayer(e.mapService,e.newItems,e.oldItems)})},r.prototype._waitUntilLayerSelectorInitialized=function(){var e=this;return new Promise(function(t,r){e._layerSelectorInitialized.get()?t():e._layerSelectorInitialized.once(e,function(){return t()})})},r}(a.ViewModelBase);r.LayerSelectorViewModelBase=o})}}});require({cache:{"geocortex/infrastructure/legend/LegendItem":function(){define(["require","exports","geocortex/framework/observables"],function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=function(){return function(e,n){var t=this;this.esriLayer=e,this.templateType="single-item",this.swatchElement=null,this.label=new r.Observable(""),this.description=new r.Observable(""),this.isVisible=new r.Observable(!0),this.isVisibleInLayerListLegend=new r.Observable(!0),this.isCluster=!1,this.expanded=new r.Observable(!0),this.expanderClass=new r.Observable,this.children=new r.ObservableCollection,this.children.useThrottling=!!n,this.expanderClass.syncTransform(this.expanded,function(e){return e?"tree-expander expanded":"tree-expander collapsed"}),this.expanded.pulse(),this.isVisibleInLayerListLegend.syncTransform(this.isVisible,function(e){return!t.isCluster||e})}}();n.LegendItem=t})},"geocortex/infrastructure/legend/LegendItemProvider":function(){define(["require","exports"],function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})})},"geocortex/infrastructure/legend/LegendItemProviderEntry":function(){define(["require","exports"],function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(e,n){this.identifier=e,this._provider=n}}();n.LegendItemProviderEntry=r})},"geocortex/infrastructure/legend/LegendItemProviderFactory":function(){define(["require","exports","./LegendItemProviderResponse"],function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=function(){function e(){}return e.registerLegendItemProvider=function(e){var n=this,t=function(e,r){for(var t=0;t<n._legendItemCallbacks.length;t++)if(e===n._legendItemCallbacks[t].uniqueId){n._legendItemCallbacks[t].callback(r),n._legendItemCallbacks.splice(t,1);break}},i=function(e){var n=e.children.get();if(n.length)for(var r,t=0;t<n.length;t++){var i=n[t].sublayerId||n[t].essLayer&&n[t].essLayer.id;if(0===t&&(r=i),i!==r||"single-item"!==n[t].templateType)return!1}return!0},s=function(e){if(e.children&&e.children.length())for(var n=0,r=e.children.length();n<r;n++){var t=e.children.getAt(n);l(t)}},d=function(e,r){n._legendItemInfos.push({uniqueId:e,legendItem:r}),t(e,r)},o=function(e){var n=e.essLayer&&e.essLayer.mapService&&e.essLayer.mapService.id||e.children&&e.children.length()&&e.children.getAt(0).essLayer&&e.children.getAt(0).essLayer.mapService&&e.children.getAt(0).essLayer.mapService.id||e.esriLayer.id,r=e.essLayer&&e.essLayer.id||e.sublayerId||null;return n+(null!=r?"."+r:"")},l=function(e){if(e){if("group"===e.templateType){if(e.children.length()&&i(e)){var n=e.children.getAt(0);return void d(o(n),e)}s(e)}"single-item"===e.templateType&&d(o(e),e)}};dojo.aspect.after(e,"provide",function(e){var t=e.code.get();if(t===r.LegendItemProviderResponseCode.Pending||t===r.LegendItemProviderResponseCode.Show){var i=function(){e.item&&l(e.item)};if(t===r.LegendItemProviderResponseCode.Show)i();else var s=e.code.bind(n,function(n){e.code.unbind(s),n===r.LegendItemProviderResponseCode.Show&&i()})}return e}),this._providers.push(e)},e.getProviders=function(){return this._providers},e.getLegendItemWhenAvailable=function(e,n){this.getLegendItemByIdWhenAvailable(e.uniqueId,n)},e.getLegendItemByIdWhenAvailable=function(e,n){if(e&&n){for(var r=null,t=0,i=this._legendItemInfos.length;t<i;t++){var s=this._legendItemInfos[t];s.uniqueId===e&&(r=s.legendItem)}r?n(r):this._legendItemCallbacks.push({uniqueId:e,callback:n})}},e}();t._providers=[],t._legendItemInfos=[],t._legendItemCallbacks=[],n.LegendItemProviderFactory=t})},"geocortex/infrastructure/legend/LegendItemProviderResponse":function(){define(["require","exports","geocortex/framework/observables"],function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(e){e[e.NotFound=0]="NotFound",e[e.Rendered=1]="Rendered",e[e.Show=2]="Show",e[e.Hide=3]="Hide",e[e.Pending=4]="Pending",e[e.Error=5]="Error"}(n.LegendItemProviderResponseCode||(n.LegendItemProviderResponseCode={}));var t=function(){return function(e,n){this.code=new r.Observable(e),this.item=n}}();n.LegendItemProviderResponse=t})}}});require({cache:{"geocortex/infrastructure/MapUtils":function(){define(["require","exports","geocortex/essentials/GeometryUtilities","./commandArgs/ProjectArgs","geocortex/framework/utils/ArrayUtils","geocortex/essentials/ReportParameters","geocortex/framework/utils/utils"],function(e,t,r,n,i,a,s){"use strict";function o(e,t,r){if(s.isNullOrUndefined(e)||s.isNullOrUndefined(t))return!1;if(e===t)return!0;var n=Object.keys(e),a=Object.keys(t);if(!n.length||!a.length)return!1;if(n=i.difference(n,r),a=i.difference(a,r),n.length!==a.length)return!1;for(var o=0,u=n;o<u.length;o++){var l=u[o];if(e[l]!==t[l])return!1}return!0}function u(e,t){return e===t||e.type===t.type&&e.spatialReference&&t.spatialReference&&e.spatialReference.equals(t.spatialReference)}function l(e,t){return e===t||e.x==t.x&&e.y==t.y&&u(e,t)}function f(e,t){var r=u(e,t);if(r&&e.points.length===t.points.length){for(var n=0;r&&n<e.points.length;n++)r=e.points[n][0]===t.points[n][0]&&e.points[n][1]===t.points[n][1];return r}return!1}function c(e,t){var r=u(e,t);return r&&dojo.forEach(e.paths,function(e,n){if(e.length===t.paths[n].length){for(var i=0;r&&i<e.length;i++)r=e[i][0]===t.paths[n][i][0]&&e[i][1]===t.paths[n][i][1];return r?void 0:r}r=!1}),r}function p(e,t){var r=u(e,t);return r&&dojo.forEach(e.rings,function(e,n){if(e.length===t.rings[n].length){for(var i=0;r&&i<e.length;i++)r=e[i][0]===t.rings[n][i][0]&&e[i][1]===t.rings[n][i][1];return r?void 0:r}r=!1}),r}function g(e,t){return u(e,t)&&e.xmin==t.xmin&&e.xmax==t.xmax&&e.ymin==t.ymin&&e.ymax==t.ymax}Object.defineProperty(t,"__esModule",{value:!0}),t.stepZoom=function(e,t,n){null==n&&(n=e.extent);var i=r.scaleEnvelopeWithoutTranslation(n,1/t);return e.setExtent(i,!!e._fitTiledMapsToExtent),i},t.stepZoomWithPriority=function(e,t,n,i){null==n&&(n=e.getMap().extent);var a=e.essentialsMap.getMap(),s=r.scaleEnvelopeWithoutTranslation(n,1/t),o=a.getLevel();if(void 0!==o&&null!==o&&o>-1){var u=o;return t>1?u=o+1:t<1&&(u=o-1),a.setLevel(u),s}return e.essentialsMap.extentManager.setExtentWithPriority(s,i),s},t.getExtent=function(e){if(e){if("point"==e.type){var t=e;return new esri.geometry.Extent(t.x,t.y,t.x,t.y,e.spatialReference)}return e.getExtent()}return null},t.panToPointWithPriority=function(e,t,r,i){if(t&&t.isInstanceOf(esri.geometry.Geometry)){var a=new n.ProjectArgs([t],function(t){var n=null,a=null;t&&t.length>0&&(n=t[0]),e.map&&n&&((i||void 0===i)&&e.command("ShowMap").execute(),"point"==n.type?e.site.essentialsMap.extentManager.centerAtWithPriority(n,r):"extent"==n.type?e.site.essentialsMap.extentManager.centerAtWithPriority(n.getCenter(),r):"polyline"!=n.type&&"polygon"!=n.type&&"multipoint"!=n.type||(a=n.getExtent())&&e.site.essentialsMap.extentManager.centerAtWithPriority(a.getCenter(),r))},function(t){e.trace.warning("PanToPoint: "+t.message)});e.command("Project").execute(a)}},t.zoomToExtent=function(e,t,r){this.zoomToExtentWithPriority(e,t,null,null,r)},t.zoomToExtentWithPriority=function(e,t,r,i){var a=function(t){t&&t.length>0&&((i||void 0===i)&&e.command("ShowMap").execute(),null==r?e.map.setExtent(t[0],!!e.map._fitTiledMapsToExtent):e.site.essentialsMap.extentManager.setExtentWithPriority(t[0],r),e.event("MapStartupExtentChangedEvent").publish(t[0]))};if(t&&t.isInstanceOf(esri.geometry.Extent)){if(!t.spatialReference&&e.map.spatialReference)return t.spatialReference=e.map.spatialReference,void a([t]);t.spatialReference&&!t.spatialReference.toJson&&(t.spatialReference.wkid||t.spatialReference.wkt)&&(t.spatialReference=new esri.SpatialReference(t.spatialReference));var s=new n.ProjectArgs([t],a,function(t){e.trace.warning("ZoomToExtent: "+t.message)});e.command("Project").execute(s)}},t.getClosestScale=function(e,t,r){var n=e.__tileInfo&&e.__tileInfo.lods;if(!n||!n.length)return r;for(var i=0,a=0;a<n.length;a++){if(n[a].scale===r)return r;if(t===h.LessThan){if(r<n[a].scale)continue}else if(n[a].scale>r){i=n[a].scale;continue}return t===h.LessThan?n[a].scale:i}};var h;!function(e){e[e.LessThan=0]="LessThan",e[e.GreaterThan=1]="GreaterThan"}(h=t.ScaleChangeMode||(t.ScaleChangeMode={})),t.cloneEsriFeature=function(e){var t=new esri.Graphic(e.toJson());return t._graphicsLayer=e._graphicsLayer,t},t.esriFeatureAttributesEqual=o,t.esriFeaturesEqual=function(e,t){if(s.isNullOrUndefined(e)||s.isNullOrUndefined(t))return!1;if(e===t)return!0;var r=["timestamp","clusterId","clusterCount","extent"],n=e.getLayer();if(n&&n instanceof esri.layers.FeatureLayer||(n=t.getLayer()),n instanceof esri.layers.FeatureLayer){var i=n.objectIdField;if(i&&e.attributes&&t.attributes&&e.attributes[i]===t.attributes[i])return!0;if(n.editFieldsInfo)for(var a=0,u=Object.keys(n.editFieldsInfo);a<u.length;a++){var l=u[a];r.push(n.editFieldsInfo[l])}}return o(e.attributes,t.attributes,r)},t.esriGeometriesEqual=function(e,t){switch(e?e.type:null){case"point":return l(e,t);case"multipoint":return f(e,t);case"polyline":return c(e,t);case"polygon":return p(e,t);case"extent":return g(e,t)}return!1},t.compareTypeSR=u,t.esriPointsEqual=l,t.esriMultipointsEqual=f,t.esriPolylinesEqual=c,t.esriPolygonsEqual=p,t.esriExtentsEqual=g,t.findFeatureInLayer=function(e,t){if(!e||!t)return null;var r=t.objectIdField;e.attributes[r]&&e.attributes[r];var n=t.graphics;if(n.length<1)return null;var a=["timestamp","clusterId","clusterCount","extent"];if(t.editFieldsInfo)for(var s in t.editFieldsInfo)t.editFieldsInfo.hasOwnProperty(s)&&a.push(t.editFieldsInfo[s]);var o=function(e){return i.contains(a,e)},u=function(e){var t=0;for(var r in e)!o(r)&&e.hasOwnProperty(r)&&++t;return t},l=n[0].attributes;if(u(l)!==u(e.attributes))return null;var f=0,c=[],p=[];for(var g in l){var h=o(g);if(!(h||l.hasOwnProperty(g)&&e.attributes.hasOwnProperty(g)))return null;h||(c.push(g),p.push(g),++f)}for(var d=0;d<f;++d)if(c[d]!==p[d])return null;for(var y=0;y<n.length;y++){var m=n[y];if(u(l)===u(e.attributes)&&m.attributes[r]===e.attributes[r])return m._graphicsLayer=t,m}return null},t.findFeatureInMap=function(e,t,r){var n=null;if(r&&(n=this.findFeatureInLayer(e,r)))return n._graphicsLayer=r,n;for(var i=t.getFeatureServices(),a=0;a<i.length;a++){var s=i[a].serviceLayer;if((!r||s!==r)&&(n=this.findFeatureInLayer(e,s)))return n}return!n&&e.getLayer&&e.getLayer()&&(n=e),n},t.getThumbnailUri=function(e,t,r,n,i){void 0===r&&(r=150),void 0===n&&(n=150),void 0===i&&(i=20);var s=new a.ReportParameters;return s.outputFormat="PNG",s.includeData=!0,s.imageWidth=r,s.imageHeight=n,s.resolution={displayName:"custom",dpi:i},s.customExtent=t||e.map.extent,s.extentType=a.ReportParameters.CUSTOM_EXTENT,s.populateMapGraphicsLayers(e.map),new Promise(function(t,r){e.site.essentialsMap.exportMap(s,function(e){t(e.data?"data:image/png;base64,{0}".format(e.data):e.href?e.href:null)},function(r){e.trace.error("Error exporting map for thumbnail: {0}".format(r.message)),t(null)})})}})}}});require({cache:{"geocortex/infrastructure/MatrixUtils":function(){define(["require","exports","./GeometryUtils"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.translate=function(t,e,r,n){if(!t||!e)return null;switch(t.type){case"point":var o=e.toScreen(t);t=e.toMap(o.offset(r,n));break;case"polyline":t=this._applyOffset(t,t.paths,r,n,e);break;case"polygon":t=this._applyOffset(t,t.rings,r,n,e)}return{geometry:t,transform:dojox.gfx.matrix.translate(r,n)}},t.rotate=function(t,e,r,n){if(!t||!e)return null;var o=n||this.getCentroid(t),a=dojox.gfx.matrix.rotategAt(-r,o.x,o.y);switch(t.type){case"polyline":t=this._applyTransform(t,t.paths,a);break;case"polygon":t=this._applyTransform(t,t.rings,a)}var i=e.toScreen(o);return{geometry:t,transform:dojox.gfx.matrix.rotategAt(-r,i.x,i.y)}},t.scale=function(t,e,r,n){if(void 0===n&&(n=null),!t||!e)return null;(isNaN(r)||1/0===r||-1/0===r)&&(r=1),null!==n&&void 0!==n||(n=r);var o=this.getCentroid(t),a=dojox.gfx.matrix.scaleAt(r,n,o.x,o.y);switch(t.type){case"polyline":t=this._applyTransform(t,t.paths,a);break;case"polygon":t=this._applyTransform(t,t.rings,a)}var i=e.toScreen(o);return{geometry:t,transform:dojox.gfx.matrix.scaleAt(r,n,i.x,i.y)}},t.getCentroid=function(t){if(!t||!t.type||!r.isValidGeometry(t))return null;var e;switch(t.type){case"point":return t;case"multipoint":case"polyline":case"polygon":if(e=t.getExtent())return e.getCenter();case"extent":return t.getCenter()}return null},t._applyOffset=function(t,e,r,n,o){if(t&&e)for(var a=t.getPoint(0,0),i=o.toMap(o.toScreen(a).offset(r,n)),s=i.x-a.x,l=i.y-a.y,f=0;f<e.length;f++)for(var p=0;p<e[f].length;p++){var u=t.getPoint(f,p);t.setPoint(f,p,u.offset(s,l))}return t},t._applyTransform=function(t,e,r){if(t&&e)for(var n=0;n<e.length;n++)for(var o=0;o<e[n].length;o++){var a=t.getPoint(n,o),i=dojox.gfx.matrix.multiplyPoint(r,a.x,a.y);a.setX(i.x),a.setY(i.y),t.setPoint(n,o,a)}return t},t}();e.MatrixUtils=n})}}});require(["geocortex/framework/resourceManager"],function(C){C.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/medium.css","css","DQovKiBHTE9CQUwgU1RZTElORyAgKE1FRElVTSktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KaHRtbCwNCmJvZHkgew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgY29sb3I6ICMzMzMzMzM7DQp9DQoNCmh0bWwgew0KCS13ZWJraXQtdGV4dC1zaXplLWFkanVzdDogbm9uZTsgLyogSU9TIC0gUmV0YWluIGZvbnQgc2l6ZSB3aGVuIHN3aXRjaGluZyBtb2RlcyAqLw0KfQ0KDQpidXR0b24sIGlucHV0LCBzZWxlY3QsIHRleHRhcmVhIHsgDQogICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6ICNERUYyRkY7DQp9DQoNCg0KLyogTU9EQUwgV0lORE9XIChNRURJVU0pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoubW9kYWwtY29udGFpbmVyIHsNCiAgICBtaW4td2lkdGg6IDM2MHB4Ow0KfQ0KDQoubW9kYWwtY29udGFpbmVyIC5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICB3aWR0aDoxMDAlOw0KfQ0KLyogVklFVyBDT05UQUlORVJTIC8gTU9EVUxFIENPTlRBSU5FUlMgKE1FRElVTSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5wYW5lbC1oZWFkZXIgaDIgew0KICAgIG1hcmdpbjogMCA0MHB4OyAvKiBBbGxvd3Mgc3BhY2UgZm9yIGljb25zIG9uIGVpdGhlciBzaWRlIG9mIHRoZSBoZWFkaW5nICovDQogICAgZm9udC1zaXplOiAxLjNlbTsNCn0NCg0KLnBhbmVsLWhlYWRlci1idXR0b24gew0KICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogI0RFRjJGRjsNCn0NCg0KLnBhbmVsLXNjcm9sbC1jb250YWluZXIgew0KICAgIC13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiB0b3VjaDsNCn0NCg0KLm1lZGl1bS1zaGVsbC1sZWZ0IC5wYW5lbC1zY3JvbGwtY29udGFpbmVyLA0KLm1lZGl1bS1zaGVsbC1ib3R0b20gLnBhbmVsLXNjcm9sbC1jb250YWluZXIgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7DQp9DQoNCi5tZWRpdW0tc2hlbGwtYm90dG9tIC5wYW5lbC1oZWFkZXIgew0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjOTk5OTk5Ow0KfQ0KDQoNCi8qIEJVVFRPTlMgKE1FRElVTSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCmJ1dHRvbiB7DQogICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiAjRkZGRkZGOw0KfQ0KDQoNCi8qIExJU1QgTUVOVSAoTUVESVVNKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLmxpc3QtbWVudS1pdGVtIHsNCiAgICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6ICNERUYyRkYNCn0NCg0KLmxpc3Qtc3VibWVudSB7DQogICAgbWFyZ2luOiA4cHg7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjOTk5OTk5Ow0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQp9DQoNCmEubGlzdC1tZW51LWl0ZW0gew0KICAgIGNvbG9yOiAjMzMzMzMzOw0KfQ0KDQoubGlzdC1tZW51LWNsb3NlZCB7DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2V4cGFuZGVyLWNsb3NlZC0yNC5wbmciKSByaWdodCBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KDQoubGlzdC1tZW51LW9wZW4gew0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9leHBhbmRlci1vcGVuLTI0LnBuZyIpIHJpZ2h0IGNlbnRlciBuby1yZXBlYXQ7DQp9DQoNCg0KLyogTE9BRElORyBJTkRJQ0FUT1IgKE1FRElVTSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5sb2FkaW5nLWNvbnRhaW5lciB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHBhZGRpbmc6IDAuNWVtOw0KfQ0KDQoubG9hZGluZy1pbWcsDQoubG9hZGluZy1tc2cgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoubG9hZGluZy1pbWcgew0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMjRweDsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9sb2FkZXItc21hbGwuZ2lmKTsNCn0NCg0KLyogVFJFRVZJRVcgKE1FRElVTSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi50cmVlLWV4cGFuZGVyIHsNCiAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMTAwJTsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgbWFyZ2luLWxlZnQ6IDFweDsNCn0NCg0KLnRyZWUtZXhwYW5kZXIuZXhwYW5kZWQgew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL21pbnVzLTI0LnBuZykgbGVmdCBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KDQoudHJlZS1leHBhbmRlci5jb2xsYXBzZWQgew0KICAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2FkZC0yNC5wbmcpIGxlZnQgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg0KLyogTk9USUZJQ0FUSU9OUyAoTUVESVVNKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLm5vdGlmaWNhdGlvbiB0ZXh0YXJlYSB7DQogICAgbWF4LXdpZHRoOiAzMDBweDsNCiAgICBtYXgtaGVpZ2h0OiAzMDBweDsNCiAgICByZXNpemU6IG5vbmU7DQp9DQovKiBUQUIgQ09OVFJPTCAoTUVESVVNKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLnRhYi1jb250cm9sLA0KLnRhYi1jb250cm9sIGEsDQoudGFiLWNvbnRyb2wgYnV0dG9uLA0KLnRhYi1jb250cm9sIGE6aG92ZXIgew0KCWxpbmUtaGVpZ2h0OiAxLjZlbTsNCn0NCg0KLyogTUVESUEgUVVFUklFUyAoTUVESVVNKSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KQG1lZGlhIHNjcmVlbiBhbmQgKG1heC1oZWlnaHQ6IDEwMjBweCkgYW5kIChtaW4td2lkdGg6IDc2MHB4KSB7DQoNCiAgICAubW9kYWwtY29udGFpbmVyIC5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICAgICAgbWF4LWhlaWdodDogNzAwcHg7DQogICAgICAgIG1pbi13aWR0aDogMzAwcHg7DQogICAgfQ0KfQ0KDQpAbWVkaWEgc2NyZWVuIGFuZCAobWF4LWhlaWdodDogNzYwcHgpIHsNCg0KICAgIC5tb2RhbC1jb250YWluZXIgLnBhbmVsLXNjcm9sbC1jb250YWluZXIgew0KICAgICAgICBtYXgtaGVpZ2h0OiA1MDBweDsNCiAgICAgICAgbWluLXdpZHRoOiAzMDBweDsNCiAgICAgICAgfQ0KfQ0KQG1lZGlhIHNjcmVlbiBhbmQgKG1heC1oZWlnaHQ6IDY2MHB4KSB7DQoNCiAgICAubW9kYWwtY29udGFpbmVyIC5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICAgICAgbWF4LWhlaWdodDogNDAwcHg7DQogICAgICAgIG1pbi13aWR0aDogMzAwcHg7DQogICAgICAgIH0NCn0NCkBtZWRpYSBzY3JlZW4gYW5kIChtYXgtaGVpZ2h0OiA1MDBweCkgew0KDQogICAgLm1vZGFsLWNvbnRhaW5lciAucGFuZWwtc2Nyb2xsLWNvbnRhaW5lciB7DQogICAgICAgIG1heC1oZWlnaHQ6IDMwMHB4Ow0KICAgICAgICBtaW4td2lkdGg6IDMwMHB4Ow0KICAgIH0NCn0NCkBtZWRpYSBzY3JlZW4gYW5kIChtYXgtaGVpZ2h0OiAzODBweCkgew0KDQogICAgLm1vZGFsLWNvbnRhaW5lciAucGFuZWwtc2Nyb2xsLWNvbnRhaW5lciB7DQogICAgICAgIG1heC1oZWlnaHQ6IDIwMHB4Ow0KICAgICAgICBtaW4td2lkdGg6IDMwMHB4Ow0KICAgIH0NCn0NCg0KLyogQU5EUk9JRCBGSVhFUyAoTUVESVVNKS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpodG1sLmRqX2FuZHJvaWQgLm1hcCBzdmcsDQpodG1sLmRqX2FuZHJvaWQgLm1hcC10b3AtbGVmdCwNCmh0bWwuZGpfYW5kcm9pZCAubWFwLXRvcC1yaWdodCwNCmh0bWwuZGpfYW5kcm9pZCAubWFwLWJvdHRvbS1sZWZ0LA0KaHRtbC5kal9hbmRyb2lkIC5tYXAtYm90dG9tLXJpZ2h0LA0KaHRtbC5kal9hbmRyb2lkIC5tYXAtbmF2aWdhdGlvbi1yZWdpb24sDQpodG1sLmRqX2FuZHJvaWQgLm1hcC1iYXNlbWFwLXJlZ2lvbiwNCmh0bWwuZGpfYW5kcm9pZCAubWFwLWNhbGxvdXQtd3JhcHBlciwNCmh0bWwuZGpfYW5kcm9pZCAubW9kYWwsDQpodG1sLmRqX2FuZHJvaWQgLnN0YXR1cy1pbmRpY2F0b3IsDQpodG1sLmRqX2FuZHJvaWQgLnVpLWRhdGVwaWNrZXIgew0KICAgIC8qLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAxcHgpOyovDQp9DQo=")});!function(){var e="<div class='menu-no-items' data-binding='{@hidden: visibleMenuItems}{@text: @language-menu-no-items}'>\x3c!-- No Items. --\x3e</div><div class='list-menu active has-icon icon-menu' data-binding='{@visible: visibleMenuItems}{@source: visibleMenuItems}'>    <div class='list-menu-item' data-binding='{@template-for: visibleMenuItems}{@enabled: canExecute}{@event-onclick: handleMenuItemClick}{@event-onfocus: handleMenuItemFocus}'>        <button class='list-menu-details' data-binding='{@event-onclick: handleMenuItemClick}{title: description}{@event-onfocus: handleMenuItemFocus}'>            <img class='list-menu-icon' data-binding='{@visible: iconUri}{src: iconUri}' alt=' ' />            <strong class='list-menu-name' data-binding='{@text: text}'></strong>        </button>    </div></div>",t="<div class='menu-hyperlinks'>    <ul class='list-menu active' data-binding='{@visible: visibleMenuItems}{@source: visibleMenuItems}'>        <li class='list-menu-item' data-binding='{@template-for: visibleMenuItems}'>            <button class='list-menu-button' data-binding='{title: description}{@text: text}{@event-onclick: handleMenuItemClick}{@enabled: canExecute}{@event-onfocus: handleMenuItemFocus}'></button>        </li>    </ul></div>",n="<div class='menu-no-items' data-binding='{@hidden: visibleMenuItems}{@text: @language-menu-no-items}'>\x3c!-- No Items. --\x3e</div><div class='list-menu active has-icon' data-binding='{@visible: visibleMenuItems}{@source: visibleMenuItems}'>    <div class='list-menu-item' data-binding='{@template-for: visibleMenuItems}{@enabled: canExecute}{@event-onclick: handleMenuItemClick}{@event-onfocus: handleMenuItemFocus}'>        <img class='list-menu-icon' data-binding='{@visible: iconUri}{src: iconUri}{alt: text}' />        <button class='list-menu-details' data-binding='{@event-onclick: handleMenuItemClick}{title: description}{@event-onfocus: handleMenuItemFocus}'>            <strong class='list-menu-name' data-binding='{@text: text}'></strong>            <span class='list-menu-desc' data-binding='{@visible: description}{@text: description}'></span>        </button>    </div></div>";require({cache:{"geocortex/infrastructure/menus/BatchItemConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/menus/BatchItemModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t){t&&t.command?(this.app=e,this.command=e.command(t.command),this.commandParameter=t.commandParameter||null,this.abortBatchOnFailure=!!t.abortBatchOnFailure):e&&e.trace.warning("BatchItemModel: Could not create batch item. Configuration or command not specified.")}}();t.BatchItemModel=n})},"geocortex/infrastructure/menus/MenuConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/menus/MenuEntryConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/menus/MenuItemConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/menus/MenuItemModel":function(){define(["require","exports","./BatchItemModel","geocortex/framework-ui/StringLocalizer"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var n=this;if(!e||!t)throw new Error("MenuItemModel: Required input parameters cannot be undefined");this.menuModel=e,this.app=e.app,this.id=t.id||"",this.text=t.text||"",this.description=t.description||"",this.iconUri=t.iconUri||this.menuModel.defaultIconUri,this.hideOnDisable=void 0!=t.hideOnDisable&&t.hideOnDisable,t.batch?(this.batchItems=[],this._setBatchItems(t.batch)):t.command&&(this.command=this.app.command(t.command),this.commandParameter=t.commandParameter||null),t.onFocusCommand&&(this.onFocusCommand=this.app.command(t.onFocusCommand),this.onFocusCommandParameter=t.onFocusCommandParameter||null),t.libraryId&&(i.localizeString(this.app,t.libraryId,this.text,function(e){return n.text=e}),i.localizeString(this.app,t.libraryId,this.description,function(e){return n.description=e}))}return e.prototype._setBatchItems=function(e){var t=this;e&&e.length&&e.forEach(function(e){e&&e.command&&t.batchItems.push(new n.BatchItemModel(t.app,e))})},e}();t.MenuItemModel=r})},"geocortex/infrastructure/menus/MenuItemViewModel":function(){define(["require","exports","geocortex/framework/observables","./MenuViewModel"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(this._canExecuteChangedBindingTokens=[],this._contextPropertyBindingTokens={},!i.MenuViewModel||!t)throw new Error("MenuViewModel: Could not create menu view model. Input arguments cannot be undefined.");this.menuViewModel=e,this.menuItem=t,this.app=t.app,this.text=new n.Observable(t.text),this.description=new n.Observable(t.description),this.canExecute=new n.Observable(this.computeCanExecute()),this.iconUri=new n.Observable(t.iconUri),this._setupBindings()}return e.prototype.execute=function(){var t=this;this.computeCanExecute()&&(this.menuItem.command?this.menuItem.command.execute(e._computeCommandParameter(this,this.menuItem.commandParameter)):this.menuItem.batchItems.forEach(function(n){return n.command.execute(e._computeCommandParameter(t,n.commandParameter))}))},e.prototype.executeOnFocus=function(){this.menuItem.onFocusCommand&&this.menuItem.onFocusCommand.execute(e._computeCommandParameter(this,this.menuItem.onFocusCommandParameter))},e.prototype.computeCanExecute=function(){if(this.menuItem.batchItems&&this.menuItem.batchItems.length){for(var t=!!this.menuItem.batchItems.length,n=0;n<this.menuItem.batchItems.length;n++){var i=this.menuItem.batchItems[n];if(t&&i.abortBatchOnFailure)if(i.command)try{t=i.command.canExecute(e._computeCommandParameter(this,i.commandParameter))}catch(e){t=!1}else t=!1}return t}if(!this.menuItem.command)return!1;try{return this.menuItem.command.canExecute(e._computeCommandParameter(this,this.menuItem.commandParameter))}catch(e){return!1}},e.prototype.refreshCanExecute=function(){var e=this.computeCanExecute();this.canExecute.get()!==e&&this.canExecute.set(e)},e.prototype.destroy=function(){for(var e=this._canExecuteChangedBindingTokens.length-1;e>=0;e--){var t=this._canExecuteChangedBindingTokens[e];t.canExecuteEvent.unsubscribe(t.token),this._canExecuteChangedBindingTokens.pop()}for(var n in this._contextPropertyBindingTokens)if(this._contextPropertyBindingTokens.hasOwnProperty(n)){var i=this.menuViewModel.menuContext.get();i[n]&&i[n].unbind(this._contextPropertyBindingTokens[n])}this._contextPropertyBindingTokens=null,this._canExecuteChangedBindingTokens=null},e.prototype._setupBindings=function(){var e=this,t=function(t){t&&e._canExecuteChangedBindingTokens.push({canExecuteEvent:t.canExecuteChanged,token:t.canExecuteChanged.subscribe(e,e.refreshCanExecute)})};this.menuItem.batchItems&&this.menuItem.batchItems.length?this.menuItem.batchItems.forEach(function(e){t(e.command)}):t(this.menuItem.command)},e._computeCommandParameter=function(e,t){var n=e.menuViewModel.menuContext.get(),r=function(t){var r=t.trim();return 0===r.indexOf("{{")&&r.indexOf("}}")>0?(r=r.replace("{{","").replace("}}","")).toLowerCase()===i.MenuViewModel.DefaultParameterName.toLowerCase()?n:n&&void 0!==n[r]?(n[r].isObservable&&(e._contextPropertyBindingTokens[r]&&n[r].unbind(e._contextPropertyBindingTokens[r]),e._contextPropertyBindingTokens[r]=n[r].once(e,e.refreshCanExecute)),n[r]):(e.app.trace.warning("Could not find menu item '{0}'.".format(r)),null):r};if(null===t||void 0===t)return n;if("string"==typeof t)return r(t);if(n&&t&&"object"==typeof t){var o={};for(var u in t)if(t.hasOwnProperty(u)){var s=t[u];o[u]="string"==typeof s?r(s):s}return o}return t},e}();t.MenuItemViewModel=r})},"geocortex/infrastructure/menus/MenuModel":function(){define(["require","exports","./MenuItemModel"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){if(!e||!t||!t.id)throw new Error("MenuModel: Required input parameters cannot be undefined");this.app=e,this.id=t.id,this.title=t.title||"",this.description=t.description||"",this.defaultIconUri=t.defaultIconUri||"",this.items=this._createMenuItems(t.items)}return e.prototype._createMenuItems=function(e){var t=this,i=[];return e&&e.length&&e.forEach(function(e){try{var r=new n.MenuItemModel(t,e);r&&(r.command||r.batchItems)?i.push(r):t.app.trace.warning("MenuModel: Could not create menu item for menu with id: {0}. Invalid configuration.".format(t.id))}catch(e){t.app.trace.warning("Unexpected configuration error: {0}".format(e.message))}}),i},e}();t.MenuModel=i})},"geocortex/infrastructure/menus/MenuRegistry":function(){define(["require","exports","./MenuModel","./MenuViewModel"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.menuList=[],this._viewMenuEntries={},this._menuConfig=[],this.app=e}return e.prototype.loadMenus=function(e){var t=this;e&&e.menus&&e.menus.length&&(e.menus.forEach(function(e){return t.register(e)}),this._menuConfig=this._menuConfig.concat(e.menus))},e.prototype.register=function(e){var t=e&&e.id;if(this._validMenuId(t)){var i=e instanceof n.MenuModel?e:new n.MenuModel(this.app,e);this._validateMenuModel(i)?this.menuList.push(i):this.app.trace.warning("Could not register menu with id: {0}. Invalid menu configuration.".format(t))}else this.app.trace.warning("Could not register menu with id: {0}. Menu id should be defined and unique.".format(t))},e.prototype.unregister=function(e){for(var t=this.menuList.length-1;t>=0;t--)this.menuList[t].id===e&&this.menuList.splice(t,1)},e.prototype.getMenu=function(e){for(var t=this.menuList,n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null},e.prototype.getDefaultIconUri=function(e){var t=this.getMenu(e);return t&&t.defaultIconUri?t.defaultIconUri:""},e.prototype.getMenuWidgetsForView=function(e){return this._viewMenuEntries[e.id]||[]},e.prototype.createMenuWidget=function(e,t,n,r,o){var u=this,s=n.domElement,a=n.viewModel,c=o||s.getAttribute("data-menu-id");if(!c||!this.getMenu(c))return console.log("Warning: Could not create menu view from DOM element attributes. Menu Id: {0} not registered with the MenuRegistry.".format(c)),null;var m=s.getAttribute("data-menu-template")||"Mapping/infrastructure/menus/MenuView.html",l=s.getAttribute("data-menu-type")||"geocortex.essentialsHtmlViewer.mapping.infrastructure.menus.MenuView",d=s.getAttribute("data-menu-library-id")||r||"Mapping",p=!s.hasAttribute("data-menu-hoist-disabled"),h=this.app.viewManager.createView({typeName:l,markupResource:m,isVisible:!0});if(!h)return console.log("Warning: Could not create menu '{0}' for view '{1}': Could not construct the menu widget view.".format(c,e.id)),null;h.app=this.app,h.configuration.menuId=c,d&&(h.libraryId=d);var g=new i.MenuViewModel(this.app,d);g.id="MenuViewModel-{0}".format(h.id),g.menuSourceView=e;var b=t;t&&t.isObservable?g.menuContext.sync(b):a&&n&&a[n.target]&&a[n.target].isObservable?(b=a[n.target],g.menuContext.sync(b)):g.menuContext.set(b),h.attach(g);var f={view:e,widgetView:h,widgetViewModel:g,context:b,menuId:c,hoistMenu:p,domElement:s};this._viewMenuEntries[e.id]||(this._viewMenuEntries[e.id]=[]),this._viewMenuEntries[e.id].push(f);var I=e.id;return dojo.aspect.after(e,"onDestroy",function(){return u._viewMenuEntries[I]=null}),this.app.event("MenuWidgetCreatedForView").publish(f),h},e.prototype.destroyMenuWidget=function(e){var t=this;e.viewModel&&(e.viewModel.menuContext.removeSync(),e.viewModel.destroy());for(var n in this._viewMenuEntries)this._viewMenuEntries.hasOwnProperty(n)&&null!=this._viewMenuEntries[n]&&this._viewMenuEntries[n].filter(function(t){return t.widgetView===e}).forEach(function(e,i){t._viewMenuEntries[n].splice(i,1)})},e.prototype._validMenuId=function(e){var t=e?this.menuList.filter(function(t){return t.id===e}):null;return null!==t&&0===t.length},e.prototype._validateMenuModel=function(e){return!!(e&&e.id&&e.items&&e.items.length)},e}();t.MenuRegistry=r})},"geocortex/infrastructure/menus/MenuView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./MenuViewModel"],function(t,n,i,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.attach=function(e){var n=this.configuration.libraryId||e.libraryId||this.libraryId;if(e instanceof r.MenuViewModel==!1){var i=new r.MenuViewModel(this.app,n);i.menuContext.set(e),e=i}this.viewModel=e,this.viewModel&&!this.viewModel.menuId&&(this.viewModel.menuId=this.configuration&&this.configuration.menuId||null),this.viewModel.setupMenu(),this.viewModel&&this.viewModel.menuId?(this.title.set(this.getResource("language-menu-default-title")),t.prototype.attach.call(this,e)):this.app.trace.warning("Could not set up menu view '{0}'. View model or 'menuId' option not found.".format(this.id))},n.prototype.handleMenuItemClick=function(e,t,n){n&&(this.app.event("MenuItemInvokedEvent").publish({menuView:this,menuId:this.viewModel.menuId,menuItem:n}),n.execute())},n.prototype.handleMenuItemFocus=function(e,t,n){n&&n.executeOnFocus()},n.prototype.getDescription=function(e,t,n){n.description&&(t.title=n.description.get())},n.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.app.menuRegistry.destroyMenuWidget(this)},n}(i.ViewBase);n.MenuView=o})},"geocortex/infrastructure/menus/MenuViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./MenuItemViewModel"],function(t,n,i,r,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.menuTitle=new r.Observable(""),i.menuDescription=new r.Observable(""),i.menuItems=new r.ObservableCollection([]),i.visibleMenuItems=new r.ObservableCollection([]),i.hasExecutableMenuItems=new r.Observable(!1),i.menuContext=new r.Observable(null),i.auto(i.menuContext,i,i._handleContextChanged),i.auto(i.menuItems,i,i._handleMenuItemsChanged),i}return e(n,t),n.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this.menuId=e&&e.menuId||null,this.libraryId=e&&e.libraryId||this.libraryId},n.prototype.setupMenu=function(e){var t=this;if(this.menuId=e||this.menuId,this.menuId){this.menuItems.clear();var n=this.app.menuRegistry.getMenu(this.menuId);if(n){if(n.title&&this.menuTitle.set(n.title),n.description&&this.menuDescription.set(n.description),n.items&&n.items.length){var i=[];n.items.forEach(function(e){var n=new o.MenuItemViewModel(t,e);i.push(n),t.auto(n.canExecute,t,t._computeExecutableMenuItems)}),this.menuItems.addItems(i)}}else this.app.trace.error("MenuViewModel: Could not load menu '{0}'. Menu not registered.".format(this.menuId))}else this.app.trace.error("MenuViewModel: Could not load menu. Menu id not specified.")},n.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.menuItems.get().forEach(function(e){return e.destroy()}),this.menuItems.clear(),this.visibleMenuItems.clear()},n.prototype._computeExecutableMenuItems=function(){var e=!1,t=[];this.visibleMenuItems.clear();for(var n=0;n<this.menuItems.length();n++){var i=this.menuItems.getAt(n);i.canExecute.get()?(e=!0,t.push(i)):i.menuItem.hideOnDisable||t.push(i)}this.visibleMenuItems.set(t),this.hasExecutableMenuItems.set(e)},n.prototype._handleContextChanged=function(e){this.menuItems.get().forEach(function(e){return e.refreshCanExecute()})},n.prototype._handleMenuItemsChanged=function(e){if("clear"===e.type)this.visibleMenuItems.clear();else if("append"===e.type)this._computeExecutableMenuItems();else if("remove"===e.type)for(var t=e.sender.get().slice(e.rangeStart,e.rangeEnd+1),n=0;n<t.length;n++)this.visibleMenuItems.removeItem(t[n]);else"insert"===e.type&&this._computeExecutableMenuItems()},n}(i.ViewModelBase);u.DefaultParameterName="context",n.MenuViewModel=u})},"geocortex/infrastructure/menus/MenuWidgetParameters":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"url:/Mapping/infrastructure/menus/IconMenuView.html":e,"url:/Mapping/infrastructure/menus/MenuHyperlinkView.html":t,"url:/Mapping/infrastructure/menus/MenuView.html":n}}),require(["geocortex/framework/resourceManager"],function(i){i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/CSS/common.css","css","LyogTUVOVSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51IHsNCiAgICBtYXJnaW4tdG9wOiAuNzVlbTsNCiAgICBwYWRkaW5nLXRvcDogLjU0ZW07DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgb3ZlcmZsb3c6IGF1dG87DQogICAgcGFkZGluZy1ib3R0b206IDAuNWVtOw0KfQ0KDQoubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtaXRlbSB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIHBhZGRpbmc6IDAgLjU0ZW07DQogICAgY3Vyc29yOiBkZWZhdWx0Ow0KfQ0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51LWl0ZW06aG92ZXIsDQoubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtaXRlbTpmb2N1cywNCi5tZW51LWh5cGVybGlua3MgLmxpc3QtbWVudS1pdGVtIGE6aG92ZXIsDQoubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtaXRlbSBhOmZvY3VzIHsNCiAgICBiYWNrZ3JvdW5kOiBub25lOw0KfQ0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51LWl0ZW06Zmlyc3QtY2hpbGQgew0KICAgIHBhZGRpbmctbGVmdDogMDsNCiAgICBib3JkZXItbGVmdDogbm9uZTsNCn0NCg0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51LWl0ZW06bGFzdC1jaGlsZCB7DQogICAgcGFkZGluZy1yaWdodDogMDsNCn0NCg0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51LWl0ZW06aG92ZXIsDQoubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtaXRlbS5zZWxlY3RlZDpob3ZlciB7DQogICAgYmFja2dyb3VuZDogbm9uZTsNCn0NCg0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51LWl0ZW0gYTpob3ZlciB7DQogICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7DQp9DQoNCi5tZW51LWh5cGVybGlua3MgLmRpc2FibGVkLA0KLm1lbnUtaHlwZXJsaW5rcyAuYm91bmQtZGlzYWJsZWQgew0KICAgIG9wYWNpdHk6IDAuMzsNCiAgICBjdXJzb3I6IGRlZmF1bHQ7DQp9DQoubWVudS1oeXBlcmxpbmtzIC5kaXNhYmxlZCBhOmhvdmVyLA0KLm1lbnUtaHlwZXJsaW5rcyBhLmJvdW5kLWRpc2FibGVkOmhvdmVyIHsNCiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQp9DQoubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtYnV0dG9uIHsNCiAgICBjb2xvcjogIzFBNzJDNDsNCiAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsNCn0NCi5yZWdpb24uZm9vdGVyLXJlZ2lvbiAudmlldyAubWVudS1oeXBlcmxpbmtzIGJ1dHRvbjpob3ZlciwNCi5tZW51LWh5cGVybGlua3MgLmxpc3QtbWVudS1idXR0b246aG92ZXIgew0KICAgIGNvbG9yOiAjNjY2NjY2Ow0KICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCn0NCi8qIEljb24gTWVudSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCi5pY29uLW1lbnUgLmxpc3QtbWVudSB7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCi5pY29uLW1lbnUgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGZvbnQtc2l6ZTogMC45ZW07DQp9DQouaWNvbi1tZW51IC5saXN0LW1lbnUtbmFtZSB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KfQ0KLmljb24tbWVudSBidXR0b24gew0KICAgIG1pbi13aWR0aDogMy41ZW07DQogICAgbWluLWhlaWdodDogMy41ZW07DQogICAgYm9yZGVyLXJhZGl1czogMC4yNXJlbTsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoubm8tdG91Y2ggLmljb24tbWVudSBidXR0b24gew0KICAgIG1pbi13aWR0aDogMi43NWVtOw0KICAgIG1pbi1oZWlnaHQ6IDIuNzVlbTsNCn0NCi5mb290ZXItY29udGFpbmVyIC5saXN0LW1lbnUuaWNvbi1tZW51IC5saXN0LW1lbnUtaWNvbiwNCi5pY29uLW1lbnUgYnV0dG9uIC5saXN0LW1lbnUtaWNvbiB7DQogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgZmxvYXQ6IG5vbmU7DQogICAgbWFyZ2luLWJvdHRvbTogMC4yZW07DQp9"),i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/CSS/large.css","css","LyogTUVOVSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLm1lbnUtaHlwZXJsaW5rcyAubGlzdC1tZW51LWl0ZW0gew0KICAgIGZvbnQtc2l6ZTogLjllbQ0KfQ=="),i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/CSS/medium.css","css","LyogTUVOVSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLm1hcC10aXAtYWN0aW9ucyAubGlzdC1tZW51LWl0ZW0gew0KICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLDAsMCwwKTsNCn0="),i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/CSS/small.css","css","LyogTUVOVSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLm1hcC10aXAtYWN0aW9ucyAubGlzdC1tZW51LWl0ZW0gew0KICAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLDAsMCwwKTsNCn0NCg=="),i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/IconMenuView.html","html",e),i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/MenuHyperlinkView.html","html",t),i.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/MenuView.html","html",n)})}();require({cache:{"geocortex/infrastructure/native/MessageClient":function(){define(["require","exports","./../Dictionary"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.app=e,this._handlers=new i.Dictionary,window.__geocortexNativeMessageClient=this}return e.prototype._postMessage=function(e,t){var i;try{i=JSON.parse(t)}catch(e){return void this.app.trace.warning("Native message could not be parsed to JSON: "+t)}for(var r=0,n=this._handlers.get(e)||[];r<n.length;r++)(0,n[r])(i)},e.prototype.subscribe=function(e,t){var i=this._handlers.get(e);i||(i=[],this._handlers.set(e,i)),i.push(t)},e.prototype.unsubscribe=function(e,t){var i=this._handlers.get(e);if(i){var r=i.indexOf(t);r>=0&&i.splice(r,1)}},e.prototype.message=function(e,t,i,r){var n=this;return new Promise(function(s,a){if(n.app.nativeManager.isNative()){var o;i&&i.register(function(){n.cancel(o)});if(r){var u=function(e){if(e.parameters.jobId===o)if("inProgress"===e.parameters.status)r(e.parameters);else if("complete"===e.parameters.status)s(e.parameters.details),n.unsubscribe("JobProgress",u);else if("canceled"===e.parameters.status){var t=new Error(e.parameters.details.message);t.name="OperationCanceled",a(t),n.unsubscribe("JobProgress",u)}else"error"===e.parameters.status&&(a(new Error(e.parameters.details.message)),n.unsubscribe("JobProgress",u))};n.subscribe("JobProgress",u)}n.app.nativeManager.onNativeInitialized().then(function(){return n.app.nativeManager.xhrPost({url:n.app.localServerAddress+"/message/"+e,postData:JSON.stringify(t),method:"POST"})}).then(function(e){var t=JSON.parse(e);o=t.jobId,i&&i.isCancellationRequested?n.cancel(o):o?n.app.nativeManager.xhrPost({url:n.app.localServerAddress+"/message/JobHandshake",postData:JSON.stringify({jobId:o}),method:"POST"}):s(t.result)}).catch(function(e){try{var t=JSON.parse(e.response.data);a(new Error(t.error.message))}catch(t){a(e)}})}else a(new Error("Method not supported in browser."))})},e.prototype.cancel=function(e){if(e)return this.app.nativeManager.xhrPost({url:this.app.localServerAddress+"/message/CancelJob",postData:JSON.stringify({jobId:e}),method:"POST"})},e}();t.MessageClient=r})},"geocortex/infrastructure/native/NativeManager":function(){define(["require","exports","./MessageClient"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.app=e,this.nativeInitialized=!1,this._messageClient=new i.MessageClient(e)}return e.prototype.isNative=function(){return/\bGeocortexApp\b/.test(navigator.userAgent)||/http:\/\/127.0.0.1(:[0-9]*)?\/viewerpackages\//gi.test(window.location.href)||this.app.isNative.get()},e.prototype.isWindowsNative=function(){return/\bGeocortexApp.Windows\b/.test(navigator.userAgent)},e.prototype.isIosNative=function(){return/\bGeocortexApp.iOS\b/.test(navigator.userAgent)},e.prototype.xhrGet=function(e){var t=this;return this.onNativeInitialized().then(function(){return t.appendAuthorizationHeader(e),dojo.xhrGet(e)})},e.prototype.xhrPost=function(e){var t=this;return this.onNativeInitialized().then(function(){return t.appendAuthorizationHeader(e),dojo.xhrPost(e)})},e.prototype.xhrPostUnsecured=function(e){return dojo.xhrPost(e)},e.prototype.appendAuthorizationHeader=function(e){e||(e={}),e.headers||(e.headers={}),e.headers.Authorization||(e.headers.Authorization="Token "+this.app.localServerToken)},e.prototype.message=function(e,t,i,r){return this._messageClient.message(e,t,i,r)},e.prototype.subscribe=function(e,t){return this._messageClient.subscribe(e,t)},e.prototype.onNativeInitialized=function(){var e=this;return this._nativeInitializedPromise?this._nativeInitializedPromise:(this._nativeInitializedPromise=new Promise(function(t,i){e._nativeInitializedResolve=t}),this._nativeInitializedPromise)},e.prototype.signalNativeInitialized=function(){this.onNativeInitialized(),this.nativeInitialized=!0,this._nativeInitializedResolve()},e.prototype.getViewerResourceInfo=function(e){var t=this.app.localServerAddress+"/resource/"+this.app.localServerNamespace+"/"+e+"/info";return this.xhrGet({url:t}).then(function(e){var t=JSON.parse(e);return{name:t.name,exists:t.exists,length:t.length,lastAccessTime:t.lastAccessTime?new Date(t.lastAccessTime):null,lastWriteTime:t.lastWriteTime?new Date(t.lastWriteTime):null}})},e.prototype.hasNativeCapability=function(e){var t=this;return new Promise(function(i,r){t._capabilities?i(t._capabilities.indexOf(e)>-1):t.isNative()?t.message("NativeCapabilitiesRequest",{}).then(function(r){t._capabilities=r.capabilities,i(t._capabilities.indexOf(e)>-1)}):i(!1)})},e}();t.NativeManager=r})},"geocortex/infrastructure/native/NativeMessage":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/native/ResourceInfo":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/NumberFormat":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){return function(){}}();t.NUMBER="n",t.FIXED_POINT="f",t.CURRENCY="c",t.ACCOUNTING="a",t.PERCENT="p",t.ROUND_TRIP="r",t.DEFAULT=t.FIXED_POINT,r.NumberFormat=t,r.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)}})}}});require({cache:{"geocortex/infrastructure/ObjectFilter":function(){define(["require","exports","./PromiseUtils"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){function t(e){return e&&"function"==typeof e.validate}function i(r,i,o,u){if("object"==typeof r&&o.has(r))return Promise.resolve(o.get(r));for(;"function"==typeof i;)i=i(r,u);return t(i)?i.validate(r,u).then(function(e){return e.validatedValue}):"object"==typeof i&&"object"==typeof r?n(r,i,o,u):!0===i?Promise.resolve(r):Promise.reject(e.FILTERED)}function n(e,t,n,o){if(!e)return Promise.resolve(e);if(n.has(e))return n.get(e);for(var u;"function"==typeof t;)t=t(e,o);if("object"==typeof t)if(Array.isArray(e))u=r.PromiseUtils.mapSkipRejected(e,function(e){return i(e,t.item,n,o)}),n.set(e,u);else{var f={};n.set(e,f),u=r.PromiseUtils.mapSkipRejected(Object.keys(t),function(r){if(r in e)return i(e[r],t[r],n,o).then(function(e){f[r]=e})}).return(f)}else u=i(e,t,n);return u}e.FILTERED={},e.filter=function(e,t,r){return t?n(e,t,new WeakMap,r):Promise.reject(new Error("Filter required."))}}(t.ObjectFilter||(t.ObjectFilter={}))})}}});require({cache:{"geocortex/infrastructure/ObjectTraverser":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(){}return e.visit=function(e,r){this.visitImpl(e,{propertyName:null,parent:null},r)},e.visitImpl=function(e,r,t){if(!1!==t(e,r)&&"object"==typeof e)for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];this.visitImpl(n,{propertyName:i,parent:e},t)}},e}();r.ObjectTraverser=t})}}});require({cache:{"geocortex/infrastructure/offline/BasemapDeleting":function(){define(["require","exports","./OfflineMap"],function(e,r,n){"use strict";function t(e,r){if(!r)return Promise.reject("basemap cannot be null.");if(!r.filename)return Promise.reject("basemap.filename cannot be null.");switch(r.sourceType){case n.OfflineMapBasemap.Type.PREGENERATED:return e.nativeManager.message("RemoveResource",{fileName:r.filename});case n.OfflineMapBasemap.Type.EXPORT_TILES:return e.nativeManager.message("RemoveExportedTiles",{fileName:r.filename})}return null}Object.defineProperty(r,"__esModule",{value:!0}),r.deleteBasemaps=function(e,r){return Promise.all(r.map(function(r){return t(e,r)})).then(function(){return null})}})},"geocortex/infrastructure/offline/BasemapDownloading":function(){define(["require","exports","./OfflineMap","./OfflineMapProgressClient","geocortex/essentials/Site","./StringFormatting","geocortex/essentials/RestHelperHTTPService"],function(e,r,n,t,a,i,o){"use strict";function s(e,r){e.map.layerIds.filter(function(n){return e.map.getLayer(n).url.indexOf(r)>=0}).map(function(r){return e.map.getLayer(r)})[0];return e.site.essentialsMap.mapServices.filter(function(e){return e.serviceUrl&&e.serviceUrl.indexOf(r)>=0}).map(function(e){return e.serviceToken})[0]}function l(e,r,t,a,i){if(!t)throw new Error("basemap cannot be null.");if(!t.filename)throw new Error("basemap.filename cannot be null.");if(!t.url)throw new Error("basemap.url cannot be null.");switch(t.sourceType){case n.OfflineMapBasemap.Type.PREGENERATED:return u(e,t,a,i);case n.OfflineMapBasemap.Type.EXPORT_TILES:return f(e,r,t,a,i)}return null}function u(e,r,n,t){var s=e.makeAbsolute(r.url,e.site.url),l=e.site.getTokenFromPrincipal(s,a.Site)||e.site.getTokenFromPrincipal(s,esri.IdentityManagerBase);null!=l&&(s=o.RestHelperHTTPService.appendTokenToUrl(s,l));var u={url:s,fileName:r.filename,overwrite:"OnNewer"};return e.nativeManager.message("DownloadResource",u,n,function(n){var a=n.details;switch(a.status){case c.connecting:t&&t({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-connecting").format(r.filename),percentage:0});break;case c.downloading:if(t){var o=Math.round(a.bytesDownloaded/a.bytesTotal*100),s=i.formatBytesString(e,a.bytesDownloaded),l=i.formatBytesString(e,a.bytesTotal),u=i.formatByteTransferRateString(e,a.bytesPerSecond);t({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-downloading").format(r.filename,s,l,o,u),percentage:o})}break;default:e.trace.error("Unknown ResourceDownloadEvent status "+a.status)}})}function f(e,r,n,t,l){var u=n.url,f=e.site.getTokenFromPrincipal(u,esri.IdentityManagerBase)||e.site.getTokenFromPrincipal(u,a.Site);null!=f&&(u=o.RestHelperHTTPService.appendTokenToUrl(u,f));var p=s(e,u),d={url:u,fileName:n.filename,minLevel:n.minLevel,maxLevel:n.maxLevel,areaOfInterest:JSON.stringify({features:[{geometry:r.content.geometry}]}),refreshInterval:n.refreshInterval,token:p};return e.nativeManager.message("ExportTiles",d,t,function(r){var t=r.details;switch(t.status){case c.connecting:l&&l({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-connecting").format(n.filename),percentage:0});break;case c.processing:l&&l({message:t.message||e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-processing").format(n.filename),percentage:0});break;case c.downloading:if(l){var a=Math.round(t.bytesDownloaded/t.bytesTotal*100),o=i.formatBytesString(e,t.bytesDownloaded),s=i.formatBytesString(e,t.bytesTotal),u=i.formatByteTransferRateString(e,t.bytesPerSecond);l({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-downloading").format(n.filename,o,s,a,u),percentage:a})}break;default:e.trace.error("Unknown ResourceDownloadEvent status "+t.status)}})}Object.defineProperty(r,"__esModule",{value:!0}),r.downloadBasemaps=function(e,r,n,a,i){var o=new t.OfflineMapProgressClient(e),s=0;return Promise.reduce(r.content.basemaps,function(u,f){if(a.isCancellationRequested)throw new Error("Operation cancelled.");var c=n?n.basemaps.filter(function(e){return e.referenceId==f.baseMapId})[0]:null;return Promise.resolve().then(function(){return c&&c.status===t.ProgressStatus.Complete?Promise.resolve():o.setOfflineBasemapProgress(r.id,{referenceId:f.baseMapId,status:t.ProgressStatus.InProgress,type:f.sourceType,filename:f.filename,statusUrl:c?c.statusUrl:null})}).then(function(){return c&&c.status===t.ProgressStatus.Complete?Promise.resolve():l(e,r,f,a,function(e){var n=(e.percentage+100*s)/r.content.basemaps.length;i&&i({message:e.message,percentage:n})})}).then(function(){return o.setOfflineBasemapProgress(r.id,{referenceId:f.baseMapId,status:t.ProgressStatus.Complete,type:f.sourceType,filename:f.filename})}).catch(function(n){return i&&i({isWarning:!0,message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-failed").format(f.filename,n.message||n),percentage:100}),o.setOfflineBasemapProgress(r.id,{referenceId:f.baseMapId,status:t.ProgressStatus.Error,errorMessage:n.message||n,type:f.sourceType,filename:f.filename})}).finally(function(){s++})},null)},r.getServiceTokenForMapService=s;var c={connecting:"Connecting",processing:"Processing",downloading:"Downloading"}})},"geocortex/infrastructure/offline/OfflineManager":function(){define(["require","exports","./../CancellationTokenSource","./OfflineMap","./bundle/BundleManager","./OfflineMapProgressClient","./../AreaOfInterestMask","geocortex/framework/observables","../ArrayUtils","./WorkCalculator","./SyncParameters","./SyncEngine","./BasemapDownloading","./BasemapDeleting","./TokenRefresher","geocortex/essentials/FeatureLayerService","./../gis/AppInfo","geocortex/essentials/Layer","geocortex/essentials/MapServiceConstants","geocortex/essentials/utilities/DecomposedUri"],function(e,r,n,t,a,i,o,s,l,u,f,c,p,d,g,h,v,m,y,_){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var M=function(){function e(e,r){this.app=e,this.libraryId=r,this._activeOfflineMapId=null,this._isCancelling=!1,this._previousActiveOfflineMapId=null,this._offlineMaps=[],this.canCancel=new s.Observable(!1),this.isOfflineMapActive=new s.Observable(!1),this.currentOperation=null,this._bundleManager=new a.BundleManager(e,r),this._progressClient=new i.OfflineMapProgressClient(e),this.aoiMask=new o.AreaOfInterestMask(e,{enabled:!1})}return e.prototype.addOfflineMap=function(e,r){var a,o=this;return this._lastOperation=this._waitForLast().then(function(){return o.currentOperation=S.Download,o._throwIfNotNativeInitialized(),o._progressClient.getLastOperationProgress(e.id)}).then(function(r){return(a=r)&&i.wasOfflineMapSyncInterupted(a)?o._loadOfflineMapFromStorage(e.id):e}).then(function(i){i&&(e=i),t.OfflineMap.verify(e),o.canCancel.set(!0),o._cancellationTokenSource=new n.CancellationTokenSource,r||(r=function(){});var s=u.WorkCalculator.calculateFirstDownloadWork(e),l=u.WorkCalculator.noWork(),d=function(){return u.WorkCalculator.calculatePercentageComplete(l,s)};return r({message:o.getResource("language-offline-progress-updating-tokens"),percentage:d()}),g.TokenRefresher.ensureAllTokensAreUpToDate(o.app).then(function(){return o._appStoreSetPromise(o._getOfflineMapKey(e),JSON.stringify(e))}).then(function(){return r({message:o.getResource("language-offline-progress-savingofflinemap"),percentage:d()}),o._setOfflineMap({id:e.id,isDownloaded:!1,hasProgress:!0},e),o._save()}).then(function(){o._throwIfCanceled(),l.saveProfileWork=s.saveProfileWork,r({message:o.getResource("language-offline-progress-starting-sync"),percentage:d()});var n=f.SyncParameters.buildSyncParameters(o.app,e);return c.SyncEngine.sync(o.app,n,o._cancellationTokenSource.token(),function(e){if(e.warnings)for(var n=0,t=e.warnings;n<t.length;n++){var a=t[n];r({message:a,percentage:d(),isWarning:!0})}l.featureLayerWork=e.overallProgress/100*s.featureLayerWork,r({message:e.text,percentage:d()})})}).then(function(){return o._throwIfCanceled(),l.featureLayerWork=s.featureLayerWork,r({message:o.getResource("language-offline-progress-starting-basemap-download"),percentage:d()}),p.downloadBasemaps(o.app,e,a,o._cancellationTokenSource.token(),function(e){l.basemapWork=e.percentage/100*s.basemapWork,r({message:e.message,percentage:d(),isWarning:e.isWarning})})}).then(function(){return o._throwIfCanceled(),l.basemapWork=s.basemapWork,r({message:o.getResource("language-offline-progress-downloadingsite"),percentage:d()}),o._bundleManager.createBundle(e.id,o._getOfflineMapBasemapMapping(e),function(e){r({message:e.message,percentage:d(),isWarning:e.isWarning})})}).then(function(){return o._progressClient.resetOfflineMapProgress(e.id)}).then(function(){return o._setOfflineMap({id:e.id,isDownloaded:!0,hasProgress:!1},e),o._save()}).then(function(){return o.refreshSyncInfo(e)}).then(function(){o._throwIfCanceled(),l.bundleWork=s.bundleWork,r({message:o.getResource("language-offline-progress-complete"),percentage:d()}),o.app.event("OfflineMapAddedEvent").publish({offlineMap:e})}).catch(function(r){throw o._isCancelling&&o._removeOfflineMapNow(e,function(){}),o.app.event("OfflineMapSyncErrorEvent").publish({offlineMap:e,error:r}),r}).finally(function(){o._cancellationTokenSource.dispose(),o._cancellationTokenSource=null,o.canCancel.set(!1),o._isCancelling=!1,o.currentOperation=null})}).then(function(){})},e.prototype.removeOfflineMap=function(e,r){var n=this;return this._lastOperation=this._waitForLast().finally(function(){return n._removeOfflineMapNow(e,r)})},e.prototype.removeOfflineMapPartialData=function(e,r){var n=this;if(!e)throw new Error(this.getResource("language-offline-errors-offlinemapnull"));if(this._throwIfNotNativeInitialized(),this.currentOperation=S.RemovePartial,-1===this._getOfflineMapIx(e))throw new Error(this.getResource("language-offline-errors-notfound"));return c.SyncEngine.deletePartialData(this.app,e.id,r).catch(function(e){n.app.trace.error("Error deleting feature data: "+e)}).then(function(){return n._progressClient.resetOfflineMapProgress(e.id)}).catch(function(e){n.app.trace.error("Error resetting offline map progress. "+e)}).finally(function(){n.currentOperation=null,n.app.event("OfflineMapPartialDataRemovedEvent").publish({offlineMap:e})})},e.prototype._removeOfflineMapNow=function(e,r){var n=this;if(!e)throw new Error(this.getResource("language-offline-errors-offlinemapnull"));this._throwIfNotNativeInitialized(),this.currentOperation=S.Remove;var a="string"==typeof e||e instanceof String?e:e.id,i=this._getOfflineMapIx(e);if(-1===i)throw new Error(this.getResource("language-offline-errors-notfound"));var o=this._offlineMaps[i].offlineMap;if(o.id===this._activeOfflineMapId)throw new Error(this.getResource("language-offline-errors-isactive"));return c.SyncEngine.deleteData(this.app,o.id).catch(function(e){n.app.trace.error("Error deleting feature data: "+e)}).then(function(){return r&&r(n.getResource("language-offline-progress-unregisteringreplica")),n._bundleManager.deleteBundle(o.id)}).catch(function(e){n.app.trace.error("Error deleting bundle: "+e)}).then(function(){r&&r(n.getResource("language-offline-progress-removingofflinemap"));var a=o.content.basemaps.filter(function(e){return e.sourceType===t.OfflineMapBasemap.Type.EXPORT_TILES});return d.deleteBasemaps(n.app,a).then(null,function(e){n.app.trace.error("Error deleting offline map. "+e)}),n._appStoreRemovePromise(n._getOfflineMapKey(e))}).catch(function(e){n.app.trace.error("Error deleting offline map. "+e)}).then(function(){return o.id===n._previousActiveOfflineMapId&&(n._previousActiveOfflineMapId=null),n._offlineMaps.splice(i,1),n._save()}).then(function(){return n._progressClient.resetOfflineMapProgress(a)}).catch(function(e){n.app.trace.error("Error resetting offline map progress. "+e)}).finally(function(){n.app.event("OfflineMapRemovedEvent").publish({offlineMap:e}),n.currentOperation=null})},e.prototype.syncFeatureData=function(e,r){for(var n=[],t=0,a=e;t<a.length;t++){var i=a[t];n.push(this.syncOfflineMap(i,function(n){r&&r({isWarning:n.isWarning,message:n.message,percentage:n.percentage/e.length})}))}return Promise.all(n)},e.prototype.syncOfflineMap=function(e,r,a){var o=this;a||(a={basemapDownloads:!0,updateBundle:!0,featureDataSync:!0,refreshMap:!0});var s,l=this._getOfflineMapIx(e),h="string"==typeof e||e instanceof String?this._offlineMaps[l].offlineMap:e;return this._lastOperation=this._waitForLast().then(function(){if(!e)throw new Error(o.getResource("language-offline-errors-offlinemapnull"));if(-1===l)throw new Error(o.getResource("language-offline-errors-notfound"));return o._throwIfNotNativeInitialized(),o.currentOperation=S.Sync,o._progressClient.getLastOperationProgress(h.id)}).then(function(e){return(s=e)&&i.wasOfflineMapSyncInterupted(s)?o._loadOfflineMapFromStorage(h.id):h}).then(function(e){return e&&(h=e),o._setOfflineMap({id:h.id,isDownloaded:!0,hasProgress:!0},h),o._save()}).then(function(){var e=null;h!==o._offlineMaps[l].offlineMap&&(e=t.OfflineMap.diff(o._offlineMaps[l].offlineMap,h)),o.canCancel.set(!0),o._cancellationTokenSource=new n.CancellationTokenSource;var i=u.WorkCalculator.calculateSyncWork(h,a),v=u.WorkCalculator.noWork(),m=function(){return u.WorkCalculator.calculatePercentageComplete(v,i)};return r({message:o.getResource("language-offline-progress-updating-tokens"),percentage:m()}),Promise.resolve().then(function(){return g.TokenRefresher.ensureAllTokensAreUpToDate(o.app)}).then(function(){if(a.featureDataSync){var e=f.SyncParameters.buildSyncParameters(o.app,h);return c.SyncEngine.sync(o.app,e,o._cancellationTokenSource.token(),function(e){if(e.warnings)for(var n=0,t=e.warnings;n<t.length;n++){var a=t[n];r({message:a,percentage:m(),isWarning:!0})}v.featureLayerWork=e.overallProgress/100*i.featureLayerWork,r({message:e.text,percentage:m()})})}}).then(function(){if(o._throwIfCanceled(),v.featureLayerWork=i.featureLayerWork,a.basemapDownloads){var r=[];return e&&e.content&&e.content.geometry?r=h.content.basemaps.filter(function(e){return e.sourceType===t.OfflineMapBasemap.Type.EXPORT_TILES}):e&&e.content&&e.content.basemaps&&(r=h.content.basemaps.filter(function(e){return e.sourceType===t.OfflineMapBasemap.Type.EXPORT_TILES}).filter(function(r){return!e.content.basemaps.some(function(e){return e.baseMapId===r.baseMapId&&e.sourceType===r.sourceType&&e.url===r.url&&e.minLevel===r.minLevel&&e.maxLevel===r.maxLevel})})),r.length>0?d.deleteBasemaps(o.app,r):null}}).then(function(){if(o._throwIfCanceled(),a.basemapDownloads)return r({message:o.getResource("language-offline-progress-starting-basemap-download"),percentage:m()}),p.downloadBasemaps(o.app,h,s,o._cancellationTokenSource.token(),function(e){v.basemapWork=e.percentage/100*i.basemapWork,r({message:e.message,percentage:m(),isWarning:e.isWarning})})}).then(function(){if(o._throwIfCanceled(),o.canCancel.set(!1),v.basemapWork=i.basemapWork,a.updateBundle)return r({message:o.getResource("language-offline-progress-downloadingsite"),percentage:m()}),o._bundleManager.updateBundle(h.id,o._getOfflineMapBasemapMapping(h),function(e){r({message:e.message,percentage:m(),isWarning:e.isWarning})})}).then(function(){return e?(r({message:o.getResource("language-offline-progress-savingofflinemap"),percentage:m()}),o._appStoreSetPromise(o._getOfflineMapKey(h),JSON.stringify(h))):null}).then(function(){return o._setOfflineMap({id:h.id,isDownloaded:!0,hasProgress:!1},h),o._save()}).then(function(){return o.refreshSyncInfo(h)}).then(function(){return o._progressClient.resetOfflineMapProgress(h.id)}).then(function(){v.bundleWork=i.bundleWork,r({message:o.getResource("language-offline-progress-complete"),percentage:m()}),a.refreshMap&&(o.aoiMask.show(new esri.geometry.Polygon(h.content.geometry)),o.app.site.essentialsMap.mapServices.forEach(function(e){return e.refresh()})),o.app.event("OfflineMapSyncedEvent").publish({offlineMap:h})}).catch(function(e){if(o._isCancelling)return o._setOfflineMap({id:h.id,isDownloaded:!0,hasProgress:!1},h),o._progressClient.resetOfflineMapProgress(h.id).then(function(){o.app.event("OfflineMapSyncErrorEvent").publish({offlineMap:h,error:e})});throw o.app.event("OfflineMapSyncErrorEvent").publish({offlineMap:h,error:e}),e}).finally(function(){o._cancellationTokenSource.dispose(),o._cancellationTokenSource=null,o.canCancel.set(!1),o._isCancelling=!1,o.currentOperation=null})}).then(function(){})},e.prototype.updateBundle=function(e){var r=this;return this._lastOperation=this._waitForLast().finally(function(){if(!n)throw new Error(r.getResource("language-offline-errors-offlinemapnull"));var e=r._getOfflineMapIx(n);if(-1===e)throw new Error(r.getResource("language-offline-errors-notfound"));r._throwIfNotNativeInitialized();var n=r._offlineMaps[e].offlineMap;return r._bundleManager.updateBundle(n.id,r._getOfflineMapBasemapMapping(n))})},e.prototype.activateOfflineMap=function(e,r){var n=this;return this._lastOperation=this._waitForLast().finally(function(){if(!e)throw new Error(n.getResource("language-offline-errors-offlinemapnull"));var t=n._getOfflineMapIx(e);if(-1===t)throw new Error(n.getResource("language-offline-errors-notfound"));n.currentOperation=S.Activate;var a=n._offlineMaps[t].offlineMap;n._throwIfNotNativeInitialized();var i=n._activeOfflineMapId;return n._activeOfflineMapId=a.id,n._bundleManager.loadBundle(n._activeOfflineMapId).then(function(){return n.refreshSyncInfo()}).then(function(){return n._save()}).catch(function(e){return n._activeOfflineMapId=i,Promise.resolve().then(function(){return i?n._bundleManager.loadBundle(n._activeOfflineMapId):n._bundleManager.unloadBundle()}).then(function(){return n.refreshSyncInfo()}).catch(function(e){n.app.trace.error("Error undoing attempt to activate offline map. "+(e.message||e))}).then(function(){throw e})}).then(function(){n.app.isOffline.set(!0),n.isOfflineMapActive.set(!0);var e=new esri.geometry.Polygon(a.content.geometry);n.aoiMask.show(e),n._restoreOfflineUserAddedLayers(a),n.app.site.essentialsMap.mapServices.forEach(function(e){if(e instanceof h.FeatureLayerService){var r=e.serviceLayer;r.suspended&&r.resume()}e.refresh()}),n.app.event("OfflineMapActivatedEvent").publish({offlineMap:n._offlineMaps[t].offlineMap,userAction:!!r})}).finally(function(){n.currentOperation=null})})},e.prototype.deactivateOfflineMap=function(e){var r=this;return this._lastOperation=this._waitForLast().finally(function(){return r._throwIfNotNativeInitialized(),null==r._activeOfflineMapId?Promise.resolve():(r.currentOperation=S.Deactivate,r._previousActiveOfflineMapId=r._activeOfflineMapId,r._activeOfflineMapId=null,r._bundleManager.unloadBundle().then(function(){return r.refreshSyncInfo()}).then(function(){return r._save()}).then(function(){r.app.isOffline.set(!1),r.isOfflineMapActive.set(!1),r.aoiMask.hide(),r.app.site.updateServiceTokensIfStale().then(function(){r.app.site.essentialsMap.mapServices.forEach(function(e){if(e instanceof h.FeatureLayerService){var r=e.serviceLayer,n=new esri.tasks.Query;n.objectIds=[0],r.queryIds(n,function(){e.refresh()},function(){r.suspend()})}else e.refresh()})}),r.app.event("OfflineMapActivatedEvent").publish({offlineMap:null,userAction:!!e})}).finally(function(){r.currentOperation=null}))})},e.prototype.cancel=function(){return this.canCancel.get()?(this._isCancelling=!0,this._cancellationTokenSource.cancel(),this.canCancel.set(!1),this._lastOperation):Promise.reject(this.getResource("language-offline-errors-cancelrejected"))},e.prototype.forgetLast=function(){this._lastOperation=Promise.resolve()},e.prototype.getOfflineMapById=function(e){return this.getOfflineMapsWithState().map(function(e){return e.offlineMap}).filter(function(r){return r.id===e})[0]},e.prototype.getOfflineMapWithStateById=function(e){return this.getOfflineMapsWithState().filter(function(r){return r.offlineMap.id===e})[0]},e.prototype.getOfflineMaps=function(){return this.getOfflineMapsWithState().map(function(e){return e.offlineMap})},e.prototype.getOfflineMapsWithState=function(){var e=this;return this._offlineMaps.map(function(r){return r.syncInfoPromise||(r.syncInfoPromise=c.SyncEngine.getSyncInfo(e.app,r.offlineMap.id)),r})},e.prototype.getActiveOfflineMap=function(){return this._activeOfflineMapId?this.getOfflineMapById(this._activeOfflineMapId):null},e.prototype.getActiveOfflineMapWithState=function(){return this._activeOfflineMapId?this.getOfflineMapWithStateById(this._activeOfflineMapId):null},e.prototype.refreshSyncInfo=function(e){var r=this,n=this._getOfflineMapInfo(e);if(!n)return Promise.resolve(null);var t=c.SyncEngine.getSyncInfo(this.app,n.offlineMap.id).then(function(e){return r.syncInfo=e,r.app.event("SyncInfoRefreshedEvent").publish({offlineMap:n.offlineMap,syncInfo:e}),e});return n&&(n.syncInfoPromise=t),t},e.prototype._getOfflineMapInfo=function(e){return e?"string"==typeof e?this.getOfflineMapWithStateById(e):this.getOfflineMapWithStateById(e.id):this.getActiveOfflineMapWithState()},e.prototype._save=function(){var e=this,r={offlineMapStates:this._offlineMaps.map(function(e){return e.state}),activeOfflineMapId:this._activeOfflineMapId,previousActiveOfflineMapId:this._previousActiveOfflineMapId};return this._appStoreSetPromise("__offlineManager",JSON.stringify(r)).catch(function(r){throw e.app.trace.error("Error saving offline manager state. "+(r.message||r)),r.message=e.getResource("language-offline-errors-savefailed"),r}).then(function(){})},e.prototype.load=function(){var e=this;if(!this._lastOperation)return this.app.trace.info("loading offline map"),this._lastOperation=this._appStoreGetPromise("__offlineManager").then(function(r){if(e.app.trace.info("offline map loaded"),!r)return null;var n=JSON.parse(r);n.offlineMapIds&&!n.offlineMapStates&&(n.offlineMapStates=n.offlineMapIds.map(function(e){return{id:e,isDownloaded:!0,hasProgress:!1}}));var t=n.offlineMapStates.map(function(r){return e._loadOfflineMapFromStorage(r.id).catch(function(n){return e.app.trace.warning("Unable to restore offline map '"+r.id+"'. "+(n.message||n)),null})});return Promise.filter(t,function(e){return null!=e}).then(function(r){e._offlineMaps=r.map(function(r){return{offlineMap:r,state:n.offlineMapStates.filter(function(e){return e.id===r.id})[0],syncInfoPromise:c.SyncEngine.getSyncInfo(e.app,r.id)}});var t=e._prioritizeOfflineMaps(n,e._offlineMaps.map(function(e){return e.offlineMap}));return e._initializeMap(t).then(function(){e.app.trace.info("offline map initialized")})}).then(function(){e.app.event("OfflineMapsLoadedEvent").publish({offlineMaps:e._offlineMaps.map(function(e){return e.offlineMap}),activeOfflineMap:e.getActiveOfflineMap(),offlineMapStates:e._offlineMaps.map(function(e){return e.state})})})}).catch(function(r){throw e.app.trace.error("Error loading offline manager state. "+(r.message||r)),r.message=e.getResource("language-offline-errors-loadfailed"),r}),this._lastOperation.then(function(){})},e.prototype.setStoreResource=function(e,r,n){return this._bundleManager.setStoreResource(e.id,r,n)},e.prototype.getStoreResource=function(e,r){return this._bundleManager.getStoreResource(e.id,r)},e.prototype.hasInternetCheck=function(){var e=this;return this.app.waitUntilSiteInitialized().then(function(){return e.app.nativeManager.message("CanReachHost",{url:e.app.site.url})})},e.prototype._prioritizeOfflineMaps=function(e,r){for(var n=[e.activeOfflineMapId,e.previousActiveOfflineMapId],t=0,a=r.map(function(e){return e.id});t<a.length;t++){var i=a[t];i!==e.activeOfflineMapId&&i!==e.previousActiveOfflineMapId&&n.push(i)}return n},e.prototype._initializeMap=function(e){var r=this;if(0===e.length&&this.app.isOffline.get())return Promise.resolve();var n=e[0];return this.app.isOffline.get()&&!n?this._initializeMap(e.slice(1)):n?this._bundleManager.loadBundle(n).then(function(){r._activeOfflineMapId=n,r.app.isOffline.set(!!n),r.isOfflineMapActive.set(!!n);var e=r._getOfflineMapIx(n),t=r._offlineMaps[e].offlineMap,a=new esri.geometry.Polygon(r._offlineMaps[e].offlineMap.content.geometry);return r.aoiMask.show(a),r._restoreOfflineUserAddedLayers(t),r.refreshSyncInfo()}).catch(function(n){return r._initializeMap(e.slice(1))}):Promise.resolve()},e.prototype.updatePrincipal=function(){var e=this,r=[];return this.app.waitUntilSiteInitialized().then(function(){for(var n=0,t=e._offlineMaps;n<t.length;n++){var a=t[n],i=a.offlineMap.properties.siteId;i&&i.string===e.app.site.id&&r.push(e._bundleManager.updatePrincipal(a.offlineMap.id,e.app.site.principal))}return Promise.all(r)})},e.prototype._waitForLast=function(){return this._lastOperation.catch(function(e){})},e.prototype._throwIfCanceled=function(){if(this._cancellationTokenSource.token().isCancellationRequested)throw new Error(this.getResource("language-offline-errors-canceled"))},e.prototype._throwIfNotNativeInitialized=function(){if(!this.app.nativeManager.nativeInitialized)throw new Error(this.getResource("language-offline-errors-notnativeinitialized"))},e.prototype._loadOfflineMapFromStorage=function(e){var r=this;return this._appStoreGetPromise(this._getOfflineMapKey(e)).then(function(e){if(!e)throw r.app.trace.error("Offline profile '{offlineMapId}' not found."),new Error(r.getResource("language-offline-errors-notfound"));return JSON.parse(e)},function(e){throw r.app.trace.error("Error loading offline map. "+(e.message||e)),e.message=r.getResource("language-offline-errors-loadfailed"),e})},e.prototype._restoreOfflineUserAddedLayers=function(e){var r=this;this.app.waitUntilSiteServiceLayersLoaded().then(function(){var n=[],t=v.AppInfo.fromGeocortexApp(r.app);e.content.layers.forEach(function(r){if(r.isUserCreated&&r.serviceInfo){var a=r.serviceInfo.url;if(a){var i=t.mapInfo.getLayerInfos().filter(function(e){return e.uniqueId===r.layerInfoUniqueId})[0];if(i)i.gcxLayer&&i.gcxLayer.properties.offlineMapId&&(i.gcxLayer.properties.offlineMapId=e.id);else{var o=t.mapInfo.serviceLayers.filter(function(e){return e.serviceLayer.url===a})[0];if(o&&o.gcxMapService){var s=new m.Layer(r.layerJson.url);s.createFromDefinition(r.layerJson),s.isUserCreated=!0,s.catalogId=r.layerJson.catalogId,s.includeInLayerList=!0,s.setInActiveTheme(!0),s.properties.offlineMapId=e.id,s.parentLayerId=null,o.gcxMapService.add(s);var l=n.filter(function(e){return e.service===o.gcxMapService})[0];l?l.layers.push(s):n.push({service:o.gcxMapService,layers:[s]})}}}}}),n.forEach(function(e){r.app.event("MapServiceLayersChangedWithResultEvent").publish({mapService:e.service,newItems:e.layers,oldItems:[]}),r.app.event("MapServiceLayersChangedEvent").publish(e.service)})})},e.prototype._getOfflineMapIx=function(e){for(var r="string"==typeof e?e:e.id,n=0;n<this._offlineMaps.length;n++)if(this._offlineMaps[n].offlineMap.id===r)return n;return-1},e.prototype._getOfflineMapBasemapMapping=function(e){var r=this.app.site.essentialsMap.baseMaps;return e.content.basemaps.map(function(e){var n=r.filter(function(r){return e.baseMapId===r.id})[0];if(!n)return null;var a=n.services.filter(function(e){return e.mapService.mapServiceType===y.MapServiceType.TILED}).pop();return a?{url:_.DecomposedUri.removeQueryParameters(a.mapService.serviceLayer.url,"token"),localServicePath:(e.sourceType===t.OfflineMapBasemap.Type.PREGENERATED?"tile":"viewertile")+"/"+e.filename.replace(" ","_")}:null}).filter(function(e){return!!e})},e.prototype._getOfflineMapKey=function(e){return"string"==typeof e?"__offlineMap-"+e:"__offlineMap-"+e.id},e.prototype._appStoreGetPromise=function(e){var r=this;return new Promise(function(n,t){return r.app.store.get(e,n,t)})},e.prototype._appStoreSetPromise=function(e,r){var n=this;return new Promise(function(t,a){return n.app.store.set(e,r,function(){return t()},a)})},e.prototype._appStoreRemovePromise=function(e){var r=this;return new Promise(function(n,t){return r.app.store.remove(e,function(){return n()},t)})},e.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},e.prototype._setOfflineMap=function(e,r){var n=l.ArrayUtils.findIndex(this._offlineMaps,function(e){return e.offlineMap.id==r.id});if(n>=0){var t=this._offlineMaps[n];this._offlineMaps.splice(n,1,{state:e,offlineMap:r,syncInfoPromise:t.syncInfoPromise})}else this._offlineMaps.push({state:e,offlineMap:r,syncInfoPromise:null})},e}();r.OfflineManager=M;var S;!function(e){e[e.Download=1]="Download",e[e.Sync=2]="Sync",e[e.Remove=3]="Remove",e[e.Activate=4]="Activate",e[e.Deactivate=5]="Deactivate",e[e.RemovePartial=6]="RemovePartial"}(S=r.OfflineManagerOperation||(r.OfflineManagerOperation={}))})},"geocortex/infrastructure/offline/OfflineMap":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){function r(e,r){return e===r||JSON.stringify(e)===JSON.stringify(r)}e.verify=function(e){if(!e)throw new Error("offlineMap is null or undefined.");if(!e.id)throw new Error("offlineMap.id is null or undefined.");if(!e.content)throw new Error("offlineMap.content is null or undefined.");if(!e.content.geometry)throw new Error("offlineMap.content.geometry is null or undefined.");if(!e.content.basemaps)throw new Error("offlineMap.content.basemaps is null or undefined.");for(var r=0;r<e.content.basemaps.length;r++){if(!e.content.basemaps[r].url)throw new Error("offlineMap.content.basemaps["+r+"].url is null or undefined.");if(!e.content.basemaps[r].baseMapId)throw new Error("offlineMap.content.basemaps["+r+"].baseMapId is null or undefined.");if(!e.content.basemaps[r].filename)throw new Error("offlineMap.content.basemaps["+r+"].filename is null or undefined.");if(!e.content.basemaps[r].sourceType)throw new Error("offlineMap.content.basemaps["+r+"].sourceType is null or undefined.")}if(!e.content.layers)throw new Error("offlineMap.content.layers is null or undefined.");for(var n=0;n<e.content.layers.length;n++)if(!e.content.layers[n].layerInfoUniqueId)throw new Error("offlineMap.content.layers["+n+"].layerInfoUniqueId is null or undefined.");if(!e.properties.siteId)throw new Error("offlineMap.properties.siteId is null or undefined.");if(!e.properties.viewerId)throw new Error("offlineMap.properties.viewerId is null or undefined.")},e.diff=function(e,n){var t={};e.description!==n.description&&(t.description=n.description),r(e.grants,n.grants)||(t.grants=n.grants),r(e.properties,n.properties)||(t.properties=n.properties),r(e.shape,n.shape)||(t.shape=n.shape),r(e.tags||[],n.tags||[])||(t.tags=n.tags),e.title!==n.title&&(t.title=n.title),r(e.thumbnail,n.thumbnail)||(t.thumbnail=n.thumbnail),e.version!==n.version&&(t.version=n.version),null==e.content!=(null==n.content)?t.content=n.content:null==n.content?t.content=null:r(e.content,n.content)||(t.content={},r(e.content.geometry,n.content.geometry)||(t.content.geometry=n.content.geometry),r(e.content.layers,n.content.layers)||(t.content.layers=n.content.layers),r(e.content.basemaps,n.content.basemaps)||(t.content.basemaps=n.content.basemaps),e.content.includeAttachments!==n.content.includeAttachments&&(t.content.includeAttachments=n.content.includeAttachments));for(var a in t)if(t.hasOwnProperty(a))return t;return null}}(r.OfflineMap||(r.OfflineMap={}));!function(e){e.Type={EXPORT_TILES:"exportTiles",PREGENERATED:"pregenerated"}}(r.OfflineMapBasemap||(r.OfflineMapBasemap={}))})},"geocortex/infrastructure/offline/OfflineMapProgressClient":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e){this.app=e}return e.prototype.getLastOperationProgress=function(e){return this.app.nativeManager.message("GetOfflineMapProgress",{localServerNamespace:this.app.localServerNamespace,offlineMapId:e})},e.prototype.resetOfflineMapProgress=function(e){return this.app.nativeManager.message("ResetOfflineMapProgress",{localServerNamespace:this.app.localServerNamespace,offlineMapId:e}).then(function(e){})},e.prototype.setOfflineBasemapProgress=function(e,r){return this.app.nativeManager.message("SetOfflineBasemapProgress",{localServerNamespace:this.app.localServerNamespace,offlineMapId:e,progress:r}).then(function(e){})},e}();r.OfflineMapProgressClient=n,r.wasOfflineMapSyncInterupted=function(e){return!!e.basemaps.some(function(e){return e.status===r.ProgressStatus.InProgress||e.status==r.ProgressStatus.NotStarted})||!!e.layers.some(function(e){return e.status===r.ProgressStatus.InProgress||e.status==r.ProgressStatus.NotStarted})},r.ProgressStatus={NotStarted:"notStarted",InProgress:"inProgress",Complete:"complete",Error:"error"}})},"geocortex/infrastructure/offline/Progress":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/offline/StringFormatting":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.formatByteTransferRateString=function(e,r){var n=r/1024;if(n<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-bytes-per-second").format(Math.round(r));var t=r/1048576;return t<1?e.getResource("Mapping.Infrastructure","language-offline-progress-kilobytes-per-second").format(Math.round(n)):e.getResource("Mapping.Infrastructure","language-offline-progress-megabytes-per-second").format(Math.round(10*t)/10)},r.formatBytesString=function(e,r){var n=r/1024;if(n<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-bytes").format(r);var t=r/1048576;if(t<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-kilobytes").format(Math.round(n));var a=r/1073741824;return a<1?e.getResource("Mapping.Infrastructure","language-offline-progress-megabytes").format(Math.round(t)):e.getResource("Mapping.Infrastructure","language-offline-progress-gigabytes").format(Math.round(100*a)/100)}})},"geocortex/infrastructure/offline/SyncEngine":function(){define(["require","exports","./SyncInfo","geocortex/essentials/FeatureLayerService","geocortex/essentials/utilities/LayerUtilities"],function(e,r,n,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){}return e.getSyncInfo=function(e,r){var t=e.localServerAddress+"/sync/"+e.localServerNamespace+"/info?profile="+r;return e.nativeManager.xhrGet({url:t}).then(function(e){var r=JSON.parse(e);return new n.SyncInfo(r)})},e.sync=function(e,r,n,t){var a=this;return e.event("FeatureDataSyncStartedEvent").publish(r),this._unregisterOfflineDeletedReplicas(e).then(function(i){return a._sync(e,r,n,t)}).then(function(r){return e.event("FeatureDataSyncCompletedEvent").publish(),r})},e._sync=function(e,r,n,t){var a=this;return n.register(function(){return a._cancel(e)}),new Promise(function(n,i){var o=e.event("NativeMessageEvent").subscribe(a,function(r){"syncStatus"===r.type&&(r.parameters.state===a.STATUS_SUCCESS?(e.event("NativeMessageEvent").unsubscribe(o),t(r.parameters),n(r.parameters)):r.parameters.state===a.STATUS_ERROR?(e.event("NativeMessageEvent").unsubscribe(o),i(r.parameters.text)):r.parameters.state===a.STATUS_IN_PROGRESS&&t(r.parameters))}),s={options:JSON.stringify(r)},l=e.localServerAddress+"/sync/"+e.localServerNamespace+"/execute";e.nativeManager.xhrPost({url:l,content:s,error:function(r){e.event("NativeMessageEvent").unsubscribe(o),i(r.responseText)}})})},e._cancel=function(e){var r=e.localServerAddress+"/sync/"+e.localServerNamespace+"/cancel";return e.nativeManager.xhrPost({url:r,method:"POST"})},e.deleteData=function(e,r){var n=this._getFeatureServiceTokenInfo(e),t=e.localServerAddress+"/sync/"+e.localServerNamespace+"/delete",a={parameters:JSON.stringify({profile:r,serviceInfo:n})};return e.nativeManager.xhrPost({url:t,content:a,method:"POST"})},e.deletePartialData=function(e,r,n){var t={profile:r,serviceInfo:this._getFeatureServiceTokenInfo(e),localServerNamespace:e.localServerNamespace,firstDownload:n};return e.nativeManager.message("DeletePartiallySyncedData",t)},e._unregisterOfflineDeletedReplicas=function(e){var r=this._getFeatureServiceTokenInfo(e),n=e.localServerAddress+"/sync/"+e.localServerNamespace+"/unregisterDeletedReplicas",t={parameters:JSON.stringify({serviceInfo:r})};return e.nativeManager.xhrPost({url:n,content:t})},e._getFeatureServiceTokenInfo=function(e){return e.site.essentialsMap.mapServices.filter(function(e){return e instanceof t.FeatureLayerService}).map(function(e){return{serviceUrl:a.LayerUtilities.decomposeFeatureLayerUrl(e.serviceUrl).serviceUrl,token:e.serviceToken}})},e}();i.STATUS_IN_PROGRESS="inProgress",i.STATUS_SUCCESS="success",i.STATUS_ERROR="error",r.SyncEngine=i})},"geocortex/infrastructure/offline/SyncInfo":function(){define(["require","exports","geocortex/essentials/utilities/LayerUtilities"],function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(e){this.servers=[],this.lastSyncNotificationDate=new Date(0);for(var r=0;r<e.servers.length;r++)"string"==typeof e.servers[r].lastSyncTime&&(e.servers[r].lastSyncTime=new Date(e.servers[r].lastSyncTime)),this.servers.push(e.servers[r]);this.lastSyncNotificationDate=new Date(e.lastSyncNotificationDate)}return e.prototype.isSynced=function(e){return!!this.findLayerOrTable(e)},e.prototype.findLayerOrTable=function(e){for(var r=n.LayerUtilities.decomposeFeatureLayerUrl(e),t=this.servers.filter(function(e){return e.featureServiceUrl==r.serviceUrl}),a=0;a<t.length;a++){var i=t[a],o=i.layers.filter(function(e){return e.id==r.layerId})[0];if(o)return o;var s=i.layers.filter(function(e){return e.id==r.layerId})[0];if(s)return s}return null},e.prototype.getOldestSyncTime=function(){if(this.servers.length){for(var e=this.servers[0].lastSyncTime,r=0;r<this.servers.length;r++)this.servers[r].lastSyncTime<e&&(e=this.servers[r].lastSyncTime);return e}return new Date},e}();r.SyncInfo=t})},"geocortex/infrastructure/offline/SyncParameters":function(){define(["require","exports","./../gis/AppInfo","./../gis/LayerInfo","geocortex/framework/utils/utils"],function(e,r,n,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){function r(e,n,o,s){s||(s={});var l=[];if(s[o.uniqueId])return l;s[o.uniqueId]=!0;for(var u=0,f=o.relationships;u<f.length;u++)!function(u){var f=o.url.replace(/\/[0-9]+$/,"/"+u.relatedTableId),c=n.filter(function(e){return e.url==f})[0];c||((c=i(n,o,u.relatedTableId))||((c=new t.LayerInfo).id=u.relatedTableId+"",c.relationships=[],c.uniqueId=a.alphaNumericToken()),c.url=f),l.push(c);for(var p=0,d=r(e,n,c,s);p<d.length;p++){var g=d[p];l.push(g)}}(f[u]);return l}function i(e,r,n){var t=r.serviceLayerInfo.gcxMapService.serviceTag;if(t){var a=n+"";return e.filter(function(e){return e.serviceLayerInfo.gcxMapService.serviceTag===t}).filter(function(e){return e.id===a})[0]}}e.buildSyncParameters=function(e,t){var a=n.AppInfo.fromGeocortexApp(e),i=a.mapInfo.getLayerInfos(),o=i.concat(a.mapInfo.getTableInfos());o.forEach(function(e){return e.url=e.getUrlWithoutParameters()});var s=[],l={};return t.content.layers.forEach(function(e){var n,t,u,f,c,p=i.filter(function(r){return r.uniqueId==e.layerInfoUniqueId})[0];if(p||e.isUserCreated){if(p){if(t=p.url.substring(0,p.url.lastIndexOf("/")),u=parseInt(p.id),n={id:u,where:e.definitionExpression,displayName:p.displayName},p.gcxLayer.isDynamic){var d=p.serviceLayerInfo.serviceLayer,g=d.dynamicLayerInfos.filter(function(e){return e.id===u})[0];g&&(n.dynamicLayerInfo=g.toJson());var h=d.layerDrawingOptions[u];h&&(n.layerDrawingOptions=h.toJson())}c=p.serviceLayerInfo.gcxMapService.serviceToken,f=p.serviceLayerInfo.capabilities}else{if(!(e.isUserCreated&&e.serviceInfo&&e.layerJson))return;t=e.serviceInfo.url,f=e.serviceInfo.capabilities,u=parseInt(e.layerJson.id);var v=JSON.parse(e.layerJson.dynamicDefinition);n={id:u,displayName:e.layerJson.name,where:e.definitionExpression,dynamicLayerInfo:v,layerDrawingOptions:v?v.drawingInfo:null}}var m=s.filter(function(e){return e.url===t})[0];if(m?l[p.uniqueId]||m.layers.push(n):(m={url:t,layers:[n],capabilities:f,token:c},s.push(m)),p){l[p.uniqueId]=p;for(var y=0,_=r(a.mapInfo,o,p);y<_.length;y++)!function(e){var r=parseInt(e.id);l[e.id]||(m.layers.some(function(e){return e.id==r})||m.layers.push({id:r,displayName:e.displayName||e.name}),l[e.uniqueId]=e)}(_[y])}}}),{profile:t.id,featureServices:s,geometry:t.content.geometry,includeAttachments:t.content.includeAttachments,mapSpatialReference:e.map.spatialReference.toJson()}}}(r.SyncParameters||(r.SyncParameters={}))})},"geocortex/infrastructure/offline/SyncProgress":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/offline/TokenRefresher":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){}return e.ensureAllTokensAreUpToDate=function(e){var r=new Date(e.site.principal.expiry).valueOf()-(new Date).valueOf()<6e4;return e.site.principal.isAuthenticated&&r?e.site.refreshPrincipal().then(function(){return Promise.resolve(e.site.updateServiceTokensIfStale())}).then(function(){}):Promise.resolve(e.site.updateServiceTokensIfStale()).then(function(){})},e}();r.TokenRefresher=n})},"geocortex/infrastructure/offline/WorkCalculator":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){}return e.calculateFirstDownloadWork=function(e){return{saveProfileWork:.25,featureLayerWork:e.content.layers.length+2,basemapWork:4*e.content.basemaps.length,bundleWork:.5}},e.calculateSyncWork=function(e,r){return{saveProfileWork:0,featureLayerWork:r.featureDataSync?e.content.layers.length+2:0,basemapWork:r.basemapDownloads?2*e.content.basemaps.length:0,bundleWork:r.updateBundle?.5:0}},e.noWork=function(){return{saveProfileWork:0,bundleWork:0,featureLayerWork:0,basemapWork:0}},e.calculatePercentageComplete=function(e,r){return this._calculateTotalWork(e)/this._calculateTotalWork(r)*100},e._calculateTotalWork=function(e){return e.saveProfileWork+e.bundleWork+e.featureLayerWork+e.basemapWork},e}();r.WorkCalculator=n})},"geocortex/infrastructure/offline/bundle/Bundle":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/offline/bundle/BundleBuilder":function(){define(["require","exports","./RoutingRulesBuilder","geocortex/geocortex","geocortex/essentials/MapServiceConstants","geocortex/essentials/FeatureLayerService","geocortex/framework/utils/utils","./WorkflowExtractor","geocortex/essentials/utilities/DecomposedUri"],function(e,r,n,t,a,i,o,s,l){"use strict";function u(e,r){return r.resources.push(S("__error_offline_no_endpoint",{error:{code:400,message:"This resource is not available offline.",details:[]}})),r.resources.push(S("__no_features",{objectIdFieldName:"OBJECTID",globalIdFieldName:"GlobalID",features:[]})),r.resources.push(S("__no_search_results",{count:0,features:[],ResponseStatus:{}})),r.resources.push(S("__no_data_links",{results:[]})),r.resources.push(S("__empty_attribution_response","")),null}function f(e,r){return new Promise(function(n,a){var i=O(e,e.app.site.url+"/map/layerlist");t.request({url:i,content:{f:"json"},load:function(e){r.resources.push(S("__layerlist_",e)),n(null)},error:function(r){var n=y(e.app,i,r.message);e.app.trace.error(n),a(r.message||n)},callbackParamName:"Callback"})})}function c(e,r){return new Promise(function(n,a){var i=O(e,e.app.site.url);t.request({url:i,content:{f:"json",deep:e.app.site.deepInitialize},load:function(e){r.resources.push(S("__site_",e)),n(null)},error:function(r){var n=y(e.app,i,r.message);e.app.trace.error(n),a(r.message||n)},callbackParamName:"Callback"})})}function p(e,r){var n=[],t=e.app.site.essentialsMap.mapServices;e.app.site.overviewMap&&(t=t.concat(e.app.site.overviewMap.mapServices));var o=t.map(function(t){return-1!=n.indexOf(t.url)?null:(n.push(t.url),t.mapServiceType===a.MapServiceType.WMS||t.mapServiceType===a.MapServiceType.WEBTILED?null:t.mapServiceType===a.MapServiceType.BING?g(e,r,t):t.mapServiceType===a.MapServiceType.GEORSS||t.mapServiceType===a.MapServiceType.KML?m(e,r,t):t instanceof i.FeatureLayerService?d(e,r,t):h(e,r,t))});return Promise.all(o)}function d(e,r,n){var t=[],a=/^(.*)(\/[0-9]+\/?)(\?.*)?$/.exec(n.serviceUrl)[1],i=null;return n.layers[0]?i=n.layers[0].relationships:n.serviceLayer&&(i=n.serviceLayer.relationships),i&&(t=t.concat(i.map(function(t){return new Promise(function(i,o){var s=a+"/"+t.relatedTableId,l={f:"json"},u=n.findServiceToken();u&&(l.token=u),esri.request({url:s,handleAs:"json",content:l,callbackParamName:"Callback"}).then(function(e){r.resources.push(S(I(s),e)),i(null)},function(r){var n=y(e.app,s,r.message);e.app.trace.error(n),o(r.message||n)})})}))),t.push(h(e,r,n)),Promise.all(t)}function g(e,r,n){return new Promise(function(t,a){var i=b(e,n),o=n.serviceLayer,s={ss:"true",c:o.culture,key:n.bingProperties.bingMapsKey},l=i+"/Imagery/Metadata/"+o.mapStyle;esri.request({url:l,handleAs:"json",content:s,callbackParamName:"jsonp"}).then(function(e){r.resources.push(S(I(i),e)),t(null)},function(r){var n=y(e.app,i,r.message);e.app.trace.error(n),a(r.message||n)})})}function h(e,r,n){return new Promise(function(t,a){var i=b(e,n),o={f:"json"},s=n.findServiceToken();s&&(o.token=s),esri.request({url:i,handleAs:"json",content:o,callbackParamName:"Callback"}).then(function(e){r.resources.push(S(I(i),e)),t(null)},function(r){var n=y(e.app,i,r.message);e.app.trace.error(n),t(null)})})}function v(e,r){var n=s.WorkflowExtractor.getWorkflowEntries(e.app).map(function(n){var t={},a=e.app.site.getTokenFromPrincipal(n,esri.IdentityManagerBase);a&&(t.token=a);var i=new l.DecomposedUri(n);return"json"===i.query.f&&(delete i.query.f,n=i.recompose(),t.f="json"),Promise.resolve(esri.request({url:n,handleAs:"json",content:t})).then(function(e){r.resources.push(S(I(n),e))}).catch(function(r){var t=_(e.app,n,r.message);e.app.trace.error(t),e.progress&&e.progress({message:t,isWarning:!0,percentage:0})})});return Promise.all(n)}function m(e,r,n){return new Promise(function(t,a){var i=b(e,n);esri.request({url:i,handleAs:"xml",content:{},callbackParamName:"Callback"}).then(function(e){r.resources.push(w(I(i),(new XMLSerializer).serializeToString(e))),t(null)},function(r){var n=y(e.app,i,r.message);e.app.trace.error(n),a(r.message||n)})})}function y(e,r,n){return M(e.offlineManager.getResource("language-offline-errors-fetch-error"),r,n)}function _(e,r,n){return M(e.offlineManager.getResource("language-offline-errors-fetch-workflow-error"),r,n)}function M(e,r,n){var t=e.format(r);return n&&(t+=" "+n),t}function S(e,r,n){return void 0===n&&(n=!1),w(e,JSON.stringify(r),n)}function w(e,r,n){return void 0===n&&(n=!1),{isEncoded:n,isJson:!0,key:e,value:n?o.base64Encode(r):r}}function b(e,r){var n=r.serviceUrl;return!n&&r.serviceLayer&&(n=r.serviceLayer.url),n&&(n=O(e,n)),n}function O(e,r){r=e.app.makeAbsolute(r);var n=document.createElement("a");n.href=r;var t=n.href,a=t.charAt(t.length-1);return"/"!==a&&"\\"!==a||(t=t.substr(0,t.length-1)),t}function I(e){var r=e,n=/^[a-z]+:\/\/(.*)/.exec(r);n&&(r=n[1]);var t=/^(services|server)\.arcgisonline\.(.*)/.exec(r);t&&(r="(services|server).arcgisonline."+t[2]),/^[^/]*virtualearth.net\//.exec(r)&&(r="[^/]*virtualearth.net/");var a=/^([a-zA-Z.]+):(80|443)(.*)/.exec(r);return a&&(r=a[1]+a[3]),r=r.replace(/\//g,"/+").replace(/\./g,"\\.").replace(/\?/g,"\\?")}Object.defineProperty(r,"__esModule",{value:!0}),r.buildBundle=function(e){var r={id:e.bundleId,timestamp:(new Date).getTime(),routingRules:n.buildRoutingRules(e),resources:[]},t=[u(0,r),c(e,r),f(e,r),p(e,r),v(e,r)];return Promise.all(t).then(function(){return r})},r.buildJsonEntry=S,r.cleanUpMapServiceUrl=b,r.cleanUpRestUrl=O,r.urlToPattern=I})},"geocortex/infrastructure/offline/bundle/BundleBuilderContext":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/offline/bundle/BundleManager":function(){define(["require","exports","./OfflineRouter","./EsriRequestHacker","./EsriLayerHacker","./offlineHandlers/ServeResourceHandler","./offlineHandlers/PassthroughHandler","./offlineHandlers/FailHandler","./offlineHandlers/RewriteHandler","./offlineHandlers/SiteHandler","./../SyncEngine","./BundleBuilder"],function(e,r,n,t,a,i,o,s,l,u,f,c){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var p=function(){function e(e,r){var f=this;this.app=e,this.libraryId=r,this._router=new n.OfflineRouter(this.app),this._esriRequestHacker=new t.EsriRequestHacker(e,function(e,r){return f._router.handle(e,r)}),this._esriLayerHacker=new a.EsriLayerHacker(e,function(e){return f._router.rewriteUrl(e)}),this._esriLayerHacker.errorReporter=function(e){return f.app.trace.warning(e)},this._serveResourceHandler=new i.ServeResourceHandler(this.app,function(e){return f._appStoreGetPromise(e)},function(e,r){return f._appStoreSetPromise(e,r)},function(e){return f._appStoreRemovePromise(e)});var c=new o.PassthroughHandler(this.app,function(e,r){return f._esriRequestHacker.unhackedRequest(e,r)});this._router.setDefaultHandler(c),this._router.addHandler(c),this._router.addHandler(this._serveResourceHandler),this._router.addHandler(new s.FailHandler),this._router.addHandler(new l.RewriteHandler(this.app,function(e,r){return f._esriRequestHacker.unhackedRequest(e,r)})),this._router.addHandler(new u.SiteHandler(this.app,function(e){return f._serveResourceHandler.getResourceValue(e)},function(e,r){var n=i.ServeResourceHandler.getResourceStorageKey(f._activeBundle.id,e);return f._serveResourceHandler.resourceSetter(n,r)},function(e,r){return f._esriRequestHacker.unhackedRequest(e,r)})),this.app.event("ApplicationStorageClearedEvent").subscribe(this,function(){f._serveResourceHandler.clear(),f._router.clearRoutingRules()})}return e.prototype.createBundle=function(e,r,n){var t=this;return this._buildBundle(e,r,n).then(function(e){return t._storeBundle(e)}).then(function(e){})},e.prototype.deleteBundle=function(e){var r=this;return this._getBundle(e).then(function(e){return e?r._serveResourceHandler.unstoreBundle(e):null}).then(function(e){return e?r._appStoreRemovePromise(r._getBundleKey(e)):null}).then(function(){})},e.prototype.updateBundle=function(e,r,n){var t=this;return this._buildBundle(e,r,n).then(function(r){return t.deleteBundle(e).catch(function(e){return t.app.trace.warning("Unable to delete old bundle before replacing it. "+(e.message||e)+" Attempting to continue."),null}).then(function(){return r})}).then(function(e){return t._storeBundle(e)}).then(function(e){return t._router.setRoutingRules(e.routingRules)}).then(function(){})},e.prototype.loadBundle=function(e){var r=this;return e?this._getBundle(e).then(function(e){if(!e)throw new Error(r.getResource("language-offline-errors-bundlenotfound"));r._activeBundle=e,r._serveResourceHandler.loadBundle(e),r._router.setRoutingRules(e.routingRules)}):Promise.reject(new Error("Bundle ID cannot be null."))},e.prototype.unloadBundle=function(){return this._serveResourceHandler.clear(),this._router.clearRoutingRules(),Promise.resolve()},e.prototype.updatePrincipal=function(e,r){var n=this;return this.getStoreResource(e,"__site_").then(function(t){var a=JSON.parse(t);if(a.principal){a.principal=r;var i=c.buildJsonEntry("__site_",a);return n._serveResourceHandler.updateEntry(e,i)}})},e.prototype._buildBundle=function(e,r,n){var t=this;return f.SyncEngine.getSyncInfo(this.app,e).then(function(a){var i={app:t.app,bundleId:e,basemaps:r,featureLayerSyncInfo:a,progress:n};return t._esriRequestHacker.disable(),c.buildBundle(i).finally(function(){t._esriRequestHacker.enable()})})},e.prototype._storeBundle=function(e){var r=this;return null==e?Promise.reject(new Error("Bundle is null.")):null==e.id?Promise.reject(new Error("Bundle ID is null.")):this._serveResourceHandler.stripAndStoreBundle(e).then(function(){return r._appStoreSetPromise(r._getBundleKey(e),JSON.stringify(e)),e},function(n){throw r.app.trace.warning("Failed to save offline bundle '"+e.id+"'. "+(n.message||n)),22==n.code&&window.localStorage&&window.localStorage.remainingSpace&&r.app.trace.warning("Local storage has "+window.localStorage.remainingSpace+" bytes remaining."),n})},e.prototype._getBundle=function(e){return e?this._appStoreGetPromise(this._getBundleKey(e)).then(function(e){return e?JSON.parse(e):null}):Promise.reject(new Error("Bundle ID is null."))},e.prototype._getBundleKey=function(e){return"__bundle-"+("string"==typeof e?e:e.id)},e.prototype.getStoreResource=function(e,r){var n=i.ServeResourceHandler.getResourceStorageKey(e,r);return this._appStoreGetPromise(n)},e.prototype.setStoreResource=function(e,r,n){var t=i.ServeResourceHandler.getResourceStorageKey(e,r);return this._appStoreSetPromise(t,n)},e.prototype._appStoreGetPromise=function(e){var r=this;return new Promise(function(n,t){return r.app.store.get(e,n,t)})},e.prototype._appStoreSetPromise=function(e,r){var n=this;return new Promise(function(t,a){return n.app.store.set(e,r,function(){return t()},a)})},e.prototype._appStoreRemovePromise=function(e){var r=this;return new Promise(function(n,t){return r.app.store.remove(e,function(){return n()},t)})},e.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},e}();r.BundleManager=p})},"geocortex/infrastructure/offline/bundle/BundleResourceEntry":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(e){e?dojo.safeMixin(this,e):this.key=""}}();r.BundleResourceEntry=n})},"geocortex/infrastructure/offline/bundle/EsriLayerHacker":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,r){this.app=e,this.urlRewriter=r,this.errorReporter=function(e){},this._captureHooks(),this._extendEsriLayers()}return e.prototype._captureHooks=function(){this._hooked_esri_getTileUrl=esri.layers.ArcGISTiledMapServiceLayer._meta.hidden.getTileUrl,this._hooked_ogc_getWMTSTileUrl=esri.layers.WMTSLayer._meta.hidden.getTileUrl,this._ogc__tileLoadHandler=esri.layers.WMTSLayer.superclass._tileLoadHandler,this._hooked_BingMaps_getTileUrl=esri.virtualearth.VETiledLayer._meta.hidden.getTileUrl,this._bingMaps__tileLoadHandler=esri.virtualearth.VETiledLayer.superclass._tileLoadHandler,this._hooked_WebTiledLayer_getTileUrl=esri.layers.WebTiledLayer._meta.hidden.getTileUrl,this._webTiledLayer__tileLoadHandler=esri.layers.WebTiledLayer.superclass._tileLoadHandler,this._hooked_esri_getImageUrl=esri.layers.ArcGISDynamicMapServiceLayer._meta.hidden.getImageUrl,this._hooked_ogc_getImageUrl=esri.layers.WMSLayer._meta.hidden.getImageUrl},e.prototype._extendEsriLayers=function(){var e=this;esri.virtualearth.VETiledLayer.extend({getTileUrl:function(r,n,t){var a=e._hooked_BingMaps_getTileUrl.apply(this,[r,n,t]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(a)||a:a},_tileLoadHandler:function(r){e._bingMaps__tileLoadHandler.apply(this,[r])}}),esri.layers.WMTSLayer.extend({getTileUrl:function(r,n,t){var a=e._hooked_ogc_getWMTSTileUrl.apply(this,[r,n,t]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(a)||a:a},_tileLoadHandler:function(r){e._ogc__tileLoadHandler.apply(this,[r])}}),esri.layers.WebTiledLayer.extend({getTileUrl:function(r,n,t){var a=e._hooked_WebTiledLayer_getTileUrl.apply(this,[r,n,t]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(a)||a:a},_tileLoadHandler:function(r){e._webTiledLayer__tileLoadHandler.apply(this,[r])}}),esri.layers.ArcGISTiledMapServiceLayer.extend({getTileUrl:function(r,n,t){var a=e._hooked_esri_getTileUrl.apply(this,[r,n,t]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(a)||a:a}}),esri.layers.WMSLayer.extend({getImageUrl:function(r,n,t,a){if(!e.app.offlineManager.isOfflineMapActive.get())return n&&t||e.errorReporter("Invalid dimensions on requested map image. This is usually due to an invalid map resize event."),void e._hooked_ogc_getImageUrl.apply(this,arguments);e._hooked_ogc_getImageUrl.apply(this,[r,n,t,function(r){var n=e.urlRewriter(r)||r;a&&a(n)}])}}),esri.layers.ArcGISDynamicMapServiceLayer.extend({getImageUrl:function(r,n,t,a){if(!e.app.offlineManager.isOfflineMapActive.get())return n&&t||e.errorReporter("Invalid dimensions on requested map image. This is usually due to an invalid map resize event."),void e._hooked_esri_getImageUrl.apply(this,arguments);e._hooked_esri_getImageUrl.apply(this,[r,n,t,function(r){var n=e.urlRewriter(r)||r;a&&a(n)}])}})},e}();r.EsriLayerHacker=n})},"geocortex/infrastructure/offline/bundle/EsriRequestHacker":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,r){this.app=e,this.requestHandler=r,this._isEnabled=!0,this._setupEsriRequestHooks()}return e.prototype.unhackedRequest=function(e,r){return this._hooked_esri_request.call(esri,e,r)},e.prototype.disable=function(){this._isEnabled=!1},e.prototype.enable=function(){this._isEnabled=!0},e.prototype._setupEsriRequestHooks=function(){var e=this;if(esri.request){this._hooked_esri_request=esri.request,esri.request=function(r,n){return e.app.offlineManager.getActiveOfflineMap()&&e._isEnabled?e.requestHandler(r,n):e._hooked_esri_request.call(esri,r,n)};var r=null;esri.request.setRequestPreCallback=function(e){r=e},this._hooked_esri_request.setRequestPreCallback(function(n){return e.app.nativeManager.isNative()&&/^https:\/\/(localhost|127\.0\.0\.1)(:\d+)?\//.test(n.url)&&(n.url="http"+n.url.substring(5)),r&&(n=r(n)),n})}else this.app.trace.error("Offline module could not hook into ESRI API.")},e}();r.EsriRequestHacker=n})},"geocortex/infrastructure/offline/bundle/OfflineRouter":function(){define(["require","exports","geocortex/framework/observables","./RequestContext","./../../CancellationTokenSource"],function(e,r,n,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){var r=this;this.app=e,this.isReady=new n.Observable(!1),this._handlers={},this._rules=[],this.app.command("RewriteUrlForOffline").register(this,function(e,n){n(r.rewriteUrl(e))})}return e.prototype.addHandler=function(e){this._handlers[e.name]=e},e.prototype.removeHandler=function(e){return!!this._handlers.hasOwnProperty(e)&&(delete this._handlers[e],!0)},e.prototype.setDefaultHandler=function(e){this._defaultHandler=e},e.prototype.setRoutingRules=function(e){this._rules=e.concat(),this.isReady.set(!0)},e.prototype.setRoutingRulesFromPromise=function(e){var r=this;this._rules.length=0,this.isReady.set(!1),e.then(function(e){if(e)try{r.setRoutingRules(JSON.parse(e))}catch(e){r.app.trace.error("Unable to parse routing rules: {0}".format(e))}else r.app.trace.debug("No offline request routing table was found.")},function(e){r.app.trace.warning("An error occurred while attempting to fetch offline request routing rules: {0}".format(e))})},e.prototype.clearRoutingRules=function(){this._rules.length=0,this.isReady.set(!1)},e.prototype.rewriteUrl=function(e){var r=this._handlers.Rewrite;if(!r)return e;e=this._stripOutProxy(e);for(var n=0;n<this._rules.length;++n){var t=this._rules[n];if("Rewrite"===t.handlerName){var a=new RegExp(t.pattern).exec(e);if(a&&a.length&&a.length>0)return r.rewriteRequest(null,t,a)}}return null},e.prototype.handle=function(e,r){var n=this,i=new a.CancellationTokenSource,o=new dojo.Deferred(function(e){i.cancel()});return this._whenReady(function(){for(var a=new t.RequestContext(e,o,r),s=n._stripOutProxy(a.url),l=!1,u=0;u<n._rules.length;++u){var f=n._rules[u],c=new RegExp(f.pattern).exec(s),p=!0;if(c&&f.queryParameterPatterns)for(var d in f.queryParameterPatterns){var g=f.queryParameterPatterns[d],h=e.content?e.content[d]:null,v=new RegExp(g.pattern).exec(h);p=p&&!!v}if(c&&c.length&&c.length>0&&p){var m=n._handlers[f.handlerName];if(m){l=!0;try{if(!1===m.handle(a,f,c,i.token())){l=!1;continue}break}catch(r){n.app.trace.warning("Offline request failed for resource '"+e.url+"'. "+r),o.errback(new Error("Offline request failed"));break}}else n.app.trace.warning("Offline request failed for resource '"+e.url+"'. Matching rule found without handler.")}}l||n._defaultHandler.handle(a,null,null,i.token())}),o.then(function(){return i.dispose()},function(){return i.dispose()}),o},e.prototype._whenReady=function(e){this.isReady.get()?e():this.isReady.once(this,e)},e.prototype._stripOutProxy=function(e){if(!e)return null;var r=this.app.configuration.proxyUri;return e.indexOf(r)>=0?e.replace?e.replace(r,""):null:e},e}();r.OfflineRouter=i})},"geocortex/infrastructure/offline/bundle/RequestContext":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(e,r,n){this.options=null,this.content=null,this.handleAs=null,this.timeOut=null,this.url=null,e&&dojo.mixin(this,e),this.dfd=r||new dojo.Deferred,this.options=n||null}}();r.RequestContext=n})},"geocortex/infrastructure/offline/bundle/RoutingRule":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/offline/bundle/RoutingRulesBuilder":function(){define(["require","exports","./BundleBuilder","geocortex/essentials/MapServiceConstants","geocortex/essentials/FeatureLayerService","./WorkflowExtractor"],function(e,r,n,t,a,i){"use strict";function o(e){return[{handlerName:"Rewrite",pattern:e,parameters:{newUrl:"Resources/Images/blank-tile.png"}}]}function s(e,r,n){var t=[];return t.push({handlerName:"ServeResource",pattern:e+"REST/v1/Imagery/Metadata/"+r.bingProperties.mapStyle,parameters:{key:e}}),t.push({handlerName:"Rewrite",pattern:"https?://[^/]*tiles.virtualearth.net/tiles",parameters:{newUrl:"Resources/Images/blank-tile.png"}}),t}function l(e,r,n){var t=[],a=-1!==r.serviceLayer.url.indexOf("?")?r.serviceLayer.url.substr(0,r.serviceLayer.url.indexOf("?")):r.serviceLayer.url;a=a.toLowerCase();var i=n.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(r){return e.featureServiceUrl.toLowerCase()===a})[0]})[0];return i?t.push({handlerName:"Rewrite",pattern:e+"/+(?!tile|identify)(.+)",parameters:{newUrl:i.localServerUrl.replace("FeatureServer","MapServer")+"/{1}"}}):(t=t.concat(g(e))).push({handlerName:"Rewrite",pattern:e+"/+([^/]*/+)?export",parameters:{newUrl:"Resources/Images/blank-tile.png"}}),t}function u(e){return e=decodeURI(e).replace(/%24/g,"$"),[{handlerName:"Rewrite",pattern:e.replace(/\$?{subDomain}/gi,"(?:.*)").replace(/\$?{level}/gi,"[0-9]*").replace(/\$?{row}/gi,"[0-9]*").replace(/\$?{col}/gi,"[0-9]*"),parameters:{newUrl:"Resources/Images/blank-tile.png"}}]}function f(e,r,t){var i=[],o=c(r.serviceUrl).layerId,s=c(r.serviceUrl).serviceUrl,e=e.split("\\?")[0],l=/^(.*)(\/\+?[0-9]+\/?\+?)$/.exec(e)[1];i.push({handlerName:"ServeResource",pattern:l+"/*$",parameters:{key:l}});var u=-1!==r.serviceLayer.url.indexOf("?")?r.serviceLayer.url.substr(0,r.serviceLayer.url.indexOf("?")):r.serviceLayer.url;u=u.toLowerCase();var f,d=t.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(r){return(e.featureServiceUrl+"/"+r.id).toLowerCase()===u})[0]})[0];if(!d&&r.serviceUrl.indexOf("/rest/services/x/")>0&&r.serviceTag)for(var g=0,v=r.essentialsMap.mapServices.filter(function(e){return e instanceof a.FeatureLayerService}).filter(function(e){return e.serviceTag===r.serviceTag});g<v.length;g++){for(var m=v[g],y=0,_=m.serviceLayer.relationships;y<_.length&&!(_[y].relatedTableId===o&&(f=c(m.serviceUrl).serviceUrl+"/"+o,d=t.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(r){return(e.featureServiceUrl+"/"+r.id).toLowerCase()===f.toLowerCase()})[0]})[0]));y++);if(d)break}if(d){if(i.push({handlerName:"Rewrite",pattern:e+"/+(.+)",parameters:{newUrl:d.localServerUrl+"/"+o+"/{1}"}}),f){var M=n.urlToPattern(n.cleanUpRestUrl(t,f));i.push({handlerName:"Rewrite",pattern:M+"/+(.+)",parameters:{newUrl:d.localServerUrl+"/"+o+"/{1}"}})}}else i=i.concat(h(l,o));r.layers[0];var S=(r.serviceLayer.relationships||[]).map(function(e){return p(l,s,d?d.localServerUrl:null,e,t)});return i=i.concat.apply(i,S)}function c(e){e=e.split("?")[0];var r=/^(.*)\/([0-9]+\/?)$/.exec(e);return{serviceUrl:r[1],layerId:parseInt(r[2])}}function p(e,r,n,t,a){var i=[{handlerName:"ServeResource",pattern:e+"/+"+t.relatedTableId+"/*$",parameters:{key:e+"/+"+t.relatedTableId}}];return n&&a.featureLayerSyncInfo.servers.filter(function(e){return e.featureServiceUrl===r}).some(function(e){return e.layers&&e.layers.some(function(e){return e.id===t.relatedTableId})})?i.push({handlerName:"Rewrite",pattern:e+"/+"+t.relatedTableId+"/+(.+)",parameters:{newUrl:n+"/"+t.relatedTableId+"/{1}"}}):i=i.concat(h(e,t.relatedTableId)),i}function d(e,r,n){var t=n.basemaps.filter(function(e){return e.url===r.url||e.url===r.serviceUrl})[0];if(t){var a=v(e);return[{handlerName:"Rewrite",pattern:e+"/+tile/+([0-9]*)/+([0-9]*)/+([0-9]*)",parameters:{newUrl:"{localserver}/"+t.localServicePath+"/{{{0}}}/{{{1}}}/{{{2}}}".format(a+1,a+2,a+3)}}].concat(g(e))}return o(e+"/+(tile|tilemap)").concat(g(e))}function g(e){return[{handlerName:"ServeResource",pattern:e+"/+([^/]*/+)?(query|queryRelatedRecords|identify|find)",parameters:{key:"__no_features"}}]}function h(e,r){return[{handlerName:"ServeResource",pattern:e+"/+"+r+"/+(query|queryRelatedRecords|applyEdits)",parameters:{key:"__no_features"}}]}function v(e){var r;if(e instanceof RegExp){var n=e.toString();n=n.substring(1,n.length-2),r=new RegExp(n+"|")}else r=new RegExp(e.toString()+"|");return r.exec("").length-1}Object.defineProperty(r,"__esModule",{value:!0}),r.buildRoutingRules=function(e){var r=[{handlerName:"Rewrite",pattern:"/arcgis/+rest/+services/+Utilities/+Geometry/+GeometryServer/+(.*)",parameters:{newUrl:"{localserver}/GeometryServer/{1}"}},{handlerName:"ServeResource",pattern:"/map/+layerlist$",parameters:{key:"__layerlist_"}},{handlerName:"ServeResource",pattern:"/search$",parameters:{key:"__no_search_results"}},{handlerName:"Site",pattern:n.urlToPattern(e.app.site.originalUrl)+"/*$",parameters:{key:"__site_"}}],c=[],p=e.app.site.essentialsMap.mapServices;return e.app.site.overviewMap&&(p=p.concat(e.app.site.overviewMap.mapServices)),p.forEach(function(i){if(-1===c.indexOf(i.url)){c.push(i.url);var p=i.serviceLayer&&i.serviceLayer.attributionDataUrl||i.attributionDataUrl;p&&r.push({handlerName:"ServeResource",pattern:n.urlToPattern(p),parameters:{key:"__empty_attribution_response"}});var h=n.urlToPattern(n.cleanUpMapServiceUrl(e,i));i.mapServiceType!==t.MapServiceType.WMS?(i.mapServiceType===t.MapServiceType.BING&&(r=r.concat(s(h,i))),i.mapServiceType!==t.MapServiceType.WMTS&&i.mapServiceType!==t.MapServiceType.WEBTILED?(r=i instanceof a.FeatureLayerService?r.concat(f(h,i,e)):r.concat(l(h,i,e)),i.mapServiceType===t.MapServiceType.TILED&&(r=r.concat(d(h,i,e))),i.mapServiceFunction===t.MapServiceFunction.BASE||i instanceof a.FeatureLayerService||(r=r.concat(g(h))),h=h.split("?")[0],r.push({handlerName:"ServeResource",pattern:h+"/*$",parameters:{key:h}})):r=r.concat(u(h))):r=r.concat(o(h))}}),r.push({handlerName:"ServeResource",pattern:"/+map/+mapservices/+[0-9]+/+layers/+[0-9]+/+datalinks/+[^/]+/+link$",parameters:{key:"__no_data_links"}}),i.WorkflowExtractor.getWorkflowEntries(e.app).forEach(function(e){var t=n.urlToPattern(e).split("\\?")[0];r.push({handlerName:"ServeResource",pattern:t,parameters:{key:t}})}),r}})},"geocortex/infrastructure/offline/bundle/WorkflowExtractor":function(){define(["require","exports","../../ObjectTraverser","../../gis/MapInfo","geocortex/framework/application/Application","geocortex/framework/utils/ArrayUtils","../../commands.meta"],function(e,r,n,t,a,i,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function r(){}return r.getWorkflowEntries=function(e){var r=this,n=this._getWorkflowEntriesForModel(e.configModel);return n=n.concat(this._getWorkflowEntriesForSite(e.site)),n=i.distinct(n).map(function(e){return r._toDownloadableUrl(e)})},r._getWorkflowEntriesForSite=function(e){var r=this,n=t.MapInfo.fromEssentialsMap(e.essentialsMap).getLayerInfos().map(function(e){return e.gcxLayer});return i.flatten(n.map(function(e){return r._extractFromMarkup(e.featureDescription)})).concat(i.flatten(n.map(function(e){return r._extractFromMarkup(e.featureLongDescription)}))).filter(function(e){return e})},r._getWorkflowEntriesForModel=function(e){var r=this,t=[];return n.ObjectTraverser.visit(e,function(e,n){if("string"==typeof e)if("RunWorkflowByUrl"===e||"RunWorkflowByUrlAndInputs"===e){if(n.parent&&n.parent.commandParameter){var i=n.parent.commandParameter,o=i.url||i;"string"==typeof o&&t.push(o)}}else for(var s=0,l=r._extractFromMarkup(e);s<l.length;s++){var u=l[s];t.push(u)}if(e instanceof a.Application)return!1}),t},r._extractFromMarkup=function(e){var r=[];if(!e)return r;e&&e.search(/command%3A/i)>=0&&(e=unescape(e));for(var n,t=/href\s*=\s*"\s*command:(RunWorkflowByUrl|RunWorkflowByUrlAndInputs)\?([^"]*)"/gi;n=t.exec(e);){var a=n[1],i=n[2];i=this.decodeHtmlQuotes(i),i=this.decodeHtmlAmpersands(i);var o=this._parseCommandArgument(a,i);if(o){var s=o.url||o;s&&"string"==typeof s&&r.push(s)}}return r},r.decodeHtmlQuotes=function(e){return e=e.replace(/&quot;/g,'"'),e=e.replace(/&39;/g,"'")},r.decodeHtmlAmpersands=function(e){return e=e.replace(/&amp;/g,"&")},r._parseCommandArgument=function(e,r){var n=o.Commands.metadataForCommandName(e);if(null===n)return null;if("string"==n.arguments)return r;if("object"!=n.arguments)return null;try{var t=JSON.parse(r);return t}catch(e){return t=dojo.queryToObject(r)}},r._toDownloadableUrl=function(r){var n=/^(.*?)\/home\/item.html\?id=(.*?)(\#.*)?$/,t=/^require:(.*)@(.*)$/,a=/^resolve:(.*)$/,i=r.match(t);if(void 0!==i&&null!==i){var o=i[1];i[2];return r=e.toUrl(o)}return void 0!==(i=r.match(a))&&null!==i?r=e.toUrl(i[1]):void 0!==(i=r.match(n))&&null!==i?r=i[1]+"/sharing/rest/content/items/"+i[2]+"/data?f=json":r},r}();r.WorkflowExtractor=s})},"geocortex/infrastructure/offline/bundle/offlineHandlers/FailHandler":function(){define(["require","exports","./OfflineHandler"],function(e,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(){this.name="Fail"}return e.prototype.handle=function(e,r,t,a){return e.dfd.reject(),n.hookDeferredCallbacks(e),!0},e}();r.FailHandler=t})},"geocortex/infrastructure/offline/bundle/offlineHandlers/OfflineHandler":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.hookDeferredCallbacks=function(e){var r=e.dfd,n=e.load;n&&r.addCallback(function(e){var t=r._pendingDfd,a=t&&t.ioArgs,i=a&&a.args;return n.call(i,e,a)});var t=e.error;t&&r.addErrback(function(e){var n=r._pendingDfd,a=n&&n.ioArgs,i=a&&a.args;return t.call(i,e,a)})}})},"geocortex/infrastructure/offline/bundle/offlineHandlers/PassthroughHandler":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,r){this.app=e,this.unhackedRequesthandler=r,this.name="Passthrough"}return e.prototype.handle=function(e,r,n,t){return this.unhackedRequesthandler(e,e.options).then(function(r){return e.dfd.resolve(r)},function(r){return e.dfd.errback(r)}),!0},e}();r.PassthroughHandler=n})},"geocortex/infrastructure/offline/bundle/offlineHandlers/RewriteHandler":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function r(e,r){this.app=e,this.unhackedRequesthandler=r,this.name="Rewrite"}return r.prototype.handle=function(r,n,t,a){r.url=this.rewriteRequest(r,n,t),!e.has("esri-cors")&&Modernizr.cors&&(delete e.has.cache["esri-cors"],e.has.add("esri-cors",function(){return!0}));var i=null;return a.register(function(){i&&i.cancel("Pass through from ESRI cancellation.")}),i=this.unhackedRequesthandler(r,r.options).then(function(e){return r.dfd.resolve(e)},function(e){return r.dfd.errback(e)}),!0},r.prototype.rewriteRequest=function(e,r,n){if(!r||!r.parameters||!r.parameters.newUrl)throw new Error("Not a rewrite rule.");var t=r.parameters.newUrl;return t=t.format.apply(t,n),t=t.replace("{localserver}",this.app.localServerAddress),this.app.localServerAddress&&this.app.localServerAddress.length>0&&t.startsWith(this.app.localServerAddress)&&(t=this._appendLocalServerToken(t)),t},r.prototype._appendLocalServerToken=function(e){return this.app.localServerToken&&(e.endsWith("?")||(e+=e.indexOf("?")>0?"&":"?"),e+="localServerToken="+this.app.localServerToken),e},r}();r.RewriteHandler=n})},"geocortex/infrastructure/offline/bundle/offlineHandlers/ServeResourceHandler":function(){define(["require","exports","./OfflineHandler","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,r,n,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,r,n,a){this.app=e,this.resourceGetter=r,this.resourceSetter=n,this.resourceRemover=a,this.name="ServeResource",this.isReady=new t.Observable(!1)}return e.prototype.handle=function(e,r,t,a){var i=this;if(!this._bundle||!r.parameters||!r.parameters.key)return!1;var o=r.parameters.key;o=o.format.apply(o,t);for(var s=0,l=this._bundle.resources.length;s<l;s++)if(this._bundle.resources[s].key===o)return n.hookDeferredCallbacks(e),this._getResourceValue(this._bundle.resources[s]).then(function(r){e.dfd.resolve(r)}).catch(function(r){i.app.trace.error(r.message),e.dfd.reject(r.message)}),!0;return!1},e.prototype.loadBundle=function(e){this.isReady.set(!0),this._bundle=e},e.prototype.clear=function(){this.isReady.set(!1),this._bundle=null},e.prototype.stripAndStoreBundle=function(r){var n=this;if(!r)return Promise.reject(new Error("Bundle cannot be null."));var t=r.resources.map(function(t){return null==t.value?Promise.reject(new Error("Bundle resoure entry value is already null: "+t.key)):t.value&&t.value.length>e._resourceCachingLength?n.resourceSetter(e.getResourceStorageKey(r.id,t.key),t.value).then(function(){t.value=null},function(e){n.app.trace.error("Unable to strip '"+t.key+"' out of the bundle and store it separately. "+e)}):null});return Promise.all(t).then(function(){return r})},e.prototype.unstoreBundle=function(r){var n=this;if(!r)return Promise.reject(new Error("Bundle cannot be null."));var t=r.resources.map(function(t){return null==t.value?n.resourceRemover(e.getResourceStorageKey(r.id,t.key)):null});return Promise.all(t).then(function(){return r})},e.prototype.updateEntry=function(r,n){return this.resourceSetter(e.getResourceStorageKey(r,n.key),n.value)},e.prototype.getResourceValue=function(e){for(var r=0,n=this._bundle.resources.length;r<n;r++)if(this._bundle.resources[r].key===e)return this._getResourceValue(this._bundle.resources[r]);return Promise.reject(new Error("No such entry found."))},e.prototype._getResourceValue=function(r){var n=this;return Promise.resolve(r.value).then(function(t){return null==t?n.resourceGetter(e.getResourceStorageKey(n._bundle.id,r.key)):t}).then(function(e){if(!e)throw new Error("Resource entry missing for: "+r.key);return e}).then(function(e){return!0===r.isEncoded&&(e=a.base64Decode(e)),!0===r.isJson&&(e=JSON.parse(e)),e})},e.getResourceStorageKey=function(e,r){return e+"-"+r},e}();i._resourceCachingLength=200,r.ServeResourceHandler=i})},"geocortex/infrastructure/offline/bundle/offlineHandlers/SiteHandler":function(){define(["require","exports","./OfflineHandler","./../RequestContext"],function(e,r,n,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,r,n,t){this.app=e,this.siteJsonGetter=r,this.siteJsonSetter=n,this.unhackedRequesthandler=t,this.name="Site"}return e.prototype.handle=function(e,r,t,a){var i=this;return n.hookDeferredCallbacks(e),this.siteJsonGetter(r.parameters.key).then(function(n){return n.__loadedOffline=!0,i._hasToken(e)?i._getOnlineSitePrincipal(e).then(function(e){return n.principal=e,i.siteJsonSetter(r.parameters.key,JSON.stringify(n)).then(function(){return n})}).catch(function(e){return i._getGmafPrincipal(n.principal).then(function(e){return n.principal=e,n}).catch(function(e){return n})}):n}).then(function(r){e.dfd.resolve(r)}).catch(function(r){e.dfd.errback(r)}),!0},e.prototype._hasToken=function(e){return/[?&]token=/.test(e.url)||e.content&&e.content.token},e.prototype._getOnlineSitePrincipal=function(e){var r=this,n=new t.RequestContext({callbackParamName:e.callbackParamName,content:e.content,form:e.form,handleAs:e.handleAs,timeOut:1e4,url:e.url},null,e.options);return new Promise(function(e,t){return r.unhackedRequesthandler(n,n.options).then(e,t)}).then(function(e){if(!e||e.error||!e.principal)throw new Error("Site JSON looks malformed.");return e.principal})},e.prototype._getGmafPrincipal=function(e){return this.app.nativeManager.nativeInitialized?this.app.nativeManager.xhrGet({url:this.app.localServerAddress+"/account/userinfo",handleAs:"json"}).then(function(r){if(!r||!r.token)throw new Error("GMAF has no login info.");return dojo.mixin(e,{isAuthenticated:!0,label:r.userName,expiry:(new Date).toISOString(),tokens:{site:r.token}})}):Promise.reject(new Error("Not a native app."))},e}();r.SiteHandler=a})}}});require({cache:{"geocortex/infrastructure/PortalUtils":function(){define(["require","exports","./SecurityUtils"],function(t,e,r){"use strict";function n(t){return r.getIdentity("ags-oauth2",t)}function i(t){var e=n(t);if(!e)return null;var i=r.getClaimsByType(e,"http://www.geocortex.com/security/ags/portal")[0];return i?i.value:null}Object.defineProperty(e,"__esModule",{value:!0}),e.getPortalIdentity=n,e.hasAccessToPortal=function(t){return!!n(t)},e.hasCreateContentPrivilege=function(t){var e=n(t);return!!e&&r.hasPrivilegeClaim(e,"portal:user:createItem")},e.hasPublishFeaturePrivilege=function(t){var e=n(t);return!!e&&r.hasPrivilegeClaim(e,"portal:publisher:publishFeatures")},e.getPortalBaseUrl=i,e.getPortalMyContentUrl=function(t){var e=i(t);if(!e)return null;var r=t.configuration.portalContentRelUrl||"home/content.html";return String.format("{0}{1}",e,r)},e.getPortalItemUrl=function(t,e){var r=i(e);if(!r)return null;var n=e.configuration.portalItemRelUrl||"home/item.html?id=";return String.format("{0}{1}{2}",r,n,t)}})}}});require({cache:{"geocortex/infrastructure/PresentableDelegateFactory":function(){define(["require","exports","geocortex/essentials/Field","./gis/FieldInfo","./DateFormat","./FormatUtils","./NumberFormat","geocortex/framework/utils/utils"],function(e,t,r,a,n,u,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.typeIdForLayerAndAttributes=function(e,t){return e.typeIdField?t[e.typeIdField]:null},e.typeFromLayerAndId=function(e,t){for(var r=0;r<e.types.length;r++)if(e.types[r].id==t)return e.types[r];return null},e.makeValueTruthy=function(e){return 0===e?"0":!1===e?"false":e},e.valuePresenterDelegate=function(t,l){var f,m;return"string"==typeof t?(m=t,l&&l.layer&&(f=l.layer.fields.filter(function(e){return e.name===m})[0])):t instanceof r.Field?m=(f=t).name:t&&t.name&&(m=t.name),function(r){return function(){var s,d=l?l.featureLayer:null,F=l?l.getType():null,c=d?d.getField(m):null;if(t instanceof a.FieldInfo&&(s=t),!(c||f||s)){if(r instanceof Date){var y=l?l.defaultDateFormat:n.DateFormat.DEFAULT;return u.formatDate(r,y)}if("number"==typeof r){var b=l?l.defaultNumberFormat:i.NumberFormat.DEFAULT;return u.formatNumber(r,b)}return e.makeValueTruthy(r)}if(f&&f.hyperlinkLabel&&o.isUrl(r)&&(r=f.hyperlinkLabel),l){var p=l.esriFeature.get();if(p&&p.attributes.hasOwnProperty(m+".Name()"))return e.makeValueTruthy(p.attributes[m+".Name()"])}return s||(s=c?a.FieldInfo.fromEsriField(c,d,f):a.FieldInfo.fromGcxField(f)),s.isDate()&&!s.format&&l&&l.defaultDateFormat?s.format="{0:"+l.defaultDateFormat+"}":s.isNumeric()&&!s.format&&l&&l.defaultNumberFormat&&(s.format="{0:"+l.defaultNumberFormat+"}"),s.formatValue(r,F?F.id.toString():null)}}},e}();t.PresentableDelegateFactory=l})}}});require({cache:{"geocortex/infrastructure/project/BaseMapLayer":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/CoordinateSystem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/DrawingInfo":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/Feature":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/FeatureCollection":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/FeatureSet":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/FeatureSetCollection":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/Layer":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/LayerDefinition":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/ModuleState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/OperationalLayer":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/Project":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/project/ProjectConverter":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","./../webMap/WebMapConverter","geocortex/essentials/Layer","./../FeatureSetCollection","./../FeatureSet","./../Feature","./../LayerIntegrationUtils","geocortex/essentials/LayerStyle","./../PromiseUtils","./../KmlFeature","./../DateFormat","./../NumberFormat","geocortex/framework/utils/ArrayUtils","./../TaskUtils","./../coordinates/CoordinatesManager","geocortex/framework/utils/utils","./../webMap/BaseMapLayer","./../ArrayUtils","geocortex/essentials/utilities/ServiceDiscoveryUtilities","./../webMap/WebMapConverter","./../webMap/Renderer","./../FormatUtils"],function(t,r,i,n,o,a,s,u,c,l,p,f,d,y,m,h,g,b,_,v,P,S,x){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PROPERTY_MEASUREMENT_ID="measurementId",r.PROPERTY_HIGHLIGHT_ID="__gcxHlId";var w=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._exclusionCache={},e}return e(i,t),i.prototype.exclude=function(e,t){var r=this._exclusionCache[t];r||(r=this._exclusionCache[t]=[]),r.push(e)},i.prototype.clearExclusionCache=function(){this._exclusionCache={}},i.prototype.clearCache=function(){t.prototype.clearCache.call(this),this.clearExclusionCache()},i.prototype.fromGcxMapService=function(e){return t.prototype.fromGcxMapService.call(this,e)},i.prototype.fromGcxLayer=function(e){return t.prototype.fromGcxLayer.call(this,e)},i.prototype.fromGcxFeatureSetCollection=function(e){return this._convert(e,"projectFeatureSetCollection",this._fromGcxFeatureSetCollection)},i.prototype.fromGcxFeatureSet=function(e){return t.prototype.fromGcxFeatureSet.call(this,e)},i.prototype.fromEsriFeatureSet=function(e){return t.prototype.fromEsriFeatureSet.call(this,e)},i.prototype.fromEsriLayer=function(e){return t.prototype.fromEsriLayer.call(this,e)},i.prototype.fromGcxFeature=function(e){return t.prototype.fromGcxFeature.call(this,e)},i.prototype.fromEsriGraphic=function(e){return t.prototype.fromEsriGraphic.call(this,e)},i.prototype.toGcxFeatureSetCollection=function(e){return Promise.resolve(this._convert(e,"gcxFeatureSetCollection",this._toGcxFeatureSetCollection))},i.prototype._canCreateGcxLayer=function(e,t){return!!e.gcxLayerDefinition},i.prototype._canCreateGcxMapService=function(e){return!!e.gcxMapServiceDefinition},i.prototype._createGcxMapService=function(e){var r=this;return Promise.try(function(){if(t.prototype._canCreateGcxMapService.call(r,e))return t.prototype._createGcxMapService.call(r,e);var i=r._getMapServiceDefinition(e);if(i){var n=e;return i.layers=n.layers.map(function(e){return e.gcxLayerDefinition}).filter(function(e){return null!=e}),v.ServiceDiscoveryUtilities.buildMapService(r.app.site.essentialsMap,i).then(function(e){return r.app.site.essentialsMap.addMapService(e),e})}return Promise.reject(new Error("ProjectConverter._createGcxMapService: Unsupported service layer type."))}).then(function(t){if(t instanceof u.LocalFeatureLayerService){var r=e;r.layers&&r.layers[0]&&r.layers[0].gcxLayerDefinition&&t.layers[0].createFromDefinition(r.layers[0].gcxLayerDefinition)}return t})},i.prototype._createGcxLayer=function(e,t){var r=this,i=e.gcxLayerDefinition;if(i&&i.catalogId)return new Promise(function(e,n){var o={catalogId:i.catalogId,callback:function(t){t&&e(t),n(new Error("ProjectConverter._createGcxLayer: Unsupported layer catalog id."))},gcxLayerDefinition:i,mapService:t};r.app.waitUntilAllLibrariesLoaded().then(function(){r.app.command("RestoreDynamicLayer").execute(o)})});var o=new n.Layer(i.url);return o.createFromDefinition(i),t.add(o),o.isUserCreated=!0,Promise.resolve(o)},i.prototype._getMapServiceDefinition=function(e){return e.gcxMapServiceDefinition},i.prototype._getWebMapLayerDefinitionFromDynamicLayer=function(e,r){var i=t.prototype._getWebMapLayerDefinitionFromDynamicLayer.call(this,e,r);return e.layerDrawingOptions&&e.layerDrawingOptions[r]&&(i.drawingInfo.showLabels=e.layerDrawingOptions[r].showLabels,i.drawingInfo.labelingInfo=e.layerDrawingOptions[r].labelingInfo),i},i.prototype._applyDynamicLayerInfo=function(e,t,r){var i=r.mapService.serviceLayer,n=parseInt(r.id);r.mapService.convertToDynamicLayers();var o=i.dynamicLayerInfos||[],a=o.filter(function(e){return e.id===n})[0];if(a){var s=o.indexOf(a);s!=t&&o.splice(t,0,o.splice(s,1)[0])}else(a=new esri.layers.DynamicLayerInfo).id=n,a.name=e.name,e.layerDefinition&&(a.minScale=e.layerDefinition.minScale,a.maxScale=e.layerDefinition.maxScale),o.splice(t,0,a);i.setDynamicLayerInfos(o)},i.prototype._applyDrawingInfo=function(e,r){var i=this;return e?t.prototype._applyDrawingInfo.call(this,e,r).then(function(){var t=e.clustering&&(e.clustering.enabled||void 0===e.clustering.enabled);if(i.app.command("RemoveClusterLayer").execute({gcxLayer:r.layers[0]}),r.featureClustering&&r.featureClustering.userCanToggle&&e.clustering&&(r.featureClustering.radius=e.clustering.radius,r.featureClustering.backgroundColor=e.clustering.backgroundColor,r.featureClustering.labelColor=e.clustering.labelColor,r.featureClustering.maximumFeatures=e.clustering.maximumFeatures),t)i.app.command("AddClusterLayer").execute({gcxLayer:r.layers[0]});else if(!(r.heatMap&&r.heatMap.userCanToggle&&e.renderer&&e.renderer.type===S.RendererType.HEATMAP)){var n=r.serviceLayer;n.setRenderer(i.toEsriRenderer(e.renderer)),n.redraw()}}):Promise.resolve()},i.prototype._setGraphicsLayerRenderer=function(e,t){},i.prototype._applyWebMapLayerToGcxLayer=function(e,r,i){var n=this;return t.prototype._applyWebMapLayerToGcxLayer.call(this,e,r,i).then(function(t){for(var o=i.mapService.serviceLayer,a=e,s=0,u=i.styles;s<u.length;s++)(l=u[s]).enabled=!1;if(a.layerStyleId){var l=i.styles.filter(function(e){return e.id===a.layerStyleId})[0],p=void 0;if(o instanceof esri.layers.ArcGISDynamicMapServiceLayer)p=JSON.stringify(n.toEsriRenderer(a.layerDefinition.drawingInfo.renderer).toJson());else if(o instanceof esri.layers.FeatureLayer){var f=a.serviceLayer;p=JSON.stringify(n.toEsriRenderer(f.layerDefinition.drawingInfo.renderer).toJson())}l?(p&&l.setRenderer(p),l.enabled=!0):p&&i.styles.push(new c.LayerStyle(p,a.layerStyleId,a.layerStyleId,!0))}return a.isDynamic&&o instanceof esri.layers.ArcGISDynamicMapServiceLayer?n.app.waitUntilServiceLayerLoaded(o).then(function(){return n._applyDynamicLayerInfo(a,r,i),t}):t})},i.prototype._toGcxLayer=function(e,r){var i=e;return r||(r=i.serviceLayer),t.prototype._toGcxLayer.call(this,e,r)},i.prototype._toGcxFeatureSetCollection=function(e){var t=this,r=this.app.featureSetManager.featureSetCollections.get().filter(function(t){return t.id===e.id})[0];r||((r=new o.FeatureSetCollection).id=e.id,this.app.featureSetManager.addCollection(r)),r.displayName.set(e.displayName),r.sourceName=e.sourceName;var i='feature set collection "{0}"'.format(e.id);return l.PromiseUtils.mapSkipRejected(e.featureSets,function(e){return l.PromiseUtils.warnOnReject(t.toGcxFeatureSet(e),t.app,'Unable to restore feature set "{0}" for {1}: {{0}}'.format(e.id,i))}).then(function(e){r.clear(),r.featureSets.addItems(e)}).then(function(){return l.PromiseUtils.warnOnReject(t.toObject(e.tag),t.app,"Unable to restore tag for {0}: {{0}}".format(i))}).then(function(e){r.tag=e}).then(function(){return t._toGcxExtendedProperties(e.extendedProperties,i)}).then(function(e){r.extendedProperties.addItems(e)}).then(function(){return r})},i.prototype._toGcxFeatureSet=function(e){var t,r=this,i=e.layer,n=i?i.serviceLayer:null,o=e.features||[],s={gcxLayer:this.toGcxLayer(i,n),esriFeatureSet:this.toEsriFeatureSet(e),extendedProperties:this._toGcxExtendedProperties(e.extendedProperties,"feature set")};return Promise.props(s).then(function(n){t=new a.FeatureSet({app:r.app,layer:n.gcxLayer,esriFeatureSet:n.esriFeatureSet,allowUnsafeContent:r.app.configuration&&r.app.configuration.allowUnsafeContent&&e.allowUnsafeContent}),i||(t.loadAttributes(),t.displayName.set(e.displayName),t.iconUri.set(e.iconUri)),t.id=e.id,t.extendedProperties.addItems(n.extendedProperties)}).then(function(){return l.PromiseUtils.mapSkipRejected(o,function(e){return r._findMatchingGcxFeature(e,t).then(function(t){return r._applyFeatureToGcxFeature(e,t)})})}).then(function(){r.app.waitUntilAllLibrariesLoaded().then(function(){t.dataLinksState===a.DataLinksState.Unresolved&&t.resolveDataLinks(function(e){r.app.event("FeatureChangedEvent").publish(e)})})}).then(function(){return t})},i.prototype._toGcxFeature=function(e){var t=this;return e.featureSet?this.toGcxFeatureSet(e.featureSet).then(function(r){return t._findMatchingGcxFeature(e,r)}).then(function(t){if(!t)throw new Error('Unable to restore feature with ID "{0}": feature no longer exists.'.format(e.id));return t}):this._createGcxFeature(e)},i.prototype._createGcxFeature=function(e){var t=this,r=e.layer,i=r?r.serviceLayer:null,n={gcxLayer:this.toGcxLayer(r,i),featureLayer:r?null:this.toEsriLayer(e.featureLayer),graphic:this.toEsriGraphic(e),extendedProperties:this._toGcxExtendedProperties(e.extendedProperties,"feature")};return Promise.props(n).then(function(r){var i={layer:r.gcxLayer,featureLayer:r.featureLayer,graphic:r.graphic,allowUnsafeContent:t.app.configuration&&t.app.configuration.allowUnsafeContent&&e.allowUnsafeContent},n=e[p.isKmlProperty]?new p.KmlFeature(i):new s.Feature(i);return n.defaultDateFormat=e.defaultDateFormat||f.DateFormat.DEFAULT,n.defaultNumberFormat=e.defaultNumberFormat||d.NumberFormat.DEFAULT,n.timeZoneId=e.timeZoneId,n.displayTimeZoneId=e.displayTimeZoneId,n.borderColor.set(e.borderColor),n.fillColor.set(e.fillColor),n.borderWidth.set(e.borderWidth),n.extendedProperties.addItems(r.extendedProperties),n})},i.prototype._applyFeatureToGcxFeature=function(e,t){return e&&t?(t.defaultDateFormat=e.defaultDateFormat||f.DateFormat.DEFAULT,t.defaultNumberFormat=e.defaultNumberFormat||d.NumberFormat.DEFAULT,t.timeZoneId=e.timeZoneId,this._toGcxExtendedProperties(e.extendedProperties,"feature").then(function(e){return t.extendedProperties.addItems(e)})):Promise.resolve()},i.prototype._findMatchingGcxFeature=function(e,t){return e.id?Promise.resolve(t.findFeatureById(e.id)):this.toEsriGraphic(e).then(function(e){return y.firstOrDefault(t.features.get(),function(t){return t.esriFeature.get()===e})})},i.prototype._queryFeatures=function(e,t){var r=this;return e&&e.length&&t&&t.layer?Promise.try(function(){for(var i=e.map(function(e){return e.id}),n=[];i.length>1e3;)n.push(i.splice(0,1e3));n.push(i);var o=t.layer,a=o?o.serviceLayer:null;return r.toGcxLayer(o,a).then(function(e){if(!e||!e.getObjectIdFieldName())throw new Error('Cannot restore features for layer "{0}": no primary key field defined.'.format(e?e.name:""));e.getObjectIdFieldName();var t=m.getQueryTask(e);return l.PromiseUtils.mapSkipRejected(n,function(e){var r=new esri.tasks.Query;return r.objectIds=e.map(function(e){return x.parseNumber(e)}),r.returnGeometry=!0,r.outFields=["*"],t.execute(r).then(function(e){return e.features})},{concurrency:2}).then(function(e){return y.flatten(e)})})}):Promise.resolve([])},i.prototype._toEsriGraphic=function(e){return t.prototype._toEsriGraphic.call(this,e).then(function(t){return e.hasOwnProperty(r.PROPERTY_MEASUREMENT_ID)&&(t[r.PROPERTY_MEASUREMENT_ID]=e[r.PROPERTY_MEASUREMENT_ID]),e.hasOwnProperty(h.coordinateIdentifierProperty)&&(t[h.coordinateIdentifierProperty]=e[h.coordinateIdentifierProperty]),e.hasOwnProperty(p.isKmlProperty)&&(t[p.isKmlProperty]=e[p.isKmlProperty]),e.hasOwnProperty(r.PROPERTY_HIGHLIGHT_ID)&&(t[r.PROPERTY_HIGHLIGHT_ID]=e[r.PROPERTY_HIGHLIGHT_ID]),t})},i.prototype._toEsriFeatureSet=function(e){var t=this,r=e.layer,i=r?r.serviceLayer:null,n=e.features||[],o=n.filter(function(e){return!g.isNullOrUndefined(e.id)}),a=n.filter(function(e){return g.isNullOrUndefined(e.id)}),s={gcxLayer:this.toGcxLayer(r,i),queryResults:this._queryFeatures(o,e),rehydratedGraphics:l.PromiseUtils.mapSkipRejected(a,function(e){return t.toEsriGraphic(e)})};return Promise.props(s).then(function(e){var t=e.queryResults.concat(e.rehydratedGraphics),r=new esri.tasks.FeatureSet;return r.features=t,r})},i.prototype._fromGcxMapService=function(e){var r=this;if((this._exclusionCache[P.ConversionType.GCX_MAP_SERVICE]||[]).indexOf(e)>=0)throw new Error("ProjectConverter.fromGcxMapService: Services added through layer addition dialog are only supported if they have been whitelisted by your administrator.");var i;e.serviceLayer;if(i=e&&e.serviceLayer instanceof esri.layers.WMTSLayer&&!e.tileRestUrl?{id:e.id,url:e.serviceUrl,type:b.BaseMapType.WEB_TILED,opacity:e.opacity,visibility:e.isVisible(),layers:[]}:t.prototype._fromGcxMapService.call(this,e),e.isUserCreated&&(i.gcxMapServiceDefinition=e.toJson(),i.isUserCreated=e.isUserCreated,i.userLayerType=e.userLayerType),i.layers||(i.layers=_.ArrayUtils.mapWithErrorCallback(e.layers,function(e){return r.fromGcxLayer(e)},function(e,t){console.warn('Unable to convert layer "{0}": {1}'.format(e.id,t))})),e.featureClustering){var n=i,o=void 0;this._isFeatureCollection(i)?(n.featureCollection.layers[0].layerDefinition=n.featureCollection.layers[0].layerDefinition||{drawingInfo:{}},o=n.featureCollection.layers[0].layerDefinition):(n.layerDefinition=n.layerDefinition||{drawingInfo:{}},o=n.layerDefinition),o.drawingInfo=o.drawingInfo||{},o.drawingInfo.clustering={radius:e.featureClustering.radius,backgroundColor:e.featureClustering.backgroundColor,labelColor:e.featureClustering.labelColor,maximumFeatures:e.featureClustering.maximumFeatures,enabled:e.featureClustering.enabled};var a=this.app.map.getLayer(e.id+"-cluster");a&&(o.drawingInfo.renderer=this.fromEsriRenderer(a.featureLayerRenderer))}return i},i.prototype._fromGcxlayer=function(e){if((this._exclusionCache[P.ConversionType.GCX_MAP_SERVICE]||[]).indexOf(e.mapService)>=0)throw new Error("ProjectConverter.fromGcxLayer: Services added through layer addition dialog are only supported if they have been whitelisted by your administrator.");var r=t.prototype._fromGcxlayer.call(this,e);r.serviceLayer=this.fromGcxMapService(e.mapService);var i=e.mapService.serviceLayer;r.isDynamic=e.isDynamic,i instanceof esri.layers.ArcGISDynamicMapServiceLayer&&i.supportsDynamicLayers&&(r.isDynamic=r.isDynamic||i.dynamicLayerInfos&&!!i.dynamicLayerInfos[parseInt(e.id)]),e.isUserCreated&&(r.gcxLayerDefinition=e.toJson(),r.isUserCreated=e.isUserCreated,r.userLayerType=e.userLayerType);var n=e.styles.filter(function(e){return e.enabled})[0];return n&&(r.layerStyleId=n.id),r},i.prototype._fromGcxFeatureSetCollection=function(e){var t={id:e.id,displayName:e.displayName.get(),featureSets:e.featureSets.get().map(this.fromGcxFeatureSet,this),sourceName:e.sourceName,tag:this.fromObject(e.tag)};return e.extendedProperties.getLength()&&(t.extendedProperties=this._fromGcxExtendedProperties(e.extendedProperties)),t},i.prototype._fromGcxFeatureSet=function(e){var r=t.prototype._fromGcxFeatureSet.call(this,e);return r.id=e.id,r.layer=this.fromGcxLayer(e.layer),r.allowUnsafeContent=e._allowUnsafeContent,e.layer||(r.displayName=e.displayName.get(),r.iconUri=e.iconUri.get()),r},i.prototype._fromGcxFeature=function(e){var r={};this._canRequeryFeatureData(e)?r={id:e.id.get(),featureSet:this.fromGcxFeatureSet(e.featureSet)}:(r=t.prototype._fromGcxFeature.call(this,e)).featureSet=this.fromGcxFeatureSet(e.featureSet),r.featureSet||(r.layer=this.fromGcxLayer(e.layer)),e.featureLayer&&!e.layer&&(r.featureLayer=this.fromEsriLayer(e.featureLayer)),r.allowUnsafeContent=e._allowUnsafeContent,e.borderColor.get()&&(r.borderColor=e.borderColor.get()),e.fillColor.get()&&(r.fillColor=e.fillColor.get()),e.borderWidth.get()>=0&&(r.borderWidth=e.borderWidth.get()),e.extendedProperties.getLength()&&(r.extendedProperties=this._fromGcxExtendedProperties(e.extendedProperties)),e.defaultDateFormat!==f.DateFormat.DEFAULT&&(r.defaultDateFormat=e.defaultDateFormat),e.defaultNumberFormat!==d.NumberFormat.DEFAULT&&(r.defaultNumberFormat=e.defaultNumberFormat);var i=e.esriFeature.get();return i&&i.hasOwnProperty(p.isKmlProperty)&&(r[p.isKmlProperty]=i[p.isKmlProperty]),e.timeZoneId&&(r.timeZoneId=e.timeZoneId),e.displayTimeZoneId&&r.displayTimeZoneId,r},i.prototype._fromEsriGraphic=function(e){var i=t.prototype._fromEsriGraphic.call(this,e);return e.hasOwnProperty(r.PROPERTY_MEASUREMENT_ID)&&(i[r.PROPERTY_MEASUREMENT_ID]=e[r.PROPERTY_MEASUREMENT_ID]),e.hasOwnProperty(h.coordinateIdentifierProperty)&&(i[h.coordinateIdentifierProperty]=e[h.coordinateIdentifierProperty]),e.hasOwnProperty(p.isKmlProperty)&&(i[p.isKmlProperty]=e[p.isKmlProperty]),e.hasOwnProperty(r.PROPERTY_HIGHLIGHT_ID)&&(i[r.PROPERTY_HIGHLIGHT_ID]=e[r.PROPERTY_HIGHLIGHT_ID]),i},i.prototype._toGcxExtendedProperties=function(e,t){var r=this;return e=e||{},l.PromiseUtils.mapSkipRejected(Object.keys(e),function(i){var n=r.toObject(e[i]).then(function(e){return{name:i,value:e}});return l.PromiseUtils.warnOnReject(n,r.app,"Unable to restore extended property '{0}' for {1}: {{0}}".format(i,t))})},i.prototype._fromGcxExtendedProperties=function(e){var t=this,r={};return e.get().forEach(function(e){r[e.name]=t.fromObject(e.value)}),r},i.prototype._canRequeryFeatureData=function(e){return e&&!e.isModified&&!g.isNullOrUndefined(e.id.get())&&""!==e.id.get()&&e.featureSet&&e.featureSet.layer&&(e.featureSet.layer.getLayerUrl()&&e.featureSet.layer.supportsQuery||!String.isNullOrEmpty(e.featureSet.layer.catalogId))},i}(i.WebMapConverter);r.ProjectConverter=w})},"geocortex/infrastructure/project/ProjectFilter":function(){define(["require","exports","./../webMap/WebMapFilter","./../validation/NumberValidator","./../validation/SiteUrlValidator","./../validation/ServiceDiscoveryUrlValidator","./../validation/XssHtmlValidator","./ProjectConverter","./../KmlFeature","./../webMap/WebMapConverter","./../webMap/OperationalLayer","geocortex/essentials/MapServiceConstants"],function(e,t,r,i,n,o,a,s,u,c,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e){var t=this;this._numberValidator=new i.NumberValidator,this._xssHtmlValidator=new a.XssHtmlValidator,this.baseMapLayer=function(e){var r=t._getUrlValidator(e);return $.extend({},t._webMapFilter.baseMapLayer,t._serviceLayerCommon,{url:r,templateUrl:r,gcxMapServiceDefinition:$.extend({},t._serviceLayerCommon.gcxMapServiceDefinition,{url:r,serviceUrl:r,tileRestUrl:r,mapUrl:r})})},this.layer=function(e){var r=t._getUrlValidator(e);return $.extend({},t._webMapFilter.layer,{serviceLayer:function(){return t.serviceLayer},layerDefinition:t.layerDefinition,featureSet:function(){return t.featureSet},isDynamic:!0,layerStyleId:!0,isUserCreated:!0,userLayerType:!0,layerUrl:r,legendUrl:r,gcxLayerDefinition:{id:!0,name:t._xssHtmlValidator,url:r,defaultVisibility:!0,visible:!0,displayName:t._xssHtmlValidator,description:!0,featureType:!0,featureZoomScale:!0,featureZoomFactor:!0,hasAttachments:!0,nativeID:!0,parentLayerId:!0,subLayerIds:!0,styleName:!0,legendUrl:r,isDynamic:!0,dynamicDefinition:!0,defaultDateFormat:!0,defaultNumberFormat:!0,timeZoneId:!0,fullExtent:!0,drawIndex:!0,identifiable:!0,includeInLayerList:!0,includeInLegend:!0,isExpanded:!0,featureBorderColor:!0,featureBorderWidth:!0,featureFillColor:!0,minScale:t._numberValidator,maxScale:t._numberValidator,queryable:!0,searchable:!0,snappable:!0,snappingEnabled:!0,showFeatureHyperlinks:!0,canToggleLabels:!0,showLabels:!0,showMapTips:!0,supportsIdentify:!0,supportsQuery:!0,type:!0,fields:!0,primaryKeyField:!0,displayField:!0,catalogId:t.object,isUserCreated:!0,userLayerType:!0,featureDescription:!1,featureLongDescription:!1,featureLabel:!1,featureHyperlinks:!1,layerHyperlinks:!1,relationships:!1,dataLinks:!1,reports:!1,charts:!1}})},this.operationalLayer=function(e){var r=t._getUrlValidator(e);return $.extend({},t._webMapFilter.operationalLayer,t._serviceLayerCommon,{layers:{item:function(){return t.layer}},featureCollection:t.featureCollection,layerDefinition:t.layerDefinition,url:r,gcxMapServiceDefinition:$.extend({},t._serviceLayerCommon.gcxMapServiceDefinition,{url:r,serviceUrl:r,tileRestUrl:r,mapUrl:r})})},this.serviceLayer=function(e){return $.extend({},t.operationalLayer(e),t.baseMapLayer(e))},this.object=function(e){if(!e||"object"!=typeof e)return!0;switch(e[c.CONVERSION_TYPE_PROPERTY]){case c.ConversionType.GCX_MAP_SERVICE:case c.ConversionType.ESRI_LAYER:return function(){return t.serviceLayer};case c.ConversionType.GCX_LAYER:return function(){return t.layer};case c.ConversionType.GCX_FEATURE_SET:case c.ConversionType.ESRI_FEATURE_SET:return function(){return t.featureSet};case c.ConversionType.GCX_FEATURE:case c.ConversionType.ESRI_GRAPHIC:return function(){return t.feature};case c.ConversionType.ESRI_GEOMETRY:return t.geometry;case c.ConversionType.ESRI_SYMBOL:return t.symbol;case c.ConversionType.ESRI_RENDERER:return t.renderer;case c.ConversionType.ESRI_SPATIAL_REFERENCE:return t.spatialReference}for(var r={},i=0,n=Object.keys(e);i<n.length;i++)r[n[i]]=t.object;return r},this.app=e,this._urlValidator=new n.SiteUrlValidator(e),this._serviceDiscoveryUrlValidator=new o.ServiceDiscoveryUrlValidator(e),this._webMapFilter=new r.WebMapFilter(e),this._xssHtmlValidator=new a.XssHtmlValidator(e.defaultContentPolicy)}return Object.defineProperty(e.prototype,"baseMap",{get:function(){return this._webMapFilter.baseMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bookmark",{get:function(){return this._webMapFilter.bookmark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._webMapFilter.color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this._coordinateSystem||(this._coordinateSystem={wkid:this._numberValidator,wkt:!0,output:!0}),this._coordinateSystem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domain",{get:function(){return this._webMapFilter.domain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inheritedDomain",{get:function(){return this._webMapFilter.inheritedDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeDomain",{get:function(){return this._webMapFilter.rangeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codedValueDomain",{get:function(){return this._webMapFilter.codedValueDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawingInfo",{get:function(){return this._drawingInfo||(this._drawingInfo=$.extend({},this._webMapFilter.drawingInfo,{showLabels:!0,clustering:{radius:this._numberValidator,backgroundColor:this.color,labelColor:this.color,maximumFeatures:this._numberValidator,enabled:!0},labelingInfo:{item:{fieldInfos:{item:this.object},labelExpression:!0,labelExpressionInfo:this.object,labelPlacement:!0,maxScale:this._numberValidator,minScale:this._numberValidator,sizeInfo:this.object,symbol:{align:!0,angle:this._numberValidator,color:{a:this._numberValidator,b:this._numberValidator,g:this._numberValidator,r:this._numberValidator},decoration:!0,font:{decoration:!0,family:!0,size:this._numberValidator,style:!0,variant:!0,weight:!0},haloColor:{a:this._numberValidator,b:this._numberValidator,g:this._numberValidator,r:this._numberValidator},haloSize:!0,horizontalAlignment:!0,kerning:!0,rotated:!0,text:!0,type:!0,verticalAlignment:!0,xoffset:this._numberValidator,yoffset:this._numberValidator},useCodedValues:!0,where:!0}}})),this._drawingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"feature",{get:function(){var e=this;return this._feature||(this._feature=$.extend({},this._webMapFilter.feature,{id:!0,layer:function(){return e.layer},featureLayer:function(){return e.serviceLayer},featureSet:function(){return e.featureSet},allowUnsafeContent:!0,extendedProperties:this.object,defaultNumberFormat:this._xssHtmlValidator,defaultDateFormat:this._xssHtmlValidator,timeZoneId:!0,displayTimeZoneId:!0,borderColor:this.color,fillColor:this.color,borderWidth:!0,attributes:this.object}),this._feature[s.PROPERTY_MEASUREMENT_ID]=!0,this._feature[s.PROPERTY_HIGHLIGHT_ID]=!0,this._feature[u.isKmlProperty]=!0),this._feature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureCollection",{get:function(){return this._featureCollection||(this._featureCollection=$.extend({},this._webMapFilter.featureCollection,{layers:{item:this.layer}})),this._featureCollection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureSet",{get:function(){var e=this;return this._featureSet||(this._featureSet=$.extend({},this._webMapFilter.featureSet,{id:!0,features:{item:function(){return e.feature}},allowUnsafeContent:!0,extendedProperties:this.object,layer:function(){return e.layer},displayName:this._xssHtmlValidator,iconUri:this._urlValidator})),this._featureSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureSetCollection",{get:function(){var e=this;return this._featureSetCollection||(this._featureSetCollection={id:!0,displayName:this._xssHtmlValidator,featureSets:{item:function(){return e.featureSet}},sourceName:!0,tag:this.object,extendedProperties:this.object}),this._featureSetCollection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"field",{get:function(){return this._webMapFilter.field},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._webMapFilter.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphic",{get:function(){return this._graphic||(this._graphic=$.extend({},this._webMapFilter.feature),this._graphic[s.PROPERTY_MEASUREMENT_ID]=!0,this._graphic[s.PROPERTY_HIGHLIGHT_ID]=!0,this._graphic[u.isKmlProperty]=!0),this._graphic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return this._webMapFilter.point},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiPoint",{get:function(){return this._webMapFilter.multiPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polyline",{get:function(){return this._webMapFilter.polyline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polygon",{get:function(){return this._webMapFilter.polygon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._webMapFilter.extent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerDefinition",{get:function(){return this._layerDefinition||(this._layerDefinition=$.extend({},this._webMapFilter.layerDefinition,{drawingInfo:this.drawingInfo})),this._layerDefinition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return this._webMapFilter.renderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleRenderer",{get:function(){return this._webMapFilter.simpleRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueValueRenderer",{get:function(){return this._webMapFilter.uniqueValueRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classBreaksRenderer",{get:function(){return this._webMapFilter.classBreaksRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heatmapRenderer",{get:function(){return this._webMapFilter.heatmapRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._webMapFilter.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"symbol",{get:function(){return this._webMapFilter.symbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleMarkerSymbol",{get:function(){return this._webMapFilter.simpleMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleLineSymbol",{get:function(){return this._webMapFilter.simpleLineSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleFillSymbol",{get:function(){return this._webMapFilter.simpleFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureMarkerSymbol",{get:function(){return this._webMapFilter.pictureMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureFillSymbol",{get:function(){return this._webMapFilter.pictureFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSymbol",{get:function(){return this._webMapFilter.textSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"template",{get:function(){return this._webMapFilter.template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._webMapFilter.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_serviceLayerCommon",{get:function(){var e=this;return{layers:{item:function(){return e.layer}},isUserCreated:!0,userLayerType:!0,gcxMapServiceDefinition:{id:!0,url:this._urlValidator,serviceUrl:this._urlValidator,tileRestUrl:this._urlValidator,mapUrl:this._urlValidator,subDomains:{item:!0},serviceType:!0,serviceFunction:!0,displayName:this._xssHtmlValidator,shortDisplayName:!0,baseMapGroup:!0,baseMapGroupIndex:!0,baseMapGroupIsMutuallyExclusive:!0,description:!0,copyright:!0,hasAttributionData:!0,visible:!0,disableClientCaching:!0,opacity:this._numberValidator,instantSearch:!0,format:!0,isExpanded:!0,serverVersion:!0,failureAction:!0,tileMatrixSet:!0,requestEncoding:!0,operationalSpatialReference:!0,minScale:this._numberValidator,maxScale:this._numberValidator,identifiable:!0,includeCatalogItems:!0,includeMosaicDatasetValues:!0,defaultDateFormat:!0,defaultNumberFormat:!0,tileInfo:!0,includeInLayerList:!0,drawingBehavior:!0,featureClustering:{enabled:!0,userCanToggle:!0,radius:this._numberValidator,maximumFeatures:this._numberValidator,backgroundColor:this.color,labelColor:this.color},featureHeatMap:{enabled:!0,userCanToggle:!0,respectScaleRange:!0,gradient:!0,offset:{item:this._numberValidator},intensity:this._numberValidator,field:!0,defaultRenderer:this.renderer,defaultMinScale:this._numberValidator,defaultMaxScale:this._numberValidator,includeInLegend:!0},catalogId:this.object,isUserCreated:!0,userLayerType:!0,dataProvider:!0,timeZoneId:!0,startTime:!0,endTime:!0,supportsDynamicLayers:!0,hasLayerCatalog:!0,updateInterval:this._numberValidator,layerOptions:!1,layerHyperlinks:!1,attributionDataUrl:!1}}},enumerable:!0,configurable:!0}),e.prototype._getUrlValidator=function(e){var t=this._urlValidator;return this._getUserLayerType(e)===p.UserLayerType.LAYER_ADDITION&&(t=this._serviceDiscoveryUrlValidator),t},e.prototype._getUserLayerType=function(e){if(e){if(e.isUserCreated&&void 0!=e.userLayerType)return e.userLayerType;var t=void 0;if(t=e.serviceLayer?e.serviceLayer:e,this._isLayerCatalogService(t))return p.UserLayerType.LAYER_CATALOG;if(this._isFeatureCollection(t)||this._isKmlLayer(t))return p.UserLayerType.UPLOAD}return null},e.prototype._isFeatureCollection=function(e){var t=e;return t&&t.featureCollection&&t.featureCollection.layers&&1===t.featureCollection.layers.length&&!!t.featureCollection.layers[0].featureSet},e.prototype._isKmlLayer=function(e){var t=e;return t&&t.type===l.OperationalLayerType.KML},e.prototype._isLayerCatalogService=function(e){return e&&e.gcxMapServiceDefinition&&e.gcxMapServiceDefinition.catalogId},e}();t.ProjectFilter=f})},"geocortex/infrastructure/project/ProjectManager":function(){define(["require","exports","./ProjectConverter","./ProjectFilter","./../ShellUtils","./../MapUtils","geocortex/framework/utils/utils","./../UrlUtilities","./../Dictionary","./../PromiseUtils","./../ObjectFilter","geocortex/essentials/serviceDiscovery/SiteServiceDiscoveryProvider","geocortex/essentials/MapServiceConstants","./../webMap/WebMapConverter"],function(e,t,r,i,n,o,a,s,u,c,l,p,f,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PROJECT_TYPE="gvh-project",t.SITE_ID_PROPERTY_NAME="siteID",t.VIEWER_ID_PROPERTY_NAME="viewerID",t.PROJECT_QUERY_STRING_KEY="project",t.VIEWER_QUERY_STRING_KEY="viewer";var y=function(){function e(e){if(this._serviceDiscovery=null,!e)throw new Error("ProjectManager: Parameter 'app' is required.");this.app=e,this.convert=new r.ProjectConverter(e),this.filter=new i.ProjectFilter(e)}return e.prototype.createEmpty=function(e){var r={};return r[t.SITE_ID_PROPERTY_NAME]={string:this.app.site.id},r[t.VIEWER_ID_PROPERTY_NAME]={string:this.app.configModel.viewerId},{title:e,fileType:t.PROJECT_TYPE,contentType:"application/json",content:{moduleState:{}},properties:r}},e.prototype.create=function(e){var t=this.createEmpty(e);return this.update(t).return(t)},e.prototype.update=function(e){return this._exportState().then(function(t){e.content=t})},e.prototype.remove=function(e){var t=this;if(!e)throw new Error('RemoveProject: parameter "project" is required.');var r=this.getProjectID(e);return this.app.waitUntilSiteInitialized().then(function(){return t.app.event("ProjectDeletingEvent").publish(r)}).then(function(){return t.app.site.documentStore.deleteById(r)}).then(function(){t.current&&t.current.id===r&&(t.current=null)}).then(function(){t.app.event("ProjectDeletedEvent").publish(r)}).catch(function(e){t.app.event("ProjectErrorEvent").publish(null,e);var r=t._getResource("language-project-error-title"),i=t._getResource("language-project-error-delete");throw e&&"writer denied"===e.formalCode&&(i=t._getResource("language-project-error-delete-denied")),t.app.command("Alert").execute(i,r),e})},e.prototype.save=function(e,t){var r=this;if(void 0===t&&(t=!0),!e)throw new Error('SaveProject: parameter "project" is required.');return this.app.waitUntilSiteInitialized().then(function(){return r.app.event("ProjectSavingEvent").publish(e)}).then(function(){return t?new Promise(function(e,t){return n.debounceViewEvents(r.app,function(){return e()})}).then(function(){return r.update(e)}).then(function(){return o.getThumbnailUri(r.app)}).then(function(t){return e.thumbnail={location:t}}).catch(function(t){r.app.event("ProjectErrorEvent").publish(e,t);var i=r._getResource("language-project-error-title"),n=r._getResource("language-project-error-write");throw r.app.command("Alert").execute(n,i),t}):Promise.resolve()}).then(function(){return r.write(e)}).then(function(t){return dojo.mixin(e,t)}).then(function(){return r.app.event("ProjectSavedEvent").publish(e)})},e.prototype.load=function(e){var t=this;if(!e)throw new Error('LoadProject: parameter "project" is required.');var r=this.getProjectID(e);return this.app.event("ProjectLoadingEvent").publish(r),"object"==typeof e&&void 0===e.content&&(e=r),this.getProject(e).then(function(e){return t._beginLoad(e)}).then(function(){if(t.current&&t.current.content)return t._applyState(t.current.content)}).then(function(){return t._finishLoad()}).catch(function(e){t.isLoading=!1})},e.prototype.write=function(e){var t=this;if(!e)throw new Error('ProjectManager.write: Parameter "project" is required.');return e.content&&e.content.isDecoded&&this.encodeReferences(e.content),this.app.waitUntilSiteInitialized().then(function(){return a.isNullOrUndefined(e.id)?t.app.site.documentStore.add(e).then(function(t){return e.id=t.id,t}):t.app.site.documentStore.updateById(e.id,e)}).catch(function(r){t.app.event("ProjectErrorEvent").publish(e,r);var i=t._getResource("language-project-error-title"),n=t._getResource("language-project-error-write");throw!r||"writer denied"!==r.formalCode&&"create denied"!==r.formalCode||(n=t._getResource("language-project-error-write-denied")),t.app.command("Alert").execute(n,i),r})},e.prototype.read=function(e,t){var r=this;if(void 0===t&&(t=!0),!e)throw new Error('ProjectManager.read: parameter "id" is required.');return this.app.waitUntilSiteInitialized().then(function(){return r.app.site.documentStore.getById(e,t)}).then(function(e){return e?(r.decodeReferences(e.content),r._filterApplicationState(e.content).then(function(t){return e.content=t,e})):e}).catch(function(t){r.app.event("ProjectErrorEvent").publish(null,t);var i=r._getResource("language-project-error-title"),n=r._getResource("language-project-error-read");if(t&&"item missing"===t.formalCode)n=r._getResource("language-project-error-read-not-found").format(e);else if(t&&"reader denied"===t.formalCode){if(n=r._getResource("language-project-error-read-denied"),r.app.command("SignIn").canExecute(null)){n=r._getResource("language-project-error-sign-in-required");throw r.app.command("Confirm").execute(n,i,function(e){e?r.app.command("SignIn").execute(null):window.location.assign(s.removeQueryParameter(window.location.href,"project"))},{okLabel:r._getResource("language-project-sign-in"),sticky:!0}),t}n=r._getResource("language-project-error-read-denied")}throw r.app.command("Alert").execute(n,i),t})},e.prototype.getProject=function(e,t){if(void 0===t&&(t=!0),!e)throw new Error('ProjectManager.getProject: parameter "project" is required.');return"string"==typeof e?this.app.project.read(e,t):Promise.resolve(e)},e.prototype.getProjectID=function(e){if(!e)throw new Error('ProjectManager.getProjectID: parameter "project" is required.');return"string"==typeof e?e:e.id},e.prototype.getProjectUrl=function(e){if(!e||!e.id)return null;var r=this.getSiteID(e);if(!r)throw new Error("ProjectManager.getProjectUrl: project siteId is null or undefined.");var i=this.getViewerID(e);if(!i)throw new Error("ProjectManager.getProjectUrl: project viewerId is null or undefined.");var n=window.location.href;n.indexOf("?")>-1?n=n.substring(0,n.indexOf("?")):n.indexOf("#")>-1&&(n=n.substring(0,n.indexOf("#")));var o=new u.Dictionary;if("unknown"!==i){var a=encodeURIComponent("{0}.{1}".format(r,i));o.set(t.VIEWER_QUERY_STRING_KEY,a)}return o.set(t.PROJECT_QUERY_STRING_KEY,encodeURIComponent(e.id)),"{0}{1}".format(n,s.queryStringDictionaryToString(o))},e.prototype.getSiteID=function(e){if(!e)throw new Error('ProjectManager.getSiteID: parameter "project" is required.');if(!e.properties)return null;var r=e.properties[t.SITE_ID_PROPERTY_NAME];return r?r.string:null},e.prototype.getViewerID=function(e){if(!e)throw new Error('ProjectManager.getViewerID: parameter "project" is required.');if(!e.properties)return null;var r=e.properties[t.VIEWER_ID_PROPERTY_NAME];return r?r.string:null},e.prototype.validateProjectOwnership=function(e){return this.app.site.documentStore.isOwner(e)?Promise.resolve(e):Promise.reject(this._getResource("language-project-error-owner"))},e.prototype._initializeDiscoveryProvider=function(){var e=this;return this._serviceDiscovery?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var t=e.app.site,r=new p.SiteServiceDiscoveryProvider;r.initialize(t),e._serviceDiscovery=r})},e.prototype._validateAgainstServiceDiscovery=function(e){var t=this,r={mapService:e,trusted:!1};return e.isUserCreated&&e.userLayerType===f.UserLayerType.LAYER_ADDITION?this._initializeDiscoveryProvider().then(function(){return t._serviceDiscovery.findServices(e.serviceUrl)}).then(function(e){return Array.isArray(e)&&e.some(function(e){return!!e.isWhitelisted})?r.trusted=!0:r.trusted=!1,r}).catch(function(){return r.trusted=!1,r}):(r.trusted=!0,Promise.resolve(r))},e.prototype._excludeUnsafeState=function(){var e=this,t=this.app.site.essentialsMap.mapServices;return Promise.map(t,function(t){return e._validateAgainstServiceDiscovery(t)}).then(function(t){for(var r=0,i=t;r<i.length;r++){var n=i[r];n.trusted||e.convert.exclude(n.mapService,d.ConversionType.GCX_MAP_SERVICE)}})},e.prototype._exportState=function(){var e=this;return this.convert.clearCache(),this._excludeUnsafeState().then(function(){var t=e._getModules(),r={};return Object.keys(t).forEach(function(e){r[e]=Promise.try(function(){return t[e].exportState()})}),c.PromiseUtils.propsSkipRejected(r)}).then(function(t){for(var r in t)t[r]||delete t[r];var i={mapScale:e.app.map.getScale(),mapCenter:e.convert.fromEsriGeometry(e.app.map.extent.getCenter()),moduleState:t};return e._filterApplicationState(i)}).then(function(t){return e.encodeReferences(t),t})},e.prototype._applyState=function(e){var t=this;if(!e)return Promise.resolve();this.decodeReferences(e);var r=e.moduleState||[];return Promise.map(Object.keys(r),function(e){var i=t._getModules()[e];if(i){var n=r[e];return n.serialVersion||(n.serialVersion=1),Promise.try(function(){return i.applyState(n)}).catch(function(r){return t.app.trace.warning('Unable to restore project state for module "{0}": {1}'.format(e,r))})}}).return()},e.prototype._applyMapExtent=function(e){this.app.site.essentialsMap.extentManager.setScaleWithPriority(e.content.mapScale,Number.MAX_VALUE);var t=this.convert.toEsriGeometry(e.content.mapCenter);this.app.site.essentialsMap.extentManager.centerAtWithPriority(t,Number.MAX_VALUE)},e.prototype._getResource=function(e){return this.app.getResource("Mapping.Infrastructure",e)},e.prototype._getModules=function(){return this.app.moduleManager._modules},e.prototype._beginLoad=function(e){var t=this;return this.app.waitUntilSiteInitialized().then(function(){if(t.isLoading)throw new Error("Cannot load a new project until the current project has finished loading.");var r=t.getSiteID(e);if(t.app.site.id!==r)throw new Error('The project "{0}" was created for the Essentials site ID "{1}" and is not compatible with this site.'.format(e.title,r));t.convert.clearCache(),t.isLoading=!0,t.current=e,t._applyMapExtent(e)})},e.prototype._finishLoad=function(){var e=this;setTimeout(function(){return e._applyMapExtent(e.current)},150),this.app.event("ProjectLoadedEvent").publish(this.current),this.isLoading=!1},e.prototype._filterApplicationState=function(e){var t=this,r={mapCenter:this.filter.point,mapScale:!0,moduleState:{},isDecoded:!0},i=this._getModules();return Promise.map(Object.keys(i),function(n){var o=i[n];if(o){var a=o.getStateFilter();!e.moduleState[n]||a?("object"==typeof a&&(a=$.extend({},a,{serialVersion:!0})),r.moduleState[n]=a):t.app.trace.warning('Module "{0}" has project state, but has no defined state filter. A module that participate in projects must implement ModuleBase.getStateFilter().'.format(n))}}).then(function(){return l.ObjectFilter.filter(e,r,{XssHtmlValidator:{defaultContentPolicy:t.app.defaultContentPolicy}})})},e.prototype.encodeReferences=function(e){if(e){var t=new RegExp("~","g"),r=new WeakMap,i=[],n=function(e){Array.isArray(e)||r.set(e,"~"+i.join("~"));for(var o=0,a=Object.keys(e);o<a.length;o++){var s=a[o],u=e[s];if(u&&"object"==typeof u){var c=r.get(u);c?e[s]=c:(i.push((s+"").replace(t,"\\x7e")),n(u),i.pop())}else u&&"string"==typeof u&&u.startsWith("~")&&(e[s]=u.replace("~","\\x7e"))}};n(e),delete e.isDecoded}},e.prototype.decodeReferences=function(e){if(e&&!e.isDecoded){var t=new RegExp("\\x7e".replace("\\","\\\\"),"g"),r=new WeakMap,i=function(n){if(!r.has(n)){r.set(n,!0);for(var o=0,a=Object.keys(n);o<a.length;o++){var s=a[o],u=n[s];if(u&&"string"==typeof u)if(u.startsWith("~")){for(var c=u.split("~").map(function(e){return e.replace(t,"~")}),l=e,p=1;p<c.length;p++){var f=c[p];f&&l&&(l=l[f])}n[s]=l}else u.startsWith("\\x7e")&&(n[s]=u.replace("\\x7e","~"));else u&&"object"==typeof u&&i(u)}}};i(e),e.isDecoded=!0}},e}();t.ProjectManager=y})},"geocortex/infrastructure/project/ServiceLayer":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/PromiseUtils":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.allSkipRejected=function(e,r){var n={};return Promise.resolve(e).then(function(e){var t=(e||[]).map(function(e){return Promise.resolve(e).catch(function(e){return r&&console.error(e),n})});return Promise.all(t).then(function(e){return e.filter(function(e){return e!==n})})})},e.mapSkipRejected=function(e,r,n,t){var o={};return Promise.resolve(e).then(function(e){var i=(e||[]).map(function(e){return Promise.resolve(e).catch(function(e){return o})});return Promise.map(i,function(e,n,i){return Promise.try(function(){return r(e,n,i)}).catch(function(e){return t&&console.error(e),o})},n).then(function(e){return e.filter(function(e){return e!==o})})})},e.propsSkipRejected=function(e){return Promise.resolve(e).then(function(e){var r={};return Promise.map(Object.keys(e),function(n){return Promise.resolve(e[n]).then(function(e){r[n]=e},function(e){})}).return(r)})},e.warnOnReject=function(e,r,n){return Promise.resolve(e).catch(function(e){return r.trace.warning(n.format(e)),Promise.reject(e)})}}(r.PromiseUtils||(r.PromiseUtils={}))})}}});require({cache:{"geocortex/infrastructure/Reporting":function(){define(["require","exports","./FeatureSetCollection","./FeatureSet","./Feature"],function(e,t,r,u,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllFeaturesFromReportable=function(e){var t=[];if(e instanceof r.FeatureSetCollection)e.featureSets.get().forEach(function(e){e.features.get().forEach(function(e){t.push(e)})});else if(e instanceof u.FeatureSet)e.features.get().forEach(function(e){t.push(e)});else if(e instanceof n.Feature){var o=e;t.push(o)}else e&&e.constructor===Array&&(t=e);return t}})}}});!function(){var e="<button class='gcx-list-button icon-right chevron-right-24' data-binding='{@event-onclick: handleClick}'>    <img class='list-menu-icon' data-binding='{src: iconUri}{@visible: iconUri}' alt=' ' aria-hidden='true' />    <img class='list-menu-icon' data-binding='{@hidden: iconUri}' src='Resources/Images/Icons/map-default-24.png' alt=' ' aria-hidden='true' />    <strong class='gcx-list-label'><span data-binding='{@var: featuresCount}{@text: featuresCount}'></span> <span data-binding='{@var: featureSetLabel}{@text: featureSetLabel}'></span></strong></button>",t="<div class='results-list-actions-widget' data-binding='{@visible: featureSetCollection}{@widget: FeatureSetCollectionActionsWidget}{@widget-context: featureSetCollection}{@widget-required: false}'     data-menu-id='FeatureSetCollectionResultsActions' data-menu-template='Mapping/infrastructure/menus/MenuHyperlinkView.html'></div>\x3c!--<div class='results'>--\x3e<div class='layer-addition map-services-dialog'>    \x3c!-- BEGIN: No Results --\x3e    <div class='no-results' data-binding='{@hidden: featureSets}{@text: searchSuggestion}' tabindex='0'></div>    <div class='panel-group' data-binding='{@visible: featureSets}{@var: scrollContainerElement}'>        \x3c!--NOTE: the logic to open and close the inline flyout menu as defined in ResultsUtils             relies on this class being gcx-list-menu. If this needs to be changed make sure that             ResultsUtils is updated as well.--\x3e        <ul class='gcx-list-menu has-action-1 has-icon' data-binding='{@source: featureSets}'>            <li class='gcx-list-item has-action-1' data-binding='{title: @language-results-feature-set-element-title}{@template-for: featureSets}'>                                \x3c!--  NOTE: The view requires that this div is the FIRST child of the <li>. If needs to be changed let's make sure that the                    access to firstElementChild in ResultsUtils is updated as well. --\x3e                <div class='smart-panel-hoisted-menu-inline feature-sets-actions bound-invisible' data-binding='{@widget: FeatureSetActionsWidget}{@widget-context: @context}{@widget-required: false}'                     data-menu-id='FeatureSetCollectionResultsFeatureSetActions' data-menu-hoist-disabled></div>                <div data-binding='{@widget: GetFeatureSetLabel}{@widget-context: @context}{@widget-replace: true}'></div>                \x3c!--  NOTE: When dealing with the click event the view requires that this button is an immediate child of <li>.                    If this needs to be updated make sure that the part of code that access the parentElement in handleFeatureSetFeatureActionClick                    is updated as well. --\x3e                <button class='gcx-action-button icon more-24' data-binding='{title: @language-menu-feature-set-actions-title}{@event-click: handleFeatureSetCollectionFeatureSetActionsClick}'></button>            </li>        </ul>    </div></div>",s="<div class='results-list-actions-widget' data-binding='{@visible: featureSet}{@widget: FeatureSetActionsWidget}{@widget-context: featureSet}{@widget-required: false}'      data-menu-id='FeatureSetResultsActions' data-menu-template='Mapping/infrastructure/menus/MenuHyperlinkView.html'></div><div class='layer-addition map-services-dialog'>    \x3c!-- BEGIN: No Results --\x3e    <div class='no-results' data-binding='{@hidden: presentableResults}{@text: searchSuggestion}' tabindex='0'></div>    \x3c!-- END: No Results --\x3e    \x3c!-- BEGIN: Feature set features List --\x3e    <div class='results-list' data-binding='{@var: scrollContainerElement}{@event-onscroll: handleScrollChange}' tabindex='-1'>        \x3c!--NOTE: the logic to open and close the inline flyout menu as defined in ResultsUtils        relies on this class being gcx-list-menu. If this needs to be changed make sure that        ResultsUtils is updated as well.--\x3e        <ul class='gcx-list-menu' data-binding='{@source: resultsPage}{@visible: resultsPage}'>            <li class='gcx-list-item has-action-1' data-binding='{title: @language-results-feature-element-title}{@event-mouseenter: handleMouseOver}{@event-mouseleave: handleMouseOut}{@template-for: resultsPage}'>                \x3c!--  NOTE: The view requires that this div is the FIRST child of the <li>. If needs to be changed let's make sure that the                     access to firstElementChild in ResultsUtils is updated as well. --\x3e                <div class='smart-panel-hoisted-menu-inline feature-set-actions bound-invisible' data-binding='{@widget: FeatureActionsWidget}{@widget-context: @context}{@widget-required: false}'                     data-menu-id='FeatureSetResultsFeatureActions' data-menu-hoist-disabled></div>                <button class='gcx-list-button list-menu-details icon-right chevron-right-24' data-binding='{@event-onfocus: handleMouseOver}{@event-onblur: handleMouseOut}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}'>                    <strong class='gcx-list-label' data-binding='{@widget: GetLabel}{@widget-context: @context}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-mouseout: handleMouseOut}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}'></strong>                </button>                \x3c!--  NOTE: When dealing with the click event the view requires that this button is an immediate child of <li>.                    If this needs to be updated make sure that the part of code that access the parentElement in handleFeatureSetFeatureActionClick                    is updated as well. --\x3e                <button class='gcx-action-button icon more-24' data-binding='{title: @language-menu-feature-actions-title}{@event-onfocus: handleMouseOver}{@event-onblur: handleMouseOut}{@event-click: handleFeatureSetFeatureActionClick}'></button>                \x3c!--The bound-invisible class on this element will be removed manually by the view if the feature has a populated content field--\x3e                <div class='gcx-list-desc bound-invisible' data-binding='{@widget: GetDescription}{@widget-context: @context}'></div>            </li>        </ul>    </div>    \x3c!-- If the below 'results-list' div is tabbable, then shift+tab gets stuck in FireFox. --\x3e    \x3c!-- BEGIN: Paging Controls --\x3e    <div class='paging-control' data-binding='{@source: presentableResults}{className: pagingControlClassName}'>        <div class='paging-control-inner' data-binding='{@template-for: presentableResults}'>            <div class='paging-result-info'>                <span class='paging-results-total' data-binding='{@hidden: numberOfItems}{@text: @language-common-no-results}'></span>                <span data-binding='{@visible: numberOfItems}'>                    <span data-binding='{@text: @language-results-displaying}'></span>&nbsp;<span data-binding='{@text: currIndexStartFromOne}'></span>&nbsp;-&nbsp;<span data-binding='{@text: currIndexEnd}'></span>&nbsp;(<span data-binding='{@text: @language-results-total}'></span>:&nbsp;<span data-binding='{@text: numberOfItems}'></span>)                </span>            </div>            <div class='paging-buttons' data-binding='{@visible: numberOfItems}'>                <button class='first' data-binding='{@event-onclick: handlePageFirst}{title: @language-page-first}'><img src='Resources/Images/Icons/paging-control-first-44.png' alt=' ' /></button>                <button class='prev' data-binding='{@event-onclick: handlePagePrev}{title: @language-page-prev}'><img src='Resources/Images/Icons/paging-control-previous-44.png' alt=' ' /></button>                <span class='paging-buttons-info' tabindex='0'>                    <span data-binding='{@text: @language-results-page}'></span>&nbsp;<span data-binding='{@text: currPageNumber}'></span>&nbsp;<span data-binding='{@text: @language-results-page-of}'></span>&nbsp;<span data-binding='{@text: lastPageNumber}'></span>                </span>                <button class='next' data-binding='{@event-onclick: handlePageNext}{title: @language-page-next}'><img src='Resources/Images/Icons/paging-control-next-44.png' alt=' ' /></button>                <button class='last' data-binding='{@event-onclick: handlePageLast}{title: @language-page-last}'><img src='Resources/Images/Icons/paging-control-last-44.png' alt=' ' /></button>            </div>        </div>    </div>    \x3c!-- END: Paging Controls --\x3e</div>",i="<div class='list-menu' data-binding='{@source: featureActions}'>    <div class='list-menu-item' data-binding='{@template-for: featureActions}{@event-onmouseover: handleGetDescription}{@event-onclick: handleMenuItemClick}'>        <button class='list-menu-details'>            <strong class='list-menu-name' data-binding='{@text: text}'></strong>            <span class='list-menu-desc' data-binding='{@text: description}'></span>        </button>    </div></div>",n="<div class='results-list-actions-widget' data-binding='{@visible: featureSetCollection}{@widget: ResultsListActionsWidget}{@widget-context: featureSetCollection}{@widget-required: false}' data-menu-id='ResultsListActions' data-menu-template='Mapping/infrastructure/menus/MenuHyperlinkView.html'></div><div class='results'>    \x3c!-- BEGIN: No Results --\x3e    <div class='no-results' data-binding='{@hidden: hasFeatureSets}{@text: searchSuggestion}' tabindex='0'></div>    \x3c!-- END: No Results --\x3e    \x3c!-- BEGIN: Results List --\x3e    \x3c!-- If the below 'results-list' div is tabbable, then shift+tab gets stuck in FireFox. --\x3e    <div class='results-list' data-binding='{@var: scrollContainerElement}{@event-onscroll: handleScrollChange}' tabindex='-1'>        <div class='list-menu active has-icon' data-binding='{@source: resultsPage}{@visible: resultsPage}{@var: resultsList}'>            <div class='list-menu-item' data-binding='{@template-for: resultsPage}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-onfocus: handleMouseOver}{@event-onblur: handleMouseOut}{@event-mouseenter: handleMouseOver}{@event-mouseleave: handleMouseOut}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}' tabindex='0'>                <img class='list-menu-icon' data-binding='{src: iconUri}{alt: label}{@visible: iconUri}' alt=' ' aria-hidden='true' />                <img class='list-menu-icon' data-binding='{alt: label}{@hidden: iconUri}' src='Resources/Images/Icons/map-default-24.png' alt=' ' aria-hidden='true' />                <span class='list-menu-details'>                    <button class='list-menu-name' data-binding='{@widget: GetLabel}{@widget-context: @context}{@visible: label}{@event-mousedown: handleMouseDown}{@event-click: handleClick}{@event-mouseout: handleMouseOut}{@event-mouseup: handleMouseUp}{@event-touchstart: handleTouchStart}{@event-touchmove: handleTouchMove}{@event-touchcancel: handleTouchCancel}{@event-touchend: handleTouchEnd}'></button>                    <span class='list-menu-desc' data-binding='{@widget: GetDescription}{@widget-context: @context}'></span>                </span>            </div>        </div>    </div>    \x3c!-- END: Results List --\x3e    \x3c!-- BEGIN: Paging Controls --\x3e    <div class='paging-control' data-binding='{@source: presentableResults}{className: pagingControlClassName}'>        <div class='paging-control-inner' data-binding='{@template-for: presentableResults}'>            <div class='paging-result-info'>                <span class='paging-results-total' data-binding='{@hidden: numberOfItems}{@text: @language-common-no-results}'></span>                <span data-binding='{@visible: numberOfItems}'>                    <span data-binding='{@text: @language-results-displaying}'></span>&nbsp;<span data-binding='{@text: currIndexStartFromOne}'></span>&nbsp;-&nbsp;<span data-binding='{@text: currIndexEnd}'></span>&nbsp;(<span data-binding='{@text: @language-results-total}'></span>:&nbsp;<span data-binding='{@text: numberOfItems}'></span>)                </span>            </div>            <div class='paging-buttons' data-binding='{@visible: numberOfItems}'>                <button class='first' data-binding='{@event-onclick: handlePageFirst}{title: @language-page-first}'><img src='Resources/Images/Icons/paging-control-first-44.png' alt=' ' /></button>                <button class='prev' data-binding='{@event-onclick: handlePagePrev}{title: @language-page-prev}'><img src='Resources/Images/Icons/paging-control-previous-44.png' alt=' ' /></button>                <span class='paging-buttons-info' tabindex='0'>                    <span data-binding='{@text: @language-results-page}'></span>&nbsp;<span data-binding='{@text: currPageNumber}'></span>&nbsp;<span data-binding='{@text: @language-results-page-of}'></span>&nbsp;<span data-binding='{@text: lastPageNumber}'></span>                </span>                <button class='next' data-binding='{@event-onclick: handlePageNext}{title: @language-page-next}'><img src='Resources/Images/Icons/paging-control-next-44.png' alt=' ' /></button>                <button class='last' data-binding='{@event-onclick: handlePageLast}{title: @language-page-last}'><img src='Resources/Images/Icons/paging-control-last-44.png' alt=' ' /></button>            </div>        </div>    </div>    \x3c!-- END: Paging Controls --\x3e</div>",a="<div class='results-table-actions-widget' data-binding='{@visible: featureSetCollection}{@widget: ResultsTableActionsWidget}{@widget-context: featureSetCollection}{@widget-required: false}'     data-menu-id='ResultsTableActions' data-menu-template='Mapping/infrastructure/menus/MenuHyperlinkView.html'></div><div class='results'>    \x3c!-- BEGIN: No Results --\x3e    <div class='no-results' data-binding='{@hidden: hasFeatureSets}{@text: searchSuggestion}'></div>    \x3c!-- END: No Results --\x3e    \x3c!-- BEGIN: Scrolling Tab Container Area --\x3e    <div class='tab-container' data-binding='{@visible: hasFeatureSets}{@var: scrollingTabContainerElement}'>        <table>            <tr>                <td class='tab-left-scroll' data-binding='{@visible: tabControlsEnabled}{@class-disabled: leftScrollTabDisabled}{@var: scrollTabLeftElement}'>                    <button data-binding='{@event-onclick: handleTabScrollBack}{title: @language-tab-scroll-prev}'>                        <img src='Resources/Images/Icons/chevron-left-16.png' alt=''>                    </button>                </td>                <td data-binding='{@source: featureSetCollection}'>                    <div class='tab-container' data-binding='{@template-for: featureSetCollection}{@var: tabContainerElement}'>                        <ul class='tab-control' data-binding='{@source: featureSets}{@var: tabElements}'>                            <li data-binding='{@template-for: featureSets}'>                                <button class='tab' data-binding='{@class-tab-active: isSelectedInCollection}{@noclass-tab: isSelectedInCollection}{@event-onclick: handleTabClick}'>                                    <strong data-binding='{@text: displayName}{title: displayName}'></strong>                                </button>                            </li>                        </ul>                    </div>                </td>                <td class='tab-right-scroll' data-binding='{@visible: tabControlsEnabled}{@class-disabled: rightScrollTabDisabled}{@var: scrollTabRightElement}'>                    <button data-binding='{@event-onclick: handleTabScrollForward}{title: @language-tab-scroll-next}'>                        <img src='Resources/Images/Icons/chevron-right-16.png'>                    </button>                </td>            </tr>        </table>    </div>    \x3c!-- END: Scrolling Tab Container Area --\x3e    \x3c!-- BEGIN: Results Table --\x3e    <div class='widget' data-binding='{@visible: hasFeatureSets}{@widget: TableViewWidget}{@widget-context: @context}{@widget-required: false}'></div>    \x3c!-- END: Results Table --\x3e    \x3c!-- BEGIN: Paging Controls --\x3e    <div class='paging-control' data-binding='{@source: presentableResults}'>        <div class='paging-control-inner' data-binding='{@template-for: presentableResults}'>            <div class='paging-result-info'>                <span data-binding='{@hidden: numberOfItems}{@text: @language-common-no-results}'></span>                <span data-binding='{@visible: numberOfItems}'>                    <span data-binding='{@text: @language-results-displaying}'></span>&nbsp;<span data-binding='{@text: currIndexStartFromOne}'></span>&nbsp;-&nbsp;<span data-binding='{@text: currIndexEnd}'></span>&nbsp;(<span data-binding='{@text: @language-results-total}'></span>:&nbsp;<span data-binding='{@text: numberOfItems}'></span>)                </span>            </div>            <div class='paging-buttons' data-binding='{@visible: numberOfItems}'>                <button class='first' data-binding='{@event-onclick: handlePageFirst}{title: @language-results-page-first}'><img src='Resources/Images/Icons/paging-control-first-44.png' alt=' '/></button>                <button class='prev' data-binding='{@event-onclick: handlePagePrev}{title: @language-results-page-prev}'><img src='Resources/Images/Icons/paging-control-previous-44.png' alt=' '/></button>                <span class='paging-buttons-info' tabindex='0'>                    <span data-binding='{@text: @language-results-page}'></span>&nbsp;<span data-binding='{@text: currPageNumber}'></span>&nbsp;<span data-binding='{@text: @language-results-page-of}'></span>&nbsp;<span data-binding='{@text: lastPageNumber}'></span>                </span>                <button class='next' data-binding='{@event-onclick: handlePageNext}{title: @language-results-page-next}'><img src='Resources/Images/Icons/paging-control-next-44.png' alt=' '/></button>                <button class='last' data-binding='{@event-onclick: handlePageLast}{title: @language-results-page-last}'><img src='Resources/Images/Icons/paging-control-last-44.png' alt=' '/></button>            </div>        </div>    </div>    \x3c!-- END: Paging Controls --\x3e</div>";require({cache:{"geocortex/infrastructure/results/FeatureSetCollectionResultsLabelView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./FeatureSetCollectionResultsLabelViewModel"],function(t,s,i,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=function(t){function s(e,s){return t.call(this,e,s)||this}return e(s,t),s.prototype.attach=function(e){return this.viewModel=new n.FeatureSetCollectionResultsLabelViewModel(this.app,this.libraryId),this.viewModel.featureSet.set(e),t.prototype.attach.call(this,this.viewModel),Promise.resolve()},s.prototype.handleClick=function(e,t,s){var i=e.target,n=!("IMG"!==i.tagName||!i.parentElement||"A"!==i.parentElement.tagName||!i.parentElement.href);return!("A"!==i.tagName&&!n)||(this.app.event("FeatureSetClickedEvent").publish(s.featureSet.get()),!1)},s}(i.ViewBase);s.FeatureSetCollectionResultsLabelView=a})},"geocortex/infrastructure/results/FeatureSetCollectionResultsLabelViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,s,i,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.featureSet=new n.Observable,i.featuresCount=new n.Observable,i.featureSetLabel=new n.Observable,i.iconUri=new n.Observable,i.featureSet.bind(i,function(e){i.featuresCount.set("("+e.features.getLength()+")");var t=""!==e.displayName.get()?e.displayName.get():e.id;i.featureSetLabel.set(t),i.iconUri.set(e.iconUri.get())}),i}return e(s,t),s}(i.ViewModelBase);s.FeatureSetCollectionResultsLabelViewModel=a})},"geocortex/infrastructure/results/FeatureSetCollectionResultsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewBase","./ResultsUtils"],function(t,s,i,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i._invisibleClassName="bound-invisible",i._visibleClassName="bound-visible",i._openUpActionsMenuClassName="inline-menu-open-up",i._defaultDetectAutomaticDrillInDelay=300,i._subscriptions=null,i.app.command("ShowResultsList").register(i,i.showResultsList),i.app.command("ShowResultsTable").register(i,i._handleShowResultsTable,function(){return!i.app.configuration.mobileMode}),i.app.command("SwitchToTabularResultsView").register(i,i._switchToTabularResultsViewImpl,i._canExecuteSwitchToTabularResultsView),i.app.command("_ExportResultsViewState").register(i,i._exportState),i.app.command("_ClearIsSelected").register(i,i._clearIsSelected),i.app.command("_ApplyResultsViewState").register(i,i._applyState),i.app.event("ViewContainerViewClosedEvent").subscribe(i,function(e){e.viewId===i.id&&!1!==i.configuration.clearCollectionOnClose&&i.viewModel.featureSetCollection.get().clear()}),i}return e(s,t),s.prototype.activated=function(){if(this.app.command("HideFeatureSetResultsView").execute(),t.prototype.activated.call(this),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var e=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),s=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:e},{eventName:"DataFrameClosedEvent",token:s}]}if(this.resultsList){var i=this.resultsList;setTimeout(function(){dojo.style(i,{display:"block"})},1)}this.app.project.isLoading||this.viewModel.featureSetCollection.get().featureSets.get().forEach(function(e){e.isSelectedInCollection.set(!1)}),this.viewModel.isViewActive.set(!0)},s.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel.isViewActive.set(!1),this.app.command("RemoveResultsStatus").execute(),this._unsubscribeFromEvents()},s.prototype.attach=function(e){if(this.configuration.automaticDrillInDelay){var s=this.configuration.automaticDrillInDelay;s<0&&(s=this._defaultDetectAutomaticDrillInDelay),e.detectAutomaticDrillInDelay=s}this.title.sync(e.headerText),this.isBusy.sync(e.isBusy),t.prototype.attach.call(this,e)},s.prototype.showResultsList=function(e){this.app.viewManager.activateView(this)},s.prototype.getDescription=function(e,t,s){t.title=s.description.get()},s.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},s.prototype.handleFeatureSetCollectionFeatureSetActionsClick=function(e,t,s){n.handleInlineMenuActionClick(e,t,this.currentActiveFeatureSetElement,this.scrollContainerElement,this),this.currentActiveFeatureSetElement=t.parentElement},s.prototype.resolveWidget=function(e,s,i){switch(t.prototype.resolveWidget.call(this,e,s),e){case"FeatureSetCollectionActionsWidget":case"FeatureSetActionsWidget":var n=this.app.menuRegistry.createMenuWidget(this,s,i);if(n)return n;break;case"GetFeatureSetLabel":var a=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/results/FeatureSetCollectionResultsLabelView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.results.FeatureSetCollectionResultsLabelView"});return a.attach(s),a;default:return}},s.prototype._handleShowResultsTable=function(){this.app.viewManager.deactivateView(this)},s.prototype._switchToTabularResultsViewImpl=function(){this.app.command("CloseDataFrame").execute()},s.prototype._canExecuteSwitchToTabularResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},s.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},s.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},s.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},s.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},s.prototype._clearIsSelected=function(){this.viewModel&&this.viewModel.featureSetCollection.get()&&this.viewModel.featureSetCollection.get().featureSets.get()&&this.viewModel.featureSetCollection.get().featureSets.get().length>0&&this.viewModel.featureSetCollection.get().featureSets.get().forEach(function(e){e.isSelectedInCollection.set(!1)})},s.prototype._applyState=function(e){this.viewModel.applyState(e)},s}(i.ResultsViewBase);s.FeatureSetCollectionResultsView=a})},"geocortex/infrastructure/results/FeatureSetCollectionResultsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewModel","geocortex/framework/observables","./../FeatureSetCollection","./../eventArgs/FeatureSetManagerEventArgs","./../commandArgs/AddStatusArgs","./ResultsUtils"],function(t,s,i,n,a,r,o,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var u=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.isViewActive=new n.Observable(!1),i._automaticDrillIn=!0,i._featureSetsBindingToken=null,i._boundFeatureSetCollection=null,i._featureViewMap={},i._featureSetsLoadTimer=0,i._performAutomaticDrillInDelay=300,i._loadingMessageDismissed=!1,i.detectAutomaticDrillInDelay=null,i.featureSets=new n.ObservableCollection,i.searchSuggestion=new n.Observable(i.app.getResource(i.libraryId,"language-common-no-results-desc")),i.app.command("ShowResultsList").register(i,i._showResultsList),i.app.command("SwitchToTabularResultsView").register(i,i._switchToTabularResultsViewImpl,i._canExecuteSwitchToTabularResultsView),i.app.command("RemoveFeatureSetFromResults").register(i,i._executeRemoveFeatureSetFromResults,i._canRemoveFeatureSetFromResults),i.isViewActive.bind(i,function(e){i._featuresInCollectionCount&&i.updateHeaderText(i._featuresInCollectionCount)}),i.featureSets.bind(i,function(e){i.app.event("_underlyingFeatureSetsChanged").publish(e)}),i.isBusy.bind(i,function(e){e?i.isViewActive.get()&&(i.detectAutomaticDrillInDelay&&i._startAutomaticDrillInTimer(),i._showLoadingMessage()):(i._loadingMessageDismissed=!1,i.isViewActive.get()&&(l.showResultsStatusMessage(i.app,i.featureSetCollection.get().countFeatures()),i.detectAutomaticDrillInDelay&&(i._clearAutomaticDrillInTimer(),i._tryAutomaticDrillIn())))}),i}return e(s,t),s.prototype.handleCollectionChanged=function(e){if(t.prototype.handleCollectionChanged.call(this,e),this._clearResetUnderlyingCollection(!0),e&&e.featureSets){this._featureSetsBindingToken=e.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSetCollection=e;for(var s=0,i=e.featureSets.length();s<i;s++)e.featureSets.getAt(s).features.length()<=0||this.featureSets.addItem(e.featureSets.getAt(s))}},s.prototype._showLoadingMessage=function(){this._loadingMessageDismissed||this.app.command("AddResultsStatus").execute(new o.AddStatusArgs(this.app.getResource(this.libraryId,"language-common-loading-results"),null,this._onLoadingMessageDismissed))},s.prototype._onLoadingMessageDismissed=function(){this._loadingMessageDismissed=!0},s.prototype._startAutomaticDrillInTimer=function(){var e=this;this._automaticDrillIn=!0,this._featureSetsLoadTimer||(this._featureSetsLoadTimer=setTimeout(function(){e._automaticDrillIn=!1},this.detectAutomaticDrillInDelay))},s.prototype._clearAutomaticDrillInTimer=function(){this._featureSetsLoadTimer&&(clearTimeout(this._featureSetsLoadTimer),this._featureSetsLoadTimer=0)},s.prototype._tryAutomaticDrillIn=function(){var e=this;this._automaticDrillIn&&1===this.featureSets.length()&&setTimeout(function(){e._performAutomaticDrillIn()},this._performAutomaticDrillInDelay)},s.prototype._performAutomaticDrillIn=function(){1===this.featureSets.length()&&(this.app.command("RemoveResultsStatus").execute(),this.app.event("FeatureSetClickedEvent").publish(this.featureSets.getAt(0)))},s.prototype.updateHeaderText=function(e){this.isViewActive.get()?(t.prototype.updateHeaderText.call(this,e),this._featuresInCollectionCount=null):(this._featuresInCollectionCount=e,t.prototype.updateHeaderText.call(this,0))},s.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},s.prototype._showResultsList=function(e){var t=this._loadFeatureSetCollection(e);t&&this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsList")},s.prototype._loadFeatureSetCollection=function(e){var t;if("string"==typeof e)t=this.app.featureSetManager.getCollectionById(e);else{if(!(e instanceof a.FeatureSetCollection))return;t=e}return t&&t!==this.featureSetCollection.get()&&(this._clearResetUnderlyingCollection(!0),this.featureSetCollection.set(t)),t},s.prototype._switchToTabularResultsViewImpl=function(){this.app.command("ShowResultsTable").execute(this.featureSetCollection.get())},s.prototype._canExecuteSwitchToTabularResultsView=function(){return!!this.featureSetCollection.get()},s.prototype._executeRemoveFeatureSetFromResults=function(e){if(this._canRemoveFeatureSetFromResults(e))return this._removeFeatureSetFromResults(e)},s.prototype._canRemoveFeatureSetFromResults=function(e){var t=this._boundFeatureSetCollection;return!(!t||!e)&&this._existsInCollection(e,t)},s.prototype._removeFeatureSetFromResults=function(e){var t=null;if(e&&this._boundFeatureSetCollection){for(var s=0;s<this._boundFeatureSetCollection.featureSets.getLength();s++)e.id===this._boundFeatureSetCollection.featureSets.getAt(s).id&&(t=s,this._boundFeatureSetCollection.featureSets.removeAt(s));null!=t&&this._notifyFeatureSetCollectionChanged(t);var i=this.getResource("language-common-results-removed-confirmation").format(e.features.length(),this._boundFeatureSetCollection.displayName.get());this.app.command("AddResultsStatus").execute(i)}},s.prototype._existsInCollection=function(e,t){if(!e)return!1;if(!t)throw new Error("FeatureSetCollection is required");for(var s=0;s<t.featureSets.getLength();s++)if(e.id===t.featureSets.getAt(s).id)return!0;return!1},s.prototype._notifyFeatureSetCollectionChanged=function(e){var t={sender:this._boundFeatureSetCollection.featureSets,type:"remove",rangeStart:e,rangeEnd:e},s=new r.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._boundFeatureSetCollection,featureSetCollectionId:this._boundFeatureSetCollection.id,collectionChangedEventArgs:t});this.app.event("FSMCollectionChangedEvent").publish(s)},s.prototype.getFeatureView=function(e){return this._featureViewMap[e]},s.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},s.prototype.unbindFeatureSet=function(){this._featureSetsBindingToken&&this._boundFeatureSetCollection&&(this._boundFeatureSetCollection.featureSets.unbind(this._featureSetsBindingToken),this._featureSetsBindingToken=null,this._boundFeatureSetCollection=null)},s.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.viewMode="grouplist"},s.prototype.applyState=function(e){var t=this;e.promises.push(this.app.project.convert.toGcxFeatureSetCollection(e.state.results).then(function(s){s&&(t._loadFeatureSetCollection(s),"grouplist"!==e.state.viewMode&&"list"!==e.state.viewMode||t.app.command("_setResultMappingCommand").execute(s.sourceName,"ShowResultsList"))}))},s.prototype._pulseFeatureSetsInCollection=function(){t.prototype._pulseFeatureSetsInCollection.call(this)},s.prototype._clearResetUnderlyingCollection=function(e){this.featureSets.clear(),e&&(this.unbindFeatureSet(),this._featureViewMap={})},s}(i.ResultsViewModel);s.FeatureSetCollectionResultsViewModel=u})},"geocortex/infrastructure/results/FeatureSetResultsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewBase","./../FeatureDescriptionPresenterView","./ResultsUtils"],function(t,s,i,n,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i._invisibleClassName="bound-invisible",i._visibleClassName="bound-visible",i._openUpActionsMenuClassName="inline-menu-open-up",i.featureClickedEventName="ResultsListFeatureClickedEvent",i.featurePressedEventName="ResultsListFeaturePressedEvent",i.featureHoveredEventName="ResultsListFeatureHoveredEvent",i.featureHoverEndEventName="ResultsListFeatureHoverEndedEvent",i.itemClass="gcx-list-item",i._subscriptions=null,i._scrollTop=0,i.app.command("ShowFeatureSetResultsView").register(i,i._showFeaturesList,function(e){return!!i.app.featureSetManager.findFeatureSetByUniqueId(e.uniqueId)}),i.app.command("HideFeatureSetResultsView").register(i,i._hideFeatureSetResults),i.app.command("ShowResultsTable").register(i,i._handleShowResultsTable,function(){return!i.app.configuration.mobileMode}),i.app.command("_ExportResultsViewState").register(i,i._exportState),i.app.command("_ApplyResultsViewState").register(i,i._applyState),i}return e(s,t),s.prototype.activated=function(){var e=this;if(this.viewModel.featureSet.get()&&this.viewModel.featureSet.get().features.get()&&0===this.viewModel.featureSet.get().features.get().length)var s=this.app.event("ViewActivatedEvent").subscribe(this,function(t){t.id===e.id&&(e.app.viewManager.deactivateView(e),e.app.event("ViewActivatedEvent").unsubscribe(s),s=null)});else if(!this.isActive){if(t.prototype.activated.call(this),this.viewModel.clearCurrentHighlights(),"all"!==this._highlightMode?this.app.behavior("ResultsPageChangedBehavior").run(this.viewModel.resultsPage.get()):this.app.behavior("AllResultsPageChangedBehavior").run(this.viewModel.featureSet.get()),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var i=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),n=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:i},{eventName:"DataFrameClosedEvent",token:n}]}if(this.resultsList){var a=this.resultsList;setTimeout(function(){dojo.style(a,{display:"block"})},1)}this._viewModelFSCBindingToken||(this._viewModelFSCBindingToken=this.viewModel.featureSetCollection.bind(this,function(t){e.app.trace.debug("View focused in results list: "+e.id),e.app.command("FocusOnFirstInputInView").execute(e)})),this.app.command("RemoveResultsStatus").execute(),this.viewModel.subscribeToEvents(),this.viewModel.bindUnderlyingCollection()}},s.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.isActive=!1,this.viewModel.clearCurrentHighlights(),this.viewModel.unbindUndelryingCollection(),this._viewModelFSCBindingToken&&(this.viewModel.featureSetCollection.unbind(this._viewModelFSCBindingToken),this._viewModelFSCBindingToken=null),this.viewModel.unsubscribeFromEvents(),this._unsubscribeFromEvents()},s.prototype.attach=function(e){var s=this;this.title.sync(e.headerText),void 0!=this.configuration.highlightMode&&(this._highlightMode=this.configuration.highlightMode),void 0!=this.configuration.isPaged&&e.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&e.presentableResults.pageSize.set(this.configuration.pageSize),this.configuration.contentField&&e.contentField.set(this.configuration.contentField),e.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){s.scrollViewTop()}),this.scrollViewTop(this._scrollTop),t.prototype.attach.call(this,e)},s.prototype._showFeaturesList=function(e){this.viewModel.featureSet.get()&&this.viewModel.featureSet.get().isSelectedInCollection.set(!0),this.app.viewManager.activateView(this)},s.prototype.handlePageFirst=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()>1&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(1))},s.prototype.handlePagePrev=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()>1&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()-1))},s.prototype.handlePageNext=function(e,t,s){this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()+1))},s.prototype.handlePageLast=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()&&("all"!==this._highlightMode&&this.viewModel.clearCurrentHighlights(),this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.lastPageNumber.get()))},s.prototype.handleScrollChange=function(e,t,s){s&&(this._scrollTop=t.scrollTop)},s.prototype.getDescription=function(e,t,s){t.title=s.description.get()},s.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},s.prototype.resolveWidget=function(e,s,i){switch(t.prototype.resolveWidget.call(this,e,s),e){case"GetLabel":return(a=new n.FeatureDescriptionPresenterView(this.app,this.libraryId)).contentField="label",a.root=dojo.create("div"),a.root.className="feature-label",a.attach(s),this.viewModel.setFeatureView(s.token+"-label",a),a;case"GetDescription":var a=new n.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField=this.viewModel.contentField.get(),a.root=dojo.create("div"),a.root.className="feature-description",a.attach(s).then(function(){"description"!==a.contentField&&"longDescription"!==a.contentField||!a.hasContent()||a.root.parentElement.classList.remove("bound-invisible")}),this.viewModel.setFeatureView(s.token,a),a;case"FeatureSetActionsWidget":case"FeatureActionsWidget":var r=this.app.menuRegistry.createMenuWidget(this,s,i);if(r)return r;break;default:return}},s.prototype._handleShowResultsTable=function(){this._hideFeatureSetResults()},s.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},s.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},s.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},s.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},s.prototype._applyState=function(e){this.viewModel.applyState(e)},s.prototype._hideFeatureSetResults=function(){this.isActive&&this.app.viewManager.deactivateView(this)},s.prototype.handleFeatureSetFeatureActionClick=function(e,t,s){a.handleInlineMenuActionClick(e,t,this.currentActiveFeatureElement,this.scrollContainerElement,this),this.currentActiveFeatureElement=t.parentElement},s}(i.ResultsViewBase);s.FeatureSetResultsView=r})},"geocortex/infrastructure/results/FeatureSetResultsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewModel","geocortex/framework-ui/ObservableCollectionAggregator","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection","./../eventArgs/ResultsPageChangedEventArgs","geocortex/framework/utils/utils","./../FeatureSet"],function(t,s,i,n,a,r,o,l,u){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var c=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.pageControlsEnabled=new a.Observable(!1),i.resultsList=new a.Observable("results-list"),i.pagingControlClassName=new a.Observable("paging-control no-pages"),i.contentField=new a.Observable("description"),i._featureViewMap={},i.featureSet=new a.Observable(new u.FeatureSet),i.results=new n.ObservableCollectionAggregator(new a.ObservableCollection),i.presentableResults=new r.PresentableCollection(i.results),i.presentableResults.items.useThrottling=!0,i.resultsPage=i.presentableResults.items,i.presentableResults.pageSize.set(i.defaultPageSize),i.defaultIsPaged!=i.presentableResults.isPaginated.get()&&i.presentableResults.isPaginated.set(i.defaultIsPaged),i.app.command("ShowFeatureSetResultsView").register(i,i.showFeaturesList,function(e){return!!i.app.featureSetManager.findFeatureSetByUniqueId(e.uniqueId)}),i}return e(s,t),s.prototype._updateHeaderText=function(e){var t=null,s="";e&&(s=" ("+e+")"),this.featureSet.get()&&(t=this.featureSet.get().displayName.get());var i="{0}{1}".format(t||this.app.getResource(this.libraryId,"language-common-results"),s);this.headerText.set(i)},s.prototype.subscribeEvents=function(){},s.prototype.handlePageResultsChange=function(e){var t=this;if("clear"===(e=e||{type:null}).type)Object.keys(this._featureViewMap).map(function(e){return t._featureViewMap[e]}).forEach(function(e){return t.app.viewManager.destroyView(e)}),this._featureViewMap={};else if("remove"===e.type&&e.sender.value.length>e.rangeStart){var s=e.sender.getAt(e.rangeStart);this._destroyViewForToken(s.token),this._destroyViewForToken(s.token+"-label")}var i="clear"===e.type||"remove"===e.type&&e.sender.value.length<=1,n=new o.ResultsPageChangedEventArgs;n.featureSetCollection=this.app.featureSetManager.findOpenFeatureSetCollectionByFeatureSetUniqueId(this.featureSet.get().uniqueId),n.newValue=i?new a.ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(n),this.app.behavior("ResultsPageChangedBehavior").run(n.newValue.get())},s.prototype.handleFeatureChanged=function(e){if(e&&this._featureViewMap.hasOwnProperty(e.token)){var t=this._featureViewMap[e.token];this._featureViewMap[e.token+"-label"].reattach(e),t.reattach(e)}},s.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},s.prototype.showFeaturesList=function(e){this._clearResetUnderlyingCollection(),this.results.getCollectionSource().addItem(e.features),e&&e!==this.featureSet.get()?(this.featureSet.set(e),this._updateHeaderText(e.features.length())):this.handlePageResultsChange(),this._presentableResultsNumberOfItemsBindingToken||(this._presentableResultsNumberOfItemsBindingToken=this.presentableResults.numberOfItems.bind(this,this._updateHeaderText))},s.prototype.clearCurrentHighlights=function(){var e=this.featureSet.get();e&&e.esriFeatureSet&&this.app.command("ClearFeatureHighlight").execute(e.esriFeatureSet.features)},s.prototype._clearSpecificHighlight=function(e){this.app.command("ClearFeatureHighlight").execute(e)},s.prototype.getFeatureView=function(e){return this._featureViewMap[e]},s.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},s.prototype.exportState=function(e){var t=this.app.project.convert.fromGcxFeatureSet(this.featureSet.get());e.openedFeatureSet=t,e.page=this.presentableResults.currPageNumber.get()},s.prototype.applyState=function(e){var t=this;"list"!==e.state.viewMode&&e.promises.push(this.app.project.convert.toGcxFeatureSet(e.state.openedFeatureSet).then(function(s){s&&(t.showFeaturesList(s),l.isNullOrUndefined(e.state.page)||t.presentableResults.currPageNumber.set(e.state.page))}))},s.prototype._hideIfNoFeaturesLeft=function(e){if(this.featureSet.get()&&this.featureSet.get().features.get()){var t=this.featureSet.get().features.get();0===t.length?(e&&this._clearSpecificHighlight(e),this.app.command("HideFeatureSetResultsView").execute(),this.featureSet.set(null)):1===t.length&&e&&e.featureSet&&e.featureSet.id===this.featureSet.get().id&&this.clearCurrentHighlights()}},s.prototype._pulseUnderlyingCollection=function(){var e=this.presentableResults.currPageNumber.get();this.results.getCollectionSource().pulse(),this.presentableResults.currPageNumber.set(e)},s.prototype._clearResetUnderlyingCollection=function(){this.results.getCollectionSource().clear(),this.presentableResults.currPageNumber.set(1),this._featureViewMap={}},s.prototype.updateHeaderText=function(e){},s.prototype.bindUnderlyingCollection=function(){this._bindObservables(),this._pulseUnderlyingCollection()},s.prototype.unbindUndelryingCollection=function(){this._unbindObservables()},s.prototype._bindObservables=function(){var e=this;this._resultsPageBindingToken||(this._resultsPageBindingToken=this.resultsPage.bind(this,this.handlePageResultsChange)),this._presentableResultsBindingToken||(this._presentableResultsBindingToken=this.presentableResults.numberOfItems.bind(this,function(t){t>0?e.pagingControlClassName.set("paging-control has-pages"):e.pagingControlClassName.set("paging-control no-pages"),e._updateHeaderText(t)}))},s.prototype._unbindObservables=function(){this._resultsPageBindingToken&&(this.resultsPage.unbind(this._resultsPageBindingToken),this._resultsPageBindingToken=null),this._presentableResultsBindingToken&&(this.presentableResults.numberOfItems.unbind(this._presentableResultsBindingToken),this._presentableResultsBindingToken=null)},s.prototype.subscribeToEvents=function(){this._featureChangedEventSubscriptionToken||(this._featureChangedEventSubscriptionToken=this.app.event("FeatureChangedEvent").subscribe(this,this.handleFeatureChanged)),this._underlyingFeatureSetsChangedSubscriptionToken||(this._underlyingFeatureSetsChangedSubscriptionToken=this.app.event("_underlyingFeatureSetsChanged").subscribe(this,this._pulseUnderlyingCollection)),this._featureRemovedFromResultsSubscriptionToken||(this._featureRemovedFromResultsSubscriptionToken=this.app.event("_featureRemovedFromResults").subscribe(this,this._hideIfNoFeaturesLeft)),this._featureDeletedEventSubscriptionToken||(this._featureDeletedEventSubscriptionToken=this.app.event("FeatureDeletedEvent").subscribe(this,this._hideIfNoFeaturesLeft)),this._deleteClickableFeatureStartedSubscriptionToken||(this._deleteClickableFeatureStartedSubscriptionToken=this.app.event("_deleteClickableFeatureStarted").subscribe(this,this._hideIfNoFeaturesLeft))},s.prototype.unsubscribeFromEvents=function(){this._featureChangedEventSubscriptionToken&&(this.app.event("FeatureChangedEvent").unsubscribe(this._featureChangedEventSubscriptionToken),this._featureChangedEventSubscriptionToken=null),this._underlyingFeatureSetsChangedSubscriptionToken&&(this.app.event("_underlyingFeatureSetsChanged").unsubscribe(this._underlyingFeatureSetsChangedSubscriptionToken),this._underlyingFeatureSetsChangedSubscriptionToken=null),this._featureRemovedFromResultsSubscriptionToken&&(this.app.event("_featureRemovedFromResults").unsubscribe(this._featureRemovedFromResultsSubscriptionToken),this._featureRemovedFromResultsSubscriptionToken=null),this._featureDeletedEventSubscriptionToken&&(this.app.event("FeatureDeletedEvent").unsubscribe(this._featureDeletedEventSubscriptionToken),this._featureDeletedEventSubscriptionToken=null),this._deleteClickableFeatureStartedSubscriptionToken&&(this.app.event("_deleteClickableFeatureStarted").unsubscribe(this._deleteClickableFeatureStartedSubscriptionToken),this._deleteClickableFeatureStartedSubscriptionToken=null)},s}(i.ResultsViewModel);s.FeatureSetResultsViewModel=c})},"geocortex/infrastructure/results/FlatResultsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewModel","geocortex/framework-ui/ObservableCollectionAggregator","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection","./../eventArgs/ResultsPageChangedEventArgs","geocortex/framework/utils/utils"],function(t,s,i,n,a,r,o,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var u=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.pageControlsEnabled=new a.Observable(!1),i.resultsList=new a.Observable("results-list"),i.pagingControlClassName=new a.Observable("paging-control no-pages"),i.contentField=new a.Observable("description"),i._featureSetsBindingToken=null,i._boundFeatureSetCollection=null,i._featureViewMap={},i.results=new n.ObservableCollectionAggregator(new a.ObservableCollection),i.presentableResults=new r.PresentableCollection(i.results),i.presentableResults.items.useThrottling=!0,i.resultsPage=i.presentableResults.items,i.presentableResults.pageSize.set(i.defaultPageSize),i.defaultIsPaged!=i.presentableResults.isPaginated.get()&&i.presentableResults.isPaginated.set(i.defaultIsPaged),i.app.command("ShowResultsList").register(i,i.showResultsList),i.app.command("SwitchToTabularResultsView").register(i,i._switchToTabularResultsViewImpl,i._canExecuteSwitchToTabularResultsView),i}return e(s,t),s.prototype.subscribeEvents=function(){t.prototype.subscribeEvents.call(this),this.app.event("FeatureChangedEvent").subscribe(this,this.handleFeatureChanged)},s.prototype.handleCollectionChanged=function(e){if(t.prototype.handleCollectionChanged.call(this,e),this._clearResetUnderlyingCollection(!0),e&&e.featureSets){this._featureSetsBindingToken=e.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSetCollection=e;for(var s=this.results.getCollectionSource(),i=0,n=e.featureSets.length();i<n;i++)s.addItem(e.featureSets.getAt(i).features)}},s.prototype.handleFeatureSetsChanged=function(e){t.prototype.handleFeatureSetsChanged.call(this,e);var s=this.results.getCollectionSource();if("append"===e.type)for(var i=e.sender.getRange(e.rangeStart,e.rangeEnd),n=0;n<i.length;n++)s.addItem(i[n].features);else if("remove"===e.type)for(var a=e.sender.getRange(e.rangeStart,e.rangeEnd),n=0;n<a.length;n++)s.removeItem(a[n].features);else"clear"===e.type&&(this._clearResetUnderlyingCollection(!1),this.results.bindingEvent.publish(e))},s.prototype.handlePageResultsChange=function(e){var t=this;if("clear"===(e=e||{type:null}).type)Object.keys(this._featureViewMap).map(function(e){return t._featureViewMap[e]}).forEach(function(e){return t.app.viewManager.destroyView(e)}),this._featureViewMap={};else if("remove"===e.type&&e.sender.value.length>e.rangeStart){var s=e.sender.getAt(e.rangeStart);this._destroyViewForToken(s.token),this._destroyViewForToken(s.token+"-label")}var i="clear"===e.type||"remove"===e.type&&e.sender.value.length<=1,n=new o.ResultsPageChangedEventArgs;n.featureSetCollection=this.featureSetCollection.get(),n.newValue=i?new a.ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(n),this.app.behavior("ResultsPageChangedBehavior").run(n.newValue.get())},s.prototype.handleFeatureChanged=function(e){if(e&&this._featureViewMap.hasOwnProperty(e.token)){var t=this._featureViewMap[e.token];this._featureViewMap[e.token+"-label"].reattach(e),t.reattach(e)}},s.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},s.prototype.showResultsList=function(e){var t;(t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e)&&t!==this.featureSetCollection.get()?(this.unbindFeatureSet(),this.featureSetCollection.set(t)):this.handlePageResultsChange(),this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsList"),this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)},s.prototype.clearCurrentHighlights=function(){if(this.featureSetCollection.get()){var e=this.presentableResults.items.get();this.app.command("ClearFeatureHighlight").execute(e)}},s.prototype._switchToTabularResultsViewImpl=function(){this.app.command("ShowResultsTable").execute(this.featureSetCollection.get())},s.prototype._canExecuteSwitchToTabularResultsView=function(){return!!this.featureSetCollection.get()},s.prototype.getFeatureView=function(e){return this._featureViewMap[e]},s.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},s.prototype.unbindFeatureSet=function(){this._featureSetsBindingToken&&this._boundFeatureSetCollection&&(this._boundFeatureSetCollection.featureSets.unbind(this._featureSetsBindingToken),this._featureSetsBindingToken=null,this._boundFeatureSetCollection=null)},s.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.page=this.presentableResults.currPageNumber.get(),e.viewMode="list"},s.prototype.applyState=function(e){var t=this;e.promises.push(this.app.project.convert.toGcxFeatureSetCollection(e.state.results).then(function(s){s&&(s!==t.featureSetCollection.get()&&(t.unbindFeatureSet(),t.featureSetCollection.set(s)),l.isNullOrUndefined(e.state.page)||("grouplist"===e.state.viewMode&&(e.state.page=1),t.presentableResults.currPageNumber.set(e.state.page)),"list"!==e.state.viewMode&&"grouplist"!==e.state.viewMode||t.app.command("_setResultMappingCommand").execute(s.sourceName,"ShowResultsList"))}))},s.prototype._pulseFeatureSetsInCollection=function(){var e=this.presentableResults.currPageNumber.get();t.prototype._pulseFeatureSetsInCollection.call(this),this.presentableResults.currPageNumber.set(e)},s.prototype._clearResetUnderlyingCollection=function(e){this.results.getCollectionSource().clear(),this.presentableResults.currPageNumber.set(1),e&&(this.unbindFeatureSet(),this._featureViewMap={})},s.prototype.bindUnderlyingCollection=function(){this._bindObservables(),this._pulseFeatureSetsInCollection()},s.prototype.unbindUndelryingCollection=function(){this._unbindObservables()},s.prototype._bindObservables=function(){var e=this;this._resultsPageBindingToken=this.resultsPage.bind(this,this.handlePageResultsChange),this._presentableResultsBindingToken=this.presentableResults.numberOfItems.bind(this,function(t){t>0?e.pagingControlClassName.set("paging-control has-pages"):e.pagingControlClassName.set("paging-control no-pages"),e.updateHeaderText(t)})},s.prototype._unbindObservables=function(){this._resultsPageBindingToken&&this.resultsPage.unbind(this._resultsPageBindingToken),this._presentableResultsBindingToken&&this.presentableResults.numberOfItems.unbind(this._presentableResultsBindingToken)},s}(i.ResultsViewModel);s.FlatResultsViewModel=u})},"geocortex/infrastructure/results/ResultsAttributeHeaderViewModel":function(){define(["require","exports","geocortex/framework/observables"],function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,i,n){this.sortState=new s.Observable(0),this.sortClass=new s.Observable(""),this._sortingPredicate=null,this._reverseSortingPredicate=null,this.displayName=t.displayName,this._sharedState=e,"DateTime"===i?(this._sortingPredicate=this.buildDateSortingFunction(n),this._reverseSortingPredicate=this.buildReverseDateSortingFunction(n)):(this._sortingPredicate=this.buildSortingFunction(n),this._reverseSortingPredicate=this.buildReverseSortingFunction(n)),this.sortClass.syncTransform(this.sortState,function(t){switch(t){case 0:return e.unsortedClass;case 1:return e.sortedClass;case 2:return e.reverseSortedClass}return e.unsortedClass}),this.sortState.bind(this,this.onSortStateChange)}return e.prototype.buildSortingFunction=function(e){return function(s,i){return t.collator(s.attributes.getAt(e).presentableValue.get(),i.attributes.getAt(e).presentableValue.get())}},e.prototype.buildReverseSortingFunction=function(e){return function(s,i){return t.collator(i.attributes.getAt(e).presentableValue.get(),s.attributes.getAt(e).presentableValue.get())}},e.prototype.buildDateSortingFunction=function(e){return function(s,i){var n=s.attributes.getAt(e).value.get(),a=i.attributes.getAt(e).value.get(),r=new Date(n),o=new Date(a),l="Invalid Date"!=r;return l!==("Invalid Date"!=o)?l?-1:1:l?r.getTime()-o.getTime():t.collator(n,a)}},e.prototype.buildReverseDateSortingFunction=function(e){return function(s,i){var n=i.attributes.getAt(e).value.get(),a=s.attributes.getAt(e).value.get(),r=new Date(n),o=new Date(a),l="Invalid Date"!=r;return l!==("Invalid Date"!=o)?l?-1:1:l?r.getTime()-o.getTime():t.collator(n,a)}},e.prototype.onSortStateChange=function(e){if(!this._sharedState.ignoreStateChange){if(e<0||e>2)throw new Error("Illegal column sort state: "+e);if(0==e){if(this._sharedState.lastSortedColumn!=this)throw new Error("Column sort state out of sync");this._sharedState.lastSortedColumn=null,this._sharedState.presentableResults.sortingPredicate=null,this._sharedState.presentableResults.unsortCollection()}else{if(null!=this._sharedState.lastSortedColumn&&this._sharedState.lastSortedColumn!=this&&(this._sharedState.ignoreStateChange=!0,this._sharedState.lastSortedColumn.sortState.set(0),this._sharedState.ignoreStateChange=!1),this._sharedState.lastSortedColumn=this,1==e)this._sharedState.presentableResults.sortingPredicate=this._sortingPredicate;else{if(2!=e)throw new Error("Invalid column sort state.");this._sharedState.presentableResults.sortingPredicate=this._reverseSortingPredicate}this._sharedState.presentableResults.sortCollection()}}},e}();t.ResultsAttributeHeaderViewModel=i,t.manualCollator=function(e,t){return isNaN(e)||isNaN(t)?e<t?-1:e>t?1:0:+e-t},t.collator="object"==typeof Intl&&"function"==typeof Intl.Collator?new Intl.Collator(void 0,{numeric:!0}).compare:t.manualCollator;var n=function(){function e(e,t,s,i){this.lastSortedColumn=null,this.presentableResults=e,this.unsortedClass=t,this.sortedClass=s,this.reverseSortedClass=i,this.reset()}return e.prototype.reset=function(){this.ignoreStateChange=!1,this.lastSortedColumn=null},e}();t.SharedState=n})},"geocortex/infrastructure/results/ResultsFeatureActionsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=function(t){function s(){return null!==t&&t.apply(this,arguments)||this}return e(s,t),s.prototype.handleMenuItemClick=function(e,t,s){s.execute(this.viewModel.currentFeature.get())},s.prototype.handleGetDescription=function(e,t,s){t.title=s.description.get()},s}(i.ViewBase);s.ResultsFeatureActionsView=n})},"geocortex/infrastructure/results/ResultsListView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewBase","./../FeatureDescriptionPresenterView"],function(t,s,i,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.featureClickedEventName="ResultsListFeatureClickedEvent",i.featurePressedEventName="ResultsListFeaturePressedEvent",i.featureHoveredEventName="ResultsListFeatureHoveredEvent",i.featureHoverEndEventName="ResultsListFeatureHoverEndedEvent",i.itemClass="list-menu-item",i._subscriptions=null,i._scrollTop=0,i.app.command("ShowResultsList").register(i,i.showResultsList),i.app.command("ShowResultsTable").register(i,i._handleShowResultsTable,function(){return!i.app.configuration.mobileMode}),i.app.command("SwitchToTabularResultsView").register(i,i._switchToTabularResultsViewImpl,i._canExecuteSwitchToTabularResultsView),i.app.command("_ExportResultsViewState").register(i,i._exportState),i.app.command("_ApplyResultsViewState").register(i,i._applyState),i.app.event("ViewContainerViewClosedEvent").subscribe(i,function(e){e.viewId===i.id&&i.configuration.clearCollectionOnClose&&i.viewModel.featureSetCollection.get().clear()}),i}return e(s,t),s.prototype.activated=function(){var e=this;if(t.prototype.activated.call(this),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var s=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),i=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:s},{eventName:"DataFrameClosedEvent",token:i}]}if(this.resultsList){var n=this.resultsList;setTimeout(function(){dojo.style(n,{display:"block"})},1)}this.viewModel.featureSetCollection.bind(this,function(t){e.app.trace.debug("View focused in results list: "+e.id),e.app.command("FocusOnFirstInputInView").execute(e)}),this.viewModel.bindUnderlyingCollection()},s.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel.clearCurrentHighlights(),this.viewModel.unbindUndelryingCollection(),this._unsubscribeFromEvents()},s.prototype.attach=function(e){var s=this;this.title.sync(e.headerText),this.isBusy.sync(e.isBusy),void 0!=this.configuration.isPaged&&e.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&e.presentableResults.pageSize.set(this.configuration.pageSize),this.configuration.contentField&&e.contentField.set(this.configuration.contentField),e.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){s.scrollViewTop()}),this.scrollViewTop(this._scrollTop),t.prototype.attach.call(this,e)},s.prototype.showResultsList=function(e){this.app.viewManager.activateView(this)},s.prototype.handlePageFirst=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.presentableResults.currPageNumber.set(1)},s.prototype.handlePagePrev=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()-1)},s.prototype.handlePageNext=function(e,t,s){this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()+1)},s.prototype.handlePageLast=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.lastPageNumber.get())},s.prototype.handleScrollChange=function(e,t,s){s&&(this._scrollTop=t.scrollTop)},s.prototype.getDescription=function(e,t,s){t.title=s.description.get()},s.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},s.prototype.resolveWidget=function(e,s,i){switch(t.prototype.resolveWidget.call(this,e,s),e){case"GetLabel":return(a=new n.FeatureDescriptionPresenterView(this.app,this.libraryId)).contentField="label",a.root=dojo.create("div"),a.root.className="feature-label",a.attach(s),this.viewModel.setFeatureView(s.token+"-label",a),a;case"GetDescription":var a=new n.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField=this.viewModel.contentField.get(),a.root=dojo.create("div"),a.root.className="feature-description",a.attach(s),this.viewModel.setFeatureView(s.token,a),a;case"ResultsListActionsWidget":var r=this.app.menuRegistry.createMenuWidget(this,s,i);if(r)return r;break;default:return}},s.prototype._handleShowResultsTable=function(){this.app.viewManager.deactivateView(this)},s.prototype._switchToTabularResultsViewImpl=function(){this.app.command("CloseDataFrame").execute()},s.prototype._canExecuteSwitchToTabularResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},s.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},s.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},s.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},s.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},s.prototype._applyState=function(e){this.viewModel.applyState(e)},s}(i.ResultsViewBase);s.ResultsListView=a})},"geocortex/infrastructure/results/ResultsModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase","./../FeatureSetCollection","./../validation/NumberValidator","./../PromiseUtils","./../commandArgs/AddStatusArgs","geocortex/geocortex","./../FeatureSet","geocortex/essentials/Field","./../FormatUtils"],function(t,s,i,n,a,r,o,l,u,c,d){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype.toJSONString=function(){return JSON.stringify({name:this.name,featureSet:this.featureSet.toJson()})},e}(),g=function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e._supportedFormats=["csv","xlsx","shp"],e._showInvisibleAttributes=!1,e._enableDataLinkObjectIdFieldOnExport=!0,e._featureIndexName="GCX_OID",e._featureIndexRoundUpPerFeatureSet=1e3,e._includeDataLinksOnExport=!0,e}return e(s,t),s.prototype.initialize=function(e){var s=this;t.prototype.initialize.call(this,e),e&&(this.resultMappings=e.resultMappings,e.customSearchSuggestions&&this.app.featureSetManager.addSearchSuggestions(e.customSearchSuggestions),e.showInvisibleAttributesOnExport&&(this._showInvisibleAttributes=e.showInvisibleAttributesOnExport),void 0!==e.includeDataLinksOnExport&&null!==e.includeDataLinksOnExport&&(this._includeDataLinksOnExport=!!e.includeDataLinksOnExport),void 0!==e.enableDataLinkObjectIdFieldOnExport&&null!==e.enableDataLinkObjectIdFieldOnExport&&(this._enableDataLinkObjectIdFieldOnExport=!!e.enableDataLinkObjectIdFieldOnExport),"string"==typeof e.gcxObjectIdFieldNameOnExport&&""!==e.gcxObjectIdFieldNameOnExport&&(this._featureIndexName=e.gcxObjectIdFieldNameOnExport.trim())),this.wireUpResultMapping(),this.app.command("ExportResultsTo").register(this,function(e){var t="csv";if(e.fsc instanceof u.FeatureSet){var i=new n.FeatureSetCollection;i.featureSets.addItem(e.fsc),e.fsc=i}e.fsc?(e.format?-1===s._supportedFormats.indexOf(e.format)?s.app.trace.warning("ExportResultsTo: {0} file format not recognized. Defaulting to csv.".format(e.format)):t=e.format:s.app.trace.warning("ExportResultsTo: file format not specified. Defaulting to csv."),s.exportTo({fsc:e.fsc,format:t})):s.app.trace.error("ExportResultsTo: Cannot export, no feature set collection specified.")},this.exportToCanExecute)},s.prototype.getStateFilter=function(){var e=this,t=new a.NumberValidator;return function(s){var i={};return i.serialVersion=!0,i.featureSetCollections={item:e.app.project.filter.featureSetCollection},i.results=e.app.project.filter.featureSetCollection,i.viewMode=!0,i.page=t,i.tableOptions={sortColumn:t,sortDirection:!0},2==s.serialVersion?i.openedFeatureSet=e.app.project.filter.featureSet:i.tableOptions.selectedFeatureSet=e.app.project.filter.featureSet,i}},s.prototype.exportState=function(){var e=this,t={featureSetCollections:this.app.featureSetManager.featureSetCollections.get().map(function(t){return e.app.project.convert.fromGcxFeatureSetCollection(t)})};return Promise.try(function(){return e.app.command("_ExportResultsViewState").execute(t),t.serialVersion=2,t})},s.prototype.applyState=function(e){var t=this;return r.PromiseUtils.mapSkipRejected(e.featureSetCollections,function(e){return t.app.project.convert.toGcxFeatureSetCollection(e)}).then(function(){return t.app.waitUntilAllLibrariesLoaded()}).then(function(){var s={state:e,promises:[]};return t.app.command("_ClearIsSelected").execute(),t.app.command("_ApplyResultsViewState").execute(s),Promise.all(s.promises).return()})},s.prototype.wireUpResultMapping=function(){this.app.event("FSMCollectionOpenedEvent").subscribe(this,this.fsmCollectionOpenedHandler),this.app.command("_setResultMappingCommand").register(this,this.fsmCollectionSetCommand),this.app.command("FSMCollectionSetCommand").register(this,this.fsmCollectionSetCommand)},s.prototype.fsmCollectionOpenedHandler=function(e){var t=e.featureSetCollection;if(this.resultMappings){var s=this.resultMappings[t.sourceName];if(s)for(var i=0;i<s.length;i++){var n=s[i];this.app.command(n).execute(t.id),this._lastCommand=n}}},s.prototype.fsmCollectionSetCommand=function(e,t){if(t){var s=null;if("ShowResultsList"===t?s="ShowResultsTable":"ShowResultsTable"===t&&(s="ShowResultsList"),s&&this.resultMappings&&this.resultMappings[e]){var i=this.resultMappings[e],n=i.indexOf(s);n>-1?i[n]=t:-1===i.indexOf(t)&&i.push(t)}}},s.prototype.exportTo=function(e){var t=this,s=new o.AddStatusArgs(this.app.getResource(this.libraryId,"language-results-export-to-status-message").format(e.format)),i="exportTo "+e.format+"StatusMessage";s.id=i,s.showBusyIcon=!0,this.app.command("AddStatus").execute(s);var n=this.app.site.url,a=n.substring(0,n.toLowerCase().lastIndexOf("/sites/"))+"/Utilities/Extract";this.fscToJson(e.fsc,this._includeDataLinksOnExport).then(function(s){l.request({url:a,content:{format:e.format,featureSets:s,f:"json"},load:dojo.hitch(t,function(s){return t.exportToSuccess(s,e.format)}),error:dojo.hitch(t,function(s){return t.exportToError(s,i,e.format)})})},function(s){t.exportToError(s,i,e.format)})},s.prototype.exportToSuccess=function(e,t){var s=this;if(e&&e.hasOwnProperty("href")){var i=e.href,n=this.app.getResource(this.libraryId,"language-results-export-to-confirm-content").format(t),a=this.app.getResource(this.libraryId,"language-results-export-to-confirm-title").format(t),r="exportTo "+t+"StatusMessage";this.app.command("RemoveStatus").execute(r),this.app.commandRegistry.command("Confirm").execute(n,a,function(e){e&&(s.app.isNative.get()?window.open(i,"_blank"):window.location.assign(i))})}},s.prototype.exportToError=function(e,t,s){this.app.command("RemoveStatus").execute(t),this.app.commandRegistry.command("Alert").execute(e.message,this.app.getResource(this.libraryId,"language-results-export-to-alert-error-message").format(s))},s.prototype.exportToCanExecute=function(e){var t=null;if(e)if(e instanceof n.FeatureSetCollection)t=e;else if(e.fsc&&e.fsc instanceof n.FeatureSetCollection)t=e.fsc;else if(e instanceof u.FeatureSet)(s=new n.FeatureSetCollection).featureSets.addItem(e),t=s;else if(e.fsc instanceof u.FeatureSet){var s=new n.FeatureSetCollection;s.featureSets.addItem(e.fsc),t=s}return t&&t.featureSets.get()&&t.featureSets.get().length>0},s.prototype.getFields=function(e){var t=[];return e.esriFeatureSet&&e.esriFeatureSet.features&&e.esriFeatureSet.features.length>0&&(t=this.getFieldsFromEsriLayer(e.esriFeatureSet.features[0].getLayer(),e)),0===t.length&&(e.layer&&e.layer.fields&&e.layer.fields.length>0?t=this.getFieldsFromEssentialsLayer(e.layer):e.attributes.get()&&e.attributes.get().length>0?t=this.getFieldsFromGcxFeatureSetAttributes(e.attributes.get(),e):e.features.get()&&e.features.get().length>0&&e.features.getAt(0).attributes.get()&&e.features.getAt(0).attributes.get().length>0?t=this.getFieldsFromGcxFeatureAttributes(e.features.getAt(0).attributes.get(),e):e.esriFeatureSet&&e.esriFeatureSet.features&&e.esriFeatureSet.features.length>0&&e.esriFeatureSet.features[0].attributes&&e.esriFeatureSet.features[0].attributes.length>0?t=this.getFieldsFromEsriFeatureAttributeValues(e.esriFeatureSet.features):e.features.get()&&e.features.get().length>0&&e.features.getAt(0).attributes.get()&&e.features.getAt(0).attributes.get().length>0&&(t=this.getFieldsFromGcxFeatureAttributeValues(e.features.get()))),t},s.prototype.getFieldsFromEsriLayer=function(e,t){var s=[];if(e&&e.fields&&(s=e.fields.slice(0),t&&t.features.get()&&t.features.getAt(0).attributes.get())){var i=t.features.getAt(0).attributes.get();i.length===s.length&&i.forEach(function(e,t){s[t].alias=e.displayName.get()?e.displayName.get():s[t].alias})}return s},s.prototype.getFieldsFromEssentialsLayer=function(e){var t=[],s=new esri.layers.Field;return e.fields.forEach(function(e){(s=new esri.layers.Field).name=e.name,s.alias=e.displayName,s.type=c.Field.convertToEsriFieldType(e.dataType),t.push(s)}),t},s.prototype.getFieldsFromGcxFeatureSetAttributes=function(e,t){var s=this,i=[],n=new esri.layers.Field;return e.forEach(function(e,a){(n=new esri.layers.Field).name=e.name.get(),n.alias=e.displayName.get(),e.type.get()?n.type=c.Field.convertToEsriFieldType(e.type.get()):t.features.get().length>0&&t.features.getAt(0).attributes.get()&&t.features.getAt(0).attributes.get().length>0?n.type=s.getTypeFromGcxFeatures(t.features.get(),a):n.type=s.getEsriTypeFromValue(null),i.push(n)}),i},s.prototype.getFieldsFromGcxFeatureAttributes=function(e,t){var s=this,i=[],n=new esri.layers.Field;return e.forEach(function(e,a){(n=new esri.layers.Field).name=e.name.get(),n.alias=e.displayName.get(),e.type.get()?n.type=c.Field.convertToEsriFieldType(e.type.get()):n.type=s.getTypeFromGcxFeatures(t.features.get(),a),i.push(n)}),i},s.prototype.getFieldsFromEsriFeatureAttributeValues=function(e){var t=0,s=[],i=new esri.layers.Field,n=e[0].attributes,e=e;for(var a in n)n.hasOwnProperty(a)&&((i=new esri.layers.Field).name=a,i.alias=a,i.type=this.getTypeFromEsriFeatures(e,t),s.push(i),t++);return s},s.prototype.getFieldsFromGcxFeatureAttributeValues=function(e){var t=0,s=[],i=new esri.layers.Field,n=e[0].attributes.get(),e=e;for(var a in n)n.hasOwnProperty(a)&&((i=new esri.layers.Field).name=a,i.alias=a,i.type=this.getTypeFromGcxFeatures(e,t),s.push(i),t++);return s},s.prototype.getTypeFromEsriFeatures=function(e,t){var s=this,i=this.getEsriTypeFromValue(null);return e.forEach(function(e){var n=e.attributes[t];n&&(i=s.getEsriTypeFromValue(n))}),i},s.prototype.getTypeFromGcxFeatures=function(e,t){var s=this,i=this.getEsriTypeFromValue(null);return e.forEach(function(e){var n=e.attributes.getAt(t).value.get();n&&(i=s.getEsriTypeFromValue(n))}),i},s.prototype.getEsriTypeFromValue=function(e){var t="esriFieldTypeString";return"number"==typeof e?t="esriFieldTypeDouble":e instanceof Date&&(t="esriFieldTypeDate"),t},s.prototype._getDataLinksAsFscItems=function(e){var t=this;return new Promise(function(s,i){if(e.layer&&e.layer.hasDataLinks&&e.layer.dataLinks.some(function(e){return!e.isOneToOne})){var n=[],a=function(e){if(!e||!e.dataLink||!e.dataLink.get()||e.dataLink.get().isOneToOne)return null;var s=n.filter(function(t){return t.name===e.dataLink.get().displayName})[0];if(s)return s;var i=t._enableDataLinkObjectIdFieldOnExport?t._featureIndexName:null;return t._generateFscCollItem(e.dataLink.get().displayName,e.table.get(),n,i)},r=function(e){e.features.get().forEach(function(e,s){for(var i=e.dataLinkingResults.get(),r=0;r<i.length;r++)!function(){var s=i[r],o=a(s);if(o&&s.dataLink&&s.dataLink.get()&&!s.dataLink.get().isOneToOne){var l=s.table.get();l.rows.forEach(function(s){var i={},a=0;void 0!==e[t._featureIndexName]&&null!==e[t._featureIndexName]&&(i[t._getFieldName(t._featureIndexName)]=e[t._featureIndexName],a=1);var u=s.row;l.columns.forEach(function(e,s){var o=t._getFieldName(e),l=d.format(u[s]),p=n[r].featureSet.fields;if(p&&p[s+a]){var g=p[s+a].type;g===c.EsriFieldTypes.esriFieldTypeDouble?i[o]=d.parseNumber(l):g===c.EsriFieldTypes.esriFieldTypeDate?i[o]=d.parseUtcDate(l):i[o]=l}});var p=new esri.Graphic(null,null,i,null);o.featureSet.features.push(p)})}}()}),s(n)};!0===e.dataLinksResolved.get()?r(e):(t.app.trace.info("Waiting for feature set {0} datalinks to resolve before processing export command.".format(e.displayName.get()?"("+e.displayName.get()+")":"")),e.doWhenDataLinkingCompleted(r),e.dataLinksState===u.DataLinksState.Unresolved&&e.resolveDataLinks(null,!0,null,null,function(e,t){i(new Error("Error resolving datalinks for feature set {0} while processing export command.".format(e&&e.displayName.get()?"("+e.displayName.get()+")":"")))}))}else i(new Error("This feature set either does not contain data links or only contains one-to-one datalinks."))})},s.prototype._generateFscCollItem=function(e,t,s,i){var n=this,a=t.columns,r=t.rows[0].row,o=new p;o.name=e,o.featureSet=new esri.tasks.FeatureSet;var l=[];if(i){var u=new esri.layers.Field;u.name=this._getFieldName(i),u.alias=i,u.type="esriFieldTypeDouble",l.push(u)}a.forEach(function(e,t){var s=new esri.layers.Field;s.name=n._getFieldName(e),s.alias=e,s.type=n.getEsriTypeFromValue(r[t]),l.push(s)}),o.featureSet.fields=l,o.featureSet.displayFieldName=this._getFieldName(a[0]);var c=0;return s.forEach(function(e){o.name===e.name&&(c+=1)}),c>0&&(o.name=o.name+c),s.push(o),o},s.prototype._getFieldName=function(e){return e.toUpperCase().replace(/ /g,"_").trim()},s.prototype.getFeatureSets=function(e,t){var s=this;return void 0===t&&(t=!1),new Promise(function(i,a){if(e&&e instanceof n.FeatureSetCollection){var r=new esri.tasks.FeatureSet,o=new esri.Graphic,l=[],u=e.featureSets.get().filter(function(e){return!!e.layer&&e.layer.hasDataLinks&&e.layer.dataLinks.some(function(e){return!e.isOneToOne})}).length,g=0,h=0,b=function(){t&&g!==u||i(l)};e.featureSets.get().forEach(function(i,n){var a=s.getFields(i);r=new esri.tasks.FeatureSet;var u=!1,f=!!i.layer&&i.layer.hasDataLinks&&i.layer.dataLinks.some(function(e){return!e.isOneToOne});if(i&&i.features.get()&&i.features.get().length>0){var m=[],v=[];i.features.getAt(0).attributes.get().forEach(function(e){e.visible.get()||s._showInvisibleAttributes?m.push(e.name.get()):v.push(e.name.get())}),u=m.some(function(e){return e===s._featureIndexName}),i.features.get().forEach(function(e,n){var l={},p=e.esriFeature.get().attributes;e.getAttributes().forEach(function(e){if(e.visible.get()||s._showInvisibleAttributes){var t,i=e.name.get(),n=e.presentableValue.get();for(var r in a){var o=a[r];if(o.name===e.name.get()){t=o.type;var u=a.filter(function(e){return-1!==e.name.indexOf(".Name()",e.name.length-".Name()".length)&&e.name.substr(0,e.name.length-".Name()".length)===o.name});if(u&&u.length>0){var g=u[0].name;if(g&&p&&p.hasOwnProperty(g)){var h=p[o.name],b=h;h=n,n=b,l[g]=h}}break}}n&&i&&(o&&o.domain&&"codedValue"==o.domain.type?(o.type=c.EsriFieldTypes.esriFieldTypeString,l[i]=e.presentableValue.get()):!o||o.type!==c.EsriFieldTypes.esriFieldTypeDouble&&o.type!==c.EsriFieldTypes.esriFieldTypeSingle?t===c.EsriFieldTypes.esriFieldTypeInteger||o&&o.type===c.EsriFieldTypes.esriFieldTypeSmallInteger?l[i]=Math.floor(d.parseNumber(e.value.get())):t===c.EsriFieldTypes.esriFieldTypeDate?l[i]=d.parseDate(e.value.get()):l[i]=n:l[i]=d.parseNumber(e.value.get()))}}),r.displayFieldName=i.esriFeatureSet.displayFieldName,o=new esri.Graphic(e.esriFeature.get().geometry,null,l,null),r.features.push(o),t&&f&&!u&&s._enableDataLinkObjectIdFieldOnExport&&(0===n&&(h=Math.ceil(h/s._featureIndexRoundUpPerFeatureSet)*s._featureIndexRoundUpPerFeatureSet),e[s._featureIndexName]=h,o.attributes[s._featureIndexName]=h,h++)})}if(r.features.length>0){if(a&&a.length>0){var C=[];a.forEach(function(e){-1==$.inArray(e.name,v)&&C.push(e)}),r.fields=C}var S=new p;S.name=e.featureSets.getAt(n).displayName.get(),S.featureSet=r;var w=0;l.forEach(function(e){S.name===e.name&&(w+=1)}),w>0&&(S.name=S.name+w),l.push(S),t&&f&&(!u&&s._enableDataLinkObjectIdFieldOnExport&&S.featureSet.fields.unshift({name:s._getFieldName(s._featureIndexName),alias:s._featureIndexName,type:"esriFieldTypeDouble"}),s._getDataLinksAsFscItems(i).then(function(e){e&&e.length&&l.push.apply(l,e),g++,b()},function(e){s.app.trace.error(e.message),g++,b()}))}}),(!t||t&&0===u)&&b()}else a(new Error("ResultsModule: getFeatureSets error. Invalid input arguments."))})},s.prototype.fscToJson=function(e,t){var s=this;return void 0===t&&(t=!0),new Promise(function(i,n){s.getFeatureSets(e,t).then(function(e){var t="[";e.forEach(function(e,s,i){var n=new p;n.featureSet=e.featureSet,n.name=e.name,t+=n.toJSONString(),s!==i.length-1&&(t+=",")}),i(t+="]")},function(e){n(e)})})},s}(i.ModuleBase);s.ResultsModule=g})},"geocortex/infrastructure/results/ResultsState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/results/ResultsTableView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewBase","./../ui/components/Table/TableViewModel"],function(t,s,i,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.featureClickedEventName="ResultsTableFeatureClickedEvent",i.featurePressedEventName="ResultsTableFeaturePressedEvent",i.featureHoveredEventName="ResultsTableFeatureHoveredEvent",i.featureHoverEndEventName="ResultsTableFeatureHoverEndedEvent",i.scrollContainerElement=null,i.tabContainerElement=null,i.tabElements=null,i.scrollTabLeftElement=null,i.scrollTabRightElement=null,i._fsBindingToken=null,i._boundFs=null,i.app.command("ShowResultsTable").register(i,i.showResultsTable,function(){return!i.app.configuration.mobileMode}),i.app.command("ShowResultsList").register(i,i._handleShowResultsList),i.app.command("_ExportResultsViewState").register(i,i._exportState),i.app.command("_ApplyResultsViewState").register(i,i._applyState),i.app.event("ViewContainerViewClosedEvent").subscribe(i,function(e){e.viewId===i.id&&!1!==i.configuration.clearCollectionOnClose&&i.viewModel.featureSetCollection.get().clear()}),i}return e(s,t),s.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel.clearCurrentHighlights(),this.viewModel.unbindUnderlyingCollections()},s.prototype.activated=function(){this.viewModel.bindUnderlyingCollections()},s.prototype.attach=function(e){var s=this;this.title.sync(e.headerText),this.isBusy.sync(e.isBusy),void 0!=this.configuration.isPaged&&e.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&e.presentableResults.pageSize.set(this.configuration.pageSize),e.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){var e=s.viewModel.curFeatureSet.get(),t=e?s.viewModel.currScrollPosWithinTab[e.uniqueId]||0:0;s.scrollView(t)}),t.prototype.attach.call(this,e)},s.prototype.resolveWidget=function(e,s,i){switch(t.prototype.resolveWidget.call(this,e,s),e){case"ResultsTableActionsWidget":return this.app.menuRegistry.createMenuWidget(this,s,i);case"TableViewWidget":var a=this.viewModel,r=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableView",markupResource:"Mapping/infrastructure/ui/components/Table/TableView.html",libraryId:this.libraryId,isVisible:!0});if(r){var o=new n.TableViewModel(this.app,this.libraryId);o.addRecordClickEvents(this.featureClickedEventName),o.addRecordLongPressEvents(this.featurePressedEventName),o.addRecordHoverEvents(this.featureHoveredEventName),o.addRecordHoverEndEvents(this.featureHoverEndEventName),o.columnHeaders=this.viewModel.columnHeaders,o.attachToPresentableCollection(a.presentableResults),r.attach(o),this.scrollContainerElement=r.tableContainerElement}return r;default:this.app.trace.warning("ResultsTableView: Unknown Widget")}},s.prototype.showResultsTable=function(e){var t=this;this.app.viewManager.activateView(this),this.viewModel.featureSetCollection.get()&&(this._unbindFromPrevFeatureSet(),this._boundFs=this.viewModel.featureSetCollection.get().featureSets,this._boundFs&&(this._fsBindingToken=this.viewModel.featureSetCollection.get().featureSets.bind(this,this._refreshTabControlVisibility)));var s=null,i=this.app.event("ApplicationResizedEvent").subscribe(this,function(){t.isActive?(s&&(clearTimeout(s),s=null),s=setTimeout(function(){t._refreshTabControlVisibility()},200)):(t.app.event("ApplicationResizedEvent").unsubscribe(i),i=null)});this._refreshTabControlVisibility()},s.prototype._refreshTabControlVisibility=function(){var e=this;setTimeout(function(){e.tabContainerElement&&e.tabElements&&(e.viewModel.tabControlsEnabled.set(e.tabElements.offsetWidth>e.tabContainerElement.offsetWidth),e._updateScrollTabDisabledStatus())},100)},s.prototype.handleTabClick=function(e,t,s){this.scrollContainerElement&&(this.viewModel.currScrollPosWithinTab[this.viewModel.curFeatureSet.get().uniqueId]=this.scrollContainerElement.scrollTop);var i=dojo.filter(this.viewModel.featureSetCollection.get().featureSets.get(),function(e){return e.uniqueId===s.uniqueId});i&&i[0]&&this.viewModel.curFeatureSet.get()!==i[0]&&(this.viewModel.clearCurrentHighlights(),this.viewModel.setCurrentSelectedFeatureSet(i[0]),this.viewModel.setCurrentPageWithinTab(s.uniqueId)),this.app.command("FocusOnFirstInputInView").execute(this)},s.prototype.handlePageFirst=function(e,t,s){this.viewModel.presentableResults.currPageNumber.get()>1&&(this.viewModel.updateCurrentPageAndScrollPosWithinTab(1,0),this.viewModel.presentableResults.currPageNumber.set(1))},s.prototype.handlePagePrev=function(e,t,s){if(this.viewModel.presentableResults.currPageNumber.get()>1){var i=this.viewModel.presentableResults.currPageNumber.get()-1;this.viewModel.updateCurrentPageAndScrollPosWithinTab(i,0),this.viewModel.presentableResults.currPageNumber.set(i)}},s.prototype.handlePageNext=function(e,t,s){if(this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()){var i=this.viewModel.presentableResults.currPageNumber.get()+1;this.viewModel.updateCurrentPageAndScrollPosWithinTab(i,0),this.viewModel.presentableResults.currPageNumber.set(i)}},s.prototype.handlePageLast=function(e,t,s){if(this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()){var i=this.viewModel.presentableResults.lastPageNumber.get();this.viewModel.updateCurrentPageAndScrollPosWithinTab(i,0),this.viewModel.presentableResults.currPageNumber.set(i)}},s.prototype.handleTabScrollBack=function(e,t,s){var i=$(this.tabContainerElement),n=i.scrollLeft()-2*this.scrollTabLeftElement.offsetWidth;i.scrollLeft(n<0?0:n),this._updateScrollTabDisabledStatus()},s.prototype.handleTabScrollForward=function(e,t,s){var i=$(this.tabContainerElement),n=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth,a=i.scrollLeft()+2*this.scrollTabRightElement.offsetWidth;i.scrollLeft(a>n?n:a),this._updateScrollTabDisabledStatus()},s.prototype.handleClickFeature=function(e,t,s){this.app.event("ResultsTableFeatureClickedEvent").publish(s)},s.prototype.handleColumnHeadClick=function(e,t,s){s.sortState.set((s.sortState.get()+1)%3)},s.prototype._handleShowResultsList=function(){this.app.viewManager.deactivateView(this)},s.prototype._canExecuteSwitchToListResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},s.prototype._updateScrollTabDisabledStatus=function(){if(this.tabContainerElement){var e=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth;this.viewModel.leftScrollTabDisabled.set(0===this.tabContainerElement.scrollLeft),this.viewModel.rightScrollTabDisabled.set(this.tabContainerElement.scrollLeft>e-1)}},s.prototype._unbindFromPrevFeatureSet=function(){this._fsBindingToken&&this._boundFs&&this._boundFs.unbind(this._fsBindingToken),this._fsBindingToken=this._boundFs=null},s.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},s.prototype._applyState=function(e){this.viewModel.applyState(e)},s}(i.ResultsViewBase);s.ResultsTableView=a})},"geocortex/infrastructure/results/ResultsUtils":function(){define(["require","exports"],function(e,t){"use strict";function s(e){return e?e.firstElementChild:null}function i(e,t){var i=s(e);i&&i.classList.contains(l)&&(t.app.event("FlyoutDeactivated").publish(t),i.classList.remove(u),i.classList.remove(l),i.classList.add(o))}function n(e,t){if(!t||!e)return!0;var s=t.getBoundingClientRect();return e.getBoundingClientRect().bottom<=s.bottom}function a(e,t,s){if(!t||!e)return!0;var i=t.getBoundingClientRect(),n=e.getBoundingClientRect();return i.top<=n.top-n.height-s.clientHeight}function r(e,t,i,r){var c=s(e);c&&c.classList.contains(o)&&(c.classList.remove(o),c.classList.add(l),!n(c,t)&&a(c,t,i)&&c.classList.add(u),r.app.event("FlyoutActivated").publish(r))}Object.defineProperty(t,"__esModule",{value:!0});var o="bound-invisible",l="bound-visible",u="inline-menu-open-up";t.showResultsStatusMessage=function(e,t){t&&t>0?e.command("AddResultsStatus").execute(t+" "+e.getResource("Mapping.Infrastructure","language-common-results-found")):e.command("AddResultsStatus").execute(e.getResource("Mapping.Infrastructure","language-common-no-results"))},t.handleInlineMenuActionClick=function(e,t,n,a,l){var u=t.parentElement;if(n&&n!==u&&i(n,l),n=u,s(n)&&s(n).classList.contains(o)){var c={view:l,onOtherInteracted:function(e){i(n,l)},onElementInteracted:function(e){($(e.srcElement||e.target).hasClass("gcx-list-menu")||$(e.srcElement||e.target).hasClass("paging-buttons"))&&i(n,l)}};l.app.command("TapToDismiss").execute(c),r(n,a,t,l)}else i(n,l)}})},"geocortex/infrastructure/results/ResultsViewBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework-ui/ViewContainer/ViewContainerView","./../ShellUtils"],function(t,s,i,n,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.isCollapsed=!0,i.isContainerCollapsed=!0,i._longPressTimer=null,i._pressStartTime=null,i._pressLengthMs=1500,i._hoverTimerToken=null,i._hoverDelayMs=0,i._hoveredFeature=null,i._firedTouchOrPress=!1,i._pressYStart=null,i._lastTouchY=null,i._scrollYDeltaThreshold=35,i._firstEvent=null,i.app.event("ViewContainerActivatedEvent").subscribe(i,function(e){!i.isCollapsed&&i._isViewHostedInContainer(e)&&(i.app.event("ResultsViewOpenedEvent").publish(i),i.viewModel.resultsPage&&i.app.behavior("ResultsPageChangedBehavior").run(i.viewModel.resultsPage.get()),i.isContainerCollapsed=!1)}),i.app.event("ViewContainerDeactivatedEvent").subscribe(i,function(e){!i.isCollapsed&&i._isViewHostedInContainer(e)&&(i.app.event("ResultsViewCollapsedEvent").publish(i),i.isContainerCollapsed=!0)}),i.app.event("ViewContainerViewClosedEvent").subscribe(i,function(e){e.viewId===i.id&&(i.app.event("ResultsViewClosedEvent").publish(i),i.isContainerCollapsed=!0)}),i}return e(s,t),s.prototype.activated=function(){t.prototype.activated.call(this),this.isCollapsed=!1,this.app.event("ResultsViewOpenedEvent").publish(this)},s.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.isCollapsed=!0,this.app.event("ResultsViewCollapsedEvent").publish(this)},s.prototype.handleTouchStart=function(e,t,s){return this._firstEvent||(this._firstEvent="touch start",this._beginLongPress(s)),!0},s.prototype.handleTouchMove=function(e,t,s){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},s.prototype.handleTouchEnd=function(e,t,s){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},s.prototype.handleTouchCancel=function(e,t,s){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},s.prototype.handleMouseDown=function(e,t,s){return this._firstEvent||(this._firstEvent="mouse down",this._beginLongPress(s)),!0},s.prototype.handleClick=function(e,t,s){this._cancelHover(),this._hoveredFeature=null,this._firstEvent&&(this._firstEvent=null,this._cancelLongPress());var i=e.target,n=!("IMG"!==i.tagName||!i.parentElement||"A"!==i.parentElement.tagName||!i.parentElement.href);return!("A"!==i.tagName&&!n)||(this.app.command("ClearFeatureInformation").execute(),this.app.event(this.featureClickedEventName).publish(s),!1)},s.prototype.handleMouseUp=function(e,t,s){return this._cancelHover(),"mouse down"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},s.prototype.handleMouseOver=function(e,t,s){(a.hasClass(e.currentTarget,this.itemClass)||e instanceof FocusEvent)&&this._beginHover(s)},s.prototype.handleMouseOut=function(e,t,s){(a.hasClass(e.currentTarget,this.itemClass)||e instanceof FocusEvent)&&(this._cancelHover(),this._tryFireHoverStop(s),"mouse down"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()))},s.prototype._beginHover=function(e){var t=this;this._hoverTimerToken&&clearTimeout(this._hoverTimerToken),this._hoverTimerToken=setTimeout(function(){t._hoveredFeature!==e&&(t._hoveredFeature=e),t.app.event(t.featureHoveredEventName).publish(e)},this._hoverDelayMs)},s.prototype._cancelHover=function(){this._hoverTimerToken&&(clearTimeout(this._hoverTimerToken),this._hoverTimerToken=null)},s.prototype._tryFireHoverStop=function(e){this._hoveredFeature===e&&(this._hoveredFeature=null,this.app.event(this.featureHoverEndEventName).publish(e))},s.prototype._beginLongPress=function(e){var t=this;this._longPressTimer&&clearTimeout(this._longPressTimer),this._longPressTimer=setTimeout(function(){t.app.event(t.featurePressedEventName).publish(e)},this._pressLengthMs)},s.prototype._cancelLongPress=function(){this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null)},s.prototype._isViewHostedInContainer=function(e){if(e instanceof n.ViewContainerView){var t=e.viewModel.regionName.get(),s=this.app.viewManager.getRegionForViewId(this.id);if(s&&s.name===t)return!0}return!1},s.prototype.scrollView=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},s}(i.ViewBase);s.ResultsViewBase=r,r.prototype.featureClickedEventName="ResultsListFeatureClickedEvent",r.prototype.featurePressedEventName="ResultsListFeaturePressedEvent"})},"geocortex/infrastructure/results/ResultsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","./../FeatureSetCollection","./../Dictionary","geocortex/framework/observables"],function(t,s,i,n,a,r){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i._emptyFeatureSetCollection=null,i._watchHandles=new a.Dictionary,i.featureSetCollection=new r.Observable,i.featureActions=new r.ObservableCollection,i.currentFeature=new r.Observable,i.hasFeatureSets=new r.Observable(!1),i.isBusy=new r.Observable(!1),i.isModified=new r.Observable(!1),i.defaultIsPaged=!0,i.defaultPageSize=50,i.headerText=new r.Observable(i.app.getResource(i.libraryId,"language-common-results")),i.searchSuggestion=new r.Observable(i.app.getResource(i.libraryId,"language-common-no-results-desc")),i.featureSetCollection.bind(i,i.handleCollectionChanged),i.registerCommands(),i.subscribeEvents(),i}return e(s,t),s.prototype.subscribeEvents=function(){this.app.event("FSMCollectionOpenedEvent").subscribe(this,this._openFSC),this.app.event("FSMCollectionClosedEvent").subscribe(this,this._closeFSC),this.app.event("FSMCollectionRemovedEvent").subscribe(this,this._removeFSC),this.app.event("FSMCollectionChangedEvent").subscribe(this,this._changeFSC),this.app.event("FeatureEditedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("FeatureDeletedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("RelatedRecordEditedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("GraphicRemovedEvent").subscribe(this,this._pulseFeatureSetsInCollection)},s.prototype.handleCollectionChanged=function(e){var t=e&&this.app.featureSetManager.getCollectionById(e.id);!t&&e&&e.featureSets&&(t=e),t?(t===this._emptyFeatureSetCollection?this.isBusy.set(!1):this.isBusy.set(this.app.featureSetManager.isCollectionOpen(t.id)),this.updateHeaderText(t.countFeatures()),this.hasFeatureSets.set(this._featureSetsHaveFeatures(t.featureSets)),this._watchDisplayNameChanges(),this._watchIsModifiedChanges()):(this.isBusy.set(!1),this._unwatchDisplayNameChanges(),this._unwatchIsModifiedChanges()),null!=this.presentableResults&&this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)},s.prototype.handleFeatureSetsChanged=function(e){var t=e.sender,s=this._featureSetsHaveFeatures(t);this.hasFeatureSets.get()!==s&&this.hasFeatureSets.set(s)},s.prototype.updateHeaderText=function(e){var t=null,s="",i=!1;e&&(s=" ("+e+")"),this.featureSetCollection.get()&&(t=this.featureSetCollection.get().displayName.get(),i=this.featureSetCollection.get().isModified.get()),this._count=e;var n="{0}{1}{2}".format(t||this.app.getResource(this.libraryId,"language-common-results"),s,i?"*":"");this.headerText.set(n)},s.prototype._featureSetsHaveFeatures=function(e){if(e)for(var t=0;t<e.length();t++)if(e.getAt(t).features&&e.getAt(t).features.length()>0||e.getAt(t).esriFeatureSet&&e.getAt(t).esriFeatureSet.features&&e.getAt(t).esriFeatureSet.features.length>0)return!0;return!1},s.prototype._openFSC=function(e){if(this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id){this.isBusy.set(!0),this.hasFeatureSets.set(!1);var t=this.app.featureSetManager.getSearchSuggestion(this.featureSetCollection.get().sourceName);this.searchSuggestion.set(t||this.app.getResource(this.libraryId,"language-common-no-results-desc"))}},s.prototype._closeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&(this.isBusy.set(!1),this.featureSetCollection.pulse())},s.prototype._removeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.featureSetCollection.set(this._getEmptyFeatureSetCollection())},s.prototype._changeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.featureSetCollection.pulse()},s.prototype._getEmptyFeatureSetCollection=function(){return null==this._emptyFeatureSetCollection?this._emptyFeatureSetCollection=new n.FeatureSetCollection:this._emptyFeatureSetCollection.clear(),this._emptyFeatureSetCollection},s.prototype.registerCommands=function(){var e=this;this.app.command("ShowResultsListFeatureAction").register(this,function(t){e.currentFeature.set(t),e.getResultsFeatureActions(),e.app.command("ActivateView").execute("ResultsFeatureActionsView")}),this.app.command("ClearSelection").register(this,function(){e.app.command("RemoveFeatureSetCollection").execute(e.featureSetCollection.get())})},s.prototype.getResultsFeatureActions=function(){this.featureActions.clear();var e=this.app.menuRegistry.getMenu("ResultsListFeatureAction");this.app.menuRegistry.getDefaultIconUri("ResultsListFeatureAction");if(!e)throw new Error("Results Feature Actions not found");this.featureActions.addItems(e.items)},s.prototype._pulseFeatureSetsInCollection=function(){this.featureSetCollection&&this.featureSetCollection.get()&&this.featureSetCollection.get().featureSets&&this.featureSetCollection.get().featureSets.length()>0&&this.featureSetCollection.get().featureSets.pulse()},s.prototype._watchDisplayNameChanges=function(){var e=this;this._unwatchDisplayNameChanges();var t=this.featureSetCollection.get()?this.featureSetCollection.get().displayName:null;if(!t)return null;var s=t.bind(this,function(){return e.updateHeaderText(e._count)}),i={remove:function(){return t.unbind(s)}};return this._watchHandles.set("displayName",i),i},s.prototype._unwatchDisplayNameChanges=function(){var e=this._watchHandles.get("displayName");e&&e.remove(),this._watchHandles.remove("displayName")},s.prototype._watchIsModifiedChanges=function(){var e=this;this._unwatchIsModifiedChanges();var t=this.featureSetCollection.get()?this.featureSetCollection.get().isModified:null;if(!t)return null;var s=t.bind(this,function(){return e.updateHeaderText(e._count)}),i={remove:function(){return t.unbind(s)}};return this._watchHandles.set("isModified",i),i},s.prototype._unwatchIsModifiedChanges=function(){var e=this._watchHandles.get("isModified");e&&e.remove(),this._watchHandles.remove("isModified")},s}(i.ViewModelBase);s.ResultsViewModel=o})},"geocortex/infrastructure/results/TabbedResultsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();define(["require","exports","./ResultsViewModel","geocortex/framework/observables","./../FeatureSet","geocortex/framework-ui/PresentableCollection","./../ui/components/Table/TableColumnHeaderViewModel","./../FeatureSetCollection","geocortex/framework/utils/ArrayUtils","./../ui/components/Table/SortState","geocortex/framework/utils/utils","./../eventArgs/ResultsPageChangedEventArgs","./ResultsUtils"],function(t,s,i,n,a,r,o,l,u,c,d,p,g){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var h=function(t){function s(e,s){var i=t.call(this,e,s)||this;return i.curFeatureSet=new n.Observable(null),i.currPageWithinTab={},i.currScrollPosWithinTab={},i.presentableResults=new r.PresentableCollection,i.pageControlsEnabled=new n.Observable(!1),i.tabControlsEnabled=new n.Observable(!1),i.resultsTable=new n.Observable("results-table"),i.columnSharedState=null,i.columnHeaders=new n.ObservableCollection([]),i.leftScrollTabDisabled=new n.Observable(!1),i.rightScrollTabDisabled=new n.Observable(!1),i._firstVisibleTab=0,i._emptyFeatureSet=new a.FeatureSet({app:i.app}),i._boundFeatureSets=null,i._featureSetsBindingToken=null,i._curFeatureSetBindingToken=null,i._presentableResultsBindingToken=null,i._resultsPageBindingToken=null,i.presentableResults.items.useThrottling=!0,i.resultsPage=i.presentableResults.items,i.presentableResults.pageSize.set(i.defaultPageSize),i.defaultIsPaged!=i.presentableResults.isPaginated.get()&&i.presentableResults.isPaginated.set(i.defaultIsPaged),i.app.command("ShowResultsTable").register(i,i.showResultsTable,function(){return!i.app.configuration.mobileMode}),i.app.command("SwitchToListResultsView").register(i,i._switchToListResultsViewImpl,i._canExecuteSwitchToListResultsView),i}return e(s,t),s.prototype.handleCollectionChanged=function(e){if(t.prototype.handleCollectionChanged.call(this,e),this.unbindFeatureSets(),e&&e.featureSets){this._featureSetsBindingToken=e.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSets=e.featureSets,this._firstVisibleTab=0;for(var s=null,i=0;i<e.featureSets.length();i++)if(e.featureSets.getAt(i).isSelectedInCollection.get()){s=e.featureSets.getAt(i);break}!s&&e.featureSets.length()>0&&(s=e.featureSets.getAt(0)),s!==this.curFeatureSet.get()&&(this.setCurrentSelectedFeatureSet(s),this.currPageWithinTab={},this.currScrollPosWithinTab={}),t.prototype.updateHeaderText.call(this,s?s.features.length():this.featureSetCollection.get().countFeatures())}},s.prototype.handleCurrentFeatureSetChanged=function(e){this.presentableResults.sortingPredicate=null,e&&this.presentableResults.items!==e.features&&(this.presentableResults.attachToCollection(e.features),this.buildColumnHeaders(e))},s.prototype.handleFeatureSetsChanged=function(e){t.prototype.handleFeatureSetsChanged.call(this,e);var s=e.sender;if("append"===e.type){0===e.rangeStart&&this.setCurrentSelectedFeatureSet(s.getAt(0));for(var i=e.rangeStart;i<=e.rangeEnd;i++)s.getAt(i).isSelectedInCollection.get()&&this.setCurrentSelectedFeatureSet(s.getAt(i))}else if("remove"===e.type){var n=this.curFeatureSet.get();if(n){var a=s.indexOf(n);a>=e.rangeStart&&a<=e.rangeEnd&&(e.rangeEnd+1<s.length()?this.setCurrentSelectedFeatureSet(s.getAt(e.rangeEnd+1)):e.rangeStart>0?this.setCurrentSelectedFeatureSet(s.getAt(e.rangeStart-1)):this.setCurrentSelectedFeatureSet(null))}}},s.prototype.showResultsTable=function(e){var t;if(e instanceof l.FeatureSetCollection)t=e;else{if("string"!=typeof e)return;t=this.app.featureSetManager.getCollectionById(e)}if(t){if(t!==this.featureSetCollection.get())this.unbindFeatureSets(),this.featureSetCollection.set(t);else{var s=this.featureSetCollection.get().featureSets.get().filter(function(e){return e.isSelectedInCollection.get()})[0];s?this.setCurrentSelectedFeatureSet(s):this.featureSetCollection.get().featureSets.length()>0&&this.setCurrentSelectedFeatureSet(this.featureSetCollection.get().featureSets.getAt(0)),this._handlePageResultsChange()}this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsTable")}this.currPageWithinTab={},this.currScrollPosWithinTab={}},s.prototype.clearCurrentHighlights=function(){if(this.curFeatureSet.get()){var e=this.curFeatureSet.get().features.getItems();this.app.command("ClearFeatureHighlight").execute(e)}},s.prototype._switchToListResultsViewImpl=function(){this.curFeatureSet.get()?this.curFeatureSet.get().isSelectedInCollection.get()?(this.app.command("ShowResultsList").execute(this.featureSetCollection.get()),this.app.command("ShowFeatureSetResultsView").execute(this.curFeatureSet.get())):(this.app.command("ShowResultsList").execute(this.featureSetCollection.get()),0===this.featureSetCollection.get().countFeatures()&&g.showResultsStatusMessage(this.app,0)):(this.app.command("ShowResultsList").execute(this.featureSetCollection.get()),g.showResultsStatusMessage(this.app,this.featureSetCollection.get().countFeatures()))},s.prototype._canExecuteSwitchToListResultsView=function(){return!!this.featureSetCollection.get()},s.prototype.setCurrentSelectedFeatureSet=function(e){for(var t=this.featureSetCollection.get().featureSets,s=0;s<t.length();s++)t.getAt(s).isSelectedInCollection.set(t.getAt(s)===e);e&&this.curFeatureSet.get()!==e&&this.curFeatureSet.set(e)},s.prototype.unbindFeatureSets=function(){this._featureSetsBindingToken&&this._boundFeatureSets&&this._boundFeatureSets.unbind(this._featureSetsBindingToken),this._boundFeatureSets=null,this._featureSetsBindingToken=null},s.prototype.buildColumnHeaders=function(e){this.columnHeaders.clear(),this.columnSharedState?this.columnSharedState.reset():this.columnSharedState=new o.SharedState(this.presentableResults,"sort","sort-up","sort-down");var t,s={};if(e.layer&&e.layer.fields)for(t=0;t<e.layer.fields.length;t++){var i=e.layer.fields[t];s[i.name]=i.dataType}var n=e.attributes.length();for(n||(e.loadAttributes(),n=e.attributes.length()),t=0;t<n;t++){var a=e.attributes.getAt(t);a.visible&&!a.visible.get()||this.columnHeaders.addItem(new o.TableColumnHeaderViewModel(this.app,this.libraryId,this.columnSharedState,a.displayName.get(),s[a.name.get()],t))}},s.prototype.setCurrentPageWithinTab=function(e){this.currPageWithinTab[e]?this.currPageWithinTab[e]!==this.presentableResults.currPageNumber.get()&&this.presentableResults.currPageNumber.set(this.currPageWithinTab[e]):this.currPageWithinTab[e]=this.presentableResults.currPageNumber.get()},s.prototype.updateCurrentPageAndScrollPosWithinTab=function(e,t){this.currScrollPosWithinTab[this.curFeatureSet.get().uniqueId]=t,this.currPageWithinTab[this.curFeatureSet.get().uniqueId]=e},s.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.viewMode="table",e.page=this.presentableResults.currPageNumber.get();var s=u.firstOrDefault(t.featureSets.get(),function(e){return e.isSelectedInCollection.get()});if(s){e.openedFeatureSet=this.app.project.convert.fromGcxFeatureSet(s);var i=u.firstOrDefault(this.columnHeaders.get(),function(e){return e.sortState.get()!==c.SortState.UNSORTED});i&&(e.tableOptions={},e.tableOptions.sortColumn=this.columnHeaders.get().indexOf(i),e.tableOptions.sortDirection=i.sortState.get()===c.SortState.ASCENDING?"asc":"desc")}},s.prototype.applyState=function(e){var t=this;if(2==e.state.serialVersion)s={results:this.app.project.convert.toGcxFeatureSetCollection(e.state.results),selectedFeatureSet:e.state.openedFeatureSet?this.app.project.convert.toGcxFeatureSet(e.state.openedFeatureSet).catch(function(e){}):null};else var s={results:this.app.project.convert.toGcxFeatureSetCollection(e.state.results),selectedFeatureSet:e.state.tableOptions?this.app.project.convert.toGcxFeatureSet(e.state.tableOptions.selectedFeatureSet).catch(function(e){}):null};e.promises.push(Promise.props(s).then(function(s){if(s.results){s.results!==t.featureSetCollection.get()&&(t.unbindFeatureSets(),t.featureSetCollection.set(s.results)),"table"===e.state.viewMode&&t.app.command("_setResultMappingCommand").execute(s.results.sourceName,"ShowResultsTable");var i=u.firstOrDefault(s.results.featureSets.get(),function(e){return e===s.selectedFeatureSet});if(i&&(t.setCurrentSelectedFeatureSet(i),d.isNullOrUndefined(e.state.page)||(t.updateCurrentPageAndScrollPosWithinTab(t.presentableResults.currPageNumber.get(),0),t.presentableResults.currPageNumber.set(e.state.page)),e.state.tableOptions&&!d.isNullOrUndefined(e.state.tableOptions.sortColumn))){var n=t.columnHeaders.getAt(e.state.tableOptions.sortColumn);n&&n.sortState.set("desc"===e.state.tableOptions.sortDirection?c.SortState.DESCENDING:c.SortState.ASCENDING)}}}))},s.prototype._handlePageResultsChange=function(e){var t="clear"===(e=e||{type:null}).type||"remove"===e.type&&e.sender.value.length<=1,s=new p.ResultsPageChangedEventArgs;s.featureSetCollection=this.featureSetCollection.get(),s.newValue=t?new n.ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(s),this.app.behavior("ResultsPageChangedBehavior").run(s.newValue.get())},s.prototype._pulseUnderlyingCollection=function(){if(this.curFeatureSet.get()){var e=this.presentableResults.currPageNumber.get();this.curFeatureSet.pulse(),this.presentableResults.currPageNumber.set(e)}},s.prototype.bindUnderlyingCollections=function(){this._bindObservables(),this._pulseUnderlyingCollection()},s.prototype.unbindUnderlyingCollections=function(){this._unbindObservables()},s.prototype._bindObservables=function(){this._curFeatureSetBindingToken||(this._curFeatureSetBindingToken=this.curFeatureSet.bind(this,this.handleCurrentFeatureSetChanged)),this._presentableResultsBindingToken||(this._presentableResultsBindingToken=this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)),this._resultsPageBindingToken||(this._resultsPageBindingToken=this.resultsPage.bind(this,this._handlePageResultsChange))},s.prototype._unbindObservables=function(){this._curFeatureSetBindingToken&&(this.curFeatureSet.unbind(this._curFeatureSetBindingToken),this._curFeatureSetBindingToken=null),this._presentableResultsBindingToken&&(this.presentableResults.numberOfItems.unbind(this._presentableResultsBindingToken),this._presentableResultsBindingToken=null),this._resultsPageBindingToken&&(this.resultsPage.unbind(this._resultsPageBindingToken),this._resultsPageBindingToken=null)},s}(i.ResultsViewModel);s.TabbedResultsViewModel=h})},"url:/Mapping/infrastructure/results/FeatureSetCollectionResultsLabelView.html":e,"url:/Mapping/infrastructure/results/FeatureSetCollectionResultsView.html":t,"url:/Mapping/infrastructure/results/FeatureSetResultsView.html":s,"url:/Mapping/infrastructure/results/ResultsFeatureActionsView.html":i,"url:/Mapping/infrastructure/results/ResultsListView.html":n,"url:/Mapping/infrastructure/results/ResultsTableView.html":a}}),require(["geocortex/framework/resourceManager"],function(r){r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/CSS/common.css","css","DQovKiBSRVNVTFRTIChDT01NT04pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLlJlc3VsdHNUYWJsZVZpZXcsIC5yZXN1bHRzLCAuUmVzdWx0c1RhYmxlVmlldyAucmVzdWx0cyAud2lkZ2V0LmJvdW5kLXZpc2libGUgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgcmlnaHQ6IDA7DQogICAgYm90dG9tOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCi5yZXN1bHRzLWxpc3Qgew0KICAgIG92ZXJmbG93OiBhdXRvOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB3aWR0aDogMTAwJTsNCn0NCi5yZXN1bHRzLWxpc3Qgew0KICAgIHRvcDogMDsNCiAgICBib3R0b206IDZlbTsNCiAgICBvdmVyZmxvdy14OiBoaWRkZW47DQp9DQoNCi5yZXN1bHRzLWxpc3QgLmxpc3QtbWVudS1pY29uIHsNCiAgICB3aWR0aDogMjRweDsNCiAgICBoZWlnaHQ6IDI0cHg7DQp9DQoNCi5yZXN1bHRzLWxpc3QgLmxpc3QtbWVudS1kZXRhaWxzIHsNCiAgICBtYXJnaW4tbGVmdDogM2VtOw0KfQ0KLnJlc3VsdHMtbGlzdCAubGlzdC1tZW51LWl0ZW0gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQoucmVzdWx0cy1saXN0IC5saXN0LW1lbnUtZGV0YWlscyAubGlzdC1tZW51LWRlc2MgLmZlYXR1cmUtZGVzY3JpcHRpb24gew0KICAgIC8qIFByZXNlcnZlIHdoaXRlIHNwYWNlIGFuZCBuZXcgbGluZXMqLw0KICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsNCn0NCi5GZWF0dXJlRGV0YWlsc1ZpZXcgLnBhbmVsLWdyb3VwLmhhcy1lZGl0YWJsZS1yZWxhdGVkLWZlYXR1cmVzIHsNCiAgICBwYWRkaW5nLWxlZnQ6IDA7DQp9DQouaGFzLWVkaXRhYmxlLXJlbGF0ZWQtZmVhdHVyZXMgLnJlc3VsdHMtdGFibGUgew0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWVlZWVlOw0KfQ0KLmNyZWF0ZWZlYXR1cmUgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBib3JkZXItYm90dG9tOiAwOw0KfQ0KLmNyZWF0ZWZlYXR1cmUgLmxpc3QtbWVudS1kZXNjIHsNCiAgICBwYWRkaW5nLWxlZnQ6IDAuNWVtOw0KfQ0KLlJlc3VsdHNUYWJsZVZpZXcgLnJlc3VsdHMgLnBhZ2luZy1jb250cm9sIHsNCiAgICBoZWlnaHQ6IDMuNTVlbTsNCn0NCi5uby1pdGVtLA0KLm5vLXJlc3VsdHMgew0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgcGFkZGluZzogMWVtOw0KICAgIGNvbG9yOiAjNzc3Nzc3Ow0KfQ0KLm5vLXJlc3VsdHMgcCB7DQogICAgbWFyZ2luLWJvdHRvbTogMWVtOw0KfQ0KDQoudmlldy5SZXN1bHRzTGlzdFZpZXcuYWN0aXZlLA0KLmxheWVyLWFkZGl0aW9uLm1hcC1zZXJ2aWNlcy1kaWFsb2csDQoucGFuZWwtZ3JvdXAsDQouZ2N4LWxpc3QtbWVudSB7DQogICAgaGVpZ2h0OiAxMDAlOw0KfQ0KDQoNCi8qIFJFU1VMVFMgUEFHSU5HIENPTlRST0wgKENPTU1PTikgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoucGFnaW5nLWNvbnRyb2wuaGFzLXBhZ2VzIHsNCiAgICBoZWlnaHQ6IDYuNWVtOw0KfQ0KDQoucGFnaW5nLWNvbnRyb2wubm8tcGFnZXMgew0KICAgIGhlaWdodDogM2VtOw0KfQ0KLnBhZ2luZy1jb250cm9sIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYm90dG9tOiAwOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQp9DQoucGFnaW5nLWNvbnRyb2wuaGFzLXBhZ2VzIHsNCiAgICBoZWlnaHQ6IDZlbTsNCn0NCi5wYWdpbmctY29udHJvbC5uby1wYWdlcyB7DQogICAgaGVpZ2h0OiAzZW07DQp9DQoucGFnaW5nLWNvbnRyb2wgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLnBhZ2luZy1jb250cm9sLWlubmVyIHsNCiAgICBtYXJnaW46IDAgLjc1ZW07DQp9DQoucGFnaW5nLXJlc3VsdC1pbmZvIHsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgbGluZS1oZWlnaHQ6IDEuOGVtOw0KICAgIHBhZGRpbmctdG9wOjAuNWVtOw0KfQ0KLnBhZ2luZy1idXR0b25zIHsNCiAgICBwYWRkaW5nOiAwLjVlbSAwOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQp9DQoudmlldy5SZXN1bHRzVGFibGVWaWV3IC5wYWdpbmctYnV0dG9ucyB7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIHBhZGRpbmc6MC42ZW0gMGVtOw0KfQ0KLnZpZXcuUmVzdWx0c1RhYmxlVmlldyAucGFnaW5nLXJlc3VsdC1pbmZvIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBwYWRkaW5nOiAuNjVlbSAwOw0KfQ0KLnBhZ2luZy1idXR0b25zIGJ1dHRvbiwNCi5wYWdpbmctY29udHJvbCBhIHsNCiAgICB3aWR0aDogMmVtOw0KICAgIGhlaWdodDogMmVtOw0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQoNCi5wYWdpbmctY29udHJvbCAucGFnaW5nLXJlc3VsdC1pbmZvIGJ1dHRvbiB7DQogICAgd2lkdGg6IDJlbTsNCiAgICBoZWlnaHQ6IDJlbTsNCiAgICBwYWRkaW5nOiAwZW0gMC4yNWVtIDBlbSAwLjI1ZW07DQp9DQoNCi5wYWdpbmctcmVzdWx0LWluZm8gYnV0dG9uLA0KLnBhZ2luZy1yZXN1bHQtaW5mbyBhIHsNCiAgICBtYXJnaW4tcmlnaHQ6IDAuNWVtOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQp9DQoNCi5wYWdpbmctcmVzdWx0LWluZm8gc3BhbiB7DQogICAgY3Vyc29yOiBkZWZhdWx0Ow0KfQ0KDQoucGFnaW5nLWNvbnRyb2wgYnV0dG9uLA0KLnBhZ2luZy1jb250cm9sIGEsDQoucGFnaW5nLWJ1dHRvbnMtaW5mbyB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0Q5RDlEOTsNCn0NCi5wYWdpbmctY29udHJvbCBidXR0b24gew0KICAgIHBhZGRpbmc6IDBlbSAwLjVlbSAwLjI1ZW0gMC41ZW07DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCi5wYWdpbmctYnV0dG9ucy1pbmZvIHsNCiAgICBwYWRkaW5nOiAwLjI3ZW0gMC41ZW0gMC4yMmVtIDAuNWVtOw0KICAgIGhlaWdodDogMmVtOw0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCi5wYWdpbmctY29udHJvbCBidXR0b24gaW1nIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IGF1dG87DQogICAgdGV4dC1hbGlnbjogY2VudGVyOyAgDQogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgICBtYXJnaW46IDAgYXV0bzsNCn0NCi5wYWdpbmctY29udHJvbCBidXR0b246aG92ZXIgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNERUYyRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0IyRTBGRjsNCn0NCg0KLnBhZ2luZy1idXR0b25zIGJ1dHRvbiwNCi5wYWdpbmctYnV0dG9ucy1pbmZvIHsNCiAgICBtYXJnaW4tcmlnaHQ6IC0xcHg7DQp9DQoNCi5wYWdpbmctYnV0dG9ucyBidXR0b246Zmlyc3QtY2hpbGQgew0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW0gMCAwIDAuMjVyZW07DQp9DQoNCi5wYWdpbmctYnV0dG9ucyBidXR0b246bGFzdC1jaGlsZCB7DQogICAgYm9yZGVyLXJhZGl1czogMCAwLjI1cmVtIDAuMjVyZW0gMDsNCiAgICBtYXJnaW4tcmlnaHQ6IDA7DQp9DQoucmVzdWx0cy1saXN0LWFjdGlvbnMtd2lkZ2V0IC5tZW51LWh5cGVybGlua3MgLmxpc3QtbWVudSwNCi5yZXN1bHRzLXRhYmxlLWFjdGlvbnMtd2lkZ2V0IC5tZW51LWh5cGVybGlua3MgLmxpc3QtbWVudSB7DQogICAgbWFyZ2luLXRvcDogMDsNCiAgICBwYWRkaW5nLWJvdHRvbTogMC41NGVtOw0KICAgIHBhZGRpbmctbGVmdDogLjc1ZW07DQogICAgYm9yZGVyLXRvcDogbm9uZTsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0Q5RDlEOTsNCn0NCg0KLnJlc3VsdHMtbGlzdC1hY3Rpb25zLXdpZGdldCAubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtaXRlbSwNCi5yZXN1bHRzLXRhYmxlLWFjdGlvbnMtd2lkZ2V0IC5tZW51LWh5cGVybGlua3MgLmxpc3QtbWVudS1pdGVtIHsNCiAgICBmbG9hdDogbm9uZTsNCn0NCg0KLnJlc3VsdHMtbGlzdC1hY3Rpb25zLXdpZGdldCAubWVudS1oeXBlcmxpbmtzIC5saXN0LW1lbnUtaXRlbTpmaXJzdC1jaGlsZCB7DQogICAgcGFkZGluZy1sZWZ0OiAuNWVtOw0KfQ0KDQouUmVzdWx0c1RhYmxlVmlldyAudGFiLWNvbnRhaW5lciB7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLlJlc3VsdHNUYWJsZVZpZXcgLnRhYi1jb250YWluZXIgdGFibGUgew0KICAgIHRhYmxlLWxheW91dDogZml4ZWQ7DQogICAgd2lkdGg6IDEwMCU7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLlJlc3VsdHNUYWJsZVZpZXcgLnRhYi1sZWZ0LXNjcm9sbCwgDQouUmVzdWx0c1RhYmxlVmlldyAudGFiLXJpZ2h0LXNjcm9sbCB7DQogICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICB3aWR0aDogMi43NWVtOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICB6LWluZGV4OiAxMDA7DQp9DQouUmVzdWx0c1RhYmxlVmlldyAudGFiLWxlZnQtc2Nyb2xsIHsNCiAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KfQ0KLlJlc3VsdHNUYWJsZVZpZXcgLnRhYi1yaWdodC1zY3JvbGwgew0KICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgI0Q5RDlEOTsNCn0NCi5SZXN1bHRzVGFibGVWaWV3IC50YWItbGVmdC1zY3JvbGwgaW1nLCANCi5SZXN1bHRzVGFibGVWaWV3IC50YWItcmlnaHQtc2Nyb2xsIGltZyB7DQogICAgbWFyZ2luOiAwIGF1dG87DQogICAgZGlzcGxheTogYmxvY2s7DQp9DQouUmVzdWx0c1RhYmxlVmlldyAudGFiLWxlZnQtc2Nyb2xsIGJ1dHRvbiwgDQouUmVzdWx0c1RhYmxlVmlldyAudGFiLXJpZ2h0LXNjcm9sbCBidXR0b24gew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KICAgIGhlaWdodDogMi4yZW07DQp9DQouUmVzdWx0c1RhYmxlVmlldyAudGFiLWxlZnQtc2Nyb2xsLmRpc2FibGVkIGJ1dHRvbiwgDQouUmVzdWx0c1RhYmxlVmlldyAudGFiLXJpZ2h0LXNjcm9sbC5kaXNhYmxlZCBidXR0b24gew0KICAgIGJhY2tncm91bmQ6ICNlZWVlZWU7DQp9DQouUmVzdWx0c1RhYmxlVmlldyAucmVzdWx0cyAud2lkZ2V0LmJvdW5kLXZpc2libGUgew0KICAgIHRvcDogMi4xNWVtOw0KfQ0KDQouUmVzdWx0c1RhYmxlVmlldyAudGFiLWNvbnRyb2wgew0KICAgIC8qIFdpZHRoIGluaGVyaXQgaXMgcmVxdWlyZWQgc28gdGFiIGNvbnRyb2wgb2Zmc2V0IHdpZHRoIGNhbiBiZSBjb21wYXJlZCB0byB0aGF0IG9mIHRoZSB0YWIgY29udGFpbmVyIHRvIGNoZWNrIHdoZXRoZXIgdG8gZGlzcGxheSB0YWIgc2Nyb2xsIGJ1dHRvbnMgKi8NCiAgICB3aWR0aDogaW5oZXJpdDsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2sgIWltcG9ydGFudDsNCiAgICB6b29tOiAxOw0KfQ=="),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/CSS/large.css","css","LmxhcmdlLXNoZWxsLWJvdHRvbSAucGFnaW5nLXJlc3VsdC1pbmZvLA0KLmxhcmdlLXNoZWxsLWJvdHRvbSAucGFnaW5nLWJ1dHRvbnMgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsgIA0KICAgIGhlaWdodDogMmVtOw0KICAgIHBhZGRpbmc6IDAuNWVtIDA7ICANCn0NCi5sYXJnZS1zaGVsbC1ib3R0b20gLnBhZ2luZy1jb250cm9sLWlubmVyIHsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoubGFyZ2Utc2hlbGwtYm90dG9tIC5wYWdpbmctY29udHJvbC1pbm5lcjphZnRlciB7DQogICAgY29udGVudDogIiI7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgY2xlYXI6IGJvdGg7DQogICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KfQ=="),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/CSS/medium.css","css","Lm1lZGl1bS1zaGVsbC1ib3R0b20gLnBhZ2luZy1yZXN1bHQtaW5mbywNCi5tZWRpdW0tc2hlbGwtYm90dG9tIC5wYWdpbmctYnV0dG9ucyB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOyAgDQogICAgaGVpZ2h0OiAyZW07DQogICAgcGFkZGluZzogMC41ZW0gMDsgIA0KfQ0KLm1lZGl1bS1zaGVsbC1ib3R0b20gLnBhZ2luZy1jb250cm9sLWlubmVyIHsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoubWVkaXVtLXNoZWxsLWJvdHRvbSAucGFnaW5nLWNvbnRyb2wtaW5uZXI6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICIiOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGNsZWFyOiBib3RoOw0KICAgIHZpc2liaWxpdHk6IGhpZGRlbjsNCn0="),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/CSS/small.css","css","DQovKiBSRVNVTFRTIFBBR0lORyBDT05UUk9MIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoucmVzdWx0cy10YWJsZSwNCi5yZXN1bHRzLWxpc3Qgew0KICAgIGJvdHRvbTogNC44ZW07DQp9DQoucGFnaW5nLWNvbnRyb2wgew0KfQ0KLnBhZ2luZy1jb250cm9sLmhhcy1wYWdlcyB7DQoJaGVpZ2h0OiA1ZW07DQp9DQoucGFnaW5nLXJlc3VsdC1pbmZvIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBwYWRkaW5nOiAuNWVtIDA7DQogICAgZm9udC1zaXplOiAwLjllbTsNCiAgICBoZWlnaHQ6IDEuN2VtOw0KfQ0KLnZpZXcuUmVzdWx0c0xpc3RWaWV3IC5wYWdpbmctYnV0dG9ucywNCi5wYWdpbmctYnV0dG9ucyB7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIHBhZGRpbmc6MC42ZW0gMC41ZW07DQp9DQoucGFnaW5nLXJlc3VsdC1pbmZvIGJ1dHRvbiB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCi5wYWdpbmctYnV0dG9ucyBidXR0b24gew0KICAgIHBhZGRpbmc6IDAgMC4yNWVtOw0KICAgIGhlaWdodDogMi4yZW07DQogICAgbGluZS1oZWlnaHQ6IDEuMmVtOw0KfQ0KDQpAbWVkaWEgb25seSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQyMHB4KSB7DQoNCiAgIC52aWV3LlJlc3VsdHNMaXN0VmlldyAucGFnaW5nLWJ1dHRvbnMsDQogICAucGFnaW5nLXJlc3VsdC1pbmZvLA0KICAgLnBhZ2luZy1idXR0b25zIHsNCiAgICAgICAgZmxvYXQ6IG5vbmU7DQogICAgICAgIG1hcmdpbjowIGF1dG87DQogICAgICAgIHBhZGRpbmc6MC4yZW0gMDsNCiAgICAgICAgd2lkdGg6YXV0bzsNCiAgICB9DQogICAgLnBhZ2luZy1yZXN1bHQtaW5mbyB7DQogICAgICAgIHBhZGRpbmc6MC41ZW0gMCAwLjJlbSAwOw0KICAgIH0NCiAgICAucGFnaW5nLWJ1dHRvbnMgew0KICAgICAgICBwYWRkaW5nOiAwIDAgMC41ZW0gMDsNCiAgICB9ICAgIA0KICAgIC5wYWdpbmctYnV0dG9ucyBhIHsNCiAgICAgICAgd2lkdGg6IDE0JTsNCiAgICAgICAgbWluLXdpZHRoOjUlOw0KICAgICAgICB0ZXh0LWFsaWduOmNlbnRlcjsNCiAgICB9DQogICAgDQogICAgLnBhZ2luZy1idXR0b25zIC5wYWdpbmctYnV0dG9ucy1pbmZvIHsNCiAgICAgICAgd2lkdGg6IGF1dG87DQogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgICAgICAgcGFkZGluZzogMC4yZW07DQogICAgfSANCiAgICANCn0NCg0KLnNjcmVlbi1yZWdpb24gLlJlc3VsdHNWaWV3Q29udGFpbmVyVmlldyB7DQogICAgdG9wOiAwcHg7DQogICAgYm90dG9tOiAwcHg7DQogICAgbGVmdDogMHB4Ow0KICAgIHJpZ2h0OiAwcHg7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ=="),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/FeatureSetCollectionResultsLabelView.html","html",e),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/FeatureSetCollectionResultsView.html","html",t),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/FeatureSetResultsView.html","html",s),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/ResultsFeatureActionsView.html","html",i),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/ResultsListView.html","html",n),r.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/ResultsTableView.html","html",a)})}();require({cache:{"geocortex/infrastructure/ReverseGeocoder":function(){define(["require","exports","geocortex/essentials/GeocodingEndpoint","./GeometryUtils"],function(e,o,r,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(e,o){this.geocoder=this._noGeocoderConfigured,this.geocoderToken=null,this.geocoderUrl=null,this.SEARCH_RADIUS=1e3,this.AGS_ADDRESS_FIELD="Match_addr",this.BING_REQUEST_TEMPLATE="http://dev.virtualearth.net/REST/v1/Locations/{0},{1}?{2}key={3}",this.app=e,this._initializeGeocoder(o)}return e.prototype.reverseGeocode=function(e){var o=this;return new Promise(function(r,t){return o.app.isOffline.get()?t(new Error("Could not execute Reverse Geocode: Application is offline")):e.spatialReference?void o.geocoder(e).then(function(e){r(e)},function(e){t(e)}):t(new Error("Could not execute Reverse Geocode: Point had no spatial reference"))})},e.prototype._initializeGeocoder=function(e){var o=this;if(e&&e.geocoderUrl&&(this.geocoderUrl=e.geocoderUrl),e&&e.geocoderToken&&(this.geocoderToken=e.geocoderToken),e.geocoderType===r.GeocodingEndpointType.ARCGIS_GEOCODER){if(!this._agsGeocoder||this._agsGeocoder.url!==e.geocoderUrl){var t=this._updateUrl(this.geocoderToken);this._agsGeocoder=new esri.tasks.Locator(t)}this.geocoderToken&&dojo.subscribe("ServiceTokenRefreshed",function(e){if(e.serviceUrl==o.geocoderUrl){var r=o._updateUrl(e.token);o._agsGeocoder=new esri.tasks.Locator(r)}}),this.geocoder=this._executeAgsReverseGeocode}else e.geocoderType===r.GeocodingEndpointType.BING_GEOCODER&&e.bingProperties&&e.bingProperties.bingMapsKey&&(this._bingMapsKey=e.bingProperties.bingMapsKey,e.bingProperties.culture&&(this._bingMapsCulture=e.bingProperties.culture),this.geocoder=this._executeBingReverseGeocode)},e.prototype._updateUrl=function(e){return this.geocoderToken=e,this.geocoderUrl+(this.geocoderToken?"?token="+encodeURIComponent(this.geocoderToken):"")},e.prototype._parseAddressObject=function(e){var o=[],r=null;for(var t in e)e[t]&&o.push(e[t]);return o.length>0&&(r=o.join(", ")),r},e.prototype._executeAgsReverseGeocode=function(e){var o=this;return new Promise(function(r,t){o._agsGeocoder.locationToAddress(e,o.SEARCH_RADIUS).then(function(e){if(!e.address||!e.location)return o.app.trace.warning("Check geocoder configuration. No results were returned from a reverse geocode."),t("Check geocoder configuration. No results were returned from a reverse geocode.");var n={address:e.address[o.AGS_ADDRESS_FIELD]||o._parseAddressObject(e.address),location:e.location};return r(n)},function(e){return t(e)})})},e.prototype._executeBingReverseGeocode=function(e){var o=this;return new Promise(function(r,n){t.projectGeometry(e,new esri.SpatialReference(4326),function(e){var t=o._bingMapsCulture?"c="+o._bingMapsCulture+"&":"",i=o.BING_REQUEST_TEMPLATE.format(e.y,e.x,t,o._bingMapsKey);dojo.xhrGet({url:o.app.configuration.proxyUri+i,handleAs:"json",load:function(e){if(e&&e.resourceSets.length>0&&e.resourceSets[0].resources.length>0){var o=e.resourceSets[0].resources[0],t={location:new esri.geometry.Point(o.point.coordinates[1],o.point.coordinates[0],new esri.SpatialReference(4326)),address:o.address.formattedAddress};r(t)}else n(new Error("Reverse Geocode: No response from Bing Geocoder."))},error:function(e){n(e)}})},function(e){},o.app)})},e.prototype._noGeocoderConfigured=function(e){return new Promise(function(e,o){o(new Error("Reverse Geocoder: No geocoder configured"))})},e}();o.ReverseGeocoder=n})}}});require({cache:{"geocortex/infrastructure/search/SearchHintItem":function(){define(["require","exports","geocortex/framework/observables","./../FilterUtils"],function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;this.iconUri=new r.Observable(""),this.text=new r.Observable(e),this.plainText=new r.Observable(""),this.plainText.syncTransform(this.text,function(e){return s.stripHtml(e)}),this.safeText=new r.Observable(""),this.safeText.syncTransform(this.text,function(e){return i.sanitizeText(e)})}return e.prototype.sanitizeText=function(e){var t={allowFrames:!1,uriTransformer:function(e){return e}};return e?s.sanitize(e,t):""},e.prototype.toString=function(){return this.plainText.get()},e}();t.SearchHintItem=i})},"geocortex/infrastructure/search/SearchHintProvider":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/search/SearchManager":function(){define(["require","exports","./../FeatureSetCollection"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s;!function(e){e.IDLE="Idle",e.SEARCHING="Searching",e.ERROR="Error"}(s=t.Status||(t.Status={}));var i=function(){function e(e){this._searchProviders=[],this._fscRootID="SearchResultsCollection",this._count=0,this._fscSourceName="Search",this.app=e,this._registerCommands(),this.app.event("SearchProgressEvent").subscribe(this,this._searchProgress)}return e.prototype._resetFeatureSetCollection=function(){this._fsc||(this._fsc=this.app.featureSetManager.getCollectionById(this._fscRootID)),this._fsc?(this.app.featureSetManager.getCollectionById(this._fsc.id)||this.app.featureSetManager.addCollection(this._fsc),this._fsc.clear(),this.app.featureSetManager.tryCloseCollection(this._fsc.id)):(this._fsc=new r.FeatureSetCollection,this._fsc.id=this._fscRootID,this._fsc.sourceName=this._fscSourceName,this.app.featureSetManager.addCollection(this._fsc))},e.prototype.getSearchHints=function(e,t){var r=this._enabledProviders();if(0!=r.length)for(var s=0;s<r.length;s++)r[s].supportsHints&&r[s].getSearchHints(e,t);else this.app.trace.warning("No search providers enabled.")},e.prototype._registerCommands=function(){this.app.command("RegisterSearchProvider").register(this,this._registerProvider),this.app.command("Search").register(this,this._search),this.app.command("GlobalSearch").register(this,this._search),this.app.command("CancelSearch").register(this,this._cancelSearch),this.app.command("ClearSearch").register(this,this._clearSearch)},e.prototype._registerProvider=function(e){if(!e)throw new Error("Search Provider cannot be null.");for(var t=0;t<this._searchProviders.length;t++)if(this._searchProviders[t].id==e.id)throw new Error("Search Provider '{0}' already registered.".format(e.name));this._searchProviders.push(e)},e.prototype._enabledProviders=function(){for(var e=[],t=0;t<this._searchProviders.length;t++){var r=this._searchProviders[t];r.isEnabled&&(!0===this.app.isOffline.get()?r.supportsOffline&&e.push(r):e.push(r))}return e},e.prototype._isSearching=function(){for(var e=0;e<this._searchProviders.length;e++)if(this._searchProviders[e].status==s.SEARCHING)return!0;return!1},e.prototype._cancelSearch=function(){if(this._isSearching())for(var e=0;e<this._searchProviders.length;e++){var t=this._searchProviders[e];t.status==s.SEARCHING&&t.cancelSearch()}},e.prototype._clearSearch=function(){this._isSearching()&&this._cancelSearch(),this._resetFeatureSetCollection()},e.prototype._search=function(e){if(this._isSearching()&&this._cancelSearch(),this._resetFeatureSetCollection(),e&&""!=e.replace(/ /g,"")){var t=this._enabledProviders();if(0!=t.length){var r=this.app.getResource("Mapping","language-search-fsc-display-name");this._fsc.displayName.set(r.format(e)),this.app.featureSetManager.isCollectionOpen(this._fsc.id)||this.app.featureSetManager.openCollection(this._fsc.id);for(var s=0;s<t.length;s++)t[s].search(this._fsc,e)}else this.app.trace.warning("No search providers enabled.")}else this.app.trace.warning("Cannot perform search without search text.")},e.prototype._searchProgress=function(e){var t=!0;if(e.status!=s.SEARCHING){for(var r=0;r<this._searchProviders.length;r++)this._searchProviders[r].status==s.SEARCHING&&(t=!1);t&&this.app.featureSetManager.tryCloseCollection(e.results.id)}},e}();t.SearchManager=i})},"geocortex/infrastructure/search/SearchProviderBase":function(){define(["require","exports","geocortex/framework/utils/utils","./SearchManager"],function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.app=e,this.libraryId=t,this.id="SearchProvider-"+r.alphaNumericToken(),this.supportsOffline=!1,this.supportsHints=!1,this.status=s.Status.IDLE}return e.prototype.initialize=function(e){},e.prototype.search=function(e,t){},e.prototype.cancelSearch=function(){},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();t.SearchProviderBase=i})}}});require({cache:{"geocortex/infrastructure/SecurityUtils":function(){define(["require","exports","geocortex/framework/utils/ArrayUtils"],function(e,t,i){"use strict";function r(e,t,r){return i.firstOrDefault(e.claims,function(e){return e.type===t&&e.value===r})}Object.defineProperty(t,"__esModule",{value:!0});var n="http://www.geocortex.net/security/claims/privilege";t.getIdentity=function(e,t){var r=t.site;return r&&r.principal&&r.principal.identities?i.firstOrDefault(r.principal.identities,function(t){return t.authenticationType===e}):null},t.getClaimsByType=function(e,t){return e.claims.filter(function(e){return e.type===t})},t.getClaimsByValue=function(e,t){return e.claims.filter(function(e){return e.value===t})},t.getClaimByTypeAndValue=r,t.hasPrivilegeClaim=function(e,t){return!!r(e,n,t)}})}}});require({cache:{"geocortex/infrastructure/selection/CombineMode":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.REPLACE="replace",e.UNION="union",e.SUBTRACT="subtract",e.INTERSECT="intersect"}(t.CombineMode||(t.CombineMode={}))})},"geocortex/infrastructure/selection/CombineResultsResponse":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/selection/SelectionMetadata":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/selection/SelectionMetadataQuery":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/selection/SelectionMetadataStore":function(){define(["require","exports","./../Dictionary","geocortex/framework/utils/ArrayUtils","geocortex/framework/utils/utils"],function(e,t,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._store=new i.Dictionary,this.app=e}return e.prototype.findByName=function(e){var t={name:e},i=this.find(t);return r.firstOrDefault(i)},e.prototype.findByCollectionId=function(e){var t={featureSetCollectionIds:[e]},i=this.find(t);return r.firstOrDefault(i)},e.prototype.findById=function(e){var t={ids:[e]},i=this.find(t);return r.firstOrDefault(i)},e.prototype.findAll=function(){return this.find()},e.prototype.find=function(e){e=e||{};var t=this._store.values();if(e.ids&&e.ids.length>0&&(t=t.filter(function(t){return e.ids.indexOf(t.id)>-1})),e.featureSetCollectionIds&&e.featureSetCollectionIds.length>0&&(t=t.filter(function(t){return e.featureSetCollectionIds.indexOf(t.featureSetCollectionId)>-1})),e.name&&(t=t.filter(function(t){return t.name&&t.name==e.name})),e.dateCreatedMin&&e.dateCreatedMin instanceof Date){var i=e.dateCreatedMin.getTime();t=t.filter(function(e){return void 0!==e.timeCreated&&e.timeCreated>=i})}if(e.dateCreatedMax&&e.dateCreatedMax instanceof Date){var r=e.dateCreatedMax.getTime();t=t.filter(function(e){return void 0!==e.timeCreated&&e.timeCreated<=r})}if(e.dateModifiedMin&&e.dateModifiedMin instanceof Date){var n=e.dateModifiedMin.getTime();t=t.filter(function(e){return void 0!==e.timeModified&&e.timeModified>=n})}if(e.dateModifiedMax&&e.dateModifiedMax instanceof Date){var o=e.dateModifiedMax.getTime();t=t.filter(function(e){return void 0!==e.timeModified&&e.timeModified<=o})}if(e.dateExpirationMin&&e.dateExpirationMin instanceof Date){var a=e.dateExpirationMin.getTime();t=t.filter(function(e){return void 0!==e.timeExpiration&&e.timeExpiration>=a})}if(e.dateExpirationMax&&e.dateExpirationMax instanceof Date){var d=e.dateExpirationMax.getTime();t=t.filter(function(e){return void 0!==e.timeExpiration&&e.timeExpiration<=d})}return t.map(function(e){return dojo.mixin({},e)})},e.prototype.add=function(e){if(!e)throw new Error("The selection metadata cannot be null.");var t=dojo.mixin({},e),i=t.id=this._generateId();return this._store.set(i,t),i},e.prototype.updateById=function(e,t){if(!e)throw new Error("The metadata ID must be set.");if(!t)throw new Error("The selection metadata cannot be null.");if(!this._store.containsKey(e))throw new Error("Selection metadata with ID '{0}' not found.".format(e));var i=this._store.get(e);this._update(i,t)},e.prototype.removeById=function(e){if(!e)throw new Error("The metadata ID must be set.");this._store.remove(e)},e.prototype.clear=function(){this._store.clear()},e.prototype._update=function(e,t){e.name=t.name,e.count=t.count,e.timeCreated=t.timeCreated,e.timeModified=t.timeModified,e.timeExpiration=e.timeExpiration,e.featureSetCollectionId=t.featureSetCollectionId,e.modified=t.modified},e.prototype._generateId=function(){return n.alphaNumericToken()},e}();t.SelectionMetadataStore=o})}}});require({cache:{"geocortex/infrastructure/sharing/SharingLinkProviderBase":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t[t.SCALE=0]="SCALE",t[t.CENTER=1]="CENTER",t[t.EXTENT=2]="EXTENT"}(e.ExtentLinkPriority||(e.ExtentLinkPriority={}));!function(t){t[t.LAYERTHEME=0]="LAYERTHEME",t[t.LAYERS=1]="LAYERS"}(e.LayerListLinkPriority||(e.LayerListLinkPriority={}));var r=function(){function t(t,e){this.acceptParameter=!0,this.generateParameter=!0,this.app=t,this.libraryId=e}return t.prototype.initialize=function(t){},t.prototype.generate=function(){return""},t.prototype.apply=function(t){},t.prototype.getResource=function(t,e){return this.app.getResource(this.libraryId,t,e)},t}();e.SharingLinkProviderBase=r})}}});require({cache:{"geocortex/infrastructure/ShellUtils":function(){define(["require","exports"],function(e,n){"use strict";function t(e,n,t,i){var u=this;void 0===i&&(i=200);var o=-1,r=[],s=function(){for(var n=r.length-1;n>=0;n--){var t=r[n];e.event(t.eventName).unsubscribe(t.subscriptionToken),r.pop()}},a=function(){o=setTimeout(function(){o=null,s(),n()},i)};t.forEach(function(n){var t=e.event(n).subscribe(u,function(){null!==o&&(clearTimeout(o),a())});r.push({eventName:n,subscriptionToken:t})}),a()}Object.defineProperty(n,"__esModule",{value:!0}),n.debounceViewEvents=function(e,n,i){void 0===i&&(i=400),t(e,n,["ViewInitializedEvent","ViewActivatedEvent","ViewDeactivatedEvent","ViewDimensionsChangedEvent","ViewHostedEvent","ViewUnhostedEvent","ApplicationResizeEvent"],i)},n.debounceEvents=t,n.hasClass=function(e,n){return new RegExp("(\\s|^)"+n+"(\\s|$)").test(e.className)},n.throttle=function(e,n,t){void 0===t&&(t={});var i,u,o,r=null,s=0,a=function(){s=!1===t.leading?0:Date.now(),r=null,o=e.apply(i,u),r||(i=u=null)};return function(){var c=Date.now();s||!1!==t.leading||(s=c);var l=n-(c-s);return i=this,u=arguments,l<=0||l>n?(r&&(clearTimeout(r),r=null),s=c,o=e.apply(i,u),r||(i=u=null)):r||!1===t.trailing||(r=setTimeout(a,l)),o}}})}}});require({cache:{"geocortex/infrastructure/SimpleRenderer":function(){define(["require","exports"],function(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(){this.fillColor=new esri.Color([236,236,0,.22745]),this.borderColor=new esri.Color([204,204,51,1]),this.borderWidth=2,this.polylineOpacity=1,this.defaultSymbol=null,this._pictureMarkerSymbolCache={}}return e.prototype.clone=function(){var o=new e;return o.fillColor=this.fillColor,o.borderColor=this.borderColor,o.borderWidth=this.borderWidth,o},e.prototype.getSymbol=function(e,o,r){if(void 0===r&&(r=!1),!e||!e.geometry)return null;e.getLayer();var i=0,l=0,t=0,s=0;if(o&&(o instanceof esri.symbol.SimpleLineSymbol&&(i=Math.max(o.width,this.borderWidth),r&&i>3&&(i-=2)),o instanceof esri.symbol.SimpleMarkerSymbol&&(l=o.size+(o.outline?o.outline.width:0),t=o.xoffset,s=o.yoffset),o instanceof esri.symbol.PictureMarkerSymbol&&(l=Math.max(o.height,o.width),t=o.xoffset,s=o.yoffset),l<24&&(l=24)),o||(o=e.symbol),e.geometry instanceof esri.geometry.Point||e.geometry instanceof esri.geometry.Multipoint){var n=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,l||24,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.borderColor,this.borderWidth),this.fillColor);return n.setOffset(t,s),n}if(e.geometry instanceof esri.geometry.Polygon){m=esri.symbol.SimpleLineSymbol.STYLE_SOLID;return r&&o&&(m=o.outline?o.outline.style:esri.symbol.SimpleLineSymbol.STYLE_SOLID),new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(m,this.borderColor,this.borderWidth),this.fillColor)}if(e.geometry instanceof esri.geometry.Polyline){var m=esri.symbol.SimpleLineSymbol.STYLE_SOLID;r&&o&&(m=o.style);var y=new esri.Color(this.borderColor.toHex());return y.a=this.polylineOpacity,new esri.symbol.SimpleLineSymbol(m,y,(i||this.borderWidth)+2)}return null},e.prototype.toJson=function(){return{fillColor:this.fillColor,borderColor:this.borderColor,borderWidth:this.borderWidth}},e}();o.SimpleRenderer=r})}}});require(["geocortex/framework/resourceManager"],function(C){C.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/small.css","css","DQovKiBHTE9CQUwgU1RZTElORyAgKFNNQUxMKS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQpodG1sLA0KYm9keSB7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgY29sb3I6ICMzMzMzMzM7DQp9DQoNCmJvZHkgew0KICAgIGZvbnQtc2l6ZTogLjhlbTsNCiAgICAtd2Via2l0LXRleHQtc2l6ZS1hZGp1c3Q6IDEwMCU7DQp9DQoNCmJ1dHRvbiwgaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEgeyANCiAgIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogI0RFRjJGRjsNCn0NCg0KDQovKiBCVVRUT05TIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCmJ1dHRvbiB7DQogICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiAjREVGMkZGOw0KfQ0KDQoNCi8qIFZJRVcgQ09OVEFJTkVSUyAvIE1PRFVMRSBDT05UQUlORVJTIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5wYW5lbC1oZWFkZXIgew0KICAgIGhlaWdodDogMy45ZW07DQogICAgbGluZS1oZWlnaHQ6IDMuOWVtOw0KfQ0KDQoucGFuZWwtaGVhZGVyIGgyIHsNCiAgICBmb250LXNpemU6IDEuM2VtOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBtYXJnaW4tbGVmdDogMy41ZW07DQogICAgbWFyZ2luLXJpZ2h0OiAzLjVlbTsNCn0NCg0KLnBhbmVsLWhlYWRlci1idXR0b24gew0KICAgIHdpZHRoOiAzLjVlbTsNCiAgICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6ICNERUYyRkY7DQp9DQoNCi5wYW5lbC1zY3JvbGwtY29udGFpbmVyIHsNCiAgICAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7DQogICAgb3ZlcmZsb3c6IGF1dG87DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJvdHRvbTogMHB4Ow0KDQp9DQoNCi52aWV3LWNvbnRhaW5lci12aWV3IHsNCiAgICBoZWlnaHQ6IDEwMCU7DQp9DQoNCi8qIExJU1QgTUVOVSAoU01BTEwpIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoubGlzdC1tZW51LWl0ZW0gew0KICAgIHBhZGRpbmc6IDFlbTsNCiAgICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6ICNERUYyRkY7DQp9DQoNCi5saXN0LXN1Ym1lbnUgew0KICAgIG1hcmdpbjogOHB4Ow0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzk5OTk5OTsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KfQ0KDQphLmxpc3QtbWVudS1pdGVtIHsNCiAgICBjb2xvcjogIzMzMzMzMzsNCn0NCg0KLmxpc3QtbWVudS1jbG9zZWQgew0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9leHBhbmRlci1jbG9zZWQtMjQucG5nIikgcmlnaHQgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg0KLmxpc3QtbWVudS1vcGVuIHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvZXhwYW5kZXItb3Blbi0yNC5wbmciKSByaWdodCBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KDQoNCi8qIExPQURJTkcgSU5ESUNBVE9SIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5sb2FkaW5nLWNvbnRhaW5lciB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHBhZGRpbmc6IDAuNWVtOw0KfQ0KDQoubG9hZGluZy1pbWcsDQoubG9hZGluZy1tc2cgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoubG9hZGluZy1pbWcgew0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMjRweDsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9sb2FkZXItc21hbGwuZ2lmKTsNCn0NCg0KDQovKiBUUkVFVklFVyAoU01BTEwpIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoudHJlZS1leHBhbmRlci5leHBhbmRlZCB7DQogICBiYWNrZ3JvdW5kOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9taW51cy0yNC5wbmcpIGxlZnQgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg0KLnRyZWUtZXhwYW5kZXIuY29sbGFwc2VkIHsNCiAgIGJhY2tncm91bmQ6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2FkZC0yNC5wbmcpIGxlZnQgY2VudGVyIG5vLXJlcGVhdDsNCn0NCg==")});require({cache:{"geocortex/infrastructure/snapping/SnappingLocations":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/snapping/SnappingProvider":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/states/State":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return function(e,t){this.stateDefinition=e,this.activatedBy=t}}();t.ActiveState=a})},"geocortex/infrastructure/states/StateManager":function(){define(["require","exports","./State","./States"],function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.registeredStates=[],this.activeStates=[],this.modalState=null,this.previousModalState=null,this.commandTokens=[],this.eventTokens=[],this.app=e,this.libraryId=t;for(var a=0;a<n.definedStates.length;a++)this.registerState(n.definedStates[a])}return e.prototype.registerState=function(e){var t=this;if(this.registeredStates.some(function(t){return t.name===e.name}))this.app.trace.info("States with duplicate names registered! New state ignored. Name is: "+e.name);else if(this.registeredStates.filter(function(e){return e.hasOwnProperty("parentState")}).some(function(t){return t.name===e.parentState}))this.app.trace.info("Tried to load a state with a parent that references another state that has a parent. Only parent -> child relationships are allowed. State name: "+e.name);else{var n=dojo.connect(this.app,"onLibrariesDownloaded",this,function(){dojo.disconnect(n),t.app.hasLibrary(t.libraryId)&&-1===e.description.search(" ")&&(e.description=t.app.getResource(t.libraryId,e.description))});e.enterCommands&&e.enterCommands.forEach(function(a){var n=t.app.command(a.name).register(t,function(n){return t._stateEntered(e,a,n)});t.commandTokens.push({instance:a,token:n})}),e.exitCommands&&e.exitCommands.forEach(function(a){var n=t.app.command(a.name).register(t,function(n){return t._stateExited(e,a,n)});t.commandTokens.push({instance:a,token:n})}),e.enterEvents&&e.enterEvents.forEach(function(a){var n=t.app.event(a.name).subscribe(t,function(n){return t._stateEntered(e,a,n)});t.eventTokens.push({instance:a,token:n})}),e.exitEvents&&e.exitEvents.forEach(function(a){var n=t.app.event(a.name).subscribe(t,function(n){return t._stateExited(e,a,n)});t.eventTokens.push({instance:a,token:n})}),this.registeredStates.push(e),"DefaultState"===e.name&&this.activeStates.push(new a.ActiveState(e))}},e.prototype.onDestroy=function(){for(e=0;e<this.eventTokens.length;e++)this.app.event(this.eventTokens[e].instance.name).unsubscribe(this.eventTokens[e].token);for(var e=0;e<this.commandTokens.length;e++)this.app.command(this.commandTokens[e].instance.name).unregister(this.commandTokens[e].token)},e.prototype.getActiveStates=function(){for(var e=[],t=0;t<this.activeStates.length;t++)e[this.activeStates[t].stateDefinition.name]=this.activeStates[t];return this.activeStates.filter(function(t){return t.stateDefinition.parentState&&e[t.stateDefinition.parentState]||!t.stateDefinition.parentState})},e.prototype.getStateByName=function(e){for(var t=0;t<this.registeredStates.length;t++)if(this.registeredStates[t].name===e)return this.registeredStates[t];return null},e.prototype.getModalState=function(){return this.modalState||null},e.prototype.isModalStateActive=function(){return null!==this.modalState},e.prototype.isCurrentlyActive=function(e){return this.activeStates.some(function(t){return t.stateDefinition.name===e})},e.prototype.getAllStateNames=function(){for(var e=[],t=0;t<this.registeredStates.length;t++)e.push(this.registeredStates[t].name);return e},e.prototype._stateEntered=function(e,t,n){if((!e.parentState||this.activeStates.some(function(t){return t.stateDefinition.name===e.parentState}))&&!(this.isCurrentlyActive(e.name)||t.parameter&&t.parameter!==n)){var i=null;("string"==typeof n||n instanceof String)&&(i=n),this.app.trace.debug("State entered: "+e.name),e.isModal&&(null!==this.modalState&&(this.previousModalState=this.modalState,this._exitState(this.modalState,t,i)),this.app.trace.debug("Modal State entered: "+e.name),this.modalState=e),this.activeStates.push(new a.ActiveState(e,t)),this.app.event("StateEnteredEvent").publish({stateDefinition:e,activeStates:this.activeStates,modalState:this.modalState,previousModalState:this.modalState})}},e.prototype._stateExited=function(e,t,a){if(!t.parameter||t.parameter===a){for(var n=!1,i=0;i<this.activeStates.length;i++)this.activeStates[i].stateDefinition===e&&(n=!0);var r=!1;if(e.parentState&&(r=this.activeStates.some(function(t){return t.stateDefinition.name===e.parentState})),n&&(!e.parentState||r)){var s=null;("string"==typeof a||a instanceof String)&&(s=a),this._exitState(e,t,s)}}},e.prototype._exitState=function(e,t,a){this._exitChildStates(e,t,a);for(var n=this.activeStates.length-1;n>=0;n--)this.activeStates[n].stateDefinition===e&&(this.activeStates.splice(n,1),this.app.trace.debug("State exited: "+e.name));this.modalState===e&&(this.modalState=null,this.previousModalState=e,this.app.trace.debug("Modal state exited: "+e.name)),this.app.event("StateExitedEvent").publish({stateDefinition:e,activeStates:this.activeStates,modalState:this.modalState,previousModalState:this.previousModalState})},e.prototype._exitChildStates=function(e,t,a){for(var n=[],i=0;i<this.activeStates.length;i++)if(this.activeStates[i].stateDefinition.parentState===e.name){var r=this.activeStates[i].stateDefinition;if(r.exitCommands)for(s=0;s<r.exitCommands.length;s++)r.exitCommands[s].name!==t.name||r.exitCommands[s].parameter&&r.exitCommands[s].parameter!==a||n.push(r);if(r.exitEvents)for(var s=0;s<r.exitEvents.length;s++)r.exitEvents[s].name!==t.name||r.exitEvents[s].parameter&&r.exitEvents[s].parameter!==a||n.push(r)}for(i=0;i<n.length;i++)this._exitState(n[i],t,a)},e}();t.StateManager=i})},"geocortex/infrastructure/states/States":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.definedStates=[{name:"DefaultState",description:"language-states-default-description",isModal:!1},{name:"TransientActiveState",description:"language-states-transient-active-description",isModal:!1,enterEvents:[{name:"TransientActivatedEvent"}],exitEvents:[{name:"TransientsDeactivatedEvent"}]},{name:"IdentifyState",description:"language-states-identify-state-description",isModal:!1,enterCommands:[{name:"SetActiveTool",parameter:"PointIdentifyTool-Navigation"},{name:"SetActiveTool",parameter:"IdentifyRectangleTool"},{name:"SetActiveTool",parameter:"RectangleIdentifyTool"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"Identify"}]},{name:"IdentifyBufferingState",parentState:"IdentifyState",description:"language-states-buffering-description",isModal:!1,enterEvents:[{name:"BufferingActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"BufferingDeactivatedEvent",parameter:"Identify"}]},{name:"IdentifyCombineModeUnionState",parentState:"IdentifyState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"union"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"},{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}]},{name:"IdentifyCombineModeSubtractState",parentState:"IdentifyState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"union"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"}]},{name:"PlotCoordinatesState",description:"language-states-plotcoordinates-state-description",isModal:!1,enterCommands:[{name:"SetActiveTool",parameter:"PlotCoordinatesTool"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"PlotCoordinates"}]},{name:"SnappingState",description:"language-states-snapping-description",isModal:!1,enterCommands:[{name:"ActivateSnapping"}],exitCommands:[{name:"DeactivateSnapping"}]},{name:"FindDataState",description:"language-states-identify-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"Identify"}]},{name:"FindDataBufferingState",parentState:"FindDataState",description:"language-states-buffering-description",isModal:!1,enterEvents:[{name:"BufferingActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"BufferingDeactivatedEvent",parameter:"Identify"}]},{name:"FindDataCombineModeUnionState",parentState:"FindDataState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"union"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"},{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}]},{name:"FindDataCombineModeSubtractState",parentState:"FindDataState",description:"language-states-identify-combine-description",isModal:!1,enterEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"subtract"}],exitEvents:[{name:"IdentifyCombineModeChangeEvent",parameter:"replace"},{name:"IdentifyCombineModeChangeEvent",parameter:"union"},{name:"IdentifyCombineModeChangeEvent",parameter:"intersect"}]},{name:"DrawMarkupState",description:"language-states-draw-markup-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"AddMarkup"},{name:"ToolCommandActivatedEvent",parameter:"AddTextMarkup"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"AddMarkup"},{name:"ToolCommandDeactivatedEvent",parameter:"AddTextMarkup"}]},{name:"MeasureState",description:"language-states-measure-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"MeasureDistance"},{name:"ToolCommandActivatedEvent",parameter:"MeasureArea"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"MeasureDistance"},{name:"ToolCommandDeactivatedEvent",parameter:"MeasureArea"}]},{name:"SelectMarkupForEditingState",description:"language-states-edit-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"DeleteMeasurement"},{name:"ToolCommandActivatedEvent",parameter:"DeleteMarkup"},{name:"ToolCommandActivatedEvent",parameter:"EditMarkup"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"DeleteMeasurement"},{name:"ToolCommandDeactivatedEvent",parameter:"DeleteMarkup"},{name:"ToolCommandDeactivatedEvent",parameter:"EditMarkup"}]},{name:"EditorActiveState",description:"language-states-editing-active-state-description",isModal:!1,enterCommands:[{name:"StartEditingFeature"},{name:"StartEditingNewFeature"},{name:"StartEditingNewRelatedRecord"}],exitEvents:[{name:"EditorClosedEvent"}]},{name:"EditingMarkupState",description:"language-states-editing-state-description",isModal:!1,enterEvents:[{name:"MarkupEditingStartedEvent"}],exitEvents:[{name:"MarkupEditingStoppedEvent"}]},{name:"EditingMeasurementMarkupState",description:"language-states-editing-state-description",isModal:!1,enterEvents:[{name:"MeasurementEditingStartedEvent"}],exitEvents:[{name:"MarkupEditingStoppedEvent"}]},{name:"FeaturePlacementState",description:"language-states-feature-editing-state-description",isModal:!0,enterEvents:[{name:"StartFeaturePlacementEvent"},{name:"ToolCommandActivatedEvent",parameter:"SetEditorFeatureGeometry"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"FeaturePlacementGraphicState",parentState:"FeaturePlacementState",description:"language-states-feature-editing-state-graphic-description",isModal:!1,enterCommands:[{name:"StartEditingGraphicGeometry"}],enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"SetEditorFeatureGeometry"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"FeaturePlacementPointGraphicState",parentState:"FeaturePlacementState",description:"language-states-feature-editing-state-point-graphic-description",isModal:!1,enterEvents:[{name:"GeometryEditPointActivatedEvent"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"MarkupStyleToggleState",description:"State for the markup style toggle button",isModal:!1,enterCommands:[{name:"_showMarkupStyleSelectorView"}],exitEvents:[{name:"_markupToggleDeactivated"}]}]})}}});!function(){var e="<div class='attribute-symbology-settings' data-binding='{@var: container}'>    \x3c!-- Attribute selector drop-down. --\x3e    <div class='symbology-drop-down' data-binding='{@event-onchange: applySettings}{@event-oninput: applySettings}'>        <label class='symbology-label' data-binding='{@text: @language-symbology-settings-pick-attribute}'></label>        <select data-binding='{@source: attributes}{@var: attributeInput}'>            <option data-binding='{@template-for: attributes}{@text: displayName}{@value name}'></option>        </select>    </div>    \x3c!-- Class breaks slider. --\x3e    <div class='symbology-sliders' data-binding='{@visible: isNumericAttribute}'>        <div class='symbology-numberinput'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-breaks}'></label>            <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: classBreaksInput}'></div>        </div>    </div>    \x3c!-- Group: Class Breaks gradient colors --\x3e    <div class='symbology-colors'  data-binding='{@visible: isNumericAttribute}'>        \x3c!-- Start Color --\x3e        <div class='color-picker inline-block'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-startcolor}'></label>            <div data-binding='{@widget: ColorPickerWidget}{@widget-context: startColor}'></div>        </div>        \x3c!-- End Color --\x3e        <div class='color-picker inline-block'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-endcolor}'></label>            <div data-binding='{@widget: ColorPickerWidget}{@widget-context: endColor}'></div>        </div>    </div>    \x3c!-- Group: Attribute Renderer Global Controls. --\x3e    <div class='symbology-sliders' data-binding='{@visible: currentAttribute}'>        \x3c!-- Transparency slider. --\x3e        <div class='symbology-numberinput'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-transparency}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: transparencyInput}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-percent-suffix}'></span>            </div>        </div>        \x3c!-- Marker size slider. --\x3e        <div class='symbology-numberinput' data-binding='{@hidden: noMarker}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-marker-size}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: markerSizeInput}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-pixel-suffix}'></span>            </div>        </div>        \x3c!-- Line width slider. --\x3e        <div class='symbology-numberinput'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-line-width}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: lineWidthInput}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-pixel-suffix}'></span>            </div>          </div>        \x3c!-- Marker style drop-down. --\x3e        <div class='symbology-drop-down' data-binding='{@hidden: noMarker}{@event-onchange: handleMarkerStyle}{@event-oninput: handleMarkerStyle}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-marker-style}'></label>            <select data-binding='{@source: markerStyles}{@var: markerStyleInput}'>                <option data-binding='{@template-for: markerStyles}{@text: label}'></option>            </select>        </div>    </div>    \x3c!-- Symbolization Classes --\x3e    <div class='symbology-classes' data-binding='{@source: symbologyClasses}'>        <div data-binding='{@template-for: symbologyClasses}{@var: symbologyClassContainer}'>            <button class='button symbology-class' data-binding='{@class-selected: selected}{@event-onclick: handleSymbolClassSelected}{title: name}'>                <div class='symbology-text' data-binding='{@text: name}'></div>                <div class='symbology-color' data-binding='{@style-background-color: displayColor}{@hidden: isImage}'></div>                <img class='symbology-image' data-binding='{@visible: isImage}{src: imageSrc}'></img>            </button>            \x3c!-- Simple symbology settings widget will be attached here --\x3e            <div data-binding='{@visible: selected}{id: widgetId}'></div>        </div>    </div></div>",t="<div class='symbology-settings panel-group-contents'>    \x3c!-- Symbology type selector --\x3e    <div class='symbology-settings-selector form-item' data-binding='{@visible: showSymbologySelectorMenu}'>        <label class='symbology-label' data-binding='{@text: @language-symbology-settings-select}'></label>        <select data-binding='{@value: selectorMode}'>            <option data-binding='{@text: @language-symbology-selector-symbol-displayname}' value='Custom'></option>            <option data-binding='{@text: @language-symbology-selector-image-displayname}' value='Image'></option>        </select>    </div>    \x3c!-- BEGIN: Content region --\x3e    <div class='markup-configuration-selector' data-binding='{data-region-name: regionName}' data-region-adapter='geocortex.framework.ui.MultiDivRegionAdapter'></div>    \x3c!-- END: Content region --\x3e</div>",i="<div class='symbology-settings panel-group-contents' data-binding='{@var: container}'>    \x3c!-- Symbology type selector --\x3e    <div class='symbology-settings-selector form-item' data-binding='{@visible: showSymbologySelectorMenu}'>        <label class='symbology-label' data-binding='{@text: @language-symbology-settings-select}'></label>        <select data-binding='{@source: symbologyWidgets}{@value: currentWidget}'>            <option data-binding='{@template-for: symbologyWidgets}{@text: displayName}{@attach: @context}'></option>        </select>    </div>    \x3c!-- Symbology settings widget. --\x3e    <div data-binding='{@hidden: symbolizeWithImagery}'>        <div data-binding='{@widget: SimpleSymbolWidget}{@widget-replace: true}'></div>    </div>    \x3c!-- Image symbology widget. --\x3e    <div data-binding='{@visible: symbolizeWithImagery}'>        <div data-binding='{@widget: CustomizedPictureSymbolWidget}{@widget-replace: true}'></div>    </div></div>",o="<div class='style-selector markup image' data-binding='{@hidden: noLibraries}'>    <div data-binding='{@source: currentImage}'>        <span class='symbol-name' data-binding='{@template-for: currentImage}{@text: name}'></span>    </div>    \x3c!-- Image Container --\x3e    <div class='swatch-container image-container' data-binding='{@source: currentImages}'>        <button class='markup-swatch markup-swatch-image' data-binding='{@template-for: currentImages}{@class-selected: selected}{id: id}{@event-onclick: handleClickSwatch}'>            <span class='symbol-button-label' data-binding='{@text: name}'></span>            <img class='markup-swatch-image' data-binding='{src: url}' />        </button>    </div>    \x3c!-- Library Switcher --\x3e    <span class='image-library-selector form-item inline-block' data-binding='{@visible: showLibrarySwitcher}'>        <label class='symbology-label' data-binding='{@text: @language-common-library}'></label>        <select data-binding='{@source: imageLibraries}{@value: currentLibrary}'>            <option data-binding='{@template-for: imageLibraries}{@text: @context}{@attach: @context}'></option>        </select>    </span>    <div class='symbology-sliders'>        \x3c!-- Size Slider --\x3e        <div class='symbology-numberinput'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-image-size}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: imageSizeViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-pixel-suffix}'></span>            </div>        </div>        \x3c!-- Rotation Slider --\x3e        <div class='symbology-numberinput'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-angle}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: imageRotationViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-degree-suffix}'></span>            </div>        </div>    </div></div><div class='no-symbol-library' data-binding='{@visible: noLibraries}'>    <span data-binding='{@text:  @language-symbology-settings-no-image-libraries}' /></div>",s="<div class='symbology-settings' data-binding='{@var: container}'>    \x3c!-- Group: Colors. --\x3e    <div class='symbology-colors inline-block'>        \x3c!-- Fill color input --\x3e        <div class='color-picker inline-block'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-color}'></label>            <div data-binding='{@widget: ColorPickerWidget}{@widget-context: fill}'></div>        </div>        \x3c!-- Outline color input --\x3e        <div class='inline-block' data-binding='{@hidden: noOutlineSymbol}'>            <div class='color-picker inline-block' data-binding='{@visible: showOutlineColor}'>                <label class='symbology-label' data-binding='{@text: @language-symbology-settings-outline}'></label>                <div data-binding='{@widget: ColorPickerWidget}{@widget-context: outline}'></div>            </div>        </div>    </div>    \x3c!-- Group: Sliders. --\x3e    <div class='symbology-sliders'>        <div class='symbology-numberinput' data-binding='{@visible: isPoint}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-marker-size}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: markerSizeViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-pixel-suffix}'></span>            </div>        </div>        <div class='symbology-numberinput'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-line-width}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: lineWidthViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-pixel-suffix}'></span>            </div>        </div>    </div>    \x3c!-- Group: Drop-downs. --\x3e    <div class='symbology-drop-downs'>        \x3c!-- Marker style drop-down. --\x3e        <div class='symbology-drop-down' data-binding='{@visible: isPoint}{@event-onchange: handleMarkerStyle}{@event-oninput: handleMarkerStyle}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-marker-style}'></label>            <select data-binding='{@source: markerStyles}{@var: markerStyleInput}'>                <option data-binding='{@template-for: markerStyles}{@text: label}'></option>            </select>        </div>        \x3c!-- Line style drop-down. --\x3e        <div class='symbology-drop-down' data-binding='{@visible: showLineStyles}{@event-onchange: handleLineStyle}{@event-oninput: handleLineStyle}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-line-style}'></label>            <select data-binding='{@source: lineStyles}{@var: lineStyleInput}'>                <option data-binding='{@template-for: lineStyles}{@text: label}'></option>            </select>        </div>        \x3c!-- Fill style drop-down. --\x3e        <div class='symbology-drop-down' data-binding='{@visible: isPolygon}{@event-onchange: handleFillStyle}{@event-oninput: handleFillStyle}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-fill-style}'></label>            <select data-binding='{@source: fillStyles}{@var: fillStyleInput}'>                <option data-binding='{@template-for: fillStyles}{@text: label}'></option>            </select>        </div>    </div></div>",l="<div class='symbology-settings text-symbology-settings'>    \x3c!-- Symbol Text --\x3e    <div class='symbology-textinput' data-binding='{@visible: showText}'>        <div class='form-item'>            <label class='symbology-label' data-binding='{@text: @language-common-text}'></label>            <input type='text' data-binding='{@value: symbolText}' />        </div>    </div>    \x3c!-- Group: Colors. --\x3e    <div class='symbology-colors inline-block'>        \x3c!-- Font color input --\x3e        <div class='color-picker inline-block' data-binding='{@visible: showFontColor}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-color}'></label>            <div data-binding='{@widget: ColorPickerWidget}{@widget-context: fontColor}'></div>        </div>        \x3c!-- Halo color input --\x3e        <div class='color-picker inline-block' data-binding='{@visible: showHaloColor}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-halo}'></label>            <div data-binding='{@widget: ColorPickerWidget}{@widget-context: fontHalo}'></div>        </div>    </div>    \x3c!--Font Family--\x3e    <div class='symbology-drop-downs'>        <div class='symbology-drop-down' data-binding='{@visible: showFontFamilies}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-font-family}'></label>            <div class='symbology-form-control'>                <select data-binding='{@source: fontFamilies}{@var: fontFamilyInput}{@value: fontFamily}'>                    <option data-binding='{@template-for: fontFamilies}{@text: @context}'></option>                </select>            </div>        </div>    </div>    \x3c!--Font Style--\x3e    <div class='symbology-form-control inline-block' data-binding='{@enabled: showLabels}{@visible: showFontStyle}'>        <label class='symbology-checkbox'>            <input type='checkbox' data-binding='{@value: fontIsBold}'>            <span data-binding='{@text: @language-symbology-settings-bold}'></span>        </label>        <label class='symbology-checkbox'>            <input type='checkbox' data-binding='{@value: fontIsItalic}'>            <span data-binding='{@text: @language-symbology-settings-italic}'></span>        </label>        <label class='symbology-checkbox'>            <input type='checkbox' data-binding='{@value: fontIsUnderline}'>            <span data-binding='{@text: @language-symbology-settings-underline}'></span>        </label>    </div>    \x3c!--Font Size--\x3e    <div class='symbology-sliders'>        <div class='symbology-numberinput' data-binding='{@visible: showFontSize}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-font-size}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: fontSizeViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-point-suffix}'></span>            </div>        </div>        <div class='symbology-numberinput' data-binding='{@visible: showHaloSize}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-halo-size}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: haloSizeViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-pixel-suffix}'></span>            </div>        </div>        <div class='symbology-numberinput' data-binding='{@visible: showTextAngle}'>            <label class='symbology-label' data-binding='{@text: @language-symbology-settings-angle}'></label>            <div class='numeric-input-wrapper'>                <div class='numeric-input' data-binding='{@widget: NumericInputWidget}{@widget-context: textAngleViewModel}'></div>                <span class='numeric-units' data-binding='{@text: @language-symbology-settings-degree-suffix}'></span>            </div>        </div>    </div></div>";require({cache:{"geocortex/infrastructure/symbology/AttributeSymbologySettingsConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/AttributeSymbologySettingsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/essentials/Field"],function(t,i,o,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WIDGET_ID_BASE="__CLASSWIDGET__";var l=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.displayName=e.app.getResource(e.libraryId,"language-symbology-settings-attribute-displayname"),e}return e(i,t),i.prototype.attach=function(e){e.initialize(this.configuration),t.prototype.attach.call(this,e),this.viewModel.startColor.color.bind(this,this.applySettings),this.viewModel.endColor.color.bind(this,this.applySettings);for(var i=this,o=0,s=this.viewModel.classSymbolWidgets;o<s.length;o++)!function(e){e.symbologyWidget.viewModel.markerSize.sync(i.viewModel.markerSize),e.symbologyWidget.viewModel.lineWidth.sync(i.viewModel.lineWidth),e.symbologyWidget.viewModel.fill.color.syncTransform(i.viewModel.transparency,function(t){return e.symbologyWidget.viewModel.fill.color.get().setAlpha((100-t)/100)}),e.pictureSymbologyWidget&&e.pictureSymbologyWidget.viewModel.imageSize.sync(i.viewModel.markerSize)}(s[o]);this.viewModel.classBreaksInput.range.value.bind(this,this.applySettings),this.viewModel.startColor.color.bind(this,this._updateColorGradient),this.viewModel.endColor.color.bind(this,this._updateColorGradient)},i.prototype.added=function(e){e.attributeSettingsView=this,t.prototype.added.call(this,e),this.viewModel.classBreaksInput.range.value.pulse()},i.prototype.getRenderer=function(){return this.viewModel._getRenderer()},i.prototype.setFromRenderer=function(e){this.viewModel._setFromRenderer(e)},i.prototype.reset=function(){if(this.viewModel.configuring=!0,this.viewModel._reset(),!this.viewModel.currentAttribute.get()){var e=document.createElement("option");e.disabled=!0,e.selected=!0,e.hidden=!0,e.value="",e.text=this.app.getResource(this.libraryId,"language-symbology-settings-attribute-select"),this.attributeInput.add(e,0)}this.viewModel.configuring=!1},i.prototype.handleMarkerStyle=function(){this.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex;for(var e=0,t=this.viewModel.classSymbolWidgets;e<t.length;e++)t[e].symbologyWidget.viewModel.markerStyleIndex=this.viewModel.markerStyleIndex;this.applySettings()},i.prototype.applySettings=function(){if(!this.viewModel.configuring){this.viewModel.configuring=!0;var e;e=this.viewModel.attributes.getLength()<this.attributeInput.length?this.viewModel.attributes.getAt(this.attributeInput.selectedIndex-1):this.viewModel.attributes.getAt(this.attributeInput.selectedIndex),!this.viewModel.creatingClasses&&e&&(e.displayName!==this.viewModel.currentAttribute.get()?this._updateClasses(e):(this.viewModel.isNumericAttribute.get()||0!==this.viewModel.symbologyClasses.getLength())&&(this.viewModel.numericAttributeIsUniqueValue||this.viewModel.symbologyClasses.getLength()===this.viewModel.numBreaks.get())?this.viewModel.symbologyClasses.getLength()>this.viewModel.numBreaks.get()&&this._updateClasses(e):this._updateClasses(e)),this.markerStyleInput.selectedIndex=this.viewModel.markerStyleIndex;for(var t=0,i=this.viewModel.classSymbolWidgets;t<i.length;t++)i[t].applySettings();this.viewModel.configuring=!1}},i.prototype._updateClasses=function(e){var t=this;setTimeout(function(){t.viewModel.configuring=!0,t.viewModel.lineWidth.pulse(),t.viewModel.markerSize.pulse(),t.viewModel.transparency.pulse(),t.viewModel.startColor.color.pulse(),t.viewModel.endColor.color.pulse(),t.viewModel.configuring=!1},0);for(var i=0,o=this.viewModel.classSymbolWidgets;i<o.length;i++)o[i].reset();this.viewModel.creatingClasses=!0,this.app.command("RemoveResultsStatus").execute(),this.viewModel._getFieldInfo(e).then(function(i){var o={field:e,fieldInfo:i};e.dataType===s.EssentialsFieldTypes.essentialsFieldTypeString||o.fieldInfo.isCodedValueDomain()||o.fieldInfo.hasSubtypeCodedValueDomains()?(t.viewModel.classBreaksMode.set(!1),t.viewModel.isNumericAttribute.set(!1),t.viewModel._createUniqueValues(o)):(t.viewModel.classBreaksMode.set(!0),t.viewModel.isNumericAttribute.set(!0),t.viewModel._createClassBreaks(o))}),this.viewModel.currentAttribute.set(e.displayName)},i.prototype._updateColorGradient=function(){if(!this.viewModel.configuring&&!this.viewModel.creatingClasses){this.viewModel.startColor.color.get(),this.viewModel.endColor.color.get();this.viewModel._createRendererClasses()}},i.prototype.handleSymbolClassSelected=function(e){var t=this,i=e.currentTarget.children[0],o=i.textContent||i.innerText,s=this.viewModel.symbologyClasses.getItems().filter(function(e){return e.name===o})[0],l=this.viewModel.symbologyClasses.indexOf(s),n=function(e,t){var i=esri.symbol.fromJson(JSON.parse(t.getSymbol()));i instanceof esri.symbol.PictureMarkerSymbol?(e.isImage.set(!0),e.imageSrc=i.url):(e.isImage.set(!1),e.imageSrc="",e.displayColor=t.symbologyWidget.viewModel.fill.color.get().toHex())};if(o===this.viewModel.selectedClass)this.viewModel.selectedClass=null,s.selected=!1,n(s,this.viewModel.classSymbolWidgets[l]);else{var r=this.viewModel.symbologyClasses.getItems().filter(function(e){return e.name===t.viewModel.selectedClass})[0],a=this.viewModel.symbologyClasses.indexOf(r),g=this.viewModel.classSymbolWidgets[a];r&&(r.selected=!1,n(r,g)),this.viewModel.selectedClass=o,s.selected=!0}this.viewModel.symbologyClasses.pulse(),$(this.viewModel.classSymbolWidgets[l].container).appendTo($("#"+s.widgetId,this.root)),this.viewModel.classSymbolWidgets[l].symbologyWidget.activated(),this.viewModel.classSymbolWidgets[l].pictureSymbologyWidget&&this.viewModel.classSymbolWidgets[l].pictureSymbologyWidget.activated()},i}(o.ViewBase);i.AttributeSymbologySettingsView=l})},"geocortex/infrastructure/symbology/AttributeSymbologySettingsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/essentials/Field","./../gis/FieldInfo","./SymbologySettingsViewModel","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./SymbolColor","./../ColorUtils","./DataClassificationUtils","./AttributeSymbologySettingsView","./../LayerIntegrationUtils","./../TaskUtils","./../commandArgs/AddStatusArgs","./../SymbolUtils","./../ArrayUtils"],function(t,i,o,s,l,n,r,a,g,d,c,u,y,m,b,h){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var p=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.attributes=new r.ObservableCollection,e.currentAttribute=new r.Observable(""),e.classBreaksMode=new r.Observable(!1),e.isNumericAttribute=new r.Observable(!1),e.symbologyClasses=new r.ObservableCollection([]),e.classSymbolWidgets=[],e.startColor={color:new r.Observable},e.endColor={color:new r.Observable},e.numBreaks=new r.Observable(5),e.markerSize=new r.Observable(10),e.lineWidth=new r.Observable(2),e.transparency=new r.Observable(10),e.noMarker=new r.Observable(!1),e.markerStyles=new r.ObservableCollection([{style:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,label:e.getResource("language-symbology-settings-marker-style-circle")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_CROSS,label:e.getResource("language-symbology-settings-marker-style-cross")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,label:e.getResource("language-symbology-settings-marker-style-diamond")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,label:e.getResource("language-symbology-settings-marker-style-square")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_X,label:e.getResource("language-symbology-settings-marker-style-x")}]),e.markerStyleIdLookup={circle:"esriSMSCircle",cross:"esriSMSCross",diamond:"esriSMSDiamond",square:"esriSMSSquare",x:"esriSMSX"},e.configuring=!1,e.creatingClasses=!1,e.numericAttributeIsUniqueValue=!1,e.queryResults=[],e}return e(i,t),i.prototype.initialize=function(e){void 0===e&&(e={}),this.config=e;var t=this.app.configModel.widgetConfigs.filter(function(e){return"AttributeSymbologySettings"===e.id})[0],i={};t?($.extend(i,t.configuration,e),this.config=i):this.config=e;var o=this.config.classSymbolizationConfig||{};o.symbologyConfig||(o.symbologyConfig={}),o.pictureSymbologyConfig||(o.pictureSymbologyConfig={}),this.maxRenderClasses=this.config.maxRenderClasses>1?this.config.maxRenderClasses:12,this.maxSamples=this.config.maxSamples||1e3,this.classBreaksInput={range:{min:2,max:this.maxRenderClasses,value:this.numBreaks,step:1},showSlider:this.config.showSliders,updateOnDrag:!1},this.config.transparency=this.config.transparency||{min:0,max:100,value:10,step:5},this.transparency.set(this.config.transparency.value),this.transparencyInput={range:{min:this.config.transparency.min,max:this.config.transparency.max,value:this.transparency,step:this.config.transparency.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.classSymbolizationConfig.symbologyConfig.markerSize=this.config.classSymbolizationConfig.symbologyConfig.markerSize||{min:0,max:50,value:16,step:1},this.markerSize.set(this.config.classSymbolizationConfig.symbologyConfig.markerSize.value),this.markerSizeInput={range:{min:this.config.classSymbolizationConfig.symbologyConfig.markerSize.min,max:this.config.classSymbolizationConfig.symbologyConfig.markerSize.max,value:this.markerSize,step:this.config.classSymbolizationConfig.symbologyConfig.markerSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.classSymbolizationConfig.symbologyConfig.lineWidth=this.config.classSymbolizationConfig.symbologyConfig.lineWidth||{min:0,max:10,value:2,step:1},this.lineWidth.set(this.config.classSymbolizationConfig.symbologyConfig.lineWidth.value),this.lineWidthInput={range:{min:this.config.classSymbolizationConfig.symbologyConfig.lineWidth.min,max:this.config.classSymbolizationConfig.symbologyConfig.lineWidth.max,value:this.lineWidth,step:this.config.classSymbolizationConfig.symbologyConfig.lineWidth.step},showSlider:this.config.showSliders,updateOnDrag:!0};for(var s=0;s<this.maxRenderClasses;s++){var n=void 0;n=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/symbology/SymbologySettingsView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.SymbologySettingsView",isVisible:!0,libraryId:"Mapping.Infrastructure"});var r=new l.SymbologySettingsViewModel(this.app,"Mapping.Infrastructure");n.configuration=this.config.classSymbolizationConfig,n.attach(r),n.applySettings(),this.classSymbolWidgets.push(n)}this.markerStyles.set(this.classSymbolWidgets[0].symbologyWidget.viewModel.markerStyles.getItems()),this.markerStyleIndex=0;var a=g.generateRandomColor();this.startColor.color.set(a.lighten(.9)),this.endColor.color.set(a.darken(.6)),this.defaultLineSymbol=new esri.symbol.SimpleLineSymbol,this.defaultLineSymbol.setColor(new esri.Color(this.config.defaultLineColor||[75,75,75,1])),this.defaultLineSymbol.setWidth(this.config.defaultLineWidth||2),this.defaultPointSymbol=new esri.symbol.SimpleMarkerSymbol,this.defaultPointSymbol.setColor(new esri.Color(this.config.defaultPointColor||[150,150,150,.8])),this.defaultPointSymbol.setSize(this.config.defaultPointSize||12),this.defaultPointSymbol.setOutline(this.defaultLineSymbol),this.defaultPolygonSymbol=new esri.symbol.SimpleFillSymbol,this.defaultPolygonSymbol.setColor(new esri.Color(this.config.defaultFillColor||[150,150,150,.3])),this.defaultPolygonSymbol.setOutline(this.defaultLineSymbol)},i.prototype._reset=function(){this.attributes.set([]),this.currentAttribute.set(""),this.classBreaksMode.set(!1),this.isNumericAttribute.set(!1),this.symbologyClasses.set([]),this.selectedClass="",this.transparency.set(this.config.transparency.value),this.markerSize.set(this.config.classSymbolizationConfig.symbologyConfig.markerSize.value),this.lineWidth.set(this.config.classSymbolizationConfig.symbologyConfig.lineWidth.value),this.markerStyleIndex=0;var e=g.generateRandomColor();this.startColor.color.set(e.lighten(.9)),this.endColor.color.set(e.darken(.6));for(var t=0,i=this.classSymbolWidgets;t<i.length;t++)i[t].reset();this.queryResults=[]},i.prototype._getRenderer=function(){var e,t,i=this;if(0===this.symbologyClasses.getLength())return"";t="point"===this.featureType.toLowerCase().trim()?this.defaultPointSymbol:"polyline"===this.featureType.toLowerCase().trim()?this.defaultLineSymbol:this.defaultPolygonSymbol;var o=this.attributes.getItems().filter(function(e){return e.displayName===i.currentAttribute.get()})[0],s="";if(o&&(s=o.name,o.layer.mapService.serviceLayer instanceof esri.layers.WFSLayer)){var l=o.name.indexOf(":");s=l>-1?o.name.substring(l+1).trim():o.name.trim()}if(this.classBreaksMode.get()){e=new esri.renderer.ClassBreaksRenderer(t,s);for(a=0;a<this.symbologyClasses.getLength();a++){var n=this.symbologyClasses.getAt(a),r=this.classSymbolWidgets[a];e.addBreak({minValue:n.min,maxValue:n.max,symbol:esri.symbol.fromJson(JSON.parse(r.getSymbol())),label:n.name})}}else{e=new esri.renderer.UniqueValueRenderer(t,s);for(var a=0;a<this.symbologyClasses.getLength();a++){var n=this.symbologyClasses.getAt(a),r=this.classSymbolWidgets[a];e.addValue({value:n.value,symbol:esri.symbol.fromJson(JSON.parse(r.getSymbol())),label:n.name})}}return JSON.stringify(e.toJson())},i.prototype._setFromRenderer=function(e){var t=this,i=e.toJson();this.creatingClasses=!0;var s=this.attributes.getItems().filter(function(e){return e.name===i.field||e.name===i.field1})[0];this._getFieldInfo(s).then(function(e){t.configuring=!0,t.isNumericAttribute.set(s.dataType!==o.EssentialsFieldTypes.essentialsFieldTypeString&&!t._hasCodedDomain(e)),"classBreaks"===i.type?t._setFromClassBreaksRenderer(i,e):"uniqueValue"===i.type&&t._setFromUniqueValueRenderer(i,e),t.configuring=!1,t.symbologyClasses.pulse(),t.creatingClasses=!1})},i.prototype._setFromClassBreaksRenderer=function(e,t){this.classBreaksMode.set(!0);var i=e.minValue;this.numBreaks.set(e.classBreakInfos.length);for(var o=0;o<e.classBreakInfos.length;o++){var s=e.classBreakInfos[o],l=new esri.Color(s.symbol.color||"#FFFFFF"),n=this.classSymbolWidgets[o],g=esri.symbol.fromJson(s.symbol);this._configureSymbolWidget(n,g),s.classMinValue&&(i=s.classMinValue),g instanceof esri.symbol.PictureMarkerSymbol?this.symbologyClasses.addItem({name:t.formatValue(i)+" - "+t.formatValue(s.classMaxValue),min:i,max:s.classMaxValue,displayColor:l.toHex(),selected:!1,isImage:new r.Observable(!0),imageSrc:g.url,widgetId:c.WIDGET_ID_BASE+o.toString()}):this.symbologyClasses.addItem({name:t.formatValue(i)+" - "+t.formatValue(s.classMaxValue),min:i,max:s.classMaxValue,displayColor:l.toHex(),selected:!1,isImage:new r.Observable(!1),imageSrc:"",widgetId:c.WIDGET_ID_BASE+o.toString()}),i=s.classMaxValue,0===o&&(this.startColor.color.set(new a.SymbolColor(l)),this._setFromSymbol(s.symbol)),o===e.classBreakInfos.length-1&&this.endColor.color.set(new a.SymbolColor(l))}},i.prototype._setFromUniqueValueRenderer=function(e,t){this.classBreaksMode.set(!1);for(var i=0;i<e.uniqueValueInfos.length;i++){var o=e.uniqueValueInfos[i],s=new esri.Color(o.symbol.color||"#FFFFFF"),l=this.classSymbolWidgets[i],n=esri.symbol.fromJson(o.symbol);this._configureSymbolWidget(l,n);var g=void 0;(t.isCodedValueDomain()||t.hasSubtypeCodedValueDomains())&&(g=t.esriField.domain.getName(o.value)),g||(g=t.formatValue(o.value)),n instanceof esri.symbol.PictureMarkerSymbol?this.symbologyClasses.addItem({name:g,value:o.value,displayColor:s.toHex(),selected:!1,isImage:new r.Observable(!0),imageSrc:n.url,widgetId:c.WIDGET_ID_BASE+i.toString()}):this.symbologyClasses.addItem({name:g,value:o.value,displayColor:s.toHex(),selected:!1,isImage:new r.Observable(!1),imageSrc:"",widgetId:c.WIDGET_ID_BASE+i.toString()}),0===i&&(this.startColor.color.set(new a.SymbolColor(s)),this._setFromSymbol(o.symbol)),i===e.uniqueValueInfos.length-1&&this.endColor.color.set(new a.SymbolColor(s))}},i.prototype._setFromSymbol=function(e){var t=this;if(this._isPictureMarkerSymbol(e))this._setFromPictureMarkerSymbol(e);else{this.transparency.set(Math.floor(Math.ceil((255-e.color[3])/255*100)/this.config.transparency.step)*this.config.transparency.step),this.markerSize.set($.isNumeric(e.size)?Math.floor(e.size*b.POINTS_TO_PIXELS):this.config.classSymbolizationConfig.symbologyConfig.markerSize.value);var i=this.markerStyles.getItems().filter(function(i){return t.markerStyleIdLookup[i.style]===e.style})[0];this.markerStyleIndex=i?this.markerStyles.indexOf(i):0;var o="Point"!==this.featureType&&"Polygon"!==this.featureType?e:e.outline;this.lineWidth.set($.isNumeric(o.width)?Math.floor(o.width*b.POINTS_TO_PIXELS):this.config.classSymbolizationConfig.symbologyConfig.lineWidth.value)}},i.prototype._setFromPictureMarkerSymbol=function(e){this.transparency.set(this.transparencyInput.range.min),this.markerSize.set(Math.max(e.width,e.height)*b.POINTS_TO_PIXELS),this.markerStyleIndex=0},i.prototype._createClassBreaks=function(e){var t=this;this.symbologyClasses.set([]);var i=this.app.map.extent;this._executeExtentQuery(e.field,i).then(function(i){t._executeQuery(e.field,i).then(function(i){if(t._findDistinctValues(i,e.field.name).length<=t.numBreaks.get())return t.classBreaksMode.set(!1),t.numericAttributeIsUniqueValue=!0,void t._createUniqueValues(e);t.numericAttributeIsUniqueValue=!1;var o=i.features.map(function(t){return t.attributes[e.field.name]}),s=d.findSignificanceFactor(o),l=d.ckmeans(o,t.numBreaks.get());if(0!==s&&1!==s)for(n=0;n<l.length;n++)l[n]=l[n].map(function(e){return e/s});for(var n=0;n<l.length;n++){var a=void 0,g=void 0;if(0===n)a=Math.floor(Math.min.apply(Math,l[n]));else{var u=Math.min.apply(Math,l[n]);u>Math.max.apply(Math,l[n-1])+1?(a=Math.floor(u-(u-Math.max.apply(Math,l[n-1]))/2),1===s&&a++):a=Math.floor(u)}if(n===l.length-1)g=Math.ceil(Math.max.apply(Math,l[n]));else{var y=Math.max.apply(Math,l[n]),m=Math.min.apply(Math,l[n+1]);g=y<m-1?Math.floor(y+(m-y)/2):s<=1?Math.floor(y):Math.floor(m)}0!==s&&1!==s&&(a*=s,g*=s);var b=void 0;b=g-a==0?e.fieldInfo.formatValue(a):e.fieldInfo.formatValue(a)+" - "+e.fieldInfo.formatValue(g),t.symbologyClasses.addItem({name:b,min:a,max:g,count:l[n].length,displayColor:"#FFFFFF",selected:!1,isImage:new r.Observable(!1),imageSrc:"",widgetId:c.WIDGET_ID_BASE+t.symbologyClasses.getLength().toString()})}t._createRendererClasses()},function(e){var i=new m.AddStatusArgs(e.message);i.regionName="VisualisationStatusRegion",i.id="VisualizationStatusMessageView",t.app.command("AddStatus").execute(i)})})},i.prototype._createUniqueValues=function(e){var t=this;this.symbologyClasses.set([]);var i=this.app.map.extent;this._executeExtentQuery(e.field,i).then(function(i){t._executeQuery(e.field,i).then(function(i){for(var o=0,s=i.features;o<s.length;o++)!function(i){var o=null!=i.attributes[e.field.name]&&""!==i.attributes[e.field.name].toString().trim()?i.attributes[e.field.name].toString():null;if(o){var s=void 0;t._hasCodedDomain(e.fieldInfo)&&(s=e.fieldInfo.esriField.domain.getName(i.attributes[e.field.name])),s||(s=e.fieldInfo.formatValue(o));var l=t.symbologyClasses.getItems().filter(function(e){return e.value===o})[0];l?l.count++:t.symbologyClasses.addItem({name:s,value:o,count:1,displayColor:"#FFFFFF",selected:!1,isImage:new r.Observable(!1),imageSrc:"",widgetId:c.WIDGET_ID_BASE+t.symbologyClasses.getLength().toString()})}}(s[o]);if(0===t.symbologyClasses.getLength()){var l=new m.AddStatusArgs(t.app.getResource(t.libraryId,"language-symbology-settings-nodata"));return l.regionName="VisualizationStatusRegion",l.id="VisualizationStatusMessageView",t.app.command("AddResultsStatus").execute(l),void t.currentAttribute.set("")}t._constrainToMaxClasses(e.field).then(function(){t.isNumericAttribute.get()?t.symbologyClasses.getItems().sort(function(e,t){return Number(e.value)-Number(t.value)}):t.symbologyClasses.getItems().sort(),t._createRendererClasses()})},function(e){var i=new m.AddStatusArgs(e.message);i.regionName="VisualisationStatusRegion",i.id="VisualizationStatusMessageView",t.app.command("AddResultsStatus").execute(i)})})},i.prototype._createRendererClasses=function(){var e,t=[],i=this.symbologyClasses.getLength();if(this.isNumericAttribute.get()){for(s=0;s<i;s++){var o=i>1?s/(i-1):.5;t.push(this.startColor.color.get().blend(o,this.endColor.color.get()))}e=this.startColor.color.get().value>=.7?this.startColor.color.get().darken(.6,!1):this.startColor.color.get().lighten(.9,!1)}else t=g.generateRandomColors(i),e=new a.SymbolColor(this.defaultLineSymbol.color.toHex());for(var s=0;s<i;s++){this.symbologyClasses.getAt(s).displayColor=t[s].toHex();var l=this.classSymbolWidgets[s];l.symbologyWidget.viewModel.fill.color.set(t[s]),l.symbologyWidget.viewModel.outline.color.set(e),l.setFeatureType(this.featureType),l.applySettings()}this.symbologyClasses.pulse(),this.numBreaks.set(this.symbologyClasses.getLength()),this.creatingClasses=!1},i.prototype._executeQuery=function(e,t){var i=this;return new Promise(function(o,s){if(e.layer instanceof u.LocalLayer){var l=e.layer.mapService.serviceLayer.graphics,n=new esri.tasks.FeatureSet;n.features=l,o(n)}else{var r=new esri.tasks.Query,a=y.getQueryTask(e.layer);r.returnGeometry=!1,r.geometry=t,r.outFields=[e.name];var g=b.stringToHash(a.url+e.name+t.toJson()),d=i.queryResults[g];d?o(d):a.execute(r,function(e){i.queryResults[g]=e,o(e)},function(e){i.app.trace.error(e.message),s(e)})}})},i.prototype._executeExtentQuery=function(e,t){return e.layer instanceof u.LocalLayer?Promise.resolve(t):this.classBreaksMode.get()?this._executeClassBreaksExtentQuery(e,t):this._executeUniqueValueExtentQuery(e,t)},i.prototype._executeUniqueValueExtentQuery=function(e,t){var i=this;return new Promise(function(o,s){var l=-1,n=function(s){var n=i._findDistinctValues(s,e.name).length;n>=(i.isNumericAttribute.get()?i.numBreaks.get():i.maxRenderClasses)||n===l||s.exceededTransferLimit?o(t):(l=n,t=t.expand(2),r())},r=function(){var s=new esri.tasks.Query,l=y.getQueryTask(e.layer);s.returnGeometry=!1,s.geometry=t,s.outFields=[e.name];var r=b.stringToHash(l.url+e.name+JSON.stringify(t.toJson())),a=i.queryResults[r];a?n(a):l.execute(s).then(function(e){i.queryResults[r]=e,n(e)},function(e){o(t)})};r()})},i.prototype._executeClassBreaksExtentQuery=function(e,t){var i=this;return new Promise(function(o,s){var l=-1,n=function(){var s=new esri.tasks.Query,r=y.getQueryTask(e.layer);s.returnGeometry=!1,s.geometry=t,r.executeForCount(s).then(function(e){e>=i.maxSamples||e===l?o(t):(l=e,t=t.expand(2),n())},function(e){o(t)})};n()})},i.prototype._constrainToMaxClasses=function(e){var t=this;return new Promise(function(i,o){if(t.symbologyClasses.getLength()>t.maxRenderClasses||t.symbologyClasses.getLength()>t.numBreaks.get()||t.isNumericAttribute.get()){if(t.symbologyClasses.getLength()>t.maxRenderClasses&&!t.isNumericAttribute.get()){var s=new m.AddStatusArgs(t.app.getResource(t.libraryId,"language-symbology-settings-exceeded-max-classes").format(t.maxRenderClasses));s.regionName="VisualizationStatusRegion",s.id="VisualizationStatusMessageView",t.app.command("AddResultsStatus").execute(s)}var l=t.isNumericAttribute.get()?t.numBreaks.get():t.maxRenderClasses;if(e.layer instanceof u.LocalLayer){var n=t.symbologyClasses.getItems().sort(function(e,t){return e.count<t.count?1:e.count>t.count?-1:0});t.symbologyClasses.set(n.slice(0,l)),i()}else{var r=t.app.map.extent,a=new esri.tasks.Query,g=y.getQueryTask(e.layer);a.returnGeometry=!1,a.geometry=r,a.outFields=[e.name],g.execute(a,function(o){var s=t._findDistinctValues(o,e.name),n=t.symbologyClasses.getItems().sort(function(e,t){return-1===s.indexOf(e.name)&&s.indexOf(t.name)>-1?1:s.indexOf(e.name)>-1&&-1===s.indexOf(t.name)?-1:e.count<t.count?1:e.count>t.count?-1:0});t.symbologyClasses.set(n.slice(0,l)),i()},function(e){i()})}}else i()})},i.prototype._configureSymbolWidget=function(e,t){e.reset(),e.setFeatureType(this.featureType),e.setFromSymbol(t)},i.prototype._findDistinctValues=function(e,t){var i=e.features.map(function(e){if(null!=e.attributes[t])return e.attributes[t].toString()});return h.ArrayUtils.unique(i)},i.prototype._getFieldInfo=function(e){var t;return new Promise(function(i,o){if(e.layer.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var l=e.layer.mapService.serviceLayer;t=l.getField(e.name),i(s.FieldInfo.fromEsriField(t,l,e))}else e.layer.getFeatureLayer().then(function(o){t=o.getField(e.name),i(s.FieldInfo.fromEsriField(t,o,e))})})},i.prototype._hasCodedDomain=function(e){return!(!e.esriField||!e.esriField.domain)},i.prototype._isPictureMarkerSymbol=function(e){return!(!e.url&&!e.imageData||!e.width||!e.height)},i}(n.ViewModelBase);i.AttributeSymbologySettingsViewModel=p})},"geocortex/infrastructure/symbology/DataClassificationUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e,t){for(var i=[],o=0;o<e;o++){for(var s=[],l=0;l<t;l++)s.push(0);i.push(s)}return i}function o(e){for(var t,i=0,o=0;o<e.length;o++)0!==o&&e[o]==t||(t=e[o],i++);return i}function s(){return 1.1.toLocaleString().substring(1,2)}Object.defineProperty(t,"__esModule",{value:!0}),t.ckmeans=function(e,t){if(t>e.length)return[];for(var s=e.slice().sort(function(e,t){return e-t}),l=(o(s),i(t,s.length)),n=i(t,s.length),r=0;r<t;r++)for(var a=s[0],g=Math.max(r,1);g<s.length;g++)if(0===r){var d=Math.pow(s[g]-a,2);l[r][g]=l[r][g-1]+g/(g+1)*d,a=(g*a+s[g])/(g+1)}else for(var c=0,u=0,y=g;y>=r;y--)c+=(g-y)/(g-y+1)*Math.pow(s[y]-u,2),u=(s[y]+(g-y)*u)/(g-y+1),y===g?(l[r][g]=c,n[r][g]=y,y>0&&(l[r][g]+=l[r-1][y-1])):c+l[r-1][y-1]<l[r][g]&&(l[r][g]=c+l[r-1][y-1],n[r][g]=y);for(var m=[],b=n[0].length-1,r=n.length-1;r>=0;r--){var h=n[r][b];m[r]=s.slice(h,b+1),r>0&&(b=h-1)}return m},t.createMatrix=i,t.uniqueCountSorted=o,t.findSignificanceFactor=function(e){var t,i=s(),o=e.filter(function(e){return null!==e}).map(function(e){var t=e.toString().split(i)[1];return t?parseFloat(t)/Math.pow(10,t.length):0}),l=e.filter(function(e){return null!==e}).map(function(e){return Math.floor(e)}),n=Math.min.apply(Math,l.filter(function(e){return 0!==e}));t=0===n||n===1/0?0:Math.floor(Math.log(Math.abs(n))/Math.LN10);var r,a=Math.max.apply(Math,l);0===a?t=0:r=Math.floor(Math.log(Math.abs(a))/Math.LN10);var g=r-t,d=Math.max.apply(Math,o.filter(function(e){return 0!==e}));if(0===d||Math.abs(d)===1/0){var c=a-n,u=Math.floor(Math.log(Math.abs(c))/Math.LN10);return Math.pow(10,g-u<0?0:g-u)}var y,m=Math.floor(Math.log(Math.abs(d))/Math.LN10),b=Math.min.apply(Math,o.filter(function(e){return 0!==e}));if(m-(y=0===b||Math.abs(b)===1/0?0:Math.floor(Math.log(Math.abs(b))/Math.LN10))<=1){var h=o.map(function(e){var t=e.toString().split(i)[1];return t?t.length:0}),p=Math.max.apply(Math,h);return Math.pow(10,-p)}return Math.pow(10,y+g)},t.getDecimalSeparator=s})},"geocortex/infrastructure/symbology/MarkupTemplates":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/SymbolColor":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){if(e instanceof esri.Color)this._fromEsriColor(e);else if(this._isHSV(e))this.hue=this._clamp(e.h,0,1),this.value=this._clamp(e.v,0,1),this.saturation=this._clamp(e.s,0,1),this.alpha=null==e.a?1:this._clamp(e.a,0,1);else if(this._isRGB(e)){o=void 0;o=e.r>1&&e.g>1&&e.b>1?this._fromRGB({r:e.r/255,g:e.g/255,b:e.b/255,a:e.a}):this._fromRGB({r:this._clamp(e.r,0,1),g:this._clamp(e.g,0,1),b:this._clamp(e.b,0,1)}),this.hue=o.h,this.value=o.v,this.saturation=o.s,this.alpha=null==e.a?1:this._clamp(e.a,0,1)}else{var t=esri.Color.fromRgb(e);if(t)this._fromEsriColor(t);else{var i=this._hexToRGB(e),o=this._fromRGB(i);this.hue=o.h,this.value=o.v,this.saturation=o.s,this.alpha=1}}}return e.prototype.toHex=function(){return this._rgbToHex(this.toRGB())},e.prototype.toRGBAString=function(){var e=this.toRGB();return"rgba("+Math.round(255*e.r).toString()+","+Math.round(255*e.g).toString()+","+Math.round(255*e.b).toString()+","+e.a.toString()+")"},e.prototype.toEsriColor=function(e){void 0===e&&(e=!0);var t=new esri.Color,i=this.toRGB();return t.r=Math.round(255*i.r),t.g=Math.round(255*i.g),t.b=Math.round(255*i.b),t.a=e?i.a:1,t},e.prototype.darken=function(t,i){return void 0===i&&(i=!0),t=this._clamp(t,0,1),new e({h:this.hue,v:this.value*(1-t),s:this.saturation,a:i?this.alpha:1})},e.prototype.lighten=function(t,i){return void 0===i&&(i=!0),t=this._clamp(t,0,1),new e({h:this.hue,v:this.value+(1-this.value)*t,s:this.saturation*(1-t),a:i?this.alpha:1})},e.prototype.blend=function(t,i){t=this._clamp(t,0,1);var o=i.toRGB(),s=this.toRGB(),l=s.r+(o.r-s.r)*t,n=s.b+(o.b-s.b)*t;return new e({r:l,g:s.g+(o.g-s.g)*t,b:n,a:s.a+(o.a-s.a)*t})},e.prototype.toRGB=function(){var e,t,i,o=this.saturation*this.value,s=6*this.hue,l=o*(1-Math.abs(s%2-1)),n=this.value-o;switch(Math.floor(s)%6){case 0:e=o+n,t=l+n,i=n;break;case 1:e=l+n,t=o+n,i=n;break;case 2:e=n,t=o+n,i=l+n;break;case 3:e=n,t=l+n,i=o+n;break;case 4:e=l+n,t=n,i=o+n;break;case 5:e=o+n,t=n,i=l+n}return{r:e,g:t,b:i,a:this.alpha}},e.prototype.equals=function(e){return e.hue===this.hue&&e.value===this.value&&e.saturation===this.saturation&&e.alpha===this.alpha},e.prototype.setAlpha=function(t){return new e({h:this.hue,s:this.saturation,v:this.value,a:t})},e.prototype._fromRGB=function(e){var t,i,o,s,l=Math.max(e.r,e.g,e.b),n=l-Math.min(e.r,e.g,e.b);return s=0===n?0:l===e.r?(e.g-e.b)/n:l===e.g?2+(e.b-e.r)/n:4+(e.r-e.g)/n,(t=s/6)<0&&(t+=1),i=0===n?0:n/l,o=l,{h:t,s:i,v:o,a:null==e.a?1:e.a}},e.prototype._fromEsriColor=function(e){var t=this._fromRGB({r:e.r/255,g:e.g/255,b:e.b/255,a:e.a});this.hue=t.h,this.value=t.v,this.saturation=t.s,this.alpha=t.a},e.prototype._rgbToHex=function(e){return"#"+("00"+Math.floor(255*e.r).toString(16)).slice(-2)+("00"+Math.floor(255*e.g).toString(16)).slice(-2)+("00"+Math.floor(255*e.b).toString(16)).slice(-2)},e.prototype._hexToRGB=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,o){return t+t+i+i+o+o});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16)/255,g:parseInt(i[2],16)/255,b:parseInt(i[3],16)/255,a:1}:null},e.prototype._clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},e.prototype._isHSV=function(e){return!!($.isNumeric(e.h)&&$.isNumeric(e.s)&&$.isNumeric(e.v))},e.prototype._isRGB=function(e){return!!($.isNumeric(e.r)&&$.isNumeric(e.g)&&$.isNumeric(e.b))},e}();t.SymbolColor=i})},"geocortex/infrastructure/symbology/SymbolEditorView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./SymbolType","./../SymbolUtils"],function(t,i,o,s,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o.displayName=o.app.getResource("Mapping.Infrastructure","language-symbology-selector-symbol-displayname"),o.customSymbolCreated={},o}return e(i,t),i.prototype.attach=function(e){var i=this;e.initialize(this.configuration),t.prototype.attach.call(this,e),this.viewModel.selectorMode.bind(this,function(e){switch(e){case"Custom":i._selectWidget(i.viewModel.symbolWidget.id);break;case"Image":i._selectWidget(i.viewModel.pictureSymbolWidget.id)}i.applySettings()}),this.viewModel.symbolWidget.onChange=function(e){return i.onChange(e)},this.viewModel.pictureSymbolWidget.onChange=function(e){return i.onChange(e)},this.viewModel.textSymbolWidget.onChange=function(e){return i.onChange(e)}},i.prototype.setSymbolType=function(e){var t=l.fromEsriSymbolType(e);t&&(this.viewModel.markupType.set(t),this.viewModel.showSymbologySelectorMenu.set(t===s.SymbolType.POINT),t===s.SymbolType.TEXT?this._selectWidget(this.viewModel.textSymbolWidget.id):(this.viewModel.symbolWidget.setFeatureType(t),"picturemarkersymbol"===e?(this.viewModel.selectorMode.set("Image"),this._selectWidget(this.viewModel.pictureSymbolWidget.id)):(this.viewModel.selectorMode.set("Custom"),this._selectWidget(this.viewModel.symbolWidget.id))))},i.prototype.setFromSymbol=function(e){if(e){var t=l.fromEsriSymbolType(e.type);t&&(this.setSymbolType(e.type),t===s.SymbolType.TEXT?this.viewModel.textSymbolWidget.setFromSymbol(e):"picturemarkersymbol"===e.type?this.viewModel.pictureSymbolWidget.setFromSymbol(e):(this.viewModel.symbolWidget.setFromSymbol(e),this.customSymbolCreated[t]=!0))}},i.prototype.getSymbol=function(){return this.viewModel.markupType.equals(s.SymbolType.TEXT)?(this.viewModel.textSymbolWidget.applySettings(),this.viewModel.textSymbolWidget.activated(),this.viewModel.textSymbolWidget.getSymbol()):this.viewModel.selectorMode.equals("Image")?(this.viewModel.pictureSymbolWidget.applySettings(),this.viewModel.pictureSymbolWidget.activated(),this.viewModel.pictureSymbolWidget.getSymbol()):(this.customSymbolCreated[this.viewModel.markupType.get()]||(this.viewModel.symbolWidget.setFromSymbol(l.defaultMarkupSymbol(this.viewModel.markupType.get())),this.customSymbolCreated[this.viewModel.markupType.get()]=!0),this.viewModel.symbolWidget.applySettings(),this.viewModel.symbolWidget.activated(),this.viewModel.symbolWidget.getSymbol())},i.prototype.applySettings=function(){this.viewModel.markupType.equals(s.SymbolType.TEXT)?this.viewModel.textSymbolWidget.applySettings():this.viewModel.selectorMode.equals("Image")?this.viewModel.pictureSymbolWidget.applySettings():this.viewModel.symbolWidget.applySettings()},i.prototype.reset=function(){this.viewModel._reset()},i.prototype.added=function(e){e&&(e.symbolEditorWidget=this,t.prototype.added.call(this,e))},i.prototype._selectWidget=function(e){this.viewModel.symbolWidget.id===e?this.app.viewManager.activateView(this.viewModel.symbolWidget):this.app.viewManager.deactivateView(this.viewModel.symbolWidget),this.viewModel.textSymbolWidget.id===e?this.app.viewManager.activateView(this.viewModel.textSymbolWidget):this.app.viewManager.deactivateView(this.viewModel.textSymbolWidget),this.viewModel.pictureSymbolWidget.id===e?this.app.viewManager.activateView(this.viewModel.pictureSymbolWidget):this.app.viewManager.deactivateView(this.viewModel.pictureSymbolWidget)},i}(o.ViewBase);i.SymbolEditorView=n})},"geocortex/infrastructure/symbology/SymbolEditorViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./widgets/SimpleSymbolWidgetViewModel","./widgets/TextSymbolWidgetViewModel","./widgets/PictureSymbolWidgetViewModel","geocortex/framework/utils/utils"],function(t,i,o,s,l,n,r,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var g=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o.initialized=!1,o.markupType=new s.Observable(null),o.showSymbologySelectorMenu=new s.Observable(!1),o.selectorMode=new s.Observable(null),o.regionName="SymbolSelectorRegion-"+a.alphaNumericToken(),o}return e(i,t),i.prototype.initialize=function(e){if(!this.initialized){t.prototype.initialize.call(this,e),this.config=e,this.textSymbolWidget=this.app.viewManager.createView({viewId:"TextSymbolWidget-"+a.alphaNumericToken(),markupResource:"Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.TextSymbolWidget",regionName:this.regionName,isVisible:!1,libraryId:"Mapping.Infrastructure"});var i=new n.TextSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),o=this.config.textSymbologyConfig||this.app.configModel.widgetConfigs.filter(function(e){return"TextSymbolWidget"===e.id})[0].configuration;i.initialize(o),this.textSymbolWidget.attach(i),this.pictureSymbolWidget=this.app.viewManager.createView({viewId:"PictureSymbolWidget-"+a.alphaNumericToken(),markupResource:"Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.PictureSymbolWidget",regionName:this.regionName,isVisible:!1,libraryId:"Mapping.Infrastructure"});var s=new r.PictureSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),g=this.config.textSymbologyConfig||this.app.configModel.widgetConfigs.filter(function(e){return"PictureSymbolWidget"===e.id})[0].configuration;s.initialize(g),this.pictureSymbolWidget.attach(s),this.symbolWidget=this.app.viewManager.createView({viewId:"SimpleSymbolWidget-"+a.alphaNumericToken(),markupResource:"Mapping/infrastructure/symbology/widgets/SimpleSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.SimpleSymbolWidget",regionName:this.regionName,isVisible:!1,libraryId:"Mapping.Infrastructure"});var d=new l.SimpleSymbolWidgetViewModel(this.app,"Mapping.Infrastructure"),c=this.config.symbologyConfig||this.app.configModel.widgetConfigs.filter(function(e){return"SimpleSymbolWidget"===e.id})[0].configuration;d.initialize(c),this.symbolWidget.attach(d),this.initialized=!0}},i.prototype._reset=function(){this.symbolWidget.reset(),this.textSymbolWidget.reset(),this.pictureSymbolWidget.reset()},i}(o.ViewModelBase);i.SymbolEditorViewModel=g})},"geocortex/infrastructure/symbology/SymbologySettingsConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/SymbologySettingsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./widgets/PictureSymbolWidgetViewModel","geocortex/framework/utils/utils"],function(t,i,o,s,l){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o.displayName=o.app.getResource(o.libraryId,"language-symbology-settings-symbol-displayname"),o}return e(i,t),i.prototype.attach=function(e){t.prototype.attach.call(this,e),this.viewModel=e,this.pictureSymbologyWidget&&(this.pictureSymbologyWidget.viewModel.parentSymbologyView=this),this.symbologyWidget.viewModel.parentSymbologyView=this,this.viewModel.imageSelector=this.pictureSymbologyWidget,this.viewModel.symbolSelector=this.symbologyWidget,this.viewModel.initialize(this.configuration)},i.prototype.added=function(e){e&&(e.symbologySettingsWidget=this,t.prototype.added.call(this,e))},i.prototype.resolveWidget=function(e,i,o){if(t.prototype.resolveWidget.call(this,e,i),"CustomizedPictureSymbolWidget"===e&&this.configuration.enableImageSelector){var n="PictureSymbolWidget-"+l.alphaNumericToken();this.pictureSymbologyWidget=this.app.viewManager.createView({viewId:n,markupResource:"Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.symbology.PictureSymbolWidget",isVisible:!0,libraryId:"Mapping.Infrastructure"}),this.pictureSymbologyWidget.configuration=this.configuration.pictureSymbologyConfig;var r=new s.PictureSymbolWidgetViewModel(this.app,"Mapping.Infrastructure");return this.pictureSymbologyWidget.attach(r),this.pictureSymbologyWidget}return this.pictureSymbologyWidget=null,"<div/>"},i.prototype.applySettings=function(e){void 0===e&&(e=!0),e&&(this.viewModel.symbolSelector.applySettings(),this.viewModel.imageSelector&&this.viewModel.imageSelector.applySettings()),this.viewModel.symbols=this.viewModel.symbolSelector.viewModel.symbols;var t=this._getCurrentWidget();if(this.viewModel.imageSelector&&t&&"Image"===t.displayName){var i=this.viewModel.imageSelector.getSymbol();i&&(this.viewModel.symbols.marker=new esri.symbol.PictureMarkerSymbol(JSON.parse(i)))}},i.prototype.setFeatureType=function(e){this.viewModel._setFeatureType(e)},i.prototype.getSymbol=function(){return this.viewModel._getSymbol()},i.prototype.setFromSymbol=function(e){this.viewModel._setFromSymbol(e)},i.prototype.setFromRenderer=function(e){this.viewModel._setFromRenderer(e)},i.prototype.reset=function(){this.viewModel._reset()},i.prototype._getCurrentWidget=function(){var e=this.viewModel.currentWidget.get(),t=e?e.id:this.symbologyWidget.id;return this.viewModel.symbologyWidgets.getItems().filter(function(e){return e.id===t})[0]},i}(o.ViewBase);i.SymbologySettingsView=n})},"geocortex/infrastructure/symbology/SymbologySettingsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,o,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var l=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.noMarker=new s.Observable(!1),e.noFill=new s.Observable(!1),e.isPoint=new s.Observable(!1),e.isLine=new s.Observable(!1),e.isPolygon=new s.Observable(!1),e.showSymbologySelectorMenu=new s.Observable(!1),e.symbolizeWithImagery=new s.Observable(!1),e.symbologyWidgets=new s.ObservableCollection([]),e.currentWidget=new s.Observable(null),e}return e(i,t),i.prototype.initialize=function(e){var t=this;void 0===e&&(e={});var i=this.app.configModel.widgetConfigs.filter(function(e){return"SymbologySettings"===e.id})[0],o={};i?($.extend(o,i.configuration,e),this.config=o):this.config=e,(null==this.config.enableImageSelector||this.config.enableImageSelector)&&(this.imageSelector.viewModel.initialize(this.config.pictureSymbologyConfig||{}),this.symbologyWidgets.addItem(this.imageSelector),this.isPoint.bind(this,function(e){e?t.showSymbologySelectorMenu.set(!0):(t.showSymbologySelectorMenu.set(!1),t.currentWidget.set(t.symbolSelector))})),this.symbolSelector.viewModel.initialize(this.config.symbologyConfig),this.symbologyWidgets.addItem(this.symbolSelector),this.currentWidget.set(this.symbolSelector),this.isPoint.bind(this,function(e){t.symbolSelector.viewModel.isPoint.set(e)}),this.isLine.bind(this,function(e){t.symbolSelector.viewModel.isLine.set(e)}),this.isPolygon.bind(this,function(e){t.symbolSelector.viewModel.isPolygon.set(e)}),this.noFill.bind(this,function(e){t.isLine.set(e),t.isPoint.set(!t.noMarker.get()&&!e),t.isPolygon.set(!e)}),this.noMarker.bind(this,function(e){t.isPoint.set(!e),t.isLine.set(t.noFill.get()&&e),t.isPolygon.set(e)}),this.symbolizeWithImagery.syncTransform(this.currentWidget,function(e){return!(!e||!t.imageSelector||e.id!==t.imageSelector.id)&&(setTimeout(function(){t.imageSelector.activated()},100),!0)})},i.prototype._reset=function(){for(var e=0,t=this.symbologyWidgets.getItems();e<t.length;e++)t[e].reset();this.currentWidget.set(this.symbolSelector)},i.prototype._setFeatureType=function(e){(e=e.toLowerCase()).indexOf("point")>-1?(this.isPoint.set(!0),this.isLine.set(!1),this.isPolygon.set(!1)):e.indexOf("line")>-1?(this.isLine.set(!0),this.isPoint.set(!1),this.isPolygon.set(!1)):(this.isPolygon.set(!0),this.isPoint.set(!1),this.isLine.set(!1))},i.prototype._getRenderer=function(){var e=null;return e=new esri.renderer.SimpleRenderer(esri.symbol.fromJson(JSON.parse(this._getSymbol()))),JSON.stringify(e.toJson())},i.prototype._getSymbol=function(){if(this.currentWidget.get())return this.currentWidget.get().getSymbol()},i.prototype._setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&this._setFromSymbol(esri.symbol.fromJson(t.symbol))},i.prototype._setFromSymbol=function(e){e instanceof esri.symbol.PictureMarkerSymbol&&this.imageSelector&&this.currentWidget.set(this.imageSelector),this.currentWidget&&this.currentWidget.get().setFromSymbol(e)},i}(o.ViewModelBase);i.SymbologySettingsViewModel=l})},"geocortex/infrastructure/symbology/SymbolType":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){}}();i.POINT="point",i.MULTIPOINT="multipoint",i.POLYLINE="polyline",i.POLYGON="polygon",i.TEXT="text",t.SymbolType=i})},"geocortex/infrastructure/symbology/widgets/MarkupStyleWidget":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/widgets/PictureSymbolWidget":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./../SymbologySettingsView"],function(t,i,o,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var l=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.displayName=e.app.getResource(e.libraryId,"language-symbology-settings-image-displayname"),e.isMarkupView=!1,e}return e(i,t),i.prototype.attach=function(e){var i=this;e.initialize(this.configuration),t.prototype.attach.call(this,e),e.viewRoot=this.root,this.viewModel.currentImage.bind(this,function(e){i.viewModel.imageSize.unbind(i._imageSizeToken),i.viewModel.imageRotation.unbind(i._imageRotationToken),e&&e!==i.viewModel.currentImage.get()?(i.viewModel.imageSize.set(e.size),i.viewModel.imageRotation.set(e.angle||0)):(i.viewModel.imageSize.pulse(),i.viewModel.imageRotation.pulse()),i.applySettings(),i.bindSymbolSettings()}),this.app.event("MarkupSymbolChangedEvent").subscribe(this,function(e){i.viewModel.markupSymbol=e}),this.bindSymbolSettings()},i.prototype.bindSymbolSettings=function(){var e=this;this._imageSizeToken=this.viewModel.imageSize.bind(this,function(t){t&&e.applySettings()}),this._imageRotationToken=this.viewModel.imageRotation.bind(this,function(t){$.isNumeric(t)&&e.applySettings()})},i.prototype.added=function(e){e&&(e.pictureSymbologyWidget=this,t.prototype.added.call(this,e))},i.prototype.activated=function(){var e=this;if(!this.viewModel.loading){var t=function(){0===e.viewModel.currentImages.getLength()&&e.viewModel.currentLibrary.pulse(),setTimeout(function(){e.viewModel.currentImage.pulse()},100);var t=e.viewModel.currentImage.get();if(t){var i=$("#"+t.id,e.root)[0];i&&!e._isSwatchVisible(i)&&i.scrollIntoView()}},i=this.app.site;i&&i.isInitialized?t():this.app.event("SiteInitializedEvent").once(this,t)}},i.prototype.updateSymbol=function(e){return e instanceof esri.symbol.PictureMarkerSymbol?(this.setFromSymbol(e),Promise.resolve(!0)):(this.applySettings(),Promise.resolve(!1))},i.prototype.reset=function(){this.viewModel._reset()},i.prototype.getSymbol=function(){return this.viewModel.currentImage.get()?this.viewModel.currentImage.get().toJsonString():""},i.prototype.setFromSymbol=function(e){var t=this;e instanceof esri.symbol.PictureMarkerSymbol&&(this.viewModel._checkForSymbol(e)||this.viewModel.loadAllLibraries().then(function(){t.viewModel._setFromSymbol(e).then(function(){t.viewModel.imageSize.pulse()})}))},i.prototype.getRenderer=function(){return this.viewModel._getRenderer()},i.prototype.setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&"esriPMS"===t.symbol.type&&this.setFromSymbol(new esri.symbol.PictureMarkerSymbol(t.symbol))},i.prototype.applySettings=function(){var e=this.viewModel.currentImage.get();if(0!==this.viewModel.imageLibraries.getLength()&&e){var t=$("#"+e.id,this.root)[0];t&&!this._isSwatchVisible(t)&&t.scrollIntoView(),this.onChange&&this.isActive&&(!this.viewModel.parentSymbologyView||this.viewModel.parentSymbologyView.isActive)&&this.onChange(e.toJsonString()),this.viewModel.parentSymbologyView instanceof s.SymbologySettingsView&&this.viewModel.parentSymbologyView.applySettings(!1)}},i.prototype.handleClickSwatch=function(e){var t=e.target,i=this.viewModel.currentImages.getItems().filter(function(e){return(t.id||t.parentElement.id)===e.id})[0];if(i){for(var o=0,s=this.viewModel.currentImages.getItems();o<s.length;o++)s[o].selected.set(!1);i.selected.set(!0),this.viewModel.currentImage.set(i)}},i.prototype._isSwatchVisible=function(e){var t=e.getBoundingClientRect(),i=function(e,t){return document.elementFromPoint(e,t)};return e.contains(i(t.left,t.top))||e.contains(i(t.right,t.top))||e.contains(i(t.right,t.bottom))||e.contains(i(t.left,t.bottom))},i}(o.ViewBase);i.PictureSymbolWidget=l})},"geocortex/infrastructure/symbology/widgets/PictureSymbolWidgetConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/widgets/PictureSymbolWidgetViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./../../SymbolUtils","geocortex/framework-ui/LazyObservable","geocortex/essentials/utilities/UrlUtilities"],function(t,i,o,s,l,n,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){var o=t.call(this,e,i)||this;return o.initialized=!1,o.imageLibraries=new s.ObservableCollection(["Shapes"]),o.currentLibrary=new s.Observable(""),o.noLibraries=new s.Observable(!1),o.imageTemplates={},o.currentImages=new s.ObservableCollection([]),o.showLibrarySwitcher=new s.Observable(!1),o.loading=!1,o.imageSize=new s.Observable(32),o.imageSizeViewModel={range:{min:16,max:64,value:o.imageSize,step:1},showSlider:!0,updateOnDrag:!0},o.imageRotation=new s.Observable(0),o.imageRotationViewModel={range:{min:0,max:360,value:o.imageRotation,step:1},showSlider:!0,updateOnDrag:!0},o.imageHeight=new s.Observable(32),o.imageWidth=new s.Observable(32),o.imageSwatchIdBase="__IMAGESWATCH__",o.currentImage=new s.Observable(null),o}return e(i,t),i.prototype.initialize=function(e){var t=this;if(void 0===e&&(e={}),!this.initialized){var i=this.app.configModel.widgetConfigs.filter(function(e){return"PictureSymbolWidget"===e.id})[0],o={};i?($.extend(o,i.configuration,e),this.config=o):this.config=e,void 0!==this.config.imageLibraries&&$.isArray(this.config.imageLibraries)&&this.imageLibraries.set(this.config.imageLibraries),this.imageLibraries.getLength()>1&&this.showLibrarySwitcher.set(!0),this.currentLibrary.set(this.imageLibraries.getAt(0)),this.config.imageSize=this.config.imageSize||{min:16,max:64,value:32,step:1},this.imageSize.set(this.config.imageSize.value),this.imageSizeViewModel={range:{min:this.config.imageSize.min,max:this.config.imageSize.max,value:this.imageSize,step:this.config.imageSize.step},showSlider:null==this.config.showSliders||this.config.showSliders,updateOnDrag:!0},this.imageRotationViewModel.showSlider=null==this.config.showSliders||this.config.showSliders,this.imageHeight.sync(this.imageSize),this.imageWidth.syncTransform(this.imageSize,function(e){return e*(t.currentImage.get()?t.currentImage.get().widthRatio:1)}),this.currentLibrary.bind(this,function(e){var i=function(e){t.currentImage.set(null);for(var i=0;i<e.length;i++)if(e[i].selected.get()){t.currentImage.set(e[i]);break}t.currentImage.get()||(e[0].selected.set(!0),t.currentImage.set(e[0])),t.currentImages.set(e)},o=t.imageTemplates[e];o?i(o):t._loadImages(e).then(function(e){e&&e.length>0?i(e):t.imageLibraries.getLength()>0&&t.currentLibrary.set(t.imageLibraries.getAt(0))})}),this.initialized=!0}},i.prototype.loadAllLibraries=function(){var e=this;return new Promise(function(t,i){for(var o=[],s=0;s<e.imageLibraries.getLength();s++){var l=e.imageLibraries.getAt(s);e.imageTemplates[l]||o.push(e._loadImages(l))}o.length>0?Promise.all(o).then(function(){t()}):t()})},i.prototype._setFromSymbol=function(e){var t=this;return new Promise(function(i,o){t._checkForSymbol(e)?i():t._addNewTemplateFromSymbol(e).then(function(){return i()})})},i.prototype._checkForSymbol=function(e){for(var t,i=this,o=null,s=this._getHashForSymbol(e),l=[],n=0;n<this.imageLibraries.getLength()&&(t=this.imageLibraries.getAt(n),!(l=this.imageTemplates[t])||!(o=l.filter(function(e){return e.hash.get()===s})[0]));n++);if(o){this.currentLibrary.set(t),this.currentImage.set(o);for(var r=0,a=l;r<a.length;r++)a[r].selected.set(!1);o.selected.set(!0),this.imageSize.set(e.height),this.imageRotation.set(e.angle),setTimeout(function(){var e=$("#"+o.id,i.viewRoot)[0];e&&e.scrollIntoView()},200)}return o},i.prototype._addNewTemplateFromSymbol=function(e){var t=this;return new Promise(function(i,o){var r=new Image,a=t._getHashForSymbol(e);r.onload=function(){var o=t.imageSwatchIdBase+t.currentImages.getLength(),g=l.webMapAngleToJSAPIAngle(e.angle),d={type:"image",name:"",selected:new s.Observable(!0),url:e.url,size:r.height,widthRatio:r.width/r.height,xoffset:e.xoffset/e.width,yoffset:e.yoffset/e.height,angle:g,id:o,hash:new n.LazyObservable(a),toSymbol:function(){return t._imageTemplateToSymbol(d)},toJsonString:function(){return JSON.stringify(d.toSymbol().toJson())}};t.imageTemplates[t.currentLibrary.get()].push(d),t.currentImages.addItem(d),t.currentImage.set(d),t.imageSize.set(e.height);var c=$("#"+o,t.viewRoot)[0];c&&c.scrollIntoView(),i()},r.src=e.url})},i.prototype._loadImages=function(e){var t=this;this.loading=!0;var i=[];return new Promise(function(o,a){if(t.app.site.getEssentialsVersion()<4.07)return t._handleInvalidLibrary(e),t.loading=!1,t.app.trace.debug("Could not load symbol library '{0}'. Essentials 4.7 or newer is required.".format(e)),void o([]);var g=/^(.*?)(\/*)$/.exec(t.app.site.originalUrl)[1],d=r.UrlUtilities.simplify(g+"/../../symbols/image/{0}".format(e));l.getEssentialsSymbolLibrary(d).then(function(r){var a=r&&r.symbols;if(!$.isArray(a))throw new Error(t.getResource("language-symbology-errors-malformed-library").format(e));for(var g=0;g<a.length;g++)!function(o){var r=esri.symbol.fromJson(a[o]);if(r&&r instanceof esri.symbol.PictureMarkerSymbol){var g=l.webMapAngleToJSAPIAngle(r.angle);"Images"==e&&r.url&&(r.url=d+r.url);var c={type:"image",name:a[o].name||"",selected:new s.Observable(!o),url:r.url,size:r.height,widthRatio:r.width/r.height,xoffset:r.xoffset/r.width,yoffset:r.yoffset/r.height,angle:g,id:t.imageSwatchIdBase+o,hash:new n.LazyObservable(null,function(){return t._getHashForSymbol(c.toSymbol())},!0),toSymbol:function(){return t._imageTemplateToSymbol(c)},toJsonString:function(){return JSON.stringify(c.toSymbol().toJson())}};i.push(c)}}(g);0===i.length?t._handleInvalidLibrary(e):t.imageTemplates[e]=i,t.loading=!1,o(i)},function(i){t._handleInvalidLibrary(e),t.loading=!1,a(i)})})},i.prototype._handleInvalidLibrary=function(e){this.imageLibraries.removeItem(e),1===this.imageLibraries.getLength()&&this.showLibrarySwitcher.set(!1),0===this.imageLibraries.getLength()&&(this.showLibrarySwitcher.set(!1),this.currentImages.set([]),this.currentImage.set(null),this.noLibraries.set(!0))},i.prototype._getRenderer=function(){var e=null;return e=new esri.renderer.SimpleRenderer(this.currentImage.get().toSymbol()),JSON.stringify(e.toJson())},i.prototype._reset=function(){this.currentLibrary.set(this.imageLibraries.getAt(0));var e=this.imageTemplates[this.currentLibrary.get()];if(e&&e.length>0){for(var t=0,i=e;t<i.length;t++)i[t].selected.set(!1);e[0].selected.set(!0),this.currentImage.set(e[0])}},i.prototype._getHashForSymbol=function(e){var t="";return t=0===e.url.indexOf("data")?e.url.substring(e.url.indexOf(",")+1):e.url,l.stringToHash(t)},i.prototype._imageTemplateToSymbol=function(e){var t=new esri.symbol.PictureMarkerSymbol(e.url,this.imageWidth.get(),this.imageHeight.get());t.setAngle(this.imageRotation.get());var i=l.rotate(0,0,e.xoffset*t.width,e.yoffset*t.height,t.angle);return t.setOffset(i.x,i.y),t},i}(o.ViewModelBase);i.PictureSymbolWidgetViewModel=a})},"geocortex/infrastructure/symbology/widgets/SimpleSymbolWidget":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./../SymbologySettingsView"],function(t,i,o,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var l=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.displayName=e.app.getResource(e.libraryId,"language-symbology-settings-symbol-displayname"),e}return e(i,t),i.prototype.attach=function(e){var i=this;e.initialized||e.initialize(this.configuration),t.prototype.attach.call(this,e),this.viewModel.fill.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.outline.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.lineWidth.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.markerSize.bind(this,function(){i.viewModel.configuring||i.applySettings()})},i.prototype.added=function(e){e&&(e.symbologyWidget=this,t.prototype.added.call(this,e))},i.prototype.activated=function(){var e=this;setTimeout(function(){e.viewModel.configuring=!0,e.viewModel.fill.color.pulse(),e.viewModel.outline.color.pulse(),e.viewModel.lineWidth.pulse(),e.viewModel.markerSize.pulse(),e.viewModel.configuring=!1},0)},i.prototype.reset=function(){this.viewModel._reset()},i.prototype.getSymbol=function(){return(!this.viewModel.symbols||this.viewModel.symbols.marker instanceof esri.symbol.PictureMarkerSymbol)&&this.applySettings(),this.viewModel._getSymbol()},i.prototype.setFromSymbol=function(e,t){void 0===t&&(t=!0),this.viewModel._setFromSymbol(e),t&&this.applySettings()},i.prototype.getRenderer=function(){return this.viewModel._getRenderer()},i.prototype.setFromRenderer=function(e){this.viewModel._setFromRenderer(e)},i.prototype.setFeatureType=function(e){this.viewModel._setFeatureType(e)},i.prototype.handleMarkerStyle=function(){this.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex,this.applySettings()},i.prototype.handleLineStyle=function(){this.viewModel.lineStyleIndex=this.lineStyleInput.selectedIndex,this.applySettings()},i.prototype.handleFillStyle=function(){this.viewModel.fillStyleIndex=this.fillStyleInput.selectedIndex,this.applySettings()},i.prototype.applySettings=function(){if(this.viewModel.initialized&&!this.viewModel.configuring){this.viewModel.configuring=!0,this.viewModel.markerStyleIndex<0&&(this.viewModel.markerStyleIndex=0),this.viewModel.lineStyleIndex<0&&(this.viewModel.lineStyleIndex=0),this.viewModel.fillStyleIndex<0&&(this.viewModel.fillStyleIndex=0),this.markerStyleInput&&(this.markerStyleInput.selectedIndex=this.viewModel.markerStyleIndex||0),this.lineStyleInput&&(this.lineStyleInput.selectedIndex=this.viewModel.lineStyleIndex||0),this.fillStyleInput&&(this.fillStyleInput.selectedIndex=this.viewModel.fillStyleIndex||0);var e=this.viewModel.fill.color.get(),t=this.viewModel.outline.color.get(),i=this.viewModel.markerStyles.getAt(this.viewModel.markerStyleIndex||0).style,o=i===esri.symbol.SimpleMarkerSymbol.STYLE_CROSS||i===esri.symbol.SimpleMarkerSymbol.STYLE_X;o&&this.viewModel.isPoint.get()&&!this.viewModel.isLine.get()&&!this.viewModel.isPolygon.get()?this.viewModel.noOutlineSymbol.set(!0):this.viewModel.noOutlineSymbol.set(!1);var l=this.viewModel.lineStyles.getAt(this.viewModel.lineStyleIndex||0).style,n=this.viewModel.fillStyles.getAt(this.viewModel.fillStyleIndex||0).style,r=this.viewModel.markerSize.get(),a=this.viewModel.lineWidth.get(),g=new esri.symbol.SimpleLineSymbol;o?g.setColor(e.toEsriColor()):g.setColor(this._getOutlineColor(e,t)),g.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID),g.setWidth(o?a||1:a);var d=new esri.symbol.SimpleMarkerSymbol;d.setColor(e.toEsriColor()),d.setStyle(i),d.setSize(r),d.setOutline(g);var c=new esri.symbol.SimpleLineSymbol;c.setColor(e.toEsriColor()),c.setStyle(l),c.setWidth(a||1);var u=new esri.symbol.SimpleLineSymbol;u.setColor(this._getOutlineColor(e,t)),u.setStyle(l),u.setWidth(a);var y=new esri.symbol.SimpleFillSymbol;y.setColor(e.toEsriColor()),y.setStyle(n),y.setOutline(u),this.viewModel.symbols={marker:d,line:c,fill:y},this.onChange&&this.isActive&&(!this.viewModel.parentSymbologyView||this.viewModel.parentSymbologyView.isActive)&&(this.viewModel.isLine.get()?this.onChange(JSON.stringify(c.toJson())):this.viewModel.isPolygon.get()?this.onChange(JSON.stringify(y.toJson())):this.viewModel.isPoint.get()&&this.onChange(JSON.stringify(d.toJson()))),this.viewModel.parentSymbologyView instanceof s.SymbologySettingsView&&this.viewModel.parentSymbologyView.applySettings(!1),this.viewModel.configuring=!1}},i.prototype._getOutlineColor=function(e,t){return this.viewModel.showOutlineColor.get()?t.toEsriColor():this.viewModel.config.adaptOutlineToFill?e.value>=.7?e.darken(.5).toEsriColor(!1):e.lighten(.9).toEsriColor(!1):e.darken(.5).toEsriColor(!1)},i}(o.ViewBase);i.SimpleSymbolWidget=l})},"geocortex/infrastructure/symbology/widgets/SimpleSymbolWidgetConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/widgets/SimpleSymbolWidgetViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./../SymbolColor","./../../ColorUtils","./../../SymbolUtils"],function(t,i,o,s,l,n,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.configuring=!1,e.isPoint=new s.Observable(!1),e.isLine=new s.Observable(!1),e.isPolygon=new s.Observable(!1),e.showLineStyles=new s.Observable(!1),e.showOutlineColor=new s.Observable(!1),e.noOutlineSymbol=new s.Observable(!1),e.markerSize=new s.Observable(10),e.markerSizeViewModel={range:{min:1,max:25,value:e.markerSize,step:1},showSlider:!0,updateOnDrag:!0},e.lineWidth=new s.Observable(2),e.lineWidthViewModel={range:{min:0,max:5,value:e.lineWidth,step:1},showSlider:!0,updateOnDrag:!0},e.fill={color:new s.Observable},e.outline={color:new s.Observable},e.initialized=!1,e.markerStyleIdLookup={circle:"esriSMSCircle",cross:"esriSMSCross",diamond:"esriSMSDiamond",square:"esriSMSSquare",x:"esriSMSX"},e.lineStyleIdLookup={solid:"esriSLSSolid",dash:"esriSLSDash",dashdot:"esriSLSDashDot",longdashdotdot:"esriSLSDashDotDot",dot:"esriSLSDot",longdash:"esriSLSLongDash",longdashdot:"esriSLSLongDashDot",shortdash:"esriSLSShortDash",shortdashdot:"esriSLSShortDashDot",shortdashdotdot:"esriSLSShortDashDotDot",shortdot:"esriSLSShortDot"},e.fillStyleIdLookup={solid:"esriSFSSolid",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical",cross:"esriSFSCross",diagonalcross:"esriSFSDiagonalCross",forwarddiagonal:"esriSFSForwardDiagonal",backwarddiagonal:"esriSFSBackwardDiagonal",null:"esriSFSNull"},e.markerStyles=new s.ObservableCollection([{style:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,label:e.getResource("language-symbology-settings-marker-style-circle")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_CROSS,label:e.getResource("language-symbology-settings-marker-style-cross")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,label:e.getResource("language-symbology-settings-marker-style-diamond")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,label:e.getResource("language-symbology-settings-marker-style-square")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_X,label:e.getResource("language-symbology-settings-marker-style-x")}]),e.lineStyles=new s.ObservableCollection([{style:esri.symbol.SimpleLineSymbol.STYLE_SOLID,label:e.getResource("language-symbology-settings-line-style-solid"),styleId:"esriSLSSolid"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASH,label:e.getResource("language-symbology-settings-line-style-dash"),styleId:"esriSLSDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,label:e.getResource("language-symbology-settings-line-style-dashdot"),styleId:"esriSLSDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT,label:e.getResource("language-symbology-settings-line-style-dashdotdot"),styleId:"esriSLSDashDotDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_DOT,label:e.getResource("language-symbology-settings-line-style-dot"),styleId:"esriSLSDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_LONGDASH,label:e.getResource("language-symbology-settings-line-style-longdash"),styleId:"esriSLSLongDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_LONGDASHDOT,label:e.getResource("language-symbology-settings-line-style-longdashdot"),styleId:"esriSLSLongDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASH,label:e.getResource("language-symbology-settings-line-style-shortdash"),styleId:"esriSLSShortDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASHDOT,label:e.getResource("language-symbology-settings-line-style-shortdashdot"),styleId:"esriSLSShortDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASHDOTDOT,label:e.getResource("language-symbology-settings-line-style-shortdashdotdot"),styleId:"esriSLSShortDashDotDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,label:e.getResource("language-symbology-settings-line-style-shortdot"),styleId:"esriSLSShortDot"}]),e.fillStyles=new s.ObservableCollection([{style:esri.symbol.SimpleFillSymbol.STYLE_SOLID,label:e.getResource("language-symbology-settings-fill-style-solid"),styleId:"esriSFSSolid"},{style:esri.symbol.SimpleFillSymbol.STYLE_HORIZONTAL,label:e.getResource("language-symbology-settings-fill-style-horizontal"),styleId:"esriSFSHorizontal"},{style:esri.symbol.SimpleFillSymbol.STYLE_VERTICAL,label:e.getResource("language-symbology-settings-fill-style-vertical"),styleId:"esriSFSVertical"},{style:esri.symbol.SimpleFillSymbol.STYLE_CROSS,label:e.getResource("language-symbology-settings-fill-style-cross"),styleId:"esriSFSCross"},{style:esri.symbol.SimpleFillSymbol.STYLE_DIAGONAL_CROSS,label:e.getResource("language-symbology-settings-fill-style-diagonal-cross"),styleId:"esriSFSDiagonalCross"},{style:esri.symbol.SimpleFillSymbol.STYLE_FORWARD_DIAGONAL,label:e.getResource("language-symbology-settings-fill-style-forward-diagonal"),styleId:"esriSFSForwardDiagonal"},{style:esri.symbol.SimpleFillSymbol.STYLE_BACKWARD_DIAGONAL,label:e.getResource("language-symbology-settings-fill-style-backward-diagonal"),styleId:"esriSFSBackwardDiagonal"}]),e}return e(i,t),i.prototype.initialize=function(e){var t=this;void 0===e&&(e={}),this.initialized&&(this.initialized=!1);var i=this.app.configModel.widgetConfigs.filter(function(e){return"SimpleSymbolWidget"===e.id})[0],o={};i?($.extend(o,i.configuration,e),this.config=o):this.config=e,null==this.config.showSliders&&(this.config.showSliders=!0),null==this.config.adaptOutlineToFill&&(this.config.adaptOutlineToFill=!0),this.isLine.bind(this,function(e){t.showLineStyles.set(e||t.isPolygon.get()),t.config.userSelectedOutlineColor&&t.showOutlineColor.set(e||t.isPolygon.get())}),this.isPolygon.bind(this,function(e){t.showLineStyles.set(e||t.isLine.get()),t.config.userSelectedOutlineColor&&t.showOutlineColor.set(e||t.isPoint.get())}),this.isPoint.bind(this,function(e){t.showLineStyles.set(!e||t.isLine.get()||t.isPolygon.get()),t.config.userSelectedOutlineColor&&t.showOutlineColor.set(!e||t.isPolygon.get()||t.isPoint.get())}),this.config.markerSize=this.config.markerSize||{min:1,max:25,value:10,step:1},this.markerSize.set(this.config.markerSize.value),this.markerSizeViewModel={range:{min:this.config.markerSize.min,max:this.config.markerSize.max,value:this.markerSize,step:this.config.markerSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.lineWidth=this.config.lineWidth||{min:0,max:5,value:2,step:1},this.lineWidth.set(this.config.lineWidth.value),this.lineWidthViewModel={range:{min:this.config.lineWidth.min,max:this.config.lineWidth.max,value:this.lineWidth,step:this.config.lineWidth.step},showSlider:this.config.showSliders,updateOnDrag:!0},void 0!==this.config.markerStyles&&(this.markerStyles.set(this.config.markerStyles),this.markerStyleIndex=0),void 0!==this.config.lineStyles&&(this.lineStyles.set(this.config.lineStyles),this.lineStyleIndex=0),void 0!==this.config.fillStyles&&(this.fillStyles.set(this.config.fillStyles),this.fillStyleIndex=0),void 0!==this.config.userSelectedOutlineColor&&this.showOutlineColor.set(this.config.userSelectedOutlineColor),this.fill.color.set(n.generateRandomColor()),this.outline.color.set(this.fill.color.get().value>=.7?this.fill.color.get().darken(.6):this.fill.color.get().lighten(.8)),this.initialized=!0},i.prototype._reset=function(){this.configuring=!0,this.markerSize.set(this.config.markerSize.value),this.lineWidth.set(this.config.lineWidth.value),this.markerStyleIndex=0,this.lineStyleIndex=0,this.fillStyleIndex=0,this.fill.color.set(n.generateRandomColor()),this.outline.color.set(this.fill.color.get().value>=.7?this.fill.color.get().darken(.6):this.fill.color.get().lighten(.8)),this.configuring=!1},i.prototype._setFeatureType=function(e){(e=e.toLowerCase()).indexOf("point")>-1?(this.isPoint.set(!0),this.isLine.set(!1),this.isPolygon.set(!1)):e.indexOf("line")>-1?(this.isLine.set(!0),this.isPoint.set(!1),this.isPolygon.set(!1)):(this.isPolygon.set(!0),this.isPoint.set(!1),this.isLine.set(!1))},i.prototype._getRenderer=function(){var e=null;return e=this.isPoint.get()?new esri.renderer.SimpleRenderer(this.symbols.marker):this.isLine.get()?new esri.renderer.SimpleRenderer(this.symbols.line):new esri.renderer.SimpleRenderer(this.symbols.fill),JSON.stringify(e.toJson())},i.prototype._getSymbol=function(){var e=null;return e=this.isPoint.get()?this.symbols.marker:this.isLine.get()?this.symbols.line:this.symbols.fill,JSON.stringify(e.toJson())},i.prototype._setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&"esriPMS"!==t.symbol.type&&this._setFromSymbolObject(t.symbol)},i.prototype._setFromSymbol=function(e){!e||e instanceof esri.symbol.PictureMarkerSymbol||this._setFromSymbolObject(e.toJson())},i.prototype._setFromSymbolObject=function(e){var t=this;this.configuring=!0,e.color&&this.fill.color.set(new l.SymbolColor({r:e.color[0]/255,g:e.color[1]/255,b:e.color[2]/255,a:e.color[3]/255}));var i;for(var o in this.markerStyleIdLookup)if(this.markerStyleIdLookup.hasOwnProperty(o)&&e.style===this.markerStyleIdLookup[o]){i=o;break}e.outline&&(this.outline.color.set(new l.SymbolColor({r:e.outline.color[0]/255,g:e.outline.color[1]/255,b:e.outline.color[2]/255,a:e.outline.color[3]/255})),i!==esri.symbol.SimpleMarkerSymbol.STYLE_CROSS&&i!==esri.symbol.SimpleMarkerSymbol.STYLE_X||this.fill.color.set(this.outline.color.get()));var s=this.markerStyles.getItems().filter(function(e){return e.style===i})[0];this.markerSize.set($.isNumeric(e.size)?Math.floor(e.size*r.POINTS_TO_PIXELS):this.config.markerSize.value),this.markerStyleIndex=s?this.markerStyles.indexOf(s):0;var n=this.isLine.get()?e:e.outline;n?(this.lineWidth.set($.isNumeric(n.width)?Math.floor(n.width*r.POINTS_TO_PIXELS):this.config.lineWidth.value),this.lineStyleIndex=n.style?this.lineStyles.indexOf(this.lineStyles.getItems().filter(function(e){return t.lineStyleIdLookup[e.style]===n.style})[0]):0):(this.lineWidth.set(0),this.lineStyleIndex=0);var a=this.fillStyles.getItems().filter(function(i){return t.fillStyleIdLookup[i.style]===e.style})[0];this.fillStyleIndex=a?this.fillStyles.indexOf(a):0,this.configuring=!1},i}(o.ViewModelBase);i.SimpleSymbolWidgetViewModel=a})},"geocortex/infrastructure/symbology/widgets/SymbologyWidget":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/widgets/TextSymbolWidget":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.displayName=e.app.getResource(e.libraryId,"language-symbology-settings-text-displayname"),e.editingMarkup=!1,e}return e(i,t),i.prototype.attach=function(e){var i=this;e.initialized||e.initialize(this.configuration),t.prototype.attach.call(this,e),this.viewModel.fontColor.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontHalo.color.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.haloSize.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontSize.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.textAngle.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.symbolText.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontFamily.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontIsBold.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontIsItalic.bind(this,function(){i.viewModel.configuring||i.applySettings()}),this.viewModel.fontIsUnderline.bind(this,function(){i.viewModel.configuring||i.applySettings()})},i.prototype.added=function(e){e&&(e.textSymbologySettingsWidget=this,t.prototype.added.call(this,e))},i.prototype.activated=function(){var e=this;setTimeout(function(){e.viewModel.configuring=!0,e.viewModel.fontColor.color.pulse(),e.viewModel.fontHalo.color.pulse(),e.viewModel.haloSize.pulse(),e.viewModel.fontSize.pulse(),e.viewModel.textAngle.pulse(),e.viewModel.configuring=!1},0)},i.prototype.reset=function(){this.viewModel.reset()},i.prototype.getSymbol=function(e){return void 0===e&&(e=!0),this.viewModel.symbol||this.applySettings(e),this.viewModel._getSymbol()},i.prototype.setFromSymbol=function(e,t){void 0===t&&(t=!0),e instanceof esri.symbol.TextSymbol&&(this.viewModel._setFromSymbol(e),!this.editingMarkup&&t&&this.applySettings())},i.prototype.applySettings=function(e){if(void 0===e&&(e=!0),this.viewModel.initialized){this.viewModel.configuring=!0;var t=this.viewModel.fontColor.color.get().toEsriColor(),i=this.viewModel.fontHalo.color.get().toEsriColor(),o=this.viewModel.fontSize.get(),s=this.viewModel.haloSize.get(),l=this.viewModel.fontIsBold.get(),n=this.viewModel.fontIsItalic.get(),r=this.viewModel.fontIsUnderline.get(),a=new esri.symbol.TextSymbol(this.viewModel.symbolText.get());a.setFont(new esri.symbol.Font(o+"pt",n?esri.symbol.Font.STYLE_ITALIC:esri.symbol.Font.STYLE_NORMAL,esri.symbol.Font.VARIANT_NORMAL,l?esri.symbol.Font.WEIGHT_BOLD:esri.symbol.Font.WEIGHT_NORMAL,this.viewModel.fontFamily.get())),a.setColor(t),a.setHaloColor(i),a.setHaloSize(s),a.setDecoration(r?"underline":"none"),a.setAngle(this.viewModel.textAngle.get()),a.setAlign(esri.symbol.TextSymbol.ALIGN_START),this.viewModel.symbol=a,e&&this.onChange&&this.isActive&&(!this.parentView||this.parentView.isActive)&&this.onChange(JSON.stringify(a.toJson())),this.viewModel.configuring=!1}},i}(o.ViewBase);i.TextSymbolWidget=s})},"geocortex/infrastructure/symbology/widgets/TextSymbolWidgetConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/symbology/widgets/TextSymbolWidgetViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./../SymbolColor","./../../SymbolUtils","./../../ColorUtils","./../../SymbolUtils","./../../BrowserUtils"],function(t,i,o,s,l,n,r,a,g){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var d=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.fontFamily=new s.Observable("sans-serif"),e.symbolText=new s.Observable(""),e.fontColor={color:new s.Observable},e.fontHalo={color:new s.Observable},e.fontFamilies=new s.ObservableCollection(["serif","sans-serif"]),e.fontIsBold=new s.Observable(!1),e.fontIsItalic=new s.Observable(!1),e.fontIsUnderline=new s.Observable(!1),e.isIE9or11=!1,e.showHaloSize=new s.Observable(!0),e.showHaloColor=new s.Observable(!0),e.showFontStyle=new s.Observable(!0),e.showFontSize=new s.Observable(!0),e.showFontColor=new s.Observable(!0),e.showFontFamilies=new s.Observable(!0),e.showTextAngle=new s.Observable(!0),e.showText=new s.Observable(!0),e.initialized=!1,e.configuring=!1,e}return e(i,t),i.prototype.initialize=function(e){void 0===e&&(e={});var t=g.isIE();this.isIE9or11=9===t||11===t,this.showHaloSize.set(!this.isIE9or11),this.showHaloColor.set(!this.isIE9or11);var i=this.app.configModel.widgetConfigs.filter(function(e){return"TextSymbolWidget"===e.id})[0];if(i){var o={};$.extend(o,i.configuration,e),this.config=o}else this.config=e;null==this.config.showSliders&&(this.config.showSliders=!0),this.config.fontSize=this.config.fontSize||{min:10,max:64,value:18,step:1},this.fontSize=new s.Observable(this.config.fontSize.value),this.fontSizeViewModel={range:{min:this.config.fontSize.min,max:this.config.fontSize.max,value:this.fontSize,step:this.config.fontSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.config.haloSize=this.config.haloSize||{min:0,max:5,value:2,step:1},this.haloSize=new s.Observable(this.config.haloSize.value),this.haloSizeViewModel={range:{min:this.config.haloSize.min,max:this.config.haloSize.max,value:this.haloSize,step:this.config.haloSize.step},showSlider:this.config.showSliders,updateOnDrag:!0},this.textAngle=new s.Observable(0),this.textAngleViewModel={range:{min:0,max:360,value:this.textAngle,step:1},showSlider:this.config.showSliders,updateOnDrag:!0},void 0!==this.config.fontFamilies&&(this.fontFamilies.set(this.config.fontFamilies),this.fontFamily.set(this.fontFamilies.getAt(0))),void 0!==this.config.haloSizeIsVisible&&this.showHaloSize.set(this.config.haloSizeIsVisible&&!this.isIE9or11),void 0!==this.config.haloColorIsVisible&&this.showHaloColor.set(this.config.haloColorIsVisible&&!this.isIE9or11),void 0!==this.config.fontSizeIsVisible&&this.showFontSize.set(this.config.fontSizeIsVisible),void 0!==this.config.fontStyleIsVisible&&this.showFontStyle.set(this.config.fontStyleIsVisible),void 0!==this.config.fontColorIsVisible&&this.showFontColor.set(this.config.fontColorIsVisible),void 0!==this.config.fontFamiliesIsVisible&&this.showFontFamilies.set(this.config.fontFamiliesIsVisible),void 0!==this.config.textAngleIsVisible&&this.showTextAngle.set(this.config.textAngleIsVisible),void 0!==this.config.textIsVisible&&this.showText.set(this.config.textIsVisible),this._setFromSymbol(a.defaultTextSymbol(this.isIE9or11)),this.initialized=!0},i.prototype.reset=function(){this.symbolText.set(""),this.fontSize.set(this.config.fontSize.value),this.haloSize.set(this.config.haloSize.value),this.textAngle.set(0),this.fontFamily.set(this.fontFamilies.getAt(0)),this.fontColor.color.set(r.generateRandomColor()),this.fontHalo.color.set(this.fontColor.color.get().value>=.7?this.fontColor.color.get().darken(.6):this.fontColor.color.get().lighten(.8))},i.prototype._getSymbol=function(){return this.symbol?JSON.stringify(this.symbol.toJson()):""},i.prototype._setFromSymbol=function(e){e instanceof esri.symbol.TextSymbol&&this._setFromSymbolObject(e.toJson())},i.prototype._setFromSymbolObject=function(e){this.configuring=!0,e.text&&this.symbolText.set(e.text),e.angle?this.textAngle.set(Math.ceil(n.webMapAngleToJSAPIAngle(e.angle)/this.textAngleViewModel.range.step)*this.textAngleViewModel.range.step):this.textAngle.set(0),this.fontColor.color.set(new l.SymbolColor({r:e.color[0]/255,g:e.color[1]/255,b:e.color[2]/255,a:e.color[3]/255})),e.haloColor?this.fontHalo.color.set(new l.SymbolColor({r:e.haloColor[0]/255,g:e.haloColor[1]/255,b:e.haloColor[2]/255,a:e.haloColor[3]/255})):this.fontHalo.color.set(new l.SymbolColor("#FFFFFF")),e.haloSize?this.haloSize.set(e.haloSize*n.POINTS_TO_PIXELS):this.haloSize.set(0);var t=e.font.family.split(",")[0];this.fontFamilies.contains(t)||this.fontFamilies.addItem(t),this.fontFamily.set(t),this.fontSize.set(Math.ceil(e.font.size/this.fontSizeViewModel.range.step)*this.fontSizeViewModel.range.step||16),this.fontIsBold.set("bold"===e.font.weight),this.fontIsItalic.set("italic"===e.font.style),this.fontIsUnderline.set("underline"===e.font.decoration),this.configuring=!1},i}(o.ViewModelBase);i.TextSymbolWidgetViewModel=d})},"url:/Mapping/infrastructure/symbology/AttributeSymbologySettingsView.html":e,"url:/Mapping/infrastructure/symbology/SymbolEditorView.html":t,"url:/Mapping/infrastructure/symbology/SymbologySettingsView.html":i,"url:/Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html":o,"url:/Mapping/infrastructure/symbology/widgets/SimpleSymbolWidget.html":s,"url:/Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html":l}}),require(["geocortex/framework/resourceManager"],function(n){n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/common.css","css","LyoqIEltYWdlIHN5bWJvbG9neSB3aWRnZXQgKi8NCg0KLk1hcmt1cEltYWdlU2VsZWN0b3JWaWV3IHsNCiAgICBoZWlnaHQ6IDEwMCUNCn0NCg0KLm5vLXN5bWJvbC1saWJyYXJ5IHsNCiAgICBtYXJnaW4tdG9wOiAxZW07DQp9DQoNCi5zdHlsZS1zZWxlY3RvciB7DQogICAgbWF4LXdpZHRoOiA1NDBweDsNCiAgICBoZWlnaHQ6IDkwJTsNCn0NCg0KLnN3YXRjaC1jb250YWluZXIgew0KICAgIG92ZXJmbG93LXk6IHNjcm9sbDsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICBtYXJnaW4tdG9wOiAwLjVlbTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjREREREREOw0KICAgIG1pbi1oZWlnaHQ6IDE1ZW07DQp9DQoNCi50ZW1wbGF0ZS1jb250YWluZXIgew0KICAgIGhlaWdodDogY2FsYygxMDAlIC0gNWVtKTsNCn0NCg0KLnRleHQgLnRlbXBsYXRlLWNvbnRhaW5lciB7DQogICAgaGVpZ2h0OiBjYWxjKDEwMCUgLSA4ZW0pOw0KfQ0KDQouaW1hZ2UtY29udGFpbmVyIHsNCiAgICBoZWlnaHQ6IDMyZW07DQp9DQoNCi5zeW1ib2xvZ3ktY2xhc3NlcyAuaW1hZ2UtY29udGFpbmVyIHsNCiAgICBoZWlnaHQ6IDhlbTsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KfQ0KDQpkaXYuc3R5bGUtc2VsZWN0b3IubWFya3VwLmltYWdlIC5zeW1ib2xvZ3ktc2xpZGVycyB7DQogICAgbWFyZ2luOiAtMWVtIDAgMCAwOw0KfQ0KDQouc3R5bGUtc2VsZWN0b3IgLm1hcmt1cC1zd2F0Y2gubWFya3VwLXN3YXRjaC1pbWFnZSB7DQogICAgbWFyZ2luOiAwLjVlbTsNCiAgICBwYWRkaW5nOiAwOw0KICAgIHdpZHRoOiAzZW07DQogICAgaGVpZ2h0OiAzZW07DQp9DQoNCi5zdHlsZS1zZWxlY3RvciAubWFya3VwLXN3YXRjaDpob3ZlciB7DQogICAgLXdlYmtpdC1ib3gtc2hhZG93OiAwcHggMHB4IDBweCA0cHggI0M4RTlGRjsNCiAgICAtbW96LWJveC1zaGFkb3c6IDBweCAwcHggMHB4IDRweCAjQzhFOUZGOw0KICAgIGJveC1zaGFkb3c6IDBweCAwcHggMHB4IDRweCAjQzhFOUZGOw0KIH0NCg0KLnN0eWxlLXNlbGVjdG9yIC5tYXJrdXAtc3dhdGNoLnNlbGVjdGVkIHsNCiAgICAtd2Via2l0LWJveC1zaGFkb3c6IDBweCAwcHggMHB4IDRweCAjNzdjOWZmOw0KICAgIC1tb3otYm94LXNoYWRvdzogMHB4IDBweCAwcHggNHB4ICM3N2M5ZmY7DQogICAgYm94LXNoYWRvdzogMHB4IDBweCAwcHggNHB4ICM3N2M5ZmY7DQogICAgYmFja2dyb3VuZDogI0U5RjZGRjsNCiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsNCiB9DQoNCmltZy5tYXJrdXAtc3dhdGNoLWltYWdlIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBtYXJnaW46IGF1dG87DQogICAgbWF4LXdpZHRoOiAzZW07DQogICAgbWF4LWhlaWdodDogM2VtOw0KfQ0KDQouaW1hZ2UtbGlicmFyeS1zZWxlY3RvciB7DQogIG1hcmdpbi10b3A6IDEwcHg7DQogIHdoaXRlLXNwYWNlOiBub3dyYXA7DQp9DQoNCi5pbWFnZS1saWJyYXJ5LXNlbGVjdG9yIC5zeW1ib2xvZ3ktbGFiZWwgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCn0NCg0KLmltYWdlLWxpYnJhcnktc2VsZWN0b3Igc2VsZWN0IHsNCiAgICBtYXJnaW4tbGVmdDogMWVtOw0KICAgIG1heC13aWR0aDogMjBlbTsNCn0NCg0KLnN5bWJvbC1idXR0b24tbGFiZWwgew0KICAgIGZvbnQtc2l6ZTogMDsNCiAgICBoZWlnaHQ6IDFweDsNCiAgICBmbG9hdDogbGVmdDsNCn0NCg0KLnN5bWJvbC1uYW1lIHsNCiAgZGlzcGxheTogYmxvY2s7DQogIG1hcmdpbjogMTBweCBhdXRvIDA7DQogIGZvbnQtc2l6ZTogMTJweDsNCiAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogIGNvbG9yOiAjMzMzOw0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGxldHRlci1zcGFjaW5nOiAwLjA1ZW07DQogIG1pbi1oZWlnaHQ6IDEuMjVlbTsNCn0NCg0KLyogS2VuZG8gU2xpZGVyICovDQoNCi5zeW1ib2xvZ3ktbnVtYmVyaW5wdXQgLmstc2xpZGVyIHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBtYXJnaW4tcmlnaHQ6IDAuNWVtOw0KfQ0KDQouay1zbGlkZXItaG9yaXpvbnRhbCAuay1zbGlkZXItdHJhY2sgew0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDVkNWQ1Ow0KfQ0KDQouay1zdGF0ZS1zZWxlY3RlZCwgLmstc2xpZGVyLXNlbGVjdGlvbiwgLmstc3RhdGUtc2VsZWN0ZWQ6bGluaywgLmstZHJhZ2hhbmRsZS5rLXN0YXRlLXNlbGVjdGVkOmhvdmVyIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogIzFBNzJDNDsNCiAgYm9yZGVyLWNvbG9yOiAjMUE3MkM0Ow0KfQ0KDQouay1zdGF0ZS1mb2N1c2VkLmstc3RhdGUtc2VsZWN0ZWQgew0KICBib3gtc2hhZG93OiBpbnNldCAwIDAgM3B4IDFweCAjMTg2MmE3Ow0KfQ0KDQouay1kcmFnaGFuZGxlIHsNCiAgYm9yZGVyLWNvbG9yOiAjMUE3MkM0Ow0KfQ0KDQouZ2N4LXNsaWRlci1pbnB1dCB7DQogIGRpc3BsYXk6IGJsb2NrOw0KICBmbG9hdDogbGVmdDsNCiAgd2lkdGg6IDIwJTsNCiAgcGFkZGluZy1sZWZ0OiAxZW07DQogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5nY3gtc2xpZGVyLXdpZHRoIHsNCiAgICBmbG9hdDogbGVmdDsNCiAgICB3aWR0aDogMThlbTsNCiAgICBtYXJnaW4tcmlnaHQ6IDAuNWVtOw0KfQ0KDQpkaXYuc3ltYm9sb2d5LWNsYXNzZXMgLmdjeC1zbGlkZXItd2lkdGggew0KICAgIHdpZHRoOiA4ZW07DQp9DQoNCi5hdHRyaWJ1dGUtc3ltYm9sb2d5LXNldHRpbmdzIC5nY3gtc2xpZGVyLXdpZHRoIHsNCiAgICB3aWR0aDogMTBlbTsNCn0NCg0KLnN5bWJvbG9neS1jbGFzc2VzIC5zeW1ib2xvZ3ktc2V0dGluZ3Mgew0KICAgIGJhY2tncm91bmQtY29sb3I6ICNFRUVFRUU7DQogICAgYm9yZGVyLXJhZGl1czogMC41ZW07DQogICAgcGFkZGluZy10b3A6IDBlbTsNCiAgICBwYWRkaW5nLWJvdHRvbTogMC4xZW07DQp9DQoNCi8qIEtlbmRvIENvbG9yIFBpY2tlciAqLw0KDQouay1mbGF0Y29sb3JwaWNrZXIgLmstc2VsZWN0ZWQtY29sb3Igew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy90cmFuc3RleHR1cmUucG5nIik7DQp9DQoNCi5rLWZsYXRjb2xvcnBpY2tlciAuay10cmFuc3BhcmVuY3ktc2xpZGVyIC5rLXNsaWRlci10cmFjayB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL3RyYW5zcGFyZW5jeS5wbmciKTsNCn0NCg0KLmstaWNvbiB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL3Nwcml0ZS5wbmciKTsNCn0NCg0KLyotLS0gU3ltYm9sb2d5IFNldHRpbmdzIFdpZGdldCAtLS0qLw0KDQouc3ltYm9sb2d5LWxhYmVsIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBtYXJnaW4tdG9wOiAxMHB4Ow0KICAgIG1hcmdpbi1ib3R0b206IDVweDsNCn0NCg0KLnN5bWJvbG9neS1udW1iZXJpbnB1dCB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWFyZ2luLWxlZnQ6IDVweDsNCn0NCg0KLm51bWVyaWMtaW5wdXQtd3JhcHBlciB7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi5zeW1ib2xvZ3ktbnVtYmVyaW5wdXQgaW5wdXRbdHlwZT1udW1iZXJdIHsNCiAgICB3aWR0aDogMy41ZW07DQogICAgcGFkZGluZzogMC4yZW07DQogICAgYm9yZGVyOiAxcHggc29saWQgI2FhYTsNCiAgICBib3JkZXItcmFkaXVzOiAycHg7DQogICAgbWFyZ2luLWxlZnQ6IDAuMjVlbTsNCn0NCg0KLnN5bWJvbG9neS1jb2xvcnMgLnN5bWJvbG9neS1sYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KfQ0KDQouY29sb3ItcGlja2VyIHsNCiAgICBtYXJnaW4tcmlnaHQ6IDFlbTsNCn0NCg0KLnN5bWJvbG9neS1sYWJlbDo6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6ICI6IjsNCn0NCg0KLnN5bWJvbG9neS1udW1iZXJpbnB1dCAuc3ltYm9sb2d5LWxhYmVsIHsNCiAgICBtYXJnaW4tbGVmdDogLTVweDsNCn0NCg0KLnN5bWJvbG9neS1jb2xvcnMgLnN5bWJvbG9neS1sYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIG1hcmdpbjogOHB4IDhweCA4cHggMDsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQouc3ltYm9sb2d5LXNldHRpbmdzIGlucHV0W3R5cGU9Y29sb3JdIHsNCiAgICB3aWR0aDogNGVtOw0KICAgIGhlaWdodDogMy41ZW07DQogICAgcGFkZGluZzogMC4xZW0gMC4zZW07DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0VFRTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjQ0NDOw0KICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQp9DQoNCi5zeW1ib2xvZ3ktc2V0dGluZ3MgaW5wdXRbdHlwZT0iY29sb3IiXTpob3ZlciwNCi5zeW1ib2xvZ3ktc2V0dGluZ3MgaW5wdXRbdHlwZT0iY29sb3IiXTphY3RpdmUgew0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNBQUE7DQp9DQoNCi5zeW1ib2xvZ3ktc2xpZGVycyB7DQogICAgbWFyZ2luOiAxZW0gMDsNCn0NCg0KLnN5bWJvbG9neS1zbGlkZXJzIC5zeW1ib2xvZ3ktbGFiZWwgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHdpZHRoOiA2ZW07DQp9DQoNCi5zeW1ib2xvZ3ktc2xpZGVycyAubnVtZXJpYy1pbnB1dCB7DQogICAgbWFyZ2luLXRvcDogMC42ZW07DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgbWFyZ2luLWxlZnQ6IDAuNWVtOw0KfQ0KDQouc3ltYm9sb2d5LXNsaWRlcnMgLm51bWVyaWMtdW5pdHMgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KfQ0KDQouc3ltYm9sb2d5LWRyb3AtZG93bnMgew0KICAgIG1hcmdpbjogMWVtIDAgMS43NWVtIDA7DQp9DQoNCi5zeW1ib2xvZ3ktZHJvcC1kb3ducyBzZWxlY3QsIC5zeW1ib2xvZ3ktc2VsZWN0LCAuaW1hZ2UtbGlicmFyeS1zZWxlY3RvciBzZWxlY3Qgew0KICBoZWlnaHQ6IDIuMmVtOw0KICBwYWRkaW5nOiAwLjJlbTsNCn0NCg0KLnN5bWJvbG9neS1kcm9wLWRvd24gew0KICAgIG1hcmdpbjogMC41ZW0gMDsNCn0NCg0KLnN5bWJvbG9neS1kcm9wLWRvd25zIC5zeW1ib2xvZ3ktbGFiZWwgew0KICAgIG1hcmdpbi1ib3R0b206IDAuMjVlbTsNCn0NCg0KLyotLS0gQXR0cmlidXRlIFN5bWJvbG9neSBTZXR0aW5ncyBXaWRnZXQgLS0tKi8NCg0KLnN5bWJvbG9neS1jbGFzc2JyZWFrLWNvbG9ycGlja2VyIHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgbWFyZ2luLWxlZnQ6IDFlbTsNCn0NCg0KLnN5bWJvbG9neS1jbGFzc2JyZWFrLWNvbG9ycGlja2VyIGlucHV0W3R5cGU9Y29sb3JdIHsNCiAgICB3aWR0aDogM2VtOw0KICAgIGhlaWdodDogMi43NWVtOw0KfQ0KDQoNCi5zeW1ib2xvZ3ktY2xhc3NlcyBidXR0b24uc3ltYm9sb2d5LWNsYXNzIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDJlbTsNCiAgICBtYXJnaW46IDAuMmVtOw0KICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgY29sb3I6ICM0NDQ0NDQ7DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0NCg0KLnN5bWJvbG9neS1jbGFzc2VzIGJ1dHRvbi5zeW1ib2xvZ3ktY2xhc3M6aG92ZXIgew0KICAgIGJhY2tncm91bmQ6ICM5NGRiZmY7DQogICAgY29sb3I6ICMxQTcyQzQ7DQp9DQoNCi5zeW1ib2xvZ3ktY2xhc3NlcyBidXR0b24uc3ltYm9sb2d5LWNsYXNzLnNlbGVjdGVkIHsNCiAgICBiYWNrZ3JvdW5kOiAjOTRkYmZmOw0KICAgIGNvbG9yOiAjMUE3MkM0Ow0KfQ0KDQouc3ltYm9sb2d5LWNsYXNzZXMgLnN5bWJvbG9neS10ZXh0IHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIHRvcDogMC4xNWVtOw0KICAgIHdpZHRoOiA3MCU7DQogICAgaGVpZ2h0OiAxLjZlbTsNCn0NCg0KLnN5bWJvbG9neS1jbGFzc2VzIC5zeW1ib2xvZ3ktY29sb3Igew0KICAgIGhlaWdodDogMS42NWVtOw0KICAgIHdpZHRoOiAyMCU7DQogICAgcmlnaHQ6IDAuMDVlbTsNCiAgICB0b3A6IDAuMWVtOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMC4yNXJlbTsNCiAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMC4yNXJlbTsNCn0NCg0KLnN5bWJvbG9neS1jbGFzc2VzIC5zeW1ib2xvZ3ktaW1hZ2Ugew0KICAgIGZsb2F0OiByaWdodDsNCiAgICBtYXgtaGVpZ2h0OiAxLjllbTsNCiAgICBtYXJnaW4tdG9wOiAtMC41ZW07DQp9DQoNCi8qLS0gVGV4dCBTeW1ib2xvZ3kgU2V0dGluZ3MgV2lkZ2V0IC0tKi8NCg0KLnN5bWJvbG9neS1jaGVja2JveCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHBhZGRpbmctcmlnaHQ6IDAuNWVtOw0KICAgIG1hcmdpbi10b3A6IDAuNWVtOw0KICAgIG1hcmdpbi1ib3R0b206IDEuNWVtOw0KfQ0KDQouc3ltYm9sb2d5LWZvcm0tY29udHJvbCB7DQogICAgbWluLXdpZHRoOiAxMDAlOw0KICAgIG1heC13aWR0aDogMTAwJTsNCn0NCg0KLnRleHQtc3ltYm9sb2d5LXNldHRpbmdzIC5zeW1ib2xvZ3ktc2xpZGVycyB7DQogICAgbWFyZ2luOiAwZW07DQp9DQo="),n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/AttributeSymbologySettingsView.html","html",e),n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/SymbolEditorView.html","html",t),n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/SymbologySettingsView.html","html",i),n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/widgets/PictureSymbolWidget.html","html",o),n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/widgets/SimpleSymbolWidget.html","html",s),n.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/symbology/widgets/TextSymbolWidget.html","html",l)})}();require({cache:{"geocortex/infrastructure/SymbolUtils":function(){define(["require","exports","./symbology/SymbolType","geocortex/framework/utils/utils","geocortex/framework-ui/LazyObservable","./BrowserUtils"],function(e,t,o,r,l,n){"use strict";function i(e){e||(e={});var t={a:e.a?e.a:d.a,r:e.r?e.r:d.r,g:e.g?e.g:d.g,b:e.b?e.b:d.b};return new dojo.Color(t)}function a(){return new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,14,s().setWidth(0),i())}function s(){return new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,i({a:.8}),2)}function u(){return new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,s(),i({a:.5}))}function y(e){void 0===e&&(e=!1);var t=new esri.symbol.TextSymbol(""),o=new esri.symbol.Font;return o.setSize("14pt"),o.setFamily("Calibri"),o.setWeight(esri.symbol.Font.WEIGHT_BOLD),t.setFont(o),t.setAlign(esri.symbol.TextSymbol.ALIGN_START),e||(t.setHaloColor(new esri.Color("#FFFFFF")),t.setHaloSize(1)),t}function f(e,t){return e.color.toHex()===t.color.toHex()&&e.angle===t.angle&&e.size===t.size&&e.style===t.style&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset&&m(e.outline,t.outline)}function c(e,t){return e.color.toHex()===t.color.toHex()&&e.angle===t.angle&&e.height===t.height&&e.size===t.size&&e.url===t.url&&e.width===t.width&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset}function m(e,t){return e.color.toHex()===t.color.toHex()&&e.style===t.style&&e.type===t.type&&e.width===t.width}function b(e,t){return e.color.toHex()===t.color.toHex()&&e.cap===t.cap&&e.miterLimit===t.miterLimit&&e.join===t.join&&e.style===t.style&&e.type===t.type&&e.width===t.width}function S(e,t){return e.color.toHex()===t.color.toHex()&&e.style===t.style&&m(e.outline,t.outline)}function p(e,t){return e.color.toHex()===t.color.toHex()&&e.height===t.height&&e.url===t.url&&e.width===t.width&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset&&e.xscale===t.xscale&&e.yscale===t.yscale&&m(e.outline,t.outline)}function h(e,t){return e.color.toHex()===t.color.toHex()&&e.align===t.align&&e.angle===t.angle&&e.decoration===t.decoration&&e.font.decoration===t.font.decoration&&e.font.family===t.font.family&&e.font.size===t.font.size&&e.font.style===t.font.style&&e.font.variant===t.font.variant&&e.font.weight===t.font.weight&&e.haloColor.toHex()===t.haloColor.toHex()&&e.haloSize===t.haloSize&&e.horizontalAlignment===t.horizontalAlignment&&e.kerning===t.kerning&&e.rotated===t.rotated&&e.text===t.text&&e.verticalAlignment===t.verticalAlignment&&e.xoffset===t.xoffset&&e.yoffset===t.yoffset}Object.defineProperty(t,"__esModule",{value:!0});var T=n.isIE();t.defaultPointMarkup=new l.LazyObservable(null,function(){return a()},!1),t.defaultPolylineMarkup=new l.LazyObservable(null,function(){return s()},!1),t.defaultPolygonMarkup=new l.LazyObservable(null,function(){return u()},!1),t.defaultTextMarkup=new l.LazyObservable(null,function(){return y(9===T||11===T)},!1),t.POINTS_TO_PIXELS=96/72;var d={r:204,g:51,b:51,a:1},g={};t.defaultSymbolColor=i,t.defaultMarkerSymbol=a,t.defaultLineSymbol=s,t.defaultFillSymbol=u,t.defaultTextSymbol=y,t.defaultSymbol=function(e){switch(e){case o.SymbolType.POINT:case o.SymbolType.MULTIPOINT:return a();case o.SymbolType.POLYLINE:return s();case o.SymbolType.POLYGON:return u();case o.SymbolType.TEXT:return y()}},t.defaultMarkupSymbol=function(e){switch(e){case o.SymbolType.POINT:case o.SymbolType.MULTIPOINT:return t.defaultPointMarkup.get();case o.SymbolType.POLYLINE:return t.defaultPolylineMarkup.get();case o.SymbolType.POLYGON:return t.defaultPolygonMarkup.get();case o.SymbolType.TEXT:return t.defaultTextMarkup.get()}},t.stringToHash=function(e){for(var t=5381,o=e.length;o;)t=33*t^e.charCodeAt(--o);return t>>>0},t.layerFeatureTypeToSymbolType=function(e){return"None"===e?null:"Line"==e?o.SymbolType.POLYLINE:e.toLowerCase()},t.fromEsriSymbolType=function(e){return"simplemarkersymbol"===e||"picturemarkersymbol"===e?o.SymbolType.POINT:"simplelinesymbol"===e?o.SymbolType.POLYLINE:"simplefillsymbol"===e?o.SymbolType.POLYGON:"textsymbol"===e?o.SymbolType.TEXT:null},t.webMapAngleToJSAPIAngle=function(e){var t=e%360;return t=t<0?Math.abs(t):360-t},t.rotate=function(e,t,o,r,l){var n=Math.PI/180*l,i=Math.cos(n),a=Math.sin(n);return{x:i*(o-e)+a*(r-t)+e,y:i*(r-t)-a*(o-e)+t}},t.createSymbolSwatch=function(e,t,o){var r=dojox.gfx.createSurface(e,t,t),l=esri.symbol.getShapeDescriptors(o);r.createShape(l.defaultShape).setFill(l.fill).setStroke(l.stroke).applyTransform({dx:.5*t,dy:.5*t})},t.createTextSymbolSwatch=function(e,t,o,l){var n=dojox.gfx.createSurface(e,t,t);o.setText("Aa");var i=esri.symbol.getShapeDescriptors(o);i.defaultShape.x+=.5*t,i.defaultShape.y+=.5*t;var a=n.createShape(i.defaultShape).setFill(i.fill).setFont(i.font);if(o.haloColor&&o.haloSize){var s=r.alphaNumericToken(),u=l._getDilateFilter(o.haloColor,o.haloSize,s);delete l._svgFilters[s],u.x=0,u.y=0,u.width="120%",u.height="120%",a.setFilter(u),a.rawNode.setAttribute("filter","url(#"+s+")")}},t.esriSymbolsEqual=function(e,t){if(!e||!t)return!1;if(e===t)return!0;if(e.type!==t.type)return!1;switch(e.type){case"simplemarkersymbol":return f(e,t);case"picturemarkersymbol":return c(e,t);case"simplelinesymbol":return m(e,t);case"cartographiclinesymbol":return b(e,t);case"simplefillsymbol":return S(e,t);case"picturefillsymbol":return p(e,t);case"textsymbol":return h(e,t);default:return!1}},t.getEssentialsSymbolLibrary=function(e){return new Promise(function(t,o){if(!e)return o(new Error("SymbolUtils: getEssentialsSymbolLibrary needs a symbolLibraryUrl"));var r=g[e];if(r)return r.then(t,o);var l={url:e,content:{f:"json"},handleAs:"json"},n=esri.request(l);g[e]=n,n.then(t,function(t){g.hasOwnProperty(e)&&delete g[e],o(t)})})}})}}});require({cache:{"geocortex/infrastructure/TaskUtils":function(){define(["require","exports","geocortex/essentials/Layer","geocortex/essentials/MapServiceConstants","geocortex/essentials/FeatureLayerService","geocortex/essentials/RestHelperHTTPService","geocortex/essentials/Field","./NumberFormat","./FormatUtils"],function(e,r,a,i,s,n,t,c,o){"use strict";function u(e,r){var i,s=null,n=null;if(e instanceof a.Layer?(i=(s=e).mapService,r&&(n=r.serviceLayer)):e instanceof esri.layers.Layer&&(n=e,r&&(i=r)),n instanceof esri.layers.FeatureLayer&&"table"===n.type||n instanceof esri.layers.FeatureLayer&&!i)return n.url;if(!m(i))return null;var t=null;if(n instanceof esri.layers.WMSLayer||n instanceof esri.layers.WFSLayer){if(!s)return null;t=s.url}else s?t=s.mapService.serviceLayer.url:n&&(t=n.url);var c,o=null;if(s?s.isDynamic?(c="dynamicLayer",o=y(n,s)):c=s.id:n&&(c=n.id),!(n instanceof esri.layers.FeatureLayer||t.match(/\/\d+(\?.*)?$/))){var u=t.indexOf("?"),l=t.indexOf("#");-1!=u?t=t.substring(0,u)+"/"+c+t.substring(u):-1!=l?t=t.substring(0,l)+"/"+c+t.substring(l):t+="/"+c}return t=f(t,r),o&&(t+=t.indexOf("?")>-1?"&layer=":"?layer=",t+=encodeURIComponent(JSON.stringify(o))),t}function l(e){var r=null;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer)(a=e).gdbVersion&&(r=a.gdbVersion);else if(e instanceof esri.layers.FeatureLayer){var a=e;a.gdbVersion&&(r=a.gdbVersion)}return r}function y(e,r){var a=null,i=r.mapService.getDynamicLayerInfoById(r.id);if(i&&i.source&&(i.source instanceof esri.layers.LayerDataSource||i.source instanceof esri.layers.LayerMapSource)){(a=new T).source=i.source.toJson(),i.id&&(a.id=i.id);var s=r.getDefinitionExpression(r.mapService.serviceLayer);return s&&(a.definitionExpression=s),a}throw new Error("A dynamic layer must have a DataSource!")}function p(e){if(!e||!e.serviceUrl)return null;if(e.mapServiceType===i.MapServiceType.WMS||e.mapServiceType===i.MapServiceType.WFS){for(var r=0;r<e.layers.length;r++)if(d(e.layers[r]))return f(e.url,e);return null}return m(e)?e instanceof s.FeatureLayerService?e.serviceUrl.substring(0,e.serviceUrl.lastIndexOf("/")).replace(/FeatureServer$/i,"MapServer"):e.mapServiceType==i.MapServiceType.DYNAMIC||e.mapServiceType==i.MapServiceType.TILED?f(e.serviceUrl,e):null:null}function f(e,r){if(!e)return null;if(!r)return e;if(r.mapServiceType===i.MapServiceType.WMS||r.mapServiceType===i.MapServiceType.WFS){var a=n.RestHelperHTTPService.getTokenForScope(r.url);a&&(e=n.RestHelperHTTPService.appendTokenToUrl(e,a))}else r.serviceToken&&!/.*token=.*/.test(e)&&(e=n.RestHelperHTTPService.appendTokenToUrl(e,r.serviceToken));return e}function d(e){return!!e&&!(!e.identifiable||!e.supportsIdentify)}function v(e){return!!e&&!(!e.queryable||!e.supportsQuery)}function m(e){if(!e||!e.serviceLayer)return!1;if(e.mapServiceType===i.MapServiceType.WMS||e.mapServiceType===i.MapServiceType.WFS){for(var r=0;r<e.layers.length;r++)if(v(e.layers[r]))return!0;return!1}var a=e.serviceLayer;return!!a.capabilities&&(a.version<10||a.capabilities&&a.capabilities.indexOf("Query")>=0)}Object.defineProperty(r,"__esModule",{value:!0});var T=function(){return function(){}}(),h=function(){return function(e){this.searchText=e?(e+"").trim():"",this.searchTextLower=this.searchText.toLowerCase(),this.searchTextQuotesFixed=this.searchText.replace("'","''"),this.searchTextLowerQuotesFixed=this.searchTextLower.replace("'","''");var r=[c.NumberFormat.ACCOUNTING,c.NumberFormat.CURRENCY,c.NumberFormat.FIXED_POINT,c.NumberFormat.NUMBER,c.NumberFormat.PERCENT,c.NumberFormat.ROUND_TRIP];this.searchNum=o.parseNumber(this.searchText,r);var a;if(!isNaN(this.searchNum)){var i;if((a=o.formatNumber(this.searchNum,c.NumberFormat.ROUND_TRIP)).indexOf(".")){var s=a.length-a.indexOf(".")-1;i=Math.pow(10,-s)}else i=1;this.searchNum<0?(this.searchLowerBound=o.formatNumber(this.searchNum-i,c.NumberFormat.ROUND_TRIP),this.searchUpperBound=a):(this.searchLowerBound=a,this.searchUpperBound=o.formatNumber(this.searchNum+i,c.NumberFormat.ROUND_TRIP))}}}();r.getQueryTaskUrl=u,r.getQueryTask=function(e,r){var i=null,s=null,n=null,t=null;if(e instanceof esri.layers.Layer)s=e,r&&(n=r);else{if(!(e instanceof a.Layer&&e.mapService&&e.mapService.serviceLayer))throw new Error("Cannot generate a QueryTask from the given parameters.");s=e.mapService.serviceLayer,n=e.mapService,t=e}if(s){var c=l(s);c&&(i={gdbVersion:c})}return new esri.tasks.QueryTask(u(t||s,n),i)},r.getIdentifyTaskUrl=p,r.getIdentifyTask=function(e){var r=null;if(e.serviceLayer){var a=l(e.serviceLayer);a&&(r={gdbVersion:a})}return new esri.tasks.IdentifyTask(p(e),r)},r.getTokenizedUrl=f,r.canIdentifyLayer=d,r.canQueryLayer=v,r.canQueryMapService=m,r.getSearchTextWhereClause=function(e,r,a,i){var s=new h(a);if(!e||!r||0==r.length||!s.searchText)return"";for(var n="",c=0;c<r.length;c++){var o=r[c];if(o.searchable&&"gml:id"!==o.name)if(o.isCodedValueDomain()||o.hasSubtypeCodedValueDomains()){var u=[],l=o.getCodedValueDomain();l&&l.codedValues.forEach(function(e){return u.push(e)});var y=o.getSubtypeCodedValueDomains();for(var p in y)y.hasOwnProperty(p)&&y[p].codedValues.forEach(function(e){return u.push(e)});u.forEach(function(e){e.name.toLowerCase().indexOf(s.searchTextLower)>-1&&(n.length>0&&(n+=" OR "),o.type===t.EsriFieldTypes.esriFieldTypeString?n+=encodeURI(o.name)+" = '"+e.code.replace("'","''")+"'":n+=encodeURI(o.name)+" = "+e.code)})}else switch(o.type){case t.EsriFieldTypes.esriFieldTypeString:n.length>0&&(n+=" OR "),e.mapService.serviceLayer instanceof esri.layers.WMSLayer||e.mapService.serviceLayer instanceof esri.layers.WFSLayer?n+=encodeURI(o.name)+" LIKE '%"+s.searchTextQuotesFixed+"%'":n+="LOWER("+o.name+") LIKE '%"+s.searchTextLowerQuotesFixed+"%'";break;case t.EsriFieldTypes.esriFieldTypeSmallInteger:case t.EsriFieldTypes.esriFieldTypeInteger:case t.EsriFieldTypes.esriFieldTypeOID:case t.EsriFieldTypes.esriFieldTypeSingle:case t.EsriFieldTypes.esriFieldTypeDouble:if(isNaN(s.searchNum))break;n.length>0&&(n+=" OR "),n+="("+encodeURI(o.name.toLowerCase())+" <= "+s.searchUpperBound+" AND "+encodeURI(o.name.toLowerCase())+" >= "+s.searchLowerBound+")";break;case t.EsriFieldTypes.esriFieldTypeDate:break;case t.EsriFieldTypes.esriFieldTypeGlobalID:case t.EsriFieldTypes.esriFieldTypeBlob:break;default:i&&i.warning("Unhandled layer data type: '{0}'. Field '{1}' in layer '{2}' has been excluded from search.".format(o.type,o.alias,e.displayName))}}var f=e.getDefinitionExpression(e.mapService.serviceLayer);return f&&(n="("+n+") AND ("+f+")"),n}})}}});require({cache:{"geocortex/infrastructure/TimeSliderUtils":function(){define(["require","exports","geocortex/essentials/TimeUnits"],function(e,i,s){"use strict";function t(e){if(!e)return NaN;var i=0;switch(e){case s.TimeUnits.UNIT_MILLISECONDS:i=1;break;case s.TimeUnits.UNIT_SECONDS:i=1e3;break;case s.TimeUnits.UNIT_MINUTES:i=6e4;break;case s.TimeUnits.UNIT_HOURS:i=36e5;break;case s.TimeUnits.UNIT_DAYS:i=864e5;break;case s.TimeUnits.UNIT_WEEKS:i=6048e5;break;case s.TimeUnits.UNIT_MONTHS:i=Math.round(26784e5);break;case s.TimeUnits.UNIT_YEARS:i=31536e6;break;case s.TimeUnits.UNIT_DECADES:i=31536e7;break;case s.TimeUnits.UNIT_CENTURIES:i=31536e8;break;case s.TimeUnits.UNIT_UNKNOWN:default:i=NaN}return i}Object.defineProperty(i,"__esModule",{value:!0}),i.convertTimeUnitToMilliseconds=t,i.computeTimeIntervalInMs=function(e,i){var s=t(i);return isNaN(parseInt(e,10))||isNaN(s)?NaN:s*e}})}}});require({cache:{"geocortex/infrastructure/TimeZoneUtils":function(){define(["require","exports","geocortex/framework/utils/ArrayUtils"],function(e,t,n){"use strict";function r(e){if(!e)return null;var t=null,r=null;return t=e.timeZoneId,e.essentialsMap&&e.essentialsMap.site&&(r=e.essentialsMap.site.timeZoneId),n.firstOrDefault([t,r],function(e){return!!e})}function i(e,t){if(null===e||void 0===e)return null;if(!t)return e;var n=-moment.tz(e.getTime(),t).utcOffset();return moment(e).add(n,"minutes").toDate()}Object.defineProperty(t,"__esModule",{value:!0}),t.UTC_ZONE_ID="Etc/UTC",t.getTimeZoneFromLayer=function(e){if(!e)return null;var t=null,i=null;return t=e.timeZoneId,e.mapService&&(i=r(e.mapService)),n.firstOrDefault([t,i],function(e){return!!e})},t.getTimeZoneFromMapService=r,t.getDisplayTimeZoneFromMapService=function(e){return e&&e.essentialsMap&&e.essentialsMap.site?e.essentialsMap.site.displayTimeZoneId:null},t.correctDatesForDisplayInDisplayTimeZone=function(e,n,r){if(null===e||void 0===e)return null;if(n||(n=t.UTC_ZONE_ID),!r)return i(e,n);var u=-(-e.getTimezoneOffset()-moment.tz(e.getTime(),r).utcOffset()),o=i(e,n);return moment(o).add(u,"minutes").toDate()},t.correctDatesForDisplayInLocalTime=i,t.correctDatesToSubmitInDatabaseTime=function(e,n,r){if(null===e||void 0===e)return null;n||(n=t.UTC_ZONE_ID);var i=moment.tz(e.getTime(),n).utcOffset();if(!r)return moment(e).add(i,"minutes").toDate();var u=i-moment.tz(e.getTime(),r).utcOffset(),o=-e.getTimezoneOffset();return moment(e).add(o+u,"minutes").toDate()},t.correctDatesToQueryInDatabaseTime=function(e,n,r){if(null===e||void 0===e)return null;n||(n=t.UTC_ZONE_ID);var i=moment.tz(e.getTime(),n).utcOffset();if(!r){var u=e.getTimezoneOffset();return moment(e).add(u+i,"minutes").toDate()}var o=i-moment.tz(e.getTime(),r).utcOffset();return moment(e).add(o,"minutes").toDate()}})}}});!function(){require({cache:{"geocortex/infrastructure/toolbarGroup/ToolbarGroupBase":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/framework-ui/StringLocalizer"],function(t,e,o,n,r){"use strict";function i(t,e,o){var n=o.type,r=a[n];if(r)return r(t,e,o);throw new Error("Could not find factory delegate for toolbar item type '"+n+"'")}Object.defineProperty(e,"__esModule",{value:!0});var a={};e.registerToolbarFactoryMethod=function(t,e){a[t]=e},e.createToolbarItem=i;var s=function(){function t(t,e,i){this.libraryId="",this.isActive=new o.Observable(!1),this.disabled=new o.Observable(!1),this.cssClass=new o.Observable,this.app=t,this.libraryId=e,i&&(this.name=new o.Observable(i.name),this.id=i.id||i.name||n.alphaNumericToken(),this.tooltip=new o.Observable(i.tooltip||null),this.type=i.type||"toolbarGroup",this.isDefault=!!i.isDefault,this.items=i.items?this.getToolbarGroupItems(i.items):new o.ObservableCollection,i.libraryId&&r.localizeObservables(t,i.libraryId,[this.name,this.tooltip]))}return t.prototype.getToolbarGroupItems=function(t){for(var e=new o.ObservableCollection,n=0;n<t.length;n++){var r=null;r=i(this.app,this.libraryId,t[n]),e.addItem(r)}return e},t}();e.ToolbarGroupBase=s})},"geocortex/infrastructure/toolbarGroup/ToolbarGroupItemBase":function(){define(["require","exports","geocortex/framework/observables","geocortex/framework-ui/StringLocalizer"],function(t,e,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,r){this.libraryId="",this.isActive=new o.Observable(!0),this.activeTransient=new o.Observable(!1),this.disabled=new o.Observable(!1),this.hidden=new o.Observable(!1),this.cssClass=new o.Observable,this.items=new o.ObservableCollection,this.hasSmallLayout=new o.Observable(!1),this.selectedTool=new o.Observable(null),this.toolChangeActive=new o.Observable(!1),r&&(this.id=r.id,this.app=t,this.libraryId=e,this.type=r.type,this.name=new o.Observable(r.name),this.tooltip=new o.Observable(r.tooltip||null),this.hideOnDisable=new o.Observable(!!r.hideOnDisable),r.libraryId&&n.localizeObservables(t,r.libraryId,[this.name,this.tooltip]))}return t.prototype.areAllHidden=function(t){for(var e=0;e<t.length();e++)if(!1===t.getAt(e).disabled.get()||!1===t.getAt(e).hideOnDisable.get())return!1;return!0},t.prototype.setHidden=function(){!0===this.disabled.get()&&!0===this.hideOnDisable.get()?this.hidden.set(!0):this.hidden.set(!1)},t.prototype.execute=function(){},t.prototype.activate=function(){this.isActive.set(!0)},t.prototype.deactivate=function(){this.isActive.set(!1),this.activeTransient.set(!1)},t.prototype.onDestroy=function(){},t}();e.ToolbarGroupItemBase=r})},"geocortex/infrastructure/toolbarGroup/ToolbarGroupRegistry":function(){define(["require","exports","geocortex/framework/observables","./ToolbarGroupBase"],function(t,e,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.toolbarGroupList=new o.ObservableCollection,this._toolbarGroupsConfig=[],this.app=t}return t.prototype.getToolbarGroupById=function(t){if(0===this.toolbarGroupList.get().length||null===t)return null;for(var e=0;e<this.toolbarGroupList.get().length;e++)if(this.toolbarGroupList.getAt(e).id==t)return this.toolbarGroupList.getAt(e);return null},t.prototype.registerToolbarGroups=function(t,e){if(t)for(var o=0;o<t.length;o++){var r=t[o],i=new n.ToolbarGroupBase(this.app,e,r);this._toolbarGroupsConfig.push(r),this.unregisterToolbarGroup(r.id),this.toolbarGroupList.addItem(i)}},t.prototype.unregisterToolbarGroup=function(t){var e=this.getPosition(t);null!=e&&this.toolbarGroupList.get().splice(e,1)},t.prototype.getPosition=function(t){for(var e=0;e<this.toolbarGroupList.getLength();e++)if(this.toolbarGroupList.getAt(e).id===t)return e;return null},t}();e.ToolbarGroupRegistry=r})},"geocortex/infrastructure/toolbarGroup/types/ToolbarButton":function(){var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./../ToolbarGroupItemBase","geocortex/framework/observables","./../ToolbarGroupBase"],function(require,exports,ToolbarGroupItemBase_1,observables_1,ToolbarGroupBase_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ToolbarButton=function(_super){function ToolbarButton(app,libraryId,entry){var _this=_super.call(this,app,libraryId,entry)||this,commandName=entry.command,commandParameter=entry.commandParameter,cvmCtor=eval("geocortex.essentialsHtmlViewer.mapping.modules.command.CommandViewModel");return _this.command=new cvmCtor(_this.app,void 0,commandName,commandParameter),_this.disabled.set(!_this.command.canExecute.get()),_this.setHidden(),_this.command.canExecute.bind(_this,function(t){_this.disabled.set(!t),_this.setHidden()}),_this.iconUri=new observables_1.Observable(entry.iconUri),_this.app.site&&_this.app.site.isInitialized||_this.app.event("SiteInitializedEvent").once(_this,_this._raiseCommandCanExecuteChanged),_this}return __extends(ToolbarButton,_super),ToolbarButton.prototype.execute=function(){this.command&&this.command.commandName&&(this.command.commandParameter?this.app.commandRegistry.command(this.command.commandName).execute(this.command.commandParameter):this.app.commandRegistry.command(this.command.commandName).execute());var t={commandName:this.command.commandName,commandParameter:this.command.commandParameter,id:this.id,name:this.name.get(),libraryId:this.libraryId};this.app.event("ToolbarButtonClickedEvent").publish(t)},ToolbarButton.prototype._raiseCommandCanExecuteChanged=function(){this.command.commandName&&this.app.command(this.command.commandName).raiseCanExecuteChanged()},ToolbarButton}(ToolbarGroupItemBase_1.ToolbarGroupItemBase);exports.ToolbarButton=ToolbarButton,ToolbarGroupBase_1.registerToolbarFactoryMethod("button",function(t,e,o){return new ToolbarButton(t,e,o)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarFlyout":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./ToolbarGroup","geocortex/framework/observables","./../../tools/MapTool","./../ToolbarGroupBase"],function(e,o,n,r,i,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(e){function o(t,o,n){var i=e.call(this,t,o,n)||this;return i.flyoutButtonDescription=new r.Observable(""),i.selectedTool.set(i.items.getAt(0)),i.flyoutButtonDescription.set(i.app.getResource(i.libraryId,"language-toolbar-flyout-description").format(i.name.get())),i.app.event("ActiveToolChangedEvent").subscribe(i,function(t){var e=i.items.get().filter(function(e){return i._seeIfActiveToolIsInFlyout(e,t)});e.length>0&&i.selectedTool.set(e[0])}),i}return t(o,e),o.prototype._seeIfActiveToolIsInFlyout=function(t,e){if(!(t.tool instanceof i.MapTool))return!1;var o=t.tool;if(e.tool instanceof i.MapTool){var n=e.tool;return o.command===n.command&&o.drawMode===n.drawMode}return!1},o.prototype.toggleFlyout=function(){this.toolChangeActive.set(!this.toolChangeActive.get())},o.prototype.switchActiveFlyoutTool=function(t){"tool"===t.type&&this.selectedTool.set(t),t.execute()},o.prototype.getToolbarItemType=function(t){return a.createToolbarItem(this.app,this.libraryId,t)},o}(n.ToolbarGroup);o.ToolbarFlyout=s,a.registerToolbarFactoryMethod("flyout",function(t,e,o){return new s(t,e,o)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarGroup":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./../ToolbarGroupItemBase","geocortex/framework/observables","./../ToolbarGroupBase"],function(e,o,n,r,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(e){function o(t,o,n){var i=e.call(this,t,o,n)||this;n.layout&&"small"===n.layout.toLowerCase()&&i.hasSmallLayout.set(!0),i.items=new r.ObservableCollection;for(var a=0;a<n.items.length;a++){var s=i.getToolbarItemType(n.items[a]);s&&i.items.addItem(s)}return i.disabled.set(i.areAllHidden(i.items)),i.setHidden(),i.disabled.bind(i,function(t){i.setHidden()}),i}return t(o,e),o.prototype.getToolbarItemType=function(t){return i.createToolbarItem(this.app,this.libraryId,t)},o}(n.ToolbarGroupItemBase);o.ToolbarGroup=a,i.registerToolbarFactoryMethod("toolbarGroup",function(t,e,o){return new a(t,e,o)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarRegion":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./../ToolbarGroupItemBase","./../ToolbarGroupBase"],function(e,o,n,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=function(e){function o(t,o,n){var r=e.call(this,t,o,n)||this;return r.regionName=n.regionName,r}return t(o,e),o}(n.ToolbarGroupItemBase);o.ToolbarRegion=i,r.registerToolbarFactoryMethod("region",function(t,e,o){return new i(t,e,o)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarToggleButton":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./../ToolbarGroupItemBase","./../../CommandViewModel","geocortex/framework/observables","./../ToolbarGroupBase"],function(e,o,n,r,i,a){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s;!function(t){t[t.TOGGLE_BUTTON_OFF=0]="TOGGLE_BUTTON_OFF",t[t.TOGGLE_BUTTON_ON=1]="TOGGLE_BUTTON_ON"}(s=o.ToggleButtonState||(o.ToggleButtonState={}));var l=function(e){function o(t,o,n){var a=e.call(this,t,o,n)||this;return a.state=new i.Observable(null),a.toggleButtonEntry=n,a.toggleOnCommand=new r.CommandViewModel(a.app,o,n.toggleOn.command,n.toggleOn.commandParameter),a.toggleOffCommand=new r.CommandViewModel(a.app,o,n.toggleOff.command,n.toggleOff.commandParameter),a.isToggledOn=new i.Observable(!1),a.iconUri=new i.Observable(null),a.state.bind(a,function(t){return a.setState(t)}),a.toggleButtonEntry.toggleStateName&&""!==a.toggleButtonEntry.toggleStateName?(a.app.event("StateEnteredEvent").subscribe(a,function(t){t.stateDefinition.name===a.toggleButtonEntry.toggleStateName&&a.state.set(s.TOGGLE_BUTTON_ON),a.isToggledOn.get()&&"TransientActiveState"===t.stateDefinition.name&&a.activeTransient.set(!0)}),a.app.event("StateExitedEvent").subscribe(a,function(t){t.stateDefinition.name===a.toggleButtonEntry.toggleStateName&&a.state.set(s.TOGGLE_BUTTON_OFF),"TransientActiveState"===t.stateDefinition.name&&a.activeTransient.set(!1)})):a._setUpBindings(),a.app.site&&a.app.site.isInitialized||a.app.event("SiteInitializedEvent").once(a,function(){a.toggleOffCommand.commandName&&a.app.command(a.toggleOffCommand.commandName).raiseCanExecuteChanged(),a.toggleOnCommand.commandName&&a.app.command(a.toggleOnCommand.commandName).raiseCanExecuteChanged(),a.state.get()===s.TOGGLE_BUTTON_OFF?a.disabled.set(!a.toggleOffCommand.canExecute.get()):a.disabled.set(!a.toggleOnCommand.canExecute.get())}),n.toggleStateName&&a.app.stateManager.isCurrentlyActive(n.toggleStateName)?a.state.set(s.TOGGLE_BUTTON_ON):a.state.set(s.TOGGLE_BUTTON_OFF),a}return t(o,e),o.prototype.execute=function(){this.command&&this.command.commandName&&(this.command.commandParameter?this.app.commandRegistry.command(this.command.commandName).execute(this.command.commandParameter):this.app.commandRegistry.command(this.command.commandName).execute())},o.prototype.setState=function(t){if(t===s.TOGGLE_BUTTON_OFF)var e=this.toggleButtonEntry.toggleOn.name||this.toggleButtonEntry.name||"",o=this.toggleButtonEntry.toggleOn.iconUri||this.toggleButtonEntry.iconUri||null,n=this.toggleButtonEntry.toggleOn.tooltip||this.toggleButtonEntry.tooltip||null,r=void 0!=this.toggleButtonEntry.toggleOn.hideOnDisable?!!this.toggleButtonEntry.toggleOn.hideOnDisable:!!this.toggleButtonEntry.hideOnDisable,i=!1;else var e=this.toggleButtonEntry.toggleOff.name||this.toggleButtonEntry.name||"",o=this.toggleButtonEntry.toggleOff.iconUri||this.toggleButtonEntry.iconUri||null,n=this.toggleButtonEntry.toggleOff.tooltip||this.toggleButtonEntry.tooltip||null,r=void 0!=this.toggleButtonEntry.toggleOff.hideOnDisable?!!this.toggleButtonEntry.toggleOff.hideOnDisable:!!this.toggleButtonEntry.hideOnDisable,i=!0;this.name.set(e),this.isToggledOn.set(i),this.iconUri.set(o),this.tooltip.set(n),this.command=t===s.TOGGLE_BUTTON_OFF?this.toggleOnCommand:this.toggleOffCommand,this.disabled.set(!this.command.canExecute.get()),this.hideOnDisable.set(r),this.setHidden(),this.app.event("ToggleButtonStateChangedEvent").publish({toggleButtonEntry:this.toggleButtonEntry,state:t})},o.prototype.onDestroy=function(){this._disconnectBindings()},o.prototype._setUpBindings=function(){var t=this;this._toggleOnCommandCanExecuteBindingToken=this.toggleOnCommand.canExecute.bind(this,function(e){return t._handleCommandCanExecuteChanged(t.toggleOnCommand,e)}),this._toggleOnCommandPostExecSubscriptionToken=this.app.command(this.toggleButtonEntry.toggleOn.command).postExecute.subscribe(this,this._handleToggleOnCommandPostExecute),this._toggleOffCommandCanExecuteBindingToken=this.toggleOffCommand.canExecute.bind(this,function(e){return t._handleCommandCanExecuteChanged(t.toggleOffCommand,e)}),this._toggleOffCommandPostExecSubscriptionToken=this.app.command(this.toggleButtonEntry.toggleOff.command).postExecute.subscribe(this,this._handleToggleOffCommandPostExecute)},o.prototype._disconnectBindings=function(){this.toggleOnCommand.canExecute.unbind(this._toggleOnCommandCanExecuteBindingToken),this.app.command(this.toggleButtonEntry.toggleOn.command).postExecute.unsubscribe(this._toggleOnCommandPostExecSubscriptionToken),this.toggleOffCommand.canExecute.unbind(this._toggleOffCommandCanExecuteBindingToken),this.app.command(this.toggleButtonEntry.toggleOff.command).postExecute.unsubscribe(this._toggleOffCommandPostExecSubscriptionToken)},o.prototype._handleToggleOnCommandPostExecute=function(t){t&&this.command.commandParameter!==t||this.state.get()!==s.TOGGLE_BUTTON_ON&&this.state.set(s.TOGGLE_BUTTON_ON)},o.prototype._handleToggleOffCommandPostExecute=function(t){t&&this.command.commandParameter!==t||this.state.get()!==s.TOGGLE_BUTTON_OFF&&this.state.set(s.TOGGLE_BUTTON_OFF)},o.prototype._handleCommandCanExecuteChanged=function(t,e){this.command===t&&(this.disabled.set(!e),this.setHidden())},o}(n.ToolbarGroupItemBase);o.ToolbarToggleButton=l,a.registerToolbarFactoryMethod("toggleButton",function(t,e,o){return new l(t,e,o)})})},"geocortex/infrastructure/toolbarGroup/types/ToolbarTool":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./../ToolbarGroupItemBase","geocortex/framework/observables","./../ToolbarGroupBase"],function(e,o,n,r,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(e){function o(t,o,n){var i=e.call(this,t,o,n)||this;if(!n)return i;var a={};for(var s in n){if(!s)break;a[s]=n[s]}a.name=n.id;var l=[];return l.push(a),i.app.allLibrariesLoaded?i._initializeTool(l):(i.disabled.set(!0),i.setHidden(),i.app.event("ViewerLibrariesDownloadedEvent").once(i,function(){i.disabled.set(!1),i.setHidden(),i._initializeTool(l)})),i.isActive.set(!1),i.iconUri=new r.Observable(n.iconUri),i.app.event("StateEnteredEvent").subscribe(i,function(t){i.isActive.get()&&"TransientActiveState"===t.stateDefinition.name&&i.activeTransient.set(!0)}),i.app.event("StateExitedEvent").subscribe(i,function(t){"TransientActiveState"===t.stateDefinition.name&&i.activeTransient.set(!1)}),i}return t(o,e),o.prototype.execute=function(){this.isActive.get()||this.tool.isActive?this.app.commandRegistry.command("ClearActiveTool").execute():this.tool.enabled&&!this.tool.enabled.get()||this.app.commandRegistry.command("SetActiveTool").execute(this.tool.id)},o.prototype._initializeTool=function(t){var e=this;this.tool=this.app.toolRegistry.createTools(t,!0)[0],this.tool?this.tool.enabled&&(this.disabled.set(!this.tool.enabled.get()),this.setHidden(),this.tool.enabled.bind(this,function(t){e.disabled.set(!t),e.setHidden(),t||!e.isActive.get()&&!e.tool.isActive||e.app.commandRegistry.command("ClearActiveTool").execute()})):(this.disabled.set(!0),this.setHidden())},o}(n.ToolbarGroupItemBase);o.ToolbarTool=a,i.registerToolbarFactoryMethod("tool",function(t,e,o){return new a(t,e,o)})})}}})}();require({cache:{"geocortex/infrastructure/tools/DisablingMapTool":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./MapTool","geocortex/framework/observables"],function(e,o,n,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(e){function o(t,o){var n=e.call(this,t,o)||this;if(n.enabled=new i.Observable(!0),o.command){var r=t.command(o.command);n.enabled.set(r.canExecute()),r.canExecuteChanged.subscribe(n,function(){var t=r.canExecute();!t&&n.isActive&&n.setActive(!1),n.enabled.set(t)})}return n}return t(o,e),o}(n.MapTool);o.DisablingMapTool=r})},"geocortex/infrastructure/tools/DrawMode":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(){}}();o.POINT="POINT",o.MULTI_POINT="MULTI_POINT",o.LINE="LINE",o.POLYGON="POLYGON",o.FREEHAND_POLYGON="FREEHAND_POLYGON",o.POLYLINE="POLYLINE",o.FREEHAND_POLYLINE="FREEHAND_POLYLINE",o.RECTANGLE="RECTANGLE",o.TRIANGLE="TRIANGLE",o.CIRCLE="CIRCLE",o.ELLIPSE="ELLIPSE",o.ARROW="ARROW",o.LEFT_ARROW="LEFT_ARROW",o.RIGHT_ARROW="RIGHT_ARROW",o.UP_ARROW="UP_ARROW",o.DOWN_ARROW="DOWN_ARROW",o.EXTENT="EXTENT",e.DrawMode=o})},"geocortex/infrastructure/tools/MapTool":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define(["require","exports","./ToolBase","./../accessibility/Draw"],function(e,o,n,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(e){function o(t,o){var n=e.call(this,t,o)||this;return n._drawIsActive=!1,n._drawEndHandlerToken=null,n._inputMethodChangeHandle=null,n._mapMouseHoverToken=null,n._mapMouseDownToken=null,n._autoPanPixelTolerance=15,n._autoPanStep=1/3,n._unsupportedAutoPanDrawModes=["FREEHAND_POLYGON","FREEHAND_POLYLINE","POINT","MULTI_POINT"],n._drawEndSuspended=!1,n}return t(o,e),o.prototype._createDrawObject=function(){this._drawObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.draw",this.app.map),this._drawObject.setMarkerSymbol(new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.8]))),this._drawObject.setFillSymbol(new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.25]))),this._drawObject.setLineSymbol(new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2))},o.prototype._activateToolbar=function(){this._drawObject||this._createDrawObject(),this._drawEndHandlerToken||(this._drawEndHandlerToken=dojo.aspect.after(this._drawObject,"onDrawEnd",dojo.hitch(this,"onDrawEnd"),!0)),this._drawObject instanceof i.Draw&&(this._inputMethodChangeHandle=dojo.aspect.after(this._drawObject,"onInputMethodChange",dojo.hitch(this,"onInputMethodChange"),!0)),this._drawObject.activate(esri.toolbars.Draw[this.drawMode]),this._drawIsActive=!0,this._drawEndSuspended=!1},o.prototype._deactivateToolbar=function(){this._drawEndHandlerToken&&(this._drawEndHandlerToken.remove(),this._drawEndHandlerToken=null),this._inputMethodChangeHandle&&(this._inputMethodChangeHandle.remove(),this._inputMethodChangeHandle=null),this._drawObject&&this._drawIsActive&&(this._drawObject.deactivate(),this._drawIsActive=!1,this._drawEndSuspended=!1)},o.prototype.onActivated=function(){if(this._drawObject||this._createDrawObject(),this._drawIsActive&&this._deactivateToolbar(),"CURRENT_EXTENT"==this.drawMode)this.onDrawEnd(this.app.map.extent);else{if(!this.app.map.graphics)return;this.app.command("ShowMap").execute(),this._activateToolbar()}this._mapMouseDownToken=this.app.event("MapMouseDownEvent").subscribe(this,this.onMapMouseDown),this._mapMouseHoverToken=this.app.event("MapMouseHoverEvent").subscribe(this,this.onMapMouseHover)},o.prototype.onDeactivated=function(){this._mapMouseHoverToken&&(this.app.event("MapMouseHoverEvent").unsubscribe(this._mapMouseHoverToken),this._mapMouseHoverToken=null),this._mapMouseDownToken&&(this.app.event("MapMouseDownEvent").unsubscribe(this._mapMouseDownToken),this._mapMouseDownToken=null),this._deactivateToolbar(),this.app.command("ShowMap").execute()},o.prototype.onDrawEnd=function(t){var e=this;if(!this._drawEndSuspended){if(this.command){var o=this.app.command(this.command);o.canExecute(t)?(o.execute(t),this.app.command("LogOptimizerEvent").execute(this.name,this.command)):this.app.trace.warning("Could not invoke command '{0}' for tool '{1}'.".format(this.command,this.name))}this.isSticky?(this._drawEndSuspended=!0,setTimeout(function(){return e._drawEndSuspended=!1},100)):this.setActive(!1)}},o.prototype.onInputMethodChange=function(t){var e={tool:this,previousMethod:t?t.previousMethod:null,newMethod:t?t.newMethod:null};this.app.event("ToolInputMethodChangedEvent").publish(e)},o.prototype.onMapMouseDown=function(t){3===t.which&&this._drawObject&&(this.app.command("ClearActiveTool").execute(),this._deactivateToolbar(),this.app.command("RemoveStatus").execute())},o.prototype.onMapMouseHover=function(t){if(null!=this._drawObject&&this._drawIsActive&&!(this._unsupportedAutoPanDrawModes.indexOf(this.drawMode)>=0)&&t.hasOwnProperty("clientX")&&t.hasOwnProperty("clientY")){var e=$(this.app.map.root).offset();t.clientX<e.left+this._autoPanPixelTolerance?this.app.command("PanLeft").execute(this._autoPanStep):e.left+this.app.map.width-this._autoPanPixelTolerance<t.clientX?this.app.command("PanRight").execute(this._autoPanStep):t.clientY<e.top+this._autoPanPixelTolerance?this.app.command("PanUp").execute(this._autoPanStep):e.top+this.app.map.height-this._autoPanPixelTolerance<t.clientY&&this.app.command("PanDown").execute(this._autoPanStep)}},o}(n.ToolBase);o.MapTool=r,r.prototype.command=null,r.prototype.drawMode=null,r.prototype.isSticky=!1})},"geocortex/infrastructure/tools/MapToolConfig":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})})},"geocortex/infrastructure/tools/ToolBase":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){this.name="",this.isActive=!1,dojo.mixin(this,e),this.app=t}return t.prototype.setActive=function(t){t?(this.isActive=!0,this.onActivated()):(this.isActive=!1,this.onDeactivated())},t.prototype.onActivated=function(){},t.prototype.onDeactivated=function(){},t}();e.ToolBase=o})},"geocortex/infrastructure/tools/ToolConfig":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})})},"geocortex/infrastructure/tools/ToolRegistry":function(){define(["require","exports","./MapTool"],function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.tools={},this._subscriptions={},this._toolTypes={},this.app=t,this._registerCommands()}return t.prototype._registerCommands=function(){var t=this;this.app.command("SetActiveTool").register(this,function(e){return t.setActiveTool(e)},function(e){return t._setActiveToolCanExecute(e)}),this.app.command("ClearActiveTool").register(this,function(){return t.clearActiveTool()})},t.prototype._setActiveToolCanExecute=function(t){return!!this.tool(t)},t.prototype.clearActiveTool=function(){for(var t in this.tools)if(this.tools.hasOwnProperty(t)){var e=this.tools[t];e&&e.isActive&&e.setActive(!1)}},t.prototype.getActiveTool=function(){for(var t in this.tools)if(this.tools.hasOwnProperty(t)){var e=this.tools[t];if(e&&e.isActive)return e}return null},t.prototype.setActiveTool=function(t){var e=this.getActiveTool();if(this.clearActiveTool(),t){var o=this.tool(t);o?(this.app.event("ActiveToolChangingEvent").publish({tool:o,previousTool:e}),o.setActive(!0)):this.app.trace.warning("Could not activate tool '{0}'. The tool does not exist in the registry.".format(t))}},t.prototype.tool=function(t){return this.tools[t]},t.prototype.register=function(t){var e=this;this.unregister(t),t&&t.name&&(this.tools[t.name]=t,this._subscriptions[t.name]=dojo.connect(t,"setActive",function(n){if(!0===n){for(var i in e.tools)if(e.hasOwnProperty(i)){var r=e.tools[i];r&&r!=t&&r.isActive&&r.setActive(!1)}e.app.event("ActiveToolChanged").publish({tool:t,previousTool:null}),e.app.event("ActiveToolChanged").publish({tool:t,previousTool:null}),e.app.event("ActiveToolChangedEvent").publish({tool:t,previousTool:null}),t instanceof o.MapTool&&e.app.event("ToolCommandActivatedEvent").publish(t.command)}else e.getActiveTool()||(e.app.event("ActiveToolChanged").publish({tool:null,previousTool:t}),e.app.event("ActiveToolChangedEvent").publish({tool:null,previousTool:t}),t instanceof o.MapTool&&e.app.event("ToolCommandDeactivatedEvent").publish(t.command))}))},t.prototype.unregister=function(t){if(t&&t.name&&this.tools[t.name]==t){this.tools[t.name]=null;var e=this._subscriptions[t.name];e&&(dojo.disconnect(e),this._subscriptions[t.name]=null)}},t.prototype.clear=function(){for(var t in this.tools){var e=this.tools[t];e&&this.unregister(e)}},t.prototype.createTools=function(t,e){var o=this,n=[];return t&&t.forEach(function(t){var i=t.typeName?t.typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.tools.MapTool";o._toolTypes.hasOwnProperty(t.command)&&(i=o._toolTypes[t.command]);var r=dojo.getObject(i);if(r){var s=new r(o.app,t);n.push(s),e&&o.register(s)}else o.app.trace.warning("Could not create tool '{0}' from type name '{1}'.".format(t.name,i))}),n},t.prototype.registerToolTypeForCommand=function(t,e){this._toolTypes[t]=e},t}();e.ToolRegistry=n})}}});!function(){var markup1="<input type='color' value='#0000ff' data-binding='{@var: colorInput}'/>",markup2="<div class='filter-control'>    <div class='filter-control-search'>        <input class='search-field' type='text' data-binding='{@value: filterText}{placeholder: filterInputPlaceholder}' />        <div class='status-img' alt=' ' aria-hidden='true' data-binding='{@visible: showBusyIcon}'></div>        <button class='clear-button' data-binding='{@event-onclick: handleFilterTextClear}'></button>        <button class='filter-button' data-binding='{@event-onclick: handleFilterButtonClick}{@text: filterButtonText}'></button>    </div></div>",markup3="<div class='autocomplete-inner'>                      <label data-binding='{for: attached_controlId}' class=' form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control'>        \x3c!-- Textbox --\x3e        <div class='autocomplete-input'>            <div class='loader' data-binding='{@visible: isBusy}'></div>            <input type='text' data-binding='{@var: textElement}{@event-onkeyup: handleKeyEvent}{@event-onblur: handleInputBlurEvent}{@event-onclick: handleInputClickEvent}{@event-onfocus: handleInputFocusEvent}{@value: text}{@style-width: textboxWidth}{title: toolTip}{id: attached_controlId}{data-gcx-form-item: itemID}' />        </div>        \x3c!-- Dropdown --\x3e        <div class='autocomplete-menu' data-binding='{@var: dropDownContainerElement}{@visible: isDropDownOpen}{@style-minWidth: textboxWidth}{@event-onkeydown: handleDropdownKeyDown}{@event-onmousedown: handleDropdownFocusEvent}{@event-onfocus: handleDropdownFocusEvent}{@event-onblur: handleDropdownBlurEvent}'>            <ul class='list-menu' data-binding='{@var: dropDownListElement}{@visible: dataItems}{@source: dataItems}'>                <li class='list-menu-item' data-binding='{@template-for: dataItems}{@text: value}{@event-onclick: handleClickItem}'></li>            </ul>        </div>    </div></div>",markup4="<div class='checkbox-inner'>    <table>        <tr>            <td class='form-label left' data-binding='{@visible: attached_textOnLeft}'>                <label data-binding='{for: attached_controlId}{@text: attached_labelText}{title: toolTip}'></label>            </td>            <td>                <input type='checkbox' data-binding='{@value: checked}{id: attached_controlId}{title: toolTip}{data-gcx-form-item: itemID}' />            </td>            <td class='form-label left' data-binding='{@hidden: attached_textOnLeft}'>                <label data-binding='{for: attached_controlId}{@text: attached_labelText}{title: toolTip}'></label>            </td>        </tr>    </table></div>",markup5="<div class='inner'>    <label data-binding='{for: attached_controlId}' class=' form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control'>        <div class='loader' data-binding='{@visible: isBusy}'></div>        <select data-binding='{id: attached_controlId}{@source: dataItems}{@value: selected}{@event-onchange: handleSelectionChanged}{disabled: isBusy}{title: toolTip}{data-gcx-form-item: itemID}'>            <option data-binding='{@template-for: dataItems}{@text: display}{@attach: @context}'></option>        </select>    </div></div>",markup6="<div class='form-container' data-binding='{@visible: isVisible}{@class-form-horizontal: attached_isHorizontal}{data-gcx-form-item: itemID}'>    <p class='form-item form-desc' data-binding='{@visible: description}{innerHTML: description}'></p>    <div class='form label-left' data-binding='{style: attached_style}{@style-maxWidth: maxWidth}{@source: formItems}{@template: Mapping/infrastructure/ui/components/Forms/FormItemView.html}'></div>\x3c!-- here --\x3e</div>",markup7="<div class='inner'>    <label data-binding='{for: attached_controlId}' class=' form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control' data-binding='{data-gcx-form-item: itemID}'>        \x3c!-- The view codebehind will calculate a picker type to use. --\x3e        <div class='inline-block' data-binding='{@source: @context}{@template-selector: attached_pickerType}'>            \x3c!-- Ideal! Date and time pickers supported natively in the browser. --\x3e            <input class='date-time' data-binding='{id: attached_controlId}{@var: native_datetime_element}{@template-select: native_datetime}{title: toolTip}{@value: date}' type='datetime' />            \x3c!-- No date picker supported. Use jQuery if not on a touch device. --\x3e            <div class='date-picker-container' data-binding='{@template-select: jQuery}'>                <input data-binding='{id: attached_controlId}{@var: jQueryFormattedInput}{title: toolTip}{@event-onchange: handleJqueryDatePickerTextChanged}' type='text' class='hasDatepicker gcxDatepicker'/>                <input data-binding='{id: attached_controlId}{@var: jQueryPicker}' type='hidden' />                <button class='ui-datepicker-trigger' data-binding='{@event-onclick: handleJqueryDatePickerInitializeClick}{aria-label: @language-accessibility-datepicker-trigger-button-aria-label}'>...</button>            </div>            \x3c!-- Native date picker supported and no time picker needed. --\x3e            <input data-binding='{id: attached_controlId}{@var: native_datetime_element}{@template-select: native}{title: toolTip}{@value: date}' type='date' />            \x3c!-- Native date picker supported, but need jQuery for time picker. Non-touch device --\x3e            <div class='date-picker-container' data-binding='{@template-select: native_date_jQuery_time}{title: toolTip}'>                <input data-binding='{id: attached_controlId}{@value: date}' type='date' />                <input data-binding='{id: attached_controlId}{@var: jQueryFormattedInput}{title: toolTip}{@event-onchange: handleJqueryTimePickerTextChanged}' type='text' class='hasDatepicker gcxDatepicker'/>                <input data-binding='{id: attached_controlId}{@var: jQueryPicker}' type='hidden' />                <button class='ui-datepicker-trigger' data-binding='{@event-onclick: handleJqueryDatePickerInitializeClick}{aria-label: @language-accessibility-datepicker-trigger-button-aria-label}'>...</button>            </div>            \x3c!-- Native date picker supported, but need a time picker and we're on a touch device. --\x3e            <div class='datetime-select datetime-picker' data-binding='{@template-select: native_date_combo_time}{title: toolTip}'>                <span class='native-date-picker'>                    <input data-binding='{id: attached_controlId}{@var: native_datetime_element}{@value: date}' type='date' />                </span>                <span class='time-selectors'>                    <label class='time-select'>                        <span class='time-select-label' data-binding='{@text: @language-hours-abbr}'></span>                        <select data-binding='{id: attached_controlId}{@source: attached_hours}{@value: attached_hour}{@event-onchange: handleChangeComboBoxTimeWithNativeDate}{@var: select0}'>                            <option data-binding='{@template-for: attached_hours}{@attached-value: val}{@text: desc}'></option>                        </select>                    </label>                    <label class='time-select'>                        <span class='time-select-label' data-binding='{@text: @language-minutes-abbr}'></span>                        <select data-binding='{id: attached_controlId}{@source: attached_minutes}{@value: attached_minute}{@event-onchange: handleChangeComboBoxTimeWithNativeDate}{@var: select1}'>                            <option data-binding='{@template-for: attached_minutes}{@text: @context}{@attached-value: @context}'></option>                        </select>                    </label>                    <label class='time-select'>                        <span class='time-select-label' data-binding='{@text: @language-seconds-abbr}'></span>                        <select data-binding='{id: attached_controlId}{@source: attached_seconds}{@value: attached_second}{@event-onchange: handleChangeComboBoxTimeWithNativeDate}{@var: select2}'>                            <option data-binding='{@template-for: attached_seconds}{@text: @context}{@attached-value: @context}'></option>                        </select>                    </label>                </span>            </div>                        \x3c!-- Touch device, no date/time pickers supported natively. Need combo box date picker. --\x3e            <div class='datetime-select' data-binding='{@template-select: combos}{title: toolTip}'>                <select class='dp-yy' data-binding='{id: attached_controlId}{@source: attached_years}{@value: attached_year}{@event-onchange: handleChangeComboBoxTime}{@var: select3}'>                    <option data-binding='{@template-for: attached_years}{@text: @context}{@attached-value: @context}'></option>                </select>                <select class='dp-mm' data-binding='{@value: attached_month}{@event-onchange: handleChangeComboBoxTime}{@var: select4}'>                    <option value='0' data-binding='{@text: @language-months-0}'></option>                    <option value='1' data-binding='{@text: @language-months-1}'></option>                    <option value='2' data-binding='{@text: @language-months-2}'></option>                    <option value='3' data-binding='{@text: @language-months-3}'></option>                    <option value='4' data-binding='{@text: @language-months-4}'></option>                    <option value='5' data-binding='{@text: @language-months-5}'></option>                    <option value='6' data-binding='{@text: @language-months-6}'></option>                    <option value='7' data-binding='{@text: @language-months-7}'></option>                    <option value='8' data-binding='{@text: @language-months-8}'></option>                    <option value='9' data-binding='{@text: @language-months-9}'></option>                    <option value='10' data-binding='{@text: @language-months-10}'></option>                    <option value='11' data-binding='{@text: @language-months-11}'></option>                </select>                <select class='dp-dd' data-binding='{@source: attached_days}{@value: attached_day}{@event-onchange: handleChangeComboBoxTime}{@var: select5}'>                    <option data-binding='{@template-for: attached_days}{@text: @context}{@attached-value: @context}'></option>                </select>            </div>            \x3c!-- Need date and time picker using comboboxes. --\x3e            <div class='dp-tp-select' data-binding='{@template-select: combos_datetime}{title: toolTip}'>                <div class='datetime-select'>                    <select class='year-select' data-binding='{id: attached_controlId}{@source: attached_years}{@value: attached_year}{@event-onchange: handleChangeComboBoxTime}{@var: select6}'>                        <option data-binding='{@template-for: attached_years}{@text: @context}{@attached-value: @context}'></option>                    </select>                    <select class='month-select' data-binding='{id: attached_controlId}{@value: attached_month}{@event-onchange: handleChangeComboBoxTime}{@var: select7}'>                        <option value='0' data-binding='{@text: @language-months-0}'></option>                        <option value='1' data-binding='{@text: @language-months-1}'></option>                        <option value='2' data-binding='{@text: @language-months-2}'></option>                        <option value='3' data-binding='{@text: @language-months-3}'></option>                        <option value='4' data-binding='{@text: @language-months-4}'></option>                        <option value='5' data-binding='{@text: @language-months-5}'></option>                        <option value='6' data-binding='{@text: @language-months-6}'></option>                        <option value='7' data-binding='{@text: @language-months-7}'></option>                        <option value='8' data-binding='{@text: @language-months-8}'></option>                        <option value='9' data-binding='{@text: @language-months-9}'></option>                        <option value='10' data-binding='{@text: @language-months-10}'></option>                        <option value='11' data-binding='{@text: @language-months-11}'></option>                    </select>                    <select class='day-select' data-binding='{@source: attached_days}{@value: attached_day}{@event-onchange: handleChangeComboBoxTime}{@var: select8}'>                        <option data-binding='{@template-for: attached_days}{@text: @context}{@attached-value: @context}'></option>                    </select>                </div>                <div class='datetime-select time'>                    <label class='time-select'>                        <span class='time-select-label' data-binding='{@text: @language-hours-abbr}'></span>                        <select data-binding='{id: attached_controlId}{@source: attached_hours}{@value: attached_hour}{@event-onchange: handleChangeComboBoxTime}{@var: select9}'>                            <option data-binding='{@template-for: attached_hours}{@attached-value: val}{@text: desc}'></option>                        </select>                    </label>                    <label class='time-select'>                        <span class='time-select-label' data-binding='{@text: @language-minutes-abbr}'></span>                        <select data-binding='{@source: attached_minutes}{@value: attached_minute}{@event-onchange: handleChangeComboBoxTime}{@var: select10}'>                            <option data-binding='{@template-for: attached_minutes}{@text: @context}{@attached-value: @context}'></option>                        </select>                    </label>                    <label class='time-select'>                        <span class='time-select-label' data-binding='{@text: @language-seconds-abbr}'></span>                        <select data-binding='{@source: attached_seconds}{@value: attached_second}{@event-onchange: handleChangeComboBoxTime}{@var: select11}'>                            <option data-binding='{@template-for: attached_seconds}{@text: @context}{@attached-value: @context}'></option>                        </select>                    </label>                </div>            </div>        </div>                <div class='inline-block' data-binding='{@visible: nullable}'>            <button class='datetime-btn un-nullify' data-binding='{@visible: attached_isNull}{@event-onclick: handleClickSetNotNull}'></button>            <button class='datetime-btn nullify' data-binding='{@hidden: attached_isNull}{@event-onclick: handleClickSetNull}'></button>        </div>    </div></div>",markup8="<div class='inner'>    <label data-binding='{for: attached_controlId}' class='form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control'>        <div data-binding='{@visible: isSupported}'>            <div class='file-input'>                <div class='file-input-browser'>                    <input type='file' data-binding='{id: attached_controlId}{@visible: isSupported}{title: toolTip}{multiple: allowMultiple}{accept: acceptFileTypes}{@event-change: handleChange}{data-gcx-form-item: itemID}' />                </div>            </div>            <input class='file-input-clear' type='button' value='X' data-binding='{@visible: files}{@event-onclick: handleClearClick}' />        </div>        <span data-binding='{@hidden: isSupported}{@text: @language-file-picker-not-supported}'></span>    </div></div>",markup9="<div class='form-item' data-binding='{@visible: isVisible}{className: attached_indicatorClass}{@source: @context}{@template-selector: formItemType}'>    <div class='autocomplete' data-binding='{@template-select: AutoCompleteBoxFormItem}{@widget: AutoCompleteBoxFormItem}{@visible: isVisible}'></div>    <div class='checkbox' data-binding='{@template-select: CheckBoxFormItem}{@widget: CheckBoxFormItem}{@visible: isVisible}'></div>    <div class='combobox' data-binding='{@template-select: ComboBoxFormItem}{@widget: ComboBoxFormItem}{@visible: isVisible}'></div>    <div class='container' data-binding='{@template-select: ContainerFormItem}{@widget: ContainerFormItem}{@visible: isVisible}'></div>    <div class='datepicker' data-binding='{@template-select: DatePickerFormItem}{@widget: DatePickerFormItem}{@visible: isVisible}'></div>    <div class='filepicker' data-binding='{@template-select: FilePickerFormItem}{@widget: FilePickerFormItem}{@visible: isVisible}'></div>    <div class='groupbox' data-binding='{@template-select: GroupBoxFormItem}{@widget: GroupBoxFormItem}{@visible: isVisible}'></div>    <div class='link' data-binding='{@template-select: HyperlinkFormItem}{@widget: HyperlinkFormItem}{@visible: isVisible}'></div>    <div class='image' data-binding='{@template-select: ImageFormItem}{@widget: ImageFormItem}{@visible: isVisible}'></div>    <div class='label' data-binding='{@template-select: LabelFormItem}{@widget: LabelFormItem}{@visible: isVisible}'></div>    <div class='listbox' data-binding='{@template-select: ListBoxFormItem}{@widget: ListBoxFormItem}{@visible: isVisible}'></div>    <div class='markdown' data-binding='{@template-select: MarkdownFormItem}{@widget: MarkdownFormItem}{@visible: isVisible}'></div>    <div class='radiobtn' data-binding='{@template-select: RadioButtonFormItem}{@widget: RadioButtonFormItem}{@visible: isVisible}'></div>    <div class='textarea' data-binding='{@template-select: TextAreaFormItem}{@widget: TextAreaFormItem}{@visible: isVisible}'></div>    <div class='textbox' data-binding='{@template-select: TextBoxFormItem}{@widget: TextBoxFormItem}{@visible: isVisible}'></div>    <div class='textarea' data-binding='{@template-select: TimePickerFormItem}{@widget: TimePickerFormItem}{@visible: isVisible}'></div></div>",markup10="<fieldset data-binding='{data-gcx-form-item: itemID}'>    <legend data-binding='{@text: header}'></legend>    <p class='form-item form-desc' data-binding='{@visible: description}{innerHTML: description}'></p>    \x3c!-- Dynamically bound table of elements --\x3e    <div class='form label-left' data-binding='{style: attached_style}{@class-form-horizontal: attached_isHorizontal}{@source: formItems}{@template: Mapping/infrastructure/ui/components/Forms/FormItemView.html}'></div></fieldset>",markup11="<div class='hyperlink'>    <a data-binding='{@event-onclick: handleClick}{href: uri}{@text: hyperlinkText}{target:target}{title: toolTip}{data-gcx-form-item: itemID}'></a></div>",markup12="<div class='inner'>    <img data-binding='{src: source}{@style-width: width}{@style-height: height}{alt: toolTip}{data-gcx-form-item: itemID}' /></div>",markup13="<div class='inner'>    <label data-binding='{for: attached_controlId}' class='form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control'>        <div class='loader' data-binding='{@visible: isBusy}'></div>        <select data-binding='{id: attached_controlId}{@source: dataItems}{@var: selectElement}{multiple: attached_isMultiple}{@value: selection}{@event-onchange: handleSelectionChanged}{title: toolTip}{disabled: isBusy}{size: size}{data-gcx-form-item: itemID}'>            <option data-binding='{@template-for: dataItems}{@text: display}{@attach: @context}'></option>        </select>    </div></div>",markup14="<div class='inner' data-binding='{@var: markdownElement}{data-gcx-form-item: itemID}'></div>",markup15="<div class='radiobtn-inner'>    <table>        <tr>            <td class='form-label left' data-binding='{@visible: attached_textOnLeft}'>                <label data-binding='{for: attached_controlId}{@text: attached_labelText}{title: toolTip}'></label>            </td>            <td>                <input type='radio' data-binding='{@var: radioElement}{id: attached_controlId}{name: groupName}{title: toolTip}{data-gcx-form-item: itemID}' />            </td>            <td class='form-label right' data-binding='{@hidden: attached_textOnLeft}'>                <label data-binding='{for: attached_controlId}{@text: attached_labelText}{title: toolTip}'></label>            </td>        </tr>    </table></div>",markup16="<div class='inner'>    <label data-binding='{for: attached_controlId}' class='form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control'>        <textarea data-binding='{id: attached_controlId}{@value: text}{@style-width: textboxWidth}{@style-height: textboxHeight}{title: toolTip}{@event-onblur: handleBlurControl}{readonly: readOnly}{data-gcx-form-item: itemID}'></textarea>    </div></div>",markup17="<div class='inner'>    <label data-binding='{for: attached_controlId}' class='form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='form-control'>        <input data-binding='{id: attached_controlId}{type: attached_type}{@value: text}{@style-width: textboxWidth}{title: toolTip}{readonly: readOnly}{data-gcx-form-item: itemID}' />    </div></div>",markup18="<div class='form-item time-picker'>    <label data-binding='{for: attached_controlId}' class='form-label'>        <span data-binding='{@source: label}{@visible: label}'>            <span data-binding='{@template-for: label}{@text: text}'></span>        </span>        <span class='indicator' data-binding='{@visible: attached_showIndicator}'>*</span>    </label>    <div class='datetime-select inline-block' data-binding='{title: toolTip}{@var: selectContainerElement}{data-gcx-form-item: itemID}'>        <div>            <select data-binding='{id: attached_controlId}{@source: attached_hours}{@value: attached_hour}{@event-onchange: handleChangeComboBoxTime}'>                <option data-binding='{@template-for: attached_hours}{@attached-value: val}{@text: desc}'></option>            </select>            <select data-binding='{@source: attached_minutes}{@value: attached_minute}{@event-onchange: handleChangeComboBoxTime}'>                <option data-binding='{@template-for: attached_minutes}{@text: @context}{@attached-value: @context}'></option>            </select>            <select data-binding='{@source: attached_seconds}{@value: attached_second}{@event-onchange: handleChangeComboBoxTime}'>                <option data-binding='{@template-for: attached_seconds}{@text: @context}{@attached-value: @context}'></option>            </select>        </div>        <div class='inline-block' data-binding='{@visible: nullable}'>            <button class='datetime-btn un-nullify' data-binding='{@visible: attached_timeIsNull}{@event-onclick: handleClickSetNotNull}'></button>            <button class='datetime-btn nullify' data-binding='{@hidden: attached_timeIsNull}{@event-onclick: handleClickSetNull}'></button>        </div>    </div>    <div class='clear'></div></div>",markup19="<span data-binding='{@source: range}{@visible: showSlider}' class='gcx-slider-width'>    <input type='number' data-binding='{@template-for: range}{@var: numericInput}{min: min}{max: max}{value: value}{step: step}' /></span><span class='inline-block' data-binding='{@source: range}'>    <input type='number' data-binding='{@template-for: range}{@var: nativeInput}{min: min}{max: max}{@value: value}{step: step}{@event-onchange: validateInput}' /></span>",markup20="<div class='paging-control' data-binding='{@source: presentableResults}'>    <div class='paging-control-inner' data-binding='{@template-for: presentableResults}'>        <div class='paging-result-info'>            <span data-binding='{@hidden: numberOfItems}{@text: @language-common-no-results}'></span>            <span data-binding='{@visible: numberOfItems}'>                <span data-binding='{@text: @language-page-displaying}'></span>&nbsp;<span data-binding='{@text: currIndexStartFromOne}'></span>&nbsp;-&nbsp;<span data-binding='{@text: currIndexEnd}'></span>&nbsp;(<span data-binding='{@text: @language-page-total}'></span>:&nbsp;<span data-binding='{@text: numberOfItems}'></span>)            </span>        </div>        <div class='paging-buttons' data-binding='{@visible: numberOfItems}'>            <button class='first' data-binding='{@event-onclick: handlePageFirst}{title: @language-page-first}'><img src='Resources/Images/Icons/paging-control-first-44.png' alt=' ' /></button>            <button class='prev' data-binding='{@event-onclick: handlePagePrev}{title: @language-page-prev}'><img src='Resources/Images/Icons/paging-control-previous-44.png' alt=' ' /></button>            <span class='paging-buttons-info' tabindex='0'>                <span data-binding='{@text: @language-page-page}'></span>&nbsp;<span data-binding='{@text: currPageNumber}'></span>&nbsp;<span data-binding='{@text: @language-page-of}'></span>&nbsp;<span data-binding='{@text: lastPageNumber}'></span>            </span>            <button class='next' data-binding='{@event-onclick: handlePageNext}{title: @language-page-next}'><img src='Resources/Images/Icons/paging-control-next-44.png' alt=' ' /></button>            <button class='last' data-binding='{@event-onclick: handlePageLast}{title: @language-page-last}'><img src='Resources/Images/Icons/paging-control-last-44.png' alt=' ' /></button>        </div>    </div></div>",markup21="<div class='gcx-slider-container'>    <div class='gcx-slider-current-label-container'>        <div class='gcx-slider-label gcx-slider-label-current-min' data-binding='{@visible: sliderMinHandleLabel}{@var: sliderMinLabelElement}{@text: sliderMinHandleLabel}'></div>        <div class='gcx-slider-label gcx-slider-label-current-max' data-binding='{@visible: sliderMaxHandleLabel}{@var: sliderMaxLabelElement}{@text: sliderMaxHandleLabel}'></div>    </div>    <div class='gcx-slider-range-container'>        <div class='gcx-slider-ticks' data-binding='{@source: sliderTicks}'>            <div class='gcx-tick' data-binding='{@template-for: sliderTicks}{@style-left: position}'></div>        </div>        <div class='gcx-slider' data-binding='{@var: sliderElement}'></div>    </div>    <div class='gcx-slider-label-container'>        <span class='gcx-slider-label gcx-slider-label-min' data-binding='{@text: sliderMinLabel}'></span>        <span class='gcx-slider-label gcx-slider-label-max' data-binding='{@text: sliderMaxLabel}'></span>    </div></div>",markup22="<div class='view-container-view smart-panel' data-binding='{@var: containerElement}'>    \x3c!-- BEGIN: Header --\x3e    <button class='bottom-panel-resize resize-handle' tabindex='-1' data-binding='{@visible: resizeY}{@event-mousedown: handleHeaderMouseDown}{@event-touchstart: handleHeaderTouchStart}{title: @language-smart-panel-resize}'>        <span class='icon-drag'></span>    </button>    <div class='panel-header banner-noselect'  data-binding='{@visible: headerIsVisible}{@var: headerElement}{@event-mousedown: handleHeaderMouseDown}                                                                {@event-touchstart: handleHeaderTouchStart}{@class-resize-horizontal-hint: resizeX}                                                                {@class-resize-vertical-hint: resizeY}'>        <div class='panel-header-contents' data-binding='{@visible: titleBarIsVisible}'>            <button class='panel-header-button right close-16' data-binding='{@visible: showingXButton}{@event-onclick: handleClickClose}{title: @language-smart-panel-close}'></button>            <button class='panel-header-button right' data-binding='{@visible: showingMaximizeButton}{@class-minimize-16: panelMaximized}{@noclass-maximize-16: panelMaximized}{@event-onclick: handleMaximizeToggleClick}{title: @language-smart-panel-maximize-restore}'></button>            <button class='panel-header-button menu-button' data-binding='{@enabled: hasExecutableMenuItems}{@visible: hasHoistedMenu}{@event-onclick: handleTapMenuButton}{@var: menuButtonElement}{title: @language-smart-panel-menu}'></button>            <button class='panel-header-button left back-16' data-binding='{@visible: showingBackButton}{@event-click: handleClickBack}{title: @language-smart-panel-back}'></button>            <h2 class='panel-title banner-noselect'>                <img src='Resources/Images/loader-small.gif' data-binding='{@visible: showBusyIndicator}' alt=' ' />                <span class='panel-title-contents' data-binding='{@text: containerTitle}{@visible: containerTitle}'></span>                <span class='panel-title-contents' data-binding='{@visible: containerTitle}'>&nbsp;-&nbsp;</span>                <span class='panel-title-contents' data-binding='{@text: viewTitle}{@visible: viewTitle}{title: viewTitle}'></span>            </h2>        </div>        <div class='smart-panel-hoisted-menu-inline' data-binding='{@visible: inlineMenuIsOpen}{@widget: SmartPanelHoistedMenu}{@widget-required: false}{@widget-context: hoistedMenuViewModel}'></div>        <div data-binding='{@dom: headerInsertDomElement}'></div>    </div>    \x3c!-- END: Header --\x3e    \x3c!-- BEGIN: Optional status messages --\x3e    <div class='region panel-status-region' data-binding='{@var: statusRegionElement}'></div>    \x3c!-- END: Optional status messages --\x3e    \x3c!-- BEGIN: Content region --\x3e    <div class='panel-scroll-container' data-binding='{data-region-name: regionName}{data-region-adapter: regionType}{@var: scrollRegionElement}{@event-onscroll: handleScrollChange}' tabindex='-1'></div>    \x3c!-- END: Content region --\x3e    \x3c!-- BEGIN: Optional footer content --\x3e    <div class='panel-footer' data-binding='{@var: footerElement}{@visible: footerInsertDomElement}' style='position: absolute'>        <div class='panel-footer-inner' data-binding='{@dom: footerInsertDomElement}'></div>    </div>    \x3c!-- END: Optional header content --\x3e</div>",markup23="<div class='results-table' data-binding='{@var: tableContainerElement}'>    <table>        <thead>            <tr data-binding='{@source: columnHeaders}'>                <th data-binding='{@template-for: columnHeaders}{@visible: visible}{@event-onclick: handleColumnHeadClick}' scope='col'>                    <button data-binding='{aria-label: columnDescriptor}'>                        <span data-binding='{class: sortClass}{title: @language-results-sort}'></span>                        <span class='result-heading' data-binding='{@text: presentableValue}'></span>                    </button>                </th>            </tr>        </thead>        <tbody data-binding='{@source: records}'>            <tr class='results-table-row-item' data-binding='{@template-for: records}                                    {@source: attributes}                                    {@event-mousedown: handleMouseDown}                                    {@event-mouseup: handleMouseUp}                                    {@event-touchstart: handleTouchStart}                                    {@event-touchmove: handleTouchMove}                                    {@event-touchend: handleTouchEnd}                                    {@event-click: handleClick}                                    {@event-mouseenter: handleMouseOver}                                    {@event-mouseleave: handleMouseOut}'>                <td data-binding='{@template-for: attributes}{@visible: visible}'>                    <a data-binding='{@visible: displayAsUrl}{@event-onclick: handleClickAttributelink}{href: value}{@text: presentableValue}' target='_blank'></a>                    <button data-binding='{@hidden: displayAsUrl}{@text: presentableValue}' tabindex='0'></button>                </td>            </tr>        </tbody>    </table></div>";require({cache:{"geocortex/infrastructure/ui/components/ProviderConfiguration":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/ColorPicker/ColorPickerProviderBase":function(){define(["require","exports","./../../../symbology/SymbolColor"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.color=new i.SymbolColor("#000000"),this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){throw new Error("Not implemented")},e.prototype.setColor=function(e){throw new Error("Not implemented")},e}();t.ColorPickerProviderBase=n})},"geocortex/infrastructure/ui/components/ColorPicker/ColorPickerViewModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/ColorPicker/ColorPickerWidget":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.added=function(){this.initialize(this.configuration)},i.prototype.initialize=function(e){var t;(t=dojo.getObject(e.provider))?(this.provider=new t(this.app,this.libraryId),this.provider.initialize(this),this.bindingToken=this.viewModel.color.bind(this.provider,this.provider.setColor)):this.app.trace.error("{0} can't find color picker provider typed {1}".format(this.id,e.provider))},i.prototype.updateColor=function(e){this.viewModel.color.set(e)},i}(n.ViewBase);i.ColorPickerWidget=a})},"geocortex/infrastructure/ui/components/ColorPicker/KendoColorPickerProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../../../symbology/SymbolColor","./ColorPickerProviderBase"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.initialize=function(e){this.widget=e},i.prototype.instantiate=function(){this.colorpicker=$(this.widget.colorInput).kendoColorPicker({buttons:!1,opacity:!0,preview:!0,select:this.updateColor.bind(this)}).data("kendoColorPicker"),this.colorpicker&&this.colorpicker.value(this.color.toRGBAString())},i.prototype.setColor=function(e){this.color=e,this.colorpicker?this.colorpicker.value(e.toRGBAString()):this.instantiate()},i.prototype.updateColor=function(e){this.color=new n.SymbolColor(e.value),this.widget.updateColor(this.color)},i}(a.ColorPickerProviderBase);i.KendoColorPickerProvider=o})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlComponent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._filterableItems=[],this._currentQuery="",t?(this.app=e,this.filterControlId=t,this.app.command("ApplyFilterControlQuery").register(this,this._applyFilterControlQueryImpl)):this.app.trace.error("FilterControlViewModel: Failed to initialize. Filter Control Id must be specified.")}return e.prototype.registerFilterableItem=function(e,t){if(e){var i={};i.filterData=t&&t.length?t:null,i.filterQuery=null,i.item=e,i.queryMatched=!0,this._filterableItems.push(i)}else this.app.trace.error("FilterControlViewModel: No item to register. Could not add to {0} filter.".format(this.filterControlId))},e.prototype.removeRegisteredItem=function(e){var t=this._filterableItems.filter(function(t){return t.item===e})[0],i=this._filterableItems.indexOf(t);return!(!t||i<0)&&(this._filterableItems.splice(i,1),!0)},e.prototype.clear=function(){this._filterableItems.length=0},e.prototype.getFilterableItem=function(e){var t=this._filterableItems.filter(function(t){return t.item===e})[0];return t||null},e.prototype.setFilterData=function(e,t){var i=this.getFilterableItem(e);i?i.filterData=t:this.app.trace.error("FilterControlViewModel: Could not update filter data for {0} filter.".format(this.filterControlId))},e.prototype.queryMatched=function(e){var t=this._filterableItems.filter(function(t){return t.item===e})[0];return!(!t||!t.queryMatched)},e.prototype.filter=function(e,t){if(e){var i=!0;return t&&e.filterData&&e.filterData.length&&(i=e.filterData.some(function(e){return!!e&&-1!==e.toLowerCase().indexOf(t.toLowerCase())})),i}this.app.trace.error("FilterControlViewModel: Filterable Item Info not provided.")},e.prototype.applyQuery=function(e){var t=this,i=!1;if(this._currentQuery!==e){this._currentQuery=e;var n={filterControlId:this.filterControlId,query:this._currentQuery};this.app.event("FilterControlQueryChangedEvent").publish(n)}if(this._filterableItems.forEach(function(n){var a=t.filter(n,e);i=!1===i?n.queryMatched!==a:i,n.filterQuery=e,n.queryMatched=a}),i){var a={filterControlId:this.filterControlId,filterableItems:this._filterableItems};this.app.event("FilterControlResultChangedEvent").publish(a)}},e.prototype._applyFilterControlQueryImpl=function(e){e.filterControlId===this.filterControlId&&e.query!==this._currentQuery&&this.applyQuery(e.query)},e}();t.FilterControlComponent=i})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlItemInfo":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlViewBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.handleFilterTextClear=function(e,t,i){throw new Error("Not Implemented. Please extend this class to implement.")},i.prototype.handleFilterButtonClick=function(e,t,i){throw new Error("Not Implemented. Please extend this class to implement.")},i}(n.ViewBase);i.FilterControlViewBase=a})},"geocortex/infrastructure/ui/components/FilterControl/FilterControlViewModelBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i,n){var o=t.call(this,e,i)||this;return o.filterText=new a.Observable(""),o.showBusyIcon=new a.Observable(!1),o.filterInputPlaceholder=new a.Observable(""),o.filterButtonText=new a.Observable(""),o._filterTextSettleDelayMs=600,o._filterTextTimeoutToken=null,o.filterText.bind(o,o._processFilterTextChanged),n&&(o._filterControlComponent=n),o}return e(i,t),i.prototype.setFilterControlComponent=function(e){return!!e&&(this._filterControlComponent=e,this.app.event("FilterControlQueryChangedEvent").subscribe(this,this._handleFilterQueryChangedEvent),!0)},i.prototype.getFilterControlComponent=function(){return this._filterControlComponent},i.prototype.handleFilterTextInput=function(e){return!!this._filterControlComponent&&(this._filterControlComponent.applyQuery(e),!0)},i.prototype._processFilterTextChanged=function(e){var t=this;this.showBusyIcon.set(!0),this._filterTextTimeoutToken&&clearTimeout(this._filterTextTimeoutToken),this._filterTextTimeoutToken=setTimeout(function(){t.handleFilterTextInput(e),t.showBusyIcon.set(!1)},this._filterTextSettleDelayMs)},i.prototype._handleFilterQueryChangedEvent=function(e){var t=this._filterControlComponent;t&&e.filterControlId===t.filterControlId&&this.filterText.get()!==e.query&&this.filterText.set(e.query)},i}(n.ViewModelBase);i.FilterControlViewModelBase=o})},"geocortex/infrastructure/ui/components/Forms/AutoCompleteBoxFormItemView":function(){var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils","./FormsUtils"],function(require,exports,FormItemViewBase_1,observables_1,utils_1,FormsUtils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AutoCompleteBoxFormItemView=function(_super){function AutoCompleteBoxFormItemView(e,t){var i=_super.call(this,e,t)||this;return i.textElement=null,i.dropDownContainerElement=null,i.dropDownListElement=null,i.timer=null,i.positionIndex=null,i.lastKeyEvent=null,i.keyTraverseInterval=null,i.closeTimer=null,i._queryCancelled=!1,i._searchFocus=!1,i.isBusy=new observables_1.Observable(!1),i.positionIndex=0,i.keyTraverseInterval=25,i}return __extends(AutoCompleteBoxFormItemView,_super),AutoCompleteBoxFormItemView.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.isDropDownOpen=new observables_1.Observable(!1),e.attached_controlId=new observables_1.Observable("textbox-{0}".format(utils_1.alphaNumericToken())),e.queryTaskRunner&&(e.queryTaskRunner.formatCallback=FormsUtils_1.FormsUtils.formatListItem),_super.prototype.attach.call(this,e),this.lastKeyEvent=(new Date).getTime(),this.addDisposableBinding(this.viewModel.dataItems,this.viewModel.dataItems.bind(this,function(e){if(this.isBusy.set(!1),this.viewModel.dataItems.getLength()>0){if(this.positionIndex=0,this._queryCancelled)return;this.openDropDown()}else this.closeDropDown()}))},AutoCompleteBoxFormItemView.prototype.handleInputBlurEvent=function(e,t,i){var n=this;this.isBusy.set(!1),this._searchFocus=!1,this.closeTimer=setTimeout(function(){n._searchFocus||(n._queryCancelled=!0,n.viewModel.queryTaskRunner.triggerCascading(i.text.get()),n.closeDropDown())},750)},AutoCompleteBoxFormItemView.prototype.handleInputClickEvent=function(e,t,i){t.focus()},AutoCompleteBoxFormItemView.prototype.handleInputFocusEvent=function(e,t,i){this._queryCancelled=!1,this._searchFocus=!0},AutoCompleteBoxFormItemView.prototype.handleDropdownFocusEvent=function(e,t,i){var n=this;return setTimeout(function(){n._searchFocus=!0},100),null!=this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null),!0},AutoCompleteBoxFormItemView.prototype.handleDropdownBlurEvent=function(e,t,i){return this.closeDropDown(),!0},AutoCompleteBoxFormItemView.prototype.handleClickItem=function(e,t,i){this.viewModel.text.set(i.display),this.viewModel.queryTaskRunner.triggerCascading(i.display),this.closeDropDown()},AutoCompleteBoxFormItemView.prototype.openDropDown=function(){eval('geocortex.essentialsHtmlViewer["___userInAutoComplete"] = true'),this.viewModel.isDropDownOpen.set(!0),this.positionIndex=-1,$(this.dropDownContainerElement).removeClass("inactive").addClass("active")},AutoCompleteBoxFormItemView.prototype.closeDropDown=function(){eval('geocortex.essentialsHtmlViewer["___userInAutoComplete"] = false'),this.viewModel.isDropDownOpen.set(!1),$(this.dropDownContainerElement).removeClass("active").addClass("inactive")},AutoCompleteBoxFormItemView.prototype.setDropDownPosition=function(e){e=Math.min(e,this.viewModel.dataItems.getLength()-1),dojo.removeClass(this.dropDownListElement,"autocomplete-highlight"),this.positionIndex=Math.max(0,e);var t=$("li",this.dropDownListElement).eq(this.positionIndex);$(t).addClass("autocomplete-highlight");var i=this.viewModel.dataItems.getAt(this.positionIndex);i&&this.viewModel.text.set(i.display),t.length>0&&$(this.dropDownContainerElement).scrollTop($(this.dropDownContainerElement).scrollTop()+$(t).position().top-$(this.dropDownContainerElement).height()/2+$(t).height()/2)},AutoCompleteBoxFormItemView.prototype.handleDropdownKeyDown=function(e,t,i){return 13!==e.which||this.handleKeyEvent(e,t,i)},AutoCompleteBoxFormItemView.prototype.handleKeyEvent=function(e,t,i){var n=(new Date).getTime();if(n-this.lastKeyEvent>this.keyTraverseInterval)if(this.lastKeyEvent=n,38===e.which||40===e.which)this.viewModel.isDropDownOpen.get()&&(40===e.which?this.setDropDownPosition(this.positionIndex+1):38===e.which&&this.setDropDownPosition(this.positionIndex-1));else{if(this.viewModel.isDropDownOpen.get()&&13===e.which){var a=this.viewModel.dataItems.getAt(this.positionIndex);return a&&(this.viewModel.text.set(a.display),this.viewModel.queryTaskRunner.triggerCascading(a.display)),this.closeDropDown(),null!=this.timer&&clearInterval(this.timer),!1}if(this.viewModel.isDropDownOpen.get()&&8===e.which)return this.closeDropDown(),this.viewModel.queryTaskRunner.triggerCascading(null),8==e.which&&this.trigger(),!1;if(9===e.which||37===e.which||39===e.which)return!0;if(13===e.which)return this.viewModel.queryTaskRunner.triggerCascading(i.display),!1;this.trigger()}return!0},AutoCompleteBoxFormItemView.prototype.trigger=function(){var e=this;null!=this.timer&&clearInterval(this.timer),this.textElement.value.length>=this.viewModel.minimumPrefixLength.get()&&(this.timer=setTimeout(function(){e.filter(!1)},this.viewModel.minimumPopulateDelay.get()))},AutoCompleteBoxFormItemView.prototype.filter=function(e){null!=this.timer&&(clearInterval(this.timer),this.timer=null),this.closeDropDown(),this.viewModel.queryTaskRunner.performQuery(this.textElement.value,e)},AutoCompleteBoxFormItemView}(FormItemViewBase_1.FormItemViewBase);exports.AutoCompleteBoxFormItemView=AutoCompleteBoxFormItemView})},"geocortex/infrastructure/ui/components/Forms/CheckBoxFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.attached_textOnLeft=new a.Observable(!1),this.addDisposableBinding(e.textLocation,e.textLocation.bind(this,function(t){e.attached_textOnLeft.set("left"===t.toLowerCase())})),e.textLocation.pulse(),e.attached_controlId=new a.Observable("checkbox-{0}".format(o.alphaNumericToken())),e.attached_labelText=null!=e.text?new a.Observable(e.text.get()):"",t.prototype.attach.call(this,e)},i}(n.FormItemViewBase);i.CheckBoxFormItemView=r})},"geocortex/infrastructure/ui/components/Forms/ContainerFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","./FormsUtils","../../../FilterUtils","geocortex/framework/events/ViewDimensionsChangedArgs"],function(t,i,n,a,o,r,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var l=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.attached_style=new a.Observable(""),n.attached_isHorizontal=new a.Observable(!1),n}return e(i,t),i.prototype.attach=function(e){var i=this;if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));if(e.attached_style=this.attached_style,e.attached_isHorizontal=this.attached_isHorizontal,e.hasOwnProperty("description")){o.FormsUtils.convertToHTMLSyntax(e.description);var n={allowFrames:!0,uriTransformer:function(e){return e}};e.description.set(r.sanitize(e.description.get(),n))}var a=this.configuration&&void 0!==this.configuration.allowHorizontal;this.auto(e.orientation,this,function(t){var n="Horizontal"===e.orientation.get();i.attached_style.set(void 0),i.attached_isHorizontal.set(n&&a)}),e.orientation.pulse(),this._attachVisibilityControls(e),t.prototype.attach.call(this,e)},i.prototype._attachVisibilityControls=function(e){var t=this;if(!e)throw new Error("A view model must be specified to attach to.");if(e.visibleControlID.get()){var i=e.formDefinition.getFormItemById(e.visibleControlID.get());i&&(e.applyVisibility(i),this.resultChangeSubscription||(this.resultChangeSubscription=dojo.subscribe("FormItemResultChangedEvent",function(n){if(n===i){var a=e.isVisible.get();if(e.applyVisibility(i),a!==e.isVisible.get()){var o=t.app.viewManager.getRegionForViewId(t.id);t.app.event("ViewDimensionsChangedEvent").publish(new s.ViewDimensionsChangedArgs(t,o));var r=e.getDisplayName(),l="language-accessibility-form-{0}-container-{1}".format(r?"named":"unnamed",a?"hidden":"shown"),d=t.app.getResource(t.libraryId,l).format(r);t.app.command("ScreenReaderNarrate").execute(d)}}})))}},i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.resultChangeSubscription&&dojo.unsubscribe(this.resultChangeSubscription)},i}(n.FormItemViewBase);i.ContainerFormItemView=l})},"geocortex/infrastructure/ui/components/Forms/DatePickerFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./TimePickerFormItemView","geocortex/framework/observables","../../../DateFormat","geocortex/framework/utils/utils","../../../FormatUtils"],function(t,i,n,a,o,r,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var l=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.attached_pickerType=new a.Observable,e.attached_days=null,e.attached_months=null,e.attached_years=null,e.attached_day=null,e.attached_month=null,e.attached_year=null,e.selectElementCount=11,e._jQueryPickerInitialized=!1,e._lastClearedDate=null,e._daysPerMonth={0:31,1:28,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31},e._dateTimePickerType={comboPicker:"combos",comboDateTimePicker:"combos_datetime",nativePicker:"native",nativeDateTimePicker:"native_datetime",nativeDateComboTimePicker:"native_date_combo_time",jQueryPicker:"jQuery",nativeDateJQueryTimePicker:"native_date_jQuery_time"},e._dateFormat=o.DateFormat.DATE_TIME_SHORT,e}return e(i,t),i.prototype.attach=function(e){var i=this;if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.attached_controlId=new a.Observable("datepicker-{0}".format(r.alphaNumericToken())),e.attached_isNull=new a.Observable(!1),e.attached_isNull.syncTransform(e.date,function(e){return null==e});var n=navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Mobile Safari")>-1&&!(navigator.userAgent.indexOf("Chrome")>-1),o=navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Firefox")>-1,s=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/gi);!Modernizr||!Modernizr.inputtypes.date||navigator.userAgent.indexOf("Chrome")>-1||n||o?Modernizr.touch?!0===e.includeTimePicker.get()?this.attached_pickerType.set(this._dateTimePickerType.comboDateTimePicker):this.attached_pickerType.set(this._dateTimePickerType.comboPicker):this.attached_pickerType.set(this._dateTimePickerType.jQueryPicker):!0===e.includeTimePicker.get()?Modernizr.inputtypes.datetime&&!s?this.attached_pickerType.set(this._dateTimePickerType.nativeDateTimePicker):this.attached_pickerType.set(this._dateTimePickerType.nativeDateComboTimePicker):this.attached_pickerType.set(this._dateTimePickerType.nativePicker),e.attached_pickerType=this.attached_pickerType,this.viewModel=e,this.attached_days=new a.ObservableCollection([]),this.attached_months=new a.ObservableCollection([]),this.attached_years=new a.ObservableCollection([]),this.attached_day=new a.Observable(1),this.attached_month=new a.Observable(1),this.attached_year=new a.Observable(2e3),e.attached_days=this.attached_days,e.attached_months=this.attached_months,e.attached_years=this.attached_years,e.attached_day=this.attached_day,e.attached_month=this.attached_month,e.attached_year=this.attached_year,this._buildComboBoxes(e),setTimeout(function(){i.viewModel.date?i.setPickerDateTime(i.viewModel.date.get()):i.viewModel.time&&i.setPickerDateTime(i.viewModel.time.get())},1),e._dateTimePickerBindingToken&&e.date.unbind(e._dateTimePickerBindingToken),e._dateTimePickerBindingToken=e.date.bind(this,function(e){if(i.attached_pickerType.get()===i._dateTimePickerType.jQueryPicker){var t=$(i.jQueryPicker,i.root).datepicker("getDate");if(null===e||void 0===e)return void i.app.trace.warning("Date parameter is null.");if(t&&e.getTime()===t.getTime())return}i.setPickerDateTime(e)}),this._syncComboBoxes(),t.prototype.attach.call(this,e)},i.prototype._syncComboBoxes=function(){for(var e=[this.attached_day,this.attached_month,this.attached_year],t=0;t<e.length;++t)e[t].bind(this,dojo.hitch(this,this._calcTime))},i.prototype._isLeapYear=function(e){return e%400==0||e%100!=0&&e%4==0},i.prototype._calcTime=function(){var e=this.attached_month.get();if(null!=e){var t=this._daysPerMonth[e];if(1===e&&(t=29),this.attached_days.getLength()<t)for(var i=this.attached_days.getLength();i<t;++i)this.attached_days.addItem(i+1);else this.attached_days.removeRange(t)}},i.prototype.setPickerDateTime=function(e){if(t.prototype.setPickerDateTime.call(this,e),e)this.attached_day.set(e.getDate()),this.attached_month.set(e.getMonth()),this.attached_year.set(e.getFullYear());else{this.attached_day.set(null),this.attached_month.set(null),this.attached_year.set(null);for(var i=0;i<=this.selectElementCount;i++)this["select"+i]&&(this["select"+i].selectedIndex=-1)}this.native_datetime_element&&(this.native_datetime_element.valueAsDate=e),this.native_date_element&&(this.native_datetime_element.valueAsDate=e),this.attached_pickerType.get()!==this._dateTimePickerType.jQueryPicker&&this.attached_pickerType.get()!==this._dateTimePickerType.nativeDateJQueryTimePicker||(this._jQueryPickerInitialized&&$(this.jQueryPicker,this.root).datetimepicker("setDate",e),this._updatejQueryFormattedInput(e))},i.prototype.handleChangeComboBoxTime=function(){var e=this.viewModel.date.get();null!=this.attached_year.get()||null!=this.attached_month.get()||null!=this.attached_day.get()||this.viewModel.includeTimePicker.get()&&(null!=this.attached_hour.get()||null!=this.attached_minute.get()||null!=this.attached_second.get())?(e||(e=new Date,this.viewModel.includeTimePicker.get()||(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0))),null==this.attached_year.get()&&this.attached_year.set(e.getFullYear()),null==this.attached_month.get()&&this.attached_month.set(e.getMonth()),null==this.attached_day.get()&&this.attached_day.set(e.getDate()),e.setFullYear(this.attached_year.get()),e.setMonth(this.attached_month.get()),e.setDate(this.attached_day.get()),this.viewModel.includeTimePicker.get()&&(null==this.attached_hour.get()&&this.attached_hour.set(e.getHours()),null==this.attached_minute.get()&&this.attached_minute.set(e.getMinutes()),null==this.attached_second.get()&&this.attached_second.set(e.getSeconds()),e.setHours(this.attached_hour.get()),e.setMinutes(this.attached_minute.get()),e.setSeconds(this.attached_second.get()))):e=null,this.viewModel.date.set(e)},i.prototype.handleChangeComboBoxTimeWithNativeDate=function(){var e=this.viewModel.date.get();e||(e=new Date),null==this.attached_hour.get()&&this.attached_hour.set(e.getHours()),null==this.attached_minute.get()&&this.attached_minute.set(e.getMinutes()),null==this.attached_second.get()&&this.attached_second.set(e.getSeconds()),e.setHours(this.attached_hour.get()),e.setMinutes(this.attached_minute.get()),e.setSeconds(this.attached_second.get()),this.viewModel.date.set(e)},i.prototype._createjQueryPicker=function(){var e=this;i.localizedJqueryDatepicker||this._localizeJqueryDatepicker(),$(this.jQueryPicker,this.root).blur();var t={dateFormat:"yy-mm-dd",showOn:"button",changeYear:!0,yearRange:"c-50:c+50",onClose:function(t,i){e.disabled=!0,e.readOnly=!0},onChangeMonthYear:function(t,i,n){var a=n.selectedDay,o=null;if(e.viewModel.date.get())o=new Date(t,i-1,a,e.viewModel.date.get().getHours(),e.viewModel.date.get().getMinutes(),e.viewModel.date.get().getSeconds());else{var r=new Date;o=new Date(t,i-1,a,r.getHours(),r.getMinutes(),r.getSeconds())}e.viewModel.date.set(o)},beforeShow:function(t,i){e.disabled=!0,e.readOnly=!0,$(i.input).siblings(".ui-datepicker-trigger").attr("aria-label",e.getResource("language-accessibility-datepicker-trigger-button-aria-label"));var n=$(window).width(),a=n-$(i.input).siblings(".ui-datepicker-trigger").offset().left,o=parseFloat($(i.dpDiv).css("width")),r=0;r=!isNaN(a)&&!isNaN(o)&&o>a?$(e.jQueryFormattedInput,e.root).offset().left-(n-o):$(e.jQueryFormattedInput,e.root).offset().left-$(i.input).siblings(".ui-datepicker-trigger").offset().left,$(i.dpDiv).css("marginLeft",r)}};if(this.attached_pickerType.get()===this._dateTimePickerType.jQueryPicker?(t.onSelect=function(t,i){var n=$(e.jQueryPicker,e.root).datepicker("getDate");e.viewModel.date.set(n),e._updatejQueryFormattedInput(n)},this.viewModel.includeTimePicker.get()?("Long"===this.viewModel.dateFormat.get()?this._dateFormat=o.DateFormat.DATE_TIME_LONG:"Short"===this.viewModel.dateFormat.get()?this._dateFormat=o.DateFormat.DATE_TIME_SHORT:this.viewModel.dateFormat.get()?this._dateFormat=this.viewModel.dateFormat.get():this._dateFormat=o.DateFormat.DATE_TIME_SHORT,t.timeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?"HH:mm":"HH:mm:ss",t.gcxTimeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?o.DateFormat.TIME_SHORT:o.DateFormat.TIME_LONG,t.showSecond="LongTime"===this.viewModel.timePickerItem.timeFormat.get(),t.gcxTimeStyle=this.viewModel.timePickerItem.jQueryPickerTimeAsInfoMsg.get(),$(this.jQueryPicker,this.root).datetimepicker(t)):("Long"===this.viewModel.dateFormat.get()?this._dateFormat=o.DateFormat.DATE_LONG:"Short"===this.viewModel.dateFormat.get()?this._dateFormat=o.DateFormat.DATE_SHORT:this.viewModel.dateFormat.get()?this._dateFormat=this.viewModel.dateFormat.get():this._dateFormat=o.DateFormat.DATE_SHORT,t.hourMin=0,t.hourMax=0,t.minuteMin=0,t.minuteMax=0,t.showHour=!1,t.showMinute=!1,t.showTime=!1,t.timeFormat="",$(this.jQueryPicker,this.root).datetimepicker(t)),$(this.jQueryPicker,this.root).datetimepicker("setDate",this.viewModel.date.get()),this._jQueryPickerInitialized=!0):this.attached_pickerType.get()===this._dateTimePickerType.nativeDateJQueryTimePicker&&(this._dateFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?o.DateFormat.TIME_SHORT:o.DateFormat.TIME_LONG,t.timeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?"HH:mm":"HH:mm:ss",t.gcxTimeFormat="Short"===this.viewModel.timePickerItem.timeFormat.get()?o.DateFormat.TIME_SHORT:o.DateFormat.TIME_LONG,t.showSecond="LongTime"===this.viewModel.timePickerItem.timeFormat.get(),t.onSelect=function(t,i){var n=$(e.jQueryPicker,e.root).datepicker("getDate"),a=e.viewModel.date.get();a.setHours(n.getHours()),a.setMinutes(n.getMinutes()),a.setSeconds(n.getSeconds()),e.viewModel.date.set(a),e.setPickerDateTime(a)},$(this.jQueryPicker,this.root).timepicker(t),$(this.jQueryPicker,this.root).timepicker("setDate",this.viewModel.date.get()),this._jQueryPickerInitialized=!0),this._updatejQueryFormattedInput(this.viewModel.date.get()),$.datepicker._doKeyDown){var n=$(this.jQueryFormattedInput,this.root);n.data("datepicker",$(this.jQueryPicker,this.root).data("datepicker")),n.keydown($.datepicker._doKeyDown),n.keypress($.datepicker._doKeyPress),n.keyup($.datepicker._doKeyUp)}},i.prototype._updatejQueryFormattedInput=function(e){if(e){var t=s.formatDate(e,this._dateFormat);$(this.jQueryFormattedInput,this.root).val(t)}else $(this.jQueryFormattedInput,this.root).val("")},i.prototype._localizeJqueryDatepicker=function(){var e=this.getResource("datepicker.regional"),t=this.getResource("timepicker.regional");e&&$.datepicker.setDefaults(e),t&&$.timepicker.setDefaults(t),i.localizedJqueryDatepicker=!0},i.prototype._buildComboBoxes=function(e){t.prototype._buildComboBoxes.call(this,e);for(var i=[],n=1900;n<=2100;++n)i.push(n);this.attached_years.set(i);for(var a=[],o=0;o<12;++o){var r="language-months-{0}".format(o);a.push({value:o,name:this.app.getResource(this.libraryId,r)})}this.attached_months.set(a);for(var s=[],l=1;l<32;++l)s.push(l);this.attached_days.set(s)},i.prototype.handleClickSetNull=function(){this.viewModel.date.get()&&(this._lastClearedDate=this.viewModel.date.get()),this.viewModel.date.set(null),this.setPickerDateTime(null)},i.prototype.handleClickSetNotNull=function(){if(null!=this._lastClearedDate)this.viewModel.date.set(this._lastClearedDate),this.setPickerDateTime(this._lastClearedDate),this._lastClearedDate=null;else{var e=new Date;this.viewModel.date.set(e),this.setPickerDateTime(e)}},i.prototype.handleJqueryDatePickerTextChanged=function(e,t,i){var n="";if(n=e.currentTarget?e.currentTarget.value:e.target.value){var a,r=[this._dateFormat];this.viewModel.includeTimePicker.get()?r.concat([o.DateFormat.DATE_TIME_LONG,o.DateFormat.DATE_TIME_SHORT]):r.concat([o.DateFormat.DATE_LONG,o.DateFormat.DATE_SHORT]),a=s.parseDate(n,r),isNaN(a.getTime())&&(a=new Date),this.viewModel.date.get()&&a.getTime()==this.viewModel.date.get().getTime()||(this.viewModel.date.set(a),this.setPickerDateTime(a),this.handleChangeComboBoxTime())}},i.prototype.handleJqueryTimePickerTextChanged=function(e,t,i){var n="";if(n=e.currentTarget?e.currentTarget.value:e.target.value){var a=s.parseDate(n,[o.DateFormat.TIME_LONG,o.DateFormat.TIME_SHORT]);isNaN(a.getTime())&&(a=new Date);var r=this.viewModel.date.get();r||(r=new Date),r.setHours(a.getHours()),r.setMinutes(a.getMinutes()),r.setSeconds(a.getSeconds()),this.viewModel.date.set(r),this.setPickerDateTime(r)}},i.prototype.handleJqueryDatePickerInitializeClick=function(e,t,i){$(t).remove(),this._jQueryPickerInitialized||this._createjQueryPicker(),this.attached_pickerType.get()===this._dateTimePickerType.jQueryPicker?$(this.jQueryPicker,this.root).datetimepicker("show"):this.attached_pickerType.get()===this._dateTimePickerType.nativeDateJQueryTimePicker&&$(this.jQueryPicker,this.root).timepicker("show")},i}(n.TimePickerFormItemView);l.localizedJqueryDatepicker=!1,i.DatePickerFormItemView=l})},"geocortex/infrastructure/ui/components/Forms/FilePickerFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils","geocortex/forms/FileItem"],function(t,i,n,a,o,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.attached_controlId=new a.Observable("filepicker-{0}".format(o.alphaNumericToken())),t.prototype.attach.call(this,e)},i.prototype.handleChange=function(e,t,i){var n=this;this.viewModel.files.clear();for(var a=0;a<e.currentTarget.files.length;a++)!function(e){var t=e.name,i=e.size,a=e.type,o=new FileReader;o.onload=function(e){var o=new r.FileItem;o.fileName=t,o.fileSize=i,o.fileType=a,o.fileDataBase64=decodeURIComponent(e.target.result.substring(e.target.result.indexOf("base64,")+7)),n.viewModel.files.addItem(o)},o.readAsDataURL(e)}(e.currentTarget.files[a])},i.prototype.handleClearClick=function(e,t,i){this.viewModel.clear()},i}(n.FormItemViewBase);i.FilePickerFormItemView=s})},"geocortex/infrastructure/ui/components/Forms/FormItemViewBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));this.viewModel=e,this.addDisposableBinding(e.isValid,e.isValid.bind(this,function(e){this.calculateIndicatorDisplay()})),this.addDisposableBinding(e.isRequired,e.isRequired.bind(this,function(e){this.calculateIndicatorDisplay()})),this.calculateIndicatorDisplay(),t.prototype.attach.call(this,e)},i.prototype.calculateIndicatorDisplay=function(){this.viewModel.attached_showIndicator&&(this.viewModel.attached_showIndicator.set(!0===this.viewModel.isRequired.get()||!1===this.viewModel.isValid.get()),0==this.viewModel.isValid.get()?this.viewModel.attached_indicatorClass.set("form-item invalid"):this.viewModel.attached_indicatorClass.set("form-item required"))},i}(n.ViewBase);i.FormItemViewBase=a})},"geocortex/infrastructure/ui/components/Forms/FormsUtils":function(){define(["require","exports","geocortex/essentials/Field","../../../FormatUtils"],function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.convertToHTMLSyntax=function(t){if(null===t.get()||void 0===t.get())return null;for(var i in e.patterns){if(!i||void 0===i||null===i)break;var n=new RegExp(i,"g");t.set(t.get().replace(n,e.patterns[i]))}},e.formatListItem=function(e,t){switch(t){case i.EsriFieldTypes.esriFieldTypeDate:return n.formatDate(n.parseDate(e));case i.EsriFieldTypes.esriFieldTypeOID:case i.EsriFieldTypes.esriFieldTypeSmallInteger:case i.EsriFieldTypes.esriFieldTypeInteger:case i.EsriFieldTypes.esriFieldTypeSingle:case i.EsriFieldTypes.esriFieldTypeDouble:return n.formatNumber(n.parseNumber(e));default:return e}},e}();a.patterns={"\\n":"<br />","\\t":"&nbsp; &nbsp; &nbsp; &nbsp;"},t.FormsUtils=a})},"geocortex/infrastructure/ui/components/Forms/GroupBoxFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./ContainerFormItemView"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.prototype.attach.call(this,e)},i}(n.ContainerFormItemView);i.GroupBoxFormItemView=a})},"geocortex/infrastructure/ui/components/Forms/HyperlinkFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.prototype.attach.call(this,e)},i.prototype.handleClick=function(e,t,i){return this.viewModel.wasClicked.set(!0),this.app.followNavigationLink({url:i.uri,element:t})},i}(n.FormItemViewBase);i.HyperlinkFormItemView=a})},"geocortex/infrastructure/ui/components/Forms/ListBoxFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils","./FormsUtils"],function(t,i,n,a,o,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.selectionChangedTimer=null,n.selectedBindingToken=null,n.selectionBindingToken=null,n}return e(i,t),i.prototype.attach=function(e){var i=this;if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));if(e.attached_controlId=new a.Observable("formitem-{0}".format(o.alphaNumericToken())),e.selectionMode){var n=e.selectionMode.get().toLowerCase();e.attached_isMultiple=new a.Observable("multiple"===n.toLowerCase()||"extended"==n.toLowerCase())}e.selected&&!this.selectedBindingToken?this.selectedBindingToken=e.selected.bind(this,function(){e.selected.get()>=0&&this.handleSelectionChanged()}):e.selection&&!this.selectionBindingToken&&(this.selectionBindingToken=e.selection.bind(this,function(){e.selection.length()>0&&this.handleSelectionChanged()})),e.queryTaskRunner&&(e.queryTaskRunner.formatCallback=r.FormsUtils.formatListItem),t.prototype.attach.call(this,e),$(this.selectElement).dblclick(function(){i.app.command("SubmitWorkflowForm").execute(i.viewModel.formDefinition)})},i.prototype.handleSelectionChanged=function(e,t,i){var n=this;return null!=this.selectionChangedTimer&&(clearInterval(this.selectionChangedTimer),this.selectionChangedTimer=null),this.selectionChangedTimer=setTimeout(function(){!1===n.viewModel.queryTaskRunner.isBusy.get()&&(n.viewModel.triggerCascading(null),n.selectionChangedTimer=null)},450),!0},i}(n.FormItemViewBase);i.ListBoxFormItemView=s})},"geocortex/infrastructure/ui/components/Forms/MarkdownFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","../../../FilterUtils"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.markdownElement=null,n}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));t.prototype.attach.call(this,e);var i=new Remarkable({breaks:!0}).render(e.plainText.get()),n=a.sanitize(i,{uriTransformer:function(e){return e}});this.markdownElement.innerHTML=n},i}(n.FormItemViewBase);i.MarkdownFormItemView=o})},"geocortex/infrastructure/ui/components/Forms/RadioButtonFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){var i=this;if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));return e.attached_textOnLeft=new a.Observable(!1),this.addDisposableBinding(e.textLocation,e.textLocation.bind(this,function(t){e.attached_textOnLeft.set("left"===t.toLowerCase())})),e.textLocation.pulse(),e.attached_controlId=new a.Observable("radio-{0}".format(o.alphaNumericToken())),e.attached_labelText=null!=e.text?new a.Observable(e.text.get()):"",t.prototype.attach.call(this,e),this.radioElement&&(this.radioElement.checked=e.checked.get(),$(this.radioElement).change(function(){e.checked.set(this.checked)})),this.viewModel.__getRadioValueClosure=function(){var e=i.radioElement;return!!e&&e.checked},!0},i}(n.FormItemViewBase);i.RadioButtonFormItemView=r})},"geocortex/infrastructure/ui/components/Forms/TextEntryFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.attach=function(e){if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.attached_controlId=new a.Observable("formitem-{0}".format(o.alphaNumericToken())),null!=e.inputScope&&("Password"===e.inputScope.get()?e.attached_type=new a.Observable("password"):e.attached_type=new a.Observable("text")),t.prototype.attach.call(this,e)},i.prototype.handleBlurControl=function(){this.app.event("WorkflowFormTextInputBlurredEvent").publish(this)},i}(n.FormItemViewBase);i.TextEntryFormItemView=r})},"geocortex/infrastructure/ui/components/Forms/TimePickerFormItemView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./FormItemViewBase","geocortex/framework/observables","geocortex/framework/utils/utils"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.attached_seconds=null,n.attached_minutes=null,n.attached_hours=null,n.attached_second=null,n.attached_minute=null,n.attached_hour=null,n._lastClearedTime=null,n}return e(i,t),i.prototype.attach=function(e){var i=this;if(!e)throw new Error("{0}: A view model must be specified to attach to.".format(this.id));e.attached_controlId=new a.Observable("timepicker-{0}".format(o.alphaNumericToken())),e.attached_time=this.attached_time=new a.Observable,e.attached_timeIsNull=new a.Observable(!1),e.attached_timeIsNull.syncTransform(e.time,function(e){return null==e}),this._buildComboBoxes(e),t.prototype.attach.call(this,e),setTimeout(function(){i.viewModel.date?i.setPickerDateTime(i.viewModel.date.get()):i.viewModel.time&&i.setPickerDateTime(i.viewModel.time.get())},1)},i.prototype._buildComboBoxes=function(e){this.attached_seconds=new a.ObservableCollection([]),this.attached_minutes=new a.ObservableCollection([]),this.attached_hours=new a.ObservableCollection([]),this.attached_second=new a.Observable(0),this.attached_minute=new a.Observable(0),this.attached_hour=new a.Observable(0);for(var t=[],i=[],n=[],o=0;o<24;++o)t.push({val:o,desc:"{0}".format(o)});for(this.attached_hours.addItems(t),o=0;o<60;++o)i.push(o),n.push(o);this.attached_minutes.addItems(i),this.attached_seconds.addItems(n),e.attached_seconds=this.attached_seconds,e.attached_minutes=this.attached_minutes,e.attached_hours=this.attached_hours,e.attached_second=this.attached_second,e.attached_minute=this.attached_minute,e.attached_hour=this.attached_hour},i.prototype.setPickerDateTime=function(e){null!=e?(this.attached_second.set(e.getSeconds()),this.attached_minute.set(e.getMinutes()),this.attached_hour.set(e.getHours())):(this.attached_second.set(null),this.attached_minute.set(null),this.attached_hour.set(null),$(this.selectContainerElement).find("select").val([]))},i.prototype.handleChangeComboBoxTime=function(){var e;e=this.viewModel.time?this.viewModel.time.get():this.viewModel.date?this.viewModel.date.get():new Date,null!=this.attached_hour.get()||null!=this.attached_minute.get()||null!=this.attached_second.get()?(null==e&&(e=new Date).setMilliseconds(0),null==this.attached_hour.get()&&this.attached_hour.set(e.getHours()),null==this.attached_minute.get()&&this.attached_minute.set(e.getMinutes()),null==this.attached_second.get()&&this.attached_second.set(e.getSeconds()),e.setHours(this.attached_hour.get()),e.setMinutes(this.attached_minute.get()),e.setSeconds(this.attached_second.get())):e=null,this.viewModel.time?this.viewModel.time.set(e):this.viewModel.date&&this.viewModel.date.set(e)},i.prototype.handleClickSetNull=function(){this.viewModel.time.get()&&(this._lastClearedTime=this.viewModel.time.get()),this.viewModel.time.set(null),this.setPickerDateTime(null)},i.prototype.handleClickSetNotNull=function(){if(null!=this._lastClearedTime)this.viewModel.time.set(this._lastClearedTime),this.setPickerDateTime(this._lastClearedTime),this._lastClearedTime=null;else{var e=new Date;this.viewModel.time.set(e),this.setPickerDateTime(e)}},i}(n.FormItemViewBase);i.TimePickerFormItemView=r})},"geocortex/infrastructure/ui/components/MultiPane/MultiPaneView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../SmartPanel/SmartPanelView","geocortex/framework/utils/ArrayUtils"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n._panes=[],n.app.event("ApplicationResizedEvent").subscribe(n,n.handleApplicationResizedEvent),n.app.event("ViewDeactivatedEvent").subscribe(n,n.handleViewDeactivatedEvent),n}return e(i,t),i.prototype.activated=function(){var e=this;t.prototype.activated.call(this),this.viewModel&&this.viewModel.expanded.set(!0),setTimeout(function(){e.handleApplicationResizedEvent()},0)},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel&&this.viewModel.expanded.set(!1)},i.prototype.addDefaultPanes=function(){if(!(this.viewModel.displayedPaneItems.getLength()>0))for(var e=0;e<this.viewModel.defaultPaneItems.getLength();e++){var t=this.viewModel.defaultPaneItems.getAt(e);this.addPaneItem(t)}},i.prototype.addPaneItemById=function(e){var t=this.viewModel.findPaneItemById(e);this.addPaneItem(t)},i.prototype.addPaneItem=function(e){throw new Error("Not implemented")},i.prototype.canAddPaneItem=function(e){return!(!e||!this.viewModel)&&!this.viewModel.displayedPaneItems.contains(e)},i.prototype.destroyPaneItemById=function(e){var t=this.viewModel.findDisplayedPaneItemById(e);this.destroyPaneItem(t)},i.prototype.destroyPaneItem=function(e){if(e&&this.canDestroyPaneItem(e)){var t=this.findPaneForPaneItem(e);return!!t&&(this.viewModel.displayedPaneItems.removeItem(e),this.selector.unselectItem(e),this.app.command("DestroyView").execute(t.id),0!=this.viewModel.displayedPaneItems.length()||this.viewModel.headerIsVisible.get()||this.app.command("DeactivateView").execute(this.id),!0)}return!1},i.prototype.canDestroyPaneItem=function(e){return!(!e||!this.viewModel)&&this.viewModel.displayedPaneItems.contains(e)},i.prototype.clearPaneItems=function(){for(var e=this.viewModel.displayedPaneItems.getLength();e--;){var t=this.viewModel.displayedPaneItems.getAt(e);this.destroyPaneItem(t)}},i.prototype.handleSelectPane=function(e){this.addPaneItem(e)},i.prototype.handleUnSelectPane=function(e){this.destroyPaneItem(e)},i.prototype.handleClickClose=function(){this.deactivateContainer()},i.prototype.handleApplicationResizedEvent=function(){if(this.viewModel){var e=this.viewModel.regionType.get().indexOf("Stack")>-1,t=this.scrollRegionElement,i=$(".view .pane",t);if(e&&0!==i.length){var n=t.clientWidth/i.length-5;$(i).width(n)}}},i.prototype.handleViewDeactivatedEvent=function(e){a.firstOrDefault(this._panes,function(t){return e===t})&&(a.removeItem(this._panes,e),this.handleApplicationResizedEvent())},i.prototype.findPaneForPaneItem=function(e){for(var t=0;t<this._panes.length;t++){var i=this._panes[t];if(i.viewModel.currentPaneItem.get()===e)return i}return null},i.prototype._executeShowMultiPaneView=function(){this.app.command("ActivateView").execute(this.id),this.addDefaultPanes(),this.viewModel.displayedPaneItems.getLength()>0&&this.handleApplicationResizedEvent()},i}(n.SmartPanelView);i.MultiPaneView=o})},"geocortex/infrastructure/ui/components/MultiPane/MultiPaneViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../SmartPanel/SmartPanelViewModel","geocortex/framework/observables","geocortex/framework/utils/ArrayUtils"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.paneItems=new a.ObservableCollection,e.defaultPaneItems=new a.ObservableCollection,e.displayedPaneItems=new a.ObservableCollection,e.expanded=new a.Observable(!1),e.headerIsVisible=new a.Observable(!0),e.showXButton=new a.Observable(!0),e.selectorIconUri=new a.Observable(""),e.selectorText=new a.Observable(""),e}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&(e.hasOwnProperty("headerIsVisible")&&this.headerIsVisible.set(!!e.headerIsVisible),e.hasOwnProperty("showXButton")&&this.showXButton.set(!!e.showXButton),e.hasOwnProperty("selectorIconUri")&&this.selectorIconUri.set(e.selectorIconUri),e.hasOwnProperty("selectorText")&&this.selectorText.set(e.selectorText))},i.prototype.findPaneItemById=function(e){return o.firstOrDefault(this.paneItems.getItems(),function(t){return t.id&&t.id===e})},i.prototype.findDisplayedPaneItemById=function(e){return o.firstOrDefault(this.displayedPaneItems.getItems(),function(t){return t.id&&t.id===e})},i}(n.SmartPanelViewModel);i.MultiPaneViewModel=r})},"geocortex/infrastructure/ui/components/MultiPane/MultiPaneViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/MultiPane/PaneView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._isDestroyed=!1,e}return e(i,t),i.prototype.destroy=function(){t.prototype.destroy.call(this),this._isDestroyed=!0},i.prototype.onClose=function(e){},i.prototype.handleClickClose=function(e,t,i){this.viewModel&&this.onClose&&this.onClose(this.viewModel.currentPaneItem.get()),this._isDestroyed||this.app.command("DestroyView").execute(this.id)},i}(n.ViewBase);i.PaneView=a})},"geocortex/infrastructure/ui/components/MultiPane/PaneViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentPaneItem=new a.Observable(null),e.headerIsVisible=new a.Observable(!0),e.showXButton=new a.Observable(!0),e}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&(e.hasOwnProperty("headerIsVisible")&&this.headerIsVisible.set(!!e.headerIsVisible),e.hasOwnProperty("showXButton")&&this.showXButton.set(!!e.showXButton))},i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.currentPaneItem.set(null),this.currentPaneItem=null,this.app=null},i}(n.ViewModelBase);i.PaneViewModel=o})},"geocortex/infrastructure/ui/components/MultiPane/PaneViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/NumericInput/KendoSliderProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./SliderProviderBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.initialize=function(e){this.widget=e},i.prototype.instantiate=function(){this.widget.viewModel.updateOnDrag?this.slider=$(this.widget.numericInput).kendoSlider({showButtons:!1,tickPlacement:"none",slide:this.updateValue.bind(this),change:this.updateValue.bind(this)}).data("kendoSlider"):this.slider=$(this.widget.numericInput).kendoSlider({showButtons:!1,tickPlacement:"none",change:this.updateValue.bind(this)}).data("kendoSlider"),this.slider&&this.slider.value(this.value)},i.prototype.setValue=function(e){this.value=e,this.slider?(this.slider.resize(),this.slider.value(e)):this.instantiate()},i.prototype.updateValue=function(e){this.widget.updateValue(e.value)},i}(n.SliderProviderBase);i.KendoSliderProvider=a})},"geocortex/infrastructure/ui/components/NumericInput/NumericInputViewModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/NumericInput/NumericInputWidget":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){t.prototype.attach.call(this,e),this.initialize(this.configuration)},i.prototype.initialize=function(e){var t;(t=dojo.getObject(e.provider))?(this.provider=new t(this.app,this.libraryId),this.provider.initialize(this),this.bindingToken=this.viewModel.range.value.bind(this,this.setValue)):this.app.trace.error("{0} can't find numeric input provider typed {1}".format(this.id,e.provider))},i.prototype.updateValue=function(e){this.bindingToken&&this.viewModel.range.value.unbind(this.bindingToken),this.viewModel.range.value.set(e),this.bindingToken=this.viewModel.range.value.bind(this,this.setValue)},i.prototype.setValue=function(e){e=this.validate(e),this.provider.setValue(e),this.nativeInput.value=e.toString()},i.prototype.validate=function(e){return e=Number(e),isNaN(e)?this.viewModel.range.min:e>this.viewModel.range.max?this.viewModel.range.max:e<this.viewModel.range.min?this.viewModel.range.min:Math.ceil(e/this.viewModel.range.step)*this.viewModel.range.step},i.prototype.validateInput=function(){this.viewModel.range.value.set(this.validate(this.viewModel.range.value.get()))},i}(n.ViewBase);i.NumericInputWidget=a})},"geocortex/infrastructure/ui/components/NumericInput/RangeConfiguration":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/NumericInput/SliderProviderBase":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.value=0,this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){throw new Error("Not implemented")},e.prototype.setValue=function(e){throw new Error("Not implemented")},e}();t.SliderProviderBase=i})},"geocortex/infrastructure/ui/components/PagingControls/PagingControlsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.libraryId="Mapping.Infrastructure",e}return e(i,t),i.prototype.attach=function(e){this.viewModel=e},i.prototype.handlePageFirst=function(e,t,i){this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(1)},i.prototype.handlePagePrev=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()>1){var n=this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()-1;this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(n)}},i.prototype.handlePageNext=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get()>this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()){var n=this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()+1;this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(n)}},i.prototype.handlePageLast=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()<this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get()){var n=this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get();this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(n)}},i}(n.ViewBase);i.PagingControlsView=a})},"geocortex/infrastructure/ui/components/PagingControls/PagingControlsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){var n=t.call(this,e,"Mapping.Infrastructure")||this;return n.libraryId="Mapping.Infrastructure",n.collectionViewModel=i,n.presentableResults=n.collectionViewModel.presentableResults,n.numberOfItems=n.presentableResults.items.length(),n}return e(i,t),i}(n.ViewModelBase);i.PagingControlsViewModel=a})},"geocortex/infrastructure/ui/components/Slider/SliderConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/Slider/SliderItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/Slider/SliderViewBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.sliderElement=null,e.sliderMinLabelElement=null,e.sliderMaxLabelElement=null,e._sliderCurrentRawValues=[],e._sliderCurrentHandlePos=[],e._widgetHostElement=null,e._minHandleBindingToken=null,e._maxHandleBindingToken=null,e._isEnabledBindingToken=null,e._isAdded=!1,e._minHnadleLocked=!1,e._maxHandleLocked=!1,e._minHandleTag="gcx_timeslider_handle0",e._maxHandleTag="gcx_timeslider_handle1",e._currPosForComputedDirection=[],e}return e(i,t),i.prototype.attach=function(e){e&&(t.prototype.attach.call(this,e),this._isAdded&&this._initializeIfEnabled(this.viewModel.isEnabled.get()))},i.prototype.added=function(e){t.prototype.added.call(this,e),this._isAdded=!0,this._widgetHostElement=e,this._cleanUp(!0),this._isEnabledBindingToken=this.viewModel.isEnabled.bind(this,this._initializeIfEnabled),this._initializeIfEnabled(this.viewModel.isEnabled.get())},i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this._cleanUp(!0)},i.prototype.refreshLabelPositions=function(){this._updateLabelPosition(0),this._updateLabelPosition(1)},i.prototype._setupViewModelBindings=function(){var e=this;this._minHandleBindingToken=this.viewModel.sliderMinHandleCurrentItem.bind(this,function(t){return e._setSliderValueAndUpdateLabels(0,e.viewModel.getRawSliderValueForItem(t))}),this.viewModel.range&&(this._maxHandleBindingToken=this.viewModel.sliderMaxHandleCurrentItem.bind(this,function(t){return e._setSliderValueAndUpdateLabels(1,e.viewModel.getRawSliderValueForItem(t))}))},i.prototype._generateJQuerySlider=function(){var e=this,t=this.viewModel,i={animate:t.animate,min:t.isNumeric?t.numericSliderMinVal:0,max:t.isNumeric?t.numericSliderMaxVal:t.items.length()-1,step:t.isNumeric?t.isDateMode||t.disableSnappingForNumericValues?1:t.numericSliderStep:1,orientation:"horizontal",range:t.range,slide:function(t,i){return e._handleSliderRawValueSlide(t,i)},change:function(t,i){return e._handleSliderRawValueChange(t,i)}};this.viewModel.isDateMode&&(i.slide=function(t,i){return e._dateModeRawValueSlide(t,i)});var n=function(){i.range?i.values=[i.min,i.min+i.step]:i.value=i.min},a=function(){if(i.values[0]===i.values[1]){var e=i.values[0]+i.step,t=i.values[0]-i.step;e<=i.max?i.values[1]=e:i.values[0]=t}};if(t.isNumeric&&t.numericSliderHandleStartValues.length)!i.range||isNaN(t.numericSliderHandleStartValues[0])||isNaN(t.numericSliderHandleStartValues[1])?i.range||isNaN(t.numericSliderHandleStartValues[0])?n():i.value=t.numericSliderHandleStartValues[0]:(i.values=t.numericSliderHandleStartValues.slice(0,2),t.lockMinSliderHandleAtMinVal&&(i.values[0]=i.min),a());else if(!t.isNumeric&&t.sliderHandleStartLabels.length){var o=t.getSliderItemByItemLabel(t.sliderHandleStartLabels[0]),r=t.getSliderItemByItemLabel(t.sliderHandleStartLabels[1]);i.range&&o&&r?(i.values=[t.items.indexOf(o)-1,t.items.indexOf(r)-1],t.lockMinSliderHandleAtMinVal&&(i.values[0]=i.min),a()):!i.range&&o?i.value=t.items.indexOf(o)-1:n()}else n();i.range?this._sliderCurrentRawValues=i.values.slice(0):this._sliderCurrentRawValues[0]=i.value,$(this.sliderElement).slider(i),this._wireInKeyboardSupport();var s=this._widgetHostElement?this._widgetHostElement:this;if(s.isActive)this._applyInitViewModelState(i);else var l=this.app.event("ViewActivatedEvent").subscribe(this,function(t){t===s&&(e.app.event("ViewActivatedEvent").unsubscribe(l),l=null,e._applyInitViewModelState(i))})},i.prototype._applyInitViewModelState=function(e){e.range?(this.viewModel.setSelectedSliderItem(0,this.viewModel.getSliderItemByRawSliderValue(e.values[0])),this.viewModel.setSelectedSliderItem(1,this.viewModel.getSliderItemByRawSliderValue(e.values[1]))):this.viewModel.setSelectedSliderItem(0,this.viewModel.getSliderItemByRawSliderValue(e.value))},i.prototype._handleSliderRawValueChange=function(e,t){var i=this._getSliderHandleIndex(t);return this._sliderCurrentRawValues[i]=t.value,this._minHnadleLocked=!1,this._maxHandleLocked=!1,!0},i.prototype._dateModeRawValueSlide=function(e,t){if(!e||37===e.which||39===e.which||!e.originalEvent||!$(e.originalEvent.target).hasClass("ui-slider-handle"))return this._handleSliderRawValueSlide(e,t);var i=this._getSliderHandleIndex(t);if(void 0!==this._currPosForComputedDirection[i]&&this._currPosForComputedDirection[i]!==t.value){var n=t.value>this._currPosForComputedDirection[i];if(n&&void 0!==this._sliderCurrentRawValues[i]&&t.value>this._sliderCurrentRawValues[i]||!n&&void 0!==this._sliderCurrentRawValues[i]&&t.value<this._sliderCurrentRawValues[i])return this._currPosForComputedDirection.length=0,this._handleSliderRawValueSlide(e,t,n)}return this._currPosForComputedDirection[i]=t.value,!1},i.prototype._handleSliderRawValueSlide=function(e,t,i){if(!t||!t.handle||void 0===t.value)return!1;var n=this._getSliderHandleIndex(t);if(this._currPosForComputedDirection.length=0,this.viewModel.range&&this.viewModel.lockMinSliderHandleAtMinVal&&0===n&&(n=1),!this.viewModel.range&&1===n)return!1;if(0===n&&this._minHnadleLocked)return!1;if(1===n&&this._maxHandleLocked)return!1;0===n?this._maxHandleLocked=!0:this._minHnadleLocked=!0;var a=this.viewModel.getSliderItemByRawSliderValue(t.value),o=(t.value,this._sliderCurrentRawValues[n]),r=void 0===i?void 0===o||t.value>o:i;if(this.viewModel.isDateMode&&!this.viewModel.disableSnappingForNumericValues&&(a=r?this.viewModel.getClosestDateItemSnappedToInterval(a,"next",37===e.which||39===e.which):this.viewModel.getClosestDateItemSnappedToInterval(a,"prev",37===e.which||39===e.which),this.viewModel.getRawSliderValueForItem(a)),a&&!a.active){this._sliderCurrentRawValues[n];a=r?this.viewModel.getNextActiveSliderItem(a):this.viewModel.getPreviousActiveSliderItem(a),this.viewModel.getRawSliderValueForItem(a)}if(a&&this.viewModel.range){var s=0===n?this.viewModel.sliderMaxHandleCurrentItem.get():this.viewModel.sliderMinHandleCurrentItem.get(),l=0===n?a.value>s.value:a.value<s.value;if(s&&(l||a.value===s.value||this.viewModel.isDateMode&&a.label===s.label)){if(this.viewModel.isDateMode){if(this.viewModel.disableSnappingForNumericValues)return!1;a=0===n?this.viewModel.getClosestDateItemSnappedToInterval(a,"prev",!0):this.viewModel.getClosestDateItemSnappedToInterval(a,"next",!0)}else a=0===n?this.viewModel.getPreviousActiveSliderItem(a):this.viewModel.getNextActiveSliderItem(a);this.viewModel.getRawSliderValueForItem(a)}}if(!a)return!1;var d=0===n?this.viewModel.sliderMinHandleCurrentItem.get():this.viewModel.sliderMaxHandleCurrentItem.get();return d&&a.value===d.value&&(this._minHnadleLocked=!1,this._maxHandleLocked=!1),this.viewModel.setSelectedSliderItem(n,a),!1},i.prototype._getSliderHandleIndex=function(e){if($(e.handle).hasClass(this._minHandleTag))return 0;if($(e.handle).hasClass(this._maxHandleTag))return 1;var t=0;return this.viewModel.range&&(t=null===e.handle.nextElementSibling||void 0===e.handle.nextElementSibling?1:0),$(e.handle).addClass(0===t?this._minHandleTag:this._maxHandleTag),t},i.prototype._setSliderValueAndUpdateLabels=function(e,t){null!==t&&(0!==e&&1!==e||isNaN(parseInt(t,10))?this.app.trace.error("SliderViewBase: Could not set slider values and update UI. Required arguments invalid."):(this._setSliderRawValue(e,t),this._updateLabelPosition(e)))},i.prototype._setSliderRawValue=function(e,t){this.viewModel.range?$(this.sliderElement).slider("values")[e]!==t&&$(this.sliderElement).slider("values",e,t):$(this.sliderElement).slider("value")!==t&&$(this.sliderElement).slider("value",t)},i.prototype._updateSliderHandleAttributes=function(e){var t=0===e?this.viewModel.sliderMinHandleCurrentItem.get():this.viewModel.sliderMaxHandleCurrentItem.get(),i=$(".ui-slider-handle",this.sliderElement).toArray()[e];if(i&&t&&t.label){var n=0===e?this.viewModel.range?this.viewModel.sliderMinHandleAriaLabel||"":this.viewModel.sliderSingleHandleAriaLabel||"":this.viewModel.sliderMaxHandleAriaLabel||"";void 0==$(i).attr("tabindex")&&$(i).attr("tabindex",0),void 0==$(i).attr("role")&&$(i).attr("role","slider"),$(i).attr("aria-label",n||t.label),$(i).attr("aria-valuenow",t.label),$(i).attr("aria-valuetext",t.label),$(i).attr("title",t.label)}},i.prototype._updateLabelPosition=function(e){var t=this;this._updateLabelPositionImpl(e),setTimeout(function(){return t._updateLabelPositionImpl(e)},this.viewModel.animate?400:100)},i.prototype._updateLabelPositionImpl=function(e){if(null!==e&&void 0!==e&&(0===e||1===e)&&(this.viewModel.range||1!==e)){var t=$(".ui-slider-handle",this.sliderElement).toArray();if(0!==t.length){var i=0===e?$(this.sliderMinLabelElement).width()+5:$(this.sliderMaxLabelElement).width(),n=$(this.sliderElement).width(),a=$(t[e]).width(),o=$(t[e]).position().left+$(this.sliderElement).position().left+.5*a-.5*i;o=Math.max($(this.sliderElement).position().left-.5*a,o),o=Math.min(n+$(this.sliderElement).position().left+.5*a-i,o);var r=this._sliderCurrentHandlePos[(e+1)%2],s=(0===e?$(this.sliderMaxLabelElement).width()+5:$(this.sliderMinLabelElement).width())+5;s=s<.5*i?i:s,r=isNaN(r)&&this.viewModel.range?n+$(this.sliderElement).position().left+.5*a-s:r,isNaN(r)||(0===e?(o=r>=i?Math.min(r-i,o):o,o=Math.min(n+$(this.sliderElement).position().left+.5*a-(s+i-5),o)):1===e&&(o=Math.max(r+s+.5*a,o))),this._sliderCurrentHandlePos[e]=o,0===e?this.sliderMinLabelElement.style.left=o+"px":this.sliderMaxLabelElement.style.left=o+"px",this._updateSliderHandleAttributes(e)}}},i.prototype._processInitRoutine=function(){this._cleanUp(),this._setupViewModelBindings(),this._generateJQuerySlider()},i.prototype._initializeIfEnabled=function(e){e&&this._processInitRoutine()},i.prototype._cleanUp=function(e){void 0===e&&(e=!1),this.sliderElement&&$(this.sliderElement).hasClass("ui-slider")&&$(this.sliderElement).slider("destroy"),this.viewModel&&(this._isEnabledBindingToken&&e&&(this.viewModel.isEnabled.unbind(this._isEnabledBindingToken),this._isEnabledBindingToken=null),this._minHandleBindingToken&&this.viewModel.sliderMinHandleCurrentItem.unbind(this._minHandleBindingToken),this._maxHandleBindingToken&&this.viewModel.sliderMaxHandleCurrentItem.unbind(this._maxHandleBindingToken)),this._sliderCurrentHandlePos=[],this._sliderCurrentRawValues=[],this._currPosForComputedDirection=[],this._minHandleBindingToken=null,this._maxHandleBindingToken=null},i.prototype._wireInKeyboardSupport=function(){var e=this,t=$(".ui-slider-handle",this.sliderElement).toArray();if(0!==t.length){var i=function(i,n,a){var o={which:a},r={handle:t[n],value:"prev"===i?e._sliderCurrentRawValues[n]-1:e._sliderCurrentRawValues[n]+1};e._handleSliderRawValueSlide(o,r)};t.forEach(function(t,n){$(t).unbind("keydown"),$(t).keydown(function(t){var a=!1;switch(t.which){case 38:case 39:case 33:i("next",n,39);break;case 37:case 40:case 34:i("prev",n,37);break;default:a=!0}e.refreshLabelPositions(),a||(t.preventDefault(),t.stopPropagation())})})}},i}(n.ViewBase);i.SliderViewBase=a})},"geocortex/infrastructure/ui/components/Slider/SliderViewModelBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/TimeUnits","./../../../TimeSliderUtils"],function(t,i,n,a,o,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(e,i,n){var o=t.call(this,e,i)||this;return o.items=new a.ObservableCollection([]),o.sliderMinLabel=new a.Observable(""),o.sliderMaxLabel=new a.Observable(""),o.sliderMinHandleLabel=new a.Observable(""),o.sliderMaxHandleLabel=new a.Observable(""),o.sliderMinHandleCurrentItem=new a.Observable(null),o.sliderMaxHandleCurrentItem=new a.Observable(null),o.range=!1,o.disableSnappingForNumericValues=!0,o.lockMinSliderHandleAtMinVal=!1,o.animate=!1,o.isNumeric=null,o.isDateMode=null,o.numericSliderStep=null,o.numericSliderMinVal=null,o.numericSliderMaxVal=null,o.labelGenerator=null,o.itemActivePredicate=null,o.sliderHandleStartLabels=[],o.numericSliderHandleStartValues=[],o.sliderTicks=new a.ObservableCollection,o.isEnabled=new a.Observable(!1),o.sliderMinHandleAriaLabel=null,o.sliderMaxHandleAriaLabel=null,o.sliderSingleHandleAriaLabel=null,o._underlyingCollection=null,o._underlyingCollectionBindingToken=null,o._config=null,o._defaultNumericLabelGenerator=function(e,t){return e+""},o._defaultItemActivePredicate=function(e,t){return!0},o._numericSliderItemCache={},o._maxSliderTicks=50,o._defaultSliderDivisions=5,o._snappableDatePoints=[],o.itemActivePredicate=o._defaultItemActivePredicate,n&&o.initialize(n),o}return e(i,t),i.prototype.initialize=function(e){this._applyConfig(e)},i.prototype.sliderHandleSlide=function(e,t){},i.prototype.setNextSliderItem=function(e){return this._setNextOrPreviousSliderItem(e,"next")},i.prototype.setPreviousSliderItem=function(e){return this._setNextOrPreviousSliderItem(e,"previous")},i.prototype.setSelectedSliderItem=function(e,t){if(0!==e&&1!==e||!t)throw new Error("SliderViewModelBase: Could not set selected slider item.");var i=0===e?this.sliderMinHandleCurrentItem.get():this.sliderMaxHandleCurrentItem.get();i&&i.value===t.value||(0===e?(this.sliderMinHandleLabel.set(t.label),this.sliderMinHandleCurrentItem.set(t)):(this.sliderMaxHandleLabel.set(t.label),this.sliderMaxHandleCurrentItem.set(t)),this.sliderHandleSlide(t,e))},i.prototype.attachToCollection=function(e,t,i,n){var o=this;if(this.cleanUp(),this.isNumeric=!1,!(e&&e instanceof a.ObservableCollection))throw new Error("SliderViewModelBase: Could not attach to collection.");t&&dojo.isFunction(t)&&(this.labelGenerator=t),n&&n.length&&(this.sliderHandleStartLabels=n.slice(0)),this.itemActivePredicate=i&&dojo.isFunction(i)?i:this._defaultItemActivePredicate,this._underlyingCollection=e,this.items.set(this._underlyingCollection.get().map(function(e,t){return o._createSliderItem(e,t)})),this._underlyingCollectionBindingToken=this._underlyingCollection.bind(this,this._handleUnderlyingCollectionChanges),this._initializeUIObservables()},i.prototype.setupNumericSlider=function(e,t,i,n,a,o){if(this.cleanUp(),this.isNumeric=!0,e=parseFloat(e),t=parseFloat(t),i=parseFloat(i),isNaN(e)||isNaN(t))throw new Error("SliderViewModelBase: Could not set numeric slider range. Minimum and/or maximum values invalid.");if(o&&o.length&&(this.numericSliderHandleStartValues=o.slice(0)),this.numericSliderMinVal=e,this.numericSliderMaxVal=t,this.labelGenerator=n&&dojo.isFunction(n)?n:this._defaultNumericLabelGenerator,this.itemActivePredicate=a&&dojo.isFunction(a)?a:this._defaultItemActivePredicate,this.numericSliderStep=i&&!isNaN(i)&&i<t-e?i:null,null===this.numericSliderStep){var r=t-e;r&&(this.numericSliderStep=r<=1?r/this._defaultSliderDivisions:Math.round(r/this._defaultSliderDivisions),this.isDateMode&&this._resetTimeIntervalBasedOnSliderStep())}this._initializeUIObservables()},i.prototype.setupDateSlider=function(e,t,i,n,a,o,s){this.isDateMode=!0,this.dateModeTimeInterval=i,this.dateModeTimeIntervalUnit=n,this.setupNumericSlider(e,t,r.computeTimeIntervalInMs(i,n),a,o,s),this.disableSnappingForNumericValues||this._generateDateModeSnappablePoints()},i.prototype.getSliderItemByRawSliderValue=function(e,t){if(void 0===t&&(t=!1),void 0===e||null===e)return null;var i=null,n=this.isNumeric?e-this.numericSliderMinVal:e;return this.isNumeric?(t&&(e=(e=e>this.numericSliderMaxVal?this.numericSliderMaxVal:e)<this.numericSliderMinVal?this.numericSliderMinVal:e),e>=this.numericSliderMinVal&&e<=this.numericSliderMaxVal&&(i=this._getUpdatedNumericItemAndUpdateCache(e,n))):n>-1&&n<this.items.length()&&(i=this.items.getAt(n),this._updateSliderItem(i,n)),i},i.prototype.getSliderItemByItemLabel=function(e){if(!e)return null;var t=null;if(this.isNumeric){if(this.labelGenerator)for(var i=this.numericSliderMinVal,n=0;i<=this.numericSliderMaxVal;i+=this.numericSliderStep,n++)if(this.labelGenerator(i,n)===e){t=this._getUpdatedNumericItemAndUpdateCache(i,n);break}}else for(var a=0,o=this.items.length();a<o;a++){var r=this.items.getAt(a);if(this._updateSliderItem(r,a),r.label===e){t=r;break}}return t},i.prototype.getSliderItemByItemValue=function(e){var t=this;if(void 0===e||null===e||this.isNumeric&&"number"!=typeof e)return null;var i=null;if(this.isNumeric){var n=e-this.numericSliderMinVal;i=this._getUpdatedNumericItemAndUpdateCache(e,n)}else i=(i=this.items.get().filter(function(i,n){return i.value===e&&(t._updateSliderItem(i,n),!0)})[0])||null;return i},i.prototype.getNextSliderItem=function(e){return this._getAdjacentSliderItem(e,"next")},i.prototype.getNextActiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"next","active")},i.prototype.getNextInactiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"next","inactive")},i.prototype.getPreviousSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev")},i.prototype.getPreviousActiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev","active")},i.prototype.getPreviousInactiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev","inactive")},i.prototype.getClosestDateItemSnappedToInterval=function(e,t,i){void 0===t&&(t="next"),void 0===i&&(i=!1);var n=this.getRawSliderValueForItem(e);return null===(n=this._getClosestDateItemRawValueSnappedToInterval(n,t,i))?null:this.getSliderItemByRawSliderValue(n,!0)},i.prototype.getRawSliderValueForItem=function(e){var t=null;if(e)if(this.isNumeric){var i=e.value;i>=this.numericSliderMinVal&&i<=this.numericSliderMaxVal&&(t=i)}else{var n=this.items.get().map(function(e){return e.value}).indexOf(e.value);n>-1&&n<this.items.length()&&(t=n)}return t},i.prototype.cleanUp=function(){this.isEnabled.set(!1),this.labelGenerator=null,this.items.clear(),this.isNumeric=null,this.sliderMaxHandleCurrentItem.set(null),this.sliderMinHandleCurrentItem.set(null),this.sliderMinHandleLabel.set(""),this.sliderMaxHandleLabel.set(""),this.sliderMaxLabel.set(""),this.sliderMinLabel.set(""),this.numericSliderStep=null,this.numericSliderMinVal=null,this.numericSliderMaxVal=null,this._numericSliderItemCache={},this.numericSliderHandleStartValues.length=0,this.sliderHandleStartLabels.length=0,this._snappableDatePoints.length=0,this.itemActivePredicate=this._defaultItemActivePredicate,this.sliderTicks.clear(),this._underlyingCollection&&(this._underlyingCollectionBindingToken&&(this._underlyingCollection.unbind(this._underlyingCollectionBindingToken),this._underlyingCollectionBindingToken=null),this._underlyingCollection=null)},i.prototype._setNextOrPreviousSliderItem=function(e,t){if(0!==e&&1!==e)return this.app.trace.error("SliderViewModelBase: Could not set "+t+" slider item. Invalid handle index.Handle index must be 0 or 1."),!1;var i=0===e?this.sliderMinHandleCurrentItem.get():this.sliderMaxHandleCurrentItem.get(),n=0===e?this.sliderMaxHandleCurrentItem.get():this.sliderMinHandleCurrentItem.get();if(!i)return this.app.trace.error("SliderViewModelBase: Could not set "+t+" slider item. Please set current item first."),!1;var a="next"===t?this.getNextActiveSliderItem(i):this.getPreviousActiveSliderItem(i);return!(!a||n&&(!n||n.value===a.value)||a.value===i.value)&&(!(n&&0===e&&"next"===t&&a.value>=n.value)&&(!(n&&1===e&&"next"!==t&&a.value<=n.value)&&((!this.range||!this.lockMinSliderHandleAtMinVal||0!==e)&&(this.setSelectedSliderItem(e,a),!0))))},i.prototype._initializeUIObservables=function(){this._setupSliderTicks(),this._setupSliderMinMaxLabels(),this.isEnabled.set(!0)},i.prototype._setupSliderTicks=function(){this.sliderTicks.clear();for(var e=this.isNumeric?(this.numericSliderMaxVal-this.numericSliderMinVal)/this.numericSliderStep:this.items.length(),t=100/(e=e>this._maxSliderTicks?this._maxSliderTicks:e),i=0,n=0;n<e;n++)i<=100&&(this.sliderTicks.addItem({position:i+"%"}),i+=t)},i.prototype._setupSliderMinMaxLabels=function(){var e=this.isNumeric?this.getSliderItemByItemValue(this.numericSliderMinVal):this.items.getAt(0),t=this.isNumeric?this.getSliderItemByItemValue(this.numericSliderMaxVal):this.items.getAt(this.items.length()-1);this.sliderMinLabel.set(e?e.label:""),this.sliderMaxLabel.set(t?t.label:"")},i.prototype._getAdjacentSliderItem=function(e,t,i){void 0===t&&(t="next"),void 0===i&&(i="any");var n=this.getRawSliderValueForItem(e);if(null===n)return null;var a=null,o=null;do{if(n=this.isNumeric?this._getAdjacentNumericItemRawValue(n,t):"prev"===t?n-1:n+1,o=this.getSliderItemByRawSliderValue(n,this.isNumeric))switch(i){case"active":a=o.active?o:null;break;case"inactive":a=o.active?null:o;break;default:a=o}}while(o&&!a);return a},i.prototype._getAdjacentNumericItemRawValue=function(e,t,i){var n=this;void 0===t&&(t="next"),void 0===i&&(i=!1);var a=null,r=function(e){return e&&!isNaN(e)&&i&&(e=(e=e>n.numericSliderMaxVal?n.numericSliderMaxVal:e)<n.numericSliderMinVal?n.numericSliderMinVal:e),e},s=function(){return"prev"===t?e-n.numericSliderStep:e+n.numericSliderStep};if(!this.isDateMode||!this.dateModeTimeInterval||!this.dateModeTimeIntervalUnit)return r(s());var l=function(e){return"next"===t?e:-1*e};switch(this.dateModeTimeIntervalUnit){case o.TimeUnits.UNIT_MILLISECONDS:return e+l(this.dateModeTimeInterval);case o.TimeUnits.UNIT_SECONDS:return e+l(1e3*this.dateModeTimeInterval);case o.TimeUnits.UNIT_MINUTES:return e+l(60*this.dateModeTimeInterval*1e3);case o.TimeUnits.UNIT_HOURS:return e+l(60*this.dateModeTimeInterval*60*1e3);case o.TimeUnits.UNIT_DAYS:return e+l(24*this.dateModeTimeInterval*60*60*1e3);case o.TimeUnits.UNIT_WEEKS:return e+l(7*this.dateModeTimeInterval*24*60*60*1e3);case o.TimeUnits.UNIT_MONTHS:(a=new Date(e)).setUTCMonth(a.getUTCMonth()+l(this.dateModeTimeInterval));break;case o.TimeUnits.UNIT_YEARS:(a=new Date(e)).setUTCFullYear(a.getUTCFullYear()+l(this.dateModeTimeInterval));break;case o.TimeUnits.UNIT_DECADES:(a=new Date(e)).setUTCFullYear(a.getUTCFullYear()+l(10*this.dateModeTimeInterval));break;case o.TimeUnits.UNIT_CENTURIES:(a=new Date(e)).setUTCFullYear(a.getUTCFullYear()+l(100*this.dateModeTimeInterval))}return r(a&&!isNaN(a.getTime())?a.getTime():s())},i.prototype._resetTimeIntervalBasedOnSliderStep=function(){if(this.dateModeTimeInterval&&this.dateModeTimeIntervalUnit&&this.numericSliderStep&&!isNaN(this.numericSliderStep)&&!(this.numericSliderStep<=0)){var e=new Date(this.numericSliderStep);if(!isNaN(e.getTime()))for(var t=[e.getUTCFullYear()-1970,e.getUTCMonth(),e.getUTCDate()-1,e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()],i=[o.TimeUnits.UNIT_YEARS,o.TimeUnits.UNIT_MONTHS,o.TimeUnits.UNIT_DAYS,o.TimeUnits.UNIT_HOURS,o.TimeUnits.UNIT_MINUTES,o.TimeUnits.UNIT_SECONDS,o.TimeUnits.UNIT_MILLISECONDS],n=0;n<t.length;n++)if(t[n]>0){this.dateModeTimeIntervalUnit=i[n],this.dateModeTimeInterval=t[n],this.numericSliderStep=r.computeTimeIntervalInMs(this.dateModeTimeInterval,this.dateModeTimeIntervalUnit);break}}},i.prototype._getClosestDateItemRawValueSnappedToInterval=function(e,t,i){if(void 0===t&&(t="next"),void 0===i&&(i=!1),!this._snappableDatePoints.length)return i?this._getAdjacentNumericItemRawValue(e,t):e;for(var n,a,o,r=0,s=this._snappableDatePoints.length-1;r<=s;){if(n=Math.floor((r+s)/2),(a=this._snappableDatePoints[n])===e)return i?this._getAdjacentNumericItemRawValue(e,t):e;if("next"===t?e>a&&e<this._snappableDatePoints[n+1]:e<a&&e>this._snappableDatePoints[n-1]){o=a;break}a<e?r=n+1:a>e&&(s=n-1)}return o?this._getAdjacentNumericItemRawValue(o,t):null},i.prototype._generateDateModeSnappablePoints=function(){if(this.isDateMode&&this.dateModeTimeInterval&&this.dateModeTimeIntervalUnit&&this.numericSliderMinVal&&this.numericSliderMaxVal){this._snappableDatePoints.length=0;var e=this.numericSliderMinVal;if(this.dateModeTimeIntervalUnit===o.TimeUnits.UNIT_WEEKS||this.dateModeTimeIntervalUnit===o.TimeUnits.UNIT_MONTHS||this.dateModeTimeIntervalUnit===o.TimeUnits.UNIT_YEARS||this.dateModeTimeIntervalUnit===o.TimeUnits.UNIT_DECADES||this.dateModeTimeIntervalUnit===o.TimeUnits.UNIT_CENTURIES){this._snappableDatePoints.push(e);do{e=this._getAdjacentNumericItemRawValue(e,"next"),this._snappableDatePoints.push(e)}while(e<this.numericSliderMaxVal);this._snappableDatePoints.push(this.numericSliderMaxVal)}}},i.prototype._applyConfig=function(e){this._config=e||{},this.range=void 0!==this._config.range&&!!this._config.range,this.animate=void 0!==this._config.animate&&!!this._config.animate,this.disableSnappingForNumericValues=void 0===this._config.disableSnappingForNumericValues||!!this._config.disableSnappingForNumericValues,this.lockMinSliderHandleAtMinVal=void 0!==this._config.lockMinSliderHandleAtMinVal&&!!this._config.lockMinSliderHandleAtMinVal,this.sliderMinHandleAriaLabel=e.sliderMinHandleAriaLabel||null,this.sliderMaxHandleAriaLabel=e.sliderMaxHandleAriaLabel||null,this.sliderSingleHandleAriaLabel=e.sliderSingleHandleAriaLabel||null},i.prototype._handleUnderlyingCollectionChanges=function(e){var t,i=this;switch(e.type){case"clear":this.items.clear();break;case"insert":t=e.sender.getRange(e.rangeStart,e.rangeEnd),this.items.insertItems(e.rangeStart,t.map(function(t,n){return i._createSliderItem(t,e.rangeStart+n)}));break;case"append":t=e.sender.getRange(e.rangeStart,e.rangeEnd),this.items.addItems(t.map(function(t,n){return i._createSliderItem(t,e.rangeStart+n)}));break;case"remove":this.items.removeRange(e.rangeStart,e.rangeEnd)}this._initializeUIObservables()},i.prototype._createSliderItem=function(e,t){return{value:e,label:this._getItemLabel(e,t),active:this.itemActivePredicate(e,t)}},i.prototype._getItemLabel=function(e,t){var i="";return this.labelGenerator&&(i=null===(i=this.labelGenerator(e,t))||void 0===i?"":i+""),i},i.prototype._updateSliderItem=function(e,t){return e.label=this._getItemLabel(e.value,t),e.active=this.itemActivePredicate(e.value,t),e},i.prototype._getUpdatedNumericItemAndUpdateCache=function(e,t){if(null===e||void 0===e||null===t||void 0===t)return null;var i=this._numericSliderItemCache[e+""];return i?this._updateSliderItem(i,t):i=this._createSliderItem(e,t),this._numericSliderItemCache[e+""]=i,i},i}(n.ViewModelBase);i.SliderViewModelBase=s})},"geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework-ui/ViewContainer/ViewContainerView","./SmartPanelViewModel","./../../../menus/MenuViewModel"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.resizeY=!1,e.resizeX=!1,e._menuViews={},e._menuItemInvokedSubscriptionToken=null,e}return e(i,t),i.prototype.attach=function(e){var i=this;if(t.prototype.attach.call(this,e),this.configuration.resizableParentRegion)if(this.app.site&&this.app.site.isInitialized){n=this.app.viewManager.getExistingRegionByName(this.configuration.resizableParentRegion);this.resizableRegion=n.domElement}else this.app.event("SiteInitializedEvent").once(this,function(){var e=i.app.viewManager.getExistingRegionByName(i.configuration.resizableParentRegion);i.resizableRegion=e.domElement});else if(this.app.site&&this.app.site.isInitialized){var n=this.app.viewManager.getExistingRegionByName(this.regionName);this.resizableRegion=n.domElement}else this.app.event("SiteInitializedEvent").once(this,function(){var e=i.app.viewManager.getExistingRegionByName(i.regionName);i.resizableRegion=e.domElement});this.viewModel.resizeX?this.resizeX=this.viewModel.resizeX:this.configuration.resizeX&&(this.resizeX=this.configuration.resizeX),this.viewModel.resizeY?this.resizeY=this.viewModel.resizeY:this.configuration.resizeY&&(this.resizeY=this.configuration.resizeY),$(this.app.getHostElement()).on("onclick.handle-resize-error",function(e){$(i.app.getHostElement()).off("mousemove.header-resize touchmove.header-resize"),null!=i.resizePreviewElement.parentNode&&i.resizableRegion.parentNode.removeChild(i.resizePreviewElement)}),this.viewModel.panelMaximized.bind(this,function(e){e?$(i.resizableRegion).attr("data-maximized","true"):$(i.resizableRegion).attr("data-maximized","false")}),this.viewModel.statusRegion?($(this.statusRegionElement).attr("data-region-name",this.viewModel.statusRegion),$(this.statusRegionElement).attr("data-region-adapter",this.viewModel.statusRegionType)):this.statusRegionElement&&this.statusRegionElement.parentNode&&(this.statusRegionElement.parentNode.removeChild(this.statusRegionElement),this.statusRegionElement=null),this._initializeEvents(),this.app.command("MaximizePanel").register(this,function(e){return i._togglePanelMaximized(e,"maximize")},this._canExecuteMaximizeRestoreOperations),this.app.command("RestorePanel").register(this,function(e){return i._togglePanelMaximized(e,"restore")},this._canExecuteMaximizeRestoreOperations)},i.prototype._initializeEvents=function(){var e=this,t=this.app.event("PanelRegionRestoredEvent").subscribe(this,function(t){t===e.resizableRegion&&e.viewModel.panelMaximized.set(!1)}),i=this.app.event("PanelRegionMaximizedEvent").subscribe(this,function(t){t===e.resizableRegion&&e.viewModel.panelMaximized.set(!0)});if(this.trackSubscription(this.app.event("PanelRegionRestoredEvent"),t),this.trackSubscription(this.app.event("PanelRegionMaximizedEvent"),i),this.viewModel.statusRegion){var n=this.app.event("RegionActivatedEvent").subscribe(this,this._handleRegionActivatedOrDeactivated),a=this.app.event("RegionDeactivatedEvent").subscribe(this,this._handleRegionActivatedOrDeactivated);this.trackSubscription(this.app.event("RegionActivatedEvent"),n),this.trackSubscription(this.app.event("RegionDeactivatedEvent"),a)}},i.prototype._handleRegionActivatedOrDeactivated=function(e){var t=this.viewModel?this.viewModel.statusRegion:null;e&&e.name===t&&this.delayedResize()},i.prototype._togglePanelMaximized=function(e,t){e===this.id&&"maximize"===t&&this.maximizePanel(),e===this.id&&"restore"===t&&this.minimizePanel()},i.prototype._canExecuteMaximizeRestoreOperations=function(){return!!this.viewModel.showingMaximizeButton.get()},i.prototype._handleViewActivatedInContainerEvent=function(e){if(t.prototype._handleViewActivatedInContainerEvent.call(this,e),this.viewModel&&this.viewModel.getDescriptorForActiveView(e))if(e instanceof i==!0){e.setParentPanel(this);var n=e.viewModel.currentView;n&&n.viewModel&&n.isActive&&this.hoistMenuForView(n)}else{for(var a,o=this._parentPanel;o;)o.viewModel.headerIsVisible.get()&&(a=o),o=o._parentPanel;if(a)return void a.hoistMenuForView(e);this.hoistMenuForView(e)}},i.prototype.activated=function(){t.prototype.activated.call(this)},i.prototype.deactivated=function(){t.prototype.deactivated.call(this)},i.prototype.destroy=function(){t.prototype.destroy.call(this),this._unsubscribeMenuItemInvokedSubscription();for(var e in this._menuViews)this._menuViews.hasOwnProperty(e)&&this.app.viewManager.destroyView(this._menuViews[e]);this._menuViews=null,this._parentPanel=null},i.prototype.openHoistedMenuInRegion=function(e){this._destroyHoistedMenuOwnerViewIfExists(),this.hoistedMenuOwnerView=this.createMenuView(this.viewModel.hoistedMenuViewModel.get()),this.hoistedMenuOwnerView.regionName=e,this.app.viewManager.activateView(this.hoistedMenuOwnerView)},i.prototype.resolveWidget=function(e,t,i){if("SmartPanelHoistedMenu"===e){if(!this.hoistedMenuId)return;return this._destroyHoistedMenuOwnerViewIfExists(),this.hoistedMenuOwnerView=this.createMenuView(t),this.viewModel.menuRegion?null:this.hoistedMenuOwnerView}return null},i.prototype.createMenuView=function(e){var t=this,i=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/menus/MenuView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.menus.MenuView",libraryId:"Mapping.Infrastructure"});i.libraryId=this.libraryId,i.configuration.menuId=this.hoistedMenuId,e&&(i.attach(e),this.auto(e.hasExecutableMenuItems,this,function(e){e||t.viewModel.menuRegion||t.viewModel.inlineMenuIsOpen.set(!1)})),this._menuViews[i.id]=i,this._unsubscribeMenuItemInvokedSubscription(),this._menuItemInvokedSubscriptionToken=this.app.event("MenuItemInvokedEvent").subscribe(this,function(e){e.menuView.id in t._menuViews&&(t.viewModel.menuRegion||t.viewModel.inlineMenuIsOpen.set(!1),t.app.viewManager.deactivateView(e.menuView))});var n=this.app.event("ViewDeactivatedEvent").subscribe(this,function(e){e===i&&(t.app.event("ViewDeactivatedEvent").unsubscribe(n),e.viewModel=null,t.app.viewManager.destroyView(e),delete t._menuViews[i.id])});return e.menuContext.pulse(),i},i.prototype.handleTapMenuButton=function(){var e=this;if(this.viewModel.menuRegion)if(this.hoistedMenuOwnerView&&this.hoistedMenuOwnerView.regionName===this.viewModel.menuRegion&&this.hoistedMenuOwnerView.isActive){var t=this.hoistedMenuOwnerView.viewModel&&this.hoistedMenuOwnerView.viewModel.menuSourceView;this._destroyHoistedMenuOwnerViewIfExists(),t&&this.app.viewManager.activateView(t)}else this.openHoistedMenuInRegion(this.viewModel.menuRegion);else if(this.viewModel.inlineMenuIsOpen.set(!this.viewModel.inlineMenuIsOpen.get()),this.viewModel.inlineMenuIsOpen.get()){this.app.event("FlyoutActivated").publish(this);var i={view:this.hoistedMenuOwnerView,onOtherInteracted:function(t){$(t.srcElement||t.target).hasClass("menu-button")||e.viewModel.inlineMenuIsOpen.set(!1),e.app.event("FlyoutDeactivated").publish(e)}};this.app.command("TapToDismiss").execute(i)}},i.prototype.hoistMenuForView=function(e){var t=this;if(e!==this.hoistedMenuOwnerView){var n=this.app.menuRegistry.getMenuWidgetsForView(e);if(n&&(n=n.filter(function(e){return e.hoistMenu})),!n||!n.length)return this.viewModel.inlineMenuIsOpen.get()&&this.viewModel.inlineMenuIsOpen.set(!1),this.viewModel.hasHoistedMenu.set(!1),this.viewModel.hoistedMenuViewModel.set(a.SmartPanelViewModel.emptyMenuViewModel),this.viewModel.hasExecutableMenuItems.removeSync(),void this.viewModel.hasExecutableMenuItems.set(!1);var r=n[0],s=new o.MenuViewModel(this.app,this.libraryId);s.menuSourceView=e,r.context&&r.context.isObservable?s.menuContext.sync(r.context):s.menuContext.sync(r.widgetViewModel.menuContext),this.hoistedMenuId=r.menuId,this.viewModel.hoistedMenuViewModel.get()&&this.viewModel.hoistedMenuViewModel.get().destroy(),this.viewModel.hoistedMenuViewModel.set(s),this.viewModel.hasHoistedMenu.set(!0),this.viewModel.hasExecutableMenuItems.sync(s.hasExecutableMenuItems);var l=$(r.domElement);l.addClass(i.HoistedClassName);var d=this.app.event("ViewUnhostedEvent").subscribe(this,function(i){i.view===e&&(t.app.event("ViewUnhostedEvent").unsubscribe(d),l.removeClass("hidden-hoisted-menu"))})}},i.prototype.setParentPanel=function(e){this._parentPanel=e},i.prototype.handleMaximizeToggleClick=function(e,t,i){this.viewModel.panelMaximized.get()?this.minimizePanel():this.maximizePanel()},i.prototype.maximizePanel=function(){this.viewModel.panelMaximized.set(!0),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish(),this.app.event("PanelRegionMaximizedEvent").publish(this.resizableRegion)},i.prototype.minimizePanel=function(){this.viewModel.panelMaximized.set(!1),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish(),this.app.event("PanelRegionRestoredEvent").publish(this.resizableRegion)},i.prototype._unsubscribeMenuItemInvokedSubscription=function(){this._menuItemInvokedSubscriptionToken&&(this.app.event("MenuItemInvokedEvent").unsubscribe(this._menuItemInvokedSubscriptionToken),this._menuItemInvokedSubscriptionToken=null)},i.prototype.handleHeaderMouseDown=function(e,t,i){var n=this;if(this.viewModel.panelMaximized.get())return!0;if(e.target!==e.currentTarget)return!0;$(this.app.getHostElement()).off("mouseup.header-click touchend.header-click");var a=!0;return $(this.app.getHostElement()).one("mouseup.header-click touchend.header-click",function(){a=!1}),setTimeout(function(){a&&n.resizableRegion&&($(n.app.getHostElement()).off("mouseup.header-click touchend.header-click"),n.resizeSmartPanel(e.pageX,e.pageY),e.preventDefault())},250),e.preventDefault(),e.stopImmediatePropagation(),!0},i.prototype.handleHeaderTouchStart=function(e,t,i){var n=this;if(this.viewModel.panelMaximized.get())return!0;for(var a=e.target||e.srcElement;a!=this.root;){if($(a).is("button")&&!$(a).hasClass("resize-handle"))return!0;a=a.parentElement}$(this.app.getHostElement()).off("touchend.header-click");var o=!0;return $(this.app.getHostElement()).one("touchend.header-click",function(){o=!1}),setTimeout(function(){o&&n.resizableRegion&&(e.preventDefault(),$(n.app.getHostElement()).off("touchend.header-click"),n.resizeSmartPanel(e.targetTouches[0].pageX,e.targetTouches[0].pageY))},250),e.preventDefault(),!0},i.prototype.resize=function(){if(this.headerElement&&this.scrollRegionElement&&this.containerElement){var e=$(this.statusRegionElement),t=$(this.headerElement),i=$(this.footerElement),n=$(this.scrollRegionElement),a=e.length&&"none"!==e.css("display")?e.outerHeight():0,o=t.length&&"none"!==t.css("display")?t.outerHeight():0,r=i.length&&"none"!==i.css("display")?i.outerHeight():0;o+=a,"relative"!==n.css("position")&&n.css("top",o+"px"),n.css("bottom",r+"px")}},i.prototype.resizeSmartPanel=function(e,t){var i=this;if(this.resizeX||this.resizeY){var n={};n.initialX=e,n.initialY=t,this.app.event("PanelResizeStartEvent").publish({viewId:this.id,resizeInformation:n}),null!==this.resizePreviewElement&&void 0!==this.resizePreviewElement||(this.resizePreviewElement=document.createElement("div"),this.resizePreviewElement.className="resize-hint"),null===this.resizePreviewElement.parentElement&&(this.app.getHostElement().appendChild(this.resizePreviewElement),$(this.resizePreviewElement).css("left",this.root.getBoundingClientRect().left)),n.initialPanelHeight=$(this.resizableRegion).height(),n.initialPanelWidth=$(this.resizableRegion).width(),(0===n.initialPanelHeight||n.initialPanelHeight>$(this.resizableRegion.parentElement).height())&&(n.initialPanelHeight=$(this.resizableRegion.parentElement).height()),(0===n.initialPanelWidth||n.initialPanelWidth>$(this.resizableRegion.parentElement).width())&&(n.initialPanelWidth=$(this.resizableRegion.parentElement).width()),this.resizeX?($(this.resizePreviewElement).width(n.initialPanelWidth),$(this.resizePreviewElement).height(n.initialPanelHeight),n.minWidth=parseInt($(this.resizableRegion).css("min-width")),n.maxWidth=parseInt($(this.resizableRegion).css("max-width"))):this.resizeY&&($(this.resizePreviewElement).width(n.initialPanelWidth),$(this.resizePreviewElement).height(n.initialPanelHeight),n.minHeight=parseInt($(this.resizableRegion).css("min-height")),n.maxHeight=parseInt($(this.resizableRegion).css("max-height"))),this._resizeAccordingToSizeConstraints(n,this.resizePreviewElement),$(this.app.getHostElement()).one("mouseup.header-resize touchend.header-resize",function(e){return i._handleResizeEnd(e,n)}),$(this.app.getHostElement()).on("mousemove.header-resize ",function(e){return i.app.event("PanelResizingEvent").publish({viewId:i.id,resizeInformation:n}),n.currentX=e.pageX,n.currentY=e.pageY,i._resizeAccordingToSizeConstraints(n,i.resizePreviewElement),e.preventDefault(),!1}),$(this.app.getHostElement()).on("touchmove.header-resize",function(e){i.app.event("PanelResizingEvent").publish({viewId:i.id,resizeInformation:n});var t=e.originalEvent;return n.currentX=t.targetTouches[0].pageX,n.currentY=t.targetTouches[0].pageY,i._resizeAccordingToSizeConstraints(n,i.resizePreviewElement),e.preventDefault(),!1})}else this.app.trace.debug("This panel is not configured to be resizable!")},i.prototype._handleResizeEnd=function(e,t){$(this.app.getHostElement()).off("mousemove.header-resize touchmove.header-resize"),this.resizePreviewElement.parentNode&&this.resizePreviewElement.parentNode.removeChild(this.resizePreviewElement),this._resizeAccordingToSizeConstraints(t,this.resizableRegion),this.app.event("PanelResizeEndEvent").publish({viewId:this.id,resizeInformation:t}),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish()},i.prototype._resizeAccordingToSizeConstraints=function(e,t){if(this.resizeX){var i=e.initialPanelWidth+(e.currentX-e.initialX);i<e.minWidth?$(t).width(e.minWidth):i>e.maxWidth?$(t).width(e.maxWidth):$(t).width(i)}if(this.resizeY){var n=e.initialPanelHeight+(e.initialY-e.currentY);n<e.minHeight?$(t).height(e.minHeight):n>e.maxHeight?$(t).height(e.maxHeight):$(t).height(n)}},i.prototype._destroyHoistedMenuOwnerViewIfExists=function(){if(this.hoistedMenuOwnerView){var e=this.hoistedMenuOwnerView;this.hoistedMenuOwnerView=null,e.viewModel=null,this.app.viewManager.destroyView(e),delete this._menuViews[e.id]}},i}(n.ViewContainerView);r.HoistedClassName="hidden-hoisted-menu",i.SmartPanelView=r})},"geocortex/infrastructure/ui/components/SmartPanel/SmartPanelViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework-ui/ViewContainer/ViewContainerViewModel","./../../../menus/MenuViewModel","geocortex/framework/observables"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,n){var r=t.call(this,e,n)||this;return r.hoistedMenuViewModel=new o.Observable(i.emptyMenuViewModel),r.hasHoistedMenu=new o.Observable(!1),r.hasExecutableMenuItems=new o.Observable(!1),r.inlineMenuIsOpen=new o.Observable(!1),r.panelMaximized=new o.Observable(!1),r.showingMaximizeButton=new o.Observable(!1),r.resizeX=!1,r.resizeY=!1,i.emptyMenuViewModel||(i.emptyMenuViewModel=new a.MenuViewModel(e,n)),r}return e(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),this.statusRegion=e.statusRegionName,this.statusRegionType=e.statusRegionType||"geocortex.framework.ui.DivRegionAdapter",e.resizeX&&(this.resizeX=e.resizeX),e.resizeY&&(this.resizeY=e.resizeY),this.menuRegion=e.menuRegion||null,void 0!=e.showMaximizeButton&&this.showingMaximizeButton.set(e.showMaximizeButton)},i}(n.ViewContainerViewModel);i.SmartPanelViewModel=r})},"geocortex/infrastructure/ui/components/Table/SortState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.UNSORTED=0]="UNSORTED",e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=2]="DESCENDING"}(t.SortState||(t.SortState={}))})},"geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModel":function(){define(["require","exports","geocortex/framework/observables","./SortState","./../../../FormatUtils"],function(e,t,i,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,a,o,r,s){this.visible=new i.Observable(!0),this.value=new i.Observable(""),this.presentableValue=new i.Observable(""),this.columnDescriptor=new i.Observable(""),this.sortState=new i.Observable(n.SortState.UNSORTED),this.sortClass=new i.Observable(""),this._sortingPredicate=null,this._reverseSortingPredicate=null,this.app=e,this.libraryId=t,this.value.set(o),this.presentableValue.set(o),this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-unsorted").format(this.presentableValue.get())),this._sharedState=a,"DateTime"===r?(this._sortingPredicate=this.buildDateSortingFunction(s),this._reverseSortingPredicate=this.buildReverseDateSortingFunction(s)):(this._sortingPredicate=this.buildSortingFunction(s),this._reverseSortingPredicate=this.buildReverseSortingFunction(s)),this.sortClass.syncTransform(this.sortState,function(e){switch(e){case 0:return a.unsortedClass;case 1:return a.sortedClass;case 2:return a.reverseSortedClass}return a.unsortedClass}),this.sortState.bind(this,this.onSortStateChange)}return e.prototype.buildSortingFunction=function(e){return function(i,n){return t.collator(i.attributes.getAt(e).presentableValue.get(),n.attributes.getAt(e).presentableValue.get())}},e.prototype.buildReverseSortingFunction=function(e){return function(i,n){return t.collator(n.attributes.getAt(e).presentableValue.get(),i.attributes.getAt(e).presentableValue.get())}},e.prototype.buildDateSortingFunction=function(e){return function(i,n){var o=i.attributes.getAt(e).value.get(),r=n.attributes.getAt(e).value.get(),s=a.parseDate(o),l=a.parseDate(r),d="Invalid Date"!=s;return d!==("Invalid Date"!=l)?d?-1:1:d?s.getTime()-l.getTime():t.collator(o,r)}},e.prototype.buildReverseDateSortingFunction=function(e){return function(i,n){var o=n.attributes.getAt(e).value.get(),r=i.attributes.getAt(e).value.get(),s=a.parseDate(o),l=a.parseDate(r),d="Invalid Date"!=s;return d!==("Invalid Date"!=l)?d?-1:1:d?s.getTime()-l.getTime():t.collator(o,r)}},e.prototype.onSortStateChange=function(e){if(!this._sharedState.ignoreStateChange){if(e<n.SortState.UNSORTED||e>n.SortState.DESCENDING)throw new Error("Illegal column sort state: "+e);if(0==e){if(this._sharedState.lastSortedColumn!=this)throw new Error("Column sort state out of sync");this._sharedState.lastSortedColumn=null,this._sharedState.presentableResults.sortingPredicate=null,this._sharedState.presentableResults.unsortCollection(),this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-unsorted").format(this.presentableValue.get()))}else{if(null!=this._sharedState.lastSortedColumn&&this._sharedState.lastSortedColumn!=this&&(this._sharedState.ignoreStateChange=!0,this._sharedState.lastSortedColumn.sortState.set(n.SortState.UNSORTED),this._sharedState.ignoreStateChange=!1),this._sharedState.lastSortedColumn=this,e==n.SortState.ASCENDING)this._sharedState.presentableResults.sortingPredicate=this._sortingPredicate,this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-sorted-ascending").format(this.presentableValue.get()));else{if(e!=n.SortState.DESCENDING)throw new Error("Invalid column sort state.");this._sharedState.presentableResults.sortingPredicate=this._reverseSortingPredicate,this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-sorted-descending").format(this.presentableValue.get()))}this._sharedState.presentableResults.sortCollection()}}},e}();t.TableColumnHeaderViewModel=o,t.manualCollator=function(e,t){return isNaN(e)||isNaN(t)?e<t?-1:e>t?1:0:+e-t},t.collator="object"==typeof Intl&&"function"==typeof Intl.Collator?new Intl.Collator(void 0,{numeric:!0}).compare:t.manualCollator;var r=function(){function e(e,t,i,n){this.lastSortedColumn=null,this.presentableResults=e,this.unsortedClass=t,this.sortedClass=i,this.reverseSortedClass=n,this.reset()}return e.prototype.reset=function(){this.ignoreStateChange=!1,this.lastSortedColumn=null},e}();t.SharedState=r})},"geocortex/infrastructure/ui/components/Table/TableColumnHeaderViewModelInterface":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./TableColumnViewModelInterface"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i}(n.TableColumnViewModelInterface);i.TableColumnHeaderViewModelInterface=a})},"geocortex/infrastructure/ui/components/Table/TableColumnViewModelInterface":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){}}();t.TableColumnViewModelInterface=i})},"geocortex/infrastructure/ui/components/Table/TableRowViewModelInterface":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/Table/TableView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase","./../../../ShellUtils"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.tableContainerElement=null,e._itemClass="results-table-row-item",e._longPressTimer=null,e._pressStartTime=null,e._firedTouchOrPress=!1,e._hoverTimerToken=null,e._hoveredFeature=null,e._pressYStart=null,e._lastTouchY=null,e._scrollYDeltaThreshold=35,e._firstEvent=null,e}return e(i,t),i.prototype.handleColumnHeadClick=function(e,t,i){i.sortState.set((i.sortState.get()+1)%3)},i.prototype.handleMouseDown=function(e,t,i){return this._beginLongPressIfNoEventsInProgress(i,"mouse-down"),!0},i.prototype.handleMouseUp=function(e,t,i){return this._cancelLongPressIfEventInProgress("mouse-down"),!0},i.prototype.handleMouseOver=function(e,t,i){a.hasClass(e.currentTarget,this._itemClass)&&this._beginHover(i)},i.prototype.handleMouseOut=function(e,t,i){a.hasClass(e.currentTarget,this._itemClass)&&(this._cancelHover(),this._tryFireHoverStop(i),this._cancelLongPressIfEventInProgress("mouse-down"))},i.prototype.handleTouchStart=function(e,t,i){return this._beginLongPressIfNoEventsInProgress(i,"touch-start"),!0},i.prototype.handleTouchMove=function(e,t,i){return this.handleTouchEnd(e,t,i)},i.prototype.handleTouchEnd=function(e,t,i){return this._cancelLongPressIfEventInProgress("touch-start"),!0},i.prototype.handleClick=function(e,t,i){var n=this;return this.viewModel&&this.viewModel.recordClickEvents.length&&this.viewModel.recordClickEvents.forEach(function(e){return n.app.event(e).publish(i)}),!0},i.prototype.handleClickAttributelink=function(e,t,i){return this.app.followNavigationLink({url:i.value.get(),element:t})},i.prototype._beginLongPressIfNoEventsInProgress=function(e,t){this._firstEvent||(this._firstEvent=t,this._beginLongPress(e))},i.prototype._cancelLongPressIfEventInProgress=function(e){this._firstEvent===e&&(this._firstEvent=null,this._cancelLongPress())},i.prototype._beginLongPress=function(e){var t=this;this._cancelLongPress(),this.viewModel&&this.viewModel.recordLongPressEvents.length&&(this._longPressTimer=setTimeout(function(){t.viewModel.recordLongPressEvents.forEach(function(i){t.app.event(i).publish(e)})},this.viewModel.recordLongPressDuration||1e3))},i.prototype._cancelLongPress=function(){this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null)},i.prototype._beginHover=function(e){var t=this;this._hoverTimerToken&&clearTimeout(this._hoverTimerToken),this._hoverTimerToken=setTimeout(function(){t._hoveredFeature!==e&&(t._hoveredFeature=e),t.viewModel.recordHoverEvents.forEach(function(i){t.app.event(i).publish(e)})},this.viewModel.recordHoverDuration||0)},i.prototype._cancelHover=function(){this._hoverTimerToken&&(clearTimeout(this._hoverTimerToken),this._hoverTimerToken=null)},i.prototype._tryFireHoverStop=function(e){var t=this;this._hoveredFeature===e&&(this._hoveredFeature=null,this.viewModel.recordHoverEndEvents.forEach(function(i){t.app.event(i).publish(e)}))},i}(n.ViewBase);i.TableView=o})},"geocortex/infrastructure/ui/components/Table/TableViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/framework-ui/PresentableCollection"],function(t,i,n,a,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.columnHeaders=new a.ObservableCollection([]),n.records=new a.ObservableCollection([]),n.presentableRecordCollection=null,n.recordClickEvents=[],n.recordLongPressEvents=[],n.recordHoverEvents=[],n.recordHoverEndEvents=[],n.recordLongPressDuration=1e3,n.recordHoverDuration=0,n}return e(i,t),i.prototype.attachToPresentableCollection=function(e){e&&e instanceof o.PresentableCollection&&(this.presentableRecordCollection=e,this.records=this.presentableRecordCollection.items)},i.prototype.addRecordClickEvents=function(e){this._executeAddEvents(e,0)},i.prototype.addRecordLongPressEvents=function(e){this._executeAddEvents(e,1)},i.prototype.addRecordHoverEvents=function(e){this._executeAddEvents(e,2)},i.prototype.addRecordHoverEndEvents=function(e){this._executeAddEvents(e,3)},i.prototype._executeAddEvents=function(e,t){var i=this,n=function(e){e&&"string"==typeof e&&(0===t?(i.recordClickEvents=i.recordClickEvents.filter(function(t){return t!==e}),i.recordClickEvents.push(e)):1===t?(i.recordLongPressEvents=i.recordLongPressEvents.filter(function(t){return t!==e}),i.recordLongPressEvents.push(e)):2===t?(i.recordHoverEvents=i.recordHoverEvents.filter(function(t){return t!==e}),i.recordHoverEvents.push(e)):3===t&&(i.recordHoverEndEvents=i.recordHoverEndEvents.filter(function(t){return t!==e}),i.recordHoverEndEvents.push(e)))};e&&dojo.isArray(e)?e.forEach(function(e){return n(e)}):n(e)},i}(n.ViewModelBase);i.TableViewModel=r})},"geocortex/infrastructure/ui/components/WizardPanel/ValidationHandler":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/framework-ui/ViewContainer/ViewContainerView"],function(t,i,n,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.attach=function(e){var i=this;t.prototype.attach.call(this,e),this._viewContainerActivatedEventToken||(this._viewContainerActivatedEventToken=this.app.event("ViewContainerActivatedEvent").subscribe(this,function(e){null==i.parentContainer&&i._isViewHostedInContainer(e)&&(i.parentContainer=e)}))},i.prototype._isViewHostedInContainer=function(e){if(e instanceof a.ViewContainerView){var t=e.viewModel.regionName.get(),i=this.app.viewManager.getRegionForViewId(this.id);if(i&&i.name===t)return!0}return!1},i.prototype.finishWizard=function(){this.parentContainer&&this.parentContainer.finish()},i.prototype.cancelWizard=function(){this.parentContainer&&this.parentContainer.cancel()},i.prototype.destroy=function(){t.prototype.destroy.call(this),this._viewContainerActivatedEventToken&&(this.app.event("ViewContainerActivatedEvent").unsubscribe(this._viewContainerActivatedEventToken),this._viewContainerActivatedEventToken=null),this.parentContainer&&(this.parentContainer=null)},i.prototype._validator=function(){return[]},i.prototype.validate=function(e){return this.validationProblems=this._validator(),this.validationProblems.length<1},i.prototype.reset=function(){this.viewModel.reset()},i.prototype.loadState=function(){},i.prototype.saveState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},i.prototype.goNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("This method is abstract")},i.prototype.goBack=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("This method is abstract")},i}(n.ViewBase);i.WizardFragmentView=o})},"geocortex/infrastructure/ui/components/WizardPanel/WizardFragmentViewModel":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/ui/components/WizardPanel/WizardPanelView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../SmartPanel/SmartPanelView"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.finish=function(){this.viewModel.closeAllViews()},i.prototype.cancel=function(){this.viewModel.closeAllViews(!0)},i.prototype.handleClickBack=function(e,i,n){t.prototype.handleClickBack.call(this,e,i,n)},i.prototype.handleClickClose=function(e,i,n){t.prototype.handleClickClose.call(this,e,i,n),this.cancel()},i}(n.SmartPanelView);i.WizardPanelView=a})},"geocortex/infrastructure/ui/components/WizardPanel/WizardPanelViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../SmartPanel/SmartPanelViewModel"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.showOrHideCloseButtons=function(){var e=this.viewDescriptors.getAt(0);if(e){var t=this.currentView===e.view;this.showingBackButton.set(!t),this.showingXButton.set(!0)}},i.prototype.closeAllViews=function(e){for(var t=0;t<this.viewDescriptors.length();t++){var i=this.viewDescriptors.getAt(t).view,n=i.viewModel;this._isWizardFragment(n)&&n.reset(),this.app.viewManager.deactivateView(i)}},i.prototype._isWizardFragment=function(e){return void 0!==e.reset},i}(n.SmartPanelViewModel);i.WizardPanelViewModel=a})},"url:/Mapping/infrastructure/ui/components/ColorPicker/ColorPickerWidget.html":markup1,"url:/Mapping/infrastructure/ui/components/FilterControl/FilterControlView.html":markup2,"url:/Mapping/infrastructure/ui/components/Forms/AutoCompleteBoxFormItemView.html":markup3,"url:/Mapping/infrastructure/ui/components/Forms/CheckBoxFormItemView.html":markup4,"url:/Mapping/infrastructure/ui/components/Forms/ComboBoxFormItemView.html":markup5,"url:/Mapping/infrastructure/ui/components/Forms/ContainerFormItemView.html":markup6,"url:/Mapping/infrastructure/ui/components/Forms/DatePickerFormItemView.html":markup7,"url:/Mapping/infrastructure/ui/components/Forms/FilePickerFormItemView.html":markup8,"url:/Mapping/infrastructure/ui/components/Forms/FormItemView.html":markup9,"url:/Mapping/infrastructure/ui/components/Forms/GroupBoxFormItemView.html":markup10,"url:/Mapping/infrastructure/ui/components/Forms/HyperlinkFormItemView.html":markup11,"url:/Mapping/infrastructure/ui/components/Forms/ImageFormItemView.html":markup12,"url:/Mapping/infrastructure/ui/components/Forms/ListBoxFormItemView.html":markup13,"url:/Mapping/infrastructure/ui/components/Forms/MarkdownFormItemView.html":markup14,"url:/Mapping/infrastructure/ui/components/Forms/RadioButtonFormItemView.html":markup15,"url:/Mapping/infrastructure/ui/components/Forms/TextAreaFormItemView.html":markup16,"url:/Mapping/infrastructure/ui/components/Forms/TextBoxFormItemView.html":markup17,"url:/Mapping/infrastructure/ui/components/Forms/TimePickerFormItemView.html":markup18,"url:/Mapping/infrastructure/ui/components/NumericInput/NumericInputWidget.html":markup19,"url:/Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html":markup20,"url:/Mapping/infrastructure/ui/components/Slider/SliderView.html":markup21,"url:/Mapping/infrastructure/ui/components/SmartPanel/SmartPanelView.html":markup22,"url:/Mapping/infrastructure/ui/components/Table/TableView.html":markup23}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/FilterControl/CSS/common.css","css","LmZpbHRlci1jb250cm9sLA0KLmZpbHRlci1jb250cm9sLXNlYXJjaCB7DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouZmlsdGVyLWNvbnRyb2wgew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwYWRkaW5nOiAwLjVlbTsNCiAgICBiYWNrZ3JvdW5kOiAjRjhGOEY4Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRDlEOUQ5Ow0KfQ0KDQouZmlsdGVyLWNvbnRyb2wtc2VhcmNoIHsNCiAgICB6LWluZGV4OiAyMDA7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0NDQ0NDQzsNCiAgICBib3JkZXItcmFkaXVzOiAwLjI1cmVtOw0KICAgIGhlaWdodDogMi41ZW07DQp9DQoNCi5maWx0ZXItY29udHJvbC1zZWFyY2ggLnNlYXJjaC1maWVsZCB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgd2lkdGg6IGNhbGMoMTAwJSAtIDQuN2VtKTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgcGFkZGluZzogMC4wNWVtIDAuMjVlbSAwLjEwZW0gMC4yNWVtOw0KICAgIGZvbnQtc2l6ZTogMS42ZW07DQogICAgYm9yZGVyOiBub25lOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW0gMCAwIDAuMjVyZW07DQp9DQoNCi5rLWVkZ2UgLmZpbHRlci1jb250cm9sLXNlYXJjaCAuc2VhcmNoLWZpZWxkIHsNCiAgICBmb250LXNpemU6IDFlbTsNCn0NCg0KLmZpbHRlci1jb250cm9sLXNlYXJjaCAuc3RhdHVzLWltZyB7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9sb2FkZXItc21hbGwuZ2lmKSBjZW50ZXIgY2VudGVyIG5vLXJlcGVhdDsNCiAgICB3aWR0aDogMi41ZW07DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgcmlnaHQ6IDcuNWVtOw0KfQ0KDQouZmlsdGVyLWNvbnRyb2wtc2VhcmNoIC5jbGVhci1idXR0b24gew0KICAgIGJhY2tncm91bmQ6ICNGRkZGRkYgdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvZGVsZXRlLTE2LnBuZykgY2VudGVyIGNlbnRlciBuby1yZXBlYXQ7DQogICAgd2lkdGg6IDIuNWVtOw0KICAgIGhlaWdodDogMTAwJTsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHJpZ2h0OiA1ZW07DQp9DQoNCi5maWx0ZXItY29udHJvbC1zZWFyY2ggLmZpbHRlci1idXR0b24gew0KICAgIGhlaWdodDogMTAwJTsNCiAgICB3aWR0aDogNWVtOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgcmlnaHQ6IDA7DQogICAgcGFkZGluZzogLjVlbTsNCiAgICBiYWNrZ3JvdW5kOiAjRjVGNUY1Ow0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgY29sb3I6ICMxQTcyQzQ7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGxpbmUtaGVpZ2h0OiAxMDAlOw0KICAgIGJvcmRlci1yYWRpdXM6IDAgMC4yNXJlbSAwLjI1cmVtIDA7DQogICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjQ0NDQ0NDOw0KICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCn0="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/CSS/common.css","css","DQovKiBGT1JNIElURU1TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQouZm9ybS1jb250YWluZXIgKiB7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsgLyogU3RhbmRhcmRpemUgdGhlIGJveCBtb2RlbCBmb3IgZm9ybSBpdGVtcyAqLw0KICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCmlucHV0LA0Kc2VsZWN0LA0KdGV4dGFyZWEsDQouZm9ybS1sYWJlbCwNCi5jaGVja2JveC1ncm91cCwNCi5yYWRpby1ncm91cCB7DQogICAgcGFkZGluZzogMC4zZW07DQp9DQpzZWxlY3Qgew0KICAgIHBhZGRpbmc6IDA7DQogICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICBjb2xvcjogIzAwMDAwMDsNCn0NCg0KaW5wdXRbdHlwZT0ndGV4dCddLA0KaW5wdXRbdHlwZT0nZGF0ZSddLA0KaW5wdXRbdHlwZT0nZGF0ZXRpbWUnXSwNCmlucHV0W3R5cGU9J3Bhc3N3b3JkJ10sDQpzZWxlY3QsDQp0ZXh0YXJlYSB7DQogICAgbWF4LXdpZHRoOiAxMDAlOyAvKiBEb24ndCBleGNlZWQgdGhlIHdpZHRoIG9mIHRoZSBjb250YWluZXIgKi8NCiAgICB3aWR0aDogMTAwJTsNCiAgICBvdXRsaW5lOiBub25lOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNBQUFBQUE7DQogICAgYm9yZGVyLXJhZGl1czogMnB4Ow0KfQ0KaW5wdXRbdHlwZT0nZGF0ZSddIHsNCiAgICB3aWR0aDogNjAlOw0KfQ0KaW5wdXRbdHlwZT0nY2hlY2tib3gnXSwNCmlucHV0W3R5cGU9J3JhZGlvJ10gew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQpmaWVsZHNldCB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IC41ZW0gLjc1ZW0gLjc1ZW0gLjc1ZW07DQogICAgYm9yZGVyLXJhZGl1czogMC4yNXJlbTsNCn0NCg0KZmllbGRzZXQgbGVnZW5kew0KDQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCn0NCg0Kc2VsZWN0IHsNCiAgICBtaW4td2lkdGg6IDEwMHB4Ow0KfQ0KDQp0ZXh0YXJlYSB7DQogICAgaGVpZ2h0OiA1ZW07DQogICAgcmVzaXplOiBub25lOw0KfQ0KDQouZm9ybS1pdGVtIHsNCiAgICBwYWRkaW5nOiAuNWVtIDAuMWVtIDAuNWVtIDA7DQp9DQoNCi5mb3JtLWl0ZW06YWZ0ZXIgew0KICAgIGNsZWFyOiBib3RoOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMDsNCiAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQogICAgY29udGVudDogIl8iOw0KfQ0KDQouZm9ybS1sYWJlbCwNCi5mb3JtLWNvbnRyb2wgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KLmZvcm0tbGFiZWwgew0KICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQp9DQoubGFiZWwtbGVmdCAuZm9ybS1sYWJlbCB7DQogICAgbWluLXdpZHRoOiAzMCU7DQp9DQouZm9ybS1ob3Jpem9udGFsIC5sYWJlbC1sZWZ0IC5mb3JtLWxhYmVsIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBwYWRkaW5nOiAwOw0KICAgIG1hcmdpbjogMDsNCiAgICB3aWR0aDogYXV0bzsNCn0NCi5mb3JtLWhvcml6b250YWwgLmZvcm0tbGFiZWwucmlnaHQgew0KICAgIG1hcmdpbi1yaWdodDogMC41ZW07DQp9DQouZm9ybS1ob3Jpem9udGFsIC5mb3JtLWxhYmVsLmJvdW5kLWludmlzaWJsZSB7DQogICAgZGlzcGxheTogbm9uZTsNCn0NCi5mb3JtLWhvcml6b250YWwgc2VsZWN0LA0KLmZvcm0taG9yaXpvbnRhbCBpbnB1dCB7DQogICAgbWluLXdpZHRoOiA0LjZlbTsNCn0NCi5mb3JtLWhvcml6b250YWwgc2VsZWN0IHsNCiAgICBwYWRkaW5nOiAwLjI1ZW07DQp9DQouZm9ybS1ob3Jpem9udGFsIGlucHV0W3R5cGU9Y2hlY2tib3hdLA0KLmZvcm0taG9yaXpvbnRhbCBpbnB1dFt0eXBlPXJhZGlvXSB7DQogICAgbWluLXdpZHRoOiAwOw0KfQ0KLmZvcm0taG9yaXpvbnRhbCA+IC5mb3JtID4gLmZvcm0taXRlbSwgDQouZm9ybS1ob3Jpem9udGFsID4gLmZvcm0taXRlbSB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiBhdXRvOw0KICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgbWFyZ2luLXJpZ2h0OiAwLjI1ZW07DQp9DQouZm9ybS1ob3Jpem9udGFsIC5jaGVja2JveCAuZm9ybS1pdGVtIHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KLmZvcm0tY29udHJvbCB7DQogICAgbWluLXdpZHRoOiA2OS45JTsNCiAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgdGV4dC1hbGlnbjogbGVmdDsNCn0NCi8qLmZvcm0taG9yaXpvbnRhbCAuZm9ybS1jb250cm9sIHNlbGVjdCwNCi5mb3JtLWhvcml6b250YWwgLmZvcm0tY29udHJvbCBpbnB1dCB7DQogICAgd2lkdGg6IGF1dG87DQp9Ki8NCi5mb3JtLWhvcml6b250YWwgLmZvcm0tY29udHJvbCB7IA0KICAgIHdpZHRoOiBhdXRvOw0KfQ0KDQouYXV0b2NvbXBsZXRlIC5mb3JtLWNvbnRyb2wgew0KICAgIHBvc2l0aW9uOiBpbmhlcml0Ow0KfQ0KDQouYXV0b2NvbXBsZXRlLWlucHV0IHsNCiAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouYXV0b2NvbXBsZXRlLW1lbnUgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBtYXJnaW4tdG9wOiAycHg7DQogICAgei1pbmRleDogOTk5Ow0KfQ0KDQouYXV0b2NvbXBsZXRlLW1lbnUgdWwgew0KICAgIG1heC1oZWlnaHQ6IDIwMHB4Ow0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsNCiAgICBvdmVyZmxvdy15OiBzY3JvbGw7DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjOTk5OTk5Ow0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQp9DQoNCi5hdXRvY29tcGxldGUtbWVudSBsaSB7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHdoaXRlLXNwYWNlOiBpbmhlcml0Ow0KfQ0KDQouYXV0b2NvbXBsZXRlLW1lbnUuaW5hY3RpdmUgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5jb21ib2JveCwNCi5saXN0Ym94IHsNCiAgICBtYXgtd2lkdGg6IDEwMCU7DQp9DQoNCi5jb21ib2JveCAubG9hZGVyIHsNCiAgICBsZWZ0OiA2cHg7DQp9DQoNCi5saXN0Ym94IHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IGF1dG87DQp9DQoNCi5saXN0Ym94IC5sb2FkZXIgew0KICAgIGxlZnQ6IDA7DQogICAgd2lkdGg6IDgwcHg7DQp9DQoNCi5jaGVja2JveC1ncm91cCBsYWJlbCwNCi5jaGVja2JveC1ncm91cCBpbnB1dCwNCi5yYWRpby1ncm91cCBsYWJlbCwNCi5yYWRpby1ncm91cCBpbnB1dCB7DQogICAgd2lkdGg6IGF1dG87DQogICAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KLnJhZGlvYnRuIGlucHV0LA0KLmNoZWNrYm94IGlucHV0IHsNCiAgICB3aWR0aDogMWVtOw0KfQ0KLmNoZWNrYm94IHRkLA0KLnJhZGlvYnRuIHRkIHsNCiAgICBwYWRkaW5nOiAwLjNlbTsNCiAgICB3aWR0aDogMWVtOw0KfQ0KLmNoZWNrYm94IC5mb3JtLWxhYmVsLA0KLnJhZGlvYnRuIC5mb3JtLWxhYmVsIHsNCiAgICB3aWR0aDogYXV0bzsNCiAgICBtaW4td2lkdGg6IDAlOw0KfQ0KDQouY2hlY2tib3ggaW5wdXQsDQouY2hlY2tib3ggc3BhbiwNCi5yYWRpb2J0biBpbnB1dCwNCi5yYWRpb2J0biBzcGFuIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KfQ0KDQoNCg0KLmZvcm0tY29udHJvbCAuZGF0ZS1waWNrZXIgew0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5ncm91cGJveCBmaWVsZHNldCB7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzk5OTk5OTsNCn0NCg0KLmh5cGVybGluayBhIHsNCiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7DQp9DQoNCi5mb3JtLWJ0bnMgew0KICAgIG1hcmdpbi10b3A6IC43NWVtOw0KICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KfQ0KDQouZm9ybS1idG5zIGJ1dHRvbiB7DQogICAgbWFyZ2luLWxlZnQ6IDAuMjVlbTsNCn0NCg0KLmZvcm0tYnRucyBpbnB1dFt0eXBlPSdTdWJtaXQnXSB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDAuMjVlbSAuNWVtOw0KICAgIGN1cnNvcjogcG9pbnRlcjsNCn0NCi5maWxlLWlucHV0LA0KLmZpbGUtaW5wdXQtY2xlYXIgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGhlaWdodDogMmVtOw0KfQ0KLmZpbGUtaW5wdXQgew0KICAgIHBhZGRpbmctcmlnaHQ6IDMycHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KLmZpbGUtaW5wdXQtYnJvd3NlciB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KLmZpbGUtaW5wdXQgaW5wdXQge30NCi5maWxlLWlucHV0LWNsZWFyIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgd2lkdGg6IDI0cHg7DQogICAgaGVpZ2h0OiAyNHB4Ow0KICAgIHRvcDogMDsNCiAgICByaWdodDogMDsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2NsZWFyLTI0LnBuZyIpIG5vLXJlcGVhdDsNCiAgICB0ZXh0LWluZGVudDogLTk5OTk5cHg7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIG1hcmdpbjogMC40ZW0gMDsNCn0NCg0KLyogREFURSAtIFRJTUUgUElDS0VSIFZBUklBVElPTlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5kYXRldGltZS1zZWxlY3Qgew0KICAgIC8qd2hpdGUtc3BhY2U6IG5vd3JhcDsqLw0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQp9DQoNCi5kYXRlLXBpY2tlciBzZWxlY3QsDQoudGltZS1waWNrZXIgc2VsZWN0IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IGF1dG87DQogICAgbWFyZ2luOiAwOw0KfQ0KDQouZGF0ZXRpbWUtc2VsZWN0IHNlbGVjdCB7DQogICAgbWluLXdpZHRoOiAwOw0KICAgIHdpZHRoOiBhdXRvOw0KfQ0KDQouZGF0ZXBpY2tlciAuZm9ybS1jb250cm9sIHsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KfQ0KLmRhdGVwaWNrZXIgLmZvcm0tY29udHJvbCA+IGRpdiB7DQogICAgd2lkdGg6IDgwJTsNCn0NCi5kYXRlcGlja2VyIC5mb3JtLWNvbnRyb2wgZGl2IHsNCiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KfQ0KaW5wdXQuaGFzRGF0ZXBpY2tlciB7DQogICAgd2lkdGg6IDgyJTsNCiAgICBmbG9hdDogbGVmdDsNCn0NCi5kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXRyaWdnZXIgew0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2NjY2M7DQogICAgYm9yZGVyLXJhZGl1czogLjI1cmVtOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIGhlaWdodDogYXV0bzsNCiAgICBwYWRkaW5nOiAwLjNlbSAwLjVlbTsNCn0NCi5kYXRldGltZS1idG4tY29udGFpbmVyIHsNCiAgICBkaXNwbGF5OiBpbmxpbmU7DQp9DQoNCmJ1dHRvbi5kYXRldGltZS1idG4gew0KICAgIHdpZHRoOiAyZW07DQogICAgaGVpZ2h0OiAyZW07DQp9DQoNCmJ1dHRvbi5kYXRldGltZS1idG4ubnVsbGlmeSB7DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2NsZWFyLTI0LnBuZyIpIGNlbnRlciBuby1yZXBlYXQ7DQp9DQoNCmJ1dHRvbi5kYXRldGltZS1idG4udW4tbnVsbGlmeSB7DQogICAgYmFja2dyb3VuZDogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2FkZC0yNC5wbmciKSBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KDQoudWktZGF0ZXBpY2tlciB7DQogICAgei1pbmRleDogMTEwMCAhaW1wb3J0YW50Ow0KfQ0KDQoNCi8qIEZPUk0gVkFSSUFUSU9OUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KLmx0ciB7DQogICAgZGlyZWN0aW9uOiBsdHI7DQp9DQoNCi5ydGwgew0KICAgIGRpcmVjdGlvbjogcnRsOw0KfQ0KDQoucnRsIC5mb3JtLWxhYmVsLA0KLnJ0bCAuZm9ybS1jb250cm9sIHsNCiAgICBmbG9hdDogcmlnaHQ7DQp9DQoNCi5ydGwgLmZvcm0tbGFiZWwgew0KICAgIGJvcmRlci1sZWZ0OiAuMjVlbSBzb2xpZCB0cmFuc3BhcmVudDsNCiAgICBib3JkZXItcmlnaHQ6IG5vbmU7DQp9DQoNCi5sYWJlbC1sZWZ0IC5mb3JtLWxhYmVsIHsNCiAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgIHBhZGRpbmc6IDAgMC4zZW0gMCAwOw0KfQ0KDQoubGFiZWwtcmlnaHQgLmZvcm0tbGFiZWwgew0KICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KfQ0KDQoubGFiZWwtc3RhY2tlZCAuZm9ybS1sYWJlbCB7DQogICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICBwYWRkaW5nLWxlZnQ6IDA7DQogICAgcGFkZGluZy1yaWdodDogMDsNCn0NCi5sYWJlbC1zdGFja2VkIC5mb3JtLWxhYmVsLA0KLmxhYmVsLXN0YWNrZWQgLmZvcm0tY29udHJvbCwNCi5lZGl0b3IgLmxhYmVsLXN0YWNrZWQgLmZvcm0tbGFiZWwsDQouZWRpdG9yIC5sYWJlbC1zdGFja2VkIC5mb3JtLWNvbnRyb2wgew0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KLmxhYmVsLXN0YWNrZWQgLmZvcm0tY29udHJvbC1kYXRlLXBpY2tlciAuaGFzRGF0ZXBpY2tlciB7DQogICAgbWF4LXdpZHRoOiAxMDAlOw0KICAgIHdpZHRoOiA5MCU7DQp9DQouZm9ybS1jb250cm9sLWRhdGUtcGlja2VyIGlucHV0W3R5cGU9ZGF0ZV0gew0KICAgIG1hcmdpbi1ib3R0b206IDAuNWVtOw0KfQ0KLmxhYmVsLXN0YWNrZWQgLmZvcm0tY29udHJvbCAuaW5saW5lLWJsb2NrIHsNCiAgICB3aWR0aDogODcuNSU7DQp9DQoubGFiZWwtc3RhY2tlZCAuZm9ybS1jb250cm9sIC5pbmxpbmUtYmxvY2sgKyAuaW5saW5lLWJsb2NrIHsNCiAgICB3aWR0aDogMS41ZW07DQogICAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQoubGFiZWwtdG9wIC5mb3JtLWxhYmVsLA0KLmxhYmVsLXRvcCAuZm9ybS1jb250cm9sIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBmbG9hdDogbm9uZTsNCiAgICBwYWRkaW5nLWxlZnQ6IDA7DQogICAgcGFkZGluZy1yaWdodDogMDsNCiAgICB3aWR0aDogYXV0bzsNCn0NCg0KLmxhYmVsLXRvcCAuZm9ybS1pdGVtIHsNCiAgICBwYWRkaW5nOiAwIDAgLjVlbSAwOw0KfQ0KDQoubHRyIC5mb3JtLWJ1dHRvbnMgew0KICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KfQ0KDQoucnRsIC5mb3JtLWJ1dHRvbnMgew0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQp9DQoNCi5jaGVja2JveCAuZm9ybS1sYWJlbC5yaWdodCwNCi5yYWRpb2J0biAuZm9ybS1sYWJlbC5yaWdodCB7DQogICAgZmxvYXQ6IG5vbmU7DQp9DQouZm9ybS1zdGFja2VkIC5mb3JtLWxhYmVsIHsNCiAgICBwYWRkaW5nLWxlZnQ6IDA7DQogICAgd2lkdGg6IDEwMCU7DQp9DQouZm9ybS1zdGFja2VkIC5mb3JtLWNvbnRyb2wgew0KICAgIHdpZHRoOiAxMDAlOw0KfQ0KDQoNCi8qIFZBTElEQVRJT04gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCi5mb3JtLXZhbGlkYXRpb24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsNCiAgICBtYXJnaW46IDAuNWVtIDA7DQogICAgcGFkZGluZzogMC4yNWVtOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGQkFCQTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjRDgwMDBDOw0KICAgIGNvbG9yOiAjNjYwMDAwOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgd2lkdGg6IDEwMCU7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQouZm9ybS1pdGVtLmludmFsaWQgaW5wdXRbdHlwZT0ndGV4dCddLA0KLmZvcm0taXRlbS5pbnZhbGlkIHNlbGVjdCwNCi5mb3JtLWl0ZW0uaW52YWxpZCB0ZXh0YXJlYSB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkNDQzsNCiAgICBib3JkZXI6IDFweCBzb2xpZCByZWQgIWltcG9ydGFudDsNCn0NCg0KLmZvcm0taXRlbS5pbnZhbGlkIGlucHV0W3R5cGU9J3RleHQnXTpmb2N1cywNCi5mb3JtLWl0ZW0uaW52YWxpZCBzZWxlY3Q6Zm9jdXMsDQouZm9ybS1pdGVtLmludmFsaWQgdGV4dGFyZWE6Zm9jdXMgew0KICAgIGJveC1zaGFkb3c6IDFweCAxcHggMnB4ICNDQ0NDQ0MgaW5zZXQsIDAgMCAycHggUmVkOw0KICAgIC13ZWJraXQtYm94LXNoYWRvdzogMXB4IDFweCAycHggI0NDQ0NDQyBpbnNldCwgMCAwIDJweCBSZWQ7DQp9DQoNCi5pbmRpY2F0b3Igew0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQoNCi5mb3JtLWl0ZW0uaW52YWxpZCAuaW5kaWNhdG9yIHsNCiAgICBjb2xvcjogUmVkOw0KfQ0KDQoNCi8qIEpRVUVSWSBERUZBVUxUUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KDQovKiBMYXlvdXQgaGVscGVycw0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoudWktaGVscGVyLWhpZGRlbiB7IGRpc3BsYXk6IG5vbmU7IH0gLyoudWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIHsgcG9zaXRpb246IGFic29sdXRlICFpbXBvcnRhbnQ7IGNsaXA6IHJlY3QoMXB4IDFweCAxcHggMXB4KTsgY2xpcDogcmVjdCgxcHgsMXB4LDFweCwxcHgpOyB9Ki8NCi51aS1oZWxwZXItcmVzZXQgeyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IGJvcmRlcjogMDsgb3V0bGluZTogMDsgbGluZS1oZWlnaHQ6IDEuMzsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBmb250LXNpemU6IDEwMCU7IGxpc3Qtc3R5bGU6IG5vbmU7IH0NCi51aS1oZWxwZXItY2xlYXJmaXg6YWZ0ZXIgeyBjb250ZW50OiAiLiI7IGRpc3BsYXk6IGJsb2NrOyBoZWlnaHQ6IDA7IGNsZWFyOiBib3RoOyB2aXNpYmlsaXR5OiBoaWRkZW47IH0NCi51aS1oZWxwZXItY2xlYXJmaXggeyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IH0gLyogcmVxdWlyZWQgY29tbWVudCBmb3IgY2xlYXJmaXggdG8gd29yayBpbiBPcGVyYSBcKi8NCiogaHRtbCAudWktaGVscGVyLWNsZWFyZml4IHsgaGVpZ2h0OjElOyB9DQoudWktaGVscGVyLWNsZWFyZml4IHsgZGlzcGxheTpibG9jazsgfSAvKiBlbmQgY2xlYXJmaXggKi8NCi51aS1oZWxwZXItemZpeCB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IHRvcDogMDsgbGVmdDogMDsgcG9zaXRpb246IGFic29sdXRlOyBvcGFjaXR5OiAwOyBmaWx0ZXI6QWxwaGEoT3BhY2l0eT0wKTsgfQ0KDQoNCi8qIENvbXBvbmVudCBjb250YWluZXJzDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCi51aS13aWRnZXQgeyBmb250LWZhbWlseTogVHJlYnVjaGV0IE1TLCBUYWhvbWEsIFZlcmRhbmEsIEFyaWFsLCBzYW5zLXNlcmlmOyBmb250LXNpemU6IDEuMWVtOyB9DQoudWktd2lkZ2V0IC51aS13aWRnZXQgeyBmb250LXNpemU6IDFlbTsgfQ0KLnVpLXdpZGdldCBpbnB1dCwgLnVpLXdpZGdldCBzZWxlY3QsIC51aS13aWRnZXQgdGV4dGFyZWEsIC51aS13aWRnZXQgYnV0dG9uIHsgZm9udC1mYW1pbHk6IFRyZWJ1Y2hldCBNUywgVGFob21hLCBWZXJkYW5hLCBBcmlhbCwgc2Fucy1zZXJpZjsgZm9udC1zaXplOiAxZW07IH0NCi51aS13aWRnZXQtY29udGVudCB7IGJvcmRlcjogMXB4IHNvbGlkICNkZGRkZGQ7IGJhY2tncm91bmQ6ICNlZWVlZWUgdXJsKC4vSW1hZ2VzL0RhdGVwaWNrZXIvdWktYmdfaGlnaGxpZ2h0LXNvZnRfMTAwX2VlZWVlZV8xeDEwMC5wbmcpIDUwJSB0b3AgcmVwZWF0LXg7IGNvbG9yOiAjMzMzMzMzOyB9DQoudWktd2lkZ2V0LWNvbnRlbnQgYSB7IGNvbG9yOiAjMzMzMzMzOyB9DQoudWktd2lkZ2V0LWhlYWRlciB7IGJvcmRlcjogMXB4IHNvbGlkICNlNzhmMDg7IGJhY2tncm91bmQ6ICNmNmE4MjggdXJsKC4vSW1hZ2VzL0RhdGVwaWNrZXIvdWktYmdfZ2xvc3Mtd2F2ZV8zNV9mNmE4MjhfNTAweDEwMC5wbmcpIDUwJSA1MCUgcmVwZWF0LXg7IGNvbG9yOiAjZmZmZmZmOyBmb250LXdlaWdodDogNjAwOyB9DQoudWktd2lkZ2V0LWhlYWRlciBhIHsgY29sb3I6ICNmZmZmZmY7IH0NCg0KLyogSW50ZXJhY3Rpb24gc3RhdGVzDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCi51aS1zdGF0ZS1kZWZhdWx0LCAudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWRlZmF1bHQsIC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1kZWZhdWx0IHsgYm9yZGVyOiAxcHggc29saWQgI2NjY2NjYzsgYmFja2dyb3VuZDogI2Y2ZjZmNiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9EYXRlcGlja2VyL3VpLWJnX2dsYXNzXzEwMF9mNmY2ZjZfMXg0MDAucG5nKSA1MCUgNTAlIHJlcGVhdC14OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzFjOTRjNDsgfQ0KLnVpLXN0YXRlLWRlZmF1bHQgYSwgLnVpLXN0YXRlLWRlZmF1bHQgYTpsaW5rLCAudWktc3RhdGUtZGVmYXVsdCBhOnZpc2l0ZWQgeyBjb2xvcjogIzFjOTRjNDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyB9DQoudWktc3RhdGUtaG92ZXIsIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaG92ZXIsIC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1ob3ZlciwgLnVpLXN0YXRlLWZvY3VzLCAudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWZvY3VzLCAudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZm9jdXMgeyBib3JkZXI6IDFweCBzb2xpZCAjZmJjYjA5OyBiYWNrZ3JvdW5kOiAjZmRmNWNlIHVybCguL0ltYWdlcy9EYXRlcGlja2VyL3VpLWJnX2dsYXNzXzEwMF9mZGY1Y2VfMXg0MDAucG5nKSA1MCUgNTAlIHJlcGVhdC14OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogI2M3NzQwNTsgfQ0KLnVpLXN0YXRlLWhvdmVyIGEsIC51aS1zdGF0ZS1ob3ZlciBhOmhvdmVyIHsgY29sb3I6ICNjNzc0MDU7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgfQ0KLnVpLXN0YXRlLWFjdGl2ZSwgLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1hY3RpdmUsIC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1hY3RpdmUgeyBib3JkZXI6IDFweCBzb2xpZCAjZmJkODUwOyBiYWNrZ3JvdW5kOiAjZmZmZmZmIHVybChSZXNvdXJjZXMvSW1hZ2VzL0RhdGVwaWNrZXIvdWktYmdfZ2xhc3NfNjVfZmZmZmZmXzF4NDAwLnBuZykgNTAlIDUwJSByZXBlYXQteDsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICNlYjhmMDA7IH0NCi51aS1zdGF0ZS1hY3RpdmUgYSwgLnVpLXN0YXRlLWFjdGl2ZSBhOmxpbmssIC51aS1zdGF0ZS1hY3RpdmUgYTp2aXNpdGVkIHsgY29sb3I6ICNlYjhmMDA7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgfQ0KLnVpLXdpZGdldCA6YWN0aXZlIHsgb3V0bGluZTogbm9uZTsgfQ0KDQovKiBJbnRlcmFjdGlvbiBDdWVzDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCi51aS1zdGF0ZS1oaWdobGlnaHQsIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaGlnaGxpZ2h0LCAudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtaGlnaGxpZ2h0ICB7Ym9yZGVyOiAxcHggc29saWQgI2ZlZDIyZjsgYmFja2dyb3VuZDogI2ZmZTQ1YyB1cmwoUmVzb3VyY2VzL0ltYWdlcy9EYXRlcGlja2VyL3VpLWJnX2hpZ2hsaWdodC1zb2Z0Xzc1X2ZmZTQ1Y18xeDEwMC5wbmcpIDUwJSB0b3AgcmVwZWF0LXg7IGNvbG9yOiAjMzYzNjM2OyB9DQoudWktc3RhdGUtaGlnaGxpZ2h0IGEsIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaGlnaGxpZ2h0IGEsLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWhpZ2hsaWdodCBhIHsgY29sb3I6ICMzNjM2MzY7IH0NCi51aS1zdGF0ZS1lcnJvciwgLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1lcnJvciwgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWVycm9yIHtib3JkZXI6IDFweCBzb2xpZCAjY2QwYTBhOyBiYWNrZ3JvdW5kOiAjYjgxOTAwIHVybChSZXNvdXJjZXMvSW1hZ2VzL0RhdGVwaWNrZXIvdWktYmdfZGlhZ29uYWxzLXRoaWNrXzE4X2I4MTkwMF80MHg0MC5wbmcpIDUwJSA1MCUgcmVwZWF0OyBjb2xvcjogI2ZmZmZmZjsgfQ0KLnVpLXN0YXRlLWVycm9yIGEsIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtZXJyb3IgYSwgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWVycm9yIGEgeyBjb2xvcjogI2ZmZmZmZjsgfQ0KLnVpLXN0YXRlLWVycm9yLXRleHQsIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtZXJyb3ItdGV4dCwgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWVycm9yLXRleHQgeyBjb2xvcjogI2ZmZmZmZjsgfQ0KLnVpLXByaW9yaXR5LXByaW1hcnksIC51aS13aWRnZXQtY29udGVudCAudWktcHJpb3JpdHktcHJpbWFyeSwgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXByaW9yaXR5LXByaW1hcnkgeyBmb250LXdlaWdodDogNjAwOyB9DQoudWktcHJpb3JpdHktc2Vjb25kYXJ5LCAudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXByaW9yaXR5LXNlY29uZGFyeSwgIC51aS13aWRnZXQtaGVhZGVyIC51aS1wcmlvcml0eS1zZWNvbmRhcnkgeyBvcGFjaXR5OiAuNzsgZmlsdGVyOkFscGhhKE9wYWNpdHk9NzApOyBmb250LXdlaWdodDogbm9ybWFsOyB9DQoudWktc3RhdGUtZGlzYWJsZWQsIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtZGlzYWJsZWQsIC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1kaXNhYmxlZCB7IG9wYWNpdHk6IC4zNTsgZmlsdGVyOkFscGhhKE9wYWNpdHk9MzUpOyBiYWNrZ3JvdW5kLWltYWdlOiBub25lOyB9DQoNCg0KLyogSWNvbnMNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLnVpLWljb24geyB3aWR0aDogMTZweDsgaGVpZ2h0OiAxNnB4OyBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9EYXRlcGlja2VyL3VpLWljb25zXzIyMjIyMl8yNTZ4MjQwLnBuZyk7IH0NCi51aS13aWRnZXQtY29udGVudCAudWktaWNvbiB7YmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvRGF0ZXBpY2tlci91aS1pY29uc18yMjIyMjJfMjU2eDI0MC5wbmcpOyB9DQoudWktd2lkZ2V0LWhlYWRlciAudWktaWNvbiB7YmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvRGF0ZXBpY2tlci91aS1pY29uc19mZmZmZmZfMjU2eDI0MC5wbmcpOyB9DQoudWktc3RhdGUtZGVmYXVsdCAudWktaWNvbiB7IGJhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0RhdGVwaWNrZXIvdWktaWNvbnNfZWY4YzA4XzI1NngyNDAucG5nKTsgfQ0KLnVpLXN0YXRlLWhvdmVyIC51aS1pY29uLCAudWktc3RhdGUtZm9jdXMgLnVpLWljb24ge2JhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0RhdGVwaWNrZXIvdWktaWNvbnNfZWY4YzA4XzI1NngyNDAucG5nKTsgfQ0KLnVpLXN0YXRlLWFjdGl2ZSAudWktaWNvbiB7YmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvRGF0ZXBpY2tlci91aS1pY29uc19lZjhjMDhfMjU2eDI0MC5wbmcpOyB9DQoudWktc3RhdGUtaGlnaGxpZ2h0IC51aS1pY29uIHtiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9EYXRlcGlja2VyL3VpLWljb25zXzIyOGVmMV8yNTZ4MjQwLnBuZyk7IH0NCi51aS1zdGF0ZS1lcnJvciAudWktaWNvbiwgLnVpLXN0YXRlLWVycm9yLXRleHQgLnVpLWljb24ge2JhY2tncm91bmQtaW1hZ2U6IHVybChSZXNvdXJjZXMvSW1hZ2VzL0RhdGVwaWNrZXIvdWktaWNvbnNfZmZkMjdhXzI1NngyNDAucG5nKTsgfQ0KLnVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLWUgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAtNDhweCAtMTkycHg7IH0NCi51aS1pY29uLWNpcmNsZS10cmlhbmdsZS1zIHsgYmFja2dyb3VuZC1wb3NpdGlvbjogLTY0cHggLTE5MnB4OyB9DQoudWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtdyB7IGJhY2tncm91bmQtcG9zaXRpb246IC04MHB4IC0xOTJweDsgfQ0KDQoNCi8qIERhdGVwaWNrZXIgDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCi51aS1kYXRlcGlja2VyIHsgd2lkdGg6IDE3ZW07IHBhZGRpbmc6IC4yZW0gLjJlbSAwOyBkaXNwbGF5OiBub25lOyB9DQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1oZWFkZXIgeyBwb3NpdGlvbjpyZWxhdGl2ZTsgcGFkZGluZzouMmVtIDA7IH0NCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXByZXYsIC51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLW5leHQgeyBwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOiAycHg7IHdpZHRoOiAxLjhlbTsgaGVpZ2h0OiAxLjhlbTsgfQ0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciwgLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciB7IHRvcDogMXB4OyB9DQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2IHsgbGVmdDoycHg7IH0NCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLW5leHQgeyByaWdodDoycHg7IH0NCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXByZXYtaG92ZXIgeyBsZWZ0OjFweDsgfQ0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciB7IHJpZ2h0OjFweDsgfQ0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItcHJldiBzcGFuLCAudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1uZXh0IHNwYW4geyBkaXNwbGF5OiBibG9jazsgcG9zaXRpb246IGFic29sdXRlOyBsZWZ0OiA1MCU7IG1hcmdpbi1sZWZ0OiAtOHB4OyB0b3A6IDUwJTsgbWFyZ2luLXRvcDogLThweDsgIH0NCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXRpdGxlIHsgbWFyZ2luOiAwIDIuM2VtOyBsaW5lLWhlaWdodDogMS44ZW07IHRleHQtYWxpZ246IGNlbnRlcjsgfQ0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItdGl0bGUgc2VsZWN0IHsgZm9udC1zaXplOjFlbTsgbWFyZ2luOjFweCAwOyB9DQoudWktZGF0ZXBpY2tlciBzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aC15ZWFyIHt3aWR0aDogMTAwJTt9DQoudWktZGF0ZXBpY2tlciBzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgDQoudWktZGF0ZXBpY2tlciBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyIHsgd2lkdGg6IDQ5JTt9DQoudWktZGF0ZXBpY2tlciB0YWJsZSB7d2lkdGg6IDEwMCU7IGZvbnQtc2l6ZTogLjllbTsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsgbWFyZ2luOjAgMCAuNGVtOyB9DQoudWktZGF0ZXBpY2tlciB0aCB7IHBhZGRpbmc6IC43ZW0gLjNlbTsgdGV4dC1hbGlnbjogY2VudGVyOyBmb250LXdlaWdodDogNjAwOyBib3JkZXI6IDA7ICB9DQoudWktZGF0ZXBpY2tlciB0ZCB7IGJvcmRlcjogMDsgcGFkZGluZzogMXB4OyB9DQoudWktZGF0ZXBpY2tlciB0ZCBzcGFuLCAudWktZGF0ZXBpY2tlciB0ZCBhIHsgZGlzcGxheTogYmxvY2s7IHBhZGRpbmc6IC4yZW07IHRleHQtYWxpZ246IHJpZ2h0OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IH0NCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgeyBiYWNrZ3JvdW5kLWltYWdlOiBub25lOyBtYXJnaW46IC43ZW0gMCAwIDA7IHBhZGRpbmc6MCAuMmVtOyBib3JkZXItbGVmdDogMDsgYm9yZGVyLXJpZ2h0OiAwOyBib3JkZXItYm90dG9tOiAwOyB9DQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIGJ1dHRvbiB7IGZsb2F0OiByaWdodDsgbWFyZ2luOiAuNWVtIC4yZW0gLjRlbTsgY3Vyc29yOiBwb2ludGVyOyBwYWRkaW5nOiAuMmVtIC42ZW0gLjNlbSAuNmVtOyB3aWR0aDphdXRvOyBvdmVyZmxvdzp2aXNpYmxlOyB9DQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIGJ1dHRvbi51aS1kYXRlcGlja2VyLWN1cnJlbnQgeyBmbG9hdDpsZWZ0OyB9DQoNCi8qIHdpdGggbXVsdGlwbGUgY2FsZW5kYXJzICovDQoudWktZGF0ZXBpY2tlci51aS1kYXRlcGlja2VyLW11bHRpIHsgd2lkdGg6YXV0bzsgfQ0KLnVpLWRhdGVwaWNrZXItbXVsdGkgLnVpLWRhdGVwaWNrZXItZ3JvdXAgeyBmbG9hdDpsZWZ0OyB9DQoudWktZGF0ZXBpY2tlci1tdWx0aSAudWktZGF0ZXBpY2tlci1ncm91cCB0YWJsZSB7IHdpZHRoOjk1JTsgbWFyZ2luOjAgYXV0byAuNGVtOyB9DQoudWktZGF0ZXBpY2tlci1tdWx0aS0yIC51aS1kYXRlcGlja2VyLWdyb3VwIHsgd2lkdGg6NTAlOyB9DQoudWktZGF0ZXBpY2tlci1tdWx0aS0zIC51aS1kYXRlcGlja2VyLWdyb3VwIHsgd2lkdGg6MzMuMyU7IH0NCi51aS1kYXRlcGlja2VyLW11bHRpLTQgLnVpLWRhdGVwaWNrZXItZ3JvdXAgeyB3aWR0aDoyNSU7IH0NCi51aS1kYXRlcGlja2VyLW11bHRpIC51aS1kYXRlcGlja2VyLWdyb3VwLWxhc3QgLnVpLWRhdGVwaWNrZXItaGVhZGVyIHsgYm9yZGVyLWxlZnQtd2lkdGg6MDsgfQ0KLnVpLWRhdGVwaWNrZXItbXVsdGkgLnVpLWRhdGVwaWNrZXItZ3JvdXAtbWlkZGxlIC51aS1kYXRlcGlja2VyLWhlYWRlciB7IGJvcmRlci1sZWZ0LXdpZHRoOjA7IH0NCi51aS1kYXRlcGlja2VyLW11bHRpIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgeyBjbGVhcjpsZWZ0OyB9DQoudWktZGF0ZXBpY2tlci1yb3ctYnJlYWsgeyBjbGVhcjpib3RoOyB3aWR0aDoxMDAlOyBmb250LXNpemU6MGVtOyB9DQoNCi8qIFJUTCBzdXBwb3J0ICovDQoudWktZGF0ZXBpY2tlci1ydGwgeyBkaXJlY3Rpb246IHJ0bDsgfQ0KLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLXByZXYgeyByaWdodDogMnB4OyBsZWZ0OiBhdXRvOyB9DQoudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItbmV4dCB7IGxlZnQ6IDJweDsgcmlnaHQ6IGF1dG87IH0NCi51aS1kYXRlcGlja2VyLXJ0bCAudWktZGF0ZXBpY2tlci1wcmV2OmhvdmVyIHsgcmlnaHQ6IDFweDsgbGVmdDogYXV0bzsgfQ0KLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLW5leHQ6aG92ZXIgeyBsZWZ0OiAxcHg7IHJpZ2h0OiBhdXRvOyB9DQoudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSB7IGNsZWFyOnJpZ2h0OyB9DQoudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSBidXR0b24geyBmbG9hdDogbGVmdDsgfQ0KLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgYnV0dG9uLnVpLWRhdGVwaWNrZXItY3VycmVudCB7IGZsb2F0OnJpZ2h0OyB9DQoudWktZGF0ZXBpY2tlci1ydGwgLnVpLWRhdGVwaWNrZXItZ3JvdXAgeyBmbG9hdDpyaWdodDsgfQ0KLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLWdyb3VwLWxhc3QgLnVpLWRhdGVwaWNrZXItaGVhZGVyIHsgYm9yZGVyLXJpZ2h0LXdpZHRoOjA7IGJvcmRlci1sZWZ0LXdpZHRoOjFweDsgfQ0KLnVpLWRhdGVwaWNrZXItcnRsIC51aS1kYXRlcGlja2VyLWdyb3VwLW1pZGRsZSAudWktZGF0ZXBpY2tlci1oZWFkZXIgeyBib3JkZXItcmlnaHQtd2lkdGg6MDsgYm9yZGVyLWxlZnQtd2lkdGg6MXB4OyB9DQoNCi8qIFNsaWRlciANCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KLnVpLXNsaWRlciB7IHBvc2l0aW9uOiByZWxhdGl2ZTsgdGV4dC1hbGlnbjogbGVmdDsgfQ0KLnVpLXNsaWRlciAudWktc2xpZGVyLWhhbmRsZSB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgei1pbmRleDogMjsgd2lkdGg6IDEuMmVtOyBoZWlnaHQ6IDEuMmVtOyBjdXJzb3I6IGRlZmF1bHQ7IH0NCi51aS1zbGlkZXIgLnVpLXNsaWRlci1yYW5nZSB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgei1pbmRleDogMTsgZm9udC1zaXplOiAuN2VtOyBkaXNwbGF5OiBibG9jazsgYm9yZGVyOiAwOyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDA7IH0NCg0KLnVpLXNsaWRlci1ob3Jpem9udGFsIHsgaGVpZ2h0OiAuOGVtOyB9DQoudWktc2xpZGVyLWhvcml6b250YWwgLnVpLXNsaWRlci1oYW5kbGUgeyB0b3A6IC0uM2VtOyBtYXJnaW4tbGVmdDogLS42ZW07IH0NCi51aS1zbGlkZXItaG9yaXpvbnRhbCAudWktc2xpZGVyLXJhbmdlIHsgdG9wOiAwOyBoZWlnaHQ6IDEwMCU7IH0NCi51aS1zbGlkZXItaG9yaXpvbnRhbCAudWktc2xpZGVyLXJhbmdlLW1pbiB7IGxlZnQ6IDA7IH0NCi51aS1zbGlkZXItaG9yaXpvbnRhbCAudWktc2xpZGVyLXJhbmdlLW1heCB7IHJpZ2h0OiAwOyB9DQoNCi51aS1zbGlkZXItdmVydGljYWwgeyB3aWR0aDogLjhlbTsgaGVpZ2h0OiAxMDBweDsgfQ0KLnVpLXNsaWRlci12ZXJ0aWNhbCAudWktc2xpZGVyLWhhbmRsZSB7IGxlZnQ6IC0uM2VtOyBtYXJnaW4tbGVmdDogMDsgbWFyZ2luLWJvdHRvbTogLS42ZW07IH0NCi51aS1zbGlkZXItdmVydGljYWwgLnVpLXNsaWRlci1yYW5nZSB7IGxlZnQ6IDA7IHdpZHRoOiAxMDAlOyB9DQoudWktc2xpZGVyLXZlcnRpY2FsIC51aS1zbGlkZXItcmFuZ2UtbWluIHsgYm90dG9tOiAwOyB9DQoudWktc2xpZGVyLXZlcnRpY2FsIC51aS1zbGlkZXItcmFuZ2UtbWF4IHsgdG9wOiAwOyB9DQoNCi51aS1zbGlkZXItaGFuZGxlIHsNCiAgICB0ZXh0LWluZGVudDogLTk5OTlweDsNCn0NCg0KLyogSlFVRVJZIE9WRVJSSURFUw0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoudWktYXV0b2NvbXBsZXRlIHsNCiAgICBtYXJnaW4tbGVmdDogMC4xNTYyNWVtOw0KfQ0KDQoudWktbWVudSAudWktbWVudS1pdGVtIGEgew0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KfQ0KLnVpLW1lbnUgLnVpLW1lbnUtaXRlbSBhLnVpLXN0YXRlLWZvY3VzIHsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIG1hcmdpbjogMDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi51aS13aWRnZXQsIC51aS13aWRnZXQtY29udGVudC51aS13aWRnZXQgew0KICAgIGZvbnQtZmFtaWx5OiBUcmVidWNoZXQgTVMsIFRhaG9tYSwgVmVyZGFuYSwgQXJpYWwsIHNhbnMtc2VyaWY7DQogICAgZm9udC1zaXplOiAuOTVlbTsNCn0NCg0KLnVpLXdpZGdldC1jb250ZW50IHsNCiAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KfQ0KDQoudWktc3RhdGUtZGVmYXVsdCwgLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1kZWZhdWx0LCAudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZGVmYXVsdCB7DQogICAgZm9udC1zaXplOiAxZW07DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCn0NCg0KLnVpLWRhdGVwaWNrZXIgew0KICAgIHBhZGRpbmc6IC4yNWVtOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICM5OTk5OTk7DQp9DQoNCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLWhlYWRlciwNCi51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUudWktd2lkZ2V0LWNvbnRlbnQgew0KICAgIGJhY2tncm91bmQ6ICNFRUVFRUU7DQogICAgYm9yZGVyOiBub25lOw0KfQ0KDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1oZWFkZXIgew0KICAgIHBhZGRpbmctdG9wOiAuMjVlbTsNCiAgICBwYWRkaW5nLWJvdHRvbTogLjI1ZW07DQogICAgY29sb3I6ICMwMDAwMDA7DQogICAgZm9udC13ZWlnaHQ6IDYwMDsNCn0NCg0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSB7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBtYXJnaW4tdG9wOiAuNWVtOw0KfQ0KDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2LA0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItbmV4dCB7DQogICAgcG9zaXRpb246YWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIHdpZHRoOiAxLjhlbTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICBjb2xvcjogdHJhbnNwYXJlbnQ7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIG9wYWNpdHk6IDAuNTsNCiAgICBmaWx0ZXI6YWxwaGEob3BhY2l0eT01MCk7DQp9DQoNCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLXByZXYsDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2hldnJvbi1sZWZ0LTE2LnBuZyIpIG5vLXJlcGVhdCBzY3JvbGwgY2VudGVyIGNlbnRlcjsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgbGVmdDogMDsNCn0NCg0KLnVpLWRhdGVwaWNrZXIgLnVpLWRhdGVwaWNrZXItbmV4dCwNCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLW5leHQtaG92ZXIgew0KICAgIGJhY2tncm91bmQ6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9jaGV2cm9uLXJpZ2h0LTE2LnBuZyIpIG5vLXJlcGVhdCBzY3JvbGwgY2VudGVyIGNlbnRlcjsNCiAgICBib3JkZXI6IG5vbmU7DQogICAgcmlnaHQ6IDA7DQp9DQoNCi51aS1kYXRlcGlja2VyIC51aS1kYXRlcGlja2VyLW5leHQtaG92ZXIsDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIHsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1wcmV2IHNwYW4sDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci1uZXh0IHNwYW4gew0KICAgIGRpc3BsYXk6IG5vbmU7DQogfQ0KDQoudWktZGF0ZXBpY2tlciAudWktZGF0ZXBpY2tlci10aXRsZSBzZWxlY3Qgew0KICAgIG1hcmdpbjogMDsNCn0NCg0KLnVpLWRhdGVwaWNrZXIgc2VsZWN0LnVpLWRhdGVwaWNrZXItbW9udGgsIC51aS1kYXRlcGlja2VyIHNlbGVjdC51aS1kYXRlcGlja2VyLXllYXIgew0KICAgIHdpZHRoOiBhdXRvOw0KICAgIG1pbi13aWR0aDogMDsNCn0NCg0KLnVpLWRhdGVwaWNrZXItdHJpZ2dlciB7DQogICAgbWFyZ2luLWxlZnQ6IC4xNWVtOw0KICAgIHBhZGRpbmc6IC4xNWVtDQp9DQoNCi51aS1kYXRlcGlja2VyLWJ1dHRvbnBhbmUgLnVpLXN0YXRlLWRlZmF1bHQgew0KICAgIGJhY2tncm91bmQ6ICNFRUVFRUU7DQogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvcCwgI0VFRUVFRSAwJSwjQ0NDQ0NDIDEwMCUpOyANCiAgICBiYWNrZ3JvdW5kOiAtbW96LWxpbmVhci1ncmFkaWVudCh0b3AsICNFRUVFRUUgMCUsICNDQ0NDQ0MgMTAwJSk7DQogICAgYmFja2dyb3VuZDogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCBsZWZ0IGJvdHRvbSwgY29sb3Itc3RvcCgwJSwjRUVFRUVFKSwgY29sb3Itc3RvcCgxMDAlLCNDQ0NDQ0MpKTsgIA0KICAgIGJhY2tncm91bmQ6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgI0VFRUVFRSAwJSwjQ0NDQ0NDIDEwMCUpOyANCiAgICBiYWNrZ3JvdW5kOiAtby1saW5lYXItZ3JhZGllbnQodG9wLCAjRUVFRUVFIDAlLCNDQ0NDQ0MgMTAwJSk7DQogICAgYmFja2dyb3VuZDogLW1zLWxpbmVhci1ncmFkaWVudCh0b3AsICNFRUVFRUUgMCUsI0NDQ0NDQyAxMDAlKTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjQUFBQUFBOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW07DQogICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgY29sb3I6ICMzMzMzMzM7DQogICAgdGV4dC1zaGFkb3c6IDFweCAxcHggI0ZGRkZGRjsNCn0NCg0KLnVpLXRpbWVwaWNrZXItZGl2IHsNCiAgICBtYXJnaW4tdG9wOiAuNzVlbTsNCiAgICBmb250LXNpemU6IC45ZW07DQp9DQoNCi51aS10aW1lcGlja2VyLWRpdiBkZCB7DQogICAgcGFkZGluZzogLjI1ZW0gLjVlbTsNCn0NCg0KLnVpLXRpbWVwaWNrZXItZGl2IGR0IHsNCiAgICBwYWRkaW5nOiAwIC41ZW07DQp9DQoNCi51aV90cGlja2VyX3RpbWVfbGFiZWwsDQoudWlfdHBpY2tlcl90aW1lIHsNCiAgICBmb250LXdlaWdodDogNjAwOw0KfQ0KDQoudWktdGltZXBpY2tlci1kaXYgZGQudWlfdHBpY2tlcl90aW1lIHsNCiAgICBwYWRkaW5nLXRvcDogMDsNCiAgICBwYWRkaW5nLWJvdHRvbTogLjVlbTsNCn0NCg0KLnVpLXNsaWRlci51aS13aWRnZXQtY29udGVudCB7DQogICAgYmFja2dyb3VuZDogI0VFRUVFRTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjOTk5OTk5Ow0KfQ0KDQoudWktc2xpZGVyLWhvcml6b250YWwgLnVpLXNsaWRlci1oYW5kbGUgew0KICAgIG1hcmdpbi1sZWZ0OiAtMC43ZW07DQogICAgdG9wOiAtMC4zZW07DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgLnVpLXN0YXRlLWhpZ2hsaWdodCwNCi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaGlnaGxpZ2h0LA0KLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWhpZ2hsaWdodCwNCi51aS10aW1lcGlja2VyLWRpdiAudWktc3RhdGUtaGlnaGxpZ2h0LA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaGlnaGxpZ2h0LA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1oaWdobGlnaHQgew0KICAgIGJhY2tncm91bmQ6ICM5OTk5OTk7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzY2NjY2NjsNCiAgICBjb2xvcjogI0ZGRkZGRjsNCn0NCg0KLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgLnVpLXN0YXRlLWFjdGl2ZSwNCi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtYWN0aXZlLA0KLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWFjdGl2ZSwNCi51aS10aW1lcGlja2VyLWRpdiAudWktc3RhdGUtYWN0aXZlLA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtYWN0aXZlLA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1hY3RpdmUgew0KICAgIGJhY2tncm91bmQ6ICM2NjY2NjY7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzMzMzMzMzsNCiAgICBjb2xvcjogI0ZGRkZGRjsNCn0NCg0KLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgLnVpLXN0YXRlLWhvdmVyLA0KLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIgLnVpLXdpZGdldC1jb250ZW50IC51aS1zdGF0ZS1ob3ZlciwNCi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1ob3ZlciwNCi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIC51aS1zdGF0ZS1mb2N1cywNCi51aS1kYXRlcGlja2VyLWNhbGVuZGFyIC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtZm9jdXMsDQoudWktZGF0ZXBpY2tlci1jYWxlbmRhciAudWktd2lkZ2V0LWhlYWRlciAudWktc3RhdGUtZm9jdXMsDQoudWktdGltZXBpY2tlci1kaXYgLnVpLXN0YXRlLWhvdmVyLA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS13aWRnZXQtY29udGVudCAudWktc3RhdGUtaG92ZXIsDQoudWktdGltZXBpY2tlci1kaXYgLnVpLXdpZGdldC1oZWFkZXIgLnVpLXN0YXRlLWhvdmVyLA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS1zdGF0ZS1mb2N1cywNCi51aS10aW1lcGlja2VyLWRpdiAudWktd2lkZ2V0LWNvbnRlbnQgLnVpLXN0YXRlLWZvY3VzLA0KLnVpLXRpbWVwaWNrZXItZGl2IC51aS13aWRnZXQtaGVhZGVyIC51aS1zdGF0ZS1mb2N1cyB7DQogICAgYmFja2dyb3VuZDogIzk5OTk5OTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjNjY2NjY2Ow0KICAgIGNvbG9yOiAjRkZGRkZGOw0KfQ0KDQoudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIGJ1dHRvbi51aS1kYXRlcGlja2VyLWN1cnJlbnQsDQoudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIGJ1dHRvbi51aS1kYXRlcGlja2VyLWNsb3NlIHsNCiAgICBvcGFjaXR5OiAxOw0KICAgIGZpbHRlcjogQWxwaGEoT3BhY2l0eT0xMDApOw0KfQ0KDQoudWktZGF0ZXBpY2tlci1idXR0b25wYW5lIGJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogI0VFRUVFRTsNCn0="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/CSS/large.css","css","DQovKiBGT1JNIElURU1TIChMQVJHRSkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCnNlbGVjdCwNCmJ1dHRvbiB7DQoJY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouZm9ybS1pdGVtIC5ncm91cC1ib3ggew0KICAgIG1heC13aWR0aDogNjQwcHg7DQp9DQoNCi5mb3JtLWJ1dHRvbi1jb250YWluZXIgew0KICAgIHBhZGRpbmctdG9wOiAuNWVtOw0KfQ0KDQouYXV0by1jb21wbGV0ZSAubGlzdC1tZW51IGxpIHsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9"),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/CSS/medium.css","css","DQovKiBGT1JNIElURU1TIChNRURJVU0pIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J10sDQppbnB1dFt0eXBlPSdyYWRpbyddLA0KaW5wdXRbdHlwZT0ndGV4dCddLA0Kc2VsZWN0LA0KdGV4dGFyZWEgew0KICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiByZ2JhKDAsMCwwLDApOyAgDQp9DQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J10gew0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMjRweDsNCn0NCg0KaW5wdXRbdHlwZT0ncmFkaW8nXSB7DQogICAgd2lkdGg6IDI0cHg7DQogICAgaGVpZ2h0OiAyNHB4Ow0KfQ0KDQppbnB1dFt0eXBlPSdjaGVja2JveCddOmRpc2FibGVkLA0KaW5wdXRbdHlwZT0ncmFkaW8nXTpkaXNhYmxlZCB7DQogICAgb3BhY2l0eTogMC40Ow0KfQ0KDQpidXR0b24uZGF0ZXRpbWUtYnRuIHsNCiAgICB3aWR0aDogMjBweDsNCiAgICBoZWlnaHQ6IDIycHg7DQp9DQoNCi5wYW5lbC1zY3JvbGwtY29udGFpbmVyIC5hdXRvY29tcGxldGUtbWVudSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGJvcmRlcjogbm9uZTsNCiAgICBtYXJnaW46IDBweDsNCiAgICB3aWR0aDogaW5oZXJpdDsNCn0NCg=="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/CSS/small.css","css","DQovKiBGT1JNIElURU1TIChTTUFMTCkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCmlucHV0LA0Kc2VsZWN0LA0KdGV4dGFyZWEgew0KCXBhZGRpbmc6IC41ZW07DQoJZm9udC1zaXplOiAxZW07DQp9DQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J10sDQppbnB1dFt0eXBlPSdyYWRpbyddLA0KaW5wdXRbdHlwZT0ndGV4dCddLA0Kc2VsZWN0LA0KdGV4dGFyZWEgew0KICAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiByZ2JhKDAsMCwwLDApOyAgDQp9DQoNCmlucHV0W3R5cGU9J3RleHQnXSwNCmlucHV0W3R5cGU9J3Bhc3N3b3JkJ10gew0KCXdpZHRoOiAxMDAlOyAvKiBVc2UgYXZhaWxhYmxlIHNwYWNlIGZvciBmaWVsZHMgb24gc21hbGwgZGV2aWNlcyAqLw0KCW1heC13aWR0aDogMTAwJTsgLyogRG9uJ3QgZXhjZWVkIHRoZSB3aWR0aCBvZiB0aGUgY29udGFpbmVyICovDQp9DQoNCi5mb3JtLWxhYmVsLA0KLmZvcm0tY29udHJvbCB7DQoJZGlzcGxheTogYmxvY2s7DQoJZmxvYXQ6IG5vbmU7DQoJcGFkZGluZy1sZWZ0OiAwOw0KCXBhZGRpbmctcmlnaHQ6IDA7DQoJd2lkdGg6IGF1dG87DQp9DQoNCi5mb3JtLWl0ZW0gew0KCXBhZGRpbmc6IC41ZW0gMDsNCn0NCg0KLmxhYmVsLWxlZnQgLmZvcm0tbGFiZWwsDQoubGFiZWwtcmlnaHQgLmZvcm0tbGFiZWwgew0KCXRleHQtYWxpZ246IGxlZnQ7DQp9DQoNCi5jb21ib2JveCwNCi5saXN0Ym94IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgd2lkdGg6IDEwMCU7DQp9DQoNCi5jb21ib2JveCBzZWxlY3QsDQoubGlzdGJveCBzZWxlY3QsDQp0ZXh0YXJlYSB7DQogICAgd2lkdGg6IDEwMCUgIWltcG9ydGFudDsgLyogVXNlIGF2YWlsYWJsZSBzcGFjZSBmb3IgZmllbGRzIG9uIHNtYWxsIGRldmljZXMgKi8NCgltYXgtd2lkdGg6IDEwMCUgIWltcG9ydGFudDsgLyogRG9uJ3QgZXhjZWVkIHRoZSB3aWR0aCBvZiB0aGUgY29udGFpbmVyICovDQp9DQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J10gew0KICAgIHdpZHRoOiAyNHB4Ow0KICAgIGhlaWdodDogMjRweDsNCn0NCg0KaW5wdXRbdHlwZT0ncmFkaW8nXSB7DQogICAgd2lkdGg6IDI0cHg7DQogICAgaGVpZ2h0OiAyNHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDEycHg7DQogICAgYm9yZGVyOiAycHggc29saWQgIzk5OTk5OTsNCn0NCg0KaW5wdXRbdHlwZT0nY2hlY2tib3gnXTpjaGVja2VkLA0KaW5wdXRbdHlwZT0ncmFkaW8nXTpjaGVja2VkIHsNCiAgICBib3JkZXI6IDJweCBzb2xpZCAjOTk5OTk5Ow0KfQ0KDQoNCmlucHV0W3R5cGU9J2NoZWNrYm94J106ZGlzYWJsZWQsDQppbnB1dFt0eXBlPSdyYWRpbyddOmRpc2FibGVkIHsNCiAgICBvcGFjaXR5OiAwLjQ7DQp9DQoNCg0KLmNoZWNrYm94IC5mb3JtLWxhYmVsLmxlZnQuYm91bmQtdmlzaWJsZSwNCi5yYWRpb2J0biAuZm9ybS1sYWJlbC5sZWZ0LmJvdW5kLXZpc2libGUgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCn0NCg0KLmNoZWNrYm94IC5mb3JtLWxhYmVsLnJpZ2h0LA0KLnJhZGlvYnRuIC5mb3JtLWxhYmVsLnJpZ2h0IHsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoNCi5hdXRvY29tcGxldGUtbWVudSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouYXV0b2NvbXBsZXRlLW1lbnUgdWwgew0KICAgIG1heC1oZWlnaHQ6IG5vbmU7DQp9DQoNCi5Xb3JrZmxvd0xpc3RWaWV3IHsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgb3ZlcmZsb3c6IGF1dG87DQp9DQo="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Slider/CSS/common.css","css","LmdjeC1zbGlkZXItY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgd2lkdGg6IDEwMCU7DQogICAgcGFkZGluZzogMC45ZW0gMy41ZW0gMCAyZW07DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KDQouZ2N4LXNsaWRlci1jdXJyZW50LWxhYmVsLWNvbnRhaW5lciB7DQogICAgbWFyZ2luLWJvdHRvbTogMC43NWVtOw0KfQ0KDQouZ2N4LXNsaWRlci1sYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIHdpZHRoOiA1MCU7DQogICAgZm9udC1zaXplOiAwLjg1ZW07DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICBjb2xvcjogIzMzMzMzMzsNCiAgICBjdXJzb3I6IGRlZmF1bHQ7DQp9DQoNCi5nY3gtc2xpZGVyLWxhYmVsLWNvbnRhaW5lciB7DQogICAgbWFyZ2luOiAwLjVlbSAwLjVlbSAwIDA7DQp9DQoNCi5nY3gtc2xpZGVyLWxhYmVsLW1pbiwNCi5nY3gtc2xpZGVyLWxhYmVsLW1heCB7DQogICAgbWF4LXdpZHRoOiA0OCU7DQogICAgY29sb3I6ICMzMzMzMzM7DQogICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCn0NCg0KLmdjeC1zbGlkZXItbGFiZWwtbWF4IHsNCiAgICBmbG9hdDogcmlnaHQ7DQogICAgdGV4dC1hbGlnbjogcmlnaHQ7DQp9DQoNCi5nY3gtc2xpZGVyLWxhYmVsLWN1cnJlbnQtbWluLA0KLmdjeC1zbGlkZXItbGFiZWwtY3VycmVudC1tYXggew0KICAgIHdpZHRoOiBhdXRvOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgbWFyZ2luOiAwLjI1ZW0gMCAwIDA7DQogICAgcGFkZGluZzogMC4zZW07DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjREREREREOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkIHdoaXRlOw0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVlbTsNCn0NCg0KLmdjeC1zbGlkZXIsDQouZ2N4LXNsaWRlci10aWNrcyB7DQogICAgbWFyZ2luOiAwIDEuNWVtIDAgMGVtOw0KfQ0KDQouZ2N4LXNsaWRlci10aWNrcyB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGNsZWFyOiBib3RoOw0KICAgIGhlaWdodDogMWVtOw0KfQ0KDQouZ2N4LXRpY2sgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBoZWlnaHQ6IDAuOGVtOw0KICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgIzk5OTk5OTsNCiAgICB0b3A6IDFlbTsNCn0NCg0KLmdjeC1zbGlkZXIudWktc2xpZGVyLnVpLXdpZGdldCB7DQogICAgZm9udC1mYW1pbHk6ICJTZWdvZSBVSSIsICJIZWx2ZXRpY2EgTmV1ZSIsICJEcm9pZCBTYW5zIiwgIkhlbHZldGljYSIsICJBcmlhbCIsICJzYW5zLXNlcmlmIjsNCiAgICBmb250LXNpemU6IDAuODVlbTsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDEwMiwxMDIsMTAyLDAuMTI1KTsNCn0NCg0KLmdjeC1zbGlkZXIgLnVpLXNsaWRlci1oYW5kbGUgew0KICAgIHRvcDogLTAuOGVtICFpbXBvcnRhbnQ7DQogICAgei1pbmRleDogMjsNCn0NCg0KLmdjeC1zbGlkZXIgLnVpLXNsaWRlci1oYW5kbGU6OmJlZm9yZSB7DQogICAgY29udGVudDogIiI7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgYm9yZGVyLXRvcDogNXB4IHNvbGlkICNEREREREQ7DQogICAgYm9yZGVyLXJpZ2h0OiA1cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgYm9yZGVyLWJvdHRvbTogNXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgIGJvcmRlci1sZWZ0OiA1cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogLTFlbTsNCn0NCg0KLnNoZWxsLXNtYWxsIC5nY3gtc2xpZGVyIC51aS1zbGlkZXItaGFuZGxlOjpiZWZvcmUgew0KICAgIHRvcDogLTAuM2VtOw0KICAgIGxlZnQ6IDAuNWVtOw0KfQ0KDQouZ2N4LXNsaWRlciAudWktc2xpZGVyLXJhbmdlIHsNCiAgICBiYWNrZ3JvdW5kOiAjMUE3MkM0Ow0KfQ0KDQouc2hlbGwtbGFyZ2UgLmdjeC1zbGlkZXIgLnVpLXNsaWRlci1oYW5kbGUudWktc3RhdGUtZGVmYXVsdC51aS1jb3JuZXItYWxsLA0KLnNoZWxsLWxhcmdlIC5nY3gtc2xpZGVyIC51aS1zbGlkZXItaGFuZGxlLnVpLXN0YXRlLWRlZmF1bHQudWktY29ybmVyLWFsbC51aS1zdGF0ZS1ob3ZlciwNCi5nY3gtc2xpZGVyIC51aS1zbGlkZXItaGFuZGxlOjphZnRlciB7DQogICAgd2lkdGg6IDFlbTsNCiAgICBoZWlnaHQ6IDFlbTsNCiAgICBtYXJnaW4tdG9wOiAwLjJlbTsNCiAgICBib3JkZXI6IDVweCBzb2xpZCAjMUE3MkM0ICFpbXBvcnRhbnQ7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KfQ=="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/SmartPanel/CSS/common.css","css","DQoucGFuZWwtaGVhZGVyIHsNCiAgICB1c2VyLXNlbGVjdDogbm9uZTsNCn0NCg0KLnJlc2l6ZS1ob3Jpem9udGFsLWhpbnQgew0KICAgIGN1cnNvcjogZXctcmVzaXplOw0KfQ0KDQoucmVzaXplLXZlcnRpY2FsLWhpbnQgew0KICAgIGN1cnNvcjogbnMtcmVzaXplOw0KfQ0KDQouc21hcnQtcGFuZWwgLnBhbmVsLWhlYWRlciBidXR0b24ubWVudS1idXR0b24gew0KICAgIGZsb2F0OiByaWdodDsNCiAgICB3aWR0aDogMy41ZW07DQogICAgaGVpZ2h0OiAzLjVlbTsNCiAgICBiYWNrZ3JvdW5kOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9tZW51LWhvaXN0ZWQtMjQucG5nKSBjZW50ZXIgbm8tcmVwZWF0Ow0KfQ0KLm5vLXRvdWNoIC5zbWFydC1wYW5lbCAucGFuZWwtaGVhZGVyIGJ1dHRvbi5tZW51LWJ1dHRvbiB7DQogICAgd2lkdGg6IDIuNzVlbTsNCiAgICBoZWlnaHQ6IDIuNzVlbTsNCn0NCi5zbWFydC1wYW5lbC1ob2lzdGVkLW1lbnUtaW5saW5lIC5oYXMtaWNvbiAubGlzdC1tZW51LWRldGFpbHMgew0KICAgIG1hcmdpbi1sZWZ0OiAyLjRlbTsNCiAgICBwYWRkaW5nLWxlZnQ6IDA7DQp9DQouc21hcnQtcGFuZWwtaG9pc3RlZC1tZW51LWlubGluZSAubGlzdC1tZW51LWljb24gew0KICAgIG1hcmdpbi1yaWdodDogMC41ZW07DQp9DQouc21hcnQtcGFuZWwtaG9pc3RlZC1tZW51LWlubGluZSB7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHotaW5kZXg6IDEwMDA7DQogICAgcmlnaHQ6IDA7DQogICAgYmFja2dyb3VuZDogI2ZmZjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOw0KICAgIGJvcmRlci10b3A6IG5vbmU7DQogICAgbWluLXdpZHRoOiA2LjI1MGVtOw0KfQ0KDQouc21hcnQtcGFuZWwtaG9pc3RlZC1tZW51LWlubGluZSB7DQogICAgdG9wOiAyLjVlbTsNCn0NCg0KLnRvdWNoIC5wYW5lbC1oZWFkZXIgLnNtYXJ0LXBhbmVsLWhvaXN0ZWQtbWVudS1pbmxpbmUgew0KICAgIHRvcDogM2VtOw0KfQ0KDQoubm8tdG91Y2ggLnNtYXJ0LXBhbmVsLWhvaXN0ZWQtbWVudS1pbmxpbmUuaW5saW5lLW1lbnUtb3Blbi11cCB7DQogICAgdG9wOiBhdXRvOw0KICAgIGJvdHRvbTogMTAwJTsNCn0NCg0KLnJlc2l6ZS1oaW50IHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgYmFja2dyb3VuZDogIzAwMDAwMDsNCiAgICB6LWluZGV4OiAxMDAwMDsNCiAgICBvcGFjaXR5OiAwLjM7DQogICAgYm90dG9tOiAwOw0KICAgIHpvb206IDE7DQogICAgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTMwKTsNCn0NCg0KLm1heGltaXplZCB7DQogICAgaGVpZ2h0OiAxMDAuMiUgIWltcG9ydGFudDsNCn0NCg0KLmJvdHRvbS1yZWdpb24gIC5zbWFydC1wYW5lbC1ob2lzdGVkLW1lbnUtaW5saW5lIHsNCiAgICByaWdodDogNWVtOw0KfQ0KDQouZGF0YS1yZWdpb24gLnNtYXJ0LXBhbmVsLWhvaXN0ZWQtbWVudS1pbmxpbmUgew0KICAgIG1heC13aWR0aDogODUlOw0KfQ0KDQouYm90dG9tLXJlZ2lvbiAgLnNtYXJ0LXBhbmVsLWhvaXN0ZWQtbWVudS1pbmxpbmUgLmxpc3QtbWVudSB7DQogICAgbWF4LWhlaWdodDogMjVlbTsNCiAgICBtYXgtd2lkdGg6IDI1ZW07DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCn0NCg0KLmRhdGEtcmVnaW9uIC5zbWFydC1wYW5lbC1ob2lzdGVkLW1lbnUtaW5saW5lIC5saXN0LW1lbnUgew0KICAgIG1heC1oZWlnaHQ6IDI1ZW07DQogICAgb3ZlcmZsb3cteTogYXV0bzsNCn0NCg0KLmhpZGRlbi1ob2lzdGVkLW1lbnUgew0KICAgIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi5tYXhpbWl6ZS0xNiB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2Fycm93LXVwLXNtYWxsLTE2LnBuZyIpOw0KfQ0KDQoubWluaW1pemUtMTYgew0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9hcnJvdy1kb3duLXNtYWxsLTE2LnBuZyIpOw0KfQ0KDQoucGFuZWwtaGVhZGVyIC5zbWFydC1wYW5lbC1ob2lzdGVkLW1lbnUtaW5saW5lIHsNCiAgICB0b3A6IDNlbTsNCn0NCg0KLyogLS0tLS0tIFNUQVJUOiBQYW5lbCBSZXNpemUgLS0tLS0tICovDQouYm90dG9tLXBhbmVsLXJlc2l6ZS5yZXNpemUtaGFuZGxlIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAtMWVtOw0KICAgIGxlZnQ6IDUwJTsNCiAgICBtYXJnaW4tbGVmdDogLTFlbTsNCiAgICBjdXJzb3I6IG5zLXJlc2l6ZTsNCiAgICB6LWluZGV4OiAxMDA7DQp9DQouYm90dG9tLXBhbmVsLXJlc2l6ZS5yZXNpemUtaGFuZGxlIC5pY29uLWRyYWcgew0KICAgIHdpZHRoOiAyZW07DQogICAgaGVpZ2h0OiAxZW07DQogICAgYm9yZGVyLWJvdHRvbTogbm9uZTsNCiAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvZHJhZy12LTE2LnBuZyIpOw0KfQ0KLnRvdWNoIC5ib3R0b20tcGFuZWwtcmVzaXplLnJlc2l6ZS1oYW5kbGUgew0KICAgIHBhZGRpbmc6IDIuNWVtIDAuNzVlbSAwIDAuNzVlbTsNCiAgICB0b3A6IC0zLjVlbTsNCiAgICBtYXJnaW4tbGVmdDogLTEuNzVlbTsNCn0NCi8qIC0tLS0tLSBFTkQ6IFBhbmVsIFJlc2l6ZSAtLS0tLS0gKi8NCg0KLyogLS0tLS0tIFNUQVJUOiBSZXN1bHRzIFRhYmxlIFJlc2l6ZS0tLS0tLSAqLw0KLmJvdHRvbS1yZWdpb24gLlJlc3VsdHNSZWdpb25WaWV3Q29udGFpbmVyVmlldyAucGFuZWwtdGl0bGUgew0KICAgIG1hcmdpbjogMDsNCiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgbWF4LXdpZHRoOiBjYWxjKDEwMCUgLSAxMC41ZW0pOw0KICAgIHVzZXItc2VsZWN0OiBpbml0aWFsOw0KICAgIGN1cnNvcjogZGVmYXVsdDsNCiAgICBoZWlnaHQ6IDIuNzVlbTsNCn0NCi5ib3R0b20tcmVnaW9uIC5SZXN1bHRzUmVnaW9uVmlld0NvbnRhaW5lclZpZXcgLnBhbmVsLXRpdGxlLWNvbnRlbnRzIHsNCiAgICB1c2VyLXNlbGVjdDogaW5pdGlhbDsNCiAgICBjdXJzb3I6IGRlZmF1bHQ7DQp9DQoNCi5uby10b3VjaCAuYm90dG9tLXJlZ2lvbiAuUmVzdWx0c1JlZ2lvblZpZXdDb250YWluZXJWaWV3IC5wYW5lbC10aXRsZSB7DQogICAgbWF4LXdpZHRoOiBjYWxjKDEwMCUgLSA3LjVlbSk7DQp9DQoNCi5ib3R0b20tcmVnaW9uIC5SZXN1bHRzUmVnaW9uVmlld0NvbnRhaW5lclZpZXcgLnBhbmVsLWhlYWRlci1jb250ZW50cyB7DQogICAgZGlzcGxheTogaW5saW5lOw0KfQ0KDQouYm90dG9tLXJlZ2lvbiAuUmVzdWx0c1JlZ2lvblZpZXdDb250YWluZXJWaWV3IC5wYW5lbC1oZWFkZXIgew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCn0NCiAvKiAtLS0tLS0gRU5EOiBSZXN1bHRzIFRhYmxlIFJlc2l6ZS0tLS0tLSAqLw=="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Table/CSS/common.css","css","LnJlc3VsdHMtdGFibGUgew0KICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICBtaW4td2lkdGg6IDEwMCU7DQogICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBvdmVyZmxvdzogYXV0bzsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDA7DQogICAgbGVmdDogMDsNCiAgICBib3R0b206IDMuNWVtOw0KfQ0KLnJlc3VsdHMtdGFibGUgdGQgew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCn0NCi5yZXN1bHRzLXRhYmxlIHRoLA0KLnJlc3VsdHMtdGFibGUgdGQgew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBwYWRkaW5nOiAwOw0KICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjREREREREOw0KfQ0KLnJlc3VsdHMtdGFibGUgdGggc3BhbiwNCi5yZXN1bHRzLXRhYmxlIHRkIHNwYW4sDQoucmVzdWx0cy10YWJsZSB0ZCBidXR0b24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHBhZGRpbmc6IDAuNWVtIDAuOGVtOw0KICAgIHdoaXRlLXNwYWNlOiBwcmU7DQogICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOw0KfQ0KLnJlc3VsdHMtdGFibGUgdGQgYSB7DQogICAgcGFkZGluZzogMC41ZW0gMC44ZW07DQp9DQoucmVzdWx0cy10YWJsZSB0aCB7DQogICAgYm9yZGVyLXRvcDogbm9uZTsNCn0NCi5yZXN1bHRzLXRhYmxlIGEgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KfQ0KLnJlc3VsdHMtdGFibGUgdHIgdGg6bGFzdC1jaGlsZCwNCi5yZXN1bHRzLXRhYmxlIHRyIHRkOmxhc3QtY2hpbGQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGJvcmRlci1yaWdodDogbm9uZTsNCn0NCi5yZXN1bHRzLXRhYmxlIHRib2R5IHRyOm50aC1jaGlsZChvZGQpIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkFGQUZBOw0KfQ0KDQoucmVzdWx0cy10YWJsZSB0Ym9keSB0cjphY3RpdmUsDQoucmVzdWx0cy10YWJsZSB0Ym9keSB0cjpob3ZlciB7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI0RFRjJGRjsNCn0NCg0KLnJlc3VsdHMtdGFibGUgLmZlYXR1cmUtc2V0LWhlYWRlciB7DQogICAgYmFja2dyb3VuZDogI0RERERERDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIHBhZGRpbmc6IC45ZW07DQp9DQoucmVzdWx0LWhlYWRpbmcgew0KICAgIHBhZGRpbmctcmlnaHQ6IDIwcHggIWltcG9ydGFudDsNCiAgICBmb250LXdlaWdodDogNjAwOw0KfQ0KLnNvcnQsDQouc29ydC1kb3duLA0KLnNvcnQtdXAgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZsb2F0OiByaWdodDsNCiAgICB3aWR0aDogMTZweDsNCiAgICBoZWlnaHQ6IDE2cHg7DQogICAgcGFkZGluZzogMCAhaW1wb3J0YW50Ow0KICAgIG1hcmdpbjowLjVlbSAwOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQp9DQouc29ydCB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvYXJyb3ctc29ydC1zbWFsbC0xNi5wbmcpOw0KICAgIHpvb206IDE7DQogICAgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTMwKTsNCiAgICBvcGFjaXR5OiAwLjM7DQp9DQp0aDpob3ZlciAuc29ydCB7DQogICAgem9vbTogMTsNCiAgICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MTAwKTsNCiAgICBvcGFjaXR5OiAxOw0KfQ0KDQouc29ydC1kb3duIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9hcnJvdy1kb3duLXNtYWxsLTE2LnBuZyk7DQp9DQoNCi5zb3J0LXVwIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9hcnJvdy11cC1zbWFsbC0xNi5wbmcpOw0KfQ=="),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/ColorPicker/ColorPickerWidget.html","html",markup1),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/FilterControl/FilterControlView.html","html",markup2),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/AutoCompleteBoxFormItemView.html","html",markup3),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/CheckBoxFormItemView.html","html",markup4),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/ComboBoxFormItemView.html","html",markup5),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/ContainerFormItemView.html","html",markup6),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/DatePickerFormItemView.html","html",markup7),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/FilePickerFormItemView.html","html",markup8),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/FormItemView.html","html",markup9),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/GroupBoxFormItemView.html","html",markup10),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/HyperlinkFormItemView.html","html",markup11),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/ImageFormItemView.html","html",markup12),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/ListBoxFormItemView.html","html",markup13),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/MarkdownFormItemView.html","html",markup14),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/RadioButtonFormItemView.html","html",markup15),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/TextAreaFormItemView.html","html",markup16),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/TextBoxFormItemView.html","html",markup17),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Forms/TimePickerFormItemView.html","html",markup18),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/NumericInput/NumericInputWidget.html","html",markup19),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html","html",markup20),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Slider/SliderView.html","html",markup21),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/SmartPanel/SmartPanelView.html","html",markup22),e.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Table/TableView.html","html",markup23)})}();require({cache:{"geocortex/infrastructure/undo/TransactionManager":function(){define(["require","exports"],function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})})},"geocortex/infrastructure/undo/TransactionStatus":function(){define(["require","exports"],function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(t){t.PENDING="pending",t.COMMITTING="committing",t.COMMITTED="committed",t.ABORTING="aborting",t.ABORTED="aborted"}(n.TransactionStatus||(n.TransactionStatus={}))})},"geocortex/infrastructure/undo/Undoable":function(){define(["require","exports"],function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})})},"geocortex/infrastructure/undo/UndoManager":function(){define(["require","exports","./UndoTransaction","./TransactionStatus"],function(t,n,i,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e;!function(t){t.IDLE="Idle",t.UNDOING="Undoing",t.REDOING="Redoing",t.COMMITTING="Committing",t.ROLLINGBACK="RollingBack"}(e=n.Status||(n.Status={}));var s=function(){function t(t,n){this.maxOperations=0,this.isSuspended=!1,this.isUndoing=!1,this.isRedoing=!1,this.canRedo=!1,this.canUndo=!1,this.length=0,this.position=0,this.rootTransaction=null,this._status=e.IDLE,this._historyStack=[],this.app=t,"number"==typeof(n=n||{}).maxOperations&&this.setMaxOperations(n.maxOperations),this.registerCommands()}return t.prototype.registerCommands=function(){var t=this;this.app.command("Undo").register(this,this.undo,function(n){return t.canUndo}),this.app.command("Redo").register(this,this.redo,function(n){return t.canRedo})},t.prototype.suspend=function(){this.isSuspended=!0},t.prototype.resume=function(){this.isSuspended=!1},t.prototype.setMaxOperations=function(t){this.maxOperations=t},t.prototype.getCurrentState=function(){return{historyStack:(this._historyStack||[]).slice(),position:this.position,rootTransaction:this.rootTransaction,status:this._status}},t.prototype.add=function(t){if(!t)throw new Error("Undo operation cannot be null");for(;this.maxOperations>0&&this._historyStack.length>=this.maxOperations;){var n=this._historyStack.shift();this.app.event("UndoOperationDiscardedEvent").publish({sender:this,operation:n})}this._historyStack.splice(this.position,0,t),this.position++,this.clearRedo(),this.app.event("UndoOperationAddedEvent").publish({sender:this,operation:t}),this._checkAvailability()},t.prototype.undo=function(){var t=this;if(0===this.position)return Promise.resolve();var n=this.peekUndo();return this.position--,n&&"function"==typeof n.performUndo?(this._updateStatus(e.UNDOING),this.app.event("UndoStartedEvent").publish({sender:this,operation:n}),n.performUndo(n.state).lastly(function(){t._updateStatus(e.IDLE),t.app.event("UndoCompletedEvent").publish({sender:t,operation:n}),t._checkAvailability()})):Promise.resolve()},t.prototype.redo=function(){var t=this;if(this.position===this._historyStack.length)return Promise.resolve();var n=this.peekRedo();return this.position++,n&&"function"==typeof n.performRedo?(this._updateStatus(e.REDOING),this.app.event("RedoStartedEvent").publish({sender:this,operation:n}),n.performRedo(n.state).lastly(function(){t._updateStatus(e.IDLE),t.app.event("RedoCompletedEvent").publish({sender:t,operation:n}),t._checkAvailability()})):Promise.resolve()},t.prototype.peekUndo=function(){return this._historyStack.length>0&&this.position>0?this.getAt(this.position-1):null},t.prototype.peekRedo=function(){return this._historyStack.length>0&&this.position<this._historyStack.length?this.getAt(this.position):null},t.prototype.clearUndo=function(){this._historyStack.splice(0,this.position),this.position=0,this._checkAvailability()},t.prototype.clearRedo=function(){this._historyStack.splice(this.position,this._historyStack.length-this.position),this.position=this._historyStack.length,this._checkAvailability()},t.prototype.getAt=function(t){return this._historyStack[t]},t.prototype.removeAt=function(t){0<=t&&t<this._historyStack.length&&(this._historyStack.splice(t,1),this.position>0&&this.position>t&&this.position--,this._checkAvailability())},t.prototype.beginTransaction=function(t,n){var o=new i.UndoTransaction(this,t);return this.rootTransaction?o.parentTransaction=n||this.rootTransaction:this.rootTransaction=o,o},t.prototype.commitTransaction=function(t){var n=this;if(!(t=t||this.rootTransaction))return Promise.reject(new Error("Cannot find the transaction to commit"));if(t.isComplete())return Promise.reject(new Error("Transaction has been closed already"));if(t.transactionStatus=o.TransactionStatus.COMMITTING,!t.hasChanges())return t.transactionStatus=o.TransactionStatus.COMMITTED,this._onTransactionCommitted(t),Promise.resolve();var e=function(n){return n instanceof i.UndoTransaction?n.isComplete()?Promise.resolve():n.commit():n&&"function"==typeof n.performRedo?n.performRedo(n.state,t):void 0},s=function(t,n){return n?e(n):null},r=t.changes[0];return e(r).then(function(){return Promise.reduce(t.changes.slice(1),s,null)}).then(function(){t.transactionStatus==o.TransactionStatus.COMMITTING&&(t.transactionStatus=o.TransactionStatus.COMMITTED,n._onTransactionCommitted(t))})},t.prototype.rollbackTransaction=function(t){var n=this;if(!(t=t||this.rootTransaction))return Promise.reject(new Error("Cannot find the transaction to rollback"));if(t.isComplete())return Promise.reject(new Error("Transaction has been closed already"));if(t.transactionStatus=o.TransactionStatus.ABORTING,!t.hasChanges())return t.transactionStatus=o.TransactionStatus.ABORTED,this._onTransactionAborted(t),Promise.resolve();return Promise.reduce(t.changes.slice().reverse(),function(n,o){return o instanceof i.UndoTransaction?o.isAborted()?Promise.resolve():o.rollback():o&&"function"==typeof o.performUndo?o.performUndo(o.state,t):void 0},null).then(function(){if(t.isAborted()||(t.transactionStatus=o.TransactionStatus.ABORTED,n._onTransactionAborted(t)),!t.isTopLevel()&&!t.parentTransaction.isAborted())return n.rollbackTransaction(t.parentTransaction)})},t.prototype.destroy=function(){this._historyStack=null},t.prototype._onTransactionCommitted=function(t){t&&t.isTopLevel()&&t==this.rootTransaction&&(this.rootTransaction=null,this.add(t))},t.prototype._onTransactionAborted=function(t){if(t){var n=t.parentTransaction;if(n){var i=n.changes.indexOf(t);i>-1&&n.changes.splice(i,1)}t.isTopLevel()&&t==this.rootTransaction&&(this.rootTransaction=null)}},t.prototype._checkAvailability=function(){this.length=this._historyStack.length,this.isUndoing=this._status==e.UNDOING,this.isRedoing=this._status==e.REDOING,0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canUndo=!1,this.canRedo=!0):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canUndo=this.canRedo=!0,this.app.command("Undo").raiseCanExecuteChanged(),this.app.command("Redo").raiseCanExecuteChanged(),this.app.event("UndoStackChangedEvent").publish({sender:this})},t.prototype._updateStatus=function(t){this._status=t||e.IDLE,this.isUndoing=this._status==e.UNDOING,this.isRedoing=this._status==e.REDOING},t}();n.UndoManager=s})},"geocortex/infrastructure/undo/UndoManagerState":function(){define(["require","exports"],function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})})},"geocortex/infrastructure/undo/UndoTransaction":function(){define(["require","exports","./TransactionStatus"],function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,n,o){if(void 0===n&&(n="[anonymous]"),void 0===o&&(o={}),!t)throw new Error("Transaction manager is required");this.owner=t,this.displayName=n,this.state=o,this.transactionStatus=i.TransactionStatus.PENDING,this.changes=[]}return t.prototype.isTopLevel=function(){return!this.parentTransaction},t.prototype.isComplete=function(){return this.isCommitted()||this.isAborted()},t.prototype.isAborted=function(){return this.transactionStatus==i.TransactionStatus.ABORTED},t.prototype.isCommitted=function(){return this.transactionStatus==i.TransactionStatus.COMMITTED},t.prototype.add=function(n,i,o){if(void 0===o&&(o={}),i&&!this.isComplete()){var e;e=i instanceof t?i:this._wrapInTransaction(n,i,o),this.changes.push(e)}},t.prototype._wrapInTransaction=function(n,o,e){void 0===e&&(e={}),o.state=o.state||e;var s=new t(this.owner,n);return s.transactionStatus=i.TransactionStatus.PENDING,s.parentTransaction=this,s.changes.push(o),s},t.prototype.hasChanges=function(){return this.changes.length>0},t.prototype.commit=function(){return this.owner.commitTransaction(this)},t.prototype.rollback=function(){return this.owner.rollbackTransaction(this)},t.prototype.performUndo=function(t,n){var i=this;if(!this.hasChanges())return Promise.resolve();return Promise.reduce(this.changes.slice().reverse(),function(t,n){if(n)return n.performUndo(n.state,i)},null)},t.prototype.performRedo=function(t,n){var i=this;if(!this.hasChanges())return Promise.resolve();return Promise.reduce(this.changes,function(t,n){if(n)return n.performRedo(n.state,i)},null)},t}();n.UndoTransaction=o})}}});require({cache:{"geocortex/infrastructure/UrlUtilities":function(){define(["require","exports","./Dictionary"],function(e,r,t){"use strict";function n(e){var r="";if(!e)return r;for(var t=e.keys(),n=0;n<t.length;n++)r.length>0&&(r+="&"),r+="{0}={1}".format(t[n],e.get(t[n]));return"{0}{1}".format(r.length>0?"?":"",r)}function a(e){var r=new t.Dictionary;return e?(e.startsWith("?")&&(e=e.slice(1)),e.split(/[&;]/g).forEach(function(e){if(e){var t=e.split("=",2);r.set(t[0],t[1])}}),r):r}function i(e){var r=document.createElement("a");return r.href=e,r}Object.defineProperty(r,"__esModule",{value:!0}),r.queryStringDictionaryToString=n,r.queryStringToDictionary=a,r.parseUrl=i,r.addQueryParameter=function(e,r,t){var o=i(e),h=a(o.search);return h.set(r,t),o.search=n(h),o.toString()},r.removeQueryParameter=function(e,r){var t=i(e),o=a(t.search);return o.remove(r),t.search=n(o),t.toString()},r.getFolder=function(e){var r="string"==typeof e?i(e):dojo.clone(e),t=null==r.pathname?"":r.pathname;if(null==t)return r;var n=t.split("/");return n[n.length-1].indexOf(".")>=0&&(n.pop(),r.pathname=n.join("/")),r.pathname.endsWith("/")||(r.pathname=r.pathname+"/"),r.search="",r.hash="",r.href=r.href.replace(/[\?#]+$/,""),r},r.removeParameters=function(e){var r="string"==typeof e?i(e):dojo.clone(e);return null==(null==r.pathname?"":r.pathname)?r:(r.pathname.endsWith("/")||(r.pathname=r.pathname+"/"),r.search="",r.hash="",r.href=r.href.replace(/[\?#]+$/,""),r)}})}}});require({cache:{"geocortex/infrastructure/validation/NumberValidator":function(){define(["require","exports","./../FormatUtils","geocortex/framework/utils/utils"],function(t,e,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.validate=function(t,e){var o=e&&!!e.invalidNumbersAsNaN,n=r.parseNumber(t);return i.isNullOrUndefined(t)?Promise.resolve({validatedValue:t}):isNaN(n)&&!o?Promise.reject(new Error("Invalid number.")):Promise.resolve({validatedValue:n})},t}();e.NumberValidator=o})},"geocortex/infrastructure/validation/ServiceDiscoveryUrlValidator":function(){var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","./SiteUrlValidator","geocortex/essentials/RestHelper","geocortex/essentials/serviceDiscovery/SiteServiceDiscoveryProvider"],function(e,r,i,o,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l=function(e){function r(t,r){var i=e.call(this,t)||this;if(i._serviceDiscovery=null,!t)throw new Error('Argument "app" is required.');return i.app=t,r&&i.setDiscoveryProvider(r),i}return t(r,e),r.prototype.getDiscoveryProvider=function(){return this._serviceDiscovery},r.prototype.setDiscoveryProvider=function(t){this._serviceDiscovery=t},r.prototype.validate=function(t,r){var i=this;return t?"string"!=typeof t?Promise.reject(new Error("Input is not a URL.")):this._initializeDiscoveryProvider().then(function(){return e.prototype.validate.call(i,t,r)}).catch(function(){return i._validate(t,r)}):Promise.resolve({validatedValue:t})},r.prototype._validate=function(t,e){var r=o.RestHelper.processClientSideTokens(this.app.site,t),i="The following URL is not allowed by this Essentials service connection whitelist and will be skipped: "+t;return Promise.resolve(this._serviceDiscovery.findServices(r)).then(function(e){if(e&&e.length>0&&e[0].isWhitelisted)return Promise.resolve({validatedValue:t});throw new Error(i)}).catch(function(){return Promise.reject(new Error(i))})},r.prototype._initializeDiscoveryProvider=function(){var t=this;return this._serviceDiscovery?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var e=t.app.site,r=new n.SiteServiceDiscoveryProvider;r.initialize(e),t.setDiscoveryProvider(r)})},r}(i.SiteUrlValidator);r.ServiceDiscoveryUrlValidator=l})},"geocortex/infrastructure/validation/SiteUrlValidator":function(){define(["require","exports","./../UrlUtilities","geocortex/essentials/RestHelper","geocortex/framework/utils/utils"],function(t,e,r,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){if(!t)throw new Error('Argument "app" is required.');this.app=t,this._initializeAllowedUrls(),this.app.command("ClearTrustedUrls").register(this,this.executeClearTrustedUrls)}return t.prototype.executeClearTrustedUrls=function(){for(var t=Object.keys(window.localStorage),e=0;e<t.length;e++)t[e].match("^uri.markup|^uri.css|^uri.navigablelink")&&window.localStorage.removeItem(t[e])},t.prototype.validate=function(t,e){var o=this;return t?"string"!=typeof t?Promise.reject(new Error("Input is not a URL.")):this._initializeAllowedUrls().then(function(){var e=r.parseUrl(i.RestHelper.processClientSideTokens(o.app.site,t));if(o._allowedUrls.some(function(t){return o._isMatch(t,e)}))return Promise.resolve({validatedValue:t});var n="The following URL is not defined by this Essentials site and will be skipped: {0}".format(t);return Promise.reject(n)}):Promise.resolve({validatedValue:t})},t.prototype.tryValidateSynchronously=function(t){var e=this;if(!this._allowedUrls)return!1;var o=r.parseUrl(i.RestHelper.processClientSideTokens(this.app.site,t));return this._allowedUrls.some(function(t){return e._isMatch(t,o)})},t.prototype._isMatch=function(t,e){return"mailto:"===e.protocol||!o.isNullOrUndefined(e.pathname)&&(e.host==t.host&&e.protocol==t.protocol&&(e.pathname.startsWith(t.pathname)||e.pathname+"/"===t.pathname))},t.prototype._initializeAllowedUrls=function(){var t=this;return this._allowedUrls?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var e=t.app.site;t._allowedUrls=[],t._allowUrl(e.url),t._allowUrl("http://localhost:8181"),t._allowUrl("http://127.0.0.1:8181");for(var r=0;r<e.trustedUrls.length;r++)t._allowUrl(e.trustedUrls[r].url);if(e.properties.trustedUrls&&e.properties.trustedUrls.split(",").forEach(function(e){t._allowUrl(e)}),e.essentialsMap)e.essentialsMap.mapServices.filter(function(t){return!t.isUserCreated}).forEach(function(e){t._allowUrl(e.serviceUrl),t._allowUrl(e.tileRestUrl),t._allowUrl(e.mapUrl),t._allowUrl(e.iconUri),(e.layerHyperlinks||[]).forEach(function(e){t._allowUrl(e.uri),t._allowUrl(e.iconUri)}),(e.layers||[]).forEach(function(e){t._allowUrl(e.getLayerUrl()),t._allowUrl(e.legendUrl),t._allowUrl(e.iconUri),(e.featureHyperlinks||[]).forEach(function(e){t._allowUrl(e.uri),t._allowUrl(e.iconUri)}),(e.layerHyperlinks||[]).forEach(function(e){t._allowUrl(e.uri),t._allowUrl(e.iconUri)}),t._extractUrls(e.featureLabel).forEach(function(e){return t._allowUrl(e)}),t._extractUrls(e.featureDescription).forEach(function(e){return t._allowUrl(e)}),t._extractUrls(e.featureLongDescription).forEach(function(e){return t._allowUrl(e)})})})})},t.prototype._allowUrl=function(t){if(t)try{this._allowedUrls.push(r.getFolder(t))}catch(t){}},t.prototype._extractUrls=function(t){return t?(t.match(/(https?:\/\/[A-Za-z0-9\-\._~:\/\?#[\]@!\$&'()*\+,;=%]+)/g)||[]).map(function(t){return t.indexOf("{")>=0?t.slice(0,t.indexOf("{")):t}):[]},t}();e.SiteUrlValidator=n})},"geocortex/infrastructure/validation/Validator":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})})},"geocortex/infrastructure/validation/XssHtmlValidator":function(){define(["require","exports","./../FilterUtils"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){void 0===t&&(t={}),this._tokenLeft="{",this._tokenRight="}",this._tokenLeftEscaped="\\{",this._tokenRightEscaped="\\}",t.contentPolicy&&(this._contentPolicy=t.contentPolicy)}return t.prototype.validate=function(t,e){var r=this;void 0===e&&(e={XssHtmlValidator:{}});var i={html:t,uris:[],contentPolicy:this._contentPolicy||e.XssHtmlValidator.defaultContentPolicy};if(!i.contentPolicy)throw new Error("XssHtmlValidator cannot perform validation without a ContentPolicy instance.");var o=e.sanitizeOptions;return Promise.resolve(i).then(function(t){return r._escape(t)}).then(function(t){return r._sanitize(t,o)}).then(function(t){return r._runUrisThroughContentPolicy(t)}).then(function(t){return r._applyUris(t)}).then(function(t){return r._unescape(t)}).then(function(t){return{validatedValue:t.html}})},t.prototype._escape=function(t){return t.html=t.html.split(this._tokenLeft).join(this._tokenLeftEscaped),t.html=t.html.split(this._tokenRight).join(this._tokenRightEscaped),t},t.prototype._sanitize=function(t,e){var i=this;void 0===e&&(e={});var o=e?e.uriTransformer:null;return e.uriTransformer=function(n,l){return o&&(n=o(n,l),l.uri=n),e.allowArbitraryHyperlinks&&l.type===r.UriType.NavigableLink?n:(t.uris.push(l),i._tokenize(t.uris.length-1))},t.html=r.sanitize(t.html,e),t},t.prototype._runUrisThroughContentPolicy=function(t){return this._contentPolicy?this._contentPolicy.screenUris(t.uris).then(function(e){return t}):t.contentPolicy.screenUris(t.uris).then(function(e){return t})},t.prototype._applyUris=function(t){var e=this;return t.uris.forEach(function(r,i){var o=e._tokenize(i);t.html=t.html.replace(o,r.uri)}),t},t.prototype._unescape=function(t){return t.html=t.html.split(this._tokenLeftEscaped).join(this._tokenLeft),t.html=t.html.split(this._tokenRightEscaped).join(this._tokenRight),t},t.prototype._tokenize=function(t){return this._tokenLeft+t.toString()+this._tokenRight},t}();e.XssHtmlValidator=i})}}});!function(){require({cache:{"geocortex/infrastructure/Viewer":function(){var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();define(["require","exports","geocortex/framework/application/Application","geocortex/framework/observables","./accessibility/AccessibilityManager","./coordinates/CoordinatesManager","./FeatureSetManager","./search/SearchManager","./HighlightManager","./native/NativeManager","./offline/OfflineManager","./states/StateManager","./undo/UndoManager","./menus/MenuRegistry","./tools/ToolRegistry","./toolbarGroup/ToolbarGroupRegistry","./clickableGraphics/ClickableGraphicsRegistry","./project/ProjectManager","./webMap/WebMapManager","./BookmarkManager","./ContentPolicy","./FilterUtils","geocortex/essentials/documents/DocumentStore","./FormatUtils","./GeometryUtils","geocortex/essentials/OAuth2Client"],function(require,exports,Application_1,observables_1,AccessibilityManager_1,CoordinatesManager_1,FeatureSetManager_1,SearchManager_1,HighlightManager_1,NativeManager_1,OfflineManager_1,StateManager_1,UndoManager_1,MenuRegistry_1,ToolRegistry_1,ToolbarGroupRegistry_1,ClickableGraphicsRegistry_1,ProjectManager_1,WebMapManager_1,BookmarkManager_1,ContentPolicy_1,FilterUtils_1,DocumentStore_1,FormatUtils_1,GeometryUtils_1,OAuth2Client_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ViewerApplication=function(_super){function ViewerApplication(configObject,hostElement,id,configTokens){var _this=_super.call(this,configObject,hostElement,id,configTokens)||this;return _this.version=eval("geocortex.essentialsHtmlViewer.version"),_this.markupLayer=new observables_1.Observable,_this.isArcGisWebApp=!1,_this._workflowActivityDispatcher=null,_this._activityTypeHandlerQueue=[],_this._activityIdHandlerQueue=[],_this._localeResourcesLoaded=!1,_this._initialProjectPromise=null,_this._momentLocales=["af","ar","ar-MA","ar-SA","ar-TN","az","be","bg","bn","bo","br","bs","ca","cs","cv","cy","da","de","de-AT","el","en-AU","en-CA","en-GB","eo","es","et","eu","fa","fi","fo","fr","fr-CA","fy","gl","he","hi","hr","hu","hy-AM","id","is","it","ja","jv","ka","km","ko","lb","lt","lv","me","mk","ml","mr","ms","ms-MY","my","nb","ne","nl","nn","pl","pt","pt-BR","ro","ru","si","sk","sl","sq","sr","sr-Cyrl","sv","ta","th","tl-PH","tr","tzl","tzm","tzm-Latn","uk","uz","vi","zh-CN","zh-TW"],_this._globalizeLocales=["af","ar","ar-MA","ar-SA","ar-TN","az","be","bg","bn","bo","br","bs","ca","cs","cy","da","de","de-AT","el","en","en-AU","en-CA","en-GB","eo","es","et","eu","fa","fi","fo","fr","fr-CA","fy","gl","he","hi","hr","hu","hy","id","is","it","ja","ka","km","ko","lb","lt","lv","mk","ml","mr","ms","my","nb","ne","nl","nn","pl","pt","ro","ru","si","sk","sl","sq","sr","sr-Cyrl","sv","ta","th","tr","tzm","tzm-Latn","uk","uz","vi","zh"],_this.___uaIsiPad=!!navigator.userAgent.match(/iPad/i),_this.accessibilityManager=new AccessibilityManager_1.AccessibilityManager(_this),_this.coordinatesManager=new CoordinatesManager_1.CoordinatesManager(_this),_this.featureSetManager=new FeatureSetManager_1.FeatureSetManager(_this),_this.searchManager=new SearchManager_1.SearchManager(_this),_this.highlightManager=new HighlightManager_1.HighlightManager(_this),_this.nativeManager=new NativeManager_1.NativeManager(_this),_this.offlineManager=new OfflineManager_1.OfflineManager(_this,"Mapping.Infrastructure"),_this.toolRegistry=new ToolRegistry_1.ToolRegistry(_this),_this.menuRegistry=new MenuRegistry_1.MenuRegistry(_this),_this.toolbarGroupRegistry=new ToolbarGroupRegistry_1.ToolbarGroupRegistry(_this),_this.stateManager=new StateManager_1.StateManager(_this,"Mapping.Infrastructure"),_this.undoManager=new UndoManager_1.UndoManager(_this),_this.project=new ProjectManager_1.ProjectManager(_this),_this.webMap=new WebMapManager_1.WebMapManager(_this),_this.bookmarks=new BookmarkManager_1.BookmarkManager(_this),_this.clickableGraphics=new ClickableGraphicsRegistry_1.ClickableGraphicsRegistry(_this),_this._applicationContentPolicy=new ContentPolicy_1.ContentPolicy(_this),_this._registerApplicationLevelCommands(),_this}return __extends(ViewerApplication,_super),Object.defineProperty(ViewerApplication.prototype,"defaultContentPolicy",{get:function(){return this._applicationContentPolicy},enumerable:!0,configurable:!0}),ViewerApplication.prototype.followNavigationLink=function(e){e.url;var t=e.element,i={uri:e.url,attribute:"href",tag:"a",type:FilterUtils_1.UriType.NavigableLink,linkChallengeCallback:function(e,i){if(e){var a="_blank";t&&t.hasAttribute("target")&&(a=t.getAttribute("target")),window.open(i.uri,a)}return!1}};return!!this._applicationContentPolicy.tryScreenNavLinkSynchronously(i)||(this._executeOpenWebPage(e),!1)},ViewerApplication.prototype._registerApplicationLevelCommands=function(){this.command("OpenWebPage").register(this,this._executeOpenWebPage),this._registerRelayCommand()},ViewerApplication.prototype._executeOpenWebPage=function(e){var t="string"==typeof e?e:e.url,i="string"==typeof e?null:e.element?e.element:null,a=["http","https","ftp","ftps","gopher","mailto","arcgis-navigator","comgooglemaps","comgooglemaps-x-callback","comgooglemapsurl"];("string"==typeof e?null:e.isLink?e.isLink:null)||(t=decodeURIComponent(t));var r=new dojo._Url(t);if(a.indexOf(r.scheme)<0)this.trace.warning("Could not open '"+t+"': Invalid URI scheme.");else{var n=function(e,t){var i="_blank";t&&t.hasAttribute("target")&&(i=t.getAttribute("target")),window.open(e,i)},o={uri:t,attribute:"href",tag:"a",type:FilterUtils_1.UriType.NavigableLink,linkChallengeCallback:function(e,t){return e&&n(t.uri,i),!1}};if(this._applicationContentPolicy.hasFlag(1)||this._applicationContentPolicy.tryScreenNavLinkSynchronously(o))return n(o.uri,i),!1;o.forcePrompt=!0,this._applicationContentPolicy.screenUris([o])}},ViewerApplication.prototype._registerRelayCommand=function(){var e=this,t=function(e){return e&&"string"==typeof e&&e.startsWith("$context.")},i=function(e,i){var a=i;if(t(e)){var r=e.split(".");r.splice(0,1);for(var n=0,o=r;n<o.length;n++){var l=o[n];if(null===a||void 0===a)break;a=a[l]}}return a},a=function(e){var a={};if(t(e.commandParameter))a=i(e.commandParameter,e.context);else for(var r in e.commandParameter)if(e.commandParameter.hasOwnProperty(r)){var n=e.commandParameter[r];"function"!=typeof n&&(a[r]=n,t(n)&&(a[r]=i(n,e.context)))}return a};this.command("RelayCommand").register(this,function(t){var i=a(t);e.command(t.commandName).execute(i)},function(t){if(t&&t.commandName&&t.commandParameter&&t.context&&"{{context}}"!==t.context){var i=a(t);return e.command(t.commandName).canExecute(i)}return!1})},ViewerApplication.prototype.initialize=function(){var e=this;document.all&&!document.querySelector&&(this.debugMode=!0);var t=this.configUri?this.configUri.split("/"):window.location.href.split("/"),i=t.slice(0,t.length-1).join("/")+"/";this.configTokens.ViewerConfigUri=i,this.getUrlParameter("gcxLocalServer")&&(this.localServerAddress=this.getUrlParameter("gcxLocalServer")),this.getUrlParameter("gcxLocalServerNamespace")&&(this.localServerNamespace=this.getUrlParameter("gcxLocalServerNamespace")),this.getUrlParameter("gcxLocalServerToken")&&(this.localServerToken=this.getUrlParameter("gcxLocalServerToken")),this._offlineManagerLoaded=this.offlineManager.load(),_super.prototype.initialize.call(this);var a=this.getUrlParameter(ProjectManager_1.PROJECT_QUERY_STRING_KEY);if(a){var r=this.getUrlParameter(DocumentStore_1.LINK_QUERY_STRING_KEY);r&&this.waitUntilSiteInitialized().then(function(){return e.site.documentStore.setGuestLink(r)}),this.waitUntilAllLibrariesLoaded().then(function(){return e.event("ProjectLoadingEvent").publish(a)}),this._initialProjectPromise=this.project.read(a).then(function(t){return e.project._beginLoad(t)}).catch(function(t){e.trace.error("Error loading project: {0}".format(t.message),t)});var n=this.initialStateAppliedCallback;this.initialStateAppliedCallback=function(t){e.project.isLoading&&e.project._finishLoad(),n&&n(t)}}},ViewerApplication.prototype.waitUntilSiteInitialized=function(){var e=this;return new Promise(function(t,i){e.site&&e.site.isInitialized?t():(e.event("SiteInitializedEvent").once(e,function(e){t()}),e.event("SiteInitializationFailedEvent").once(e,function(e){i(e)}),e.event("SiteAuthorizationFailedEvent").once(e,function(e){i(e)}))})},ViewerApplication.prototype.waitUntilDocumentStoreInitialized=function(){var e=this;return this.waitUntilSiteInitialized().then(function(){return e.site.documentStore.onInitialized()})},ViewerApplication.prototype.waitUntilOfflineManagerLoaded=function(){return this._offlineManagerLoaded},ViewerApplication.prototype.waitUntilMapLoaded=function(){var e=this;return new Promise(function(t,i){if(e.map&&e.map.loaded)t();else if(e.map)var a=e.map.on("load",function(e){a.remove(),t()});else e.event("SiteInitializingEvent").once(e,function(){var i=e.map.on("load",function(e){i.remove(),t()})})})},ViewerApplication.prototype.waitUntilServiceLayerLoaded=function(e){return new Promise(function(t,i){if(e.loadError)i(e.loadError);else if(e.loaded)t();else var a=e.on("load",function(e){a.remove(),r.remove(),t()}),r=e.on("error",function(e){a.remove(),r.remove(),i(e.error)})})},ViewerApplication.prototype.waitUntilSiteServiceLayersLoaded=function(){var e=this;return new Promise(function(t,i){e.site&&e.site.serviceLayersLoaded?t():(e.event("SiteServiceLayersLoadedEvent").once(e,function(e){t()}),e.event("SiteInitializationFailedEvent").once(e,function(e){i(e)}),e.event("SiteAuthorizationFailedEvent").once(e,function(e){i(e)}))})},ViewerApplication.prototype.waitUntilAllLibrariesLoaded=function(){var e=this;return new Promise(function(t,i){e.allLibrariesLoaded?t():e.event("ViewerLibrariesDownloadedEvent").once(e,function(e){t()})})},ViewerApplication.prototype.waitUntilViewInitialized=function(e){var t=this;return new Promise(function(i,a){var r=t.viewManager.getViewById(e);if(r&&r.initiallyBound)i(r);else var n=t.event("ViewInitializedEvent").subscribe(t,function(a){a.id===e&&(i(a),t.event("ViewInitializedEvent").unsubscribe(n))})})},ViewerApplication.prototype.registerActivityTypeHandler=function(e,t){this._workflowActivityDispatcher?this._workflowActivityDispatcher.registerActivityHandler(e,t):this._activityTypeHandlerQueue.push({typeName:e,handler:t})},ViewerApplication.prototype.registerActivityIdHandler=function(e,t){this._workflowActivityDispatcher?this._workflowActivityDispatcher.registerExternalIdHandler(e,t):this._activityIdHandlerQueue.push({id:e,handler:t})},ViewerApplication.prototype.getWorkflowActivityDispatcher=function(){return this._workflowActivityDispatcher},ViewerApplication.prototype.setWorkflowActivityDispatcher=function(e){this._workflowActivityDispatcher=e;for(i=0;i<this._activityTypeHandlerQueue.length;++i){var t=this._activityTypeHandlerQueue[i];this._workflowActivityDispatcher.registerActivityHandler(t.typeName,t.handler)}this._activityTypeHandlerQueue.length=0;for(var i=0;i<this._activityIdHandlerQueue.length;++i){var a=this._activityIdHandlerQueue[i];this._workflowActivityDispatcher.registerExternalIdHandler(a.id,a.handler)}this._activityIdHandlerQueue.length=0},ViewerApplication.prototype.shutdown=function(e){this.toolRegistry.clear(),this.undoManager.destroy(),this.clickableGraphics.clear(),_super.prototype.shutdown.call(this,e)},ViewerApplication.prototype.onConfigurationLoaded=function(e){var t=this,i=e.configuration,a=!0;if(i.hasOwnProperty("application")&&i.application.hasOwnProperty("contentPolicy")){var r=i.application.contentPolicy;r.disableSecurityPrompt&&this._applicationContentPolicy.setFlag(1),!1===r.disablePromptOnImages&&(a=!1),!0===r.trustExactUrl&&this._applicationContentPolicy.setFlag(4)}a&&this._applicationContentPolicy.setFlag(2),this._applicationContentPolicy.screenUris([]),i&&i.hasOwnProperty("application")&&i.application.locale&&(this.locale=i.application.locale),this.urlParameters&&this.getUrlParameter("locale")&&(this.locale=this.getUrlParameter("locale"));var n=this.locale||"en-US";document.documentElement.setAttribute("lang",n),this._loadThirdPartyLocaleResources().then(function(){if($&&$.timepicker){var a=Object.getPrototypeOf($.timepicker);a._onTimeChange&&(a._base_onTimeChange=a._onTimeChange,a._onTimeChange=function(){if(this._base_onTimeChange(),this._defaults&&this._defaults.gcxTimeFormat&&this.$timeObj){var e=FormatUtils_1.formatDate($(this.$input).datepicker("getDate"),this._defaults.gcxTimeFormat);this.$timeObj.text(e)}if(this._defaults&&!0===this._defaults.gcxTimeStyle){var t=this.$timeObj?this.$timeObj.prevObject:null;t&&1!==$(".info-message",t).length&&t.append("<div class='info-message'></div>");var i=t?$(".info-message",t):null;i&&(i.text(this._defaults.timeText+": "+this.$timeObj.text()),this.$timeObj.css("display","none"),$(this.$timeObj.selector+"_label").css("display","none"))}})}if($&&$.datepicker&&$.datepicker._showDatepicker&&($.datepicker.__base_showDatepicker=$.datepicker._showDatepicker,$.datepicker._showDatepicker=function(e){this.__base_showDatepicker(e);var t=$(e).siblings(".gcxDatepicker");t.length&&t.focus()}),i.hasOwnProperty("application")&&i.application.hasOwnProperty("geometryServiceUrl")&&(esri.config.defaults.geometryService=new esri.tasks.GeometryService(i.application.geometryServiceUrl)),i.hasOwnProperty("application")&&i.application.hasOwnProperty("datumTransforms")?GeometryUtils_1.registerDatumTransforms(i.application.datumTransforms):GeometryUtils_1.registerDefaultDatumTransforms(),e.configuration.application&&e.configuration.application.oAuth2ClientId){window.location.href;if(!OAuth2Client_1.OAuth2Client.applicationHasImplicitGrant()&&!OAuth2Client_1.OAuth2Client.applicationHasImplicitGrantError()){var r=e.configuration.application.oAuth2AuthorizeUri||"http://www.arcgisonline.com/sharing/oauth2/authorize";return OAuth2Client_1.OAuth2Client.redirectToLogOnPage(r,e.configuration.application.oAuth2ClientId),void(t.abortInitialization=!0)}}_super.prototype.onConfigurationLoaded.call(t,e)})},ViewerApplication.prototype.getInitialState=function(e,t){var i=this;return!this._initialProjectPromise||this._initialProjectPromise.isRejected()?Promise.resolve(null):this._initialProjectPromise.then(function(){var t=i.project.current;return t&&t.content&&t.content.moduleState?t.content.moduleState[e]:null})},Object.defineProperty(ViewerApplication.prototype,"locale",{get:function(){return this._locale},set:function(e){this._locale=this._canonicalizeLocale(e),this._localeResourcesLoaded&&(moment.locale(this._getMomentLocaleForLocale(this._locale)),_globalize.locale(this._getGlobalizeLocaleForLocale(this._locale)))},enumerable:!0,configurable:!0}),ViewerApplication.prototype.doWhenMapInitialized=function(e){var t=this;if(this.isArcGisWebApp)e();else if(this.site&&this.site.isInitialized)e();else var i=this.eventRegistry.event("SiteServiceLayersLoadedEvent").subscribe(this,function(){t.eventRegistry.event("SiteServiceLayersLoadedEvent").unsubscribe(i),e()})},ViewerApplication.prototype._loadThirdPartyLocaleResources=function(){var e,t=this;return"function"==typeof define&&(e=define.amd,delete define.amd),Promise.all([this._loadMomentLocaleData(),this._loadGlobalizeLocaleData()]).then(function(){"function"==typeof define&&(define.amd=e),t._localeResourcesLoaded=!0},function(t){"function"==typeof define&&(define.amd=e)})},ViewerApplication.prototype._loadMomentLocaleData=function(){var e=this,t=this._getMomentLocaleForLocale(this.locale);return moment.localeData(t)?Promise.resolve():new Promise(function(i,a){if("en"===t)i();else{var r="./Resources/Scripts/moment/locale/"+t+".js";e.includeScript(r,function(e){moment.locale(t),i()},a)}})},ViewerApplication.prototype._loadGlobalizeLocaleData=function(){var e=this._getGlobalizeLocaleForLocale(this.locale),t="./Resources/Scripts/globalize/locale/"+e+".json";return this.fetchConfigResource({url:t}).then(function(t){var i=JSON.parse(t);_globalize.load(i),_globalize.locale(e)})},ViewerApplication.prototype._getMomentLocaleForLocale=function(e){return this._getBestMatchLocale(e,this._momentLocales)},ViewerApplication.prototype._getGlobalizeLocaleForLocale=function(e){return this._getBestMatchLocale(e,this._globalizeLocales)},ViewerApplication.prototype._getBestMatchLocale=function(e,t){e=this._canonicalizeLocale(e);var i=this._parseLocale(e);if(t.indexOf(e)>=0)return e;if(i.script){if(e=i.language+"-"+i.script,t.indexOf(e)>=0)return e;if(e=i.language+"-"+i.territory,t.indexOf(e)>=0)return e}else if(i.territory&&(e=i.language,t.indexOf(e)>=0))return e;return"en"},ViewerApplication.prototype._parseLocale=function(e){if(!e)throw new Error("Invalid locale: {0}".format(e));var t=e.split("-");if(t.length<1||t.length>3||t.some(function(e){return 0===e.length}))throw new Error("Invalid locale: {0}".format(e));var i={language:t[0].toLowerCase()};return 2==t.length?2==t[1].length?i.territory=t[1].toUpperCase():i.script=t[1][0].toUpperCase()+t[1].slice(1).toLowerCase():3===t.length&&(i.script=t[1][0].toUpperCase()+t[1].slice(1).toLowerCase(),i.territory=t[2].toUpperCase()),i},ViewerApplication.prototype._canonicalizeLocale=function(e){var t=this._parseLocale(e),i=t.language;return t.script&&(i+="-"+t.script),t.territory&&(i+="-"+t.territory),i},ViewerApplication}(Application_1.Application);exports.ViewerApplication=ViewerApplication})}}})}();require({cache:{"geocortex/infrastructure/visualization/VisualizationProviderBase":function(){define(["require","exports","geocortex/framework/observables"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,i){this.visualizations=[],this.enabledVisualization=null,this.currentLayer=new t.Observable(null),this.isEnabled=new t.Observable(!1),this.isSupported=new t.Observable(!1),this.app=e,this.libraryId=i,this.currentLayer.bind(this,this.handleCurrentLayerChanged)}return e.prototype.initialize=function(e){e.viewId&&(this.viewId=e.viewId),e.displayName&&(this.displayName=e.displayName)},e.prototype.canSupport=function(e){return!1},e.prototype.handleCurrentLayerChanged=function(e){throw new Error("Not implemented")},e.prototype.handleActivate=function(e){throw new Error("Not implemented")},e.prototype.handleApply=function(){throw new Error("Not implemented")},e}();i.VisualizationProviderBase=r})},"geocortex/infrastructure/visualization/VisualizationProviderConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/VisualizationUtils":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getFeatureHeatMap=function(e){return e&&e.mapService?(e.includeInLegend&&e.mapService.heatMap&&(e.mapService.heatMap.includeInLegend=e.includeInLegend),e.mapService.heatMap):null},r.getHeatMapRenderer=function(e){if(!e||!e.mapService||!e.mapService.serviceLayer)return null;var r=e.mapService.serviceLayer.renderer;return r instanceof esri.renderer.HeatmapRenderer?r:null}})}}});require({cache:{"geocortex/infrastructure/webMap/BaseMap":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/BaseMapLayer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.OPEN_STREET_MAP="OpenStreetMap",e.BING_AERIAL="BingMapsAerial",e.BING_ROAD="BingMapsRoad",e.BING_HYBRID="BingMapsHybrid",e.WEB_TILED="WebTiledLayer"}(r.BaseMapType||(r.BaseMapType={}))})},"geocortex/infrastructure/webMap/Bookmark":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/CsvLayer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Domain":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.INHERITED="inherited",e.RANGE="range",e.CODED_VALUE="codedValue"}(r.DomainType||(r.DomainType={}))})},"geocortex/infrastructure/webMap/DrawingInfo":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Feature":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/FeatureCollection":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/FeatureSet":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Field":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Geometry":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.POINT="esriGeometryPoint",e.MULTIPOINT="esriGeometryMultipoint",e.POLYLINE="esriGeometryPolyline",e.POLYGON="esriGeometryPolygon",e.EXTENT="esriGeometryEnvelope",e.fromEsriGeometryType=function(r){if(r){if(r.startsWith("esriGeometry"))return r;switch(r){case"point":return e.POINT;case"multipoint":return e.MULTIPOINT;case"polyline":return e.POLYLINE;case"polygon":return e.POLYGON;case"extent":return e.EXTENT;default:throw new Error("GeometryType.fromEsriGeometryType: Unrecognized geometry type.")}}}}(r.GeometryType||(r.GeometryType={}))})},"geocortex/infrastructure/webMap/Layer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/LayerDefinition":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/LocationInfo":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/OperationalLayer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.CSV="CSV",e.WMS="WMS",e.KML="KML",e.WFS="WFS",e.STREAM="STREAM"}(r.OperationalLayerType||(r.OperationalLayerType={}))})},"geocortex/infrastructure/webMap/PopupInfo":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Renderer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.SIMPLE="simple",e.UNIQUE_VALUE="uniqueValue",e.CLASS_BREAKS="classBreaks",e.HEATMAP="heatmap"}(r.RendererType||(r.RendererType={}));!function(e){e.BY_FIELD="esriNormalizeByField",e.BY_LOG="esriNormalizeByLog",e.BY_PERCENT_OF_TOTAL="esriNormalizeByPercentOfTotal"}(r.NormalizationType||(r.NormalizationType={}));!function(e){e.NATURAL_BREAKS="esriClassifyNaturalBreaks",e.EQUAL_INTERVAL="esriClassifyEqualInterval",e.QUANTILE="esriClassifyQuantile",e.STANDARD_DEVIATION="esriClassifyStandardDeviation",e.GEOMETRICAL_INTERVAL="esriClassifyGeometricalInterval"}(r.ClassificationMethod||(r.ClassificationMethod={}))})},"geocortex/infrastructure/webMap/ServiceLayer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/SpatialReference":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Symbol":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.SIMPLE_MARKER="esriSMS",e.SIMPLE_LINE="esriSLS",e.SIMPLE_FILL="esriSFS",e.PICTURE_MARKER="esriPMS",e.PICTURE_FILL="esriPFS",e.TEXT="esriTS"}(r.SymbolType||(r.SymbolType={}));!function(e){e.CIRCLE="esriSMSCircle",e.CROSS="esriSMSCross",e.DIAMOND="esriSMSDiamond",e.SQUARE="esriSMSSquare",e.X="esriSMSX",e.TRIANGLE="esriSMSTriangle",e.PATH="esriSMSPath"}(r.SimpleMarkerStyle||(r.SimpleMarkerStyle={}));!function(e){e.DASH="esriSLSDash",e.DASH_DOT="esriSLSDashDot",e.DASH_DOT_DOT="esriSLSDashDotDot",e.DOT="esriSLSDot",e.NONE="esriSLSNull",e.SOLID="esriSLSSolid"}(r.SimpleLineStyle||(r.SimpleLineStyle={}));!function(e){e.BACKWARD_DIAGONAL="esriSFSBackwardDiagonal",e.CROSS="esriSFSCross",e.DIAGONAL_CROSS="esriSFSDiagonalCross",e.FORWARD_DIAGONAL="esriSFSForwardDiagonal",e.HORIZONTAL="esriSFSHorizontal",e.NONE="esriSFSNull",e.SOLID="esriSFSSolid",e.VERTICAL="esriSFSVertical"}(r.SimpleFillStyle||(r.SimpleFillStyle={}));!function(e){e.BASELINE="baseline",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom"}(r.VerticalAlignment||(r.VerticalAlignment={}));!function(e){e.LEFT="left",e.RIGHT="right",e.CENTER="center",e.JUSTIFY="justify"}(r.HorizontalAlignment||(r.HorizontalAlignment={}));!function(e){e.ITALIC="italic",e.NORMAL="normal",e.OBLIQUE="oblique"}(r.FontStyle||(r.FontStyle={}));!function(e){e.BOLD="bold",e.BOLDER="bolder",e.LIGHTER="lighter",e.NORMAL="normal"}(r.FontWeight||(r.FontWeight={}));!function(e){e.LINE_THROUGH="line-through",e.UNDERLINE="underline",e.NONE="none"}(r.TextDecoration||(r.TextDecoration={}))})},"geocortex/infrastructure/webMap/Template":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/Type":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/WebMap":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})},"geocortex/infrastructure/webMap/WebMapConverter":function(){define(["require","exports","./Symbol","geocortex/essentials/MapService","geocortex/essentials/Layer","./../FeatureSet","./../Feature","./Geometry","./Renderer","geocortex/framework/utils/ArrayUtils","./OperationalLayer","./../LayerIntegrationUtils","geocortex/framework/utils/utils","geocortex/essentials/Field","geocortex/essentials/LayerType","./../PromiseUtils","geocortex/essentials/MapServiceConstants","./BaseMapLayer"],function(e,r,t,i,n,o,a,s,l,u,c,y,p,f,m,d,h,_){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var b=function(){return function(){}}();r.CONVERSION_TYPE_PROPERTY="__conversionType";var S,E={type:t.SymbolType.SIMPLE_MARKER,style:t.SimpleMarkerStyle.CIRCLE,size:0,color:[0,0,0,0]};!function(e){e.StreamLayer="StreamLayer",e.FeatureLayer="ArcGISFeatureLayer",e.MapService="ArcGISMapServiceLayer",e.TiledMapService="ArcGISTiledMapServiceLayer",e.ImageService="ArcGISImageServiceLayer",e.BingAerial="BingMapsAerial",e.BingHybrid="BingMapsHybrid",e.BingRoad="BingMapsRoad",e.OpenStreetMap="OpenStreetMap",e.WebTiled="WebTiledLayer",e.KML="KML",e.WMS="WMS",e.WFS="WFS"}(S=r.LayerType||(r.LayerType={}));var L;!function(e){e.WEB_MAP_SERVICE_LAYER="webMapServiceLayer",e.WEB_MAP_LAYER="webMapLayer",e.WEB_MAP_FEATURE_SET="webMapFeatureSet",e.WEB_MAP_FEATURE="webMapFeature",e.WEB_MAP_GEOMETRY="webMapGeometry",e.WEB_MAP_SYMBOL="webMapSymbol",e.WEB_MAP_RENDERER="webMapRenderer",e.WEB_MAP_SPATIAL_REFERENCE="webMapSpatialReference",e.WEB_MAP_COLOR="webMapColor",e.WEB_MAP_DATA="webMapData",e.GCX_MAP_SERVICE="gcxMapService",e.GCX_LAYER="gcxLayer",e.GCX_FEATURE_SET="gcxFeatureSet",e.GCX_FEATURE="gcxFeature",e.ESRI_LAYER="esriLayer",e.ESRI_FEATURE_SET="esriFeatureSet",e.ESRI_GRAPHIC="esriGraphic",e.ESRI_GEOMETRY="esriGeometry",e.ESRI_SYMBOL="esriSymbol",e.ESRI_RENDERER="esriRenderer",e.ESRI_SPATIAL_REFERENCE="esriSpatialReference",e.ESRI_COLOR="esriColor",e.OBJECT="object"}(L=r.ConversionType||(r.ConversionType={}));var g=function(){function e(e){this._resultCache={},this._nextSymbolId=1,this._nestingLevel=0,this._hasReferences=!1,this._converting={},this.app=e}return e.prototype.fromGcxMapService=function(e){return this._convert(e,L.WEB_MAP_SERVICE_LAYER,this._fromGcxMapService)},e.prototype.fromGcxLayer=function(e){return this._convert(e,L.WEB_MAP_LAYER,this._fromGcxlayer)},e.prototype.fromGcxFeatureSet=function(e){return this._convert(e,L.WEB_MAP_FEATURE_SET,this._fromGcxFeatureSet)},e.prototype.fromGcxFeature=function(e){return this._convert(e,L.WEB_MAP_FEATURE,this._fromGcxFeature)},e.prototype.fromEsriLayer=function(e){return this._convert(e,L.WEB_MAP_SERVICE_LAYER,this._fromEsriLayer)},e.prototype.fromEsriFeatureSet=function(e){return this._convert(e,L.WEB_MAP_FEATURE_SET,this._fromEsriFeatureSet)},e.prototype.fromEsriGraphic=function(e){return this._convert(e,L.WEB_MAP_FEATURE,this._fromEsriGraphic)},e.prototype.fromEsriGeometry=function(e){return this._convert(e,L.WEB_MAP_GEOMETRY,this._fromEsriGeometry)},e.prototype.fromEsriSymbol=function(e){return this._convert(e,L.WEB_MAP_SYMBOL,this._fromEsriSymbol)},e.prototype.fromEsriRenderer=function(e){return this._convert(e,L.WEB_MAP_RENDERER,this._fromEsriRenderer)},e.prototype.fromEsriSpatialReference=function(e){return this._convert(e,L.WEB_MAP_SPATIAL_REFERENCE,this._fromEsriSpatialReference)},e.prototype.fromEsriColor=function(e){return this._convert(e,L.WEB_MAP_COLOR,this._fromEsriColor)},e.prototype.fromObject=function(e){return this._convert(e,L.WEB_MAP_DATA,this._fromObject)},e.prototype.toGcxMapService=function(e){return Promise.resolve(this._convert(e,L.GCX_MAP_SERVICE,this._toGcxMapService))},e.prototype.toGcxLayer=function(e,r){return Promise.resolve(this._convert(e,L.GCX_LAYER,this._toGcxLayer,[r]))},e.prototype.toGcxFeatureSet=function(e){return Promise.resolve(this._convert(e,L.GCX_FEATURE_SET,this._toGcxFeatureSet))},e.prototype.toGcxFeature=function(e){return Promise.resolve(this._convert(e,L.GCX_FEATURE,this._toGcxFeature))},e.prototype.toEsriLayer=function(e){return Promise.resolve(this._convert(e,L.ESRI_LAYER,this._toEsriLayer))},e.prototype.toEsriFeatureSet=function(e){return Promise.resolve(this._convert(e,L.ESRI_FEATURE_SET,this._toEsriFeatureSet))},e.prototype.toEsriGraphic=function(e){return Promise.resolve(this._convert(e,L.ESRI_GRAPHIC,this._toEsriGraphic))},e.prototype.toEsriGeometry=function(e){return this._convert(e,L.ESRI_GEOMETRY,this._toEsriGeometry)},e.prototype.toEsriSymbol=function(e){return this._convert(e,L.ESRI_SYMBOL,this._toEsriSymbol)},e.prototype.toEsriRenderer=function(e){return this._convert(e,L.ESRI_RENDERER,this._toEsriRenderer)},e.prototype.toEsriSpatialReference=function(e){return this._convert(e,L.ESRI_SPATIAL_REFERENCE,this._toEsriSpatialReference)},e.prototype.toEsriColor=function(e){return this._convert(e,L.ESRI_COLOR,this._toEsriColor)},e.prototype.toObject=function(e){return Promise.resolve(this._convert(e,L.OBJECT,this._toObject))},e.prototype.clearCache=function(){this._resultCache={}},e.prototype._convert=function(e,r,t,i){if(void 0===i&&(i=[]),null===e||void 0===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||e instanceof Date)return e;var n=this._resultCache[r];n||(n=this._resultCache[r]=new WeakMap);var o=this._converting[r];if(o||(o=this._converting[r]=new WeakMap),n.has(e))return n.get(e);if(o.has(e)){var a=new b;return n.set(e,a),this._hasReferences=!0,a}var s=void 0;0===this._nestingLevel&&(this._hasReferences=!1),this._nestingLevel++,o.set(e,!0);try{s=t.apply(this,[e].concat(i)),(a=n.get(e))&&(a.result=s),n.set(e,s)}catch(r){throw n.delete(e),r}finally{this._nestingLevel--,o.delete(e)}return 0===this._nestingLevel&&this._hasReferences&&this._resolveReferences(s),s},e.prototype._resolveReferences=function(e){if(e){var r=new WeakMap,t=function(e){if(!(e instanceof i.MapService||e instanceof n.Layer)){r.set(e,!0);for(var o in e){var a=e[o];"object"==typeof a&&(a instanceof b?e[o]=a.result:a&&!r.has(a)&&t(a))}}};t(e)}},e.prototype._getWebMapLayerDefinitionFromFeatureLayer=function(e){var r={};return r.definitionExpression=e.getDefinitionExpression(),r.drawingInfo={renderer:this.fromEsriRenderer(e.renderer)},r},e.prototype._getWebMapLayerDefinitionFromDynamicLayer=function(e,r){var t={},i=!1;if(e.layerDefinitions&&e.layerDefinitions[r]&&(i=!0,t.definitionExpression=e.layerDefinitions[r]),e.dynamicLayerInfos){var n=u.firstOrDefault(e.dynamicLayerInfos,function(e){return e.id===r});n&&(i=!0,t.minScale=n.minScale,t.maxScale=n.maxScale,t.source=n.source.toJson())}return e.layerDrawingOptions&&e.layerDrawingOptions[r]&&(i=!0,t.drawingInfo={renderer:this.fromEsriRenderer(e.layerDrawingOptions[r].renderer),fixedSymbols:!e.layerDrawingOptions[r].scaleSymbols}),i?t:null},e.prototype._applyWebMapServiceLayerToMapService=function(e,r){var t=this;return Promise.try(function(){r.setOpacity(e.opacity),r.setVisibility(e.visibility);var i=r.serviceLayer,n=e;return i instanceof esri.layers.FeatureLayer&&(r.layers[0].setVisibility(e.visibility),n.layerDefinition&&n.layerDefinition.definitionExpression&&i.setDefinitionExpression(n.layerDefinition.definitionExpression)),t._isFeatureCollection(e)&&n.featureCollection.layers[0].layerDefinition?t._applyDrawingInfo(n.featureCollection.layers[0].layerDefinition.drawingInfo,r):n.layerDefinition?t._applyDrawingInfo(n.layerDefinition.drawingInfo,r):void 0})},e.prototype._applyWebMapLayersToGcxLayers=function(e,r){var t=this,i=[];return(e.layers||[]).forEach(function(e,n){var o=t._findOrCreateMatchingGcxLayer(e,r).then(function(r){return!!r&&t._applyWebMapLayerToGcxLayer(e,n,r)});i.push(o)}),Promise.all(i).then(function(e){return e.some(function(e){return e})})},e.prototype._applyWebMapLayerToGcxLayer=function(e,r,t){var i=this,n=t.mapService.serviceLayer;if(!(e.layerDefinition&&n instanceof esri.layers.ArcGISDynamicMapServiceLayer))return Promise.resolve(!1);var o=n;return this.app.waitUntilServiceLayerLoaded(n).then(function(){var r=parseInt(t.id),n=!1;if(e.layerDefinition.definitionExpression){var a=(o.layerDefinitions||[]).slice();a[r]=e.layerDefinition.definitionExpression,o.setLayerDefinitions(a,!0),n=!0}if(e.layerDefinition.drawingInfo){t.mapService.convertToDynamicLayers();var s=(o.layerDrawingOptions||[]).slice();if(s[r]=new esri.layers.LayerDrawingOptions,s[r].renderer=i.toEsriRenderer(e.layerDefinition.drawingInfo.renderer),s[r].scaleSymbols=!e.layerDefinition.drawingInfo.fixedSymbols,e.layerDefinition.drawingInfo.hasOwnProperty("showLabels")&&(s[r].showLabels=e.layerDefinition.drawingInfo.showLabels),e.layerDefinition.drawingInfo.hasOwnProperty("labelingInfo")&&e.layerDefinition.drawingInfo.labelingInfo){var l=e.layerDefinition.drawingInfo.labelingInfo;s[r].labelingInfo=s[r].labelingInfo||[],s[r].labelingInfo.length?s[r].labelingInfo[0]=new esri.layers.LabelClass(l[0]):s[r].labelingInfo.push(new esri.layers.LabelClass(l[0]));var c=l[0],y=c.symbol.color,p=c.symbol.haloColor;y&&s[r].labelingInfo[0].symbol.setColor(new esri.Color([y.r,y.g,y.b,y.a])),p&&s[r].labelingInfo[0].symbol.setHaloColor(new esri.Color([p.r,p.g,p.b,p.a]));var f=s[r].labelingInfo[0].symbol;s[r].labelingInfo[0].symbol.font.setSize(.75*f.font.size),s[r].labelingInfo[0].symbol.setHaloSize(.75*f.haloSize)}o.setLayerDrawingOptions(s,!0),n=!0}if(o.dynamicLayerInfos){var m=u.firstOrDefault(o.dynamicLayerInfos,function(e){return e.id===r});m&&(m.minScale=e.layerDefinition.minScale,m.maxScale=e.layerDefinition.maxScale,o.setDynamicLayerInfos(o.dynamicLayerInfos,!0),n=!0)}return n})},e.prototype._applyDrawingInfo=function(e,r){var t=this;if(!e)return Promise.resolve();var i=r.serviceLayer;return this.app.waitUntilServiceLayerLoaded(i).then(function(){if(!r.heatMap||!r.heatMap.userCanToggle||r.isUserCreated&&r.heatMap.enabled||t.app.command("RemoveHeatMap").execute({gcxLayer:r.layers[0]}),e.renderer)if(r.heatMap&&r.heatMap.userCanToggle&&e.renderer.type===l.RendererType.HEATMAP){var n=e.renderer;if(n){var o=r.heatMap;o.intensity=n.blurRadius,o.field=n.field,o.gradient=[],o.offset=[],(n.colorStops||[]).forEach(function(e,r){o.gradient[r]=e.color,o.offset[r]=e.ratio}),t.app.command("AddHeatMap").execute({gcxLayer:r.layers[0]})}}else i instanceof esri.layers.GraphicsLayer&&t._setGraphicsLayerRenderer(i,t.toEsriRenderer(e.renderer))})},e.prototype._setGraphicsLayerRenderer=function(e,r){e.setRenderer(r),e.redraw()},e.prototype._findMatchingGcxMapService=function(e){var r=this.app.site.essentialsMap.findMapServiceById(e.id);return r=r||u.firstOrDefault(this.app.site.essentialsMap.mapServices,function(r){return r.serviceUrl===e.url})},e.prototype._findMatchingGcxLayer=function(e,r){var t="object"==typeof e?e:null,i=null;t&&(i=r.findLayerOrTableByName(t.name));var n=t?t.id.toString():e.toString();i=i||r.findLayerOrTableById(n);var o=void 0;return!(i=i||u.firstOrDefault(r.layers,function(e){return e.wmsLayerName===n}))&&t&&t.layerDefinition&&t.layerDefinition.source&&"mapLayer"===t.layerDefinition.source.type&&(o=t.layerDefinition.source.mapLayerId),i||null===o||void 0===o||(i=r.findLayerById(o.toString())),i||r.layers.forEach(function(e){if(e.dynamicDefinition){var r=JSON.parse(e.dynamicDefinition);!r||!r.source||"mapLayerId"!==r.source.type||!r.source.mapLayerId&&0!==r.source.mapLayerId||r.source.mapLayerId.toString()!==n&&r.source.mapLayerId.toString()!==o||(i=e)}}),i},e.prototype._findOrCreateMatchingGcxLayer=function(e,r){var t=this._findMatchingGcxLayer(e,r);return!t&&this._canCreateGcxLayer(e,r)?this._createGcxLayer(e,r):Promise.resolve(t)},e.prototype._findOrCreateMatchingGcxMapService=function(e){var r=this._findMatchingGcxMapService(e);return!r&&this._canCreateGcxMapService(e)?this._createGcxMapService(e):Promise.resolve(r)},e.prototype._canCreateGcxLayer=function(e,r){return r.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer},e.prototype._createGcxLayer=function(e,r){if(!this._canCreateGcxLayer(e,r))return Promise.reject(new Error("WebMapConverter._createGcxLayer: Unsupported layer type."));var t={source:{type:"mapLayerId",mapLayerId:e.id}};e.layerDefinition&&e.layerDefinition.drawingInfo&&(t.drawingInfo=e.layerDefinition.drawingInfo);var i={id:e.id.toString(),name:e.name,displayName:e.title||e.name,isDynamic:!0,dynamicDefinition:JSON.stringify(t)},o=new n.Layer(r.url+"/layers/"+e.id.toString());return o.createFromDefinition(i),r.add(o),Promise.resolve(o)},e.prototype._canCreateGcxMapService=function(e){return this._isFeatureCollection(e)||this._isKmlLayer(e)||this._isLayerCatalogService(e)},e.prototype._createGcxMapService=function(e){var r=this,t=this._getMapServiceDefinition(e);if(this._isLayerCatalogService(e)){var i=e.gcxMapServiceDefinition.catalogId,n=e.layers.map(function(e){return e.gcxLayerDefinition.catalogId});return new Promise(function(t,o){var a={mapServiceId:e.id,layerLookupIds:n,lookupId:i,callback:function(e){e&&t(e),o(new Error("WebMapConverter._createGcxMapService: Unsupported layer catalog id."))},serviceLayer:e};r.app.waitUntilAllLibrariesLoaded().then(function(){r.app.command("LayerCatalogRestoreMapService").execute(a)})})}if(this._isFeatureCollection(e)){var o=e.featureCollection.layers[0],a=o.featureSet||{},s=a.features||[];a.features=[];var l={mapService:y.buildLocalFeatureLayerService(o,t),graphics:Promise.map(s,function(e){return r.toEsriGraphic(e)})};return Promise.props(l).then(function(e){var t=e.mapService,i=r._toEsriRenderer(o.layerDefinition.drawingInfo.renderer);return t.serviceLayer.setRenderer(i),e.graphics.forEach(function(e){t.serviceLayer.add(e)}),e.graphics.length&&(t.serviceLayer.fullExtent=esri.graphicsExtent(e.graphics)),r.app.site.essentialsMap.addMapService(t),t})}return this._isKmlLayer(e)?y.buildKmlService(e.url,t).then(function(e){return r.app.site.essentialsMap.addMapService(e),e}):Promise.reject(new Error("WebMapConverter._createGcxMapService: Unsupported service layer type."))},e.prototype._getMapServiceDefinition=function(e){return{id:e.id,displayName:e.title}},e.prototype._isFeatureCollection=function(e){var r=e;return r.featureCollection&&r.featureCollection.layers&&1===r.featureCollection.layers.length&&!!r.featureCollection.layers[0].featureSet},e.prototype._isKmlLayer=function(e){return e.type===c.OperationalLayerType.KML},e.prototype._isGraphicsLayer=function(e){return e.id&&e.id.startsWith("graphics-layer-")},e.prototype._isLayerCatalogService=function(e){var r=e;return r.gcxMapServiceDefinition&&r.gcxMapServiceDefinition.catalogId},e.prototype._addSourceType=function(e,t){return t[r.CONVERSION_TYPE_PROPERTY]=e,t},e.prototype._getWebMapLayerType=function(e){if(e instanceof esri.layers.StreamLayer)return S.StreamLayer;if(e instanceof esri.layers.FeatureLayer)return S.FeatureLayer;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer)return S.MapService;if(e instanceof esri.layers.ArcGISTiledMapServiceLayer)return S.TiledMapService;if(e instanceof esri.layers.ArcGISImageServiceLayer)return S.ImageService;if(e instanceof esri.virtualearth.VETiledLayer)switch(e.mapStyle.toLowerCase()){case esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL.toLowerCase():return S.BingAerial;case esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL_WITH_LABELS.toLowerCase():return S.BingHybrid;case esri.virtualearth.VETiledLayer.MAP_STYLE_ROAD.toLowerCase():return S.BingRoad}else{if(e instanceof esri.layers.WebTiledLayer)return e.url&&e.url.indexOf("tile.openstreetmap.org")>=0?S.OpenStreetMap:S.WebTiled;if(e instanceof esri.layers.KMLLayer)return S.KML;if(e instanceof esri.layers.WMSLayer)return S.WMS;if(e instanceof esri.layers.WFSLayer)return S.WFS;if(e instanceof esri.layers.WMTSLayer)return S.WebTiled}},e.prototype._inferAttributeType=function(e,r){var t=u.firstOrDefault(e,function(e){return e.attributes&&!p.isNullOrUndefined(e.attributes[r])});if(!t)return f.EsriFieldTypes.esriFieldTypeString;var i=t.attributes[r];return"number"==typeof i?f.EsriFieldTypes.esriFieldTypeDouble:i instanceof Date?f.EsriFieldTypes.esriFieldTypeDate:f.EsriFieldTypes.esriFieldTypeString},e.prototype._setVisibleLayers=function(e,r){var t=this;if(!r.supportsLayerVisibility())return!1;var i=!1,n=[],o=e.visibleLayers||[],a=e.layers||[];return o.forEach(function(e){var i=void 0;if(a){var o=u.firstOrDefault(a,function(r){return r.id===e});(o=o||u.firstOrDefault(a,function(r){return r.name===e}))&&(i=t._findMatchingGcxLayer(o,r))}i||(i=t._findMatchingGcxLayer(e,r)),i&&n.push(i)}),r.layers.forEach(function(e){if(e.type!==m.LayerType.GROUP_LAYER){var r=n.indexOf(e)>=0;i=i||r!==e.isVisible(),e.setVisibility(r,!0)}}),i},e.prototype._toGcxMapService=function(e){var r=this,t=void 0,i=e;return Promise.all([this.app.waitUntilSiteInitialized(),this.app.waitUntilMapLoaded()]).then(function(){return r._findOrCreateMatchingGcxMapService(e)}).then(function(i){if(!(t=i))throw new Error('No matching Essentials map service was found for service "{0}".'.format(e.id));return r._applyWebMapServiceLayerToMapService(e,t)}).then(function(){return r._applyWebMapLayersToGcxLayers(i,t)}).then(function(e){return(e=r._setVisibleLayers(i,t)||e)&&t.refresh(),t})},e.prototype._toGcxLayer=function(e,r){var t=this;if(!r)throw new Error('WebMapConverter.toGcxLayer: Parameter "serviceLayer" is required.');return this.toGcxMapService(r).then(function(i){var n=t._findMatchingGcxLayer(e,i);if(!n)throw new Error('No matching Essentials layer was found for layer "{0}" for service "{1}".'.format(e.id,r.id));return n})},e.prototype._toGcxFeatureSet=function(e){var r=this;return this.toEsriFeatureSet(e).then(function(e){return new o.FeatureSet({app:r.app,esriFeatureSet:e})})},e.prototype._toEsriLayer=function(e){if(this._isGraphicsLayer(e))return this._toEsriGraphicsLayer(e);if(e.layerType===S.FeatureLayer)return this._toEsriFeatureLayer(e);throw new Error("WebMapConverter.toEsriLayer: Unsupported layer type.")},e.prototype._toEsriGraphicsLayer=function(e){var r=this,t=e.id.slice("graphics-layer-".length),i=this.app.map.getLayer(t);return!i||i instanceof esri.layers.GraphicsLayer?Promise.all([this.app.waitUntilSiteInitialized(),this.app.waitUntilMapLoaded()]).then(function(){var n=i;n||(n=new esri.layers.GraphicsLayer({id:t}),r.app.map.addLayer(n)),n.setVisibility(e.visibility),n.setOpacity(e.opacity),n.clear();var o=[];return((e.featureCollection||{}).layers||[]).forEach(function(e){if(((e.featureSet||{}).features||[]).forEach(function(e){e.attributes&&(o[e.attributes.__id]=r.toEsriGraphic(e))}),!n.renderer&&e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer){var t=e.layerDefinition.drawingInfo.renderer;t.uniqueValueInfos&&t.uniqueValueInfos[0]&&JSON.stringify(t.uniqueValueInfos[0].symbol)===JSON.stringify(E)||n.setRenderer(r.toEsriRenderer(t))}}),Promise.all(o).then(function(e){return e.forEach(function(e){e&&n.add(e)}),n})}):Promise.resolve(i)},e.prototype._toEsriFeatureLayer=function(e){var r=this;if(e.url){var t=new esri.layers.FeatureLayer(e.url);return t.setVisibility(e.visibility),t.setOpacity(e.opacity),this.app.waitUntilServiceLayerLoaded(t).return(t)}if(this._isFeatureCollection(e)){var i=new esri.layers.FeatureLayer(e.featureCollection.layers[0]);i.setVisibility(e.visibility),i.setOpacity(e.opacity),i.clear();var n=(e.featureCollection.layers[0].featureSet||{}).features||[];return Promise.map(n,function(e){return r.toEsriGraphic(e).then(function(e){return i.add(e)})}).return(i)}throw new Error("WebMapConverter.toEsriLayer: Unsupported layer type.")},e.prototype._toEsriFeatureSet=function(e){var r=this,t=e.features||[];return d.PromiseUtils.mapSkipRejected(t,function(e){return r.toEsriGraphic(e)}).then(function(e){var r=new esri.tasks.FeatureSet;return r.features=e,r})},e.prototype._toGcxFeature=function(e){return this.toEsriGraphic(e).then(function(e){return new a.Feature({graphic:e})})},e.prototype._toEsriGraphic=function(e){var r=this;return this.toObject(e.attributes).then(function(t){var i,n=r.toEsriGeometry(e.geometry),o=!0;t&&(i=t.__symbol,delete t.__symbol,t.hasOwnProperty("__visible")&&(o=t.__visible,delete t.__visible),delete t.__id);var a=new esri.Graphic(n,i,t,null);return a.visible=o,a})},e.prototype._toEsriGeometry=function(e){if(e.hasOwnProperty("x")&&e.hasOwnProperty("y"))return new esri.geometry.Point(e);if(e.hasOwnProperty("points"))return new esri.geometry.Multipoint(e);if(e.hasOwnProperty("paths"))return new esri.geometry.Polyline(e);if(e.hasOwnProperty("rings"))return new esri.geometry.Polygon(e);if(e.hasOwnProperty("xmin")&&e.hasOwnProperty("xmax")&&e.hasOwnProperty("ymin")&&e.hasOwnProperty("ymax"))return new esri.geometry.Extent(e);throw new Error("WebMapConverter.toEsriGeometry: Unrecognized type of geometry object.")},e.prototype._toEsriSymbol=function(e){switch(e.type){case t.SymbolType.SIMPLE_MARKER:var r=new esri.symbol.SimpleMarkerSymbol(e);return e.size!==r.size&&(r.size=e.size),r;case t.SymbolType.SIMPLE_LINE:return new esri.symbol.SimpleLineSymbol(e);case t.SymbolType.SIMPLE_FILL:return new esri.symbol.SimpleFillSymbol(e);case t.SymbolType.PICTURE_MARKER:return new esri.symbol.PictureMarkerSymbol(e);case t.SymbolType.PICTURE_FILL:return new esri.symbol.PictureFillSymbol(e);case t.SymbolType.TEXT:return new esri.symbol.TextSymbol(e);default:throw new Error('WebMapConverter.toEsriSymbol: Unsupported symbol type "{0}".'.format(e.type))}},e.prototype._toEsriRenderer=function(e){var r=this;switch(e.type){case l.RendererType.SIMPLE:var t=new esri.renderer.SimpleRenderer(dojo.clone(e));return t.symbol=this.toEsriSymbol(e.symbol),t;case l.RendererType.UNIQUE_VALUE:var i=new esri.renderer.UniqueValueRenderer(dojo.clone(e));return i.defaultSymbol=this.toEsriSymbol(e.defaultSymbol),i.infos.forEach(function(t,i){t.symbol=r.toEsriSymbol(e.uniqueValueInfos[i].symbol)}),i;case l.RendererType.CLASS_BREAKS:var n=new esri.renderer.ClassBreaksRenderer(dojo.clone(e));return n.defaultSymbol=this.toEsriSymbol(e.defaultSymbol),n.infos.forEach(function(t,i){t.symbol=r.toEsriSymbol(e.classBreakInfos[i].symbol)}),n;case l.RendererType.HEATMAP:var o=new esri.renderer.HeatmapRenderer(dojo.clone(e));if(e.colorStops){var a=[];e.colorStops.forEach(function(e,t){var i=dojo.clone(e);i.color=r.toEsriColor(i.color),a.push(i)})}return o.setColorStops(a),o;default:throw new Error('WebMapConverter.toEsriRenderer: Unsupported renderer type "{0}".'.format(e.type))}},e.prototype._toEsriSpatialReference=function(e){return new esri.SpatialReference(e)},e.prototype._toEsriColor=function(e){return e.constructor===Array&&4===e.length&&(e[3]=e[3]/255),new esri.Color(e)},e.prototype._toObject=function(e){var t=this;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||e instanceof Date||null===e||void 0===e)return Promise.resolve(e);if(e.hasOwnProperty(r.CONVERSION_TYPE_PROPERTY))switch(e[r.CONVERSION_TYPE_PROPERTY]){case L.GCX_MAP_SERVICE:return this.toGcxMapService(e);case L.GCX_LAYER:return this.toGcxLayer(e,null);case L.GCX_FEATURE_SET:return this.toGcxFeatureSet(e);case L.GCX_FEATURE:return this.toGcxFeature(e);case L.ESRI_LAYER:return this.toEsriLayer(e);case L.ESRI_FEATURE_SET:return this.toEsriFeatureSet(e);case L.ESRI_GRAPHIC:return this.toEsriGraphic(e);case L.ESRI_GEOMETRY:return Promise.resolve(this.toEsriGeometry(e));case L.ESRI_SYMBOL:return Promise.resolve(this.toEsriSymbol(e));case L.ESRI_RENDERER:return Promise.resolve(this.toEsriRenderer(e));case L.ESRI_SPATIAL_REFERENCE:return Promise.resolve(this.toEsriSpatialReference(e))}var i={},n=[];return Object.keys(e).forEach(function(r){n.push(t.toObject(e[r]).then(function(e){i[r]=e}))}),Promise.all(n).return(i)},e.prototype._fromGcxMapService=function(e){var r=this,t=e.serviceLayer,i={id:e.id,url:e.serviceUrl,opacity:e.opacity,visibility:e.isVisible(),layerType:this._getWebMapLayerType(t)};if(e.mapServiceFunction===h.MapServiceFunction.OPERATIONAL){var n=i;if(n.title=e.displayName,n.minScale=e.minScale===1/0?0:e.minScale,n.maxScale=e.maxScale,t instanceof esri.layers.ArcGISDynamicMapServiceLayer){n.capabilities=t.capabilities,n.visibleLayers=t.visibleLayers.map(function(e){return parseInt(e)});var o=e.layers;t.dynamicLayerInfos&&(o=[],t.dynamicLayerInfos.forEach(function(r,t){var i=e.findLayerById(r.id.toString());i&&o.push(i)})),n.layers=o.map(function(e){return r.fromGcxLayer(e)})}else t instanceof esri.layers.WMSLayer?(n.visibleLayers=t.visibleLayers,n.type=c.OperationalLayerType.WMS):t instanceof esri.layers.WFSLayer?n.type=c.OperationalLayerType.WFS:t instanceof esri.layers.KMLLayer?n.type=c.OperationalLayerType.KML:t instanceof esri.layers.StreamLayer?n.type=c.OperationalLayerType.STREAM:t instanceof esri.layers.FeatureLayer&&(n.layerDefinition=this._getWebMapLayerDefinitionFromFeatureLayer(t),n.capabilities=t.capabilities,e.isUserCreated&&t.graphics&&t.graphics.length&&(n.featureCollection=this._esriFeatureLayerToFeatureCollection(t),n.featureCollection.showLegend=e.layers[0].includeInLegend));t instanceof esri.layers.GraphicsLayer&&t.renderer instanceof esri.renderer.HeatmapRenderer&&!n.featureCollection&&(n.layerDefinition=n.layerDefinition||{},n.layerDefinition.drawingInfo={renderer:this.fromEsriRenderer(t.renderer)})}else{var a=i;if(t instanceof esri.virtualearth.VETiledLayer)a.type=i.layerType,delete i.url;else if(t instanceof esri.layers.WebTiledLayer)a.type=i.layerType,a.templateUrl=t.url,delete i.url;else if(t instanceof esri.layers.WMTSLayer){if(a.type=_.BaseMapType.WEB_TILED,!e.tileRestUrl)throw new Error('WebMapConverter.fromGcxMapService: WMTS layers are only supported if the "tileRestUrl" property is set.');e.tileRestUrl&&!t.resourceUrls&&(t.resourceUrls=[{template:e.tileRestUrl}]),a.templateUrl=t._getTileUrlTemplate(),delete i.url}}return i},e.prototype._esriFeatureLayerToFeatureCollection=function(e){var r=e.toJson().layerDefinition||{};return{layers:[{featureSet:{geometryType:e.geometryType,features:e.graphics.map(this.fromEsriGraphic,this)},layerDefinition:{displayField:r.displayField,fields:r.fields,geometryType:r.geometryType,hasAttachments:r.hasAttachments,minScale:r.minScale,maxScale:r.maxScale,name:r.name,objectIdField:r.objectIdField,templates:r.templates,type:r.type,typeIdField:r.typeIdField,types:r.types,drawingInfo:{renderer:this.fromEsriRenderer(e.renderer)}}}],showLegend:!0}},e.prototype._fromGcxlayer=function(e){var r={name:e.wmsLayerName,title:e.displayName,layerUrl:e.getLayerUrl(),legendUrl:e.legendUrl},t=parseInt(e.id);isNaN(t)||void 0===t||(r.id=t);var i=e.mapService.serviceLayer;if(i instanceof esri.layers.ArcGISDynamicMapServiceLayer){var n=this._getWebMapLayerDefinitionFromDynamicLayer(i,t);n&&(r.layerDefinition=n)}return r},e.prototype._fromGcxFeatureSet=function(e){var r,t=e.esriFeatureSet;if(t)!(r=s.GeometryType.fromEsriGeometryType(t.geometryType))&&t.features&&t.features.length>0&&t.features[0].geometry&&(r=s.GeometryType.fromEsriGeometryType(t.features[0].geometry.type));else if(e.features.length){var i=e.features.getAt(0);i.hasGeometry.get()&&(r=s.GeometryType.fromEsriGeometryType(i.esriFeature.get().geometry.type))}return{features:e.features.get().map(this.fromGcxFeature,this),geometryType:r||s.GeometryType.POINT}},e.prototype._fromEsriLayer=function(e){if(e instanceof esri.layers.FeatureLayer)return this._fromEsriFeatureLayer(e);if(e instanceof esri.layers.GraphicsLayer)return this._fromEsriGraphicsLayer(e);throw new Error("WebMapConverter.fromEsriLayer: Unsupported layer type.")},e.prototype._fromEsriGraphicsLayer=function(e){var r=this,t={id:"graphics-layer-"+e.id,title:e.id,visibility:e.visible,opacity:e.opacity,minScale:e.minScale,maxScale:e.maxScale},i={};e.graphics.forEach(function(t,n){var o=t.geometry.type,a=i[o];a||(a={featureSet:{features:[],geometryType:s.GeometryType.fromEsriGeometryType(o)},layerDefinition:{geometryType:s.GeometryType.fromEsriGeometryType(o),objectIdField:"__id",name:r.app.getResource("Mapping.Infrastructure","language-webmap-layer-name-"+o),fields:[{name:"__id",alias:"OBJECTID",type:f.EsriFieldTypes.esriFieldTypeOID,editable:!1,nullable:!1},{name:"__visible",alias:r.app.getResource("Mapping.Infrastructure","language-webmap-field-name-visible"),type:f.EsriFieldTypes.esriFieldTypeInteger,editable:!0,nullable:!1}],drawingInfo:{renderer:e.renderer?r.fromEsriRenderer(e.renderer):{type:l.RendererType.UNIQUE_VALUE,field1:"__symbolId",uniqueValueInfos:[{value:0,symbol:E}]}}}},i[t.geometry.type]=a);var c=r.fromEsriGraphic(t);if(c.attributes=c.attributes||{},c.attributes.__id=n,Object.keys(c.attributes).forEach(function(t){if("__symbolId"!==t&&"__symbol"!==t){var i=function(e){return u.firstOrDefault(a.layerDefinition.fields,function(r){return r.name===e})}(t);i||(i={name:t,alias:t,type:r._inferAttributeType(e.graphics,t),nullable:!0,editable:!0},a.layerDefinition.fields.push(i))}}),!e.renderer){var y=a.layerDefinition.drawingInfo.renderer,p=c.attributes.__symbolId;p&&!u.firstOrDefault(y.uniqueValueInfos,function(e){return e.value===p})&&y.uniqueValueInfos.push({value:p,symbol:c.attributes.__symbol})}a.featureSet.features.push(c)}),t.featureCollection={layers:[],showLegend:!1};for(var n=0,o=Object.keys(i);n<o.length;n++){var a=o[n];t.featureCollection.layers.push(i[a])}return t},e.prototype._fromEsriFeatureLayer=function(e){var r={id:e.id,title:e.id,visibility:e.visible,opacity:e.opacity,minScale:e.minScale,maxScale:e.maxScale,layerType:S.FeatureLayer};return e.url?r.url=e.url:r.featureCollection=this._esriFeatureLayerToFeatureCollection(e),r},e.prototype._fromEsriFeatureSet=function(e){return{features:e.features.map(this.fromEsriGraphic,this),geometryType:s.GeometryType.fromEsriGeometryType(e.geometryType)}},e.prototype._fromGcxFeature=function(e){var r=this,t={};return e.attributes.get().forEach(function(e){t[e.name.get()]=r.fromObject(e.value.get())}),{attributes:t,geometry:this.fromEsriGeometry(e.esriFeature.get().geometry)}},e.prototype._fromEsriGraphic=function(e){var r={attributes:this.fromObject(e.attributes)||{},geometry:this.fromEsriGeometry(e.geometry)};return r.attributes.__visible=e.visible?1:0,e.symbol&&(r.attributes.__symbol=this._addSourceType(L.ESRI_SYMBOL,this.fromEsriSymbol(e.symbol)),e.symbol.__symbolId||(e.symbol.__symbolId=this._nextSymbolId++),r.attributes.__symbolId=e.visible?e.symbol.__symbolId:0),r},e.prototype._fromEsriGeometry=function(e){var r={spatialReference:this.fromEsriSpatialReference(e.spatialReference)};switch(e.type){case"point":r.x=e.x,r.y=e.y;break;case"multipoint":r.points=e.points;case"polyline":r.paths=e.paths;break;case"polygon":r.rings=e.rings;break;case"extent":r.xmin=e.xmin,r.xmax=e.xmax,r.ymin=e.ymin,r.ymax=e.ymax}return r},e.prototype._fromEsriSymbol=function(e){var r=e.toJson();return e.size!==r.size&&(r.size=e.size),r},e.prototype._fromEsriRenderer=function(e){var r=this,t=e.toJson();return e instanceof esri.renderer.SimpleRenderer?t.symbol=this.fromEsriSymbol(e.symbol):e instanceof esri.renderer.UniqueValueRenderer?(t.defaultSymbol=this.fromEsriSymbol(e.defaultSymbol),t.uniqueValueInfos.forEach(function(t,i){t.symbol=r.fromEsriSymbol(e.infos[i].symbol)})):e instanceof esri.renderer.ClassBreaksRenderer&&(t.defaultSymbol=this.fromEsriSymbol(e.defaultSymbol),t.classBreakInfos.forEach(function(t,i){t.symbol=r.fromEsriSymbol(e.infos[i].symbol)})),t},e.prototype._fromEsriSpatialReference=function(e){return e.toJson()},e.prototype._fromEsriColor=function(e){return e.toRgba()},e.prototype._fromObject=function(e){if(e instanceof i.MapService)return this._addSourceType(L.GCX_MAP_SERVICE,this.fromGcxMapService(e));if(e instanceof n.Layer)return this._addSourceType(L.GCX_LAYER,this.fromGcxLayer(e));if(e instanceof o.FeatureSet)return this._addSourceType(L.GCX_FEATURE_SET,this.fromGcxFeatureSet(e));if(e instanceof a.Feature)return this._addSourceType(L.GCX_FEATURE,this.fromGcxFeature(e));if(e instanceof esri.layers.Layer)return this._addSourceType(L.ESRI_LAYER,this.fromEsriLayer(e));if(e instanceof esri.tasks.FeatureSet)return this._addSourceType(L.ESRI_FEATURE_SET,this.fromEsriFeatureSet(e));if(e instanceof esri.Graphic)return this._addSourceType(L.ESRI_GRAPHIC,this.fromEsriGraphic(e));if(e instanceof esri.geometry.Geometry)return this._addSourceType(L.ESRI_GEOMETRY,this.fromEsriGeometry(e));if(e instanceof esri.symbol.Symbol)return this._addSourceType(L.ESRI_SYMBOL,this.fromEsriSymbol(e));if(e instanceof esri.renderer.Renderer)return this._addSourceType(L.ESRI_RENDERER,this.fromEsriRenderer(e));if(e instanceof esri.SpatialReference)return this._addSourceType(L.ESRI_SPATIAL_REFERENCE,this.fromEsriSpatialReference(e));var r={};for(var t in e)e.hasOwnProperty(t)&&"function"!=typeof e[t]&&"__symbolId"!==t&&(r[t]=this.fromObject(e[t]));return r},e}();r.WebMapConverter=g})},"geocortex/infrastructure/webMap/WebMapFilter":function(){define(["require","exports","./../validation/NumberValidator","./../validation/SiteUrlValidator","./Domain","./Renderer","./Symbol","./WebMapConverter"],function(e,r,t,i,n,o,a,s){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l="__conversionType",u=function(){function e(e){var r=this;this._numberValidator=new t.NumberValidator,this.object=function(e){if(!e||"object"!=typeof e)return!0;if(Array.isArray(e))return{item:r.object};switch(e[l]){case s.ConversionType.GCX_MAP_SERVICE:case s.ConversionType.ESRI_LAYER:return r.serviceLayer;case s.ConversionType.GCX_LAYER:return r.layer;case s.ConversionType.GCX_FEATURE_SET:case s.ConversionType.ESRI_FEATURE_SET:return r.featureSet;case s.ConversionType.GCX_FEATURE:case s.ConversionType.ESRI_GRAPHIC:return r.feature;case s.ConversionType.ESRI_GEOMETRY:return r.geometry;case s.ConversionType.ESRI_SYMBOL:return r.symbol;case s.ConversionType.ESRI_RENDERER:return r.renderer;case s.ConversionType.ESRI_SPATIAL_REFERENCE:return r.spatialReference}for(var t={},i=0,n=Object.keys(e);i<n.length;i++)t[n[i]]=r.object;return t},this.app=e,this._urlValidator=new i.SiteUrlValidator(e)}return Object.defineProperty(e.prototype,"baseMap",{get:function(){return this._baseMap||(this._baseMap={baseMapLayers:{item:this.baseMapLayer},title:!0}),this._baseMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseMapLayer",{get:function(){return this._baseMapLayer||(this._baseMapLayer=$.extend({},this._serviceLayerCommon,{type:!0,isReference:!0,templateUrl:this._urlValidator}),this._baseMapLayer[l]=!0),this._baseMapLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bookmark",{get:function(){return this._bookmark||(this._bookmark={name:!0,extent:this.extent}),this._bookmark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color||(this._color={item:this._numberValidator}),this._color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"csvLayer",{get:function(){return this._csvLayer||(this._csvLayer=$.extend({},this.operationalLayer,{columnDelimiter:!0,locationInfo:this.locationInfo})),this._csvLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domain",{get:function(){var e=this;return this._domain||(this._domain=function(r){if(!r)return!1;switch(r.type){case n.DomainType.INHERITED:return e.inheritedDomain;case n.DomainType.RANGE:return e.rangeDomain;case n.DomainType.CODED_VALUE:return e.codedValueDomain;default:return!1}}),this._domain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inheritedDomain",{get:function(){return this._inheritedDomain||(this._inheritedDomain={type:!0}),this._inheritedDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeDomain",{get:function(){return this._rangeDomain||(this._rangeDomain={type:!0,name:!0,range:{item:this._numberValidator}}),this._rangeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"codedValueDomain",{get:function(){return this._codedValueDomain||(this._codedValueDomain={type:!0,name:!0,codedValues:{item:{name:!0,code:!0}}}),this._codedValueDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawingInfo",{get:function(){return this._drawingInfo||(this._drawingInfo={renderer:this.renderer,fixedSymbols:!0}),this._drawingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature||(this._feature={attributes:this.object,geometry:this.geometry},this._feature[l]=!0),this._feature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureCollection",{get:function(){return this._featureCollection||(this._featureCollection={layers:{item:this.layer},showLegend:!0}),this._featureCollection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureSet",{get:function(){return this._featureSet||(this._featureSet={features:{item:this.feature},geometryType:!0},this._featureSet[l]=!0),this._featureSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"field",{get:function(){return this._field||(this._field={alias:!0,domain:this.domain,editable:!0,length:!0,name:!0,nullable:!0,type:!0}),this._field},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){var e=this;return this._geometry||(this._geometry=function(r){return!!r&&(r.hasOwnProperty("x")?e.point:r.hasOwnProperty("points")?e.multiPoint:r.hasOwnProperty("paths")?e.polyline:r.hasOwnProperty("rings")?e.polygon:!!r.hasOwnProperty("xmin")&&e.extent)}),this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"point",{get:function(){return this._point||(this._point={spatialReference:this.spatialReference,x:this._numberValidator,y:this._numberValidator,z:this._numberValidator,m:this._numberValidator},this._point[l]=!0),this._point},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiPoint",{get:function(){return this._multipoint||(this._multipoint={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,points:{item:{item:this._numberValidator}}},this._multipoint[l]=!0),this._multipoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polyline",{get:function(){return this._polyline||(this._polyline={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,paths:{item:{item:{item:this._numberValidator}}}},this._polyline[l]=!0),this._polyline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"polygon",{get:function(){return this._polygon||(this._polygon={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,rings:{item:{item:{item:this._numberValidator}}}},this._polygon[l]=!0),this._polygon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._extent||(this._extent={spatialReference:this.spatialReference,xmin:this._numberValidator,xmax:this._numberValidator,ymin:this._numberValidator,ymax:this._numberValidator,zmin:this._numberValidator,zmax:this._numberValidator,mmin:this._numberValidator,mmax:this._numberValidator},this._extent[l]),this._extent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer||(this._layer={featureSet:this.featureSet,id:!0,layerDefinition:this.layerDefinition,layerUrl:this._urlValidator,legendUrl:this._urlValidator,name:!0,title:!0,popupInfo:this.popupInfo},this._layer[l]=!0),this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layerDefinition",{get:function(){return this._layerDefinition||(this._layerDefinition={definitionExpression:!0,displayField:!0,drawingInfo:this.drawingInfo,fields:{item:this.field},geometryType:!0,hasAttachments:!0,maxScale:this._numberValidator,minScale:this._numberValidator,name:!0,objectIdField:!0,templates:{item:this.template},type:!0,typeIdField:!0,types:{item:this.type},source:{type:!0,mapLayerId:this._numberValidator}}),this._layerDefinition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locationInfo",{get:function(){return this._locationInfo||(this._locationInfo={locationType:!0,latitudeFieldName:!0,longitudeFieldName:!0}),this._locationInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"operationalLayer",{get:function(){return this._operationalLayer||(this._operationalLayer=$.extend({},this._serviceLayerCommon,{type:!0,capabilities:!0,featureCollection:this.featureCollection,itemId:!0,layerDefinition:this.layerDefinition,layers:{item:this.layer},maxScale:this._numberValidator,minScale:this._numberValidator,mode:this._numberValidator,popupInfo:this.popupInfo,title:!0,visibleLayers:{item:!0}}),this._operationalLayer[l]=!0),this._operationalLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"popupInfo",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){var e=this;return this._renderer||(this._renderer=function(r){if(!r)return!1;switch(r.type){case o.RendererType.SIMPLE:return e.simpleRenderer;case o.RendererType.UNIQUE_VALUE:return e.uniqueValueRenderer;case o.RendererType.CLASS_BREAKS:return e.classBreaksRenderer;case o.RendererType.HEATMAP:return e.heatmapRenderer;default:return!1}}),this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serviceLayer",{get:function(){return this._serviceLayer||(this._serviceLayer=$.extend({},this.operationalLayer,this.wmsLayer,this.csvLayer,this.baseMapLayer)),this._serviceLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleRenderer",{get:function(){return this._simpleRenderer||(this._simpleRenderer={type:!0,symbol:this.symbol,label:!0,description:!0},this._simpleRenderer[l]=!0),this._simpleRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueValueRenderer",{get:function(){return this._uniqueValueRenderer||(this._uniqueValueRenderer={type:!0,field1:!0,field2:!0,field3:!0,fieldDelimiter:!0,defaultSymbol:this.symbol,defaultLabel:!0,uniqueValueInfos:{item:{value:!0,label:!0,description:!0,symbol:this.symbol}}},this._uniqueValueRenderer[l]=!0),this._uniqueValueRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classBreaksRenderer",{get:function(){return this._classBreaksRenderer||(this._classBreaksRenderer={type:!0,field:!0,classificationMethod:!0,normalizationType:!0,normalizationField:!0,normalizationTotal:this._numberValidator,defaultSymbol:this.symbol,defaultLabel:!0,backgroundFillSymbol:this.simpleFillSymbol,minValue:this._numberValidator,classBreakInfos:{item:{classMinValue:this._numberValidator,classMaxValue:this._numberValidator,label:!0,description:!0,symbol:this.symbol}}},this._classBreaksRenderer[l]=!0),this._classBreaksRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heatmapRenderer",{get:function(){return this._heatmapRenderer||(this._heatmapRenderer={type:!0,blurRadius:this._numberValidator,field:!0,maxPixelIntensity:this._numberValidator,minPixelIntensity:this._numberValidator,colorStops:{item:{ratio:!0,color:this.color}}}),this._heatmapRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_serviceLayerCommon",{get:function(){return{id:!0,url:this._urlValidator,visibility:!0,opacity:this._numberValidator,layerType:!0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this._spatialReference||(this._spatialReference={wkid:this._numberValidator,wkt:!0},this._spatialReference[l]=!0),this._spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"symbol",{get:function(){var e=this;return this._symbol||(this._symbol=function(r){if(!r)return!1;switch(r.type){case a.SymbolType.SIMPLE_MARKER:return e.simpleMarkerSymbol;case a.SymbolType.SIMPLE_LINE:return e.simpleLineSymbol;case a.SymbolType.SIMPLE_FILL:return e.simpleFillSymbol;case a.SymbolType.PICTURE_MARKER:return e.pictureMarkerSymbol;case a.SymbolType.PICTURE_FILL:return e.pictureFillSymbol;case a.SymbolType.TEXT:return e.textSymbol;default:return!1}}),this._symbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleMarkerSymbol",{get:function(){return this._simpleMarkerSymbol||(this._simpleMarkerSymbol={type:!0,style:!0,color:this.color,size:!0,angle:this._numberValidator,path:!0,xoffset:this._numberValidator,yoffset:this._numberValidator,outline:{type:!0,style:!0,color:this.color,width:this._numberValidator}},this._simpleMarkerSymbol[l]=!0),this._simpleMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleLineSymbol",{get:function(){return this._simpleLineSymbol||(this._simpleLineSymbol={type:!0,style:!0,color:this.color,width:this._numberValidator},this._simpleLineSymbol[l]=!0),this._simpleLineSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simpleFillSymbol",{get:function(){return this._simpleFillSymbol||(this._simpleFillSymbol={type:!0,style:!0,color:this.color,outline:this.simpleLineSymbol},this._simpleFillSymbol[l]=!0),this._simpleFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureMarkerSymbol",{get:function(){return this._pictureMarkerSymbol||(this._pictureMarkerSymbol={type:!0,url:this._urlValidator,imageData:!0,contentType:!0,width:this._numberValidator,height:this._numberValidator,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator},this._pictureMarkerSymbol[l]=!0),this._pictureMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureFillSymbol",{get:function(){return this._pictureFillSymbol||(this._pictureFillSymbol={type:!0,url:this._urlValidator,imageData:!0,contentType:!0,outline:this.simpleLineSymbol,width:this._numberValidator,height:this._numberValidator,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator,xscale:this._numberValidator,yscale:this._numberValidator},this._pictureFillSymbol[l]=!0),this._pictureFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSymbol",{get:function(){return this._textSymbol||(this._textSymbol={type:!0,color:this.color,backgroundColor:this.color,borderLineSize:this._numberValidator,borderLineColor:this.color,haloSize:this._numberValidator,haloColor:this.color,verticalAlignment:!0,horizontalAlignment:!0,rightToLeft:!0,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator,kerning:!0,font:{family:!0,size:this._numberValidator,style:!0,weight:!0,decoration:!0},text:!0},this._textSymbol[l]=!0),this._textSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"template",{get:function(){return this._template||(this._template={description:!0,drawingTool:!0,name:!0,prototype:this.feature}),this._template},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){var e=this;return this._type||(this._type={domains:function(r){if(!r)return!0;for(var t={},i=0,n=Object.keys(r);i<n.length;i++)t[n[i]]=e.domain;return t},id:this._numberValidator,name:!0,templates:{item:this.template}}),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webMap",{get:function(){return this._webMap||(this._webMap={operationalLayers:{item:this.operationalLayer},baseMap:this.baseMap,bookmarks:{item:this.bookmark},version:!0,applicationProperties:!0}),this._webMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wmsLayer",{get:function(){return this.wmsLayer||(this._wmsLayer=$.extend({},this.operationalLayer,{copyright:!0,extent:this.extent,format:!0,mapUrl:this._urlValidator,maxHeight:this._numberValidator,maxWidth:this._numberValidator,spatialReferences:{item:this._numberValidator},version:!0})),this._wmsLayer},enumerable:!0,configurable:!0}),e}();r.WebMapFilter=u})},"geocortex/infrastructure/webMap/WebMapManager":function(){define(["require","exports","./WebMapConverter","./WebMapFilter","geocortex/essentials/MapServiceConstants","./../ArrayUtils","./../GraphicsLayerUtils"],function(e,r,t,i,n,o,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e){if(!e)throw new Error("ProjectManager: Parameter 'app' is required.");this.app=e,this.convert=new t.WebMapConverter(e),this.filter=new i.WebMapFilter(e)}return e.prototype.create=function(){var e=this;if(!this.app.site||!this.app.site.isInitialized)throw new Error("WebMapConverter.fromCurrentMap: The Essentials site for this application is missing or not yet initialized.");this.convert.clearCache();var r=this.app.site.essentialsMap,t=function(e,r){console.warn('Unable to convert map service "{0}" to web map format: {1}'.format(e.displayName,r))},i=n.MapServiceFunction,s=r.mapServices.filter(function(e){return e.mapServiceFunction===i.OPERATIONAL}).reverse(),l=o.ArrayUtils.mapWithErrorCallback(s,function(r){return e.convert.fromGcxMapService(r)},t);a.getGraphicsLayersExceptExcluded(this.app,[a.ExcludeFromEnum.WebMapName]).filter(function(e){return e.graphics.length>0}).forEach(function(r){try{l.push(e.convert.fromEsriLayer(r))}catch(e){console.warn('Unable to convert graphics layer "{0}" to web map format: {1}'.format(r.id,e))}});var u=r.mapServices.filter(function(e){return e.isVisible()&&e.mapServiceFunction===i.BASE}).reverse(),c="",y=o.ArrayUtils.mapWithErrorCallback(u,function(r){return e.convert.fromGcxMapService(r)},t);if(u.length){var p=r.baseMaps.filter(function(e){return u.every(function(r){return e.services.some(function(e){return e.mapService===r})})});c=1===p.length?p[0].displayName:u[u.length-1].displayName}return y.length||(c="Light Gray Canvas",y[0]={id:"World_Light_Gray_Base_1486",layerType:"ArcGISTiledMapServiceLayer",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"}),this.app.bookmarks.export().then(function(e){return{operationalLayers:l,baseMap:{title:c,baseMapLayers:y},bookmarks:e,version:"1.7"}})},e}();r.WebMapManager=s})},"geocortex/infrastructure/webMap/WmsLayer":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/infrastructure/webSocket/Protocol":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/webSocket/SendMessageOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/infrastructure/webSocket/WebSocketCommand":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.name=e,this.ws=t,this.queue=void 0,this._syncedCommands=[]}return e.prototype.execute=function(e){var t={type:"Command",name:this.name,args:e},r={queue:this.queue,maxAgeQueuedMillis:this.maxAgeQueuedMillis};this.ws.sendMessage(t,r)},e.prototype.sync=function(e){if(!this._syncedCommands.some(function(t){return t.command===e})){var t=e.register(this,this.execute);this._syncedCommands.push({command:e,token:t})}},e}();t.WebSocketCommand=r;var s=function(){return function(e,t){this.impl=e,this.scope=t}}();t.CommandRegistrationEntry=s})},"geocortex/infrastructure/webSocket/WebSocketConnection":function(){define(["require","exports","./WebSocketCommand","geocortex/framework/observables"],function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.app=e,this.reconnectionMin=250,this.reconnectionMax=3e4,this.reconnectionGrowthFactor=4,this.maxMessageQueueLength=8,this._commands={},this._connectionString="",this._queuedMessages=[],this._reconnectionWait=this.reconnectionMin,this._ws=null,this.isConnected=new s.Observable(!1)}return e.hasBrowserSupport=function(){return"WebSocket"in window},e.prototype.connect=function(e){var t=this;e?e.startsWith("ws://")||e.startsWith("wss://")?this._ws?this.app.trace.error("WebSocketServer already connected."):(this._connectionString=e,this.app.site&&this.app.site.isInitialized?this._connectWebSocket():this.app.event("SiteInitializedEvent").once(this,function(){t._connectWebSocket()})):this.app.trace.error("WebSocketServer connection string must start with ws:// or wss://."):this.app.trace.error("WebSocketServer connection string missing.")},e.prototype.sendMessage=function(e,t){if(!e)throw new Error("Message cannot be null.");if(!e.type)throw new Error("Message missing type.  This is not a proper message.");if(this._ws&&this._ws.readyState==this._ws.OPEN){try{var r=JSON.stringify(e)}catch(e){return void this.app.trace.error("WebSocketServer can't serialize message: "+e.message)}this._ws.send(r)}else if(!t||!1!==t.queue)for(this._queuedMessages.push({msg:e,expirationTime:t&&t.maxAgeQueuedMillis?new Date(Date.now()+t.maxAgeQueuedMillis):null});this._queuedMessages.length>this.maxMessageQueueLength;)this._queuedMessages.shift()},e.prototype.command=function(e){return this._commands.hasOwnProperty(e)||(this._commands[e]=new r.WebSocketCommand(e,this)),this._commands[e]},e.prototype._connectWebSocket=function(){var t=this;if(e.hasBrowserSupport())if(!this._ws||this._ws.readyState!=this._ws.CONNECTING&&this._ws.readyState!=this._ws.OPEN){if(this.app.isOffline.get())return this.app.trace.debug("WebSocketServer connect attempt skipped because the application is in offline mode."),void this._reconnectWebSocket();try{this._ws=new WebSocket(this._connectionString)}catch(e){this.app.trace.error("WebSocketServer error opening socket: "+e.message)}this._ws.onopen=function(e){return t._onOpen(e)},this._ws.onclose=function(e){return t._onClose(e)},this._ws.onerror=function(e){return t._onError(e)},this._ws.onmessage=function(e){return t._onMessage(e)}}else this.app.trace.debug("WebSocketServer already connected, aborting reconnect.");else this.app.trace.warning("Web sockets are not supported on this browser.")},e.prototype._reconnectWebSocket=function(){var e=this;this.app.trace.debug("WebSocketServer reconnecting in "+this._reconnectionWait+"..."),setTimeout(function(){return e._connectWebSocket()},this._reconnectionWait),this._reconnectionWait=Math.ceil(Math.min(this._reconnectionWait*this.reconnectionGrowthFactor,this.reconnectionMax))},e.prototype._onOpen=function(e){this.isConnected.set(!0),this.app.trace.debug("WebSocketServer connected.");var t=this._queuedMessages;this._queuedMessages=[];for(var r=Date.now();t.length>0;){var s=t.shift();s.expirationTime&&s.expirationTime.getTime()>r||this.sendMessage(s.msg)}},e.prototype._onClose=function(e){this.isConnected.set(!1),this.app.trace.debug("WebSocketServer disconnected."),this._reconnectWebSocket()},e.prototype._onError=function(e){this.isConnected.set(!1),this.app.trace.error("WebSocketServer web socket error: "+e.message)},e.prototype._onMessage=function(e){try{var t=JSON.parse(e.data)}catch(t){return this.app.trace.error("WebSocketServer error deserializing inbound message: "+t.message),void(this.app.debugMode&&this.app.trace.error(e.data))}if(!t.type)return this.app.trace.error("WebSocketServer incoming message missing type."),void(this.app.debugMode&&this.app.trace.error(e.data));switch(t.type){case"Event":this._onEventMessage(t);break;case"Error":this._onErrorMessage(t);break;default:this.app.trace.error("WebSocketServer unknown message type '"+t.type+"'."),this.app.debugMode&&this.app.trace.error(e.data)}},e.prototype._onEventMessage=function(e){if(e.name&&"string"==typeof e.name){var t=this.app.event(e.name);t.publish.apply(t,e.args||[])}else this.app.trace.error("WebSocketServer message missing name.")},e.prototype._onErrorMessage=function(e){e.message&&"string"==typeof e.message?this.app.trace.error("WebSocketServer remote error: "+e.message):this.app.trace.error("WebSocketServer error from server with missing message.")},e}();t.WebSocketConnection=n})}}});