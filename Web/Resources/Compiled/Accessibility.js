!function(){var t="<div class='accessibility' tabindex='-1'>    <button type='button' class='accessibility-button' data-binding='{@visible: included}{@event-onclick: handleOnClick}{title: @language-accessibility-map-accessibility-icon}' tabindex='0'></button></div>",i="<div class='module notification alert'>    <div class='desc' data-binding='{@widget: GetHTMLContent}{@widget-context: content}'></div>    <div class='form-btns'>        <button class='button' data-binding='{@var: okButtonElement}{@event-onclick: handleClickOk}{@text: @language-common-ok}'        />    </div></div>",a="\x3c!-- The aria-label and span may appear redundant, but they're both needed for how different browsers/readers work. --\x3e<div class='screen-reader-notifications' data-binding='{@var: screenReaderNotificationsElement}' aria-live='polite'>    <span data-binding='{@text: ariaLabelText}' aria-live='polite'></span></div>";function s(e,t,i){if("string"==typeof e&&(i=t,t=e),void 0!==i)for(var a=t.split("."),n=null,r=window,o=0,s=a.length;o<s;o++)n=a[o],o==s-1?r[n]=i:r[n]||(r[n]={}),r=r[n];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Accessibility/AccessibilityButtonView":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=(a=i.ViewBase,o(r,a),r.prototype.handleOnClick=function(e,t,i){return this.app.command("ShowAccessibilityView").execute(),!1},r);function r(){return null!==a&&a.apply(this,arguments)||this}t.AccessibilityButtonView=n})},"Mapping/modules/Accessibility/AccessibilityIconView":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FeatureDescriptionPresenterView"],function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewBase,s(o,n),o.prototype.attach=function(e){if(e){if(n.prototype.attach.call(this,e),null!==this.viewModel.content.get())this._activateAccessibilityView();else var t=this.app.eventRegistry.event("AccessibilityIconContentInitializedEvent").subscribe(this,function(){this._activateAccessibilityView(),this.app.eventRegistry.event("AccessibilityIconContentInitializedEvent").unsubscribe(t)});if(this.okButtonElement)try{this.okButtonElement.focus()}catch(e){}this.viewContainerViewClosedEventToken||(this.viewContainerViewClosedEventToken=this.app.event("ViewContainerViewClosedEvent").subscribe(this,function(e){e&&e.viewId==this.id&&this._deactivateForUser()}))}},o.prototype._canExecuteActivateAccessibilityView=function(){return this.viewModel.included.get()},o.prototype._executeActivateAccessibilityView=function(){this.app.commandRegistry.command("ActivateView").execute(this.id)},o.prototype._activateAccessibilityView=function(){this.viewModel.included.get()&&this.title.set(this.viewModel.title.get()),this.app.commandRegistry.command("ShowAccessibilityView").register(this,this._executeActivateAccessibilityView,this._canExecuteActivateAccessibilityView)},o.prototype.resolveWidget=function(e,t){if(n.prototype.resolveWidget.call(this,e,t),"GetHTMLContent"===e){var i=new a.FeatureDescriptionPresenterView(this.app,this.libraryId);return i.root=document.createElement("div"),i.root.className="content",i.root.innerHTML=i.insertLinkAndImageBindings(t),i.attach(null),i}},o.prototype.handleClickOk=function(e,t,i){return this._deactivateForUser(),!1},o.prototype._deactivateForUser=function(){this.userInitiatedDA=!0,this.app.viewManager.deactivateView(this),this.viewModel.callback&&this.userInitiatedDA&&this.viewModel.callback()},o);function o(){var e=null!==n&&n.apply(this,arguments)||this;return e.userInitiatedDA=!1,e}t.AccessibilityIconView=r})},"Mapping/modules/Accessibility/AccessibilityIconViewModel":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewModelBase,s(o,n),o.prototype.initialize=function(e){e&&(e.hasOwnProperty("included")&&this.included.set(e.included),e.hasOwnProperty("title")&&this.title.set(e.title),e.hasOwnProperty("content")&&(this.content.set(decodeURIComponent(e.content)),this.app.eventRegistry.event("AccessibilityIconContentInitializedEvent").publish()))},o);function o(){var e=null!==n&&n.apply(this,arguments)||this;return e.included=new a.Observable(!0),e.content=new a.Observable(null),e.title=new a.Observable(null),e}t.AccessibilityIconViewModel=r})},"Mapping/modules/Accessibility/AccessibilityModule":function(){var a,u=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/framework/observables","geocortex/framework-ui/ViewContainer/ViewContainerView","geocortex/infrastructure/FocusUtils","geocortex/infrastructure/ui/components/SmartPanel/SmartPanelView"],function(e,t,i,a,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,n=window.HTMLElement||window.Element,p=(c=i.ModuleBase,u(l,c),l.prototype.initialize=function(e){var t=this;if(c.prototype.initialize.call(this,e),e.keyboardFocusIndicatorEnabled){var i=e.keyboardFocusIndicatorColor||l.DEFAULT_KEYBOARD_FOCUS_INDICATOR_COLOR,a=document.createElement("style");a.textContent="\n                    .keyboard-focus-active :focus,\n                    .keyboard-focus-active #map_root:focus:after,\n                    .keyboard-focus-active .gcx-toggle .input-checkbox:focus + .input-label:before {\n                        outline-color: "+i+" !important;\n                    }\n                ",document.head.appendChild(a),$(document).on("keydown",function(e){9===e.keyCode&&!1===$(document.documentElement).hasClass("keyboard-focus-active")&&(t.app.trace.debug("Keyboard focus active."),$(document.documentElement).addClass("keyboard-focus-active"))}),$(document).on("mousedown",function(e){$(document.documentElement).hasClass("keyboard-focus-active")&&e.target!==document.activeElement&&e.target.parentElement!==document.activeElement&&(t.app.trace.debug("Keyboard focus deactivated."),$(document.documentElement).removeClass("keyboard-focus-active"))})}if(this.app.waitUntilMapLoaded().then(function(){t.enableMapFocusedText()}),this.app.waitUntilApplicationReady().then(function(){e.expandedMapKeyboardAccessibility&&t.enableKeyboardNavigation(),e.automaticElementFocusing&&t.enableAutomaticElementFocusing(),$(document).on("focus","input, .ui-slider-handle",function(e){t.app.map.disableKeyboardNavigation(),$(e.target).one("blur",function(){return t.app.map.enableKeyboardNavigation()})})}),e.hasOwnProperty("includeProviders")&&this.includeProviders.set(e.includeProviders),e.providers&&this.includeProviders.get())for(var n=0,r=e.providers;n<r.length;n++){var o=r[n];if(!1===o.isEnabled)return;var s=dojo.getObject(o.type);s&&new s(this.app,o.libraryId||this.libraryId).initialize(o)}},l.prototype.enableMapFocusedText=function(){$(this.app.map.root).attr("aria-label",this.app.getResource(this.libraryId,"language-accessibility-map-focused")),$(this.app.map.root).attr("role","main"),$(this.app.map.root).children(".esriMapContainer, .esriControlsBR").attr("aria-hidden","true")},l.prototype.enableAutomaticElementFocusing=function(){var n=this;function t(e){return n._interceptTabsWhileModalActive(e)}this.app.command("FocusOnFirstInputInView").register(this,function(e){o.focusOnFirstInput(e,n.app.map)}),this.app.event("ViewActivatedEvent").subscribe(this,function(e){if(!n._modalContainerView){var t=n.app.viewManager.getRegionForViewId(e.id);t&&"ModalWindowPlaceholderRegion"===t.name&&(n._modalContainerView=e)}}),this.app.waitUntilApplicationReady().then(function(){return setTimeout(function(){n.app.event("ViewActivatedEvent").subscribe(n,function(e){if(!(e instanceof r.ViewContainerView||e instanceof s.SmartPanelView)){for(var t=0,i=n._viewsIgnoreAutoFocus;t<i.length;t++){var a=i[t];if(-1!==e.id.search(a))return}n._viewToFocus=e,null===n._viewFocusHandle&&(n._viewFocusHandle=setTimeout(function(){n._viewToFocus&&(n.app.trace.debug("View focused: "+e.id),n.app.command("FocusOnFirstInputInView").execute(e)),n._viewFocusHandle=null},300))}})},1e3)}),this.app.event("RegionActivatedEvent").subscribe(this,function(e){"ModalWindowRegion"===e.name&&$(document).on("keydown",t)}),this.app.event("RegionDeactivatedEvent").subscribe(this,function(e){"ModalWindowRegion"===e.name&&$(document).off("keydown",t)})},l.prototype._resetModalFocus=function(e){if(e&&e.root)try{var t=$(e.root).find(":visible:input, a:visible, button:visible").not(".bound-disabled, .disabled, [tabindex=-1]");if(t&&0<t.length)return void o.focus(t[0])}catch(e){this.app.trace.debug("Could not focus: "+e)}},l.prototype._interceptTabsWhileModalActive=function(e){var t=e.keyCode||e.which;if(9===t||9===t&&e.shiftKey){var i=document.activeElement,a=$(this._modalContainerView.root).find(":focusable");a&&i===a[0]&&9===t&&e.shiftKey?e.preventDefault():i===a[a.length]&&9===t&&e.preventDefault(),0===$(i).parents(".ModalViewContainerView").length&&(this._resetModalFocus(this._modalContainerView),e.preventDefault())}},l.prototype.enableKeyboardNavigation=function(){var t=this;this.disableKeyboardNavigation(),this.app.map&&this.app.map.loaded?(this._keydownHandle=dojo.on(document,"keydown",function(e){return t._onKeyDownHandler(e)}),this._keyupHandle=dojo.on(document,"keyup",function(e){return t._onKeyUpHandler(e)})):this.app.event("MapLoadedEvent").once(this,function(e){t._keydownHandle=dojo.on(document,"keydown",function(e){return t._onKeyDownHandler(e)}),t._keyupHandle=dojo.on(document,"keyup",function(e){return t._onKeyUpHandler(e)})})},l.prototype.disableKeyboardNavigation=function(){this._keydownHandle&&this._keydownHandle.remove(),this._keyupHandle&&this._keyupHandle.remove(),this._keydownHandle=null,this._keyupHandle=null,this._panning=!1},l.prototype._onKeyDownHandler=function(e){if(document.activeElement===this.app.map.root||!document.activeElement||!document.activeElement.classList||document.activeElement.classList.contains("ovwHighlight")){var t=e.target||e.srcElement,i=null;if(t instanceof n&&(i=t.className),t===this.app.map.root||"ovwHighlight"===i){var a=this.app.map;a.navigationManager._keyHandle&&(this._panning=!0,a.navigationManager._keyHandle.advice(e))}}},l.prototype._onKeyUpHandler=function(e){var t=e.target||e.srcElement,i=null;if(t instanceof n&&(i=t.className),t===this.app.map.root||"ovwHighlight"===i){var a=this.app.map;a.navigationManager._keyEndHandle&&this._panning&&(this._panning=!1,a.navigationManager._keyEndHandle.advice(e))}},l.DEFAULT_KEYBOARD_FOCUS_INDICATOR_COLOR="#550055",l);function l(){var e=null!==c&&c.apply(this,arguments)||this;return e.includeProviders=new a.Observable(!0),e._keydownHandle=null,e._keyupHandle=null,e._panning=!1,e._viewsIgnoreAutoFocus=["LoadingStatus","StatusIndicatorView","StatusMessageView","ProviderView","geometryEditingStatus","MapView","DataFrameButtonView","SearchHintsView"],e._modalContainerView=null,e._viewFocusHandle=null,e._viewToFocus=null,e}t.AccessibilityModule=p})},"Mapping/modules/Accessibility/AccessibilityViewModel":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=(n=i.ViewModelBase,s(o,n),o.prototype.initialize=function(e){var t=this;n.prototype.initialize.call(this,e),this.app.command("EnableScreenReaderNarrate").register(this,function(){t._numNarrateDeactivations=0<t._numNarrateDeactivations?--t._numNarrateDeactivations:0,0===t._numNarrateDeactivations&&(t.screenNarrationEnabled=!0,t.app.event("_screenReaderNarrationEnabled").publish())}),this.app.command("DisableScreenReaderNarrate").register(this,function(){t._numNarrateDeactivations++,t.screenNarrationEnabled=!1}),this.app.command("ScreenReaderNarrate").register(this,function(e){t.screenNarrationEnabled?setTimeout(function(){t.screenNarrationEnabled&&(t.app.trace.debug("ScreenReader Narration Enabled. Now Narrating: {0}".format(e)),t.ariaLabelText.set(e))},0):t.app.trace.debug("ScreenReader Narration Disabled by {0} components. Not narrating '{1}'".format(t._numNarrateDeactivations,e))})},o);function o(){var e=null!==n&&n.apply(this,arguments)||this;return e.ariaLabelText=new a.Observable(""),e.screenNarrationEnabled=!0,e._numNarrateDeactivations=0,e}t.AccessibilityViewModel=r})},"Mapping/modules/Accessibility/AccessibilityProviders/MapTextProvider":function(){var a,u=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/accessibility/AccessibilityProviderBase","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/DateFormat","geocortex/infrastructure/NumberFormat","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/gis/LayerInfo"],function(e,t,i,o,a,n,r,y,d,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c,p=(c=i.AccessibilityProviderBase,u(l,c),l.prototype.initialize=function(e){var i=this;c.prototype.initialize.call(this,e),0<=e.decimalPrecision&&e.decimalPrecision<10?this.decimalPrecision=e.decimalPrecision:this.app.trace.warning("MapTextProvider: decimalPrecision entered in config is out of range (0-9). Using default value of "+this.decimalPrecision+"."),this.readAttributionInformation=e.readAttributionInformation,this.app.event("MapExtentChangedEvent").subscribe(this,this._delayMapDescriptionChanged),this.app.event("MapTimeExtentChangedEvent").subscribe(this,function(){return i.app.map&&i._delayMapDescriptionChanged(i.app.map.extent)}),this.app.event("MapPanStartedEvent").subscribe(this,function(e,t){clearTimeout(i._timeoutId),i._timeoutId=null}),this.app.waitUntilMapLoaded().then(function(){i._handleMapLoadedEvent(i.app.map)}),this.app.event("_screenReaderNarrationEnabled").once(this,function(){return i._screenReaderNarrationEnabled=!0})},l.prototype._handleMapLoadedEvent=function(e){var t=this;$(this.app.map.root).focus(function(e){clearTimeout(t._timeoutId),t._timeoutId=setTimeout(function(){t._handleMapDescriptionChanged(t.app.map.extent)},t._mapReadDelay)}),this.readAttributionInformation&&$(this.app.map.attribution.listNode).on("DOMSubtreeModified",function(e){t._delayMapDescriptionChanged(t.app.map.extent)})},l.prototype._delayMapDescriptionChanged=function(e){var t=this;this._previousExtent&&e.xmin===this._previousExtent.xmin&&e.xmax===this._previousExtent.xmax&&e.ymin===this._previousExtent.ymin&&e.ymax===this._previousExtent.ymax||(clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){t._timeoutId=null,t._handleMapDescriptionChanged(e)},this._eventDelay))},l.prototype._handleMapDescriptionChanged=function(r){var o=this;if(this._screenReaderNarrationEnabled){var s="",t=function(e){0===e.length&&(e=o.app.getResource(o.libraryId,"language-accessibility-map-none"));var t=o._getTimeExtentDescription();o.fullDescription="",o.fullDescription=s,o.fullDescription+=" "+o._getScaleDescription(),t&&(o.fullDescription+=" "+t),o.fullDescription+=" "+o.app.getResource(o.libraryId,"language-accessibility-map-visible-features").format(e),o.changedDescription="";var i=!1;if(null!==o._previousExtent&&r.getCenter().x===o._previousExtent.getCenter().x&&r.getCenter().y===o._previousExtent.getCenter().y||(o.changedDescription+=s,i=!0),o._previousScale!==o.app.map.getScale()&&(o.changedDescription+=" "+o._getScaleDescription()),t&&o.app.map.timeExtent&&o.app.map.timeExtent.startTime&&o.app.map.timeExtent.endTime&&(o._previousTimeExtentMin===o.app.map.timeExtent.startTime.getTime()&&o._previousTimeExtentMax===o.app.map.timeExtent.endTime.getTime()||(o.changedDescription+=" "+t)),i&&(o.changedDescription+=" "+o.app.getResource(o.libraryId,"language-accessibility-map-visible-features").format(e)),o.readAttributionInformation){var a=o._getAttributionInformation();o.fullDescription+=" "+a,o.changedDescription+=" "+a}function n(e,t){setTimeout(function(){o.app.command("ScreenReaderNarrate").execute(o.app.getResource(o.libraryId,t).format(e))},o._viewDelay)}!o._hasReadFullDescription&&o.fullDescription?(o._hasReadFullDescription=!0,n(o.fullDescription,"language-accessibility-map-initialized-information")):o.changedDescription&&n(o.changedDescription,"language-accessibility-map-changed-information"),$(o.app.map.root).attr("aria-label",o.app.getResource(o.libraryId,"language-accessibility-map-focused")),o._previousExtent=r,o._previousScale=o.app.map.getScale(),o._previousTimeExtentMin=o.app.map.timeExtent&&o.app.map.timeExtent.startTime?o.app.map.timeExtent.startTime.getTime():null,o._previousTimeExtentMax=o.app.map.timeExtent&&o.app.map.timeExtent.endTime?o.app.map.timeExtent.endTime.getTime():null};this._getCentreCoordinatesDescription(r,function(e){s=e,o._setVisibleFeaturesDescription(r,t)})}},l.prototype._getCentreCoordinatesDescription=function(e,i){var a=this,n="",r="",t=new esri.SpatialReference(102100);o.projectGeometry(e,t,function(e){if(e instanceof esri.geometry.Extent){var t=e;n=a._getFormattedLatitudeString(t),r=a._getFormattedLongitudeString(t)}i(a.app.getResource(a.libraryId,"language-accessibility-map-coordinates-introduction").format(n,r))},function(e){a.app.trace.info("Error encountered attempting to project geometry: "+e),i(a.app.getResource(a.libraryId,"language-accessibility-map-coordinates-error"))},this.app)},l.prototype._getFormattedLatitudeString=function(e){var t=a.formatNumber(Math.abs(e.getCenter().getLatitude()),r.NumberFormat.NUMBER,{fractionalDigits:this.decimalPrecision});return 0<e.getCenter().getLatitude()?this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-north").format(t):this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-south").format(t)},l.prototype._getFormattedLongitudeString=function(e){var t=a.formatNumber(Math.abs(e.getCenter().getLongitude()),r.NumberFormat.NUMBER,{fractionalDigits:this.decimalPrecision});return e.getCenter().getLongitude()<0?this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-west").format(t):this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-east").format(t)},l.prototype._getScaleDescription=function(){var e=a.formatNumber(this.app.map.getScale(),r.NumberFormat.NUMBER,{fractionalDigits:this.decimalPrecision});return this.app.getResource(this.libraryId,"language-accessibility-map-scale").format(e)},l.prototype._getTimeExtentDescription=function(){var e,t;return this.app.map&&this.app.map.timeExtent&&this.app.map.timeExtent.startTime&&this.app.map.timeExtent.endTime&&(e=a.formatDate(this.app.map.timeExtent.startTime,n.DateFormat.DATE_TIME_LONG),t=a.formatDate(this.app.map.timeExtent.endTime,n.DateFormat.DATE_TIME_LONG),e&&t)?this.app.getResource(this.libraryId,"language-accessibility-map-time-extent").format(e,t):""},l.prototype._setVisibleFeaturesDescription=function(l,e){for(var u="",t=this._getVisibleLayers(l),d=[],m=[],i=function(t){if(t.mapService.mapServiceFunction===y.MapServiceFunction.BASE)return"continue";if(t.mapService.serviceLayer instanceof esri.layers.GraphicsLayer){var e=t.mapService.serviceLayer;return 0<(n=h._countGraphicsInExtent(l,e))&&(u+=" "+h.app.getResource(h.libraryId,"language-accessibility-map-visible-feature-information").format(n,t.name)),"continue"}if(t.mapService.serviceLayer instanceof esri.layers.KMLLayer){for(var i=t.mapService.serviceLayer.getLayers(),a=t.mapService.displayName,n=0,r=0,o=i;r<o.length;r++){var s=o[r];s.graphics&&s.visible&&s.isVisibleAtScale(h.app.map.getScale())&&(n+=h._countGraphicsInExtent(l,s))}return 0<n&&(u+=" "+h.app.getResource(h.libraryId,"language-accessibility-map-visible-feature-information").format(n,a)),"continue"}var c=t.mapService.serviceLayer;if(c.capabilities&&c.capabilities.toLowerCase().indexOf("query")<0&&c.capabilities.toLowerCase().indexOf("identify")<0)return"continue";if(!t.mapService.serviceLayer.loadError&&t.queryable&&t.supportsQuery)0===m.filter(function(e){return e.mapService.serviceUrl+"/"+e.id==t.mapService.serviceUrl+"/"+t.id}).length&&m.push(t);else if(t.identifiable&&t.supportsIdentify&&t.mapService.mapServiceType!==y.MapServiceType.WMS){var p=d.filter(function(e){return e.mapService.serviceUrl===t.mapService.serviceUrl});0<p.length&&0===p[0].layers.filter(function(e){return e.toString()===t.id}).length?p[0].layers.push(parseInt(t.id,10)):0!==p.length||t.mapService.serviceLayer.loadError||d.push({mapService:t.mapService,layers:[parseInt(t.id,10)]})}else h.app.trace.debug(t.name+" layer does not support identify or query. Not supported for screenreader.")},h=this,a=0,n=t;a<n.length;a++)i(n[a]);0===d.length?this._completedIdentifies=!0:this._completedIdentifies=!1,0===m.length?this._completedQueries=!0:this._completedQueries=!1,0===d.length&&0===m.length?e(u):(0<d.length&&this._performIdentify(e,u,l,d),0<m.length&&this._performQueries(e,u,l,m))},l.prototype._countGraphicsInExtent=function(e,t){for(var i=0,a=0,n=t.graphics;a<n.length;a++){var r=n[a];e.intersects(r.geometry)&&r.visible&&i++}return i},l.prototype._performIdentify=function(t,i,e,a){var n=this,r={};this._identifyTaskCollection=[],this._lastIdentifyMap&&this._lastIdentifyMap.cancel();for(var o=0,s=a;o<s.length;o++){var c=s[o],p=new esri.tasks.IdentifyParameters;p.mapExtent=e,p.geometry=e,p.layerIds=c.layers,p.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_VISIBLE,p.returnGeometry=!1,p.tolerance=0,p.height=$(this.app.map.root).height(),p.width=$(this.app.map.root).width();var l=d.getIdentifyTask(c.mapService);this._identifyTaskCollection.push({identifyTask:l,identifyParameters:p})}this._lastIdentifyMap=Promise.map(this._identifyTaskCollection,function(i){return new Promise(function(e,t){n._lastIdentifyMap.isCancelled()||i.identifyTask.execute(i.identifyParameters,e,t)}).then(function(e){var t=e;if(!n._lastIdentifyMap.isCancelled())for(var i=0;i<t.length;i++){var a=e[i];void 0!==r[a.layerName]?r[a.layerName]+=1:r[a.layerName]=1}}).catch(function(e){n.app.trace.info("Error performing identify on server for feature count in MapTextProvider: "+e)})},{concurrency:1}).then(function(){for(var e in r)r.hasOwnProperty(e)&&0<r[e]&&(i+=" "+n.app.getResource(n.libraryId,"language-accessibility-map-visible-feature-information").format(r[e],e));!n._lastIdentifyMap.isCancelled()&&n._completedQueries&&t(i)}).catch(function(e){n.app.trace.info("Error retrieving MapTextProvider info: "+e)}).lastly(function(){n._completedIdentifies=!0})},l.prototype._performQueries=function(e,t,i,a){var n=this,r=new esri.tasks.Query;r.geometry=esri.geometry.Polygon.fromExtent(i),r.returnGeometry=!1,r.where="1=1",this._queryTaskCollection=[],null!=this._lastQueryMap&&this._lastQueryMap.cancel();for(var o=0,s=a;o<s.length;o++){var c=s[o],p=c.mapService.serviceLayer.url,l=(c.id,c.name),u=(p.split("?"),d.getQueryTask(c));this._queryTaskCollection.push({queryTask:u,layerName:l})}this._lastQueryMap=Promise.map(this._queryTaskCollection,function(i){if(!n._lastQueryMap.isCancelled())return new Promise(function(e,t){i.queryTask.executeForCount(r,e,t)}).then(function(e){0<e&&(t+=" "+n.app.getResource(n.libraryId,"language-accessibility-map-visible-feature-information").format(e,i.layerName))}).catch(function(e){n.app.trace.info("Error querying server for feature count in MapTextProvider: "+e)})},{concurrency:1}).then(function(){!n._lastQueryMap.isCancelled()&&n._completedIdentifies&&e(t)}).catch(function(e){n.app.trace.info("Error retrieving MapTextProvider info: "+e)}).lastly(function(){n._completedQueries=!0})},l.prototype._getVisibleLayers=function(e){for(var t=[],i=0,a=this.app.site.essentialsMap.allLayers();i<a.length;i++){var n=a[i],r=s.LayerInfo.fromGcxLayer(n);r.getMaxScale()>this.app.map.getScale()||r.getMinScale()<this.app.map.getScale()||r.isVisible()&&r.subLayerIds&&0===r.subLayerIds.length&&t.push(n)}return t},l.prototype._getAttributionInformation=function(){for(var e="",t=$(this.app.map.attribution.listNode).children(),i=0;i<t.length;i++){var a=t[i];"none"!==$(a).css("display")&&(e+=a.textContent+" ")}return e},l);function l(){var e=null!==c&&c.apply(this,arguments)||this;return e.fullDescription="",e.changedDescription="",e.decimalPrecision=4,e.readAttributionInformation=!1,e._viewDelay=0,e._timeoutId=null,e._eventDelay=250,e._mapReadDelay=1250,e._previousExtent=null,e._previousScale=null,e._previousTimeExtentMin=null,e._previousTimeExtentMax=null,e._queryTaskCollection=[],e._identifyTaskCollection=[],e._completedQueries=!1,e._completedIdentifies=!1,e._hasReadFullDescription=!1,e._screenReaderNarrationEnabled=!1,e}t.MapTextProvider=p})},"Mapping/modules/Accessibility/AccessibilityProviders/ViewActivatorProvider":function(){var a,o=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});define(["require","exports","geocortex/infrastructure/accessibility/AccessibilityProviderBase"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=(a=i.AccessibilityProviderBase,o(r,a),r.prototype.initialize=function(e){var t=this;a.prototype.initialize.call(this,e),e.notifications&&(this._notifications=e.notifications),e.subviewNotifications&&(this._subviewNotifications=e.subviewNotifications),this._resetViewArrays(),this.app.event("ViewActivatedEvent").subscribe(this,this._handleViewActivated),this.app.event("ViewDeactivatedEvent").subscribe(this,this._handleViewDeactivated),this.app.event("DataFrameOpenedEvent").subscribe(this,this._handleDataFrameOpened),this.app.event("DataFrameClosedEvent").subscribe(this,this._handleDataFrameClosed),this.app.event("FlyoutActivated").subscribe(this,this._compactToolbarFlyoutActivated),this.app.event("FlyoutDeactivated").subscribe(this,this._compactToolbarFlyoutDeactivated),this.app.waitUntilApplicationReady().then(function(){t._narrateViewActivation=!0})},r.prototype._handleViewActivated=function(e){var t=this.app.getResource(this.libraryId,"language-accessibility-map-open");this.app.trace.view("View activated: "+e.id),null!=this._notifications[e.id]?(-1<this._openViews.indexOf(e.id)||this._openViews.push(e.id),this._handleView(e)):"DataRegion"==e.regionName&&this._isDataFrameOpen?(-1<this._activeContainerViews.indexOf(e.id)||(this._activeContainerViews.push(e.id),this.app.trace.view("Active container views: {0}".format(this._activeContainerViews.length.toString()))),this._handleDataRegionView(e,t)):this.app.trace.view("No corresponding notification message for "+e.id)},r.prototype._handleViewDeactivated=function(e){if(this.app.getResource(this.libraryId,"language-accessibility-map-closed"),this.app.trace.view("View deactivated: "+e.id),-1<this._activeContainerViews.indexOf(e.id)){var t=this._activeContainerViews.indexOf(e.id);this._activeContainerViews.splice(t,1),this.app.trace.view("Active container views: {0}".format(this._activeContainerViews.length.toString())),0==this._activeContainerViews.length&&(this._currentDataFrameViewId="PlaceholderView")}else null!=this._notifications[e.id]?(-1<this._closedViews.indexOf(e.id)||this._closedViews.push(e.id),this._handleView(e)):null!=this._subviewNotifications[e.id]&&this._isDataFrameOpen?(-1<this._dataFrameClosedViews.indexOf(e.id)||this._dataFrameClosedViews.push(e.id),this._handleView(e)):this.app.trace.view("No corresponding notification message for "+e.id)},r.prototype._handleView=function(e){var t=this;this.newEventTime=(new Date).getTime(),setTimeout(function(){(new Date).getTime()-t.newEventTime>t.timeDelay&&t._arraysNotEmpty()&&(t._composeMessage(),t.app.trace.view("Message: {0}".format(t._message)),t.app.command("ScreenReaderNarrate").execute(t._message),t._message="",t._resetViewArrays())},this.timeDelay)},r.prototype._arraysNotEmpty=function(){return 0<this._openViews.length||0<this._closedViews.length||0<this._dataFrameOpenViews.length||0<this._dataFrameClosedViews.length},r.prototype._handleDataRegionView=function(e,t){var i="";if(e.id==this.app.getResource(this.libraryId,"language-accessibility-map-workflowlist-view"))i=e.id;else{if(!e.viewModel||!e.viewModel.currentView)return;i=e.viewModel.currentView.id}if(null!=this._subviewNotifications[i]){if(i==this._currentDataFrameViewId)return void this.app.trace.view("Active view = Current data frame view.");t==this.app.getResource(this.libraryId,"language-accessibility-map-open")?(-1<this._dataFrameOpenViews.indexOf(e.id)||this._dataFrameOpenViews.push(i),null==this._currentDataFrameViewId||-1<this._dataFrameClosedViews.indexOf(this._currentDataFrameViewId)||this._dataFrameClosedViews.push(this._currentDataFrameViewId),this._currentDataFrameViewId=i):-1<this._dataFrameClosedViews.indexOf(this._currentDataFrameViewId)||this._dataFrameClosedViews.push(i),this._handleView(e)}else this._handleView(e)},r.prototype._composeMessage=function(){this._isDataFrameOpen||(this._dataFrameOpenViews=[]),this._addOpenViews(),this._addDataFrameOpenViews(),this._addClosedViews(),this._addDataFrameClosedViews()},r.prototype._addOpenViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-open"),t=0;t<this._openViews.length;t++)this._message+=this._notifications[this._openViews[t]].format(e)},r.prototype._addClosedViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-closed"),t=0;t<this._closedViews.length;t++)this._message+=this._notifications[this._closedViews[t]].format(e)},r.prototype._addDataFrameOpenViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-open"),t=0;t<this._dataFrameOpenViews.length;t++)this._message+=this._subviewNotifications[this._dataFrameOpenViews[t]].format(e)},r.prototype._addDataFrameClosedViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-closed"),t=0;t<this._dataFrameClosedViews.length;t++)this._message+=this._subviewNotifications[this._dataFrameClosedViews[t]].format(e)},r.prototype._resetViewArrays=function(){this._openViews=[],this._closedViews=[],this._dataFrameOpenViews=[],this._dataFrameClosedViews=[]},r.prototype._handleDataFrameOpened=function(){if(this._narrateViewActivation){var e=this.app.getResource(this.libraryId,"language-accessibility-map-data-frame-open"),t=this.app.getResource(this.libraryId,"language-accessibility-map-open");e+=this._subviewNotifications[this._currentDataFrameViewId].format(t),this._isDataFrameOpen=!0,this.app.trace.view(e),this.app.command("ScreenReaderNarrate").execute(e)}},r.prototype._handleDataFrameClosed=function(){var e=this.app.getResource(this.libraryId,"language-accessibility-map-data-frame-closed");this._isDataFrameOpen=!1,this.app.trace.view(e),this.app.command("ScreenReaderNarrate").execute(e)},r.prototype._compactToolbarFlyoutActivated=function(e){e.id===this.app.getResource(this.libraryId,"language-accessibility-map-compact-toolbar-view")&&(this.app.trace.view("View activated: "+e.id),this._openViews.push(e.id),this._handleView(e))},r.prototype._compactToolbarFlyoutDeactivated=function(e){e.id===this.app.getResource(this.libraryId,"language-accessibility-map-compact-toolbar-view")&&(this.app.trace.view("View deactivated: "+e.id),this._closedViews.push(e.id),this._handleView(e))},r);function r(){var e=null!==a&&a.apply(this,arguments)||this;return e._notifications={},e._subviewNotifications={},e._message="",e._isDataFrameOpen=!1,e._openViews=[],e._closedViews=[],e._dataFrameOpenViews=[],e._dataFrameClosedViews=[],e._currentDataFrameViewId="LayerListView",e._activeContainerViews=["LayerDataContainerView"],e.startTime=(new Date).getTime(),e.timeDelay=250,e.newEventTime=null,e._narrateViewActivation=!1,e}t.ViewActivatorProvider=n})},"url:/Mapping/modules/Accessibility/AccessibilityButtonView.html":t,"url:/Mapping/modules/Accessibility/AccessibilityIconView.html":i,"url:/Mapping/modules/Accessibility/AccessibilityView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Accessibility/CSS/common.css","css","LnZpZXcuQWNjZXNzaWJpbGl0eVZpZXcgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB6LWluZGV4OiAtMTsNCn0NCi5rZXlib2FyZC1mb2N1cy1hY3RpdmUgOmZvY3VzLA0KLmtleWJvYXJkLWZvY3VzLWFjdGl2ZSAjbWFwX3Jvb3Q6Zm9jdXM6YWZ0ZXIsDQoua2V5Ym9hcmQtZm9jdXMtYWN0aXZlIC5nY3gtdG9nZ2xlIC5pbnB1dC1jaGVja2JveDpmb2N1cyArIC5pbnB1dC1sYWJlbDpiZWZvcmUgew0KICAgIG91dGxpbmU6IDJweCBzb2xpZDsNCiAgICBvdXRsaW5lLW9mZnNldDogLTJweDsNCn0NCi5rZXlib2FyZC1mb2N1cy1hY3RpdmUgLmdjeC10b2dnbGUgLmlucHV0LWNoZWNrYm94OmZvY3VzICsgLmlucHV0LWxhYmVsOmFmdGVyIHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsNCiAgICBib3JkZXI6IDNweCBzb2xpZCAjRkZGRkZGOw0KfQ0KLmtleWJvYXJkLWZvY3VzLWFjdGl2ZSAjbWFwX3Jvb3Q6Zm9jdXM6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6Jyc7DQogICAgbGVmdDogMDsNCiAgICByaWdodDogMDsNCiAgICB0b3A6IDA7DQogICAgYm90dG9tOiAwOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIHotaW5kZXg6IDEwOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCi8qIENoYXJ0aW5nIG92ZXJyaWRlcyB0byBhbGxvdyBmb3IgZm9jdXMgc3RhdGUgKi8NCi5jaGFydCB7DQogICAgb3V0bGluZS1vZmZzZXQ6IDAhaW1wb3J0YW50Ow0KICAgIHdpZHRoOiA5OSU7DQp9DQoNCi5BY2Nlc3NpYmlsaXR5QnV0dG9uVmlldyB7DQogICAgZmxvYXQ6IHJpZ2h0Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KLmFjY2Vzc2liaWxpdHktYnV0dG9uIHsNCiAgICB3aWR0aDogMi41ZW07DQogICAgaGVpZ2h0OiAyLjVlbTsNCiAgICBwYWRkaW5nOiAwLjI1ZW0gMC41ZW07DQogICAgYmFja2dyb3VuZDogdXJsKFJlc291cmNlcy9JbWFnZXMvSWNvbnMvYWNjZXNzaWJpbGl0eS0zMi5wbmcpIGNlbnRlciBjZW50ZXIgbm8tcmVwZWF0Ow0KICAgIGJhY2tncm91bmQtc2l6ZTogMi41ZW0gMi41ZW07DQogICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBjb250ZW50LWJveDsNCiAgICAtbW96LWJveC1zaXppbmc6IGNvbnRlbnQtYm94Ow0KICAgIGJveC1zaXppbmc6IGNvbnRlbnQtYm94Ow0KfQ0KDQovKiBFTkQ6IFVzZXIgLS0tLS0tLS0tLS0tLS0tICov"),e.resourceManager.register("Mapping","inv","Mapping/modules/Accessibility/AccessibilityButtonView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Accessibility/AccessibilityIconView.html","html",i),e.resourceManager.register("Mapping","inv","Mapping/modules/Accessibility/AccessibilityView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Accessibility/AccessibilityButtonView","Mapping/modules/Accessibility/AccessibilityIconView","Mapping/modules/Accessibility/AccessibilityIconViewModel","Mapping/modules/Accessibility/AccessibilityModule","Mapping/modules/Accessibility/AccessibilityViewModel","Mapping/modules/Accessibility/AccessibilityProviders/MapTextProvider","Mapping/modules/Accessibility/AccessibilityProviders/ViewActivatorProvider"],function(e,t,i,a,n,r,o){s(e,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityButtonView",e.AccessibilityButtonView),s(t,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityIconView",t.AccessibilityIconView),s(i,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityIconViewModel",i.AccessibilityIconViewModel),s(a,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityModule",a.AccessibilityModule),s(n,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityViewModel",n.AccessibilityViewModel),s(r,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.MapTextProvider",r.MapTextProvider),s(o,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.ViewActivatorProvider",o.ViewActivatorProvider)})}();