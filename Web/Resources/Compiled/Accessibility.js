function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var a=t.split("."),n=null,r=window,s=0,o=a.length;s<o;s++)n=a[s],s==o-1?r[n]=i:r[n]||(r[n]={}),r=r[n]}require({cache:{"Mapping/modules/Accessibility/AccessibilityButtonView":function(){define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,i){"use strict";var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.handleOnClick=function(e,t,i){return this.app.command("ShowAccessibilityView").execute(),!1},t}(i.ViewBase);t.AccessibilityButtonView=a})},"Mapping/modules/Accessibility/AccessibilityIconView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/FeatureDescriptionPresenterView"],function(e,t,i,a){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.userInitiatedDA=!1,t}return __extends(t,e),t.prototype.attach=function(t){if(t){if(e.prototype.attach.call(this,t),null!==this.viewModel.content.get())this._activateAccessibilityView();else var i=this.app.eventRegistry.event("AccessibilityIconContentInitializedEvent").subscribe(this,function(){this._activateAccessibilityView(),this.app.eventRegistry.event("AccessibilityIconContentInitializedEvent").unsubscribe(i)});if(this.okButtonElement)try{this.okButtonElement.focus()}catch(a){}this.viewContainerViewClosedEventToken||(this.viewContainerViewClosedEventToken=this.app.event("ViewContainerViewClosedEvent").subscribe(this,function(e){e&&e.viewId==this.id&&this._deactivateForUser()}))}},t.prototype._canExecuteActivateAccessibilityView=function(){return this.viewModel.included.get()},t.prototype._executeActivateAccessibilityView=function(){this.app.commandRegistry.command("ActivateView").execute(this.id)},t.prototype._activateAccessibilityView=function(){this.viewModel.included.get()&&this.title.set(this.viewModel.title.get()),this.app.commandRegistry.command("ShowAccessibilityView").register(this,this._executeActivateAccessibilityView,this._canExecuteActivateAccessibilityView)},t.prototype.resolveWidget=function(t,i){if(e.prototype.resolveWidget.call(this,t,i),"GetHTMLContent"===t){var n=new a.FeatureDescriptionPresenterView(this.app,this.libraryId);return n.root=document.createElement("div"),n.root.className="content",n.root.innerHTML=n.insertLinkAndImageBindings(i),n.attach(null),n}},t.prototype.handleClickOk=function(e,t,i){return this._deactivateForUser(),!1},t.prototype._deactivateForUser=function(){this.userInitiatedDA=!0,this.app.viewManager.deactivateView(this),this.viewModel.callback&&this.userInitiatedDA&&this.viewModel.callback()},t}(i.ViewBase);t.AccessibilityIconView=n})},"Mapping/modules/Accessibility/AccessibilityIconViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,a){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.included=new a.Observable((!0)),t.content=new a.Observable(null),t.title=new a.Observable(null),t}return __extends(t,e),t.prototype.initialize=function(e){e&&(e.hasOwnProperty("included")&&this.included.set(e.included),e.hasOwnProperty("title")&&this.title.set(e.title),e.hasOwnProperty("content")&&(this.content.set(decodeURIComponent(e.content)),this.app.eventRegistry.event("AccessibilityIconContentInitializedEvent").publish()))},t}(i.ViewModelBase);t.AccessibilityIconViewModel=n})},"Mapping/modules/Accessibility/AccessibilityModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/framework/observables","geocortex/infrastructure/FocusUtils"],function(e,t,i,a,n){"use strict";var r=window.HTMLElement||window.Element,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.includeProviders=new a.Observable((!0)),t._keydownHandle=null,t._keyupHandle=null,t._panning=!1,t._viewsIgnoreAutoFocus=["LoadingStatus","StatusIndicatorView","StatusMessageView","View-","ProviderView","geometryEditingStatus"],t._modalContainerView=null,t}return __extends(t,e),t.prototype.initialize=function(i){var a=this;if(e.prototype.initialize.call(this,i),i.keyboardFocusIndicatorEnabled){var n=i.keyboardFocusIndicatorColor||t.DEFAULT_KEYBOARD_FOCUS_INDICATOR_COLOR,r=document.createElement("style");r.textContent="\n                    .keyboard-focus-active :focus,\n                    .keyboard-focus-active #map_root:focus:after {\n                        outline-color: "+n+" !important;\n                    }\n                ",document.head.appendChild(r),$(document).on("mousedown",function(e){$(document.documentElement).hasClass("keyboard-focus-active")&&(a.app.trace.debug("Keyboard focus deactivated."),$(document.documentElement).removeClass("keyboard-focus-active"))}),$(document).on("keydown",function(e){9==e.keyCode&&$(document.documentElement).hasClass("keyboard-focus-active")===!1&&(a.app.trace.debug("Keyboard focus active."),$(document.documentElement).addClass("keyboard-focus-active"))})}if(this.app.map?this.enableMapFocusedText():this.app.event("SiteServiceLayersLoadedEvent").once(this,this.enableMapFocusedText),i.hasOwnProperty("includeProviders")&&this.includeProviders.set(i.includeProviders),i.providers&&this.includeProviders.get())for(var s=0;s<i.providers.length;s++){var o=i.providers[s];if(o.isEnabled===!1)return;var c=dojo.getObject(o.type);if(c){var l=new c(this.app,o.libraryId||this.libraryId);l.initialize(o)}}i.expandedMapKeyboardAccessibility&&this.enableKeyboardNavigation(),i.automaticElementFocusing&&this.enableAutomaticElementFocusing()},t.prototype.enableMapFocusedText=function(){$(this.app.map.root).attr("aria-label",this.app.getResource(this.libraryId,"language-accessibility-map-focused")),$(this.app.map.root).attr("role","main"),$(this.app.map.root).children(".esriMapContainer, .esriControlsBR").attr("aria-hidden","true")},t.prototype.enableAutomaticElementFocusing=function(){var e=this;this.app.command("FocusOnFirstInputInView").register(this,function(e){setTimeout(function(){n.focusOnFirstInput(e)})}),this.app.event("_shellStabilizedEvent").once(this,function(){e.app.event("ViewActivatedEvent").subscribe(e,function(t){if(!e._modalContainerView){var i=e.app.viewManager.getRegionForViewId(t.id);i&&"ModalWindowPlaceholderRegion"===i.name&&(e._modalContainerView=t)}for(var a=0;a<e._viewsIgnoreAutoFocus.length;a++)if(t.id.search(e._viewsIgnoreAutoFocus[a])!==-1)return;e.app.trace.debug("View focused: "+t.id),e.app.command("FocusOnFirstInputInView").execute(t)})});var t=function(t){return e._interceptTabsWhileModalActive(t)};this.app.event("RegionActivatedEvent").subscribe(this,function(e){"ModalWindowRegion"===e.name&&$(document).on("keydown",t)}),this.app.event("RegionDeactivatedEvent").subscribe(this,function(e){"ModalWindowRegion"===e.name&&$(document).off("keydown",t)})},t.prototype._resetModalFocus=function(e){if(e&&e.root)try{var t=$(e.root).find(":visible:input, a:visible, button:visible").not(".bound-disabled, .disabled, [tabindex=-1]");if(t&&t.length>0)return void n.focus(t[0])}catch(i){this.app.trace.debug("Could not focus: "+i)}},t.prototype._interceptTabsWhileModalActive=function(e){var t=e.keyCode||e.which;if(9===t||9===t&&e.shiftKey){var i=document.activeElement,a=$(this._modalContainerView.root).find(":focusable");a&&i===a[0]&&9===t&&e.shiftKey?e.preventDefault():i===a[a.length]&&9===t&&e.preventDefault(),0===$(i).parents(".ModalViewContainerView").length&&(this._resetModalFocus(this._modalContainerView),e.preventDefault())}},t.prototype.enableKeyboardNavigation=function(){var e=this;this.disableKeyboardNavigation(),this.app.map&&this.app.map.loaded?(this._keydownHandle=dojo.on(document,"keydown",function(t){return e._onKeyDownHandler(t)}),this._keyupHandle=dojo.on(document,"keyup",function(t){return e._onKeyUpHandler(t)})):this.app.event("MapLoadedEvent").once(this,function(t){e._keydownHandle=dojo.on(document,"keydown",function(t){return e._onKeyDownHandler(t)}),e._keyupHandle=dojo.on(document,"keyup",function(t){return e._onKeyUpHandler(t)})})},t.prototype.disableKeyboardNavigation=function(){this._keydownHandle&&this._keydownHandle.remove(),this._keyupHandle&&this._keyupHandle.remove(),this._keydownHandle=this._keyupHandle=null,this._panning=!1},t.prototype._onKeyDownHandler=function(e){var t=e.target||e.srcElement,i=null;if(t instanceof r){var a=t;i=a.className}if(t===this.app.map.root||"ovwHighlight"===i){var n=this.app.map;n.navigationManager._keyHandle&&(this._panning=!0,n.navigationManager._keyHandle.advice(e))}},t.prototype._onKeyUpHandler=function(e){var t=e.target||e.srcElement,i=null;if(t instanceof r){var a=t;i=a.className}if(t===this.app.map.root||"ovwHighlight"===i){var n=this.app.map;n.navigationManager._keyEndHandle&&this._panning&&(this._panning=!1,n.navigationManager._keyEndHandle.advice(e))}},t}(i.ModuleBase);s.DEFAULT_KEYBOARD_FOCUS_INDICATOR_COLOR="#550055",t.AccessibilityModule=s})},"Mapping/modules/Accessibility/AccessibilityViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables"],function(e,t,i,a){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ariaLabelText=new a.Observable(""),t.screenNarrationEnabled=!0,t._numNarrateDeactivations=0,t}return __extends(t,e),t.prototype.initialize=function(t){var i=this;e.prototype.initialize.call(this,t),this.app.command("EnableScreenReaderNarrate").register(this,function(){i._numNarrateDeactivations=i._numNarrateDeactivations>0?--i._numNarrateDeactivations:0,0===i._numNarrateDeactivations&&(i.screenNarrationEnabled=!0)}),this.app.command("DisableScreenReaderNarrate").register(this,function(){i._numNarrateDeactivations++,i.screenNarrationEnabled=!1}),this.app.command("ScreenReaderNarrate").register(this,function(e){if(!i.screenNarrationEnabled)return void i.app.trace.debug("ScreenReader Narration Disabled by {0} components. Not narrating '{1}'".format(i._numNarrateDeactivations,e));var t=0;setTimeout(function(){i.screenNarrationEnabled&&(i.app.trace.debug("ScreenReader Narration Enabled. Now Narrating: {0}".format(e)),i.ariaLabelText.set(e))},t)})},t}(i.ViewModelBase);t.AccessibilityViewModel=n})},"Mapping/modules/Accessibility/AccessibilityProviders/MapTextProvider":function(){define(["require","exports","geocortex/infrastructure/accessibility/AccessibilityProviderBase","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/DateFormat","geocortex/infrastructure/NumberFormat","geocortex/essentials/MapServiceConstants","geocortex/infrastructure/TaskUtils","geocortex/infrastructure/gis/LayerInfo"],function(e,t,i,a,n,r,s,o,c,l){"use strict";var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fullDescription="",t.changedDescription="",t.decimalPrecision=4,t.readAttributionInformation=!1,t._viewDelay=0,t._timeoutId=null,t._eventDelay=250,t._mapReadDelay=1250,t._previousExtent=null,t._previousScale=null,t._previousTimeExtentMin=null,t._previousTimeExtentMax=null,t._queryTaskCollection=[],t._identifyTaskCollection=[],t._lastQueryMap=null,t._lastIdentifyMap=null,t._completedQueries=!1,t._completedIdentifies=!1,t}return __extends(t,e),t.prototype.initialize=function(t){var i=this;e.prototype.initialize.call(this,t),t.decimalPrecision>=0&&t.decimalPrecision<10?this.decimalPrecision=t.decimalPrecision:this.app.trace.warning("MapTextProvider: decimalPrecision entered in config is out of range (0-9). Using default value of "+this.decimalPrecision+"."),this.readAttributionInformation=t.readAttributionInformation,this.app.event("MapExtentChangedEvent").subscribe(this,this._delayMapDescriptionChanged),this.app.event("MapTimeExtentChangedEvent").subscribe(this,function(){return i.app.map&&i._delayMapDescriptionChanged(i.app.map.extent)}),this.app.event("MapPanStartedEvent").subscribe(this,function(e,t){clearTimeout(i._timeoutId),i._timeoutId=null}),this.app.map?this._handleMapLoadedEvent(this.app.map):this.app.event("SiteServiceLayersLoadedEvent").once(this,this._handleMapLoadedEvent)},t.prototype._handleMapLoadedEvent=function(e){var t=this;$(this.app.map.root).focus(function(e){clearTimeout(t._timeoutId),t._timeoutId=setTimeout(function(){t.app.command("ScreenReaderNarrate").execute(t.fullDescription)},t._mapReadDelay)}),this.readAttributionInformation&&$(this.app.map.attribution.listNode).on("DOMSubtreeModified",function(e){t._delayMapDescriptionChanged(t.app.map.extent)})},t.prototype._delayMapDescriptionChanged=function(e){var t=this;clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){t._timeoutId=null,t._handleMapDescriptionChanged(e)},this._eventDelay)},t.prototype._handleMapDescriptionChanged=function(e){var t=this;setTimeout(function(){t.app.trace.debug("setTimeout() called for loadingChanges."),t.app.command("ScreenReaderNarrate").execute(t.app.getResource(t.libraryId,"language-accessibility-map-loading-changes"))},this._viewDelay);var i="",a=function(a){i=a,t._setVisibleFeaturesDescription(e,n)},n=function(a){0===a.length&&(a=t.app.getResource(t.libraryId,"language-accessibility-map-none"));var n=t._getTimeExtentDescription();if(t.fullDescription="",t.fullDescription=i,t.fullDescription+=" "+t._getScaleDescription(),n&&(t.fullDescription+=" "+n),t.fullDescription+=" "+t.app.getResource(t.libraryId,"language-accessibility-map-visible-features").format(a),t.changedDescription="",null!==t._previousExtent&&e.getCenter()==t._previousExtent.getCenter()||(t.changedDescription+=i),t._previousScale!=t.app.map.getScale()&&(t.changedDescription+=" "+t._getScaleDescription()),n&&t.app.map.timeExtent&&t.app.map.timeExtent.startTime&&t.app.map.timeExtent.endTime&&(t._previousTimeExtentMin===t.app.map.timeExtent.startTime.getTime()&&t._previousTimeExtentMax===t.app.map.timeExtent.endTime.getTime()||(t.changedDescription+=" "+n)),t.changedDescription+=" "+t.app.getResource(t.libraryId,"language-accessibility-map-visible-features").format(a),t.readAttributionInformation){var r=t._getAttributionInformation();t.fullDescription+=" "+r,t.changedDescription+=" "+r}setTimeout(function(){t.app.trace.debug("setTimeout() called for changedDescription."),t.app.command("ScreenReaderNarrate").execute(t.app.getResource(t.libraryId,"language-accessibility-map-changed-information").format(t.changedDescription))},t._viewDelay),$(t.app.map.root).attr("aria-label",t.app.getResource(t.libraryId,"language-accessibility-map-focused")),t._previousExtent=e,t._previousScale=t.app.map.getScale(),t._previousTimeExtentMin=t.app.map.timeExtent&&t.app.map.timeExtent.startTime?t.app.map.timeExtent.startTime.getTime():null,t._previousTimeExtentMax=t.app.map.timeExtent&&t.app.map.timeExtent.endTime?t.app.map.timeExtent.endTime.getTime():null};this._getCentreCoordinatesDescription(e,a)},t.prototype._getCentreCoordinatesDescription=function(e,t){var i=this,n="",r="",s=new esri.SpatialReference(102100);a.projectGeometry(e,s,function(e){if(e instanceof esri.geometry.Extent){var a=e;n=i._getFormattedLatitudeString(a),r=i._getFormattedLongitudeString(a)}t(i.app.getResource(i.libraryId,"language-accessibility-map-coordinates-introduction").format(n,r))},function(e){i.app.trace.info("Error encountered attempting to project geometry: "+e),t(i.app.getResource(i.libraryId,"language-accessibility-map-coordinates-error"))},this.app)},t.prototype._getFormattedLatitudeString=function(e){var t=n.formatNumber(Math.abs(e.getCenter().getLatitude()),s.NumberFormat.NUMBER,{fractionalDigits:this.decimalPrecision});return e.getCenter().getLatitude()>0?this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-north").format(t):this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-south").format(t)},t.prototype._getFormattedLongitudeString=function(e){var t=n.formatNumber(Math.abs(e.getCenter().getLongitude()),s.NumberFormat.NUMBER,{fractionalDigits:this.decimalPrecision});return e.getCenter().getLongitude()<0?this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-west").format(t):this.app.getResource(this.libraryId,"language-accessibility-map-coordinates-east").format(t)},t.prototype._getScaleDescription=function(){var e=n.formatNumber(this.app.map.getScale(),s.NumberFormat.NUMBER,{fractionalDigits:this.decimalPrecision});return this.app.getResource(this.libraryId,"language-accessibility-map-scale").format(e)},t.prototype._getTimeExtentDescription=function(){var e,t;return this.app.map&&this.app.map.timeExtent&&this.app.map.timeExtent.startTime&&this.app.map.timeExtent.endTime&&(e=n.formatDate(this.app.map.timeExtent.startTime,r.DateFormat.DATE_TIME_LONG),t=n.formatDate(this.app.map.timeExtent.endTime,r.DateFormat.DATE_TIME_LONG),e&&t)?this.app.getResource(this.libraryId,"language-accessibility-map-time-extent").format(e,t):""},t.prototype._setVisibleFeaturesDescription=function(e,t){for(var i="",a=this._getVisibleLayers(e),n=[],r=[],s=0;s<a.length;s++){var c=a[s];if(c.mapService.mapServiceFunction!==o.MapServiceFunction.BASE)if(c.mapService.serviceLayer instanceof esri.layers.GraphicsLayer){var l=c.mapService.serviceLayer,p=this._countGraphicsInExtent(e,l);p>0&&(i+=" "+this.app.getResource(this.libraryId,"language-accessibility-map-visible-feature-information").format(p,c.name))}else if(c.mapService.serviceLayer instanceof esri.layers.KMLLayer){for(var d=c.mapService.serviceLayer,u=d.getLayers(),h=c.mapService.displayName,p=0,m=0;m<u.length;m++){var f=u[m];f.graphics&&f.visible&&f.isVisibleAtScale(this.app.map.getScale())&&(p+=this._countGraphicsInExtent(e,f))}p>0&&(i+=" "+this.app.getResource(this.libraryId,"language-accessibility-map-visible-feature-information").format(p,h))}else{var g=c.mapService.serviceLayer;if(!(g.capabilities&&g.capabilities.toLowerCase().indexOf("query")<0&&g.capabilities.toLowerCase().indexOf("identify")<0))if(c.queryable&&c.supportsQuery)0===r.filter(function(e){return e.mapService.serviceUrl+"/"+e.id==c.mapService.serviceUrl+"/"+c.id}).length&&r.push(c);else if(c.identifiable&&c.supportsIdentify){var y=n.filter(function(e){return e.mapService.serviceUrl===c.mapService.serviceUrl});y.length>0&&0===y[0].layers.filter(function(e){return e.toString()===c.id}).length?y[0].layers.push(parseInt(c.id)):0===y.length&&n.push({mapService:c.mapService,layers:[parseInt(c.id)]})}else this.app.trace.debug(c.name+" layer does not support identify or query. Not supported for screenreader.")}}0===n.length?this._completedIdentifies=!0:this._completedIdentifies=!1,0===r.length?this._completedQueries=!0:this._completedQueries=!1,0===n.length&&0===r.length?t(i):(n.length>0&&this._performIdentify(t,i,e,n),r.length>0&&this._performQueries(t,i,e,r))},t.prototype._countGraphicsInExtent=function(e,t){for(var i=0,a=0;a<t.graphics.length;a++){var n=t.graphics[a];e.intersects(n.geometry)&&n.visible&&i++}return i},t.prototype._performIdentify=function(e,t,i,a){var n=this,r={};this._identifyTaskCollection=[],null!=this._lastIdentifyMap&&this._lastIdentifyMap.cancel();for(var s=0;s<a.length;s++){var o=new esri.tasks.IdentifyParameters;o.mapExtent=i,o.geometry=i,o.layerIds=a[s].layers,o.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_VISIBLE,o.returnGeometry=!1,o.tolerance=0,o.height=$(this.app.map.root).height(),o.width=$(this.app.map.root).width();var l=c.getIdentifyTask(a[s].mapService);this._identifyTaskCollection.push({identifyTask:l,identifyParameters:o})}var p=!1;this._lastIdentifyMap=Promise.map(this._identifyTaskCollection,function(e){return new Promise(function(t,i){p||e.identifyTask.execute(e.identifyParameters,t,i)}).then(function(e){var t=e;if(!p)for(var i=0;i<t.length;i++){var a=e[i];void 0!==r[a.layerName]?r[a.layerName]+=1:r[a.layerName]=1}})["catch"](function(e){n.app.trace.info("Error performing identify on server for feature count in MapTextProvider: "+e)})},{concurrency:1}).then(function(){for(var i in r)r.hasOwnProperty(i)&&r[i]>0&&(t+=" "+n.app.getResource(n.libraryId,"language-accessibility-map-visible-feature-information").format(r[i],i));!p&&n._completedQueries&&e(t)}).cancellable()["catch"](Promise.CancellationError,function(e){p=!0,n.app.trace.debug("Feature information retrieval for MapTextProvider cancelled.")})["catch"](function(e){n.app.trace.info("Error retrieving MapTextProvider info: "+e)}).lastly(function(){n._completedIdentifies=!0})},t.prototype._performQueries=function(e,t,i,a){var n=this,r=new esri.tasks.Query;r.geometry=esri.geometry.Polygon.fromExtent(i),r.returnGeometry=!1,r.where="1=1",this._queryTaskCollection=[],null!=this._lastQueryMap&&this._lastQueryMap.cancel();for(var s=0;s<a.length;s++){var o=a[s],l=o.mapService.serviceLayer.url,p=(o.id,o.name),d=(l.split("?"),c.getQueryTask(o));this._queryTaskCollection.push({queryTask:d,layerName:p})}var u=!1;this._lastQueryMap=Promise.map(this._queryTaskCollection,function(e){if(!u)return new Promise(function(t,i){e.queryTask.executeForCount(r,t,i)}).then(function(i){i>0&&(t+=" "+n.app.getResource(n.libraryId,"language-accessibility-map-visible-feature-information").format(i,e.layerName))})["catch"](function(e){n.app.trace.info("Error querying server for feature count in MapTextProvider: "+e)})},{concurrency:1}).then(function(){!u&&n._completedIdentifies&&e(t)}).cancellable()["catch"](Promise.CancellationError,function(e){u=!0,n.app.trace.debug("Feature information retrieval for MapTextProvider cancelled.")})["catch"](function(e){n.app.trace.info("Error retrieving MapTextProvider info: "+e)}).lastly(function(){n._completedQueries=!0})},t.prototype._getVisibleLayers=function(e){for(var t=this.app.site.essentialsMap.allLayers(),i=[],a=0;a<t.length;a++){var n=t[a],r=l.LayerInfo.fromGcxLayer(n);r.getMaxScale()>this.app.map.getScale()||r.getMinScale()<this.app.map.getScale()||r.isVisible()&&r.subLayerIds&&0===r.subLayerIds.length&&i.push(n)}return i},t.prototype._getAttributionInformation=function(){for(var e="",t=$(this.app.map.attribution.listNode).children(),i=0;i<t.length;i++){var a=t[i];"none"!==$(a).css("display")&&(e+=a.textContent+" ")}return e},t}(i.AccessibilityProviderBase);t.MapTextProvider=p})},"Mapping/modules/Accessibility/AccessibilityProviders/ViewActivatorProvider":function(){define(["require","exports","geocortex/infrastructure/accessibility/AccessibilityProviderBase"],function(e,t,i){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._notifications={},t._subviewNotifications={},t._message="",t._isDataFrameOpen=!1,t._openViews=[],t._closedViews=[],t._dataFrameOpenViews=[],t._dataFrameClosedViews=[],t._currentDataFrameViewId="LayerListView",t._activeContainerViews=["LayerDataContainerView"],t.startTime=(new Date).getTime(),t.timeDelay=250,t.newEventTime=null,t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t.notifications&&(this._notifications=t.notifications),t.subviewNotifications&&(this._subviewNotifications=t.subviewNotifications),this._resetViewArrays(),this.app.event("ViewActivatedEvent").subscribe(this,this._handleViewActivated),this.app.event("ViewDeactivatedEvent").subscribe(this,this._handleViewDeactivated),this.app.event("DataFrameOpenedEvent").subscribe(this,this._handleDataFrameOpened),this.app.event("DataFrameClosedEvent").subscribe(this,this._handleDataFrameClosed),this.app.event("FlyoutActivated").subscribe(this,this._compactToolbarFlyoutActivated),this.app.event("FlyoutDeactivated").subscribe(this,this._compactToolbarFlyoutDeactivated)},t.prototype._handleViewActivated=function(e){var t=this.app.getResource(this.libraryId,"language-accessibility-map-open");this.app.trace.debug("View activated: "+e.id),null!=this._notifications[e.id]?(this._openViews.indexOf(e.id)>-1||this._openViews.push(e.id),this._handleView(e)):"DataRegion"==e.regionName&&this._isDataFrameOpen?(this._activeContainerViews.indexOf(e.id)>-1||(this._activeContainerViews.push(e.id),this.app.trace.debug("Active container views: {0}".format(this._activeContainerViews.length.toString()))),this._handleDataRegionView(e,t)):this.app.trace.debug("No corresponding notification message for "+e.id)},t.prototype._handleViewDeactivated=function(e){this.app.getResource(this.libraryId,"language-accessibility-map-closed");if(this.app.trace.debug("View deactivated: "+e.id),this._activeContainerViews.indexOf(e.id)>-1){var t=this._activeContainerViews.indexOf(e.id);this._activeContainerViews.splice(t,1),this.app.trace.debug("Active container views: {0}".format(this._activeContainerViews.length.toString())),0==this._activeContainerViews.length&&(this._currentDataFrameViewId="PlaceholderView")}else null!=this._notifications[e.id]?(this._closedViews.indexOf(e.id)>-1||this._closedViews.push(e.id),this._handleView(e)):null!=this._subviewNotifications[e.id]&&this._isDataFrameOpen?(this._dataFrameClosedViews.indexOf(e.id)>-1||this._dataFrameClosedViews.push(e.id),this._handleView(e)):this.app.trace.debug("No corresponding notification message for "+e.id)},t.prototype._handleView=function(e){var t=this;this.newEventTime=(new Date).getTime(),setTimeout(function(){var e=(new Date).getTime(),i=e-t.newEventTime;i>t.timeDelay&&t._arraysNotEmpty()&&(t._composeMessage(),t.app.trace.debug("Message: {0}".format(t._message)),t.app.command("ScreenReaderNarrate").execute(t._message),t._message="",t._resetViewArrays())},this.timeDelay)},t.prototype._arraysNotEmpty=function(){return this._openViews.length>0||this._closedViews.length>0||this._dataFrameOpenViews.length>0||this._dataFrameClosedViews.length>0},t.prototype._handleDataRegionView=function(e,t){var i="";if(e.id==this.app.getResource(this.libraryId,"language-accessibility-map-workflowlist-view"))i=e.id;else{if(!e.viewModel||!e.viewModel.currentView)return;i=e.viewModel.currentView.id}if(null!=this._subviewNotifications[i]){if(i==this._currentDataFrameViewId)return void this.app.trace.debug("Active view = Current data frame view.");t==this.app.getResource(this.libraryId,"language-accessibility-map-open")?(this._dataFrameOpenViews.indexOf(e.id)>-1||this._dataFrameOpenViews.push(i),null==this._currentDataFrameViewId||this._dataFrameClosedViews.indexOf(this._currentDataFrameViewId)>-1||this._dataFrameClosedViews.push(this._currentDataFrameViewId),this._currentDataFrameViewId=i):this._dataFrameClosedViews.indexOf(this._currentDataFrameViewId)>-1||this._dataFrameClosedViews.push(i),this._handleView(e)}else this._handleView(e)},t.prototype._composeMessage=function(){this._isDataFrameOpen||(this._dataFrameOpenViews=[]),this._addOpenViews(),this._addDataFrameOpenViews(),this._addClosedViews(),this._addDataFrameClosedViews()},t.prototype._addOpenViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-open"),t=0;t<this._openViews.length;t++)this._message+=this._notifications[this._openViews[t]].format(e)},t.prototype._addClosedViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-closed"),t=0;t<this._closedViews.length;t++)this._message+=this._notifications[this._closedViews[t]].format(e)},t.prototype._addDataFrameOpenViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-open"),t=0;t<this._dataFrameOpenViews.length;t++)this._message+=this._subviewNotifications[this._dataFrameOpenViews[t]].format(e)},t.prototype._addDataFrameClosedViews=function(){for(var e=this.app.getResource(this.libraryId,"language-accessibility-map-closed"),t=0;t<this._dataFrameClosedViews.length;t++)this._message+=this._subviewNotifications[this._dataFrameClosedViews[t]].format(e)},t.prototype._resetViewArrays=function(){this._openViews=[],this._closedViews=[],this._dataFrameOpenViews=[],this._dataFrameClosedViews=[]},t.prototype._handleDataFrameOpened=function(){var e=this.app.getResource(this.libraryId,"language-accessibility-map-data-frame-open"),t=this.app.getResource(this.libraryId,"language-accessibility-map-open");e+=this._subviewNotifications[this._currentDataFrameViewId].format(t),this._isDataFrameOpen=!0,this.app.trace.debug(e),this.app.command("ScreenReaderNarrate").execute(e)},t.prototype._handleDataFrameClosed=function(){var e=this.app.getResource(this.libraryId,"language-accessibility-map-data-frame-closed");this._isDataFrameOpen=!1,this.app.trace.debug(e),this.app.command("ScreenReaderNarrate").execute(e)},t.prototype._compactToolbarFlyoutActivated=function(e){e.id===this.app.getResource(this.libraryId,"language-accessibility-map-compact-toolbar-view")&&(this.app.trace.debug("View activated: "+e.id),this._openViews.push(e.id),this._handleView(e))},t.prototype._compactToolbarFlyoutDeactivated=function(e){e.id===this.app.getResource(this.libraryId,"language-accessibility-map-compact-toolbar-view")&&(this.app.trace.debug("View deactivated: "+e.id),this._closedViews.push(e.id),this._handleView(e))},t}(i.AccessibilityProviderBase);t.ViewActivatorProvider=a})},"url:/Mapping/modules/Accessibility/AccessibilityButtonView.html":'<div class="accessibility" tabindex="-1">\r\n    <button type="button" class="accessibility-button" data-binding="{@visible: included}{@event-onclick: handleOnClick}{title: @language-accessibility-map-accessibility-icon}" tabindex="0"></button>\r\n</div>',"url:/Mapping/modules/Accessibility/AccessibilityIconView.html":'<div class="module notification alert">\r\n    <div role="alert" tabindex="0">        \r\n        <div class="desc" data-binding="{@widget: GetHTMLContent}{@widget-context: content}"></div>        \r\n    </div>\r\n    <div class="form-btns">\r\n        <button class="button" data-binding="{@var: okButtonElement}{@event-onclick: handleClickOk}{@text: @language-common-ok}" />\r\n    </div>    \r\n</div>',"url:/Mapping/modules/Accessibility/AccessibilityView.html":'<!-- The aria-label and span may appear redundant, but they\'re both needed for how different browsers/readers work. -->\r\n<div class="screen-reader-notifications" data-binding="{@var: screenReaderNotificationsElement}" aria-live="polite">\r\n    <span data-binding="{@text: ariaLabelText}" aria-live="polite"></span>\r\n</div>'}}),define(["Mapping/modules/Accessibility/AccessibilityButtonView","Mapping/modules/Accessibility/AccessibilityIconView","Mapping/modules/Accessibility/AccessibilityIconViewModel","Mapping/modules/Accessibility/AccessibilityModule","Mapping/modules/Accessibility/AccessibilityViewModel","Mapping/modules/Accessibility/AccessibilityProviders/MapTextProvider","Mapping/modules/Accessibility/AccessibilityProviders/ViewActivatorProvider"],function(e,t,i,a,n,r,s){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityButtonView",e.AccessibilityButtonView),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityIconView",t.AccessibilityIconView),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityIconViewModel",i.AccessibilityIconViewModel),shim(a,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityModule",a.AccessibilityModule),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.AccessibilityViewModel",n.AccessibilityViewModel),shim(r,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.MapTextProvider",r.MapTextProvider),shim(s,"geocortex.essentialsHtmlViewer.mapping.modules.accessibility.ViewActivatorProvider",s.ViewActivatorProvider)});