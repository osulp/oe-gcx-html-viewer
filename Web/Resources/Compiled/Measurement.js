!function(){var t="<div class='measurement-unit-switcher'>    <ul class='list-menu has-icon' data-binding='{@source: lengthUnits}{@value: selectedLengthUnits}{@visible: lengthSwitcherSelected}'>        <li class='list-menu-item' data-binding='{@template-for: lengthUnits}{@event-onclick: handleSetLengthUnits}'>            <span class='list-menu-details' data-binding='{@text: @context}'></span>        </li>    </ul>    <ul class='list-menu has-icon' data-binding='{@source: areaUnits}{@value: selectedAreaUnits}{@hidden: lengthSwitcherSelected}'>        <li class='list-menu-item' data-binding='{@template-for: areaUnits}{@event-onclick: handleSetAreaUnits}'>            <span class='list-menu-details' data-binding='{@text: @context}'></span>        </li>    </ul></div>",r="<ul class='transient-measurement'>    <li class='toolbar-item select-double'>        <select data-binding='{@source: lengthUnits}{@value: selectedLengthUnits}{disabled: measurementInProgress}{title: @language-measurement-length-select}{aria-label: @language-measurement-length-select}'>            <option data-binding='{@template-for: lengthUnits}{value: @context}{@text: @context}' />        </select>        <select data-binding='{@source: areaUnits}{@value: selectedAreaUnits}{disabled: measurementInProgress}{title: @language-measurement-area-select}{aria-label: @language-measurement-area-select}'>            <option data-binding='{@template-for: areaUnits}{value: @context}{@text: @context}' />        </select>    </li></ul>",a="<div class='toolbar-tool-mode'>    <div class='tbtm-done' data-binding='{@event-onclick: handleClickClose}'>        <span data-binding='{@text: @language-menu-done}'></span>    </div>    <div class='tbtm-list'>        <ul class='five'>            <li class='tbtm-checkbox'>                <input type='checkbox' id='tbtm-add-drawing' data-binding='{@value: addMarkupToMap}{disabled: measurementInProgress}' />                <p for='tbtm-add-drawing' data-binding='{@text: @language-measurement-add-as-drawing}'>\x3c!-- 'Add as Drawing' --\x3e</p>            </li>            <li>                <button class='tbtm-select' data-binding='{@event-onclick: handleShowLengthSwitcher}'>                    <h1 class='tbtm-units'><span data-binding='{@text: selectedLengthUnitShort}'></span><span class='icon icon-select'></span></h1>                    <p data-binding='{@text: @language-measurement-length-label}'></p>                </button>            </li>            <li>                <button class='tbtm-select' data-binding='{@event-onclick: handleShowAreaSwitcher}'>                    <h1 class='tbtm-units'><span data-binding='{@text: selectedAreaUnitShort}'></span><span class='icon icon-select'></span></h1>                    <p data-binding='{@text: @language-measurement-area-label}'></p>                </button>            </li>            <li>                <button class='tbtm-btn' data-binding='{@disabled: descriptorContainerEmpty}{@class-highlight: eraseActive}{@event-onclick: handleEraseMeasurement}'>                    <span class='icon icon-erase-24'></span>                    <p data-binding='{@text: @language-toolbar-erase}'></p>                </button>            </li>            <li>                <button class='tbtm-btn' data-binding='{@disabled: descriptorContainerEmpty}{@event-onclick: handleClearAll}'>                    <span class='icon icon-clear-24'></span>                    <p data-binding='{@text: @language-toolbar-clear-all}'></p>                </button>            </li>        </ul>    </div></div>";function p(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var a=t.split("."),i=null,n=window,s=0,o=a.length;s<o;s++)i=a[s],s==o-1?n[i]=r:n[i]||(n[i]={}),n=n[i];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Measurement/HighlightedMeasurementLabel":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=(a=r.HighlightedLabelGraphic,s(n,a),n.prototype.addToMapGraphicLayer=function(e){var t=this;void 0===e&&(e=!1),e&&(this._addedGraphicsToMapLayer=[]),this._addedGraphicsToMapLayer.push(this.app.map.graphics.add(this.highlightGraphic)),this.highlightIdTagGraphic&&this._addedGraphicsToMapLayer.push(this.app.map.graphics.add(this.highlightIdTagGraphic)),this.textGraphics.forEach(function(e){t._addedGraphicsToMapLayer.push(t.app.map.graphics.add(e))}),this.show()},n.prototype.getMapGraphics=function(){return this._addedGraphicsToMapLayer},n.prototype.addToMeasurementLayer=function(e){void 0===e&&(e=!0),a.prototype.addToLayer.call(this,e)},n.prototype.hide=function(){return a.prototype.hide.call(this),this._addedGraphicsToMapLayer.forEach(function(e){e.hide()}),this},n.prototype.show=function(){return a.prototype.show.call(this),this._addedGraphicsToMapLayer.forEach(function(e){e.show()}),this},n.prototype.assignMeasurementId=function(e){a.prototype.assignGraphicIdentifierKey.call(this,"measurementId",e)},n);function n(){var e=null!==a&&a.apply(this,arguments)||this;return e._addedGraphicsToMapLayer=[],e}t.HighlightedMeasurementLabel=i})},"Mapping/modules/Measurement/MeasurementMarkupManager":function(){define(["require","exports","./Descriptors/GeometryDescriptor","geocortex/framework/observables","geocortex/infrastructure/coordinates/AngleFormat","geocortex/infrastructure/coordinates/AngleDirectionSystem","./MeasurementModule","./Descriptors/LineSegmentDescriptor","geocortex/infrastructure/FormatUtils","geocortex/infrastructure/NumberFormat","./Descriptors/DescriptorBase","geocortex/infrastructure/FeatureSetCollection","geocortex/infrastructure/GraphicsLayerUtils","./MeasurementUtils","geocortex/infrastructure/tools/DrawMode","geocortex/framework/utils/utils"],function(e,t,a,i,n,s,b,o,r,u,S,m,g,d,v,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(p.prototype._subscribeEvents=function(){this.app.event("MarkupEditingStartedEvent").subscribe(this,this._processMarkupEditingStarted),this.app.event("MarkupEditingStoppedEvent").subscribe(this,this._processMarkupEditingStopped),this.app.event("MarkupDeletedEvent").subscribe(this,this._processMarkupDeleted),this.app.event("MarkupClearedEvent").subscribe(this,this.destroyAllDescriptors),this.app.event("_deleteClickableFeatureStarted").subscribe(this,this._handleDeleteClickableFeatureStarted),this.app.event("GraphicRemovedEvent").subscribe(this,this._handleGraphicRemoved)},p.prototype.formatMeasurement=function(e,t){return void 0===t&&(t=2),null==e||"number"!=typeof e?"":r.formatNumber(e,u.NumberFormat.NUMBER,{fractionalDigits:t})},p.prototype.measurementCompleted=function(){var t=this;this.addedMapGraphics.forEach(function(e){e.getMapGraphics().forEach(function(e){t.app.map.graphics.remove(e)})}),this.addedMapGraphics.forEach(function(e){e.addToMeasurementLayer(e.isVisible())})},p.prototype.createDescriptor=function(e,t){var r=null;switch(e){case S.DescriptorType.LINE_SEGMENT:r=new o.LineSegmentDescriptor(t,this.app),this._currentLineSegmentInProcess=r;break;case S.DescriptorType.POLYLINE:case S.DescriptorType.POLYGON:r=new a.GeometryDescriptor(this.geometryIdCounter.toString(),e,t,this.app),this.descriptorContainer.push(r),this.geometryIdCounter++,this._currentGeometryInProcess=r;break;default:this._reportStatus("MeasurementMarkupManager: Invalid Descriptor type","error",!1)}return this.descriptorContainerEmpty.set(!1),r},p.prototype.destroyDescriptor=function(e,t,r){var a=this;void 0===t&&(t=!1),void 0===r&&(r=!0);for(var i=0;i<this.descriptorContainer.length;i++)if(t||this.descriptorContainer[i].id===e){var n=this.descriptorContainer[i];n.setInactive();for(var s=0;s<n._lineSegments.length;s++){var o=n._lineSegments[s];this._removeGraphicFromLayer(o.graphic),this._removeHighlightedLabelFromLayer(o.highlightedLabelGraphic)}if((t||!t&&r)&&this._removeGraphicFromLayer(n.graphic),n.highlightedLabelGraphic&&(this._removeGraphicFromLayer(n.highlightedLabelGraphic.highlightGraphic),n.highlightedLabelGraphic.textGraphics.forEach(function(e){a._removeGraphicFromLayer(e)}),this._removeHighlightedLabelFromLayer(n.highlightedLabelGraphic)),n.measurementData){var u=this.app.featureSetManager.getCollectionById("Measurement");u&&u.featureSets.removeItem(n.measurementData)}if(this._currentGeometryInProcess&&this._currentGeometryInProcess.id===n.id&&(this._currentGeometryInProcess=null),this.app.event("MeasurementMarkupDeleted").publish({graphic:n.graphic,measurementDescriptor:n}),!t){this.descriptorContainer.splice(i,1);break}i===this.descriptorContainer.length-1&&(this.descriptorContainer=[])}0===this.descriptorContainer.length&&this.descriptorContainerEmpty.set(!0)},p.prototype.getGeometryDescriptorById=function(e){for(var t=0,r=this.descriptorContainer;t<r.length;t++){var a=r[t];if(a.id===e)return a}return null},p.prototype.getGeometryDescriptorByGeometry=function(e){for(var t=e,r=0;r<this.descriptorContainer.length;r++)if(t.declaredClass===this.descriptorContainer[r].geometry.declaredClass){var a=this.descriptorContainer[r].geometry;if(t===a)return this.descriptorContainer[r];var i=t.paths?t.paths.length:t.rings?t.rings.length:0;if(i===(a.paths?a.paths.length:a.rings.length))for(var n=0;n<i;n++){var s=t.paths?t.paths[n].length:t.rings[n].length;if(s===(a.paths?a.paths[n].length:a.rings[n].length))for(var o=0;o<s;o++){var u=t.getPoint(n,o),m=a.getPoint(n,o);if(u.x!==m.x||u.y!==m.y)break;if(o===s-1)return this.descriptorContainer[r]}break}}return null},p.prototype.getMeasurementResultsCollection=function(){var e=this.app.featureSetManager.getCollectionById("Measurement");return e||((e=new m.FeatureSetCollection).id="Measurement",e.sourceName="Measurement",e.displayName.set(this.getResource("language-measurement-results-collection-name")),this.app.featureSetManager.addCollection(e)),e},p.prototype.destroyAllDescriptors=function(){this.destroyDescriptor("",!0)},p.prototype.refreshLabels=function(){for(var e=0,t=this.descriptorContainer;e<t.length;e++)t[e].refreshLabelVisibilityAndPosition()},p.prototype.activatePredictiveMeasurements=function(){var t=this;if(this._measurementModule._enablePrediction){var r=!0,a={x:0,y:0};this._predictiveMeasurementToken=this.app.map.on("mouse-move",function(e){if(a.x!==e.mapPoint.x||a.y!==e.mapPoint.y)switch(a.x=e.mapPoint.x,a.y=e.mapPoint.y,r){case!1:t._predictiveMeasurementsGraphic&&t._predictiveMeasurementsGraphic.isVisible()&&t._predictiveMeasurementsGraphic.hide(),t._delayedExecuteToken&&(clearTimeout(t._delayedExecuteToken),t._delayedExecuteToken=null),r=!0;case!0:t._delayedExecuteToken=setTimeout(function(){t._predictiveMeasurementCount++,t._executePredictiveMeasurements(e.mapPoint,t._predictiveMeasurementCount)},1e3),r=!1}})}},p.prototype.deactivatePredictiveMeasurements=function(){this._measurementModule._enablePrediction&&(this._delayedExecuteToken&&(clearTimeout(this._delayedExecuteToken),this._delayedExecuteToken=null),this._predictiveMeasurementToken&&(this._predictiveMeasurementToken.remove(),this._predictiveMeasurementToken=null),this._predictiveMeasurementCount=0,this._predictiveMeasurementsGraphic&&this._predictiveMeasurementsGraphic.hide())},p.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},p.prototype._setLayerIds=function(e,t){this.markupLayerId=e||this.markupLayerId,this.measurementLayerId=t||this.measurementLayerId},p.prototype._setMapTipPresentation=function(e,t,r,a,i,n){this._predictiveMeasurementTextColor=e,this._predictiveMeasurementHighlightColor=t,this._predictiveMeasurementOutlineColor=r,this._predictiveMeasurementOutlineWidth=a,this._predictiveMeasurementHighlightRadius=i,this._predictiveMeasurementTextSize=n},p.prototype._executePredictiveMeasurements=function(s,o){var u=this;if(this._currentGeometryInProcess&&this._currentLineSegmentInProcess&&this._currentLineSegmentInProcess.mapPointStart){if(!this._measurementLayersCreated){var e=g.getInternalGraphicsLayer(this.markupLayerId,this.app,g.GraphicsLayerType.Markup,!0),t=g.getInternalGraphicsLayer(this.measurementLayerId,this.app,g.GraphicsLayerType.Label);e&&t&&(this._measurementLayersCreated=!0)}var a=0,r=0===this._currentGeometryInProcess._lineSegments.length?this._currentLineSegmentInProcess.mapPointStart:this._currentGeometryInProcess._lineSegments[this._currentGeometryInProcess._lineSegments.length-1].mapPointEnd,m="";if(s.x!==r.x||s.y!==r.y)switch(this._currentGeometryInProcess.type){case S.DescriptorType.POLYLINE:var i=new esri.geometry.Polyline(r.spatialReference);i.addPath([r,s]),this._measurementModule._processLineSegment(i,function(e){a=u._currentGeometryInProcess.length?e.length+u._currentGeometryInProcess.length:e.length;var t=b.measurementMarkupManager.formatMeasurement(e.length,u.measurementFractionalDigits),r=b.measurementMarkupManager.formatMeasurement(a,u.measurementFractionalDigits);m=u.getResource("language-measurement-polyline-predictive-markup-label").format(t,u._lengthUnitString,r,u._lengthUnitString),o===u._predictiveMeasurementCount&&(u._predictiveMeasurementsGraphic=d.addHighlightedLabelToMap(m,s,null,u.measurementLayerId,u.app,!0,0,0,"Arial",u._predictiveMeasurementTextSize,u._predictiveMeasurementTextColor,u._predictiveMeasurementHighlightColor,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,u._predictiveMeasurementOutlineColor,u._predictiveMeasurementOutlineWidth),u._predictiveMeasurementHighlightRadius,0,!0),u.app.command("ScreenReaderNarrate").execute(m))});break;case S.DescriptorType.POLYGON:for(var n=new esri.geometry.Polygon(r.spatialReference),l=[],p=0,c=this._currentGeometryInProcess._lineSegments;p<c.length;p++){var h=c[p];l.push(h.mapPointStart),l.push(h.mapPointEnd)}0===l.length&&l.push(r,s),l.push(s),l.push(l[0]),n.addRing(l),this._measurementModule._processPolygon(n,function(n){var e=new esri.geometry.Polyline(r.spatialReference);e.addPath([r,s]),u._measurementModule._processLineSegment(e,function(e){var t=0===n.perimeter?2*e.length:n.perimeter,r=b.measurementMarkupManager.formatMeasurement(e.length,u.measurementFractionalDigits),a=b.measurementMarkupManager.formatMeasurement(n.area,u.measurementFractionalDigits),i=b.measurementMarkupManager.formatMeasurement(t,u.measurementFractionalDigits);m=u.getResource("language-measurement-polygon-predictive-markup-label").format(r,u._lengthUnitString,a,u._areaUnitString,i,u._lengthUnitString),o===u._predictiveMeasurementCount&&(u._predictiveMeasurementsGraphic=d.addHighlightedLabelToMap(m,s,null,u.measurementLayerId,u.app,!0,0,0,"Arial",u._predictiveMeasurementTextSize,u._predictiveMeasurementTextColor,u._predictiveMeasurementHighlightColor,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,u._predictiveMeasurementOutlineColor,u._predictiveMeasurementOutlineWidth),u._predictiveMeasurementHighlightRadius,0,!0),u.app.command("ScreenReaderNarrate").execute(m))})})}}},p.prototype._createMeasurementMarkupFromGeometry=function(e){if(e&&(e instanceof esri.geometry.Polyline||e instanceof esri.geometry.Polygon)){this.app.command("_clearMeasurementMarkup").execute("temporary",!0);var t=this.getGeometryDescriptorByGeometry(e),r=!0;if(!t){var a=null;t=this.createDescriptor(e instanceof esri.geometry.Polyline?S.DescriptorType.POLYLINE:S.DescriptorType.POLYGON,e.spatialReference),a=e instanceof esri.geometry.Polyline?new esri.geometry.Polyline(e.toJson()):new esri.geometry.Polygon(e.toJson()),t.setGeometry(a),r=!1,this.app.command("_addGeometryMarkup").execute(t)}this.narrateGeometryDescriptor(t),this._recreateMeasurementMarkup(t.graphic,r,!1)}else this._reportStatus("CreateMeasurementMarkup: Invalid geometry type. Measurement information can only be generated for Polyline or Polygon geometry types.","error",!1)},p.prototype.narrateGeometryDescriptor=function(e){this.app.command("ScreenReaderNarrate").execute(this.getResource("language-measurement-accessibility-measured").format(e.labelStr))},p.prototype._handleDeleteClickableFeatureStarted=function(e){e&&e.esriFeature&&e.esriFeature.get()&&(this._featureWhichIsBeingDeleted=e.esriFeature.get())},p.prototype._handleGraphicRemoved=function(e){e&&e.graphic&&this._featureWhichIsBeingDeleted===e.graphic&&(this._featureWhichIsBeingDeleted=null)},p.prototype._recreateMeasurementMarkup=function(e,t,r){var n=this;if(void 0===t&&(t=!0),void 0===r&&(r=!0),!this._featureWhichIsBeingDeleted||this._featureWhichIsBeingDeleted!==e){var s=function(e){n.measurementInProgress.set(!1),b.measurementMarkupManager._reportStatus("Error recreating measurement markup: {0}","error",!1,[e])};if(e&&e.geometry&&!k.isNullOrUndefined(e.measurementId)){var a=e.measurementId,i=e.geometry,o=0;if(i.paths?o=i.paths.length:i.rings&&(o=i.rings.length),e&&i instanceof esri.geometry.Polyline||i instanceof esri.geometry.Polygon){var u=i instanceof esri.geometry.Polyline?"MeasureDistance":"MeasureArea",m=i instanceof esri.geometry.Polyline?S.DescriptorType.POLYLINE:S.DescriptorType.POLYGON,l=this.getGeometryDescriptorById(a);if(!l||l&&t){var p=null;l&&(p=l.originalZoomLevel,this.destroyDescriptor(a,!1,r)),(l=this.createDescriptor(m,i.spatialReference)).originalZoomLevel=null===p?l.originalZoomLevel:p,l.drawMode="polyline"===i.type?v.DrawMode.POLYLINE:v.DrawMode.POLYGON,e.measurementId=l.id}l.setGeometry(i),l.graphic=e;for(var c=[],h=[],g=0;g<o;g++)for(var d=i instanceof esri.geometry.Polyline?i.paths[g].length:i.rings[g].length,M=1;M<d;M++){var y=i.getPoint(g,M-1),_=i.getPoint(g,M);if(y&&_){var f=this.createDescriptor(S.DescriptorType.LINE_SEGMENT,i.spatialReference);f.id=l.id,f.setStartPt(y),f.setEndPt(_),f.mapPointStart.x===f.mapPointEnd.x&&f.mapPointStart.y===f.mapPointEnd.y||(c.push(f),h.push(f.geometry))}}this.measurementInProgress.set(!0),this._measurementModule._processLineSegment(h,function(e){for(var r=e.serverResponse.lengths.length,a=e.serverResponse.lengths,t=function(t){c[t].setMeasurementUnit(n._lengthUnit),c[t].length=a[t],n.app.command("_addLineSegmentMeasurementMarkup").execute(c[t],function(e){e.isActive=l.isActive,l.addSegment(e),t===r-1&&function(e,t){n.app.command(t).execute(e,function(){n.measurementInProgress.set(!1),e.refreshMeasurementData(),n._reportStatus("Successfully computed measurement information for specified geometry/graphic.","info",!1)},s)}(l,u)},s)},i=0;i<r;i++)t(i)},s)}else this._reportStatus("Could not recreate measurement markup. Incompatible geometry. Only Polyline and Polygon geometry are supported.","warning",!1)}}},p.prototype._hideMeasurementMarkup=function(e,t){var r=this;if(void 0===t&&(t=!1),!0!==this.measurementInProgress.get()){this._measurementInProgressToken&&(this.measurementInProgress.unbind(this._measurementInProgressToken),this._measurementInProgressToken=null);for(var a=0,i=this.descriptorContainer;a<i.length;a++){var n=i[a];if(n.id===e.measurementId){for(var s=0;s<n._lineSegments.length;s++){var o=n._lineSegments[s];o.graphic&&o.graphic.hide(),o.highlightedLabelGraphic&&o.highlightedLabelGraphic.hide()}t&&n.graphic&&n.graphic.hide(),n.highlightedLabelGraphic&&n.highlightedLabelGraphic.hide();break}}}else{var u=e,m=t;this._measurementInProgressToken=this.measurementInProgress.bind(this,function(){r._hideMeasurementMarkup(u,m)})}},p.prototype._updateMeasurementUnits=function(e,t){for(var r=0,a=this.descriptorContainer;r<a.length;r++)a[r].setMeasurementUnit(e,t);this._lengthUnit=e,this._areaUnit=t,this._lengthUnitString=d.getUnitString(e),this._areaUnitString=d.getUnitString(t)},p.prototype._removeGraphicFromLayer=function(e){if(e){var t=e.getLayer();t&&t.remove(e)}},p.prototype._removeHighlightedLabelFromLayer=function(e){var t=this;e.textGraphics.forEach(function(e){t._removeGraphicFromLayer(e)}),this._removeGraphicFromLayer(e.highlightGraphic);var r=this.addedMapGraphics.indexOf(e);-1!==r&&this.addedMapGraphics.splice(r,1)},p.prototype._canExecuteMarkupIntegration=function(e){return!(!e||k.isNullOrUndefined(e.measurementId))},p.prototype._processMarkupEditingStarted=function(e){if(this._canExecuteMarkupIntegration(e)){var t=this.getGeometryDescriptorById(e.measurementId);t&&(this._hideMeasurementMarkup(e),t.editingInProgress=!0)}},p.prototype._processMarkupEditingStopped=function(e){if(this._canExecuteMarkupIntegration(e)){var t=this.getGeometryDescriptorById(e.measurementId);t&&(this._recreateMeasurementMarkup(e,!0,!1),t.editingInProgress=!1)}},p.prototype._processMarkupDeleted=function(e){this._canExecuteMarkupIntegration(e)&&this.destroyDescriptor(e.measurementId)},p.prototype._getUnitLanguageResources=function(){for(var e in this.unit)this.unit.hasOwnProperty(e)&&(this.unit[e]={shortName:this.getResource("language-measurement-unit-"+e.toLowerCase()+"-short"),longName:this.getResource("language-measurement-unit-"+e.toLowerCase()),config:e})},p.prototype._reportStatus=function(e,t,r,a){var i=this;void 0===r&&(r=!1),void 0===a&&(a=null);var n="language-measurement-"===e.substring(0,21)?this.getResource(e):e;function s(){r&&i.app.command("ClearActiveTool").execute()}switch(a&&(n=n.format.apply(n,a)),t.toLowerCase()){case"alert":return void this.app.command("Alert").execute(n,this.getResource("language-measurement-alert-title"),function(){s()});case"info":this.app.trace.info(n);break;case"warning":this.app.trace.warning(n);break;case"error":this.app.trace.error(n)}s()},p);function p(e,t,r){var a=this;this.GCX_UNIT_YARDS=12345,this.GCX_UNIT_SQ_NAUTICAL_MILES="gcXSqNauticalMileConstant",this.geometryIdCounter=1,this.descriptorContainer=[],this.markupLayerId=null,this.measurementLayerId=null,this.unit={feet:null,yard:null,meter:null,kilometer:null,mile:null,nauticalMile:null,sqFeet:null,sqYard:null,sqMeter:null,sqKilometer:null,sqMile:null,sqNauticalMile:null,acre:null,hectare:null},this.measurementResultTypes=[],this.coordinateFractionalDigits=4,this.measurementFractionalDigits=2,this.degreeFormat=n.DD,this.angleDirectionSystem=s.POLAR,this.addedMapGraphics=[],this._zoomEndToken=null,this._predictiveMeasurementToken=null,this._delayedExecuteToken=null,this._measurementInProgressToken=null,this._predictiveMeasurementsGraphic=null,this._measurementModule=null,this._predictiveMeasurementCount=null,this._lengthUnit=null,this._areaUnit=null,this._lengthUnitString=null,this._areaUnitString=null,this._currentLineSegmentInProcess=null,this._currentGeometryInProcess=null,this._measurementLayersCreated=null,this._toolActive=!1,this._predictiveMeasurementTextColor=null,this._predictiveMeasurementHighlightColor=null,this._predictiveMeasurementOutlineColor=null,this._predictiveMeasurementOutlineWidth=null,this._predictiveMeasurementHighlightRadius=null,this._predictiveMeasurementTextSize=null,this._featureWhichIsBeingDeleted=null,this.app=t,this.libraryId=r,this._measurementModule=e,this._predictiveMeasurementCount=0,this._measurementLayersCreated=!1,this.measurementInProgress=new i.Observable(!1),this.descriptorContainerEmpty=new i.Observable(!0),this._getUnitLanguageResources(),this._subscribeEvents(),this.descriptorContainerEmpty.bind(this,function(e){e&&a._zoomEndToken?(a._zoomEndToken.remove(),a._zoomEndToken=null,a.app.command("ClearMarkup").raiseCanExecuteChanged()):e||a._zoomEndToken||(a._zoomEndToken=a.app.map.on("zoom-end",dojo.hitch(a,a.refreshLabels)))})}t.MeasurementMarkupManager=l})},"Mapping/modules/Measurement/MeasurementModule":function(){var a,M=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","./MeasurementMarkupManager","geocortex/framework/application/ModuleBase","geocortex/infrastructure/validation/NumberValidator","./MeasurementUtils","./Descriptors/GeometryDescriptor","geocortex/infrastructure/Feature","geocortex/infrastructure/GeometryUtils","./Descriptors/LineSegmentDescriptor","./Descriptors/DescriptorBase","geocortex/essentials/GeometryUtilities","geocortex/framework/utils/utils"],function(e,m,a,t,i,l,o,n,p,s,u,c,r){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var h,g=(h=t.ModuleBase,M(d,h),d.prototype.initialize=function(e){this._registerCommands(),this._measurementWkid=e&&e.measurementProjectionWkid&&""!==e.measurementProjectionWkid?parseInt(e.measurementProjectionWkid,10):-1;var t=-1===this._measurementWkid?"geodesic":"planar";this._calculationType=e&&e.calculationType&&("planar"===e.calculationType||"geodesic"===e.calculationType||"preserveShape"===e.calculationType)?e.calculationType:t,this._enablePrediction=!(e&&!r.isNullOrUndefined(e.enablePrediction))||e.enablePrediction,this._measurementLengthUnits=l.getGeometryServiceUnitConstant(e.measurementLengthUnits||"feet"),this._measurementAreaUnits=l.getGeometryServiceUnitConstant(e.measurementAreaUnits||"squarefeet"),this._segmentWarningThreshold=r.isNullOrUndefined(e.numSegmentsWarningThreshold)?1e3:parseInt(e.numSegmentsWarningThreshold,10),e&&e.tools&&this.app&&this.app.toolRegistry&&this.app.toolRegistry.createTools(e.tools,!0),m.measurementMarkupManager._updateMeasurementUnits(this._measurementLengthUnits,this._measurementAreaUnits),e&&e.measurementResultTypes&&(m.measurementMarkupManager.measurementResultTypes=e.measurementResultTypes),e&&e.coordinateFractionalDigits&&(m.measurementMarkupManager.coordinateFractionalDigits=e.coordinateFractionalDigits),e&&e.measurementFractionalDigits&&(m.measurementMarkupManager.measurementFractionalDigits=e.measurementFractionalDigits),e&&e.degreeFormat&&(m.measurementMarkupManager.degreeFormat=e.degreeFormat.toLowerCase()),e&&e.angleDirectionSystem&&(m.measurementMarkupManager.angleDirectionSystem=e.angleDirectionSystem.toLowerCase()),-1!==this._measurementWkid&&(this._measurementSpatialReference=new esri.SpatialReference(this._measurementWkid)),this.app.map&&this.app.map.loaded?this._onMapLoaded():this.app.event("MapLoadedEvent").subscribe(this,this._onMapLoaded)},d.prototype.getStateFilter=function(){return{lengthUnit:!0,areaUnit:!0,measurements:{item:this._getMeasurementShapeFilter()}}},d.prototype.exportState=function(){return Promise.try(function(){return{lengthUnit:m.measurementMarkupManager._lengthUnit,areaUnit:m.measurementMarkupManager._areaUnit,measurements:m.measurementMarkupManager.descriptorContainer.map(function(e){return e.exportState()})}})},d.prototype.applyState=function(e){var a=this;return Promise.try(function(){m.measurementMarkupManager._lengthUnit=e.lengthUnit,m.measurementMarkupManager._lengthUnitString=l.getUnitString(e.lengthUnit),m.measurementMarkupManager._areaUnit=e.areaUnit,m.measurementMarkupManager._areaUnitString=l.getUnitString(e.areaUnit),a._measurementLengthUnits=e.lengthUnit,a._measurementAreaUnits=e.areaUnit,a.app.command("_applyMeasurementUnits").execute(e.lengthUnit,e.areaUnit)}).then(function(){return a.app.waitUntilMapLoaded()}).then(function(){return Promise.map(e.measurements,function(e){var t=a.app.project.convert.toEsriSpatialReference(e.spatialReference),r=new o.GeometryDescriptor(e.id,e.type,t,a.app);return r.applyState(e),r})}).then(function(e){m.measurementMarkupManager.descriptorContainer=e,m.measurementMarkupManager.descriptorContainerEmpty.set(0===e.length)}).return()},d.prototype._getHighlightedLabelFilter=function(){return{highlightGraphic:this.app.project.filter.graphic,highlightSymbol:this.app.project.filter.simpleMarkerSymbol,textGraphics:{item:this.app.project.filter.graphic},textSymbols:{item:this.app.project.filter.textSymbol},layerId:!0,mapPoint:this.app.project.filter.point,text:!0,labelXoffset:this._numberValidator,labelYoffset:this._numberValidator,fontFamily:!0,fontSize:!0,cornerRadius:this._numberValidator,angle:this._numberValidator,anchor:!0,textColor:this.app.project.filter.color,highlightColor:this.app.project.filter.color,highlightOutlineSymbol:this.app.project.filter.simpleLineSymbol}},d.prototype._getDescriptorFilter=function(){return{id:!0,geometry:this.app.project.filter.geometry,length:this._numberValidator,type:this._numberValidator,spatialReference:this.app.project.filter.spatialReference,graphic:this.app.project.filter.graphic,feature:this.app.project.filter.feature,label:this._getHighlightedLabelFilter()}},d.prototype._getMeasurementSegmentFilter=function(){return $.extend({},this._getDescriptorFilter(),{startPoint:this.app.project.filter.point,endPoint:this.app.project.filter.point})},d.prototype._getMeasurementShapeFilter=function(){return $.extend({},this._getDescriptorFilter(),{segments:{item:this._getMeasurementSegmentFilter()},area:this._numberValidator,simplifiedGeometry:this.app.project.filter.geometry,originalZoomLevel:this._numberValidator,drawMode:!0,measurementData:this.app.project.filter.featureSet})},d.prototype._onMapLoaded=function(){this._currentSpatialReference=this.app.map.spatialReference,this._measurementSpatialReference||(this._measurementSpatialReference=this._currentSpatialReference)},d.prototype._registerCommands=function(){this.app.command("MeasureDistance").register(this,this._executeMeasurementCommand,this._canExecuteMeasureDistance),this.app.command("MeasureArea").register(this,this._executeMeasurementCommand,this._canExecuteMeasureArea),this.app.command("SetMeasurementUnits").register(this,this._setMeasurementUnits),this.app.event("GeometryChangedEvent").subscribe(this,this.handleGraphicEdited)},d.prototype.handleGraphicEdited=function(e){var t=e.graphic;t&&t.hasOwnProperty("measurementId")&&("polygon"===t.geometry.type?this._reCalculatePolygonDimensions(t):"polyline"===t.geometry.type&&this._reCalculatePolylineDimensions(t))},d.prototype._canExecuteMeasureArea=function(e){if(e instanceof n.Feature&&e.featureSet&&e.featureSet.isMeasurement)return!1;var t=this._retrieveGeometry(e),r=p.getGeometryService(this.app),a=e instanceof s.LineSegmentDescriptor;return!!t&&!!(t&&r&&(a||t instanceof esri.geometry.Polygon))},d.prototype._canExecuteMeasureDistance=function(e){if(e instanceof n.Feature&&e.featureSet&&e.featureSet.isMeasurement)return!1;var t=this._retrieveGeometry(e),r=p.getGeometryService(this.app),a=e instanceof s.LineSegmentDescriptor;return!!t&&!!(t&&r&&(a||t instanceof esri.geometry.Polyline))},d.prototype._executeMeasurementCommand=function(e,t,r){function a(e){i.app.command("ClearDefaultHighlights").execute(),m.measurementMarkupManager._createMeasurementMarkupFromGeometry(e)}var i=this;if(e instanceof u.DescriptorBase)this._executeMeasurement(e,t,r);else{var n=this._retrieveGeometry(e);if(n){var s=function(e){for(var t=0,r=0,a=e.hasOwnProperty("rings")?e.rings:e.paths;r<a.length;r++)t+=a[r].length-1;return t}(n);s>this._segmentWarningThreshold?this.app.command("Confirm").execute(this.app.getResource(this.libraryId,"language-measurement-high-line-segments-warning").format(s),null,function(e){e&&a(n)}):a(n)}}},d.prototype._retrieveGeometry=function(e){var t=null;if(e)if(e instanceof u.DescriptorBase||e instanceof esri.Graphic)t=e.geometry;else if(e instanceof esri.geometry.Geometry)t=e;else if(e instanceof n.Feature&&e.esriFeature){var r=e.esriFeature.get();r&&(t=r.geometry)}return t},d.prototype._executeMeasurement=function(e,r,a){var i=this;switch(m.measurementMarkupManager.measurementInProgress.get()||m.measurementMarkupManager.measurementInProgress.set(!0),e.type){case u.DescriptorType.LINE_SEGMENT:this._processLineSegment(e,function(e){var t=m.measurementMarkupManager.getGeometryDescriptorById(e.id);e.isActive=!!t&&t.isActive,i.app.command("_addLineSegmentMeasurementMarkup").execute(e,r,function(e){i._tryErrorCallback(a,e)})},function(e){i._tryErrorCallback(a,e)});break;case u.DescriptorType.POLYLINE:this.app.command("_addCompletedGeometryMeasurementMarkup").execute(e,r,function(e){i._tryErrorCallback(a,e)});break;case u.DescriptorType.POLYGON:this._processPolygon(e,function(e){i.app.command("_addCompletedGeometryMeasurementMarkup").execute(e,r,a)},function(e){i._tryErrorCallback(a,e)});break;default:this._tryErrorCallback(a,new Error("Invalid Descriptor Type"))}},d.prototype._processLineSegment=function(r,a,t){var i=this,e=r instanceof s.LineSegmentDescriptor?r.geometry:r;e=e instanceof Array?e:[e],this._tryProject(e,this._measurementSpatialReference,function(e){i._measurePolylineLengths(e,i._measurementLengthUnits,function(e){var t={length:e.lengths[0],serverResponse:e};r instanceof s.LineSegmentDescriptor?(r.setMeasurementUnit(i._measurementLengthUnits),r.length=t.length,a(r)):a(t)},function(e){i._tryErrorCallback(t,e)})},function(e){i._projectionError(e),i._tryErrorCallback(t,e)})},d.prototype._reCalculatePolylineDimensions=function(e){function t(e){var t="Error calculating measurement markup: {0}";r.app.trace.error(t.format.apply(t,[e])),a.attributes&&(a.attributes.Length=r.getResource("language-measurement-value-not-available"),r._raiseGraphicAttributesChangedEvent(a))}var r=this,a=e,i=[e.geometry];this._tryProject(i,this._measurementSpatialReference,function(e){r._measurePolylineLengths(e,r._measurementLengthUnits,function(e){!function(e){r.app.trace.info("Successfully computed measurement information for specified geometry/ graphic."),a.attributes&&(a.attributes.Length=e,r._raiseGraphicAttributesChangedEvent(a))}(e.lengths[0])},function(e){r._tryErrorCallback(t,e)})},function(e){r._projectionError(e),r._tryErrorCallback(t,e)})},d.prototype._reCalculatePolygonDimensions=function(e){function t(e){var t="Error calculating measurement markup: {0}";r.app.trace.error(t.format.apply(t,[e])),a.attributes&&(a.attributes.Area=r.getResource("language-measurement-value-not-available"),a.attributes.Length=r.getResource("language-measurement-value-not-available"),r._raiseGraphicAttributesChangedEvent(a))}var r=this,a=e,i=p.getGeometryService(this.app),n=[e.geometry];i.simplify(n,function(e){r._tryProject(e,r._measurementSpatialReference,function(e){r._measurePolygonAreaAndPerimeter(e,r._measurementLengthUnits,r._measurementAreaUnits,function(e){var t={area:e.areas[0],perimeter:e.lengths[0],serverResponse:e};!function(e,t){r.app.trace.info("Successfully computed measurement information for specified geometry/ graphic."),a.attributes&&(a.attributes.Area=e,a.attributes.Length=t,r._raiseGraphicAttributesChangedEvent(a))}(t.area,t.perimeter)},function(e){r._tryErrorCallback(t,e)})},function(e){r._projectionError(e),r._tryErrorCallback(t,e)})},function(e){r._tryErrorCallback(t,e)})},d.prototype._raiseGraphicAttributesChangedEvent=function(e){var t={graphic:e};this.app.event("GraphicAttributesChangedEvent").publish(t)},d.prototype._processPolygon=function(a,i,t){function n(e,t){a.area=e,a.simplifiedGeometry=t,a.unit||a.setMeasurementUnit(s._measurementLengthUnits,s._measurementAreaUnits),i(a)}var s=this;if(a instanceof o.GeometryDescriptor&&2===a._lineSegments.length)n(0,null);else{var e=a instanceof o.GeometryDescriptor?a.geometry:a;e=e instanceof Array?e:[e],p.getGeometryService(this.app).simplify(e,function(r){s._tryProject(r,s._measurementSpatialReference,function(e){s._measurePolygonAreaAndPerimeter(e,s._measurementLengthUnits,s._measurementAreaUnits,function(e){var t={area:e.areas[0],perimeter:e.lengths[0],serverResponse:e};a instanceof o.GeometryDescriptor?n(t.area,r[0]):i(t)},function(e){s._tryErrorCallback(t,e)})},function(e){s._projectionError(e),s._tryErrorCallback(t,e)})},function(e){s._tryErrorCallback(t,e)})}},d.prototype._tryProject=function(e,t,r,a){var i=this;if(c.spatialRefsAreEqual(this._currentSpatialReference,t,!1))r(e);else{var n=new esri.tasks.ProjectParameters;n.geometries=e,n.outSR=t,this._calculationType="planar",p.project(n,r,function(e){i._tryErrorCallback(a,e)},this.app)}},d.prototype._measurePolylineLengths=function(e,t,r,a){var i=this,n=!1;t===m.measurementMarkupManager.GCX_UNIT_YARDS&&(t=esri.tasks.GeometryService.UNIT_FOOT,n=!0);var s=new esri.tasks.LengthsParameters;s.calculationType=this._calculationType,"preserveShape"!==this._calculationType&&(s.geodesic="planar"!==this._calculationType),s.lengthUnit=t,s.polylines=e,p.getGeometryService(this.app).lengths(s,function(e){if(n)for(var t=0;t<e.lengths.length;t++)e.lengths[t]=l.convertLength(e.lengths[t],esri.tasks.GeometryService.UNIT_FOOT,m.measurementMarkupManager.GCX_UNIT_YARDS);r(e)},function(e){i._tryErrorCallback(a,e)})},d.prototype._measurePolygonAreaAndPerimeter=function(e,t,r,a,i){var n=this,s=!1;t===m.measurementMarkupManager.GCX_UNIT_YARDS&&(t=esri.tasks.GeometryService.UNIT_FOOT,s=!0);var o=!1;r===m.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES&&(r=esri.tasks.GeometryService.UNIT_SQUARE_MILES,o=!0);var u=new esri.tasks.AreasAndLengthsParameters;u.lengthUnit=t,u.areaUnit=r,u.calculationType=this._calculationType,u.polygons=e,p.getGeometryService(this.app).areasAndLengths(u,function(e){if(s)for(var t=0;t<e.lengths.length;t++)e.lengths[t]=l.convertLength(e.lengths[t],esri.tasks.GeometryService.UNIT_FOOT,m.measurementMarkupManager.GCX_UNIT_YARDS);if(o)for(var r=0;r<e.areas.length;r++)e.areas[r]=l.convertArea(e.areas[r],esri.tasks.GeometryService.UNIT_SQUARE_MILES,m.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES);a(e)},function(e){n._tryErrorCallback(i,e)})},d.prototype._setMeasurementUnits=function(e,t){this._measurementLengthUnits=l.getGeometryServiceUnitConstant(e),this._measurementAreaUnits=l.getGeometryServiceUnitConstant(t),m.measurementMarkupManager._updateMeasurementUnits(this._measurementLengthUnits,this._measurementAreaUnits)},d.prototype._projectionError=function(e){m.measurementMarkupManager._reportStatus("language-measurement-projection-error","alert",!0,[this._measurementWkid,e])},d.prototype._tryErrorCallback=function(e,t){e&&e(t)},d);function d(e,t){var r=h.call(this,e,t)||this;return r._measurementWkid=-1,r._measurementSpatialReference=null,r._currentSpatialReference=null,r._numberValidator=new i.NumberValidator,m.measurementMarkupManager=new a.MeasurementMarkupManager(r,e,t),r.app.toolRegistry.registerToolTypeForCommand("MeasureArea","geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementTool"),r.app.toolRegistry.registerToolTypeForCommand("MeasureDistance","geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementTool"),r}m.MeasurementModule=g})},"Mapping/modules/Measurement/MeasurementOperation":function(){define(["require","exports","geocortex/framework/observables","./MeasurementModule","./Descriptors/DescriptorBase"],function(e,t,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(n.prototype.setStartPt=function(e){var r=this;this._tool.app.command("_clearMeasurementMarkup").execute("temporary",!0),function(e){r._currentGeometry="POLYLINE"===r._tool.drawMode?o.measurementMarkupManager.createDescriptor(a.DescriptorType.POLYLINE,e.mapPoint.spatialReference):o.measurementMarkupManager.createDescriptor(a.DescriptorType.POLYGON,e.mapPoint.spatialReference),r._currentLineSegment=o.measurementMarkupManager.createDescriptor(a.DescriptorType.LINE_SEGMENT,e.mapPoint.spatialReference),r._currentLineSegment.id=r._currentGeometry.id;var t=e.snappingPoint?e.snappingPoint:e.mapPoint;r._currentLineSegment.setStartPt(t),o.measurementMarkupManager.activatePredictiveMeasurements(),r.pointIndex=1}(e)},n.prototype.setEndPt=function(e){var t=this;if(this._currentLineSegment.mapPointStart.x!==e.mapPoint.x||this._currentLineSegment.mapPointStart.y!==e.mapPoint.y){if(this._prevSegEndPt){if(this._prevSegEndPt.x===e.mapPoint.x&&this._prevSegEndPt.y===e.mapPoint.y)return;this._currentLineSegment=o.measurementMarkupManager.createDescriptor(a.DescriptorType.LINE_SEGMENT,this._prevSegEndPt.spatialReference),this._currentLineSegment.id=this._currentGeometry.id,this._currentLineSegment.setStartPt(this._prevSegEndPt),this._prevSegEndPt=null}var r=e.snappingPoint?e.snappingPoint:e.mapPoint;this._currentLineSegment.setEndPt(r),this._prevSegEndPt=this._currentLineSegment.mapPointEnd,this._totalSegmentCount++,this._tool.executeToolCommand(this._currentLineSegment,function(e){t._currentGeometry.addSegment(e),t._lineSegmentCommandCallbackCompleted.set(t._lineSegmentCommandCallbackCompleted.get()+1)})}},n.prototype.plotPoint=function(e){0===this.pointIndex?this.setStartPt(e):this.setEndPt(e)},n.prototype.executeDrawEnd=function(t){var r=this;if(o.measurementMarkupManager.deactivatePredictiveMeasurements(),0===this._totalSegmentCount)return o.measurementMarkupManager._reportStatus("No geometry drawn. Cannot compute measurements","info",!1),void o.measurementMarkupManager.destroyDescriptor(this._currentGeometry.id);function a(){o.measurementMarkupManager.measurementInProgress.get()&&o.measurementMarkupManager.measurementInProgress.set(!1)}function i(){r._tool.isSticky||r._tool.setActive(!1)}function n(e){r._tool.onDrawCompleted(e,r._currentGeometry,function(e){a(),i(),e.refreshMeasurementData()},function(e){a(),i(),r._tool._onDrawCompletedError(e)})}if(this._drawEndInvoked=!0,this._currentGeometry.setGeometry(t),this._tool.app.command("_addGeometryMarkup").execute(this._currentGeometry),this._lineSegmentCommandCallbackCompleted.get()===this._totalSegmentCount)n(t);else var s=this._lineSegmentCommandCallbackCompleted.bind(this,function(e){e===r._totalSegmentCount&&(r._lineSegmentCommandCallbackCompleted.unbind(s),n(t))})},n);function n(e){this.pointIndex=0,this._currentGeometry=null,this._currentLineSegment=null,this._prevSegEndPt=null,this._tool=null,this._tool=e,this._lineSegmentCommandCallbackCompleted=new r.Observable(0),this._drawEndInvoked=!1,this._totalSegmentCount=0}t.MeasurementOperation=i})},"Mapping/modules/Measurement/MeasurementState":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/Measurement/MeasurementTool":function(){var a,m=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/infrastructure/tools/MapTool","./MeasurementModule","geocortex/infrastructure/tools/DrawMode","./MeasurementOperation","geocortex/infrastructure/accessibility/Draw","./Descriptors/DescriptorBase"],function(e,t,r,c,a,i,n,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=(s=r.MapTool,m(u,s),u.prototype.onActivated=function(){var t=this;if(this.drawMode!==a.DrawMode.POLYLINE&&this.drawMode!==a.DrawMode.POLYGON)return s.prototype.onActivated.call(this);if(!this._drawObject){this._drawObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.draw",this.app.map,{enableEditing:!1}),this._drawObject.setFillSymbol(new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.25]))),this._drawObject.setLineSymbol(new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2)),this._drawObject.setRespectDrawingVertexOrder(!0);var r=null;this.clickHandlerToken&&this.drawEndHandlerToken||(this.clickHandlerToken=this.app.event("GraphicVertexAddedEvent").subscribe(this,function(e){e&&e.sender===t._drawObject&&function(e){r&&!r._drawEndInvoked||(r=new i.MeasurementOperation(t)),r.plotPoint(e)}(e)}),this.drawEndHandlerToken=dojo.aspect.after(this._drawObject,"onDrawComplete",function(e){r.executeDrawEnd(e.geometry),r=null},!0)),this.keyDownHandlerToken||(this.keyDownHandlerToken=this.app.map.on("key-down",function(e){27!==e.which&&27!==e.keyCode||(t.isSticky?(t.onDeactivated(),t.onActivated()):t.setActive(!1))})),this._drawObject instanceof n.Draw&&!this._inputMethodChangeHandle&&(this._inputMethodChangeHandle=dojo.aspect.after(this._drawObject,"onInputMethodChange",dojo.hitch(this,"onInputMethodChange"),!0))}return this._drawIsActive&&(this._drawObject.deactivate(),this._drawIsActive=!1),this.app.map.graphics?(this.mapMouseHoverToken=this.app.event("MapMouseHoverEvent").subscribe(this,this.onMapMouseHover),this._drawObject.activate(esri.toolbars.Draw[this.drawMode]),this._drawIsActive=!0,c.measurementMarkupManager._toolActive=!0):(setTimeout(function(){c.measurementMarkupManager._reportStatus("language-measurement-null-graphics-error","alert",!0)}),!1)},u.prototype.onDeactivated=function(){s.prototype.onDeactivated.call(this),this.clickHandlerToken&&(this.app.event("GraphicVertexAddedEvent").unsubscribe(this.clickHandlerToken),this.clickHandlerToken=null),this.drawEndHandlerToken&&(this.drawEndHandlerToken.remove(),this.drawEndHandlerToken=null),this.keyDownHandlerToken&&(this.keyDownHandlerToken.remove(),this.keyDownHandlerToken=null),this._inputMethodChangeHandle&&(this._inputMethodChangeHandle.remove(),this._inputMethodChangeHandle=null),this.mapMouseHoverToken&&(this.app.event("MapMouseHoverEvent").unsubscribe(this.mapMouseHoverToken),this.mapMouseHoverToken=null),c.measurementMarkupManager.deactivatePredictiveMeasurements(),c.measurementMarkupManager.measurementInProgress.get()&&c.measurementMarkupManager.measurementInProgress.set(!1),this.isSticky?this.app.command("_clearMeasurementMarkup").execute("temporary",!0):c.measurementMarkupManager._currentGeometryInProcess&&!c.measurementMarkupManager._currentGeometryInProcess.graphic&&c.measurementMarkupManager.destroyDescriptor(c.measurementMarkupManager._currentGeometryInProcess.id),this._drawObject&&delete this._drawObject,c.measurementMarkupManager._toolActive=!1},u.prototype.executeToolCommand=function(e,t,r){if(this.command){var a=this.app.command(this.command);a.canExecute(e)?a.execute(e,function(e){t&&t(e)},function(e){c.measurementMarkupManager._reportStatus("Execute Tool Command Error - Measurement Tools: {0}","error",!1,[e]),r&&r(e)}):c.measurementMarkupManager._reportStatus("Could not invoke command '{0}' for tool '{1}'.","error",!0,[this.name,this.command])}},u.prototype._onDrawCompletedError=function(e){c.measurementMarkupManager._reportStatus("Measurement Tool - Error on Draw Complete: {0}","error",!0,[e])},u.prototype.onDrawCompleted=function(e,t,r,a){function i(e){r&&r(e)}function n(e,t){a&&a(t?new Error(t):e)}var s=this,o="Measurement Tools: onDrawCompleted - Descriptor type mismatch";if(e instanceof esri.geometry.Polygon)if(t.type===h.DescriptorType.POLYGON){var u=t._lineSegments,m=u[u.length-1].mapPointEnd,l=u[0].mapPointStart;if(m.x!==l.x||m.y!==l.y){var p=c.measurementMarkupManager.createDescriptor(h.DescriptorType.LINE_SEGMENT,e.spatialReference);p.id=t.id,p.setStartPt(m),p.setEndPt(l),this.executeToolCommand(p,function(e){t.addSegment(e),s.executeToolCommand(t,i,n)},n)}else this.executeToolCommand(t,i,n)}else n(null,o);else e instanceof esri.geometry.Polyline?t.type===h.DescriptorType.POLYLINE?this.executeToolCommand(t,i,n):n(null,o):n(null,"Only Polygon and Polyline geometries supported")},u);function u(e,t){var r=s.call(this,e,t)||this;return r.clickHandlerToken=null,r.drawEndHandlerToken=null,r.keyDownHandlerToken=null,r.mapMouseHoverToken=null,r._toolSuspended=!1,r.app.command("_suspendMeasurementToolIfActive").register(r,function(){c.measurementMarkupManager._toolActive?r._drawIsActive&&r._drawObject&&(r._toolSuspended=!0,r._drawObject.deactivate()):r.app.command("ClearActiveTool").execute()}),r.app.command("_resumeMeasurementToolIfSuspended").register(r,function(){r._toolSuspended&&r._drawObject&&(r._toolSuspended=!1,r._drawObject.activate(esri.toolbars.Draw[r.drawMode]))}),r}t.MeasurementTool=o})},"Mapping/modules/Measurement/MeasurementUtils":function(){define(["require","exports","./HighlightedMeasurementLabel","./MeasurementModule","geocortex/essentials/DistanceUnit","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic"],function(e,t,f,b,a,i,n,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=null,d=null,M={},r=/\r\n|\r|\n/g;function y(e){return e.split(r)}function k(e){return(r.test(e)?e.match(r).length:0)+1}t.getUnitString=function(e,t){void 0===t&&(t=!1);var r="";if(!e)return r;switch(e){case esri.Units.FEET:case esri.tasks.GeometryService.UNIT_FOOT:case b.measurementMarkupManager.unit.feet.shortName:case b.measurementMarkupManager.unit.feet.longName:case b.measurementMarkupManager.unit.feet.config:r=t?b.measurementMarkupManager.unit.feet.longName:b.measurementMarkupManager.unit.feet.shortName;break;case esri.Units.YARDS:case b.measurementMarkupManager.GCX_UNIT_YARDS:case b.measurementMarkupManager.unit.yard.shortName:case b.measurementMarkupManager.unit.yard.longName:case b.measurementMarkupManager.unit.yard.config:r=t?b.measurementMarkupManager.unit.yard.longName:b.measurementMarkupManager.unit.yard.shortName;break;case esri.Units.METERS:case esri.tasks.GeometryService.UNIT_METER:case b.measurementMarkupManager.unit.meter.shortName:case b.measurementMarkupManager.unit.meter.longName:case b.measurementMarkupManager.unit.meter.config:r=t?b.measurementMarkupManager.unit.meter.longName:b.measurementMarkupManager.unit.meter.shortName;break;case esri.Units.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER:case b.measurementMarkupManager.unit.kilometer.shortName:case b.measurementMarkupManager.unit.kilometer.longName:case b.measurementMarkupManager.unit.kilometer.config:r=t?b.measurementMarkupManager.unit.kilometer.longName:b.measurementMarkupManager.unit.kilometer.shortName;break;case esri.Units.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE:case b.measurementMarkupManager.unit.mile.shortName:case b.measurementMarkupManager.unit.mile.longName:case b.measurementMarkupManager.unit.mile.config:r=t?b.measurementMarkupManager.unit.mile.longName:b.measurementMarkupManager.unit.mile.shortName;break;case esri.Units.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:case b.measurementMarkupManager.unit.nauticalMile.shortName:case b.measurementMarkupManager.unit.nauticalMile.longName:case b.measurementMarkupManager.unit.nauticalMile.config:r=t?b.measurementMarkupManager.unit.nauticalMile.longName:b.measurementMarkupManager.unit.nauticalMile.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_FEET:case esri.Units.SQUARE_FEET:case b.measurementMarkupManager.unit.sqFeet.shortName:case b.measurementMarkupManager.unit.sqFeet.longName:case b.measurementMarkupManager.unit.sqFeet.config:r=t?b.measurementMarkupManager.unit.sqFeet.longName:b.measurementMarkupManager.unit.sqFeet.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_METERS:case esri.Units.SQUARE_METERS:case b.measurementMarkupManager.unit.sqMeter.shortName:case b.measurementMarkupManager.unit.sqMeter.longName:case b.measurementMarkupManager.unit.sqMeter.config:r=t?b.measurementMarkupManager.unit.sqMeter.longName:b.measurementMarkupManager.unit.sqMeter.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS:case esri.Units.SQUARE_KILOMETERS:case b.measurementMarkupManager.unit.sqKilometer.shortName:case b.measurementMarkupManager.unit.sqKilometer.longName:case b.measurementMarkupManager.unit.sqKilometer.config:r=t?b.measurementMarkupManager.unit.sqKilometer.longName:b.measurementMarkupManager.unit.sqKilometer.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_MILES:case esri.Units.SQUARE_MILES:case b.measurementMarkupManager.unit.sqMile.shortName:case b.measurementMarkupManager.unit.sqMile.longName:case b.measurementMarkupManager.unit.sqMile.config:r=t?b.measurementMarkupManager.unit.sqMile.longName:b.measurementMarkupManager.unit.sqMile.shortName;break;case esri.tasks.GeometryService.UNIT_SQUARE_YARDS:case esri.Units.SQUARE_YARDS:case b.measurementMarkupManager.unit.sqYard.shortName:case b.measurementMarkupManager.unit.sqYard.longName:case b.measurementMarkupManager.unit.sqYard.config:r=t?b.measurementMarkupManager.unit.sqYard.longName:b.measurementMarkupManager.unit.sqYard.shortName;break;case b.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES:case b.measurementMarkupManager.unit.sqNauticalMile.shortName:case b.measurementMarkupManager.unit.sqNauticalMile.longName:case b.measurementMarkupManager.unit.sqNauticalMile.config:r=t?b.measurementMarkupManager.unit.sqNauticalMile.longName:b.measurementMarkupManager.unit.sqNauticalMile.shortName;break;case esri.tasks.GeometryService.UNIT_ACRES:case esri.Units.ACRES:case b.measurementMarkupManager.unit.acre.shortName:case b.measurementMarkupManager.unit.acre.longName:case b.measurementMarkupManager.unit.acre.config:r=t?b.measurementMarkupManager.unit.acre.longName:b.measurementMarkupManager.unit.acre.shortName;break;case esri.tasks.GeometryService.UNIT_HECTARES:case esri.Units.HECTARES:case b.measurementMarkupManager.unit.hectare.shortName:case b.measurementMarkupManager.unit.hectare.longName:case b.measurementMarkupManager.unit.hectare.config:r=t?b.measurementMarkupManager.unit.hectare.longName:b.measurementMarkupManager.unit.hectare.shortName}return r},t.getGeometryServiceUnitConstant=function(e,t){if(!e)return null;var r=null;switch(e){case esri.Units.ACRES:case b.measurementMarkupManager.unit.acre.longName:case b.measurementMarkupManager.unit.acre.shortName:case b.measurementMarkupManager.unit.acre.config:case esri.tasks.GeometryService.UNIT_ACRES.toString():r=esri.tasks.GeometryService.UNIT_ACRES;break;case esri.Units.ARES:case esri.tasks.GeometryService.UNIT_ARES.toString():r=esri.tasks.GeometryService.UNIT_ARES;break;case b.measurementMarkupManager.unit.feet.longName:case b.measurementMarkupManager.unit.feet.shortName:case b.measurementMarkupManager.unit.feet.config:case a.DistanceUnitType.FEET:case esri.tasks.GeometryService.UNIT_FOOT.toString():case esri.Units.FEET:r=esri.tasks.GeometryService.UNIT_FOOT;break;case esri.Units.HECTARES:case b.measurementMarkupManager.unit.hectare.longName:case b.measurementMarkupManager.unit.hectare.shortName:case b.measurementMarkupManager.unit.hectare.config:case esri.tasks.GeometryService.UNIT_HECTARES.toString():r=esri.tasks.GeometryService.UNIT_HECTARES;break;case b.measurementMarkupManager.unit.kilometer.longName:case b.measurementMarkupManager.unit.kilometer.shortName:case b.measurementMarkupManager.unit.kilometer.config:case a.DistanceUnitType.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER.toString():case esri.Units.KILOMETERS:r=esri.tasks.GeometryService.UNIT_KILOMETER;break;case b.measurementMarkupManager.unit.meter.longName:case b.measurementMarkupManager.unit.meter.shortName:case b.measurementMarkupManager.unit.meter.config:case a.DistanceUnitType.METERS:case esri.tasks.GeometryService.UNIT_METER.toString():case esri.Units.METERS:r=esri.tasks.GeometryService.UNIT_METER;break;case b.measurementMarkupManager.unit.mile.longName:case b.measurementMarkupManager.unit.mile.shortName:case b.measurementMarkupManager.unit.mile.config:case a.DistanceUnitType.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE.toString():case esri.Units.MILES:r=esri.tasks.GeometryService.UNIT_STATUTE_MILE;break;case b.measurementMarkupManager.unit.nauticalMile.longName:case b.measurementMarkupManager.unit.nauticalMile.shortName:case b.measurementMarkupManager.unit.nauticalMile.config:case a.DistanceUnitType.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE.toString():case esri.Units.NAUTICAL_MILES:r=esri.tasks.GeometryService.UNIT_NAUTICAL_MILE;break;case b.measurementMarkupManager.unit.yard.longName:case b.measurementMarkupManager.unit.yard.shortName:case b.measurementMarkupManager.unit.yard.config:case a.DistanceUnitType.YARDS:case esri.Units.YARDS:r=b.measurementMarkupManager.GCX_UNIT_YARDS;break;case esri.Units.SQUARE_CENTIMETERS:case esri.tasks.GeometryService.UNIT_SQUARE_CENTIMETERS.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_CENTIMETERS;break;case esri.Units.SQUARE_DECIMETERS:case esri.tasks.GeometryService.UNIT_SQUARE_DECIMETERS.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_DECIMETERS;break;case b.measurementMarkupManager.unit.sqFeet.longName:case b.measurementMarkupManager.unit.sqFeet.shortName:case b.measurementMarkupManager.unit.sqFeet.config:case esri.tasks.GeometryService.UNIT_SQUARE_FEET.toString():case esri.Units.SQUARE_FEET:r=esri.tasks.GeometryService.UNIT_SQUARE_FEET;break;case esri.Units.SQUARE_INCHES:case esri.tasks.GeometryService.UNIT_SQUARE_INCHES.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_INCHES;break;case b.measurementMarkupManager.unit.sqKilometer.longName:case b.measurementMarkupManager.unit.sqKilometer.shortName:case b.measurementMarkupManager.unit.sqKilometer.config:case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS.toString():case esri.Units.SQUARE_KILOMETERS:r=esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS;break;case b.measurementMarkupManager.unit.sqMeter.longName:case b.measurementMarkupManager.unit.sqMeter.shortName:case b.measurementMarkupManager.unit.sqMeter.config:case esri.tasks.GeometryService.UNIT_SQUARE_METERS.toString():case esri.Units.SQUARE_METERS:r=esri.tasks.GeometryService.UNIT_SQUARE_METERS;break;case b.measurementMarkupManager.unit.sqMile.longName:case b.measurementMarkupManager.unit.sqMile.shortName:case b.measurementMarkupManager.unit.sqMile.config:case esri.tasks.GeometryService.UNIT_SQUARE_MILES.toString():case esri.Units.SQUARE_MILES:r=esri.tasks.GeometryService.UNIT_SQUARE_MILES;break;case b.measurementMarkupManager.unit.sqNauticalMile.longName:case b.measurementMarkupManager.unit.sqNauticalMile.shortName:case b.measurementMarkupManager.unit.sqNauticalMile.config:r=b.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES;break;case esri.Units.SQUARE_MILLIMETERS:case esri.tasks.GeometryService.UNIT_SQUARE_MILLIMETERS.toString():r=esri.tasks.GeometryService.UNIT_SQUARE_MILLIMETERS;break;case b.measurementMarkupManager.unit.sqYard.longName:case b.measurementMarkupManager.unit.sqYard.shortName:case b.measurementMarkupManager.unit.sqYard.config:case esri.tasks.GeometryService.UNIT_SQUARE_YARDS.toString():case esri.Units.SQUARE_YARDS:r=esri.tasks.GeometryService.UNIT_SQUARE_YARDS;break;default:r=t||e}return r},t.addGraphicToLayer=function(e,t,r){return i.addGraphicToLayer(e,t,r)},t.getGraphicsLayer=function(e,t,r){return i.getInternalGraphicsLayer(e,r,i.GraphicsLayerType.Label)},t.getLabelSize=function(e,a,i,n){for(var s=!0,o=null,t=k(e),r=function(e){if(s){var t=document.getElementById(n+"_layer");(o=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttributeNS(null,"font-size",i),o.setAttributeNS(null,"font-family",a),o.setAttributeNS(null,"visibility","hidden"),o.textContent=e,t.appendChild(o),s=!1}else o.textContent=e;var r=o.getBBox();return d=null===d?r.height:d,M[e]=o.getComputedTextLength(),M[e]},u=y(e),m=0,l=0;u&&l<u.length;l++){for(var p=e.length,c=0,h=0;h<p;h++){var g=u[l].charAt(h);g=" "===g?".":g,c+=M.hasOwnProperty(g)?M[g]:r(g)}m<c&&(m=c)}return{width:Math.ceil(m),height:Math.ceil(d*t)}},t.getRenderedLineSegmentLength=function(e){if(!e||!e.mapPointStart||!e.mapPointEnd)return null;var t=b.measurementMarkupManager.app.map.toScreen(e.mapPointStart),r=b.measurementMarkupManager.app.map.toScreen(e.mapPointEnd),a=Math.abs(r.x-t.x),i=Math.abs(r.y-t.y);return Math.sqrt(a*a+i*i)},t.plotPointOnMap=function(e,t,r,a){var i=new esri.Graphic;new dojo.Color(t),i.geometry=e,i.symbol=n.defaultMarkerSymbol(),i.symbol.setColor(new esri.Color(t)),this.addGraphicToLayer(i,r,a)},t.addHighlightedLabelToMap=function(e,t,r,a,i,n,s,o,u,m,l,p,c,h,g,d){void 0===n&&(n=!1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===u&&(u="Arial"),void 0===m&&(m="12px"),void 0===l&&(l=new esri.Color("white")),void 0===p&&(p=new esri.Color("black")),void 0===c&&(c=null),void 0===h&&(h=0),void 0===g&&(g=0),void 0===d&&(d=!1);var M,y={};y.layerId=a,y.mapPoint=t,y.text=e,y.labelXoffset=s,y.labelYoffset=o,y.fontFamily=u,y.fontSize=m,y.cornerRadius=h,y.angle=g,y.anchor=S.HighlightedLabelAnchor.MIDDLE,y.textColor=l,y.highlightColor=p,y.highlightOutlineSymbol=c;var _=!1;return k(e),v?(v.textGraphics&&0<v.textGraphics.length&&v.textGraphics[0].getLayer()&&v.highlightGraphic.getLayer()&&(_=!0),v.isVisible()&&v.hide()):n&&(y.anchor=S.HighlightedLabelAnchor.BOTTOM_LEFT,v=new f.HighlightedMeasurementLabel(y,i)),n?(M=v).update(t,e):M=new f.HighlightedMeasurementLabel(y,i),!n&&r&&M.assignMeasurementId(r),n&&(!n||_)||(M.addToMapGraphicLayer(),n||b.measurementMarkupManager.addedMapGraphics.push(M)),d?M.show():M.hide(),M},t.getTextLines=y,t.svgRoundedRectanglePath=function(e,t,r){return"M0,0h"+(e-r)+"a"+r+","+r+" 0 0 1 "+r+","+r+"v"+(t-2*r)+"a"+r+","+r+" 0 0 1 "+-r+","+r+"h"+(r-e)+"a"+r+","+r+" 0 0 1 "+-r+","+-r+"v"+(2*r-t)+"a"+r+","+r+" 0 0 1 "+r+","+-r+"z"},t.refreshHighlightSymbolSize=function(e,t,r,a){void 0===r&&(r="Arial"),void 0===a&&(a="12px");var i=this.getLabelSize(e,r,a),n=.5*i.height,s=i.width+n,o=i.height+n;if(t){t.setStyle("STYLE_PATH");var u="M0,0h"+s+"v"+o+"h-"+s+"z";t.setPath(u)}return t},t.convertLength=function(e,t,r){var a=0;switch(t){case esri.tasks.GeometryService.UNIT_METER:a=3.280839895013*e;break;case esri.tasks.GeometryService.UNIT_KILOMETER:a=3280.839895013123*e;break;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:a=5280*e;break;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:a=6076.12*e;break;case b.measurementMarkupManager.GCX_UNIT_YARDS:a=3*e;break;default:a=e}switch(r){case esri.tasks.GeometryService.UNIT_METER:return a/3.280839895013;case esri.tasks.GeometryService.UNIT_KILOMETER:return a/3280.839895013123;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:return a/5280;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:return a/6076.12;case b.measurementMarkupManager.GCX_UNIT_YARDS:return a/3;default:return a}},t.convertArea=function(e,t,r){var a=0;switch(t){case esri.tasks.GeometryService.UNIT_SQUARE_METERS:a=10.76391041670891*e;break;case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS:a=10763910.41670972*e;break;case esri.tasks.GeometryService.UNIT_SQUARE_MILES:a=27878400*e;break;case esri.tasks.GeometryService.UNIT_SQUARE_YARDS:a=9*e;break;case esri.tasks.GeometryService.UNIT_ACRES:a=43560*e;break;case esri.tasks.GeometryService.UNIT_HECTARES:a=107639*e;break;case b.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES:a=36919234.2544*e;break;default:a=e}switch(r){case esri.tasks.GeometryService.UNIT_SQUARE_METERS:return a/10.76391041670891;case esri.tasks.GeometryService.UNIT_SQUARE_KILOMETERS:return a/10763910.41670972;case esri.tasks.GeometryService.UNIT_SQUARE_MILES:return a/27878400;case b.measurementMarkupManager.GCX_UNIT_SQ_NAUTICAL_MILES:return a/36919234.2544;case esri.tasks.GeometryService.UNIT_SQUARE_YARDS:return a/9;case esri.tasks.GeometryService.UNIT_ACRES:return a/43560;case esri.tasks.GeometryService.UNIT_HECTARES:return a/107639;default:return a}}})},"Mapping/modules/Measurement/MeasurementView":function(){var a,s=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=(a=r.ViewBase,s(n,a),n.prototype.attach=function(e){a.prototype.attach.call(this,e),this.measurementSwitcherView=this.app.viewManager.getViewById("MeasurementUnitSwitcherView")},n.prototype.activateUnitSwitcherView=function(){this.measurementSwitcherView&&!this.measurementSwitcherView.isActive&&this.app.command("ActivateView").execute("MeasurementUnitSwitcherView")},n.prototype.deactivateUnitSwitcherView=function(){this.measurementSwitcherView&&this.measurementSwitcherView.isActive&&this.app.command("DeactivateView").execute("MeasurementUnitSwitcherView")},n.prototype.handleClickClose=function(){this.deactivateUnitSwitcherView(),this.app.command("ClearActiveTool").execute()},n.prototype.handleShowLengthSwitcher=function(){this.viewModel.measurementInProgress.get()||(this.viewModel.lengthSwitcherSelected.set(!0),this.activateUnitSwitcherView())},n.prototype.handleShowAreaSwitcher=function(){this.viewModel.measurementInProgress.get()||(this.viewModel.lengthSwitcherSelected.set(!1),this.activateUnitSwitcherView())},n.prototype.handleSetLengthUnits=function(e,t,r){this.viewModel.selectedLengthUnits.set(r),this.deactivateUnitSwitcherView()},n.prototype.handleSetAreaUnits=function(e,t,r){this.viewModel.selectedAreaUnits.set(r),this.deactivateUnitSwitcherView()},n);function n(e,t){var r=a.call(this,e,t)||this;return r.measurementSwitcherView=null,r}t.MeasurementView=i})},"Mapping/modules/Measurement/MeasurementViewModel":function(){var a,h=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","./MeasurementModule","./MeasurementUtils","./Descriptors/DescriptorBase","geocortex/infrastructure/GraphicUtils","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/coordinates/CoordinateUtils","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/GraphicsLayerIds"],function(e,t,r,a,_,u,f,i,n,m,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,p=(o=r.ViewModelBase,h(c,o),c.prototype.initialize=function(e){var t=this;e=e||{},this._lineColor=e.lineColor?new esri.Color(e.lineColor):null,this._fillColor=e.fillColor?new esri.Color(e.fillColor):null,this._textColor=e.textColor?new esri.Color(e.textColor):null,this._highlightColor=e.highlightColor?new esri.Color(e.highlightColor):null,this._outlineColor=e.outlineColor?new esri.Color(e.outlineColor):null,this._outlineWidth=null!=e.outlineWidth?parseFloat(e.outlineWidth):this._defaultOutlineWidth,this._totalMeasurementTextColor=e.totalMeasurementTextColor?new esri.Color(e.totalMeasurementTextColor):null,this._totalMeasurementHighlightColor=e.totalMeasurementHighlightColor?new esri.Color(e.totalMeasurementHighlightColor):null,this._totalMeasurementOutlineColor=e.totalMeasurementOutlineColor?new esri.Color(e.totalMeasurementOutlineColor):null,this._totalMeasurementOutlineWidth=null!=e.totalMeasurementOutlineWidth?parseFloat(e.totalMeasurementOutlineWidth):this._defaultOutlineWidth,this._lineDescriptionFormat=e.lineDescriptionFormat?e.lineDescriptionFormat:"{0}",this._highlightRadius=null!=e.highlightRadius?parseInt(e.highlightRadius):this._defaultHighlightRadius,this._textSize=e.textSize?e.textSize:"12px",this._textOffset=null!=e.textOffset?parseInt(e.textOffset):this._defaultTextOffset,this._textAboveMarkup=null!=e.textAboveMarkup&&e.textBelowMarkup,this._flipLabelThreshold=null!=e.disablePolygonLabelFlipThreshold?parseInt(e.disablePolygonLabelFlipThreshold):1e3,this._polylineLabelOffset=null!=e.polylineLabelOffset?parseInt(e.polylineLabelOffset):this._polylineLabelOffset,this.addMarkupToMap=new a.Observable(e.addMarkupToMapByDefault||!1),_.measurementMarkupManager._setLayerIds(l.MARKUP_LAYER_ID,l.MEASUREMENT_LAYER_ID),_.measurementMarkupManager._setMapTipPresentation(this._totalMeasurementTextColor,this._totalMeasurementHighlightColor,this._totalMeasurementOutlineColor,this._totalMeasurementOutlineWidth,this._highlightRadius,this._textSize),this._textFont=new esri.symbol.Font,this._textFont.setSize(this._textSize),this._textFont.setFamily("Arial"),this.lengthUnits=new a.ObservableCollection([_.measurementMarkupManager.unit.feet.longName,_.measurementMarkupManager.unit.yard.longName,_.measurementMarkupManager.unit.meter.longName,_.measurementMarkupManager.unit.kilometer.longName,_.measurementMarkupManager.unit.mile.longName,_.measurementMarkupManager.unit.nauticalMile.longName]),this.areaUnits=new a.ObservableCollection([_.measurementMarkupManager.unit.sqFeet.longName,_.measurementMarkupManager.unit.sqYard.longName,_.measurementMarkupManager.unit.sqMeter.longName,_.measurementMarkupManager.unit.sqKilometer.longName,_.measurementMarkupManager.unit.sqMile.longName,_.measurementMarkupManager.unit.sqNauticalMile.longName,_.measurementMarkupManager.unit.acre.longName,_.measurementMarkupManager.unit.hectare.longName]),this.selectedAreaUnits=new a.Observable(u.getUnitString(_.measurementMarkupManager._areaUnitString,!0)),this.selectedAreaUnitShort=new a.Observable(u.getUnitString(_.measurementMarkupManager._areaUnitString)),this.selectedLengthUnits=new a.Observable(u.getUnitString(_.measurementMarkupManager._lengthUnitString,!0)),this.selectedLengthUnitShort=new a.Observable(u.getUnitString(_.measurementMarkupManager._lengthUnitString)),this.measurementInProgress=new a.Observable(!1),this.descriptorContainerEmpty=new a.Observable(!0),this.lengthSwitcherSelected=new a.Observable(!0),this.eraseActive=new a.Observable(!1),this.measurementInProgress.sync(_.measurementMarkupManager.measurementInProgress),this.descriptorContainerEmpty.sync(_.measurementMarkupManager.descriptorContainerEmpty),this.selectedAreaUnits.bind(this,function(e){t._isRestoringState||t.app.command("SetMeasurementUnits").execute(t.selectedLengthUnits.get(),e),t.selectedAreaUnitShort.set(u.getUnitString(_.measurementMarkupManager._areaUnitString))}),this.selectedLengthUnits.bind(this,function(e){t._isRestoringState||t.app.command("SetMeasurementUnits").execute(e,t.selectedAreaUnits.get()),t.selectedLengthUnitShort.set(u.getUnitString(_.measurementMarkupManager._lengthUnitString))}),this.addMarkupToMap.bind(this,function(e){e?(t._currentMarkupSegmentGraphics=t._temporaryMarkupSegmentGraphics.slice(0),t._temporaryMarkupSegmentGraphics=[]):(t._temporaryMarkupSegmentGraphics=t._currentMarkupSegmentGraphics.slice(0),t._currentMarkupSegmentGraphics=[])}),this._registerCommands()},c.prototype._registerCommands=function(){var r=this;this.app.command("DeleteMeasurement").register(this,this._executeDeleteMeasurementCommand,this._canExecuteDeleteMeasurementCommand),this.app.command("_addLineSegmentMeasurementMarkup").register(this,this._executeAddLineSegmentMeasurementMarkup,this._canExecuteAddMarkup),this.app.command("_addCompletedGeometryMeasurementMarkup").register(this,this._executeAddCompletedGeometryMeasurementMarkup,this._canExecuteAddMarkup),this.app.command("_addGeometryMarkup").register(this,this._executeAddGeometryMarkup,this._canExecuteAddMarkup),this.app.command("_clearMeasurementMarkup").register(this,this._executeClearMeasurementMarkup),this.app.command("_applyMeasurementUnits").register(this,function(e,t){r._isRestoringState=!0,r.selectedLengthUnits.set(u.getUnitString(e,!0)),r.selectedAreaUnits.set(u.getUnitString(t,!0)),r._isRestoringState=!1})},c.prototype._canExecuteAddMarkup=function(e){return this._markupLayer&&this._measurementLayer||(this._markupLayer=n.getInternalGraphicsLayer(l.MARKUP_LAYER_ID,this.app,n.GraphicsLayerType.Markup,!0),this._measurementLayer=n.getInternalGraphicsLayer(l.MEASUREMENT_LAYER_ID,this.app,n.GraphicsLayerType.Label),this._markupLayer&&this._measurementLayer&&(_.measurementMarkupManager._measurementLayersCreated=!0)),!!(e&&e.geometry&&this._markupLayer&&this._measurementLayer)},c.prototype._canExecuteDeleteMeasurementCommand=function(e){return!!e},c.prototype._executeAddGeometryMarkup=function(e){e.type===f.DescriptorType.POLYGON?(this._fillColor&&(e.graphicSymbol.setColor(this._fillColor),e.graphicSymbol.color.a=.4),this._lineColor&&e.graphicSymbol.outline.setColor(this._lineColor)):this._lineColor&&e.graphicSymbol.setColor(this._lineColor);var t=e.addToMap(l.MARKUP_LAYER_ID);this.app.command("EditMarkup").raiseCanExecuteChanged(),this.app.command("DeleteMarkup").raiseCanExecuteChanged(),this.app.command("ClearMarkup").raiseCanExecuteChanged(),this.app.command("ExportMarkupLayer").raiseCanExecuteChanged(),e.type===f.DescriptorType.LINE_SEGMENT?this._temporaryMarkupSegmentGraphics.push(t):this.addMarkupToMap.get()?this._currentMarkupSegmentGraphics.push(t):this._temporaryMarkupSegmentGraphics.push(t)},c.prototype._executeAddLineSegmentMeasurementMarkup=function(e,t,r){if(e&&e.geometry){if(e.isActive&&(this.addMarkupToMap.get()||_.measurementMarkupManager._currentGeometryInProcess&&_.measurementMarkupManager._currentGeometryInProcess.id===e.id)){var a=_.measurementMarkupManager.formatMeasurement(e.length,_.measurementMarkupManager.measurementFractionalDigits)+" "+e.unitStr,i=m.formatAngle(e.getAngle(),_.measurementMarkupManager.degreeFormat,this.app,_.measurementMarkupManager.coordinateFractionalDigits),n=this._lineDescriptionFormat.format(a,i,e.getQuadrantBearing());this._setLineSegmentSymbols(e);var s=e.getAngleDegree(),o=e.getLabelLocation();e.highlightedLabelGraphic=u.addHighlightedLabelToMap(n,o,null,l.MEASUREMENT_LAYER_ID,this.app,!1,this._textOffset,this._textOffset,this._textFont.family,this._textSize,this._textColor,this._highlightColor,0<this._outlineWidth?new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this._outlineColor,this._outlineWidth):null,this._highlightRadius,s),e.showLabel=e.highlightedLabelGraphic.getWidth()*this._labelSizeAdjustmentFactor<u.getRenderedLineSegmentLength(e),e.showLabel&&!e.highlightedLabelGraphic.isVisible()&&e.highlightedLabelGraphic.show(),t&&t(e)}}else this._tryErrorCallback(r,new Error("LineSegment or geometry not defined"))},c.prototype._executeAddCompletedGeometryMeasurementMarkup=function(e,t,r){var a=this,i=null;if(e&&e.isActive&&(this.addMarkupToMap.get()||_.measurementMarkupManager._currentGeometryInProcess&&_.measurementMarkupManager._currentGeometryInProcess.id===e.id)){switch(e.type){case f.DescriptorType.POLYGON:e.geometry,e._lineSegments.length;var n=e.geometry,s=n.getExtent();i=s?s.getCenter():null,!n.contains(i)&&e.simplifiedGeometry&&(i=e.simplifiedGeometry.getCentroid()||i),e.labelStr=this._polygonFormatString.format(_.measurementMarkupManager.formatMeasurement(e.area,_.measurementMarkupManager.measurementFractionalDigits),e.areaUnitStr,_.measurementMarkupManager.formatMeasurement(e.length,_.measurementMarkupManager.measurementFractionalDigits),e.unitStr),e.highlightedLabelGraphic=this._addHighlightedLabelToMap(e,i),this.app.command("LogOptimizerEvent").execute("MeasureAreaTool","MeasureArea");break;case f.DescriptorType.POLYLINE:e.labelStr=this._polylineFormatString.format(_.measurementMarkupManager.formatMeasurement(e.length,_.measurementMarkupManager.measurementFractionalDigits),e.unitStr);var o=e._lineSegments[e._lineSegments.length-1];e.highlightedLabelGraphic=this._addHighlightedLabelToMap(e,o.mapPointEnd);var u=e.highlightedLabelGraphic.getTotalWidth()/2+this._polylineLabelOffset,m=e.highlightedLabelGraphic.getTotalHeight()/2+this._polylineLabelOffset,l=esri.geometry.toScreenGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,o.mapPointStart),p=esri.geometry.toScreenGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,o.mapPointEnd),c=p.x-l.x,h=p.y-l.y,g=0,d=0,M=c<0?-1:1,y=h<0?-1:1;d=Math.abs(c)>Math.abs(h)?(g=u*M,m*(Math.abs(h)/Math.abs(c))*y):(g=Math.abs(h)>Math.abs(c)?u*(Math.abs(c)/Math.abs(h))*M:u*M,m*y),e.highlightedLabelGraphic.calculateLabelPoint=function(){return a._calcLabelPoint(o.mapPointEnd,e.highlightedLabelGraphic,g,d)},e.highlightedLabelGraphic.calculateLabelPoint(),this.app.command("LogOptimizerEvent").execute("MeasureDistanceTool","MeasureDistance");break;default:this._tryErrorCallback(r,new Error("Invalid Geometry Descriptor"))}_.measurementMarkupManager.narrateGeometryDescriptor(e),_.measurementMarkupManager.measurementCompleted(),e.setInactive(),this.app.event("MeasurementMarkupAdded").publish({graphic:e.graphic,measurementDescriptor:e}),t&&t(e)}},c.prototype._calcLabelPoint=function(e,t,r,a){var i=esri.geometry.toScreenGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,e),n=esri.geometry.toMapGeometry(this.app.map.extent,this.app.map.width,this.app.map.height,new esri.geometry.Point(i.x+r,i.y+a));t.setMapPoint(n)},c.prototype._addHighlightedLabelToMap=function(e,t){return u.addHighlightedLabelToMap(e.labelStr,t,e.id,l.MEASUREMENT_LAYER_ID,this.app,!1,this._textOffset,this._textOffset,"Arial",this._textSize,this._totalMeasurementTextColor,this._totalMeasurementHighlightColor,0<this._totalMeasurementOutlineWidth?new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this._totalMeasurementOutlineColor,this._totalMeasurementOutlineWidth):null,this._highlightRadius,0,!0)},c.prototype._executeDeleteMeasurementCommand=function(e){var a=this,t=[l.MARKUP_LAYER_ID,l.MEASUREMENT_LAYER_ID];i.deleteMarkup(e,t,this.app,function(e){if(e&&e.length)for(var t=0;t<e.length;t++)e[t].hasOwnProperty("measurementId")&&_.measurementMarkupManager.destroyDescriptor(e[t].measurementId);var r=a.app.toolRegistry.getActiveTool();_.measurementMarkupManager.descriptorContainerEmpty.get()&&r&&"DeleteMeasurementTool"===r.name&&a.app.command("ClearActiveTool").execute()},!0,"language-measurement-erase-multiple-prompt","language-measurement-erase-multiple-prompt-title",this.libraryId),this.app.command("LogOptimizerEvent").execute("DeleteMeasurementTool","DeleteMeasurement")},c.prototype._executeClearMeasurementMarkup=function(t,r){var a=this;if("all"===t){var e=this.app.getResource(this.libraryId,"language-measurement-clear-all-prompt"),i=this.app.getResource(this.libraryId,"language-measurement-clear-all-prompt-title");this.app.command("StopEditingMarkup").execute(),this.app.command("Confirm").execute(e,i,function(e){e&&a._clearMarkup(t,r)})}else this._clearMarkup(t,r)},c.prototype._clearMarkup=function(e,t){switch(void 0===e&&(e="all"),void 0===t&&(t=!1),e){case"all":_.measurementMarkupManager.destroyAllDescriptors(),this.app.command("LogOptimizerEvent").execute("ClearMeasurementTool","ClearAllMeasurements");break;case"temporary":for(var r=0;r<this._temporaryMarkupSegmentGraphics.length;r++)(a=this._temporaryMarkupSegmentGraphics[r])&&a.measurementId&&_.measurementMarkupManager.destroyDescriptor(a.measurementId);break;case"current":for(r=0;r<this._currentMarkupSegmentGraphics.length;r++){var a;(a=this._currentMarkupSegmentGraphics[r])&&a.measurementId&&_.measurementMarkupManager.destroyDescriptor(a.measurementId)}}_.measurementMarkupManager._currentGeometryInProcess&&!_.measurementMarkupManager._currentGeometryInProcess.graphic&&_.measurementMarkupManager.destroyDescriptor(_.measurementMarkupManager._currentGeometryInProcess.id),"temporary"!==e&&"all"!==e&&!t||(this._temporaryMarkupSegmentGraphics=[]),"current"!==e&&"all"!==e&&!t||(this._currentMarkupSegmentGraphics=[])},c.prototype._setLineSegmentSymbols=function(e){e.graphicSymbol||(e.graphicSymbol=s.defaultLineSymbol(),this._lineColor&&e.graphicSymbol.setColor(this._lineColor))},c.prototype._tryErrorCallback=function(e,t){e&&e(t)},c);function c(e,t){var r=o.call(this,e,t)||this;return r.measurementGraphicId=0,r._lineColor=null,r._fillColor=null,r._textColor=null,r._highlightColor=null,r._outlineColor=null,r._outlineWidth=null,r._totalMeasurementTextColor=null,r._totalMeasurementHighlightColor=null,r._totalMeasurementOutlineColor=null,r._totalMeasurementOutlineWidth=null,r._lineDescriptionFormat=null,r._highlightRadius=null,r._textSize=null,r._textOffset=null,r._count=-1,r._markupLayer=null,r._measurementLayer=null,r._currentMarkupSegmentGraphics=[],r._temporaryMarkupSegmentGraphics=[],r._isRestoringState=!1,r._labelSizeAdjustmentFactor=1.25,r._defaultTextOffset=0,r._defaultOutlineWidth=0,r._defaultHighlightRadius=5,r._flipLabelThreshold=1e3,r._polylineLabelOffset=5,r._polygonFormatString=_.measurementMarkupManager.getResource("language-measurement-polygon-final-markup-label"),r._polylineFormatString=_.measurementMarkupManager.getResource("language-measurement-polyline-final-markup-label"),r}t.MeasurementViewModel=p})},"Mapping/modules/Measurement/Descriptors/DescriptorBase":function(){define(["require","exports","./../HighlightedMeasurementLabel","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/highlightedLabel/HighlightedLabelGraphic"],function(e,t,s,a,o){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.DescriptorType||(t.DescriptorType={}))[r.LINE_SEGMENT=0]="LINE_SEGMENT",r[r.POLYLINE=1]="POLYLINE",r[r.POLYGON=2]="POLYGON";var i=(n.prototype.addSegment=function(e){},n.prototype.setMeasurementUnit=function(e,t){},n.prototype.setGeometry=function(e){},n.prototype.addToMap=function(e,t){var r=null;return this.isActive&&(t||this.graphic||(this.graphic=new esri.Graphic,this.graphic.geometry=this.geometry,this.graphic.symbol=this.graphicSymbol),(r=t||this.graphic).measurementId=this.id,r=a.addGraphicToLayer(r,e,this.app)?r:null),r},n.prototype.updateFeature=function(){if(this.feature||(this.feature=new esri.Graphic,this.feature.geometry=this._polygonToPolyLine(this.geometry),this.feature.symbol=this.graphicSymbol),this.feature.setAttributes(this._createAttributes()),this.graphic){this.graphic.setAttributes(this._createAttributes());var e={graphic:this.graphic};this.app.eventRegistry.event("GraphicAttributesChangedEvent").publish(e)}},n.prototype.exportState=function(){return{id:this.id,geometry:this.app.project.convert.fromEsriGeometry(this.geometry),length:this.length,type:this.type,spatialReference:this.app.project.convert.fromEsriSpatialReference(this.spatialReference),graphic:this.app.project.convert.fromEsriGraphic(this.graphic),feature:this.app.project.convert.fromEsriGraphic(this.feature),label:this.highlightedLabelGraphic?this.highlightedLabelGraphic.exportState(this.app):null}},n.prototype.applyState=function(t,r,a){var i=this,n=this.app.project.convert,e={graphic:n.toEsriGraphic(t.graphic),feature:n.toEsriGraphic(t.feature),label:o.HighlightedLabelGraphic.fromExportedState(t.label,this.app,s.HighlightedMeasurementLabel.prototype)};return Promise.props(e).then(function(e){i.id=t.id,i.geometry=n.toEsriGeometry(t.geometry),i.length=t.length,i.type=t.type,i.spatialReference=n.toEsriSpatialReference(t.spatialReference),i.graphic=e.graphic,i.feature=e.feature,i.lengthUnit=r,i.unitStr=a,i.highlightedLabelGraphic=e.label})},n.prototype._createAttributes=function(){throw new Error("DescriptorBase._createAttributes is abstract and must be overridden in derived classes.")},n.prototype._polygonToPolyLine=function(e){if(!e||"polygon"!==e.type)return e;var t=new esri.geometry.Polyline(e.rings);return t.setSpatialReference(e.spatialReference),t},n);function n(e,t,r){this.id="",this.geometry=null,this.type=null,this.length=null,this.lengthUnit=null,this.unitStr=null,this.labelStr=null,this.spatialReference=null,this.graphic=null,this.graphicSymbol=null,this.isActive=!0,this.feature=null,this.highlightedLabelGraphic=null,this.app=r,this.type=e,this.spatialReference=t}t.DescriptorBase=i})},"Mapping/modules/Measurement/Descriptors/GeometryDescriptor":function(){var a,M=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","./DescriptorBase","./LineSegmentDescriptor","geocortex/infrastructure/FeatureSet","geocortex/infrastructure/SymbolUtils","geocortex/infrastructure/tools/MapTool","./../MeasurementModule","./../MeasurementUtils","geocortex/essentials/GeometryUtilities","geocortex/infrastructure/tools/DrawMode","geocortex/infrastructure/coordinates/CoordinateUtils","geocortex/essentials/Field"],function(e,t,o,a,i,s,u,m,l,r,p,c,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h,g=(h=o.DescriptorBase,M(d,h),d.prototype.addSegment=function(e){e.id=this.id,e.isActive=this.isActive,null==this.lengthUnit&&null!=e.lengthUnit&&(e.unitStr?(this.lengthUnit=e.lengthUnit,this.unitStr=e.unitStr):(this.setMeasurementUnit(e.lengthUnit),e.unitStr=this.unitStr)),null!=this.lengthUnit&&null!=e.lengthUnit&&this.lengthUnit!==e.lengthUnit&&m.measurementMarkupManager._reportStatus("GeometryDescriptor: Added line segment unit differs from geometry.","error",!0),e.length?this.length=this.length?this.length+e.length:e.length:m.measurementMarkupManager._reportStatus("GeometryDescriptor: Line Segment added without computing length or length 0. Total geometry length not updated.","warning",!1),e.graphicSymbol&&!this.graphicSymbol&&this.type===o.DescriptorType.POLYLINE&&(this.graphicSymbol=new esri.symbol.SimpleLineSymbol(e.graphicSymbol.toJson())),this._lineSegments.push(e)},d.prototype.setMeasurementUnit=function(e,t){var r=!1;if((null!=this.areaUnit&&this.areaUnit!==t||null==this.areaUnit&&t&&this.type===o.DescriptorType.POLYGON)&&(this.area&&null!=this.areaUnit&&(this.area=l.convertArea(this.area,this.areaUnit,t)),this.areaUnit=t,this.areaUnitStr=l.getUnitString(this.areaUnit),r=!0),null!=this.lengthUnit&&this.lengthUnit!==e||null==this.lengthUnit&&null!=e){for(var a=this.length=0,i=this._lineSegments;a<i.length;a++){var n=i[a];n.setMeasurementUnit(e),this.length+=n.length}this.unitStr=l.getUnitString(e),this.lengthUnit=e,r=!0}if(r&&(this.labelStr=this.type===o.DescriptorType.POLYLINE?m.measurementMarkupManager.getResource("language-measurement-polyline-final-markup-label").format(m.measurementMarkupManager.formatMeasurement(this.length,m.measurementMarkupManager.measurementFractionalDigits),this.unitStr):m.measurementMarkupManager.getResource("language-measurement-polygon-final-markup-label").format(m.measurementMarkupManager.formatMeasurement(this.area,m.measurementMarkupManager.measurementFractionalDigits),this.areaUnitStr,m.measurementMarkupManager.formatMeasurement(this.length,m.measurementMarkupManager.measurementFractionalDigits),this.unitStr),this.highlightedLabelGraphic&&this.highlightedLabelGraphic.refresh(this.labelStr),this.measurementData)){this.updateFeature(),null!=this.measurementData.features.getAt(0)&&this.measurementData.features.getAt(0).loadAttributes(!1);for(var s=1;s<this.measurementData.features.length();s++)this._lineSegments[s-1].updateFeature(),this._lineSegments[s-1].feature.attributes.Segment=s.toString(),this.measurementData.features.getAt(s).loadAttributes(!1);for(this._formatMeasurementData(),s=0;s<this.measurementData.features.length();s++)this.app.event("FeatureChangedEvent").publish(this.measurementData.features.getAt(s))}},d.prototype.setGeometry=function(e){r.spatialRefsAreEqual(e.spatialReference,this.spatialReference,!1)?this.geometry=e:m.measurementMarkupManager._reportStatus("GeometryDescriptor: setGeometry error: Invalid Spatial Reference","error",!0)},d.prototype.refreshLabelVisibilityAndPosition=function(){if(!this.editingInProgress){this.showHighlightedLabel=!1;for(var e=this.app.map.getZoom()>=this.originalZoomLevel,t=0,r=this._lineSegments;t<r.length;t++){var a=r[t];a.refreshLabelVisibility(),this.showHighlightedLabel=this.showHighlightedLabel||e||a.showLabel}this.showHighlightedLabel?this.highlightedLabelGraphic&&this.highlightedLabelGraphic.highlightGraphic&&this.highlightedLabelGraphic.textGraphics&&0<this.highlightedLabelGraphic.textGraphics.length&&(this.highlightedLabelGraphic.calculateLabelPoint&&this.highlightedLabelGraphic.calculateLabelPoint(),this.highlightedLabelGraphic.moveToTop(),this.highlightedLabelGraphic.show()):this.highlightedLabelGraphic&&this.highlightedLabelGraphic.highlightGraphic&&this.highlightedLabelGraphic.textGraphics&&0<this.highlightedLabelGraphic.textGraphics.length&&this.highlightedLabelGraphic.hide()}},d.prototype.refreshMeasurementData=function(){var e=this.drawMode||p.DrawMode.POLYGON,t=new esri.tasks.FeatureSet;if(this.updateFeature(),t.features.push(this.feature),[p.DrawMode.CIRCLE,p.DrawMode.ELLIPSE,p.DrawMode.FREEHAND_POLYGON,p.DrawMode.FREEHAND_POLYLINE].indexOf(this.drawMode)<0)for(var r=0;r<this._lineSegments.length;r++)this._lineSegments[r].updateFeature(),this._lineSegments[r].feature.attributes.Segment=(r+1).toString(),t.features.push(this._lineSegments[r].feature);if(this.measurementData?(this.measurementData.esriFeatureSet=t,this.measurementData.loadFeatures()):(this.measurementData=new i.FeatureSet({esriFeatureSet:t}),this.measurementData.displayName.set(this._getDisplayName()),this.measurementData.isSelectedInCollection.set(!0),this.measurementData.isMeasurement=!0,this._setAttributeMetadata(this.measurementData.attributes)),this._formatMeasurementData(),0<=m.measurementMarkupManager.measurementResultTypes.indexOf(e)){var a=m.measurementMarkupManager.getMeasurementResultsCollection();a.featureSets.addItem(this.measurementData),this.app.featureSetManager.openCollection(a.id),this.app.featureSetManager.closeCollection(a.id)}},d.prototype.setInactive=function(){this.isActive=!1;for(var e=0,t=this._lineSegments;e<t.length;e++)t[e].isActive=!1},d.prototype.exportState=function(){var e=h.prototype.exportState.call(this);return e.area=this.area,e.simplifiedGeometry=this.app.project.convert.fromEsriGeometry(this.simplifiedGeometry),e.drawMode=this.drawMode,e.measurementData=this.app.project.convert.fromGcxFeatureSet(this.measurementData),e.originalZoomLevel=this.originalZoomLevel,e.segments=this._lineSegments.map(function(e){return e.exportState()}),e},d.prototype.applyState=function(t){var r=this,e={measurementData:this.app.project.convert.toGcxFeatureSet(t.measurementData),segments:Promise.map(t.segments,function(e){var t=new a.LineSegmentDescriptor(r.spatialReference,r.app);return t.applyState(e).return(t)})};return h.prototype.applyState.call(this,t,m.measurementMarkupManager._lengthUnit,m.measurementMarkupManager._lengthUnitString).then(function(){return Promise.props(e)}).then(function(e){r.area=t.area,r.simplifiedGeometry=r.app.project.convert.toEsriGeometry(t.simplifiedGeometry),r.drawMode=t.drawMode,r.measurementData=e.measurementData,r.originalZoomLevel=r.originalZoomLevel,r._lineSegments=e.segments,r.areaUnit=m.measurementMarkupManager._areaUnit,r.areaUnitStr=m.measurementMarkupManager._areaUnitString,r.refreshLabelVisibilityAndPosition()})},d.prototype._createAttributes=function(){var e={};return e.Segment=m.measurementMarkupManager.getResource("language-measurement-results-total"),e.X=this._lineSegments[0].mapPointStart.x,e.Y=this._lineSegments[0].mapPointStart.y,e.Length=this.length,e.Units=this.unitStr,e.Area=this.area,e["Area Units"]=this.areaUnitStr,e.Angle=0,e.Bearing="",e},d.prototype._formatMeasurementData=function(){for(var e=0;e<this.measurementData.features.length();e++){var t=this.measurementData.features.getAt(e);0===e?(t.labelFormat.set(m.measurementMarkupManager.getResource("language-measurement-results-feature-label-total").format(this.measurementData.displayName.get())),t.descriptionFormat.set(m.measurementMarkupManager.getResource("language-measurement-results-feature-description-"+this.geometry.type))):(t.labelFormat.set(m.measurementMarkupManager.getResource("language-measurement-results-feature-label-segment").format(this.measurementData.displayName.get(),e)),t.descriptionFormat.set(m.measurementMarkupManager.getResource("language-measurement-results-feature-description-segment")));for(var r=0;r<t.attributes.length();r++){var a=t.attributes.getAt(r),i=a.name.get(),n=a.value.get();0!==e||"X"!==i&&"Y"!==i&&"Angle"!==i?(0<e||"polyline"===this.geometry.type)&&"Area"===i?a.presentableValue.set(""):"X"===i||"Y"===i?a.presentableValue.set(m.measurementMarkupManager.formatMeasurement(n,m.measurementMarkupManager.coordinateFractionalDigits)):"Length"===i||"Area"===i?a.presentableValue.set(m.measurementMarkupManager.formatMeasurement(n,m.measurementMarkupManager.measurementFractionalDigits)):"Angle"===i&&a.presentableValue.set(c.formatAngle(n,m.measurementMarkupManager.degreeFormat,this.app,m.measurementMarkupManager.coordinateFractionalDigits)):a.presentableValue.set("")}this._setAttributeMetadata(t.attributes)}},d.prototype._setAttributeMetadata=function(e){for(var t=0;t<e.length();t++){var r=e.getAt(t);switch(r.name.get()){case"Segment":r.displayName.set(m.measurementMarkupManager.getResource("language-measurement-results-field-segment")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeString);break;case"X":r.displayName.set(m.measurementMarkupManager.getResource("language-measurement-results-field-x")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Y":r.displayName.set(m.measurementMarkupManager.getResource("language-measurement-results-field-y")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Length":r.displayName.set(m.measurementMarkupManager.getResource("language-common-measurement-results-field-length")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Units":r.displayName.set(m.measurementMarkupManager.getResource("language-common-measurement-results-field-units")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeString);break;case"Area":r.displayName.set(m.measurementMarkupManager.getResource("language-common-measurement-results-field-area")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Area Units":r.displayName.set(m.measurementMarkupManager.getResource("language-common-measurement-results-field-area-units")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeString);break;case"Angle":r.displayName.set(m.measurementMarkupManager.getResource("language-measurement-results-field-angle")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeDouble);break;case"Bearing":r.displayName.set(m.measurementMarkupManager.getResource("language-measurement-results-field-bearing")),r.type.set(n.EssentialsFieldTypes.essentialsFieldTypeString)}}},d.prototype._getDisplayName=function(){for(var e=1,t=this.drawMode||p.DrawMode.POLYGON,r=0,a=m.measurementMarkupManager.descriptorContainer;r<a.length;r++){var i=a[r];(i.drawMode||p.DrawMode.POLYGON)===t&&i.id!==this.id&&e++}var n=m.measurementMarkupManager.getResource("language-measurement-drawmode-"+t.toLowerCase().replace("_","-"));return m.measurementMarkupManager.getResource("language-measurement-results-feature-set-name").format(n,e)},d);function d(e,t,r,a){var i=h.call(this,t,r,a)||this;i._lineSegments=[],i.showHighlightedLabel=!0,i.editingInProgress=!1,i.originalZoomLevel=0,i.id=e,i.length=0,i.originalZoomLevel=a.map.getZoom(),t===o.DescriptorType.POLYGON?(i.graphicSymbol=s.defaultFillSymbol(),i.area=0,i.areaUnit=null,i.areaUnitStr=null,i.simplifiedGeometry=null):i.graphicSymbol=s.defaultLineSymbol();var n=i.app.toolRegistry.getActiveTool();return n&&n instanceof u.MapTool&&(i.drawMode=n.drawMode),i}t.GeometryDescriptor=g})},"Mapping/modules/Measurement/Descriptors/LineSegmentDescriptor":function(){var a,l=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","./DescriptorBase","./../MeasurementModule","./../MeasurementUtils","geocortex/infrastructure/coordinates/AngleDirectionSystem","geocortex/infrastructure/coordinates/CoordinateUtils"],function(e,t,a,r,i,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,u=(o=a.DescriptorBase,l(m,o),m.prototype.setStartPt=function(e){e?(this.mapPointStart=new esri.geometry.Point(e.toJson()),0===this.geometry.paths.length?this.geometry.addPath([this.mapPointStart]):this.geometry.insertPoint(0,0,this.mapPointStart)):r.measurementMarkupManager._reportStatus("LineSegmentDescriptor: setStartPt - Start point not specified","error",!1)},m.prototype.setEndPt=function(e){e?(this.mapPointEnd=new esri.geometry.Point(e.toJson()),1===this.geometry.paths.length?this.geometry.insertPoint(0,1,this.mapPointEnd):r.measurementMarkupManager._reportStatus("LineSegmentDescroptor: setEndPt - Please set startPt of segment before setting endPt","error",!1)):r.measurementMarkupManager._reportStatus("LineSegmentDescriptor: setEndPt - End point not specified","error",!1)},m.prototype.setMeasurementUnit=function(e,t){(null!=this.lengthUnit&&this.lengthUnit!=e||null==this.lengthUnit&&null!=e)&&(this.length&&null!=this.lengthUnit&&(this.length=i.convertLength(this.length,this.lengthUnit,e)),this.lengthUnit=e,this.unitStr=t||i.getUnitString(this.lengthUnit),this.highlightedLabelGraphic&&this.highlightedLabelGraphic.refresh(r.measurementMarkupManager.formatMeasurement(this.length,r.measurementMarkupManager.measurementFractionalDigits)+" "+this.unitStr))},m.prototype.refreshLabelVisibility=function(){if(this.highlightedLabelGraphic){var e=i.getRenderedLineSegmentLength(this);this.showLabel=this.highlightedLabelGraphic.getWidth()<e,this.showLabel?this.highlightedLabelGraphic.show():this.highlightedLabelGraphic.hide()}},m.prototype.exportState=function(){var e=o.prototype.exportState.call(this);return e.startPoint=this.app.project.convert.fromEsriGeometry(this.mapPointStart),e.endPoint=this.app.project.convert.fromEsriGeometry(this.mapPointEnd),e},m.prototype.applyState=function(e){var t=this;return o.prototype.applyState.call(this,e,r.measurementMarkupManager._lengthUnit,r.measurementMarkupManager._lengthUnitString).then(function(){t.mapPointStart=t.app.project.convert.toEsriGeometry(e.startPoint),t.mapPointEnd=t.app.project.convert.toEsriGeometry(e.endPoint)})},m.prototype._createAttributes=function(){var e={};return e.Segment=this.id,e.X=this.mapPointStart.x,e.Y=this.mapPointStart.y,e.Length=this.length,e.Units=this.unitStr,e.Area=0,e["Area Units"]="",e.Angle=this.getAngle(),e.Bearing=this.getQuadrantBearing(),e},m.prototype.getAngle=function(){return r.measurementMarkupManager.angleDirectionSystem===n.NORTH_AZIMUTH?this.getNorthAzimuth():r.measurementMarkupManager.angleDirectionSystem===n.SOUTH_AZIMUTH?this.getSouthAzimuth():this.getPolarAngle()},m.prototype.getAngleDegree=function(){var e=0;if(this.mapPointStart&&this.mapPointEnd){var t=Math.atan2(this.mapPointStart.y-this.mapPointEnd.y,this.mapPointEnd.x-this.mapPointStart.x)*(180/Math.PI);e=0<=(t=t<0?360+t:t)&&t<=180?90<t?180+t:t:t<270?t-180:t}return e},m.prototype.getPolarAngle=function(){var e=this.mapPointEnd.x-this.mapPointStart.x,t=this.mapPointEnd.y-this.mapPointStart.y;return(360+180*Math.atan2(t,e)/Math.PI)%360},m.prototype.getNorthAzimuth=function(){return(360-this.getPolarAngle()+90)%360},m.prototype.getSouthAzimuth=function(){return(360-this.getPolarAngle()+90+180)%360},m.prototype.getLabelLocation=function(){if(this.mapPointStart&&this.mapPointEnd)return new esri.geometry.Point((this.mapPointStart.x+this.mapPointEnd.x)/2,(this.mapPointStart.y+this.mapPointEnd.y)/2,this.spatialReference)},m.prototype.getQuadrantBearing=function(){return s.formatBearing(this.getNorthAzimuth(),r.measurementMarkupManager.degreeFormat,this.app,r.measurementMarkupManager.coordinateFractionalDigits)},m);function m(e,t){var r=o.call(this,a.DescriptorType.LINE_SEGMENT,e,t)||this;return r.mapPointStart=null,r.mapPointEnd=null,r.showLabel=!1,r.geometry=new esri.geometry.Polyline(e),r.length=0,r}t.LineSegmentDescriptor=u})},"url:/Mapping/modules/Measurement/MeasurementUnitSwitcherView.html":t,"url:/Mapping/modules/Measurement/MeasurementView.html":r,"url:/Mapping/modules/Measurement/Widgets/MeasurementTransientView.html":a}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/CSS/common.css","css","LyogLS0tLS0tIFNUQVJUOiBNZWFzdXJlbWVudCAtLS0tLS0gKi8NCi5pY29uLWNsZWFyLTI0IHsNCiAgICB3aWR0aDogMjRweDsNCiAgICBoZWlnaHQ6IDI0cHg7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvY2xlYXItMjQucG5nIik7DQp9DQouaWNvbi1lcmFzZS0yNCB7DQogICAgd2lkdGg6IDI0cHg7DQogICAgaGVpZ2h0OiAyNHB4Ow0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9Ub29sYmFyL2VyYXNlLTI0LnBuZyIpOw0KfQ0KLnRvb2xiYXItc21hbGwtbGF5b3V0IC5ob3Jpem9udGFsIC5pY29uLWNsZWFyLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9jbGVhci0xNi5wbmciKTsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KfQ0KLnRvb2xiYXItc21hbGwtbGF5b3V0IC5ob3Jpem9udGFsIC5pY29uLWVyYXNlLTI0IHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvVG9vbGJhci9lcmFzZS0xNi5wbmciKTsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KfQ0KLnRvb2xiYXItaXRlbS5zZWxlY3QtZG91YmxlIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgei1pbmRleDogOTk5Ow0KIH0NCi5Db21wYWN0VG9vbGJhclZpZXcgLnRvb2xiYXItaXRlbS5zZWxlY3QtZG91YmxlIHsNCiAgICB0b3A6IDAuMjVlbTsNCiAgICB3aWR0aDogMTAwcHg7DQp9DQouc2hlbGwtc21hbGwgLkNvbXBhY3RUb29sYmFyVmlldyAudG9vbGJhci1pdGVtLnNlbGVjdC1kb3VibGUgew0KICAgIHdpZHRoOiBpbmhlcml0Ow0KfQ0KLnRvb2xiYXItaXRlbS5zZWxlY3QtZG91YmxlOmhvdmVyLA0KLnRvb2xiYXItaXRlbS5zZWxlY3QtZG91YmxlOmZvY3VzIHsNCiAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Ow0KICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsNCiAgIGN1cnNvcjogZGVmYXVsdDsNCn0NCi50b29sYmFyLWl0ZW0uc2VsZWN0LWRvdWJsZSBzZWxlY3Qgew0KICAgIG1hcmdpbi10b3A6IDAuMjVlbTsNCn0NCi50b29sYmFyLWl0ZW0uc2VsZWN0LWRvdWJsZSBzZWxlY3QgKyBzZWxlY3Qgew0KICAgIG1hcmdpbi10b3A6IDAuNWVtOw0KfQ0KLnRvb2xiYXItaXRlbS5jaGVja2JveCwNCi50b29sYmFyLWl0ZW0uY2hlY2tib3ggaW5wdXQsDQoudG9vbGJhci1pdGVtLmNoZWNrYm94IGxhYmVsIHsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoudG9vbGJhci1pdGVtLmNoZWNrYm94IHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgcGFkZGluZy10b3A6IDAuMjVlbTsNCiAgICB3aWR0aDogNWVtOw0KfQ0KLnRvb2xiYXItaXRlbS5jaGVja2JveCBsYWJlbCB7DQogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIGxpbmUtaGVpZ2h0OiAxLjI1ZW07DQp9DQoudG9vbGJhci1pdGVtLmNoZWNrYm94IGlucHV0IHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBtYXJnaW46IDAuNWVtIGF1dG8gMC4zNWVtIGF1dG87DQogICAgd2lkdGg6IDI0cHg7IC8qIE1hdGNoaW5nIHdpZHRoIGFuZCBoZWlnaHQgdG8gdG9vbGJhciBpY29uIHNpemUgKi8NCiAgICBoZWlnaHQ6IDI0cHg7DQp9DQoudG9vbGJhci1pdGVtLm11bHRpLXRvb2wgew0KICAgIG1hcmdpbi1ib3R0b206IDA7DQp9DQoudG9vbGJhci1pdGVtLm11bHRpLXRvb2wsDQoubXVsdGktdG9vbC1idXR0b24gew0KICAgIHdpZHRoOiA1ZW07DQp9DQoubmVzdGVkLWdyb3VwIC5tdWx0aS10b29sLWJ1dHRvbiB7DQogICAgZm9udC1zaXplOiAwLjkzNzNlbTsNCiAgICB3aWR0aDogNS4zNzllbTsNCiAgICBwYWRkaW5nLXRvcDogMDsNCiAgICBwYWRkaW5nLWJvdHRvbTogMDsNCiAgICBtYXJnaW46IDA7DQp9DQoudG9vbGJhci1ib2R5IC50b29sYmFyLXJlZ2lvbiB1bC50cmFuc2llbnQtbWVhc3VyZW1lbnQgbGkgew0KICAgIG1hcmdpbjogMCAwLjI1ZW07DQp9DQoudHJhbnNpZW50LW1lYXN1cmVtZW50IC50b29sYmFyLWl0ZW0uYnV0dG9uIHsNCiAgICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQovKiAtLS0tLS0gRU5EOiBNZWFzdXJlbWVudCAtLS0tLS0gKi8NCg0KDQovKiBTVEFSVDogTWVhc3VyZW1lbnQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCi5tZWFzdXJlbWVudC10b29sYmFyLXZpZXcgew0KICAgIG1hcmdpbi10b3A6IC0wLjI1ZW07DQogICAgcGFkZGluZy1yaWdodDogMC41ZW07DQp9DQoubWVhc3VyZW1lbnQtdG9vbGJhci12aWV3IC50b29sYmFyLXNtYWxsLWxheW91dCAudG9vbGJhci1pdGVtIHsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQoubWVhc3VyZW1lbnQtdG9vbGJhci12aWV3IC50b29sYmFyLWl0ZW0uc2VsZWN0IHNlbGVjdCB7DQogICAgZm9udC1zaXplOiAwLjhlbTsNCiAgICBjb2xvcjogIzY1NjE4OTsNCiAgICBtYXJnaW46IDAuN2VtIDA7DQp9DQoudG9vbGJhci1ib2R5IC5tZWFzdXJlbWVudC10b29sYmFyLXZpZXcgLnRvb2xiYXItc21hbGwtbGF5b3V0IC50b29sYmFyLWl0ZW0uY2hlY2tib3ggew0KICAgIHBhZGRpbmc6IDAuN2VtIDAgMCAwOw0KICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCgktbW96LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQoJYm94LXNpemluZzogYm9yZGVyLWJveDsgDQogICAgdmVydGljYWwtYWxpZ246IHRvcDsNCn0NCi50b29sYmFyLWJvZHkgLm1lYXN1cmVtZW50LXRvb2xiYXItdmlldyAudG9vbGJhci1zbWFsbC1sYXlvdXQgLnRvb2xiYXItaXRlbS5jaGVja2JveCBpbnB1dCB7DQogICAgbGVmdDogMCAhaW1wb3J0YW50Ow0KICAgIHRvcDogMC41ZW0gIWltcG9ydGFudDsNCiAgICBoZWlnaHQ6IDFlbTsNCn0NCi50b29sYmFyLWJvZHkgLm1lYXN1cmVtZW50LXRvb2xiYXItdmlldyAudG9vbGJhci1zbWFsbC1sYXlvdXQgLnRvb2xiYXItaXRlbS5jaGVja2JveCBsYWJlbCB7DQogICAgcGFkZGluZy1sZWZ0OiAxLjVlbTsNCiAgICBoZWlnaHQ6IDEuNWVtOw0KfQ0KLmljb24gew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQp9DQoudGJvLWJ0biAuaWNvbiB7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgbWFyZ2luLXJpZ2h0OiAwLjVlbTsNCn0NCi5pY29uLWNsZWFyLTE2IHsNCiAgICB3aWR0aDogMTZweDsNCiAgICBoZWlnaHQ6IDE2cHg7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL1Rvb2xiYXIvY2xlYXItMTYucG5nIik7DQp9DQouaWNvbi1lcmFzZS0xNiB7DQogICAgd2lkdGg6IDE2cHg7DQogICAgaGVpZ2h0OiAxNnB4Ow0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9Ub29sYmFyL2VyYXNlLTE2LnBuZyIpOw0KfQ0KLmhpZ2hsaWdodCB7DQogICAgYm9yZGVyOiAxcHggc29saWQgI0M4RTlGRjsNCiAgICBiYWNrZ3JvdW5kOiAjRkJGREZGOw0KfQ0KDQovKiBFTkQ6IE1lYXN1cmVtZW50IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQoNCi8qIC0tLS0tLSBTVEFSVDogQ29tcGFjdCBUb29sYmFyIC0tLS0tLSAqLw0KLmZseW91dC1tZW51LXRyYW5zaWVudC1tZWFzdXJlbWVudCAudG9vbGJhci1zbWFsbC1sYXlvdXQgew0KICAgIGZsb2F0OiBsZWZ0Ow0KICAgIHBhZGRpbmctbGVmdDogOWVtICFpbXBvcnRhbnQ7DQp9DQouZmx5b3V0LW1lbnUtdHJhbnNpZW50LW1lYXN1cmVtZW50IGxpIHsNCiAgICBtYXJnaW46IDFweDsNCn0NCi5mbHlvdXQtbWVudS10cmFuc2llbnQtbWVhc3VyZW1lbnQgLnRvb2xiYXItaXRlbS5zZWxlY3Qgew0KICAgIGxlZnQ6IDA7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHRvcDogMDsNCiAgICB3aWR0aDogOGVtICFpbXBvcnRhbnQ7DQogICAgcGFkZGluZzogMC41ZW0gMDsNCn0NCi5mbHlvdXQtbWVudS10cmFuc2llbnQtbWVhc3VyZW1lbnQgLnRvb2xiYXItaXRlbS5zZWxlY3QgKyAudG9vbGJhci1pdGVtLnNlbGVjdCB7DQogICAgdG9wOiBhdXRvOw0KICAgIGJvdHRvbTogMDsNCn0NCi5mbHlvdXQtbWVudS10cmFuc2llbnQtbWVhc3VyZW1lbnQgLnRvb2xiYXItaXRlbS5jaGVja2JveCB7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHBhZGRpbmctdG9wOiAwLjI1ZW07DQp9DQovKiAtLS0tLS0gRU5EOiBDb21wYWN0IFRvb2xiYXIgLS0tLS0tICovDQovKiAtLS0tLS0gU1RBUlQ6IE5vIExhYmVsIExheW91dCAtLS0tLS0gKi8NCi5uby1sYWJlbCAudHJhbnNpZW50LXRvb2xiYXIuaGFzLW5laWdoYm91ci10cmFuc2llbnQgew0KICAgIHBhZGRpbmctbGVmdDogMDsNCglkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQoJZmxvYXQ6IHJpZ2h0Ow0KfQ0KLlRhYmJlZFRvb2xiYXJWaWV3IC5uby1sYWJlbCAudHJhbnNpZW50LXRvb2xiYXIgKyAudHJhbnNpZW50LW1lYXN1cmVtZW50IHsJDQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHRvcDogYXV0bzsNCglkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQp9DQoubm8tbGFiZWwgLnRyYW5zaWVudC1tZWFzdXJlbWVudCAudG9vbGJhci1pdGVtLnNlbGVjdC1kb3VibGUgew0KCWRpc3BsYXk6IGJsb2NrOw0KICAgIG1heC13aWR0aDogMTAwJTsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQp9DQoubm8tbGFiZWwgLnRvb2xiYXItaXRlbS5zZWxlY3QtZG91YmxlIHNlbGVjdCB7DQogICAgd2lkdGg6IDcuNWVtOw0KCW1pbi13aWR0aDogMWVtOw0KCWRpc3BsYXk6IGlubGluZS1ibG9jazsNCgltYXJnaW46IDAuMzc1ZW0gMCAwIDA7DQp9DQoubm8tbGFiZWwgLnJlZ2lvbi1hY3RpdmVbZGF0YS1yZWdpb24tbmFtZT0iTWVhc3VyZW1lbnRUb29sQ29udHJvbFJlZ2lvbiJdIHsNCgliYWNrZ3JvdW5kLWNvbG9yOiAjRjhGOEY4Ow0KCWJvcmRlcjogMXB4IHNvbGlkICNEREREREQ7DQoJYm9yZGVyLXJhZGl1czogMC4yNXJlbTsNCgltYXJnaW46IDAuMTI1ZW0gMCAwLjJlbTsNCglvdmVyZmxvdzogaGlkZGVuOw0KCXBhZGRpbmc6IDA7DQoJcG9zaXRpb246IHJlbGF0aXZlOw0KCXotaW5kZXg6IDYwMDsNCgloZWlnaHQ6IDIuNWVtOw0KfQ0KLm5vLWxhYmVsIC5yZWdpb24tYWN0aXZlW2RhdGEtcmVnaW9uLW5hbWU9Ik1lYXN1cmVtZW50VG9vbENvbnRyb2xSZWdpb24iXSAudHJhbnNpZW50LXRvb2xiYXIgew0KCWJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Ow0KCWJvcmRlcjogbm9uZTsNCgltYXJnaW46IDA7DQoJcGFkZGluZzogMDsNCn0NCi8qIC0tLS0tLSBFTkQ6IE5vIExhYmVsIExheW91dCAtLS0tLS0gKi8="),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/CSS/small.css","css","DQovKiBTVEFSVDogTWVhc3VyZW1lbnQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCg0KLnRidG0tc2VsZWN0IHsNCiAgICB3aWR0aDogMTAwJTsNCn0NCnVsID4gbGkudG9vbGJhci1pdGVtLnNlbGVjdC1kb3VibGUgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIG1heC13aWR0aDogMTAwJTsNCn0NCi50b29sYmFyLWl0ZW0uc2VsZWN0LWRvdWJsZSBzZWxlY3Qgew0KICAgIG1hcmdpbjogMC41ZW07DQogICAgcGFkZGluZzogMWVtOw0KICAgIHdpZHRoOiAyMCU7DQogICAgZmxvYXQ6IGxlZnQ7DQogICAgaGVpZ2h0OiAzLjVlbTsNCn0NCg0KLyogRU5EOiBNZWFzdXJlbWVudCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/MeasurementUnitSwitcherView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/MeasurementView.html","html",r),e.resourceManager.register("Mapping","inv","Mapping/modules/Measurement/Widgets/MeasurementTransientView.html","html",a)}),require({cache:{}}),define(["Mapping/modules/Measurement/HighlightedMeasurementLabel","Mapping/modules/Measurement/MeasurementMarkupManager","Mapping/modules/Measurement/MeasurementModule","Mapping/modules/Measurement/MeasurementOperation","Mapping/modules/Measurement/MeasurementTool","Mapping/modules/Measurement/MeasurementUtils","Mapping/modules/Measurement/MeasurementView","Mapping/modules/Measurement/MeasurementViewModel","Mapping/modules/Measurement/Descriptors/DescriptorBase","Mapping/modules/Measurement/Descriptors/GeometryDescriptor","Mapping/modules/Measurement/Descriptors/LineSegmentDescriptor"],function(e,t,r,a,i,n,s,o,u,m,l){p(e,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.HighlightedMeasurementLabel",e.HighlightedMeasurementLabel),p(t,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementMarkupManager",t.MeasurementMarkupManager),p(r,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementModule",r.MeasurementModule),p(a,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementOperation",a.MeasurementOperation),p(i,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementTool",i.MeasurementTool),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getUnitString",n.getUnitString),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getGeometryServiceUnitConstant",n.getGeometryServiceUnitConstant),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.addGraphicToLayer",n.addGraphicToLayer),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getGraphicsLayer",n.getGraphicsLayer),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getLabelSize",n.getLabelSize),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getRenderedLineSegmentLength",n.getRenderedLineSegmentLength),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.plotPointOnMap",n.plotPointOnMap),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.addHighlightedLabelToMap",n.addHighlightedLabelToMap),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.getTextLines",n.getTextLines),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.svgRoundedRectanglePath",n.svgRoundedRectanglePath),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.refreshHighlightSymbolSize",n.refreshHighlightSymbolSize),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.convertLength",n.convertLength),p(n,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementUtils.convertArea",n.convertArea),p(s,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementView",s.MeasurementView),p(o,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.MeasurementViewModel",o.MeasurementViewModel),p(u,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.DescriptorType",u.DescriptorType),p(u,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.DescriptorBase",u.DescriptorBase),p(m,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.GeometryDescriptor",m.GeometryDescriptor),p(l,"geocortex.essentialsHtmlViewer.mapping.modules.measurement.LineSegmentDescriptor",l.LineSegmentDescriptor)})}();