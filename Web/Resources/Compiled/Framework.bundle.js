require({cache:{"geocortex/framework/behaviors/TypedBehavior":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/Behaviors":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/events/TypedEvent":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/utils/ThrottledOperation":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i){this.period=100,this.isActive=!1,this._setTimeoutToken=null,this.period=void 0==e?0:e,this.action=t,this.cancelAction=i;var r=this;this._setTimeoutToken=setTimeout(function(){r.execute(r)},this.period)}return e.prototype.cancel=function(){this._setTimeoutToken&&(clearTimeout(this._setTimeoutToken),this._setTimeoutToken=null,this.isActive=!1,this.cancelAction&&this.cancelAction())},e.prototype.execute=function(e){e.isActive=!0;var t=e.action();null!==e._setTimeoutToken&&t?e._setTimeoutToken=setTimeout(function(){e.execute(e)},e.period):(e._setTimeoutToken=null,e.isActive=!1)},e}();t.ThrottledOperation=i})},"geocortex/framework/events/CollectionChangedArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.sender=null,this.type="append",this.rangeStart=0,this.rangeEnd=0}return e}();t.CollectionChangedArgs=i})},"geocortex/framework/observables":function(){define(["require","exports","geocortex/framework/events/Event","geocortex/framework/events/CollectionChangedArgs"],function(e,t,i,r){"use strict";var n=function(){function e(e){this.bindingEvent=new i.Event("__anonymous"),this._syncToken=null,this._syncSource=null,this.value=e}return e.prototype.set=function(e){this.value=e,this.bindingEvent.publish(e)},e.prototype.get=function(){return this.value},e.prototype.equals=function(e){var t=e;if(e&&e.get&&"function"==typeof e.get&&(t=e.get()),this.value instanceof Array&&t instanceof Array){if(this.value.length!==t.length)return!1;for(var i=0;i<this.value.length;i++)if(this.value[i]!==t[i])return!1;return!0}return this.get()===t},e.makeBindableProxy=function(t){if(!t)return null;var i=[];if(t.___clonedObject)return t.___clonedObject;var r=function(){throw new Error("Can't make method calls on a bindable proxy.")},n=function(t,a,s){for(var l=0;l<i.length;++l)if(a===i[l])return i[l];if(i.push(a),a&&"string"!=typeof a&&"number"!=typeof a&&"boolean"!=typeof a){if(a instanceof Array){for(var u=new o,l=0;l<a.length;++l){var c={};c=n(l,a[l],a),u.addItem(c)}return u}if(a instanceof Object){if(a.isObservable)return a;var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=n(d,a[d],a));return c}return a instanceof Function?r:a}var h=new e(a);return function(){h.set=function(e){s[t]=e,h.value=e,h.bindingEvent.publish(e)},h.get=function(){return s[t]}}(),h},a={root:t},s=n("root",a,t);return t.___clonedObject=s.root,t instanceof Array?s.root:new e(s.root)},e.prototype.bind=function(e,t){return this.bindingEvent.subscribe(e,t)},e.prototype.unbind=function(e){return this.bindingEvent.unsubscribe(e)},e.prototype.once=function(e,t){var i=this,r=this.bind(e,function(){i.unbind(r),t.apply(e,arguments)});return r},e.prototype.sync=function(e){this.removeSync(),e&&(this.set(e.get()),this._syncSource=e,this._syncToken=e.bindingEvent.subscribe(this,function(e){this.set(e)}))},e.prototype.removeSync=function(){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null)},e.prototype.syncTransform=function(e,t){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null),e&&(this.set(t(e.get())),this._syncSource=e,this._syncToken=e.bindingEvent.subscribe(this,function(e){this.set(t(e))}))},e.prototype.pulse=function(){this.set(this.get())},e}();t.Observable=n,n.prototype.isObservable=!0;var o=function(){function e(e){this.bindingEvent=new i.Event("__anonymous"),this.useThrottling=!1,this.throttledOperations=null,this._syncSource=null,this.value=e||[]}return e.prototype.isEmpty=function(){return 0===this.value.length},e.prototype.length=function(){return this.value.length},e.prototype.contains=function(e){return Array.contains(this.value,e)},e.prototype.getAt=function(e){return this.value[e]},e.prototype.getRange=function(e,t){return void 0===t?this.value.slice(e):this.value.slice(e,t+1)},e.prototype.indexOf=function(e){return this.value.indexOf(e)},e.prototype.get=function(){return this.value},e.prototype.getItems=function(){return this.value},e.prototype.getLength=function(){return this.value.length},e.prototype.addItems=function(e){if(e&&!(e.length<1)){var t=new r.CollectionChangedArgs;t.type="append",t.rangeStart=this.value.length,this.value=this.value.concat(e),t.rangeEnd=t.rangeStart+e.length-1,t.sender=this,this.bindingEvent.publish(t)}},e.prototype.addItem=function(e){var t=new r.CollectionChangedArgs;t.type="append",t.rangeStart=this.value.length,t.rangeEnd=this.value.length,this.value.push(e),t.sender=this,this.bindingEvent.publish(t)},e.prototype.insertItems=function(e,t){if(0!=t.length){if(e>=this.value.length)return void this.addItems(t);var i=new r.CollectionChangedArgs;i.type="insert",i.rangeStart=e,i.rangeEnd=e+t.length-1,i.sender=this;for(var n=0;n<t.length;++n)this.value.splice(e+n,0,t[n]);this.bindingEvent.publish(i)}},e.prototype.insertItem=function(e,t){if(e>=this.value.length)return void this.addItem(t);var i=new r.CollectionChangedArgs;i.type="insert",i.rangeStart=e,i.rangeEnd=e,i.sender=this,this.value.splice(e,0,t),this.bindingEvent.publish(i)},e.prototype.removeItem=function(e){for(var t;(t=Array.pos(this.value,e))>-1;){var i=new r.CollectionChangedArgs;i.type="remove",i.rangeStart=t,i.rangeEnd=t,i.sender=this,this.bindingEvent.publish(i),Array.remove(this.value,t,t)}},e.prototype.removeAt=function(e){if(0<=e&&e<this.getLength()){var t=new r.CollectionChangedArgs;t.type="remove",t.rangeStart=e,t.rangeEnd=e,t.sender=this,this.bindingEvent.publish(t),Array.remove(this.value,e,e)}},e.prototype.removeRange=function(e,t){t||0===t||(t=this.value.length);var i=new r.CollectionChangedArgs;i.type="remove",i.rangeStart=e,i.rangeEnd=Math.min(t,this.value.length),i.sender=this,this.bindingEvent.publish(i),Array.remove(this.value,e,t)},e.prototype.removeWhere=function(e){if(e)for(var t=this.value.length-1;t>=0;t--)if(e(this.value[t])){var i=new r.CollectionChangedArgs;i.type="remove",i.rangeStart=t,i.rangeEnd=t,i.sender=this,this.bindingEvent.publish(i),Array.remove(this.value,t,t)}},e.prototype.clear=function(){if(this.value&&0!=this.value.length){var e=new r.CollectionChangedArgs;e.type="clear",e.rangeStart=0,e.rangeEnd=this.value.length-1,e.sender=this,this.bindingEvent.publish(e),this.value.length=0}},e.prototype.set=function(e){this.clear(),e&&this.addItems(e)},e.prototype.pulse=function(){var e=new r.CollectionChangedArgs;e.type="clear",e.rangeStart=0,e.rangeEnd=this.value.length-1,e.sender=this,this.bindingEvent.publish(e),e=new r.CollectionChangedArgs,e.type="append",e.rangeStart=0,e.rangeEnd=this.value.length-1,e.sender=this,this.bindingEvent.publish(e)},e.prototype.bind=function(e,t){return this.bindingEvent.subscribe(e,t)},e.prototype.unbind=function(e){return this.bindingEvent.unsubscribe(e)},e.prototype.once=function(e,t){var i=this,r=i.bind(e,function(){i.unbind(r),t.apply(e,arguments)});return r},e.prototype.sync=function(e){e.value&&e.bindingEvent&&(this.clear(),this.value=e.value,e.bindingEvent.subscribe(this,function(t){this.value=e.value;var i=new r.CollectionChangedArgs;dojo.mixin(i,t),i.sender=this,this.bindingEvent.publish(i),"clear"===t.type&&(this.value=[])}))},e.prototype.equals=function(e){var t=e;if(e&&e.isObservableCollection&&(t=e.get()),!t.hasOwnProperty("length"))throw new Error("Type mismatch");if(this.get().length!==t.length)return!1;for(var i=0;i<this.get().length;i++)if(this.value[i]!==t[i])return!1;return!0},e}();t.ObservableCollection=o,o.prototype.isObservable=!0,o.prototype.isObservableCollection=!0})},"geocortex/framework/utils/utils":function(){define(["require","exports"],function(e,t){"use strict";function i(e){return"undefined"!=typeof e}function r(e){return null===e||!i(e)}function n(e){if(0===e.indexOf("http"))return e;var t="{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if("/"!=t.charAt(t.length-1)||"\\"!=t.charAt(t.length-1)){var i=t.split("/");--i.length,t=i.join("/"),t+="/"}return e="/"===e.charAt(0)||"\\"===e.charAt(0)?window.location.protocol+"//"+window.location.host+"/"+e.substring(1):t+e}function o(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i=e||8,r="",n=0;n<i;n++){var o=Math.floor(Math.random()*t.length);r+=t.substring(o,o+1)}return r}function a(e){var t,i,r,n,o,a,s,l="",u=0;for(e=this.utf8Encode(e);u<e.length;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),r=e.charCodeAt(u++),n=t>>2,o=(3&t)<<4|i>>4,a=(15&i)<<2|r>>6,s=63&r,isNaN(i)?a=s=64:isNaN(r)&&(s=64),l=l+this.base64keyStr.charAt(n)+this.base64keyStr.charAt(o)+this.base64keyStr.charAt(a)+this.base64keyStr.charAt(s);return l}function s(e){var t="";if(!e||""===e)return t;var i,r,n,o,a,s,l,u=0,c=/[^A-Za-z0-9\+\/\=]/g;if(c.exec(e))throw new Error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=this.base64keyStr.indexOf(e.charAt(u++)),a=this.base64keyStr.indexOf(e.charAt(u++)),s=this.base64keyStr.indexOf(e.charAt(u++)),l=this.base64keyStr.indexOf(e.charAt(u++)),i=o<<2|a>>4,r=(15&a)<<4|s>>2,n=(3&s)<<6|l,t+=String.fromCharCode(i),64!=s&&(t+=String.fromCharCode(r)),64!=l&&(t+=String.fromCharCode(n)),i=r=n=null,o=a=s=l=null;while(u<e.length);return t=this.utf8Decode(t)}function l(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}function u(e){for(var t="",i=0,r=0,n=0,o=0;i<e.length;)r=e.charCodeAt(i),r<128?(t+=String.fromCharCode(r),i++):r>191&&r<224?(n=e.charCodeAt(i+1),t+=String.fromCharCode((31&r)<<6|63&n),i+=2):(n=e.charCodeAt(i+1),o=e.charCodeAt(i+2),t+=String.fromCharCode((15&r)<<12|(63&n)<<6|63&o),i+=3);return t}function c(e){if(!e||"string"!=typeof e)return!1;var t=e.trim().toLowerCase();return t.length>=7&&0===t.indexOf("http://")||t.length>=8&&0===t.indexOf("https://")}function d(e){return!r(e)&&/^(\d+|\d*[.]\d+)%$/.test(e)}function h(e,t,i){return e<t?t:e>i?i:e}function p(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}t.base64keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.isDefined=i,t.isNullOrUndefined=r,t.makeUrlAbsolute=n,t.alphaNumericToken=o,t.base64Encode=a,t.base64Decode=s,t.utf8Encode=l,t.utf8Decode=u,t.isUrl=c,t.isPercentage=d,t.clamp=h,t.addEventListener=p})},"geocortex/framework/commands/Command":function(){define(["require","exports","geocortex/framework/events/Event","geocortex/framework/utils/utils","geocortex/framework/FrameworkObject"],function(e,t,i,r,n){"use strict";var o=function(){function e(e,t,i){this.impl=e,this.scope=t,this.canExecute=i}return e}(),a=function(){function e(e,t,r){this._entries={},this.app=null,this.name=e,this.app=t,this.isWrapper=!0,this.canExecuteChanged=new i.Event("{0}.CanExecuteChanged".format(e)),this.preExecute=new i.Event("{0}.PreExecute".format(e)),this.postExecute=new i.Event("{0}.PostExecute".format(e)),this.canExecuteMode=null!=r&&void 0!=r?r:"all"}return e.prototype.raiseCanExecuteChanged=function(){this.canExecuteChanged.publish()},e.prototype.canExecute=function(e){if(this.isWrapper)return!1;for(var t in this._entries)if(this._entries.hasOwnProperty(t)){var i=this._entries[t];if(i.canExecute&&i.canExecute.apply(i.scope,arguments)){if("any"===this.canExecuteMode)return!0}else if("all"===this.canExecuteMode)return!1}return"any"!==this.canExecuteMode},e.prototype.execute=function(e){var t=!1;if(this._entries)for(var i in this._entries)if(this._entries.hasOwnProperty(i)){t=!0;break}if(!t)return void this.app.trace.debug("Command '{0}' executed but no implementation registered.".format(this.name));if("all"!==this.canExecuteMode||this.canExecute.apply(this,arguments)){if(this.app&&this.app.debugMode){var r="Command '{0}' executed.".format(this.name);console.debug?console.debug(r):console.log(r)}this.preExecute.publish.apply(this.preExecute,arguments);for(var i in this._entries)if(this._entries.hasOwnProperty(i)){var n=this._entries[i];("any"!==this.canExecuteMode||n.canExecute.apply(n.scope,arguments))&&n.impl.apply(n.scope,arguments)}this.postExecute.publish.apply(this.postExecute,arguments)}},e.prototype.register=function(e,t,i){this.isWrapper=!1;var a=r.alphaNumericToken(),s=new o(t,e,i||this.defaultCanExecuteFunction);return this._entries[a]=s,e&&e instanceof n.FrameworkObject&&e.trackCommandHandler(this,a),this.app.trace.debug("Registered an implementation for command '{0}'.".format(this.name)),this.raiseCanExecuteChanged(),a},e.prototype.defaultCanExecuteFunction=function(){return!0},e.prototype.unregister=function(e){return this.isWrapper=!1,!!this._entries.hasOwnProperty(e)&&(delete this._entries[e],this.app.trace.debug("Unregistered an implementation for command '{0}'.".format(this.name)),this.raiseCanExecuteChanged(),!0)},e.prototype.clear=function(){this._entries={},this.raiseCanExecuteChanged(),this.app.trace.debug("Cleared all implementations of command '{0}'.".format(this.name))},e}();t.Command=a})},"geocortex/framework/FrameworkObject":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.dojoConnects=[],this.observableBindings=[],this.eventSubscriptions=[],this.commandHandlers=[],this.app=e,this.libraryId=t}return e.prototype.auto=function(e,t,i){if(3===arguments.length&&"string"==typeof t)this.dojoConnects.push(dojo.connect(e,t,i));else if(2===arguments.length&&t instanceof Function){var r=e.bind(e,t);this.observableBindings.push({obj:e,token:r})}else if(3===arguments.length&&i instanceof Function){var r=e.bind(t,i);this.observableBindings.push({obj:e,token:r})}},e.prototype.trackSubscription=function(e,t){this.eventSubscriptions.push({event:e,token:t})},e.prototype.trackCommandHandler=function(e,t){this.commandHandlers.push({command:e,token:t})},e.prototype.onDestroy=function(){},e.prototype.destroy=function(){for(var e=0;e<this.dojoConnects.length;++e)dojo.disconnect(this.dojoConnects[e]);this.dojoConnects=[];for(var e=0;e<this.observableBindings.length;++e){var t=this.observableBindings[e].obj,i=this.observableBindings[e].token;t.unbind(i)}this.observableBindings=[];for(var e=0;e<this.eventSubscriptions.length;++e){var r=this.eventSubscriptions[e].event,i=this.eventSubscriptions[e].token;r.unsubscribe(i)}this.eventSubscriptions=[];for(var e=0;e<this.commandHandlers.length;++e){var n=this.commandHandlers[e].command,i=this.commandHandlers[e].token;n.unregister(i)}this.commandHandlers=[],this.onDestroy()},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();t.FrameworkObject=i})},"geocortex/framework/ui/BindingExpression":function(){define(["require","exports"],function(e,t){"use strict";var i=/^on/,r=function(){function t(){this.domElement=null,this.type="attr",this.attributeName=null,this.target=null,this.invert=!1,this._dojoDomEvents=[],this.targetBindings=[],this.templateMode=null,this.templateKey=null,this.templateSelections={},this.parentView=null,this.boundViews=[],this.viewModel=null}return t.prototype.on=function(t,r){var n=this;if(t&&r){if(!this.domElement)throw new Error("Cannot bind before domElement is set.");i.test(t)&&(t=t.substring(2)),e(["dojo/on"],function(e){var i=e(n.domElement,t,r);n._dojoDomEvents.push(i)})}},t.prototype.destroy=function(){if(this.templateSelections)for(var e in this.templateSelections)if(this.templateSelections.hasOwnProperty(e)){var t=this.templateSelections[e];if(t&&t.___domParent){var i=t.___domParent;dojo.place(t,i,"last")}}this.domElement=null,this.target=null,this.parentView=null,this.viewModel=null;for(var r=0;r<this._dojoDomEvents.length;++r)this._dojoDomEvents[r].remove();for(this._dojoDomEvents.length=0,r=0;r<this.targetBindings.length;++r)this.targetBindings[r].event.unsubscribe(this.targetBindings[r].token);this.targetBindings=[];for(var r=0;r<this.boundViews.length;++r)this.boundViews[r].destroyBindings();this.boundViews=[]},t}();t.BindingExpression=r})},"geocortex/framework/ui/BindingNode":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.domElement=null,this.parent=null,this.children=[],this.expressions=[],this.context=null,this.contextChange=!1,this.domElement=null,this.parent=null,this.context=null}return e.prototype.destroy=function(){this.domElement=null,this.parent=null,this.context=null,this.contextChange=!1;for(var e=0;e<this.expressions.length;++e)this.expressions[e].destroy();this.expressions=[];for(var e=0;e<this.children.length;++e)this.children[e].destroy();this.children=[]},e}();t.BindingNode=i})},"geocortex/framework/ui/DisposableBinding":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/ui/ViewModelBase":function(){define(["require","exports","geocortex/framework/FrameworkObject"],function(e,t,i){"use strict";var r=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.initialize=function(e){},t.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},t}(i.FrameworkObject);t.ViewModelBase=r})},"geocortex/framework/config/ViewConfig":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i){this.viewId=e,this.moduleName=t,this.typeName=i}return e}();t.ViewConfig=i})},"geocortex/framework/ui/BindingInterfaces":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/config/WidgetConfig":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.viewModelType=null,this.configuration={},this.typeName="",this.markup="",this.id=e,this.libraryId=t}return e}();t.WidgetConfig=i})},"geocortex/framework/ui/ViewBase":function(){define(["require","exports","geocortex/framework/FrameworkObject","geocortex/framework/observables","geocortex/framework/ui/BindingNode","geocortex/framework/utils/utils","geocortex/framework/ui/BindingExpression","geocortex/framework/config/ViewConfig","geocortex/framework/events/CollectionChangedArgs","geocortex/framework/ui/ViewModelBase","geocortex/framework/utils/ThrottledOperation","geocortex/framework/config/WidgetConfig"],function(e,t,i,r,n,o,a,s,l,u,c,d){"use strict";var h=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.isActive=!1,n.isManaged=!1,n.isBusy=new r.Observable((!1)),n.title=new r.Observable(""),n.description=new r.Observable(""),n.iconUri=new r.Observable(""),n.markupResource=null,n.viewModel=null,n.regionName="",n.typeName="",n.root=null,n.bindingTree=null,n.parentView=null,n.childRegions=[],n.bound=!1,n.initiallyBound=!1,n.disposableBindings=[],n.bindingSetupDelegates=[],n.id="View-"+o.alphaNumericToken(),n}return __extends(t,e),t.prototype.addDisposableBinding=function(e,t){this.disposableBindings.push({event:e.bindingEvent,token:t})},t.prototype.attach=function(e){this.bound||(this.viewModel=e,this.root&&(this.bindingTree=this.buildTree(),null!==this.viewModel&&void 0!==this.viewModel&&this.pulseAll(),this.bound=!0,this.initiallyBound||(this.initiallyBound=!0,this.app.event("ViewInitializedEvent").publish(this))))},t.prototype.activated=function(){},t.prototype.deactivated=function(){},t.prototype.added=function(e){!this.bound&&this.viewModel&&(this.bindingTree=this.buildTree(),this.bound=!0,this.pulseAll(),this.initiallyBound||(this.initiallyBound=!0,this.app.event("ViewInitializedEvent").publish(this)))},t.prototype.removed=function(){this.destroyBindings()},t.prototype.destroy=function(){this.destroyBindings(),e.prototype.destroy.call(this)},t.prototype.destroyBindings=function(){if(this.isActive&&this.app.viewManager.deactivateView(this),this.bindingTree){this.bindingTree.destroy();for(var e=0;e<this.disposableBindings.length;++e){var t=this.disposableBindings[e];t.event.unsubscribe(t.token)}this.bound=!1,this.disposableBindings=[],this.bindingSetupDelegates=[]}},t.prototype.pulseAll=function(){for(var e=0;e<this.bindingSetupDelegates.length;++e)try{this.bindingSetupDelegates[e]()}catch(t){this.app.trace.error("Error performing initial data-bind in view '{0}' with view model '{1}': {2}".format(this.id,this.viewModel.id,t.message),t)}this.bindingSetupDelegates=[]},t.prototype.resolveWidget=function(e,t,i){return null},t.prototype.buildTree=function(){var e=this;if(null!=this.root){var t=function(i,r){var o=function(t){var i=[];if(!t)return i;var r=t.match(/\{(.*?)\}/g);if(!r){if(e.app)return e.app.trace.warning("Invalid data-binding expression '{0}'.".format(t)),[];throw new Error("Invalid data-binding expression '{0}'.".format(t))}for(var n=0;n<r.length;++n){var o=r[n],a=o.split(":");2==a.length&&i.push({directive:a[0].replace("{","").trim(),target:a[1].replace("}","").trim()})}return i};if(r&&r.children)for(var l=0;l<r.children.length;++l){var u=r.children[l],c=dojo.attr(u,"data-region-name"),d=dojo.attr(u,"data-binding");if(d||(d=u.___dataBindingExpressions),d){var h=o(d);if(u.___dataBindingExpressions=d,e.app.debugMode||dojo.removeAttr(u,"data-binding"),!h||0===h.length)continue;for(var p=!1,f=0;f<h.length;++f)!function(){var t=i.expressions,r=i.context,n=!1,l=h[f],c=l.directive,d=l.target,g=new a.BindingExpression;if(g.domElement=u,g.target=d,null!=e.viewModel?g.viewModel=e.viewModel:(g.viewModel={},g.viewModel.id="[None]"),e.parentView?g.parentView=e.parentView:g.parentView=e,c.startsWith("@")){var v=c.split("-")[1];if(c.startsWith("@event-"))v?(g.type="event",g.attributeName=v):(e.app.trace.warning("Binding error: Invalid event binding expression '{0}' in view '{1}'.".format(c,e.id)),n=!0);else if(c.startsWith("@var"))g.type="var";else if(c.startsWith("@text"))g.attributeName="innerHTML",g.type="text";else if(c.startsWith("@attach"))g.attributeName="___attachedValue",g.type="attachment";else if(c.startsWith("@style-")){var m=c.indexOf("-"),y=c.substring(m+1);y?(g.type="style",g.attributeName=y):(e.app.trace.warning("Binding error: Invalid style binding expression '{0}' in view '{1}'.".format(c,e.id)),n=!0)}else if(c.startsWith("@dom"))g.type="dom",g.attributeName=v;else if(c.startsWith("@value"))g.type="value",g.attributeName=v;else if(c.startsWith("@widget"))g.type=c.substring(1),g.attributeName=v,g.otherExpressions=h;else if(c.startsWith("@class")||c.startsWith("@noclass")){g.type="class",c.startsWith("@noclass")&&(g.invert=!0);var w=c.indexOf("-"),b=c.substring(w+1);b?g.attributeName=b:(e.app.trace.warning("Binding error: Invalid class binding expression '{0}' in view '{1}'.".format(c,e.id)),n=!0)}else if("@source"===c){g.type="source",g.attributeName="@source",p=!0;g.templateMode="single-inline";for(var _=0;_<h.length;++_){var k=h[_];if(k!==l){var E=k.directive,C=k.target;if("@template"===E){g.templateMode="single-external";var x=new s.ViewConfig(null,null,null);x.markupResource=C,x.libraryId=e.libraryId;var M=e.app.viewManager.createView(x);if(!M){e.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(C,e.id));break}M.app=e.app,g.templateSelections={"@default":M.root};break}if("@template-selector"===E){g.templateMode="inline-selected",g.templateKey=C,g.templateSelections={};break}}}if("single-external"!==g.templateMode){for(var S=new dojo.NodeList,I=0;I<u.children.length;++I)for(var V=u.children[I],T=dojo.attr(V,"data-binding"),j=o(T),A=0;A<j.length;++A){var R=j[A];if("@template-for"===R.directive||"@template-select"===R.directive){if("@template-for"===R.directive&&R.target===g.target){S.push(V);var M=dojo.clone(V);g.templateSelections["@default"]=M,M.___domParent=u}else if("@template-select"===R.directive){S.push(V);for(var O=!1,N=0;N<j.length;++N){var B=j[N];if("@template"===B.directive){var D=new s.ViewConfig(null,null,null);D.markupResource=B.target,D.libraryId=e.libraryId;var M=e.app.viewManager.createView(D);if(!M){e.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(B.target,e.id));break}M.app=e.app;var q=dojo.clone(V);dojo.place(M.root,q,"last"),g.templateSelections[R.target]=q,O=!0;break}}O||(S.push(V),g.templateSelections[R.target]=V,V.___domParent=u)}break}}S.orphan()}}else"@source-remove"===c?(g.type="source-remove",g.attributeName=v):"@source-add"===c?(g.type="source-add",g.attributeName=v):"@visible"===c||"@hidden"===c?("@hidden"===c&&(g.invert=!0),g.type="visibility",g.attributeName="@visibility"):"@disabled"===c||"@enabled"===c?("@disabled"===c&&(g.invert=!0),g.type="disabledState",g.attributeName="@disabledState"):c.startsWith("@template")?g.type="template":c.startsWith("@halt")?p=!0:(e.app.trace.warning("Unknown binding term '{0}'.".format(c)),n=!0)}else g.type="attr",g.attributeName=c;n||e.applyBinding.apply(e,[u,g,r,i])&&t.push(g)}();var g=new n.BindingNode;g.domElement=u,g.parent=i,g.context=i.context,g.children=[],g.expressions=[],i.children.push(g),0!=p||c||t(g,u)}else c||t(i,u)}},i=new n.BindingNode;return i.domElement=null,i.parent=null,i.children=[],i.context=this.viewModel,t(i,{children:[this.root]}),i}},t.prototype.getBindingTarget=function(e){if("@context"===e.target)return e.viewModel;if(e.target.indexOf("@language-")>-1){var t=e.target.split("-"),i=t.slice(1).join("-");return this.app.getResource(this.libraryId,"language-"+i)}if(1!=e.viewModel.isObservable)return e.viewModel[e.target];var r=e.viewModel.get();return null==r?r:r[e.target]},t.prototype.setBindingTargetValue=function(e,t){if("@context"===e.target)return void(e.viewModel&&e.viewModel.isObservable?e.viewModel.set(t):e.viewModel=t);if(!(e.target.indexOf("@language-")>-1)){if(!e.viewModel.isObservable)return void(e.viewModel[e.target].isObservable?e.viewModel[e.target].set(t):e.viewModel[e.target]=t);var i=e.viewModel.get();i&&(i[e.target]?i[e.target].isObservable?i[e.target].set(t):i[e.target]=t:i[e.target]=new r.Observable(t))}},t.prototype.resolveBindingTemplate=function(e,t){var i=null;if("single-inline"===e.templateMode||"single-external"===e.templateMode)i=dojo.clone(e.templateSelections["@default"]);else if("inline-selected"===e.templateMode){var r=null;t[e.templateKey]&&(r=t[e.templateKey],r.isObservable&&(r=r.get())),!r&&e.templateSelections.hasOwnProperty("@null")?i=dojo.clone(e.templateSelections["@null"]):e.templateSelections.hasOwnProperty(r)&&(i=dojo.clone(e.templateSelections[r])),!i&&e.templateSelections.hasOwnProperty("@default")&&(i=dojo.clone(e.templateSelections["@default"]),dojo.addClass(i,"empty-div"))}return i||(i=dojo.create("div")),i},t.prototype.buildSourceBinding=function(e,i,r,n){var o=this,a=this.getBindingTarget(i);if(null===a)return!1;if(void 0===a)return this.app.trace.warning("Binding error: '{0}' in view model '{1}' was not bindable.".format(i.target,i.viewModel.id)),!1;var s=a,d=function(){if(s.useThrottling&&s.throttledOperations&&s.throttledOperations.length)for(var e=s.throttledOperations.length-1;e>=0;e--)s.throttledOperations[e].cancel(),s.throttledOperations.splice(e,1)},h=function(r){if(i.upToDate===!0)return void(i.upToDate=!1);for(var h=null,p=null,f=0;f<n.expressions.length;++f){var g=n.expressions[f];h||"source-add"!=g.type||(h=g.target),p||"source-remove"!=g.type||(p=g.target)}var v=o;i.parentView&&(v=i.parentView);var m=v[h],y=v[p];if(void 0!==r&&null!==r){if(r instanceof l.CollectionChangedArgs){if(null===r||"clear"===r.type){if(d(),y)for(var w=r.rangeStart;w<=r.rangeEnd;++w)y.apply(o,[i,s.getAt(w),r,w]);for(var w=0;w<i.boundViews.length;++w)o.app.viewManager.destroyView(i.boundViews[w]);if(i.boundViews=[],!y&&null!=i.domElement&&null!=i.domElement.children){for(var b=new dojo.NodeList,w=0;w<i.domElement.children.length;++w)i.domElement.children[w].___collectionTemplate||b.push(i.domElement.children[w]);b.orphan()}}else if("replace"===r.type){if(d(),y)for(var w=r.rangeStart;w<r.rangeEnd+1;++w)y.apply(o,[i,s.getAt(w),r,w]);for(var w=0;w<i.boundViews.length;++w)o.app.viewManager.destroyView(i.boundViews[w]);i.boundViews=[],y||dojo.empty(i.domElement),r.type="append",r.rangeStart=0,r.rangeEnd=s.value.length-1}}else{var _=r.isObservable?r.get():r;y&&y.apply(o,[i,_,r,0]);for(var w=0;w<i.boundViews.length;++w)o.app.viewManager.destroyView(i.boundViews[w]);if(i.boundViews=[],!y){var k=i.___singleSourceItem;if(k){var b=new dojo.NodeList;b.push(k),b.orphan(),i.___singleSourceItem=null}}if(_)if(m)m.apply(o,[i,_,r,0]);else{var E=o.resolveBindingTemplate(i,_);dojo.place(E,i.domElement,"last");var C=new t(o.app);C.parentView=i.parentView,C.app=C.parentView.app,C.libraryId=o.libraryId;var x={children:[]};x.children.push(E);var M=_;M||(M=new u.ViewModelBase(o.app,o.libraryId),M.app=o.app,M.libraryId=o.libraryId),!M.___boundViews,M.hasOwnProperty("___boundViews"),C.root=x,C.attach(M),C.root=E,i.___singleSourceItem=C.root,i.boundViews.push(C)}}if("append"===r.type||"insert"===r.type){var S=null;"insert"===r.type&&i.domElement.children.length>r.rangeStart&&(S=i.domElement.children[r.rangeStart]);var I=function(n,a,l){if(n>a)return!1;if(!i||null==i.domElement)return!1;for(var c=l?l:s,d=n;d<=a;++d){var h=null;if(null!=m)m.apply(o,[i,c.isObservable?c.getAt(d):c[d],r,d]);else{var p=c.isObservable?c.getAt(d):c[d];if(h=o.resolveBindingTemplate(i,p),S&&"insert"===r.type)dojo.place(h,S,"before");else if(S&&"append"===r.type)dojo.place(h,S,"after");else{if(!i||null==i.domElement)return!1;dojo.place(h,i.domElement,"last")}var f=new t(o.app,o.libraryId);f.parentView=i.parentView,f.app=f.parentView.app,f.libraryId=o.libraryId,f.id+="-item"+d;var g={children:[]};g.children.push(h),null!==p&&void 0!==p||(p=new u.ViewModelBase(o.app,o.libraryId),p.app=o.app,p.libraryId=o.libraryId),!p.___boundViews,p.hasOwnProperty("___boundViews"),f.root=g,f.attach(p),f.root=h,i.boundViews.push(f)}}return e.___populateInitialValueFunc&&(e.___populateInitialValueFunc(),delete e.___populateInitialValueFunc),!0};if(s.useThrottling){s.throttledOperations=s.throttledOperations&&s.throttledOperations.constructor===Array?s.throttledOperations:[];var V=10,T=void 0==s.throttleDelay?0:s.throttleDelay,j=r.rangeStart,A=Math.min(j+V-1,r.rangeEnd),R=s.get().slice(0),O=function(){var e=s.throttledOperations.indexOf(N);e>-1&&s.throttledOperations.splice(e,1)},N=new c.ThrottledOperation(T,function(){var e=I(j,A,R);return A>=r.rangeEnd?(O(),!1):(j+=V,A+=V,A=Math.min(A,r.rangeEnd),e||O(),e)});s.throttledOperations.push(N)}else I(r.rangeStart,r.rangeEnd)}else if("remove"===r.type){d();for(var B=r.rangeStart;B<=r.rangeEnd;++B)for(var D=0;D<i.boundViews.length;++D){var q=i.boundViews[D];null!==q.viewModel&&void 0!==q.viewModel&&q.viewModel==a.getAt(B)&&(y?y.apply(o,[i,r[B],r,B]):o.app.viewManager.destroyView(q),Array.removeItem(i.boundViews,q),--D)}}}};if(s.bind&&i.targetBindings.push({event:s.bindingEvent,token:s.bind(this,h)}),s.isObservableCollection){var p=s.getLength()-1;this.bindingSetupDelegates.push(function(){var e=new l.CollectionChangedArgs;e.type="append",e.rangeStart=0,e.rangeEnd=p,e.sender=s,h.apply(o,[e]),s.isObservable&&s.bindingEvent.isPublishing&&(i.upToDate=!0)})}else this.bindingSetupDelegates.push(function(){h.apply(o,[a]),s.isObservable&&s.bindingEvent.isPublishing&&(i.upToDate=!0)})},t.prototype.buildEventBinding=function(e,t,i){var r=this;return!this[t.target]&&t.parentView&&t.parentView[t.target]&&(r=t.parentView),r[t.target]?(e!=t.domElement&&this.app.trace.warning("Binding error: buildEventBinding passed in el that doesn't match binding.domElement."),void t.on(t.attributeName,function(n){
var o;return t.target&&"function"==typeof r[t.target]&&(o=r[t.target](n,e,i)),o?o:(n.preventDefault(),n.stopPropagation(),!1)})):(this.app.trace.warning("Binding error: Event handler '{0}' was not found in view '{1}' or its parent view.".format(t.target,r.id)),!1)},t.prototype.buildVarBinding=function(e,t,i){var r=this;t.parentView&&(r=t.parentView);var n=r[t.target];n?n&&n instanceof Array?n.push(e):n&&n.isObservableCollection?n.addItem(e):r[t.target]=e:r[t.target]=e},t.prototype.buildTextBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(null===n)return!1;if(void 0===n)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var o=function(){if(null==n||n.isObservable){var i=n.get();i=null===i||void 0===i?"":i.toString(),"innerHTML"===t.attributeName?(dojo.empty(e),e.appendChild(dojo.doc.createTextNode(i))):dojo.attr(e,t.attributeName,String.escapeHtml(i))}else"innerHTML"===t.attributeName?(dojo.empty(e),e.appendChild(document.createTextNode(n))):dojo.attr(e,t.attributeName,String.escapeHtml(n))};n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,o)}),this.bindingSetupDelegates.push(function(){o.apply(r,[null])})},t.prototype.buildAttributeBinding=function(e,t,i,r){var n=this,o=this.getBindingTarget(t);if("undefined"==typeof o)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var a=function(){if(null===o)return dojo.attr(e,t.attributeName,""),!1;if(o.isObservable){var i=o.get();null!==i&&void 0!==i||(i=""),r===!0?e[t.attributeName]=i:dojo.attr(e,t.attributeName,i)}else null!==o&&void 0!==o||(o=""),r===!0?e[t.attributeName]=o:dojo.attr(e,t.attributeName,o)};null!==o&&o.isObservable&&t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,a)}),this.bindingSetupDelegates.push(function(){a.apply(n,[null])})},t.prototype.buildStyleBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(null===n)return!1;var o=function(e,t){return isNaN(t)||""===t?t:t+"px"};if(void 0===n)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;if(null==n||n.isObservable){if(null!=n){var a=function(){var i=o(t.attributeName,n.get());dojo.style(e,t.attributeName,i)};n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,a)}),this.bindingSetupDelegates.push(function(){a.apply(r,[null])})}}else{var s=o(t.attributeName,n);dojo.style(e,t.attributeName,s)}},t.prototype.buildDomBinding=function(e,t,i){var r=this,n=this;t.parentView&&(n=t.parentView);var o=n[t.target];if(null==o)return!1;if(void 0===o)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;try{if(o.isObservable){if(t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,function(e){return!!o.get()&&(t.domElement=dojo.place(o.get(),t.domElement,"replace"),void(r.app&&r.app.viewManager.notifyDimensionsChanged(r)))})}),!o.get())return!1;dojo.place(o.get(),t.domElement,"replace")}else{if(!o)return!1;dojo.place(o,t.domElement,"replace")}}catch(a){this.app.trace.warning("Binding error: An error occurred in view '{0}' while attempting to perform a DOM binding in view model '{1}'.".format(this.id,t.viewModel.id))}},t.prototype._createWidgetViewFromConfig=function(e,t){var i=e.type,r=e.id?"WidgetView-{0}-{1}".format(e.id,o.alphaNumericToken()):"{0}-{1}".format(o.alphaNumericToken(),o.alphaNumericToken()),n=new s.ViewConfig(r,null,i||"geocortex.framework.ui.ViewBase");n.isVisible=!0,n.libraryId=e.libraryId,e.markup&&(n.markupResource=e.markup),e=this.app.translateConfiguration(e.libraryId,e);var a=null;if(e.viewModelId){if(a=this.app.getFrameworkObjectById(e.viewModelId),!a)throw new Error("Could not bind widget '{0}' to view model with ID '{1}': View model not found.".format(e.Id,e.viewModelId))}else e.viewModelType?(a=this.app.instantiateFrameworkObject(e.viewModelType,e.libraryId),e.id||(e.id=o.alphaNumericToken()),a.id="WidgetViewModel-{0}-{1}".format(e.id,o.alphaNumericToken())):a=t;var l=this.app.viewManager.createView(n);if(!l)throw new Error("Could not create widget '{0}': The widget's view could not be created.".format(e.Id));l.configuration=e.configuration;var u={children:[]};return u.children.push(l.root),l.root=u,l.attach(a),l.root=u.children[0],l},t.prototype.buildWidgetBinding=function(e,i,r){var n=this,o=i.target,a=this.viewModel,s=!0,l=!1,u=null,c=null;if(i.otherExpressions)for(var h=0;h<i.otherExpressions.length;++h){var p=i.otherExpressions[h];if("@widget-context"===p.directive){if(i.target=p.target,a=this.getBindingTarget(i),!a)return this.app.trace.error("Error binding widget '{0}' to target '{1}': Target was not found in view model.".format(o,p.target)),!1;u=a}else"@widget-required"===p.directive?s=!("false"===p.target.toLowerCase()):"@widget-replace"===p.directive&&(l="true"===p.target.toLowerCase())}c=a&&a.isObservable;for(var f=this.app.configModel.widgetConfigs,g=null,h=0;h<f.length;++h){var v=f[h];if(v.id===o){g=v;break}}var m=!g,y=function(){var e=u||null;e&&e.isObservable&&(e=e.get());var t=(i.parentView||n).resolveWidget(o,e,i);if(!t){if(s)throw new Error("Widget '{0}' was not found.".format(o));return!1}return t},w=function(e,r){var a=null;if(i.boundViews.length>0){for(var s=0;s<i.boundViews.length;++s){var u=i.boundViews[s];n.app.viewManager.destroyView(u)}i.boundViews=[]}dojo.empty(i.domElement);var c=null;if(e){if("string"==typeof e){var h=dojo.create("div");dojo.attr(h,"innerHTML",e),dojo.addClass(h,"empty-div"),a=h.children&&1===h.children.length?h.children[0]:h}else if(e.hasOwnProperty("nodeType")&&[1,2,3,8,9].contains(g.nodeType))a=e;else if(e instanceof t)c=e,i.boundViews.push(c),a=e.root;else{if(!(e instanceof d.WidgetConfig))return void n.app.trace.warning("Could not resolve widget '{0}': Object of unknown type provided.".format(o));c=n._createWidgetViewFromConfig(e,r),i.boundViews.push(c),a=c.root}dojo.place(a,i.domElement,l?"replace":"last"),c&&(c.added(n),c.activated())}},b=this.libraryId;g&&g.libraryId&&(b=g.libraryId),c&&i.targetBindings.push({event:a.bindingEvent,token:a.bind(this,function(e){if(m){var t=y();w(t,e)}else w(g,e)})}),this.bindingSetupDelegates.push(function(){var e=null;if(a&&(e=a.isObservable?a.get():a),m){var t=y();w(t,e)}else w(g,e)})},t.prototype.buildClassBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(null===n)return!1;if(void 0===n)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var o=function(i){var n=r.isTruthy(i);t.invert===!0&&(n=!n);var o=t.attributeName;n===!0?(dojo.removeClass(e,o),dojo.addClass(e,o)):dojo.removeClass(e,o)};n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,o)}),this.bindingSetupDelegates.push(function(){o.apply(r,[n])})},t.prototype.isTruthy=function(e){if(!e)return!1;if(!(e instanceof l.CollectionChangedArgs))return e.isObservableCollection?e.getLength()>0:e.isObservable?!!e.get():!!e||"string"==typeof e&&e.length>0;var t=e;if("append"===t.type){var i=t.rangeEnd+1-t.rangeStart;if(i>0||t.sender.value&&t.sender.value.length>0)return!0}else{if("clear"===t.type)return!1;if("insert"===t.type){if(t.rangeEnd+1-t.rangeStart>0)return!0}else if("remove"===e.type&&t.rangeEnd+1-t.rangeStart<t.sender.value.length)return!0}},t.prototype.buildVisibilityBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(null===n)return!1;if(void 0===n)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;t.initialVisibility=dojo.style(e,"display")||"block";var o=function(i){var n=r.isTruthy(i);1==t.invert&&(n=!n);var o="";o="inline"===t.initialVisibility?"bound-visible-inline":"bound-visible",1==n?(dojo.removeClass(e,"bound-invisible"),dojo.addClass(e,o)):(dojo.removeClass(e,o),dojo.addClass(e,"bound-invisible"))};n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,o)}),this.bindingSetupDelegates.push(function(){o.apply(r,[n])})},t.prototype.buildDisabledBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(void 0===n)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;t.initialDisabled=dojo.attr(e,"disabled");var o=function(i){var r="bound-disabled",o=!1;if(i){if(n)if(i instanceof l.CollectionChangedArgs)if("append"==i.type){var a=i.rangeEnd+1-i.rangeStart;(a>0||n.value&&n.value.length>0)&&(o=!1)}else"clear"==i.type?o=!0:"insert"==i.type?i.rangeEnd+1-i.rangeStart>0&&(o=!1):"remove"==i.type&&i.rangeEnd+1-i.rangeStart<n.value.length&&(o=!1);else o=n.isObservableCollection?!(n.getLength()>0):n.isObservable?!n.get():"string"==typeof i&&0==i.length}else o=!0;1==t.invert&&(o=!o),1==o?(dojo.attr(e,"disabled",!0),dojo.attr(e,"tabindex",-1),dojo.addClass(e,r)):(dojo.removeAttr(e,"disabled"),dojo.removeAttr(e,"tabindex"),dojo.removeClass(e,r))};n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,o)}),this.bindingSetupDelegates.push(function(){o.apply(r,[n])})},t.prototype.buildValueBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(void 0===n)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;if(null==n)return!1;var a=n.isObservable||!1,s=n.isObservableCollection||!1,u=e.tagName.toLowerCase(),c=dojo.attr(e,"type")||e.type?e.type:null;if(a){var d=function(t){t!==dojo.attr(e,"value")&&(null!==t&&void 0!==t||(t=""),dojo.attr(e,"value",t))},h=function(t){e.checked=t===!0},p=function(t){var i=dojo.attr(e,"value");dojo.query("input[type=radio]",r.root).forEach(function(t){t.name===e.name}),t===!0||i==t?e.checked=!0:e.checked=!1},f=function(t){if(t instanceof Date){var i=new Date(t.getTime());i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),e.valueAsDate=i}else e.value=t},g=function(e){var i=e,r=function(e,t){if("undefined"!=typeof e.___attachedValue){var r=e.___attachedValue;if(r===(void 0===t?i:t))return!0;if("number"==typeof r||"boolean"==typeof r)r=r.toString();else if(r&&r.hasOwnProperty("value")){var r=r.value;"number"!=typeof r&&"boolean"!=typeof r||(r=r.toString())}return r===(void 0===t?i:t)}var n=void 0===t?i:t;return e.value===n};if(i instanceof l.CollectionChangedArgs){for(var n=i,o=n.sender,a=[],s=n.rangeStart;s<=n.rangeEnd;s++){var u=o.getAt(s);a.push(u.value?u.value+"":u)}if("append"===n.type||"insert"===n.type)for(var c=0;c<t.domElement.options.length;++c)for(var d=t.domElement.options[c],h=0;h<a.length;h++)r(d,a[h])?d.selected=!0:dojo.attr(t.domElement,"multiple")||(d.selected=!1)}else if("number"!=typeof i&&"boolean"!=typeof i||(i=i.toString()),null===i||void 0===i)for(var c=0;c<t.domElement.options.length;++c){var d=t.domElement.options[c];d.selected=!1}else if(dojo.isArray(i)){var p=t.viewModel[t.target].isObservableCollection;if(p)for(var f=!1,c=0;c<t.domElement.options.length;++c){var d=t.domElement.options[c];if(d.selected=!1,dojo.attr(t.domElement,"multiple")||!f)for(var g=0;g<i.length;++g){var v=i[g];if(r(d,v)){d.selected=!0,f=!0;break}}}else for(var c=0;c<t.domElement.options.length;++c){var d=t.domElement.options[c];if(r(d,v)){d.selected=!0;break}}}else for(var c=0;c<t.domElement.options.length;++c){var d=t.domElement.options[c];if(r(d,v)){d.selected=!0;break}}};"select"===u?(t.targetBindings.push({event:n.bindingEvent,token:n.bind(t,g)}),this.bindingSetupDelegates.push(function(){g.apply(r,[n.get()])})):"radio"===c?(t.targetBindings.push({event:n.bindingEvent,token:n.bind(t,p)}),this.bindingSetupDelegates.push(function(){p.apply(r,[n.get()])})):"checkbox"===c?(t.targetBindings.push({event:n.bindingEvent,token:n.bind(t,h)}),this.bindingSetupDelegates.push(function(){h.apply(r,[n.get()])})):"date"===c?(t.targetBindings.push({event:n.bindingEvent,token:n.bind(t,f)}),this.bindingSetupDelegates.push(function(){f.apply(r,[n.get()])})):(t.targetBindings.push({event:n.bindingEvent,token:n.bind(t,d)}),this.bindingSetupDelegates.push(function(){d.apply(r,[n.get()])}))}var v=function(){t.on("change",function(e){if(void 0===e.currentTarget)return void(r.app&&r.app.trace.error("Binding error: bound to change event where currentTarget is undefined"));var i=dojo.attr(e.currentTarget,"value");return a?n.set(i):r.setBindingTargetValue(t,i),!0})},m=function(){var e=null,i=function(i){var o=dojo.attr(i.currentTarget,"value");if(o!==e)return e=o,a?n.set(o):r.setBindingTargetValue(t,o),!0};t.on("change",i),t.on("keyup",i),t.on("mouseup",i),t.on("input",i)},y=function(){t.on("change",function(e){var i=dojo.attr(e.currentTarget,"checked");return a?n.set(i):r.setBindingTargetValue(t,i),!0})},w=function(){t.on("click",function(e){return dojo.attr(e.currentTarget,"checked")&&(a?n.set(e.currentTarget.value):r.setBindingTargetValue(t,e.currentTarget.value)),!0})},b=function(){t.on("change",function(e){var i=a?n.get():n,o=e.currentTarget.valueAsDate;return o.setMinutes(o.getMinutes()+o.getTimezoneOffset()),i instanceof Date&&!isNaN(i.getTime())&&(o.setHours(i.getHours()),o.setMinutes(i.getMinutes()),o.setSeconds(i.getSeconds()),o.setMilliseconds(i.getMilliseconds())),a?n.set(o):r.setBindingTargetValue(t,o),!0})},_=function(){var i=function(){for(var i=dojo.query("option",e),l=[],u=0;u<i.length;++u){var c=i[u];if(c.selected===!0){var d=c.___attachedValue;o.isNullOrUndefined(d)?l.push(c.value):l.push(d)}}if(0===l.length&&i.length>0&&!e.multiple&&r.app.___uaIsiPad===!0){e.selectedIndex=0;var d=i[0].___attachedValue;l.push(o.isNullOrUndefined(d)?i[0].value:d)}return l.length>0?s?(n.clear(),n.addItems(l)):a?n.set(l[0]):r.setBindingTargetValue(t,l):n.clear(),!0};e.___populateInitialValueFunc=function(){g(n.isObservable?n.get():n)},t.on("change",i)};"textarea"===u||"input"===u&&"text"===c?m():"input"===u&&"checkbox"===c?y():"input"===u&&"radio"===c?w():"input"===u&&"date"===c?b():"select"===u?_():v()},t.prototype.applyBinding=function(e,t,i,r){return"source"===t.type?this.buildSourceBinding(e,t,i,r):"event"===t.type?this.buildEventBinding(e,t,i):"text"===t.type?this.buildTextBinding(e,t,i):"var"===t.type?this.buildVarBinding(e,t,i):"class"===t.type?this.buildClassBinding(e,t,i):"style"===t.type?this.buildStyleBinding(e,t,i):"dom"===t.type?this.buildDomBinding(e,t,i):"value"===t.type?this.buildValueBinding(e,t,i):"attr"===t.type?this.buildAttributeBinding(e,t,i):"attachment"===t.type?this.buildAttributeBinding(e,t,i,!0):"visibility"===t.type?this.buildVisibilityBinding(e,t,i):"disabledState"===t.type?this.buildDisabledBinding(e,t,i):"widget"===t.type&&this.buildWidgetBinding(e,t,i),!0},t}(i.FrameworkObject);t.ViewBase=h})},"geocortex/framework/utils/Tuple":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i,r,n){this.item1=null,this.item2=null,this.item3=null,this.item4=null,this.item5=null,this.item1=e,this.item2=t,null!=i&&"undefined"!=typeof i&&(this.item3=i),null!=r&&"undefined"!=typeof r&&(this.item4=r),null!=n&&"undefined"!=typeof n&&(this.item5=n)}return e.equals=function(e,t){return null===e?null===t:e.item1===t.item1&&(e.item2===t.item2&&(e.item3===t.item3&&(e.item4===t.item4&&e.item5===t.item5)))},e.compare=function(e,t){var i=function(e,t){return null===e?null===t?0:-1:e===t?0:e>t?1:-1};return i(e.item1,t.item1)||i(e.item2,t.item2)||i(e.item3,t.item3)||i(e.item4,t.item4)||i(e.item5,t.item5)},e}();t.Tuple=i})},"geocortex/framework/utils/Grouping":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/utils/ArrayUtils":function(){define(["require","exports","geocortex/framework/utils/Tuple"],function(e,t,i){"use strict";function r(e,t){var i=e?e.length:0;if((null===t||"undefined"==typeof t)&&i>0)return e[0];for(var r=0;r<i;r++){var n=e[r];if(t(n,r))return n}return null}function n(e,t){var i=e?e.length:0;if((null===t||"undefined"==typeof t)&&i>0)return e[i-1];for(var r=i-1;r>=0;r--){var n=e[r];if(t(n,r))return n}return null}function o(e,t){if(e){var r=e.slice();return r.sort(function(e,r){var n=t(e),o=t(r);return n instanceof i.Tuple?i.Tuple.compare(n,o):v(n,o)})}return[]}function a(e,t){if(e){var r=e.slice();return r.sort(function(e,r){var n=t(e),o=t(r);return n instanceof i.Tuple?i.Tuple.compare(o,n):v(o,n)})}return[]}function s(e,t){var i={},r=[];if(e&&t){for(var n=0;n<e.length;n++){var o=e[n],a=t(o),s=JSON.stringify(a);i.hasOwnProperty(s)?i[s].items.push(o):i[s]={key:a,items:[o]}}for(var l in i)i.hasOwnProperty(l)&&r.push(i[l])}return r}function l(e){if(e){var t=e.filter(function(e,t,i){return null!=e&&i.indexOf(e)===t});return t}return[]}function u(e,t){var i;return i=e?t?e.filter(function(e){return t.indexOf(e)<0}):e.slice(0):[]}function c(e,t,i){var r=e.slice((i||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r)}function d(e,t){var i=p(e,t);return i==-1?null:c(e,i,i)}function h(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1}function p(e,t){for(var i=e.length;i--;)if(e[i]===t)return i;return-1}function f(e){return e?[].concat.apply([],e):e}var g=this,v=function(e,t){return e===t?0:e>t?1:-1};t.firstOrDefault=r,t.lastOrDefault=n,t.orderBy=o,t.orderByDescending=a,t.groupBy=s,t.distinct=l,t.difference=u,t.remove=c,t.removeItem=d,t.contains=h,t.pos=p,t.flatten=f,Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-(1/0)&&(r=+(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var n=r>=0?r:Math.max(i-Math.abs(r),0);n<i;n++)if(n in t&&t[n]===e)return n;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=i;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-(1/0)&&(r=+(r>0||-1)*Math.floor(Math.abs(r))));for(var n=r>=0?Math.min(r,i-1):i-Math.abs(r);n>=0;n--)if(n in t&&t[n]===e)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,r;if(null==this)throw new TypeError("this is null or not defined");var n=Object(this),o=n.length>>>0;if("[object Function]"!=={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(i=t),r=0;r<o;){var a;Object.prototype.hasOwnProperty.call(n,r)&&(a=n[r],e.call(i,a,r,n)),r++}}),Array.prototype.every||(Array.prototype.every=function(e){if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],n=0;n<i;n++)if(n in t&&!e.call(r,t[n],n,t))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e){if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],n=0;n<i;n++)if(n in t&&e.call(r,t[n],n,t))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],n=arguments[1],o=0;o<i;o++)if(o in t){var a=t[o];e.call(n,a,o,t)&&r.push(a)}return r}),Array.prototype.map||(Array.prototype.map=function(e,t){var i,r,n;if(null==g)throw new TypeError(" this is null or not defined");var o=Object(g),a=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(i=t),r=new Array(a),n=0;n<a;){var s,l;n in o&&(s=o[n],l=e.call(i,s,n,o),r[n]=l),n++}return r}),Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],o=0;o<r;o++)if(t=i[o],e.call(n,t,o,i))return t}),Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],o=0;o<r;o++)if(t=i[o],e.call(n,t,o,i))return o;return-1}),Array.remove=c,Array.removeItem=d,Array.contains=h,Array.pos=p})},"geocortex/framework/ui/RegionAdapterBase":function(){define(["require","exports","geocortex/framework/utils/ArrayUtils"],function(e,t,i){"use strict";var r=function(){function e(e,t){this._viewActivationTimers=[],this._viewDeactivationTimers=[],this.isActive=!1,this.domElement=null,this.options=null,this.views=[],this.activeViews=[],this.defaultTransitionDelay=10,this.app=t,this.name=e}return e.prototype.host=function(e,t){this.domElement=e,this.options=t||{},this.options.useTransitions?this.options.transitionDelay&&!isNaN(this.options.transitionDelay)||(this.options.transitionDelay=this.defaultTransitionDelay):this.options.useTransitions=!1},e.prototype.unhost=function(){this.domElement=null,this.options=null},e.prototype.activateView=function(e){this.cancelActivate(e),0===this.activeViews.length&&e.isActive===!1&&(this.isActive=!0,this.app.event("RegionActivatedEvent").publish(this),dojo.removeClass(this.domElement,"region-inactive"),dojo.addClass(this.domElement,"region-active")),i.contains(this.activeViews,e)?(i.removeItem(this.activeViews,e),this.activeViews.push(e)):this.activeViews.push(e),e.activated(),e.isActive=!0,this.options.useTransitions?(dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"activating"),this._viewActivationTimers[e.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(e.root,"inactive"),dojo.removeClass(e.root,"activating"),dojo.addClass(e.root,"active"),delete this._viewActivationTimers[e.id]}),this.options.transitionDelay)):(dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"active")),this.app.event("ViewActivatedEvent").publish(e)},e.prototype.cancelActivate=function(e){this._viewActivationTimers[e.id]&&(clearTimeout(this._viewActivationTimers[e.id]),delete this._viewActivationTimers[e.id],dojo.removeClass(e.root,"activating"))},e.prototype.cancelDeactivate=function(e){this._viewActivationTimers[e.id]&&(clearTimeout(this._viewActivationTimers[e.id]),delete this._viewActivationTimers[e.id],dojo.removeClass(e.root,"deactivating"))},e.prototype.deactivateView=function(e){this.cancelDeactivate(e),this.activeViews.length<=1&&e.isActive===!0&&(this.isActive=!1,dojo.removeClass(this.domElement,"region-active"),dojo.addClass(this.domElement,"region-inactive"),this.app.event("RegionDeactivatedEvent").publish(this)),this.cancelActivate(e),i.removeItem(this.activeViews,e),e.deactivated(),e.isActive=!1,this.options.useTransitions?(dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"deactivating"),this._viewDeactivationTimers[e.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(e.root,"active"),dojo.removeClass(e.root,"deactivating"),dojo.addClass(e.root,"inactive"),delete this._viewDeactivationTimers[e.id]}),this.options.transitionDelay)):(dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive")),this.app.event("ViewDeactivatedEvent").publish(e)},e.prototype.hostView=function(e){dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive"),e.added(),this.app.event("ViewHostedEvent").publish({region:this,view:e})},e.prototype.unhostView=function(e){e.removed(),dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive"),this.app.event("ViewUnhostedEvent").publish({region:this,view:e})},e}();t.RegionAdapterBase=r})},"geocortex/framework/events/ViewDimensionsChangedArgs":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.view=e,this.region=t}return e}();t.ViewDimensionsChangedArgs=i})},"geocortex/framework/events":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/config/LibraryConfig":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t){this.locales=[],this.position=0,this.omitStyles=!1,this.id=e,this.uri=t}return e}();t.LibraryConfig=i})},"geocortex/framework/config/ViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i){this.libraryId="",this.configuration={},this.viewModelId=e,this.moduleName=t,this.typeName=i}return e}();t.ViewModelConfig=i})},"geocortex/framework/config/ModuleConfig":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i,r){this.viewConfigs=[],this.viewModelConfigs=[],this.moduleName=e,this.moduleType=t,this.configuration=i,this.libraryId=r}return e}();t.ModuleConfig=i})},"geocortex/framework/config/ConfigurationModel":function(){define(["require","exports","geocortex/framework/config/LibraryConfig","geocortex/framework/config/ModuleConfig","geocortex/framework/config/WidgetConfig","geocortex/framework/config/ViewConfig","geocortex/framework/config/ViewModelConfig"],function(e,t,i,r,n,o,a){"use strict";var s=function(){function e(e){this.application={},this.version="unknown",this.viewerId="unknown",this.defaultLibraryId="",this.globals=null,this.libraryConfigs=[],this.moduleConfigs=[],this.widgetConfigs=[],this.libraryModules={},this.externalLocaleReferences=[],this.app=e}return e.prototype.parse=function(e,t){var s="object"==typeof e?e:JSON.parse(e);if(!s.configuration){var l={version:"1.0",viewerId:"unknown",application:{},defaultLibraryId:"",libraries:[],modules:[],widgets:[]};s.configuration=l}var u,c,d;try{this.application=s.configuration.application||{},this.version=s.configuration.version||"1.0",this.viewerId=s.configuration.viewerId||"unknown",this.defaultLibraryId=s.configuration.defaultLibraryId||null,u=s.configuration.libraries||[],c=s.configuration.modules||[],d=s.configuration.widgets||[],this.app.trace.debug("Config version: {0}.".format(this.version))}catch(h){return void this.app.trace.error("Error reading configuration: {0}".format(h),h)}if(u&&u.length>0)for(var p=0;p<u.length;++p){var f=u[p];f=this.app.translateConfiguration(f.id,f),null==this.defaultLibraryId&&(this.defaultLibraryId=f.id);var g=new i.LibraryConfig(f.id,f.uri);if(g.position=p,g.omitStyles=f.omitStyles||!1,g.async=f.async===!0,g.location=f.location||g.id,this.libraryConfigs.push(g),this.libraryModules[f.id]=[],f.locales)for(var v=0;v<f.locales.length;++v){var m=f.locales[v];m.locale=m.locale.toLowerCase(),m.hasOwnProperty("uri")&&(m.libraryId=f.id,g.locales.push(m),this.externalLocaleReferences.push(m))}}if(c&&c.length>0)for(var v=0;v<c.length;++v){var y=c[v],w=y.libraryId;w||(w=this.defaultLibraryId);var b=new r.ModuleConfig(y.moduleName,y.moduleType,y.configuration,w);b.require=y.require,this.libraryModules[w]?this.libraryModules[w].push(b):this.app.trace.error("Unknown library '{0}'.".format(w));var _=y.views;if(_)for(var k=0;k<_.length;++k){var E=_[k],C=E.type||"geocortex.framework.ui.ViewBase",x=new o.ViewConfig(E.id,y.moduleName,C);b.viewConfigs.push(x),x.libraryId=E.libraryId||w;this.libraryConfigs.filter(function(e){return e.id===x.libraryId})[0];x.viewModelId=E.viewModelId||null,x.markupResource=E.markup||null,x.configuration=E.configuration||{},x.regionName=E.region||null,x.isManaged=E.isManaged||!1,x.isVisible=E.visible||!1,x.title=E.title||null,x.description=E.description||"",x.iconUri=E.iconUri||"",x.require=E.require||"",x.requireMarkup=E.requireMarkup}var M=y.viewModels;if(M)for(var k=0;k<M.length;++k){var S=M[k],I=new a.ViewModelConfig(S.id,y.moduleName,S.type);b.viewModelConfigs.push(I),I.libraryId=S.libraryId||w,S.configuration&&(I.configuration=S.configuration),I.require=S.require}this.moduleConfigs.push(b)}if(d&&d.length>0)for(var p=0;p<d.length;++p){var V=new n.WidgetConfig(d[p].id,d[p].libraryId||this.defaultLibraryId);dojo.safeMixin(V,d[p]),this.widgetConfigs.push(V)}t&&t(this)},e}();t.ConfigurationModel=s})},"geocortex/framework/utils/Trace":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e){this._appName="GVH",this.app=e}return e.prototype._traceImpl=function(e,t,i){("debug"!==e&&"trace"!==e||this.app.debugMode)&&this.app&&this.app.event("TraceEvent").publish({level:e,timestamp:new Date,source:this._appName,message:t,stack:i})},e.prototype._stackTraceFromException=function(e){return"undefined"!=typeof e?e.stack||e.backtrace||e.stacktrace:null},e.prototype.debug=function(e){this._traceImpl("debug",e)},e.prototype.trace=function(e){this._traceImpl("trace",e)},e.prototype.info=function(e){this._traceImpl("info",e)},e.prototype.alert=function(e){this._traceImpl("alert",e)},e.prototype.warning=function(e){this._traceImpl("warning",e)},e.prototype.error=function(e,t){this._traceImpl("error",e,this._stackTraceFromException(t))},e.prototype.exception=function(e,t){this._traceImpl("error",e,this._stackTraceFromException(t))},e}();t.Trace=i})},"geocortex/framework/Thenable":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/SimplePromise":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(t){var i=this;this._state=e.PENDING,this._value=null,this._handlers=[],this._doResolve(t,function(e){return i._resolve(e)},function(e){return i._reject(e)})}return e.resolve=function(t){var i=e._getThen(t);return i?t:new e(function(e,i){e(t)})},e.reject=function(t){return new e(function(e,i){i(t)})},e.all=function(t){return e.resolve(t).then(function(t){if(!Array.isArray(t))throw new Error("SimplePromise.all: expecting an array or a thenable.");var i=t.length,r=[];return new e(function(n,o){t.forEach(function(t,a){e.resolve(t).then(function(e){r[a]=e,0===--i&&n(r)},o)})})})},e.prototype.then=function(t,i){var r=this;return new e(function(e,n){return r._done(function(i){if("function"!=typeof t)return e(i);try{return e(t(i))}catch(r){return n(r)}},function(t){if("function"!=typeof i)return n(t);try{return e(i(t))}catch(r){return n(r)}})})},e.prototype._fulfill=function(t){var i=this;this._state=e.FULFILLED,this._value=t,this._handlers.forEach(function(e){return i._handle(e)}),this._handlers=[]},e.prototype._reject=function(t){var i=this;this._state=e.REJECTED,this._value=t,this._handlers.forEach(function(e){return i._handle(e)}),this._handlers=[]},e.prototype._resolve=function(t){var i=this;try{var r=e._getThen(t);if(r)return void this._doResolve(r.bind(t),function(e){return i._resolve(e)},function(e){return i._reject(e)});this._fulfill(t)}catch(n){this._reject(n)}},e._getThen=function(e){var t=typeof e;if(e&&("object"===t||"function"===t)){var i=e.then;if("function"==typeof i)return i}return null},e.prototype._doResolve=function(e,t,i){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,i(e))})}catch(n){if(r)return;r=!0,i(n)}},e.prototype._handle=function(t){this._state===e.PENDING?this._handlers.push(t):(this._state===e.FULFILLED&&"function"==typeof t.onFulfilled&&t.onFulfilled(this._value),this._state===e.REJECTED&&"function"==typeof t.onRejected&&t.onRejected(this._value))},e.prototype._done=function(e,t){var i=this;setTimeout(function(){i._handle({onFulfilled:e,onRejected:t})},0)},e}();i.PENDING=0,i.FULFILLED=1,i.REJECTED=2,t.SimplePromise=i})},"geocortex/framework/application/ModuleBase":function(){define(["require","exports","geocortex/framework/FrameworkObject","geocortex/framework/SimplePromise"],function(e,t,i,r){"use strict";var n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.behaviorNames=[],r.configuration={},r}return __extends(t,e),t.prototype.initialize=function(e){this.configuration=e,this.behaviorNames=this.app.behaviorRegistry.loadBehaviorsFromConfig(this,e)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this);for(var t=0;t<this.behaviorNames.length;t++)this.app.behaviorRegistry.remove(this.behaviorNames[t]);this.behaviorNames.length=0},t.prototype.shutdown=function(e){},t.prototype.exportState=function(){
return new r.SimplePromise(function(e,t){return e(null)})},t.prototype.applyState=function(e){return new r.SimplePromise(function(e,t){return e()})},t.prototype.getStateFilter=function(){return null},t}(i.FrameworkObject);t.ModuleBase=n})},"geocortex/framework/application/ModuleManager":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e){this._modules={},this.app=e}return e.prototype.shutdown=function(e){for(var t in this._modules)this._modules.hasOwnProperty(t)&&(this._modules[t].shutdown(e),this._modules[t].destroy());this._modules={}},e.prototype.instantiate=function(e,t){return null==e?null:this.app.instantiateFrameworkObject(e,t)},e.prototype.markModuleLoaded=function(e,t){this._modules[e]=t,this.app.event("ModuleInitializedEvent").publish(e)},e.prototype.moduleIsLoaded=function(e){return null!=this._modules[e]},e.prototype.notifyModuleLoaded=function(e,t){if(this.moduleIsLoaded(e)&&null!=t)t(e);else var i=this.app.event("ModuleInitializedEvent").subscribe(this,function(r){if(r==e)try{t(r)}finally{this.app.event("ModuleInitializedEvent").unsubscribe(i)}})},e}();t.ModuleManager=i})},"geocortex/framework/commands/CommandRegistry":function(){define(["require","exports","geocortex/framework/commands/Command"],function(e,t,i){"use strict";var r=function(){function e(e){this.commands={},this.app=e}return e.prototype.clear=function(){for(var e in this.commands)this.commands.hasOwnProperty(e)&&this.commands[e].clear()},e.prototype.command=function(e){var t=this.commands[e];if(!t){var r=new i.Command(e,this.app);return r.isWrapper=!0,this.commands[r.name]=r,r}return t},e}();t.CommandRegistry=r})},"geocortex/framework/events/EventRegistry":function(){define(["require","exports","geocortex/framework/events/Event"],function(e,t,i){"use strict";var r=function(){function e(e){this.events={},this.app=e}return e.prototype.clear=function(){for(var e in this.events)this.events.hasOwnProperty(e)&&this.events[e].clear()},e.prototype.event=function(e){var t=this.events[e];if(!t){var r=new i.Event(e,this.app);t=r,this.events[e]=t}return t},e}();t.EventRegistry=r})},"geocortex/framework/behaviors/Behavior":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i,r){this.app=e,this.name=t,this.event=r,this.commands=i||[],this._wireUpEvent()}return e.prototype.run=function(e){this._executeCommands(e)},e.prototype._wireUpEvent=function(){var e=this;this.event&&(this.eventToken=this.app.event(this.event).subscribe(this,function(t){e._executeCommands(t)}))},e.prototype._executeCommands=function(e){for(var t=0;this.commands&&t<this.commands.length;t++)this.app.command(this.commands[t]).execute(e)},e.prototype.destroy=function(){this.event&&this.app.event(this.event).unsubscribe(this.eventToken),this.commands=null},e}();t.Behavior=i})},"geocortex/framework/behaviors/BehaviorRegistry":function(){define(["require","exports","geocortex/framework/behaviors/Behavior","geocortex/framework/application/ModuleBase"],function(e,t,i,r){"use strict";var n=function(){function e(e){this.behaviors={},this.dummyBehavior=new i.Behavior(null,null,null),this.app=e}return e.prototype.loadBehaviorsFromConfig=function(e,t){var i=[];if(!(e instanceof r.ModuleBase))return this.app.trace.warning("Attempted to add behaviors to registry outside of ModuleBase. Behaviors from "+e.id+" not added."),i;if(t&&t.behaviors)for(var n=0;n<t.behaviors.length;n++){var o=t.behaviors[n];i.push(o.name),this.addBehavior(o.name,o.commands,o.event)}return i},e.prototype.addBehavior=function(e,t,r){if(!t)return void this.app.trace.debug("Behavior "+e+" does not possess an array of command IDs. Not added to registry.");this.behaviors[e]&&this.app.trace.warning("Behavior "+e+" is already present in registry."),e||this.app.trace.warning("Attempted to add a nameless Behavior to the registry.");var n=new i.Behavior(this.app,e,t,r);this.behaviors[e]=n},e.prototype.remove=function(e){if(!this.behaviors[e])return this.app.trace.debug("Attempted to remove behavior not in found in registry."),!1;var t=this.behaviors[e];return delete this.behaviors[e],t.destroy(),!0},e.prototype.behavior=function(e){var t=null;return void 0!==this.behaviors[e]?t=this.behaviors[e]:(t=this.dummyBehavior,this.app.trace.debug("Could not find Behavior named "+e+" in the Behavior Registry.")),t},e}();t.BehaviorRegistry=n})},"geocortex/framework/storage/StorageStats":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){this.capacity=e.UNKNOWN,this.sizeInChars=e.UNKNOWN,this.numKeys=e.UNKNOWN}return e}();i.UNKNOWN=-1,t.StorageStats=i})},"geocortex/framework/storage/StorageProviderBase":function(){define(["require","exports","geocortex/framework/storage/StorageStats"],function(e,t,i){"use strict";var r=function(){function e(e){this.app=e,this.keyNamespace=e.id}return e.prototype.initialize=function(){},e.prototype.isSupported=function(){return!1},e.prototype.isFull=function(){return!1},e.prototype.getStats=function(){return new i.StorageStats},e.prototype.getScore=function(){return 0},e.prototype.clear=function(e,t){},e.prototype.clearAllData=function(e,t){},e.prototype.get=function(e,t,i,r){},e.prototype.set=function(e,t,i,r,n){},e.prototype.remove=function(e,t,i,r){},e}();t.StorageProviderBase=r})},"geocortex/framework/storage/HttpStorageProvider":function(){define(["require","exports","geocortex/framework/storage/StorageProviderBase"],function(e,t,i){"use strict";var r=function(e){function t(t){var i=e.call(this,t)||this;return i.fileStorageEndpoint="/filesystem",i._initialized=!1,i.localServerAddress=i.app.localServerAddress?i.app.localServerAddress:"http://127.0.0.1:8181",i}return __extends(t,e),t.prototype.initialize=function(){if(!this._initialized){!window.require.has("esri-cors")&&window.Modernizr.cors&&(delete window.require.has.cache["esri-cors"],window.require.has.add("esri-cors",function(){return!0}));var e=this.localServerAddress.replace("http://","");window.esri.config.defaults.io.corsEnabledServers.push(e),this._initialized=!0}},t.isSupported=function(){return/\bGeocortexApp\b/.test(navigator.userAgent)||/http:\/\/127.0.0.1(:[0-9]*)?\/viewerpackages\//gi.test(window.location.href)},t.prototype.fileStorageRequest=function(e,t,i,r,n){this.initialize();var o=this.localServerAddress+this.fileStorageEndpoint+"/"+t,a={url:o,headers:{Authorization:"Token "+this.app.localServerToken},load:function(e){i(e)},error:function(e){return e&&e.status&&404===e.status?void i(null):void r(e)},failOk:!0};n&&(a.putData=n),dojo.xhr(e,a)},t.prototype.clear=function(e,t){this.fileStorageRequest("DELETE",this.keyNamespace+"/",e,t)},t.prototype.clearAllData=function(e,t){this.fileStorageRequest("DELETE","",e,t)},t.prototype.get=function(e,t,i,r){var n=r?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("GET",n,t,i)},t.prototype.set=function(e,t,i,r,n){var o=n?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("PUT",o,i,r,t)},t.prototype.remove=function(e,t,i,r){var n=r?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("DELETE",n,t,i)},t}(i.StorageProviderBase);t.HttpStorageProvider=r})},"geocortex/framework/storage/FileStorageProvider":function(){define(["require","exports","geocortex/framework/storage/StorageProviderBase","geocortex/framework/storage/StorageStats"],function(e,t,i,r){"use strict";var n;!function(e){e.QUOTA_EXCEEDED_ERR="QuotaExceededError",e.NOT_FOUND_ERR="NotFoundError",e.SECURITY_ERR="SecurityError",e.INVALID_MODIFICATION_ERR="InvalidModificationError",e.INVALID_STATE_ERR="InvalidStateError"}(n=t.ErrorType||(t.ErrorType={}));var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isInitializing=!1,t._initializationSuccessCallback=null,t._initializationErrorCallback=null,t._defaultDesiredSize=524288e3,t._storageTypeTemporary=0,t._storageTypePersistent=1,t._error=null,t._isFull=!1,t._isInitialized=!1,t}return __extends(t,e),t.prototype.initialize=function(t){var i=this;if(!this._isInitialized&&!this._error){if(e.prototype.initialize.call(this),!this.isSupported())return void this.app.trace.warning("The HTML5 storage provider could not be initialized. The File API is not supported by this browser.");t||(this.app.configuration&&this.app.configuration.offlineStorageSpaceMb&&(t=1024*parseInt(this.app.configuration.offlineStorageSpaceMb,10)*1024),t||(t=this._defaultDesiredSize));var r=function(e){i._isInitialized||(i._isInitialized=!0,i.app.trace.debug("Filesystem '{0}' initialized successfully.".format(e.name)),i._filesystem=e,i._error=null,i._initializationSuccessCallback(e))};navigator.webkitPersistentStorage||window.webkitStorageInfo?this._requestQuota(this._storageTypePersistent,t,function(e){i._isInitialized||(i.app.trace.debug("HTML5 File API quota granted. Size: {0} bytes.".format(e)),i._requestFileSystem(window.PERSISTENT,t,r,function(e){e=i._shapeError(e),i._error=e,i._initializationErrorCallback&&i._initializationErrorCallback(e)}))},function(e){e=i._shapeError(e),i._error=e,i.app.trace.error("Error requesting filesystem quota: {0}".format(e.toString()),e),i._initializationErrorCallback&&i._initializationErrorCallback(e)}):this._requestFileSystem(LocalFileSystem.PERSISTENT,t,r,function(e){e=i._shapeError(e),i._error=e,i._initializationErrorCallback&&i._initializationErrorCallback(e)})}},t.prototype.isSupported=function(){return!(!window.requestFileSystem&&!window.webkitRequestFileSystem)},t.prototype.isFull=function(){return this._isFull},t.prototype.getScore=function(){return this.initialize(),5},t.prototype.getStats=function(){return this.initialize(),new r.StorageStats},t.prototype._ensureInitializedThen=function(e){var t=null;if(this._isInitialized)e.apply(this,[]);else if(this._isInitializing)t=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(t),e.apply(i,[])});else{var i=this;this._isInitializing=!0,t=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(t),e.apply(i,[])}),this.initialize()}},t.prototype._silentlyEnsureInitializeThen=function(e,t){var i=this;return this._isInitialized||this._isInitializing||!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?void i._ensureInitializedThen(e):void this._queryUsageAndQuota(this._storageTypePersistent,function(r,n){0==r&&0==n?t():i._ensureInitializedThen(e)},function(e){e=i._shapeError(e),i.app.trace.warning("An error occurred while trying to fetch file API usage information: {0}".format(e.toString()))})},t.prototype._requestFileSystem=function(e,t,i,r){if(window.requestFileSystem)window.requestFileSystem(e,t,i,r);else{if(!window.webkitRequestFileSystem)throw new Error("No request filesystem method found");window.webkitRequestFileSystem(e,t,i,r)}},t.prototype._requestQuota=function(e,t,i,r){var n=navigator,o=window;switch(e){case this._storageTypeTemporary:n.webkitTemporaryStorage&&n.webkitTemporaryStorage.requestQuota?n.webkitTemporaryStorage.requestQuota(t,i,r):o.webkitStorageInfo&&o.webkitStorageInfo.requestQuota&&o.webkitStorageInfo.requestQuota(window.TEMPORARY,t,i,r);break;case this._storageTypePersistent:n.webkitPersistentStorage&&n.webkitPersistentStorage.requestQuota?n.webkitPersistentStorage.requestQuota(t,i,r):o.webkitStorageInfo&&o.webkitStorageInfo.requestQuota&&o.webkitStorageInfo.requestQuota(window.PERSISTENT,t,i,r)}},t.prototype._queryUsageAndQuota=function(e,t,i){var r=navigator,n=window;switch(e){case this._storageTypeTemporary:r.webkitTemporaryStorage&&r.webkitTemporaryStorage.queryUsageAndQuota?r.webkitTemporaryStorage.queryUsageAndQuota(t,i):n.webkitStorageInfo&&n.webkitStorageInfo.queryUsageAndQuota&&n.webkitStorageInfo.queryUsageAndQuota(window.TEMPORARY,t,i);break;case this._storageTypePersistent:r.webkitPersistentStorage&&r.webkitPersistentStorage.queryUsageAndQuota?r.webkitPersistentStorage.queryUsageAndQuota(t,i):n.webkitStorageInfo&&n.webkitStorageInfo.queryUsageAndQuota&&n.webkitStorageInfo.queryUsageAndQuota(window.PERSISTENT,t,i)}},t.prototype._writeValue=function(e,t,i,r,n){function o(e){e=l._shapeError(e),r&&r(e)}function a(t){n?l._filesystem.root.getFile(e+".json",{create:!0,exclusive:!1},t,o):l._filesystem.root.getDirectory(u,{create:!0,exclusive:!1},function(i){l._filesystem.root.getFile(u+"/"+e+".json",{create:!0,exclusive:!1},t,o)},o)}function s(e){e.createWriter(function(e){e.truncate(0)}),e.createWriter(function(e){e.onwriteend=function(e){l.app.trace.debug("Wrote {0} bytes to filesystem.".format(e.total))},e.onerror=function(e){e=l._shapeError(e),l.app.trace.debug("Write failed: {0}".format(e)),r&&r(e)};var n=!1;try{var a="undefined"!=typeof window.cordova&&window.cordova.exec,s=!1;if(a&&(e.write(t),s=!0),!s&&"undefined"!=typeof Blob)try{var u=new Blob([t],{type:"text/plain"});e.write(u),s=!0}catch(c){l.app.trace.debug('Failed to create blob "'+c+'". Falling back to BlobBuilder.')}if(!s){var d=null;if("undefined"!=typeof BlobBuilder?d=new BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?d=new WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder&&(d=new MSBlobBuilder),!d)throw new Error("Error writing to File API file: No BlobBuilder implementation found.");d.append(t),e.write(d.getBlob("text/plain"))}}catch(h){n=!0,o(h)}n||i()})}var l=this,u=n?"":this.keyNamespace;try{a(s)}catch(c){o(c)}},t.prototype._readValue=function(e,t,i,r){function o(e){return e.name&&e.name===n.NOT_FOUND_ERR?void t(null):(e=a._shapeError(e),void(i&&i(e)))}var a=this,s=r?"":this.keyNamespace+"/";a._filesystem.root.getFile(s+e+".json",{},function(e){e.file(function(e){var i=new FileReader;i.onloadend=function(e){t(this.result)};try{i.readAsText(e)}catch(r){o(r)}},o)},o)},t.prototype._shapeError=function(e){var t="";switch(e.name){case n.QUOTA_EXCEEDED_ERR:t="Quota Exceeded.";break;case n.NOT_FOUND_ERR:t="File not found.";break;case n.SECURITY_ERR:t="Security error.";break;case n.INVALID_MODIFICATION_ERR:t="Invalid modification.";break;case n.INVALID_STATE_ERR:t="Invalid state.";break;default:t="Unknown Error."}return e=new Error("File error: {0}.".format(t))},t.prototype.clear=function(e,t){function i(e){t&&(e=r._shapeError(e),t(e))}var r=this;this._silentlyEnsureInitializeThen(function(){r._filesystem.root.getDirectory(this.keyNamespace,{create:!1},function(t){t.removeRecursively(function(){e&&e()},i)},function(t){t.name===n.NOT_FOUND_ERR?e():i(t)})},e)},t.prototype.clearAllData=function(e,t){var i=this;this._silentlyEnsureInitializeThen(function(){try{var r=i._filesystem.root.createReader(),n=[],o=0,a=0,s=0,l=new dojo.Deferred,u=new dojo.Deferred,c=new dojo.DeferredList([l,u]);c.then(function(i){s?t&&t(new Error("{0} errors were encountered while clearing the storage provider.".format(s))):e&&e()}),c.addErrback(function(e){t&&(e=i._shapeError(e),t(e))});var d=function(){var e=function(){--o,o<=0&&(l.resolve(),u.resolve())},t=function(e){e=i._shapeError(e),i.app.trace.warning("Error removing local file: {0}.".format(e.toString())),--o,++s,o<=0&&l.resolve()},r=function(i){i.remove(e,t)},a=function(e){e=i._shapeError(e),i.app.trace.warning("Could not obtain file for removal: {0}.".format(e.toString())),u.errback(e)};if(o=n.length,0===o)l.resolve(),u.resolve();else if(0===n.length)l.resolve(),u.resolve();else for(var d=0;d<n.length;++d)try{i._filesystem.root.getFile(n[d],{},r,a)}catch(h){h=i._shapeError(h),c.errback(h)}},h=function(){},p=function(e){e=i._shapeError(e),i.app.trace.warning("Error removing local folder: {0}.".format(e.toString())),++s,a<=0&&u.resolve()},f=function(){r.readEntries(function(e){if(e.length){for(var t=0;t<e.length;++t){var i=e[t];i.isDirectory?i.removeRecursively(h,p):n.push(i.fullPath)}f()}else d()},function(e){e=i._shapeError(e),t&&t(e)})};f()}catch(g){g=i._shapeError(g),t&&t(g)}},e)},t.prototype.get=function(e,t,i,r){var n=this;this._silentlyEnsureInitializeThen(function(){try{n._readValue(e,t,i,r)}catch(o){o=n._shapeError(o),i&&i(o)}},function(){t(null)})},t.prototype.set=function(e,t,i,r,n){var o=this;this._ensureInitializedThen(function(){try{o._writeValue(e,t,i,r,n)}catch(a){a=o._shapeError(a),r&&r(a)}})},t.prototype.remove=function(e,t,i,r){var n=this,o=r?"":this.keyNamespace;this._ensureInitializedThen(function(){try{var r=function(e){e.remove(t,function(e){e=n._shapeError(e),i&&i(e)})},a=function(e){e=n._shapeError(e),n.app.trace.debug("Could not obtain file for removal: {0}.".format(e.toString())),i&&i(e)};n._filesystem.root.getFile(o+"/"+e+".json",{create:!1},r,a)}catch(s){s=n._shapeError(s),i&&i(s)}})},t}(i.StorageProviderBase);t.FileStorageProvider=o})},"geocortex/framework/storage/LocalStorageProvider":function(){define(["require","exports","geocortex/framework/storage/StorageProviderBase","geocortex/framework/storage/StorageStats"],function(e,t,i,r){"use strict";var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isFull=!1,t}return __extends(t,e),t.prototype.initialize=function(){e.prototype.initialize.call(this),this._localStorage=window.localStorage},t.prototype.isSupported=function(){return this._localStorage||this.initialize(),!!this._localStorage},t.prototype.isFull=function(){return this._localStorage||this.initialize(),this._isFull},t.prototype.getScore=function(){return this._localStorage||this.initialize(),5},t.prototype.getStats=function(){return this._localStorage||this.initialize(),new r.StorageStats},t.prototype.clear=function(e,i){this._localStorage||this.initialize();for(var r=null,n=new RegExp("^"+this.keyNamespace+t._namespaceSeperator),o=0,a=this._localStorage.length;o<a;o++){var s=this._localStorage.key(o);if(n.test(s))try{this._localStorage.removeItem(s),o--,a--}catch(l){r=l}}null!=r?i&&i(r):e&&e()},t.prototype.clearAllData=function(e,t){this._localStorage||this.initialize();try{this._localStorage.clear(),e&&e()}catch(i){t&&t(i)}},t.prototype.get=function(e,i,r,n){e=n?e:"{0}{1}{2}".format(this.keyNamespace,t._namespaceSeperator,e),this._localStorage||this.initialize();try{var o=this._localStorage.getItem(e);i&&i(o)}catch(a){r&&r(a)}},t.prototype.set=function(e,i,r,n,o){e=o?e:"{0}{1}{2}".format(this.keyNamespace,t._namespaceSeperator,e),this._localStorage||this.initialize();try{this._localStorage.setItem(e,i),r&&r()}catch(a){n&&n(a)}},t.prototype.remove=function(e,i,r,n){e=n?e:"{0}{1}{2}".format(this.keyNamespace,t._namespaceSeperator,e),this._localStorage||this.initialize();try{this._localStorage.removeItem(e),i&&i()}catch(o){r&&r(o)}},t}(i.StorageProviderBase);n._namespaceSeperator="→",t.LocalStorageProvider=n})},"geocortex/framework/storage/Store":function(){define(["require","exports","geocortex/framework/storage/HttpStorageProvider","geocortex/framework/storage/FileStorageProvider","geocortex/framework/storage/LocalStorageProvider"],function(e,t,i,r,n){"use strict";var o=function(){function e(e,t){this.app=e,this._rootNamespace=this._sanitizeKey(t?t.toString():"framework."+this.app.id)}return e.prototype.initialize=function(e){if(e)this._provider=e;else if(i.HttpStorageProvider.isSupported())this._provider=new i.HttpStorageProvider(this.app);else{var t=new r.FileStorageProvider(this.app);t.isSupported()?this._provider=t:this._provider=new n.LocalStorageProvider(this.app)}this._provider.keyNamespace=this._rootNamespace},e.prototype.hasProvider=function(){return null!=this._provider},e.prototype._yield=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},e.prototype._yieldError=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},e.prototype._yieldGet=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},e.prototype.clear=function(e,t){this._provider&&this._provider.clear(this._yield(e),this._yieldError(t))},e.prototype.clearAllData=function(e,t){this._provider&&this._provider.clearAllData(this._yield(e),this._yieldError(t))},e.prototype._sanitizeKey=function(e){var t=e.replace(new RegExp("[/\\\\:,?=|]","gm"),"_");return t},e.prototype.set=function(e,t,i,r,n){var o=new dojo.Deferred,a=this._sanitizeKey(e);return n=n||!1,this._provider&&this._provider.set(a,t,this._yield(function(){o&&o.fired==-1&&o.resolve(t),i&&i(e,t)}),this._yieldError(function(i){o&&o.fired==-1&&o.resolve(i),r&&r(i,e,t)}),n),o},e.prototype.get=function(e,t,i,r){var n=new dojo.Deferred,o=this._sanitizeKey(e);return r=r||!1,this._provider&&this._provider.get(o,this._yieldGet(function(i){n&&n.fired==-1&&n.resolve(i),t&&t(i,e)}),this._yieldError(function(t){n&&n.fired==-1&&n.resolve(t),i&&i(t,e)}),r),n},e.prototype.remove=function(e,t,i,r){var n=new dojo.Deferred,o=this._sanitizeKey(e);return r=r||!1,this._provider&&this._provider.remove(o,this._yield(function(){n&&n.fired==-1&&n.resolve(e),t&&t(e)}),this._yieldError(function(t){n&&n.fired==-1&&n.resolve(t),i&&i(t,e)}),r),n},e}();t.Store=o})},"geocortex/framework/application/ResourceManager":function(){define(["require","exports","geocortex/framework/utils/utils"],function(e,t,i){"use strict";var r=function(){function t(){this.resources=[],this.cachedResources={},this.themesToInject=[]}return t.prototype.fetch=function(t,r,n){n=n||"inv";var o=r+"-"+n+"-"+t;if(this.cachedResources.hasOwnProperty(o))return this.cachedResources[o];var a=e.cache,s=window.location.pathname;/\/$/.test(s)||(s+="/");var l="url:/"+t;if(null!=a[l])return a[l];var u=this.findResource(t,r,n);if(!u)return null;var c=null;switch(u.format){case"css":case"html":c="<"!==(u.data||"").trim().charAt(0)?i.base64Decode(u.data):u.data,this.cachedResources[o]=c;break;case"json":c=i.base64Decode(u.data),c=JSON.parse(c),this.cachedResources[o]=c;break;default:return null}return c},t.prototype.fetchAllFor=function(e,t){for(var i=[],r=0;r<this.resources.length;++r){var n=this.resources[r];if(n.library==e){if(null!=t&&n.format!=t)continue;i.push(n)}}return i},t.prototype.register=function(e,t,i,r,n){var o=this.findResource(i,e);if(!o){var a={};a.name=i,a.library=e,a.locale=t,a.format=r,a.data=n,this.resources.push(a)}},t.prototype.remove=function(e,t,i){var r=this.findResource(t,e,i);if(null!=r){Array.removeItem(this.resources,r);var n=e+"-"+i+"-"+t;return this.cachedResources.hasOwnProperty(n)&&delete this.cachedResources[n],!0}return!1},t.prototype.injectTheme=function(e){this.themesToInject.push(e)},t.prototype.performThemeInjection=function(){for(var e=dojo.query("head")[0],t=0;t<this.themesToInject.length;++t){var i=dojo.create("link",{rel:"stylesheet",href:this.themesToInject[t]});dojo.place(i,e,"last")}},t.prototype.findResource=function(e,t,i){i=i||"inv";for(var r=0;r<this.resources.length;++r){var n=this.resources[r];if(n.name==e){if(null!=t&&n.library!=t)continue;if(n.locale==i)return n}}return null},t}();t.ResourceManager=r})},"geocortex/framework/resourceManager":function(){define(["require","exports","geocortex/framework/application/ResourceManager"],function(e,t,i){"use strict";t.resourceManager=new i.ResourceManager})},"geocortex/framework/ui/ViewManager":function(){define(["require","exports","geocortex/framework/utils/ArrayUtils","geocortex/framework/config/ViewConfig","geocortex/framework/utils/utils","geocortex/framework/resourceManager","geocortex/framework/events/ViewDimensionsChangedArgs"],function(e,t,i,r,n,o,a){"use strict";var s=function(){function e(){}return e}();t.ViewManagerRegionEntry=s;var l=function(){function e(e){this._views=[],this._hostedRegions=[],this._pendingRegions=[],this.app=e,this._registerCommands()}return e.prototype.shutdown=function(){for(var e=0;e<this._hostedRegions.length;++e)this.destroyRegion(this._hostedRegions[e]);this._hostedRegions.length=0;for(var t=0;t<this._views.length;++t)this.destroyView(this._views[t]);this._views.length=0;for(var e=0;e<this._pendingRegions.length;++e){for(var i=this._pendingRegions[e],t=0;t<i.views.length;++t)this.destroyView(i.views[t]);i.views=[]}this._pendingRegions.length=0},e.prototype._registerCommands=function(){this.app.commandRegistry.command("ActivateView").register(this,function(e){var t=this.getViewById(e);return t?void this.activateView(t):void this.app.trace.warning("ActivateView: Could not find view '{0}'.".format(e))}),this.app.commandRegistry.command("DeactivateView").register(this,function(e){var t=this.getViewById(e);return t?void this.deactivateView(t):void this.app.trace.warning("DeactivateView: Could not find view '{0}'.".format(e))}),this.app.commandRegistry.command("ToggleView").register(this,function(e){var t=this.getViewById(e);return t?void this.toggleView(t):void this.app.trace.warning("ToggleView: Could not find view '{0}'.".format(e))}),this.app.commandRegistry.command("DestroyView").register(this,function(e){var t=this.getViewById(e);return t?void this.destroyView(t):void this.app.trace.warning("DestroyView: Could not find view '{0}'.".format(e))})},e.prototype.activateView=function(e){if(!e.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to activateView."),!1;var t=this.getRegionForViewId(e.id);if(!t){if(!e.regionName)return this.app.trace.warning("Could not activate view '{0}' - view is not associated with a region.".format(e.id)),!1;if(t=this.getExistingRegionByName(e.regionName))return t.hostView(e),t.activateView(e),!0;var r=this._getPendingRegionEntryByName(e.regionName);if(r)return i.contains(r.views,e)?(this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(e.id,e.regionName)),!1):(r.views.push(e),!1);var n=new s;return n.name=e.regionName,n.views=[e],this._pendingRegions.push(n),!1}return t.activateView(e),!0},e.prototype.deactivateView=function(e){if(!e.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to deactivateView."),!1;var t=this.getRegionForViewId(e.id);return t?(t.deactivateView(e),!0):(this.app.trace.debug("Could not find region for view '{0}'.".format(e.id)),!1)},e.prototype.toggleView=function(e){e.isActive?this.deactivateView(e):this.activateView(e)},e.prototype.createView=function(e,t){var r=e.viewId||e.id;if(r){var a=this.getViewById(r);if(a)return void this.app.trace.error("Could not create view '{0}' - a view with that ID already exists.".format(r))}var l=e.typeName||e.type||"geocortex.framework.ui.ViewBase";if(t=t||null,!t)try{t=this.app.instantiateFrameworkObject(l,e.libraryId)}catch(u){return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(l),u),null}if(null==t)return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(l)),null;var c=e.isVisible||e.visible;if(t.id=null==r?"View-"+n.alphaNumericToken():r,t.markupResource=e.markupResource||e.markup,t.regionName=e.regionName||e.region,t.configuration=e.configuration||{},t.isManaged=e.isManaged||!1,t.title.set(e.title||""),t.description.set(e.description),t.iconUri.set(e.iconUri),e.viewModel&&(t.viewModel=e.viewModel),this._views.push(t),t.regionName){var d=this.getExistingRegionByName(t.regionName);if(d)return d.hostView(t),c&&d.activateView(t),t;c&&(t.___shouldActivate=!0);var h=this._getPendingRegionEntryByName(t.regionName);if(h){if(i.contains(h.views,t))return this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(t.id,t.regionName)),t;h.views.push(t)}else{var p=new s;p.name=t.regionName,p.views=[t],this._pendingRegions.push(p)}return t}var f=o.resourceManager.fetch(t.markupResource,t.libraryId||"inv");return null==f?(this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),null):(t.root=dojo.create("div"),t.root.innerHTML=f,t.root.children&&1===t.root.children.length&&(t.root=t.root.children[0]),t)},e.prototype.create=function(e,t,i,n,o){var a=new r.ViewConfig(null,null,e);a.markupResource=i,a.regionName=n,a.configuration={};var s=this.createView(a);if(null===s)return s;var l=null;try{l=this.app.instantiateFrameworkObject(t||"geocortex.framework.ui.ViewModelBase",o),l.initialize({})}catch(u){return this.app.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(a.typeName,u.message),u),null}return s.attach(l),this.activateView(s),s},e.prototype.destroyView=function(e){for(var t=this.getRegionForViewId(e.id),r=window.document.activeElement;r;){if(e.root===r){window.document.activeElement.blur();break}r=r.parentElement}if(null!=t&&(t.deactivateView(e),t.unhostView(e)),e.destroy(),null!=e.childRegions)for(var n=0;n<e.childRegions.length;++n)this.destroyRegion(e.childRegions[n]);if(e.childRegions.length=0,null!=e.root){var o=new dojo.NodeList;o.push(e.root),o.orphan()}i.removeItem(this._views,e),e.onDestroy()},e.prototype.destroyRegion=function(e){if(null!=e.views)for(var t=e.views.length-1;t>=0;t--)this.destroyView(e.views[t]);i.removeItem(this._hostedRegions,e),e.unhost()},e.prototype.discoverRegions=function(e,t){var i=this;null!=e&&dojo.query("[data-region-name]",e).forEach(function(e){var r=dojo.attr(e,"data-region-name"),n=i.getExistingRegionByName(r);if(n)return void i.app.trace.error("Region '{0}' already exists.".format(r));var o=i._getPendingRegionEntryByName(r),a=null;o&&i._removePendingRegionEntry(r);var s=dojo.attr(e,"data-region-adapter"),l=null;try{s||(s="geocortex.framework.ui.DivRegionAdapter"),l=dojo.getObject(s,!0),a=new l(r,i.app)}catch(u){return i.app.trace.error("Could not instantiate region with type '{0}' - type was not found.".format(s),u),null}var c=dojo.attr(e,"data-region-options"),d={};if(c)for(var h=c.split(","),p=0;p<h.length;p++){var f=h[p].split("=");d[f[0]]=f.length>1?f[1]:""}if(a.host(e,d),i._hostedRegions.push(a),null!=t&&(t.childRegions.push(a),a.ownerView=t),o)for(var g=0;g<o.views.length;++g){var v=o.views[g];i._views.push(v),a.hostView(v),v.___shouldActivate&&(delete v.___shouldActivate,a.activateView(v))}})},e.prototype.getExistingRegionByName=function(e){for(var t=0;t<this._hostedRegions.length;++t){var i=this._hostedRegions[t];if(i.name==e)return i}return null},e.prototype._getPendingRegionEntryByName=function(e){for(var t=0;t<this._pendingRegions.length;++t){var i=this._pendingRegions[t];if(i.name==e)return i}return null},e.prototype._removePendingRegionEntry=function(e){for(var t=-1,r=0;r<this._pendingRegions.length;++r){var n=this._pendingRegions[r];if(n.name==e){t=r;break}}return r>-1&&(i.remove(this._pendingRegions,t,t),!0)},e.prototype.getRegionForViewId=function(e){for(var t=0;t<this._hostedRegions.length;++t)for(var i=this._hostedRegions[t],r=0;r<i.views.length;++r){var n=i.views[r];if(n.id===e)return i}return null},e.prototype.getViewById=function(e){for(var t=0;t<this._views.length;++t){var i=this._views[t];if(i.id&&i.id===e)return i}},e.prototype.getViews=function(){return this._views},e.prototype.notifyDimensionsChanged=function(e){var t=this.getRegionForViewId(e.id),i=new a.ViewDimensionsChangedArgs(e,t);this.app.eventRegistry.event("ViewDimensionsChangedEvent").publish(i)},e}();t.ViewManager=l})},"geocortex/framework/ui/PopupModalRegionAdapter":function(){define(["require","exports","geocortex/framework/ui/RegionAdapterBase","geocortex/framework/utils/ArrayUtils","geocortex/framework/resourceManager"],function(e,t,i,r,n){"use strict";var o=function(e){function t(i,r){var n=e.call(this,i,r)||this;if(n.activeView=null,n.activeViews=[],n.titleBindingToken=null,n.contentHeader=null,n.contentTitle=null,n.contentContainer=null,n.contentElement=null,n.overlayElement=null,n._scrollTimer=null,n._scrollDelay=50,n._screenReaderNarrationDisabled=!1,t.instance)throw new Error("PopupModalRegionAdapter is a singleton and has already been constructed once.");return t.instance=n,null==n.app.modalRegionSingleton&&(n.app.modalRegionSingleton=n),n.app.command("CloseModalRegion").register(n,function(){n.deactivate()}),n.app.event("ViewActivatedEvent").subscribe(n,function(){n.activeViews.length>0&&setTimeout(function(){n.positionContent()},0)}),n.app.event("ViewDimensionsChangedEvent").subscribe(n,function(){n.positionContent()}),n}return __extends(t,e),
t.getInstance=function(){return t.instance},t.prototype.activate=function(){this.activeViews.length>0&&(dojo.style(this.domElement,"opacity",0),dojo.query(this.domElement).removeClass("inactive"),dojo.query(this.domElement).addClass("active"),dojo.query(this.overlayElement).removeClass("inactive"),dojo.query(this.overlayElement).addClass("active"))},t.prototype.deactivate=function(){dojo.query(this.domElement).removeClass("active"),dojo.query(this.domElement).addClass("inactive"),dojo.query(this.overlayElement).removeClass("active"),dojo.query(this.overlayElement).addClass("inactive"),this._screenReaderNarrationDisabled&&(this.app.command("EnableScreenReaderNarrate").execute(),this._screenReaderNarrationDisabled=!1),this.activeView&&(this.activeView=null)},t.prototype.host=function(t){var i=this;e.prototype.host.call(this,t),this.domElement=t,dojo.query(this.domElement).removeClass("active"),dojo.query(this.domElement).addClass("inactive"),this.contentContainer=dojo.query(".modal-container")[0],this.contentElement=dojo.query(".modal-container-inner")[0],this.overlayElement=dojo.query(".modal-overlay")[0],dojo.connect(window,"onresize",function(){i.handleScrollEvent()}),dojo.connect(window,"onscroll",function(){i.handleScrollEvent()}),this.app.event("WorkflowFormTextInputBlurredEvent").subscribe(this,function(){setTimeout(function(){i.positionContent()},100)})},t.prototype.handleScrollEvent=function(){var e=this;null!=this._scrollTimer&&(clearTimeout(this._scrollTimer),this._scrollTimer=null),this._scrollTimer=setTimeout(function(){e.positionContent()},0)},t.prototype.positionContent=function(){var e=this;if(this.contentContainer&&null!=this.activeView&&null!=this.activeView.root){var t=dojo.position(this.contentContainer),i=dojo.window.getBox(),r=t.w;t.w>i.w?(r=i.w,dojo.style(this.contentElement,{"max-width":r+"px"})):dojo.style(this.contentElement,{"max-width":""});var n=t.h;t.h>i.h?(n=i.h,dojo.style(this.contentElement,{"max-height":n+"px"})):dojo.style(this.contentElement,{"max-height":""}),dojo.style(this.contentContainer,{left:i.w/2-r/2+"px",top:i.h/2-n/2+"px"}),setTimeout(function(){return dojo.style(e.domElement,"opacity",1)})}},t.prototype.showActiveView=function(e){e.isActive&&(this.activeView=e,this.hideAllViews(),e.activated(),this.activate(),this.activeView=e,dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"active"))},t.prototype.hideAllViews=function(){dojo.query("> .view",this.contentElement).removeClass("active"),dojo.query("> .view",this.contentElement).addClass("inactive")},t.prototype.activateView=function(t){var i=this;r.contains(this.activeViews,t)?(r.removeItem(this.activeViews,t),this.activeViews.push(t)):this.activeViews.push(t),this._screenReaderNarrationDisabled||(this._screenReaderNarrationDisabled=!0,this.app.command("DisableScreenReaderNarrate").execute()),e.prototype.activateView.call(this,t),this.showActiveView(t),this._repositionOnImageLoaded(t.root),setTimeout(function(){return i.app.command("FocusOnFirstInputInView").execute(t)},400)},t.prototype.deactivateView=function(t){r.removeItem(this.activeViews,t),this.activeViews.length>0?(this.showActiveView(this.activeViews[this.activeViews.length-1]),this.positionContent()):this.deactivate(),e.prototype.deactivateView.call(this,t)},t.prototype.deactivateActiveView=function(){if(this.activeView){null!=this.titleBindingToken&&(this.activeView.title.unbind(this.titleBindingToken),this.titleBindingToken=null);var e=this.activeView;this.activeView=null,this.deactivateView(e),r.removeItem(this.activeViews,this.activeView)}},t.prototype.hostView=function(t){if(this.views.push(t),null==t.root){var i=n.resourceManager.fetch(t.markupResource,t.libraryId);if(null==i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;t.root=dojo.create("div",{className:"view {0}".format(t.id)}),t.root.innerHTML=i,dojo.place(t.root,this.contentElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t),this.positionContent()}else dojo.place(t.root,this.contentElement,"last");return e.prototype.hostView.call(this,t),!0},t.prototype.unhostView=function(t){t==this.activeView&&this.deactivateView(t),r.removeItem(this.views,t),r.removeItem(this.activeViews,t);var i=new dojo.NodeList;i.push(t.root),i.orphan(),e.prototype.unhostView.call(this,t)},t.prototype._repositionOnImageLoaded=function(e){var t=this,i="attached_ModalRegion_ImageLoadedConnection";dojo.forEach(dojo.query("img",e),function(e){e[i]&&(dojo.disconnect(e[i]),delete e[i]);var r=dojo.connect(e,"load",t,function(e){t._imageLoaded(e)});e[i]=r})},t.prototype._imageLoaded=function(e){var t=e.target,i="attached_ModalRegion_ImageLoadedConnection";t[i]&&(dojo.disconnect(t[i]),delete t[i]),this.positionContent()},t}(i.RegionAdapterBase);o.instance=null,t.PopupModalRegionAdapter=o})},"geocortex/framework/application/ApplicationCommands":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e.createCommands=function(e){},e}();t.ApplicationCommands=i})},"geocortex/framework/index":function(){define(["require","exports","geocortex/framework/resourceManager"],function(e,t,i){"use strict";function r(e){t.applications.push(e)}function n(e){return t.libraries[e]===!0}function o(e){if(!n(e)){t.libraries[e]=!0;for(var r=0,o=!0,a=0;a<t.applications.length;++a){var s=t.applications[a],l=s.getLibraryOrder(e),u=s.shouldOmitStylesForLibrary(e);if(u===!0&&(o=!1),l){r=l+32*a;break}}if(o){var c=i.resourceManager.fetchAllFor(e,"css");c||(c=[]);for(var d="",h=dojo.query("head")[0],p=0;p<c.length;++p){var f=c[p],g=i.resourceManager.fetch(f.name,f.library);g&&(d+=g+" ")}var v=document.createElement("style");if(t.injectedStyleBlocks.push(v),v.setAttribute("type","text/css"),dojo.attr(v,"data-block-order",r),0===r)dojo.place(v,h,"first");else{var m=dojo.query("head style[data-block-order]");if(0===m.length)dojo.place(v,h,"first");else{for(var y=null,w=!1,b=0;b<m.length;++b){var _=m[b],k=dojo.attr(_,"data-block-order")||0;if(k>=r){dojo.place(v,_,"before"),w=!0;break}y=_}w||dojo.place(v,y,"after")}}if(v.styleSheet)v.styleSheet.cssText=d;else{var E=document.createTextNode(d);v.appendChild(E)}}for(var a=0;a<t.applications.length;++a){var s=t.applications[a];s.notifyLibraryDownload(e)}}}function a(){t.initialized||(t.initialized=!0)}t.applications=[],t.libraries={},t.injectedStyleBlocks=[],t.initialized=!1,t.registerApplication=r,t.hasLibrary=n,t.notifyLibraryDownload=o,t.initialize=a,a()})},"geocortex/framework/config":function(){define(["require","exports"],function(e,t){"use strict";t._configDomains=[],t._nonConfigs=[]})},"geocortex/framework/config/ConfigurationLoader":function(){define(["require","exports","geocortex/framework/config"],function(e,t,i){"use strict";function r(e){var t=[-1399014851,-706512510];i._nonConfigs&&i._nonConfigs.length>0&&(t=i._nonConfigs.map(function(e){return String.quickHashCode(e.toLowerCase())}));var r=document.createElement("a");for(r.href=e.toLowerCase(),e=r.href,e=decodeURIComponent(e);e.indexOf("%")>-1;)e=decodeURIComponent(e);e=e.replace(/[\\\/:]+/g,"/");var n=e.split(/[\\\/:]/),o=(n.length,n.map(function(e){return e.toLowerCase()}).map(function(e,t){return t<n.length-1?[e,n[t+1]]:null}));o.pop();var a=!1;return o.forEach(function(e){var i=String.quickHashCode(e[0]+"/"+e[1]);if(t.indexOf(i)>-1)return void(a=!0)}),a}var n=function(){function e(e){this._targetConfigUri=null,this.app=e}return e.prototype.loadConfigurationTree=function(e,t){var i=this;this._targetConfigUri=e;var n=r(this._targetConfigUri);if(n){var o=new Error("Configuration cannot be loaded from this location.");return void this.app.event("ConfigurationLoadFailedEvent").publish(o)}this.app.fetchConfigResource({url:this._targetConfigUri,load:function(e){null!=t&&void 0!=t&&t(e)},error:function(e){return i.app.event("ConfigurationLoadFailedEvent").publish(e)}})},e}();t.ConfigurationLoader=n,t.checkList=r})},"geocortex/framework/application/Application":function(){define(["require","exports","geocortex/framework/config/ConfigurationModel","geocortex/framework/observables","geocortex/framework/utils/Trace","geocortex/framework/application/ModuleManager","geocortex/framework/commands/CommandRegistry","geocortex/framework/events/EventRegistry","geocortex/framework/behaviors/BehaviorRegistry","geocortex/framework/storage/Store","geocortex/framework/ui/ViewManager","geocortex/framework/application/ApplicationCommands","geocortex/framework/index","geocortex/framework/resourceManager","geocortex/framework/config/ConfigurationLoader","geocortex/framework/ui/ViewModelBase","geocortex/framework/utils/utils","geocortex/framework/SimplePromise","geocortex/framework/config"],function(e,t,i,r,n,o,a,s,l,u,c,d,h,p,f,g,v,m,y){"use strict";var w=function(){function t(e,t,p,f){this.version="2.7",this.allowCrossDomainConfig=!1,this.configuration={},this.localServerAddress="",this.localServerToken=null,this.localServerNamespace=null,this.urlParameters={},this.developmentMode=!1,this.isHttpsMode=!1,this.allLibrariesLoaded=!1,this.configPreprocessor=null,this.modalRegionSingleton=null,this._resourceDictionaries={},this.frameworkObjects={},this._pendingFrameworkObjectRequests={},this._initialStateAppliedCount=0,this._moduleRecords=[],this._viewModelEntries={},this.id=p||"default",this.configTokens=f||{},this.trace=new n.Trace(this),this.moduleManager=new o.ModuleManager(this),this.commandRegistry=new a.CommandRegistry(this),this.eventRegistry=new s.EventRegistry(this),this.behaviorRegistry=new l.BehaviorRegistry(this),this.viewManager=new c.ViewManager(this),this.command=dojo.hitch(this.commandRegistry,this.commandRegistry.command),this.event=dojo.hitch(this.eventRegistry,this.eventRegistry.event),this.behavior=dojo.hitch(this.behaviorRegistry,this.behaviorRegistry.behavior),this.hostElement=t||dojo.body(),this.store=new u.Store(this,this.id),this.store.initialize(),null==e?this.configModel=new i.ConfigurationModel(this):"object"==typeof e?(this.configObject=e,this.configUri=null):(this.configModel=null,this.configUri=e.trim()),this.isOffline=new r.Observable((!1)),this.isOffline.bind(this,function(e){e?this.eventRegistry.event("ApplicationOfflineEvent").publish():this.eventRegistry.event("ApplicationOnlineEvent").publish()}),this.isNative=new r.Observable((!1)),this.isNative.bind(this,function(e){e?this.eventRegistry.event("ApplicationNativeReadyEvent").publish():this.eventRegistry.event("ApplicationNativeRemovedEvent").publish()}),d.ApplicationCommands.createCommands(this);var g=document.URL,v=g.substring(g.indexOf("?")+1,g.length);this.urlParameters=dojo.queryToObject(v)||{};var m=window.location.protocol;m.indexOf(":")<0&&(m+=":");var y=window.location.pathname.lastIndexOf("/"),w="/";y>-1&&(w=window.location.pathname.substr(0,y)),""===w&&(w="/"),this.host=m+"//"+window.location.host.trim()+w.trim(),"/"!==this.host.charAt(this.host.length-1)&&(this.host=this.host+"/"),this.isHttpsMode=this.isHttpsUri(this.host),this.detectBrowserLocale(),h.registerApplication(this)}return t.prototype.getLibraryOrder=function(e){if(!this.configModel.libraryConfigs)return null;for(var t=0;t<this.configModel.libraryConfigs.length;++t){var i=this.configModel.libraryConfigs[t];if(i.id===e)return t}return null},t.prototype.shouldOmitStylesForLibrary=function(e){if(!this.configModel.libraryConfigs)return null;for(var t=0;t<this.configModel.libraryConfigs.length;++t){var i=this.configModel.libraryConfigs[t];if(i.id===e)return!!i.omitStyles}return!1},t.prototype.translateConfiguration=function(e,t){var i=this,r=function(t,n,o){if("string"==typeof n){if(n.indexOf("@language")>-1){var a=n.split("-");if(a.length<2)throw new Error("Invalid language key '{0}'.".format(n));var s=a.join("-").replace("@",""),l=o||e;return i.getResource(l,s)}return i.performTokenReplacement(n)}if(n instanceof Array){for(var u=[],c=0;c<n.length;++c)u.push(r(c,n[c]));return u}if(n instanceof Function)return n;if(n instanceof Object){var d={},h=n.hasOwnProperty("libraryId")?n.libraryId:void 0;for(var p in n)n.hasOwnProperty(p)&&(d[p]=r(p,n[p],h));return d}return n},n={};for(var o in t)t.hasOwnProperty(o)&&(n[o]=r(o,t[o]));return n},t.prototype.performTokenReplacement=function(e){var t=this;if(!e)return e;var i=e.replace(/{.+?}/g,function(e){var i=e.substring(1,e.length-1),r=t.configTokens.hasOwnProperty(i)?t.configTokens[i]:e;return!r&&t.configuration&&t.configuration.hasOwnProperty(i)?t.configuration[i]:r?r:(t.trace.warning("The token syntax \\{{0}\\} was detected, but could not be matched to a valid replacement.".format(i)),"")});return i},t.prototype.isHttpsUri=function(e){var t=e.trim(),i=t.indexOf("://");return i>-1&&t.length>=5&&"https"===t.substring(0,5)},t.prototype.makeAbsolute=function(e,t){var i=new dojo._Url(e);if(i.host)return e;var r=t?t:"{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if("/"!=r.charAt(r.length-1)||"\\"!=r.charAt(r.length-1)){var n=r.split("/");--n.length,r=n.join("/"),r+="/"}if("/"==e.charAt(0)||"\\"==e.charAt(0)){var o=new dojo._Url(r);e=o.scheme+"://"+o.authority+"/"+e.substring(1)}else{for(var a=r.split("/"),s=e?e.split("../"):[],l=0,u=0;u<s.length;++u)""==s[u]&&++l;var c=a.slice(0,a.length-(l>0?l+1:l)),d=s.slice(l>0?l-1:l);e=c.join("/")+d.join("/")}return e},t.prototype.getHostElement=function(){return this.hostElement},t.prototype.getResource=function(e,t,i){i=i||this.locale||"inv",i=i.toLowerCase();var r=this._resourceDictionaries[i],n=this._resourceDictionaries.inv||{};r||(r=n);var o=r[e]||n[e];if(!o)return this.trace.warning("No resource dictionary found for library '{0}' while trying to get resource with key '{1}', using locale '{2}'.".format(e,t,i)),"@"+t;var a=null;if(o.hasOwnProperty(t))a=o[t];else{if(r===n)return"@"+t;if(o=n[e],!o||o.hasOwnProperty(t)===!1)return this.trace.warning("The resource with key '{0}' was not found in library '{1}'.".format(t,e)),"@"+t;a=o[t]}return"debug"===i?this._getDebugLocaleString(a):"strings"===i?t:"!!"===i?"!"+a+"!":a},t.prototype.getUri=function(e){var t=!1;if(t=e.indexOf("://")<0){var i=this.host+e;return this.isHttpsUri(i)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(i)),null==this.proxyUri||String.isNullOrEmpty(this.proxyUri)?i:this.proxyUri+encodeURIComponent(i)}return this.isHttpsUri(e)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(e)),this.proxyUri+encodeURIComponent(e)},t.prototype.getUrlParameter=function(e){if(this.urlParameters)for(var t in this.urlParameters)if(this.urlParameters.hasOwnProperty(t)&&!String.isNullOrEmpty(t)&&!String.isNullOrEmpty(e)&&t.toLowerCase()===e.toLowerCase())return this.urlParameters[t];return null},t.prototype.onLibrariesDownloaded=function(e){},t.prototype.onConfigurationLoaded=function(e){},t.prototype.notifyLibraryDownload=function(e){this.trace.info("Processing downloaded library '{0}' for application '{1}'.".format(e,this.id)),this.eventRegistry.event("LibraryDownloadedEvent").publish(e);var t=p.resourceManager.fetchAllFor(e,"json");if(t&&t.length>0)for(var i=0;i<t.length;++i){var r=t[i],n=p.resourceManager.fetch(r.name,r.library,r.locale);this.injectLibraryResources(e,n,r.locale)}this.configModel&&(this._initializeLibrary(e),this.pendingLibraryDownloads>0&&--this.pendingLibraryDownloads,this._doIfNoPendingLibraryDownloads())},t.prototype.hasLibrary=function(e){return h.hasLibrary(e)&&!!this.configModel.libraryModules[e]&&this._resourceDictionaries.inv&&!!this._resourceDictionaries.inv[e]},t.prototype.registerFrameworkObject=function(e){if(!e.id)throw new Error("Could not register framework object. Object was missing an ID.");this.frameworkObjects[e.id]=e;var t=this._pendingFrameworkObjectRequests[e.id];return t&&t.length&&(t.forEach(function(t){return t(e)}),t.length=0,delete this._pendingFrameworkObjectRequests[e.id]),e},t.prototype.freeAllFrameworkObjects=function(){},t.prototype.getFrameworkObjectById=function(e){for(var t in this.frameworkObjects)if(this.frameworkObjects.hasOwnProperty(t)&&t===e)return this.frameworkObjects[t];return null},t.prototype.getFrameworkObjectByIdAsync=function(e,t,i){if(!(e&&dojo.isString(e)&&t&&dojo.isFunction(t)))return void(i&&dojo.isFunction(i)&&i(new Error("Cannot retrieve Framework Object. Object ID or callback unspecified or incorrect.")));var r=this.getFrameworkObjectById(e);r?t(r):(this._pendingFrameworkObjectRequests[e]=this._pendingFrameworkObjectRequests[e]||[],this._pendingFrameworkObjectRequests[e].push(t))},t.prototype.initialize=function(){var e=this;dojo.connect(window,"onresize",function(t){e.eventRegistry.event("ApplicationResizedEvent").publish()}),dojo.subscribe("ServiceTokenRefreshed",function(t){e.configuration&&t.serviceUrl===e.configuration.geometryServiceUrl&&(e.configuration.geometryServiceToken=t.token)});var t=new f.ConfigurationLoader(this),r=function(t){"string"==typeof t&&(t=JSON.parse(t)),e.configPreprocessor&&(e.configPreprocessor(t),e.configPreprocessor=null);var r=new i.ConfigurationModel(e);e.onConfigurationLoaded(t),e.abortInitialization||r.parse(t,function(t){return e.processConfiguration(t)})};if(null!=this.configModel)throw new Error("Configuration model should not be loaded already");if(null!=this.configObject)r(this.configObject),this.configObject=null;else{if(null==this.configUri)throw new Error("No configuration method");t.loadConfigurationTree(this.configUri,function(e){return r(e)})}this.viewManager.discoverRegions(this.hostElement)},t.prototype.shutdown=function(e){this.eventRegistry.event("ApplicationShutdownEvent").publish(e),this.viewManager.shutdown(),this.moduleManager.shutdown(e),this.commandRegistry.clear(),this.eventRegistry.clear()},t.prototype._doIfNoPendingLibraryDownloads=function(){0===this.pendingLibraryDownloads&&(p.resourceManager&&p.resourceManager.performThemeInjection(),this.allLibrariesLoaded=!0,this.eventRegistry.event("ViewerLibrariesDownloadedEvent").publish(this),this.onLibrariesDownloaded(this),this._initialStateAppliedCount<=0&&this.initialStateAppliedCallback&&this.initialStateAppliedCallback(this))},t.prototype.onInitializationComplete=function(){null!=this.initializationCompleteCallback&&void 0!=this.initializationCompleteCallback&&this.initializationCompleteCallback(this)},t.prototype.detectBrowserLocale=function(){navigator.language?this.locale=navigator.language:navigator.userLanguage?this.locale=navigator.userLanguage:navigator.browserLanguage?this.locale=navigator.browserLanguage:this.locale="inv"},t.prototype._getLibraryConfig=function(e){return this.configModel.libraryConfigs.filter(function(t){return t.id===e})[0]},t.prototype._getAsyncModuleRoot=function(e){return e.libraryId+"/modules/"+e.moduleName},t.prototype._establishRecords=function(){this._moduleRecords=this.configModel.moduleConfigs.map(function(e,t){return{index:t,moduleConfig:e,loaded:!1,initialized:!1,tasks:function(e){var t=0;t++,t+=e.viewConfigs.length;for(var i=0,r=e.viewConfigs;i<r.length;i++){var n=r[i];n.requireMarkup&&t++}return t+=e.viewModelConfigs.length}(e),tasksDone:0,MainClass:null,views:e.viewConfigs.map(function(e){return{ViewClass:null,viewMarkup:null}}),viewModels:e.viewModelConfigs.map(function(e){return{ViewModelClass:null}})}})},t.prototype._download=function(){this.pendingLibraryDownloads=this.configModel.libraryConfigs.length,this._allViewModels=this.configModel.moduleConfigs.map(function(e){return e.viewModelConfigs}).reduce(function(e,t){return e.concat(t)}),this._loadTraditionalLibraries(),this._cacheAsyncModules(),this._loadAsyncLibraries()},t.prototype._loadTraditionalLibraries=function(){for(var e=this.configModel.libraryConfigs.filter(function(e){return!e.async}),t=0,i=e;t<i.length;t++){var r=i[t];h.hasLibrary(r.id)?this.notifyLibraryDownload(r.id):(h.libraries[r.id]=!1,r.uri?this.includeScript(r.uri,function(e){},function(){}):this.notifyLibraryDownload(r.id))}},t.prototype._cacheAsyncModules=function(){var t=this,i=this.configModel.moduleConfigs.filter(function(e){return t._getLibraryConfig(e.libraryId).async});i.forEach(function(i){var r=(t._getLibraryConfig(i.libraryId),t._getAsyncModuleRoot(i));e([r],null,function(e){})})},t.prototype._loadAsyncLibraries=function(){var t=this,i=this._moduleRecords.filter(function(e){return t._getLibraryConfig(e.moduleConfig.libraryId).async});if(i.length){var r=function(){var e=t.configModel.libraryConfigs.filter(function(e){return!!e.async});e.forEach(function(e){var i=t._moduleRecords.filter(function(t){return t.moduleConfig.libraryId===e.id}),r=!i.some(function(e){return!e.loaded});r&&h.notifyLibraryDownload(e.id)})},n=function(e,i){i&&(i.message="Subcomponent failed for module '"+e.moduleConfig.moduleName+"': "+i.message,t.trace.error(i.message,i)),e.tasksDone++,e.tasksDone>=e.tasks&&(e.loaded=!0,r(),t._initializeModule(e))},o=0,a="Mapping/modules/",s=function(r){var l=r.moduleConfig,u=l.libraryId+"/modules/"+l.moduleName+"/",c=""+u+l.moduleName+"Module";l.require||(l.require=c),r.tasks=1+2*l.viewConfigs.length+l.viewModelConfigs.length,e([t._getAsyncModuleRoot(l)],function(c){e([l.require],function(e){if(r.MainClass=e[l.moduleName+"Module"],!r.MainClass||"function"!=typeof r.MainClass){var t=Object.keys(e).filter(function(t){return"function"==typeof e[t]})[0];r.MainClass=e[t]}n(r)},function(e){return n(r,e)}),l.viewConfigs.forEach(function(i,o){var s=r.views[o];i.require||(i.require=u+i.viewId);var c=function(){e([i.require],function(e){if(s.ViewClass=e[i.viewId],!s.ViewClass){var t=Object.keys(e).filter(function(t){return"function"==typeof e[t]})[0];s.ViewClass=e[t]}n(r)},function(e){return n(r,e)}),i.requireMarkup||(i.requireMarkup=i.markupResource);var o=function(){i.requireMarkup&&e(["dojo/text!/"+i.requireMarkup],function(e){s.viewMarkup=e,n(r)},function(e){return n(r,e)})},u=e.cache["url:/"+i.requireMarkup],c=i.requireMarkup.startsWith(a);if(!u&&c){var d=i.requireMarkup.split("/"),h=d[2];t.trace.debug("Deferring loading of "+l.moduleName+" to load module "+h+" for view markup "+i.requireMarkup),e([a+h],function(e){o()})}else o()},d=e.cache[i.require],h=i.require.startsWith(a);if(!d&&h){var p=i.require.split("/"),f=p[2];t.trace.debug("Deferring loading of "+l.moduleName+" to load module "+f+" for view "+i.viewId),e([a+f],function(e){c()})}else c()}),l.viewModelConfigs.forEach(function(t,i){var o=r.viewModels[i];t.require||(t.require=u+t.viewModelId),e([t.require],function(e){if(o.ViewModelClass=e[t.viewModelId],!o.ViewModelClass||"function"!=typeof o.ViewModelClass){var i=Object.keys(e).filter(function(t){return"function"==typeof e[t]})[0];o.ViewModelClass=e[i]}n(r)},function(e){return n(r,e)})}),o++;var d=i[o];d&&s(d)})},l=i[o];s(l)}},t.prototype._initializeLibrary=function(e,t){var i=this;void 0===t&&(t=function(e){return i.trace.error(e.message,e)});var r=this._getLibraryConfig(e);if(!r||!r.async){var n=this.configModel.moduleConfigs.filter(function(t){return t.libraryId===e});this._initializeTraditionalModules(n)}this.initializationCompleteCallback&&(this.onInitializationComplete(),this.initializationCompleteCallback=null)},t.prototype._initializeModule=function(e,t){var i=this;void 0===t&&(t=function(e){return i.trace.error(e.message,e)});var r=e.moduleConfig,n=r.libraryId,o=this._getLibraryConfig(n),a=o.async;if(!this.moduleManager.moduleIsLoaded(r.moduleName)){if(!e.MainClass)return void console.log("# SKIP MODULE "+e.moduleConfig.moduleName);var s=a?new e.MainClass(this,n):this.moduleManager.instantiate(r.moduleType,r.libraryId);if(!s)return void t(new Error("Failed module instantiation ("+r.moduleName+")"));if(performance&&performance.mark&&performance.mark("mark_start_init_mod_"+r.moduleName),s.initialize){this.trace.info("Initializing module '{0}'.".format(r.moduleName));try{s.id="module-"+n+"-"+r.moduleName,s.initialize(this.translateConfiguration(n,r.configuration)),this.registerFrameworkObject(s),function(e,t){i._initialStateAppliedCount++,i.getInitialState(t.moduleName,n).then(function(t){if(t&&"function"==typeof e.applyState)return t.serialVersion||(t.serialVersion=1),e.applyState(t)}).then(function(){return i._onInitialStateApplied(t.moduleName)},function(e){return i._onInitialStateApplied(t.moduleName,e)})}(s,r)}catch(l){return l.message="Error initializing module '"+r.moduleName+"': "+l.message+".",void t(l)}this.moduleManager.markModuleLoaded(r.moduleName,s),this.trace.debug("Module '"+r.moduleName+"' initialized.")}e.viewModels.forEach(function(e,o){var s=r.viewModelConfigs[o];if(i._viewModelEntries[s.viewModelId])i.trace.debug("View model '{0}' is defined by module '{1}' but it already exists.".format(s.viewModelId,r.moduleName));else try{var l=a?new e.ViewModelClass(i,n):i.instantiateFrameworkObject(s.typeName,s.libraryId);l.id=s.viewModelId||v.alphaNumericToken(),l.initialize(i.translateConfiguration(n,s.configuration)),i._viewModelEntries[s.viewModelId]=l,i.registerFrameworkObject(l)}catch(u){u.message="Failed to initialize view model '"+s.viewModelId+"': "+u.message,t(u)}}),e.views.forEach(function(e,o){var s=r.viewConfigs[o];if(!i.getFrameworkObjectById(s.viewId)){s=i.translateConfiguration(n,s),a&&s.requireMarkup&&(s.markupResource=s.requireMarkup);var l=null;if(s.viewModelId)if(l=i._viewModelEntries[s.viewModelId])l.libraryId=l.libraryId||n;else{var u=i._allViewModels.filter(function(e){return e.viewModelId===s.viewModelId})[0];if(!u)return void t(new Error("Could not attach view model '"+s.viewModelId+"' to view '"+s.viewId+"' - view model entry not found by ID."));l=i.instantiateFrameworkObject(u.typeName,u.libraryId),l.initialize(u.configuration),i._viewModelEntries[s.viewModelId]=l}else l=new g.ViewModelBase(i,n);if(s.viewModel=l,!e.viewMarkup)return void t(new Error("Missing markup for view '{0}'.".format(s.viewId)));p.resourceManager.register(n,"inv",s.markupResource,"html",e.viewMarkup);var c=null;return e.ViewClass&&(c=a?new e.ViewClass(i,s.libraryId||n):i.viewManager.createView(s)),a&&i.viewManager.createView(s,c),c?void i.registerFrameworkObject(c):void t(new Error("Could not instantiate view with type '{0}'.".format(s.typeName)))}}),e.initialized=!0,performance&&performance.mark&&performance.mark("mark_end_init_mod_"+r.moduleName),performance&&performance.measure&&performance.measure("measure_init_mod_"+r.moduleName,"mark_start_init_mod_"+r.moduleName,"mark_end_init_mod_"+r.moduleName)}},t.prototype._initializeTraditionalModules=function(e){for(var t=this,i=0;i<e.length;++i){var r=e[i];if(!this.moduleManager.moduleIsLoaded(r.moduleName)){var n=this.translateConfiguration(r.libraryId,r.configuration),o=this.moduleManager.instantiate(r.moduleType,r.libraryId);if(null!==o){if(o.initialize){this.trace.info("Initializing module '{0}'.".format(r.moduleName));try{o.id="module-{0}-{1}".format(r.libraryId,r.moduleName),o.initialize(n),this.registerFrameworkObject(o),function(e,i){t._initialStateAppliedCount++,t.getInitialState(i.moduleName,i.libraryId).then(function(t){if(t&&"function"==typeof e.applyState)return e.applyState(t)}).then(function(){return t._onInitialStateApplied(i.moduleName)},function(e){return t._onInitialStateApplied(i.moduleName,e)})}(o,r)}catch(a){this.trace.error("Error initializing module '{0}': {1}.".format(r.moduleName,a.message),a);continue}this.moduleManager.markModuleLoaded(r.moduleName,o),this.trace.debug("Module '{0}' initialized.".format(r.moduleName))}if(r.viewModelConfigs&&r.viewModelConfigs.length>0)for(var s=0;s<r.viewModelConfigs.length;++s){var l=r.viewModelConfigs[s];if(this._viewModelEntries[l.viewModelId])this.trace.debug("View model '{0}' is defined by module '{1}' but it already exists.".format(l.viewModelId,r.moduleName));else{var u=null;try{u=this.instantiateFrameworkObject(l.typeName,l.libraryId),u.id=l.viewModelId||v.alphaNumericToken();var n=this.translateConfiguration(r.libraryId,l.configuration);u.initialize(n),this._viewModelEntries[l.viewModelId]=u,this.registerFrameworkObject(u)}catch(a){this.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(l.typeName,a.message),a)}}}}else this.trace.error("Could not instantiate module with type '{0}' - type not found or constructor failed.".format(r.moduleType))}}for(var i=0;i<e.length;++i){var r=e[i];if(r.viewConfigs)for(var s=0;s<r.viewConfigs.length;++s){var c=r.viewConfigs[s];if(!this.getFrameworkObjectById(c.viewId)){c=this.translateConfiguration(r.libraryId,c);var d=null;c.viewModelId?(d=this._viewModelEntries[c.viewModelId],d?d.libraryId=d.libraryId||r.libraryId:this.trace.error("Could not attach view model '{0}' to view '{1}' - view model not found.".format(c.viewModelId,c.viewId))):d=new g.ViewModelBase(this,r.libraryId),c.viewModel=d;var h=this.viewManager.createView(c);h?this.registerFrameworkObject(h):this.trace.warning("Could not instantiate view with type '{0}'.".format(c.typeName))}}}},t.prototype.injectLibraryResources=function(e,t,i){return i=i.toLowerCase(),this._resourceDictionaries.hasOwnProperty(i)===!1?(this._resourceDictionaries[i]={},void(this._resourceDictionaries[i][e]=t)):void(this._resourceDictionaries[i].hasOwnProperty(e)===!1?this._resourceDictionaries[i][e]=t:dojo.mixin(this._resourceDictionaries[i][e],t))},t.prototype.instantiateFrameworkObject=function(e,t){for(var i=e.split("."),r=window,n=0;n<i.length&&"object"==typeof r;n++)r=r[i[n]];var o=null;if("function"==typeof r&&(o=new r(this,t)),!o)try{var a=dojo.getObject(e);o=new a(this,t)}catch(s){this.trace.error("Could not instantiate object of type '{0}': '{1}'".format(e,s),s)}return o},t.prototype.includeScript=function(e,t,i){var r=this,n={url:e,preventCache:this.debugMode,load:function(i){try{t&&t(i)}catch(n){r.trace.error("Error while including script '{0}': {1}".format(e,n),n)}},error:function(t){r.trace.error("Error while including script '{0}': {1}".format(e,t),t),r.pendingLibraryDownloads>0&&r.pendingLibraryDownloads--,r._doIfNoPendingLibraryDownloads(),i&&i(t)}};dojo.io.script.get(n)},t.prototype.processConfiguration=function(e){var t=this;if(this.configuration=e.application||{},this.configModel=e,this.eventRegistry.event("AppConfigLoaded").publish(this.configModel),this.eventRegistry.event("ApplicationConfigLoadedEvent").publish(this.configModel),this.configuration&&this.configuration.locale&&(this.locale=this.configuration.locale),this.urlParameters&&this.getUrlParameter("locale")&&(this.locale=this.getUrlParameter("locale")),dojo.locale=this.locale,this.pendingLocaleDownloads=e.externalLocaleReferences.length,this._establishRecords(),0==this.pendingLocaleDownloads)this._download();else for(var i=function(e,i){try{if(i)if(i.hasOwnProperty("locales")){for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];t.injectLibraryResources(e.libraryId,n,r)}}else{if(!e.hasOwnProperty("locale"))throw new Error("Locale reference missing 'locale' identifier.");t.injectLibraryResources(e.libraryId,i,e.locale)}else t.trace.warning("Error loading locale '{0}' for library '{1}' from offline storage.".format(e.locale,e.libraryId))}catch(o){t.trace.error("Error fetching external locale resource {0}: {1}".format(e.uri,o.message),o)}finally{--t.pendingLocaleDownloads,t.pendingLocaleDownloads<1&&t._download()}},r=function(e,i){t.trace.error("Error fetching external locale resource {0}: {1}".format(e.uri,i.message),i),--t.pendingLocaleDownloads,t.pendingLocaleDownloads<1&&t._download()},n=0;n<e.externalLocaleReferences.length;++n){var o=e.externalLocaleReferences[n];!function(e){var n={url:e.uri,handleAs:"json",load:function(t){return i(e,t)},error:function(t){return r(e,t)}};t.fetchConfigResource(n)}(o)}},t.prototype.addNativeReadyFunction=function(e){if("undefined"!=typeof gcxNativeReady)e&&e();else{var t=gcxNativeReadyCallback;gcxNativeReadyCallback=function(){t&&t(),e&&e()}}},t.prototype.getInitialState=function(e,t){return new m.SimplePromise(function(e,t){return e(null)})},t.prototype._onInitialStateApplied=function(e,t){
this._initialStateAppliedCount--,t&&this.trace.error('Error setting initial state for module "{0}": {1}'.format(e,t.message),t),this.allLibrariesLoaded&&this._initialStateAppliedCount<=0&&this.initialStateAppliedCallback&&this.initialStateAppliedCallback(this)},t.prototype.fetchConfigResource=function(e){var t=document.createElement("a");try{t.href=e.url,t.style.display="none",document.body.appendChild(t);var i=y._configDomains;if(!t.hostname||["protocol","hostname"].every(function(e){return t[e]===window.location[e]})||i&&1==i[t.protocol+"//"+t.hostname])return dojo.xhrGet(e);var r=new Error("Could not load viewer because the specified configuration file is not on the same domain as the viewer ({0}).".format(e.url));throw r.name="ConfigurationDomainMismatch",r}finally{document.body.removeChild(t)}},t.prototype._getDebugLocaleString=function(e){for(var t=[9728,9983],i=[],r=0;r<e.length;++r)i.push(Math.floor(Math.random()*(t[1]-t[0]))+t[0]);return String.fromCharCode.apply(String,i)},t}();t.Application=w})},"geocortex/framework/events/Event":function(){define(["require","exports","geocortex/framework/utils/utils","geocortex/framework/FrameworkObject"],function(e,t,i,r){"use strict";var n=function(){function e(e,t){this.handler=e,this.scope=t,this.once=!1}return e}(),o=function(){function e(e,t){this.app=null,this.isPublishing=!1,this.subscriptions={},this.name=e,this.app=t}return e.prototype.getSubscriptionHandlerByToken=function(e){return this.subscriptions.hasOwnProperty(e)?this.subscriptions[e].handler:null},e.prototype.subscribe=function(e,t){if(null===t||void 0===t)throw new Error("Event handler cannot be null or undefined");var o;do o=i.alphaNumericToken();while(this.getSubscriptionHandlerByToken[o]);var a=new n(t,e);return this.subscriptions[o]=a,e&&e instanceof r.FrameworkObject&&e.trackSubscription(this,o),o},e.prototype.once=function(e,t){var i=this.subscribe(e,t);return this.subscriptions[i].once=!0,i},e.prototype.unsubscribe=function(e){return!!this.subscriptions.hasOwnProperty(e)&&(delete this.subscriptions[e],!0)},e.prototype.clear=function(){this.subscriptions={}},e.prototype.publish=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.app&&this.app.debugMode){var i="Event '{0}' published.".format(this.name);console.debug?console.debug(i):console.log(i)}this.isPublishing=!0;for(var r in this.subscriptions)if(this.subscriptions.hasOwnProperty(r)){var n=this.subscriptions[r];n.handler.apply(n.scope,arguments),n.once&&delete this.subscriptions[r]}this.isPublishing=!1},e}();t.Event=o})},"geocortex/framework/commands/TypedCommand":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/commands":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/behaviors/Behaviors":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/ui/BindingExpressionFactory":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e}();t.BindingExpressionFactory=i})},"geocortex/framework/ui/BindingEngine":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(){}return e.prototype.bind=function(e,t,i){},e.prototype.unbind=function(e){},e}();t.DefaultBindingEngine=i})},"geocortex/framework/ui/BindingExpressionHandler":function(){define(["require","exports"],function(e,t){"use strict"})},"geocortex/framework/ui/DivRegionAdapter":function(){define(["require","exports","geocortex/framework/ui/RegionAdapterBase","geocortex/framework/resourceManager","geocortex/framework/utils/ArrayUtils"],function(e,t,i,r,n){"use strict";var o=function(e){function t(t,i){return e.call(this,t,i)||this}return __extends(t,e),t.prototype.unhostAllViews=function(){for(var e=0;e<this.views.length;++e){var t=this.views[e];this.unhostView(t)}this.views.length=0},t.prototype.hostView=function(t){if(this.unhostAllViews(),this.views.push(t),null==t.root){var i=r.resourceManager.fetch(t.markupResource,t.libraryId);if(null===i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;t.root=dojo.create("div",{className:"view {0}".format(t.id)}),t.root.innerHTML=i,dojo.place(t.root,this.domElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t)}else dojo.place(t.root,this.domElement,"only");return e.prototype.hostView.call(this,t),!0},t.prototype.unhostView=function(t){this.deactivateView(t),n.removeItem(this.views,t);var i=new dojo.NodeList;i.push(t.root),i.orphan(),e.prototype.unhostView.call(this,t)},t}(i.RegionAdapterBase);t.DivRegionAdapter=o})},"geocortex/framework/ui/DivStackRegionAdapter":function(){define(["require","exports","geocortex/framework/ui/RegionAdapterBase","geocortex/framework/utils/ArrayUtils","geocortex/framework/resourceManager"],function(e,t,i,r,n){"use strict";var o=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.activeViews=[],r.activateViewsInLastPosition=!0,r}return __extends(t,e),t.prototype.host=function(t,i){e.prototype.host.call(this,t,i),"false"===this.options.activateViewsInLastPosition&&(this.activateViewsInLastPosition=!1)},t.prototype.activateView=function(t){r.contains(this.activeViews,t)?(r.removeItem(this.activeViews,t),this.activeViews.push(t)):this.activeViews.push(t),this.activateViewsInLastPosition&&dojo.place(t.root,this.domElement,"last"),e.prototype.activateView.call(this,t)},t.prototype.deactivateView=function(t){t.isActive=!1,r.removeItem(this.activeViews,t),this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1]),e.prototype.deactivateView.call(this,t)},t.prototype.hostView=function(t){if(this.views.push(t),null==t.root){var i=n.resourceManager.fetch(t.markupResource,t.libraryId);if(null==i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;var r=this.getHostedTagName();t.root=dojo.create(r,{className:"view {0}".format(t.id)}),t.root.innerHTML=i,dojo.place(t.root,this.domElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t)}else dojo.place(t.root,this.domElement,"last");return e.prototype.hostView.call(this,t),!0},t.prototype.unhostView=function(t){this.deactivateView(t),r.removeItem(this.views,t),r.removeItem(this.activeViews,t);var i=new dojo.NodeList;i.push(t.root),i.orphan(),e.prototype.unhostView.call(this,t)},t.prototype.getHostedTagName=function(){return this.options&&this.options.tagName?this.options.tagName:"div"},t}(i.RegionAdapterBase);t.DivStackRegionAdapter=o})},"geocortex/framework/ui/MultiViewRegionAdapter":function(){define(["require","exports","geocortex/framework/ui/RegionAdapterBase","geocortex/framework/resourceManager","geocortex/framework/utils/ArrayUtils"],function(e,t,i,r,n){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activateView=function(t){if(this.hideAllViews(),this.activeViews.length>0){var i=this.activeViews[this.activeViews.length-1];i!==t&&(this.cancelActivate(i),i.deactivated())}e.prototype.activateView.call(this,t)},t.prototype.deactivateView=function(t,i){void 0!==i&&null!==i||(i=!0),e.prototype.deactivateView.call(this,t),i&&this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1])},t.prototype.hideAllViews=function(){dojo.query("> .view",this.domElement).removeClass("active"),dojo.query("> .view",this.domElement).addClass("inactive")},t.prototype.hostView=function(t){if(this.views.push(t),null==t.root){var i=r.resourceManager.fetch(t.markupResource,t.libraryId);if(null==i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;var n=this.getHostedTagName();t.root=dojo.create(n,{className:"view {0}".format(t.id)}),t.root.innerHTML=i,dojo.place(t.root,this.domElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t)}else dojo.place(t.root,this.domElement,"last");return e.prototype.hostView.call(this,t),!0},t.prototype.getHostedTagName=function(){return this.options&&this.options.tagName?this.options.tagName:"div"},t.prototype.unhostView=function(t){this.deactivateView(t),n.removeItem(this.views,t),n.removeItem(this.activeViews,t);var i=new dojo.NodeList;i.push(t.root),i.orphan(),e.prototype.unhostView.call(this,t)},t}(i.RegionAdapterBase);t.MultiViewRegionAdapter=o})},"geocortex/framework/ui/MultiDivRegionAdapter":function(){define(["require","exports","geocortex/framework/ui/MultiViewRegionAdapter"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getHostedTagName=function(){return"div"},t}(i.MultiViewRegionAdapter);t.MultiDivRegionAdapter=r})},"geocortex/framework/utils/DateFormatters":function(){define(["require","exports"],function(e,t){"use strict";t.DateFormatters={d:function(e){return e.getDate()+""},dd:function(e){return i(e.getDate(),2)},f:function(e){return r(e.getMilliseconds()/1e3,1,!1)},ff:function(e){return r(e.getMilliseconds()/1e3,2,!1)},fff:function(e){return r(e.getMilliseconds()/1e3,3,!1)},ffff:function(e){return r(e.getMilliseconds()/1e3,4,!1)},fffff:function(e){return r(e.getMilliseconds()/1e3,5,!1)},ffffff:function(e){return r(e.getMilliseconds()/1e3,6,!1)},fffffff:function(e){return r(e.getMilliseconds()/1e3,7,!1)},F:function(e){return r(e.getMilliseconds()/1e3,1,!0)},FF:function(e){return r(e.getMilliseconds()/1e3,2,!0)},FFF:function(e){return r(e.getMilliseconds()/1e3,3,!0)},FFFF:function(e){return r(e.getMilliseconds()/1e3,4,!0)},FFFFF:function(e){return r(e.getMilliseconds()/1e3,5,!0)},FFFFFF:function(e){return r(e.getMilliseconds()/1e3,6,!0)},FFFFFFF:function(e){return r(e.getMilliseconds()/1e3,7,!0)},h:function(e){var t=e.getHours();return t>12&&(t-=12),i(t,1)},hh:function(e){var t=e.getHours();return t>12&&(t-=12),i(t,2)},H:function(e){return i(e.getHours(),1)},HH:function(e){return i(e.getHours(),2)},m:function(e){return i(e.getMinutes(),1)},mm:function(e){return i(e.getMinutes(),2)},M:function(e){return i(e.getMonth()+1,1)},MM:function(e){return i(e.getMonth()+1,2)},s:function(e){return i(e.getSeconds(),1)},ss:function(e){return i(e.getSeconds(),2)},y:function(e){return i(e.getFullYear(),1)},yy:function(e){return i(e.getFullYear(),2)},yyy:function(e){return i(e.getFullYear(),3)},yyyy:function(e){return i(e.getFullYear(),4)},yyyyy:function(e){return i(e.getFullYear(),5)}};var i=function(e,t){e+="";for(var i=t-e.length,r=[];r.length<i;)r.push("0");var n=r.join("")+e;return n},r=function(e,t,r){var o=Math.floor(e*Math.pow(10,t)),a=i(o,t),s=r?n(a):a;return s},n=function(e){return e+="",e.replace(/0*$/g,"")}})},"geocortex/framework/utils/DateUtils":function(){define(["require","exports"],function(e,t){"use strict";function i(e){return o.test(e)}function r(){return null===a&&(a=(new Date).getTimezoneOffset()),a}function n(){if(null==s){var e=r(),t=Math.floor(e/60),i=Math.floor(e-60*t);if(0==t&&0==i)return"Z";t<0?(t*=-1,s="+"):s="-",s+=0==t?"00":t<10?"0"+t:t,s+=0==i?":00":i<10?":0"+i:":"+i}return s}var o=/(Z|([+-][012]\d(:?\d\d)?))\s*$/;t.containsTimezone=i;var a=null,s=null;t.getTimezoneOffset=r,t.getTimezoneString=n,function(){var e=new Date("2011-06-02T09:34:29+02:00");e&&1307000069e3===+e?Date.fromISO=function(e){return new Date(e)}:Date.fromISO=function(e){var t,i,r=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/,n=r.exec(e)||[];if(n[1]){t=n[1].split(/\D/);for(var o=0,a=t.length;o<a;o++)t[o]=parseInt(t[o],10)||0;return t[1]-=1,t=new Date(Date.UTC.apply(Date,t)),t.getDate()?(n[5]&&(i=60*parseInt(n[5],10),n[6]&&(i+=parseInt(n[6],10)),"+"==n[4]&&(i*=-1),i&&t.setUTCMinutes(t.getUTCMinutes()+i)),t):NaN}return NaN}}(),Date.prototype.toISOString||!function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}()})},"geocortex/framework/utils/String":function(){define(["require","exports","geocortex/framework/utils/DateFormatters"],function(e,t,i){"use strict";if(!String.prototype.format){var r="d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|:|\\/",n="("+r+"|[^"+r+"])",o=new RegExp(n,"g"),a="\0MAGIC\0";String.prototype.format=function(){var e=arguments,t=this.replace(/{{/g,a);return t=t.replace(/{(\d+)(?::([^}]*))?}/g,function(t,r,n){var a=e[r];if(!(n&&a instanceof Date))return a;for(var s=a,l=n.match(o),u=[],c=0;c<l.length;c++){var d=l[c],h=i.DateFormatters[d];if(h){var p=h.call(this,s);u.push(p)}else u.push(d)}var f=u.join("");return f}),t.replace(new RegExp(a,"g"),"{").replace(/}}/g,"}")}}String.format=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return e.format.apply(e,t)},String.quickHashCode=function(e){var t,i,r=0;if(0==e.length)return r;for(t=0;t<e.length;t++)i=e.charCodeAt(t),r=(r<<5)-r+i,r&=r;return r},String.escapeHtml=function(e){return null===e||void 0===e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},String.unescapeHtml=function(e){return null===e||void 0===e?e:e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")},String.escapeHtmlEncode=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},String.isNullOrEmpty=function(e){return"undefined"==typeof e||null===e||0===e.length},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t},String.prototype.endsWith=function(e,t){t=t||this.length,t-=e.length;var i=this.lastIndexOf(e);return i!==-1&&i===t}})},"geocortex/framework/utils/TimeDelayedOperation":function(){define(["require","exports"],function(e,t){"use strict";var i=function(){function e(e,t,i){this.delayMS=0,this.func=null,this.delayMS=e,i?this.func=function(){t.apply(i)}:this.func=t}return e.prototype.start=function(){this._timerHandle=setTimeout(this.func,this.delayMS)},e.prototype.stop=function(){clearTimeout(this._timerHandle)},e.prototype.reset=function(){this.stop(),this.start()},e}();t.TimeDelayedAction=i})}}});