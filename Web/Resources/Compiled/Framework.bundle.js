require({cache:{"geocortex/framework/application/Application":function(){define(["require","exports","./../config/ConfigurationModel","./../observables","./../utils/Trace","./ModuleManager","./../commands/CommandRegistry","./../events/EventRegistry","./../behaviors/BehaviorRegistry","./../storage/Store","./../ui/ViewManager","./ApplicationCommands","./../index","./../resourceManager","./../config/ConfigurationLoader","./../ui/ViewModelBase","./../utils/utils","./../SimplePromise","../utils/HttpsUtils","../utils/ArrayUtils","./DeferredLoadTriggers"],function(e,i,t,r,o,n,a,s,l,u,d,c,f,h,g,m,p,v,y,b,w){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var M=function(){function i(i,h,g,m,p){void 0===p&&(p=!1);var v=this;this.version="2.11",this.allowCrossDomainConfig=!1,this.configuration={},this.localServerAddress="",this.localServerToken=null,this.localServerNamespace=null,this.urlParameters={},this.developmentMode=!1,this.isHttpsMode=!1,this.isShuttingDown=!1,this.allLibrariesLoaded=!1,this.configPreprocessor=null,this.modalRegionSingleton=null,this._resourceDictionaries={},this._hasShell=!1,this._shellStabilized=!1,this._debug={},this._internalDebugEnabled=!1,this._moduleRecords=[],this._viewModelEntries={},this._frameworkObjects={},this._pendingFrameworkObjectRequests={},this._initialStateAppliedCount=0,this._stashLog=!0,this._stashedLogs=[],this._moduleLoadPromise=Promise.resolve(),this._getLibraryCacheName=function(e){var i=v._getLibraryConfig(e.libraryId);return i&&i.async&&i.bundleUri?v.performTokenReplacement(i.bundleUri):"dojo/ready"},this._getModuleCacheName=function(e){var i=v._getLibraryConfig(e.libraryId);return i&&i.async&&(i.loadModulesBundle||e.overrideLoadBundle)?v._getAsyncModuleRoot(e):"dojo/ready"},this.debugMode=p;var b=geocortex.framework.debug;b&&b.DebugObservables&&b.DebugMeta&&b.DebugTimers&&b.DebugTrace&&(this._internalDebugEnabled=!0,this._debug.obs=b.DebugObservables,this._debug.meta=b.DebugMeta,this._debug.timers=b.DebugTimers,this._debug.trace=b.DebugTrace),this.debugModeActive("time")&&this._debug.timers.startTimingViewer(),this.debugModeActive("binding")&&this._debug.obs.patchObservables(this),this.id=g||"default",this.configTokens=m||{},this.trace=new o.Trace(this),this.commandRegistry=new a.CommandRegistry(this),this.eventRegistry=new s.EventRegistry(this),this.behaviorRegistry=new l.BehaviorRegistry(this),this.command=dojo.hitch(this.commandRegistry,this.commandRegistry.command),this.event=dojo.hitch(this.eventRegistry,this.eventRegistry.event),this.behavior=dojo.hitch(this.behaviorRegistry,this.behaviorRegistry.behavior),this._traceEventListenerHandle=this.eventRegistry.event("TraceEvent").subscribe(this,this._traceEventListener),this.moduleManager=new n.ModuleManager(this),this.viewManager=new d.ViewManager(this),this._hostElement=h||dojo.body(),this.store=new u.Store(this,this.id),this.store.initialize(),null==i?this.configModel=new t.ConfigurationModel(this):"object"==typeof i?(this._configObject=i,this.configUri=null):(this.configModel=null,this.configUri=i.trim()),this.isOffline=new r.Observable(!1),this.isOffline.bind(this,function(e){e?this.eventRegistry.event("ApplicationOfflineEvent").publish():this.eventRegistry.event("ApplicationOnlineEvent").publish()}),this.isNative=new r.Observable(!1),this.isNative.bind(this,function(e){e?this.eventRegistry.event("ApplicationNativeReadyEvent").publish():this.eventRegistry.event("ApplicationNativeRemovedEvent").publish()}),c.ApplicationCommands.createCommands(this);var w=document.URL,M=w.substring(w.indexOf("?")+1,w.length);this.urlParameters=dojo.queryToObject(M)||{},this.host=y.getHost(),this.isHttpsMode=y.isHttpsUri(this.host),this._detectBrowserLocale(),this._requireErrorHandlerHandle=e.on("error",function(e){v._handleRequireError(e)}),f.registerApplication(this)}return i.prototype._handleRequireError=function(e){this._disableModuleOnRequireError(e)||this.trace.error("[require error]: "+e.src+"."+e.message+": ["+e.info[0]+"]",e)},i.prototype.getLibraryOrder=function(e){if(!this.configModel.libraryConfigs)return null;for(var i=0;i<this.configModel.libraryConfigs.length;++i)if(this.configModel.libraryConfigs[i].id===e)return i;return null},i.prototype.shouldOmitStylesForLibrary=function(e){if(!this.configModel.libraryConfigs)return null;for(var i=0,t=this.configModel.libraryConfigs;i<t.length;i++){var r=t[i];if(r.id===e)return!!r.omitStyles}return!1},i.prototype.translateConfiguration=function(e,i){var t=this,r=function(i,o,n){if("string"==typeof o){if(o.indexOf("@language")>-1){var a=o.split("-");if(a.length<2)throw new Error("Invalid language key '{0}'.".format(o));var s=a.join("-").replace("@",""),l=n||e;return t.getResource(l,s)}return t.performTokenReplacement(o)}if(o instanceof Array){for(var u=[],d=0;d<o.length;++d)u.push(r(d,o[d]));return u}if(o instanceof Function)return o;if(o instanceof Object){var c={},f=o.hasOwnProperty("libraryId")?o.libraryId:void 0;for(var h in o)o.hasOwnProperty(h)&&(c[h]=r(h,o[h],f));return c}return o},o={};for(var n in i)i.hasOwnProperty(n)&&(o[n]=r(n,i[n]));return o},i.prototype.performTokenReplacement=function(e){var i=this;return e?e.replace(/{.+?}/g,function(e){var t=e.substring(1,e.length-1),r=i.configTokens.hasOwnProperty(t)?i.configTokens[t]:e;return!r&&i.configuration&&i.configuration.hasOwnProperty(t)?i.configuration[t]:r||(i.trace.warning("The token syntax \\{{0}\\} was detected, but could not be matched to a valid replacement.".format(t)),"")}):e},i.prototype.isHttpsUri=function(e){return y.isHttpsUri(e)},i.prototype.makeAbsolute=function(e,i){if(new dojo._Url(e).host)return e;var t=i||"{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if("/"!==t.charAt(t.length-1)||"\\"!==t.charAt(t.length-1)){var r=t.split("/");--r.length,t=r.join("/"),t+="/"}if("/"===e.charAt(0)||"\\"===e.charAt(0)){var o=new dojo._Url(t);e=o.scheme+"://"+o.authority+"/"+e.substring(1)}else{for(var n=t.split("/"),a=e?e.split("../"):[],s=0,l=0,u=a;l<u.length;l++)""===u[l]&&++s;var d=n.slice(0,n.length-(s>0?s+1:s)),c=a.slice(s>0?s-1:s);e=d.join("/")+c.join("/")}return e},i.prototype.getHostElement=function(){return this._hostElement},i.prototype.getResource=function(e,i,t){t=(t=t||this.locale||"inv").toLowerCase();var r=this._resourceDictionaries[t],o=this._resourceDictionaries.inv||{};r||(r=o);var n=r[e]||o[e];if(!n)return this.trace.warning("No resource dictionary found for library '{0}' while trying to get resource with key '{1}', using locale '{2}'.".format(e,i,t)),"@"+i;var a=null;if(n.hasOwnProperty(i))a=n[i];else{if(r===o)return"@"+i;if(!(n=o[e])||!1===n.hasOwnProperty(i))return this.trace.warning("The resource with key '{0}' was not found in library '{1}'.".format(i,e)),"@"+i;a=n[i]}return"debug"===t?this._getDebugLocaleString(a):"strings"===t?i:"!!"===t?"!"+a+"!":a},i.prototype.getUri=function(e){if(e.indexOf("://")<0){var i=this.host+e;return this.isHttpsUri(i)!==this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(i)),p.isNullOrUndefined(this.proxyUri)||String.isNullOrEmpty(this.proxyUri)?i:this.proxyUri+encodeURIComponent(i)}return this.isHttpsUri(e)!==this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(e)),this.proxyUri+encodeURIComponent(e)},i.prototype.getUrlParameter=function(e){if(this.urlParameters)for(var i in this.urlParameters)if(this.urlParameters.hasOwnProperty(i)&&!String.isNullOrEmpty(i)&&!String.isNullOrEmpty(e)&&i.toLowerCase()===e.toLowerCase())return this.urlParameters[i];return null},i.prototype.onLibrariesDownloaded=function(e){},i.prototype.onConfigurationLoaded=function(e){},i.prototype.notifyLibraryDownload=function(e){var i=this;this.trace.info("Processing downloaded library '{0}' for application '{1}'.".format(e,this.id)),this.eventRegistry.event("LibraryDownloadedEvent").publish(e);var t=h.resourceManager.fetchAllFor(e,"json");if(t&&t.length>0)for(var r=0,o=t;r<o.length;r++){var n=o[r],a=h.resourceManager.fetch(n.name,n.library,n.locale);this.injectLibraryResources(e,a,n.locale)}this.configModel&&(this.shouldOmitStylesForLibrary(e)||this._addStyles(e),this.waitUntilShellStabilized().then(function(){return i._initializeLibrary(e)}),this._pendingLibraryDownloads>0&&--this._pendingLibraryDownloads,this._doIfNoPendingLibraryDownloads())},i.prototype.hasLibrary=function(e){return f.hasLibrary(e)&&!!this.configModel.libraryModules[e]&&this._resourceDictionaries.inv&&!!this._resourceDictionaries.inv[e]},i.prototype.registerFrameworkObject=function(e){if(!e.id)throw new Error("Could not register framework object. Object was missing an ID.");this._frameworkObjects[e.id]=e;var i=this._pendingFrameworkObjectRequests[e.id];return i&&i.length&&(i.forEach(function(i){return i(e)}),i.length=0,delete this._pendingFrameworkObjectRequests[e.id]),e},i.prototype.freeAllFrameworkObjects=function(){},i.prototype.getFrameworkObjectById=function(e){for(var i in this._frameworkObjects)if(this._frameworkObjects.hasOwnProperty(i)&&i===e)return this._frameworkObjects[i];return null},i.prototype.getFrameworkObjectByIdAsync=function(e,i,t){if(e&&dojo.isString(e)&&i&&dojo.isFunction(i)){var r=this.getFrameworkObjectById(e);r?i(r):(this._pendingFrameworkObjectRequests[e]=this._pendingFrameworkObjectRequests[e]||[],this._pendingFrameworkObjectRequests[e].push(i))}else t&&dojo.isFunction(t)&&t(new Error("Cannot retrieve Framework Object. Object ID or callback unspecified or incorrect."))},i.prototype.initialize=function(){var e=this;dojo.connect(window,"onresize",function(i){e.eventRegistry.event("ApplicationResizedEvent").publish()}),dojo.subscribe("ServiceTokenRefreshed",function(i){e.configuration&&i.serviceUrl===e.configuration.geometryServiceUrl&&(e.configuration.geometryServiceToken=i.token)});var i=new g.ConfigurationLoader(this),r=function(i){"string"==typeof i&&(i=JSON.parse(i)),e.configPreprocessor&&(e.configPreprocessor(i),e.configPreprocessor=null);var r=new t.ConfigurationModel(e);e.onConfigurationLoaded(i),e.abortInitialization||r.parse(i,function(i){return e.processConfiguration(i)})};if(null!=this.configModel)throw new Error("Configuration model should not be loaded already");if(null!=this._configObject)r(this._configObject),this._configObject=null;else{if(null==this.configUri)throw new Error("No configuration method");i.loadConfigurationTree(this.configUri,function(e){return r(e)})}this.viewManager.discoverRegions(this._hostElement)},i.prototype.shutdown=function(e){this.eventRegistry.event("ApplicationShutdownEvent").publish(e),this.isShuttingDown=!0,this.viewManager.shutdown(),this.moduleManager.shutdown(e),this.commandRegistry.clear(),this.eventRegistry.clear(),this._requireErrorHandlerHandle&&this._requireErrorHandlerHandle.remove()},i.prototype._doIfNoPendingLibraryDownloads=function(){0===this._pendingLibraryDownloads&&(h.resourceManager&&h.resourceManager.performThemeInjection(),this.allLibrariesLoaded=!0,this.eventRegistry.event("ViewerLibrariesDownloadedEvent").publish(this),this.onLibrariesDownloaded(this),this._initialStateAppliedCount<=0&&this.initialStateAppliedCallback&&this.initialStateAppliedCallback(this))},i.prototype.onInitializationComplete=function(){p.isNullOrUndefined(this.initializationCompleteCallback)||this.initializationCompleteCallback(this)},i.prototype._detectBrowserLocale=function(){navigator.language?this.locale=navigator.language:navigator.userLanguage?this.locale=navigator.userLanguage:navigator.browserLanguage?this.locale=navigator.browserLanguage:this.locale="inv"},i.prototype._getLibraryConfig=function(e){return this.configModel.libraryConfigs.filter(function(i){return i.id===e})[0]},i.prototype._getAsyncModuleRoot=function(e){var i=this._getLibraryConfig(e.libraryId);return i.location&&"Mapping"!==i.id?this.performTokenReplacement(i.location+"/"+e.moduleName+".js"):e.libraryId+"/modules/"+e.moduleName},i.prototype._establishRecords=function(){this._moduleRecords=this.configModel.moduleConfigs.map(function(e,i){return{index:i,moduleConfig:e,loaded:!1,initialized:!1,deferred:!1,tasks:function(e){var i=0;i++,i+=e.viewConfigs.length;for(var t=0,r=e.viewConfigs;t<r.length;t++)r[t].requireMarkup&&i++;return i+=e.viewModelConfigs.length}(e),tasksDone:0,MainClass:null,views:e.viewConfigs.map(function(e){return{ViewClass:null,viewMarkup:null}}),viewModels:e.viewModelConfigs.map(function(e){return{ViewModelClass:null}})}})},i.prototype._download=function(){this._pendingLibraryDownloads=this.configModel.libraryConfigs.length,this._allViewModels=this.configModel.moduleConfigs.map(function(e){return e.viewModelConfigs}).reduce(function(e,i){return e.concat(i)}),this._loadTraditionalLibraries(),this._cacheAsyncLibrariesAndRegisterPath(),this._cacheAsyncModules(),this._loadAsyncLibraries()},i.prototype._loadTraditionalLibraries=function(){for(var e=0,i=this.configModel.libraryConfigs.filter(function(e){return!e.async});e<i.length;e++){var t=i[e];f.hasLibrary(t.id)?this.notifyLibraryDownload(t.id):(f.libraries[t.id]=!1,t.uri?this.includeScript(t.uri,function(e){},function(){}):this.notifyLibraryDownload(t.id))}},i.prototype._cacheAsyncLibrariesAndRegisterPath=function(){var i=this;this.configModel.libraryConfigs.filter(function(e){return e.async&&e.packageName&&e.location}).forEach(function(t){var r=i.performTokenReplacement(t.location),o={};o[t.packageName]=r,e({paths:o})}),this.configModel.libraryConfigs.filter(function(e){return e.async&&e.bundleUri}).forEach(function(t){var r=i.performTokenReplacement(t.bundleUri),o=i.getLibraryDependencyUris(t,i.configModel.libraryConfigs);o.length>0?e(o,function(){e([r])}):e([r])})},i.prototype.getLibraryDependencyUris=function(e,i){var t=this,r=[];return e&&e.libraryDependencies&&e.libraryDependencies.length>0&&i&&e.libraryDependencies.forEach(function(o){var n=i.filter(function(e){return e.id===o});n&&n.length>0?r.push(n[0].bundleUri):t.trace.error("Library '"+e.id+"' has dependency on library '"+o+"' that doesn't have a bundleUri specified or doesn't exist.")}),r},i.prototype._cacheAsyncModules=function(){var i=this;this.configModel.moduleConfigs.filter(function(e){var t=i._getLibraryConfig(e.libraryId);return t&&t.async&&(t.loadModulesBundle||e.overrideLoadBundle)&&!i._isDeferred(e)&&e.isEnabled}).forEach(function(t){i._getLibraryConfig(t.libraryId);var r=i._getAsyncModuleRoot(t);e([r],function(){})})},i.prototype._loadAsyncLibraries=function(){var e=this,i=this._moduleRecords.filter(function(i){var t=e._getLibraryConfig(i.moduleConfig.libraryId);return!!t&&t.async});if(i.length){var t=function(r){if(!(r>=i.length)){var o=i[r];if(o.moduleConfig.moduleDependencies.length>0){for(var n=!1,a=0,s=o.moduleConfig.moduleDependencies.reverse();a<s.length;a++)!function(t){var a=i.filter(function(e){return!e.loaded&&!e.deferred&&e.moduleConfig.moduleName===t})[0];if(a){n=!0;var s=i.indexOf(a);i.splice(r,0,i.splice(s,1)[0]),e.trace.debug("Delaying initialization of module '"+o.moduleConfig.moduleName+"' to load dependency '"+a.moduleConfig.moduleName+"'")}}(s[a]);if(n)return void t(r)}if(o&&!o.loaded)if(e._isDeferred(o.moduleConfig)||!1===o.moduleConfig.isEnabled){if(o.deferred=!0,o.moduleConfig.configuration&&!1===o.moduleConfig.isEnabled)return void t(++r);e.waitUntilShellStabilized().then(function(){if(!o.loaded&&(e.trace.debug("Deferring initialization of module '"+o.moduleConfig.moduleName+"'."),e._loadTriggers[o.moduleConfig.moduleName])){for(var i=0,t=e._loadTriggers[o.moduleConfig.moduleName].views;i<t.length;i++){var r=t[i];o.loadTriggers.hasView(r)||o.loadTriggers.views.push(r)}if(o.loadTriggers.commands=e._loadTriggers[o.moduleConfig.moduleName].commands,o.loadTriggers.commands)for(var n=0,a=o.loadTriggers.commands;n<a.length;n++){var s=a[n];e.command(s)}}}),t(++r)}else e._processModule(o).then(function(){return t(++r)});else t(++r)}},r=function(){e._loadTriggers={},e.configuration.deferredModuleLoading=!1,e.trace.warning("The file './Viewer/Resources/moduleDependencies.json' could not be found or loaded. Deferred module loading will not be available.")};this.configuration.deferredModuleLoading?this.fetchConfigResource({url:"./Resources/moduleDependencies.json",load:function(i){try{e._loadTriggers=JSON.parse(i)}catch(e){r()}finally{t(0)}},error:function(e){r(),t(0)}}):(this.configuration.deferredModuleLoading=!1,this._loadTriggers={},t(0))}},i.prototype._determineViewAndRegionDependencies=function(){for(var e=this,i=0,t=this.configModel.moduleConfigs.filter(function(e){return e.deferLoading});i<t.length;i++)!function(i){var t=b.firstOrDefault(e._moduleRecords.filter(function(e){return e.moduleConfig.moduleName===i.moduleName}));if(p.isNullOrUndefined(t))return"continue";t.loadTriggers=new w.DeferredLoadTriggers;for(var r=0,o=i.viewConfigs;r<o.length;r++){var n=o[r];t.loadTriggers.hasView(n.viewId)||t.loadTriggers.views.push(n.viewId),n.regionName&&n.isVisible&&!t.loadTriggers.hasRegion(n.regionName)&&t.loadTriggers.regions.push(n.regionName)}}(t[i])},i.prototype._checkForStartupWorkflows=function(){var e=this,i=b.firstOrDefault(this._moduleRecords.filter(function(e){return"Workflow"===e.moduleConfig.moduleName})),t=b.firstOrDefault(this._moduleRecords.filter(function(e){return"WorkflowHost"===e.moduleConfig.moduleName}));if(i&&i.moduleConfig){var r=this.getUrlParameter("run")||this.getUrlParameter("runWorkflow")||this.getUrlParameter("runWorkflowById");p.isNullOrUndefined(r)?i.moduleConfig.configuration&&i.moduleConfig.configuration.startupWorkflows&&i.moduleConfig.configuration.startupWorkflows.length&&(i.moduleConfig.deferLoading=!1):i.moduleConfig.deferLoading=!1}t&&t.moduleConfig&&!1!==t.moduleConfig.isEnabled&&t.moduleConfig.configuration&&t.moduleConfig.configuration.startup&&t.moduleConfig.configuration.startup.length&&(t.moduleConfig.deferLoading||(t.moduleConfig.deferLoading=!0),this.waitUntilShellStabilized().then(function(){setTimeout(function(){e._loadDeferred([t.moduleConfig.moduleName])})}))},i.prototype._loadDeferred=function(e){for(var i=this,t=new Promise(function(t,r){for(var o=0,n=0,a=e;n<a.length;n++)!function(r){var n=b.firstOrDefault(i._moduleRecords.filter(function(e){return e.moduleConfig.moduleName===r}));if(n){var a=i.event("ModuleInitializedEvent").subscribe(i,function(r){r===n.moduleConfig.moduleName&&(i.event("ModuleInitializedEvent").unsubscribe(a),i.event("ModuleInitializationFailedEvent").unsubscribe(s),i._addStyles(n.moduleConfig.libraryId,n.moduleConfig.moduleName),n.initialized=!0,++o===e.length&&setTimeout(function(){return t(e)}))}),s=i.event("ModuleInitializationFailedEvent").subscribe(i,function(r){r===n.moduleConfig.moduleName&&(i.event("ModuleInitializedEvent").unsubscribe(a),i.event("ModuleInitializationFailedEvent").unsubscribe(s),n.initialized=!0,++o===e.length&&t(e))});i._processModule(n)}else++o===e.length&&t(e)}(a[n])}),r=this,o=0,n=e;o<n.length;o++)!function(e){var i=b.firstOrDefault(r._moduleRecords.filter(function(i){return i.moduleConfig.moduleName===e}));i&&(i.loadPromise=t)}(n[o]);return t},i.prototype._processModule=function(i){var t=this;if(!this._moduleLoadPromise.isResolved())return this._moduleLoadPromise.then(function(){return t._processModule(i)});var r=function(e,i){i&&(i.message="Subcomponent failed for module '"+e.moduleConfig.moduleName+"': "+i.message,t.trace.error(i.message,i)),++e.tasksDone>=e.tasks&&(e.loaded=!0,o(),t._initializeModule(e))},o=function(){t.configModel.libraryConfigs.filter(function(e){return!!e.async}).forEach(function(e){t._moduleRecords.filter(function(i){return i.moduleConfig.libraryId===e.id}).every(function(e){return e.loaded||e.deferred})&&f.notifyLibraryDownload(e.id)})};return this._moduleLoadPromise=new Promise(function(o){var n=i.moduleConfig,a=n.libraryId+"/modules/"+n.moduleName+"/",s=""+a+n.moduleName+"Module";n.require||(n.require=s),i.tasks=1+2*n.viewConfigs.length+n.viewModelConfigs.length;var l=e.on("error",function(e){e.info&&e.info[0]&&e.info[0].indexOf(n.moduleName)>-1&&(t._disableModuleOnRequireError(e),l.remove(),o())});e([t._getLibraryCacheName(n),t._getModuleCacheName(n)],function(s,u){l.remove(),e([n.require],function(e){if(i.MainClass=e[n.moduleName+"Module"],!i.MainClass||"function"!=typeof i.MainClass){var t=Object.keys(e).filter(function(i){return"function"==typeof e[i]})[0];i.MainClass=e[t]}r(i)},function(e){return r(i,e)}),n.viewConfigs.forEach(function(o,s){var l=i.views[s];o.require||(o.require=a+o.viewId);var u=function(){e([o.require],function(e){if(l.ViewClass=e[o.viewId],!l.ViewClass){var t=Object.keys(e).filter(function(i){return"function"==typeof e[i]})[0];l.ViewClass=e[t]}r(i)},function(e){return r(i,e)}),o.requireMarkup||(o.requireMarkup=o.markupResource);var a=function(){o.requireMarkup&&e(["dojo/text!/"+o.requireMarkup],function(e){l.viewMarkup=e,r(i)},function(e){return r(i,e)})},s=e.cache["url:/"+o.requireMarkup],u=o.requireMarkup.startsWith("Mapping/modules/");if(!s&&u){var d=o.requireMarkup.split("/")[2];t.trace.debug("Requiring '"+n.moduleName+"' to load module '"+d+"', as it needs view markup '"+o.requireMarkup+"'"),e(["Mapping/modules/"+d],function(e){a()})}else a()},d=e.cache[o.require],c=o.require.startsWith("Mapping/modules/");if(!d&&c){var f=o.require.split("/")[2];t.trace.debug("Deferring loading of "+n.moduleName+" to load module "+f+" for view "+o.viewId),e(["Mapping/modules/"+f],function(e){u()})}else u()}),n.viewModelConfigs.forEach(function(t,o){var n=i.viewModels[o];t.require||(t.require=a+t.viewModelId),e([t.require],function(e){if(n.ViewModelClass=e[t.viewModelId],!n.ViewModelClass||"function"!=typeof n.ViewModelClass){var o=Object.keys(e).filter(function(i){return"function"==typeof e[i]})[0];n.ViewModelClass=e[o]}r(i)},function(e){return r(i,e)})}),o()})}),this._moduleLoadPromise},i.prototype._addStyles=function(e,i){for(var t,r=this,o=h.resourceManager.fetchAllFor(e,"css")||[],n=[],a=[],s=0,l=t=i?o.filter(function(e){return e.name&&e.name.indexOf(i)>-1}):o;s<l.length;s++){var u=l[s];u.name.split("/").pop().toLowerCase().indexOf("common.css")>-1?n.push(u):a.push(u)}n.sort(function(e,i){return e.name.localeCompare(i.name)}),a.sort(function(e,i){return e.name.localeCompare(i.name)});var d=[];if(n.concat(a).forEach(function(e){if(r.shellName){if(e.name.toLowerCase().indexOf("large.css")>-1&&"Desktop"!==r.shellName)return;if(e.name.toLowerCase().indexOf("medium.css")>-1&&"Tablet"!==r.shellName)return;if(e.name.toLowerCase().indexOf("small.css")>-1&&"Handheld"!==r.shellName)return}var i=h.resourceManager.fetch(e.name,e.library);i&&d.push(i)}),d.length>0){var c=document.createElement("style");c.setAttribute("type","text/css"),c.setAttribute("data-injected-stylesheet","");var f=document.createTextNode(d.join(" "));c.appendChild(f);var g=document.head.querySelectorAll("[data-injected-stylesheet]");if(g.length){var m=g.item(g.length-1);document.head.insertBefore(c,m.nextSibling)}else dojo.place(c,document.head,"first")}},i.prototype._initializeLibrary=function(e,i){var t=this;void 0===i&&(i=function(e){return t.trace.error(e.message,e)});var r=this._getLibraryConfig(e);if(!r||!r.async){var o=this.configModel.moduleConfigs.filter(function(i){return i.libraryId===e});this._initializeTraditionalModules(o)}this.initializationCompleteCallback&&(this.onInitializationComplete(),this.initializationCompleteCallback=null)},i.prototype._initializeModule=function(e,i){var t=this;void 0===i&&(i=function(i){t.trace.error(i.message,i),t.event("ModuleInitializationFailedEvent").publish(e.moduleConfig.moduleName)});var r=e.moduleConfig,o=r.libraryId,n=this._getLibraryConfig(o).async;if(!this.moduleManager.moduleIsLoaded(r.moduleName))if(e.MainClass){var a=n?new e.MainClass(this,o):this.moduleManager.instantiate(r.moduleType,r.libraryId);if(a){if(a.initialize){this.trace.info("Initializing module '{0}'.".format(r.moduleName)),this.debugModeActive("time")&&this._debug.timers.startTimingModule(r.moduleName);try{a.id="module-"+o+"-"+r.moduleName,a.initialize(this.translateConfiguration(o,r.configuration)),this.registerFrameworkObject(a),function(e,i){t._initialStateAppliedCount++,t.getInitialState(i.moduleName,o).then(function(i){if(i&&"function"==typeof e.applyState)return i.serialVersion||(i.serialVersion=1),e.applyState(i)}).then(function(){return t._onInitialStateApplied(i.moduleName)},function(e){return t._onInitialStateApplied(i.moduleName,e)})}(a,r)}catch(e){return e.message="Error initializing module '"+r.moduleName+"': "+e.message+".",void i(e)}this.moduleManager.markModuleLoaded(r.moduleName,a),this.trace.debug("Module '"+r.moduleName+"' initialized.")}e.viewModels.forEach(function(e,a){var s=r.viewModelConfigs[a];if(t._viewModelEntries[s.viewModelId])t.trace.debug("View model '{0}' is defined by module '{1}' but it already exists.".format(s.viewModelId,r.moduleName));else try{var l=n?new e.ViewModelClass(t,o):t.instantiateFrameworkObject(s.typeName,s.libraryId);l.id=s.viewModelId||p.alphaNumericToken(),l.initialize(t.translateConfiguration(o,s.configuration)),t._viewModelEntries[s.viewModelId]=l,t.registerFrameworkObject(l)}catch(e){e.message="Failed to initialize view model '"+s.viewModelId+"': "+e.message,i(e)}}),e.views.forEach(function(e,a){var s=r.viewConfigs[a];if(!t.getFrameworkObjectById(s.viewId)){s=t.translateConfiguration(o,s),n&&s.requireMarkup&&(s.markupResource=s.requireMarkup);var l=null;if(s.viewModelId)if(l=t._viewModelEntries[s.viewModelId])l.libraryId=l.libraryId||o;else{var u=t._allViewModels.filter(function(e){return e.viewModelId===s.viewModelId})[0];if(!u)return void i(new Error("Could not attach view model '"+s.viewModelId+"' to view '"+s.viewId+"' - view model entry not found by ID."));(l=t.instantiateFrameworkObject(u.typeName,u.libraryId)).initialize(u.configuration),t._viewModelEntries[s.viewModelId]=l}else l=new m.ViewModelBase(t,o);if(s.viewModel=l,e.viewMarkup){h.resourceManager.register(o,"inv",s.markupResource,"html",e.viewMarkup);var d=null;e.ViewClass&&(d=n?new e.ViewClass(t,s.libraryId||o):t.viewManager.createView(s)),n&&t.viewManager.createView(s,d),d?t.registerFrameworkObject(d):i(new Error("Could not instantiate view with type '{0}'.".format(s.typeName)))}else i(new Error("Missing markup for view '{0}'.".format(s.viewId)))}}),e.initialized=!0,this.debugModeActive("time")&&this._debug.timers.timeModule(this,r.moduleName)}else i(new Error("Failed module instantiation ("+r.moduleName+")"))}else this.trace.debug("# SKIP MODULE "+e.moduleConfig.moduleName)},i.prototype._initializeTraditionalModules=function(e){for(var i=this,t=this,r=0,o=e;r<o.length;r++)!function(e){if(t.moduleManager.moduleIsLoaded(e.moduleName))return"continue";var r=t.translateConfiguration(e.libraryId,e.configuration),o=t.moduleManager.instantiate(e.moduleType,e.libraryId);if(null===o)return t.trace.error("Could not instantiate module with type '{0}' - type not found or constructor failed.".format(e.moduleType)),"continue";if(o.initialize){t.trace.info("Initializing module '{0}'.".format(e.moduleName));try{o.id="module-{0}-{1}".format(e.libraryId,e.moduleName),o.initialize(r),t.registerFrameworkObject(o),function(t,r){i._initialStateAppliedCount++,i.getInitialState(r.moduleName,r.libraryId).then(function(e){if(e&&"function"==typeof t.applyState)return o.applyState(e)}).then(function(){return i._onInitialStateApplied(e.moduleName)},function(t){return i._onInitialStateApplied(e.moduleName,t)})}(o,e)}catch(i){return t.trace.error("Error initializing module '{0}': {1}.".format(e.moduleName,i.message),i),"continue"}t.moduleManager.markModuleLoaded(e.moduleName,o),t.trace.debug("Module '{0}' initialized.".format(e.moduleName))}if(e.viewModelConfigs&&e.viewModelConfigs.length>0)for(var n=0,a=e.viewModelConfigs;n<a.length;n++){var s=a[n];if(t._viewModelEntries[s.viewModelId])t.trace.debug("View model '{0}' is defined by module '{1}' but it already exists.".format(s.viewModelId,e.moduleName));else{var l=null;try{(l=t.instantiateFrameworkObject(s.typeName,s.libraryId)).id=s.viewModelId||p.alphaNumericToken();var u=t.translateConfiguration(e.libraryId,s.configuration);l.initialize(u),t._viewModelEntries[s.viewModelId]=l,t.registerFrameworkObject(l)}catch(e){t.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(s.typeName,e.message),e)}}}}(s=o[r]);for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.viewConfigs)for(var l=0,u=s.viewConfigs;l<u.length;l++){var d=u[l];if(!this.getFrameworkObjectById(d.viewId)){var c=this.translateConfiguration(s.libraryId,d),f=null;c.viewModelId?(f=this._viewModelEntries[c.viewModelId])?f.libraryId=f.libraryId||s.libraryId:this.trace.error("Could not attach view model '{0}' to view '{1}' - view model not found.".format(c.viewModelId,c.viewId)):f=new m.ViewModelBase(this,s.libraryId),c.viewModel=f;var h=this.viewManager.createView(c);h?this.registerFrameworkObject(h):this.trace.warning("Could not instantiate view with type '{0}'.".format(c.typeName))}}}},i.prototype.injectLibraryResources=function(e,i,t){return t=t.toLowerCase(),!1===this._resourceDictionaries.hasOwnProperty(t)?(this._resourceDictionaries[t]={},void(this._resourceDictionaries[t][e]=i)):void(!1===this._resourceDictionaries[t].hasOwnProperty(e)?this._resourceDictionaries[t][e]=i:dojo.mixin(this._resourceDictionaries[t][e],i))},i.prototype.instantiateFrameworkObject=function(e,i){for(var t=e.split("."),r=window,o=0;o<t.length&&"object"==typeof r;o++)r=r[t[o]];var n=null;if("function"==typeof r&&(n=new r(this,i)),!n)try{n=new(dojo.getObject(e))(this,i)}catch(i){this.trace.error("Could not instantiate object of type '{0}': '{1}'".format(e,i),i)}return n},i.prototype.includeScript=function(e,i,t){var r=this,o={url:e,preventCache:this.debugMode,load:function(t){try{i&&i(t)}catch(i){r.trace.error("Error while including script '{0}': {1}".format(e,i),i)}},error:function(i){r.trace.error("Error while including script '{0}': {1}".format(e,i),i),r._pendingLibraryDownloads>0&&r._pendingLibraryDownloads--,r._doIfNoPendingLibraryDownloads(),t&&t(i)}};dojo.io.script.get(o)},i.prototype.processConfiguration=function(e){var i=this;if(this.configuration=e.application||{},this.configModel=e,this.eventRegistry.event("AppConfigLoaded").publish(this.configModel),this.eventRegistry.event("ApplicationConfigLoadedEvent").publish(this.configModel),this.configuration&&this.configuration.locale&&(this.locale=this.configuration.locale),this.urlParameters&&this.getUrlParameter("locale")&&(this.locale=this.getUrlParameter("locale")),!1===this.configuration.deferredModuleLoading&&this.trace.info("Deferred module loading is disabled in configuration. All configured and enabled modules will be loaded during viewer initialization."),dojo.locale=this.locale,this._pendingLocaleDownloads=e.externalLocaleReferences.length,this._establishRecords(),this._determineViewAndRegionDependencies(),this._checkForStartupWorkflows(),0===this._pendingLocaleDownloads)this._download();else for(var t=function(e,t){try{if(t)if(t.hasOwnProperty("locales")){for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];i.injectLibraryResources(e.libraryId,o,r)}}else{if(!e.hasOwnProperty("locale"))throw new Error("Locale reference missing 'locale' identifier.");i.injectLibraryResources(e.libraryId,t,e.locale)}else i.trace.warning("Error loading locale '{0}' for library '{1}' from offline storage.".format(e.locale,e.libraryId))}catch(t){i.trace.error("Error fetching external locale resource {0}: {1}".format(e.uri,t.message),t)}finally{--i._pendingLocaleDownloads<1&&i._download()}},r=function(e,t){i.trace.error("Error fetching external locale resource {0}: {1}".format(e.uri,t.message),t),--i._pendingLocaleDownloads<1&&i._download()},o=0,n=e.externalLocaleReferences;o<n.length;o++)!function(e){var o={url:e.uri,handleAs:"json",load:function(i){return t(e,i)},error:function(i){return r(e,i)}};i.fetchConfigResource(o)}(n[o])},i.prototype.addNativeReadyFunction=function(e){if("undefined"!=typeof gcxNativeReady)e&&e();else{var i=gcxNativeReadyCallback;gcxNativeReadyCallback=function(){i&&i(),e&&e()}}},i.prototype.getInitialState=function(e,i){return new v.SimplePromise(function(e,i){return e(null)})},i.prototype._onInitialStateApplied=function(e,i){this._initialStateAppliedCount--,i&&this.trace.error('Error setting initial state for module "{0}": {1}'.format(e,i.message),i),this.allLibrariesLoaded&&this._initialStateAppliedCount<=0&&this.initialStateAppliedCallback&&this.initialStateAppliedCallback(this)},i.prototype.fetchConfigResource=function(e){var i=document.createElement("a");try{i.href=e.url,i.style.display="none",document.body.appendChild(i);var t=geocortex._configDomains;if(!i.hostname||["protocol","hostname"].every(function(e){return i[e]===window.location[e]})||t&&!0===t[i.protocol+"//"+i.hostname])return dojo.xhrGet(e);var r=new Error("Could not load viewer because the specified configuration file is not on the same domain as the viewer ({0}).".format(e.url));throw r.name="ConfigurationDomainMismatch",r}finally{document.body.removeChild(i)}},i.prototype._traceEventListener=function(e){this._stashLog?this._stashedLogs.push(e):this.eventRegistry.event("TraceEvent").unsubscribe(this._traceEventListenerHandle)},i.prototype._getDebugLocaleString=function(e){for(var i=[9728,9983],t=[],r=0;r<e.length;++r)t.push(Math.floor(Math.random()*(i[1]-i[0]))+i[0]);return String.fromCharCode.apply(String,t)},i.prototype._awaitModulesImpl=function(e){for(var i=this,t=[],r=[],o=0,n=e;o<n.length;o++){var a=n[o];a&&(a.loadPromise&&!a.loadPromise.isResolved()&&-1===t.indexOf(a.loadPromise)?t.push(a.loadPromise):r.push(a.moduleConfig.moduleName))}return r.length>0&&t.push(this._loadDeferred(r)),t.length>0?new Promise(function(e,r){Promise.all(t).then(function(i){return e(i)}).catch(function(t){i.trace.debug("Error loading deferred modules: "+t.message),e(null)})}):Promise.resolve(null)},i.prototype._isDeferred=function(e){return!1!==this.configuration.deferredModuleLoading&&("Native"!==e.moduleName&&"Offline"!==e.moduleName||!this.isNative.get())&&!!e.deferLoading},i.prototype._findUnloadedModulesForCommand=function(e){var i=this;return this._moduleRecords.filter(function(t){return i._canBeLoaded(t)&&t.loadTriggers.hasCommand(e)})},i.prototype._findUnloadedModuleForView=function(e){var i=this;return b.firstOrDefault(this._moduleRecords,function(t){return i._canBeLoaded(t)&&t.loadTriggers.hasView(e)})},i.prototype._findUnloadedModulesForRegion=function(e){var i=this;return this._moduleRecords.filter(function(t){return i._canBeLoaded(t)&&t.loadTriggers.hasRegion(e)})},i.prototype._canBeLoaded=function(e){return e.loadTriggers&&e.deferred&&(!e.loaded||e.loadPromise&&!e.loadPromise.isResolved())},i.prototype._disableModuleOnRequireError=function(e){if(e&&e.info&&e.info[0]){var i=e.info[0],t=/Resources\/Compiled\/([a-zA-Z]+)\.js/.exec(i),r=null;if(t&&t[1]&&(r=t[1]),!p.isNullOrUndefined(r)){var o=b.firstOrDefault(this._moduleRecords.filter(function(e){return e.moduleConfig.moduleName===r}));return o&&!o.loaded&&(this.trace.error("An error occurred when requiring the module '"+r+"'. This module will be unavailable"),this.event("ModuleInitializationFailedEvent").publish(r),o.loaded=!0),!0}return!1}},i.prototype.pendingModulesForCommand=function(e){return this._findUnloadedModulesForCommand(e).map(function(e){return e.moduleConfig.moduleName})},i.prototype.awaitModulesForCommand=function(e){return this._awaitModulesImpl(this._findUnloadedModulesForCommand(e))},i.prototype.awaitModuleForView=function(e){return this._awaitModulesImpl([this._findUnloadedModuleForView(e)])},i.prototype.loadModulesForRegion=function(e){this._awaitModulesImpl(this._findUnloadedModulesForRegion(e))},i.prototype.awaitModules=function(e){var i=this._moduleRecords.filter(function(i){return e.indexOf(i.moduleConfig.moduleName)>-1});return this._awaitModulesImpl(i)},i.prototype.hasDeferredModule=function(e){var i=b.firstOrDefault(this._moduleRecords.filter(function(i){return i.moduleConfig.moduleName===e}));return i&&!i.loaded&&i.deferred},i.prototype.debugModeActive=function(e){return("all"===this.debugMode||this.debugMode.toString().indexOf(e)>-1)&&(e.toString().indexOf("time")>-1?!!(this._internalDebugEnabled&&performance&&performance.mark&&performance.measure&&performance.getEntriesByName):!(e.toString().indexOf("binding")>-1&&!this._internalDebugEnabled))},i.prototype.getStashedLogs=function(){return this._stashLog=!1,this._stashedLogs},i.prototype.waitUntilAllLibrariesLoaded=function(){var e=this;return new Promise(function(i,t){e.allLibrariesLoaded?i():e.event("ViewerLibrariesDownloadedEvent").once(e,function(e){i()})}).catch(function(i){i.message&&e.trace.error(i.message)})},i.prototype.waitUntilShellStabilized=function(){var e=this;return new Promise(function(i,t){e._hasShell?e._shellStabilized?i():e.event("_shellStabilizedEvent").once(e,function(e){i()}):e.waitUntilAllLibrariesLoaded().then(function(){return i()})}).catch(function(i){i.message&&e.trace.error(i.message)})},i}();i.Application=M})},"geocortex/framework/application/ApplicationCommands":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t=function(){function e(){}return e.createCommands=function(e){},e}();i.ApplicationCommands=t})},"geocortex/framework/application/DeferredLoadTriggers":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t=function(){function e(e,i,t){this.views=e||[],this.commands=i||[],this.regions=t||[]}return e.prototype.hasView=function(e){return this.views&&this.views.indexOf(e)>-1},e.prototype.hasCommand=function(e){return this.commands&&this.commands.indexOf(e)>-1},e.prototype.hasRegion=function(e){return this.regions&&this.regions.indexOf(e)>-1},e}();i.DeferredLoadTriggers=t})},"geocortex/framework/application/ModuleBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])};return function(i,t){function r(){this.constructor=i}e(i,t),i.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define(["require","exports","./../FrameworkObject","./../SimplePromise"],function(i,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(i){function t(e,t){var r=i.call(this,e,t)||this;return r.behaviorNames=[],r.configuration={},r}return e(t,i),t.prototype.initialize=function(e){this.configuration=e,this.behaviorNames=this.app.behaviorRegistry.loadBehaviorsFromConfig(this,e)},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.app.trace.debug("module onDestroy: "+this.id);for(var e=this.behaviorNames.length-1;e>=0;e--)this.app.behaviorRegistry.remove(this.behaviorNames[e]);this.behaviorNames.length=0},t.prototype.shutdown=function(e){},t.prototype.exportState=function(){return new o.SimplePromise(function(e,i){return e(null)})},t.prototype.applyState=function(e){return new o.SimplePromise(function(e,i){return e()})},t.prototype.getStateFilter=function(){return null},t}(r.FrameworkObject);t.ModuleBase=n})},"geocortex/framework/application/ModuleManager":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var t=function(){function e(e){this._modules={},this.app=e}return e.prototype.shutdown=function(e){for(var i in this._modules)this._modules.hasOwnProperty(i)&&(this._modules[i].shutdown(e),this._modules[i].destroy());this._modules={}},e.prototype.instantiate=function(e,i){return null==e?null:this.app.instantiateFrameworkObject(e,i)},e.prototype.markModuleLoaded=function(e,i){this._modules[e]=i,this.app.event("ModuleInitializedEvent").publish(e)},e.prototype.moduleIsLoaded=function(e){return null!=this._modules[e]},e.prototype.notifyModuleLoaded=function(e,i){if(this.moduleIsLoaded(e)&&null!=i)i(e);else var t=this.app.event("ModuleInitializedEvent").subscribe(this,function(r){if(r==e)try{i(r)}finally{this.app.event("ModuleInitializedEvent").unsubscribe(t)}})},e}();i.ModuleManager=t})},"geocortex/framework/application/ResourceManager":function(){define(["require","exports","./../utils/utils"],function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function i(){this.resources=[],this.cachedResources={},this.themesToInject=[]}return i.prototype.fetch=function(i,r,o){var n=r+"-"+(o=o||"inv")+"-"+i;if(this.cachedResources.hasOwnProperty(n))return this.cachedResources[n];var a=e.cache,s=window.location.pathname;/\/$/.test(s)||(s+="/");var l="url:/"+i;if(null!=a[l])return a[l];var u=this.findResource(i,r,o);if(!u)return null;var d=null;switch(u.format){case"css":case"html":d="<"!==(u.data||"").trim().charAt(0)?t.base64Decode(u.data):u.data,this.cachedResources[n]=d;break;case"json":d=t.base64Decode(u.data),d=JSON.parse(d),this.cachedResources[n]=d;break;default:return null}return d},i.prototype.fetchAllFor=function(e,i){for(var t=[],r=0;r<this.resources.length;++r){var o=this.resources[r];if(o.library==e){if(null!=i&&o.format!=i)continue;t.push(o)}}return t},i.prototype.register=function(e,i,t,r,o){if(!this.findResource(t,e)){var n={};n.name=t,n.library=e,n.locale=i,n.format=r,n.data=o,this.resources.push(n)}},i.prototype.remove=function(e,i,t){var r=this.findResource(i,e,t);if(null!=r){Array.removeItem(this.resources,r);var o=e+"-"+t+"-"+i;return this.cachedResources.hasOwnProperty(o)&&delete this.cachedResources[o],!0}return!1},i.prototype.injectTheme=function(e){this.themesToInject.push(e)},i.prototype.performThemeInjection=function(){for(var e=dojo.query("head")[0],i=0;i<this.themesToInject.length;++i){var t=dojo.create("link",{rel:"stylesheet",href:this.themesToInject[i]});dojo.place(t,e,"last")}},i.prototype.findResource=function(e,i,t){t=t||"inv";for(var r=0;r<this.resources.length;++r){var o=this.resources[r];if(o.name==e){if(null!=i&&o.library!=i)continue;if(o.locale==t)return o}}return null},i}();i.ResourceManager=r})}}});require({cache:{"geocortex/framework/behaviors/Behavior":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,i,r){this.app=e,this.name=t,this.event=r,this.commands=i||[],this._wireUpEvent()}return e.prototype.run=function(e){this._executeCommands(e)},e.prototype._wireUpEvent=function(){var e=this;this.event&&(this.eventToken=this.app.event(this.event).subscribe(this,function(t){e._executeCommands(t)}))},e.prototype._executeCommands=function(e){for(var t=0;this.commands&&t<this.commands.length;t++)this.app.command(this.commands[t]).execute(e)},e.prototype.destroy=function(){this.event&&this.app.event(this.event).unsubscribe(this.eventToken),this.commands=null},e}();t.Behavior=i})},"geocortex/framework/behaviors/BehaviorRegistry":function(){define(["require","exports","./Behavior","./../application/ModuleBase"],function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.behaviors={},this.dummyBehavior=new i.Behavior(null,null,null),this.app=e}return e.prototype.loadBehaviorsFromConfig=function(e,t){var i=[];if(!(e instanceof r.ModuleBase))return this.app.trace.warning("Attempted to add behaviors to registry outside of ModuleBase. Behaviors from "+e.id+" not added."),i;if(t&&t.behaviors)for(var o=0;o<t.behaviors.length;o++){var n=t.behaviors[o];i.push(n.name),this.addBehavior(n.name,n.commands,n.event)}return i},e.prototype.addBehavior=function(e,t,r){if(t){this.behaviors[e]&&this.app.trace.warning("Behavior "+e+" is already present in registry."),e||this.app.trace.warning("Attempted to add a nameless Behavior to the registry.");var o=new i.Behavior(this.app,e,t,r);this.behaviors[e]=o}else this.app.trace.debug("Behavior "+e+" does not possess an array of command IDs. Not added to registry.")},e.prototype.remove=function(e){if(!this.behaviors[e])return this.app.trace.debug("Attempted to remove behavior not in found in registry."),!1;var t=this.behaviors[e];return delete this.behaviors[e],t.destroy(),!0},e.prototype.behavior=function(e){var t=null;return void 0!==this.behaviors[e]?t=this.behaviors[e]:(t=this.dummyBehavior,this.app.trace.debug("Could not find Behavior named "+e+" in the Behavior Registry.")),t},e}();t.BehaviorRegistry=o})},"geocortex/framework/behaviors/Behaviors":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/behaviors/TypedBehavior":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/framework/Behaviors":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/framework/commands":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/commands/Command":function(){define(["require","exports","./../events/Event","./../utils/utils","./../FrameworkObject"],function(e,t,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){this.impl=e,this.scope=t,this.canExecute=n},s=function(){function e(e,t,i){this._entries={},this.app=null,this.name=e,this.app=t,this.isWrapper=!0,this.canExecuteChanged=new n.Event("{0}.CanExecuteChanged".format(e)),this.preExecute=new n.Event("{0}.PreExecute".format(e)),this.postExecute=new n.Event("{0}.PostExecute".format(e)),this.canExecuteMode=null!==i&&void 0!==i?i:"all"}return e.prototype.raiseCanExecuteChanged=function(){this.canExecuteChanged.publish()},e.prototype.canExecute=function(e){var t=this;if(!this.app.isShuttingDown&&this.app.pendingModulesForCommand(this.name).length>0&&this.app.awaitModulesForCommand(this.name).then(function(e){e&&t.raiseCanExecuteChanged()}),this.isWrapper)return!1;for(var n in this._entries)if(this._entries.hasOwnProperty(n)){var i=this._entries[n];if(i.canExecute&&i.canExecute.apply(i.scope,arguments)){if("any"===this.canExecuteMode)return!0}else if("all"===this.canExecuteMode)return this._traceDebug("Command '"+this.name+"' failed an 'all' canExecute check"),!1}return"any"!==this.canExecuteMode||(this._traceDebug("Command '"+this.name+"' failed an 'any' canExecute check"),!1)},e.prototype.execute=function(e){var t=this,n=arguments;if(!this.app.isShuttingDown&&this.app.pendingModulesForCommand(this.name).length>0)this.app.awaitModulesForCommand(this.name).then(function(){return t.execute.apply(t,n)});else{var i=!1;if(this._entries)for(var a in this._entries)if(this._entries.hasOwnProperty(a)){i=!0;break}if(i){if("all"!==this.canExecuteMode||this.canExecute.apply(this,n)){this._traceDebug("Command "+this.name+" executed"),this.preExecute.publish.apply(this.preExecute,n);for(var a in this._entries)if(this._entries.hasOwnProperty(a)){var r=this._entries[a];("any"!==this.canExecuteMode||r.canExecute.apply(r.scope,n))&&r.impl.apply(r.scope,n)}this.postExecute.publish.apply(this.postExecute,n)}}else this._traceDebug("Command "+this.name+" executed but no implementation registered.")}},e.prototype.register=function(e,t,n){this.isWrapper=!1;var s=i.alphaNumericToken(),o=new r(t,e,n||this.defaultCanExecuteFunction);return this._entries[s]=o,e&&e instanceof a.FrameworkObject&&e.trackCommandHandler(this,s),this._traceDebug("Registered an implementation for command '"+this.name+"'."),this.raiseCanExecuteChanged(),s},e.prototype.defaultCanExecuteFunction=function(){return!0},e.prototype.unregister=function(e){return this.isWrapper=!1,!!this._entries.hasOwnProperty(e)&&(delete this._entries[e],this._traceDebug("Unregistered an implementation for command '"+this.name+"'."),this.raiseCanExecuteChanged(),!0)},e.prototype.clear=function(){this._entries={},this.app.isShuttingDown||this.raiseCanExecuteChanged(),this._traceDebug("Cleared all implementations of command '"+this.name+"'.")},e.prototype._traceDebug=function(e){this.app&&this.app.debugMode&&(this.app._internalDebugEnabled?this.app._debug.trace.traceCommand(this.app,e):this.app.trace.command(e))},e}();t.Command=s})},"geocortex/framework/commands/CommandRegistry":function(){define(["require","exports","./Command"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.commands={},this.app=e}return e.prototype.clear=function(){for(var e in this.commands)this.commands.hasOwnProperty(e)&&this.commands[e].clear()},e.prototype.command=function(e){var t=this.commands[e];if(!t){var i=new n.Command(e,this.app);return i.isWrapper=!0,this.commands[i.name]=i,i}return t},e}();t.CommandRegistry=i})},"geocortex/framework/commands/TypedCommand":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})}}});require({cache:{"geocortex/framework/commands":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/framework/config":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i._nonConfigs=[]})},"geocortex/framework/config/ConfigurationLoader":function(){define(["require","exports","./../config"],function(e,i,o){"use strict";function r(e){var i=[-1399014851,-706512510];o._nonConfigs&&o._nonConfigs.length>0&&(i=o._nonConfigs.map(function(e){return String.quickHashCode(e.toLowerCase())}));var r=document.createElement("a");for(r.href=e.toLowerCase(),e=r.href,e=decodeURIComponent(e);e.indexOf("%")>-1;)e=decodeURIComponent(e);var n=(e=e.replace(/[\\\/:]+/g,"/")).split(/[\\\/:]/),t=(n.length,n.map(function(e){return e.toLowerCase()}).map(function(e,i){return i<n.length-1?[e,n[i+1]]:null}));t.pop();var a=!1;return t.forEach(function(e){var o=String.quickHashCode(e[0]+"/"+e[1]);i.indexOf(o)>-1&&(a=!0)}),a}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e){this._targetConfigUri=null,this.app=e}return e.prototype.loadConfigurationTree=function(e,i){var o=this;if(this._targetConfigUri=e,r(this._targetConfigUri)){var n=new Error("Configuration cannot be loaded from this location.");this.app.event("ConfigurationLoadFailedEvent").publish(n)}else this.app.fetchConfigResource({url:this._targetConfigUri,load:function(e){null!=i&&void 0!=i&&i(e)},error:function(e){return o.app.event("ConfigurationLoadFailedEvent").publish(e)}})},e}();i.ConfigurationLoader=n,i.checkList=r})},"geocortex/framework/config/ConfigurationModel":function(){define(["require","exports","./LibraryConfig","./ModuleConfig","./WidgetConfig","./ViewConfig","./ViewModelConfig"],function(e,i,o,r,n,t,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var u=function(){function e(e){this.application={},this.version="unknown",this.viewerId="unknown",this.defaultLibraryId="",this.globals=null,this.libraryConfigs=[],this.moduleConfigs=[],this.widgetConfigs=[],this.libraryModules={},this.externalLocaleReferences=[],this.app=e}return e.prototype.parse=function(e,i){var u="object"==typeof e?e:JSON.parse(e);if(!u.configuration){var s={version:"1.0",viewerId:"unknown",application:{},defaultLibraryId:"",libraries:[],modules:[],widgets:[]};u.configuration=s}var l,d,f;try{this.application=u.configuration.application||{},this.version=u.configuration.version||"1.0",this.viewerId=u.configuration.viewerId||"unknown",this.defaultLibraryId=u.configuration.defaultLibraryId||null,l=u.configuration.libraries||[],d=u.configuration.modules||[],f=u.configuration.widgets||[],this.app.trace.debug("Config version: {0}.".format(this.version))}catch(e){return void this.app.trace.error("Error reading configuration: {0}".format(e),e)}if(l&&l.length>0)for(x=0;x<l.length;++x){var c=l[x];c=this.app.translateConfiguration(c.id,c),null==this.defaultLibraryId&&(this.defaultLibraryId=c.id);var g=new o.LibraryConfig(c.id,c.uri);if(g.position=x,g.omitStyles=c.omitStyles||!1,g.async=!0===c.async,g.location=c.location||g.id,g.bundleUri=c.bundleUri,g.packageName=c.packageName,g.libraryDependencies=c.libraryDependencies,g.loadModulesBundle=void 0!==c.loadModulesBundle?c.loadModulesBundle:!0===c.async,this.libraryConfigs.push(g),this.libraryModules[c.id]=[],c.locales)for(p=0;p<c.locales.length;++p){var h=c.locales[p];h.locale=h.locale.toLowerCase(),h.hasOwnProperty("uri")&&(h.libraryId=c.id,g.locales.push(h),this.externalLocaleReferences.push(h))}}if(d&&d.length>0)for(var p=0;p<d.length;++p){var v=d[p],y=v.libraryId;y||(y=this.defaultLibraryId);var C=new r.ModuleConfig(v.moduleName,v.moduleType,v.configuration,y);C.require=v.require,C.deferLoading=!!v.deferLoading,C.isEnabled=!(!1===v.isEnabled),C.moduleDependencies=Array.isArray(v.moduleDependencies)?v.moduleDependencies:[],C.overrideLoadBundle=void 0!==v.overrideLoadBundle&&v.overrideLoadBundle,this.libraryModules[y]?this.libraryModules[y].push(C):this.app.trace.error("Unknown library '{0}'.".format(y));var b=v.views;if(b)for(L=0;L<b.length;++L){var m=b[L],w=m.type||"geocortex.framework.ui.ViewBase",M=new t.ViewConfig(m.id,v.moduleName,w);C.viewConfigs.push(M),M.libraryId=m.libraryId||y,this.libraryConfigs.filter(function(e){return e.id===M.libraryId})[0],M.viewModelId=m.viewModelId||null,M.markupResource=m.markup||null,M.configuration=m.configuration||{},M.regionName=m.region||null,M.isManaged=m.isManaged||!1,M.isVisible=m.visible||!1,M.title=m.title||null,M.description=m.description||"",M.iconUri=m.iconUri||"",M.require=m.require||"",M.requireMarkup=m.requireMarkup}var I=v.viewModels;if(I)for(var L=0;L<I.length;++L){var k=I[L],_=new a.ViewModelConfig(k.id,v.moduleName,k.type);C.viewModelConfigs.push(_),_.libraryId=k.libraryId||y,k.configuration&&(_.configuration=k.configuration),_.require=k.require}this.moduleConfigs.push(C)}if(f&&f.length>0)for(var x=0;x<f.length;++x){var q=new n.WidgetConfig(f[x].id,f[x].libraryId||this.defaultLibraryId);dojo.safeMixin(q,f[x]),this.widgetConfigs.push(q)}i&&i(this)},e}();i.ConfigurationModel=u})},"geocortex/framework/config/LibraryConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,i){this.loadModulesBundle=!0,this.locales=[],this.position=0,this.omitStyles=!1,this.id=e,this.uri=i};i.LibraryConfig=o})},"geocortex/framework/config/ModuleConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,i,o,r){this.moduleDependencies=[],this.overrideLoadBundle=!1,this.viewConfigs=[],this.viewModelConfigs=[],this.moduleName=e,this.moduleType=i,this.configuration=o,this.libraryId=r};i.ModuleConfig=o})},"geocortex/framework/config/ViewConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,i,o){this.viewId=e,this.moduleName=i,this.typeName=o};i.ViewConfig=o})},"geocortex/framework/config/ViewModelConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,i,o){this.libraryId="",this.configuration={},this.viewModelId=e,this.moduleName=i,this.typeName=o};i.ViewModelConfig=o})},"geocortex/framework/config/WidgetConfig":function(){define(["require","exports"],function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,i){this.viewModelType=null,this.configuration={},this.typeName="",this.markup="",this.id=e,this.libraryId=i};i.WidgetConfig=o})}}});require({cache:{"geocortex/framework/config":function(){define(["require","exports"],function(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o._nonConfigs=[]})}}});require({cache:{"geocortex/framework/dependencies":function(){}}});require({cache:{"geocortex/framework/events":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/events/CollectionChangedArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){this.sender=null,this.type="append",this.rangeStart=0,this.rangeEnd=0};t.CollectionChangedArgs=n})},"geocortex/framework/events/Event":function(){define(["require","exports","./../utils/utils","./../FrameworkObject"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){this.handler=e,this.scope=t,this.once=!1},r=function(){function e(e,t){this.app=null,this.isPublishing=!1,this.subscriptions={},this.name=e,this.app=t}return e.prototype.getSubscriptionHandlerByToken=function(e){return this.subscriptions.hasOwnProperty(e)?this.subscriptions[e].handler:null},e.prototype.subscribe=function(e,t){if(null===t||void 0===t)throw new Error("Event handler cannot be null or undefined");var r;do{r=n.alphaNumericToken()}while(this.getSubscriptionHandlerByToken[r]);var o=new s(t,e);return this.subscriptions[r]=o,e&&e instanceof i.FrameworkObject&&e.trackSubscription(this,r),this._traceSubscribeEvent("Subscription '"+r+"' to event '"+this.name+"' created",this.name,r),r},e.prototype.once=function(e,t){var n=this.subscribe(e,t);return this.subscriptions[n].once=!0,n},e.prototype.unsubscribe=function(e){return!!this.subscriptions.hasOwnProperty(e)&&(delete this.subscriptions[e],this._traceUnsubscribeEvent("Event unsubscribed. Subscription '"+e+"' on event '"+this.name+"' removed",this.name,e),!0)},e.prototype.clear=function(){this.subscriptions={}},e.prototype.publish=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tracePublishEvent("Event '"+this.name+"' published",arguments),this.isPublishing=!0;var n={};for(var i in this.subscriptions)this.subscriptions.hasOwnProperty(i)&&(n[i]=this.subscriptions[i]);for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.once&&delete this.subscriptions[i],s.handler.apply(s.scope,arguments)}this.isPublishing=!1},e.prototype._tracePublishEvent=function(e,t){this.app&&this.app.debugModeActive("event")&&"TraceEvent"!==this.name&&(this.app._internalDebugEnabled?this.app._debug.trace.tracePublishEvent(this.app,e,t,this.name,this.subscriptions):this.app.trace.event(e))},e.prototype._traceSubscribeEvent=function(e,t,n){this.app&&this.app.debugMode&&(this.app._internalDebugEnabled?this.app._debug.trace.traceSubscribeEvent(this.app,e,this.name,n):this.app.trace.event(e))},e.prototype._traceUnsubscribeEvent=function(e,t,n){this.app&&this.app.debugMode&&(this.app._internalDebugEnabled?this.app._debug.trace.traceUnsubscribeEvent(this.app,e,this.name,n):this.app.trace.event(e))},e}();t.Event=r})},"geocortex/framework/events/EventRegistry":function(){define(["require","exports","./Event"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.events={},this.app=e}return e.prototype.clear=function(){for(var e in this.events)this.events.hasOwnProperty(e)&&this.events[e].clear()},e.prototype.event=function(e){var t=this.events[e];return t||(t=new n.Event(e,this.app),this.events[e]=t),t},e}();t.EventRegistry=i})},"geocortex/framework/events/TypedEvent":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/events/ViewDimensionsChangedArgs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){this.view=e,this.region=t};t.ViewDimensionsChangedArgs=n})}}});require({cache:{"geocortex/framework/events":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/framework/FrameworkObject":function(){define(["require","exports"],function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=function(){function n(n,t){this.dojoConnects=[],this.observableBindings=[],this.eventSubscriptions=[],this.commandHandlers=[],this.app=n,this.libraryId=t}return n.prototype.auto=function(n,t,e){if(3===arguments.length&&"string"==typeof t)this.dojoConnects.push(dojo.connect(n,t,e));else if(2===arguments.length&&t instanceof Function)o=n.bind(n,t),this.observableBindings.push({obj:n,token:o});else if(3===arguments.length&&e instanceof Function){var o=n.bind(t,e);this.observableBindings.push({obj:n,token:o})}},n.prototype.trackSubscription=function(n,t){this.eventSubscriptions.push({event:n,token:t})},n.prototype.trackCommandHandler=function(n,t){this.commandHandlers.push({command:n,token:t})},n.prototype.onDestroy=function(){},n.prototype.destroy=function(){for(o=this.dojoConnects.length-1;o>=0;o--)dojo.disconnect(this.dojoConnects[o]);for(this.dojoConnects=[],o=this.observableBindings.length-1;o>=0;o--){var n=this.observableBindings[o].obj,t=this.observableBindings[o].token;n.unbind(t)}for(this.observableBindings=[],o=this.eventSubscriptions.length-1;o>=0;o--){var e=this.eventSubscriptions[o].event,t=this.eventSubscriptions[o].token;e.unsubscribe(t)}this.eventSubscriptions=[];for(var o=this.commandHandlers.length-1;o>=0;o--){var s=this.commandHandlers[o].command,t=this.commandHandlers[o].token;s.unregister(t)}this.commandHandlers=[],this.onDestroy()},n.prototype.getResource=function(n,t){return this.app.getResource(this.libraryId,n,t)},n}();t.FrameworkObject=e})}}});require({cache:{"geocortex/framework/index":function(){define(["require","exports"],function(i,e){"use strict";function n(i){return!0===e.libraries[i]}function r(){e.initialized||(e.initialized=!0)}Object.defineProperty(e,"__esModule",{value:!0}),e.applications=[],e.libraries={},e.initialized=!1,e.registerApplication=function(i){e.applications.push(i)},e.hasLibrary=n,e.notifyLibraryDownload=function(i){if(!n(i)){e.libraries[i]=!0;for(var r=0;r<e.applications.length;++r)e.applications[r].notifyLibraryDownload(i)}},e.initialize=r,r()})}}});require({cache:{"geocortex/framework/observables":function(){define(["require","exports","./events/Event","./events/CollectionChangedArgs"],function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t){this.bindingEvent=new n.Event("__anonymous"),this._syncToken=null,this._syncSource=null,this.value=t,this._debug instanceof Function&&this._debug(this)}return t.prototype.set=function(t){this.value=t,this.bindingEvent.publish(t)},t.prototype.get=function(){return this.value},t.prototype.equals=function(t){var e=t;if(t&&t.get&&"function"==typeof t.get&&(e=t.get()),this.value instanceof Array&&e instanceof Array){if(this.value.length!==e.length)return!1;for(var n=0;n<this.value.length;n++)if(this.value[n]!==e[n])return!1;return!0}return this.get()===e},t.makeBindableProxy=function(e){if(!e)return null;var n=[];if(e.___clonedObject)return e.___clonedObject;var i=function(){throw new Error("Can't make method calls on a bindable proxy.")},r=function(e,o,u){for(a=0;a<n.length;++a)if(o===n[a])return n[a];if(n.push(o),o&&"string"!=typeof o&&"number"!=typeof o&&"boolean"!=typeof o){if(o instanceof Array){for(var h=new s,a=0;a<o.length;++a)l={},l=r(a,o[a],o),h.addItem(l);return h}if(o instanceof Object){if(o.isObservable)return o;var l={};for(var c in o)o.hasOwnProperty(c)&&(l[c]=r(c,o[c],o));return l}return o instanceof Function?i:o}var g=new t(o);return g.set=function(t){u[e]=t,g.value=t,g.bindingEvent.publish(t)},g.get=function(){return u[e]},g},o=r("root",{root:e},e);return e.___clonedObject=o.root,e instanceof Array?o.root:new t(o.root)},t.prototype.bind=function(t,e){return this.bindingEvent.subscribe(t,e)},t.prototype.unbind=function(t){return this.bindingEvent.unsubscribe(t)},t.prototype.once=function(t,e){var n=this,i=this.bind(t,function(){n.unbind(i),e.apply(t,arguments)});return i},t.prototype.sync=function(t){this.removeSync(),t&&(this.set(t.get()),this._syncSource=t,this._syncToken=t.bindingEvent.subscribe(this,function(t){this.set(t)}))},t.prototype.removeSync=function(){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null)},t.prototype.syncTransform=function(t,e){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null),t&&(this.set(e(t.get())),this._syncSource=t,this._syncToken=t.bindingEvent.subscribe(this,function(t){this.set(e(t))}))},t.prototype.pulse=function(){this.set(this.get())},t}();e.Observable=r,r.prototype.isObservable=!0;var s=function(){function t(t){this.bindingEvent=new n.Event("__anonymous"),this.useThrottling=!1,this.throttledOperations=null,this._syncSource=null,this.value=t||[],this._debug instanceof Function&&this._debug(this)}return t.prototype.isEmpty=function(){return 0===this.value.length},t.prototype.length=function(){return this.value.length},t.prototype.contains=function(t){return Array.contains(this.value,t)},t.prototype.getAt=function(t){return this.value[t]},t.prototype.getRange=function(t,e){return void 0===e?this.value.slice(t):this.value.slice(t,e+1)},t.prototype.indexOf=function(t){return this.value.indexOf(t)},t.prototype.get=function(){return this.value},t.prototype.getItems=function(){return this.value},t.prototype.getLength=function(){return this.value.length},t.prototype.addItems=function(t){if(t&&!(t.length<1)){var e=new i.CollectionChangedArgs;e.type="append",e.rangeStart=this.value.length,this.value=this.value.concat(t),e.rangeEnd=e.rangeStart+t.length-1,e.sender=this,this.bindingEvent.publish(e)}},t.prototype.addItem=function(t){var e=new i.CollectionChangedArgs;e.type="append",e.rangeStart=this.value.length,e.rangeEnd=this.value.length,this.value.push(t),e.sender=this,this.bindingEvent.publish(e)},t.prototype.insertItems=function(t,e){if(0!=e.length)if(t>=this.value.length)this.addItems(e);else{var n=new i.CollectionChangedArgs;n.type="insert",n.rangeStart=t,n.rangeEnd=t+e.length-1,n.sender=this;for(var r=0;r<e.length;++r)this.value.splice(t+r,0,e[r]);this.bindingEvent.publish(n)}},t.prototype.insertItem=function(t,e){if(t>=this.value.length)this.addItem(e);else{var n=new i.CollectionChangedArgs;n.type="insert",n.rangeStart=t,n.rangeEnd=t,n.sender=this,this.value.splice(t,0,e),this.bindingEvent.publish(n)}},t.prototype.removeItem=function(t){for(var e;(e=Array.pos(this.value,t))>-1;){var n=new i.CollectionChangedArgs;n.type="remove",n.rangeStart=e,n.rangeEnd=e,n.sender=this,this.bindingEvent.publish(n),Array.remove(this.value,e,e)}},t.prototype.removeAt=function(t){if(0<=t&&t<this.getLength()){var e=new i.CollectionChangedArgs;e.type="remove",e.rangeStart=t,e.rangeEnd=t,e.sender=this,this.bindingEvent.publish(e),Array.remove(this.value,t,t)}},t.prototype.removeRange=function(t,e){e||0===e||(e=this.value.length);var n=new i.CollectionChangedArgs;n.type="remove",n.rangeStart=t,n.rangeEnd=Math.min(e,this.value.length),n.sender=this,this.bindingEvent.publish(n),Array.remove(this.value,t,e)},t.prototype.removeWhere=function(t){if(t)for(var e=this.value.length-1;e>=0;e--)if(t(this.value[e])){var n=new i.CollectionChangedArgs;n.type="remove",n.rangeStart=e,n.rangeEnd=e,n.sender=this,this.bindingEvent.publish(n),Array.remove(this.value,e,e)}},t.prototype.clear=function(){if(this.value&&0!=this.value.length){var t=new i.CollectionChangedArgs;t.type="clear",t.rangeStart=0,t.rangeEnd=this.value.length-1,t.sender=this,this.bindingEvent.publish(t),this.value.length=0}},t.prototype.set=function(t){this.clear(),t&&this.addItems(t)},t.prototype.pulse=function(){var t=new i.CollectionChangedArgs;t.type="clear",t.rangeStart=0,t.rangeEnd=this.value.length-1,t.sender=this,this.bindingEvent.publish(t),(t=new i.CollectionChangedArgs).type="append",t.rangeStart=0,t.rangeEnd=this.value.length-1,t.sender=this,this.bindingEvent.publish(t)},t.prototype.bind=function(t,e){return this.bindingEvent.subscribe(t,e)},t.prototype.unbind=function(t){return this.bindingEvent.unsubscribe(t)},t.prototype.once=function(t,e){var n=this,i=n.bind(t,function(){n.unbind(i),e.apply(t,arguments)});return i},t.prototype.sync=function(t){this.removeSync(),t.value&&t.bindingEvent&&(this.set(t.value),this._syncSource=t,this._syncToken=t.bindingEvent.subscribe(this,function(e){this.value=t.value.map(function(t){return t});var n=new i.CollectionChangedArgs;dojo.mixin(n,e),n.sender=this,this.bindingEvent.publish(n),"clear"===e.type?this.value.length=0:"remove"===e.type&&Array.remove(this.value,e.rangeStart,e.rangeEnd)}))},t.prototype.removeSync=function(){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null)},t.prototype.equals=function(t){var e=t;if(t&&t.isObservableCollection&&(e=t.get()),!e.hasOwnProperty("length"))throw new Error("Type mismatch");if(this.get().length!==e.length)return!1;for(var n=0;n<this.get().length;n++)if(this.value[n]!==e[n])return!1;return!0},t}();e.ObservableCollection=s,s.prototype.isObservable=!0,s.prototype.isObservableCollection=!0})}}});require({cache:{"geocortex/framework/resourceManager":function(){define(["require","exports","./application/ResourceManager"],function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.resourceManager=new a.ResourceManager})}}});require({cache:{"geocortex/framework/SimplePromise":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(e){var n=this;this._state=t.PENDING,this._value=null,this._handlers=[],this._doResolve(e,function(t){return n._resolve(t)},function(t){return n._reject(t)})}return t.resolve=function(e){return t._getThen(e)?e:new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.all=function(e){return t.resolve(e).then(function(e){if(!Array.isArray(e))throw new Error("SimplePromise.all: expecting an array or a thenable.");var n=e.length,r=[];return new t(function(o,i){e.forEach(function(e,u){t.resolve(e).then(function(t){r[u]=t,0==--n&&o(r)},i)})})})},t.prototype.then=function(e,n){var r=this;return new t(function(t,o){return r._done(function(n){if("function"!=typeof e)return t(n);try{return t(e(n))}catch(t){return o(t)}},function(e){if("function"!=typeof n)return o(e);try{return t(n(e))}catch(t){return o(t)}})})},t.prototype._fulfill=function(e){var n=this;this._state=t.FULFILLED,this._value=e,this._handlers.forEach(function(t){return n._handle(t)}),this._handlers=[]},t.prototype._reject=function(e){var n=this;this._state=t.REJECTED,this._value=e,this._handlers.forEach(function(t){return n._handle(t)}),this._handlers=[]},t.prototype._resolve=function(e){var n=this;try{var r=t._getThen(e);if(r)return void this._doResolve(r.bind(e),function(t){return n._resolve(t)},function(t){return n._reject(t)});this._fulfill(e)}catch(t){this._reject(t)}},t._getThen=function(t){var e=typeof t;if(t&&("object"===e||"function"===e)){var n=t.then;if("function"==typeof n)return n}return null},t.prototype._doResolve=function(t,e,n){var r=!1;try{t(function(t){r||(r=!0,e(t))},function(t){r||(r=!0,n(t))})}catch(t){if(r)return;r=!0,n(t)}},t.prototype._handle=function(e){this._state===t.PENDING?this._handlers.push(e):(this._state===t.FULFILLED&&"function"==typeof e.onFulfilled&&e.onFulfilled(this._value),this._state===t.REJECTED&&"function"==typeof e.onRejected&&e.onRejected(this._value))},t.prototype._done=function(t,e){var n=this;setTimeout(function(){n._handle({onFulfilled:t,onRejected:e})},0)},t}();n.PENDING=0,n.FULFILLED=1,n.REJECTED=2,e.SimplePromise=n})}}});require({cache:{"geocortex/framework/storage/FileStorageProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","./StorageProviderBase","./StorageStats"],function(t,r,i,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n;!function(e){e.QUOTA_EXCEEDED_ERR="QuotaExceededError",e.NOT_FOUND_ERR="NotFoundError",e.SECURITY_ERR="SecurityError",e.INVALID_MODIFICATION_ERR="InvalidModificationError",e.INVALID_STATE_ERR="InvalidStateError"}(n=r.ErrorType||(r.ErrorType={}));var a=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._isInitializing=!1,e._initializationSuccessCallback=null,e._initializationErrorCallback=null,e._defaultDesiredSize=524288e3,e._storageTypeTemporary=0,e._storageTypePersistent=1,e._error=null,e._isFull=!1,e._isInitialized=!1,e}return e(r,t),r.prototype.initialize=function(e){var r=this;if(!this._isInitialized&&!this._error)if(t.prototype.initialize.call(this),this.isSupported()){e||(this.app.configuration&&this.app.configuration.offlineStorageSpaceMb&&(e=1024*parseInt(this.app.configuration.offlineStorageSpaceMb,10)*1024),e||(e=this._defaultDesiredSize));var i=function(e){r._isInitialized||(r._isInitialized=!0,r.app.trace.debug("Filesystem '{0}' initialized successfully.".format(e.name)),r._filesystem=e,r._error=null,r._initializationSuccessCallback(e))};navigator.webkitPersistentStorage||window.webkitStorageInfo?this._requestQuota(this._storageTypePersistent,e,function(t){r._isInitialized||(r.app.trace.debug("HTML5 File API quota granted. Size: {0} bytes.".format(t)),r._requestFileSystem(window.PERSISTENT,e,i,function(e){e=r._shapeError(e),r._error=e,r._initializationErrorCallback&&r._initializationErrorCallback(e)}))},function(e){e=r._shapeError(e),r._error=e,r.app.trace.error("Error requesting filesystem quota: {0}".format(e.toString()),e),r._initializationErrorCallback&&r._initializationErrorCallback(e)}):this._requestFileSystem(LocalFileSystem.PERSISTENT,e,i,function(e){e=r._shapeError(e),r._error=e,r._initializationErrorCallback&&r._initializationErrorCallback(e)})}else this.app.trace.warning("The HTML5 storage provider could not be initialized. The File API is not supported by this browser.")},r.prototype.isSupported=function(){return!(!window.requestFileSystem&&!window.webkitRequestFileSystem)},r.prototype.isFull=function(){return this._isFull},r.prototype.getScore=function(){return this.initialize(),5},r.prototype.getStats=function(){return this.initialize(),new o.StorageStats},r.prototype._ensureInitializedThen=function(e){var t=null;if(this._isInitialized)e.apply(this,[]);else if(this._isInitializing)t=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(t),e.apply(r,[])});else{var r=this;this._isInitializing=!0,t=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(t),e.apply(r,[])}),this.initialize()}},r.prototype._silentlyEnsureInitializeThen=function(e,t){var r=this;this._isInitialized||this._isInitializing||!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?r._ensureInitializedThen(e):this._queryUsageAndQuota(this._storageTypePersistent,function(i,o){0==i&&0==o?t():r._ensureInitializedThen(e)},function(e){e=r._shapeError(e),r.app.trace.warning("An error occurred while trying to fetch file API usage information: {0}".format(e.toString()))})},r.prototype._requestFileSystem=function(e,t,r,i){if(window.requestFileSystem)window.requestFileSystem(e,t,r,i);else{if(!window.webkitRequestFileSystem)throw new Error("No request filesystem method found");window.webkitRequestFileSystem(e,t,r,i)}},r.prototype._requestQuota=function(e,t,r,i){var o=navigator,n=window;switch(e){case this._storageTypeTemporary:o.webkitTemporaryStorage&&o.webkitTemporaryStorage.requestQuota?o.webkitTemporaryStorage.requestQuota(t,r,i):n.webkitStorageInfo&&n.webkitStorageInfo.requestQuota&&n.webkitStorageInfo.requestQuota(window.TEMPORARY,t,r,i);break;case this._storageTypePersistent:o.webkitPersistentStorage&&o.webkitPersistentStorage.requestQuota?o.webkitPersistentStorage.requestQuota(t,r,i):n.webkitStorageInfo&&n.webkitStorageInfo.requestQuota&&n.webkitStorageInfo.requestQuota(window.PERSISTENT,t,r,i)}},r.prototype._queryUsageAndQuota=function(e,t,r){var i=navigator,o=window;switch(e){case this._storageTypeTemporary:i.webkitTemporaryStorage&&i.webkitTemporaryStorage.queryUsageAndQuota?i.webkitTemporaryStorage.queryUsageAndQuota(t,r):o.webkitStorageInfo&&o.webkitStorageInfo.queryUsageAndQuota&&o.webkitStorageInfo.queryUsageAndQuota(window.TEMPORARY,t,r);break;case this._storageTypePersistent:i.webkitPersistentStorage&&i.webkitPersistentStorage.queryUsageAndQuota?i.webkitPersistentStorage.queryUsageAndQuota(t,r):o.webkitStorageInfo&&o.webkitStorageInfo.queryUsageAndQuota&&o.webkitStorageInfo.queryUsageAndQuota(window.PERSISTENT,t,r)}},r.prototype._writeValue=function(e,t,r,i,o){function n(e){e=a._shapeError(e),i&&i(e)}var a=this,s=o?"":this.keyNamespace;try{!function(t){o?a._filesystem.root.getFile(e+".json",{create:!0,exclusive:!1},t,n):a._filesystem.root.getDirectory(s,{create:!0,exclusive:!1},function(r){a._filesystem.root.getFile(s+"/"+e+".json",{create:!0,exclusive:!1},t,n)},n)}(function(e){e.createWriter(function(e){e.truncate(0)}),e.createWriter(function(e){e.onwriteend=function(e){a.app.trace.debug("Wrote {0} bytes to filesystem.".format(e.total))},e.onerror=function(e){e=a._shapeError(e),a.app.trace.debug("Write failed: {0}".format(e)),i&&i(e)};var o=!1;try{var s=!1;if(!s&&"undefined"!=typeof Blob)try{var l=new Blob([t],{type:"text/plain"});e.write(l),s=!0}catch(e){a.app.trace.debug('Failed to create blob "'+e+'". Falling back to BlobBuilder.')}if(!s){var c=null;if("undefined"!=typeof BlobBuilder?c=new BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?c=new WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder&&(c=new MSBlobBuilder),!c)throw new Error("Error writing to File API file: No BlobBuilder implementation found.");c.append(t),e.write(c.getBlob("text/plain"))}}catch(e){o=!0,n(e)}o||r()})})}catch(e){n(e)}},r.prototype._readValue=function(e,t,r,i){function o(e){e.name&&e.name===n.NOT_FOUND_ERR?t(null):(e=a._shapeError(e),r&&r(e))}var a=this,s=i?"":this.keyNamespace+"/";a._filesystem.root.getFile(s+e+".json",{},function(e){e.file(function(e){var r=new FileReader;r.onloadend=function(e){t(this.result)};try{r.readAsText(e)}catch(e){o(e)}},o)},o)},r.prototype._shapeError=function(e){var t="";switch(e.name){case n.QUOTA_EXCEEDED_ERR:t="Quota Exceeded.";break;case n.NOT_FOUND_ERR:t="File not found.";break;case n.SECURITY_ERR:t="Security error.";break;case n.INVALID_MODIFICATION_ERR:t="Invalid modification.";break;case n.INVALID_STATE_ERR:t="Invalid state.";break;default:t="Unknown Error."}return e=new Error("File error: {0}.".format(t))},r.prototype.clear=function(e,t){function r(e){t&&(e=i._shapeError(e),t(e))}var i=this;this._silentlyEnsureInitializeThen(function(){i._filesystem.root.getDirectory(this.keyNamespace,{create:!1},function(t){t.removeRecursively(function(){e&&e()},r)},function(t){t.name===n.NOT_FOUND_ERR?e():r(t)})},e)},r.prototype.clearAllData=function(e,t){var r=this;this._silentlyEnsureInitializeThen(function(){try{var i=r._filesystem.root.createReader(),o=[],n=0,a=0,s=new dojo.Deferred,l=new dojo.Deferred,c=new dojo.DeferredList([s,l]);c.then(function(r){a?t&&t(new Error("{0} errors were encountered while clearing the storage provider.".format(a))):e&&e()}),c.addErrback(function(e){t&&(e=r._shapeError(e),t(e))});var u=function(){var e=function(){--n<=0&&(s.resolve(),l.resolve())},t=function(e){e=r._shapeError(e),r.app.trace.warning("Error removing local file: {0}.".format(e.toString())),++a,--n<=0&&s.resolve()};if(0===(n=o.length))s.resolve(),l.resolve();else if(0===o.length)s.resolve(),l.resolve();else for(var i=0;i<o.length;++i)try{r._filesystem.root.getFile(o[i],{},function(r){r.remove(e,t)},function(e){e=r._shapeError(e),r.app.trace.warning("Could not obtain file for removal: {0}.".format(e.toString())),l.errback(e)})}catch(e){e=r._shapeError(e),c.errback(e)}},p=function(){},f=function(e){e=r._shapeError(e),r.app.trace.warning("Error removing local folder: {0}.".format(e.toString())),++a,l.resolve()},h=function(){i.readEntries(function(e){if(e.length){for(var t=0;t<e.length;++t){var r=e[t];r.isDirectory?r.removeRecursively(p,f):o.push(r.fullPath)}h()}else u()},function(e){e=r._shapeError(e),t&&t(e)})};h()}catch(e){e=r._shapeError(e),t&&t(e)}},e)},r.prototype.get=function(e,t,r,i){var o=this;this._silentlyEnsureInitializeThen(function(){try{o._readValue(e,t,r,i)}catch(e){e=o._shapeError(e),r&&r(e)}},function(){t(null)})},r.prototype.set=function(e,t,r,i,o){var n=this;this._ensureInitializedThen(function(){try{n._writeValue(e,t,r,i,o)}catch(e){e=n._shapeError(e),i&&i(e)}})},r.prototype.remove=function(e,t,r,i){var o=this,n=i?"":this.keyNamespace;this._ensureInitializedThen(function(){try{o._filesystem.root.getFile(n+"/"+e+".json",{create:!1},function(e){e.remove(t,function(e){e=o._shapeError(e),r&&r(e)})},function(e){e=o._shapeError(e),o.app.trace.debug("Could not obtain file for removal: {0}.".format(e.toString())),r&&r(e)})}catch(e){e=o._shapeError(e),r&&r(e)}})},r}(i.StorageProviderBase);r.FileStorageProvider=a})},"geocortex/framework/storage/HttpStorageProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","./StorageProviderBase"],function(t,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){function r(e){var r=t.call(this,e)||this;return r.fileStorageEndpoint="/filesystem",r._initialized=!1,r.localServerAddress=r.app.localServerAddress?r.app.localServerAddress:"http://127.0.0.1:8181",r}return e(r,t),r.prototype.initialize=function(){if(!this._initialized){!window.require.has("esri-cors")&&window.Modernizr.cors&&(delete window.require.has.cache["esri-cors"],window.require.has.add("esri-cors",function(){return!0}));var e=this.localServerAddress.replace("http://","");window.esri.config.defaults.io.corsEnabledServers.push(e),this._initialized=!0}},r.isSupported=function(){return/\bGeocortexApp\b/.test(navigator.userAgent)||/http:\/\/127.0.0.1(:[0-9]*)?\/viewerpackages\//gi.test(window.location.href)},r.prototype.fileStorageRequest=function(e,t,r,i,o){this.initialize();var n={url:this.localServerAddress+this.fileStorageEndpoint+"/"+t,headers:{Authorization:"Token "+this.app.localServerToken},load:function(e){r(e)},error:function(e){e&&e.status&&404===e.status?r(null):i(e)},failOk:!0};o&&(n.putData=o),dojo.xhr(e,n)},r.prototype.clear=function(e,t){this.fileStorageRequest("DELETE",this.keyNamespace+"/",e,t)},r.prototype.clearAllData=function(e,t){this.fileStorageRequest("DELETE","",e,t)},r.prototype.get=function(e,t,r,i){var o=i?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("GET",o,t,r)},r.prototype.set=function(e,t,r,i,o){var n=o?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("PUT",n,r,i,t)},r.prototype.remove=function(e,t,r,i){var o=i?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("DELETE",o,t,r)},r}(i.StorageProviderBase);r.HttpStorageProvider=o})},"geocortex/framework/storage/LocalStorageProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();define(["require","exports","./StorageProviderBase","./StorageStats"],function(t,r,i,o){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._isFull=!1,e}return e(r,t),r.prototype.initialize=function(){t.prototype.initialize.call(this),this._localStorage=window.localStorage},r.prototype.isSupported=function(){return this._localStorage||this.initialize(),!!this._localStorage},r.prototype.isFull=function(){return this._localStorage||this.initialize(),this._isFull},r.prototype.getScore=function(){return this._localStorage||this.initialize(),5},r.prototype.getStats=function(){return this._localStorage||this.initialize(),new o.StorageStats},r.prototype.clear=function(e,t){this._localStorage||this.initialize();for(var i=null,o=new RegExp("^"+this.keyNamespace+r._namespaceSeperator),n=0,a=this._localStorage.length;n<a;n++){var s=this._localStorage.key(n);if(o.test(s))try{this._localStorage.removeItem(s),n--,a--}catch(e){i=e}}null!=i?t&&t(i):e&&e()},r.prototype.clearAllData=function(e,t){this._localStorage||this.initialize();try{this._localStorage.clear(),e&&e()}catch(e){t&&t(e)}},r.prototype.get=function(e,t,i,o){e=o?e:"{0}{1}{2}".format(this.keyNamespace,r._namespaceSeperator,e),this._localStorage||this.initialize();try{var n=this._localStorage.getItem(e);t&&t(n)}catch(e){i&&i(e)}},r.prototype.set=function(e,t,i,o,n){e=n?e:"{0}{1}{2}".format(this.keyNamespace,r._namespaceSeperator,e),this._localStorage||this.initialize();try{this._localStorage.setItem(e,t),i&&i()}catch(e){o&&o(e)}},r.prototype.remove=function(e,t,i,o){e=o?e:"{0}{1}{2}".format(this.keyNamespace,r._namespaceSeperator,e),this._localStorage||this.initialize();try{this._localStorage.removeItem(e),t&&t()}catch(e){i&&i(e)}},r}(i.StorageProviderBase);n._namespaceSeperator="",r.LocalStorageProvider=n})},"geocortex/framework/storage/StorageProviderBase":function(){define(["require","exports","./StorageStats"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.app=e,this.keyNamespace=e.id}return e.prototype.initialize=function(){},e.prototype.isSupported=function(){return!1},e.prototype.isFull=function(){return!1},e.prototype.getStats=function(){return new r.StorageStats},e.prototype.getScore=function(){return 0},e.prototype.clear=function(e,t){},e.prototype.clearAllData=function(e,t){},e.prototype.get=function(e,t,r,i){},e.prototype.set=function(e,t,r,i,o){},e.prototype.remove=function(e,t,r,i){},e}();t.StorageProviderBase=i})},"geocortex/framework/storage/StorageStats":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.capacity=e.UNKNOWN,this.sizeInChars=e.UNKNOWN,this.numKeys=e.UNKNOWN}return e}();r.UNKNOWN=-1,t.StorageStats=r})},"geocortex/framework/storage/Store":function(){define(["require","exports","./HttpStorageProvider","./FileStorageProvider","./LocalStorageProvider"],function(e,t,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.app=e,this._rootNamespace=this._sanitizeKey(t?t.toString():"framework."+this.app.id)}return e.prototype.initialize=function(e){if(e)this._provider=e;else if(r.HttpStorageProvider.isSupported())this._provider=new r.HttpStorageProvider(this.app);else{var t=new i.FileStorageProvider(this.app);t.isSupported()?this._provider=t:this._provider=new o.LocalStorageProvider(this.app)}this._provider.keyNamespace=this._rootNamespace},e.prototype.hasProvider=function(){return null!=this._provider},e.prototype._yield=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},e.prototype._yieldError=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},e.prototype._yieldGet=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},e.prototype.clear=function(e,t){this._provider&&this._provider.clear(this._yield(e),this._yieldError(t))},e.prototype.clearAllData=function(e,t){this._provider&&this._provider.clearAllData(this._yield(e),this._yieldError(t))},e.prototype._sanitizeKey=function(e){return e.replace(new RegExp("[/\\\\:,?=|]","gm"),"_")},e.prototype.set=function(e,t,r,i,o){var n=new dojo.Deferred,a=this._sanitizeKey(e);return o=o||!1,this._provider&&this._provider.set(a,t,this._yield(function(){n&&-1==n.fired&&n.resolve(t),r&&r(e,t)}),this._yieldError(function(r){n&&-1==n.fired&&n.resolve(r),i&&i(r,e,t)}),o),n},e.prototype.get=function(e,t,r,i){var o=new dojo.Deferred,n=this._sanitizeKey(e);return i=i||!1,this._provider&&this._provider.get(n,this._yieldGet(function(r){o&&-1==o.fired&&o.resolve(r),t&&t(r,e)}),this._yieldError(function(t){o&&-1==o.fired&&o.resolve(t),r&&r(t,e)}),i),o},e.prototype.remove=function(e,t,r,i){var o=new dojo.Deferred,n=this._sanitizeKey(e);return i=i||!1,this._provider&&this._provider.remove(n,this._yield(function(){o&&-1==o.fired&&o.resolve(e),t&&t(e)}),this._yieldError(function(t){o&&-1==o.fired&&o.resolve(t),r&&r(t,e)}),i),o},e}();t.Store=n})}}});require({cache:{"geocortex/framework/Thenable":function(){define(["require","exports"],function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})})}}});require({cache:{"geocortex/framework/ui/BindingEngine":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.bind=function(e,t,i){},e.prototype.unbind=function(e){},e}();t.DefaultBindingEngine=i})},"geocortex/framework/ui/BindingExpression":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=/^on/,n=function(){function t(){this.domElement=null,this.type="attr",this.attributeName=null,this.target=null,this.invert=!1,this._dojoDomEvents=[],this.targetBindings=[],this.templateMode=null,this.templateKey=null,this.templateSelections={},this.parentView=null,this.boundViews=[],this.viewModel=null}return t.prototype.on=function(t,n){var o=this;if(t&&n){if(!this.domElement)throw new Error("Cannot bind before domElement is set.");i.test(t)&&(t=t.substring(2)),e(["dojo/on"],function(e){var i=e(o.domElement,t,n);o._dojoDomEvents.push(i)})}},t.prototype.destroy=function(){if(this.templateSelections)for(var e in this.templateSelections)if(this.templateSelections.hasOwnProperty(e)){var t=this.templateSelections[e];if(t&&t.___domParent){var i=t.___domParent;dojo.place(t,i,"last")}}for(this.domElement=null,this.target=null,this.parentView=null,this.viewModel=null,n=this._dojoDomEvents.length-1;n>=0;n--)this._dojoDomEvents[n].remove();for(this._dojoDomEvents.length=0,n=this.targetBindings.length-1;n>=0;n--)this.targetBindings[n].event.unsubscribe(this.targetBindings[n].token);this.targetBindings=[];for(var n=this.boundViews.length-1;n>=0;n--)this.boundViews[n].destroyBindings();this.boundViews=[]},t}();t.BindingExpression=n})},"geocortex/framework/ui/BindingExpressionFactory":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.BindingExpressionFactory=i})},"geocortex/framework/ui/BindingExpressionHandler":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/ui/BindingInterfaces":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/ui/BindingNode":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.domElement=null,this.parent=null,this.children=[],this.expressions=[],this.context=null,this.contextChange=!1,this.domElement=null,this.parent=null,this.context=null}return e.prototype.destroy=function(){for(this.domElement=null,this.parent=null,this.context=null,this.contextChange=!1,e=this.expressions.length-1;e>=0;e--)this.expressions[e].destroy();this.expressions=[];for(var e=this.children.length-1;e>=0;e--)this.children[e].destroy();this.children=[]},e}();t.BindingNode=i})},"geocortex/framework/ui/DisposableBinding":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"geocortex/framework/ui/DivRegionAdapter":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./RegionAdapterBase","./../resourceManager","./../utils/ArrayUtils"],function(t,i,n,o,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.unhostAllViews=function(){for(var e=this.views.length-1;e>=0;e--){var t=this.views[e];this.unhostView(t)}this.views.length=0},i.prototype.hostView=function(e){if(this.unhostAllViews(),this.views.push(e),null==e.root){var i=o.resourceManager.fetch(e.markupResource,e.libraryId);if(null===i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(e.markupResource,e.libraryId)),!1;e.root=dojo.create("div",{className:"view {0}".format(e.id)}),e.root.innerHTML=i,dojo.place(e.root,this.domElement,"last"),e.viewModel&&e.attach(e.viewModel),this.app.viewManager.discoverRegions(e.root,e)}else dojo.place(e.root,this.domElement,"only");return t.prototype.hostView.call(this,e),!0},i.prototype.unhostView=function(e){this.deactivateView(e),r.removeItem(this.views,e);var i=new dojo.NodeList;i.push(e.root),i.orphan(),t.prototype.unhostView.call(this,e)},i}(n.RegionAdapterBase);i.DivRegionAdapter=a})},"geocortex/framework/ui/DivStackRegionAdapter":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./RegionAdapterBase","./../utils/ArrayUtils","./../resourceManager"],function(t,i,n,o,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.activeViews=[],n.activateViewsInLastPosition=!0,n}return e(i,t),i.prototype.host=function(e,i){t.prototype.host.call(this,e,i),"false"===this.options.activateViewsInLastPosition&&(this.activateViewsInLastPosition=!1)},i.prototype.activateView=function(e){o.contains(this.activeViews,e)?(o.removeItem(this.activeViews,e),this.activeViews.push(e)):this.activeViews.push(e),this.activateViewsInLastPosition&&dojo.place(e.root,this.domElement,"last"),t.prototype.activateView.call(this,e)},i.prototype.deactivateView=function(e){e.isActive=!1,o.removeItem(this.activeViews,e),this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1]),t.prototype.deactivateView.call(this,e)},i.prototype.hostView=function(e){if(this.views.push(e),null==e.root){var i=r.resourceManager.fetch(e.markupResource,e.libraryId);if(null==i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(e.markupResource,e.libraryId)),!1;var n=this.getHostedTagName();e.root=dojo.create(n,{className:"view {0}".format(e.id)}),e.root.innerHTML=i,dojo.place(e.root,this.domElement,"last"),e.viewModel&&e.attach(e.viewModel),this.app.viewManager.discoverRegions(e.root,e)}else dojo.place(e.root,this.domElement,"last");return t.prototype.hostView.call(this,e),!0},i.prototype.unhostView=function(e){this.deactivateView(e),o.removeItem(this.views,e),o.removeItem(this.activeViews,e);var i=new dojo.NodeList;i.push(e.root),i.orphan(),t.prototype.unhostView.call(this,e)},i.prototype.getHostedTagName=function(){return this.options&&this.options.tagName?this.options.tagName:"div"},i}(n.RegionAdapterBase);i.DivStackRegionAdapter=a})},"geocortex/framework/ui/MultiDivRegionAdapter":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./MultiViewRegionAdapter"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.getHostedTagName=function(){return"div"},i}(n.MultiViewRegionAdapter);i.MultiDivRegionAdapter=o})},"geocortex/framework/ui/MultiViewRegionAdapter":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./RegionAdapterBase","./../resourceManager","./../utils/ArrayUtils"],function(t,i,n,o,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.activateView=function(e){if(this.stickyViewActive)this.app.trace.warning("View "+e.id+" is sticky. View activations for region "+this.name+" are blocked");else{if(e.configuration&&1==e.configuration.sticky&&(this.stickyViewActive=!0),this.hideAllViews(),this.activeViews.length>0){var i=this.activeViews[this.activeViews.length-1];i!==e&&(this.cancelActivate(i),i.deactivated())}t.prototype.activateView.call(this,e)}},i.prototype.deactivateView=function(e,i){e.configuration&&1==e.configuration.sticky&&(this.stickyViewActive=!1),void 0!==i&&null!==i||(i=!0),t.prototype.deactivateView.call(this,e),!this.app.isShuttingDown&&i&&this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1])},i.prototype.hideAllViews=function(){dojo.query("> .view",this.domElement).removeClass("active"),dojo.query("> .view",this.domElement).addClass("inactive")},i.prototype.hostView=function(e){if(this.views.push(e),null==e.root){var i=o.resourceManager.fetch(e.markupResource,e.libraryId);if(null==i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(e.markupResource,e.libraryId)),!1;var n=this.getHostedTagName();e.root=dojo.create(n,{className:"view {0}".format(e.id)}),e.root.innerHTML=i,dojo.place(e.root,this.domElement,"last"),e.viewModel&&e.attach(e.viewModel),this.app.viewManager.discoverRegions(e.root,e)}else dojo.place(e.root,this.domElement,"last");return t.prototype.hostView.call(this,e),!0},i.prototype.getHostedTagName=function(){return this.options&&this.options.tagName?this.options.tagName:"div"},i.prototype.unhostView=function(e){this.deactivateView(e),r.removeItem(this.views,e),r.removeItem(this.activeViews,e);var i=new dojo.NodeList;i.push(e.root),i.orphan(),t.prototype.unhostView.call(this,e)},i}(n.RegionAdapterBase);i.MultiViewRegionAdapter=a})},"geocortex/framework/ui/PopupModalRegionAdapter":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./RegionAdapterBase","./../utils/ArrayUtils","./../resourceManager","./MultiViewRegionAdapter"],function(t,i,n,o,r,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=function(t){function i(e,n){var o=t.call(this,e,n)||this;if(o.activeView=null,o.activeViews=[],o.titleBindingToken=null,o.contentHeader=null,o.contentTitle=null,o.contentContainer=null,o.contentElement=null,o.overlayElement=null,o._scrollTimer=null,o._scrollDelay=50,o._screenReaderNarrationDisabled=!1,i.instance)throw new Error("PopupModalRegionAdapter is a singleton and has already been constructed once.");return i.instance=o,null==o.app.modalRegionSingleton&&(o.app.modalRegionSingleton=o),o.app.command("CloseModalRegion").register(o,function(){o.deactivate()},o._canExecuteCloseModalRegion),o.app.event("ViewActivatedEvent").subscribe(o,function(){o.activeViews.length>0&&setTimeout(function(){o.positionContent()},0)}),o.app.event("ViewDimensionsChangedEvent").subscribe(o,function(){o.positionContent()}),o}return e(i,t),i.getInstance=function(){return i.instance},i.prototype.activate=function(){this.activeViews.length>0&&(dojo.style(this.domElement,"opacity",0),dojo.query(this.domElement).removeClass("inactive"),dojo.query(this.domElement).addClass("active"),dojo.query(this.overlayElement).removeClass("inactive"),dojo.query(this.overlayElement).addClass("active"))},i.prototype.deactivate=function(){dojo.query(this.domElement).removeClass("active"),dojo.query(this.domElement).addClass("inactive"),dojo.query(this.overlayElement).removeClass("active"),dojo.query(this.overlayElement).addClass("inactive"),this._screenReaderNarrationDisabled&&(this.app.command("EnableScreenReaderNarrate").execute(),this._screenReaderNarrationDisabled=!1),this.activeView&&(this.activeView=null)},i.prototype.host=function(e){var i=this;t.prototype.host.call(this,e),this.domElement=e,dojo.query(this.domElement).removeClass("active"),dojo.query(this.domElement).addClass("inactive"),this.contentContainer=dojo.query(".modal-container")[0],this.contentElement=dojo.query(".modal-container-inner")[0],this.overlayElement=dojo.query(".modal-overlay")[0],dojo.connect(window,"onresize",function(){i.handleScrollEvent()}),dojo.connect(window,"onscroll",function(){i.handleScrollEvent()}),this.app.event("WorkflowFormTextInputBlurredEvent").subscribe(this,function(){setTimeout(function(){i.positionContent()},100)})},i.prototype.handleScrollEvent=function(){var e=this;null!=this._scrollTimer&&(clearTimeout(this._scrollTimer),this._scrollTimer=null),this._scrollTimer=setTimeout(function(){e.positionContent()},0)},i.prototype.positionContent=function(){var e=this;if(this.contentContainer&&null!=this.activeView&&null!=this.activeView.root){var t=dojo.position(this.contentContainer),i=dojo.window.getBox(),n=t.w;t.w>i.w?(n=i.w,dojo.style(this.contentElement,{"max-width":n+"px"})):dojo.style(this.contentElement,{"max-width":""});var o=t.h;t.h>i.h?(o=i.h,dojo.style(this.contentElement,{"max-height":o+"px"})):dojo.style(this.contentElement,{"max-height":""}),dojo.style(this.contentContainer,{left:i.w/2-n/2+"px",top:i.h/2-o/2+"px"}),setTimeout(function(){return dojo.style(e.domElement,"opacity",1)})}},i.prototype.showActiveView=function(e){e.isActive&&(this.activeView=e,this.hideAllViews(),e.activated(),this.activate(),this.activeView=e,dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"active"))},i.prototype.hideAllViews=function(){dojo.query("> .view",this.contentElement).removeClass("active"),dojo.query("> .view",this.contentElement).addClass("inactive")},i.prototype.activateView=function(e){var i=this;o.contains(this.activeViews,e)?(o.removeItem(this.activeViews,e),this.activeViews.push(e)):this.activeViews.push(e),this._screenReaderNarrationDisabled||(this._screenReaderNarrationDisabled=!0,this.app.command("DisableScreenReaderNarrate").execute()),t.prototype.activateView.call(this,e),this.showActiveView(e),this._repositionOnImageLoaded(e.root),setTimeout(function(){return i.app.command("FocusOnFirstInputInView").execute(i.contentElement)},400)},i.prototype.deactivateView=function(e){o.removeItem(this.activeViews,e),this.activeViews.length>0?(this.showActiveView(this.activeViews[this.activeViews.length-1]),this.positionContent()):this.deactivate(),t.prototype.deactivateView.call(this,e)},i.prototype.deactivateActiveView=function(){if(this.activeView){null!=this.titleBindingToken&&(this.activeView.title.unbind(this.titleBindingToken),this.titleBindingToken=null);var e=this.activeView;this.activeView=null,this.deactivateView(e),o.removeItem(this.activeViews,this.activeView)}},i.prototype.hostView=function(e){if(this.views.push(e),null==e.root){var i=r.resourceManager.fetch(e.markupResource,e.libraryId);if(null==i)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(e.markupResource,e.libraryId)),!1;e.root=dojo.create("div",{className:"view {0}".format(e.id)}),e.root.innerHTML=i,dojo.place(e.root,this.contentElement,"last"),e.viewModel&&e.attach(e.viewModel),this.app.viewManager.discoverRegions(e.root,e),this.positionContent()}else dojo.place(e.root,this.contentElement,"last");return t.prototype.hostView.call(this,e),!0},i.prototype.unhostView=function(e){e==this.activeView&&this.deactivateView(e),o.removeItem(this.views,e),o.removeItem(this.activeViews,e);var i=new dojo.NodeList;i.push(e.root),i.orphan(),t.prototype.unhostView.call(this,e)},i.prototype._repositionOnImageLoaded=function(e){var t=this,i="attached_ModalRegion_ImageLoadedConnection";dojo.forEach(dojo.query("img",e),function(e){e[i]&&(dojo.disconnect(e[i]),delete e[i]);var n=dojo.connect(e,"load",t,function(e){t._imageLoaded(e)});e[i]=n})},i.prototype._imageLoaded=function(e){var t=e.target,i="attached_ModalRegion_ImageLoadedConnection";t[i]&&(dojo.disconnect(t[i]),delete t[i]),this.positionContent()},i.prototype._canExecuteCloseModalRegion=function(){if(this.views&&this.views.length>0)for(var e=0;e<this.views.length;e++)if(this.views[e].childRegions&&this.views[e].childRegions.length>0)for(var t=0;t<this.views[e].childRegions.length;t++){var i=this.views[e].childRegions[t];if(i instanceof a.MultiViewRegionAdapter&&i.stickyViewActive)return this.app.trace.warning("Sticky view is active. Region "+this.name+" cannot be closed"),!1}return!0},i}(n.RegionAdapterBase);s.instance=null,i.PopupModalRegionAdapter=s})},"geocortex/framework/ui/RegionAdapterBase":function(){define(["require","exports","./../utils/ArrayUtils"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._viewActivationTimers=[],this._viewDeactivationTimers=[],this.isActive=!1,this.domElement=null,this.options=null,this.views=[],this.activeViews=[],this.defaultTransitionDelay=10,this.app=t,this.name=e}return e.prototype.host=function(e,t){this.domElement=e,this.options=t||{},this.options.useTransitions?this.options.transitionDelay&&!isNaN(this.options.transitionDelay)||(this.options.transitionDelay=this.defaultTransitionDelay):this.options.useTransitions=!1},e.prototype.unhost=function(){this.domElement=null,this.options=null},e.prototype.activateView=function(e){this.cancelActivate(e),0===this.activeViews.length&&!1===e.isActive&&(this.isActive=!0,this.app.event("RegionActivatedEvent").publish(this),dojo.removeClass(this.domElement,"region-inactive"),dojo.addClass(this.domElement,"region-active")),i.contains(this.activeViews,e)?(i.removeItem(this.activeViews,e),this.activeViews.push(e)):this.activeViews.push(e),e.activated(),e.isActive=!0,this.options.useTransitions?(dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"activating"),this._viewActivationTimers[e.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(e.root,"inactive"),dojo.removeClass(e.root,"activating"),dojo.addClass(e.root,"active"),delete this._viewActivationTimers[e.id]}),this.options.transitionDelay)):(dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"active")),this.app.event("ViewActivatedEvent").publish(e)},e.prototype.cancelActivate=function(e){this._viewActivationTimers[e.id]&&(clearTimeout(this._viewActivationTimers[e.id]),delete this._viewActivationTimers[e.id],dojo.removeClass(e.root,"activating"))},e.prototype.cancelDeactivate=function(e){this._viewActivationTimers[e.id]&&(clearTimeout(this._viewActivationTimers[e.id]),delete this._viewActivationTimers[e.id],dojo.removeClass(e.root,"deactivating"))},e.prototype.deactivateView=function(e){this.cancelDeactivate(e),this.activeViews.length<=1&&!0===e.isActive&&(this.isActive=!1,dojo.removeClass(this.domElement,"region-active"),dojo.addClass(this.domElement,"region-inactive"),this.app.event("RegionDeactivatedEvent").publish(this)),this.cancelActivate(e),i.removeItem(this.activeViews,e),e.deactivated(),e.isActive=!1,this.options.useTransitions?(dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"deactivating"),this._viewDeactivationTimers[e.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(e.root,"active"),dojo.removeClass(e.root,"deactivating"),dojo.addClass(e.root,"inactive"),delete this._viewDeactivationTimers[e.id]}),this.options.transitionDelay)):(dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive")),this.app.event("ViewDeactivatedEvent").publish(e)},e.prototype.hostView=function(e){dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive"),e.hostView=this.ownerView,e.added(),this.app.event("ViewHostedEvent").publish({region:this,view:e})},e.prototype.unhostView=function(e){e.hostView=null,e.removed(),dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive"),this.app.event("ViewUnhostedEvent").publish({region:this,view:e})},e}();t.RegionAdapterBase=n})},"geocortex/framework/ui/ViewBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../FrameworkObject","./../observables","./BindingNode","./../utils/utils","./BindingExpression","./../config/ViewConfig","./../events/CollectionChangedArgs","./ViewModelBase","./../utils/ThrottledOperation","./../config/WidgetConfig"],function(t,i,n,o,r,a,s,l,d,p,u,c){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var h=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.isActive=!1,n.isManaged=!1,n.isBusy=new o.Observable(!1),n.title=new o.Observable(""),n.description=new o.Observable(""),n.iconUri=new o.Observable(""),n.markupResource=null,n.viewModel=null,n.regionName="",n.typeName="",n.root=null,n.bindingTree=null,n.parentView=null,n.hostView=null,n.childRegions=[],n.bound=!1,n.initiallyBound=!1,n.disposableBindings=[],n.bindingSetupDelegates=[],n._bindingRegex=/\{(.*?)\}/g,n.id="View-"+a.alphaNumericToken(),n.app&&n.app._internalDebugEnabled&&n.app.debugModeActive("view")&&(n.app.trace.view("Created view '"+n.id+"'"),n.app._debug.meta.createdView()),n}return e(i,t),i.prototype.addDisposableBinding=function(e,t){this.disposableBindings.push({event:e.bindingEvent,token:t})},i.prototype.attach=function(e){this.app&&this.app._internalDebugEnabled&&this.app.debugModeActive("view")&&this.app.trace.view("View.Attach called for view '{0}'.".format(this.id)),this.bound||(this.viewModel=e,this.root&&(this.bindingTree=this.buildTree(),null!==this.viewModel&&void 0!==this.viewModel&&this.pulseAll(),this.bound=!0,this.initiallyBound||(this.initiallyBound=!0,this.app.event("ViewInitializedEvent").publish(this))))},i.prototype.activated=function(){},i.prototype.deactivated=function(){},i.prototype.added=function(e){!this.bound&&this.viewModel&&(this.bindingTree=this.buildTree(),this.bound=!0,this.pulseAll(),this.initiallyBound||(this.initiallyBound=!0,this.app.event("ViewInitializedEvent").publish(this)))},i.prototype.removed=function(){this.app&&this.app._internalDebugEnabled&&this.app.debugModeActive("view")&&this.app.trace.view("View.Removed called for view '{0}'.".format(this.id)),this.destroyBindings()},i.prototype.destroy=function(){this.destroyBindings(),t.prototype.destroy.call(this)},i.prototype.destroyBindings=function(){if(this.isActive&&this.app.viewManager.deactivateView(this),this.bindingTree){this.bindingTree.destroy();for(var e=this.disposableBindings.length-1;e>=0;e--){var t=this.disposableBindings[e];t.event.unsubscribe(t.token)}this.bound=!1,this.disposableBindings=[],this.bindingSetupDelegates=[]}},i.prototype.pulseAll=function(){for(var e=0;e<this.bindingSetupDelegates.length;++e)try{this.bindingSetupDelegates[e]()}catch(e){this.app.trace.error("Error performing initial data-bind in view '{0}' with view model '{1}': {2}".format(this.id,this.viewModel.id,e.message),e)}this.bindingSetupDelegates=[]},i.prototype.resolveWidget=function(e,t,i){return null},i.prototype.buildTree=function(){var e=this;if(null!=this.root){var t=function(i,n){var o=function(t){var i=[];if(!t)return i;var n=t.match(e._bindingRegex);if(!n){if(e.app)return e.app.trace.warning("Invalid data-binding expression '{0}'.".format(t)),[];throw new Error("Invalid data-binding expression '{0}'.".format(t))}for(var o=0;o<n.length;++o){var r=n[o].split(":");2==r.length&&i.push({directive:r[0].replace("{","").trim(),target:r[1].replace("}","").trim()})}return i};if(n&&n.children)for(var a=0;a<n.children.length;++a){var d=n.children[a],p=dojo.attr(d,"data-region-name"),u=dojo.attr(d,"data-binding");if(u||(u=d.___dataBindingExpressions),u){var c=o(u);if(d.___dataBindingExpressions=u,e.app.debugMode||dojo.removeAttr(d,"data-binding"),!c||0===c.length)continue;for(var h=!1,v=0;v<c.length;++v)!function(){var t=i.expressions,n=i.context,r=!1,a=c[v],p=a.directive,u=a.target,g=new s.BindingExpression;if(g.domElement=d,g.target=u,null!=e.viewModel?g.viewModel=e.viewModel:(g.viewModel={},g.viewModel.id="[None]"),e.parentView?g.parentView=e.parentView:g.parentView=e,p.startsWith("@")){var f=p.split("-")[1];if(p.startsWith("@event-"))f?(g.type="event",g.attributeName=f):(e.app.trace.warning("Binding error: Invalid event binding expression '{0}' in view '{1}'.".format(p,e.id)),r=!0);else if(p.startsWith("@var"))g.type="var";else if(p.startsWith("@text"))g.attributeName="innerHTML",g.type="text";else if(p.startsWith("@attach"))g.attributeName="___attachedValue",g.type="attachment";else if(p.startsWith("@style-")){var w=p.indexOf("-"),m=p.substring(w+1);m?(g.type="style",g.attributeName=m):(e.app.trace.warning("Binding error: Invalid style binding expression '{0}' in view '{1}'.".format(p,e.id)),r=!0)}else if(p.startsWith("@dom"))g.type="dom",g.attributeName=f;else if(p.startsWith("@value"))g.type="value",g.attributeName=f;else if(p.startsWith("@widget"))g.type=p.substring(1),g.attributeName=f,g.otherExpressions=c;else if(p.startsWith("@class")||p.startsWith("@noclass")){g.type="class",p.startsWith("@noclass")&&(g.invert=!0);var y=p.indexOf("-"),b=p.substring(y+1);b?g.attributeName=b:(e.app.trace.warning("Binding error: Invalid class binding expression '{0}' in view '{1}'.".format(p,e.id)),r=!0)}else if("@source"===p){g.type="source",g.attributeName="@source",h=!0,g.templateMode="single-inline";for(var V=0;V<c.length;++V){var _=c[V];if(_!==a){var j=_.directive,E=_.target;if("@template"===j){g.templateMode="single-external";var M=new l.ViewConfig(null,null,null);if(M.markupResource=E,M.libraryId=e.libraryId,!(k=e.app.viewManager.createView(M))){e.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(E,e.id));break}k.app=e.app,g.templateSelections={"@default":k.root};break}if("@template-selector"===j){g.templateMode="inline-selected",g.templateKey=E,g.templateSelections={};break}}}if("single-external"!==g.templateMode){for(var B=new dojo.NodeList,x=0;x<d.children.length;++x)for(var C=d.children[x],O=dojo.attr(C,"data-binding"),R=o(O),A=0;A<R.length;++A){var T=R[A];if("@template-for"===T.directive||"@template-select"===T.directive){if("@template-for"===T.directive&&T.target===g.target){B.push(C);var k=dojo.clone(C);g.templateSelections["@default"]=k,k.___domParent=d}else if("@template-select"===T.directive){B.push(C);for(var I=!1,N=0;N<R.length;++N){var D=R[N];if("@template"===D.directive){var S=new l.ViewConfig(null,null,null);if(S.markupResource=D.target,S.libraryId=e.libraryId,!(k=e.app.viewManager.createView(S))){e.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(D.target,e.id));break}k.app=e.app;var P=dojo.clone(C);dojo.place(k.root,P,"last"),g.templateSelections[T.target]=P,I=!0;break}}I||(B.push(C),g.templateSelections[T.target]=C,C.___domParent=d)}break}}B.orphan()}}else"@source-remove"===p?(g.type="source-remove",g.attributeName=f):"@source-add"===p?(g.type="source-add",g.attributeName=f):"@visible"===p||"@hidden"===p?("@hidden"===p&&(g.invert=!0),g.type="visibility",g.attributeName="@visibility"):"@disabled"===p||"@enabled"===p?("@disabled"===p&&(g.invert=!0),g.type="disabledState",g.attributeName="@disabledState"):p.startsWith("@template")?g.type="template":p.startsWith("@halt")?h=!0:(e.app.trace.warning("Unknown binding term '{0}'.".format(p)),r=!0)}else g.type="attr",g.attributeName=p;r||e.applyBinding.apply(e,[d,g,n,i])&&t.push(g)}();var g=new r.BindingNode;g.domElement=d,g.parent=i,g.context=i.context,g.children=[],g.expressions=[],i.children.push(g),0!=h||p||t(g,d)}else p||t(i,d)}},i=new r.BindingNode;return i.domElement=null,i.parent=null,i.children=[],i.context=this.viewModel,t(i,{children:[this.root]}),i}},i.prototype.getBindingTarget=function(e){if("@context"===e.target)return e.viewModel;if(e.target.indexOf("@language-")>-1){var t=e.target.split("-").slice(1).join("-");return this.app.getResource(this.libraryId,"language-"+t)}if(1!=e.viewModel.isObservable)return e.viewModel[e.target];var i=e.viewModel.get();return null==i?i:i[e.target]},i.prototype.setBindingTargetValue=function(e,t){if("@context"!==e.target){if(!(e.target.indexOf("@language-")>-1))if(e.viewModel.isObservable){var i=e.viewModel.get();i&&(i[e.target]?i[e.target].isObservable?i[e.target].set(t):i[e.target]=t:i[e.target]=new o.Observable(t))}else e.viewModel[e.target].isObservable?e.viewModel[e.target].set(t):e.viewModel[e.target]=t}else e.viewModel&&e.viewModel.isObservable?e.viewModel.set(t):e.viewModel=t},i.prototype.resolveBindingTemplate=function(e,t){var i=null;if("single-inline"===e.templateMode||"single-external"===e.templateMode)i=dojo.clone(e.templateSelections["@default"]);else if("inline-selected"===e.templateMode){var n=null;t[e.templateKey]&&(n=t[e.templateKey]).isObservable&&(n=n.get()),!n&&e.templateSelections.hasOwnProperty("@null")?i=dojo.clone(e.templateSelections["@null"]):e.templateSelections.hasOwnProperty(n)&&(i=dojo.clone(e.templateSelections[n])),!i&&e.templateSelections.hasOwnProperty("@default")&&(i=dojo.clone(e.templateSelections["@default"]),dojo.addClass(i,"empty-div"))}return i||(i=dojo.create("div")),i},i.prototype.buildSourceBinding=function(e,t,n,o){var r=this,a=this.getBindingTarget(t);if(null===a)return!1;if(void 0===a)return this.app.trace.warning("Binding error: '{0}' in view model '{1}' was not bindable.".format(t.target,t.viewModel.id)),!1;var s=a,l=function(){if(s.useThrottling&&s.throttledOperations&&s.throttledOperations.length)for(var e=s.throttledOperations.length-1;e>=0;e--)s.throttledOperations[e].cancel(),s.throttledOperations.splice(e,1)},c=function(n){if(!0!==t.upToDate){for(var c=null,h=null,v=0;v<o.expressions.length;++v){var g=o.expressions[v];c||"source-add"!=g.type||(c=g.target),h||"source-remove"!=g.type||(h=g.target)}var f=r;t.parentView&&(f=t.parentView);var w=f[c],m=f[h];if(void 0!==n&&null!==n){if(n instanceof d.CollectionChangedArgs){if(null===n||"clear"===n.type){if(l(),m)for(b=n.rangeStart;b<=n.rangeEnd;++b)m.apply(r,[t,s.getAt(b),n,b]);for(b=t.boundViews.length-1;b>=0;b--)r.app.viewManager.destroyView(t.boundViews[b]);if(t.boundViews=[],!m&&null!=t.domElement&&null!=t.domElement.children){for(var y=new dojo.NodeList,b=0;b<t.domElement.children.length;++b)t.domElement.children[b].___collectionTemplate||y.push(t.domElement.children[b]);y.orphan()}}else if("replace"===n.type){if(l(),m)for(b=n.rangeStart;b<n.rangeEnd+1;++b)m.apply(r,[t,s.getAt(b),n,b]);for(b=t.boundViews.length-1;b>=0;b--)r.app.viewManager.destroyView(t.boundViews[b]);t.boundViews=[],m||dojo.empty(t.domElement),n.type="append",n.rangeStart=0,n.rangeEnd=s.value.length-1}}else{var V=n.isObservable?n.get():n;for(m&&m.apply(r,[t,V,n,0]),b=t.boundViews.length-1;b>=0;b--)r.app.viewManager.destroyView(t.boundViews[b]);if(t.boundViews=[],!m){var _=t.___singleSourceItem;_&&((y=new dojo.NodeList).push(_),y.orphan(),t.___singleSourceItem=null)}if(V&&t.domElement)if(w)w.apply(r,[t,V,n,0]);else{var j=r.resolveBindingTemplate(t,V);dojo.place(j,t.domElement,"last");var E=new i(r.app);E.parentView=t.parentView,E.app=E.parentView.app,E.libraryId=r.libraryId;var M={children:[]};M.children.push(j);var B=V;B||((B=new p.ViewModelBase(r.app,r.libraryId)).app=r.app,B.libraryId=r.libraryId),B.___boundViews,B.hasOwnProperty("___boundViews"),E.root=M,E.attach(B),E.root=j,t.___singleSourceItem=E.root,t.boundViews.push(E)}}if("append"===n.type||"insert"===n.type){var x=null;"insert"===n.type&&t.domElement.children.length>n.rangeStart&&(x=t.domElement.children[n.rangeStart]);var C=function(o,a,l){if(o>a)return!1;if(!t||null==t.domElement)return!1;for(var d=l||s,u=o;u<=a;++u){var c=null;if(null!=w)w.apply(r,[t,d.isObservable?d.getAt(u):d[u],n,u]);else{var h=d.isObservable?d.getAt(u):d[u];if(c=r.resolveBindingTemplate(t,h),x&&"insert"===n.type)dojo.place(c,x,"before");else if(x&&"append"===n.type)dojo.place(c,x,"after");else{if(!t||null==t.domElement)return!1;dojo.place(c,t.domElement,"last")}var v=new i(r.app,r.libraryId);v.parentView=t.parentView,v.app=v.parentView.app,v.libraryId=r.libraryId,v.id+="-item"+u;var g={children:[]};g.children.push(c),null!==h&&void 0!==h||((h=new p.ViewModelBase(r.app,r.libraryId)).app=r.app,h.libraryId=r.libraryId),h.___boundViews,h.hasOwnProperty("___boundViews"),v.root=g,v.attach(h),v.root=c,t.boundViews.push(v)}}return e.___populateInitialValueFunc&&(e.___populateInitialValueFunc(),delete e.___populateInitialValueFunc),!0};if(s.useThrottling){s.throttledOperations=s.throttledOperations&&s.throttledOperations.constructor===Array?s.throttledOperations:[];var O=void 0==s.throttleDelay?0:s.throttleDelay,R=n.rangeStart,A=Math.min(R+10-1,n.rangeEnd),T=s.get().slice(0),k=function(){var e=s.throttledOperations.indexOf(I);e>-1&&s.throttledOperations.splice(e,1)},I=new u.ThrottledOperation(O,function(){var e=C(R,A,T);return A>=n.rangeEnd?(k(),!1):(R+=10,A+=10,A=Math.min(A,n.rangeEnd),e||k(),e)});s.throttledOperations.push(I)}else C(n.rangeStart,n.rangeEnd)}else if("remove"===n.type){l();for(var N=n.rangeStart;N<=n.rangeEnd;++N)for(var D=t.boundViews.length-1;D>=0;D--){var S=t.boundViews[D];null!==S.viewModel&&void 0!==S.viewModel&&S.viewModel==a.getAt(N)&&(m?m.apply(r,[t,n[N],n,N]):r.app.viewManager.destroyView(S),Array.removeItem(t.boundViews,S))}}}}else t.upToDate=!1};if(s.bind&&t.targetBindings.push({event:s.bindingEvent,token:s.bind(this,c)}),s.isObservableCollection){var h=s.getLength()-1;this.bindingSetupDelegates.push(function(){var e=new d.CollectionChangedArgs;e.type="append",e.rangeStart=0,e.rangeEnd=h,e.sender=s,c.apply(r,[e]),s.isObservable&&s.bindingEvent.isPublishing&&(t.upToDate=!0)})}else this.bindingSetupDelegates.push(function(){c.apply(r,[a]),s.isObservable&&s.bindingEvent.isPublishing&&(t.upToDate=!0)})},i.prototype.buildEventBinding=function(e,t,i){var n=this;if(!this[t.target]&&t.parentView&&t.parentView[t.target]&&(n=t.parentView),!n[t.target])return this.app.trace.warning("Binding error: Event handler '{0}' was not found in view '{1}' or its parent view.".format(t.target,n.id)),!1;e!=t.domElement&&this.app.trace.warning("Binding error: buildEventBinding passed in el that doesn't match binding.domElement."),t.on(t.attributeName,function(o){var r;return t.target&&"function"==typeof n[t.target]&&(r=n[t.target](o,e,i)),r||(o.preventDefault(),o.stopPropagation(),!1)})},i.prototype.buildVarBinding=function(e,t,i){var n=this;t.parentView&&(n=t.parentView);var o=n[t.target];o?o&&o instanceof Array?o.push(e):o&&o.isObservableCollection?o.addItem(e):n[t.target]=e:n[t.target]=e},i.prototype.buildTextBinding=function(e,t,i){var n=this,o=this.getBindingTarget(t);if(null===o)return!1;if(void 0===o)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var r=function(){if(null==o||o.isObservable){var i=o.get();i=null===i||void 0===i?"":i.toString(),"innerHTML"===t.attributeName?(dojo.empty(e),e.appendChild(dojo.doc.createTextNode(i))):dojo.attr(e,t.attributeName,String.escapeHtml(i))}else"innerHTML"===t.attributeName?(dojo.empty(e),e.appendChild(document.createTextNode(o))):dojo.attr(e,t.attributeName,String.escapeHtml(o))};o.isObservable&&t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,r)}),this.bindingSetupDelegates.push(function(){r.apply(n,[null])})},i.prototype.buildAttributeBinding=function(e,t,i,n){var o=this,r=this.getBindingTarget(t);if(void 0===r)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var a=function(){if(null===r)return dojo.attr(e,t.attributeName,""),!1;if(r.isObservable){var i=r.get();null!==i&&void 0!==i||(i=""),!0===n?e[t.attributeName]=i:dojo.attr(e,t.attributeName,i)}else null!==r&&void 0!==r||(r=""),!0===n?e[t.attributeName]=r:dojo.attr(e,t.attributeName,r)};null!==r&&r.isObservable&&t.targetBindings.push({event:r.bindingEvent,token:r.bind(this,a)}),this.bindingSetupDelegates.push(function(){a.apply(o,[null])})},i.prototype.buildStyleBinding=function(e,t,i){var n=this,o=this.getBindingTarget(t);if(null===o)return!1;var r=function(e,t){return isNaN(t)||""===t?t:t+"px"};if(void 0===o)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;if(null==o||o.isObservable){if(null!=o){var a=function(){var i=r(t.attributeName,o.get());dojo.style(e,t.attributeName,i)};o.isObservable&&t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,a)}),this.bindingSetupDelegates.push(function(){a.apply(n,[null])})}}else{var s=r(t.attributeName,o);dojo.style(e,t.attributeName,s)}},i.prototype.buildDomBinding=function(e,t,i){var n=this,o=this;t.parentView&&(o=t.parentView);var r=o[t.target];if(null==r)return!1;if(void 0===r)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;try{if(r.isObservable){if(t.targetBindings.push({event:r.bindingEvent,token:r.bind(this,function(e){if(!r.get())return!1;t.domElement=dojo.place(r.get(),t.domElement,"replace"),n.app&&n.app.viewManager.notifyDimensionsChanged(n)})}),!r.get())return!1;dojo.place(r.get(),t.domElement,"replace")}else{if(!r)return!1;dojo.place(r,t.domElement,"replace")}}catch(e){this.app.trace.warning("Binding error: An error occurred in view '{0}' while attempting to perform a DOM binding in view model '{1}'.".format(this.id,t.viewModel.id))}},i.prototype._createWidgetViewFromConfig=function(e,t){var i=e.type,n=e.id?"WidgetView-{0}-{1}".format(e.id,a.alphaNumericToken()):"{0}-{1}".format(a.alphaNumericToken(),a.alphaNumericToken()),o=new l.ViewConfig(n,null,i||"geocortex.framework.ui.ViewBase");o.isVisible=!0,o.libraryId=e.libraryId,e.markup&&(o.markupResource=e.markup);var r=null;if((e=this.app.translateConfiguration(e.libraryId,e)).viewModelId){if(!(r=this.app.getFrameworkObjectById(e.viewModelId)))throw new Error("Could not bind widget '{0}' to view model with ID '{1}': View model not found.".format(e.Id,e.viewModelId))}else e.viewModelType?(r=this.app.instantiateFrameworkObject(e.viewModelType,e.libraryId),e.id||(e.id=a.alphaNumericToken()),r.id="WidgetViewModel-{0}-{1}".format(e.id,a.alphaNumericToken())):r=t;var s=this.app.viewManager.createView(o);if(!s)throw new Error("Could not create widget '{0}': The widget's view could not be created.".format(e.Id));s.configuration=e.configuration;var d={children:[]};return d.children.push(s.root),s.root=d,s.attach(r),s.root=d.children[0],s},i.prototype.buildWidgetBinding=function(e,t,n){var o=this,r=t.target,a=this.viewModel,s=!0,l=!1,d=null,p=null;if(t.otherExpressions)for(g=0;g<t.otherExpressions.length;++g){var u=t.otherExpressions[g];if("@widget-context"===u.directive){if(t.target=u.target,!(a=this.getBindingTarget(t)))return this.app.trace.error("Error binding widget '{0}' to target '{1}': Target was not found in view model.".format(r,u.target)),!1;d=a}else"@widget-required"===u.directive?s=!("false"===u.target.toLowerCase()):"@widget-replace"===u.directive&&(l="true"===u.target.toLowerCase())}p=a&&a.isObservable;for(var h=this.app.configModel.widgetConfigs,v=null,g=0;g<h.length;++g){var f=h[g];if(f.id===r){v=f;break}}var w=!v,m=function(){var e=d||null;e&&e.isObservable&&(e=e.get());var i=(t.parentView||o).resolveWidget(r,e,t);if(!i){if(s)throw new Error("Widget '{0}' was not found.".format(r));return!1}return i},y=function(e,n){if(t.domElement){var a=null;if(t.boundViews.length>0){for(var s=t.boundViews.length-1;s>=0;s--){var d=t.boundViews[s];o.app.viewManager.destroyView(d)}t.boundViews=[]}dojo.empty(t.domElement);var p=null;if(e){if("string"==typeof e){var u=dojo.create("div");dojo.attr(u,"innerHTML",e),dojo.addClass(u,"empty-div"),a=u.children&&1===u.children.length?u.children[0]:u}else if(e.hasOwnProperty("nodeType")&&[1,2,3,8,9].contains(v.nodeType))a=e;else if(e instanceof i)p=e,t.boundViews.push(p),a=e.root;else{if(!(e instanceof c.WidgetConfig))return void o.app.trace.warning("Could not resolve widget '{0}': Object of unknown type provided.".format(r));p=o._createWidgetViewFromConfig(e,n),t.boundViews.push(p),a=p.root}dojo.place(a,t.domElement,l?"replace":"last"),p&&(p.added(o),p.activated())}}};this.libraryId,v&&v.libraryId&&v.libraryId,p&&t.targetBindings.push({event:a.bindingEvent,token:a.bind(this,function(e){if(w){var t=m();y(t,e)}else y(v,e)})}),this.bindingSetupDelegates.push(function(){var e=null;if(a&&(e=a.isObservable?a.get():a),w){var t=m();y(t,e)}else y(v,e)})},i.prototype.buildClassBinding=function(e,t,i){var n=this,o=this.getBindingTarget(t);if(null===o)return!1;if(void 0===o)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var r=function(i){var o=n.isTruthy(i);!0===t.invert&&(o=!o);var r=t.attributeName;!0===o?(dojo.removeClass(e,r),dojo.addClass(e,r)):dojo.removeClass(e,r)};o.isObservable&&t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,r)}),this.bindingSetupDelegates.push(function(){r.apply(n,[o])})},i.prototype.isTruthy=function(e){if(!e)return!1;if(!(e instanceof d.CollectionChangedArgs))return e.isObservableCollection?e.getLength()>0:e.isObservable?!!e.get():!!e||"string"==typeof e&&e.length>0;var t=e;if("append"===t.type){if(t.rangeEnd+1-t.rangeStart>0||t.sender.value&&t.sender.value.length>0)return!0}else{if("clear"===t.type)return!1;if("insert"===t.type){if(t.rangeEnd+1-t.rangeStart>0)return!0}else if("remove"===e.type&&t.rangeEnd+1-t.rangeStart<t.sender.value.length)return!0}},i.prototype.buildVisibilityBinding=function(e,t,i){var n=this,o=this.getBindingTarget(t);if(null===o)return!1;if(void 0===o)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;t.initialVisibility=dojo.style(e,"display")||"block";var r=function(i){var o=n.isTruthy(i);1==t.invert&&(o=!o);var r="";r="inline"===t.initialVisibility?"bound-visible-inline":"bound-visible",1==o?(dojo.removeClass(e,"bound-invisible"),dojo.addClass(e,r)):(dojo.removeClass(e,r),dojo.addClass(e,"bound-invisible"))};o.isObservable&&t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,r)}),this.bindingSetupDelegates.push(function(){r.apply(n,[o])})},i.prototype.buildDisabledBinding=function(e,t,i){var n=this,o=this.getBindingTarget(t);if(void 0===o)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;t.initialDisabled=dojo.attr(e,"disabled");var r=function(i){var n=!1;i?o&&(i instanceof d.CollectionChangedArgs?"append"==i.type?(i.rangeEnd+1-i.rangeStart>0||o.value&&o.value.length>0)&&(n=!1):"clear"==i.type?n=!0:"insert"==i.type?i.rangeEnd+1-i.rangeStart>0&&(n=!1):"remove"==i.type&&i.rangeEnd+1-i.rangeStart<o.value.length&&(n=!1):n=o.isObservableCollection?!(o.getLength()>0):o.isObservable?!o.get():"string"==typeof i&&0==i.length):n=!0,1==t.invert&&(n=!n),1==n?(dojo.attr(e,"disabled",!0),dojo.attr(e,"tabindex",-1),dojo.addClass(e,"bound-disabled")):(dojo.removeAttr(e,"disabled"),dojo.removeAttr(e,"tabindex"),dojo.removeClass(e,"bound-disabled"))};o.isObservable&&t.targetBindings.push({event:o.bindingEvent,token:o.bind(this,r)}),this.bindingSetupDelegates.push(function(){r.apply(n,[o])})},i.prototype.buildValueBinding=function(e,t,i){var n=this,o=this.getBindingTarget(t);if(void 0===o)return this.app.trace.view("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;if(null==o)return!1;var r=o.isObservable||!1,s=o.isObservableCollection||!1,l=e.tagName.toLowerCase(),p=dojo.attr(e,"type")||e.type?e.type:null;if(r){var u=function(t){t!==dojo.attr(e,"value")&&(null!==t&&void 0!==t||(t=""),dojo.attr(e,"value",t))},c=function(t){e.checked=!0===t},h=function(t){var i=dojo.attr(e,"value");dojo.query("input[type=radio]",n.root).forEach(function(t){t.name,e.name}),e.checked=!0===t||i==t},v=function(t){if(t instanceof Date){var i=new Date(t.getTime());i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),e.valueAsDate=i}else e.value=t},g=function(e){var i=e;if(t.domElement){var n=function(e,t){if(void 0!==e.___attachedValue){var n=e.___attachedValue;return n===(void 0===t?i:t)||("number"==typeof n||"boolean"==typeof n?n=n.toString():n&&n.hasOwnProperty("value")&&("number"!=typeof(n=n.value)&&"boolean"!=typeof n||(n=n.toString())),n===(void 0===t?i:t))}var o=void 0===t?i:t;return e.value===o};if(i instanceof d.CollectionChangedArgs){for(var o=i,r=o.sender,a=[],s=o.rangeStart;s<=o.rangeEnd;s++){var l=r.getAt(s);a.push(l.value?l.value+"":l)}if("append"===o.type||"insert"===o.type)for(h=0;h<t.domElement.options.length;++h)for(var p=t.domElement.options[h],u=0;u<a.length;u++)n(p,a[u])?p.selected=!0:dojo.attr(t.domElement,"multiple")||(p.selected=!1)}else if("number"!=typeof i&&"boolean"!=typeof i||(i=i.toString()),null===i||void 0===i)for(h=0;h<t.domElement.options.length;++h)(p=t.domElement.options[h]).selected=!1;else if(dojo.isArray(i)){if(t.viewModel[t.target].isObservableCollection){for(var c=!1,h=0;h<t.domElement.options.length;++h)if((p=t.domElement.options[h]).selected=!1,dojo.attr(t.domElement,"multiple")||!c)for(var v=0;v<i.length;++v){var g=i[v];if(n(p,g)){p.selected=!0,c=!0;break}}}else for(h=0;h<t.domElement.options.length;++h)if(n(p=t.domElement.options[h],g)){p.selected=!0;break}}else for(h=0;h<t.domElement.options.length;++h)if(n(p=t.domElement.options[h],g)){p.selected=!0;break}}};"select"===l?(t.targetBindings.push({event:o.bindingEvent,token:o.bind(t,g)}),this.bindingSetupDelegates.push(function(){g.apply(n,[o.get()])})):"radio"===p?(t.targetBindings.push({event:o.bindingEvent,token:o.bind(t,h)}),this.bindingSetupDelegates.push(function(){h.apply(n,[o.get()])})):"checkbox"===p?(t.targetBindings.push({event:o.bindingEvent,token:o.bind(t,c)}),this.bindingSetupDelegates.push(function(){c.apply(n,[o.get()])})):"date"===p?(t.targetBindings.push({event:o.bindingEvent,token:o.bind(t,v)}),this.bindingSetupDelegates.push(function(){v.apply(n,[o.get()])})):(t.targetBindings.push({event:o.bindingEvent,token:o.bind(t,u)}),this.bindingSetupDelegates.push(function(){u.apply(n,[o.get()])}))}"textarea"===l||"input"===l&&"text"===p?function(){var e=null,i=function(i){var a=dojo.attr(i.currentTarget,"value");if(a!==e)return e=a,r?o.set(a):n.setBindingTargetValue(t,a),!0};t.on("change",i),t.on("keyup",i),t.on("mouseup",i),t.on("input",i)}():"input"===l&&"checkbox"===p?t.on("change",function(e){var i=dojo.attr(e.currentTarget,"checked");return r?o.set(i):n.setBindingTargetValue(t,i),!0}):"input"===l&&"radio"===p?t.on("click",function(e){return dojo.attr(e.currentTarget,"checked")&&(r?o.set(e.currentTarget.value):n.setBindingTargetValue(t,e.currentTarget.value)),!0}):"input"===l&&"date"===p?t.on("change",function(e){var i=r?o.get():o,a=e.currentTarget.valueAsDate;return a.setMinutes(a.getMinutes()+a.getTimezoneOffset()),i instanceof Date&&!isNaN(i.getTime())&&(a.setHours(i.getHours()),a.setMinutes(i.getMinutes()),a.setSeconds(i.getSeconds()),a.setMilliseconds(i.getMilliseconds())),r?o.set(a):n.setBindingTargetValue(t,a),!0}):"select"===l?(e.___populateInitialValueFunc=function(){g(o.isObservable?o.get():o)},t.on("change",function(){for(var i=dojo.query("option",e),l=[],d=0;d<i.length;++d){var p=i[d];!0===p.selected&&(u=p.___attachedValue,a.isNullOrUndefined(u)?l.push(p.value):l.push(u))}if(0===l.length&&i.length>0&&!e.multiple&&!0===n.app.___uaIsiPad){e.selectedIndex=0;var u=i[0].___attachedValue;l.push(a.isNullOrUndefined(u)?i[0].value:u)}return l.length>0?s?(o.clear(),o.addItems(l)):r?o.set(l[0]):n.setBindingTargetValue(t,l):o.clear(),!0})):t.on("change",function(e){if(void 0!==e.currentTarget){var i=dojo.attr(e.currentTarget,"value");return r?o.set(i):n.setBindingTargetValue(t,i),!0}n.app&&n.app.trace.error("Binding error: bound to change event where currentTarget is undefined")})},i.prototype.applyBinding=function(e,t,i,n){return"source"===t.type?this.buildSourceBinding(e,t,i,n):"event"===t.type?this.buildEventBinding(e,t,i):"text"===t.type?this.buildTextBinding(e,t,i):"var"===t.type?this.buildVarBinding(e,t,i):"class"===t.type?this.buildClassBinding(e,t,i):"style"===t.type?this.buildStyleBinding(e,t,i):"dom"===t.type?this.buildDomBinding(e,t,i):"value"===t.type?this.buildValueBinding(e,t,i):"attr"===t.type?this.buildAttributeBinding(e,t,i):"attachment"===t.type?this.buildAttributeBinding(e,t,i,!0):"visibility"===t.type?this.buildVisibilityBinding(e,t,i):"disabledState"===t.type?this.buildDisabledBinding(e,t,i):"widget"===t.type&&this.buildWidgetBinding(e,t,i),!0},i}(n.FrameworkObject);i.ViewBase=h})},"geocortex/framework/ui/ViewManager":function(){define(["require","exports","./../utils/ArrayUtils","./../config/ViewConfig","./../utils/utils","./../resourceManager","./../events/ViewDimensionsChangedArgs"],function(e,t,i,n,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){};t.ViewManagerRegionEntry=s;var l=function(){function e(e){this._views=[],this._hostedRegions=[],this._pendingRegions=[],this.app=e,this._registerCommands()}return e.prototype.shutdown=function(){for(e=this._hostedRegions.length-1;e>=0;e--)this.destroyRegion(this._hostedRegions[e]);for(this._hostedRegions.length=0,i=this._views.length-1;i>=0;i--)this.destroyView(this._views[i]);this._views.length=0;for(var e=this._pendingRegions.length-1;e>=0;e--){for(var t=this._pendingRegions[e],i=t.views.length-1;i>=0;i--)this.destroyView(t.views[i]);t.views=[]}this._pendingRegions.length=0},e.prototype._registerCommands=function(){var e=this;this.app.commandRegistry.command("ActivateView").register(this,function(t){var i=e.getViewById(t);i?e.activateView(i):e.app.isShuttingDown||e.app.awaitModuleForView(t).then(function(i){i?e.app.commandRegistry.command("ActivateView").execute(t):e.app.trace.warning("ActivateView: Could not find view '{0}'.".format(t))})}),this.app.commandRegistry.command("DeactivateView").register(this,function(t){var i=e.getViewById(t);i?e.deactivateView(i):e.app.trace.warning("DeactivateView: Could not find view '{0}'.".format(t))}),this.app.commandRegistry.command("ToggleView").register(this,function(t){var i=e.getViewById(t);i?e.toggleView(i):e.app.isShuttingDown||e.app.awaitModuleForView(t).then(function(i){i?e.app.commandRegistry.command("ActivateView").execute(t):e.app.trace.warning("ToggleView: Could not find view '{0}'.".format(t))})}),this.app.commandRegistry.command("DestroyView").register(this,function(t){var i=e.getViewById(t);i?e.destroyView(i):e.app.trace.warning("DestroyView: Could not find view '{0}'.".format(t))})},e.prototype.activateView=function(e){if(!e.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to activateView."),!1;var t=this.getRegionForViewId(e.id);if(!t){if(!e.regionName)return this.app.trace.warning("Could not activate view '{0}' - view is not associated with a region.".format(e.id)),!1;if(t=this.getExistingRegionByName(e.regionName))return t.hostView(e),t.activateView(e),!0;var n=this._getPendingRegionEntryByName(e.regionName);if(n)return i.contains(n.views,e)?(this.app.trace.view("View '{0}' re-added to pending region '{1}'.".format(e.id,e.regionName)),!1):(n.views.push(e),!1);var o=new s;return o.name=e.regionName,o.views=[e],this._pendingRegions.push(o),!1}return t.activateView(e),!0},e.prototype.deactivateView=function(e){if(!e.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to deactivateView."),!1;var t=this.getRegionForViewId(e.id);return t?(t.deactivateView(e),!0):(this.app.trace.view("Could not find region for view '{0}'.".format(e.id)),!1)},e.prototype.toggleView=function(e){e.isActive?this.deactivateView(e):this.activateView(e)},e.prototype.createView=function(e,t){var n=e.viewId||e.id;if(!n||!this.getViewById(n)){var a=e.typeName||e.type||"geocortex.framework.ui.ViewBase";if(!(t=t||null))try{t=this.app.instantiateFrameworkObject(a,e.libraryId)}catch(e){return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(a),e),null}if(null==t)return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(a)),null;var l=e.isVisible||e.visible;if(t.id=null==n?"View-"+o.alphaNumericToken():n,t.markupResource=e.markupResource||e.markup,t.regionName=e.regionName||e.region,t.configuration=e.configuration||{},t.isManaged=e.isManaged||!1,t.title.set(e.title||""),t.description.set(e.description),t.iconUri.set(e.iconUri),e.viewModel&&(t.viewModel=e.viewModel),this._views.push(t),this.app._internalDebugEnabled&&this.app.debugModeActive("view")&&this.app._debug.meta.createdManagedView(),t.regionName){var d=this.getExistingRegionByName(t.regionName);if(d)return d.hostView(t),l&&d.activateView(t),t;l&&(t.___shouldActivate=!0);var p=this._getPendingRegionEntryByName(t.regionName);if(p){if(i.contains(p.views,t))return this.app.trace.view("View '{0}' re-added to pending region '{1}'.".format(t.id,t.regionName)),t;p.views.push(t)}else{var u=new s;u.name=t.regionName,u.views=[t],this._pendingRegions.push(u)}return t}var c=r.resourceManager.fetch(t.markupResource,t.libraryId||"inv");return null==c?(this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),null):(t.root=dojo.create("div"),t.root.innerHTML=c,t.root.children&&1===t.root.children.length&&(t.root=t.root.children[0]),t)}this.app.trace.error("Could not create view '{0}' - a view with that ID already exists.".format(n))},e.prototype.create=function(e,t,i,o,r){var a=new n.ViewConfig(null,null,e);a.markupResource=i,a.regionName=o,a.configuration={};var s=this.createView(a);if(null===s)return s;var l=null;try{(l=this.app.instantiateFrameworkObject(t||"geocortex.framework.ui.ViewModelBase",r)).initialize({})}catch(e){return this.app.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(a.typeName,e.message),e),null}return s.attach(l),this.activateView(s),s},e.prototype.destroyView=function(e){if(e&&e.id){this.app.trace.view("destroy view: "+e.id);for(var t=this.getRegionForViewId(e.id),n=window.document.activeElement;n;){if(e.root===n){window.document.activeElement.blur();break}n=n.parentElement}if(null!=t&&(t.deactivateView(e),t.unhostView(e)),e.destroy(),this.app._internalDebugEnabled&&this.app.debugModeActive("view")&&(-1===this._views.indexOf(e)?this.app._debug.meta.destroyedView():this.app._debug.meta.destroyedManagedView()),null!=e.childRegions)for(var o=e.childRegions.length-1;o>=0;o--)this.destroyRegion(e.childRegions[o]);if(e.childRegions.length=0,null!=e.root){var r=new dojo.NodeList;r.push(e.root),r.orphan()}i.removeItem(this._views,e),e.onDestroy()}else this.app.trace.error("ViewManager: Invalid or nonexistent view passed to destroyView.")},e.prototype.destroyRegion=function(e){if(e){if(this.app.trace.view("destroy region: "+e.name),null!=e.views)for(var t=e.views.length-1;t>=0;t--)this.destroyView(e.views[t]);i.removeItem(this._hostedRegions,e),e.unhost()}else this.app.trace.error("ViewManager: Invalid or nonexistent region passed to destroyRegion.")},e.prototype.discoverRegions=function(e,t){var i=this;null!=e&&dojo.query("[data-region-name]",e).forEach(function(e){var n=dojo.attr(e,"data-region-name"),o=i.getExistingRegionByName(n);if(o)o.domElement!==e&&i.app.trace.error("Region '{0}' already exists.".format(n));else{var r=i._getPendingRegionEntryByName(n),a=null;r&&i._removePendingRegionEntry(n);var s=dojo.attr(e,"data-region-adapter"),l=null;try{s||(s="geocortex.framework.ui.DivRegionAdapter"),l=dojo.getObject(s,!0),a=new l(n,i.app)}catch(e){return i.app.trace.error("Could not instantiate region with type '{0}' - type was not found.".format(s),e),null}var d=dojo.attr(e,"data-region-options"),p={};if(d)for(var u=d.split(","),c=0;c<u.length;c++){var h=u[c].split("=");p[h[0]]=h.length>1?h[1]:""}if(a.host(e,p),i._hostedRegions.push(a),null!=t&&(t.childRegions.push(a),a.ownerView=t),r)for(var v=0,g=r.views;v<g.length;v++){var f=g[v];i._views.push(f),i.app._internalDebugEnabled&&i.app.debugModeActive("view")&&i.app._debug.meta.createdManagedView(),a.hostView(f),f.___shouldActivate&&(delete f.___shouldActivate,a.activateView(f))}i.app.waitUntilAllLibrariesLoaded().then(function(){i.app.loadModulesForRegion(a.name)})}})},e.prototype.getExistingRegionByName=function(e){for(var t=0,i=this._hostedRegions;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},e.prototype._getPendingRegionEntryByName=function(e){for(var t=0,i=this._pendingRegions;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},e.prototype._removePendingRegionEntry=function(e){for(var t=-1,n=0;n<this._pendingRegions.length;++n)if(this._pendingRegions[n].name===e){t=n;break}return t>-1&&(i.remove(this._pendingRegions,t,t),!0)},e.prototype.getRegionForViewId=function(e){for(var t=0,i=this._hostedRegions;t<i.length;t++)for(var n=i[t],o=0,r=n.views;o<r.length;o++)if(r[o].id===e)return n;return null},e.prototype.getViewById=function(e){for(var t=0,i=this._views;t<i.length;t++){var n=i[t];if(n.id&&n.id===e)return n}},e.prototype.getViews=function(){return this._views},e.prototype.notifyDimensionsChanged=function(e){var t=this.getRegionForViewId(e.id),i=new a.ViewDimensionsChangedArgs(e,t);this.app.eventRegistry.event("ViewDimensionsChangedEvent").publish(i)},e}();t.ViewManager=l})},"geocortex/framework/ui/ViewModelBase":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();define(["require","exports","./../FrameworkObject"],function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(t){function i(e,i){return t.call(this,e,i)||this}return e(i,t),i.prototype.initialize=function(e){},i.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},i}(n.FrameworkObject);i.ViewModelBase=o})}}});require({cache:{"geocortex/framework/utils/ArrayUtils":function(){define(["require","exports","./Tuple"],function(t,e,r){"use strict";function n(t,e,r){var n=t.slice((r||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,n)}function i(t,e){var r=u(t,e);return-1==r?null:n(t,r,r)}function o(t,e){for(var r=t.length;r--;)if(t[r]===e)return!0;return!1}function u(t,e){for(var r=t.length;r--;)if(t[r]===e)return r;return-1}var a=this;Object.defineProperty(e,"__esModule",{value:!0});var c=function(t,e){return t===e?0:t>e?1:-1};e.firstOrDefault=function(t,e){var r=t?t.length:0;if((null===e||void 0===e)&&r>0)return t[0];for(var n=0;n<r;n++){var i=t[n];if(e(i,n))return i}return null},e.lastOrDefault=function(t,e){var r=t?t.length:0;if((null===e||void 0===e)&&r>0)return t[r-1];for(var n=r-1;n>=0;n--){var i=t[n];if(e(i,n))return i}return null},e.orderBy=function(t,e){return t?t.slice().sort(function(t,n){var i=e(t),o=e(n);return i instanceof r.Tuple?r.Tuple.compare(i,o):c(i,o)}):[]},e.orderByDescending=function(t,e){return t?t.slice().sort(function(t,n){var i=e(t),o=e(n);return i instanceof r.Tuple?r.Tuple.compare(o,i):c(o,i)}):[]},e.groupBy=function(t,e){var r={},n=[];if(t&&e){for(var i=0;i<t.length;i++){var o=t[i],u=e(o),a=JSON.stringify(u);r.hasOwnProperty(a)?r[a].items.push(o):r[a]={key:u,items:[o]}}for(var c in r)r.hasOwnProperty(c)&&n.push(r[c])}return n},e.distinct=function(t){return t?t.filter(function(t,e,r){return null!=t&&r.indexOf(t)===e}):[]},e.difference=function(t,e){return t?e?t.filter(function(t){return e.indexOf(t)<0}):t.slice(0):[]},e.remove=n,e.removeItem=i,e.contains=o,e.pos=u,e.returnTop=function(t,e){var r=[];for(var n in t)t.hasOwnProperty(n)&&r.push([n,t[n]]);return r.sort(function(t,e){return t=t[1],e=e[1],t>e?-1:t<e?1:0}),r.slice(0,e)},e.flatten=function(t){return t?[].concat.apply([],t):t},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=+(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var i=n>=0?n:Math.max(r-Math.abs(n),0);i<r;i++)if(i in e&&e[i]===t)return i;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if(0===r)return-1;var n=r;arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=+(n>0||-1)*Math.floor(Math.abs(n))));for(var i=n>=0?Math.min(n,r-1):r-Math.abs(n);i>=0;i--)if(i in e&&e[i]===t)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var r,n;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),o=i.length>>>0;if("[object Function]"!=={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(r=e),n=0;n<o;){var u;Object.prototype.hasOwnProperty.call(i,n)&&(u=i[n],t.call(r,u,n,i)),n++}}),Array.prototype.every||(Array.prototype.every=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],i=0;i<r;i++)if(i in e&&!t.call(n,e[i],i,e))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],i=0;i<r;i++)if(i in e&&t.call(n,e[i],i,e))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=[],i=arguments[1],o=0;o<r;o++)if(o in e){var u=e[o];t.call(i,u,o,e)&&n.push(u)}return n}),Array.prototype.map||(Array.prototype.map=function(t,e){var r,n,i;if(null==a)throw new TypeError(" this is null or not defined");var o=Object(a),u=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(e&&(r=e),n=new Array(u),i=0;i<u;){var c,s;i in o&&(c=o[i],s=t.call(r,c,i,o),n[i]=s),i++}return n}),Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,r=Object(this),n=r.length>>>0,i=arguments[1],o=0;o<n;o++)if(e=r[o],t.call(i,e,o,r))return e}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,r=Object(this),n=r.length>>>0,i=arguments[1],o=0;o<n;o++)if(e=r[o],t.call(i,e,o,r))return o;return-1}),Array.remove=n,Array.removeItem=i,Array.contains=o,Array.pos=u})},"geocortex/framework/utils/DateFormatters":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DateFormatters={d:function(t){return t.getDate()+""},dd:function(t){return r(t.getDate(),2)},f:function(t){return n(t.getMilliseconds()/1e3,1,!1)},ff:function(t){return n(t.getMilliseconds()/1e3,2,!1)},fff:function(t){return n(t.getMilliseconds()/1e3,3,!1)},ffff:function(t){return n(t.getMilliseconds()/1e3,4,!1)},fffff:function(t){return n(t.getMilliseconds()/1e3,5,!1)},ffffff:function(t){return n(t.getMilliseconds()/1e3,6,!1)},fffffff:function(t){return n(t.getMilliseconds()/1e3,7,!1)},F:function(t){return n(t.getMilliseconds()/1e3,1,!0)},FF:function(t){return n(t.getMilliseconds()/1e3,2,!0)},FFF:function(t){return n(t.getMilliseconds()/1e3,3,!0)},FFFF:function(t){return n(t.getMilliseconds()/1e3,4,!0)},FFFFF:function(t){return n(t.getMilliseconds()/1e3,5,!0)},FFFFFF:function(t){return n(t.getMilliseconds()/1e3,6,!0)},FFFFFFF:function(t){return n(t.getMilliseconds()/1e3,7,!0)},h:function(t){var e=t.getHours();return e>12&&(e-=12),r(e,1)},hh:function(t){var e=t.getHours();return e>12&&(e-=12),r(e,2)},H:function(t){return r(t.getHours(),1)},HH:function(t){return r(t.getHours(),2)},m:function(t){return r(t.getMinutes(),1)},mm:function(t){return r(t.getMinutes(),2)},M:function(t){return r(t.getMonth()+1,1)},MM:function(t){return r(t.getMonth()+1,2)},s:function(t){return r(t.getSeconds(),1)},ss:function(t){return r(t.getSeconds(),2)},y:function(t){return r(t.getFullYear(),1)},yy:function(t){return r(t.getFullYear(),2)},yyy:function(t){return r(t.getFullYear(),3)},yyyy:function(t){return r(t.getFullYear(),4)},yyyyy:function(t){return r(t.getFullYear(),5)}};var r=function(t,e){for(var r=e-(t+="").length,n=[];n.length<r;)n.push("0");return n.join("")+t},n=function(t,e,n){var o=Math.floor(t*Math.pow(10,e)),u=r(o,e);return n?i(u):u},i=function(t){return(t+="").replace(/0*$/g,"")}})},"geocortex/framework/utils/DateUtils":function(){define(["require","exports"],function(t,e){"use strict";function r(){return null===i&&(i=(new Date).getTimezoneOffset()),i}Object.defineProperty(e,"__esModule",{value:!0});var n=/(Z|([+-][012]\d(:?\d\d)?))\s*$/;e.containsTimezone=function(t){return n.test(t)};var i=null,o=null;e.getTimezoneOffset=r,e.getTimezoneString=function(){if(null==o){var t=r(),e=Math.floor(t/60),n=Math.floor(t-60*e);if(0==e&&0==n)return"Z";e<0?(e*=-1,o="+"):o="-",o+=0==e?"00":e<10?"0"+e:e,o+=0==n?":00":n<10?":0"+n:":"+n}return o},function(){var t=new Date("2011-06-02T09:34:29+02:00");Date.fromISO=t&&1307000069e3==+t?function(t){return new Date(t)}:function(t){var e,r,n=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/.exec(t)||[];if(n[1]){for(var i=0,o=(e=n[1].split(/\D/)).length;i<o;i++)e[i]=parseInt(e[i],10)||0;return e[1]-=1,(e=new Date(Date.UTC.apply(Date,e))).getDate()?(n[5]&&(r=60*parseInt(n[5],10),n[6]&&(r+=parseInt(n[6],10)),"+"==n[4]&&(r*=-1),r&&e.setUTCMinutes(e.getUTCMinutes()+r)),e):NaN}return NaN}}(),Date.prototype.toISOString||function(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}()})},"geocortex/framework/utils/Grouping":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})})},"geocortex/framework/utils/HttpsUtils":function(){define(["require","exports"],function(t,e){"use strict";function r(){var t=window.location.protocol;t.indexOf(":")<0&&(t+=":");var e=window.location.pathname.lastIndexOf("/"),r="/";e>-1&&(r=window.location.pathname.substr(0,e)),""===r&&(r="/");var n=t+"//"+window.location.host.trim()+r.trim();return"/"!==n.charAt(n.length-1)&&(n+="/"),n}function n(t){var e=t.trim();return e.indexOf("://")>-1&&e.length>=5&&"https"===e.substring(0,5)}Object.defineProperty(e,"__esModule",{value:!0}),e.isHttpsMode=function(){return n(r())},e.getHost=r,e.isHttpsUri=n})},"geocortex/framework/utils/String":function(){define(["require","exports","./DateFormatters"],function(t,e,r){"use strict";if(Object.defineProperty(e,"__esModule",{value:!0}),!String.prototype.format){var n=new RegExp("(d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|:|\\/|[^d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|:|\\/])","g");String.prototype.format=function(){var t=arguments,e=this.replace(/{{/g,"\0MAGIC\0");return(e=e.replace(/{(\d+)(?::([^}]*))?}/g,function(e,i,o){var u=t[i];if(!(o&&u instanceof Date))return u;for(var a=u,c=o.match(n),s=[],f=0;f<c.length;f++){var l=c[f],p=r.DateFormatters[l];if(p){var h=p.call(this,a);s.push(h)}else s.push(l)}return s.join("")})).replace(new RegExp("\0MAGIC\0","g"),"{").replace(/}}/g,"}")}}String.format=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return t.format.apply(t,e)},String.quickHashCode=function(t){var e,r=0;if(0==t.length)return r;for(e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;return r},String.escapeHtml=function(t){return null===t||void 0===t?t:t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},String.unescapeHtml=function(t){return null===t||void 0===t?t:t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")},String.escapeHtmlEncode=function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},String.isNullOrEmpty=function(t){return void 0===t||null===t||0===t.length},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e},String.prototype.endsWith=function(t,e){e=e||this.length,e-=t.length;var r=this.lastIndexOf(t);return-1!==r&&r===e}})},"geocortex/framework/utils/ThrottledOperation":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,r){this.period=100,this.isActive=!1,this._setTimeoutToken=null,this.period=void 0==t?0:t,this.action=e,this.cancelAction=r;var n=this;this._setTimeoutToken=setTimeout(function(){n.execute(n)},this.period)}return t.prototype.cancel=function(){this._setTimeoutToken&&(clearTimeout(this._setTimeoutToken),this._setTimeoutToken=null,this.isActive=!1,this.cancelAction&&this.cancelAction())},t.prototype.execute=function(t){t.isActive=!0;var e=t.action();null!==t._setTimeoutToken&&e?t._setTimeoutToken=setTimeout(function(){t.execute(t)},t.period):(t._setTimeoutToken=null,t.isActive=!1)},t}();e.ThrottledOperation=r})},"geocortex/framework/utils/TimeDelayedOperation":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,r){this.delayMS=0,this.func=null,this.delayMS=t,this.func=r?function(){e.apply(r)}:e}return t.prototype.start=function(){this._timerHandle=setTimeout(this.func,this.delayMS)},t.prototype.stop=function(){clearTimeout(this._timerHandle)},t.prototype.reset=function(){this.stop(),this.start()},t}();e.TimeDelayedAction=r})},"geocortex/framework/utils/Trace":function(){define(["require","exports","./../utils/utils"],function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._appName="GVH",this.app=t}return t.prototype._traceImpl=function(t,e,n,i,o){if(("debug"!==t&&"trace"!==t||this.app.debugMode)&&this.app){var u=r.activeLogSources.indexOf(n.toLowerCase())>-1||r.activeLogSources.indexOf("all")>-1;this.app.event("TraceEvent").publish({level:t,timestamp:new Date,source:n,message:e,stack:i,display:o,visible:u})}},t.prototype._stackTraceFromException=function(t){return void 0!==t?t.stack||t.backtrace||t.stacktrace:null},t.prototype.binding=function(t,e){this.app&&this.app.debugModeActive("binding")&&this._traceImpl("debug",t,e)},t.prototype.event=function(t,e){this.app&&this.app.debugModeActive("event")&&this._traceImpl("debug",t,"Events",null,e)},t.prototype.command=function(t){this.app&&this.app.debugModeActive("command")&&this._traceImpl("debug",t,"Commands")},t.prototype.timer=function(t,e){this.app&&this.app.debugModeActive("time")&&this._traceImpl(e,t,"Timers")},t.prototype.view=function(t){this.app&&this.app.debugModeActive("view")&&this._traceImpl("debug",t,"Views")},t.prototype.debug=function(t){this.app&&this.app.debugMode&&this._traceImpl("debug",t,this._appName)},t.prototype.trace=function(t){this._traceImpl("trace",t,this._appName)},t.prototype.info=function(t){this._traceImpl("info",t,this._appName)},t.prototype.alert=function(t){this._traceImpl("alert",t,this._appName)},t.prototype.warning=function(t){this._traceImpl("warning",t,this._appName)},t.prototype.error=function(t,e){this._traceImpl("error",t,this._appName,this._stackTraceFromException(e))},t.prototype.exception=function(t,e){this._traceImpl("error",t,this._appName,this._stackTraceFromException(e))},t}();e.Trace=n})},"geocortex/framework/utils/Tuple":function(){define(["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e,r,n,i){this.item1=null,this.item2=null,this.item3=null,this.item4=null,this.item5=null,this.item1=t,this.item2=e,null!=r&&void 0!==r&&(this.item3=r),null!=n&&void 0!==n&&(this.item4=n),null!=i&&void 0!==i&&(this.item5=i)}return t.equals=function(t,e){return null===t?null===e:t.item1===e.item1&&t.item2===e.item2&&t.item3===e.item3&&t.item4===e.item4&&t.item5===e.item5},t.compare=function(t,e){var r=function(t,e){return null===t?null===e?0:-1:t===e?0:t>e?1:-1};return r(t.item1,e.item1)||r(t.item2,e.item2)||r(t.item3,e.item3)||r(t.item4,e.item4)||r(t.item5,e.item5)},t}();e.Tuple=r})},"geocortex/framework/utils/utils":function(){define(["require","exports"],function(t,e){"use strict";function r(t){return void 0!==t}function n(t){return null===t||!r(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.base64keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.isDefined=r,e.isNullOrUndefined=n,e.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isEmptyObject=function(t){return!!t&&0===Object.keys(t).length&&t.constructor===Object},e.isObject=function(t){return t===Object(t)},e.makeUrlAbsolute=function(t){if(0===t.indexOf("http"))return t;var e="{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if("/"!=e.charAt(e.length-1)||"\\"!=e.charAt(e.length-1)){var r=e.split("/");--r.length,e=r.join("/"),e+="/"}return t="/"===t.charAt(0)||"\\"===t.charAt(0)?window.location.protocol+"//"+window.location.host+"/"+t.substring(1):e+t},e.alphaNumericToken=function(t){for(var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",r=t||8,n="",i=0;i<r;i++){var o=Math.floor(Math.random()*e.length);n+=e.substring(o,o+1)}return n},e.base64Encode=function(t){var e,r,n,i,o,u,a,c="",s=0;for(t=this.utf8Encode(t);s<t.length;)i=(e=t.charCodeAt(s++))>>2,o=(3&e)<<4|(r=t.charCodeAt(s++))>>4,u=(15&r)<<2|(n=t.charCodeAt(s++))>>6,a=63&n,isNaN(r)?u=a=64:isNaN(n)&&(a=64),c=c+this.base64keyStr.charAt(i)+this.base64keyStr.charAt(o)+this.base64keyStr.charAt(u)+this.base64keyStr.charAt(a);return c},e.base64Decode=function(t){var e="";if(!t||""===t)return e;var r,n,i,o,u,a,c=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(t))throw new Error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{r=this.base64keyStr.indexOf(t.charAt(c++))<<2|(o=this.base64keyStr.indexOf(t.charAt(c++)))>>4,n=(15&o)<<4|(u=this.base64keyStr.indexOf(t.charAt(c++)))>>2,i=(3&u)<<6|(a=this.base64keyStr.indexOf(t.charAt(c++))),e+=String.fromCharCode(r),64!=u&&(e+=String.fromCharCode(n)),64!=a&&(e+=String.fromCharCode(i)),r=n=i=null,o=u=a=null}while(c<t.length);return e=this.utf8Decode(e)},e.utf8Encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},e.utf8Decode=function(t){for(var e="",r=0,n=0,i=0,o=0;r<t.length;)(n=t.charCodeAt(r))<128?(e+=String.fromCharCode(n),r++):n>191&&n<224?(i=t.charCodeAt(r+1),e+=String.fromCharCode((31&n)<<6|63&i),r+=2):(i=t.charCodeAt(r+1),o=t.charCodeAt(r+2),e+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&o),r+=3);return e},e.isUrl=function(t){if(!t||"string"!=typeof t)return!1;var e=t.trim().toLowerCase();return e.length>=7&&0===e.indexOf("http://")||e.length>=8&&0===e.indexOf("https://")},e.isPercentage=function(t){return!n(t)&&/^(\d+|\d*[.]\d+)%$/.test(t)},e.clamp=function(t,e,r){return t<e?e:t>r?r:t},e.addEventListener=function(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent&&t.attachEvent("on"+e,r)},e.activeLogSources=["all"],e.setActiveLogSources=function(t){e.activeLogSources=t}})}}});