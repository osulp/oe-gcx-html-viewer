!function(){var t="<div class='list-reports-view'>    <div class='list-reports-header' tabindex='0'>        <p data-binding='{@text: @language-list-reports-explanation}'></p>    </div>    <ul class='list-of-reports' data-binding='{@source: availableReportListings}'>        <li data-binding='{@template-for: availableReportListings}'>            <button class='list-of-reports-link' data-binding='{@event-onclick: handleClickReport}'>                <strong class='list-of-reports-link-title' data-binding='{@text: displayName}'></strong>                <span class='list-of-reports-link-description' data-binding='{@text: description}'></span>                <span class='list-of-reports-link-details' data-binding='{@visible: isMoreThanOneFeatureSelected}{@text: details}'></span>            </button>        </li>    </ul></div>",r="<div class='run-report-view'>    \x3c!-- Report is in progress. --\x3e    <div class='run-report-progress' data-binding='{@hidden: complete}'>        \x3c!-- Sync report. --\x3e        <div data-binding='{@hidden: isAsync}'>            <h2 data-binding='{@text: @language-run-report-progress-heading-sync}'></h2>            <p data-binding='{@text: @language-run-report-progress-message-sync}'></p>        </div>        \x3c!-- Async report. --\x3e        <div data-binding='{@visible: isAsync}'>            <h2 data-binding='{@text: @language-run-report-progress-heading-async}'></h2>            <p data-binding='{@text: @language-run-report-progress-message-async}'></p>        </div>    </div>    \x3c!-- Report is complete. --\x3e    <div class='run-report-complete' data-binding='{@visible: complete}'>        \x3c!-- Sync report: direct link to download file. --\x3e        <div data-binding='{@hidden: isAsync}'>            <h2 data-binding='{@text: @language-run-report-complete-heading-sync}'></h2>            <a class='run-report-complete-link' data-binding='{@visible: downloadTag}{href: href}{@text: @language-run-report-complete-link-sync}' href='' target='_blank' download></a>            \x3c!-- Browser in GMAF cannot handle the download nor the target tahs. The download tag disables the download fir all  platforms, target breaks iOS. Therefore, in GMAF, they are removed. --\x3e            <a class='run-report-complete-link' data-binding='{@hidden: downloadTag}{href: href}{@text: @language-run-report-complete-link-sync}' href=''></a>        </div>        \x3c!-- Async report: embedded print job iframe. --\x3e        <div data-binding='{@visible: isAsync}'>            <h2 data-binding='{@text: @language-run-report-complete-heading-async}'></h2>            <a class='run-report-complete-link' data-binding='{href: href}{@text: @language-run-report-complete-link-async}' href='' target='_blank'></a>        </div>        <button class='run-report-complete-done-button' data-binding='{@text: @language-run-report-complete-done-button}{@event-onclick: handleClickDoneButton}'></button>    </div></div>";function i(e,t,r){if("string"==typeof e&&(r=t,t=e),void 0!==r)for(var o=t.split("."),n=null,i=window,s=0,a=o.length;s<a;s++)n=o[s],s==a-1?i[n]=r:i[n]||(i[n]={}),i=i[n];else console.warn("Undefined shim for: "+t)}require({cache:{"Mapping/modules/Reporting/ListReportsView":function(){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=(o=r.ViewBase,s(i,o),i.prototype.handleClickReport=function(e,t,r){this.viewModel.engageReport(r)},i);function i(e,t){var r=o.call(this,e,t)||this;return r.app.command("ListReports").postExecute.subscribe(r,function(){r.app.viewManager.activateView(r)}),r.app.command("RunFeatureReport").postExecute.subscribe(r,function(){r.app.viewManager.activateView(r)}),r.app.command("RunFeaturesReport").postExecute.subscribe(r,function(){r.app.viewManager.activateView(r)}),r}t.ListReportsView=n})},"Mapping/modules/Reporting/ListReportsViewModel":function(){var o,l=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/Reporting"],function(e,t,r,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=(n=r.ViewModelBase,l(a,n),a.prototype.initialize=function(e){void 0===e&&(e={}),n.prototype.initialize.apply(this,arguments),this.warnUserWhenReportExcludesFeatures="warnUserWhenReportExcludesFeatures"in e&&e.warnUserWhenReportExcludesFeatures,this.app.command("ListReports").register(this,this._executeListReports,this._canExecuteListReports),this.app.command("RunFeatureReport").register(this,this._executeListReports,this._canExecuteListReports),this.app.command("RunFeaturesReport").register(this,this._executeListReports,this._canExecuteListReports)},a.prototype._executeListReports=function(e){var o=this,n=i.getAllFeaturesFromReportable(e);this.features.set(n),this.availableReportListings.set(this._getVisibleReportsFromFeatures(n).map(function(t){var r=n.filter(function(e){return!e||!e.layer||!e.layer.mapService||e.layer.mapService.id!==t.layer.mapService.id||e.layer.id!==t.layer.id}),e=o.features.get().filter(function(e){return-1===r.indexOf(e)});return{report:t,displayName:t.displayName,description:t.description,excludedFeatures:r,includedFeatures:e,details:o.getResource("language-list-reports-details").format(e.length,n.length),isMoreThanOneFeatureSelected:1<o.features.getLength()}}))},a.prototype._canExecuteListReports=function(e){var t=i.getAllFeaturesFromReportable(e);return 0<this._getVisibleReportsFromFeatures(t).length},a.prototype._getVisibleReportsFromFeatures=function(e){var t=[];e.forEach(function(e){e.layer&&-1===t.indexOf(e.layer)&&t.push(e.layer)});var r=[];return t.forEach(function(e){e.reports&&e.reports.forEach(function(e){-1===r.indexOf(e)&&e.visible&&r.push(e)})}),r},a.prototype.engageReport=function(e){var t=this,r=e.report,o=e.excludedFeatures,n=e.includedFeatures,i={report:r,reportable:n};this.warnUserWhenReportExcludesFeatures&&0<o.length?this.app.command("Confirm").execute(this.getResource("language-list-reports-exclusion-warning-message").format(r.displayName,o.length,this.features.getLength(),n.length),this.getResource("language-list-reports-exclusion-warning-title"),function(e){e&&t.app.command("RunReport").execute(i)}):this.app.command("RunReport").execute(i)},a);function a(){var e=null!==n&&n.apply(this,arguments)||this;return e.features=new o.ObservableCollection,e.availableReportListings=new o.ObservableCollection,e}t.ListReportsViewModel=s})},"Mapping/modules/Reporting/ReportingModule":function(){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n=(o=r.ModuleBase,s(i,o),i);function i(){return null!==o&&o.apply(this,arguments)||this}t.ReportingModule=n})},"Mapping/modules/Reporting/RunReportView":function(){var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/commandArgs/AddStatusArgs"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r.ViewBase,a(s,n),s.prototype.handleClickDoneButton=function(){this.app.viewManager.deactivateView(this)},s.prototype._displayReportProgressUI=function(e){this._displayProgressUI(e.report.displayName||e.report.id)},s.prototype._displayUrlReportProgressUI=function(e){this._displayProgressUI("URL Report")},s.prototype._displayProgressUI=function(e){this.isBusy.set(!0),this.app.viewManager.activateView(this);var t=new o.AddStatusArgs(this.getResource("language-run-report-progress-status").format(e));t.id="RunningReport",t.imageProperties={uri:"Resources/Images/Icons/Toolbar/reports-24.png",altText:this.getResource("language-run-report-progress-image-alt")},t.showBusyIcon=!0,t.timeoutMS=0,this.app.command("AddStatus").execute(t)},s.prototype._cleanupReportProgressUI=function(){this.isBusy.set(!1),this.app.command("RemoveStatus").execute("RunningReport")},s.prototype._handleReportResultUI=function(e){this._cleanupReportProgressUI(),this.isBusy.set(!1),this.app.viewManager.activateView(this)},s.prototype._handleReportErrorUI=function(t){this.isBusy.set(!1),this.app.viewManager.deactivateView(this);var e,r=this.getResource("language-run-report-error-title");e="ReportAlreadyRunning"===t.name?this.getResource("language-run-report-error-message-already-running"):"RequestTimeoutError"===t.name?this.getResource("language-run-report-error-message-timeout"):"OfflineReportImpossible"===t.name?this.getResource("language-run-report-error-message-offline"):"PortalItemNotFoundError"===t.name?this.getResource("language-run-report-error-message-portal-item-not-found"):"PortalItemAuthorizationError"===t.name?this.getResource("language-run-report-error-message-portal-item-unauthorized"):"ServiceUnavailableError"===t.name?this.getResource("language-run-report-error-message-service-unavailable"):"ServicePortalError"===t.name?this.getResource("language-run-report-error-message-service-portal-unauthorized"):"ServiceReportFailedError"===t.name?this.getResource("language-run-report-error-message-service-report-failed"):["ServiceError","ServiceReportNotFoundError","ServiceTokenError"].filter(function(e){return e===t.name}).pop()?this.getResource("language-run-report-error-message-service-error"):/outputFormat parameter invalid/.test(t.message)?this.getResource("language-run-report-error-message-output-format-unavailable"):this.getResource("language-run-report-error-message-generic"),"ReportAlreadyRunning"!==t.name&&this._cleanupReportProgressUI(),this.app.command("Alert").execute(e,r)},s);function s(e,t){var r=n.call(this,e,t)||this;return r.app.command("RunReport").preExecute.subscribe(r,r._displayReportProgressUI),r.app.command("RunReportByUrl").preExecute.subscribe(r,r._displayUrlReportProgressUI),r.app.event("ReportResultEvent").subscribe(r,r._handleReportResultUI),r.app.event("ReportErrorEvent").subscribe(r,r._handleReportErrorUI),r}t.RunReportView=i})},"Mapping/modules/Reporting/RunReportViewModel":function(){var o,c=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/essentials/ReportParameters","geocortex/infrastructure/Reporting","geocortex/essentials/Report","./Reporting5Client/Reporting5GvhClient"],function(e,t,r,o,n,i,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,u=(l=r.ViewModelBase,c(p,l),p.prototype.initialize=function(e){void 0===e&&(e={}),l.prototype.initialize.apply(this,arguments),this.app.command("RunReport").register(this,this._executeRunReport),this.app.command("RunReportByUrl").register(this,this._executeRunReportByUrl)},p.prototype._executeRunReport=function(r){var t=this;if(r)try{if(this.complete.set(!1),r.reportParameters=r.reportParameters||new n.ReportParameters,r.reportParameters.featureIds=[],r.reportParameters.outputFormat=r.reportParameters.outputFormat||"PDF",!r.report.supportedOutputFormats.some(function(e){return e.toLowerCase()===r.reportParameters.outputFormat.toLowerCase()})){var e,o=r.report.supportedOutputFormats.length?r.report.supportedOutputFormats[0]:null;if(!o)throw(e=new Error("Selected report has no available output formats configured.")).name="ReportHasNoSupportedOutputFormats",e;r.reportParameters.outputFormat=o}if(i.getAllFeaturesFromReportable(r.reportable).forEach(function(e){var t=e.getPrimaryKeyValue();t&&r.reportParameters.featureIds.push(t)}),this.app.isNative.get()&&(this.downloadTag.set(!1),this.app.isOffline.get()))throw(e=new Error("Reports cannot be run while offline.")).name="OfflineReportImpossible",e;null!=r.report.layer&&null!=r.report.layer.mapService&&this.app.event("ReportStartedEvent").publish(r.report.id,r.report.layer.mapService.id,r.report.layer.id),r.report.type===s.ReportType.LAYER_URL_REPORT?a.Reporting5GVHClient.RunReport(r.report.reportUrl,this.app.site,r.reportParameters).then(function(e){t.isAsync.set(!1),t.href.set(e),t.complete.set(!0),t.app.event("ReportResultEvent").publish({isAsync:!1,href:e})}).error(function(e){console.error("Reporting5 Error: ["+e.name+"] : "+e.msg+" -> ["+r.report.reportUrl+"]"),t.app.event("ReportErrorEvent").publish(e)}).catch(function(e){console.error("Reporting5 Error: ["+e.name+"] : "+e.msg+" -> ["+r.report.reportUrl+"]"),t.app.event("ReportErrorEvent").publish(e)}):r.report.run(null,r.reportParameters,function(e){t.isAsync.set(e.isAsync),t.href.set(e.href),t.complete.set(!0),t.app.event("ReportResultEvent").publish(e)},function(e){t.app.event("ReportErrorEvent").publish(e)})}catch(e){this.app.event("ReportErrorEvent").publish(e)}},p.prototype._executeRunReportByUrl=function(t){var r=this;if(!String.isNullOrEmpty(t))try{if(this.complete.set(!1),this.app.isNative.get()&&(this.downloadTag.set(!1),this.app.isOffline.get())){var e=new Error("Reports cannot be run while offline.");throw e.name="OfflineReportImpossible",e}this.app.event("ReportStartedEvent").publish(t,"-1","-1"),a.Reporting5GVHClient.RunReport(t,this.app.site,null).then(function(e){r.isAsync.set(!0),r.href.set(e),r.complete.set(!0),r.app.event("ReportResultEvent").publish(e)}).error(function(e){console.error(e+" : ["+t+"]"),r.app.event("ReportErrorEvent").publish(e)}).catch(function(e){console.error(e+" : ["+t+"]"),r.app.event("ReportErrorEvent").publish(e)})}catch(e){this.app.event("ReportErrorEvent").publish(e)}},p);function p(){var e=null!==l&&l.apply(this,arguments)||this;return e.complete=new o.Observable(!1),e.isAsync=new o.Observable(!1),e.href=new o.Observable(""),e.downloadTag=new o.Observable(!0),e}t.RunReportViewModel=u})},"Mapping/modules/Reporting/Reporting5Client/Reporting5.defs":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.cancel=function(){this._cancelled=!0},o.prototype.isCancelled=function(){return this._cancelled},o);function o(){this._cancelled=!1}t.LiteCancellationToken=r})},"Mapping/modules/Reporting/Reporting5Client/Reporting5Client":function(){var r=this&&this.__awaiter||function(e,s,a,l){return new(a=a||Promise)(function(t,r){function o(e){try{i(l.next(e))}catch(e){r(e)}}function n(e){try{i(l.throw(e))}catch(e){r(e)}}function i(e){e.done?t(e.value):function(t){return t instanceof a?t:new a(function(e){e(t)})}(e.value).then(o,n)}i((l=l.apply(e,s||[])).next())})},g=this&&this.__generator||function(r,o){var n,i,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=o.call(r,a)}catch(e){t=[6,e],i=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};define(["require","exports","./Reporting5Service"],function(u,e,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=(d.RunReport=function(l,u,p,c){return r(this,void 0,void 0,function(){var t,r,o,n,i,s,a;return g(this,function(e){switch(e.label){case 0:return String.isNullOrEmpty(l)&&this._throwError("ReportUrlNullOrEmpty","reportUrl cannot be null or empty."),null===(t=this._parseReportItemUrl(l))&&this._throwError("ReportUrlNotRecognized","reportUrl format was not recognized."),this._checkCancelToken(c),r=null,[4,this._fetchPortalItem(t.portalUrl,t.itemId,u)];case 1:return(r=e.sent()).typeKeywords&&r.typeKeywords.filter(function(e){return"Geocortex Reporting"===e}).pop()||this._throwError("PortalItemInvalidError","Portal Item is not a Geocortex Report."),r.url||this._throwError("PortalItemInvalidError","Portal Item does not contain a service URL. Contact your administrator."),[4,(o=new h.Reporting5Service(r.url,t.portalUrl,u)).initialize()];case 2:return e.sent(),this._checkCancelToken(c),[4,o.runJob(t.itemId,p)];case 3:n=e.sent(),i=null,a=s=0,e.label=4;case 4:return i?[3,7]:[4,d._delay(this._watchSchedule[s][0])];case 5:return e.sent(),this._checkCancelToken(c),[4,o.watchJob(n)];case 6:return(i=e.sent())||(this._checkCancelToken(c),this._watchSchedule[s][1]&&(a++,this._watchSchedule[s][1]<a&&(a=0,s++))),[3,4];case 7:return[2,o.fetchResult(n,i)]}})})},d._fetchPortalItem=function(s,a,l){return r(this,void 0,void 0,function(){var t,r,o,n,i;return g(this,function(e){switch(e.label){case 0:return t=s+"/sharing/content/items/"+a+"?f=json",String.isNullOrEmpty(l)||(t+="&token="+l),r=null,u(["dojo/request"],function(e){r=e(t,{handleAs:"json",headers:{"X-Requested-With":null}}).response}),o=null,[4,r];case 1:return 200===(n=e.sent()).status?(o=n.data,(i=this._parsePortalResponseError(o))&&(403===i.code||498===i.code?this._throwError("PortalItemAuthorizationError","You are not authorized to access this report - Have you signed in?"):404===i.code||400===i.code?this._throwError("PortalItemNotFoundError","Report is inaccessible or has been deleted."):this._throwError("PortalError","Unable to fetch Portal Item - Portal Error: ["+i.code+"] "+i.msg))):this._throwError("PortalError","Unable to fetch Portal Item - Network Error ["+n.status+"] "+n.text),[2,o]}})})},d._parsePortalResponseError=function(e){if(e.error){var t=e.error.code,r=e.error.message;return!r&&e.error.details&&0<e.error.details.length&&(r=e.error.details[0]),{code:t,msg:r}}return null},d._parseReportItemUrl=function(e){var t=e.match("(http[s]?://.*?)/home/item.html.*?id=([a-f0-9]+)");return t?{portalUrl:t[1],itemId:t[2]}:null},d._delay=function(t){return r(this,void 0,void 0,function(){return g(this,function(e){return[2,new Promise(function(e){setTimeout(function(){e()},t)})]})})},d._checkCancelToken=function(e){e&&e.isCancelled()&&this._throwError("ReportJobCancelled","The Job was cancelled.")},d._throwError=function(e,t){throw{name:e,message:t}},d._watchSchedule=[[250,12],[1e3,57],[3e3,void 0]],d);function d(){}e.Reporting5Client=t})},"Mapping/modules/Reporting/Reporting5Client/Reporting5GvhClient":function(){var a=this&&this.__awaiter||function(e,s,a,l){return new(a=a||Promise)(function(t,r){function o(e){try{i(l.next(e))}catch(e){r(e)}}function n(e){try{i(l.throw(e))}catch(e){r(e)}}function i(e){e.done?t(e.value):function(t){return t instanceof a?t:new a(function(e){e(t)})}(e.value).then(o,n)}i((l=l.apply(e,s||[])).next())})},l=this&&this.__generator||function(r,o){var n,i,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=o.call(r,a)}catch(e){t=[6,e],i=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};define(["require","exports","./Reporting5Client"],function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.RunReport=function(o,n,i){return a(this,void 0,void 0,function(){var t,r;return l(this,function(e){return String.isNullOrEmpty(o)?[2,null]:(t=n.getTokenFromPrincipal(o,esri.IdentityManagerBase),r=this._marshalReportParameters(i),[2,s.Reporting5Client.RunReport(o,t,r).then(function(e){return e}).catch(function(e){throw e}).error(function(e){throw e})])})})},o._marshalReportParameters=function(e){return e&&e.featureIds?[{name:"FeatureIds",containsMultipleValues:!0,values:e.featureIds}]:[]},o);function o(){}t.Reporting5GVHClient=r})},"Mapping/modules/Reporting/Reporting5Client/Reporting5Service":function(){var o=this&&this.__awaiter||function(e,s,a,l){return new(a=a||Promise)(function(t,r){function o(e){try{i(l.next(e))}catch(e){r(e)}}function n(e){try{i(l.throw(e))}catch(e){r(e)}}function i(e){e.done?t(e.value):function(t){return t instanceof a?t:new a(function(e){e(t)})}(e.value).then(o,n)}i((l=l.apply(e,s||[])).next())})},d=this&&this.__generator||function(r,o){var n,i,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=o.call(r,a)}catch(e){t=[6,e],i=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};define(["require","exports"],function(c,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=(h.prototype.initialize=function(){return o(this,void 0,void 0,function(){var t,r,o,n,i=this;return d(this,function(e){switch(e.label){case 0:return this.serviceUrl.endsWith("/")&&(this.serviceUrl=this.serviceUrl.slice(0,-1)),this.serviceUrl+="/service",[4,h._probeServiceEndpoint(this.serviceUrl)];case 1:return e.sent()||h._throwError("ServiceUnavailableError","Reporting Service Endpoint is not available. : "+this.serviceUrl),[4,h._fetchPortalSettings(this.serviceUrl)];case 2:return t=e.sent(),!(r=t.filter(function(e){return e.portalUrl===i.portalUrl}).pop())&&this.isAgolPortalUrl(this.portalUrl)&&(o=t.filter(function(e){return i.isAgolPortalUrl(e.portalUrl)&&i.isEquivalentAgolPortalUrl(e.portalUrl,i.portalUrl)}).pop())&&(this.portalUrl=o.portalUrl,r=1),r||h._throwError("ServicePortalError","Current Authentication Portal is not registered with the target Reporting Service. - Pleaes contact your Administrator"),this._serviceToken=null,this._serviceTokenExpiry=null,this._portalToken?[4,this.getJobToken(this._portalToken)]:[3,4];case 3:n=e.sent(),this._serviceToken=n.token,e.label=4;case 4:return[2]}})})},h.prototype.isAgolPortalUrl=function(e){return!(String.isNullOrEmpty(e)||!/^https?:\/\//i.test(e)||!/www\.arcgis\.com$/i.test(e)&&!/\.maps\.arcgis\.com$/i.test(e))},h.prototype.isEquivalentAgolPortalUrl=function(e,t){var r="(https?)://(.*?).arcgis.com",o=e.match(r),n=o[1],i=o[2],s=t.match(r),a=s[1],l=s[2];return n===a&&("www"===i||"www"===l||i===l)},h.prototype.getJobToken=function(e){return o(this,void 0,void 0,function(){var t,r,o,n,i,s,a=this;return d(this,function(e){switch(e.label){case 0:t={"X-Requested-With":null,Accept:"application/json","Content-Type":"application/json"},r=JSON.stringify({portalUrl:this.portalUrl,accessToken:this._portalToken}),o=null,c(["dojo/request"],function(e){o=e(a.serviceUrl+"/auth/token/run",{handleAs:"json",method:"POST",headers:t,data:r}).response}),n=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,o];case 2:return n=e.sent().data,[3,4];case 3:return i=e.sent(),h._throwError("ServiceTokenError","Failed to fetch Run Token from Reporting Service : Network Error ["+(i.message||i.name)),[3,4];case 4:return n.error?(s=n.error,h._throwError("ServiceTokenError","Failed to fetch Run Token from Reporting Service : "+s.$type+" ["+s.code+"] "+s.message),[2]):[2,{token:n.response.token,ttl:n.response.token}]}})})},h.prototype.runJob=function(s,a){return o(this,void 0,void 0,function(){var t,r,o,n,i=this;return d(this,function(e){switch(e.label){case 0:t={template:{itemId:""+s,portalUrl:this.portalUrl}},a&&(t.parameters=a),r={"X-Requested-With":null,Accept:"application/json","Content-Type":"application/json"},this._serviceToken&&(r.Authorization="Bearer "+this._serviceToken),o=null,c(["dojo/request"],function(e){o=e(i.serviceUrl+"/job/run",{handleAs:"json",method:"POST",headers:r,data:JSON.stringify(t)}).response}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,o];case 2:return[2,e.sent().data.response.ticket];case 3:return 404===(n=e.sent()).response.status?h._throwError("ServiceReportNotFoundError","Report Template not available at Service Endpoint - Contact your Administrator"):h._throwError("ServiceError","Failed to start Report Job - "+(n.response.data?n.response.data.error.message:n.message)),[3,4];case 4:return[2]}})})},h.prototype.watchJob=function(p){return o(this,void 0,void 0,function(){var t,r,o,n,i,s,a,l,u=this;return d(this,function(e){switch(e.label){case 0:t={"X-Requested-With":null,Accept:"application/json"},this._serviceToken&&(t.Authorization="Bearer "+this._serviceToken),r=null,c(["dojo/request"],function(e){r=e(u.serviceUrl+"/job/artifacts?ticket="+p,{handleAs:"json",method:"GET",headers:t}).response}),o=null,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r];case 2:return n=e.sent(),o=n.data,[3,4];case 3:return i=e.sent(),h._throwError("ServiceError","Unable to request Job Watch : ["+i.response.status+"] "+i.response.text),[3,4];case 4:if(o.error)h._throwError("ServiceError","Unable to request Job Watch : ["+o.error.status+"] "+o.error.message);else{if(s=o.results.filter(function(e){return"JobResult"===e.$type}).pop())return[2,s.tag];o.results.filter(function(e){return"JobQuit"===e.$type}).pop()&&((a=o.results.filter(function(e){return e.$type.endsWith("error")}).pop())?(l=a.error,h._throwError("ServiceReportFailedError","Job Error Occured : "+l.$type+" ["+l.code+"] "+l.message)):h._throwError("ServiceReportFailedError","Job Quit without Job Result"))}return[2,null]}})})},h.prototype.fetchResult=function(e,t){return String.isNullOrEmpty(e)&&Error("Ticket cannot be null or empty"),String.isNullOrEmpty(t)&&Error("Tag cannot be null or empty"),this.serviceUrl+"/job/result?ticket="+e+"&tag="+t},h._throwError=function(e,t){throw{name:e,message:t}},h._probeServiceEndpoint=function(r){return o(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:t=null,c(["dojo/request"],function(e){t=e(r,{handleAs:"json",method:"OPTIONS",headers:{"X-Requested-With":null}}).response}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t];case 2:return e.sent(),[2,!0];case 3:return e.sent(),[2,!1];case 4:return[2]}})})},h._fetchPortalSettings=function(r){return o(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:t=null,c(["dojo/request"],function(e){t=e(r+"/auth/portals",{handleAs:"json",method:"GET",headers:{"X-Requested-With":null,Accept:"application/json"}}).response}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t];case 2:return[2,e.sent().data.results];case 3:return e.sent(),this._throwError("ServiceError","Failed to fetch portal settings from item's service endpoint."),[3,4];case 4:return[2]}})})},h);function h(e,t,r){String.isNullOrEmpty(e)&&h._throwError("NullOrEmptyServiceUrl","serviceUrl cannot be null or empty."),String.isNullOrEmpty(t)&&h._throwError("NullOrEmptyPortalUrl","portalUrl cannot be null or empty"),this.portalUrl=t,this.serviceUrl=e,this._portalToken=r}e.Reporting5Service=t})},"url:/Mapping/modules/Reporting/ListReportsView.html":t,"url:/Mapping/modules/Reporting/RunReportView.html":r}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Reporting/CSS/common.css","css","DQovKioNCiAqIFJlcG9ydHNMaXN0Vmlldw0KICovDQoNCi5saXN0LXJlcG9ydHMtdmlldyB7fQ0KLmxpc3QtcmVwb3J0cy12aWV3ICogew0KICAgIG1hcmdpbjogMDsNCiAgICBwYWRkaW5nOiAwOw0KfQ0KDQoubGlzdC1yZXBvcnRzLWhlYWRlciB7DQogICAgcGFkZGluZzogMWVtIDIwcHg7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMgew0KICAgIGxpc3Qtc3R5bGU6IG5vbmU7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNFNEU4RUM7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluayB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgd2lkdGg6IDEwMCU7DQogICAgZm9udC1zaXplOiAxLjJlbTsNCiAgICBwYWRkaW5nOiAxZW0gMjBweDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgY29sb3I6ICMyRDVGQjU7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluazpob3ZlciB7DQogICAgYmFja2dyb3VuZDogcmdiYSgwLCAxNDgsIDI1NSwgMC4xKTsNCn0NCi5saXN0LW9mLXJlcG9ydHMtbGluazphY3RpdmUgew0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTQ4LCAyNTUsIDAuMyk7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluay10aXRsZSB7DQogICAgZGlzcGxheTogYmxvY2s7DQp9DQoNCi5saXN0LW9mLXJlcG9ydHMtbGluay1kZXNjcmlwdGlvbiB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgZm9udC1zaXplOiAwLjhlbTsNCn0NCg0KLmxpc3Qtb2YtcmVwb3J0cy1saW5rLWRldGFpbHMgew0KICAgIGZvbnQtc2l6ZTogMC44ZW07DQogICAgb3BhY2l0eTogMC42Ow0KICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsNCiAgICBjb2xvcjogYmxhY2s7DQogICAgcGFkZGluZy1sZWZ0OiAxZW07DQp9DQoNCg0KLyoqDQogKiBSZXBvcnRSZXN1bHRWaWV3DQogKi8NCg0KLnJ1bi1yZXBvcnQtdmlldyB7DQogICAgcGFkZGluZzogMWVtIDJlbTsNCn0NCi5ydW4tcmVwb3J0LXZpZXcgKiB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQp9DQoNCi5ydW4tcmVwb3J0LWNvbXBsZXRlLWxpbmsgew0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIGZvbnQtc2l6ZTogMS4yZW07DQogICAgbWFyZ2luLXRvcDogMS41ZW07DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCn0NCi5ydW4tcmVwb3J0LWNvbXBsZXRlLWxpbms6aG92ZXIgew0KICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KfQ0KDQoucnVuLXJlcG9ydC12aWV3IGlmcmFtZSB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgbWluLWhlaWdodDogMjQwcHg7DQogICAgbWFyZ2luOiAxZW0gYXV0bzsNCiAgICBib3JkZXI6IDA7DQp9DQoNCi5ydW4tcmVwb3J0LWNvbXBsZXRlLWRvbmUtYnV0dG9uIHsNCiAgICBkaXNwbGF5OiBibG9jazsNCiAgICBtYXJnaW4tdG9wOiA0ZW07DQogICAgbWFyZ2luLWxlZnQ6IGF1dG87DQogICAgcGFkZGluZzogMC41ZW0gMWVtOw0KICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsIDAuMDgpOw0KICAgIGJvcmRlci1yYWRpdXM6IDJweDsNCn0="),e.resourceManager.register("Mapping","inv","Mapping/modules/Reporting/ListReportsView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Reporting/RunReportView.html","html",r)}),require({cache:{}}),define(["Mapping/modules/Reporting/ListReportsView","Mapping/modules/Reporting/ListReportsViewModel","Mapping/modules/Reporting/ReportingModule","Mapping/modules/Reporting/RunReportView","Mapping/modules/Reporting/RunReportViewModel"],function(e,t,r,o,n){i(e,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.ListReportsView",e.ListReportsView),i(t,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.ListReportsViewModel",t.ListReportsViewModel),i(r,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.ReportingModule",r.ReportingModule),i(o,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.RunReportView",o.RunReportView),i(n,"geocortex.essentialsHtmlViewer.mapping.modules.reporting.RunReportViewModel",n.RunReportViewModel)})}();