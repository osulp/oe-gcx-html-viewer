/*
	
	Copyright (c) 2015, Latitude Geographics Group Ltd.
	All rights reserved.
	       
	Redistribution is not permitted. 
	
	Use in binary form, without modification, is permitted provided that neither 
	the name of the organization nor the names of its contributors may be used 
	to endorse or promote products derived from this software without specific 
	prior written permission.
	       
	THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDER ''AS IS'' AND ANY
	EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
	WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
	DISCLAIMED. IN NO EVENT SHALL LATITUDE GEOGRAPHICS GROUP LTD. BE LIABLE FOR ANY
	DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
	LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
	ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

var geocortex;
(function(c){(function(h){var f=function(){function d(b){this.initializationFailure=null;this.isInitialized=false;this.onInitialized=this.onInitializationFailed=null;this._initializing=false;if(!dojo.isString(b)||b.length===0)throw Error("Invalid url supplied to AsyncInitializable: "+b);this.url=b;this._initializedHandler=dojo.hitch(this,this._initializedHandler);this._initializationFailedHandler=dojo.hitch(this,this._initializationFailedHandler);this._restLoadHandler=dojo.hitch(this,this._restLoadHandler);
this._restErrorHandler=dojo.hitch(this,this._restErrorHandler)}d.prototype.initialize=function(b){if(!this.isInitialized&&!this._initializing){var a=b!==void 0&&b!==null;a?this._restLoadHandler(true,b):(this._initializing=true,c.request({url:this.url,content:{f:"json"},load:dojo.hitch(this,this._restLoadHandler,a),error:this._restErrorHandler,callbackParamName:"CallBack"}))}};d.prototype.doWhenInitialized=function(b,a){arguments.length===1&&(a=b,b=this);if(this.isInitialized)a.call(b,this);else var g=
dojo.connect(this,"onInitialized",this,function(){dojo.disconnect(g);a.apply(b,arguments)})};d.prototype._configureObject=function(){};d.prototype._initializationFailedHandler=function(b){this.initializationFailure=b;if(this.onInitializationFailed)this.onInitializationFailed(b)};d.prototype._initializedHandler=function(b){this.isInitialized=true;if(this.onInitialized)this.onInitialized(b);this._initializing=false};d.prototype._restErrorHandler=function(b){this._initializationFailedHandler(b);this._initializedHandler(this)};
d.prototype._restLoadHandler=function(b,a){this._configureObject(a,b);this._initializedHandler(this)};return d}();h.AsyncInitializable=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){function b(a){this.originalUri=a;this.schemeHostAndPath=a.match(/[^?|^#]*/)[0];var g=a.match(/\?([^#]*)/);this.query={};if(g&&g.length>1)this.query=dojo.queryToObject(g[1]);this.fragment=dojo.queryToObject(a.indexOf("#")>=0?a.substring(a.indexOf("#")+1,a.length):"")}b.prototype.recompose=function(){var a=this.schemeHostAndPath;this.query&&this.anyProperties(this.query)&&(a+="?"+dojo.objectToQuery(this.query));this.fragment&&this.anyProperties(this.fragment)&&
(a+="#"+dojo.objectToQuery(this.fragment));return a};b.prototype.anyProperties=function(a){for(var g in a)return true;return false};b.getHost=function(a){if(!a)return null;a=a.match(/^http[s]?:\/\/([^\/]*)/);return a.length>1?a[1]:null};b.appendToPath=function(a,g){var i=new b(a);i.schemeHostAndPath+=g;return i.recompose()};return b}();c.DecomposedUri=d})(c.utilities||(c.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){function b(){}b.endsWith=function(a,g){return a.indexOf(g,a.length-g.length)!==-1};b.replaceLayerTokens=function(a,g){if(g)switch(a.toLowerCase()){case "layerid":return g.id;case "layername":return g.name;case "layerdisplayname":return g.displayName;case "layerdescription":return g.description}return""};b.replaceMapServicetokens=function(a,g){if(g)switch(a.toLowerCase()){case "mapserviceid":return g.id;case "mapservicedisplayname":return g.displayName;
case "mapserviceurl":return g.url;case "mapservicetoken":return g.serviceToken}return""};return b}();c.StringUtilities=d;if(typeof String.prototype.endsWith!=="function")String.prototype.endsWith=function(b){return d.endsWith(this,b)}})(c.utilities||(c.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(){}}();c.TokenResult=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function b(){}b.getTokenFromImplicitGrant=function(){var a=window.location.href;if(a.indexOf("#")>0){var a=a.substring(a.indexOf("#")+1,a.length),g=dojo.queryToObject(a);if(!g.access_token)return null;a=new c.TokenResult;a.token=g.access_token;a.userName=g.username;if(g=parseInt(g.expires_in))a.expiresOn=new Date((new Date).getTime()+g*1E3);return a}return null};b.getErrorFromImplicitGrant=function(){var a=window.location.href;if(a.indexOf("#")>0&&(a=a.substring(a.indexOf("#")+
1,a.length),a=dojo.queryToObject(a),a.error)){var g=new d;g.code=a.error;g.description=a.error_description;return g}return null};b.applicationHasImplicitGrant=function(){return b.hasFragmentParameter("access_token")};b.applicationHasImplicitGrantError=function(){return b.hasFragmentParameter("error")};b.hasFragmentParameter=function(a){var g=window.location.href;if(g.indexOf("#")<0)return false;g=window.location.href;g=g.substring(g.indexOf("#")+1,g.length);return!!dojo.queryToObject(g)[a]};b.redirectToLogOnPage=
function(a,g){var i=new c.utilities.DecomposedUri(window.location.href);b.removeImplicitGrantParams(i);i=a+"?client_id="+encodeURIComponent(g)+"&response_type=token&redirect_uri="+encodeURIComponent(i.recompose())+"&expiration=20160";window.location.href=i};b.removeImplicitGrantParamsAndUpdateUrlHash=function(){var a=new c.utilities.DecomposedUri(window.location.href);b.removeImplicitGrantParams(a);window.location.hash=dojo.objectToQuery(a.fragment)};b.removeImplicitGrantParams=function(a){delete a.fragment.access_token;
delete a.fragment.username;delete a.fragment.expires_in;delete a.fragment.error;delete a.fragment.error_description;return a};return b}();c.OAuth2Client=f;var d=function(){function b(){}b.ACCESS_DENIED_ERROR_CODE="access_denied";return b}();c.OAuth2Error=d})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function d(b,a,g){this.baseUrl=b;this.domains=a;this.clientId=g}d.prototype.initiate=function(){if(!this.tokenResult)this.tokenResult=c.OAuth2Client.getTokenFromImplicitGrant();if(!this.tokenResult)return(this.error=c.OAuth2Client.getErrorFromImplicitGrant())||c.OAuth2Client.redirectToLogOnPage(this.getLogOnUrl(),this.clientId),c.OAuth2Client.removeImplicitGrantParamsAndUpdateUrlHash(),false;c.OAuth2Client.removeImplicitGrantParamsAndUpdateUrlHash();return true};
d.prototype.getLogOnUrl=function(){return this.baseUrl+"oauth2/authorize"};d.prototype.getToken=function(b){return!this.tokenResult||!b?null:this.appliesTo(b)?this.tokenResult.token:null};d.prototype.appliesTo=function(b){for(var b=c.utilities.DecomposedUri.getHost(b),a=0;a<this.domains.length;a++)if(c.utilities.StringUtilities.endsWith(b,this.domains[a]))return true;return false};return d}();c.ArcGisPortalSecurityContext=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c){this.essentialsMap=this.displayName=null;this.extensions=[];this.iconUri=this.id=null;this.properties={};this.services=[];if(!c)throw Error("Essentials map is required for a base map.");this.essentialsMap=c}}();c.BaseMap=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c){this.mapService=null;if(!c)throw Error("Map service is required for a base map service.");this.mapService=c}}();c.BaseMapService=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(c,b){b===void 0&&(b="Png");this.defaultOutputFormat=b;this.allowIncludeGeoreferenceData=c}}();c.ExportMapImageOptions=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){c=c.essentials||(c.essentials={});c=c.exportMap||(c.exportMap={});(c.BingEnvironment||(c.BingEnvironment={})).PRODUCTION="Production"})(geocortex||(geocortex={}));(function(c){c=c.essentials||(c.essentials={});c=c.exportMap||(c.exportMap={});c=c.ExportMapTypes||(c.ExportMapTypes={});c.WEBTILED="WebTiledLayer";c.BINGAERIAL="BingMapsAerial";c.BINGAERIALLABELS="BingMapsAerialWithLabels";c.BINGROADS="BingMapsRoad";c.BINGHYBRID="BingMapsHybrid"})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(){function b(a){this._site=this._essentialsRestUrl=this._esriMap=this.resource=null;this._populateFromResource(a);if(!this._esriMap||!this._essentialsRestUrl)throw Error("Unable to create ExportMapTask from the resource.");}b.prototype._populateFromResource=function(a){if(a instanceof h.Map)this._esriMap=a.getMap(),this._essentialsRestUrl=a.url+"/export",this._site=a.site;else if(a instanceof h.PrintTemplate)this._esriMap=a.site.getMap(),this._essentialsRestUrl=
a.url+"/print",this._site=a.site;else if(a instanceof h.Report)this._esriMap=a.site.getMap(),this._essentialsRestUrl=a.url+"/run",this._site=a.site};b.prototype.generateMapImageUrl=function(a){var g=this,i=new dojo.Deferred;this._marshalContent(a).then(function(a){c.request({url:g._essentialsRestUrl,content:a,load:i.resolve,error:i.reject,callbackParamName:"CallBack"})});return i};b.prototype._getWebMap=function(a,g){return a._getPrintDefinition(g,new esri.tasks.PrintTemplate)};b.prototype._getPrintingObjectForEssentials=
function(){var a=new dojo.Deferred,g=new esri.tasks.PrintTask("http://3275ec4b-ad36-465e-97e9-a20acaae8d53/",{async:false}),i;try{i=this._getWebMap(g,this._esriMap)}catch(b){a.reject(Error("Could not create ExportContext definition. {0} Verify that subroutines have not changed.".format(b&&b.message?b.message:"Unable to determine cause.")))}i?(this._handleFeatureLayers(i),this._handleDynamicLayerDefs(i),this._cleanOutVisibility(i),this._handleWebTiledLayers(i),this._handleLayersAttribution(i,this._esriMap),
this._handleHeatmapRenderer(i,this._esriMap),this._handleClusters(i,this._esriMap),this._adjustMeasurementSymbols(i),this._removeAttributes(i),this._adjustText(i),this._setServiceVisibilities(i),this._convertSymbolsToBase64(i).then(function(g){return a.resolve(g)},function(g){return a.reject(Error("Converting symbols to base64 failed: {0}".format(g&&g.message?g.message:"Unable to determine cause")))})):a.reject(Error("ExportContext definition was empty"));return a};b.prototype._convertSymbolsToBase64=
function(a){for(var g=new dojo.Deferred,i=[],b={},c=0;c<a.operationalLayers.length;c++){var d=a.operationalLayers[c];if(d.featureCollection&&d.featureCollection.layers)for(var f=0;f<d.featureCollection.layers.length;f++){var m=d.featureCollection.layers[f];if(m.featureSet&&m.featureSet.features)for(var n=0;n<m.featureSet.features.length;n++){var o=m.featureSet.features[n];if(o&&o.symbol&&o.symbol.type==="esriPMS")o=o.symbol,o.url&&i.push(o)}}}if(!Modernizr||!Modernizr.canvas){for(c=0;c<i.length;c++){var q=
i[c].url;if(q)i[c].url=h.utilities.UrlUtilities.simplify(q)}g.resolve(a)}else{d=[];for(c=0;c<i.length;c++)if((q=i[c].url)&&!b.hasOwnProperty(q)&&!i[c].imageData)b[q]={url:null,data:null},f=h.utilities.PrintUtilities.getImageAsBase64(q),d.push(f);h.utilities.PromiseUtilities.settle(d).then(function(c){c.forEach(function(a){a.isFulfilled()?(a=a.value())&&a.url&&a.data&&(b[a.url]={data:a.data}):(a=a.reason())&&a.url&&(b[a.url]={url:h.utilities.UrlUtilities.simplify(q)});for(a=0;a<i.length;a++){var g=
i[a],c=b[g.url];if(c)if(c.data)g.imageData=c.data,delete g.url;else if(c.url)g.url=c.url;g.yoffset&&(g.yoffset*=-1)}});g.resolve(a)})}return g};b.prototype._adjustMeasurementSymbols=function(a){for(var g=0;g<a.operationalLayers.length;g++){var i=a.operationalLayers[g];if(i&&i.id&&i.id.indexOf("_measurement")>-1&&i.featureCollection&&i.featureCollection.layers){var b=[],c=this._esriMap.getLayer(i.id);if(c&&c.graphics){for(var c=c.graphics,d=0;d<c.length;d++){var f=c[d];if(f.symbol instanceof esri.symbol.PictureMarkerSymbol){var m=
h.utilities.PrintUtilities.adjustPictureMarkerSymbol(f);if(m)f=new esri.Graphic(f.toJson()),f.symbol=m,b.push(f.toJson())}}for(d=0;d<i.featureCollection.layers.length;d++)if(i.featureCollection.layers[d].layerDefinition.name==="pointLayer")i.featureCollection.layers[d].featureSet.features=b}}}};b.prototype._adjustText=function(a){for(var g=0;g<a.operationalLayers.length;g++){var i=a.operationalLayers[g];if(i&&i.id&&i.featureCollection&&i.featureCollection.layers){for(var b=false,c=0;c<i.featureCollection.layers.length;c++){var d=
i.featureCollection.layers[c];if(d&&d.layerDefinition&&d.layerDefinition.name==="textLayer"){b=true;break}}if(b&&(b=[],(c=this._esriMap.getLayer(i.id))&&c.graphics)){c=c.graphics;for(d=0;d<c.length;d++){var f=c[d];if(f.symbol instanceof esri.symbol.TextSymbol){var m=h.utilities.PrintUtilities.adjustTextSymbol(f);if(m)f=new esri.Graphic(f.toJson()),f.symbol=m,b.push(f.toJson())}}for(d=0;d<i.featureCollection.layers.length;d++)if(i.featureCollection.layers[d].layerDefinition.name==="textLayer")i.featureCollection.layers[d].featureSet.features=
b}}}};b.prototype._setServiceVisibilities=function(a){if(a.operationalLayers)for(var a=a.operationalLayers,g=0;g<a.length;g++){var i=a[g],b=this._esriMap.getLayer(i.id);if(i)i.visibility=b?b.visible:true}};b.prototype._handleDynamicLayerDefs=function(a){if(this._site&&a.operationalLayers)for(var a=a.operationalLayers,g=0;g<a.length;g++){var b=this._site.essentialsMap.findMapServiceById(a[g].id);if(b&&b.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){var c=a[g];if(c&&c.layers){for(var d=
[],l=[],f=c.layers,h=0;h<f.length;h++){var n=f[h];if(n&&(n.id||n.id===0)){var o=n.id,q={id:o};l.push(o);if(n.layerDefinition&&n.layerDefinition.definitionExpression)q.layerDef=n.layerDefinition.definitionExpression;if((n=b.findLayerById(o))&&n.displayName)q.displayName=n.displayName;d.push(q)}}c.visibleLayers=b.serviceLayer.visibleLayers;c.visibility=true;c.layers=d}}}};b.prototype._handleFeatureLayers=function(a){if(this._site&&a.operationalLayers)for(var a=a.operationalLayers,g=0;g<a.length;g++){var b=
a[g].id,c=this._site.essentialsMap.findMapServiceById(b);if(c&&c.serviceLayer instanceof esri.layers.FeatureLayer){c=a[g];b={id:b,opacity:c.opacity,visibility:true,url:c.url,minScale:c.minScale?c.minScale:0,maxScale:c.maxScale?c.maxScale:0};if(c.layerDefinition){if(c.layerDefinition.drawingInfo)b.drawingInfo=c.layerDefinition.drawingInfo;if(c.layerDefinition.definitionExpression)b.where=c.layerDefinition.definitionExpression}a[g]=b}}};b.prototype._cleanOutVisibility=function(a){if(a.operationalLayers)for(var a=
a.operationalLayers,g=0;g<a.length;g++)if(a[g].visibleLayers)for(var b=0;b<a[g].visibleLayers.length;b++)if(a[g].visibleLayers[b]==-1){a[g].visibleLayers.splice(b,1);break}};b.prototype._handleWebTiledLayers=function(a){if(a.operationalLayers)for(var a=a.operationalLayers,g=0;g<a.length;g++)if(a[g].type===f.ExportMapTypes.WEBTILED)a[g]={id:a[g].id,opacity:a[g].opacity,visibility:true};else if(a[g].type===f.ExportMapTypes.BINGAERIAL||a[g].type===f.ExportMapTypes.BINGAERIALLABELS||a[g].type===f.ExportMapTypes.BINGHYBRID||
a[g].type===f.ExportMapTypes.BINGROADS){if(a[g].type===f.ExportMapTypes.BINGAERIALLABELS)a[g].type=f.ExportMapTypes.BINGHYBRID;a[g]={id:a[g].id,opacity:a[g].opacity,visibility:true,type:a[g].type,token:a[g].key,serverType:f.BingEnvironment.PRODUCTION}}};b.prototype._handleLayersAttribution=function(a,g){var b=g.layerIds.concat(g.graphicsLayerIds),c=/.*mapservices\/([^/]*)\/Attribution[^/]*/;a.operationalLayers.forEach(function(a){for(var d in b)if(b.hasOwnProperty(d)){var f=b[d];if(a.id===f){d=g.getLayer(f);
if(d.hasAttributionData&&d.attributionDataUrl){if((d=c.exec(d.attributionDataUrl))&&d.length>1)a.mapServiceId=d[1]}else if(d.layerId)a.mapServiceId=d.layerId;break}}})};b.prototype._handleHeatmapRenderer=function(a,g){var b=g.layerIds.concat(g.graphicsLayerIds);a.operationalLayers.forEach(function(a,g,b){a.id.startsWith("null_image")&&b.splice(g,1)});b.forEach(function(b){var i=g.getLayer(b);if(i.visible&&i.renderer!==void 0&&i.renderer instanceof esri.renderer.HeatmapRenderer){var c=i.minScale?i.minScale:
0,d=i.maxScale?i.maxScale:0,f=i.getDefinitionExpression()?i.getDefinitionExpression():"",h=i.gdbVersion?i.gdbVersion:"",o=i.renderer.toJson();a.operationalLayers.push({type:"HeatMap",id:b,opacity:1,minScale:c,maxScale:d,where:f,gdbVersion:h,url:i.url,layerDefinition:{name:i.name,geometryType:"esriGeometryPoint",displayField:i.renderer.field?i.renderer.field:""},drawingInfo:{renderer:o}})}})};b.prototype._handleClusters=function(a,g){var b=g.layerIds.concat(g.graphicsLayerIds),c=[];a.operationalLayers.forEach(function(a){a.id.endsWith("-cluster")&&
c.push(a.id)});c.forEach(function(g){for(var b=0;b<a.operationalLayers.length;++b)if(a.operationalLayers[b].id===g){a.operationalLayers.splice(b,1);break}});b.forEach(function(b){var i=g.getLayer(b);if(i.id.endsWith("-cluster")&&i.visible&&i.renderer!==void 0&&i.renderer instanceof esri.renderer.ClassBreaksRenderer&&i.featureLayer&&i.singleFeatureLayer){for(var c=i.featureLayer,d=c.id,p=i.url,f=i.renderer.attributeField,h=i.clusterRadius.get(),r=i.maxFeaturesInCluster.get(),s=i._clusterLabelColor,
u=i.singleFeatureLayer.renderer.toJson(),t=i.renderer.toJson(),v=c.name,x=c.minScale?c.minScale:0,y=c.maxScale?c.maxScale:0,z=c.getDefinitionExpression()?c.getDefinitionExpression():"",A=c.gdbVersion?c.gdbVersion:"",w=0;w<a.operationalLayers.length;++w)if(a.operationalLayers[w].id===d&&c.renderer===null){a.operationalLayers.splice(w,1);break}i.singleFeatureLayer.graphics.length==0&&a.operationalLayers.push({type:"Cluster",id:b,opacity:1,minScale:x,maxScale:y,where:z,gdbVersion:A,url:p,layerDefinition:{name:v,
geometryType:"esriGeometryPoint",displayField:f},drawingInfo:{renderer:t,singleSymbolRenderer:u,labelColor:s,distance:h,maxFeaturesInCluster:r}})}})};b.prototype._removeAttributes=function(a){if(a.operationalLayers)for(var g=0;g<a.operationalLayers.length;g++){var b=a.operationalLayers[g];if(b&&b.featureCollection&&b.featureCollection.layers)for(var c=0;c<b.featureCollection.layers.length;c++){var d=b.featureCollection.layers[c];if((!d||!d.layerDefinition||!d.layerDefinition.drawingInfo||!d.layerDefinition.drawingInfo.renderer||
!(d.layerDefinition.drawingInfo.renderer.type==="uniqueValue"||d.layerDefinition.drawingInfo.renderer.type==="classBreaks"))&&d&&d.featureSet&&d.featureSet.features)for(var f=0;f<d.featureSet.features.length;f++){var h=d.featureSet.features[f];h&&h.attributes&&delete h.attributes}}}};b.prototype._marshalContent=function(a){var g=this,b=new dojo.Deferred;this._getPrintingObjectForEssentials().then(function(d){var j={f:"json","if":"WebMap,blankMap"};if(g._site)d.product="Geocortex Essentials "+g._site.currentVersion;
if(a.reportParameters){var f=a.reportParameters;if(!d.mapOptions)d.mapOptions={extent:null};delete d.mapOptions.scale;if(f.scale){var h=parseFloat(f.scale.scale);if(h&&!isNaN(h))d.mapOptions.scale=h}if(f.targetSpatialReference)d.mapOptions.spatialReference=f.targetSpatialReference;if(f.extentType==c.essentials.ReportParameters.CURRENT_EXTENT&&g._esriMap)d.mapOptions.extent=g._esriMap.extent;else if(f.extentType==c.essentials.ReportParameters.FULL_EXTENT&&g._site&&g._site.essentialsMap)d.mapOptions.extent=
g._site.essentialsMap.fullExtent;else if(f.extentType==c.essentials.ReportParameters.INITIAL_EXTENT&&g._site&&g._site.essentialsMap)d.mapOptions.extent=g._site.essentialsMap.initialExtent;else if(f.extentType==c.essentials.ReportParameters.CUSTOM_EXTENT&&f.customExtent)d.mapOptions.extent=f.customExtent;h={dpi:null,outputSize:[]};h.outputSize[0]=f.imageWidth?f.imageWidth:g._esriMap.width;h.outputSize[1]=f.imageHeight?f.imageHeight:g._esriMap.height;h.dpi=f.resolution?f.resolution.dpi:96;d.exportOptions=
h;if(f.grid&&f.grid.id)d.layoutOptions={grid:f.grid.id};if(f.fields&&f.fields.length>0)for(h=0;h<f.fields.length;h++)j[f.fields[h].id]=f.fields[h].value;if(f.outputFormat)j.outputFormat=f.outputFormat;if(f.featureIds)j.featureIDs=f.featureIds.join(",");if(f.includeGeoreferenceData)j.georef=f.includeGeoreferenceData}if(a.queryParameters&&(j=dojo.mixin(a.queryParameters,j),j.geometry))j.geometry=JSON.stringify(j.geometry);a.operationParameters&&(j=dojo.mixin(a.operationParameters,j));if(f.notificationEmailAddress)j.emailAddress=
f.notificationEmailAddress;j.data=JSON.stringify(d);b.resolve(j)},function(a){return b.reject(Error("Failed to serialize ExportContext content: {0}".format(a&&a.message?a.message:"Unable to determine cause")))});return b};return b}();f.ExportMapTask=d})(h.exportMap||(h.exportMap={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){function a(){this.state={fulfilled:false,rejected:false}}a.prototype.fulfill=function(a){this.state.fulfilled=true;this.state.value=a};a.prototype.reject=function(a){this.state.rejected=true;this.state.reason=a};a.prototype.isFulfilled=function(){return this.state.fulfilled};a.prototype.isRejected=function(){return this.state.rejected};a.prototype.isPending=function(){return!this.state.fulfilled&&!this.state.rejected};a.prototype.value=function(){return this.state.value};
a.prototype.reason=function(){return this.state.reason};return a}(),b=function(){function a(){}a.settle=function(g){if(dojo.isArray(g))return a._settleImpl(g);else if(g.then)return g.then(function(g){return a._settleImpl(g)});throw Error("Unknown parameter type.  Must be an array of promises or a promise of array of promises.");};a._settleImpl=function(a){var b=new dojo.Deferred,c,j=a.map(function(a){var g=new d;!a||typeof a.then!="function"?g.fulfill(a):a.then(function(a){g.fulfill(a);c&&c()},function(a){g.reject(a);
c&&c()});return g});c=function(){j.every(function(a){return!a.isPending()})&&b.resolve(j)};c();return b.promise};return a}();c.PromiseUtilities=b})(c.utilities||(c.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f;(function(c){c[c.NONE=-1]="NONE";c[c.RESIZE=0]="RESIZE";c[c.REPOSITION=1]="REPOSITION";c[c.EXTENT_CHANGE=2]="EXTENT_CHANGE"})(f||(f={}));f=function(){function c(b,a){this._map=null;this._queuedExtentChangePriority=this._currentExtentChangePriority=-1;this._queuedExtentChange=[];this._fitTiledMapsToExtent=this._extentChangeInProgress=false;this._newLayers=[];this.currentExtentChangeHandle=this._initialExtent=null;this._firstMapResizeExecuted=false;this._map=b;this._fitTiledMapsToExtent=
!!a;this._map.on("resize",dojo.hitch(this,this._onResize));this._map.on("reposition",dojo.hitch(this,this._onReposition))}c.prototype.setInitialExtent=function(b){var a=this;if(this._map&&this._map.loaded)this._setInitialExtentImpl(b);else this._map.on("load",function(){return a._setInitialExtentImpl(b)})};c.prototype._setInitialExtentImpl=function(b){this._initialExtent=b;this._map.resize(true);this._map.setExtent(b,this._fitTiledMapsToExtent);this._firstMapResizeExecuted=true};c.prototype._onResize=
function(){this._firstMapResizeExecuted?this._handleNextExtentChange():(this._firstMapResizeExecuted=true,this.firstResize())};c.prototype._onReposition=function(){this._handleNextExtentChange()};c.prototype._onExtentChange=function(){if(this._extentChangeInProgress)this._currentExtentChangePriority=-1,this._extentChangeInProgress=false,this._handleNextExtentChange()};c.prototype.registerLayer=function(b){this._hasLoaded()||this._newLayers.push(b)};c.prototype.firstResize=function(){this._initialExtent&&
this._map.extent&&!this._fitTiledMapsToExtent&&this._map.extent.expand(1.75).contains(this._initialExtent);this._handleNextExtentChange()};c.prototype._handleNextExtentChange=function(){if(this._hasLoaded())if(this._queuedExtentChange[0]!==null&&typeof this._queuedExtentChange[0]!=="undefined"){var b=this._queuedExtentChange[0];this._queuedExtentChange[0]=null;b(this._map)}else if(this._queuedExtentChange[1]!==null&&typeof this._queuedExtentChange[1]!=="undefined")b=this._queuedExtentChange[1],this._queuedExtentChange[1]=
null,b(this._map);else if(this._queuedExtentChange[2]!==null&&typeof this._queuedExtentChange[2]!=="undefined")this._extentChangeInProgress=true,this._currentExtentChangePriority=this._queuedExtentChangePriority,this._queuedExtentChangePriority=-1,b=this._queuedExtentChange[2],this._queuedExtentChange[2]=null,b(this._map)};c.prototype.changeExtentWithPriority=function(b,a){var g=this,i=typeof a!=="undefined"?a:5,c=function(a){g.currentExtentChangeHandle!==null&&g.currentExtentChangeHandle.cancel();
g.currentExtentChangeHandle=b(a);g.currentExtentChangeHandle.then(dojo.hitch(g,g._onExtentChange),dojo.hitch(g,g._onExtentChange))};if(this._isExtentChangeBlocked()){if(!(i<this._queuedExtentChangePriority))this._queuedExtentChangePriority=i,this._queuedExtentChange[2]=c}else if(!(i<this._currentExtentChangePriority))this._currentExtentChangePriority=i,this._extentChangeInProgress=true,c(this._map)};c.prototype.setExtentWithPriority=function(b,a){var g=this;this.changeExtentWithPriority(function(a){return a.setExtent(b,
g._fitTiledMapsToExtent)},a)};c.prototype.centerAtWithPriority=function(b,a){this.changeExtentWithPriority(function(a){var i=a.extent.getCenter(),c=a.extent.getWidth()/a.width,d=a.extent.getHeight()/a.height;return Math.abs(i.x-b.x)>=c||Math.abs(i.y-b.y)>=d?a.centerAt(b):(a=new dojo.Deferred,a.resolve(),a)},a)};c.prototype.setScaleWithPriority=function(b,a){this.changeExtentWithPriority(function(a){return a.setScale(b)},a)};c.prototype.blockForResize=function(b,a,g){b==this._map.width&&a==this._map.height||
(this._isResizeBlocked()?this._queuedExtentChange[0]=function(a){a.resize(g)}:this._map.resize(g))};c.prototype.blockForReposition=function(){this._isRepositionBlocked()?this._queuedExtentChange[1]=function(b){b.resize()}:this._map.resize()};c.prototype._isExtentChangeBlocked=function(){return this._queuedExtentChange[1]!=null||this._queuedExtentChange[0]!=null||!this._hasLoaded()};c.prototype._isRepositionBlocked=function(){return this._extentChangeInProgress||!this._hasLoaded()};c.prototype._isResizeBlocked=
function(){return this._isRepositionBlocked()};c.prototype._hasLoaded=function(){return this._map&&this._map.loaded&&this._firstMapResizeExecuted};return c}();c.ExtentManager=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(){}}();c.EssentialsLayerInfo=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(){function b(a,g){this.isRequired=new Observable(false);this.isValid=new Observable(true);this.isVisible=new Observable(true);this.argumentName=null;this.validationItems=[];this.formDefinition=g||null;this.attached_indicatorClass=new Observable("");this.attached_showIndicator=new Observable("");if(a){this.toolTip=new Observable(c.forms.getElementText(a,"ToolTip"));this.itemID=new Observable(c.forms.getElementText(a,"ItemID"));this.argumentName=
new Observable(c.forms.getElementText(a,"ArgumentName"));var b=c.forms.getElementText(a,"IsVisible");b&&this.isVisible.set(c.forms._parseBoolean(b));b=c.forms.getElement(a,"ValidationItems");if(b!=null)for(var d=0;d<b.childNodes.length;d++){var j=c.forms.items._processValidationItem(b.childNodes[d]);j instanceof c.forms.items.validation.RequiredValidationItem&&this.isRequired.set(true);j!=null&&this.validationItems.push(j)}}else this.toolTip=new Observable(""),this.itemID=new Observable(null),this.argumentName=
new Observable(null)}b.prototype.getResult=function(){return null};b.prototype._notifyResultChanged=function(){dojo.publish("FormItemResultChangedEvent",[this])};b.prototype.refresh=function(){};b.prototype.validate=function(){var a=[];this.isValid.set(true);if(this.validationItems!=null)for(var g=0;g<this.validationItems.length;g++){var b=this.getResult();if(b!=null)b=b.value;b=this.validationItems[g].validate(b);b.isValid||(this.isValid.set(false),a.push(b))}return a};b.prototype._render=function(){return document.createTextNode(this.itemID.get())};
b.prototype._destroy=function(){};return b}();f.AbstractFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));var __extends=this.__extends||function(c,h){function f(){this.constructor=c}for(var d in h)h.hasOwnProperty(d)&&(c[d]=h[d]);f.prototype=h.prototype;c.prototype=new f};
(function(c){(function(h){(function(f){var d=function(b){function a(a,i){b.call(this,a,i);this.formItemType="LabelFormItem";a?(this.text=new Observable(c.forms.getElementText(a,"Text")),this.labelForItemID=new Observable(c.forms.getElementText(a,"LabelForItemID"))):(this.text=new Observable(null),this.labelForItemID=new Observable(null))}__extends(a,b);a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.LabelFormItem=d})(h.items||(h.items={}))})(c.forms||
(c.forms={}))})(geocortex||(geocortex={}));(function(c){(function(h){(function(f){f.initLabelContainer=function(d,b){b?(d.label=new f.LabelFormItem(c.forms.getElement(b,"Label")),d.label.toolTip.get()==""&&d.toolTip!=null&&d.label.toolTip.set(d.toolTip.get())):d.label=new c.forms.items.LabelFormItem(null)}})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){return function(b,a,g){this.isList=false;this.argumentName=b;this.value=a;this.wasSet=g||false}}();c.FormItemResult=d})(c.items||(c.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,i){var d=this;b.call(this,a,i);this.formItemType="TextBoxFormItem";if(a){var j=c.forms.getElementText(a,"DefaultText");this.defaultText=new Observable(j);this.text=new Observable(j);this.inputScope=new Observable(c.forms.getElementText(a,"InputScope"));this.textboxWidth=new Observable(parseInt(c.forms.getElementText(a,"TextboxWidth")))}else this.defaultText=new Observable(""),this.text=new Observable(""),this.inputScope=new Observable("Default"),
this.textboxWidth=new Observable(NaN);this.readOnly=new Observable(false);f.initLabelContainer(this,a,i);this.text.bind(null,function(){return d._notifyResultChanged()})}__extends(a,b);a.prototype.getResult=function(){return new f.FormItemResult(this.argumentName.get(),this.text.get())};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.TextBoxFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,i){b.call(this,a,i);this.formItemType="TextAreaFormItem";this.textboxHeight=a?new Observable(parseInt(c.forms.getElementText(a,"TextboxHeight"))):new Observable(1)}__extends(a,b);return a}(f.TextBoxFormItem);f.TextAreaFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c,b){this.className=c;this.instance=b}}();c.Extension=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,g,i){var d=this;this._timer=null;this.userName=this._endpointUrl=this._siteId="";this._extentConnect=null;this._numConsecutiveFailures=0;this._enabled=true;this._sessionId="";this._previousScale=-1;this._firstExtentLogged=false;this._map=b;if(a)this._siteId=a;this._endpointUrl=g?g:window.location.protocol+"//"+window.location.host+"/Geocortex/Optimizer/Rest/DataRelay/LogData.ashx?f=json";if(i)this.userName=i;this._pendingEvents=[];this._timer=
new c.framework.utils.TimeDelayedAction(3E3,this._flushQueue,this);var j={};j.extent=this._map.extent;if(b.loaded)this._logExtentChange(j),this._extentConnect=b.on("extent-change",dojo.hitch(this,"_logExtentChange"));else b.on("load",function(){d._logExtentChange(j);d._extentConnect=b.on("extent-change",dojo.hitch(d,"_logExtentChange"))});this._sessionId=this._crc32((new Date).getTime()+""+navigator.userAgent)}d.prototype._logExtentChange=function(b){if(this._enabled){var a;a={data:[{name:"ArcGISExtents",
columns:{}}]};a.data[0].columns=[{type:"tinyint",name:"InitialExtent",key:"InitialExtent"},{type:"real",name:"XMinNew",key:"XMinNew"},{type:"real",name:"YMinNew",key:"YMinNew"},{type:"real",name:"XMaxNew",key:"XMaxNew"},{type:"real",name:"YMaxNew",key:"YMaxNew"}];a.data[0].rows=[{InitialExtent:this._firstExtentLogged?0:1,XMinNew:b.extent.xmin,YMinNew:b.extent.ymin,XMaxNew:b.extent.xmax,YMaxNew:b.extent.ymax}];this._queueData(a);this._firstExtentLogged=true;if(b.lod)b.levelChange&&this._previousScale>
-1&&this._logScaleChange(this._previousScale,b.lod.scale),this._previousScale=b.lod.scale;else if(b=this._map.getScale(),b!==null)this._previousScale!=b&&this._previousScale>-1&&this._logScaleChange(this._previousScale,b),this._previousScale=b}};d.prototype._logScaleChange=function(b,a){if(this._enabled){var g={data:[{name:"ArcGISScale",columns:[]}]};g.data[0].columns=[{type:"float",name:"ScaleOld",key:"ScaleOld"},{type:"float",name:"ScaleNew",key:"ScaleNew"}];g.data[0].rows=[{ScaleOld:b,ScaleNew:a}];
this._queueData(g)}};d.prototype.logToolUsage=function(b,a){if(this._enabled){var g={data:[{name:"ArcGISTool",columns:[]}]};g.data[0].columns=[{type:"ustr",name:"Tool",key:"Tool"},{type:"ustr",name:"ToolData",key:"ToolData"}];g.data[0].rows=[{Tool:b,ToolData:a}];this._queueData(g)}};d.prototype._queueData=function(b){b.platform="js";b.data[0].columns.push({type:"now",name:"SampleTime",key:"SampleTime"},{type:"origin",name:"UserAddress",key:"UserAddress"},{type:"ustr",name:"SiteId",key:"SiteId"},{type:"ustr",
name:"UserAgent",key:"UserAgent"},{type:"ustr",name:"UserName",key:"UserName"},{type:"ustr",name:"LayerList",key:"LayerList"},{type:"int",name:"SessionId",key:"SessionId"},{type:"ustr",name:"ClientType",key:"ClientType"},{type:"host",name:"MachineName",key:"MachineName"});dojo.mixin(b.data[0].rows[0],{SiteId:this._siteId,UserAgent:navigator.userAgent,UserName:this.userName,LayerList:this._getCurrentLayerList(),SessionId:this._sessionId,ClientType:"JavaScript"});this._pendingEvents.push(b);this._timer.reset()};
d.prototype._flushQueue=function(){for(this._timer.stop();this._pendingEvents.length>0;)this._logData(this._pendingEvents.shift())};d.prototype._logData=function(b){try{dojo.xhrPost({url:this._endpointUrl,postData:JSON.stringify(b),timeout:1E4,load:dojo.hitch(this,this._handleLogSuccessResponse),error:dojo.hitch(this,this._handleLogErrorResponse)})}catch(a){this._incrementFailures()}};d.prototype._handleLogSuccessResponse=function(){this._numConsecutiveFailures=0};d.prototype._handleLogErrorResponse=
function(){this._incrementFailures()};d.prototype._incrementFailures=function(){this._numConsecutiveFailures++;if(this._numConsecutiveFailures>2)dojo.disconnect(this._extentConnect),this._enabled=false};d.prototype._getCurrentLayerList=function(){for(var b="",a=this._map.layerIds,g=0;g<a.length;g++){var i=this._map.getLayer(a[g]);if(i!=null&&i.visible&&i.visibleAtMapScale){var c;if(i instanceof esri.layers.ArcGISDynamicMapServiceLayer){var d=i;for(c=0;c<d.visibleLayers.length;c++)d.visibleLayers[c]==
null||d.visibleLayers[c]==-1||(b+=d.layerInfos.filter(function(a){return a.id==d.visibleLayers[c]})[0].name+"\\t")}else if(i instanceof esri.virtualearth.VETiledLayer)b+="Bing:"+i.mapStyle+"\\t";else if(i instanceof esri.layers.ArcGISImageServiceLayer)b+="Image:"+i.url+"\\t";else if(i instanceof esri.layers.ArcGISTiledMapServiceLayer)for(c=0;c<i.layerInfos.length;c++)i.layerInfos[c]!=null&&(b+=i.layerInfos[c].name+"\\t")}}b.length>3&&(b=b.substring(0,b.length-2));return b};d.prototype._crc32=function(b){for(var b=
b.replace(/\r\n/g,"\n"),a="",g=0;g<b.length;g++){var i=b.charCodeAt(g);i<128?a+=String.fromCharCode(i):(i>127&&i<2048?a+=String.fromCharCode(i>>6|192):(a+=String.fromCharCode(i>>12|224),a+=String.fromCharCode(i>>6&63|128)),a+=String.fromCharCode(i&63|128))}var b=a,a=0,c;a^=-1;g=0;for(i=b.length;g<i;g++)c=(a^b.charCodeAt(g))&255,c="0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(c*
9,8),a=a>>>8^c;a^=-1;return a.toString()};return d}();h.EventRelay=f})(c.optimizer||(c.optimizer={}))})(geocortex||(geocortex={}));
(function(c){function h(c){var d,b,a={};b=typeof c;if(c!==null&&(b==="number"||b==="boolean"||b==="string"))return c;typeof c.toJson==="function"&&(a=c.toJson());for(var g in c)if(!(g=="declaredClass"||g.indexOf("_inherited")>-1||a[g]!==void 0))if(d=c[g],b=typeof d,d!==null&&d!==void 0&&b!=="function")if(dojo.isArray(d)){a[g]=[];b=0;for(var i=d.length;b<i;b++)a[g][b]=h(d[b])}else a[g]=b==="object"?typeof d.toJson==="function"?d.toJson():h(d):d;return a}c.config={baseUrl:"http://localhost/",io:{errorHandler:function(c){dojo.publish("geocortex.Error",
[c])},postLength:2E3,timeout:6E4},REST_version:"3.0",authenticationDialogId:null};c.deferredResolve=function(c,d){c&&c.fired==-1&&c.resolve(d)};c.deferredReject=function(c,d){c&&c.fired==-1&&c.reject(d)};c.encodeJson=function(c){var c=h(c),d={},b;for(b in c)d[b]=dojo.isArray(c[b])||typeof c[b]==="object"?JSON.stringify(c[b]):c[b];return d};c.request=function(f,d){d||(d={});if(!d.gcx)d.gcx={};f.preventCache=d.gcx.preventCache===void 0?true:d.gcx.preventCache?true:false;f.timeout=f.timeout||c.config.io.timeout;
f.handleAs=f.handleAs||"json";var b=c.requiresProxy(f),a=c.hasProxy();if(b&&!a)return b=Error("Cross-domain or large requests require a proxy."),dojo.isFunction(f.error)&&f.error(b),a=new dojo.Deferred,a.errback(b),a;delete f.gcx;d.useProxy=b;if(!d.hasOwnProperty("disableIdentityLookup"))d.disableIdentityLookup=true;return(new c.essentials.RestHelperHTTPService(f,d)).send()};c.hasProxy=function(){var c=false;try{c=esri._getProxyUrl()}catch(d){}return c};c.requiresProxy=function(f){var d=false;try{var b=
f.url.length;f.content&&(b+=dojo.objectToQuery(f.content).length);var a=new dojo._Url(f.url),g=window.location;if(!a.scheme&&!a.host&&!a.port)return false;var i=g.protocol+"//"+g.hostname+(g.port?":"+g.port:"")!==a.scheme+"://"+a.host+(a.port?":"+a.port:""),d=b>c.config.io.postLength&&i}catch(p){}return d};c.urlToQueryObject=function(c){var d=c.indexOf("?");return d===-1?null:dojo.queryToObject(c.substring(d+1))};c._getExtensions=function(f){var d=[];if(!f)return d;d.length=f.length;for(var b=0;b<
f.length;b++)d[b]=new c.essentials.Extension(f[b].className,f[b].instance);return d};c._getProperties=function(c){var d={};if(!c)return d;for(var b=0;b<c.length;b++)d[c[b].name]=c[b].value;return d}})(geocortex||(geocortex={}));Date.now||(Date.now=function(){return+new Date});
(function(c){(function(c){var f=function(){return function(){this.password=this.messageFromServer=null;this.pendingCalls=[];this.username=this.token=this.targetRootUri=this.tokenRootUri=this.tokenService=null}}();c.AuthenticationControlBlock=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function c(){this._authenticationControlBlocks=[]}c.prototype.add=function(b){this.find(b.tokenRootUri)===null&&this._authenticationControlBlocks.push(b)};c.prototype.remove=function(b){for(var a=0;a<this._authenticationControlBlocks.length;a++)if(this._authenticationControlBlocks[a]===b)return this._authenticationControlBlocks.splice(a,1),true;return false};c.prototype.find=function(b){for(var a=0;a<this._authenticationControlBlocks.length;a++){var g=this._authenticationControlBlocks[a],
i=g.tokenRootUri,c=g.targetRootUri;if(b.toLowerCase().indexOf(i.toLowerCase())===0||b.toLowerCase().indexOf(c.toLowerCase())===0)return g}return null};c.prototype.removeAt=function(b){this._authenticationControlBlocks.splice(b,1)};return c}();c.AuthenticationControlBlockStore=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a){this._error=this._handle=this.optionsObject=this.requestObject=null;this._deferred=new dojo.Deferred;if(b!==void 0){this.requestObject=b;if(dojo.isFunction(this.requestObject.error))this._error=this.requestObject.error,this.requestObject.error=null;if(dojo.isFunction(this.requestObject.handle))this._handle=this.requestObject.handle;this.requestObject.handle=dojo.hitch(this,this._handleProxy)}if(a!==void 0)this.optionsObject=a}d.getAuthenticationControlBlockStore=
function(){return d._controlBlocks};d.prototype._handleProxy=function(b,a){this._isUnauthorizedResponse(b)===false&&dojo.isFunction(this._handle)&&this._handle(b,a)};d.prototype._requestCallback=function(b){this._deferred.resolve(b)};d.prototype._requestErrback=function(b){this._isUnauthorizedResponse(b)?this._handleUnauthenticated(b):(dojo.isFunction(this._error)&&this._error(b),this._deferred.reject(b))};d.prototype._isUnauthorizedResponse=function(b){return b&&b.code===401?true:false};d.prototype._handleUnauthenticated=
function(b){if(b&&b.tokenService){if(c.hasProxy()===false)throw Error("No proxy page is configured - a proxy page is required to access secured Sites");var a=this.requestObject.url,g=b.tokenService,i=c.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);if(i===null||i.token!==null&&i.token!==""){var d=new dojo._Url(a),g=d.scheme+"://"+d.host+(d.port&&d.port!=="80"?":"+d.port:"")+g;i||(i=new c.essentials.AuthenticationControlBlock);i.messageFromServer=b.message;i.token===null?
(i.tokenService=g,i.tokenRootUri=g.substring(0,g.lastIndexOf("/")),i.targetRootUri=a.substring(0,a.lastIndexOf("/")),i.pendingCalls.push(this),c.essentials.RestHelperHTTPService._controlBlocks.add(i),this._gatherCredentials().then(dojo.hitch(this,function(a){i.username=a.username;i.password=a.password;this._requestToken(i)}))):(i.token=null,i.pendingCalls=[],i.pendingCalls.push(this),this._requestToken(i))}else{b=false;for(a=0;a<i.pendingCalls.length;a++)if(i.pendingCalls[a]===this){b=true;break}b===
false&&i.pendingCalls.push(this)}}else dojo.isFunction(this._error)&&this._error(b),this._deferred.reject(b)};d.prototype._gatherCredentials=function(b){var a;a=b===void 0?new dojo.Deferred:b;if(!dijit.Dialog||!dijit.form||!dijit.form.TextBox||!dijit.form.Button)dojo.require("dijit.Dialog"),dojo.require("dijit.form.TextBox"),dojo.require("dijit.form.Button"),dojo.addOnLoad(dojo.hitch(this,function(){this._gatherCredentials(a)}));else{var g=c.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url),
b=c.config.authenticationDialogId,i;b?i=dijit.byId(b):b=c.config.authenticationDialogId="geocortex_authenticationDialog_default";if(!i||!(i instanceof dijit.Dialog))i=new dijit.Dialog({title:"Authentication Required",id:b,content:this._createAuthDialogContent()});dojo.html.set(dojo.byId(b+"_message"),g.messageFromServer||"");var g=dijit.byId(b+"_ok"),b=dijit.byId(b+"_cancel"),d,j,f;d=dojo.connect(g,"onClick",function(){dojo.forEach([d,j,f],dojo.disconnect);var g=i.attr("value");a.resolve({username:g.username,
password:g.password})});j=dojo.connect(b,"onClick",function(){dojo.forEach([d,j,f],dojo.disconnect);i.hide();a.cancel()});f=dojo.connect(i,"onCancel",function(){dojo.forEach([d,j,f],dojo.disconnect);a.cancel()});i.show()}return a};d.prototype._createAuthDialogContent=function(){var b=c.config.authenticationDialogId,a=new dijit.form.TextBox({name:"username",id:"gcx_auth_username"}),g=new dijit.form.TextBox({type:"password",name:"password",id:"gcx_auth_password"}),i=new dijit.form.Button({label:"OK",
type:"submit",id:b+"_ok"}),d=new dijit.form.Button({label:"Cancel",type:"button",id:b+"_cancel"}),j=dojo.create("div");dojo.create("div",{id:b+"_message"},j);var f=dojo.create("table",null,j),h=dojo.create("tr",null,f),m=dojo.create("tr",null,f),f=dojo.create("tr",null,f);dojo.place("<td><label for='gcx_auth_username'>Username: </label></td>",h);dojo.place("<td><label for='gcx_auth_password'>Password: </label></td>",m);h=dojo.create("td",null,h);m=dojo.create("td",null,m);f=dojo.create("td",{colspan:"2",
align:"center"},f);b=dojo.create("div",{id:b+"_actionbuttoncontainer"},f);a.placeAt(h);g.placeAt(m);i.placeAt(b);d.placeAt(b);return j};d.prototype._requestToken=function(b){esri.request({url:b.tokenService,content:{username:b.username,password:b.password,lifespan:"20",f:"json"},timeout:c.config.io.timeout,handleAs:"json"},{usePost:true,disableIdentityLookup:true}).then(dojo.hitch(this,this._onTokenRequestCompleted),dojo.hitch(this,this._onTokenRequestFault))};d.prototype._onTokenRequestFault=function(b){if(this._isUnauthorizedResponse(b)){var a=
c.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);a.messageFromServer=b.message;this._gatherCredentials().then(dojo.hitch(this,function(g){a.username=g.username;a.password=g.password;this._requestToken(a)}))}else dojo.isFunction(this._error)&&this._error(b),this._deferred.errback(b)};d.prototype._onTokenRequestCompleted=function(b){var a=c.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);if(b&&b.token){a.token=b.token;dojo.publish("geocortex_authenticationSucceeded",
[{username:a.username,token:a.token}]);for(b=a.pendingCalls.length-1;b>=0;b--){var g=a.pendingCalls[b];a.pendingCalls.pop();g.send()}}else c.essentials.RestHelperHTTPService._controlBlocks.remove(a)};d.prototype.send=function(){if(this.requestObject!==null){var b=c.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);if(b!==null&&b.token!==null){if(!this.requestObject.content)this.requestObject.content={};if(this.requestObject.url.indexOf("token=")===-1)this.requestObject.url=
this._appendParameter(this.requestObject.url,"token",b.token)}}else if(this.requestObject.url.indexOf("token=")!==-1)this.requestObject.url=this.requestObject.url.replace("token=","oldtkn=");if(d.arcGisPortalToken)this.requestObject.content.arcGisPortalToken=d.arcGisPortalToken.token;if(d.token)this.requestObject.content.token=d.token;esri.request(this.requestObject,this.optionsObject).then(dojo.hitch(this,this._requestCallback),dojo.hitch(this,this._requestErrback));return this._deferred.promise};
d.prototype._appendParameter=function(b,a,g){var i=b;i+=b.indexOf("?")>0?"&":"?";i+=encodeURIComponent(a)+"="+encodeURIComponent(g);return i};d._controlBlocks=new c.essentials.AuthenticationControlBlockStore;return d}();h.RestHelperHTTPService=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){function d(a,b,c){return a==null||b==null?c:a.isWebMercator&&b.isWebMercator&&a.isWebMercator()&&b.isWebMercator()?true:a.wkid!==b.wkid?false:a.wkid>0?true:a.wkt.toLowerCase()==b.wkt.toLowerCase()}function b(a){var b=a.rings[0][0],c=a.rings[0][1],d=null,a=a.rings[0].slice(2,a.rings[0].length);a.push(b);for(var f=0;f<a.length;++f){var h=a[f],b=this.crossProduct(h,b,c);if(b>0&&d===true||b<0&&d===false)return false;d=b>0;b=c;c=h}return true}function a(a,b,c){c||
(c=[0,0]);return(a[0]-c[0])*(b[1]-c[1])-(a[1]-c[1])*(b[0]-c[0])}c.spatialRefsAreEqual=d;c.envelopesAreEqual=function(a,b){return a==null||b==null?a==null&&b==null:d(a.spatialReference,b.spatialReference)&&a.xmin==b.xmin&&a.ymin==b.ymin&&a.xmax==b.xmax&&a.ymax==b.ymax};c.getExtent=function(a){if(a.length)var b=new esri.geometry.Extent(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE,a[0].spatialReference);for(var c=0;c<a.length;++c){var d=a[c].getExtent();b.xmin=Math.min(d.xmin,
b.xmin);b.ymin=Math.min(d.ymin,b.ymin);b.xmax=Math.min(d.xmax,b.xmax);b.xmax=Math.min(d.ymax,b.ymax)}return b};c.envelopeToPolygon=function(a){var b=new esri.geometry.Polygon(a.spatialReference);b.addRing([[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]);return b};c.isValidGeometry=function(g){if(g.type!="polygon")return true;if(g.rings.length==0||g.rings.length<3)return true;if(b(g)){var i=g.rings[0][0],c=g.rings[0][1],g=g.rings[0].slice(2,g.rings[0].length);g.push(i);
for(var d=0;d<g.length;++d){var f=g[d];if(a(i,f,c)>0)return true;i=c;c=f}return false}else{for(c=i=0;c<g.rings.length;++c)for(var f=g.rings[c],h=0,d=0;d<f.length;++d)h=(d+1)%f.length,i+=f[d][0]*-f[h][1],i-=-f[d][1]*f[h][0];return i>0}};c.isSelfIntersectingPolygon=function(a){if(esri.geometry.polygonSelfIntersecting)return esri.geometry.polygonSelfIntersecting(a);else if(a.isSelfIntersecting)return a.isSelfIntersecting(a);throw Error("No self intersection method found");};c.isConvex=b;c.pointInEnvelope=
function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references.");return a.x<b.xmin||a.x>b.xmax?false:a.y<b.ymin||a.y>b.ymax?false:true};c.clipEnvelope=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references.");var c=new esri.geometry.Extent(a.xmin,a.ymin,a.xmax,a.ymax,a.spatialReference);c.xmin=a.xmin<b.xmin?b.xmin:a.xmin>b.xmax?b.xmax:a.xmin;c.xmin=a.ymin<
b.ymin?b.ymin:a.ymin>b.ymax?b.ymax:a.ymin;c.xmin=a.xmax<b.xmin?b.xmin:a.xmax>b.xmax?b.xmax:a.xmax;c.xmin=a.ymax<b.ymin?b.ymin:a.ymax>b.ymax?b.ymax:a.ymax;return c};c.scaleEnvelope=function(a,b,c){return new esri.geometry.Extent(a.xmin*b,a.ymin*c,a.xmax*b,a.ymax*c,a.spatialReference)};c.scaleEnvelopeWithoutTranslation=function(a,b){if(a==null)return null;var c=a.getCenter();return new esri.geometry.Extent(c.x-a.getWidth()*(b/2),c.y-a.getHeight()*(b/2),c.x+a.getWidth()*(b/2),c.y+a.getHeight()*(b/2),
a.spatialReference)};c.computeDistance=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)};c.translateEnvelope=function(a,b,c){return new esri.geometry.Extent(a.xmin+b,a.ymin+c,a.xmax+b,a.ymax+c,a.spatialReference)};c.length=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};c.normalize=function(a){var b=this.length(a);return new esri.geometry.Point(a.x/b,a.y/b)};c.angle=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references");
return Math.acos(this.dotProduct(a,b)/Math.sqrt(this.dotProduct(a,a)*this.dotProduct(b,b)))};c.crossProduct=function(a,b,c){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references");c||(c=new esri.geometry.Point(0,0));return(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x)};c.crossProductArray=a;c.dotProduct=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references");return a.x*
b.x+a.y*b.y};c.polygonMidpoint=function(a){if(a.length==0)throw Error("Expected at least one point in polygonMidPoint.");for(var b=0,c=0,d=0;d<a.length;++d){var f=a[d];b+=f.x;c+=f.y}b/=a.length;c/=a.length;return new esri.geometry.Point(b,c,a[0].spatialReference)}})(c.GeometryUtilities||(c.GeometryUtilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){return function(d,b){this.encodeUriReplacementValues=d.encodeUriReplacementValues;this.target=d.target;this.text=d.text;this.toolTip=d.toolTip;var a=null;if(b&&b.mapService&&b.mapService.essentialsMap)a=b.mapService.essentialsMap.site;this.uri=c.essentials.RestHelper.processClientSideTokens(a,d.uri);this.iconUri=c.essentials.RestHelper.processClientSideTokens(a,d.iconUri);this.layer=b}}();h.FeatureHyperlink=f})(c.essentials||(c.essentials={}))})(geocortex||
(geocortex={}));(function(c){(function(c){var f=function(){return function(){}}();c.MapGrid=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(c,b){this.name=c;this.type=b}}();c.DistanceUnit=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){c=c.essentials||(c.essentials={});c=c.DistanceUnitType||(c.DistanceUnitType={});c.OTHER="Other";c.INCHES="Inches";c.FEET="Feet";c.US_SURVEY_FEET="USSurveyFeet";c.YARDS="Yards";c.MILES="Miles";c.NAUTICAL_MILES="NauticalMiles";c.MILLIMETERS="Millimeters";c.CENTIMETERS="Centimeters";c.DECIMETERS="Decimeters";c.METERS="Meters";c.KILOMETERS="Kilometers";c.DEGREES="Degrees";c.RADIANS="Radians";c.GRADS="Grads"})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.baseMaps=[];this.initialExtent=this.fullExtent=null;this.fitTiledMapsToExtent=false;this.mapServices=[];this.mapServicesFilteredView=[];this.primaryMapService=this.layerThemesInfo=null;this.supportedExportFormats="BMP,JPEG,PNG,TIFF,GeoTIFF,PDF".split(",");this.units=this.exportMapImageOptions=null;this.serviceLayersAdded=false;this.spatialReference=this.extentManager=null;this.setExtentOnLoad=true;this._onExportError=this._onExportComplete=
this._esriMap=null;this.originalUrl=a;this.url=h.utilities.UrlUtilities.simplify(a);this.layerThemesInfo=new c.essentials.LayerThemesInfo(this)}__extends(b,d);b.prototype.getMap=function(){return this._esriMap};b.prototype.allLayers=function(){for(var a=[],g=0;g<this.mapServices.length;g++)for(var b=this.mapServices[g],c=0;c<b.layers.length;c++)a.push(b.layers[c]);return a};b.prototype.filteredLayers=function(){for(var a=[],g=0;g<this.mapServices.length;g++){var b=this.mapServices[g];this._layerThemeMapServiceFilter(b)&&
(a=a.concat(b.layers))}return a};b.prototype.loadServiceLayersInMap=function(a){if(!a)throw Error("Must supply a map");this._esriMap=a;this.fitTiledMapsToExtent=!!a._fitTiledMapsToExtent;this.extentManager=new h.ExtentManager(a,this.fitTiledMapsToExtent);for(var g=0;g<this.mapServices.length;g++){var b=this.mapServices[g],c=b.serviceLayer;c&&(this.extentManager.registerLayer(c),c.loaded?(this._layerLoadedUpdate(a),b._handleServiceLayerLoaded(c),b._handleDynamicLayers(c)):(dojo.connect(c,"onLoad",
dojo.hitch(this,this._layerLoadedUpdate,a)),dojo.connect(c,"onError",dojo.hitch(this,this._layerLoadedUpdate,a))))}};b.prototype.calculateScale=function(){return esri.geometry.getScale(this.site.getMap())};b.prototype._addServiceLayers=function(a){for(var g=this.mapServices.length-1;g>=0;g--)a.addLayer(this.mapServices[g].serviceLayer);this.setExtentOnLoad&&this.initialExtent&&this.extentManager.setInitialExtent(this.initialExtent);if(this.site!==null&&dojo.isObject(this.site)&&(this.site.serviceLayersLoaded=
true,dojo.isFunction(this.site.onServiceLayersLoaded)))this.site.onServiceLayersLoaded(this.site)};b.prototype.addServiceLayers=function(a,g){var b=this,d=this;if(a||a.length){for(var j=[],f=function(a){var b=null,i=false,f=c.essentials.MapServiceType.FEATURE;a.opacity=a.opacity||1;switch(a.type){case "Feature Layer":b=new c.essentials.FeatureLayerService(a.url||"http://02A178F6-050B-4709-8825-32FB5E715543/");break;default:switch(a.declaredClass){case "esri.layers.WebTiledLayer":b=new c.essentials.MapService(a.tileServers[0]),
f=c.essentials.MapServiceType.WEBTILED,i=true}}if(b){b.serviceLayer=a;b.essentialsMap=d;var h=a.layerId||c.framework.utils.alphaNumericToken(),i={id:h,isExpanded:true,includeInLayerList:i,serviceFunction:g,serviceType:f,layerOptions:null};i.layerOptions={id:h,name:a.name,description:a.description,displayField:a.displayField,includeInLayerList:true,identifiable:true,fullExtent:a.fullExtent,primaryKeyField:a.objectIdField,visible:a.visible};b._createFrom(i);j.push(b);dojo.connect(a,"onClick",function(a){dojo.publish("FeatureClickedEvent",
dojo.mixin(a,{layer:b.layers[0],useFeaturePresenter:true}))})}},k=0;k<a.length;++k){var m=a[k];if(m instanceof h.GeoRssLayerService)j.push(m);else{if(m.getFeatureLayers){var n=m,o=n.getFeatureLayers();if(o&&o.length>0){dojo.forEach(o,function(a){a.name=a.name||n.name;f(a)});continue}}f(m)}}this.mapServices=this.mapServices.concat(j);dojo.forEach(j,function(a){return b._addToFilteredView(a)});this._addServiceLayers(this.getMap());dojo.forEach(j,function(a){dojo.publish("MapServiceAddedEvent",a)})}};
b.prototype.removeServiceLayer=function(a){if(a&&this.mapServices.length)for(var g=0;g<this.mapServices.length;g++){var b=this.mapServices[g];if(b&&b.serviceLayer&&b.serviceLayer===a){this.mapServices.splice(g,1);dojo.publish("MapServiceRemovedEvent",b);break}}};b.prototype._configureMapServices=function(a){for(var g=0;a&&g<a.length;g++){var b=a[g],d=this.originalUrl+"/mapservices/"+b.id;if(b.drawingBehavior==c.essentials.DrawingBehavior.FEATURE_LAYER){if(!dojo.isObject(esri.layers.FeatureLayer))throw Error("This Javascript application must // dojo.require the esri.layers.FeatureLayer package in order to use a site with feature layers");
this.mapServices[g]=new c.essentials.FeatureLayerService(d)}else if(b.drawingBehavior==c.essentials.DrawingBehavior.GEORSS_LAYER){if(!dojo.isObject(esri.layers.GraphicsLayer))throw Error("This Javascript application must // dojo.require the esri.layers.GraphicsLayer package in order to use a site with GeoRSS layers");this.mapServices[g]=new c.essentials.GeoRssLayerService(d)}else if(b.drawingBehavior==c.essentials.DrawingBehavior.KML_SERVICE){if(!dojo.isObject(esri.layers.KMLLayer))throw Error("This Javascript application must // dojo.require the esri.layers.KMLLayer package in order to use a site with KML layers");
this.mapServices[g]=new c.essentials.KmlService(d)}else this.mapServices[g]=new c.essentials.MapService(d);this.mapServices[g].essentialsMap=this;this.mapServices[g].initialize(b);dojo.publish("ServiceLayerInitializedEvent",this.mapServices[g].serviceLayer);this._addToFilteredView(this.mapServices[g])}};b.prototype._configureObject=function(a,g){if(a===void 0||a.mapServices===void 0)throw Error("Incorrect map object returned from initialization");if(a.initialExtent)this.initialExtent=new esri.geometry.Extent(a.initialExtent);
if(a.fullExtent)this.fullExtent=new esri.geometry.Extent(a.fullExtent);if(a.units)this.units=new c.essentials.DistanceUnit(a.units.name,a.units.type);if(a.exportOptions)this.exportMapImageOptions=new c.essentials.ExportMapImageOptions(a.exportOptions.allowIncludeGeoreferenceData,a.exportOptions.defaultOutputFormat);a.layerThemes&&(a.layerThemes.items&&a.layerThemes.items.length||a.layerThemes.allowDefault)&&this._configureLayerThemesInfo(a.layerThemes);this._configureMapServices(a.mapServices,g);
dojo.isArray(a.baseMaps)&&this._configureBaseMaps(a.baseMaps);if(g)this.isInitialized=true;this.primaryMapService=this.findMapServiceById(a.primaryMapServiceID)};b.prototype.findMapServiceById=function(a){for(var g=0;g<this.mapServices.length;g++)if(this.mapServices[g].id==a)return this.mapServices[g];return null};b.prototype.setFeatureLayerExclusivelyVisible=function(a){for(var g=this.site.getFeatureServices(),b=0;b<g.length;b++){var c=g[b];c.setVisibility(c.serviceLayer.id===a.id)}};b.prototype.exportMap=
function(a,g,b){var d=this;this._onExportComplete=g;this._onExportError=b;g=new c.essentials.exportMap.ExportMapTask(this);b=new c.essentials.exportMap.ExportMapParameters;b.reportParameters=a;g.generateMapImageUrl(b).then(function(a){return d._exportRestComplete(a)},function(a){return d._exportRestError(a)})};b.prototype._exportRestComplete=function(a){var g=null;if(a){if(a.error)g=a.error}else g=Error("No results");g&&this._onExportComplete&&this._onExportError(g);a&&this._onExportComplete&&this._onExportComplete(a)};
b.prototype._exportRestError=function(a){this._onExportError&&this._onExportError(a)};b.prototype._layerLoadedUpdate=function(a){if(!this.serviceLayersAdded){for(var g=0;g<this.mapServices.length;g++){var b=this.mapServices[g];if(!b.serviceLayer.loaded&&!b.initializationFailure)return}this.serviceLayersAdded=true;(this.spatialReference=this.primaryMapService.serviceLayer.spatialReference)&&this.spatialReference.wkt&&this._switchSpatialReferenceGlobally(this.spatialReference);if(!this._esriMap.spatialReference)this._esriMap.spatialReference=
this.spatialReference||this.initialExtent.spatialReference||this.fullExtent.spatialReference;if(!this._esriMap.extent&&this.initialExtent)this._esriMap.extent=new esri.geometry.Extent(this.initialExtent.toJson());this._addServiceLayers(a)}};b.prototype.applyCatalogLayersChange=function(a){a&&(this._applyCatalogChangesToDynamicLayers(a),this._applyCatalogChangesToWmsLayers(a))};b.prototype.applyStartupTheme=function(){this.layerThemesInfo.layerThemesConfigured&&this.layerThemesInfo.applyTheme(this.layerThemesInfo.startupThemeId||
this.layerThemesInfo.themes[0].id)};b.prototype.refreshFilteredCollections=function(){var a=this;this.mapServicesFilteredView.length=0;dojo.forEach(this.mapServices,function(g){return a._addToFilteredView(g)});for(var g=0;g<this.mapServices.length;g++)this.mapServices[g].refreshFilteredCollections()};b.prototype._switchSpatialReferenceGlobally=function(a){if(this.initialExtent)this.initialExtent=new esri.geometry.Extent(this.initialExtent.xmin,this.initialExtent.ymin,this.initialExtent.xmax,this.initialExtent.ymax,
a);if(this.fullExtent)this.fullExtent=new esri.geometry.Extent(this.fullExtent.xmin,this.fullExtent.ymin,this.fullExtent.xmax,this.fullExtent.ymax,a);if(this.site.hasNamedExtents&&this.site.namedExtents&&this.site.namedExtents.length)for(var g=0;g<this.site.namedExtents.length;g++){var b=this.site.namedExtents[g];b.extent=new esri.geometry.Extent(b.extent.xmin,b.extent.ymin,b.extent.xmax,b.extent.ymax,a)}this._esriMap.spatialReference=a};b.prototype._applyCatalogChangesToWmsLayers=function(){};b.prototype._applyCatalogChangesToDynamicLayers=
function(a){var g=a.mapServiceId,b=[],d=new c.essentials.catalog.LayerCatalogDetail;d.mapServiceId=g;for(var j=0;j<a.entries.length;j++)a.entries[j].isDynamic&&b.push(a.entries[j]);d.entries=b;(a=this.findMapServiceById(g))&&a.applyCatalogLayersChange(d)};b.prototype._configureLayerThemesInfo=function(a){var g=this;if(!a)throw Error("RestLayerThemesInfo object not defined. Cannot configure layer themes.");this.layerThemesInfo.layerThemesConfigured=true;this.layerThemesInfo.allowDefault=a.allowDefault!=
void 0?a.allowDefault:true;this.layerThemesInfo.startupThemeId=a.startupThemeID;this.layerThemesInfo.allowDefault&&this.layerThemesInfo.themes.push(new h.LayerTheme(this.layerThemesInfo,null,a.defaultThemeDisplayName||""));a.items&&a.items.length&&dojo.forEach(a.items,function(a){g.layerThemesInfo.themes.push(new h.LayerTheme(g.layerThemesInfo,a))})};b.prototype._addToFilteredView=function(a){a&&this._layerThemeMapServiceFilter(a)&&this.mapServicesFilteredView.push(a)};b.prototype._layerThemeMapServiceFilter=
function(a){return a.essentialsMap.layerThemesInfo.layerThemesConfigured?a.inActiveTheme:true};b.prototype._configureBaseMaps=function(a){var g=this;a.forEach(function(a){var b=new h.BaseMap(g);b.displayName=a.displayName;b.id=a.id;if(a.iconUri)b.iconUri=c.essentials.RestHelper.processClientSideTokens(g.site,a.iconUri);b.properties=c._getProperties(a.properties);b.extensions=c._getExtensions(a.extensions);dojo.isArray(a.mapServices)&&a.mapServices.forEach(function(a){(a=g.findMapServiceById(a.id))&&
b.services.push(new h.BaseMapService(a))});g.baseMaps.push(b)})};return b}(h.AsyncInitializable);h.Map=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(c,b){this.displayName=c;this.scale=b}}();c.Scale=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c,b){if(c!==void 0)this.displayName=c;if(b!==void 0)this.dpi=b}}();c.Resolution=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(c,b,a,g){this.id=c;this.displayName=b;this.value=a;this.multiline=g}}();c.TextField=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(){this.customExtent=null;this.extentType="currentExtent";this.fields=[];this.scale=this.resolution=this.featureIds=this.outputFormat=this.notificationEmailAddress=this.imageWidth=this.imageHeight=this.grid=null}d.prototype.toJson=function(b,a){if(!b||!a)throw Error("Reporting parameter creation is missing a main map.");var g={},i,d,j=this.scale&&this.scale.scale!=void 0&&!isNaN(parseFloat(this.scale.scale))?parseFloat(this.scale.scale):b.getScale();
if(this.scale&&this.scale.scale!=void 0)g.scale=this.scale.scale;if(this.extentType==c.essentials.ReportParameters.CURRENT_EXTENT&&b!==null)i=b.extent;else if(this.extentType==c.essentials.ReportParameters.FULL_EXTENT&&a!==null)i=a.fullExtent;else if(this.extentType==c.essentials.ReportParameters.INITIAL_EXTENT&&a!==null)i=a.initialExtent;else if(this.extentType==c.essentials.ReportParameters.CUSTOM_EXTENT&&this.customExtent!==null)i=this.customExtent;if(i){if(i.spatialReference&&(d=i.spatialReference.toJson()))if(d.wkid&&
d.wkid>0)g.bboxSR=d.wkid;else if(d.wkt)g.bboxSR=d.wkt;g.bbox=i.xmin+","+i.ymin+","+i.xmax+","+i.ymax}if(this.targetSpatialReference&&(d=this.targetSpatialReference.toJson()))if(d.wkid&&d.wkid>0)g.targetSR=d.wkid;else if(d.wkt)g.targetSR=d.wkt;if(this.notificationEmailAddress)g.emailAddress=this.notificationEmailAddress;if(this.imageHeight&&this.imageHeight>0)g.imageHeight=this.imageHeight;if(this.imageWidth&&this.imageWidth>0)g.imageWidth=this.imageWidth;if(b.timeExtent)g.time="",g.time+=b.timeExtent.startTime?
b.timeExtent.startTime.getTime():"null",g.time+=",",g.time+=b.timeExtent.endTime?b.timeExtent.endTime.getTime():"null";d=[];if(a!==null){var f="",h="",m="";for(i=0;i<a.mapServices.length;i++){var n=a.mapServices[i],o="",q=n.serviceLayer,r,s="";if(q)if(q.visible===true&&(h+=(h===""?"":";")+n.id+":"+q.opacity),n.mapServiceType===c.essentials.MapServiceType.DYNAMIC){r=q.layerDefinitions;var u=0,t;for(t in r)u>0&&(s+=","),s+='"'+t+'":"'+r[t].replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"',u++;u>0&&(m.length>
1&&(m+=","),m+='"'+n.id+'":{',m+=s,m+="}");if(q.visible===true&&q.isVisibleAtScale(j)===true)if(q instanceof esri.layers.ArcGISDynamicMapServiceLayer)r=q,r.visibleLayers&&r.visibleLayers.toString()!=="-1"&&(o=r.visibleLayers.toString());else if(!n.layers||n.layers.length===0)o="*";else if(n.layers&&n.layers.length>0)for(r=0;r<n.layers.length;r++)s=n.layers[r],s.isVisible()&&s.areAllAncestorsVisible()&&(o+=(o.length===0?"":",")+s.id)}else if(q.visible===true&&q.isVisibleAtScale(j)===true)if(!n.layers||
n.layers.length===0)o="*";else if(n.layers&&n.layers.length>0)for(r=0;r<n.layers.length;r++)s=n.layers[r],s.isVisible()&&s.areAllAncestorsVisible()&&(o+=(o.length===0?"":",")+s.id);r=n.id;r+=o.length===0?"(hide:*)":"(show:"+o+")";f+=(f.length===0?"":";")+r;if(n instanceof c.essentials.FeatureLayerService){o={};o.id=n.id;if((r=q.getSelectionSymbol())&&r.color)r=r.color.toRgba(),o.selectionColor={r:r[0],g:r[1],b:r[2],a:r[3]};o.mode=n.queryMode;if(n=q.getDefinitionExpression())o.where=n;if(q.renderer)o.renderer=
q.renderer.toJson();o.selectedFeatures=[];if((n=q.getSelectedFeatures())&&n.length>0)if(q=q.objectIdField)for(r=0;r<n.length;r++)s=n[r],s.attributes&&(s=s.attributes[q])&&o.selectedFeatures.push(s);d.push(o)}}if(m.length>0)g.layerDefinitions="{"+m+"}";if(f.length>0)g.layers=f;if(h.length>0)g.opacity=h}if(d.length>0)g.featureLayerOptions=d;if(this.outputFormat)g.outputFormat=this.outputFormat;if(this.featureIds)g.featureIds=this.featureIds;if(this.resolution)g.dpi=this.resolution.dpi;if(this.mapGraphicsLayers)g.graphics=
this.mapGraphicsLayers.layers,g.symbols=this.mapGraphicsLayers.symbols;if(this.includeGeoreferenceData)g.georef=this.includeGeoreferenceData;if(this.useTransparentBackground)g.useTransparentBackground=this.useTransparentBackground;for(j=0;j<this.fields.length;j++)t=this.fields[j],g[t.id]=t.value;if(this.grid)g.grid=this.grid.id;return g};d.prototype.populateMapGraphicsLayers=function(b){this.mapGraphicsLayers={layers:[],symbols:[]};this._extractGraphicInformation(b.graphics,this.mapGraphicsLayers.layers,
this.mapGraphicsLayers.symbols);for(var a=0;a<b.graphicsLayerIds.length;a++){var g=b.getLayer(b.graphicsLayerIds[a]);g.visible&&!(g instanceof esri.layers.FeatureLayer&&g.url)&&this._extractGraphicInformation(g,this.mapGraphicsLayers.layers,this.mapGraphicsLayers.symbols)}};d.prototype._extractGraphicInformation=function(b,a,g){for(var i=0;i<b.graphics.length;i++){var d=b.graphics[i];if(d.visible){var j={},f=null;if(d.symbol)f=d.symbol;else if(b.renderer&&b.renderer.getSymbol)f=b.renderer.getSymbol(d),
d.symbol=f;if(f){g.push(f);for(var h=0;h<g.length-1;h++)if(g[h]==f){j.symbolID=g[h].id;f.id=j.symbolID;g.pop();break}if(j.symbolID==void 0)f=g.length-1,g[f]instanceof esri.symbol.TextSymbol?g[f]=c.essentials.utilities.PrintUtilities.adjustTextSymbol(d):g[f]instanceof esri.symbol.PictureMarkerSymbol&&(g[f]=c.essentials.utilities.PrintUtilities.adjustPictureMarkerSymbol(d)),j.symbolID=(g.length-1).toString(),g[j.symbolID].id=j.symbolID;j.geometry=d.geometry;a.push({elements:[j],opacity:b.opacity})}}}};
d.CURRENT_EXTENT="currentExtent";d.CUSTOM_EXTENT="customExtent";d.FULL_EXTENT="fullExtent";d.INITIAL_EXTENT="initialExtent";return d}();h.ReportParameters=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=this.description=null;this.extensions=[];this.id=null;this.visible=false;this.layer=null;this.properties={};this.supportedMapScales=[];this.supportedOutputFormats=[];this.supportedResolutions=[];this.textFields=[];this._running=false;this._onRunReportError=this._onRunReportComplete=null}__extends(b,d);b.prototype.isRunning=function(){return this._running};b.prototype.run=function(a,g,b,d){var j=this;if(this.isRunning()){if(d)a=
Error("Report already running"),a.name="ReportAlreadyRunning",d(a)}else{this._running=true;try{this._onRunReportComplete=b;this._onRunReportError=d;var f=new h.exportMap.ExportMapTask(this),k=new h.exportMap.ExportMapParameters;k.reportParameters=g;if(a)k.queryParameters=c.essentials.RestHelper._createRestParametersFromQuery(a);f.generateMapImageUrl(k).then(function(a){return j._runRestComplete(a)},function(a){return j._runRestError(a)})}catch(m){if(this._running=false,this._onRunReportError)this._onRunReportError(m);
else throw m;}}};b.prototype._configureObject=function(a,g){if(a.id===void 0||a.displayName===void 0)throw Error("Incorrect report object returned from initialization");this.id=a.id;this.visible=a.visible===void 0?true:a.visible;this.supportedOutputFormats=a.supportedOutputFormats;this.supportedResolutions=a.supportedResolutions;this.supportedMapScales=a.supportedScales;this.textFields=a.textFields;this.description=a.description;this.displayName=a.displayName;if(g)this.isInitialized=true;this.properties=
c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};b.prototype._runRestComplete=function(a){this._running=false;var g=null;if(a){if(a.error)g=a.error}else g=Error("No results");g&&this._onRunReportError&&this._onRunReportError(g);a&&this._onRunReportComplete&&this._onRunReportComplete(a)};b.prototype._runRestError=function(a){this._running=false;this._onRunReportError&&this._onRunReportError(a)};return b}(h.AsyncInitializable);h.Report=f})(c.essentials||(c.essentials={}))})(geocortex||
(geocortex={}));(function(c){c=c.essentials||(c.essentials={});c=c.ReportType||(c.ReportType={});c.LAYER_TEMPLATE_REPORT="Layer Template Report";c.MAP_TEMPLATE_REPORT="Map Template Report"})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){function c(){}c.UNKNOWN=0;c.FEATURE_LAYER=1;c.RASTER_LAYER=2;c.GROUP_LAYER=3;c.GEO_RSS_LAYER=4;return c}();c.LayerType=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function a(){}a.esriFieldTypeSmallInteger="esriFieldTypeSmallInteger";a.esriFieldTypeInteger="esriFieldTypeInteger";a.esriFieldTypeSingle="esriFieldTypeSingle";a.esriFieldTypeDouble="esriFieldTypeDouble";a.esriFieldTypeString="esriFieldTypeString";a.esriFieldTypeDate="esriFieldTypeDate";a.esriFieldTypeOID="esriFieldTypeOID";a.esriFieldTypeGeometry="esriFieldTypeGeometry";a.esriFieldTypeBlob="esriFieldTypeBlob";a.esriFieldTypeRaster="esriFieldTypeRaster";
a.esriFieldTypeGUID="esriFieldTypeGUID";a.esriFieldTypeGlobalID="esriFieldTypeGlobalID";a.esriFieldTypeXML="esriFieldTypeXML";return a}();c.EsriFieldTypes=f;var d=function(){function a(){}a.essentialsFieldTypeSmallInteger="Int16";a.essentialsFieldTypeInteger="Int32";a.essentialsFieldTypeSingle="Single";a.essentialsFieldTypeDouble="Double";a.essentialsFieldTypeString="String";a.essentialsFieldTypeDate="DateTime";a.essentialsFieldTypeGUID="Guid";a.essentialsFieldTypeObject="Object";return a}();c.EssentialsFieldTypes=
d;var b=function(){function a(a){this.alias=a.alias;this.dataType=a.dataType;this.displayName=a.displayName;this.focusField=!!a.focusField;this.hyperlinkLabel=a.hyperlinkLabel;this.name=a.name;this.searchable=!!a.searchable;this.visible=!!a.visible}a.convertFromEsriType=function(a){if(!a||a.indexOf("esriFieldType")!==0)return a;switch(a){case f.esriFieldTypeGeometry:case f.esriFieldTypeBlob:case f.esriFieldTypeRaster:return d.essentialsFieldTypeObject;case f.esriFieldTypeDate:return d.essentialsFieldTypeDate;
case f.esriFieldTypeDouble:return d.essentialsFieldTypeDouble;case f.esriFieldTypeGlobalID:return d.essentialsFieldTypeGUID;case f.esriFieldTypeInteger:case f.esriFieldTypeOID:return d.essentialsFieldTypeInteger;case f.esriFieldTypeSingle:return d.essentialsFieldTypeSingle;case f.esriFieldTypeSmallInteger:return d.essentialsFieldTypeSmallInteger;default:return d.essentialsFieldTypeString}};a.convertToEsriFieldType=function(a){switch(a){case c.EssentialsFieldTypes.essentialsFieldTypeObject:return f.esriFieldTypeBlob;
case c.EssentialsFieldTypes.essentialsFieldTypeDate:return f.esriFieldTypeDate;case c.EssentialsFieldTypes.essentialsFieldTypeDouble:return f.esriFieldTypeDouble;case c.EssentialsFieldTypes.essentialsFieldTypeGUID:return f.esriFieldTypeGlobalID;case c.EssentialsFieldTypes.essentialsFieldTypeInteger:return f.esriFieldTypeInteger;case c.EssentialsFieldTypes.essentialsFieldTypeSingle:return f.esriFieldTypeSingle;case c.EssentialsFieldTypes.essentialsFieldTypeSmallInteger:return f.esriFieldTypeSmallInteger;
case c.EssentialsFieldTypes.essentialsFieldTypeString:return f.esriFieldTypeString;default:return f.esriFieldTypeString}};return a}();c.Field=b})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(){this.type=this.name=this.id=this.featureField=null}}();c.DataLinkParameter=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=null;this.extensions=[];this.visible=this.id=null;this.isOneToOne=false;this.layer=null;this.parameters=[];this.properties={};this._dataLinking=false;this._onDataLinkingError=this._onDataLinkingComplete=null}__extends(b,d);b.prototype.isDataLinking=function(){return this._dataLinking};b.prototype.performDataLinking=function(a,g,b){var d=this,j=function(a){d._dataLinking=false;b&&b(Error(a))};!a&&this.parameters.length>
0&&j("No FeatureSetParameters provided");this.isDataLinking()&&j("Currently performing data linking");this._dataLinking=true;this._onDataLinkingComplete=dojo.hitch(this,g);this._onDataLinkingError=dojo.hitch(this,b);for(var g=this.url+"/link",f=null,h=0;h<this.parameters.length;h++){for(var m=this.parameters[h],n="",o=0;o<a.features.length;o++){var q=a.features[o].attributes[m.featureField];if(!q&&this.layer&&this.layer.fields)for(var r=0;r<this.layer.fields.length;r++)if(this.layer.fields[r].name===
m.featureField)break;n+=(n.length===0?"":",")+(q?this._prepParamValue(q):" ")}n&&n.length>0&&(f=f===null?{}:f,f[m.id]=n)}f?(a=c.encodeJson(dojo.mixin({f:"json"},f)),c.request({url:g,content:a,load:dojo.hitch(this,this._dataLinkingRestComplete),error:dojo.hitch(this,this._dataLinkRestError),callbackParamName:"CallBack"})):j("Missing Feature Fields.")};b.prototype._configureObject=function(a,g){if(a===void 0||a.displayName===void 0||a.parameters===void 0)throw Error("Incorrect data link object returned from initialization");
this.displayName=a.displayName;this.id=a.id;this.visible=a.visible===void 0?true:a.visible;this.isOneToOne=!!a.isOneToOne;this.parameters=a.parameters;if(g)this.isInitialized=true;this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};b.prototype._dataLinkingRestComplete=function(a){this._dataLinking=false;!a&&this._onDataLinkingError&&this._onDataLinkingError(Error("No results"));a.error&&this._onDataLinkingError&&this._onDataLinkingError(a.error);this._onDataLinkingComplete&&
this._onDataLinkingComplete(this._parseConvertDates(a.results))};b.prototype._parseConvertDates=function(a){for(var g in a)if(a.hasOwnProperty(g)){var b=a[g];typeof b==="string"?b.length>6&&b.substring(0,6)==="/Date("&&(b=parseInt(b.substring(6)),b=(new Date(b)).toLocaleString(),a[g]=b):typeof b==="object"&&(a[g]=this._parseConvertDates(b))}return a};b.prototype._dataLinkRestError=function(a){this._dataLinking=false;this._onDataLinkingError&&this._onDataLinkingError(a)};b.prototype._prepParamValue=
function(a){var g="";typeof a==="number"?g=a.toString():typeof a==="string"&&(g=a.replace(/,/g,"\\,"));return g};return b}(h.AsyncInitializable);h.DataLink=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){function b(){}b.equals=function(a,g){return a&&g&&(a===g||c.StringUtilities.endsWith(a,this.separator+g))?true:false};b.lookUp=function(a,g){if(a&&g){for(var b=0,d=null,b=0;b<a.length;++b)if(d=a[b],d.id===g)return d;for(b=0;b<a.length;++b)if(d=a[b],c.StringUtilities.endsWith(d.id,this.separator+g))return d}return null};b.separator="-";return b}();c.SiteResourceIdComparer=d})(c.utilities||(c.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||
(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.canToggleLabels=false;this.charts=[];this.configuredVisible=false;this.dataLinks=[];this.dataProvider=null;this.defaultVisibility=false;this.dynamicDefinition=this.drawIndex=this.description=this.displayName=this.displayField=null;this.extensions=[];this.featureFillColor=this.featureDescription=this.featureBorderColor=null;this.featureHyperlinks=[];this.featureLongDescription=this.featureLabel=null;this.featureType="None";
this.featureZoomScale=this.featureZoomFactor=null;this.fields=[];this.fullExtent=null;this.hasReports=this.hasDataLinks=this.hasAttachments=false;this.id=this.iconUri=null;this.identifiableAtAllScales=this.identifiable=false;this.includeInLegend=this.includeInLayerList=true;this.isUserCreated=this.isExpanded=this.isDynamic=false;this.layerHyperlinks=[];this.mapService=this.legendUrl=null;this.minScale=this.maxScale=0;this.primaryKeyField=this.parentLayerId=this.name=null;this.properties={};this.queryable=
false;this.relationships=[];this.reports=[];this.searchable=false;this.showFeatureHyperlinks="ShowAll";this.showLabels=true;this.supportsQuery=this.supportsIdentify=this.snappingEnabled=this.snappable=this.showMapTips=false;this.styleName=null;this.subLayerIds=[];this.type=c.essentials.LayerType.UNKNOWN;this.visibleStateForRefresh=c.essentials.RefreshVisibility.DEFAULT;this.wmsLayerName=null;this.inActiveTheme=true;this.layerThemeSettings=[];this._visible=false;this._featureLayerPromise=null;this.setInActiveTheme(true)}
__extends(b,d);b.prototype.getFeatureLayer=function(){var a=this;if(!this._featureLayerPromise)if(this.mapService.serviceUrl.endsWith("/MapServer"))this._featureLayerPromise=this.mapService._getLayersInfo().then(function(g){var b=null;g&&g.layers&&g.layers.forEach(function(g){a.id===g.id.toString()&&(b=new esri.layers.FeatureLayer({layerDefinition:g}))});return b});else{var g;g=this.mapService.serviceLayer instanceof esri.layers.FeatureLayer?this.mapService.serviceLayer:new esri.layers.FeatureLayer(this.getLayerUrl());
this._featureLayerPromise=g.loaded?Promise.resolve(g):new Promise(function(b,c){var d=g.on("load",function(){d.remove();f.remove();if(a.wmsLayerName)for(var c=a.fields,p=g.fields.length-1;p>=0;p--){var n=g.fields[p];n.name==="gml:id"&&g.fields.splice(p,1);n.type=h.Field.convertToEsriFieldType(c[p].dataType)}b(g)}),f=g.on("error",function(a){d.remove();f.remove();c(a)})})}return this._featureLayerPromise};b.prototype.getRelatedFeatureLayer=function(a,g,b){var d=new dojo.Deferred,j=function(a){c.deferredResolve(d,
a);typeof g=="function"&&g(a)},f=this._getRelation(a);if(!f)return j=Error("Relation not found: "+a),d&&d.fired==-1&&d.resolve(j),typeof b=="function"&&b(j),d;a=this.getLayerUrl();f=a.substring(0,a.lastIndexOf("/")+1)+f.relatedTableId;this.mapService&&this.mapService.serviceToken&&(f+=f.indexOf("?")>-1?"&token=":"?token=",f+=encodeURIComponent(this.mapService.serviceToken));esri.getProxyRule(f)===void 0&&this.mapService.proxyUrl!==null&&esri.addProxyRule({urlPrefix:f,proxyUrl:this.mapService.proxyUrl});
f=new esri.layers.FeatureLayer(f,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});f.loaded?j(f):dojo.connect(f,"onLoad",dojo.hitch(this,j));dojo.connect(f,"onError",dojo.hitch(this,function(a){d&&d.fired==-1&&d.resolve(a);typeof b=="function"&&b(a)}));return d};b.prototype.areAllAncestorsVisible=function(){for(var a=this.mapService.findLayerById(this.parentLayerId);a!==null&&a!==void 0;){if(!a.isVisible())return false;a=this.mapService.findLayerById(a.parentLayerId)}return true};b.prototype.getLayerUrl=
function(){if(this.mapService&&this.mapService.serviceUrl)if(this.mapService.drawingBehavior==="FeatureLayer")return this.mapService.serviceUrl;else if(this.mapService.mapServiceType==="WMS"){var a=this.mapService.url+"/layers/"+this.id;if(this.mapService.serviceToken){var b="",b=a.indexOf("?")===-1?"?token=":"&token=";a+=b+this.mapService.serviceToken}return a}else return this.mapService.serviceUrl+"/"+this.id;else return null};b.prototype.getFieldByName=function(a){if(this.fields&&this.fields.length>
0){if(!this._fieldLookup){this._fieldLookup={};for(var b=0;b<this.fields.length;b++){var c=this.fields[b];this._fieldLookup[c.name]=c}}return this._fieldLookup[a]}else return null};b.prototype.isVisible=function(){return this._visible};b.prototype.setVisibility=function(a,b){if(this.mapService){switch(this.mapService.mapServiceType){case c.essentials.MapServiceType.DYNAMIC:case c.essentials.MapServiceType.FEATURE:case c.essentials.MapServiceType.WMS:case c.essentials.MapServiceType.WMTS:case c.essentials.MapServiceType.GEORSS:case c.essentials.MapServiceType.KML:case c.essentials.MapServiceType.TILED:this._visible=
a;break;default:this._visible=true}this.mapService._setVisibility(this.id,this._visible,b)}};b.prototype.setInActiveTheme=function(a){this.inActiveTheme=a;dojo.publish("LayerInActiveThemeChangedEvent",this)};b.prototype.findReportById=function(a){return c.essentials.utilities.SiteResourceIdComparer.lookUp(this.reports,a)};b.prototype.withinScaleRange=function(a){if(this.maxScale==0&&this.minScale==Infinity||isNaN(this.maxScale)&&isNaN(this.minScale))return true;a==null&&(a=this.mapService.essentialsMap.calculateScale());
return this.maxScale<a&&a<this.minScale};b.prototype._configureDataLinks=function(a,b){for(var i=0;a&&i<a.length;i++)this.dataLinks[i]=new c.essentials.DataLink(this.url+"/datalinks/"+a[i].id),this.dataLinks[i].layer=this,this.dataLinks[i]._configureObject(a[i],b)};b.prototype._idIsUnique=function(a){if(this.mapService&&a){var b=[];dojo.forEach(this.mapService.layers,function(a){b.push(a.id)});if(b.indexOf(a)<0)return true}return false};b.prototype._getUniqueId=function(){if(this.mapService){var a=
[];dojo.forEach(this.mapService.layers,function(b){a.push(b.id)});if(a.length>0){var b=Math.max.apply(null,a);b++;return b.toString()}}return"0"};b.prototype.createFromDefinition=function(a){this._createFrom(a)};b.prototype._createFrom=function(a){this.defaultVisibility=a.defaultVisibility;this.configuredVisible=a.visible;this.displayName=a.displayName||a.name;this.description=a.description;this.featureDescription=a.featureDescription;this.featureLongDescription=a.hasOwnProperty("featureLongDescription")?
a.featureLongDescription:a.featureDescription;this.featureLabel=a.featureLabel;this.featureType=a.featureType;this.featureZoomScale=a.featureZoomScale;this.featureZoomFactor=a.featureZoomFactor;this.hasDataLinks=a.hasDataLinks;this.hasReports=a.hasReports;this.hasAttachments=a.hasAttachments;this.id=a.hasOwnProperty("id")?a.id:this._getUniqueId();this.name=a.name;this.wmsLayerName=a.nativeID;this.parentLayerId=a.parentLayerId;this.subLayerIds=a.subLayerIds;this._visible=a.visible;this.styleName=a.styleName;
this.legendUrl=a.legendUrl;this.isDynamic=a.isDynamic;this.dynamicDefinition=a.dynamicDefinition;this.dataProvider=a.dataProvider;var b=a.fullExtent;if(b)this.fullExtent=new esri.geometry.Extent(b.xmin,b.ymin,b.xmax,b.ymax,b.spatialReference);if(a.hasOwnProperty("drawIndex"))this.drawIndex=a.drawIndex;if(a.hasOwnProperty("identifiable"))this.identifiable=a.identifiable;if(a.hasOwnProperty("includeInLayerList"))this.includeInLayerList=a.includeInLayerList;if(a.hasOwnProperty("includeInLegend"))this.includeInLegend=
a.includeInLegend;if(a.hasOwnProperty("featureBorderColor"))(this.featureBorderColor=a.featureBorderColor)&&this.featureBorderColor.length>=4&&this.featureBorderColor[3]>=1&&(this.featureBorderColor[3]/=255);if(a.hasOwnProperty("featureFillColor"))(this.featureFillColor=a.featureFillColor)&&this.featureFillColor.length>=4&&this.featureFillColor[3]>=1&&(this.featureFillColor[3]/=255);this.minScale=a.hasOwnProperty("minScale")&&!isNaN(a.minScale)&&a.minScale!=0?a.minScale:Infinity;this.maxScale=a.hasOwnProperty("maxScale")&&
!isNaN(a.maxScale)?a.maxScale:0;if(this.mapService&&this.mapService.minScale!=null&&!isNaN(this.mapService.minScale))this.minScale=Math.min(this.minScale,this.mapService.minScale);if(this.mapService&&this.mapService.maxScale!=null&&!isNaN(this.mapService.maxScale))this.maxScale=Math.max(this.maxScale,this.mapService.maxScale);if(a.hasOwnProperty("queryable"))this.queryable=a.queryable;if(a.hasOwnProperty("searchable"))this.searchable=a.searchable;if(a.hasOwnProperty("snappable"))this.snappable=a.snappable;
if(a.hasOwnProperty("snappingEnabled"))this.snappingEnabled=a.snappingEnabled;if(a.hasOwnProperty("showFeatureHyperlinks"))this.showFeatureHyperlinks=a.showFeatureHyperlinks;if(a.hasOwnProperty("canToggleLabels"))this.canToggleLabels=a.canToggleLabels;if(a.hasOwnProperty("showLabels"))this.showLabels=a.showLabels;if(a.hasOwnProperty("showMapTips"))this.showMapTips=a.showMapTips;if(a.hasOwnProperty("supportsIdentify"))this.supportsIdentify=a.supportsIdentify;if(a.hasOwnProperty("supportsQuery"))this.supportsQuery=
a.supportsQuery;if(a.hasOwnProperty("layerHyperlinks"))for(b=0;b<a.layerHyperlinks.length;b++)this.layerHyperlinks[b]=new c.essentials.LayerHyperlink(a.layerHyperlinks[b],this);if(a.type!==void 0)this.type=this._convertLayerType(a.type);if(a.fields)for(b=0;b<a.fields.length;b++){var i=a.fields[b],d={dataType:c.essentials.Field.convertFromEsriType(i.type||i.dataType),alias:i.alias,displayName:i.displayName||i.alias||i.name,name:i.name,searchable:true,visible:true,focusField:false,hyperlinkLabel:null};
if(i.hasOwnProperty("searchable"))d.searchable=i.searchable;if(i.hasOwnProperty("visible"))d.visible=i.visible;this.fields[b]=new c.essentials.Field(d)}this.primaryKeyField=this.getFieldByName(a.primaryKeyField);this.displayField=this.getFieldByName(a.displayField);this.isInitialized=true};b.prototype._configureObject=function(a,b){if(a===void 0||a.name===void 0||a.id===void 0||a.hasDataLinks===void 0)throw Error("Incorrect layer object returned from initialization");this.defaultVisibility=a.defaultVisibility;
this.configuredVisible=a.visible;this.displayName=a.displayName;this.description=a.description;this.featureDescription=a.featureDescription;this.featureLongDescription=a.hasOwnProperty("featureLongDescription")?a.featureLongDescription:a.featureDescription;this.featureLabel=a.featureLabel;this.featureType=a.featureType===void 0?this.featureType:a.featureType;this.featureZoomScale=a.featureZoomScale===void 0?this.featureZoomScale:a.featureZoomScale;this.featureZoomFactor=a.featureZoomFactor===void 0?
this.featureZoomFactor:a.featureZoomFactor;this.hasDataLinks=a.hasDataLinks;this.hasReports=a.hasReports;this.hasAttachments=a.hasAttachments;this.id=a.id;this.name=a.name;this.wmsLayerName=a.nativeID;this.parentLayerId=a.parentLayerId;this.subLayerIds=a.subLayerIds;this.styleName=a.styleName;this.legendUrl=a.legendUrl;this.isDynamic=a.isDynamic===void 0?this.isDynamic:a.isDynamic;this.dynamicDefinition=a.dynamicDefinition;this.dataProvider=a.dataProvider;var i=a.fullExtent;if(i)this.fullExtent=new esri.geometry.Extent(i.xmin,
i.ymin,i.xmax,i.ymax,i.spatialReference);i=null;if(this.mapService&&this.mapService.essentialsMap)i=this.mapService.essentialsMap.site;this.iconUri=c.essentials.RestHelper.processClientSideTokens(i,a.iconUri);if(a.hasOwnProperty("includeInLayerList"))this.includeInLayerList=a.includeInLayerList;this._visible=this.mapService.essentialsMap.layerThemesInfo.startupThemeId!=null&&this.includeInLayerList?false:a.initiallyVisible===void 0?!!a.visible:!!a.initiallyVisible;if(a.themeSettings&&a.themeSettings.length)for(i=
0;i<a.themeSettings.length;i++){var d=a.themeSettings[i],j=this.mapService.essentialsMap.layerThemesInfo.getTheme(d.themeID);if(j){var f=d.visible==void 0?this.configuredVisible:d.visible;this.layerThemeSettings.push(new h.LayerThemeSetting(j,f));if(j.id===this.mapService.essentialsMap.layerThemesInfo.startupThemeId&&this.includeInLayerList)this._visible=d.initiallyVisible===void 0?f:d.initiallyVisible}}if(a.hasOwnProperty("drawIndex"))this.drawIndex=a.drawIndex;if(a.hasOwnProperty("featureBorderColor"))(this.featureBorderColor=
a.featureBorderColor)&&this.featureBorderColor.length>=4&&this.featureBorderColor[3]>=1&&(this.featureBorderColor[3]/=255);if(a.hasOwnProperty("featureFillColor"))(this.featureFillColor=a.featureFillColor)&&this.featureFillColor.length>=4&&this.featureFillColor[3]>=1&&(this.featureFillColor[3]/=255);if(a.hasOwnProperty("identifiable"))this.identifiable=a.identifiable;if(a.hasOwnProperty("includeInLegend"))this.includeInLegend=a.includeInLegend;this.minScale=a.hasOwnProperty("minScale")&&!isNaN(a.minScale)&&
a.minScale!=0?a.minScale:Infinity;this.maxScale=a.hasOwnProperty("maxScale")&&!isNaN(a.maxScale)?a.maxScale:0;if(this.mapService&&this.mapService.minScale!=null&&!isNaN(this.mapService.minScale))this.minScale=Math.min(this.minScale,this.mapService.minScale);if(this.mapService&&this.mapService.maxScale!=null&&!isNaN(this.mapService.maxScale))this.maxScale=Math.max(this.maxScale,this.mapService.maxScale);if(a.hasOwnProperty("queryable"))this.queryable=a.queryable;if(a.hasOwnProperty("searchable"))this.searchable=
a.searchable;if(a.hasOwnProperty("showFeatureHyperlinks"))this.showFeatureHyperlinks=a.showFeatureHyperlinks;if(a.hasOwnProperty("canToggleLabels"))this.canToggleLabels=a.canToggleLabels;if(a.hasOwnProperty("showLabels"))this.showLabels=a.showLabels;if(a.hasOwnProperty("showMapTips"))this.showMapTips=a.showMapTips;if(a.hasOwnProperty("snappable"))this.snappable=a.snappable;if(a.hasOwnProperty("snappingEnabled"))this.snappingEnabled=a.snappingEnabled;if(a.hasOwnProperty("supportsIdentify"))this.supportsIdentify=
a.supportsIdentify;if(a.hasOwnProperty("supportsQuery"))this.supportsQuery=a.supportsQuery;if(a.type!==void 0)this.type=this._convertLayerType(a.type);if(this.type==c.essentials.LayerType.GROUP_LAYER&&a.hasOwnProperty("isExpanded"))this.isExpanded=a.isExpanded;if(a.featureHyperlinks)for(i=0;i<a.featureHyperlinks.length;i++)this.featureHyperlinks[i]=new c.essentials.FeatureHyperlink(a.featureHyperlinks[i],this);if(a.fields)for(i=0;i<a.fields.length;i++)this.fields[i]=new c.essentials.Field(a.fields[i]);
if(a.relationships)for(i=0;i<a.relationships.length;i++)a.relationships[i].id=parseInt(a.relationships[i].id),a.relationships[i].relatedTableId=parseInt(a.relationships[i].relatedTableId),this.relationships.push(a.relationships[i]);if(a.hasOwnProperty("layerHyperlinks"))for(i=0;i<a.layerHyperlinks.length;i++)this.layerHyperlinks[i]=new c.essentials.LayerHyperlink(a.layerHyperlinks[i],this);if(a.hasOwnProperty("charts")&&c.charting&&dojo.isObject(c.charting.configuration.ChartDefinition))for(i=0;i<
a.charts.length;i++)this.charts.push(new c.essentials.LayerChart(a.charts[i],this));this.primaryKeyField=this.getFieldByName(a.primaryKeyField);this.displayField=this.getFieldByName(a.displayField);this._configureDataLinks(a.dataLinks,b);this._configureReports(a.reports,b);if(b)this.isInitialized=true;this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};b.prototype._configureReports=function(a,b){for(var i=0;a&&i<a.length;i++){this.reports[i]=new c.essentials.Report(this.url+
"/reports/"+a[i].id);this.reports[i].layer=this;if(this.mapService&&this.mapService.essentialsMap&&this.mapService.essentialsMap.site)this.reports[i].site=this.mapService.essentialsMap.site;this.reports[i]._configureObject(a[i],b)}};b.prototype.getObjectIdFieldName=function(){var a=null;if(this.primaryKeyField)a=this.primaryKeyField.name;return a};b.prototype._convertLayerType=function(a){return a=="FeatureLayer"||a=="DynamicFeatureLayer"?c.essentials.LayerType.FEATURE_LAYER:a=="GroupLayer"||a=="AnnotationLayer"?
c.essentials.LayerType.GROUP_LAYER:a=="RasterLayer"?c.essentials.LayerType.RASTER_LAYER:a=="GeoRssLayer"?c.essentials.LayerType.GEO_RSS_LAYER:c.essentials.LayerType.UNKNOWN};b.prototype._getRelation=function(a){typeof a=="string"&&(a=parseInt(a));for(var b=0;b<this.relationships.length;b++)if(this.relationships[b].id==a)return this.relationships[b];return null};b.prototype.getDefinitionExpression=function(a){var b=null,i=parseInt(this.id);if(a)a instanceof esri.layers.ArcGISDynamicMapServiceLayer?
(a=a.layerDefinitions)&&a[i]&&(b=a[i]):a instanceof esri.layers.FeatureLayer&&(i=a.getDefinitionExpression())&&(b=i);b||this.dynamicDefinition&&(b=c.essentials.RestHelper.getDynamicExpressionFromJson(this.dynamicDefinition));return b};b.prototype._createDynamicLayerInfo=function(){var a=null;if(this.isDynamic){a=c.essentials.RestHelper.getDynamicLayerInfoFromJson(this.dynamicDefinition,this.id);if(this.minScale<Infinity)a.minScale=this.minScale;if(this.maxScale>0)a.maxScale=this.maxScale}return a};
b.prototype.getLayerDrawingOptions=function(){var a=null;this.isDynamic&&(a=c.essentials.RestHelper.getLayerDrawingOptionsFromJson(this.dynamicDefinition));return a};b.prototype.getLayerThemeSettings=function(a){for(var b=0;b<this.layerThemeSettings.length;b++){var c=this.layerThemeSettings[b];if(c.theme===a||c.theme.id===a)return c}return null};b.prototype._syncProgramaticallyChangedLayerVisibility=function(a){this._visible=a};return b}(h.AsyncInitializable);h.Layer=f})(c.essentials||(c.essentials=
{}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.baseMapGroup=this.bingProperties=null;this.configuredOpacity=1;this.configuredVisible=false;this.attributionDataUrl=this.copyright=null;this.hasAttributionData=false;this.description=this.dataProvider=null;this.disableClientCaching=false;this.essentialsMap=this.drawingBehavior=this.displayName=null;this.extensions=[];this.failureAction=c.essentials.FailureAction.WARN;this.geometryServiceUrl=this.featureClustering=null;this.hasLayerCatalog=
false;this.initializationFailure=this.imageFormat=this.originalUrl=this.id=this.iconUri=null;this.isExpanded=this.includeInLayerList=true;this.isUserCreated=this.isServiceLayerLoaded=false;this.layers=[];this.layersFilteredView=[];this.minScale=this.maxScale=this.mapUrl=this.mapServiceType=this.mapServiceFunction=null;this.opacityFilter=this.opacity=1;this.operationalSpatialReference=null;this.inActiveTheme=true;this.layerThemeSettings=[];this.properties={};this.requestEncoding=this.proxyUrl=null;
this.instantSearch=false;this.shortDisplayName=this.serviceUrl=this.serviceToken=this.serviceLayer=this.serverVersion=null;this.subDomains=[];this.supportsDynamicLayers=false;this.heatMap=this.updateInterval=this.tileInfo=this.tileMatrixSet=null;this._needsProxy=this.includeCatalogItems=this.includeMosaicDatasetValues=this.identifiable=false;this._layersInfoPromise=this._delayedRefreshToken=this._updateIntervalId=this.layerVisibilityEventManager=null;this._initiallyVisible=false;this.originalUrl=
a;this.url=h.utilities.UrlUtilities.simplify(a);this.setInActiveTheme(true)}__extends(b,d);b.prototype._getLayersInfo=function(){var a=this;if(!this._layersInfoPromise)this._layersInfoPromise=new Promise(function(b,i){a.doWhenInitialized(function(){if(a.serviceUrl.endsWith("/MapServer")){var d=a.serviceUrl+"/Layers";a.serviceToken!==null&&(d=d+(d.indexOf("?")>-1?"&token=":"?token=")+encodeURIComponent(a.serviceToken));c.request({url:d,content:{f:"json"},load:function(a){b(a)},error:function(a){i(a)},
callbackParamName:"CallBack",preventCache:false},{gcx:{preventCache:false}})}else b(null)})});return this._layersInfoPromise};b.prototype.getConfiguredVisibleLayers=function(){return this._getVisibleLayersOfType("configuredVisible")};b.prototype.getDefaultVisibleLayers=function(){return this._getVisibleLayersOfType("defaultVisibility")};b.prototype.getVisibleLayers=function(){return this._getVisibleLayersOfType("_visible")};b.prototype._getVisibleLayersOfType=function(a){for(var b=[],c=0,d=0;d<this.layers.length;d++){var j=
this.layers[d];if(j[a]&&j.parentLayerId===null)j.subLayerIds===null||j.subLayerIds.length===0?b[c++]=j.id:c=this._getVisibleGroupLayersOfType(a,j,b,c)}return b};b.prototype.isVisible=function(){var a=false;if(this.serviceLayer&&typeof this.serviceLayer.visible==="boolean")a=this.serviceLayer.visible;return a};b.prototype.isTiled=function(){return this.serviceLayer?this.serviceLayer instanceof esri.layers.TiledMapServiceLayer:false};b.prototype.setVisibility=function(a){if(this.serviceLayer!==null){if(!this.supportsLayerVisibility()&&
this.layers.length)for(var b=0;b<this.layers.length;b++){var c=this.layers[b];c&&(c._visible=a)}a?this.serviceLayer.show():this.serviceLayer.hide()}};b.prototype.setOpacity=function(a){if(a==null||isNaN(a))a=1;this.opacity=a=Math.min(1,Math.max(0,a));this.serviceLayer&&this.serviceLayer.setOpacity&&this.serviceLayer.setOpacity(a*this.opacityFilter)};b.prototype.setOpacityFilter=function(a){isNaN(a)&&(a=1);this.opacityFilter=a=Math.min(1,Math.max(0,a));this.serviceLayer&&this.serviceLayer.setOpacity&&
this.serviceLayer.setOpacity(a*this.opacity)};b.prototype.setInActiveTheme=function(a){this.inActiveTheme=a;dojo.publish("MapServiceInActiveThemeChangedEvent",this)};b.prototype.findServiceToken=function(){return this.serviceToken?this.serviceToken:!this.essentialsMap||!this.essentialsMap.site||!this.essentialsMap.site.arcGisPortalSecurityContext?null:this.essentialsMap.site.arcGisPortalSecurityContext.getToken(this.serviceUrl)};b.prototype.findLayerByName=function(a){for(var b=0;b<this.layers.length;b++){var c=
this.layers[b];if(c.name==a||c.displayName==a)return c}return null};b.prototype.findLayerById=function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if(c.id==a)return c}return null};b.prototype.refresh=function(a){var b=this,c=this.serviceLayer;if(c&&typeof c.refresh==="function"){var d=function(){b._delayedRefreshToken=null;if(a===true&&typeof c.setDisableClientCaching==="function"){var a=c.disableClientCaching;c.setDisableClientCaching(true);c.refresh();c.setDisableClientCaching(a)}else c.refresh()};
this._delayedRefreshToken&&clearTimeout(this._delayedRefreshToken);typeof a!=="number"?d():this._delayedRefreshToken=setTimeout(d,a)}};b.prototype.refreshFilteredCollections=function(){var a=this;this.layersFilteredView.length=0;dojo.forEach(this.layers,function(b){return a._addToFilteredView(b)})};b.prototype._configureLayers=function(a,b){for(var i=0;a&&i<a.length;i++)this.layers[i]=new c.essentials.Layer(this.url+"/layers/"+a[i].id),this.layers[i].mapService=this,this.layers[i]._configureObject(a[i],
b);this._createServiceLayer();this.minScale&&this.serviceLayer.setMinScale(this.minScale);this.maxScale&&this.serviceLayer.setMaxScale(this.maxScale);this.disableClientCaching&&this.serviceLayer&&this.serviceLayer.setDisableClientCaching&&this.serviceLayer.setDisableClientCaching(true)};b.prototype._createFrom=function(a){this.id=a.id;this.mapServiceType=a.serviceType;this.mapServiceFunction=a.serviceFunction;this.displayName=a.displayName||a.name;this.shortDisplayName=a.shortDisplayName;this.baseMapGroup=
a.baseMapGroup;this.baseMapGroupIndex=a.baseMapGroupIndex;this.baseMapGroupIsMutuallyExclusive=a.baseMapGroupIsMutuallyExclusive;this.description=a.description;this.copyright=a.copyright;this.attributionDataUrl=a.attributionDataUrl;this.hasAttributionData=a.hasAttributionData;this._initiallyVisible=this.configuredVisible=!!a.visible;this.disableClientCaching=!!a.disableClientCaching;this.instantSearch=!!a.instantSearch;this.opacity=this.configuredOpacity=a.opacity;this.imageFormat=a.format;this.isExpanded=
a.isExpanded;this.serverVersion=a.serverVersion;this.failureAction=a.failureAction;this.tileMatrixSet=a.tileMatrixSet;this.requestEncoding=a.requestEncoding;this.operationalSpatialReference=a.operationalSpatialReference;this.dataProvider=a.dataProvider;this.minScale=a.minScale;this.maxScale=a.maxScale;this.identifiable=!!a.identifiable;this.includeCatalogItems=!!a.includeCatalogItems;this.includeMosaicDatasetValues=!!a.includeMosaicDatasetValues;if(a.tileInfo&&(this.tileInfo=dojo.clone(a.tileInfo),
this.tileInfo.spatialReference))this.tileInfo.spatialReference=this.tileInfo.spatialReference.wkid?new esri.SpatialReference(this.tileInfo.spatialReference.wkid):new esri.SpatialReference(this.tileInfo.spatialReference.wkt);this.supportsDynamicLayers=false;this.includeInLayerList=a.includeInLayerList;this.drawingBehavior=a.drawingBehavior||c.essentials.DrawingBehavior.FEATURE_LAYER;if(a.layerOptions){var b=new c.essentials.Layer("http://02A178F6-050B-4709-8825-32FB5E715543/"+a.id);b.mapService=this;
b._createFrom(a.layerOptions);this.layers.push(b)}this.isInitialized=true};b.prototype._configureObject=function(a,b){if(a===void 0||a.id===void 0||a.displayName===void 0||a.serviceType===void 0||a.connectionString===void 0)throw Error("Incorrect map service object returned from initialization");this.id=a.id;this.mapServiceType=a.serviceType;this.mapServiceFunction=a.serviceFunction===void 0?this.mapServiceFunction:a.serviceFunction;this.displayName=a.displayName;this.shortDisplayName=a.shortDisplayName;
this.baseMapGroup=a.baseMapGroup;this.baseMapGroupIndex=a.baseMapGroupIndex;this.baseMapGroupIsMutuallyExclusive=a.baseMapGroupIsMutuallyExclusive;this.description=a.description===void 0?this.description:a.description;this.copyright=a.copyright;this.attributionDataUrl=a.attributionDataUrl;this.hasAttributionData=a.hasAttributionData;this.configuredVisible=!!a.visible;this.disableClientCaching=!!a.disableClientCaching;this.instantSearch=!!a.instantSearch;this.opacity=this.configuredOpacity=a.opacity===
void 0||a.opacity===null?this.configuredOpacity:a.opacity;this.imageFormat=a.format===void 0?this.imageFormat:a.format;if(a.updateInterval!==void 0){var i=a.updateInterval;i&&i<10&&i!==0&&(i=10);this.updateInterval=i;this._resetUpdateTimer()}this.isExpanded=a.isExpanded===void 0?this.isExpanded:a.isExpanded;this.serverVersion=a.serverVersion;this.failureAction=a.failureAction;this.tileMatrixSet=a.tileMatrixSet;this.requestEncoding=a.requestEncoding;this.operationalSpatialReference=a.operationalSpatialReference;
this.dataProvider=a.dataProvider;this.minScale=a.minScale;this.maxScale=a.maxScale;this.identifiable=!!a.identifiable;this.includeCatalogItems=!!a.includeCatalogItems;this.includeMosaicDatasetValues=!!a.includeMosaicDatasetValues;if(a.tileInfo&&(this.tileInfo=dojo.clone(a.tileInfo),this.tileInfo.spatialReference))this.tileInfo.spatialReference=this.tileInfo.spatialReference.wkid?new esri.SpatialReference(this.tileInfo.spatialReference.wkid):new esri.SpatialReference(this.tileInfo.spatialReference.wkt);
if(typeof a.includeInLayerList==="boolean")this.includeInLayerList=a.includeInLayerList;this._initiallyVisible=this.essentialsMap.layerThemesInfo.startupThemeId!=null&&this.includeInLayerList?false:a.initiallyVisible===void 0?!!a.visible:!!a.initiallyVisible;if(a.themeSettings&&a.themeSettings.length)for(i=0;i<a.themeSettings.length;i++){var d=a.themeSettings[i],j=this.essentialsMap.layerThemesInfo.getTheme(d.themeID);if(j){var f=d.visible==void 0?this.configuredVisible:d.visible;this.layerThemeSettings.push(new h.LayerThemeSetting(j,
f));if(j.id===this.essentialsMap.layerThemesInfo.startupThemeId&&this.includeInLayerList)this._initiallyVisible=d.initiallyVisible===void 0?f:d.initiallyVisible}}this.supportsDynamicLayers=a.supportsDynamicLayers===void 0?this.supportsDynamicLayers:a.supportsDynamicLayers;this.hasLayerCatalog=a.hasLayerCatalog===void 0?this.hasLayerCatalog:a.hasLayerCatalog;if(a.iconUri){i=null;if(this.essentialsMap)i=this.essentialsMap.site;this.iconUri=c.essentials.RestHelper.processClientSideTokens(i,a.iconUri)}if(a.featureClustering)this.featureClustering=
{enabled:a.featureClustering.enabled,userCanToggle:a.featureClustering.userCanToggle,radius:a.featureClustering.radius,maximumFeatures:a.featureClustering.clusterSize,backgroundColor:a.featureClustering.backgroundColor,labelColor:a.featureClustering.labelColor};if(a.featureHeatMap)this.heatMap=a.featureHeatMap;this.drawingBehavior=a.drawingBehavior===void 0?this.drawingBehavior:a.drawingBehavior;this._processConnectionString(a.connectionString,a);this._processProxyInfo(a.proxyInfo);this._configureLayers(a.layers,
b);if(b)this.isInitialized=true;this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions);this.setOpacity(this.configuredOpacity)};b.prototype._updateServiceToken=function(a){this.serviceToken=a;if(this.serviceLayer&&this.serviceLayer._url){var b=this.serviceLayer._url;if(b.query){b.query.token=a;var c=dojo.objectToQuery(b.query);this.serviceLayer.url=b.path+(c?"?"+c:"")}}dojo.publish("ServiceTokenRefreshed",{serviceUrl:this.serviceUrl,token:a})};b.prototype._addDefinitionExpression=
function(a,b){if(!a)throw Error("Expecting a layer");b=b||this.serviceLayer;if(b instanceof esri.layers.ArcGISDynamicMapServiceLayer){var c=a.getDefinitionExpression(null);if(c){var d=parseInt(a.id),j=b.layerDefinitions||[];if(d)j[d]=c,b.setLayerDefinitions(j);else throw Error("Failed to add definition expression for "+a.displayName);}}};b.prototype._removeDefinitionExpression=function(a,b){if(a&&(b=b||this.serviceLayer)&&b instanceof esri.layers.ArcGISDynamicMapServiceLayer){var c=parseInt(a.id);
if(c&&b.layerDefinitions){var d=b.layerDefinitions;d[c]&&(d.splice(c,1),b.setLayerDefinitions(d))}}};b.prototype._createServiceLayer=function(){if(this.serviceLayer==null){var a=this.serviceUrl;this.serviceToken!==null&&(a=a+(a.indexOf("?")>-1?"&token=":"?token=")+encodeURIComponent(this.serviceToken));if(this.drawingBehavior==="MapService"){var b;switch(this.mapServiceType){case c.essentials.MapServiceType.DYNAMIC:if(this._needsProxy)esri.config.defaults.io.alwaysUseProxy=true;var i=new esri.layers.ArcGISDynamicMapServiceLayer(a,
{id:this.id});if(this.attributionDataUrl&&this.attributionDataUrl!=="")i.attributionDataUrl=this.attributionDataUrl,i.hasAttributionData=true;else if(this.hasAttributionData)i.attributionDataUrl=this.url+"/Attribution",i.hasAttributionData=true;b=this.getVisibleLayers();b.length===0?i.setVisibleLayers&&(this.layers.length===0?i.setVisibleLayers(b,false):i.setVisibleLayers(["-1"],false)):i.setVisibleLayers&&i.setVisibleLayers(b,false);for(b=0;b<this.layers.length;b++)this._addDefinitionExpression(this.layers[b],
i);this.layerVisibilityEventManager=new h.LayerVisibilityEventManager(this,i);i.setImageFormat(this._getAgsDynamicImageFormat(this.imageFormat));dojo.connect(i,"onError",this,this._layerLoadErrorHandler);dojo.connect(i,"onLoad",this,function(){this._handleServiceLayerLoaded(i);this._handleDynamicLayers(i)});this._initiallyVisible?i.show():i.hide();this.serviceLayer=i;break;case c.essentials.MapServiceType.TILED:b=new esri.layers.ArcGISTiledMapServiceLayer(a,{id:this.id});if(this.attributionDataUrl&&
this.attributionDataUrl!=="")b.attributionDataUrl=this.attributionDataUrl,b.hasAttributionData=true;else if(this.hasAttributionData)b.attributionDataUrl=this.url+"/Attribution",b.hasAttributionData=true;dojo.connect(b,"onError",dojo.hitch(this,this._layerLoadErrorHandler));dojo.connect(b,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));this._initiallyVisible?b.show():b.hide();this.serviceLayer=b;break;case c.essentials.MapServiceType.IMAGE:b=null;this._hasTileLevels()?b=new esri.layers.ArcGISTiledMapServiceLayer(a,
{id:this.id}):(b=new esri.layers.ArcGISImageServiceLayer(a,{id:this.id}),b.setImageFormat(this._getAgsImageServiceImageFormat(this.imageFormat)));if(this.attributionDataUrl&&this.attributionDataUrl!=="")b.attributionDataUrl=this.attributionDataUrl,b.hasAttributionData=true;else if(this.hasAttributionData)b.attributionDataUrl=this.url+"/Attribution",b.hasAttributionData=true;dojo.connect(b,"onError",this,this._layerLoadErrorHandler);dojo.connect(b,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));
this._initiallyVisible?b.show():b.hide();this.serviceLayer=b;break;case c.essentials.MapServiceType.BING:b=new esri.virtualearth.VETiledLayer(this.bingProperties);dojo.connect(b,"onError",this,this._layerLoadErrorHandler);dojo.connect(b,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));this._initiallyVisible?b.show():b.hide();this.serviceLayer=b;break;case c.essentials.MapServiceType.WMS:if(!dojo.isObject(esri.layers.WMSLayer))throw Error("This Javascript application must // dojo.require the esri.layers.wms package in order to use a site with a WMS service.");
this._extendWms();var d=false;for(b=0;b<this.layers.length;b++)if(this.layers[b].wmsLayerName){d=true;break}var j;if(d){b={extent:this.essentialsMap.initialExtent,layerInfos:this._constructWmsLayerInfos(),version:this.serverVersion};j=new esri.layers.WMSLayer(a,{resourceInfo:b,visibleLayers:this._getWmsVisibleLayers()});if(this.operationalSpatialReference!=null)b=parseInt(this.operationalSpatialReference.replace(/^.*:/,"")),j.spatialReferences.push(b),j.preferredSpatialReference=b;dojo.connect(j,
"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded))}else j=new esri.layers.WMSLayer(a),dojo.connect(j,"onLoad",dojo.hitch(this,this._finishWmsLayerConfiguration));if(this.attributionDataUrl&&this.attributionDataUrl!=="")j.attributionDataUrl=this.attributionDataUrl,j.hasAttributionData=true;else if(this.hasAttributionData)j.attributionDataUrl=this.url+"/Attribution",j.hasAttributionData=true;this.layerVisibilityEventManager=new h.LayerVisibilityEventManager(this,j);j.setImageFormat(this._getEsriWmsImageFormat());
j.__gcxWmsImageFormat=this.imageFormat;dojo.connect(j,"onError",this,this._layerLoadErrorHandler);this._initiallyVisible?j.show():j.hide();this.serviceLayer=j;try{require(["dojo/request"],function(b){b(a,{headers:{"X-Requested-With":null},withCredentials:true}).then(function(){j.refresh()},function(){j.refresh()})})}catch(f){}break;case c.essentials.MapServiceType.WMTS:if(!dojo.isObject(esri.layers.WMTSLayer))throw Error("This JavaScript application must // dojo.require the esri.layers.wmts package in order to use a site with WMTS service.");
if(this.layers.length==0)throw Error("You must include at least one layer in your WMTS. Service "+this.displayName+" has 0 layers.");b=c.essentials.GeometryUtilities.scaleEnvelopeWithoutTranslation(this.layers[0].fullExtent,1.1);b==null&&(b=c.essentials.GeometryUtilities.scaleEnvelopeWithoutTranslation(this.essentialsMap.fullExtent,1.1));d=new esri.layers.WMTSLayerInfo({tileInfo:this.tileInfo,fullExtent:b,initialExtent:b,identifier:this.layers.length>0?this.layers[0].name:null,tileMatrixSet:this.tileMatrixSet,
format:this._getEsriOgcImageFormat(),style:this.layers[0].styleName});b={version:this.serverVersion,layerInfos:[d],getTileUrl:this._prefixProxy(this.mapUrl)};b=new esri.layers.WMTSLayer(a,{serviceMode:"KVP",resourceInfo:b,layerInfo:d});if(this.attributionDataUrl&&this.attributionDataUrl!=="")b.attributionDataUrl=this.attributionDataUrl,b.hasAttributionData=true;else if(this.hasAttributionData)b.attributionDataUrl=this.url+"/Attribution",b.hasAttributionData=true;if(b._url){var k=0,m=c.hasProxy()?
2:1;b._url=b._url.replace(/\?/g,function(){k++;return k<=m?"?":""})}dojo.connect(b,"onError",this,this._layerLoadErrorHandler);dojo.connect(b,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));this._initiallyVisible?b.show():b.hide();this.serviceLayer=b;break;case c.essentials.MapServiceType.WEBTILED:b=a.replace(/([^$])({[^}]*})/g,function(a,b,g){return b+"$"+g});d={copyright:this.copyright,id:this.id,subDomains:null};if(b.indexOf("${subDomain}")>=0)d.subDomains=this.subDomains;b=new esri.layers.WebTiledLayer(b,
d);if(this.attributionDataUrl&&this.attributionDataUrl!=="")b.attributionDataUrl=this.attributionDataUrl,b.hasAttributionData=true;else if(this.hasAttributionData)b.attributionDataUrl=this.url+"/Attribution",b.hasAttributionData=true;this._initiallyVisible?b.show():b.hide();dojo.connect(b,"onError",this,this._layerLoadErrorHandler);dojo.connect(b,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));this.serviceLayer=b}}}};b.prototype._prefixProxy=function(a){return this.proxyUrl?this.proxyUrl+
"?"+a:a};b.prototype._constructWmsLayerInfos=function(){for(var a=[],b=0;b<this.layers.length;b++){var c=this.layers[b];if(c.wmsLayerName!=null){var d=new esri.layers.WMSLayerInfo({name:c.wmsLayerName,title:c.name});d.styleName=c.styleName;a.push(d)}}return a};b.prototype._getWmsVisibleLayers=function(){for(var a=[],b=0;b<this.layers.length;b++){var c=this.layers[b];c.isVisible()&&c.areAllAncestorsVisible()&&c.wmsLayerName!=null&&c.subLayerIds.length==0&&a.push(c.wmsLayerName)}return a};b.prototype._applyWmsLayerVisibility=
function(){this.serviceLayer.setVisibleLayers(this._getWmsVisibleLayers())};b.prototype._getEsriWmsImageFormat=function(){var a=this._getEsriOgcImageFormat();a=="jpeg"&&(a="jpg");return a};b.prototype._getEsriOgcImageFormat=function(){return this.imageFormat!=null?this.imageFormat.replace(/^image\//,""):null};b.prototype._findWMSLayerName=function(a,b){for(var c in a){var d=a[c];if(d.title===b)return d.name;if(d.subLayers!==null&&d.subLayers.length>0&&(d=this._findWMSLayerName(d.subLayers,b),d!==
null))return d}return null};b.prototype._finishWmsLayerConfiguration=function(a){for(var b=[],c=0,d,j=0;j<this.layers.length;j++){var f=this.layers[j];if(f.configuredVisible&&(f.subLayerIds===null||f.subLayerIds.length===0))if(f.parentLayerId!==null){if(this.findLayerById(f.parentLayerId).configuredVisible)d=this._getWMSLayerNameFromTitle(f.name),f.wmsLayerName=d,d!==null&&d!==""&&(b[c]=d,c++)}else d=this._getWMSLayerNameFromTitle(f.name),f.wmsLayerName=d,d!==null&&d!==""&&(b[c]=d,c++)}this.serviceLayer.setVisibleLayers(b);
this._handleServiceLayerLoaded(a)};b.prototype._handleServiceLayerLoaded=function(a){this.isServiceLayerLoaded=true;if(this.essentialsMap&&this.essentialsMap.site&&dojo.isFunction(this.essentialsMap.site.onLayerLoad))this.essentialsMap.site.onLayerLoad(a)};b.prototype.convertToDynamicLayers=function(){var a=this.serviceLayer;if(a&&a instanceof esri.layers.ArcGISDynamicMapServiceLayer&&(a.dynamicLayerInfos||a.setDynamicLayerInfos(this._createDynamicLayerInfos(a)),!a.layerDrawingOptions))a.layerDrawingOptions=
[]};b.prototype._layerLoadErrorHandler=function(a){if(!a||!(a.message&&a.message.indexOf("Unable to load tile")==0))if(this.initializationFailure=a,this.essentialsMap&&this.essentialsMap.site&&dojo.isFunction(this.essentialsMap.site.onLayerLoadError))this._layerLoadErrorHandler=this.essentialsMap.site.onLayerLoadError};b.prototype.remove=function(a){if(!a)throw Error("Expecting a layer.");var b=this.serviceLayer;if(a.isDynamic&&this.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&
this.serviceLayer){this.convertToDynamicLayers();var c=parseInt(a.id,10),d=this.findLayerById(a.id);if(d!=null){var f=this.layers.indexOf(d);f>-1&&(d.setInActiveTheme(false),this.layers.splice(f,1))}d=this.getVisibleLayers();if(c!=null){var h=[];b.dynamicLayerInfos&&(h=dojo.clone(this.serviceLayer.dynamicLayerInfos));var k=[];if(b.layerDrawingOptions)k=this.serviceLayer.layerDrawingOptions;if(a.isDynamic){for(var f=null,m=0;m<h.length;m++)if(h[m].id===c){f=h[m];break}f&&(f=h.indexOf(f),f>-1&&(h.splice(f,
1),b.setDynamicLayerInfos(h,true)));var c=[],n;for(n in k)k.hasOwnProperty(n)&&n!==a.id&&(c[n]=dojo.clone(k[n]));this._removeDefinitionExpression(a,b);b.setLayerDrawingOptions(c)}d.indexOf(a.id)>-1&&d.splice(d.indexOf(a.id),1);this._syncLayerVisibilities(d)}else throw"Could not convert Layer ID '"+a.id+"' into an integer!";}else throw"MapService - remove() - Unsupported Layer Type.";};b.prototype.add=function(a){if(!a)throw Error("Expecting a layer");var b=this.serviceLayer;if(a.isDynamic&&b instanceof
esri.layers.ArcGISDynamicMapServiceLayer){this.convertToDynamicLayers();var c=this.getVisibleLayers();a.mapService=this;this.layers.push(a);var d=[];if(b.dynamicLayerInfos)d=b.dynamicLayerInfos;var f=[];if(b.layerDrawingOptions)f=b.layerDrawingOptions;var h,k=parseInt(a.id,10);if(k!=null){h=a._createDynamicLayerInfo();if(!h.name)h.name=a.displayName;h!=null&&d.push(h);h=a.getLayerDrawingOptions();h!=null&&(f[k]=h);f.length>0&&b.setLayerDrawingOptions(f,true);this._addDefinitionExpression(a,b);b.setDynamicLayerInfos(d);
c.push(a.id);this._syncLayerVisibilities(c)}else throw"Could not convert Layer ID '"+a.id+"' into an integer!";}else throw"MapService - add() - Unsupported layer type..";};b.prototype.getDynamicLayerInfoById=function(a){var b=null;if(this.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer&&(a=parseInt(a,10),!isNaN(a))){var c=this.serviceLayer.dynamicLayerInfos;if(c)for(var d=0;d<c.length;d++)c[d].id===a&&(b=c[d])}return b};b.prototype._syncLayerVisibilities=function(a){for(var b=0;b<
this.layers.length;b++)this.layers[b].visibleStateForRefresh=a.indexOf(this.layers[b].id)>-1?c.essentials.RefreshVisibility.SHOW:c.essentials.RefreshVisibility.HIDE;a.length==0&&a.push("-1");this.serviceLayer.setVisibleLayers(a)};b.prototype._handleDynamicLayers=function(a){var b=this;if(this.supportsDynamicLayers){var c=dojo.some(this.layers,function(a){return a.isDynamic}),d=dojo.some(this.layers,function(a){return a.drawIndex!=null}),f=dojo.some(this.layers,function(a){return a.canToggleLabels&&
!a.showLabels});if(c||d||f||this.hasLayerCatalog){if(c=this.essentialsMap.getMap()){if((!c.spatialReference||(!c.spatialReference.wkid||c.spatialReference.wkid<=0)&&(!c.spatialReference.wkt||!c.spatialReference.wkt.trim()))&&a.spatialReference!=null&&a.spatialReference.wkt&&a.spatialReference.wkt.trim())c.spatialReference=a.spatialReference;if(c.extent&&(!c.extent.spatialReference||(!c.extent.spatialReference.wkid||c.extent.spatialReference.wkid<=0)&&(!c.extent.spatialReference.wkt||!c.extent.spatialReference.wkt.trim()))&&
a.spatialReference!=null&&a.spatialReference.wkt&&a.spatialReference.wkt.trim())c=new esri.geometry.Extent(c.extent),c.spatialReference=a.spatialReference,this.essentialsMap.extentManager.setExtentWithPriority(c,2)}var h=this._createDynamicLayerInfos(a),k=[];a.layerDrawingOptions&&(k=dojo.mixin([],a.layerDrawingOptions));f&&dojo.forEach(this.layers,function(a){if(a.canToggleLabels){var b=a.getLayerDrawingOptions();if(b==null){var b=new esri.layers.LayerDrawingOptions,c=parseInt(a.id,10);k[c]=b}b.showLabels=
a.showLabels}});dojo.forEach(this.layers,function(a,b){if(a.isDynamic){var c,g=parseInt(a.id,10);if(g){c=a._createDynamicLayerInfo();if(!c.name)c.name=a.name;c&&h.splice(b,0,c);if(c=a.getLayerDrawingOptions())if(k[g]=c,a.showLabels!=null)c.showLabels=a.showLabels}else throw"Could not convert Layer ID '"+a.id+"' into an integer!";}});if(d){var m=dojo.clone(h),n=[];dojo.forEach(this.layers,function(a){a!=null&&a.drawIndex!=null&&n.push(a)});n.sort(function(a,b){return a.drawIndex-b.drawIndex});dojo.forEach(n,
function(a){for(var b=null,c=null,g=0;g<m.length;g++){var d=m[g];if(d.id.toString()==a.id){b=d;c=g;break}}b!=null&&c!=null&&(m.splice(c,1),m.push(b))});h=[];dojo.forEach(m,function(a){h.push(a)})}setTimeout(function(){k.length>0&&a.setLayerDrawingOptions(k,true);h.length>0&&a.setDynamicLayerInfos(h,true);var c=b.getVisibleLayers();c.InternallyChangedLayer={};c.length>0||c.push("-1");a.setVisibleLayers(c)},0)}}};b.prototype._createDynamicLayerInfos=function(a,b){b==void 0&&(b=true);var c=null;if(a!=
null&&(c=a.createDynamicLayerInfosFromLayerInfos(),b))for(var d=c.length-1;d>=0;d--){var f=this.findLayerById(c[d].id.toString());(f==null||f.isDynamic)&&c.splice(d,1)}return c};b.prototype._getAgsDynamicImageFormat=function(a){if(typeof a=="undefined"||a===null||a.length<1)return"png8";a=a.toLowerCase();switch(a){case "png":case "png8":case "png24":case "png32":case "jpeg":case "jpg":case "gif":case "bmp":case "svg":case "svgz":case "emf":case "ps":case "pdf":return a;default:return"png8"}};b.prototype._getAgsImageServiceImageFormat=
function(a){if(typeof a=="undefined"||a===null||a.length<1)return null;a=a.toLowerCase();switch(a){case "jpgpng":case "png":case "png8":case "png24":case "png32":case "jpeg":case "jpg":case "gif":case "bmp":case "tiff":return a;default:return null}};b.prototype._getVisibleGroupLayersOfType=function(a,b,c,d){if(b[a])for(var f=0;f<b.subLayerIds.length;f++){var h=this.findLayerById(b.subLayerIds[f]);if(h[a])if(h.subLayerIds!==null&&h.subLayerIds.length>0)d=this._getVisibleGroupLayersOfType(a,h,c,d);
else if(dojo.indexOf(c,h.id)<0)c[d]=h.id,d++}return d};b.prototype._getWMSLayerNameFromTitle=function(a){return this.serviceLayer instanceof esri.layers.WMSLayer?this._findWMSLayerName(this.serviceLayer.layerInfos,a):null};b.prototype._getPrincipalResult=function(a){if(this.essentialsMap&&this.essentialsMap.site)return!this.essentialsMap.site.principal?void 0:a(this.essentialsMap.site.principal)};b.prototype._processConnectionString=function(a,b){var d=c.essentials.ServiceHelper.extractConnectionStringValue;
if(this.mapServiceType==c.essentials.MapServiceType.BING){this.bingProperties={};var p;if((p=d(a,"mapStyle"))&&p.length>0)this.bingProperties.mapStyle=p;if((p=d(a,"culture"))&&p.length>0)this.bingProperties.culture=p;if((p=d(a,"key"))&&p.length>0)this.bingProperties.bingMapsKey=p}else{p=d(a,"url");if(p.length>0)this.serviceUrl=p.replace(/%3d/g,"=").replace(/%3D/g,"=");else if((this.mapServiceType===c.essentials.MapServiceType.DYNAMIC||this.mapServiceType===c.essentials.MapServiceType.TILED)&&this.essentialsMap.site.getEssentialsVersion()>=
3.912||(this.mapServiceType===c.essentials.MapServiceType.FEATURE||this.mapServiceType===c.essentials.MapServiceType.IMAGE)&&this.essentialsMap.site.getEssentialsVersion()>=4.01){if(this.essentialsMap.site.getEssentialsVersion()<4.03)this.serviceUrl=this.url+"/MapServer";else if(this.mapServiceType===c.essentials.MapServiceType.FEATURE)if(b&&b.layers&&b.layers.length>0&&b.layers[0])this.serviceUrl=this.url+"/GeoREST/FeatureServer/"+b.layers[0].id;else throw Error("Unable to configure FeatureLayer connection string. No child layer is specified.");
else this.serviceUrl=this.mapServiceType===c.essentials.MapServiceType.IMAGE?this.url+"/GeoREST/ImageServer":this.url+"/GeoREST/MapServer";if(this._getPrincipalResult(function(a){return a.isAuthenticated}))this.serviceToken=this._getPrincipalResult(function(a){return a.tokens.site});if(this.essentialsMap.site.currentVersion==="3.912")this._needsProxy=true}p=d(a,"geometryServiceUrl");if(p.length>0)this.geometryServiceUrl=p;if(this.essentialsMap&&this.essentialsMap.site&&!this.serviceToken)this.serviceToken=
this.essentialsMap.site.getTokenFromPrincipal(this.serviceUrl,this.mapServiceType);p=d(a,"token");var f=this.essentialsMap&&this.essentialsMap.site?this.essentialsMap.site.arcGisPortalSecurityContext:null;if(p.length>0)this.serviceToken=p;else if(f&&f.appliesTo(this.serviceUrl)&&f.tokenResult)this.serviceToken=f.tokenResult.token;else if(this.serviceUrl!=null&&(p=c.essentials.RestHelperHTTPService.getAuthenticationControlBlockStore().find(this.serviceUrl))&&p.token!=null)this.serviceToken=p.token;
p=d(a,"proxy");if(p.length>0)this.proxyUrl=p,esri.addProxyRule({urlPrefix:this.serviceUrl,proxyUrl:p}),this.serviceUrl.indexOf("services.arcgis")>-1&&esri.addProxyRule({urlPrefix:this.serviceUrl.replace("services.arcgis","server.arcgis"),proxyUrl:p});p=d(a,"mapUrl");if(p.length>0)this.mapUrl=p.replace(/%3d/g,"=").replace(/%3D/g,"=");if(d=d(a,"subDomains"))this.subDomains=d.split(",")}};b.prototype._isLocalProxyInfo=function(a){return!a?false:a.type!="local-reverse-proxy"?false:!a.address?false:true};
b.prototype._processProxyInfo=function(a){if(this._isLocalProxyInfo(a)){for(var a=(this.url+"/../../../../../"+a.address).split("/"),b=a.indexOf("..");b>0;b=a.indexOf(".."))a.splice(b-1,2);this.serviceUrl=a.join("/")}};b.prototype.supportsLayerVisibility=function(){switch(this.mapServiceType){case c.essentials.MapServiceType.FEATURE:case c.essentials.MapServiceType.GEORSS:case c.essentials.MapServiceType.KML:case c.essentials.MapServiceType.BING:case c.essentials.MapServiceType.TILED:case c.essentials.MapServiceType.WMTS:case c.essentials.MapServiceType.IMAGE:case c.essentials.MapServiceType.WEBTILED:return false;
case c.essentials.MapServiceType.DYNAMIC:return this.serviceLayer!==null&&!!this.serviceLayer.visibleLayers}return true};b.prototype._setVisibility=function(a,b,d){a={mapServiceId:this.id,layerId:a,visibility:b};d===void 0&&(d=false);var p,f;switch(this.mapServiceType){case c.essentials.MapServiceType.DYNAMIC:if(this.serviceLayer!==null){if(!this.serviceLayer.visibleLayers){b?this.serviceLayer.show():this.serviceLayer.hide();dojo.publish("LayerVisibilityChange",[Array(a)]);break}b=this.getVisibleLayers();
b.InternallyChangedLayer=a;b.length===0&&b.push("-1");this.serviceLayer.setVisibleLayers&&this.serviceLayer.setVisibleLayers(b,d)}break;case c.essentials.MapServiceType.WMS:if(this.serviceLayer!==null){var h=[];h.InternallyChangedLayer=a;for(p=b=0;p<this.layers.length;p++)if(f=this.layers[p],f.isVisible()&&(f.subLayerIds===null||f.subLayerIds.length===0)&&f.areAllAncestorsVisible())f=f.wmsLayerName,f!==null&&f!==""&&(h[b]=f,b++);d?(this.serviceLayer.visibleLayers=h.slice(0),dojo.publish("LayerVisibilityChange",
[Array(a)])):this.serviceLayer.setVisibleLayers(h)}break;case c.essentials.MapServiceType.FEATURE:case c.essentials.MapServiceType.GEORSS:case c.essentials.MapServiceType.KML:case c.essentials.MapServiceType.BING:case c.essentials.MapServiceType.TILED:case c.essentials.MapServiceType.WMTS:case c.essentials.MapServiceType.IMAGE:case c.essentials.MapServiceType.WEBTILED:if(this.serviceLayer!==null)if(this.layers.length===1)b?this.serviceLayer.show():this.serviceLayer.hide(),dojo.publish("LayerVisibilityChange",
[Array(a)]);else throw Error("Visibility of individual layers cannot be set for this Map Service: {0}".format(this.displayName));break;default:throw Error("Cannot set layer visibility. Unknown MapService type.");}};b.prototype._extendWms=function(){if(!c.essentials.MapService._wmsExtended){var a=esri.layers.WMSLayer._meta.hidden.getImageUrl,b=/.*images\/pixel.png$/;esri.layers.WMSLayer.extend({getImageUrl:function(c,d,f,h){var k=this;a.apply(this,[c,d,f,function(a){if(!b.test(a)){for(var c={},d=0;d<
k.layerInfos.length;d++)c[k.layerInfos[d].name]=k.layerInfos[d].styleName;for(var i=[],d=0;d<k.visibleLayers.length;d++)i.push(c[k.visibleLayers[d]]);c=i.join(",");d=a.substring(a.lastIndexOf("?")+1,a.length);d=dojo.queryToObject(d);d.STYLES=c;k.preferredSpatialReference&&(d[d.CRS?"CRS":"SRS"]="EPSG:"+k.preferredSpatialReference);if(k.__gcxWmsImageFormat)d.FORMAT=k.__gcxWmsImageFormat;a=a.substring(0,a.lastIndexOf("?")+1)+dojo.objectToQuery(d)}h(a)}])}});c.essentials.MapService._wmsExtended=true}};
b.prototype._hasTileLevels=function(){return!this.tileInfo?false:!this.tileInfo.lods?false:this.tileInfo.lods.length>0?true:false};b.prototype.applyCatalogLayersChange=function(a){var b=false,d=[];if(this.id==a.mapServiceId){for(var f=0;f<a.entries.length;f++){var j=new c.essentials.Layer(this.url+" / layers /"+a.entries[f].id);a.entries[f].visible=true;j.createFromDefinition(a.entries[f]);j.isUserCreated=true;j.includeInLayerList=true;j.setInActiveTheme(true);d.push(j)}a=[];for(f=0;f<this.layers.length;f++)if(this.layers[f].isUserCreated){for(var j=
null,h=0;h<d.length;h++)if(d[h].id===this.layers[f].id){j=d[h];break}j==null?a.push(this.layers[f]):(h=d.indexOf(j),j.setInActiveTheme(false),h>-1&&d.splice(h,1))}for(f=0;f<a.length;f++)this.remove(a[f]),b=true;for(f=0;f<d.length;f++)this.add(d[f]),b=true;return b?(dojo.publish("CatalogLayersChangedEvent",this),d):[]}};b.prototype.getLayerThemeSettings=function(a){for(var b=0;b<this.layerThemeSettings.length;b++){var c=this.layerThemeSettings[b];if(c.theme===a||c.theme.id===a)return c}return null};
b.prototype._resetUpdateTimer=function(){if(this.updateInterval!=void 0&&this.updateInterval!=0){this._updateIntervalId!=void 0&&window.clearInterval(this._updateIntervalId);var a=this;this._updateIntervalId=setInterval(function(){a._onUpdateIntervalTick()},this.updateInterval*1E3)}else window.clearInterval(this._updateIntervalId),this._updateIntervalId=null};b.prototype._onUpdateIntervalTick=function(){this.serviceLayer&&this.serviceLayer.refresh&&(this.serviceLayer.setDisableClientCaching?(this.serviceLayer.setDisableClientCaching(true),
this.serviceLayer.refresh(),this.serviceLayer.setDisableClientCaching(this.disableClientCaching)):this.serviceLayer.refresh())};b.prototype._addToFilteredView=function(a){a&&this._layerThemeLayerFilter(a)&&this.layersFilteredView.push(a)};b.prototype._layerThemeLayerFilter=function(a){return a.mapService.essentialsMap.layerThemesInfo.layerThemesConfigured?a.inActiveTheme:true};b.prototype._getDefaultGeometryServiceUrl=function(){var a=this.essentialsMap?this.essentialsMap.site:null;return a&&a.geometryEndpoints&&
a.geometryEndpoints.length>0?a.geometryEndpoints[0].geometryServiceUrl:null};b.prototype._getDefaultGeometryServiceToken=function(){var a=this.essentialsMap?this.essentialsMap.site:null;return a&&a.geometryEndpoints&&a.geometryEndpoints.length>0?a.geometryEndpoints[0].geometryServiceToken:null};b._wmsExtended=false;return b}(h.AsyncInitializable);h.MapService=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.color=[255,0,0];this.selectionColor=[0,255,255];this.disableClientCaching=false;this.onDemandCacheSize=1E3;this.outFields="";this.queryMode=esri.layers.FeatureLayer.MODE_ONDEMAND;this.renderer=this.scaleEnabled=this.editVerticesEnabled=this.rotateEnabled=this.moveEnabled=this.canAddAttachments=this.canEdit=this.canDelete=this.canAdd=this.canUpdate=this.where=this.tileWidth=this.tileHeight=null;this._colorSet=false;this._serviceLayer=
this._initialFeatureCollection=null;this.serviceUrl=a}__extends(b,d);b.prototype.getEmptyFeatureCollection=function(){return JSON.parse(this._initialFeatureCollection)};b.prototype.restoreFeatureLayer=function(){if(!this._serviceLayer._mode)switch(this._serviceLayer.mode){case esri.layers.FeatureLayer.MODE_SNAPSHOT:this._serviceLayer._mode=new esri.layers._SnapshotMode(this._serviceLayer);break;case esri.layers.FeatureLayer.MODE_ONDEMAND:this._serviceLayer._mode=new esri.layers._OnDemandMode(this._serviceLayer);
break;case esri.layers.FeatureLayer.MODE_SELECTION:this._serviceLayer._mode=new esri.layers._SelectionMode(this._serviceLayer)}this.replaceFeatureLayer(this._serviceLayer,true,true,true);this.serviceLayer.resume();this.serviceLayer.mode===esri.layers.FeatureLayer.MODE_SNAPSHOT&&this.serviceLayer.graphics.length===0&&this.serviceLayer.refresh()};b.prototype.replaceFeatureLayer=function(a,b,c,d){var f=this.serviceLayer;if(!a)throw Error("featureLayer cannot be null in order to replace the feature layer.");
var h=this._getEsriMap();if(!h)throw Error("Unable to get access to the Esri map object to perform the Feature Layer replace.");if(!this.serviceLayer)throw Error("ServiceLayer not present. Can't replace the the FeatureLayer");if(b)a.visible=f.visible,a.setMaxScale(f.maxScale),a.setMinScale(f.minScale);if(c)a.opacity=f.opacity;d&&a.setRenderer(f.renderer);b=dojo.indexOf(h.graphicsLayerIds,f.id);this.serviceLayer=a;f.suspend();h.removeLayer(f);h.addLayer(a,b);f.url||this._cleanUpLayer(f)};b.prototype._cleanUpLayer=
function(a){a.clear();if(a._essentialsMetadata)for(var a=a._essentialsMetadata.eventHandlers,b=0,b=0;b<a.length;b++)dojo.disconnect(a[b])};b.prototype.queryCount=function(a,b,c){this.isServiceLayerLoaded&&this.serviceLayer&&this.serviceLayer.queryCount(a,function(a){b&&b(a)},function(a){c&&c(a)})};b.prototype.queryFeatures=function(a,b,c){return this.isServiceLayerLoaded&&this.serviceLayer?this.serviceLayer.queryFeatures(a,b,c):(a=Error("Esri layer has not finished loading"),c?(c(a),null):(c=new dojo.Deferred,
c.reject(a),c))};b.prototype.queryIds=function(a,b,c){if(this.isServiceLayerLoaded&&this.serviceLayer)return this.serviceLayer.queryIds(a,b,c);else if(c)return a=Error("Esri layer has not finished loading"),c(a),c=new dojo.Deferred,c.reject(a),c};b.prototype.queryRelatedFeatures=function(a,b,c){if(this.isServiceLayerLoaded&&this.serviceLayer)return this.serviceLayer.queryRelatedFeatures(a,b,c);else if(c)return a=Error("Esri layer has not finished loading"),c(a),c=new dojo.Deferred,c.reject(a),c};
b.prototype._getEsriMap=function(){var a=null;this.essentialsMap!==null&&this.essentialsMap.site!==null&&(a=this.essentialsMap.site.getMap());return a};b.prototype._configureObject=function(a,b){if(a===void 0||a.outFields===void 0||a.queryMode===void 0||a.where===void 0)throw Error("Incorrect map service object returned from initialization");this.disableClientCaching=!!a.disableClientCaching;this.onDemandCacheSize=a.onDemandCacheSize===void 0||a.onDemandCacheSize===null?this.onDemandCacheSize:a.onDemandCacheSize;
if(!a.outFields)a.outFields="*";this.outFields=a.outFields;this.where=a.where;if(a.queryMode===void 0)this.queryMode=esri.layers.FeatureLayer.MODE_ONDEMAND;else switch(a.queryMode){case "Selection":case "SelectionOnly":this.queryMode=esri.layers.FeatureLayer.MODE_SELECTION;break;case "Snapshot":this.queryMode=esri.layers.FeatureLayer.MODE_SNAPSHOT;break;default:this.queryMode=esri.layers.FeatureLayer.MODE_ONDEMAND}if(a.tileHeight)this.tileHeight=a.tileHeight;if(a.tileWidth)this.tileWidth=a.tileWidth;
if(a.selectionColor)this.selectionColor=a.selectionColor;if(a.color)this.color=a.color,this._colorSet=true,this.color.length>3&&(this.color[3]/=255);this.editVerticesEnabled=a.hasOwnProperty("editVerticesEnabled")?a.editVerticesEnabled:true;this.moveEnabled=a.hasOwnProperty("moveEnabled")?a.moveEnabled:true;this.scaleEnabled=a.hasOwnProperty("scaleEnabled")?a.scaleEnabled:true;this.rotateEnabled=a.hasOwnProperty("rotateEnabled")?a.rotateEnabled:true;if(a.renderer)try{this.renderer=esri.renderer.fromJson(a.renderer)}catch(c){}d.prototype._configureObject.call(this,
a,b)};b.prototype._updateServiceToken=function(a){d.prototype._updateServiceToken.call(this,a);if(this.serviceLayer){var b=this.serviceLayer._task;if(b&&b._url&&b._url.query)b._url.query.token=a}};b.prototype._createServiceLayer=function(){d.prototype._createServiceLayer.call(this);var a=this.serviceUrl;this.serviceToken!==null&&(a=a+"?token="+encodeURIComponent(this.serviceToken));var b={};b.id=this.id;b.opacity=this.configuredOpacity;b.visible=this._computeInitServiceLayerVisibility();if(this.outFields&&
this.outFields.length>0)b.outFields=this.outFields.split(",");if(this.queryMode!==null)b.mode=this.queryMode;if(this.tileHeight!==null&&this.tileWidth!==null&&this.queryMode==esri.layers.FeatureLayer.MODE_ONDEMAND)b.tileHeight=this.tileHeight,b.tileWidth=this.tileWidth;this.serviceLayer=new esri.layers.FeatureLayer(a,b);this.serviceLayer.setRenderer(this.renderer);if(this.attributionDataUrl&&this.attributionDataUrl!=="")this.serviceLayer.attributionDataUrl=this.attributionDataUrl,this.serviceLayer.hasAttributionData=
true;else if(this.hasAttributionData)this.serviceLayer.attributionDataUrl=this.url+"/Attribution",this.serviceLayer.hasAttributionData=true;this._serviceLayer=this.serviceLayer;this.where&&this.serviceLayer.setDefinitionExpression(this.where);dojo.connect(this.serviceLayer,"onError",this,this._layerLoadErrorHandler);this.serviceLayer.loaded?this._handleLayerLoadEvent(this.serviceLayer):dojo.connect(this.serviceLayer,"onLoad",dojo.hitch(this,this._handleLayerLoadEvent))};b.prototype._computeInitServiceLayerVisibility=
function(){var a=this._initiallyVisible;a&&this.layers&&this.layers.length===1&&(a=this.layers[0].isVisible());return a};b.prototype._handleLayerLoadEvent=function(a){if(this.serviceLayer.version<10||this._colorSet){var b=null;if(this.serviceLayer.geometryType=="esriGeometryPoint"){var b=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,15,null,new esri.Color(this.selectionColor)),c=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,15,null,
new esri.Color(this.color));this.serviceLayer.setRenderer(new esri.renderer.SimpleRenderer(c))}else this.serviceLayer.geometryType=="esriGeometryPolyline"?(b=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(this.selectionColor),1),c=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(this.color),1),this.serviceLayer.setRenderer(new esri.renderer.SimpleRenderer(c))):this.serviceLayer.geometryType=="esriGeometryPolygon"&&(b=
new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0]),1),new esri.Color(this.selectionColor)),c=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0]),1),new esri.Color(this.color)),this.serviceLayer.setRenderer(new esri.renderer.SimpleRenderer(c)));this.serviceLayer.setSelectionSymbol(b)}b=
this.serviceLayer.getEditCapabilities();this.canUpdate=b.canUpdate;this.canAdd=b.canCreate;this.canDelete=b.canDelete;this.canEdit=this.serviceLayer.isEditable();this.canAddAttachments=false;if(this.serviceLayer.capabilities)this.canAddAttachments=this.serviceLayer.capabilities.toLowerCase().indexOf("uploads")>=0;this._initialFeatureCollection=JSON.stringify(this.serviceLayer.toJson());this._handleServiceLayerLoaded(a)};b.prototype.hasOriginRelationships=function(){if(this.serviceLayer&&this.serviceLayer.version>=
10.1&&this.serviceLayer.relationships&&this.serviceLayer.relationships.length>0)for(var a=0;a<this.serviceLayer.relationships.length;a++)if(this.serviceLayer.relationships[a].role==="esriRelRoleOrigin")return true;return false};b.prototype.getRelatedFeatureLayer=function(a,b,d){var f=new dojo.Deferred;if(this.serviceLayer.version<10.1)return a=Error("getRelatedFeatureLayer is only available for feature layer from ArcGIS 10.1 or greater."),f&&f.fired==-1&&f.resolve(a),typeof d=="function"&&d(a),f;
var j=this._getEsriRelation(a);if(!j)return a=Error("Relation not found: "+a),f&&f.reject(a),typeof d=="function"&&d(a),f;a=this.serviceUrl.substring(0,this.serviceUrl.lastIndexOf("/")+1)+j.relatedTableId;this.serviceToken&&(a+=a.indexOf("?")>-1?"&token=":"?token=",a+=encodeURIComponent(this.serviceToken));esri.getProxyRule(a)===void 0&&this.proxyUrl!==null&&esri.addProxyRule({urlPrefix:a,proxyUrl:this.proxyUrl});a=new esri.layers.FeatureLayer(a,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});
dojo.connect(a,"onLoad",dojo.hitch(this,function(a){c.deferredResolve(f,a);typeof b=="function"&&b(a)}));dojo.connect(a,"onError",dojo.hitch(this,function(a){f&&f.fired==-1&&f.resolve(a);typeof d=="function"&&d(a)}));return f};b.prototype._getEsriRelation=function(a){typeof a=="string"&&(a=parseInt(a));if(this.serviceLayer.relationships)for(var b=0;b<this.serviceLayer.relationships.length;b++)if(this.serviceLayer.relationships[b].id==a)return this.serviceLayer.relationships[b];return null};b.prototype._getRelation=
function(a){return this.layers&&this.layers.length>0?this.layers[0]._getRelation(a):null};return b}(h.MapService);h.FeatureLayerService=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function c(b,a,g,d){this.runtimeTypeName=null;this.name=b||null;this.typeName=a||null;this.isRequired=!!g;this.value=d||null}c.prototype._configureObject=function(b){if(typeof b.name=="undefined"||typeof b.typeName=="undefined")throw Error("Incorrect argument info object returned from initialization");this.name=b.name;this.typeName=b.typeName;this.isRequired=b.isRequired;this.value=b.value;this.runtimeTypeName=b.runtimeTypeName};c.prototype._internalClone=
function(){var b=new c(this.name,this.typeName,this.isRequired,dojo.clone(this.value));b.runtimeTypeName=dojo.clone(this.runtimeTypeName);return b};return c}();c.ArgumentInfo=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,c,d,f,j,h,k,m){this.debug=false;this.id=b||null;this.displayName=a||null;this.typeName=c||null;this.instanceId=d||null;this.externalId=f||null;this.syncToken=j||null;this.isComplete=h||false;this.isAborted=false;this.inputs=k||[];this.outputs=m||[]}d.prototype._configureObject=function(b){if(typeof b.id=="undefined"||typeof b.displayName=="undefined"||typeof b.typeName=="undefined"||typeof b.instanceId=="undefined")throw Error("Incorrect external activity info object returned from initialization");
this.id=b.id;this.displayName=b.displayName;this.typeName=b.typeName;this.instanceId=b.instanceId;this.externalId=b.externalId;this.syncToken=b.syncToken;this.isComplete=b.isComplete;if(b.debug)this.debug=b.debug;this.inputs=[];this.outputs=[];var a;if(b.inputs)for(a=0;a<b.inputs.length;a++){var g=b.inputs[a],d=new c.workflow.ArgumentInfo;d._configureObject(g);this.inputs[a]=d}if(b.outputs)for(a=0;a<b.outputs.length;a++)g=b.outputs[a],d=new c.workflow.ArgumentInfo,d._configureObject(g),this.outputs[a]=
d};return d}();h.ExternalActivityInfo=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.error=this.displayName=null;this.extensions=[];this.externalActivities={};this.id=null;this.properties={};this.site=null;this._inputs=[];this._outputs=[]}__extends(b,d);b.prototype.getInputs=function(){return this._cloneArgumentInfoCollection(this._inputs)};b.prototype.getOutputsMetadata=function(){return this._cloneArgumentInfoCollection(this._outputs)};b.prototype._cloneArgumentInfoCollection=function(a){var b=null;if(a!==
null)for(var b=[],c=0;c<a.length;c++)b.push(a[c]._internalClone());return b};b.prototype._configureObject=function(a){if(a.id===void 0||a.displayName===void 0)throw Error("Incorrect workflow object returned from initialization");var b,d;this.id=a.id;this.displayName=a.displayName;this.runOnStartup=!!a.runOnStartup;this.error=a.error;this._inputs=[];this._outputs=[];this.externalActivities=[];if(a.inputs)for(var f=0;f<a.inputs.length;f++)b=a.inputs[f],d=new c.workflow.ArgumentInfo,d._configureObject(b),
this._inputs[f]=d;if(a.outputs)for(f=0;f<a.outputs.length;f++)b=a.outputs[f],d=new c.workflow.ArgumentInfo,d._configureObject(b),this._outputs[f]=d;if(a.externalActivities)for(f=0;f<a.externalActivities.length;f++)b=a.externalActivities[f],d=new c.workflow.ExternalActivityInfo,d._configureObject(b),this.externalActivities[f]=d;this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};return b}(h.AsyncInitializable);h.Workflow=f})(c.essentials||(c.essentials={}))})(geocortex||
(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.id=this.displayName=null;this._isLoading=false;this._layerTypes=this._onLoadingError=this._onLoadingComplete=null;this._arcgisSharingRegularExpressions=[/(https?:\/\/.*?\/)home\/item.html\?id=(\w*)/,/(https?:\/\/.*?\/)home\/webmap\/viewer.html\?webmap=(\w*)/,/(https?:\/\/.*?\/)explorer\/\?open=(\w*)/,/(https?:\/\/.*?\/sharing)\/content\/items\/(\w*)\/data/,/(https?:\/\/.*?\/sharing)\/content\/items\/(\w*)/];this.site=null}
__extends(b,d);b.prototype.isLoading=function(){return this._isLoading};b.prototype._getUrlPortions=function(a){for(var b={id:null,path:null},c=0;c<this._arcgisSharingRegularExpressions.length;++c){var d=a.match(this._arcgisSharingRegularExpressions[c]);if(d&&d.length>0){b.id=d[2];b.path=d[1];break}}return b};b.prototype._loadWebMap=function(a,b,c){var d=this;if(!a||!a.path){var f="Web map with address "+b+" cannot be loaded.",b=esri.urlToObject(b);b.query=b.query||{};if(!b.query||!b.query.webmap&&
!b.query.id)this._onLoadingError(Error(f)),c.resolve(false);else{var b=b.query.webmap||b.query.id,h;if(esri.arcgis&&esri.arcgis.utils)h=esri.arcgis.utils.getItem;else if(esri.arcgis.getItem)h=esri.arcgis.getItem;h&&h(b).then(function(a){a?this._processItemData(a.itemData):this._onLoadingError(Error(f));c.resolve(false)})}}else if(esri.arcgis&&esri.arcgis.Portal)(new esri.arcgis.Portal(a.path)).on("ready",function(b){b&&b.queryItems({q:"id:"+a.id}).then(function(a){a&&esri.request({url:a.results[0].itemDataUrl}).then(function(a){d._processItemData(a);
c.resolve(false)})})})};b.prototype._initializeWebMap=function(a,b,c,d){var f=this;this.isLoading()?d&&d(Error("Currently loading web map.")):(this._isLoading=true,b=new dojo.Deferred,this._onLoadingComplete=dojo.hitch(this,c),this._onLoadingError=dojo.hitch(this,d),this._layerTypes=this.site.webMapsInfo.layerTypes,this._loadWebMap(this._getUrlPortions(a.url),a.url,b),b.then(function(a){f._isLoading=a}))};b.prototype._processItemData=function(a){if(a){var b=a.operationalLayers;b&&this._processLayerCollection(b,
"Operational");(a=a.baseMap.baseMapLayers)&&this._processLayerCollection(a,"Base")}};b.prototype._processLayerCollection=function(a,b){var c=this;if(a){for(var d=[],f=0;f<a.length;++f){var h=a[f];if(!this._layerTypes||!(!h.type&&this._layerTypes.indexOf("Null")>=0||h.type&&this._layerTypes.indexOf(h.type)>=0))h=this._addLayerToMap(h),d.push(h)}(new dojo.DeferredList(d)).then(function(a){if(a){for(var d=[],f=0;f<a.length;++f){var p=a[f][1];p&&(p.length>0?d=d.concat(p):d.push(p))}d.length>0&&c.site.essentialsMap.addServiceLayers(d,
b)}},function(a){c._onLoadingError(Error("There was an error loading a layer: "+a))})}};b.prototype._addLayerToMap=function(a){var b=new dojo.Deferred,d=null;this.site.getMap();switch(a.type){case "CSV":var d=new dojo._Url(window.location.href),f=new dojo._Url(a.url);if(d.host!==f.host||d.port!==f.port||d.scheme!==f.scheme)a.url=esri.config.defaults.io.proxyUrl+a.url;c.essentials.utilities.LayerUtilities.createFeatureLayerFromCsv(a,null).then(function(c){c&&c.setVisibility&&c.setVisibility(a.visibility);
b.resolve(c)},function(a){b.reject(a)});break;case "GeoRSS":d=new h.GeoRssLayerService(a.url);d.essentialsMap=this.site.essentialsMap;f={displayName:a.title,serviceType:c.essentials.MapServiceType.GEORSS,connectionString:"url="+a.url,feedImageUri:a.pointSymbol?a.pointSymbol.url:null,opacity:a.opacity,id:a.id||c.framework.utils.alphaNumericToken(),visible:a.visibility};d._configureObject(f);b.resolve(d);break;case "WebTiledLayer":if(!a.wmtsInfo&&esri.layers&&esri.layers.WebTiledLayer&&(d=new esri.layers.WebTiledLayer(a.templateUrl,
{id:a.id,subDomains:a.subDomains,copyright:a.copyright}),a.title))d.name=a.title;b.resolve(d);break;case "WMS":b.resolve(null);break;default:d=null,a.url||a.featureCollection&&(d=this._addFeatureCollectionToMap(a.featureCollection)),b.resolve(d)}return b.promise};b.prototype._addFeatureCollectionToMap=function(a){var b=this.site.getMap(),d=[];dojo.forEach(a.layers,function(a){a=new esri.layers.FeatureLayer(a,{outSR:b.spatialReference});a.layerId=c.framework.utils.alphaNumericToken();d.push(a)});return d};
b.prototype._loadingRestComplete=function(a){this._isLoading=false;!a&&this._onLoadingError&&this._onLoadingError(Error("No results"));a.error&&this._onLoadingError&&this._onLoadingError(a.error);this._onLoadingComplete&&this._onLoadingComplete(a.results)};b.prototype._loadingRestError=function(a){this._isLoading=false;this._onLoadingError&&this._onLoadingError(a)};b.prototype._configureObject=function(a,b){if(a===void 0||a.id===void 0)throw Error("Incorrect Web Map reference object returned from initialization");
this.displayName=a.displayName;this.id=a.id;if(b)this.isInitialized=true;this._initializeWebMap(a,this.site,function(){},function(a){throw a;})};return b}(h.AsyncInitializable);h.WebMapReference=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=this.description=null;this.extensions=[];this.visible=this.id=null;this.maximumResolution=300;this.site=this.properties=null;this.supportedMapScales=[];this.supportedOutputFormats=[];this.supportedResolutions=[];this.supportsEmailNotification=false;this.textFields=[];this.grids=[];this.type=c.essentials.ReportType.MAP_TEMPLATE_REPORT;this.isDefault=false;this.defaultOutputFormat=this.defaultGrid=this.defaultResolution=
this.defaultMapScale=null;this._printing=false;this._onPrintError=this._onPrintComplete=null;this.extensions=[];this.properties=[];this.supportedMapScales=[];this.supportedOutputFormats=[];this.supportedResolutions=[];this.textFields=[]}__extends(b,d);b.prototype.isPrinting=function(){return this._printing};b.prototype.print=function(a,b,d){var f=this;this.isPrinting()?d&&d(Error("Template already printing")):(this._onPrintComplete=b,this._onPrintError=d,this._printing=true,b=new c.essentials.exportMap.ExportMapParameters,
b.reportParameters=a,(new c.essentials.exportMap.ExportMapTask(this)).generateMapImageUrl(b).then(function(a){return f._printRestComplete(a)},function(a){return f._printRestError(a)}))};b.prototype._configureObject=function(a,b){if(a===void 0||a.id===void 0||a.displayName===void 0)throw Error("Incorrect print template object returned from initialization");this.description=a.description===void 0?this.description:a.description;this.displayName=a.displayName;this.id=a.id;this.visible=a.visible===void 0?
true:a.visible;this.maximumResolution=a.maximumResolution===void 0?this.maximumResolution:a.maximumResolution;this.supportedMapScales=a.supportedScales===void 0?this.supportedMapScales:a.supportedScales;this.supportedOutputFormats=a.supportedOutputFormats===void 0?this.supportedOutputFormats:a.supportedOutputFormats;this.supportedResolutions=a.supportedResolutions===void 0?this.supportedResolutions:a.supportedResolutions;this.supportsEmailNotification=!!a.supportsEmailNotification;this.textFields=
a.textFields===void 0?this.textFields:a.textFields;this.grids=a.grids===void 0?this.grids:a.grids;if(b)this.isInitialized=true;this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions);this.isDefault=a.isDefault===void 0?this.isDefault:a.isDefault;var d=a.defaultMapScale===void 0?null:a.defaultMapScale;if(d)for(var f=0;f<this.supportedMapScales.length;f++)if(d===this.supportedMapScales[f].displayName)this.defaultMapScale=this.supportedMapScales[f];if(d=a.defaultResolution===
void 0?null:a.defaultResolution)for(f=0;f<this.supportedResolutions.length;f++)if(d===this.supportedResolutions[f].displayName)this.defaultResolution=this.supportedResolutions[f];if(d=a.defaultGrid===void 0?null:a.defaultGrid)for(f=0;f<this.grids.length;f++)if(d===this.grids[f].displayName)this.defaultGrid=this.grids[f];this.defaultOutputFormat=a.defaultOutputFormat===void 0?this.defaultOutputFormat:a.defaultOutputFormat};b.prototype._printRestComplete=function(a){this._printing=false;var b=null;
if(a){if(a.error)b=a.error}else b=Error("Unexpected Error");b?this._onPrintError&&this._onPrintError(b):this._onPrintComplete&&this._onPrintComplete(a)};b.prototype._printRestError=function(a){this._printing=false;this._onPrintError&&this._onPrintError(a)};return b}(h.AsyncInitializable);h.PrintTemplate=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=null;this.extensions=[];this.id=this.extent=null;this.properties={};this.site=null}__extends(b,d);b.prototype.navigateTo=function(){if(this.site){var a=this.site.essentialsMap;a&&a.extentManager.setExtentWithPriority(this.extent,8)}};b.prototype._configureObject=function(a){if(a===void 0||a.id===void 0||a.displayName==void 0||a.extent===void 0)throw Error("Incorrect named extent object returned from initialization");
this.id=a.id;this.displayName=a.displayName;this.extent=new esri.geometry.Extent(a.extent);this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};return b}(h.AsyncInitializable);h.NamedExtent=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=null;this.extensions=[];this.id=null;this.properties={};this.site=this.geoprocessorUrl=this.geoprocessorType=null}__extends(b,d);b.prototype._configureObject=function(a){if(a.id===void 0||a.displayName===void 0||a.connectionString===void 0)throw Error("Incorrect geoprocessing endpoint object returned from initialization");this.id=a.id;this.displayName=a.displayName;this.geoprocessorType=a.geoprocessorType||a.serviceType;
this._processConnectionString(a.connectionString);this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};b.prototype._processConnectionString=function(a){var b=c.essentials.ServiceHelper.extractConnectionStringValue;if(this.geoprocessorType===c.essentials.GeoprocessingEndpointType.ARCGIS_GEOPROCESSOR){if((a=b(a,"url"))&&a.length>0)this.geoprocessorUrl=a}else throw Error("Unknown geoprocessor type '"+this.geoprocessorType+"'");};return b}(h.AsyncInitializable);
h.GeoprocessingEndpoint=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){c=c.essentials||(c.essentials={});(c.GeoprocessingEndpointType||(c.GeoprocessingEndpointType={})).ARCGIS_GEOPROCESSOR="ArcGisGeoprocessor"})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=null;this.extensions=[];this.id=null;this.properties={};this.site=this.geometryServiceToken=this.geometryServiceUrl=this.geometryServiceType=null}__extends(b,d);b.prototype._configureObject=function(a){if(a.id===void 0||a.displayName===void 0||a.connectionString===void 0)throw Error("Incorrect geometry endpoint object returned from initialization");this.id=a.id;this.displayName=a.displayName;this.geometryServiceType=
a.serviceType;this._processConnectionString(a.connectionString);this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions)};b.prototype._processConnectionString=function(a){var b=c.essentials.ServiceHelper.extractConnectionStringValue;if(this.geometryServiceType===c.essentials.GeometryEndpointType.ARCGIS_GEOMETRY){var d=b(a,"url");if(d&&d.length>0)this.geometryServiceUrl=d;this.geometryServiceToken=b(a,"token")}};return b}(h.AsyncInitializable);h.GeometryEndpoint=
f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){c=c.essentials||(c.essentials={});(c.GeometryEndpointType||(c.GeometryEndpointType={})).ARCGIS_GEOMETRY="ArcGisGeometry"})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function c(){}c.extractConnectionStringValue=function(b,a){if(b.length>0){var c=b.match("(^|;)[s]*"+a+"=([^;]*)");if(c!==null)return c[2]}return""};return c}();c.ServiceHelper=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this.displayName=this.bingProperties=null;this.extensions=[];this.id=null;this.properties={};this.geocoderToken=this.geocoderUrl=this.geocoderType=null;this.includeInGlobalSearch=false;this.site=null;this.parameters=[];this.globalSearchKey=null}__extends(b,d);b.prototype._configureObject=function(a){if(!a.hasOwnProperty("id")||!a.hasOwnProperty("displayName")||!a.hasOwnProperty("serviceType")||!a.hasOwnProperty("connectionString")||
!a.hasOwnProperty("globalSearchKey")||!a.hasOwnProperty("parameters"))throw Error("Incorrect geocoding endpoint object returned from initialization");this.id=a.id;this.displayName=a.displayName;this.geocoderType=a.serviceType;this.includeInGlobalSearch=a.includeInGlobalSearch;this.globalSearchKey=a.globalSearchKey;this._processConnectionString(a.connectionString);this.properties=c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions);this.parameters=a.parameters};b.prototype._processConnectionString=
function(a){var b=c.essentials.ServiceHelper.extractConnectionStringValue;if(this.geocoderType===c.essentials.GeocodingEndpointType.BING_GEOCODER){this.bingProperties={};var d=b(a,"key");if(d&&d.length>0)this.bingProperties.bingMapsKey=d;if((d=b(a,"culture"))&&d.length>0)this.bingProperties.culture=d}else if(this.geocoderType===c.essentials.GeocodingEndpointType.ARCGIS_GEOCODER){if((d=b(a,"url"))&&d.length>0)this.geocoderUrl=d;this.geocoderToken=b(a,"token")}};return b}(h.AsyncInitializable);h.GeocodingEndpoint=
f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){c=c.essentials||(c.essentials={});c=c.GeocodingEndpointType||(c.GeocodingEndpointType={});c.ARCGIS_GEOCODER="ArcGisGeocoder";c.BING_GEOCODER="BingGeocoder"})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function c(){this.finished=false;this.id=(new Date).valueOf().toString();this.scripts=[]}c.getCurrent=function(){var b=window.security;return b&&!b.finished?b:null};c.beginRefresh=function(b){if(c.getCurrent()!=null)return false;var a=new c;a.site=b;if(!a.getExpirationNoticeUrl())return false;if(!a.getRefreshUrl())return false;window.security=a;a.useSystemBrowser()?a.openSystemBrowser():a.openFrame();return true};c.cancel=function(){var b=c.getCurrent();
return b&&b.finish()};c.prototype.openSystemBrowser=function(){var b=this,a=this.getRefreshUrl()+"&app="+this.site.signInRedirectUri+"&token_type=fragment",c=/GeocortexApp\.iOS/.test(navigator.userAgent)?"_system":"_blank",d=function(){var a=location.hash;a.length>0&&a.startsWith("#gcx-")&&(window.removeEventListener?window.removeEventListener("popstate",d,false):window.detachEvent&&window.detachEvent("onpopstate",d),a=a.substring(5),b.sendRequest(b.site.url+"?f=json&callback=security.updateSitePrincipal&token="+
a))};window.addEventListener?window.addEventListener("popstate",d,false):window.attachEvent&&window.attachEvent("onpopstate",d);window.open(a,c)};c.prototype.openFrame=function(){var b=this;this.frame=document.createElement("iframe");this.frame.name="SignInHelper";this.frame.style.display="none";document.body.appendChild(this.frame);window.open("SignInHelper.html","SignInHelper");window.setTimeout(function(){return b.openPopup()},15E3)};c.prototype.openPopup=function(){this.finished||(this.sendRequest(this.getExpirationNoticeUrl()+
"?f=json&part=_html&callback=security.showContent"),window.open("SignInHelper.html","_blank"))};c.prototype.getExpirationNoticeUrl=function(){return!this.site.principal?null:!this.site.principal.urls?null:this.site.principal.urls.expirationNotice};c.prototype.getRefreshUrl=function(){return!this.site.principal?null:!this.site.principal.urls?null:this.site.principal.urls.refresh};c.prototype.sendRequest=function(b){if(!this.finished){var a=document.createElement("script");a.style.display="none";document.body.appendChild(a);
this.scripts.push(a);a.type="text/javascript";a.src=b+"&rid="+this.id}};c.prototype.showContent=function(b){if(this.finished)return false;if(b.rid!=this.id)return false;this.dialog&&this.dialog.parentNode&&this.dialog.parentNode.removeChild(this.dialog);this.dialog=document.createElement("div");this.dialog.innerHTML=b.content;document.body.appendChild(this.dialog);return true};c.prototype.handleSignIn=function(b,a){if(this.finished)return null;if(b.length>0&&b.startsWith("#gcx-"))this.sendRequest(this.site.url+
"?f=json&callback=security.updateSitePrincipal&token="+b.substring(5));else{var c="";this.site.principal.urls.referrer==null&&(c="&app="+encodeURIComponent(a));return this.getRefreshUrl()+c+"&token_type=fragment"}return null};c.prototype.finish=function(){if(this.finished)return false;for(this.finished=true;this.scripts.length>0;){var b=this.scripts.pop();b.parentNode.removeChild(b)}this.dialog&&this.dialog.parentNode&&this.dialog.parentNode.removeChild(this.dialog);this.frame&&this.frame.parentNode&&
this.frame.parentNode.removeChild(this.frame);return true};c.prototype.updateSitePrincipal=function(b){if(this.finished)return false;if(b.rid!=this.id)return false;this.finish();this.site.updatePrincipal(b.principal);return true};c.prototype.useSystemBrowser=function(){return/\bGeocortexApp\b/.test(navigator.userAgent)};return c}();c.SecurityHelper=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a,b){d.call(this,a);this.dataProvider=this.currentVersion=null;this.deepInitialize=false;this.essentialsMap=this.updateInterval=this.displayName=null;this.extensions=[];this.geocodingEndpoints=[];this.geometryEndpoints=[];this.geoprocessingEndpoints=[];this.layerListRestEndpoint=null;this.hasWebMaps=this.hasWorkflows=this.hasVirtualDirectory=this.hasViewers=this.hasPrintTemplates=this.hasOverviewMap=this.hasNorthArrow=this.hasNamedExtents=this.hasGeoprocessingEndpoints=
this.hasGeometryEndpoints=this.hasGeocodingEndpoints=false;this.id=null;this.namedExtents=[];this.overviewMap=null;this.printTemplates=[];this.properties={};this.serviceLayersLoaded=false;this.url=null;this.workflows=[];this.webMapsInfo={layerTypes:null,webMaps:[]};this.onLayerLoadError=this.onLayerLoad=this.configPreprocessor=null;this.onServiceLayersLoaded=function(){};this.onUserSignInCancelled=this.onSignOut=this.onSignIn=null;this.principal={isAuthenticated:false,label:null,identities:[],policy:{},
urls:{},tokens:{arcgis:{},geocortex:{},site:null}};this._signOutEnabled=this._signInEnabled=this._initializedHandlerCalled=this._webMapsInitialized=this._workflowsInitialized=this._printTemplatesInitialized=this._overviewMapInitialized=this._namedExtentsInitialized=this._mapInitialized=this._geoprocessingEndpointsInitialized=this._geometryEndpointsInitialized=this._geocodingEndpointsInitialized=false;this._tokenIntervalHandle=null;this.originalUrl=a;this.url=h.utilities.UrlUtilities.simplify(a);this._esriMap=
b}__extends(b,d);b.prototype.initialize=function(){this._initialize()};b.prototype.getResourceById=function(a,b){return c.essentials.utilities.SiteResourceIdComparer.lookUp(a,b)};b.prototype.findWorkflowById=function(a){return this.getResourceById(this.workflows,a)};b.prototype.findPrintTemplateById=function(a){return this.getResourceById(this.printTemplates,a)};b.prototype.getFeatureServices=function(){var a=[];if(!this.essentialsMap)return a;for(var b=0;b<this.essentialsMap.mapServices.length;b++){var d=
this.essentialsMap.mapServices[b];d instanceof c.essentials.FeatureLayerService&&a.push(d)}return a};b.prototype.getMap=function(){return this._esriMap};b.prototype.getEssentialsVersion=function(){var a=3;if(this.currentVersion){var b=this.currentVersion.split(".");b.length>=2&&(a=parseFloat(b[0]+"."+b[1]))}return a};b.prototype.search=function(a,b,d,f){var j=this;b&&b(a);try{var l=this.url+"/search",b={};a&&a.toJson&&(b=a.toJson(this.getMap(),this.essentialsMap));var k=c.encodeJson(dojo.mixin({f:"json"},
b))}catch(m){f&&f(m);return}var b=function(b){var c=new h.SearchResults;c.queryParams=a;b?j._parseSearchResponse(c,b):c.error=Error("Unexpected Error");c.error&&f&&f(c.error);d&&d(c)},n=function(a){f&&f(a)};k.hasOwnProperty("layers")&&k.layers&&c.request({url:l,content:k,load:b,error:n,callbackParamName:"CallBack"})};b.prototype._parseSearchResponse=function(a,b){if(!b)throw Error("_parseSearchResponse: required jsonObject argument was not supplied.");if(b.hasOwnProperty("error")&&b.error&&b.error.message)a.error=
Error(b.error.message);else if(b.hasOwnProperty("ResponseStatus")&&b.ResponseStatus&&b.ResponseStatus.ErrorCode)a.error=Error(b.ResponseStatus.Message),a.error.name=b.ResponseStatus.ErrorCode;else if(b.hasOwnProperty("features")){var c=this._createFeatureSets(b.features,a.queryParams.returnHighlights),d;for(d in c)c.hasOwnProperty(d)&&a.results.push(c[d])}};b.prototype._createFeatureSets=function(a,b){for(var c={},d=0;d<a.length;d++){var f=a[d],l=f.hasOwnProperty("mapServiceId")?f.mapServiceId:null,
k=f.hasOwnProperty("layerId")?f.layerId:null;if(k=(l=this.essentialsMap.findMapServiceById(l))?l.findLayerById(k):null)f=this._createFeature(f,k,b),c.hasOwnProperty(k.url)||(c[k.url]=new h.SearchResultSet({layer:k})),c[k.url].features.push(f)}return c};b.prototype._createFeature=function(a,b,c){if(!a)throw Error("_createSearchFeature: required jsonFeature argument was not supplied.");var d=this._jObjectToGraphic(a),b=new h.SearchResultFeature(d,b);c&&this._assignHighlights(b,a);return b};b.prototype._jObjectToGraphic=
function(a){if(!a)throw Error("_jObjectToGraphic: required jobject argument was not supplied.");var b=null;if(a.hasOwnProperty("geometry")&&a.geometry&&(b=esri.geometry.fromJson(a.geometry))&&b.spatialReference&&!a.geometry.spatialReference)b.spatialReference=new esri.SpatialReference(4326);var c={};a.hasOwnProperty("attributes")&&a.attributes&&(c=JSON.parse(JSON.stringify(a.attributes)));return new esri.Graphic(b,null,c,null)};b.prototype._assignHighlights=function(a,b){if(!a)throw Error("_assignHighlights: required feature argument was not supplied.");
if(!b)throw Error("_assignHighlights: required jobject argument was not supplied.");var c={};b.hasOwnProperty("highlights")&&b.highlights&&(c=JSON.parse(JSON.stringify(b.highlights)));a.highlights=c};b.prototype._initAsyncCollection=function(a,b,d,f){if(a&&d&&f)for(var j=0;a&&j<a.length;j++)if(d[j]=new f(this.url+"/"+b+"/"+a[j].id),d[j].site=this,d[j]._configureObject(a[j]),this.deepInitialize===true&&f!==c.essentials.Workflow)d[j].isInitialized=true;this._siteInitializeUpdate()};b.prototype._initAsyncCollectionErrorHandler=
function(a,b){a();this._initializationFailedHandler(b);this._siteInitializeUpdate()};b.prototype._initGeocodingEndpointsHandler=function(a){this._geocodingEndpointsInitialized=true;a&&this._initAsyncCollection(a.geocodingEndpoints,"geocoding",this.geocodingEndpoints,c.essentials.GeocodingEndpoint)};b.prototype._initGeometryEndpointsHandler=function(a){this._geometryEndpointsInitialized=true;a&&this._initAsyncCollection(a.geometryEndpoints,"geometry",this.geometryEndpoints,c.essentials.GeometryEndpoint)};
b.prototype.getLayerCatalog=function(a,b,d,f){a=this.url+"/catalog/layercatalog/getcatalog";b();c.request({url:a,content:{f:"json"},load:function(a){d(a)},error:f,callbackParamName:"CallBack"})};b.prototype.getLayerCatalogDetails=function(a,b,d,f){var j=this.url+"/catalog/layercatalog/getcatalogdetails",h={};h.ids=a.ids.join();h.f="json";b();c.request({url:j,content:h,load:function(a){d(a)},error:f,callbackParamName:"CallBack"})};b.prototype._initGeoprocessingEndpointsHandler=function(a){this._geoprocessingEndpointsInitialized=
true;a&&this._initAsyncCollection(a.geoprocessingEndpoints,"geoprocessing",this.geoprocessingEndpoints,c.essentials.GeoprocessingEndpoint)};b._getTokenFromFragment=function(){var a=window.location.href,b=a.indexOf("#gcx-");return b>=0?(a=a.substring(b+5),window.location.replace("#"),a):null};b._addQueryParameter=function(a,b){var c=a.split("#",2),a=c[0],c=c.length>1?c[1]:"";return a+(a.indexOf("?")>-1?"&":"?")+b+c};b.prototype.canSignIn=function(){return this._signInEnabled&&!!this.principal&&!!this.principal.urls.signIn&&
!this.principal.isAuthenticated&&!!this.principal.policy&&this.principal.policy.issuers.length>0};b.prototype._signIn=function(a,c){if(!a)a=this.principal;if(!c)c=a.urls.signIn;if(a.policy===void 0)a.policy={};var d=a.policy.hints;d&&(c=b._addQueryParameter(c,d));c=b._addQueryParameter(c,"token_type=fragment");this.signInRedirectUri&&c.indexOf("app=")<0?c=b._addQueryParameter(c,"app="+encodeURIComponent(this.signInRedirectUri)):!a.urls.referrer&&c.indexOf("app=")<0&&(c=b._addQueryParameter(c,"app="+
encodeURIComponent(window.location.toString())));if(this.onSignIn)this.onSignIn({url:c});window.addEventListener&&window.addEventListener("popstate",function(){location.hash.startsWith("#gcx-")&&location.reload()},false);/GeocortexApp\.iOS/.test(navigator.userAgent)?document.addEventListener("deviceready",function(){window.open(c,"_system")},false):window.location.assign(c)};b.prototype.signIn=function(a){this._signIn(this.principal,a)};b.prototype.canSignOut=function(){return this._signOutEnabled&&
!!this.principal&&this.principal.isAuthenticated&&!!this.principal.urls.signOut};b.prototype.signOut=function(){if(this.onSignOut)this.onSignOut();var a=this.principal.urls.signOut;this.signOutRedirectUri?a=b._addQueryParameter(a,"app="+encodeURIComponent(this.signOutRedirectUri)):this._signOutRedirectUrl&&(a=b._addQueryParameter(a,"app="+encodeURIComponent(this._signOutRedirectUrl)));/GeocortexApp\.iOS/.test(navigator.userAgent)?window.open(a,"_system"):window.location.assign(a)};b.prototype.getTokenFromPrincipal=
function(a,b){var c=null;if(b===h.MapServiceType.DYNAMIC)c=this.principal.tokens.arcgis;else if(b===h.MapServiceType.FEATURE)c=this.principal.tokens.arcgis;else if(b===h.MapServiceType.IMAGE)c=this.principal.tokens.arcgis;else if(b===h.MapServiceType.TILED)c=this.principal.tokens.arcgis;else if(b===h.MapServiceType.WEBTILED)c=this.principal.tokens.arcgis;else if(b===esri.IdentityManagerBase)c=this.principal.tokens.arcgis;else if(b===h.MapServiceType.WMS)return this.principal.tokens.site;if(!c)return null;
var a=a.toLowerCase(),d=document.createElement("a");d.href=a.toLowerCase();var f=d.protocol,l=d.hostname,k=d.port,a=d.href,m;for(m in c){var n=m.toLowerCase();if(l==n)return c[m];if(l.endsWith("."+n))return c[m];try{if(d.href=f+"://"+n,d.port=k,a.startsWith(d.href))return c[m]}catch(o){}try{if(d.href=n,a.startsWith(d.href))return c[m]}catch(q){}}return null};b.prototype._initialize=function(){var a=this;if(!this.isInitialized&&!this._initializing){h.RestHelperHTTPService.token=b._getTokenFromFragment();
if(!h.RestHelperHTTPService.token){var d=function(){window.removeEventListener?window.removeEventListener("popstate",d,false):window.detachEvent&&window.detachEvent("onpopstate",d);if(!a.isInitialized&&a._initializing){var i=b._getTokenFromFragment();if(i)h.RestHelperHTTPService.token=i,c.request({url:a.url,content:{f:"json",deep:a.deepInitialize},load:dojo.hitch(a,a._verifySiteDependencies),error:dojo.hitch(a,a._initSiteErrorHandler),callbackParamName:"CallBack"})}};window.addEventListener?window.addEventListener("popstate",
d,false):window.attachEvent&&window.attachEvent("onpopstate",d)}this._initializedHandlerCalled=false;this._initializing=true;c.request({url:this.url,content:{f:"json",deep:this.deepInitialize},load:dojo.hitch(this,this._verifySiteDependencies),error:dojo.hitch(this,this._initSiteErrorHandler),callbackParamName:"CallBack"})}};b.prototype._initMapHandler=function(a){this._mapInitialized=true;a!==null&&a.site!==null&&a.loadServiceLayersInMap(a.site.getMap());this._siteInitializeUpdate()};b.prototype._initMapErrorHandler=
function(a){this._mapInitialized=true;this._initializationFailedHandler(a);this._siteInitializeUpdate()};b.prototype._initNamedExtentsHandler=function(a){this._namedExtentsInitialized=true;a&&this._initAsyncCollection(a.namedExtents,"namedextents",this.namedExtents,c.essentials.NamedExtent)};b.prototype._initOverviewMapHandler=function(){this._overviewMapInitialized=true;this._siteInitializeUpdate()};b.prototype._initOverviewMapErrorHandler=function(a){this._overviewMapInitialized=true;this._initializationFailedHandler(a);
this._siteInitializeUpdate()};b.prototype._initPrintTemplatesHandler=function(a){var b=this,d=0;this._printTemplatesInitialized=true;a.printTemplates.length>0&&a.printTemplates[0].visible!=null?this._initAsyncCollection(a.printTemplates,"printtemplates",this.printTemplates,c.essentials.PrintTemplate):a.printTemplates.forEach(function(f){c.request({url:b.url+"/printtemplates/"+f.id,content:{f:"json"},load:function(f){d++;a.printTemplates.forEach(function(a){if(a.id===f.id)a.visible=f.visible});d===
a.printTemplates.length&&b._initAsyncCollection(a.printTemplates,"printtemplates",b.printTemplates,c.essentials.PrintTemplate)},callbackParamName:"CallBack"})})};b.prototype._getUpdatedServiceTokens=function(){c.request({url:this.url+"/update",content:{f:"json"},load:dojo.hitch(this,this._processServiceTokensHandler),error:dojo.hitch(this,this._processServiceTokensErrorHandler),callbackParamName:"CallBack"})};b.prototype._processServiceTokensHandler=function(a){var b=this;a&&a.mapServiceTokens&&this._updateServiceTokens(this.essentialsMap,
a.mapServiceTokens);a&&a.overviewMapServiceTokens&&this._updateServiceTokens(this.overviewMap,a.overviewMapServiceTokens);a.geocodingServiceTokens&&a.geocodingServiceTokens.forEach(function(a){var c=b.geocodingEndpoints.filter(function(b){return b.id===a.id})[0];if(c)c.geocoderToken=a.token,dojo.publish("ServiceTokenRefreshed",{serviceUrl:c.geocoderUrl,token:a.token})});a.geometryServiceTokens&&a.geometryServiceTokens.forEach(function(a){var c=b.geometryEndpoints.filter(function(b){return b.id===
a.id})[0];if(c)c.geometryServiceToken=a.token,dojo.publish("ServiceTokenRefreshed",{serviceUrl:c.geometryServiceUrl,token:a.token})})};b.prototype._processServiceTokensErrorHandler=function(a){throw a;};b.prototype._updateServiceTokens=function(a,b){if(a&&b)for(var c=0;b&&c<b.length;c++){var d=a.findMapServiceById(b[c].id);d&&d._updateServiceToken(b[c].token)}};b.prototype._updateServiceTokensFromPrincipal=function(a){if(a&&a.mapServices)for(var b=0;b<a.mapServices.length;b++){var c=a.mapServices[b];
if(c&&c.serviceUrl){var d=this.getTokenFromPrincipal(c.serviceUrl,esri.IdentityManagerBase);d&&c._updateServiceToken(d)}}};b.prototype._refreshPrincipal=function(){var a=this,b={site:this,handled:false,resumeRefresh:function(){return h.SecurityHelper.beginRefresh(a)},suspendRefresh:function(){return h.SecurityHelper.cancel()}};dojo.publish("geocortex_sessionExpiring",b);b.handled||b.resumeRefresh()};b.prototype._refreshPrincipalAt=function(a,b){var c=this;if(!a)return false;var d=(new Date(a)).valueOf();
isNaN(d)&&(d=Date.parse(a));d=d-(new Date).valueOf()-b;d=Math.max(1E4,d);window.setTimeout(function(){return c._refreshPrincipal()},d);return true};b.prototype.updatePrincipal=function(a){this.principal=a;this._refreshPrincipalAt(a.expiry,3E5);h.RestHelperHTTPService.token=this.principal.tokens.site;this.principal.tokens&&this.principal.tokens.arcgis&&(this._updateServiceTokensFromPrincipal(this.essentialsMap),this._updateServiceTokensFromPrincipal(this.overviewMap))};b.prototype._getCredential=function(a){var b=
this.getTokenFromPrincipal(a,esri.IdentityManagerBase),c=new dojo.Deferred;b?(a=new esri.Credential,a.token=b,c.resolve(a)):c.reject(Error("No token available for service {0}".format(a)));return c};b.prototype._hookGetCredential=function(){var a=this;esri.IdentityManagerBase.prototype.getCredential=function(b,c){try{return a._getCredential(b,c)}catch(d){var f=new dojo.Deferred;f.reject(d);return f}}};b.prototype._initSiteHandler=function(a){var b=this;this._hookGetCredential();if(!a)throw Error("Incorrect site object returned from initialization");
if(this.configPreprocessor)this.configPreprocessor(a),this.configPreprocessor=null;if(a.principal){var d=a.principal;if(d.policy===void 0)d.policy={};if(d.policy.authenticate&&!d.isAuthenticated){this._signIn(d);return}this.principal=d;d.isAuthenticated&&dojo.publish("geocortex_authenticationSucceeded",[{username:d.label,token:d.tokens.site}]);this._refreshPrincipalAt(this.principal.expiry,3E5)}else if(a.arcGisPortalAuthentication&&a.arcGisPortalAuthentication.clientID){d=a.arcGisPortalAuthentication;
this.arcGisPortalSecurityContext=new h.ArcGisPortalSecurityContext(d.url,d.domains,d.clientID);if(!this.arcGisPortalSecurityContext.initiate()){if(this.arcGisPortalSecurityContext.error)if(this.arcGisPortalSecurityContext.error.code==h.OAuth2Error.ACCESS_DENIED_ERROR_CODE){if(this.onUserSignInCancelled)this.onUserSignInCancelled({tryAgainAction:dojo.hitch(this,function(){h.OAuth2Client.redirectToLogOnPage(this.arcGisPortalSecurityContext.getLogOnUrl(),this.arcGisPortalSecurityContext.clientId)})})}else a=
Error(),a.name=this.arcGisPortalSecurityContext.error.code,a.message=this.arcGisPortalSecurityContext.error.description,this._initializationFailedHandler(a);return}h.RestHelperHTTPService.arcGisPortalToken=this.arcGisPortalSecurityContext.tokenResult}this.hasGeocodingEndpoints=!!a.hasGeocodingEndpoints;this.hasGeometryEndpoints=!!a.hasGeometryEndpoints;this.hasGeoprocessingEndpoints=!!a.hasGeoprocessingEndpoints;this.hasNamedExtents=!!a.hasNamedExtents;this.hasNorthArrow=!!a.hasNorthArrow;this.hasOverviewMap=
!!a.hasOverviewMap;this.hasPrintTemplates=!!a.hasPrintTemplates;this.hasViewers=!!a.hasViewers;this.hasVirtualDirectory=!!a.hasVirtualDirectory;this.hasWorkflows=!!a.hasWorkflows;this.hasWebMaps=!!a.hasWebMaps;this.dataProvider=a.dataProvider;this.displayName=a.displayName;this.id=a.id;this._signInEnabled=!!a.signInEnabled;this._signOutEnabled=!!a.signOutEnabled;this._signOutRedirectUrl=a.signOutRedirectUrl;this.currentVersion=a.currentVersion===void 0?"3.0":a.currentVersion;if(a.hasOwnProperty("updateInterval")){if(this.updateInterval=
parseInt(a.updateInterval),isNaN(this.updateInterval))this.updateInterval=0}else this.updateInterval=0;var f=c.essentials.RestHelperHTTPService.getAuthenticationControlBlockStore().find(this.url);f&&setInterval(function(){(new c.essentials.RestHelperHTTPService)._requestToken(f)},Math.max(6E4,c.essentials.RestHelper.tokenDurationMinutes*6E4-12E4));if(this.updateInterval>0)this._tokenIntervalHandle=setInterval(function(){b._getUpdatedServiceTokens()},Math.max(60,this.updateInterval*1E3));this.properties=
c._getProperties(a.properties);this.extensions=c._getExtensions(a.extensions);this.essentialsMap=new c.essentials.Map(this.originalUrl+"/map");this.essentialsMap.site=this;dojo.connect(this.essentialsMap,"onInitialized",dojo.hitch(this,this._initMapHandler));dojo.connect(this.essentialsMap,"onInitializationFailed",dojo.hitch(this,this._initMapErrorHandler));if(this.hasOverviewMap)this.overviewMap=new c.essentials.Map(this.originalUrl+"/overviewmap"),this.overviewMap.site=this,dojo.connect(this.overviewMap,
"onInitialized",dojo.hitch(this,this._initOverviewMapHandler)),dojo.connect(this.overviewMap,"onInitializationFailed",dojo.hitch(this,this._initOverviewMapErrorHandler));if(a.map&&a.map.layerList)this.layerListRestEndpoint=a.map.layerList;!this.deepInitialize||this.getEssentialsVersion()<3.3||a.map===void 0?(this.essentialsMap.initialize(),this.hasOverviewMap?this.overviewMap.initialize():this._overviewMapInitialized=true,this.hasGeocodingEndpoints?c.request({url:this.url+"/geocoding",content:{f:"json"},
load:dojo.hitch(this,this._initGeocodingEndpointsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._geocodingEndpointsInitialized=true})),callbackParamName:"CallBack"}):this._geocodingEndpointsInitialized=true,this.hasGeometryEndpoints?c.request({url:this.url+"/geometry",content:{f:"json"},load:dojo.hitch(this,this._initGeometryEndpointsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._geometryEndpointsInitialized=
true})),callbackParamName:"CallBack"}):this._geometryEndpointsInitialized=true,this.hasGeoprocessingEndpoints?c.request({url:this.url+"/geoprocessing",content:{f:"json"},load:dojo.hitch(this,this._initGeoprocessingEndpointsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._geoprocessingEndpointsInitialized=true})),callbackParamName:"CallBack"}):this._geoprocessingEndpointsInitialized=true,this.hasNamedExtents?c.request({url:this.url+"/namedextents",
content:{f:"json"},load:dojo.hitch(this,this._initNamedExtentsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._namedExtentsInitialized=true})),callbackParamName:"CallBack"}):this._namedExtentsInitialized=true,this.hasPrintTemplates?c.request({url:this.url+"/printtemplates",content:{f:"json"},load:dojo.hitch(this,this._initPrintTemplatesHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._printTemplatesInitialized=
true})),callbackParamName:"CallBack"}):this._printTemplatesInitialized=true,this.hasWorkflows?c.request({url:this.url+"/workflows",content:{f:"json"},load:dojo.hitch(this,this._initWorkflowsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._workflowsInitialized=true})),callbackParamName:"CallBack"}):this._workflowsInitialized=true,this.hasWebMaps?c.request({url:this.url+"/webmaps",content:{f:"json"},load:dojo.hitch(this,this._initWebMapHandler),error:dojo.hitch(this,
this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._webMapsInitialized=true})),callbackParamName:"CallBack"}):this._webMapsInitialized=true):(this._initGeocodingEndpointsHandler(a),this._initGeometryEndpointsHandler(a),this._initGeoprocessingEndpointsHandler(a),this.essentialsMap.initialize(a.map),this._initNamedExtentsHandler(a),a.overviewMap?this.overviewMap.initialize(a.overviewMap):(this._overviewMapInitialized=true,this._siteInitializeUpdate()),this._initPrintTemplatesHandler(a),
this._initWorkflowsHandler(a),this._initWebMapHandler(a));this._siteInitializeUpdate()};b.prototype._initSiteErrorHandler=function(a){var b=a.principal;if(b&&!b.isAuthenticated&&a.code==403)this._signIn(b);else{if(b&&b.isAuthenticated&&a.code==403&&b.urls.signOut)this._signOutEnabled=true,this.principal=b;this._workflowsInitialized=this._printTemplatesInitialized=this._namedExtentsInitialized=this._geoprocessingEndpointsInitialized=this._geometryEndpointsInitialized=this._geocodingEndpointsInitialized=
true;this._initializationFailedHandler(a);this._siteInitializeUpdate()}};b.prototype._initWorkflowsHandler=function(a){this._workflowsInitialized=true;a&&this._initAsyncCollection(a.workflows,"workflows",this.workflows,c.essentials.Workflow)};b.prototype._initWebMapHandler=function(a){this._webMapsInitialized=true;if(a&&a.webMapsInfo)this.webMapsInfo.layerTypes=a.webMapsInfo.layerTypes,this._initAsyncCollection(a.webMapsInfo.webMaps,"webmaps",this.webMapsInfo.webMaps,c.essentials.WebMapReference)};
b.prototype._siteInitializeUpdate=function(){if(this._geocodingEndpointsInitialized&&this._geometryEndpointsInitialized&&this._geoprocessingEndpointsInitialized&&this._mapInitialized&&this._namedExtentsInitialized&&this._overviewMapInitialized&&this._printTemplatesInitialized&&this._workflowsInitialized&&this._webMapsInitialized&&!this._initializedHandlerCalled)this._initializedHandlerCalled=true,this._initializedHandler(this)};b.prototype._verifySiteDependencies=function(a){a&&a.hasFeatureLayers?
dojo.addOnLoad(dojo.hitch(this,function(){this._initSiteHandler(a)})):this._initSiteHandler(a)};return b}(h.AsyncInitializable);h.Site=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function d(){}d.processClientSideTokens=function(b,a){var g="";if(a!==""){var i="";if(b)i=b.url;var g=d._replaceToken("SiteRestUrl",a,i),g=d._replaceToken("VirtualDirectoryUrl",g,i+"/virtualdirectory"),f=window.location.href.substring(0,window.location.href.lastIndexOf("/")),g=d._replaceToken("HostUri",g,f),i=i.substring(0,i.lastIndexOf("/sites/"))+"/virtualdirectory",g=d._replaceToken("RestVirtualDirectoryUrl",g,i),g=d._replaceToken("RestToken",g,c.RestHelperHTTPService.token)}return g};
d.validateDynamicDefinition=function(b){if(!b||!b.trim())throw Error("The JSON string cannot be null, empty nor merely whitespace!");if(b=d.getJsonObjectFromJsonString(b)){if(b.source==null)throw"The source is required!";if(b.source.type==null)throw"The type is required!";if(b.source.type=="mapLayer"){if(b.source.mapLayerId==null)throw"The mapLayerId is required for the mapLayer type!";}else if(b.source.type=="dataLayer"){if(b.source.dataSource==null)throw"The dataSource is required for the dataLayer type!";
}else throw"The type '"+b.source.type.toString()+"' is not supported!";}};d.getJsonObjectFromJsonString=function(b){return JSON.parse(b)};d.getLayerSourceFromJsonObject=function(b){if(b.type=="mapLayer")return new esri.layers.LayerMapSource(b);else{var a=new esri.layers.LayerDataSource;switch(b.dataSource.type){case "table":a.dataSource=new esri.layers.TableDataSource(b.dataSource);break;case "queryTable":a.dataSource=new esri.layers.QueryDataSource(b.dataSource);break;case "raster":a.dataSource=
new esri.layers.RasterDataSource(b.dataSource);break;case "joinTable":a.dataSource=new esri.layers.JoinDataSource(b.dataSource);break;default:throw"The type '"+b.type.toString()+"' not supported!";}return a}};d.getDynamicLayerInfoFromJson=function(b,a){var c;d.validateDynamicDefinition(b);var i=d.getJsonObjectFromJsonString(b);if(i){c=new esri.layers.DynamicLayerInfo;if(i.id)c.id=i.id;else if(a!=null)c.id=parseInt(a,10);else throw"The Layer's ID is missing or invalid!";c.source=this.getLayerSourceFromJsonObject(i.source);
if(i.minScale!=null)c.minScale=i.minScale;if(c.minScale<=0)c.minScale=Infinity;if(i.maxScale!=null)c.maxScale=i.maxScale}return c};d.getDynamicExpressionFromJson=function(b){var a;d.validateDynamicDefinition(b);if((b=d.getJsonObjectFromJsonString(b))&&b.definitionExpression)a=b.definitionExpression;return a};d.getLayerDrawingOptionsFromJson=function(b){var a;d.validateDynamicDefinition(b);if((b=d.getJsonObjectFromJsonString(b))&&b.drawingInfo){b=dojo.clone(b.drawingInfo);a=new esri.layers.LayerDrawingOptions;
switch(b.renderer.type){case "simple":a.renderer=new esri.renderer.SimpleRenderer(b.renderer);break;case "uniqueValue":a.renderer=new esri.renderer.UniqueValueRenderer(b.renderer);break;case "classBreaks":a.renderer=new esri.renderer.ClassBreaksRenderer(b.renderer);break;default:throw"The type '"+b.renderer.type.toString()+"' not supported!";}if(b.labelingInfo&&b.labelingInfo instanceof Array){var c=b.labelingInfo;if(b.showLabels===void 0)b.showLabels=true;for(var i=0;i<c.length;i++){var f=new esri.layers.LabelClass(c[i]);
if(!a.labelingInfo)a.labelingInfo=[];a.labelingInfo.push(f)}}a.transparency=b.transparency;a.scaleSymbols=b.scaleSymbols;a.showLabels=b.showLabels}return a};d._replaceToken=function(b,a,c){return!a?a:a.replace("{"+b+"}",c)};d._createRestParametersFromQuery=function(b){var a={};if(b)a=b.toJson(),a.spatialRel=d._convertSpatialRelationshipToDotnet(a.spatialRel);return a};d._convertSpatialRelationshipToDotnet=function(b){switch(b){case esri.tasks.Query.SPATIAL_REL_CONTAINS:return"esriSpatialRelContains";
case esri.tasks.Query.SPATIAL_REL_CROSSES:return"esriSpatialRelCrosses";case esri.tasks.Query.SPATIAL_REL_ENVELOPEINTERSECTS:return"esriSpatialRelEnvelopeIntersects";case esri.tasks.Query.SPATIAL_REL_INDEXINTERSECTS:return"esriSpatialRelIndexIntersects";case esri.tasks.Query.SPATIAL_REL_INTERSECTS:return"esriSpatialRelIntersects";case esri.tasks.Query.SPATIAL_REL_OVERLAPS:return"esriSpatialRelOverlaps";case esri.tasks.Query.SPATIAL_REL_RELATION:return"esriSpatialRelRelation";case esri.tasks.Query.SPATIAL_REL_TOUCHES:return"esriSpatialRelTouches";
case esri.tasks.Query.SPATIAL_REL_WITHIN:return"esriSpatialRelWithin"}throw Error("Unknown rel: "+b);};d._convertSpatialRelationshipFromDotnetIndex=function(b){switch(b){case 1:return esri.tasks.Query.SPATIAL_REL_CONTAINS;case 2:return esri.tasks.Query.SPATIAL_REL_CROSSES;case 3:return esri.tasks.Query.SPATIAL_REL_ENVELOPEINTERSECTS;case 4:return esri.tasks.Query.SPATIAL_REL_INDEXINTERSECTS;case 0:return esri.tasks.Query.SPATIAL_REL_INTERSECTS;case 5:return esri.tasks.Query.SPATIAL_REL_OVERLAPS;case 8:return esri.tasks.Query.SPATIAL_REL_RELATION;
case 6:return esri.tasks.Query.SPATIAL_REL_TOUCHES;case 7:return esri.tasks.Query.SPATIAL_REL_WITHIN}throw Error("Unknown rel: "+b);};d.tokenDurationMinutes=20;return d}();c.RestHelper=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){return function(d,b){this.encodeUriReplacementValues=d.encodeUriReplacementValues;this.target=d.target;this.text=d.text;this.toolTip=d.toolTip;var a=null;if(b&&b.mapService&&b.mapService.essentialsMap)a=b.mapService.essentialsMap.site;this.uri=c.essentials.RestHelper.processClientSideTokens(a,d.uri);this.iconUri=c.essentials.RestHelper.processClientSideTokens(a,d.iconUri);this.layer=b}}();h.LayerHyperlink=f})(c.essentials||(c.essentials={}))})(geocortex||
(geocortex={}));
(function(c){(function(c){(function(c){function d(){}var b=function(){function a(){}a.prototype.select=function(b){var c=this,d=new a;d._subscribe=function(a){var d=true,f=c._subscribe({onNext:function(c){if(d)try{a.onNext(b(c))}catch(i){d=false,a.onError(i)}},onError:function(b){d&&(d=false,a.onError(b))},onCompleted:function(){d&&(d=false,a.onCompleted())}});if(d)return f;f.dispose();return{dispose:function(){}}};return d};a.prototype._subscribe=function(){return{dispose:d}};a.prototype.subscribe=function(a,
b,c){if(arguments.length>1){var f={onNext:a||d,onError:b||d,onCompleted:c||d};return this._subscribe(f)}if(a instanceof Function){if(a.length>1)return f={onNext:function(b){return a(b)},onError:function(b){return a(void 0,b)},onCompleted:function(){return a()}},this._subscribe(f);f={onNext:a,onError:b||d,onCompleted:c||d};return this._subscribe(f)}return a?this._subscribe(a):this._subscribe({onNext:d,onError:d,onCompleted:d})};return a}();c.AnonymousObservable=b})(c.Rx||(c.Rx={}))})(c.essentials||
(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){function f(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var c=a.length,d=0;d<b.length;d++){var g=a.indexOf(b[d]);g>=0&&g<c&&(c=g)}return g}var d=function(){function a(){}a.prototype.toString=function(){return this.message};return a}();h.ServiceRequestError=d;d.prototype.message="An error occurred while performing the operation.";d.prototype.details=[];d.prototype.name="ServiceRequestError";var b=function(a){function b(){a.apply(this,arguments)}__extends(b,
a);return b}(d);h.ServiceRequestAbortedError=b;b.prototype.message="The request was aborted.";b.prototype.name="ServiceRequestAbortedError";var a=function(){function a(){}a.prototype.start=function(){try{this.promise=c.request(this),this.valid?this.registration=this.servicePoint.cancellationToken.register(this.error.bind(this)):this.promise.cancel()}catch(a){this.error(a)}};a.prototype.load=function(a){try{if(this.member){var b=a[this.member];if(b)for(a=0;a<b.length;a++)if(this.valid)this.observer.onNext(b[a]);
else break}else if(this.valid)this.observer.onNext(a);this.complete()}catch(c){this.error(c)}};a.prototype.error=function(){if(this.valid)this.valid=false,this.promise.cancel(),this.registration.dispose(),this.observer.onError(e||new b)};a.prototype.complete=function(){if(this.valid)this.valid=false,this.promise.cancel(),this.registration.dispose(),this.observer.onCompleted()};a.prototype.dispose=function(){if(this.valid)this.valid=false,this.promise.cancel(),this.registration.dispose()};return a}();
a.prototype.handleAs="json";a.prototype.valid=true;a.prototype.registration={dispose:function(){}};var g,i,d=function(){function b(){}b.prototype.formatQuery=function(a){var b,c;b=[];for(c=1;c<arguments.length;c++)b[c-1]=arguments[c];c=a.format.apply(a,b);var d=f(c,"?","!","#");b=c.substring(0,d);c=c.substring(d);d=this.baseAddress;i||(g=document.head.getElementsByTagName("base")[0],g||(g=document.createElement("base"),g.setAttribute("href",window.location.href),document.head.appendChild(g)),i=document.createElement("a"));
try{var h=g.getAttribute("href");g.setAttribute("href",d);i.setAttribute("href",b);b=i.href}finally{g.setAttribute("href",h)}return b+c};b.prototype.getRequest=function(b,c){var d=function(a){this.observer=a;this.start()};d.prototype=new a;d.prototype.servicePoint=this;d.prototype.query=b;d.prototype.member=c;var g=new h.Rx.AnonymousObservable;g._subscribe=function(a){return new d(a)};return g};return b}();h.ServicePoint=d;d.prototype.baseAddress=window.location.href;d.prototype.cancellationToken=
{dispose:function(){},register:function(){return this}}})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function c(){this.extent=null;this.maxResults=50;this.contains=true;this.returnCountOnly=this.returnIdsOnly=this.returnHighlights=this.returnGeometry=false;this.outSpatialReference=this.searchText=null}c.prototype.toJson=function(b,a){if(!b||!a)throw Error("Search query parameter creation is missing a main map.");var c={searchText:this.searchText,contains:this.contains,returnGeometry:this.returnGeometry,returnHighlights:this.returnHighlights,returnIdsOnly:this.returnIdsOnly,
returnCountOnly:this.returnCountOnly};if(this.extent)c.envelope="{0},{1},{2},{3}".format(this.extent.xmin,this.extent.ymin,this.extent.xmax,this.extent.ymax);if((this.returnGeometry||this.extent)&&this.outSpatialReference)c.outSR=this.outSpatialReference.toJson();if(this.maxResults>0)c.maxResults=this.maxResults;var d=this.searchLayers;if(!d||d.length==0)d=a.allLayers();c.layers=this._getServiceStrings(d);return c};c.prototype._getServiceStrings=function(b){for(var a="",c={},d=0;d<b.length;d++){var f=
b[d];if(f&&f.searchable&&f.mapService&&f.mapService.instantSearch){var h=f.mapService.id;c.hasOwnProperty(h)||(c[h]=[]);c[h].push(f.id)}}for(var l in c)c.hasOwnProperty(l)&&(a+=a.length===0?"":";",a+="{0}(include:{1})".format(l,c[l].join(",")));return a};return c}();c.SearchQuery=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c){this.features=[];this.layer=null;if(c&&c.hasOwnProperty("features"))this.features=c.features;if(c&&c.hasOwnProperty("layer"))this.layer=c.layer}}();c.SearchResultSet=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c,b){this.layer=this.esriFeature=null;this.highlights={};this.esriFeature=c;this.layer=b}}();c.SearchResultFeature=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(f){var d=function(){function b(a){this.service=a}b.prototype.postProcess=function(a){if(!a.thumbnailUrl)a.thumbnailUrl=this.service.formatQuery("connections/{0}/preview?f=json&providerName={1}&url={2}",a.connection.id,a.serviceProviderName,a.url);for(var b in a.children)this.postProcess(a.children[b]);return a};b.prototype.findServices=function(a){var b=this.postProcess.bind(this.postProcess);return this.service.getRequest(this.service.formatQuery("connections/find?f=json&term={0}",
a),"results").select(b)};b.prototype.expandService=function(a,b,c){if(arguments.length==1)var d=a,a=d.connection.id,b=d.serviceProviderName,c=d.url;d=this.postProcess.bind(this.postProcess);return this.service.getRequest(this.service.formatQuery("connections/{0}/expand?f=json&providerName={1}&url={2}",a,b,c),null).select(d)};b.prototype.suggestHints=function(a){return this.service.getRequest(this.service.formatQuery("connections/suggest?f=json&term={0}",a),"hints")};b.prototype.realizeMapService=
function(a,b,d,f){if(arguments.length==1)var j=a,a=j.connection.id,b=j.serviceProviderName,d=j.url;return this.service.getRequest(this.service.formatQuery("connections/{0}/realize?f=json&providerName={1}&url={2}&sr={3}",a,b,d,f),null).select(function(a){var b=a.serviceType.indexOf("FeatureLayer")>=0?new c.FeatureLayerService(d):new c.MapService(d);b._configureObject(a,true);return b})};return b}();f.ServiceDiscoveryServicePoint=d})(c.serviceDiscovery||(c.serviceDiscovery={}))})(c.essentials||(c.essentials=
{}))})(geocortex||(geocortex={}));(function(c){(function(c){(function(c){var d=function(){function b(){}b.simplify=function(a){var b=document.createElement("a");b.href=a;a=b.href;b=a.charAt(a.length-1);if(b==="/"||b==="\\")a=a.substr(0,a.length-1);return a};return b}();c.UrlUtilities=d})(c.utilities||(c.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(f){var d=function(){return function(){this.queryParameters=this.reportParameters=this.operationParameters=null;this.operationParameters={};this.reportParameters=new c.ReportParameters}}();f.ExportMapParameters=d})(c.exportMap||(c.exportMap={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){b.call(this,a,d);this.formItemType="MarkdownFormItem";this.plainText=a?new Observable(c.forms.getElementText(a,"PlainText")):new Observable("")}__extends(a,b);a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.MarkdownFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c,b){this.runtimeTypeName=null;this.runtimeTypeName=c||null;this.value=b||null}}();c.ArgumentValueWrapper=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(){function b(){}b.createFeatureLayerFromCsv=function(a,b){var d=new dojo.Deferred;if(!a)return d.resolve(null),d;var f=new dojox.data.CsvStore({url:a.url,separator:a.columnDelimiter||","});f.fetch({onComplete:function(h){var l,k,m=0,n=a.layerDefinition,o={layerDefinition:n,featureSet:{features:[],geometryType:"esriGeometryPoint"}},q=null,r=null;b&&(q=b.lowerBound||0,r=b.upperBound||h.length);if(q||r)h=h.slice(q,r);dojo.forEach(h,function(b,c){if(c===
0&&a.locationInfo)l=a.locationInfo.latitudeFieldName,k=a.locationInfo.longitudeFieldName;f.getIdentity(b);var d=f.getAttributes(b),g={};dojo.forEach(d,function(a){var c=Number(f.getValue(b,a));g[a]=isNaN(c)?f.getValue(b,a):c});g.__OBJECTID=m;m++;var d=parseFloat(g[l]),i=parseFloat(g[k]);!isNaN(d)&&!isNaN(i)&&(d={geometry:(new esri.geometry.Point(i,d)).toJson(),attributes:g},o.featureSet.features.push(d))});h=new esri.layers.FeatureLayer(o);q=null;if(n&&n.drawingInfo&&n.drawingInfo.renderer&&n.drawingInfo.renderer.symbol&&
n.drawingInfo.renderer.symbol.type==="esriPMS")q=n.drawingInfo.renderer.symbol;if(q!=null)h.renderer.symbol.imageData=q.imageData,h.renderer.symbol.url=q.url;if(a.title)h.name=a.title;h.layerId=a.id||c.framework.utils.alphaNumericToken();d.resolve(h)}});return d};return b}();f.LayerUtilities=d})(h.utilities||(h.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(){this.error=null;this.results=[];this.queryParams=null}}();c.SearchResults=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){(function(c){var d=function(){return function(){this.type=this.entries=this.displayName=this.id=null;this.entries=[]}}();c.CatalogEntry=d})(c.catalog||(c.catalog={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){return function(){this.ids=null;this.ids=[]}}();c.LayerCatalogDetailsParams=d})(c.catalog||(c.catalog={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){(function(c){var d=function(){return function(){}}();c.LayerCatalogParams=d})(c.catalog||(c.catalog={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){return function(){this.entries=this.mapServiceId=null;this.entries=[]}}();c.LayerCatalogDetail=d})(c.catalog||(c.catalog={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){function c(){}c.DEFAULT="Default";c.SHOW="Show";c.HIDE="Hide";return c}();c.RefreshVisibility=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d=function(){function b(){}b.adjustTextSymbol=function(a){if(a&&a.symbol instanceof esri.symbol.TextSymbol){var b=function(a,b){b.font.size=a.font.size!=void 0&&typeof a.font.size==="number"?Math.round(a.font.size)+"px":a.font.size;b.x=a.x;b.y=a.y;b.xoffset=a.xoffset;b.yoffset=a.yoffset;b.align=a.align;b.angle=a.angle},c=new esri.symbol.TextSymbol(a.symbol.toJson());b(a.symbol,c);if(c.toJson&&typeof c.toJson==="function"){var d=c.toJson;c.toJson=function(){var a=
d.call(c);b(c,a);return a}}var f=document.body,h=document.createElement("div"),k={fontFamily:c.font.family,fontSize:c.font.size,fontWeight:c.font.weight,padding:"0",position:"absolute",lineHeight:"1",visibility:"hidden"},m;for(m in k)h.style[m]=k[m];h.appendChild(document.createTextNode(c.text));f.appendChild(h);k=h.clientWidth;m=h.clientHeight;f.removeChild(h);c.xoffset=c.angle===0?c.xoffset:0;c.yoffset=c.angle===0?c.yoffset:0;if(a.measurementId)f=a.measurementOffset||5,c.xoffset=-(k*0.7/2),c.yoffset=
a.measurementLabelFlipped?m*0.7+f:a.highlightedTextLabel?c.yoffset:-1*f,a.highlightedTextLabel&&(c.setColor(new esri.Color("black")),c.font.setWeight(esri.symbol.Font.WEIGHT_BOLD),c.font.setStyle(esri.symbol.Font.STYLE_OBLIQUE));else{switch(c.verticalAlignment){case "top":break;case "middle":c.yoffset+=m*0.7/2;break;default:c.yoffset+=m*0.7}if(a=c.horizontalAlignment||c.align||null)switch(a){case esri.symbol.TextSymbol.ALIGN_MIDDLE:case "center":case "justify":c.xoffset-=k*0.7/2;break;case esri.symbol.TextSymbol.ALIGN_END:case "right":c.xoffset-=
k*0.7}}return c}return null};b.adjustPictureMarkerSymbol=function(a){if(a&&a.symbol instanceof esri.symbol.PictureMarkerSymbol){var b=new esri.symbol.PictureMarkerSymbol(a.symbol.toJson());if(b.toJson&&typeof b.toJson==="function"){var c=b.toJson;b.toJson=function(){var a=c.call(b),d,f;a.color=[0,0,0,255];if(!isNaN(d=parseInt(b.width,10))&&!isNaN(f=parseInt(b.height,10)))a.width=d,a.height=f,a.xoffset=!isNaN(parseInt(a.xoffset))?a.xoffset+d/2:d/2,a.yoffset=!isNaN(parseInt(a.yoffset))?a.yoffset-f/
2:f/2;return a}}return b}return null};b.getImageAsBase64=function(a,b){b===void 0&&(b="image/png");var c=new dojo.Deferred,d=document.createElement("canvas"),f=d.getContext("2d"),h=new Image;h.onload=function(){d.height=h.height;d.width=h.width;f.drawImage(h,0,0);try{var k=d.toDataURL(b);c.resolve({url:a,data:k.replace(/^data:image\/(png|jpg);base64,/,"")})}catch(m){c.reject({url:a,error:m})}};h.onerror=function(){c.reject({url:a,error:Error("Failed to download image.")})};h.src=a;return c};return b}();
c.PrintUtilities=d})(c.utilities||(c.utilities={}))})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){function c(){}c.prototype.toJson=function(){return JSON.stringify(this)};return c}();c.EssentialsFeatureSet=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a){this.layer=null;if(c.charting&&dojo.isObject(c.charting.configuration.ChartDefinition)){if(b)this.id=b.id,this.displayName=b.displayName,this.defaultChart=b.defaultChart,this.chartFeatureType=b.chartFeatureType,this.chartDefinition=new c.charting.configuration.ChartDefinition(b.chartDefinition),this.chartDefinition.id=this.id,this.chartDefinition.displayName=this.displayName;if(a)this.layer=a,this._setFieldDisplayNames(this.chartDefinition,
a)}}d.prototype._setFieldDisplayNames=function(b,a){if(a&&b){for(var c={},d=0;d<a.fields.length;d++){var f=a.fields[d];if(f)c[f.name]=f.displayName}if(b.category.field.sourceType==0)b.category.field.displayName=c[b.category.field.name]||b.category.field.name;for(d=0;d<b.series.length;d++)if((f=b.series[d])&&f.field.sourceType==0)f.field.displayName=c[f.field.name]||f.field.name}};return d}();h.LayerChart=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c,b,a,g){this.label=new Observable(c);this.value=new Observable(b);this.isDefault=new Observable(g||false);this.causesValidation=new Observable(a)}}();c.FormButton=f})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){(function(d){var b=function(){function a(a){this.message=c.forms.getElementText(a,"Message")}a.prototype.validate=function(){throw Error("Abstract method");};return a}();d.ValidationItem=b})(f.validation||(f.validation={}))})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var f=this;b.call(this,a,d);this.formItemType="CheckBoxFormItem";a?(this.text=new Observable(c.forms.getElementText(a,"Text")),this.checked=new Observable(c.forms._parseBoolean(c.forms.getElementText(a,"Checked"))),this.textLocation=new Observable(c.forms.getElementText(a,"TextLocation"))):(this.text=new Observable(""),this.checked=new Observable(false),this.textLocation=new Observable("Right"));this.checked.bind(null,function(){return f._notifyResultChanged()})}
__extends(a,b);a.prototype.getResult=function(){return new c.forms.items.FormItemResult(this.argumentName.get(),this.checked.get())};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.CheckBoxFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){return function(c,b,a,g,i,f){this.instanceId=c;this.status=b;this.pendingExternalActivities=a;this.outputs=g;this.workflowData=i;this.instanceData=f}}();c.WorkflowState=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,c,d){this.activityComplete=null;this._dispatcher=b;this._pendingIndex=a;this._workflow=c;this._workflowState=d}d.prototype.dispatcher=function(){return this._dispatcher};d.prototype.workflow=function(){return this._workflow};d.prototype.getDisplayName=function(){return this._workflowState?this._workflowState.pendingExternalActivities[this._pendingIndex].displayName:""};d.prototype.getInputNames=function(){var b=[];if(this._workflowState)for(var a=
this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,c=0;c<a.length;c++)b.push(a[c].name);return b};d.prototype.getInputNamesByType=function(b){var a=[];if(this._workflowState)for(var c=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,d=0;d<c.length;d++)c[d].typeName.indexOf(b)===0&&a.push(c[d].name);return a};d.prototype.getOutputNames=function(){var b=[];if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,
c=0;c<a.length;c++)b.push(a[c].name);return b};d.prototype.getOutputNamesByType=function(b){var a=[];if(this._workflowState)for(var c=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,d=0;d<c.length;d++)c[d].typeName.indexOf(b)===0&&a.push(c[d].name);return a};d.prototype.getSite=function(){return this._workflow!=null?this._workflow.site:null};d.prototype.getEsriMap=function(){return this._workflow!=null&&this._workflow.site!=null?this._workflow.site.getMap():null};d.prototype.getValue=
function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,c=0;c<a.length;c++)if(a[c].name==b)return a[c].value;return null};d.prototype.getOutputValue=function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,c=0;c<a.length;c++)if(a[c].name==b)return a[c].value;return null};d.prototype.getJsonValue=function(b){for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,
c=0;c<a.length;c++)if(a[c].name==b)return JSON.stringify(a[c].value);return null};d.prototype.getOutputJsonValue=function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,c=0;c<a.length;c++)if(a[c].name==b)return(b=a[c].value)&&b.length===1&&(b=b[0]),JSON.stringify(b);return null};d.prototype.setValue=function(b,a,d){if(this._workflowState){var i=false,f=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,h=this._getRuntimeType(a);
if(a&&a instanceof c.workflow.ArgumentValueWrapper)h=a.runtimeTypeName,a=a.value;for(var l=0;l<f.length;l++)if(f[l].name==b){i=true;if(f=f[l])if(f.value=a,h!=null)f.runtimeTypeName=h;break}if(!i&&d)h||(h="System.Object"),f=new c.workflow.ArgumentInfo,f.isRequired=false,f.name=b,f.value=a,f.typeName=h,f.runtimeTypeName=h,this._workflowState.pendingExternalActivities[this._pendingIndex].outputs.push(f)}};d.prototype.getActivityTypeName=function(){var b="";if(this._workflowState&&(b=this._workflowState.pendingExternalActivities[this._pendingIndex].typeName)){var a=
b.indexOf("`");a>=0&&(b=b.substring(0,a))}return b};d.prototype.getActivityExternalId=function(){return this._workflowState?this._workflowState.pendingExternalActivities[this._pendingIndex].externalId:""};d.prototype.getInputArgumentTypeName=function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,c=0;c<a.length;c++)if(a[c].name==b)return a[c].typeName;return""};d.prototype.getInputArgumentRuntimeTypeName=function(b){for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,
c=0;c<a.length;c++)if(a[c].name==b)return a[c].runtimeTypeName;return""};d.prototype.completeActivity=function(){if(this._workflowState){var b=this._workflowState.pendingExternalActivities[this._pendingIndex];if(!b.isComplete){var a=this;this.getActivityExternalId()=="debugger"||b&&b.debug?c.workflow.DefaultActivityHandlers.showDebug(this,false,function(){a._completeActivityInternal()}):this._completeActivityInternal()}}};d.prototype.abortActivity=function(){if(this._workflowState){var b=this._workflowState.pendingExternalActivities[this._pendingIndex];
b.isAborted=true;this._workflowState.status="Aborted: "+b.displayName}this._dispatcher!=null&&this._dispatcher.activityAbort(this)};d.prototype._completeActivityInternal=function(){if(this._workflowState){var b=this._workflowState.pendingExternalActivities[this._pendingIndex];b.isComplete=true;this._dispatcher!=null&&this._dispatcher.activityComplete(this);b.inputs=null;var b=this._workflowState.pendingExternalActivities[this._pendingIndex].syncToken,a=true;if(b!="")for(var d=this._workflowState.pendingExternalActivities,
i=0;i<d.length;i++)if(d[i].syncToken==b&&!d[i].isComplete){a=false;break}a&&(c.workflow.WorkflowControllerProxy._executeWorkflow(this._workflow,this._dispatcher,this._workflowState,null,this),dojo.isFunction(this.activityComplete)&&this.activityComplete(this))}};d.prototype._getRuntimeType=function(b){var a="System.Object";b&&(typeof b.isInstanceOf=="function"?b.isInstanceOf(esri.geometry.Extent)?a="ESRI.ArcGIS.Client.Geometry.Envelope":b.isInstanceOf(esri.geometry.Extent)?a="ESRI.ArcGIS.Client.Geometry.Envelope":
b.isInstanceOf(esri.geometry.Point)?a="ESRI.ArcGIS.Client.Geometry.MapPoint":b.isInstanceOf(esri.geometry.Multipoint)?a="ESRI.ArcGIS.Client.Geometry.MultiPoint":b.isInstanceOf(esri.geometry.Polygon)?a="ESRI.ArcGIS.Client.Geometry.Polygon":b.isInstanceOf(esri.geometry.Polyline)?a="ESRI.ArcGIS.Client.Geometry.Polyline":b.isInstanceOf(esri.geometry.Geometry)?a="ESRI.ArcGIS.Client.Geometry.Geometry":b.isInstanceOf(esri.layers.LayerDataSource)?a="ESRI.ArcGIS.Client.LayerDataSource":b.isInstanceOf(esri.layers.LayerMapSource)&&
(a="ESRI.ArcGIS.Client.LayerMapSource"):typeof b=="string"?a="System.String":typeof b=="number"?a="System.Double":typeof b=="boolean"?a="System.Boolean":typeof b=="object"&&(a=typeof b.getMonth=="function"?"System.DateTime":"System.Object"));return a};return d}();h.ActivityContext=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){f.startWorkflow=function(c,b,a){f._executeWorkflow(c,b,null,a,null)};f._executeWorkflow=function(d,b,a,g,i){var f={};if(d==null)if(a=Error("workflow cannot be null"),b!=null){b.handleError(a,null);return}else throw a;var h=d.url+"/run";if(g)c.workflow.WorkflowControllerProxy._preProcessArguments(g),f.inargs=JSON.stringify(g);if(a!=null){for(var g=a.pendingExternalActivities,l=0;l<g.length;l++)c.workflow.WorkflowControllerProxy._preProcessArguments(g[l].outputs);
f.workflow=JSON.stringify(a)}f=c.encodeJson(dojo.mixin({f:"json"},f));if(b!=null)b.isBusy=true;b.webRequestBegin(h,d);c.request({url:h,content:f,load:dojo.hitch(this,function(a){b.webRequestComplete(h,d);c.workflow.WorkflowControllerProxy._processWorkflowResults(a,d,b)}),error:dojo.hitch(this,function(a){if(b!=null)b.isBusy=false,b.handleError(a,i);else throw a;}),callbackParamName:"CallBack"})};f._processWorkflowResults=function(d,b,a){if(a!=null)a.isBusy=false;if(d)if(d.error)c.workflow.WorkflowControllerProxy._handleErrorInternal(a,
Error("Error running workflow: "+d.error.message));else if(d=new c.workflow.WorkflowState(d.instanceId,d.status,c.workflow.WorkflowControllerProxy._getExternalActivities(d.pendingExternalActivities),c.workflow.WorkflowControllerProxy._getArguments(d.outputs),d.workflowData,d.instanceData),d.status=="Completed")a!=null&&a.workflowComplete(d.outputs,b);else if(d.status=="WaitingForExternalActivities"){var g=d.pendingExternalActivities;if(g!=null)for(var f=0;f<g.length;f++){var h=new c.workflow.ActivityContext(a,
f,b,d);a!=null&&a.activityBegin(h);var j=g[f];c.workflow.WorkflowControllerProxy._preProcessArguments(j.inputs);try{h.getActivityExternalId()==="debugger"||j&&j.debug?c.workflow.DefaultActivityHandlers.showDebug(h,true,function(){c.workflow.WorkflowControllerProxy._dispatch(h)}):c.workflow.WorkflowControllerProxy._dispatch(h)}catch(l){c.workflow.WorkflowControllerProxy._handleErrorInternal(a,l,h)}}}};f._handleErrorInternal=function(c,b,a){if(c!=null)c.handleError(b,a||null);else throw b;};f._preProcessArguments=
function(d){if(d!=null)for(var b=0;b<d.length;b++){var a=function(a){var b=a,c=a.indexOf(",");c>0&&(b=a.substring(0,c));return b},g=a(d[b].runtimeTypeName);d[b].value=c.workflow.WorkflowControllerProxy._getObjectFromJsonWithType(d[b].value,g);if(d[b].value==null)a=a(d[b].typeName),d[b].value=c.workflow.WorkflowControllerProxy._getObjectFromJsonWithType(d[b].value,a)}};f._getObjectFromJsonWithType=function(c,b){var a=c;switch(b){case "ESRI.ArcGIS.Client.Tasks.FeatureSet":if(c!=null)a=new esri.tasks.FeatureSet(c),
a.features=a.features||[];break;case "ESRI.ArcGIS.Client.Geometry.Geometry":case "ESRI.ArcGIS.Client.Geometry.Envelope":case "ESRI.ArcGIS.Client.Geometry.MapPoint":case "ESRI.ArcGIS.Client.Geometry.MultiPoint":case "ESRI.ArcGIS.Client.Geometry.Polygon":case "ESRI.ArcGIS.Client.Geometry.Polyline":if(c!=null&&(a=esri.geometry.fromJson(c))&&a.spatialReference&&!c.spatialReference)a.spatialReference=null;break;case "ESRI.ArcGIS.Client.Geometry.SpatialReference":c!=null&&(a=new esri.SpatialReference(c));
break;case "ESRI.ArcGIS.Client.LayerMapSource":var g=c;g&&(a=new esri.layers.LayerMapSource(g));break;case "ESRI.ArcGIS.Client.LayerDataSource":(g=c)&&(a=new esri.layers.LayerDataSource(g));break;case "ESRI.ArcGIS.Client.TimeExtent":c instanceof Array&&c.length>0&&(a=new Date(c[0]),a=new esri.TimeExtent(a,c.length>1?new Date(c[1]):a));break;case "System.DateTime":c instanceof Date&&(a="/Date("+c.getTime()+")/")}return a};f._getExternalActivities=function(d){var b=[];if(d!=null)for(var a=0;a<d.length;a++){var g=
d[a],f=new c.workflow.ExternalActivityInfo;f._configureObject(g);b[a]=f}return b};f._getArguments=function(d){arguments=[];if(d!=null)for(var b=0;b<d.length;b++){var a=d[b],g=new c.workflow.ArgumentInfo;g._configureObject(a);arguments[b]=g}return arguments};f._dispatch=function(c){if(c.dispatcher()!=null)c.dispatcher().dispatch(c);else throw Error("Unhandled activity: "+c.getActivityTypeName());}})(h.WorkflowControllerProxy||(h.WorkflowControllerProxy={}))})(c.workflow||(c.workflow={}))})(geocortex||
(geocortex={}));(function(c){(function(h){var f=function(){function d(b,a,c){this.display=b;this.value=a;this.typeName=c}d.prototype.getValue=function(){var b=this.value;this.typeName!=null&&(b=c.workflow.WorkflowControllerProxy._getObjectFromJsonWithType(b,this.typeName));this.value!=null&&typeof this.value.__type!="undefined"&&delete b.__type;return b};return d}();h.DataItem=f})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){f.initDataItemsFormItem=function(d,b,a){d.dataItems=new ObservableCollection;if(b&&(b=c.forms.getElement(b,"DataItems"),b!=null))for(var g=0;g<b.childNodes.length;g++){var f=b.childNodes[g],f=new c.forms.DataItem(c.forms.getElementText(f,"Display"),c.forms.getElementText(f,"Value"),c.forms.getElementText(f,"TypeName"));f!=null&&d.dataItems.addItem(f)}if(a&&(a=a.inputData)&&a.hasOwnProperty(d.itemID.get()))a=a[d.itemID.get()],d.dataItems.addItems(a)}})(h.items||
(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(){function b(a,b){this.cascadingEvent=new c.framework.events.Event("cascadingEvent");this.isBusy=new Observable(false);this._queryId=0;if(!a.queryTaskRunner)a.queryTaskRunner=this;if(a.queryTaskRunner!==this)throw Error("FormItem in the constructor must be the QueryTaskFormItem containing the QueryTaskRunner");this.formItem=a;if(b){if(this.queryDisplayOutputField=new Observable(c.forms.getElementText(b,"QueryDisplayOutputField")),this.queryValueOutputField=
new Observable(c.forms.getElementText(b,"QueryValueOutputField")),this.queryServiceUrl=new Observable(c.forms.getElementText(b,"QueryServiceUrl")),this.queryWhereClause=new Observable(c.forms.getElementText(b,"QueryWhereClause")),this.filterByInputGeometry=new Observable(c.forms._parseBoolean(c.forms.getElementText(b,"FilterByInputGeometry"))),this.queryCascadingID=new Observable(c.forms.getElementText(b,"QueryCascadingID")),this.proxyUrl=new Observable(c.forms.getElementText(b,"ProxyUrl")),this.token=
new Observable(c.forms.getElementText(b,"Token")),c.forms.getElementText(b,"LayerSourceJson"))this.layerSourceJson=new Observable(c.forms.getElementText(b,"LayerSourceJson"))}else this.queryDisplayOutputField=new Observable(null),this.queryValueOutputField=new Observable(null),this.queryServiceUrl=new Observable(null),this.queryWhereClause=new Observable(null),this.filterByInputGeometry=new Observable(false),this.queryCascadingID=new Observable(null),this.proxyUrl=new Observable(null),this.token=
new Observable(null);a.formDefinition&&a.formDefinition.map(a);var d=this.queryCascadingID.get();d!=null&&d!=""&&a.formDefinition.addCascading(d,a,function(a){a?this.queryTaskRunner.performQuery(a):(this.clearDataItems(),this.triggerCascading(null))});if(!a.isBusy)a.isBusy=new Observable(false);a.isBusy.sync(this.isBusy)}b.prototype.triggerCascading=function(a){this.cascadingEvent.publish(a)};b.prototype.isQueryable=function(){return this.queryServiceUrl.get()==null||dojo.trim(this.queryServiceUrl.get())===
""||this.queryWhereClause.get()==null||dojo.trim(this.queryWhereClause.get())===""||this.queryDisplayOutputField.get()==null||dojo.trim(this.queryDisplayOutputField.get())===""?false:true};b.prototype.performQuery=function(a,b){var d=this;if(this.isQueryable()&&(this.formItem.dataItems.clear(),a!=null)){var f=null;if(this.filterByInputGeometry.get()&&this.formItem.formDefinition!=null&&this.formItem.formDefinition.inputGeometry)f=this.formItem.formDefinition.inputGeometry;var h=this.queryServiceUrl.get();
this.token&&this.token.get()&&(h+=(dojo.indexOf(h,"?")>=0?"&":"?")+"token="+this.token.get());var l;if(this.layerSourceJson&&this.layerSourceJson.get()){var k=c.essentials.RestHelper.getJsonObjectFromJsonString(this.layerSourceJson.get());l=new esri.tasks.QueryTask(h,{source:c.essentials.RestHelper.getLayerSourceFromJsonObject(k)})}else l=new esri.tasks.QueryTask(h);var m=new esri.tasks.Query;m.returnGeometry=false;m.geometry=f;m.outFields=[];m.where=this._getWhereClause(a);m.returnDistinctValues=
true;m.outFields.push(this.queryDisplayOutputField.get());this.queryValueOutputField.get()!=null&&dojo.trim(this.queryValueOutputField.get())!=""&&this.queryValueOutputField.get()!=this.queryDisplayOutputField.get()&&m.outFields.push(this.queryValueOutputField.get());this.isBusy.set(true);++this._queryId;(function(){var a=d._queryId;l.execute(m,function(f){var h=[];if(a==d._queryId){for(var j=0;j<f.features.length;++j){var p=f.features[j].attributes,k=null;d.queryDisplayOutputField.get()!=null&&(k=
p[d.queryDisplayOutputField.get().trim()]);p=d.queryValueOutputField.get()!=null&&dojo.trim(d.queryValueOutputField.get())!=""&&d.queryValueOutputField.get()!=d.queryDisplayOutputField.get()?p[d.queryValueOutputField.get().trim()]:k;h.push(new c.forms.DataItem(k,p,null))}h.sort(function(a,b){return a.display<b.display?-1:1});d.formItem.prepareForResults&&d.formItem.prepareForResults();f={};j=[];for(k=0;k<h.length;++k){var p=h[k],l=p.display+"-"+p.value;f.hasOwnProperty(l)||(f[l]=true,j.push(p))}d.formItem.dataItems.addItems(j);
d.isBusy.set(false);h=null;d.formItem.dataItems.getLength()>0&&(h=d.formItem.dataItems.getAt(0));b===true&&d.triggerCascading(h==null?null:h.value);d.formItem.handleResultsComplete&&d.formItem.handleResultsComplete()}})})()}};b.prototype._getWhereClause=function(a){var b=this,c=this.queryWhereClause.get(),c=c.replace(/{1:([a-zA-Z0-9]+)(:[a-zA-Z0-9]+)?}/g,function(a,c,d){a=b.formItem.formDefinition.getFormItemById(c);if(!a)return"{unknown form item "+c+"}";c=a.getResult().value;if(!d)return c;return d===
":SQL"?b._escapeForWhere(c):(a=/:[fF](\d+)/.exec(d))?parseFloat(c).toFixed(+a[1]):"{unknown format clause "+d+"}"});return c=c.format(this._escapeForWhere(a))};b.prototype._escapeForWhere=function(a){a&&typeof a==="number"&&(a=a.toString());return(a||"").replace(/\'/g,"''")};return b}();f.QueryTaskRunner=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var h=this;b.call(this,a,d);this._defaultSet=false;this.selectText=new Observable;this.selected=new Observable;this.defaultSelectedValue=new Observable;this.isBusy=new Observable(false);this.formItemType="ComboBoxFormItem";f.initLabelContainer(this,a,d);f.initDataItemsFormItem(this,a,d);this.queryTaskRunner=new f.QueryTaskRunner(this,a,d);if(a){var j=c.forms.getElementText(a,"SelectText");j&&this.selectText.set(j);(j=c.forms.getElementText(a,
"SelectedValue"))&&this.defaultSelectedValue.set(j)}this.selected.bind(null,function(){return h._notifyResultChanged()});this.prepareForResults();this.queryTaskRunner.isQueryable()||this._selectDefaultValue();j=this.queryTaskRunner.queryCascadingID.get();(j==null||j=="")&&this.queryTaskRunner.performQuery("")}__extends(a,b);a.prototype.clearDataItems=function(){this.dataItems.clear()};a.prototype._hasRealDataItem=function(){return this.selected.get()!=null};a.prototype.triggerCascading=function(a){(this.selected.get()==
null||!a)&&this.queryTaskRunner.cascadingEvent.publish(null);var b=this.selected.get();b===null&&(b=a);b===null||b===void 0?this.queryTaskRunner.cascadingEvent.publish(null):this.queryTaskRunner.cascadingEvent.publish(b.value)};a.prototype.prepareForResults=function(){if(this.selectText.get()){var a=this.selectText.get();this.dataItems.insertItem(0,new c.forms.DataItem(a,"",null))}};a.prototype.handleResultsComplete=function(){if(!this._defaultSet&&(this._selectDefaultValue(),this.selected.get()!=
null))this._defaultSet=true,this.triggerCascading(this.selected.get())};a.prototype.getResult=function(){if(this.selected.get()==null)return new c.forms.items.FormItemResult(this.argumentName.get(),null);var a=this.selected.get();return!a?new c.forms.items.FormItemResult(this.argumentName.get(),null):new c.forms.items.FormItemResult(this.argumentName.get(),a.getValue())};a.prototype._addOption=function(a,b){this.dataItems.addItem(new c.forms.DataItem(a,b))};a.prototype._selectDefaultValue=function(){var a=
dojo.filter(this.dataItems.getItems(),dojo.hitch(this,function(a){return this.defaultSelectedValue.get()?a.value+""===this.defaultSelectedValue.get()+"":false}));a.length>0?this.selected.set(a[0]):this.dataItems.length()>0&&this.selected.set(this.dataItems.getAt(0))};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.ComboBoxFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var h=this;b.call(this,a,d);this.initialTime=new Observable;this.nullable=new Observable(false);this.timeFormat=new Observable;this._timeFormatStr=new Observable;this.formItemType="TimePickerFormItem";f.initLabelContainer(this,a,d);if(a){for(var j=true,l=a.getElementsByTagNameNS?a.getElementsByTagNameNS("http://schemas.datacontract.org/2004/07/Geocortex.Forms.Client.Items.Validation","ValidationItem"):a.getElementsByTagName("ValidationItem"),
k=0;k<l.length;k++){var m=l[k].getAttributeNS("http://www.w3.org/2001/XMLSchema-instance","type");if(m&&m.indexOf("RequiredValidationItem")>=0){j=false;break}}this.nullable.set(j);j=true;l=c.forms.getElementText(a,"InitialTime");(j=c.forms.getElementText(a,"InitializeWithCurrentTime")===null?!l:c.forms.getElementText(a,"InitializeWithCurrentTime")==="true")?this.initialTime.set(new Date):l?(c.framework.utils.DateUtils.containsTimezone(l)||(l+=c.framework.utils.DateUtils.getTimezoneString()),this.initialTime.set(Date.fromISO(l)),
this.timeFormat.set(c.forms.getElementText(a,"TimeFormat"))):this.initialTime.set(null)}else this.timeFormat.set("LongTime"),this.initialTime.set(new Date);this.time=new Observable(this.initialTime.get());this.timeFormat.bind(this,function(a){a==="Short"?this._timeFormatStr.set("hh:mm tt"):this._timeFormatStr.set("h:mm:ss tt")});this.timeFormat.pulse();this.time.bind(null,function(){return h._notifyResultChanged()})}__extends(a,b);a.prototype.getResult=function(){var a=this.time.get();a&&(a=new Date(a.toString()),
a="/Date({0})/".format(a.getTime()));return new c.forms.items.FormItemResult(this.argumentName.get(),a)};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.TimePickerFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var h=this;b.call(this,a,d);this.nullable=new Observable(false);this._dateFormatStr=new Observable;this.formItemType="DatePickerFormItem";f.initLabelContainer(this,a,d);var j=true;if(a){for(var j=true,l=a.getElementsByTagNameNS?a.getElementsByTagNameNS("http://schemas.datacontract.org/2004/07/Geocortex.Forms.Client.Items.Validation","ValidationItem"):a.getElementsByTagName("ValidationItem"),k=0;k<l.length;k++){var m=l[k].getAttributeNS("http://www.w3.org/2001/XMLSchema-instance",
"type");if(m&&m.indexOf("RequiredValidationItem")>=0){j=false;break}}this.nullable.set(j);this.dateFormat=new Observable(c.forms.getElementText(a,"DateFormat"));this.includeTimePicker=new Observable(c.forms.getElementText(a,"IncludeTimePicker")==="true");l=null;if(this.includeTimePicker.get())this.timePickerItem=new f.TimePickerFormItem(c.forms.getElement(a,"TimePickerItem")),l=this.timePickerItem.initialTime.get();k=c.forms.getElementText(a,"InitialDate");j=c.forms.getElementText(a,"InitializeWithCurrentDate")===
null?!k:c.forms.getElementText(a,"InitializeWithCurrentDate")==="true";k&&(c.framework.utils.DateUtils.containsTimezone(k)&&(m=Math.max(k.lastIndexOf("Z"),k.lastIndexOf("+"),k.lastIndexOf("-")),m>0&&(k=k.substring(0,m))),k+=c.framework.utils.DateUtils.getTimezoneString());m=null;if(j||k)m=new Date(k);m&&!isNaN(m.getTime())?(m.getTimezoneOffset()!=c.framework.utils.DateUtils.getTimezoneOffset()&&m.setTime(m.getTime()-(c.framework.utils.DateUtils.getTimezoneOffset()-m.getTimezoneOffset())*6E4),l&&(m.setHours(l.getHours()),
m.setMinutes(l.getMinutes()),m.setSeconds(l.getSeconds())),this.initialDate=new Observable(m)):this.initialDate=new Observable(l)}else this.dateFormat=new Observable,this.initialDate=new Observable(null),this.includeTimePicker=new Observable(false);j?(j=new Date,this.includeTimePicker.get()||(j.setHours(0),j.setMinutes(0),j.setSeconds(0)),this.date=new Observable(j),this.initialDate.set(j)):this.date=new Observable(this.initialDate.get());this.dateFormat.bind(this,function(a){a==="Long"?this._dateFormatStr.set("DD MM dd, yy"):
this._dateFormatStr.set("mm/dd/yy")});this.dateFormat.pulse();this.date.bind(null,function(){return h._notifyResultChanged()})}__extends(a,b);a.prototype.getResult=function(){var a=this.date.get(),b=a===null?null:new Date(a.toString());if(b)if(isNaN(b.getTime()))b=this.initialDate.get();else{var d=0,f=this.attached_pickerType&&this.attached_pickerType.get?this.attached_pickerType.get().toLowerCase().indexOf("native")>-1:true;!(a instanceof Date)&&!this.includeTimePicker.get()&&f&&(d=b.getTimezoneOffset()*
6E4);b="/Date({0})/".format(b.getTime()+d)}return new c.forms.items.FormItemResult(this.argumentName.get(),b)};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.DatePickerFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var h=this;b.call(this,a,d);this.files=new ObservableCollection;this.formItemType="FilePickerFormItem";this.isSupported=new Observable(typeof FileReader!=="undefined"&&this._isFileInputSupported());a?(this.acceptFileTypes=new Observable(c.forms.getElementText(a,"AcceptFileTypes")),this.allowMultiple=new Observable(c.forms._parseBoolean(c.forms.getElementText(a,"AllowMultiple")))):(this.acceptFileTypes=new Observable(null),this.allowMultiple=
new Observable(false));f.initLabelContainer(this,a,d);this.files.bind(null,function(){return h._notifyResultChanged()})}__extends(a,b);a.prototype.clear=function(){this.files.clear();this.refresh()};a.prototype.getResult=function(){for(var a=[],b=0;b<this.files.getLength();++b){var d=this.files.getAt(b);d&&a.push(d)}a=new c.workflow.ArgumentValueWrapper("System.Collections.Generic.List`1[[Geocortex.Forms.Client.FileItem, Geocortex.EssentialsWpfApi]]",a);a=new f.FormItemResult(this.argumentName.get(),
a,true);a.isList=true;return a};a.prototype._render=function(){return c.forms.renderFormItem(this)};a.prototype._isFileInputSupported=function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return false;var a=document.createElement("input");a.type="file";return!a.disabled};return a}(f.AbstractFormItem);f.FilePickerFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||
(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){b.call(this,a,d);this.formItems=new ObservableCollection;this.formItemType="ContainerFormItem";if(a){this.orientation=new Observable(c.forms.getElementText(a,"Orientation"));this.description=new Observable(c.forms.getElementText(a,"Description"));this.maxWidth=new Observable(parseInt(c.forms.getElementText(a,"MaxWidth")));this.visibleControlID=new Observable(c.forms.getElementText(a,"VisibleControlID"));this.visibleControlValue=new Observable(c.forms.getElementText(a,
"VisibleControlValue"));var f=c.forms.getElement(a,"FormItems");if(f!=null)for(var h=0;h<f.childNodes.length;h++){var l=c.forms.items._processFormItem(f.childNodes[h],this.formDefinition);if(l!=null){this.formItems.addItem(l);var k=this;l.refresh=function(){var a=k.formItems.indexOf(this);a>=0&&(k.formItems.removeAt(a),k.formItems.insertItem(a,this))}}}}else this.orientation=new Observable("Vertical"),this.description=new Observable(""),this.maxWidth=new Observable(NaN),this.visibleControlID=new Observable(""),
this.visibleControlValue=new Observable("")}__extends(a,b);a.prototype.validate=function(){var a=[];if(this.isVisible.get()&&this.formItems!=null)for(var b=0;b<this.formItems.getLength();++b){var c=this.formItems.getAt(b);if(c.isVisible.get())for(var c=c.validate(),d=0;d<c.length;++d)a.push(c[d])}return a};a.prototype._getResults=function(){for(var b=[],c=0;c<this.formItems.getLength();++c){var d=this.formItems.getAt(c);if(d.isVisible.get())if(d instanceof a){if(d=d._getResults(),d!=null)for(var f=
0;f<d.length;++f)b.push(d[f])}else d=d.getResult(),d!=null&&b.push(d)}return b};a.prototype._destroy=function(){for(var a=this.formItems.length()-1;a>=0;a--)this.formItems.getAt(a)._destroy();this.formItems.clear()};a.prototype._render=function(){return c.forms.renderFormItem(this)};a.prototype.getFormItemById=function(a){for(var b=0,c=this.formItems.length();b<c;b++){var d=this.formItems.getAt(b);if(d.itemID.get()===a)return d;else if(d.getFormItemById&&(d=d.getFormItemById(a)))return d}return null};
a.prototype.applyVisibility=function(a){if(a){var b=false,c=a.getResult();if(c!==null&&c.value!==null)if(a=this.visibleControlValue.get())if(c.isList){if(c=c.value)for(var d=0;d<c.length;d++)if(c[d].toString()===a){b=true;break}}else b=c.value===true||c.value===false?c.value.toString().toUpperCase()===a.toUpperCase():c.value.toString()===a;else c.value===true&&(b=true);this.isVisible.set(b)}};a.prototype.getDisplayName=function(){return null};return a}(f.AbstractFormItem);f.ContainerFormItem=d})(h.items||
(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){b.call(this,a,d);this.formItemType="GroupBoxFormItem";this.header=a?new Observable(c.forms.getElementText(a,"Header")):new Observable(null)}__extends(a,b);a.prototype._render=function(){return c.forms.renderFormItem(this)};a.prototype.getDisplayName=function(){return this.header.get()};return a}(f.ContainerFormItem);f.GroupBoxFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var f=this;b.call(this,a,d);this.wasClicked=new Observable(false);this.formItemType="HyperlinkFormItem";a?(this.hyperlinkText=new Observable(c.forms.getElementText(a,"HyperlinkText")),this.target=new Observable(c.forms.getElementText(a,"Target")),this.uri=new Observable(c.forms.getElementText(a,"Uri"))):(this.hyperlinkText=new Observable("Hyperlink"),this.target=new Observable("_blank"),this.uri=new Observable(""));this.wasClicked.bind(null,
function(){return f._notifyResultChanged()})}__extends(a,b);a.prototype.getResult=function(){return new c.forms.items.FormItemResult(this.argumentName.get(),this.wasClicked.get(),this.wasClicked.get())};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.HyperlinkFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){b.call(this,a,d);this.formItemType="ImageFormItem";if(a){this.source=new Observable(c.forms.getElementText(a,"Source"));this.width=new Observable(c.forms.getElementText(a,"Width"));this.height=new Observable(c.forms.getElementText(a,"Height"));var f=this.width.get(),h=this.height.get();f&&h?parseInt(f)>parseInt(h)?this.height.set("auto"):this.width.set("auto"):(this.width=new Observable("auto"),this.height=new Observable("auto"))}else this.source=
new Observable(""),this.width=new Observable("auto"),this.height=new Observable("auto")}__extends(a,b);a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.ImageFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){var h=this;b.call(this,a,d);this.selection=new ObservableCollection;this.selectedValues=new ObservableCollection;this._selectedValuesLookup=null;this.isBusy=new Observable(false);this.formItemType="ListBoxFormItem";f.initLabelContainer(this,a,d);f.initDataItemsFormItem(this,a,d);this.size=new Observable(6);if(a){this.maxHeight=new Observable(parseInt(c.forms.getElementText(a,"MaxHeight")));this.selectionMode=new Observable(c.forms.getElementText(a,
"SelectionMode"));var j=c.forms.getElementText(a,"Size");j&&(j=parseInt(j),j>0&&this.size.set(j));if(j=c.forms.getElement(a,"SelectedValues")){this._selectedValuesLookup={};var l;for(l=0;l<j.childNodes.length;l++){var k=j.childNodes[l].textContent;this.selectedValues.addItem(k);this._selectedValuesLookup[k+""]=true}this._setDefaults();this.selection.length()===0&&this.dataItems.getItems().length!==0&&this.selection.addItem(this.dataItems.getAt(0))}}else this.label=new c.forms.items.LabelFormItem(null,
this.formDefinition),this.maxHeight=new Observable(NaN),this.selectionMode=new Observable("Single");this.queryTaskRunner=new f.QueryTaskRunner(this,a,d);this.queryTaskRunner.queryCascadingID.get()||this.queryTaskRunner.performQuery("");this.selection.bind(null,function(){setTimeout(function(){h._notifyResultChanged()},0)})}__extends(a,b);a.prototype.clearDataItems=function(){this.dataItems.clear()};a.prototype._setDefaults=function(){for(var a=0;a<this.dataItems.getItems().length;a++){var b=this.dataItems.getAt(a);
this._selectedValuesLookup[b.value.toString()]&&this.selection.addItem(b)}};a.prototype.handleResultsComplete=function(){this._setDefaults()};a.prototype.triggerCascading=function(a){(this.selection==null||!a)&&this.queryTaskRunner.cascadingEvent.publish(null);var b=null;this.selection!=null&&(b=this.selection.getAt(0));b==null&&a!=null&&(b=a);b==null?this.queryTaskRunner.cascadingEvent.publish(null):this.queryTaskRunner.cascadingEvent.publish(b.value)};a.prototype.getResult=function(){var a=null;
if(this.selectionMode.get().toLowerCase()=="single")return this.selection.getLength()>0&&(a=(a=this.selection.getAt(0))?a.getValue():null),new f.FormItemResult(this.argumentName.get(),a,true);else{for(var b=[],c=0;c<this.selection.getLength();++c)(a=(a=this.selection.getAt(c))?a.getValue():null)&&b.push(a);a=new f.FormItemResult(this.argumentName.get(),b,true);a.isList=true;return a}};a.prototype._render=function(){return c.forms.renderFormItem(this)};return a}(f.AbstractFormItem);f.ListBoxFormItem=
d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(d,f){var h=this;b.call(this,d,f);this.formItemType="RadioButtonFormItem";d?(this.text=new Observable(c.forms.getElementText(d,"Text")),this.checked=new Observable(c.forms._parseBoolean(c.forms.getElementText(d,"Checked"))),this.textLocation=new Observable(c.forms.getElementText(d,"TextLocation")),this.groupName=new Observable(c.forms.getElementText(d,"GroupName"))):(this.text=new Observable(null),this.checked=new Observable(false),
this.textLocation=new Observable("Right"),this.groupName=new Observable(null));this.checked.bind(null,function(b){b&&a._findButtonsInGroup(h.groupName.get(),h.formDefinition.containerFormItem).forEach(function(a){a!==h&&a.checked.set(false)});h._notifyResultChanged()})}__extends(a,b);a.prototype.getResult=function(){var a=this.__getRadioValueClosure,a=a?a():false;return new c.forms.items.FormItemResult(this.argumentName.get(),a)};a.prototype._render=function(){return c.forms.renderFormItem(this)};
a._findButtonsInGroup=function(b,c){var d=[];c&&c.formItems.get().forEach(function(c){c instanceof a?c.groupName.get()===b&&d.push(c):c instanceof f.ContainerFormItem&&a._findButtonsInGroup(b,c).forEach(function(a){return d.push(a)})});return d};return a}(f.AbstractFormItem);f.RadioButtonFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){var d=function(b){function a(a,d){b.call(this,a,d);this.isBusy=new Observable(false);this.formItemType="AutoCompleteBoxFormItem";a?(this.minimumPrefixLength=new Observable(parseInt(c.forms.getElementText(a,"MinimumPrefixLength"))),this.minimumPopulateDelay=new Observable(parseInt(c.forms.getElementText(a,"MinimumPopulateDelay")))):(this.minimumPrefixLength=new Observable(3),this.minimumPopulateDelay=new Observable(200));f.initDataItemsFormItem(this,a,d);this.queryTaskRunner=
new f.QueryTaskRunner(this,a,d)}__extends(a,b);a.prototype.clearDataItems=function(){this.dataItems.clear()};return a}(f.TextBoxFormItem);f.AutoCompleteBoxFormItem=d})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){(function(c){var b=function(){return function(a,b){this.isValid=a;this.errorMessage=b}}();c.ValidationResult=b})(c.validation||(c.validation={}))})(c.items||(c.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(){this.fileDataBase64=this.fileName=null;this.fileSize=0;this.fileType=null}}();c.FileItem=f})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){(function(d){var b=function(a){function b(d){a.call(this,d);this.totalFileSize=parseInt(c.forms.getElementText(d,"TotalFileSize"))}__extends(b,a);b.prototype.validate=function(a){if(a instanceof c.workflow.ArgumentValueWrapper&&a.value&&a.value instanceof Array){for(var b=0,d=0;d<a.value.length;++d){var g=a.value[d];g&&g instanceof c.forms.FileItem&&(b+=g.fileSize)}if(b>this.totalFileSize)return new c.forms.items.validation.ValidationResult(false,this.message)}return new c.forms.items.validation.ValidationResult(true,
null)};return b}(d.ValidationItem);d.FileSizeValidationItem=b})(f.validation||(f.validation={}))})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){(function(d){var b=function(a){function b(d){a.call(this,d);this.minimumValue=parseFloat(c.forms.getElementText(d,"MinimumValue"));this.maximumValue=parseFloat(c.forms.getElementText(d,"MaximumValue"))}__extends(b,a);b.prototype.validate=function(a){if(a===null||a===void 0||a==="")return new c.forms.items.validation.ValidationResult(true,null);a=parseFloat(a);return a==null||isNaN(a)||a<this.minimumValue||a>this.maximumValue?new c.forms.items.validation.ValidationResult(false,
this.message):new c.forms.items.validation.ValidationResult(true,null)};return b}(d.ValidationItem);d.NumericRangeValidationItem=b})(f.validation||(f.validation={}))})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){(function(d){var b=function(a){function b(d){a.call(this,d);this.expression=c.forms.getElementText(d,"Expression");this.ignoreCase=c.forms._parseBoolean(c.forms.getElementText(d,"IgnoreCase"))}__extends(b,a);b.prototype.validate=function(a){if(a===null||a===void 0||a==="")return new c.forms.items.validation.ValidationResult(true,null);var b="",d=this.expression;this.ignoreCase&&(b+="i");this.expression=='^(?(")(".+?"@)|(([0-9a-zA-Z]((\\.(?!\\.))|[-!#\\$%&\'\\*\\+/=\\?\\^`\\{\\}\\|~\\w])*)(?<=[0-9a-zA-Z])@))(?(\\[)(\\[(\\d{1,3}\\.){3}\\d{1,3}\\])|(([0-9a-zA-Z][-\\w]*[0-9a-zA-Z]\\.)+[a-zA-Z]{2,6}))$'&&
(d="^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$");var g=null;try{g=RegExp(d,b)}catch(f){}return g!=null&&!g.test(a)?new c.forms.items.validation.ValidationResult(false,this.message):new c.forms.items.validation.ValidationResult(true,null)};return b}(d.ValidationItem);d.RegexValidationItem=b})(f.validation||(f.validation={}))})(h.items||(h.items={}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){(function(d){var b=function(a){function b(c){a.call(this,c)}__extends(b,a);b.prototype.validate=function(a){var b=true,d=null;if(a===void 0||a===null||typeof a==="string"&&dojo.trim(a)===""||a.length!==void 0&&a.length<=0||a.value&&dojo.isArray(a.value)&&a.value.length===0)b=false,d=this.message;return new c.forms.items.validation.ValidationResult(b,d)};return b}(d.ValidationItem);d.RequiredValidationItem=b})(f.validation||(f.validation={}))})(h.items||(h.items=
{}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(c){function f(c,b){var a=c.getElementsByTagName(b);if(a.length>=1)for(var g=0;g<a.length;g++){if(a[g].parentNode===c)return a[g]}else if(c.childNodes.length>0&&(a=c.childNodes[0].prefix,a!=""&&(a=c.getElementsByTagName(a+":"+b),a.length>=1)))for(g=0;g<a.length;g++)if(a[g].parentNode===c)return a[g];return null}c.getElement=f;c.getElementText=function(c,b){var a=f(c,b);return a?dojox.xml.parser.textContent(a):null};c.getAttributeValue=function(c,b){if(c!=null)for(var a=0;a<c.attributes.length;a++)if(c.attributes[a].name==
b)return c.attributes[a].value;return null};c._parseBoolean=function(c){if(c!=null)switch(c.toLowerCase()){case "true":case "yes":case "1":return true;case "false":case "no":case "0":case null:break;default:return Boolean(c)}return false};c.renderFormItem=function(){throw Error("This abstract function must be implemented by your UI system");}})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){function d(b){var a="";if(b!=null&&b.attributes!=null)for(var c=0;c<b.attributes.length;c++)if(String(b.attributes[c].nodeName).indexOf("type")>=0){b=b.attributes[c].nodeValue;a=b.indexOf(":");a>=0&&a+1<b.length&&(b=b.substr(a+1));a=b;break}return a}f._processFormItem=function(b,a){var g=null;switch(d(b)){case "AutoCompleteBoxFormItem":g=new c.forms.items.AutoCompleteBoxFormItem(b,a);break;case "CheckBoxFormItem":g=new c.forms.items.CheckBoxFormItem(b,a);break;
case "ContainerFormItem":g=new c.forms.items.ContainerFormItem(b,a);break;case "ComboBoxFormItem":g=new c.forms.items.ComboBoxFormItem(b,a);break;case "DatePickerFormItem":g=new c.forms.items.DatePickerFormItem(b,a);break;case "FilePickerFormItem":g=new c.forms.items.FilePickerFormItem(b,a);break;case "GroupBoxFormItem":g=new c.forms.items.GroupBoxFormItem(b,a);break;case "HyperlinkFormItem":g=new c.forms.items.HyperlinkFormItem(b,a);break;case "ImageFormItem":g=new c.forms.items.ImageFormItem(b,
a);break;case "ListBoxFormItem":g=new c.forms.items.ListBoxFormItem(b,a);break;case "MarkdownFormItem":g=new c.forms.items.MarkdownFormItem(b,a);break;case "RadioButtonFormItem":g=new c.forms.items.RadioButtonFormItem(b,a);break;case "TextAreaFormItem":g=new c.forms.items.TextAreaFormItem(b,a);break;case "TextBoxFormItem":g=new c.forms.items.TextBoxFormItem(b,a);break;case "TimePickerFormItem":g=new c.forms.items.TimePickerFormItem(b,a)}g.dataItems&&a!=null&&a.inputData!=null&&a.inputData.hasOwnProperty(g.itemID)&&
g.dataItems.addItems(a.inputData.item(g.itemID));return g};f._processValidationItem=function(b){var a=null;switch(d(b)){case "NumericRangeValidationItem":a=new h.items.validation.NumericRangeValidationItem(b);break;case "RequiredValidationItem":a=new h.items.validation.RequiredValidationItem(b);break;case "RegexValidationItem":a=new h.items.validation.RegexValidationItem(b);break;case "FileSizeValidationItem":a=new h.items.validation.FileSizeValidationItem(b)}return a};f._getType=d})(h.items||(h.items=
{}))})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,d){this._formManager=this.knownTypes=this.inputGeometry=this.containerFormItem=this.inputData=this.version=null;this._version=1.1;this._controlMap=this._cascadingMap=this._formContainer=null;this.knownTypes=[];this.inputData=a;this.version=this._version;this._controlMap={};this._cascadingMap={};a=null;b&&(a=dojox.xml.parser.parse(b));if(d)this.inputGeometry=d;if(a!=null){b=a.documentElement;d=c.forms.getElementText(b,"Version");if(parseFloat(d)>
this._version)throw Error("Form version "+d+" is incompatible with current API version "+this._version);this.title=new Observable(c.forms.getElementText(b,"Title"));this.maxWidth=new Observable(parseInt(c.forms.getElementText(b,"MaxWidth")));this.maxHeight=new Observable(parseInt(c.forms.getElementText(b,"MaxHeight")));a=c.forms.getElement(b,"KnownTypes");if(a!=null)for(d=0;d<a.childNodes.length;d++)this.knownTypes.push(a.childNodes[d].firstChild.data);this.containerFormItem=new c.forms.items.ContainerFormItem(c.forms.getElement(b,
"ContainerFormItem"),this)}else this.containerFormItem=new c.forms.items.ContainerFormItem(null,this),this.containerFormItem.itemID=new Observable("Group1"),this.title=new Observable(""),this.maxWidth=new Observable(NaN),this.maxHeight=new Observable(NaN);for(var f in this._cascadingMap)if(this._cascadingMap.hasOwnProperty(f))for(d=0;d<this._cascadingMap[f].length;++d)b=this._cascadingMap[f][d],this._controlMap[f].queryTaskRunner.cascadingEvent.subscribe(b.formItem,b.handler)}d.prototype.addCascading=
function(b,a,c){this._cascadingMap.hasOwnProperty(b)==false&&(this._cascadingMap[b]=[]);this._cascadingMap[b].push({formItem:a,handler:c})};d.prototype.map=function(b){this._controlMap[b.itemID.get()]=b};d.prototype.render=function(){};d.prototype.validate=function(){return this.containerFormItem.validate()};d.prototype.getResults=function(){return this.containerFormItem._getResults()};d.prototype.destroy=function(){this.containerFormItem._destroy()};d.prototype.getFormItemById=function(b){return this.containerFormItem.getFormItemById(b)};
return d}();h.FormDefinition=f})(c.forms||(c.forms={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){f.getPropertyIgnoreCase=function(c,b){for(var a in c)if(c.hasOwnProperty(a)&&a.toLowerCase()===b.toLowerCase())return a;return null};f.handleReport=function(d){function b(a){var b=null;if(t&&a)for(var c=0;c<t.length;c++){var d=t[c];if(d.Key===a.displayName||"tf_"+d.Key===a.id||d.Key===a.id){b=d;break}}return b}var a=d.getValue("MapServiceId"),g=d.getValue("LayerId"),i=d.getValue("LayerName"),h=d.getValue("ReportId"),j=null,l=d.getSite();if(l&&a&&(g||i)&&h)if(a=
f.findMapServiceById(l,a))l=null,g?l=a.findLayerById(g):i&&(l=a.findLayerByName(i)),l!=null&&(j=l.findReportById(h));if(j){var g=new esri.tasks.Query,i=new c.essentials.ReportParameters,k=d.getValue("ShowOpenReport"),h=d.getValue("Geometry"),a=d.getValue("OutSpatialReference"),l=d.getValue("Text"),m=d.getValue("Where"),n=d.getValue("OutputFormat"),o=d.getValue("Resolution"),q=d.getValue("CustomExtent"),r=d.getValue("SpatialRelationship"),s=d.getValue("ReportExtentType"),u=d.getValue("NotificationEmailAddress"),
t=d.getValue("TextFields");if(!s)s=c.essentials.ReportParameters.CURRENT_EXTENT;i.extentType=s;if(n)i.outputFormat=n;if(j.textFields)for(var v in j.textFields)j.textFields.hasOwnProperty(v)&&(n=j.textFields[v],s=b(n),s!=null?i.fields.push(new c.essentials.TextField(n.id,n.displayName,s.Value,n.multiline)):i.fields.push(n));if(u)i.notificationEmailAddress=u;if(o)i.resolution=o;if(q)i.customExtent=q;g.spatialRelationship=c.essentials.RestHelper._convertSpatialRelationshipFromDotnetIndex(r);if(h)g.geometry=
h;if(a)g.outSpatialReference=a;if(l)g.text=l;if(m)g.where=m;j.run(g,i,function(a){a=a?a.href:null;k&&a&&a.length>0&&d.dispatcher().handleOpenReportUrl(a,d);d.setValue("ResultUrl",a);d.completeActivity()},function(a){d.dispatcher().handleError(Error("Error running report '"+a.message+"'"),d)})}else d.dispatcher().handleError(Error("Cannot find report '"+h+"'"),d)};f.showDebug=function(d,b,a){var f=new c.forms.FormDefinition;f.maxHeight.set(600);f.maxWidth.set(500);var i;b?(f.title.set("Debug - Input Arguments for "+
d.getDisplayName()),f.containerFormItem.description.set("Input Arguments:"),i=d.getInputNames()):(f.title.set("Debug - Output Arguments for "+d.getDisplayName()),f.containerFormItem.description.set("Output Arguments:"),i=d.getOutputNames());if(i!=null&&i.length>0)for(var h=0;h<i.length;h++){var j=i[h],l;(l=b?d.getValue(j):d.getOutputValue(j))&&typeof l=="object"&&(l=b?d.getJsonValue(j):d.getOutputJsonValue(j));var k;!l||String(l).length<100&&String(l).indexOf("\n")==-1?k=new c.forms.items.TextBoxFormItem(null,
f):(k=new c.forms.items.TextAreaFormItem(null,f),k.textboxHeight.set(100));k.label=new c.forms.items.LabelFormItem(null,f);k.text.set(l);k.textboxWidth.set(300);k.label.text.set(j);k.readOnly.set(true);f.containerFormItem.formItems.addItem(k)}(d=d.dispatcher())&&typeof d._showDebugHandler=="function"?d._showDebugHandler(f,a):a&&a()};f.handleGetBrowserUrl=function(c){c.setValue("Url",window.location.href);c.completeActivity()};f.handleExternalDelay=function(c){var b=c.getValue("Milliseconds");if(b!=
null)setTimeout(function(){c.completeActivity()},b);else throw Error("External Delay: required Milliseconds argument was not supplied.");};f.handleGetExternalTimeInfo=function(c){c.setValue("UtcOffset",(new Date).getTimezoneOffset()*-6E4);c.completeActivity()};f.handleWaitForGeoprocessorJobComplete=function(d){var b=d.getValue("GeoprocessorUrl");d.getValue("Token");d.getValue("ProxyURL");var a=d.getValue("UpdateDelay"),f=d.getValue("JobId"),i=false;if(!b)throw Error("GeoprocessorUrl parameter is missing.");
if(!f)throw Error("JobId parameter is missing.");var h=new esri.tasks.Geoprocessor(b);a>0&&h.setUpdateDelay(a);dojo.connect(h,"onError",function(){d.setValue("Result",c.workflow.DefaultActivityHandlers._getJobStatusCode(esri.tasks.JobInfo.STATUS_FAILED));d.completeActivity()});dojo.connect(h,"onStatusUpdate",function(b){if(!i)b=b.jobStatus,b==esri.tasks.JobInfo.STATUS_CANCELLED||b==esri.tasks.JobInfo.STATUS_DELETED||b==esri.tasks.JobInfo.STATUS_FAILED||b==esri.tasks.JobInfo.STATUS_SUCCEEDED||b==esri.tasks.JobInfo.STATUS_TIMED_OUT?
(i=true,d.setValue("Result",c.workflow.DefaultActivityHandlers._getJobStatusCode(b)),d.completeActivity()):window.setTimeout(function(){h.checkJobStatus(f)},a)});h.checkJobStatus(f)};f._getJobStatusCode=function(c){switch(c){case "esriJobNew":return 0;case "esriJobSubmitted":return 1;case "esriJobWaiting":return 2;case "esriJobExecuting":return 3;case "esriJobSucceeded":return 4;case "esriJobFailed":return 5;case "esriJobTimedOut":return 6;case "esriJobCancelling":return 7;case "esriJobCancelled":return 8;
case "esriJobDeleting":return 9;case "esriJobDeleted":return 10;default:return-1}};f.handleGetLayerInfoByProperty=function(d){if(!d)throw Error("Get Map Service Info: required context was not supplied.");var b=d.getValue("PropertyName");if(b==null)throw Error("Provide a Property Name: No property name available.");var a=d.getSite();if(!a)throw Error("Set Layer Visibility: No site available.");for(var f=[],a=a.essentialsMap.mapServices,i={mapServiceUrl:"",mapServiceId:"",token:"",isVisible:false,isDynamic:false,
propertyValue:null,id:"",name:"",displayName:"",layerUrl:""},h=null,j=0;j<a.length;j++)for(var l=a[j].layers,k=0;k<l.length;k++)if(l[k].properties[b]!=void 0){i.mapServiceUrl=a[j].serviceUrl;i.mapServiceId=a[j].id;i.token=a[j].serviceToken;i.isVisible=l[k].isVisible();i.isDynamic=l[k].isDynamic;i.propertyValue=l[k].properties[b];i.id=l[k].id;i.name=l[k].name;i.displayName=l[k].displayName;i.layerUrl=a[j].mapServiceType===c.essentials.MapServiceType.FEATURE?i.mapServiceUrl:i.mapServiceUrl+"/"+(!i.isDynamic?
i.id:"dynamicLayer");if(i.isDynamic){var m=a[0].serviceLayer;if(m&&m.dynamicLayerInfos)for(var n=0;n<m.dynamicLayerInfos.length;n++)if((h=m.dynamicLayerInfos[n])&&h.id.toString()===i.id){h.source&&(i.layerSourceJson=JSON.stringify(h.source.toJson()));break}}f.push(i);i={mapServiceUrl:"",mapServiceId:"",token:"",isVisible:false,isDynamic:false,propertyValue:null,id:"",name:"",displayName:"",layerUrl:""}}d.setValue("LayersInfo",f);d.completeActivity()}})(h.DefaultActivityHandlers||(h.DefaultActivityHandlers=
{}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){c.handleAlert=function(c){c.getValue("Title");var b=c.getValue("Text");alert(b);c.completeActivity()};c.handleConfirm=function(c){var b=c.getValue("Text"),b=confirm(b);b==null&&(b=false);c.setValue("Result",b);c.completeActivity()};c.handlePrompt=function(c){var b=c.getValue("Description"),a=c.getValue("DefaultText"),b=prompt(b,a);c.setValue("Result",b);c.completeActivity()}})(c.DefaultActivityHandlers||(c.DefaultActivityHandlers={}))})(c.workflow||(c.workflow=
{}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){c.handleSetLayerProperty=function(d){var b=d.getValue("MapServiceId"),a=d.getValue("LayerId"),g=d.getValue("LayerName"),i=d.getValue("PropertyName"),h=d.getValue("Value");if(!b)throw Error("Set Layer Property: required MapServiceId argument was not supplied.");if(!a&&!g)throw Error("Set Layer Property: a LayerId or a LayerName argument must be supplied.");var j=d.getSite();if(!j)throw Error("Set Layer Property: No site available.");j=c.findMapServiceById(j,b);
if(!j||!j.serviceLayer)throw Error("Set Layer Property: Unable to find map service with ID '"+b+"'");b=null;b=a?j.findLayerById(a):j.findLayerByName(g);if(!b)throw Error("Set Layer Property: Unable to find layer with Name '"+g+"' or ID '"+a+"'.");if(a=c.getPropertyIgnoreCase(b,i))b[a]=h;else if(a=c.getPropertyIgnoreCase(b.properties,i))b.properties[a]=h;else throw Error("Set Layer Property: Layer does not support the property '"+i+"'.");d.completeActivity()};c.handleGetLayerProperty=function(d){var b=
d.getValue("MapServiceId"),a=d.getValue("LayerId"),g=d.getValue("LayerName"),i=d.getValue("PropertyName");if(!b)throw Error("Get Layer Property: required MapServiceId argument was not supplied.");if(!a&&!g)throw Error("Get Layer Property: a LayerId or a LayerName argument must be supplied.");var h=d.getSite();if(!h)throw Error("Get Layer Property: No site available.");h=c.findMapServiceById(h,b);if(!h||!h.serviceLayer)throw Error("Get Layer Property: Unable to find map service with ID '"+b+"'");b=
null;b=a?h.findLayerById(a):h.findLayerByName(g);if(!b)throw Error("Get Layer Property: Unable to find layer with Name '"+g+"' or ID '"+a+"'.");if(a=c.getPropertyIgnoreCase(b,i))d.setValue("Value",b[a]);else if(a=c.getPropertyIgnoreCase(b.properties,i))d.setValue("Value",b.properties[a]);else throw Error("Get Layer Property: Layer does not support the property '"+i+"'.");d.completeActivity()};c.handleGetLayerVisibility=function(d){var b=d.getValue("MapServiceId"),a=d.getValue("LayerId"),g=d.getValue("LayerName"),
i=d.getValue("EffectiveVisibility");if(!b)throw Error("Get Layer Visibility: required MapServiceId argument was not supplied.");if(!a&&!g)throw Error("Get Layer Visibility: a LayerId or a LayerName argument must be supplied.");var h=d.getSite();if(!h)throw Error("Get Layer Visibility: No site available.");var j=c.findMapServiceById(h,b);if(!j)throw Error("Get Layer Visibility: Unable to find map service with ID '"+b+"'");h=null;a?h=j.findLayerById(a):g&&(h=j.findLayerByName(g));if(!h)throw Error("Get Layer Visibility: Unable to find layer with ID '"+
a+"' in map service with ID '"+b+"'");b=h.isVisible();if(i&&(b=false,h.isVisible()&&j.isVisible()&&h.withinScaleRange(null))){i=j.getVisibleLayers();for(a=0;a<i.length;a++)if(i[a]==h.id){b=true;break}}d.setValue("Visible",b);d.completeActivity()};c.handleSetLayerVisibility=function(d){var b=d.getValue("MapServiceId"),a=d.getValue("LayerId"),g=d.getValue("LayerName"),i=d.getValue("Visible");if(!b)throw Error("Set Layer Visibility: required MapServiceId argument was not supplied.");if(!a&&!g)throw Error("Set Layer Visibility: a LayerId or a LayerName argument must be supplied.");
if(i===null)throw Error("Set Layer Visibility: required Visible argument was not supplied.");var h=d.getSite();if(!h)throw Error("Set Layer Visibility: No site available.");h=c.findMapServiceById(h,b);if(!h)throw Error("Set Layer Visibility: Unable to find map service with ID '"+b+"'");var j=null;if(a){if(j=h.findLayerById(a),!j)throw Error("Set Layer Visibility: Unable to find layer with ID '"+a+"' in map service with ID '"+b+"'");}else if(g){if(j=h.findLayerByName(g),!j)throw Error("Set Layer Visibility: Unable to find layer with name '"+
g+"' in map service with ID '"+b+"'");}else throw Error("Set Layer Visibility: must define layer ID or name");j.setVisibility(i);d.completeActivity()};c.handleGetLayerDefinition=function(d){var b=d.getValue("MapServiceId"),a=d.getValue("LayerId"),g=d.getValue("LayerName");if(!b)throw Error("Get Layer Definition: required MapServiceId argument was not supplied.");if(!a&&!g)throw Error("Get Layer Definition: a LayerId or a LayerName argument must be supplied.");var i=null,h=d.getSite();if(h&&(b=c.findMapServiceById(h,
b))&&b.serviceLayer){if(!a&&g)if(a=b.findLayerByName(g))a=a.id;else throw Error("Set Layer Definition: Unable to find layer with Name '"+g+"'.");b.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer?b.serviceLayer.layerDefinitions&&(i=b.serviceLayer.layerDefinitions[parseInt(a)]):b.serviceLayer instanceof esri.layers.FeatureLayer&&(i=b.serviceLayer.getDefinitionExpression())}d.setValue("Definition",i);d.completeActivity()};c.handleSetLayerDefinition=function(d){var b=d.getValue("MapServiceId"),
a=d.getValue("LayerId"),g=d.getValue("LayerName"),i=d.getValue("Definition");if(!b)throw Error("Set Layer Definition: required MapServiceId argument was not supplied.");if(!a&&!g)throw Error("Set Layer Definition: a LayerId or a LayerName argument must be supplied.");var h=d.getSite();if(!h)throw Error("Set Layer Visibility: No site available.");h=c.findMapServiceById(h,b);if(!h||!h.serviceLayer)throw Error("Set Layer Definition: Unable to find map service with ID '"+b+"'");if(!a&&g)if(a=h.findLayerByName(g))a=
a.id;else throw Error("Set Layer Definition: Unable to find layer with Name '"+g+"'.");if(h.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){g=h.serviceLayer;if(!g.layerDefinitions)g.layerDefinitions=[];g.layerDefinitions[parseInt(a)]=i;g.setLayerDefinitions(g.layerDefinitions,true)}else if(h.serviceLayer instanceof esri.layers.FeatureLayer)h.serviceLayer.setDefinitionExpression(i);else throw Error("Set Layer Definition: Map service type does not support layer definitions.");d.completeActivity()};
c.handleGetGraphicsLayerContent=function(c){var b=c.getValue("GraphicsLayerId"),a=c.getValue("GeometryType"),f=null;a!==null&&(a===0?f="extent":a===1?f="multipoint":a===2?f="point":a===3?f="polygon":a===4&&(f="polyline"));a=c.getEsriMap();if(a!=null&&a.graphicsLayerIds!=null)for(var i=0;i<a.graphicsLayerIds.length;i++)if(b==a.graphicsLayerIds[i]){b=a.getLayer(a.graphicsLayerIds[i]);if(b!=null&&b.graphics!=null){a=new esri.tasks.FeatureSet;for(i=0;i<b.graphics.length;i++){var h=b.graphics[i];if(f!==
null){if(h.geometry===null)continue;if(f!==h.geometry.type)continue}h=new esri.Graphic(h.geometry,null,h.attributes,null);a.features.push(h)}c.setValue("Features",a)}break}c.completeActivity()};c.handleUpdateGraphicsLayer=function(d){var b=d.getValue("GraphicsLayerId"),a=!!d.getValue("RemoveAllFeatures"),g=d.getValue("FeatureSet"),i=d.getValue("RendererJson"),h=d.getEsriMap();if(h==null)throw Error("Update Graphics Layer: No map available.");var j=false,l=c.findMapServiceByMap(h,b);if(l){if(!(l instanceof
esri.layers.GraphicsLayer))throw Error("Update Graphics Layer: The layer '"+b+"' is not a GraphicsLayer");}else l=new esri.layers.GraphicsLayer({id:b}),j=true;try{l.suspend();a&&l.clear();if(g&&g.features)for(var k=g.features.length-1;k>=0;--k)l.add(g.features[k]);if(i)l.renderer=esri.renderer.fromJson(JSON.parse(i));j&&h.addLayer(l)}finally{l.resume()}d.completeActivity()}})(c.DefaultActivityHandlers||(c.DefaultActivityHandlers={}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){function d(a,b){return b&&a&&a.essentialsMap&&a.essentialsMap.mapServices?c.essentials.utilities.SiteResourceIdComparer.lookUp(a.essentialsMap.mapServices,b):null}function b(a,b){if(!a||!b)return null;if(a.layerIds!=null)for(var d=0;d<a.layerIds.length;d++){var f=a.getLayer(a.layerIds[d]);if(f!=null&&c.essentials.utilities.SiteResourceIdComparer.equals(f.id,b))return f}if(a.graphicsLayerIds!=null)for(d=0;d<a.graphicsLayerIds.length;d++)if(f=a.getLayer(a.graphicsLayerIds[d]),
f!=null&&c.essentials.utilities.SiteResourceIdComparer.equals(f.id,b))return f;return null}f.findMapServiceById=d;f.findMapServiceByMap=b;f.handleRemoveMapService=function(a){var c=a.getValue("MapServiceId"),d=a.getEsriMap();if(d==null)throw Error("Remove Map Service: No map available.");if(c=b(d,c))d.removeLayer(c),(d=a.getSite())&&d.essentialsMap&&d.essentialsMap.mapServices&&d.essentialsMap.removeServiceLayer(c);a.completeActivity()};f.handleSetImageServiceInfo=function(a){var c=a.getValue("ImageServiceId"),
d=a.getValue("BandIds"),f=a.getValue("MosaicRule"),h=a.getValue("RenderingRule"),l=a.getEsriMap();if(l==null)throw Error("Set Image Service Info: No map available.");require(["esri/layers/RasterFunction"],function(){var k=b(l,c);if(k instanceof esri.layers.ArcGISImageServiceLayer){d&&k.setBandIds(d,true);if(f){var m=new esri.layers.MosaicRule(f);if(!m.method)m=k.defaultMosaicRule;k.setMosaicRule(m,true)}h&&(m=new esri.layers.RasterFunction(h),m.functionName||(m=null),k.setRenderingRule(m,true));k.refresh()}a.completeActivity()})};
f.handleSetMapServiceVisibility=function(a){var c=a.getValue("MapServiceId"),f=a.getValue("Visible");if(c==null)throw Error("Set Map Service Visibility: required MapServiceId argument was not supplied.");if(f==null)throw Error("Set Map Service Visibility: required Visible argument was not supplied.");var h=a.getEsriMap(),j=a.getSite();if(h==null)throw Error("Set Map Service Visibility: No map available.");var l=null,l=b(h,c);if(l==null)throw Error("Set Map Service Visibility: Unable to find map service with ID '"+
c+"'");l.setVisibility(f);a.completeActivity();j&&c&&(a=d(j,c),dojo.publish("MapServiceVisibilityChangedEvent",a))};f.handleGetMapServiceInfo=function(a){if(!a)throw Error("Get Map Service Info: required context was not supplied.");var c=a.getValue("MapServiceId"),f=a.getValue("LayerName");if(c==null)throw Error("Get Map Service Info: required MapServiceId argument was not supplied.");var h=null,j=null,l=null,k=null,m=false,n=a.getEsriMap();if(n==null)throw Error("Get Map Service Info: No map available.");
var o=a.getSite(),q=null;if(o!=null&&o.essentialsMap!=null&&(o=d(o,c),o!=null))q=o.serviceLayer,h=o.serviceUrl,j=o.findServiceToken(),m=o.isVisible();if(q==null&&(q=b(n,c)))if(h=q.url,typeof q.visible==="boolean")m=q.visible;if(f!=null){c=false;if(q.supportsDynamicLayers&&q.dynamicLayerInfos){n=q.dynamicLayerInfos;for(o=0;o<n.length;o++){var r=n[o];if(r.name===f||r.id===f){c=true;l="dynamicLayer";k=r.source;break}}}if(!c&&q.layerInfos){n=q.layerInfos;for(o=0;o<n.length;o++)if(r=n[o],r!=null&&r.id!=
null&&r.name==f){l=r.id;break}}}a.setValue("MapServiceUrl",h);a.setValue("Token",j);a.setValue("LayerId",l);a.setValue("Source",k);a.setValue("Visible",m);a.completeActivity()};f.handleSetMapServiceProperty=function(a){var c=a.getValue("MapServiceId"),f=a.getValue("PropertyName"),h=a.getValue("Value");if(!c)throw Error("{0}: required MapServiceId argument was not supplied.".format("Set Map Service Property"));if(!f)throw Error("{0}: required PropertyName argument was not supplied.".format("Set Map Service Property"));
var j=a.getEsriMap();if(!j)throw Error("{0}: no map available.".format("Set Map Service Property"));j=b(j,c);if(!j)throw Error("{0}: unable to find map service with ID '{1}'.".format("Set Map Service Property",c));if(f.toLowerCase()==="gdbversion")if(j instanceof esri.layers.FeatureLayer){if(!j.isDataVersioned)throw Error("{0}: map service with ID '{1}' is not versioned.".format("Set Map Service Property",c));j.setGDBVersion(h)}else if(j instanceof esri.layers.ArcGISDynamicMapServiceLayer){f=a.getSite();
if(!f)throw Error("{0}: no site available.".format("Set Map Service Property"));f=d(f,c);if(!f)throw Error("{0}: unable to find map service with ID '{1}'.".format("Set Map Service Property",c));if(!f.supportsDynamicLayers)throw Error("{0}: map service with ID '{1}' is not versioned.".format("Set Map Service Property",c));f.convertToDynamicLayers();var c=f.serviceLayer,l;for(l in c.dynamicLayerInfos)if(l.source instanceof esri.layers.LayerMapSource)l.source.gdbVersion=h}else throw Error("{0}: map service with ID '{1}' does not support GDB version.".format("Set Map Service Property",
c));else if(f.toLowerCase()==="visible")j.setVisibility(h);else{f="set"+f.toLowerCase();l=null;for(var k in j)if(k.toLowerCase()===f){l=k;break}if(!l)throw Error("{0}: map service property '{1}' does not exist.".format("Set Map Service Property",f));j[l](h)}a.completeActivity()}})(h.DefaultActivityHandlers||(h.DefaultActivityHandlers={}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){c.handleGetCurrentPosition=function(c){if(navigator.geolocation){var b={enableHighAccuracy:c.getValue("EnableHighAccuracy"),timeout:c.getValue("Timeout")||2E4,maximumAge:c.getValue("MaximumAge")};navigator.geolocation.getCurrentPosition(function(a){c.setValue("Latitude",a.coords.latitude);c.setValue("Longitude",a.coords.longitude);c.setValue("Altitude",a.coords.altitude);c.setValue("Accuracy",a.coords.accuracy);c.setValue("AltitudeAccuracy",a.coords.altitudeAccuracy);
c.setValue("Heading",a.coords.heading);c.setValue("Speed",a.coords.speed);c.setValue("Timestamp",a.timestamp);c.completeActivity()},function(a){c.setValue("ErrorCode",a.code);c.setValue("ErrorMessage",a.message);c.completeActivity()},b)}else c.setValue("ErrorCode",2),c.setValue("ErrorMessage","Geolocation is not supported."),c.completeActivity()};c.handleGetPhoto=function(c){if(navigator.camera){var b={quality:c.getValue("Quality"),destinationType:c.getValue("DestinationType"),sourceType:c.getValue("SourceType"),
allowEdit:c.getValue("AllowEdit"),encodingType:c.getValue("EncodingType"),targetWidth:c.getValue("TargetWidth"),targetHeight:c.getValue("TargetHeight")};navigator.camera.getPicture(function(a){c.setValue("ImageData",a);c.completeActivity()},function(a){c.setValue("Message",a);c.completeActivity()},b)}else c.setValue("Message","camera is not supported."),c.completeActivity()}})(c.DefaultActivityHandlers||(c.DefaultActivityHandlers={}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a){this._mapService=null;this._mapService=b;if(this._mapService.mapServiceType!=c.essentials.MapServiceType.WMS&&this._mapService.mapServiceType!=c.essentials.MapServiceType.DYNAMIC)throw Error("LayerVisibilityEventManager: Only Dynamic and WMS Layer types supported.");var d=this;dojo.require("dojo.aspect");dojo.aspect.before(a,"setVisibleLayers",function(a,b){return d.beforeESRIsetVisibleLayers(a,b)});dojo.aspect.after(a,"setVisibleLayers",
function(a,b,c){d.afterESRIsetVisibleLayers(a,b,c)},true)}d.prototype.beforeESRIsetVisibleLayers=function(b,a){var d=[],f=[];a===void 0&&(a=false);if(b.InternallyChangedLayer)return f=b.InternallyChangedLayer,f.mapServiceId!=void 0&&f.layerId!=void 0&&f.visibility!=void 0&&d.push(f),d=[b,a,d];if(this._mapService.mapServiceType==c.essentials.MapServiceType.DYNAMIC)f=dojo.clone(b);else if(this._mapService.mapServiceType==c.essentials.MapServiceType.WMS)for(var h=0;b&&h<b.length;h++){var j=this._findWmsLayerIdFromName(b[h]);
if(j&&j!==null)f.push(j.toString());else return d=[b,a,d]}if(b&&this._mapService.mapServiceType==c.essentials.MapServiceType.DYNAMIC&&b.length===1&&b[0]=="-1"){for(f=0;f<this._mapService.layers.length;f++)j=this._mapService.layers[f].id,d.push({mapServiceId:this._mapService.id,layerId:j.toString(),visibility:false}),this._mapService.findLayerById(j)._syncProgramaticallyChangedLayerVisibility(false);return d=[b,a,d]}if(b&&b.length===0||this._mapService.mapServiceType==c.essentials.MapServiceType.DYNAMIC&&
b.length===1&&b[0]==="")f=this._mapService.getDefaultVisibleLayers();for(var l=this._getAllCurrentlyVisibleLayers(),k=0;l&&k<l.length;k++)if(j=l[k],f&&f.indexOf(j.toString())<0&&(h=this._mapService.findLayerById(j)))d.push({mapServiceId:this._mapService.id,layerId:j.toString(),visibility:false}),h._syncProgramaticallyChangedLayerVisibility(false);j=this._mapService.getVisibleLayers();if(f&&f.length>0)for(l=0;l<f.length;l++)if(this._mapService.mapServiceType==c.essentials.MapServiceType.DYNAMIC&&isNaN(parseInt(f[l]))&&
(f[l]="0"),j&&j.indexOf(f[l].toString())<0&&(h=this._mapService.findLayerById(f[l])))h.subLayerIds&&h.subLayerIds.length>0&&(this._deleteItemWithId(f[l],d),this._recursivelyUpdateSublayerVisibility(h,true,d)),d.push({mapServiceId:this._mapService.id,layerId:f[l].toString(),visibility:true}),h._syncProgramaticallyChangedLayerVisibility(true),h.parentLayerId&&h.parentLayerId!==null&&h.parentLayerId!==void 0&&this._recursivelyUpdateAncestorVisibility(h,f,d);return d=[b,a,d]};d.prototype.afterESRIsetVisibleLayers=
function(b,a,c){c&&c.length>0&&dojo.publish("LayerVisibilityChange",Array(c))};d.prototype._recursivelyUpdateAncestorVisibility=function(b,a,c){if(b&&b.parentLayerId&&b.parentLayerId!==null&&b.parentLayerId!==void 0){var d=this._mapService.findLayerById(b.parentLayerId);d.isVisible()||(this._deleteItemWithId(b.parentLayerId,c),d._syncProgramaticallyChangedLayerVisibility(true),c.push({mapServiceId:this._mapService.id,layerId:b.parentLayerId.toString(),visibility:true}));this._recursivelyUpdateAncestorVisibility(d,
a,c)}};d.prototype._recursivelyUpdateSublayerVisibility=function(b,a,c){if(b.subLayerIds&&b.subLayerIds.length>0)for(var d=0;d<b.subLayerIds.length;d++){var f=this._mapService.findLayerById(b.subLayerIds[d]),h=f.id;f._syncProgramaticallyChangedLayerVisibility(a);this._deleteItemWithId(h,c);c.push({mapServiceId:this._mapService.id,layerId:h.toString(),visibility:a});f.subLayerIds&&f.subLayerIds.length>0&&this._recursivelyUpdateSublayerVisibility(f,a,c)}};d.prototype._getAllCurrentlyVisibleLayers=function(){for(var b=
[],a=0;a<this._mapService.layers.length;a++){var c=this._mapService.layers[a];c.isVisible()&&b.push(c.id.toString())}return b};d.prototype._findWmsLayerIdFromName=function(b){for(var a=0;a<this._mapService.layers.length;a++){var c=this._mapService.layers[a];if(b==c.wmsLayerName)return c.id}return null};d.prototype._deleteItemWithId=function(b,a){for(var c=0;c<a.length;c++)a[c].layerId==b&&a.splice(c,1)};return d}();h.LayerVisibilityEventManager=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex=
{}));(function(c){c=c.essentials||(c.essentials={});c=c.MapServiceType||(c.MapServiceType={});c.DYNAMIC="Dynamic";c.TILED="Tiled";c.IMAGE="Image";c.BING="Bing";c.FEATURE="Feature";c.WMS="WMS";c.WMTS="WMTS";c.GEORSS="GeoRss";c.WEBTILED="WebTiled";c.KML="Kml";c.GRAPHICS="Graphics";c.LABEL="Label";c.STREAM="Stream";c.CSV="Csv";c.MAPIMAGE="MapImage";c.UNKNOWN="Unknown"})(geocortex||(geocortex={}));
(function(c){c=c.essentials||(c.essentials={});c=c.MapServiceFunction||(c.MapServiceFunction={});c.OPERATIONAL="Operational";c.BASE="Base"})(geocortex||(geocortex={}));(function(c){c=c.essentials||(c.essentials={});c=c.DrawingBehavior||(c.DrawingBehavior={});c.MAP_SERVICE="MapService";c.FEATURE_LAYER="FeatureLayer";c.GEORSS_LAYER="GeoRssLayer";c.KML_SERVICE="KmlService";c.GeoRSS_LAYER=c.GEORSS_LAYER})(geocortex||(geocortex={}));
(function(c){c=c.essentials||(c.essentials={});c=c.FailureAction||(c.FailureAction={});c.IGNORE="Ignore";c.WARN="Warn";c.ERROR="Error"})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,c){this.layerThemesInfo=b;this._configureLayerTheme(typeof a==="object"?a:null,a,c)}d.prototype._configureLayerTheme=function(b,a,d){this.id=b?b.id:a;this.isDefaultTheme=this.id===null;this.isActive=false;this.displayName=b?b.displayName:d;this.extensions=c._getExtensions(b?b.extensions:null);this.properties=b?b.properties:null};d.prototype.applyToMap=function(){var b=this;if(this.layerThemesInfo==void 0)throw Error("Could not apply theme '{0}' to the map because the LayerThemesInfo property is not set on this LayerTheme.".format(this.displayName));
var a=this.layerThemesInfo,d=a.map;if(d==void 0)throw Error("Failed to apply theme '{0}' to map because the Map property is not set on the LayerThemesInfo object.".format(this.displayName));this.isActive=true;if(a.activeTheme&&a.activeTheme!==this||!a.activeTheme){if(a.activeTheme)a.previousTheme=a.activeTheme,a.previousTheme.isActive=false;a.activeTheme=this}a.themeChangeInProgress=true;a.layerThemeChangingEvent({currTheme:a.activeTheme,prevTheme:a.previousTheme});for(var f=function(a,b){b===void 0&&
(b=false);a.setInActiveTheme(true);j(a,a.configuredVisible,b)},h=function(a,c){c===void 0&&(c=false);var d=a.getLayerThemeSettings(b.id);a.setInActiveTheme(d!=null);var f=false;d!=null&&(f=d.visible!=void 0?d.visible:a.configuredVisible);j(a,f,c)},j=function(a,b,d){d===void 0&&(d=false);if(a instanceof c.essentials.Layer)if(a.mapService.supportsLayerVisibility())a.mapService.essentialsMap.site.getEssentialsVersion()>=4.02&&a.type===c.essentials.LayerType.GROUP_LAYER&&(b=true);else if(a.mapService.layers.length!==
1||!a.inActiveTheme||a.mapService.includeInLayerList)return;a.isUserCreated||a.setVisibility(b,d)},l=0;l<d.mapServices.length;l++){var k=d.mapServices[l],m=k.supportsLayerVisibility();this.isDefaultTheme?f(k):h(k);for(var n=0;n<k.layers.length;n++){var o=k.layers[n];this.isDefaultTheme?f(o,m):h(o,m)}m&&k.refresh()}d.refreshFilteredCollections();a.themeChangeInProgress=false;a.layerThemeChangedEvent({currTheme:a.activeTheme,prevTheme:a.previousTheme})};return d}();h.LayerTheme=f})(c.essentials||(c.essentials=
{}))})(geocortex||(geocortex={}));(function(c){(function(c){var f=function(){return function(c,b){this.theme=c;this.visible=b}}();c.LayerThemeSetting=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(){function c(b){this.layerThemeChangedEvent=function(){};this.themeChangeInProgress=false;this.layerThemeChangingEvent=function(){};this.allowDefault=this.layerThemesConfigured=false;this.themes=[];this.map=b}c.prototype.applyTheme=function(b){this.layerThemesConfigured&&(b=this.getTheme(b))&&b.applyToMap()};c.prototype.getTheme=function(b,a){a===void 0&&(a=false);if(this.layerThemesConfigured)for(var c=0;c<this.themes.length;c++){if(this.themes[c].id===b)return this.themes[c];
if(a&&this.themes[c].displayName.toLowerCase()===b.toLowerCase())return this.themes[c]}return null};return c}();c.LayerThemesInfo=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){var f=function(c){function b(){c.apply(this,arguments);this.mapSpatialReference=this.serviceLayer=this.updateInterval=null}__extends(b,c);b.prototype._configureObject=function(a,b){if(a===void 0)throw Error("Incorrect map service object returned from initialization");this.updateInterval=a.updateInterval;c.prototype._configureObject.call(this,a,b)};b.prototype._createServiceLayer=function(){var a=this;if(this.essentialsMap)this.mapSpatialReference=this.essentialsMap.initialExtent.spatialReference;
var b={id:this.id,outSR:this.mapSpatialReference};this.serviceLayer=new esri.layers.KMLLayer(this.serviceUrl,b);this._initiallyVisible?this.serviceLayer.show():this.serviceLayer.hide();this.serviceLayer._options=b;if(this.attributionDataUrl&&this.attributionDataUrl!=="")this.serviceLayer.attributionDataUrl=this.attributionDataUrl,this.serviceLayer.hasAttributionData=true;else if(this.hasAttributionData)this.serviceLayer.attributionDataUrl=this.url+"/Attribution",this.serviceLayer.hasAttributionData=
true;var c=this.serviceLayer.on("load",function(){c.remove();a.serviceLayer.setOpacity(a.configuredOpacity);a._initializeKmlLayers()});this.serviceLayer.on("error",function(b){return a._layerLoadErrorHandler(b)});this.serviceLayer.setOpacity(this.configuredOpacity);this.updateInterval&&!isNaN(this.updateInterval)&&this.serviceLayer.setRefreshInterval(this.updateInterval)};b.prototype._updateStartHandler=function(){this._initializeKmlLayers()};b.prototype._initializeKmlLayers=function(){for(var a=
this.serviceLayer.getLayers(),b=0;b<a.length;b++)if(a[b]instanceof esri.layers.FeatureLayer){var c=a[b];c.layerId=+this.id;c.name=this.displayName;c.displayField="name";a[b].spatialReference=this.mapSpatialReference}};return b}(c.MapService);c.KmlService=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(c){(function(c){var d={};c.handleGetExternalValue=function(b){var a=b.getValue("Key");a!=null&&(a=d[a],a===void 0&&(a=null),b.setValue("Value",a));b.completeActivity()};c.handleSetExternalValue=function(b){var a=b.getValue("Key"),c=b.getValue("Value");a!=null&&(d[a]=c);b.completeActivity()}})(c.CacheActivityHandlers||(c.CacheActivityHandlers={}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,c,d,f,h,l){this.isBusy=false;this._drawObjectContext=null;this._registeredActivityHandlers={};this._registeredExternalIdHandlers={};this.handleOpenReportUrlFunction=this.handleUnhandledActivityErrorFunction=null;this.defaultFormContainerId="form-container-outer";this.defaultFormContentId="form-container";this._handleErrorFunction=b||null;this._activityBeginFunction=a||null;this._activityCompleteFunction=c||null;this._workflowAbortFunction=
f||null;this._workflowCompleteFunction=d||null;this._webRequestBeginFunction=h||null;this._webRequestCompleteFunction=l||null;this.registerDefaultHandlers()}d.prototype.registerDefaultHandlers=function(){this.registerActivityHandler("Geocortex.Workflow.Activities.Alert",c.workflow.DefaultActivityHandlers.handleAlert);this.registerActivityHandler("Geocortex.Workflow.Activities.CaptureGeometry",c.workflow.DefaultActivityHandlers.handleCaptureGeometry);this.registerActivityHandler("Geocortex.Workflow.Activities.Confirm",
c.workflow.DefaultActivityHandlers.handleConfirm);this.registerActivityHandler("Geocortex.Workflow.Activities.ExportMap",c.workflow.DefaultActivityHandlers.handleExportMap);this.registerActivityHandler("Geocortex.Workflow.Activities.ExternalDelay",c.workflow.DefaultActivityHandlers.handleExternalDelay);this.registerActivityHandler("Geocortex.Workflow.Activities.GetBrowserUrl",c.workflow.DefaultActivityHandlers.handleGetBrowserUrl);this.registerActivityHandler("Geocortex.Workflow.Activities.GetCurrentPosition",
c.workflow.DefaultActivityHandlers.handleGetCurrentPosition);this.registerActivityHandler("Geocortex.Workflow.Activities.GetExternalTimeInfo",c.workflow.DefaultActivityHandlers.handleGetExternalTimeInfo);this.registerActivityHandler("Geocortex.Workflow.Activities.GetExternalValue",c.workflow.CacheActivityHandlers.handleGetExternalValue);this.registerActivityHandler("Geocortex.Workflow.Activities.GetGraphicsLayerContent",c.workflow.DefaultActivityHandlers.handleGetGraphicsLayerContent);this.registerActivityHandler("Geocortex.Workflow.Activities.GetLayerDefinition",
c.workflow.DefaultActivityHandlers.handleGetLayerDefinition);this.registerActivityHandler("Geocortex.Workflow.Activities.GetLayerInfoByProperty",c.workflow.DefaultActivityHandlers.handleGetLayerInfoByProperty);this.registerActivityHandler("Geocortex.Workflow.Activities.GetLayerProperty",c.workflow.DefaultActivityHandlers.handleGetLayerProperty);this.registerActivityHandler("Geocortex.Workflow.Activities.GetLayerVisibility",c.workflow.DefaultActivityHandlers.handleGetLayerVisibility);this.registerActivityHandler("Geocortex.Workflow.Activities.GetMapExtent",
c.workflow.DefaultActivityHandlers.handleGetMapExtent);this.registerActivityHandler("Geocortex.Workflow.Activities.GetMapInfo",c.workflow.DefaultActivityHandlers.handleGetMapInfo);this.registerActivityHandler("Geocortex.Workflow.Activities.GetMapServiceInfo",c.workflow.DefaultActivityHandlers.handleGetMapServiceInfo);this.registerActivityHandler("Geocortex.Workflow.Activities.GetPhoto",c.workflow.DefaultActivityHandlers.handleGetPhoto);this.registerActivityHandler("Geocortex.Workflow.Activities.PrintMap",
c.workflow.DefaultActivityHandlers.handlePrintMap);this.registerActivityHandler("Geocortex.Workflow.Activities.Prompt",c.workflow.DefaultActivityHandlers.handlePrompt);this.registerActivityHandler("Geocortex.Workflow.Activities.RefreshMap",c.workflow.DefaultActivityHandlers.handleRefreshMap);this.registerActivityHandler("Geocortex.Workflow.Activities.RemoveMapService",c.workflow.DefaultActivityHandlers.handleRemoveMapService);this.registerActivityHandler("Geocortex.Workflow.Activities.Report",c.workflow.DefaultActivityHandlers.handleReport);
this.registerActivityHandler("Geocortex.Workflow.Activities.SetExternalValue",c.workflow.CacheActivityHandlers.handleSetExternalValue);this.registerActivityHandler("Geocortex.Workflow.Activities.SetLayerDefinition",c.workflow.DefaultActivityHandlers.handleSetLayerDefinition);this.registerActivityHandler("Geocortex.Workflow.Activities.SetLayerProperty",c.workflow.DefaultActivityHandlers.handleSetLayerProperty);this.registerActivityHandler("Geocortex.Workflow.Activities.SetLayerVisibility",c.workflow.DefaultActivityHandlers.handleSetLayerVisibility);
this.registerActivityHandler("Geocortex.Workflow.Activities.SetMapExtent",c.workflow.DefaultActivityHandlers.handleSetMapExtent);this.registerActivityHandler("Geocortex.Workflow.Activities.SetMapServiceVisibility",c.workflow.DefaultActivityHandlers.handleSetMapServiceVisibility);this.registerActivityHandler("Geocortex.Workflow.Activities.UpdateGraphicsLayer",c.workflow.DefaultActivityHandlers.handleUpdateGraphicsLayer);this.registerActivityHandler("Geocortex.Workflow.Activities.WaitForGeoprocessorJobComplete",
c.workflow.DefaultActivityHandlers.handleWaitForGeoprocessorJobComplete);this.registerActivityHandler("Geocortex.Workflow.Activities.SetImageServiceInfo",c.workflow.DefaultActivityHandlers.handleSetImageServiceInfo);this.registerActivityHandler("Geocortex.Workflow.Activities.SetMapServiceProperty",c.workflow.DefaultActivityHandlers.handleSetMapServiceProperty);this.registerExternalIdHandler("IntersectLayers",c.workflow.DefaultActivityHandlers.handleIntersectLayers);this.registerExternalIdHandler("GetPhoto",
c.workflow.DefaultActivityHandlers.handleGetPhoto)};d.prototype.canHandleActivity=function(b){b||this.handleError(Error("Null ActivityContext passed to canHandleActivity."),b);if(b.getActivityExternalId()!=null&&this._registeredExternalIdHandlers[b.getActivityExternalId()]!=null)return true;b=b.getActivityTypeName();return b!=null&&this._registeredActivityHandlers[b]?true:false};d.prototype.registerExternalIdHandler=function(b,a){b==null||a==null?this.handleError(Error("Null externalId or handler passed to registerExternalIdHandler."),
null):this._registeredExternalIdHandlers[b]=a};d.prototype.registerActivityHandler=function(b,a){b==null||a==null?this.handleError(Error("Null activityTypeName or handler passed to registerActivityHandler."),null):this._registeredActivityHandlers[b]=a};d.prototype.dispatch=function(b){if(b==null)this.handleError(Error("Null ActivityContext passed to dispatch."),b);else{var a=b.getActivityTypeName(),c=b.getActivityExternalId();this.canHandleActivity(b)?(c!=null&&this._registeredExternalIdHandlers[c]!=
null&&(c=this._registeredExternalIdHandlers[c],c(b,this)),a!=null&&this._registeredActivityHandlers[a]&&(c=this._registeredActivityHandlers[a],c(b,this))):this.handleUnhandledActivityErrorFunction(Error("Unknown activity type '"+a+"' or external ID '"+c+"' encountered."),b)}};d.prototype.handleError=function(b,a){this._handleErrorFunction!=null&&this._handleErrorFunction(b,a)};d.prototype.handleUnhandledActivityError=function(b,a){this.handleUnhandledActivityErrorFunction!=null?this.handleUnhandledActivityErrorFunction(b,
a):this.handleError(b,a)};d.prototype.handleOpenReportUrl=function(b,a){this.handleOpenReportUrlFunction!=null?this.handleOpenReportUrlFunction(b,a):window.open(b)};d.prototype.webRequestBegin=function(b,a){this._webRequestBeginFunction!=null&&this._webRequestBeginFunction(b,a)};d.prototype.webRequestComplete=function(b,a){this._webRequestCompleteFunction!=null&&this._webRequestCompleteFunction(b,a)};d.prototype.abortMapBasedActivity=function(){if(this._drawObjectContext){if(!this._drawObjectContext.toolbar||
!this._drawObjectContext.drawEvent||!this._drawObjectContext.activityContext)return false;this._drawObjectContext.toolbar.deactivate();dojo.disconnect(this._drawObjectContext.drawEvent);this._drawObjectContext.activityContext.abortActivity();this._drawObjectContext=null}return true};d.prototype.setDrawObjectContext=function(b){this._drawObjectContext=b};d.prototype.activityBegin=function(b){this._activityBeginFunction!=null&&this._activityBeginFunction(b)};d.prototype.activityComplete=function(b){this._activityCompleteFunction!=
null&&this._activityCompleteFunction(b)};d.prototype.activityAbort=function(b){this.workflowAbort(b,b.workflow())};d.prototype.workflowComplete=function(b,a){this._workflowCompleteFunction!=null&&this._workflowCompleteFunction(b,a)};d.prototype.workflowAbort=function(b,a){this._workflowAbortFunction!=null&&this._workflowAbortFunction(b,a)};return d}();h.DefaultActivityDispatcher=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(b,a,d,f,h,j,l,k){this._defaultActivityDispatcher=new c.workflow.DefaultActivityDispatcher;this.isBusy=this._drawObjectContext=null;this._dispatchFunction=b||null;this._handleErrorFunction=a||null;this._activityBeginFunction=d||null;this._activityCompleteFunction=f||null;this._workflowCompleteFunction=h||null;this._workflowAbortFunction=j||null;this._webRequestBeginFunction=l||null;this._webRequestCompleteFunction=k||null}d.prototype.dispatch=function(b){this._defaultActivityDispatcher.canHandleActivity(b)?
this._defaultActivityDispatcher.dispatch(b):this._dispatchFunction!=null&&this._dispatchFunction(b)};d.prototype.handleError=function(b,a){this._handleErrorFunction!=null&&this._handleErrorFunction(b,a)};d.prototype.abortMapBasedActivity=function(){if(this._drawObjectContext){if(!this._drawObjectContext.toolbar||!this._drawObjectContext.drawEvent||!this._drawObjectContext.activityContext)return false;this._drawObjectContext.toolbar.deactivate();dojo.disconnect(this._drawObjectContext.drawEvent);this._drawObjectContext.activityContext.abortActivity();
this._drawObjectContext=null}return true};d.prototype.setDrawObjectContext=function(b){this._drawObjectContext=b};d.prototype.activityBegin=function(b){this._activityBeginFunction!=null&&this._activityBeginFunction(b)};d.prototype.activityComplete=function(b){this._activityCompleteFunction!=null&&this._activityCompleteFunction(b)};d.prototype.activityAbort=function(b){this.workflowAbort(b,b.workflow())};d.prototype.webRequestBegin=function(b,a){this._webRequestBeginFunction!=null&&this._webRequestBeginFunction(b,
a)};d.prototype.webRequestComplete=function(b,a){this._webRequestCompleteFunction!=null&&this._webRequestCompleteFunction(b,a)};d.prototype.workflowComplete=function(b,a){this._workflowCompleteFunction!=null&&this._workflowCompleteFunction(b,a)};d.prototype.workflowAbort=function(b,a){this._workflowAbortFunction!=null&&this._workflowAbortFunction(b,a)};d.prototype.handleOpenReportUrl=function(b){window.open(b)};return d}();h.SimpleActivityDispatcher=f})(c.workflow||(c.workflow={}))})(geocortex||(geocortex=
{}));
(function(c){(function(h){(function(f){f._pickSupported=function(c,b){if(!c||c.length<=0)return null;if(b)for(var a=b.toUpperCase(),f=0;f<c.length;f++){var h=c[f];if(h&&h.toUpperCase()===a)return c[f]}return c[0]};f.handleIntersectLayers=function(d){var b=[],a=[],f=[],h=[],p=null,j=p=null,l=null,l=null,k=false,j=null,m,n;m=-1;var o=d.getValue("InputLayers");if(o&&o.length>0)for(p=0;p<o.length;p++)m=o[p].lastIndexOf("\\\\"),m>=0&&(o[p]=o[p].substring(m+2));else d.dispatcher().handleError(Error("Intersect Layers: no input layers provided."),d);
(p=d.getSite())||d.dispatcher().handleError(Error("Intersect Layers: no site available."),d);(p=p.essentialsMap)||d.dispatcher().handleError(Error("Intersect Layers: no map available."),d);(!p.mapServices||p.mapServices.length<=0)&&d.dispatcher().handleError(Error("Intersect Layers: no map service is configured for the map."),d);for(m=0;m<p.mapServices.length;m++){j=p.mapServices[m];l=j.layers;n=k=0;for(j=[];k<l.length&&n<o.length;)l[k].name<o[n]?k++:(l[k].name>o[n]||(j.push(l[k]),k++),n++);for(n=
0;n<j.length;n++){l=j[n];k=false;switch(l.type){case c.essentials.LayerType.FEATURE_LAYER:a.push(l.name);k=true;break;case c.essentials.LayerType.GROUP_LAYER:f.push(l.name);k=true;break;case c.essentials.LayerType.RASTER_LAYER:h.push(l.name),k=true}k&&b.push(l.name)}}d.setValue("OutputLayers",b);d.setValue("FeatureLayers",a);d.setValue("GroupLayers",f);d.setValue("RasterLayers",h);d.completeActivity()};f.handleExportMap=function(d){var b=d.getValue("TargetSpatialReference"),a=d.getValue("CustomExtent"),
f=d.getValue("Resolution"),h=d.getValue("OutputFormat"),p=d.getValue("Scale"),j=d.getValue("ImageHeight"),l=d.getValue("ImageWidth"),k=d.getValue("UseTransparentBackground"),m=null,n=null,o=m=null;(m=d.getSite())||d.dispatcher().handleError(Error("Export Map: no site available."),d);(n=m.getMap())||d.dispatcher().handleError(Error("Export Map: no map available."),d);(m=m.essentialsMap)||d.dispatcher().handleError(Error("Export Map: no map available."),d);o=new c.essentials.ReportParameters;o.outputFormat=
c.workflow.MapActivityHandlers._pickSupported(m.supportedExportFormats,h);if(f)o.resolution=new c.essentials.Resolution("",f);if(p)o.scale=new c.essentials.Scale("",p);o.imageHeight=j?j:n.height;o.imageWidth=l?l:n.width;if(a)o.customExtent=a;o.extentType=a?c.essentials.ReportParameters.CUSTOM_EXTENT:c.essentials.ReportParameters.CURRENT_EXTENT;o.useTransparentBackground=k;if(b)o.targetSpatialReference=b;n&&o.populateMapGraphicsLayers(n);m.exportMap(o,function(a){d.setValue("ResultUrl",a?a.href:null);
d.completeActivity()},function(a){d.dispatcher().handleError(Error("Error exporting map '"+a.message+"'"),d)})};f.handlePrintMap=function(d){var b=d.getValue("TargetSpatialReference"),a=d.getValue("TextFields"),f=d.getValue("CustomExtent"),h=d.getValue("NotificationEmailAddress"),p=d.getValue("Resolution"),j=d.getValue("OutputFormat"),l=d.getValue("Scale"),k=d.getValue("PrintTemplateId"),m=d.getValue("GridId"),n=null,o=null;(n=d.getSite())||d.dispatcher().handleError(Error("Print Map: no site available."),
d);(o=n.getMap())||d.dispatcher().handleError(Error("Print Map: no map available."),d);(n=n.findPrintTemplateById(k))||d.dispatcher().handleError(Error("Print Map: unable to find print template '"+k+"'."),d);n.isPrinting()&&d.dispatcher().handleError(Error("Print Map: unable to perform print operation because print template '"+k+"' is busy."),d);k=new c.essentials.ReportParameters;k.outputFormat=c.workflow.MapActivityHandlers._pickSupported(n.supportedOutputFormats,j);if(p)k.resolution=new c.essentials.Resolution("",
p);if(l)k.scale=new c.essentials.Scale("",l);if(h)k.notificationEmailAddress=h;if(f)k.customExtent=f;k.extentType=f?c.essentials.ReportParameters.CUSTOM_EXTENT:c.essentials.ReportParameters.CURRENT_EXTENT;if(b)k.targetSpatialReference=b;if(n.textFields&&n.textFields.length>0&&a)for(b=0;b<a.length;b++)if(a[b])for(f=0;f<n.textFields.length;f++)a[b].Key===n.textFields[f].displayName&&(h=new c.essentials.TextField(n.textFields[f].id,"",a[b].Value,false),k.fields.push(h));if(m&&(a=dojo.filter(n.grids,
function(a){return a.id==m}),a.length>0))k.grid=a[0];n.print(k,function(a){d.setValue("ResultUrl",a?a.href:null);d.completeActivity()},function(a){d.dispatcher().handleError(Error("Error printing map '"+a.message+"'"),d)})}})(h.MapActivityHandlers||(h.MapActivityHandlers={}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){f.handleIntersectLayers=function(d){c.workflow.MapActivityHandlers.handleIntersectLayers(d)};f.handleExportMap=function(d){c.workflow.MapActivityHandlers.handleExportMap(d)};f.handlePrintMap=function(d){c.workflow.MapActivityHandlers.handlePrintMap(d)};f.handleRefreshMap=function(d){var b=d.getValue("MapServiceId");if(d.getEsriMap()!=null){var a=function(a){a=a.serviceLayer;if(typeof a.refresh=="function")if(typeof a.disableClientCaching=="boolean"){var b=a.disableClientCaching;
a.disableClientCaching=true;a.refresh();a.disableClientCaching=b}else a.refresh()},f=d.workflow().site.essentialsMap.mapServices;b?(b=c.essentials.utilities.SiteResourceIdComparer.lookUp(f,b))&&a(b):dojo.forEach(f,function(b){a(b)})}else throw Error("Refresh Map: no map available.");d.completeActivity()};f.handleGetMapExtent=function(c){var b=c.getEsriMap();if(b==null)throw Error("Get Map Extent: No map available.");c.setValue("Extent",b.extent);c.completeActivity()};f.handleGetMapInfo=function(c){var b=
c.getEsriMap();if(b==null)throw Error("Get Map Info: No map available.");c.setValue("Extent",b.extent);c.setValue("Scale",esri.geometry.getScale(b));c.setValue("SpatialReference",b.spatialReference);c.setValue("Height",b.height);c.setValue("Width",b.width);var a=[];b.layerIds!=null&&(a=a.concat(b.layerIds));b.graphicsLayerIds!=null&&(a=a.concat(b.graphicsLayerIds));c.setValue("MapServiceIds",a);c.completeActivity()};f.handleSetMapExtent=function(c){var b=c.getValue("Extent");if(b!=null){var a=c.getEsriMap();
if(a!=null){if(!b.spatialReference||!b.spatialReference.wkid&&!b.spatialReference.wkt)b.spatialReference=a.spatialReference;var f=c.getSite();f&&f.essentialsMap?f.essentialsMap.extentManager.setExtentWithPriority(b,10):a.setExtent(b)}else throw Error("Set Map Extent: No map available.");}else throw Error("Set Map Extent: required Extent argument was not supplied.");c.completeActivity()};f.handleCaptureGeometry=function(c){function b(a,b,h){h.deactivate();dojo.disconnect(b);f.setDrawObjectContext(null);
c.setValue("Result",a);c.completeActivity()}function a(a){var c;switch(a){case 0:c=esri.toolbars.Draw.EXTENT;break;case 1:c=esri.toolbars.Draw.FREEHAND_POLYGON;break;case 2:c=esri.toolbars.Draw.FREEHAND_POLYLINE;break;case 3:c=esri.toolbars.Draw.LINE;break;case 4:c=esri.toolbars.Draw.POINT;break;case 5:c=esri.toolbars.Draw.MULTI_POINT;break;case 6:c=esri.toolbars.Draw.POLYGON;break;case 7:c=esri.toolbars.Draw.POLYLINE;break;case 8:b(p.extent,l,j);k=false;break;default:c=esri.toolbars.Draw.EXTENT}return c}
var f=c.dispatcher();if(!f.abortMapBasedActivity())throw Error("Could not deactivate current map based activity.");var h=c.getValue("CaptureType"),p=c.getEsriMap();if(p!=null){if(typeof esri.toolbars.Draw!="function")throw Error('dojo.require("esri.toolbars.draw") must be added to your client code to use CaptureGeometry activity.');var j=new esri.toolbars.Draw(p),l=dojo.connect(j,"onDrawEnd",dojo.hitch(l,function(a){b(a,l,j)})),k=true,h=a(h);k&&j.activate(h)}else throw Error("Capture Geometry: No map available.");
f.setDrawObjectContext({activityContext:c,toolbar:j,drawEvent:l})}})(h.DefaultActivityHandlers||(h.DefaultActivityHandlers={}))})(c.workflow||(c.workflow={}))})(geocortex||(geocortex={}));
(function(c){(function(h){(function(f){f.parseObject=function(d){if(d)try{if(d.nodeType===3||d.nodeType===4){var b=String.prototype.trim?d.nodeValue.trim():dojo.string.trim(d.nodeValue);return b.length===0?null:b}else if(d.nodeType===1){var a={},f=0;dojo.forEach(d.attributes,function(b){a[b.nodeName]=b.nodeValue});dojo.forEach(d.childNodes,function(b){var d=c.essentials.xmlUtils.parseObject(b);d&&(f++,a[b.nodeName]?(dojo.isArray(a[b.nodeName])===false&&(a[b.nodeName]=[a[b.nodeName]]),a[b.nodeName].push(d)):
a[b.nodeName]=d)});return f===1&&a["#text"]?a["#text"]:f===1&&a["#cdata-section"]?a["#cdata-section"]:a}}catch(h){throw Error("Unable to parse XML object: "+h.toString());}return null};f.getAllNodes=function(c){var b=new dojo.NodeList;if(dojo.isIE)for(var c=c.childNodes,a=0;a<c.length;a++)b.push(c[a]);else b=dojo.query("*",c);return b};f.getNodes=function(c,b,a){var f=new dojo.NodeList;dojo.isIE?(c=a.getElementsByTagName(c),dojo.forEach(c,function(a){a=a.getElementsByTagName(b);dojo.forEach(a,function(a){f.push(a)})})):
f=dojo.query(c+" > "+b,a);return f};f.getValue=function(c,b){if(c){var a=c;dojo.isString(c)&&(a=c.split(" > "),a=this.getNodes(a[0],a[1],b)[0]);return a.firstChild&&a.firstChild.nodeValue?a.firstChild.nodeValue:"Node not valid"}return"No Value"};f.getAttribute=function(c,b){if(c)if(dojo.isIE){for(var a=0;a<c.attributes.length;a++)if(c.attributes[a].nodeName==b)return c.attributes[a].nodeValue;return null}else return c.getAttribute(b);return"No Value"}})(h.xmlUtils||(h.xmlUtils={}))})(c.essentials||
(c.essentials={}))})(geocortex||(geocortex={}));(function(c){(function(h){var f=function(){return function(d,b){this.error=b;if(this.resultObject=d)this.rawJson=c.encodeJson(d)}}();h.RestEndpointResult=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(){function d(){this._activeEndpointRequest=false;this._onRequestError=this._onRequestComplete=null}d.prototype.getCustomRestEndpoint=function(b,a,d,f,h){this._activeEndpointRequest?this._onEndpointRequestError(Error("An operation is already in progress.")):(this._activeEndpointRequest=true,this._onRequestComplete=d,this._onRequestError=f,c.request({url:b,content:a,load:dojo.hitch(this,this._onEndpointRequestComplete),error:dojo.hitch(this,this._onEndpointRequestError),
callbackParamName:"CallBack"},h))};d.prototype._onEndpointRequestComplete=function(b){this._activeEndpointRequest=false;try{b||(b={error:Error("Expected results")}),b.error&&this._onRequestError&&this._onRequestError(b.error)}finally{this._onRequestComplete&&this._onRequestComplete(new c.essentials.RestEndpointResult(b,b.error))}};d.prototype._onEndpointRequestError=function(b){this._activeEndpointRequest=false;try{this._onRequestError&&this._onRequestError(b)}finally{this._onRequestComplete&&this._onRequestComplete(new c.essentials.RestEndpointResult(null,
b))}};return d}();h.RestUtility=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
(function(c){(function(h){var f=function(d){function b(a){d.call(this,a);this._colorSet=false;this.geometryService=this.mapSpatialReference=this.geoRssLayer=this.markerSymbol=this.pictureSymbol=this.updateInterval=this.feedImageUri=this.feedUrl=this.color=this._layerLoadCompleted=null}__extends(b,d);b.prototype._configureObject=function(a,c){if(a===void 0)throw Error("Incorrect map service object returned from initialization");b.webMercatorSref=new esri.SpatialReference({wkid:102100});b.wgs84Sref=
new esri.SpatialReference({wkid:4326});this.feedImageUri=a.feedImageUri;this.updateInterval=a.updateInterval;this.geoRssLayer=new esri.layers.GraphicsLayer({opacity:a.opacity,id:a.id,visible:a.visible});dojo.connect(this.geoRssLayer,"onError",this,this._layerLoadErrorHandler);if(a.color)this.color=a.color,this._colorSet=true,this.color.length>3&&(this.color[3]/=255);d.prototype._configureObject.call(this,a,c);if(this.attributionDataUrl&&this.attributionDataUrl!=="")this.geoRssLayer.attributionDataUrl=
this.attributionDataUrl,this.geoRssLayer.hasAttributionData=true;else if(this.hasAttributionData)this.geoRssLayer.attributionDataUrl=this.url+"/Attribution",this.geoRssLayer.hasAttributionData=true};b.prototype._createServiceLayer=function(){var a=null;if(this.essentialsMap)a=this.essentialsMap.site,this.mapSpatialReference=this.essentialsMap.initialExtent.spatialReference;this.feedImageUri?(this.feedImageUri=c.essentials.RestHelper.processClientSideTokens(a,this.feedImageUri),this.pictureSymbol=
new esri.symbol.PictureMarkerSymbol(this.feedImageUri,25,25)):this.markerSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,15,new esri.symbol.SimpleLineSymbol,new esri.Color(this.color));this.feedUrl=this.serviceUrl;this._loadFeed();if(this.updateInterval&&!isNaN(this.updateInterval)){var b=this;this._layerLoadCompleted=false;var d=setInterval(function(){b._layerLoadCompleted&&b._loadFeed();b._layerLoadCompleted=false},this.updateInterval*1E3);dojo.connect(window,
"onunload",function(){clearInterval(d)})}this.serviceLayer=this.geoRssLayer};b.prototype._loadFeed=function(){esri.config.defaults.io.proxyUrl&&c.request({url:this.serviceUrl,content:{},handleAs:"xml",load:dojo.hitch(this,this._handleFeed),error:function(a){a&&a.message&&typeof a.message=="string"&&alert(a.message)}})};b.prototype._handleFeed=function(a){var b=this._getFeedRoot(a);if(b){var d=b.nodeName,f=c.essentials.xmlUtils.getAttribute(b,"xml:base"),h=[],b=null;d==="feed"?b=c.essentials.xmlUtils.getNodes("feed",
"entry",a):d==="rdf"?b=c.essentials.xmlUtils.getNodes("rdf","item",a):d==="rss"&&(b=c.essentials.xmlUtils.getNodes("channel","item",a));if(b){var l=this.pictureSymbol||this.markerSymbol;b.forEach(dojo.hitch(this,function(a){var b,g,o,q=null;c.essentials.xmlUtils.getAllNodes(a).forEach(dojo.hitch(this,function(a){if(a.nodeName){if(a.nodeName==="title")b=a.firstChild.nodeValue;if(d==="feed"){if(a.nodeName==="summary")o=a.firstChild.nodeValue}else if(a.nodeName==="description")o=a.firstChild.nodeValue;
a.nodeName==="link"&&(g=d==="feed"?(f||"")+c.essentials.xmlUtils.getAttribute(a,"href"):(f||"")+a.firstChild.nodeValue);a.nodeName==="georss:where"&&(q=this._getGMLGRSSPoint(a));a.nodeName==="georss:point"&&(q=this._getSimpleGRSSPoint(a));a.nodeName==="geo:lat"&&(q=this._getW3CGRSSPoint(a))}}));q&&h.push(new esri.Graphic(q,l,{title:b,content:o,link:g},null))}));this.mapSpatialReference&&this._projectShapes(h,this.mapSpatialReference)}}};b.prototype._projectShapes=function(a,c){if(a&&c){for(var d=
false,f=b.webMercatorSref.wkid,h=b.wgs84Sref.wkid,l=0;l<a.length;l++){var k=a[l],m=null;if(k.geometry&&k.geometry.spatialReference.wkid!==c.wkid)c.wkid===f&&k.geometry.spatialReference.wkid===h?m=esri.geometry.geographicToWebMercator(k.geometry):c.wkid===h&&k.geometry.spatialReference.wkid===f?m=esri.geometry.webMercatorToGeographic(k.geometry):(m=esri.geometry.geographicToWebMercator(k.geometry),d=true),k.geometry=m}if(d){var n=[],d=this.geometryServiceUrl||this._getDefaultGeometryServiceUrl(),f=
this.geometryServiceUrl?null:this._getDefaultGeometryServiceToken();f!==null&&(d+=(d.indexOf("?")>-1?"&token=":"?token=")+encodeURIComponent(f));this.geometryService=new esri.tasks.GeometryService(d);dojo.forEach(a,function(a){n.push(a.geometry)});d=new esri.tasks.ProjectParameters;d.geometries=n;d.outSR=c;this.geometryService.project(d,dojo.hitch(this,function(b){for(var c=0;c<b.length;c++)a[c].geometry=b[c];this._publishLayer(a)}),this._projectionError);return}}this._publishLayer(a)};b.prototype._publishLayer=
function(a){if(this.geoRssLayer)this.geoRssLayer.clear(),dojo.forEach(a,dojo.hitch(this,function(a){this.geoRssLayer.add(a)})),this.geoRssLayer.redraw(),dojo.publish("geoRssLayerLoaded",[{esriLayer:this.geoRssLayer}]),this._layerLoadCompleted=true};b.prototype._projectionError=function(){};b.prototype._getSimpleGRSSPoint=function(a){a=a.firstChild.nodeValue.split(" ");return new esri.geometry.Point(parseFloat(a[1]),parseFloat(a[0]),b.wgs84Sref)};b.prototype._getGMLGRSSPoint=function(a){a=this._getNonTextNodeChild(this._getNonTextNodeChild(a)).firstChild.nodeValue.split(" ");
return new esri.geometry.Point(parseFloat(a[1]),parseFloat(a[0]),b.wgs84Sref)};b.prototype._getNonTextNodeChild=function(a){for(var a=a.childNodes,b=0;b<a.length;b++)if(a[b].nodeType!==3)return a[b]};b.prototype._getW3CGRSSPoint=function(a){if(!a.nextSibling)return null;var c=a.nextSibling;if(a.nextSibling.nodeName==="#text")c=a.nextSibling.nextSibling;a=a.firstChild.nodeValue;return new esri.geometry.Point(parseFloat(c.firstChild.nodeValue),parseFloat(a),b.wgs84Sref)};b.prototype._getFeedRoot=function(a){if(!a)throw Error("The GeoRSS service at "+
this.feedUrl+" returned an invalid response.");for(var a=a.childNodes,b=0;b<a.length;b++)if(a[b]&&a[b].nodeName.substring(0,3)!=="xml")return a[b];return null};b.webMercatorSref=null;b.wgs84Sref=null;return b}(h.MapService);h.GeoRssLayerService=f})(c.essentials||(c.essentials={}))})(geocortex||(geocortex={}));
