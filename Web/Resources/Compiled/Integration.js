function shim(e,t,n){if("string"==typeof e&&(n=t,t=e),"undefined"==typeof n)return void console.warn("Undefined shim for: "+t);for(var i=t.split("."),o=null,a=window,r=0,s=i.length;r<s;r++)o=i[r],r==s-1?a[o]=n:a[o]||(a[o]={}),a=a[o]}require({cache:{"Mapping/modules/Integration/ExternalComponent":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/Integration/ExternalComponentPaneView":function(){define(["require","exports","geocortex/infrastructure/ui/components/MultiPane/PaneView","geocortex/framework/utils/utils"],function(e,t,n,i){"use strict";var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attach=function(t){var n=this;e.prototype.attach.call(this,t);var o="iframe[data-frame-id='{0}']".format(t.frameId);i.addEventListener(this.frameElement,"load",function(){n.app.command("ListenToExternalComponentFrame").execute({elementSelector:o,name:n.viewModel.currentPaneItem.get().id,viewpointIndicatorUri:n.viewModel.currentPaneItem.get().viewpointIndicatorUri})})},t}(n.PaneView);t.ExternalComponentPaneView=o})},"Mapping/modules/Integration/ExternalComponentPaneViewModel":function(){define(["require","exports","geocortex/infrastructure/ui/components/MultiPane/PaneViewModel","geocortex/framework/observables","geocortex/framework/utils/utils"],function(e,t,n,i,o){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uri=new i.Observable(""),t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.frameId="frame-"+o.alphaNumericToken(),t&&t.hasOwnProperty("uri")&&this.uri.set(t.uri)},t}(n.PaneViewModel);t.ExternalComponentPaneViewModel=a})},"Mapping/modules/Integration/ExternalComponentPaneViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/Integration/ExternalComponentView":function(){define(["require","exports","geocortex/infrastructure/ui/components/MultiPane/MultiPaneView","geocortex/framework-ui/Selector/SelectorViewModel","./ExternalComponentPaneViewModel","geocortex/framework/utils/utils"],function(e,t,n,i,o,a){"use strict";var r=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._notificationViewId="externalComponentStatusMessageView",i._windowUnloadInterval=500,i._windowLoadInterval=250,i._isIE9=!1,i._registerCommands(),i.app.site&&i.app.site.isInitialized?i._siteInitialized():i.app.event("SiteInitializedEvent").once(i,i._siteInitialized),i._isIE9=$(document.documentElement).hasClass("dj_ie9"),i}return __extends(t,e),t.prototype.deactivated=function(){e.prototype.deactivated.call(this),this.app.command("RemoveNotification").execute(this._notificationViewId)},t.prototype.resolveWidget=function(t,n,o){var a=this;return"Selector"===t?(this._selectorView=this.app.viewManager.createView({typeName:"geocortex.framework.ui.Selector.SelectorView",markupResource:"Framework.UI/geocortex/framework/ui/Selector/SelectorView.html",isVisible:!0,libraryId:"Framework.UI"}),this.selector=new i.SelectorViewModel(this.app,this.libraryId,(!!this.app.configuration.mobileMode),(!!this.app.configuration.mobileMode)),this.selector.setCollection(this.viewModel.paneItems,"displayName",null),this.selector.selectorText.set(this.viewModel.selectorText.get()||this.app.getResource(this.libraryId,"language-integration-selector-text")),this.selector.noItemsText.set(this.app.getResource(this.libraryId,"language-integration-no-items")),this.selector.onSelectItem=function(e){return a.handleSelectPane(e.item)},this.selector.onUnselectItem=function(e){return a.handleUnSelectPane(e.item)},this._selectorView.attach(this.selector),this._selectorView):e.prototype.resolveWidget.call(this,t,n,null)},t.prototype.handleUnSelectPane=function(e){this.destroyPaneItemById(e.id)},t.prototype.handleClickClose=function(){this.clearDockedPaneItems(),this.deactivateContainer()},t.prototype.addPaneItem=function(e){if(!e||!this.canAddPaneItem(e))return null;this.viewModel.displayedPaneItems.addItem(e),this.app.command("ActivateView").execute(this.id);var t=new o.ExternalComponentPaneViewModel(this.app,this.libraryId);t.currentPaneItem.set(e),t.initialize({uri:e.uri});var n=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.modules.integration.ExternalComponentPaneView",markupResource:"Mapping/modules/Integration/ExternalComponentPaneView.html",libraryId:this.libraryId||"Mapping",regionName:this.viewModel.regionName.get(),isVisible:!0});return this._panes.push(n),n.attach(t),this.selector.selectItem(e),this.handleApplicationResizedEvent(),n},t.prototype.destroyPaneItemById=function(e,t){void 0===t&&(t=!1);var n=this.viewModel.findUndockedPaneItemById(e);n?this.destroyUndockedPaneItem(n):t||(n=this.viewModel.findDisplayedPaneItemById(e),this.destroyPaneItem(n))},t.prototype.destroyPaneItem=function(t){var n=e.prototype.destroyPaneItem.call(this,t);return this.viewModel.haveDockedPanes()||this.app.command("DeactivateView").execute(this.id),n},t.prototype.destroyUndockedPaneItem=function(e){e&&this.viewModel.isUndockedPaneItem(e)&&(e.window&&(e.window.close(),e.window=null),this.viewModel.undockedPaneItems.removeItem(e),this.viewModel.displayedPaneItems.removeItem(e),this.selector.unselectItem(e))},t.prototype.clearDockedPaneItems=function(){for(var e=this.viewModel.displayedPaneItems.getLength();e--;){var t=this.viewModel.displayedPaneItems.getAt(e);this.viewModel.isDockedPaneItem(t)&&this.destroyPaneItem(t)}},t.prototype.dockPaneItemById=function(e){var t=this,n=this.viewModel.findPaneItemById(e);this.viewModel.isUndockedPaneItem(n)&&this.destroyUndockedPaneItem(n),setTimeout(function(){t.addPaneItem(n)},this._windowUnloadInterval)},t.prototype.undockPaneItemById=function(e){var t=this;if("Tablet"==this.app.shellName||this._isIE9)return this.app.trace.warning("Undocking an external component is not supported."),void this.dockPaneItemById(e);var n=this.viewModel.findPaneItemById(e);if(n){var i=n.id.replace(/\W/g,""),o=window.open(n.uri,i);this.app.command("ListenToExternalComponentFrame").execute({elementSelector:null,name:n.id,contentWindow:o,viewpointIndicatorUri:n.viewpointIndicatorUri}),setTimeout(function(){a.addEventListener(o,"unload",function(){t.destroyPaneItemById(n.id,!0)})},this._windowLoadInterval),this.viewModel.isDockedPaneItem(n)&&this.destroyPaneItem(n),this.viewModel.haveDockedPanes()||this.app.command("DeactivateView").execute(this.id),n.window=o,this.viewModel.undockedPaneItems.addItem(n),this.viewModel.displayedPaneItems.addItem(n),this.selector.selectItem(n)}},t.prototype.handleApplicationResizedEvent=function(){e.prototype.handleApplicationResizedEvent.call(this);var t=this.scrollRegionElement,n=$(".view .pane .map-frame",t);0!==n.length&&$(n).height(t.clientHeight)},t.prototype._registerCommands=function(){this.app.command("ShowExternalComponentView").register(this,this._executeShowExternalComponentView,this._canExecuteExternalComponentView),this.app.command("DisplayDockedExternalComponentById").register(this,this.dockPaneItemById),this.app.command("DisplayUndockedExternalComponentById").register(this,this.undockPaneItemById),this.app.command("RemoveExternalComponentById").register(this,this.destroyPaneItemById)},t.prototype._siteInitialized=function(){var e=this;this.app.command("ShowExternalComponentView").raiseCanExecuteChanged(),a.addEventListener(window,"unload",function(){e.viewModel.undockedPaneItems.getItems().forEach(function(e){e.window.close()})})},t.prototype._executeShowExternalComponentView=function(){this._executeShowMultiPaneView();var e=this.viewModel.statusText.get();if(e){var t={id:this._notificationViewId,text:e,closeButton:{}};this.app.command("DisplayNotification").execute(t)}},t.prototype._canExecuteExternalComponentView=function(){return this.viewModel&&this.viewModel.paneItems.getLength()>0},t}(n.MultiPaneView);t.ExternalComponentView=r})},"Mapping/modules/Integration/ExternalComponentViewModel":function(){define(["require","exports","geocortex/infrastructure/ui/components/MultiPane/MultiPaneViewModel","geocortex/framework/observables","geocortex/framework/utils/ArrayUtils"],function(e,t,n,i,o){"use strict";var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.undockedPaneItems=new i.ObservableCollection,t.overlayIsVisible=new i.Observable((!1)),t.statusText=new i.Observable(""),t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(t.hasOwnProperty("externalComponents")&&this.paneItems.addItems(t.externalComponents),t.hasOwnProperty("defaultComponents")&&this.setDefaultComponents(t.defaultComponents),t.hasOwnProperty("statusText")&&this.statusText.set(t.statusText)),this._registerCommandsAndEvents()},t.prototype.setDefaultComponents=function(e){if(0!=this.paneItems.length()){for(var t=0;t<e.length;t++){var n=o.firstOrDefault(this.paneItems.getItems(),function(n){return n.id===e[t]});this.defaultPaneItems.addItem(n)}0==this.defaultPaneItems.getLength()&&this.defaultPaneItems.addItem(this.paneItems.getAt(0))}},t.prototype.findUndockedPaneItemById=function(e){return o.firstOrDefault(this.undockedPaneItems.getItems(),function(t){return t.id&&t.id===e})},t.prototype.isUndockedPaneItem=function(e){return o.contains(this.undockedPaneItems.getItems(),e)},t.prototype.isDockedPaneItem=function(e){return o.contains(this.displayedPaneItems.getItems(),e)&&!o.contains(this.undockedPaneItems.getItems(),e)},t.prototype.haveDockedPanes=function(){return this.displayedPaneItems.length()>this.undockedPaneItems.length()},t.prototype._registerCommandsAndEvents=function(){var e=this;this.app.event("MapMouseDownEvent").subscribe(this,function(){return e.overlayIsVisible.set(!0)}),this.app.event("MapMouseUpEvent").subscribe(this,function(){return e.overlayIsVisible.set(!1)}),this.app.event("PanelResizeStartEvent").subscribe(this,function(){return e.overlayIsVisible.set(!0)}),this.app.event("PanelResizeEndEvent").subscribe(this,function(){return e.overlayIsVisible.set(!1)})},t}(n.MultiPaneViewModel);t.ExternalComponentViewModel=a})},"Mapping/modules/Integration/ExternalComponentViewModelConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/Integration/IntegrationModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/GeometryUtils","geocortex/framework/utils/utils","geocortex/framework/utils/ArrayUtils","geocortex/essentials/utilities/GraphicsLayerUtilities","geocortex/infrastructure/GraphicsLayerUtils","geocortex/infrastructure/GraphicsLayerIds"],function(e,t,n,i,o,a,r,s,p){"use strict";var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._connectedComponents=[],t._componentStates=[],t._eventSubscriptions=[],t._commandSubscriptions=[],t._heading=0,t._pitch=0,t._previousScale=0,t._ignoreUpdates=!1,t._componentIgnoreUpdates=!1,t._ignoreUpdateInterval=250,t}return __extends(t,e),t.prototype.initialize=function(e){var n=this;this._incomingMessageTransport=new geocortex.essentialsHtmlViewer.integration.PostMessageTransport(window,null,"Viewer"),this._incomingMessageTransport.allowOrigin("{0}//{1}".format(window.location.protocol,window.location.host)),this._incomingMessageTransport.onMessage=function(e){return n._handleBridgeMessage(e)},e.allowedOrigins&&e.allowedOrigins.forEach(function(e){return n._incomingMessageTransport.allowOrigin(e)}),r.addToGraphicsLayerIdsToExclude([s.ExcludeFromEnum.ExportApplyStateName,s.ExcludeFromEnum.ExportMapTaskName,s.ExcludeFromEnum.WebMapName],t.VIEWPOINT_INDICATOR_GRAPHICS_LAYER_ID),this._registerCommandsAndEvents()},t.prototype._registerCommandsAndEvents=function(){this.app.command("ListenToExternalComponentFrame").register(this,this._executeListenToExternalComponentFrame),this.app.command("ToggleExternalComponentSyncById").register(this,this._executeToggleExternalComponentSyncById),this.app.command("BroadcastCurrentViewpoint").register(this,this._executeBroadcastCurrentViewpoint),this.app.event("ComponentViewpointUpdatedEvent").subscribe(this,this._handleComponentViewpointUpdatedEvent),this.app.event("MapExtentChangedEvent").subscribe(this,this._handleMapExtentChangedEvent),this.app.event("ApplicationResizedEvent").subscribe(this,this._handleApplicationResizedEvent)},t.prototype._handleComponentViewpointUpdatedEvent=function(e){var t=this;if(e){var n=this._getComponent(this._commandOrEventSender);if(!n)return void this.app.trace.warning("Received a viewpoint update from an unrecognized component.");this._lastUpdaterName=n.id,n.sync&&e.heading&&(this._heading=e.heading);var o;o=e.extent?new esri.geometry.Extent(e.extent):new esri.geometry.Point(e.center),o.spatialReference=o.spatialReference||n.preferredSpatialReference;var a=new esri.tasks.ProjectParameters;a.geometries=[o],a.outSR=this.app.map.spatialReference,i.project(a,function(i){var o=i[0];o instanceof esri.geometry.Extent?n.sync&&!t._ignoreUpdates?(t.app.command("ZoomToExtent").execute(o),t._updateSyncedViewpointIndicator()):n.sync||t._updateViewpointIndicator(n.name,n.viewpointIndicatorUri,o.getCenter(),e.heading):n.sync&&!t._ignoreUpdates?(e.scale&&e.scale!==t._previousScale&&(t._previousScale=e.scale,t.app.command("ZoomToScale").execute(e.scale)),t.app.command("PanToPoint").execute(o),t._updateSyncedViewpointIndicator()):n.sync||t._updateViewpointIndicator(n.name,n.viewpointIndicatorUri,o,e.heading)},function(e){t.app.trace.warning("An error occurred while attempting to project the current extent for third-party map components: "+e)},this.app)}},t.prototype._executeBroadcastCurrentViewpoint=function(e){var t=this._getComponentByName(e);if(!t)return void this.app.trace.warning("Received a broadcast request from an unrecognized component.");var n=this._currentViewpoint;this._lastUpdaterName=null,n.updaterName=this._lastUpdaterName,this._updateViewpointIndicator(t.name,t.viewpointIndicatorUri,n.extent.getCenter(),this._heading),this._broadcastViewpoint(n,t,!0)},t.prototype._executeListenToExternalComponentFrame=function(e){var t=$(e.elementSelector,this.app.getHostElement())[0],n=t?t.contentWindow:e.contentWindow;if(!n)return void this.app.trace.error("Could not listen to remote component. No element to listen to found for selector '{0}' and no context window provided.".format(e.elementSelector));var i=o.alphaNumericToken(32),a=e.name,r=new geocortex.essentialsHtmlViewer.integration.PostMessageTransport(null,n,a),s={id:i,name:a,transport:r,preferredSpatialReference:new esri.SpatialReference({wkid:4326}),sync:!1,viewpointIndicatorUri:e.viewpointIndicatorUri};this._connectedComponents.push(s)},t.prototype._executeToggleExternalComponentSyncById=function(e){var t=this._getComponentByName(e);if(!t)return void this.app.trace.warning("Received a sync update from an unrecognized component.");if(t.sync=!t.sync,t.sync){this._removeViewpointIndicator(t.name),this._updateSyncedViewpointIndicator();var n=this._currentViewpoint;n.updaterName=null,this._broadcastViewpoint(n,t)}else this._removeSyncedViewpointIndicator(),this._updateViewpointIndicator(t.name,t.viewpointIndicatorUri,this.app.map.extent.getCenter(),this._heading)},t.prototype._handleHandshakeRequest=function(e){if(!e.payload)return void this.app.trace.warning("Received a handshake request without a specified id.");var t=e.payload,n=this._getComponentByName(t);return n?(n.transport.send({messageName:geocortex.essentialsHtmlViewer.integration.protocol.HandshakeResponse,componentId:n.id}),void this._handleRemoteComponentInitialized(n)):void this.app.trace.warning("Received a handshake request from an unrecognized component.")},t.prototype._handleRemoteComponentDisconnect=function(e){var t=this._getComponent(e.componentId);return t?(e.payload&&this._updateComponentState(e.payload),this._removeComponent(e.componentId),void(t.sync?this._removeSyncedViewpointIndicator():this._removeViewpointIndicator(t.name))):void this.app.trace.warning("An unknown component broadcasted a disconnect message.")},t.prototype._updateComponentState=function(e){var t=a.firstOrDefault(this._componentStates,function(t){return t.id===e.id});t&&a.removeItem(this._componentStates,t),this._componentStates.push(e)},t.prototype._removeComponent=function(e){var t=this._getComponent(e);if(!t)return!1;var n=this._connectedComponents.indexOf(t);return!(n<0)&&(this._connectedComponents.splice(n,1),!0)},t.prototype._sendToAll=function(e,t){var n=this;this._connectedComponents.forEach(function(i){if(!t||i.id!==t)try{i.transport.send(e)}catch(o){n.app.trace.warning("Could not send message '{0}' to component '{1}' (ID: '{2}'): {3}".format(e.messageName,i.name,i.id,o))}})},t.prototype._sendTo=function(e,t){var n=this._getComponent(e);n&&n.transport.send(t)},t.prototype._getComponent=function(e){var t=this._connectedComponents.filter(function(t){return t.id===e})[0];return t?t:(this.app.trace.warning("Could not find connected component with ID '{0}'.".format(e)),null)},t.prototype._getComponentByName=function(e){var t=this._connectedComponents.filter(function(t){return t.name===e})[0];return t?t:(this.app.trace.warning("Could not find connected component with name '{0}'.".format(e)),null)},t.prototype._handleBridgeMessage=function(e){var t=this;if(e.messageName===geocortex.essentialsHtmlViewer.integration.protocol.HandshakeRequest)return void this._handleHandshakeRequest(e);var n=e.componentId,i=this._getComponent(n);if(!n||!i)return void this.app.trace.warning("Received a bridge message with missing or unknown component ID from sender. Discarding.");switch(e.messageName){case geocortex.essentialsHtmlViewer.integration.protocol.RemoteDisconnect:this._handleRemoteComponentDisconnect(e);break;case geocortex.essentialsHtmlViewer.integration.protocol.RemotePublish:var o=e.commandOrEventName;if(!o)return void this.app.trace.warning("Message from integration bridge was missing the 'commandOrEventName' field.");try{this._commandOrEventSender=e.componentId,o.endsWith("Event")?this.app.event(o).publish(e.payload):this.app.command(o).execute(e.payload)}finally{this._commandOrEventSender=null}break;case geocortex.essentialsHtmlViewer.integration.protocol.RemoteSubscribe:var o=e.commandOrEventName;if(!o)return void this.app.trace.warning("Message from integration bridge was missing the 'commandOrEventName' field.");if(o.endsWith("Event")){if(this._eventSubscriptions[o])return;this._eventSubscriptions[o]=this.app.event(o).subscribe(this,function(e){t._sendToAll({messageName:geocortex.essentialsHtmlViewer.integration.protocol.RemotePublish,commandOrEventName:o,payload:e})})}else{if(this._commandSubscriptions[o])return;this._commandSubscriptions[o]=this.app.command(o).register(this,function(e){t._sendToAll({messageName:geocortex.essentialsHtmlViewer.integration.protocol.RemotePublish,commandOrEventName:o,payload:e})})}break;case geocortex.essentialsHtmlViewer.integration.protocol.RemoteUnsubscribe:var o=e.commandOrEventName;if(o.endsWith("Event")){var a=this._eventSubscriptions[o];this.app.event(o).unsubscribe(a),delete this._eventSubscriptions[o]}else{var a=this._commandSubscriptions[o];this.app.command(o).unregister(a),delete this._commandSubscriptions[o]}}},t.prototype._handleMapExtentChangedEvent=function(e,t){this._updateViewpoint(e)},t.prototype._handleApplicationResizedEvent=function(){var e=this;this._componentIgnoreUpdates=!0,this._ignoreUpdatesTimer=setTimeout(function(){e._componentIgnoreUpdates=!1},this._ignoreUpdateInterval)},t.prototype._updateViewpoint=function(e){var t=e.getCenter(),n={timestamp:(new Date).getTime(),extent:e,position:{x:t.x,y:t.y},scale:this.app.map.getScale(),heading:this._heading,pitch:this._pitch,updaterName:this._lastUpdaterName};this._currentViewpoint=n,this._lastUpdaterName=null,this._updateSyncedViewpointIndicator(t),this._broadcastViewpoint(n)},t.prototype._updateSyncedViewpointIndicator=function(e,n){this._connectedComponents.some(function(e){return e.sync})&&(e=e||this.app.map.extent.getCenter(),this._updateViewpointIndicator("sync",t.DEFAULT_VIEWPOINT_INDICATOR_URI,e,this._heading))},t.prototype._updateViewpointIndicator=function(e,t,n,i){var o=this;if(void 0===i&&(i=0),t){var r=this.app.site.getMap();if(r&&r.spatialReference){this._indicatorLayer||(this._indicatorLayer=s.getInternalGraphicsLayer(p.VIEWPOINT_INDICATOR_GRAPHICS_LAYER_ID,this.app,s.GraphicsLayerType.Pushpin),this._indicatorLayer.on("mouse-down",function(e){o._onMouseDown(e)}),Modernizr.touch&&this._indicatorLayer.getNode().addEventListener("touchstart",function(e){o._onTouchStart(e)}));var d=a.firstOrDefault(this._indicatorLayer.graphics,function(t){return t.attributes.ID===e});if(!d){var c=new esri.symbol.PictureMarkerSymbol(t,32,32);d=new esri.Graphic(n,c,{ID:e},null),this._indicatorLayer.add(d)}var l=(i+45)%360;d.symbol.setAngle(l),d.setGeometry(n)}}},t.prototype._removeSyncedViewpointIndicator=function(){this._connectedComponents.some(function(e){return e.sync})||this._removeViewpointIndicator("sync")},t.prototype._removeViewpointIndicator=function(e){if(this._indicatorLayer){var t=a.firstOrDefault(this._indicatorLayer.graphics,function(t){return t.attributes.ID==e});t&&this._indicatorLayer.remove(t)}},t.prototype._onMouseDown=function(e){var t=this;if(e.preventDefault(),0===e.button){var n=e.graphic.attributes.ID;if("sync"!==n){var i=this._getComponentByName(n);if(!i)return void this.app.trace.warning("Viewpoint indicator is not associated with a remote component.");this.app.map.disableMapNavigation(),this._ignoreUpdates=!0;var o=null,a=null,r=null,s=e.graphic.symbol.angle-45,p=function(e){e.preventDefault(),0!==e.button&&d(e),t._updateViewpointIndicatorComponent(i,e.mapPoint,s)},d=function(e){e.preventDefault(),o.remove(),a.remove(),r.remove(),t._updateViewpointIndicatorComponent(i,e.mapPoint,s),t._ignoreUpdates=!1,t.app.map.enableMapNavigation()};a=this.app.map.on("mouse-drag",p),o=this.app.map.on("mouse-up",d),r=this.app.map.on("mouse-out",d)}}},t.prototype._onTouchStart=function(e){var t=this;e.preventDefault();var n=e.target.e_graphic.attributes.ID;if("sync"!==n){var i=this._getComponentByName(n);if(!i)return void this.app.trace.warning("Viewpoint indicator is not associated with a remote component.");this.app.map.disableMapNavigation(),this._ignoreUpdates=!0;var o=e.target.e_graphic.symbol.angle-45,a=function(e){e.preventDefault(),t._updateViewpointIndicatorComponent(i,e.mapPoint,o)},r=function(e){e.preventDefault(),t.app.map.root.removeEventListener("touchmove",a),t.app.map.root.removeEventListener("touchend",r),t._updateViewpointIndicatorComponent(i,e.mapPoint,o),t._ignoreUpdates=!1,t.app.map.enableMapNavigation()};this.app.map.root.addEventListener("touchmove",a),this.app.map.root.addEventListener("touchend",r)}},t.prototype._updateViewpointIndicatorComponent=function(e,t,n){var o=this;if(void 0===n&&(n=0),e&&t){this._updateViewpointIndicator(e.name,e.viewpointIndicatorUri,t,n);var a=new esri.tasks.ProjectParameters;a.geometries=[t],a.outSR=e.preferredSpatialReference,i.project(a,function(t){var n=t[0];e.transport.send({messageName:geocortex.essentialsHtmlViewer.integration.protocol.RemotePublish,commandOrEventName:"ViewpointIndicatorUpdatedEvent",payload:n})},function(e){o.app.trace.warning("An error occurred while attempting to project the current extent for third-party map components: "+e)},this.app)}},t.prototype._broadcastViewpoint=function(e,t,n){var o=this;void 0===n&&(n=!1);var a=t?[t]:this._connectedComponents;if(!this._componentIgnoreUpdates||n)for(var r=0;r<a.length;r++){var t=a[r];if(t.sync||n){var s=new esri.tasks.ProjectParameters;s.geometries=[this.app.map.extent],s.outSR=t.preferredSpatialReference,i.project(s,function(n){var i=n[0];e.extent=i,e.position=e.extent.getCenter(),o._ignoreUpdates=!0,o._ignoreUpdatesTimer=setTimeout(function(){o._ignoreUpdates=!1},o._ignoreUpdateInterval),t.transport.send({messageName:geocortex.essentialsHtmlViewer.integration.protocol.RemotePublish,commandOrEventName:"ViewerPositionUpdatedEvent",payload:e})},function(e){o.app.trace.warning("An error occurred while attempting to project the current extent for third-party map components: "+e)},this.app)}}},t.prototype._handleRemoteComponentInitialized=function(e){var t=a.firstOrDefault(this._componentStates,function(t){return t.id===e.name});t&&(e.sync=t.sync);var n={viewpoint:null,sync:e.sync,hasPreviousState:!!t};t&&!t.sync&&(n.viewpoint={extent:t.viewpoint.extent,heading:t.viewpoint.heading,pitch:t.viewpoint.pitch,position:t.viewpoint.center,scale:t.viewpoint.scale,updaterName:null}),e.transport.send({messageName:geocortex.essentialsHtmlViewer.integration.protocol.RemotePublish,commandOrEventName:"ExternalComponentInitializedEvent",payload:n}),t?t.sync?(this._broadcastViewpoint(this._currentViewpoint,e,!0),this._updateSyncedViewpointIndicator()):this._updateViewpointIndicator(e.name,e.viewpointIndicatorUri,this._currentViewpoint.extent.getCenter(),t.viewpoint.heading):(this._broadcastViewpoint(this._currentViewpoint,e,!0),this._updateViewpointIndicator(e.name,e.viewpointIndicatorUri,this._currentViewpoint.extent.getCenter(),0))},t}(n.ModuleBase);d.DEFAULT_VIEWPOINT_INDICATOR_URI="Resources/Images/Icons/location-direction-blue-32.png",d.VIEWPOINT_INDICATOR_GRAPHICS_LAYER_ID=p.VIEWPOINT_INDICATOR_GRAPHICS_LAYER_ID,t.IntegrationModule=d})},"Mapping/modules/Integration/IntegrationModuleConfig":function(){define(["require","exports"],function(e,t){"use strict"})},"Mapping/modules/Integration/RemoteComponent":function(){define(["require","exports"],function(e,t){"use strict"})},"url:/Mapping/modules/Integration/ExternalComponentPaneView.html":'<div class="pane">\r\n    <iframe frameborder="0" class="map-frame" data-binding="{@var: frameElement}{data-frame-id: frameId}{@visible: uri}{src: uri}"></iframe>\r\n</div>',"url:/Mapping/modules/Integration/ExternalComponentView.html":'<div class="view-container-view integration" data-binding="{@var: containerElement}">\r\n\r\n    <!-- BEGIN: Header -->\r\n    <button class="bottom-panel-resize resize-handle" tabindex="-1" data-binding="{@visible: resizeY}{@event-mousedown: handleHeaderMouseDown}{@event-touchstart: handleHeaderTouchStart}{title: @language-integration-smart-panel-resize}">\r\n        <span class="icon-drag"></span>\r\n    </button>\r\n    <div class="banner-noselect" data-binding="{@var: headerElement}{@event-mousedown: handleHeaderMouseDown}{@event-touchstart: handleHeaderTouchStart}\r\n                                                {@class-resize-horizontal-hint: resizeX}{@class-resize-vertical-hint: resizeY}">\r\n        <div class="panel-header" data-binding="{@visible: headerIsVisible}">\r\n            <button class=" panel-header-button right close-16" href="javascript:void(0)" data-binding="{@visible: showXButton}{@event-onclick: handleClickClose}">\r\n            </button>\r\n            <button class="panel-header-button right" data-binding="{@visible: showingMaximizeButton}{@class-minimize-16: panelMaximized}{@noclass-maximize-16: panelMaximized}{@event-onclick: handleMaximizeToggleClick}{@event-touchstart: handleMaximizeToggleClick}{title: @language-integration-smart-panel-maximize-restore}"></button>\r\n            <img data-binding="{@visible: selectorIconUri}{src: selectorIconUri}" />\r\n            <div data-binding="{@widget: Selector}{@widget-replace: true}"></div>\r\n        </div>\r\n        <div class="resize-header" data-binding="{@hidden: headerIsVisible}"></div>\r\n    </div>\r\n\r\n    <div class="panel-scroll-container" data-binding="{data-region-name: regionName}{data-region-adapter: regionType}{@var: scrollRegionElement}{@event-onscroll: handleScrollChange}"></div>\r\n    <div class="integration-overlay" data-binding="{@visible: overlayIsVisible}"></div>\r\n</div>'}}),define(["Mapping/modules/Integration/ExternalComponentPaneView","Mapping/modules/Integration/ExternalComponentPaneViewModel","Mapping/modules/Integration/ExternalComponentView","Mapping/modules/Integration/ExternalComponentViewModel","Mapping/modules/Integration/IntegrationModule"],function(e,t,n,i,o){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.integration.ExternalComponentPaneView",e.ExternalComponentPaneView),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.integration.ExternalComponentPaneViewModel",t.ExternalComponentPaneViewModel),shim(n,"geocortex.essentialsHtmlViewer.mapping.modules.integration.ExternalComponentView",n.ExternalComponentView),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.integration.ExternalComponentViewModel",i.ExternalComponentViewModel),shim(o,"geocortex.essentialsHtmlViewer.mapping.modules.integration.IntegrationModule",o.IntegrationModule)});