!function(){function e(e,t,o){if("string"==typeof e&&(o=t,t=e),void 0!==o)for(var r=t.split("."),i=null,a=window,n=0,p=r.length;n<p;n++)i=r[n],n==p-1?a[i]=o:a[i]||(a[i]={}),a=a[i];else console.warn("Undefined shim for: "+t)}var t="<div class='export-webmap'>    <div data-binding='{@hidden: exportComplete}'>        <div data-binding='{@visible: isExporting}'>            <p data-binding='{@text: @language-export-web-map-is-exporting}'></p>        </div>        <div data-binding='{@hidden: isExporting}'>            <label for='exportWebMapTitle' data-binding='{@text: @language-export-web-map-title-label}'></label>            <input id='exportWebMapTitle' type ='text' data-binding='{@value: title}' />            <div class='form-btns'>                <button class='button' data-binding='{@event-click: handleExportWebMapClick}{@text: @language-export-web-map-export-button}'></button>            </div>        </div>    </div>    <div data-binding='{@visible: exportComplete}'>        <p data-binding='{@text: @language-export-web-map-complete-description}'></p>        <div class='form-btns'>            <button class='button' data-binding='{@event-click: handleOpenPortalItem}{@text: @language-export-web-map-open-portal}'></button>        </div>    </div></div>";require({cache:{"Mapping/modules/ExportWebMap/ExportWebMapModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(t,o,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(r.ModuleBase);o.ExportWebMapModule=i})},"Mapping/modules/ExportWebMap/ExportWebMapView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/PortalUtils"],function(t,o,r,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(e,o){return t.call(this,e,o)||this}return e(o,t),o.prototype.attach=function(e){var o=this;t.prototype.attach.call(this,e),this.app.command("ShowExportWebMapDialog").register(this,function(){o.app.viewManager.activateView(o),o.app.command("ScreenReaderNarrate").execute(o.app.getResource(o.libraryId,"language-export-web-map-narrate-view-activated"))},function(){return!!o.viewModel&&i.hasCreateContentPrivilege(o.app)})},o.prototype.activated=function(){t.prototype.activated.call(this),this.viewModel&&this.viewModel.clearFields()},o.prototype.handleExportWebMapClick=function(e,t,o){this.viewModel.exportWebMap()},o.prototype.handleOpenPortalItem=function(e,t,o){var r=i.getPortalItemUrl(this.viewModel.itemId,this.app);window.open(r),this.app.viewManager.deactivateView(this)},o}(r.ViewBase);o.ExportWebMapView=a})},"Mapping/modules/ExportWebMap/ExportWebMapViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/PortalUtils","geocortex/infrastructure/GeometryUtils","geocortex/geocortex"],function(t,o,r,i,a,n,p){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function o(e,o){var r=t.call(this,e,o)||this;return r.itemId="",r.title=new i.Observable(null),r.isExporting=new i.Observable(!1),r.exportComplete=new i.Observable(!1),r}return e(o,t),o.prototype.initialize=function(e){var t=this;this.app.command("OpenPortalMyContentWindow").register(this,function(){var e=a.getPortalMyContentUrl(t.app);window.open(e)},function(){return a.hasAccessToPortal(t.app)}),this.app.site&&this.app.site.isInitialized?this.siteInitialized():this.app.event("SiteInitializedEvent").once(this,this.siteInitialized)},o.prototype.siteInitialized=function(){this.app.command("ShowExportWebMapDialog").raiseCanExecuteChanged(),this.app.command("OpenPortalMyContentWindow").raiseCanExecuteChanged()},o.prototype.exportWebMap=function(){var e=this;if(!this.title.get())return this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-export-web-map-invalid-title")),void this.app.command("ScreenReaderNarrate").execute(this.app.getResource(this.libraryId,"language-export-web-map-invalid-title"));this.isExporting.set(!0),this.app.command("ScreenReaderNarrate").execute(this.app.getResource(this.libraryId,"language-export-web-map-is-exporting")),this.app.webMap.create().then(function(t){var o=e.app.site.essentialsMap.getMap().extent,r=new esri.SpatialReference(4326);n.projectGeometry(o,r,function(o){e._uploadWebmapToPortal(e.title.get(),t,o)},function(t){e._handleError(t)},e.app)},function(t){e._handleError(t)})},o.prototype._uploadWebmapToPortal=function(e,t,o){var r=this,i=String.format("{0}, {1}, {2}, {3}",o.xmin,o.ymin,o.xmax,o.ymax);p.request({url:this.app.site.url+"/additem",content:{f:"json",extent:i,text:JSON.stringify(t),title:e,type:"Web Map"},load:function(e){r.itemId=e.id,r.app.command("ScreenReaderNarrate").execute(r.app.getResource(r.libraryId,"language-export-web-map-complete-description")),r.isExporting.set(!1),r.exportComplete.set(!0)},error:function(e){r._handleError(e)}},{usePost:!0})},o.prototype._handleError=function(e){this.app.trace.error("Error exporting web map to Portal.",e),this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-export-web-map-error")),this.app.command("ScreenReaderNarrate").execute(this.app.getResource(this.libraryId,"language-export-web-map-error")),this.clearFields()},o.prototype.clearFields=function(){this.itemId="",this.title.set(null),this.isExporting.set(!1),this.exportComplete.set(!1)},o}(r.ViewModelBase);o.ExportWebMapViewModel=s})},"url:/Mapping/modules/ExportWebMap/ExportWebMapView.html":t}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/ExportWebMap/CSS/common.css","css","LmV4cG9ydC13ZWJtYXANCnsNCiAgICBoZWlnaHQ6IDEwMCU7DQogICAgcGFkZGluZzogMTBweDsNCn0NCg0KLmV4cG9ydC13ZWJtYXAgbGFiZWwNCnsNCiAgICBjb2xvcjogIzY2NzU4MDsNCiAgICBmb250LXNpemU6IDEuMmVtOw0KICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIG1hcmdpbjogLjc1ZW0gMCAwLjI1ZW0gMDsNCn0NCg=="),e.resourceManager.register("Mapping","inv","Mapping/modules/ExportWebMap/ExportWebMapView.html","html",t)}),require({cache:{}}),define(["Mapping/modules/ExportWebMap/ExportWebMapModule","Mapping/modules/ExportWebMap/ExportWebMapView","Mapping/modules/ExportWebMap/ExportWebMapViewModel"],function(t,o,r){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.exportWebMap.ExportWebMapModule",t.ExportWebMapModule),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.exportWebMap.ExportWebMapView",o.ExportWebMapView),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.exportWebMap.ExportWebMapViewModel",r.ExportWebMapViewModel)})}();