function shim(e,t,i){if("string"==typeof e&&(i=t,t=e),"undefined"==typeof i)return void console.warn("Undefined shim for: "+t);for(var r=t.split("."),a=null,o=window,n=0,p=r.length;n<p;n++)a=r[n],n==p-1?o[a]=i:o[a]||(o[a]={}),o=o[a]}require({cache:{"Mapping/modules/ExportWebMap/ExportWebMapModule":function(){define(["require","exports","geocortex/framework/application/ModuleBase"],function(e,t,i){"use strict";var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(i.ModuleBase);t.ExportWebMapModule=r})},"Mapping/modules/ExportWebMap/ExportWebMapView":function(){define(["require","exports","geocortex/framework/ui/ViewBase","geocortex/infrastructure/PortalUtils"],function(e,t,i,r){"use strict";var a=function(e){function t(t,i){var a=e.call(this,t,i)||this;return a.app.command("ShowExportWebMapDialog").register(a,function(){a.app.viewManager.activateView(a),a.app.command("ScreenReaderNarrate").execute(a.app.getResource(a.libraryId,"language-export-web-map-narrate-view-activated"))},function(){return!!a.viewModel&&r.hasCreateContentPrivilege(a.app)}),a}return __extends(t,e),t.prototype.activated=function(){e.prototype.activated.call(this),this.viewModel&&this.viewModel.clearFields()},t.prototype.handleExportWebMapClick=function(e,t,i){this.viewModel.exportWebMap()},t.prototype.handleOpenPortalItem=function(e,t,i){var a=r.getPortalItemUrl(this.viewModel.itemId,this.app);window.open(a),this.app.viewManager.deactivateView(this)},t}(i.ViewBase);t.ExportWebMapView=a})},"Mapping/modules/ExportWebMap/ExportWebMapViewModel":function(){define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/PortalUtils","geocortex/infrastructure/GeometryUtils","geocortex/geocortex"],function(e,t,i,r,a,o,n){"use strict";var p=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.itemId="",o.title=new r.Observable(null),o.isExporting=new r.Observable((!1)),o.exportComplete=new r.Observable((!1)),o.app.command("OpenPortalMyContentWindow").register(o,function(){var e=a.getPortalMyContentUrl(o.app);window.open(e)},function(){return a.hasAccessToPortal(o.app)}),o.app.site&&o.app.site.isInitialized?o.siteInitialized():o.app.event("SiteInitializedEvent").once(o,o.siteInitialized),o}return __extends(t,e),t.prototype.siteInitialized=function(){this.app.command("ShowExportWebMapDialog").raiseCanExecuteChanged(),this.app.command("OpenPortalMyContentWindow").raiseCanExecuteChanged()},t.prototype.exportWebMap=function(){var e=this;return this.title.get()?(this.isExporting.set(!0),this.app.command("ScreenReaderNarrate").execute(this.app.getResource(this.libraryId,"language-export-web-map-is-exporting")),void this.app.webMap.create().then(function(t){var i=e.app.site.essentialsMap.getMap().extent,r=new esri.SpatialReference(4326);o.projectGeometry(i,r,function(i){e._uploadWebmapToPortal(e.title.get(),t,i)},function(t){e._handleError(t)},e.app)},function(t){e._handleError(t)})):(this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-export-web-map-invalid-title")),void this.app.command("ScreenReaderNarrate").execute(this.app.getResource(this.libraryId,"language-export-web-map-invalid-title")))},t.prototype._uploadWebmapToPortal=function(e,t,i){var r=this,a=String.format("{0}, {1}, {2}, {3}",i.xmin,i.ymin,i.xmax,i.ymax);n.request({url:this.app.site.url+"/additem",content:{f:"json",extent:a,text:JSON.stringify(t),title:e,type:"Web Map"},load:function(e){r.itemId=e.id,r.app.command("ScreenReaderNarrate").execute(r.app.getResource(r.libraryId,"language-export-web-map-complete-description")),r.isExporting.set(!1),r.exportComplete.set(!0)},error:function(e){r._handleError(e)}},{usePost:!0})},t.prototype._handleError=function(e){this.app.trace.error("Error exporting web map to Portal.",e),this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-export-web-map-error")),this.app.command("ScreenReaderNarrate").execute(this.app.getResource(this.libraryId,"language-export-web-map-error")),this.clearFields()},t.prototype.clearFields=function(){this.itemId="",this.title.set(null),this.isExporting.set(!1),this.exportComplete.set(!1)},t}(i.ViewModelBase);t.ExportWebMapViewModel=p})},"url:/Mapping/modules/ExportWebMap/ExportWebMapView.html":'<div class="export-webmap">\r\n    <div data-binding="{@hidden: exportComplete}">\r\n        <div data-binding="{@visible: isExporting}">\r\n            <p data-binding="{@text: @language-export-web-map-is-exporting}"></p>\r\n        </div>\r\n\r\n        <div data-binding="{@hidden: isExporting}">\r\n            <label data-binding="{@text: @language-export-web-map-title-label}"></label>\r\n            <input type="text" data-binding="{@value: title}" />\r\n\r\n            <div class="form-btns">\r\n                <button class="button" data-binding="{@event-click: handleExportWebMapClick}{@text: @language-export-web-map-export-button}"></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div data-binding="{@visible: exportComplete}">\r\n        <p data-binding="{@text: @language-export-web-map-complete-description}"></p>\r\n        <div class="form-btns">\r\n            <button class="button" data-binding="{@event-click: handleOpenPortalItem}{@text: @language-export-web-map-open-portal}"></button>\r\n        </div>\r\n    </div>\r\n</div>'}}),define(["Mapping/modules/ExportWebMap/ExportWebMapModule","Mapping/modules/ExportWebMap/ExportWebMapView","Mapping/modules/ExportWebMap/ExportWebMapViewModel"],function(e,t,i){shim(e,"geocortex.essentialsHtmlViewer.mapping.modules.exportWebMap.ExportWebMapModule",e.ExportWebMapModule),shim(t,"geocortex.essentialsHtmlViewer.mapping.modules.exportWebMap.ExportWebMapView",t.ExportWebMapView),shim(i,"geocortex.essentialsHtmlViewer.mapping.modules.exportWebMap.ExportWebMapViewModel",i.ExportWebMapViewModel)});