!function(){function e(e,t,o){if("string"==typeof e&&(o=t,t=e),void 0!==o)for(var i=t.split("."),a=null,n=window,l=0,s=i.length;l<s;l++)a=i[l],l==s-1?n[a]=o:n[a]||(n[a]={}),n=n[a];else console.warn("Undefined shim for: "+t)}var t="<div class='geolocate-wrapper'>    <div class='zoom-control-btn' data-binding='{@visible: visible}{@class-geolocate-tracking: isTracking}{@class-geolocate-following: isFollowing}{@class-geolocate-active: active}'>        <button class='geolocate-base toggle-btn' data-binding='{@event-onclick: handleClickGeolocate}{title:@language-geolocate-find-desc}' tabindex='0'></button>    </div>    <div class='geolocate-menu' data-region-name='GeolocateMenuRegion' data-region-adapter='geocortex.framework.ui.MultiDivRegionAdapter'></div></div>",o="<div class='status-window geolocate-status-window'>    <table role='presentation'>        <tr>            <td>                <img class='status-img' data-binding='{src: imageUri}{@visible: imageUri}' alt=' ' />            </td>            <td>                <div class='geolocate-status' data-binding='{@text: status}{@visible: status}'></div>                <div class='coords-display' data-binding='{@visible: showCoordinates}'>                    <div class='coords-item coords-x'>                        <span class='coords-label' data-binding='{@text: xValueType}'></span>                        <span class='coords-values' data-binding='{@text: xValue}'></span>                    </div>                    <div class='coords-item coords-y'>                        <span class='coords-label' data-binding='{@text: yValueType}'></span>                        <span class='coords-values' data-binding='{@text: yValue}'></span>                    </div>                </div>            </td>            <td class='status-close'>                <button class='status-btn' data-binding='{@event-onclick: handleClickClose}{title: @language-common-close}'>                    <span>&nbsp;</span>                </button>            </td>        </tr>    </table></div>",i="<div class='geolocate-container' data-binding='{@visible: visible}'>    <div class='geolocate-title'>        <span data-binding='{@text: @language-geolocate-title}'></span>    </div>    <div class='geolocate-list'>        <ul class='list-menu has-icon' data-binding='{@event-onblur: deactivateGeolocateMenuView}'>            <li class='list-menu-item' data-binding='{@visible: geolocateEnabled}'>                <button data-binding='{@event-onclick: handleClickMenuFind}{title: @language-geolocate-find}'>                    <img class='list-menu-icon' src='Resources/Images/Icons/geolocate-24.png' alt=' ' />                    <span class='list-menu-details' data-binding='{@text: @language-geolocate-find}'></span>                </button>            </li>            <li class='list-menu-item' data-binding='{@visible: trackingEnabled}'>                <button data-binding='{@event-onclick: handleClickMenuTrack}{title: @language-geolocate-track}'>                    <img class='list-menu-icon' src='Resources/Images/Icons/geolocate-track-24.png' alt=' ' />                    <span class='list-menu-details' data-binding='{@text: @language-geolocate-track}'></span>                </button>            </li>            <li class='list-menu-item' data-binding='{@visible: followingEnabled}'>                <button data-binding='{@event-onclick: handleClickMenuFollow}{title: @language-geolocate-follow}'>                    <img class='list-menu-icon' src='Resources/Images/Icons/geolocate-follow-24.png' alt=' ' />                    <span class='list-menu-details' data-binding='{@text: @language-geolocate-follow}'></span>                </button>            </li>        </ul>    </div></div>";require({cache:{"Mapping/modules/Geolocate/GeolocateModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o}(i.ModuleBase);o.GeolocateModule=a})},"Mapping/modules/Geolocate/GeolocateSpoofer":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeolocateSpoofer=null})},"Mapping/modules/Geolocate/GeolocateStatusView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.handleClickClose=function(e,t,o){this.app.viewManager.deactivateView(this),o&&o.onClose&&o.onClose()},o}(i.ViewBase);o.GeolocateStatusView=a})},"Mapping/modules/Geolocate/GeolocateStatusViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/coordinates/AngleFormat","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/coordinates/CoordinateUtils"],function(t,o,i,a,n,l,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var c=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.status=new a.Observable(""),e.showCoordinates=new a.Observable(!1),e.xValueType=new a.Observable(""),e.yValueType=new a.Observable(""),e.xValue=new a.Observable(""),e.yValue=new a.Observable(""),e.imageUri=new a.Observable(""),e.onClose=null,e}return e(o,t),o.prototype.initialize=function(e){this.config=e,e.coordinateWkid&&(e.coordinateWkid=parseInt(e.coordinateWkid.toString()))},o.prototype.updateStatus=function(e,t){var o=this;if("following"===e?(this.status.set(this.app.getResource(this.libraryId,"language-geolocate-follow-in-progress")),this.imageUri.set(this.config.busyIcon||"Resources/Images/loader-small.gif"),this.showCoordinates.set(this.config.showFollowingCoordinates)):"tracking"===e?(this.status.set(this.app.getResource(this.libraryId,"language-geolocate-track-in-progress")),this.imageUri.set(this.config.busyIcon||"Resources/Images/loader-small.gif"),this.showCoordinates.set(this.config.showTrackingCoordinates)):(this.status.set(""),this.imageUri.set(this.config.geolocateIcon||"Resources/Images/Icons/geolocate-24.png"),this.showCoordinates.set(this.config.showGeolocateCoordinates)),this.showCoordinates)if("xy"===(this.config.coordinateFormat?this.config.coordinateFormat.toLowerCase():n.DD)){this.xValueType.set(this._getCoordinateResource("x")),this.yValueType.set(this._getCoordinateResource("y"));var i=this.config.coordinateWkid||this.app.map.spatialReference.wkid,a=new esri.SpatialReference({wkid:4326}),c=new esri.geometry.Point(t.coords.longitude,t.coords.latitude,a);l.projectGeometry(c,new esri.SpatialReference(i),function(e){o.xValue.set(s.formatXYCoordinate(e.x,o.app,o.config.coordinateFractionalDigits)),o.yValue.set(s.formatXYCoordinate(e.y,o.app,o.config.coordinateFractionalDigits))},function(e){o.app.trace.warning("Unable to project geometry for coordinate tracking: "+e),o.xValue.set(o.getResource("language-geolocate-error-cannot-convert-coordinate")),o.yValue.set(o.getResource("language-geolocate-error-cannot-convert-coordinate"))},this.app)}else{var r=s.formatLatLon(t.coords.latitude,t.coords.longitude,this.config.coordinateFormat,this.app,this.config.coordinateFractionalDigits);this.xValueType.set(this._getCoordinateResource("latitude-abbrev")),this.yValueType.set(this._getCoordinateResource("longitude-abbrev")),this.xValue.set(r.latitude),this.yValue.set(r.longitude)}},o.prototype._getCoordinateResource=function(e){return this.app.getResource("Mapping.Infrastructure","language-coordinates-"+e)},o}(i.ViewModelBase);o.GeolocateStatusViewModel=c})},"Mapping/modules/Geolocate/GeolocateView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,o,i){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.deactivateGeolocateMenuView=function(){this.app.event("FlyoutDeactivated").publish(this),this.app.command("DeactivateView").execute("GeolocateView")},o.prototype.handleClickGeolocate=function(e,t,o){var i=this;if(this.viewModel.isTracking.get()||this.viewModel.isFollowing.get())return this.app.command("GeolocateStop").execute(),!1;if(1===this.viewModel.optionsCount.get()){if(this.viewModel.geolocateEnabled.get())return this.app.command("Geolocate").execute(),!1;if(this.viewModel.trackingEnabled.get())return this.app.command("GeolocateTrack").execute(),!1;if(this.viewModel.followingEnabled.get())return this.app.command("GeolocateFollow").execute(),!1}else if(this.app.event("FlyoutActivated").publish(this),this.app.configuration.mobileMode)this.app.command("ActivateView").execute("GeolocateView");else{var a={view:this,onOtherInteracted:function(e){return i._onOtherInteracted(e)}};this.app.command("TapToDismiss").execute(a),this.app.command("ToggleView").execute("GeolocateView")}},o.prototype.handleClickMenuFind=function(e,t,o){return this.app.command("Geolocate").execute(),this.deactivateGeolocateMenuView(),!1},o.prototype.handleClickMenuTrack=function(e,t,o){return this.app.command("GeolocateTrack").execute(),this.deactivateGeolocateMenuView(),!1},o.prototype.handleClickMenuFollow=function(e,t,o){return this.app.command("GeolocateFollow").execute(),this.deactivateGeolocateMenuView(),!1},o.prototype._onOtherInteracted=function(e){var t=$(e.target||e.srcElement);t.hasClass("geolocate-base")&&t.hasClass("toggle-btn")||this.deactivateGeolocateMenuView()},o}(i.ViewBase);o.GeolocateView=a})},"Mapping/modules/Geolocate/GeolocateViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/eventArgs/GeolocationEventArgs","./GeolocateSpoofer","geocortex/infrastructure/commandArgs/AddStatusArgs","geocortex/infrastructure/GeometryUtils","geocortex/infrastructure/GraphicsLayerIds","geocortex/infrastructure/GraphicsLayerUtils"],function(t,o,i,a,n,l,s,c,r,g){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var d=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.visible=new a.Observable(!0),e.geolocateEnabled=new a.Observable(!1),e.geolocateWatchId=new a.Observable(null),e.geolocateOptions={},e.trackingEnabled=new a.Observable(!1),e.followingEnabled=new a.Observable(!1),e.adjustExtentZoomOnGeolocate=new a.Observable(!0),e.geolocateExtentZoomLevel=new a.Observable(null),e.geolocateAccuracyCircleEnabled=new a.Observable(!0),e.optionsCount=new a.Observable(0),e.isSingle=new a.Observable(!1),e.isTracking=new a.Observable(!1),e.isFollowing=new a.Observable(!1),e.accuracyCircle=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([42,84,155,.65]),2),new esri.Color([42,84,155,.35])),e.indicatorIcon=null,e.mapZoomEndEventId=new a.Observable(null),e.activeToolChangedEventId=new a.Observable(null),e._geolocationTriggered=!1,e.lastProjectedPoint=null,e.singleGeolocationProfiles={},e.singleGeolocationFallbackProfile={accuracyThreshold:10,timeLimit:3e4},e}return e(o,t),o.prototype.initialize=function(e){if(this._registerCommands(),e&&(this.geolocateEnabled.set(e.geolocateEnabled||!1),this.trackingEnabled.set(e.trackingEnabled||!1),this.followingEnabled.set(e.followingEnabled||!1),this.geolocateOptions.enableHighAccuracy=!e.hasOwnProperty("enableHighAccuracy")||e.enableHighAccuracy,this.geolocateOptions.timeout=e.hasOwnProperty("timeout")?e.timeout:4e9,this.geolocateOptions.maximumAge=e.maximumAge||0,e.hasOwnProperty("singleGeolocationProfiles")))for(var t in e.singleGeolocationProfiles)this.singleGeolocationProfiles[t]=e.singleGeolocationProfiles[t];this.geolocateEnabled.get()||this.trackingEnabled.get()||this.followingEnabled.get()||this.visible.set(!1),navigator.geolocation?(void 0!==e.adjustExtentZoomOnGeolocate?this.adjustExtentZoomOnGeolocate.set(e.adjustExtentZoomOnGeolocate):this.adjustExtentZoomOnGeolocate.set(!0),void 0!==e.geolocateExtentZoomLevel?this.geolocateExtentZoomLevel.set(e.geolocateExtentZoomLevel):this.geolocateExtentZoomLevel.set(5e4),void 0!==e.geolocateAccuracyCircleEnabled?this.geolocateAccuracyCircleEnabled.set(e.geolocateAccuracyCircleEnabled):this.geolocateAccuracyCircleEnabled.set(!0),void 0!==e.geolocationIndicator&&(this.indicatorIcon=new esri.symbol.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:e.geolocationIndicator,contentType:"image/png",width:24,height:24}),null==this.indicatorIcon&&(this.indicatorIcon=new esri.symbol.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:"Resources/Images/Icons/geolocate-position-32.png",contentType:"image/png",width:24,height:24}))),navigator.geolocation?(this.app.event("SiteInitializedEvent").once(this,this._handleGeolocateStateChanged),this.app.event("ApplicationOnlineEvent").subscribe(this,this._handleGeolocateStateChanged),this.app.event("ApplicationOfflineEvent").subscribe(this,this._handleGeolocateStateChanged),this.app.event("NativeApplicationReady").subscribe(this,this._handleGeolocateStateChanged)):this.visible.set(!1),this.optionsCount.set(this.geolocateEnabled.get()?this.optionsCount.get()+1:this.optionsCount.get()),this.optionsCount.set(this.followingEnabled.get()?this.optionsCount.get()+1:this.optionsCount.get()),this.optionsCount.set(this.trackingEnabled.get()?this.optionsCount.get()+1:this.optionsCount.get())):this.visible.set(!1)},o.prototype._registerCommands=function(){var e=this;this.app.command("ShowGeolocateMenu").register(this,function(){e.app.command("ActivateView").execute("GeolocateView")},function(){return e.visible.get()}),this.app.command("Geolocate").register(this,this._geolocate),this.app.command("GeolocateTrack").register(this,this._geolocateTrack),this.app.command("GeolocateFollow").register(this,this._geolocateFollow),this.app.command("GeolocateStop").register(this,this._stopGeolocation),this.app.command("GeolocateShowBuffer").register(this,this._showBuffer),this.app.command("GeolocateHideBuffer").register(this,this._hideBuffer)},o.prototype._handleGeolocateStateChanged=function(){var e=this,t=this.app.map,o=this.app.isOffline.get();this._geolocateIsEnabled()?this.app.isNative.get()?this._setVisibilityForNativeApp(t):o?t.loaded?this._checkSpatialReferencesAndSetVisibility(t):t.loaded||this.app.event("MapLoadedEvent").once(this,function(t){return e._checkSpatialReferencesAndSetVisibility(t)}):this.visible.set(!0):this.visible.set(!1)},o.prototype._checkSpatialReferencesAndSetVisibility=function(e){this._geolocateIsEnabled()?(!e.spatialReference||102100!==e.spatialReference.wkid&&e.spatialReference.wkid,this.visible.set(!1)):this.visible.set(!1)},o.prototype._setVisibilityForNativeApp=function(e){var t=this;if(this._geolocateIsEnabled()){var o=function(e){!e.spatialReference||102100!==e.spatialReference.wkid&&4326!==e.spatialReference.wkid?e.spatialReference?t.app.command("NativeHasCapability").execute("project",function(e){return t.visible.set(e)}):t.visible.set(!1):t.visible.set(!0)};e.loaded?o(e):this.app.event("MapLoadedEvent").once(this,function(e){return o(e)})}else this.visible.set(!1)},o.prototype._geolocateIsEnabled=function(){return this.geolocateEnabled.get()||this.trackingEnabled.get()||this.followingEnabled.get()},o.prototype._geolocate=function(e){this._stopGeolocation(),!!(e&&"toolFriendly"in e)&&e.toolFriendly||this.app.command("ClearActiveTool").execute(),this.singleGeolocationAccuracyThreshold=this.singleGeolocationFallbackProfile.accuracyThreshold,this.singleGeolocationTimeLimit=this.singleGeolocationFallbackProfile.timeLimit;var t=e&&e.profile?e.profile:"default";t in this.singleGeolocationProfiles?("accuracyThreshold"in this.singleGeolocationProfiles[t]&&(this.singleGeolocationAccuracyThreshold=this.singleGeolocationProfiles[t].accuracyThreshold),"timeLimit"in this.singleGeolocationProfiles[t]&&(this.singleGeolocationTimeLimit=this.singleGeolocationProfiles[t].timeLimit)):console.error("Single geolocation profile named '"+t+"' was not found. Fallback values will be used"),e&&"accuracyThreshold"in e&&(this.singleGeolocationAccuracyThreshold=e.accuracyThreshold),e&&"timeLimit"in e&&(this.singleGeolocationTimeLimit=e.timeLimit),this.isSingle.set(!0),this._initializeGeolocation()},o.prototype._geolocateTrack=function(){this.app.command("ClearActiveTool").execute(),this._stopGeolocation(),this.isTracking.set(!0),this._initializeGeolocation()},o.prototype._geolocateFollow=function(){var e=this;this.app.command("ClearActiveTool").execute(),this._stopGeolocation(),this.isFollowing.set(!0),this.app.map.disablePan(),this.mapZoomEndEventId.set(this.app.event("MapZoomEndEvent").subscribe(this,function(){l.GeolocateSpoofer||navigator.geolocation;e.app.map.enablePan(),e.lastProjectedPoint&&e.app.command("PanToPoint").execute(e.lastProjectedPoint),e.isFollowing.get()&&e.app.map.disablePan()})),this._initializeGeolocation()},o.prototype._initializeGeolocation=function(){var e=this,t=l.GeolocateSpoofer||navigator.geolocation;if(navigator&&t){this.geolocateWatchId.get()&&t&&(t.clearWatch(this.geolocateWatchId.get()),this.geolocateWatchId.set(0)),this.activeToolChangedEventId.set(this.app.event("ActiveToolChanged").subscribe(this,function(){e._stopGeolocation(!0)})),this.isSingle.get()&&(this.singleGeolocationBestEventPayload=null,this.singleGeolocatedEventAlreadyPublished=!1,this.singleGeolocationTimeoutId&&(clearTimeout(this.singleGeolocationTimeoutId),this.singleGeolocationTimeoutId=null),this.singleGeolocationTimeoutId=setTimeout(function(){e._haltSingleGeolocation(!0)},this.singleGeolocationTimeLimit)),this.geolocationLayer=g.getInternalGraphicsLayer(r.GEOLOCATION_LAYER_ID,this.app,g.GraphicsLayerType.Pushpin),this.geolocationLayer.clear(),this._showBusyLocating(!0);var o=(t=l.GeolocateSpoofer||navigator.geolocation).watchPosition(function(t){return e._handleGeolocationResult(t)},function(t){return e._handleGeolocationError(t)},this.geolocateOptions);this.geolocateWatchId.set(o)}else{var i=this.app.getResource(this.libraryId,"language-geolocate-error"),a=this.app.getResource(this.libraryId,"language-geolocate-error-browser");this.app.command("Alert").execute(a,i)}},o.prototype._showBusyLocating=function(e){var t=this;if(e){var o=this.app.getResource(this.libraryId,"language-geolocate-in-progress"),i=new s.AddStatusArgs(o,null,this.isSingle.get()?function(){t._haltSingleGeolocation()}:function(){t._stopGeolocation()});i.showBusyIcon=!0,i.timeoutMS=0,this.app.command("AddStatus").execute(i)}else this.app.command("RemoveStatus").execute("")},o.prototype._hideBuffer=function(){this.accuracyGraphic&&this.geolocationLayer.remove(this.accuracyGraphic),this.indicatorGraphic&&this.geolocationLayer.remove(this.indicatorGraphic)},o.prototype._showBuffer=function(){this.accuracyGraphic&&this.geolocationLayer.add(this.accuracyGraphic),this.indicatorGraphic&&this.geolocationLayer.add(this.indicatorGraphic)},o.prototype._handleGeolocationResult=function(e){var t=this;if(e&&e.coords){var o=new esri.SpatialReference({wkid:4326}),i=new esri.SpatialReference({wkid:102100}),a=new esri.geometry.Point(e.coords.longitude,e.coords.latitude,o),s=esri.geometry.geographicToWebMercator(a),r=c.createCircle(i,s,e.coords.accuracy,60),g=new esri.tasks.ProjectParameters;g.geometries=[r],g.outSR=this.app.map.spatialReference;var d=function(e){t._showBusyLocating(!1),t._stopGeolocation();var o;o=t.app.isOffline.get()?t.getResource("language-geolocate-error-offline"):t.getResource("language-geolocate-error-projection").format(e.message),t.app.trace.warning(e.toString()),t.app.command("Alert").execute(o)};c.project(g,function(o){var i=o&&o.length>0?o[0]:null,a=i?i.getExtent():null,c=a?a.getCenter():null,r=new n.GeolocationEventArgs;r.mapPoint=s,r.projectedMapPoint=c,r.location=e,r.accuracyThreshold=t.singleGeolocationAccuracyThreshold,t.isFollowing.get()?r.typeOfGeolocation="following":t.isTracking.get()?r.typeOfGeolocation="tracking":r.typeOfGeolocation="single",(t.isFollowing.get()||t.isTracking.get())&&t.app.event("GeolocatedEvent").publish(r),t.isSingle.get()&&((!t.singleGeolocationBestEventPayload||r.location.coords.accuracy<=t.singleGeolocationBestEventPayload.location.coords.accuracy)&&(t.singleGeolocationBestEventPayload=r),(r=t.singleGeolocationBestEventPayload).location.coords.accuracy<=t.singleGeolocationAccuracyThreshold&&(clearTimeout(t.singleGeolocationTimeoutId),t.singleGeolocationTimeoutId=null,t._showBusyLocating(!1),t._updateStatus(r.location),null!==t.geolocateWatchId.get()&&((l.GeolocateSpoofer||navigator.geolocation).clearWatch(t.geolocateWatchId.get()),t.geolocateWatchId.set(null)),t.app.event("GeolocatedEvent").publish(r),t.singleGeolocatedEventAlreadyPublished=!0)),t.isTracking.get()||t._geolocationTriggered||!t.adjustExtentZoomOnGeolocate.get()||t.app.map.setScale(t.geolocateExtentZoomLevel.get()),i&&c?(t.lastProjectedPoint=c,t.isTracking.get()||(t.app.map.enablePan(),t.app.command("PanToPoint").execute(c),t.isFollowing.get()&&t.app.map.disablePan()),t._geolocationTriggered?(t.indicatorGraphic.setGeometry(c),t.geolocateAccuracyCircleEnabled.get()&&t.accuracyGraphic.setGeometry(i)):(t._geolocationTriggered=!0,(t.isFollowing.get()||t.isTracking.get())&&t._showBusyLocating(!1),t.indicatorGraphic||(t.indicatorGraphic=new esri.Graphic(c,t.indicatorIcon),t.accuracyGraphic=new esri.Graphic(i,t.accuracyCircle)),t.geolocationLayer.add(t.indicatorGraphic),t.geolocateAccuracyCircleEnabled.get()?(t.accuracyGraphic.setGeometry(i),t.geolocationLayer.add(t.accuracyGraphic)):t.geolocationLayer.remove(t.accuracyGraphic)),(t.isFollowing.get()||t.isTracking.get())&&t._updateStatus(e),t.app.map.on("click",function(e){t.accuracyGraphic!==e.graphic&&t.indicatorGraphic!=e.graphic||(t.geolocationLayer.remove(t.accuracyGraphic),t.isFollowing.get()||t.isTracking.get()||t._stopGeolocation())})):d(new Error("Cannot add the indicators and status message to the map without a proper geometry."))},d,this.app)}},o.prototype._handleGeolocationError=function(e){var t,o=this,i=function(e,t,i){void 0===i&&(i=!1);var a=""+o.getResource("language-geolocate-error")+e;o.app.trace.warning(a+": "+t),i||o.app.command("Alert").execute(t)};switch(e.code){case e.PERMISSION_DENIED:t="language-geolocate-error-permission";break;case e.POSITION_UNAVAILABLE:t="language-geolocate-error-position-unavailable";break;case e.TIMEOUT:t="language-geolocate-error-timeout";break;default:t="language-geolocate-error-unknown"}e.code===e.POSITION_UNAVAILABLE&&e.message&&1!==e.message.toLowerCase().indexOf("kclerrordomain error 0")?i(this.getResource(t),e.message,!0):(this._showBusyLocating(!1),this._stopGeolocation(),this.app.event("GeolocationFailedEvent").publish({error:e,isFollowing:this.isFollowing.get(),isTracking:this.isTracking.get()}),i(this.getResource(t),e.message))},o.prototype._haltSingleGeolocation=function(e){void 0===e&&(e=!1);var t=this.geolocateWatchId.get(),o=l.GeolocateSpoofer||navigator.geolocation;if(null!==t&&o&&(o.clearWatch(t),this.geolocateWatchId.set(null)),this.singleGeolocationTimeoutId&&(clearTimeout(this.singleGeolocationTimeoutId),this.singleGeolocationTimeoutId=null),this.singleGeolocationBestEventPayload){if(this._showBusyLocating(!1),this._updateStatus(this.singleGeolocationBestEventPayload.location),!this.singleGeolocatedEventAlreadyPublished){var i=this.singleGeolocationBestEventPayload;i.timedOut=e,this.app.event("GeolocatedEvent").publish(i),this.singleGeolocatedEventAlreadyPublished=!0}}else this._stopGeolocation(),this.app.command("Alert").execute(this.app.getResource(this.libraryId,"language-geolocate-error-no-results"),this.app.getResource(this.libraryId,"language-geolocate-title"))},o.prototype._stopGeolocation=function(e){void 0==e&&(e=!1);var t=l.GeolocateSpoofer||navigator.geolocation;null!==this.geolocateWatchId.get()&&t&&(t.clearWatch(this.geolocateWatchId.get()),this.geolocateWatchId.set(null)),this.singleGeolocationTimeoutId&&(clearTimeout(this.singleGeolocationTimeoutId),this.singleGeolocationTimeoutId=null),this.lastProjectedPoint=null,this.app.event("MapZoomEndEvent").unsubscribe(this.mapZoomEndEventId.get()),this.app.event("ActiveToolChanged").unsubscribe(this.activeToolChangedEventId.get()),g.removeInternalGraphicsLayer(r.GEOLOCATION_LAYER_ID,this.app,g.GraphicsLayerType.Pushpin),this._geolocationTriggered=!1,this.isSingle.set(!1),this.isTracking.set(!1),this.isFollowing.set(!1),this.app.command("RemoveStatus").execute(""),e||this.app.map.enableMapNavigation(),this.app.command("DeactivateView").execute("GeolocateStatusView")},o.prototype._updateStatus=function(e){var t=this,o=this.app.viewManager.getViewById("GeolocateStatusView");if(o){o.viewModel.onClose=function(){t._stopGeolocation()};var i;this.isSingle.get()?i="single":this.isTracking.get()?i="tracking":this.isFollowing.get()&&(i="following"),o.viewModel.updateStatus(i,e),o.viewModel.status.get()||o.viewModel.showCoordinates.get()?this.app.viewManager.activateView(o):this.app.viewManager.deactivateView(o)}},o}(i.ViewModelBase);o.GeolocateViewModel=d})},"url:/Mapping/modules/Geolocate/GeolocateButtonView.html":t,"url:/Mapping/modules/Geolocate/GeolocateStatusView.html":o,"url:/Mapping/modules/Geolocate/GeolocateView.html":i}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/CSS/common.css","css","LyogU1RBUlQ6IEdlb2xvY2F0ZSAtLS0tLS0tLS0tLS0tLS0gKi8NCi5yZWdpb24ubWFwLWJvdHRvbS1sZWZ0IC5HZW9sb2NhdGVCdXR0b25WaWV3IC56b29tLWNvbnRyb2wtYnRuIGJ1dHRvbiB7DQogICAgd2lkdGg6IDMuNWVtOw0KICAgIGhlaWdodDogMy41ZW07DQp9DQoubm8tdG91Y2ggLnJlZ2lvbi5tYXAtYm90dG9tLWxlZnQgLkdlb2xvY2F0ZUJ1dHRvblZpZXcgLnpvb20tY29udHJvbC1idG4gYnV0dG9uIHsNCiAgICB3aWR0aDogMi43NWVtOw0KICAgIGhlaWdodDogMi43NWVtOw0KfQ0KLmdlb2xvY2F0ZS1jb250YWluZXIgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDBweDsNCiAgICBsZWZ0OiAzLjVlbTsNCiAgICBib3JkZXItcmFkaXVzOiAwIDAuMjVyZW0gMCAwOw0KfQ0KLm5vLXRvdWNoIC5nZW9sb2NhdGUtY29udGFpbmVyIHsNCiAgICBsZWZ0OiAyLjc1ZW07DQp9DQouZ2VvbG9jYXRlLXdyYXBwZXIgew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCi5nZW9sb2NhdGUtYmFzZSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIHotaW5kZXg6IDk5Ow0KICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9nZW9sb2NhdGUtMjQucG5nIik7DQogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCn0NCi5nZW9sb2NhdGUtdHJhY2tpbmcgLmdlb2xvY2F0ZS1iYXNlIHsNCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIlJlc291cmNlcy9JbWFnZXMvSWNvbnMvZ2VvbG9jYXRlLXRyYWNrLWFjdGl2ZS0yNC5wbmciKTsNCn0NCi5nZW9sb2NhdGUtZm9sbG93aW5nIC5nZW9sb2NhdGUtYmFzZSB7DQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2dlb2xvY2F0ZS1mb2xsb3ctYWN0aXZlLTI0LnBuZyIpOw0KfQ0KLmdlb2xvY2F0ZS10aXRsZSB7DQogICAgY29sb3I6ICM5NTkzOTg7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBjdXJzb3I6IGRlZmF1bHQ7DQogICAgZm9udC1zaXplOiAxLjNlbTsNCiAgICBsaW5lLWhlaWdodDogMi41NWVtOw0KICAgIGJhY2tncm91bmQ6ICAjRkZGRkZGOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICNEOUQ5RDk7DQogICAgYm9yZGVyLXJhZGl1czogMCAwLjI1cmVtIDAgMDsNCiAgICB3aWR0aDogMTVlbTsNCiAgICBtYXJnaW46IDAgMC4yNWVtOw0KICAgIHBvc2l0aW9uOnJlbGF0aXZlOw0KICAgIHotaW5kZXg6NTUwOw0KfQ0KLmdlb2xvY2F0ZS1saXN0IC5oYXMtaWNvbiAubGlzdC1tZW51LWRldGFpbHMgew0KICAgIG1hcmdpbi1sZWZ0OiAyLjVlbTsNCiAgICBwYWRkaW5nLWxlZnQ6IDA7DQogICAgd2lkdGg6IDE1ZW07DQogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsNCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCn0NCi56b29tLWNvbnRyb2wtYnRuLmdlb2xvY2F0ZS5nZW9sb2NhdGUtYWN0aXZlIHsNCg0KICAgIGJvcmRlci1yYWRpdXM6IDAuMjVyZW0gMCAwIDAuMjVyZW07DQogICAgYm9yZGVyLXJpZ2h0OiBub25lOw0KICAgIHpvb206IDE7DQoJZmlsdGVyOiBhbHBoYShvcGFjaXR5PTEwMCk7DQoJb3BhY2l0eTogMTsNCn0NCi5nZW9sb2NhdGUtbGlzdCB7DQogICAgbWFyZ2luOiAwIDAuMzNlbSAwLjM1ZW0gMC44ZW07DQogICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjRDlEOUQ5Ow0KICAgIGJvcmRlci10b3A6IG5vbmU7DQogICAgYm9yZGVyLXJhZGl1czogMCAwIDAuMjVyZW0gMC4yNXJlbTsNCiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsNCiAgICB6LWluZGV4OjU1MDsNCn0NCg0KLmdlb2xvY2F0ZS1zdGF0dXMgew0KICAgIG1hcmdpbjogMC43NWVtOw0KfQ0KLmdlb2xvY2F0ZS1zdGF0dXMtd2luZG93IC5jb29yZHMtZGlzcGxheSB7DQogICAgbWFyZ2luLWJvdHRvbTogMC43NWVtOw0KfQ0KLyogRU5EOiBHZW9sb2NhdGUgLS0tLS0tLS0tLS0tLS0tICov"),e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/CSS/large.css","css","LyogU1RBUlQ6IEdlb2xvY2F0ZSAtLS0tLS0tLS0tLS0tLS0gKi8NCg0KLmdlb2xvY2F0ZS1saXN0IGJ1dHRvbiB7DQogICAgYmFja2dyb3VuZDogbm9uZTsNCiAgICBib3JkZXI6IDA7DQogICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICBtYXJnaW46IDA7DQogICAgcGFkZGluZzogMDsNCiAgICBib3gtc2hhZG93OiBub25lOw0KICAgIGNvbG9yOiAjMDAwMDAwOw0KICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQp9DQoNCi5nZW9sb2NhdGUtbGlzdCBidXR0b246aG92ZXIgew0KICAgIGJvcmRlcjogMDsNCiAgICBwYWRkaW5nOiAwOw0KICAgIGJveC1zaGFkb3c6IG5vbmU7DQp9DQoNCi5nZW9sb2NhdGUtbGlzdCAubGlzdC1tZW51LWl0ZW06Zmlyc3QtY2hpbGQgew0KICAgIC13ZWJraXQtYm9yZGVyLXJhZGl1czogMCAzcHggMCAwOw0KICAgIC1tb3otYm9yZGVyLXJhZGl1czogMCAzcHggMCAwOw0KICAgIGJvcmRlci1yYWRpdXM6IDAgM3B4IDAgMDsNCn0NCg0KLmdlb2xvY2F0ZS1saXN0IC5saXN0LW1lbnUtaXRlbTpsYXN0LWNoaWxkIHsNCiAgICAtd2Via2l0LWJvcmRlci1yYWRpdXM6IDAgMCAzcHggM3B4Ow0KICAgIC1tb3otYm9yZGVyLXJhZGl1czogMCAwIDNweCAzcHg7DQogICAgYm9yZGVyLXJhZGl1czogMCAwIDNweCAzcHg7DQp9DQoNCi5nZW9sb2NhdGUtbGlzdCBsaTpob3ZlciB7DQogICAgYmFja2dyb3VuZDogI0VFRTsNCn0NCg0KLmxpc3QtbWVudS1pdGVtIHNwYW4sDQoubGlzdC1tZW51LWl0ZW0gYSB7DQogICAgbGluZS1oZWlnaHQ6IDEuNmVtOw0KfQ0KLyogRU5EOiBHZW9sb2NhdGUgLS0tLS0tLS0tLS0tLS0tICovDQo="),e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/CSS/medium.css","css","LyogU1RBUlQ6IEdlb2xvY2F0ZSAtLS0tLS0tLS0tLS0tLS0gKi8NCi5nZW9sb2NhdGUtbGlzdCAubGlzdC1tZW51LWl0ZW06Zmlyc3QtY2hpbGQgew0KICAgIGJvcmRlci1yYWRpdXM6IDAgMC4yNXJlbSAwIDA7DQp9DQouZ2VvbG9jYXRlLWxpc3QgLmxpc3QtbWVudS1pdGVtOmxhc3QtY2hpbGQgew0KICAgIGJvcmRlci1yYWRpdXM6IDAgMCAwLjI1cmVtIDAuMjVyZW07DQp9DQoubGlzdC1tZW51LWl0ZW0gc3BhbiwNCi5saXN0LW1lbnUtaXRlbSBhIHsNCiAgICBsaW5lLWhlaWdodDogMS42ZW07DQp9DQovKiBFTkQ6IEdlb2xvY2F0ZSAtLS0tLS0tLS0tLS0tLS0gKi8="),e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/CSS/small.css","css","LyogU1RBUlQ6IEdlb2xvY2F0ZSAtLS0tLS0tLS0tLS0tLS0gKi8NCi5nZW9sb2NhdGUtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogc3RhdGljOw0KICAgIGJvcmRlci1yYWRpdXM6IDA7DQp9DQouZ2VvbG9jYXRlLXRpdGxlIHsNCiAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQp9DQouZ2VvbG9jYXRlLWxpc3Qgew0KICAgIG1hcmdpbjogMDsNCiAgICBib3JkZXI6IDA7DQp9DQouZ2VvbG9jYXRlLWxpc3QgbGkgew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCi5nZW9sb2NhdGUtbGlzdCAubGlzdC1tZW51LWl0ZW0gLmxpc3QtbWVudS1pY29uIHsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgdG9wOiAwOw0KICAgIGxlZnQ6IDA7DQogICAgcGFkZGluZzogMWVtOw0KICAgIHdpZHRoOiAxNnB4Ow0KICAgIGhlaWdodDogMTZweDsNCiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOw0KfQ0KLmxpc3QtbWVudS1pdGVtIHNwYW4sDQoubGlzdC1tZW51LWl0ZW0gYSB7DQogICAgbGluZS1oZWlnaHQ6IDEuMmVtOw0KfQ0KLmdlb2xvY2F0ZS13cmFwcGVyIC56b29tLWNvbnRyb2wtYnRuIHsNCiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsNCn0NCi8qIEVORDogR2VvbG9jYXRlIC0tLS0tLS0tLS0tLS0tLSAqLw=="),e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/GeolocateButtonView.html","html",t),e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/GeolocateStatusView.html","html",o),e.resourceManager.register("Mapping","inv","Mapping/modules/Geolocate/GeolocateView.html","html",i)}),require({cache:{}}),define(["Mapping/modules/Geolocate/GeolocateModule","Mapping/modules/Geolocate/GeolocateSpoofer","Mapping/modules/Geolocate/GeolocateStatusView","Mapping/modules/Geolocate/GeolocateStatusViewModel","Mapping/modules/Geolocate/GeolocateView","Mapping/modules/Geolocate/GeolocateViewModel"],function(t,o,i,a,n,l){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.geolocate.GeolocateModule",t.GeolocateModule),e(o,"geocortex.essentialsHtmlViewer.mapping.modules.geolocate.GeolocateSpoofer",o.GeolocateSpoofer),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.geolocate.GeolocateStatusView",i.GeolocateStatusView),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.geolocate.GeolocateStatusViewModel",a.GeolocateStatusViewModel),e(n,"geocortex.essentialsHtmlViewer.mapping.modules.geolocate.GeolocateView",n.GeolocateView),e(l,"geocortex.essentialsHtmlViewer.mapping.modules.geolocate.GeolocateViewModel",l.GeolocateViewModel)})}();