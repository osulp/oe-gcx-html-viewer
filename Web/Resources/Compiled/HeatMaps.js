!function(){function e(e,t,a){if("string"==typeof e&&(a=t,t=e),void 0!==a)for(var i=t.split("."),r=null,n=window,s=0,o=i.length;s<o;s++)r=i[s],s==o-1?n[r]=a:n[r]||(n[r]={}),n=n[r];else console.warn("Undefined shim for: "+t)}var t="<div class='heat-maps form-stacked'>    <h2 class='visualization-title' data-binding='{@text: @language-heat-maps-title}'></h2>    <div class='form-item'>        <label class='form-label' data-binding='{@text: @language-heat-maps-intensity}'></label>        <div class='slider-container'>            <div class='slider-label slider-label-min' data-binding='{@text: @language-heat-maps-intensity-slider-min-label}'></div>            <div class='slider-label slider-label-max' data-binding='{@text: @language-heat-maps-intensity-slider-max-label}'></div>            <div class='intensity-slider' data-binding='{@var: sliderElement}'>                <div class='slider-label slider-label-current'></div>            </div>        </div>    </div>    <div class='form-item'>        <label for='heatmapsViewField' data-binding='{@text: @language-heat-maps-intensity-multiplier}'></label>        <select id='heatmapsViewField' data-binding='{@source: fields}{@value: selectedField}{@disabled: disableFields}{title: @language-heat-maps-intensity-multiplier}'>            <option data-binding='{@template-for: fields}{@text: displayName}{value: name}'></option>        </select>    </div></div>";require({cache:{"Mapping/modules/HeatMaps/FieldListItem":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/HeatMaps/GradientOptions":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/HeatMaps/HeatMapsModule":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/application/ModuleBase","geocortex/infrastructure/VisualizationUtils","geocortex/infrastructure/ColorUtils"],function(t,a,i,r,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s;!function(e){e[e.OUTERMOST=0]="OUTERMOST",e[e.OUTER=1]="OUTER",e[e.INNER=2]="INNER",e[e.INNERMOST=3]="INNERMOST"}(s=a.GradientColorType||(a.GradientColorType={}));var o=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e._allowToggleForUserAddedLayers=!0,e._defaultIntensity=30,e._defaultGradient=["#00FFFFFF","#FF0000FF","#FFFF0000","#FFFFFF00"],e}return e(a,t),a.prototype.initialize=function(e){var a=this;if(t.prototype.initialize.call(this,e),Modernizr.canvas){if(null!=e.allowToggleForUserAddedLayers&&(this._allowToggleForUserAddedLayers=e.allowToggleForUserAddedLayers),e.intensity&&(this._defaultIntensity=e.intensity),e.gradientOptions){var i=e.gradientOptions;i.outermostColor&&(this._defaultGradient[s.OUTERMOST]=i.outermostColor),i.outerColor&&(this._defaultGradient[s.OUTER]=i.outerColor),i.innerColor&&(this._defaultGradient[s.INNER]=i.innerColor),i.innermostColor&&(this._defaultGradient[s.INNERMOST]=i.innermostColor)}this.app.waitUntilMapLoaded().then(function(){a._handleMapLoaded(a.app.map)}),this._registerCommandsAndEvents()}else this.app.trace.warning("The heat map module requires a Canvas enabled Browser. IE8 does not support Canvas.")},a.prototype._handleMapLoaded=function(e){var t=this.app.site;if(t&&t.essentialsMap)for(var a=0,i=t.essentialsMap.mapServices;a<i.length;a++){var r=i[a];if(r.heatMap&&r.heatMap.enabled)for(var n=0,s=r.layers;n<s.length;n++){var o=s[n];this.app.command("AddHeatMap").execute({gcxLayer:o,onStartUp:!0})}}},a.prototype._registerCommandsAndEvents=function(){this.app.command("AddHeatMap").register(this,this._executeAddHeatMap,this._canExecuteAddHeatMap),this.app.command("RemoveHeatMap").register(this,this._executeRemoveHeatMap,this._canExecuteRemoveHeatMap)},a.prototype._executeAddHeatMap=function(e){var t=this._getGeocortexLayer(e),a=r.getFeatureHeatMap(t),i=this._createHeatMapRenderer(a);if(i){var n=t.mapService.serviceLayer;n&&n instanceof esri.layers.GraphicsLayer?(!e.onStartUp&&this.app.applicationReady&&0===this.app.pendingModulesForCommand("RemoveVisualization").length&&this.app.command("RemoveVisualization").execute({gcxLayer:t}),a.enabled=!0,a.respectScaleRange||(a.defaultMaxScale=n.maxScale?n.maxScale:0,a.defaultMinScale=n.minScale?n.minScale:0,n.setMaxScale(0),n.setMinScale(0)),a.defaultRenderer=n.renderer,n.setRenderer(i),this.app.command("AddHeatMap").raiseCanExecuteChanged(),this.app.command("RemoveHeatMap").raiseCanExecuteChanged(),this.app.event("HeatMapAddedEvent").publish(t),this.app.event("LayerVisualizationChangedEvent").publish(t)):this.app.trace.warning("Could not add heat map for layer with ID '{0}'. Heat map requires a graphics layer".format(t.id))}else this.app.trace.warning("Could not add heat map for layer with ID '{0}'. Invalid renderer configuration".format(t.id))},a.prototype._canExecuteAddHeatMap=function(e){if("string"!=typeof e&&e.onStartUp)return!0;var t=this._getGeocortexLayer(e);return!!(t&&t.mapService&&t.mapService.heatMap)&&!t.mapService.heatMap.enabled},a.prototype._executeRemoveHeatMap=function(e){var t=this._getGeocortexLayer(e),a=r.getFeatureHeatMap(t),i=t.mapService.serviceLayer;if(i&&i instanceof esri.layers.GraphicsLayer){a.enabled=!1;var n=r.getHeatMapRenderer(t);if(n){a.respectScaleRange||(i.setMaxScale(a.defaultMaxScale),i.setMinScale(a.defaultMinScale)),a.intensity=n.blurRadius,a.field=n.field,i.setRenderer(a.defaultRenderer),a.defaultRenderer=null;var s=n._canvas;s.parentNode.removeChild(s),s=null,n=null}this.app.command("AddHeatMap").raiseCanExecuteChanged(),this.app.command("RemoveHeatMap").raiseCanExecuteChanged(),this.app.event("HeatMapRemovedEvent").publish(t),this.app.event("LayerVisualizationChangedEvent").publish(t)}else this.app.trace.warning("Could not remove heat map for layer with ID '{0}'. Heat map requires a graphics layer".format(t.id))},a.prototype._canExecuteRemoveHeatMap=function(e){if("string"!=typeof e&&e.onStartUp)return!0;var t=this._getGeocortexLayer(e);return!!(t&&t.mapService&&t.mapService.heatMap)&&t.mapService.heatMap.enabled},a.prototype._getGeocortexLayer=function(e){return"string"==typeof e?this.app.site&&this.app.site.essentialsMap?this.app.site.essentialsMap.allLayers().filter(function(t){return e===t.mapService.id})[0]:null:e.gcxLayer},a.prototype._createHeatMapRenderer=function(e){if(e){var t=this._getHeatMapColors(e),a=new esri.renderer.HeatmapRenderer({colors:t,blurRadius:e.intensity?e.intensity:this._defaultIntensity,field:e.field?e.field:null});if(e.offset){for(var i=[],r=0;r<e.offset.length;r++)i[r]={ratio:e.offset[r],color:t[r]};a.setColorStops(i)}return a}},a.prototype._getHeatMapColors=function(e){var t=this;return 0===e.gradient.length?this._defaultGradient.map(function(e){return n.getStringFromHex(e)}):e.gradient.map(function(e,a){return n.getStringFromList(e)||n.getStringFromHex(t._defaultGradient[a])})},a}(i.ModuleBase);a.HeatMapsModule=o})},"Mapping/modules/HeatMaps/HeatMapsModuleConfig":function(){define(["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})},"Mapping/modules/HeatMaps/HeatMapsView":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewBase"],function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.sliderElement=null,e.layerName="",e}return e(a,t),a.prototype.attach=function(e){t.prototype.attach.call(this,e),e.selectedLayer.bind(this,this._onSelectedLayerChanged)},a.prototype.added=function(e){t.prototype.added.call(this,e),this._setupJQuerySlider()},a.prototype._onSelectedLayerChanged=function(e){this.layerName=e.displayName,$(this.sliderElement).slider("value",this.viewModel.intensity.get())},a.prototype._setupJQuerySlider=function(){var e=this,t={animate:!1,min:a.SLIDER_MIN_VAL,max:a.SLIDER_MAX_VAL,step:a.SLIDER_STEP_INCREMENT,orientation:"horizontal",value:a.SLIDER_MIN_VAL,change:function(t,a){return e._handleSliderValueChanged(t,a)}};$(this.sliderElement).slider(t);var i=$(this.sliderElement).children(".ui-slider-handle");i.attr("title",this.getResource("language-heat-maps-intensity-slider-tooltip")),i.text(this.getResource("language-heat-maps-intensity-slider-handle"))},a.prototype._handleSliderValueChanged=function(e,t){if(t&&void 0!=t.value){this.viewModel.intensity.set(t.value);var a="{0} {1}: {2} {3}".format(this.layerName,this.app.getResource(this.libraryId,"language-heat-maps-intensity-slider-intensity"),t.value,this.app.getResource(this.libraryId,"language-heat-maps-intensity-slider-pixels"));$(this.sliderElement).children("a").attr("aria-label",a)}},a}(i.ViewBase);r.SLIDER_MIN_VAL=0,r.SLIDER_MAX_VAL=100,r.SLIDER_STEP_INCREMENT=1,a.HeatMapsView=r})},"Mapping/modules/HeatMaps/HeatMapsViewModel":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/framework/ui/ViewModelBase","geocortex/framework/observables","geocortex/infrastructure/VisualizationUtils","geocortex/essentials/Field"],function(t,a,i,r,n,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(t){function a(e,i){var s=t.call(this,e,i)||this;return s._currentHeatMap=null,s.selectedLayer=new r.Observable(null),s.intensity=new r.Observable(null),s.fields=new r.ObservableCollection,s.selectedField=new r.Observable(null),s.disableFields=new r.Observable(!1),s.selectedLayer.bind(s,function(e){s._currentHeatMap=n.getFeatureHeatMap(e),s._currentHeatMap&&(s.fields.set(s._getNumericFields(e)),s.selectedField.set(s._currentHeatMap.field?s._currentHeatMap.field:a.EMPTY_FIELD),s.intensity.set(s._currentHeatMap.intensity))}),s.fields.bind(s,function(e){s.disableFields.set(s.fields.get().length<2)}),s.selectedField.bind(s,function(e){s._currentHeatMap&&s._currentHeatMap.field!==e&&(s._currentHeatMap.field=e)}),s.intensity.bind(s,function(e){s._currentHeatMap&&s._currentHeatMap.intensity!==e&&(s._currentHeatMap.intensity=e)}),s.app.event("VisualizationViewActivatedEvent").subscribe(s,function(e){s.selectedLayer.set(e)}),s}return e(a,t),a.prototype._getNumericFields=function(e){for(var t=e.fields,i=[{name:a.EMPTY_FIELD,displayName:this.app.getResource(this.libraryId,"language-heat-maps-none")}],r=0;r<t.length;r++){var n=t[r];this._isNumericFieldType(n.dataType)&&i.push({name:n.name,displayName:n.displayName})}return 1===i.length&&(i[r].displayName=this.app.getResource(this.libraryId,"language-heat-maps-no-fields")),i},a.prototype._isNumericFieldType=function(e){switch(e){case s.EssentialsFieldTypes.essentialsFieldTypeInteger:case s.EssentialsFieldTypes.essentialsFieldTypeSmallInteger:case s.EssentialsFieldTypes.essentialsFieldTypeSingle:case s.EssentialsFieldTypes.essentialsFieldTypeDouble:return!0}return!1},a}(i.ViewModelBase);o.EMPTY_FIELD="",a.HeatMapsViewModel=o})},"Mapping/modules/HeatMaps/HeatMapVisualizationProvider":function(){var e=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();define(["require","exports","geocortex/infrastructure/visualization/VisualizationProviderBase","geocortex/infrastructure/VisualizationUtils"],function(t,a,i,r){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(t){function a(e,a){var i=t.call(this,e,a)||this;i.displayName=i.app.getResource(a,"language-heat-maps-name");var r={provider:i,name:i.displayName,id:i.displayName};return i.enabledVisualization=r,i.visualizations.push(r),i}return e(a,t),a.prototype.canSupport=function(e){return!!Modernizr.canvas&&(!(!e||!e.mapService)&&(e.mapService.heatMap&&e.mapService.heatMap.userCanToggle))},a.prototype.handleCurrentLayerChanged=function(e){if(Modernizr.canvas){var t=r.getFeatureHeatMap(e);this.isEnabled.set(!!t&&t.enabled),this.isSupported.set(!!t&&t.userCanToggle),this.isEnabled.get()&&(this.enabledVisualization=this.visualizations[0])}},a.prototype.handleActivate=function(){this.app.command("AddHeatMap").execute({gcxLayer:this.currentLayer.get()})},a.prototype.handleApply=function(){var e=this.currentLayer.get(),t=r.getFeatureHeatMap(e),a=r.getHeatMapRenderer(e);if(a){var i=!1;a.blurRadius!==t.intensity&&(a.setBlurRadius(t.intensity),i=!0),a.field!==t.field&&(a.setField(t.field),i=!0),i&&e.mapService.serviceLayer.refresh()}},a}(i.VisualizationProviderBase);a.HeatMapVisualizationProvider=n})},"url:/Mapping/modules/HeatMaps/HeatMapsView.html":t}}),require(["geocortex/framework/resourceManager"],function(e){e.resourceManager.register("Mapping","inv","Mapping/modules/HeatMaps/CSS/common.css","css","LmhlYXQtbWFwcyAuc2xpZGVyLWNvbnRhaW5lciwNCi5oZWF0LW1hcHMgLmludGVuc2l0eS1zbGlkZXIgew0KICAgIGNsZWFyOiBib3RoOw0KfQ0KLmhlYXQtbWFwcyAuc2xpZGVyLWxhYmVsIHsNCiAgICB3aWR0aDogYXV0bzsNCn0NCi5oZWF0LW1hcHMgLnNsaWRlci1sYWJlbC1tYXggew0KICAgIGZsb2F0OiByaWdodDsNCn0="),e.resourceManager.register("Mapping","inv","Mapping/modules/HeatMaps/CSS/large.css","css","LkhlYXRNYXBzVmlldyAudWktc2xpZGVyLWhvcml6b250YWwgLnVpLXNsaWRlci1oYW5kbGUgew0KICAgIHdpZHRoOiAxLjVlbTsNCiAgICBvdmVyZmxvdzogaGlkZGVuOw0KfQ=="),e.resourceManager.register("Mapping","inv","Mapping/modules/HeatMaps/HeatMapsView.html","html",t)}),require({cache:{}}),define(["Mapping/modules/HeatMaps/HeatMapsModule","Mapping/modules/HeatMaps/HeatMapsView","Mapping/modules/HeatMaps/HeatMapsViewModel","Mapping/modules/HeatMaps/HeatMapVisualizationProvider"],function(t,a,i,r){e(t,"geocortex.essentialsHtmlViewer.mapping.modules.heatMaps.GradientColorType",t.GradientColorType),e(t,"geocortex.essentialsHtmlViewer.mapping.modules.heatMaps.HeatMapsModule",t.HeatMapsModule),e(a,"geocortex.essentialsHtmlViewer.mapping.modules.heatMaps.HeatMapsView",a.HeatMapsView),e(i,"geocortex.essentialsHtmlViewer.mapping.modules.heatMaps.HeatMapsViewModel",i.HeatMapsViewModel),e(r,"geocortex.essentialsHtmlViewer.mapping.modules.heatMaps.HeatMapVisualizationProvider",r.HeatMapVisualizationProvider)})}();