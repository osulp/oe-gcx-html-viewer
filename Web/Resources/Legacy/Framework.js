/*
	
	Copyright (c) 2016, Latitude Geographics Group Ltd.
	All rights reserved.
	       
	Redistribution is not permitted. 
	
	Use in binary form, without modification, is permitted provided that neither 
	the name of the organization nor the names of its contributors may be used 
	to endorse or promote products derived from this software without specific 
	prior written permission.
	       
	THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDER ''AS IS'' AND ANY
	EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
	WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
	DISCLAIMED. IN NO EVENT SHALL LATITUDE GEOGRAPHICS GROUP LTD. BE LIABLE FOR ANY
	DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
	LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
	ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/


/* Begin Script: Framework/framework_ts_out.js ------------------------- */ 
var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},geocortex;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i,r){this.app=e,this.name=t,this.event=r,this.commands=i||[],this._wireUpEvent()}return e.prototype.run=function(e){this._executeCommands(e)},e.prototype._wireUpEvent=function(){var e=this;this.event&&(this.eventToken=this.app.event(this.event).subscribe(this,function(t){e._executeCommands(t)}))},e.prototype._executeCommands=function(e){for(var t=0;this.commands&&t<this.commands.length;t++)this.app.command(this.commands[t]).execute(e)},e.prototype.destroy=function(){this.event&&this.app.event(this.event).unsubscribe(this.eventToken),this.commands=null},e}();e.Behavior=t}(e.behaviors||(e.behaviors={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(t){var i=function(){function i(e){this.behaviors={},this.dummyBehavior=new t.Behavior(null,null,null),this.app=e}return i.prototype.loadBehaviorsFromConfig=function(t,i){var r=[];if(!(t instanceof e.application.ModuleBase))return this.app.trace.warning("Attempted to add behaviors to registry outside of ModuleBase. Behaviors from "+t.id+" not added."),r;if(i&&i.behaviors)for(var n=0;n<i.behaviors.length;n++){var o=i.behaviors[n];r.push(o.name),this.addBehavior(o.name,o.commands,o.event)}return r},i.prototype.addBehavior=function(e,i,r){if(i){this.behaviors[e]&&this.app.trace.warning("Behavior "+e+" is already present in registry."),e||this.app.trace.warning("Attempted to add a nameless Behavior to the registry.");var n=new t.Behavior(this.app,e,i,r);this.behaviors[e]=n}else this.app.trace.debug("Behavior "+e+" does not possess an array of command IDs. Not added to registry.")},i.prototype.remove=function(e){if(!this.behaviors[e])return this.app.trace.debug("Attempted to remove behavior not in found in registry."),!1;var t=this.behaviors[e];return delete this.behaviors[e],t.destroy(),!0},i.prototype.behavior=function(e){var t=null;return void 0!==this.behaviors[e]?t=this.behaviors[e]:(t=this.dummyBehavior,this.app.trace.debug("Could not find Behavior named "+e+" in the Behavior Registry.")),t},i}();t.BehaviorRegistry=i}(e.behaviors||(e.behaviors={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){var t=function(){function e(e,t){this.dojoConnects=[],this.observableBindings=[],this.eventSubscriptions=[],this.commandHandlers=[],this.app=e,this.libraryId=t}return e.prototype.auto=function(e,t,i){if(3===arguments.length&&"string"==typeof t)this.dojoConnects.push(dojo.connect(e,t,i));else if(2===arguments.length&&t instanceof Function){r=e.bind(e,t);this.observableBindings.push({obj:e,token:r})}else if(3===arguments.length&&i instanceof Function){var r=e.bind(t,i);this.observableBindings.push({obj:e,token:r})}},e.prototype.trackSubscription=function(e,t){this.eventSubscriptions.push({event:e,token:t})},e.prototype.trackCommandHandler=function(e,t){this.commandHandlers.push({command:e,token:t})},e.prototype.onDestroy=function(){},e.prototype.destroy=function(){for(r=0;r<this.dojoConnects.length;++r)dojo.disconnect(this.dojoConnects[r]);this.dojoConnects=[];for(r=0;r<this.observableBindings.length;++r){var e=this.observableBindings[r].obj,t=this.observableBindings[r].token;e.unbind(t)}this.observableBindings=[];for(r=0;r<this.eventSubscriptions.length;++r){var i=this.eventSubscriptions[r].event,t=this.eventSubscriptions[r].token;i.unsubscribe(t)}this.eventSubscriptions=[];for(var r=0;r<this.commandHandlers.length;++r){var n=this.commandHandlers[r].command,t=this.commandHandlers[r].token;n.unregister(t)}this.commandHandlers=[],this.onDestroy()},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();e.FrameworkObject=t}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;if(function(e){!function(e){!function(e){var t=function(){return function(){this.sender=null,this.type="append",this.rangeStart=0,this.rangeEnd=0}}();e.CollectionChangedArgs=t}(e.events||(e.events={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={})),!String.prototype.format){var dateFormats="d{1,4}|f{1,7}|F{1,7}|g{1,2}|h{1,2}|H{1,2}|K|m{1,2}|M{1,4}|s{1,2}|t{1,2}|y{1,5}|z{1,3}|:|\\/",uberDateRegexPattern="("+dateFormats+"|[^"+dateFormats+"])",uberDateRegex=new RegExp(uberDateRegexPattern,"g"),openBraceTempToken="\0MAGIC\0";String.prototype.format=function(){var e=arguments,t=this.replace(/{{/g,openBraceTempToken);return(t=t.replace(/{(\d+)(?::([^}]*))?}/g,function(t,i,r){var n=e[i];if(!(r&&n instanceof Date))return n;for(var o=n,a=r.match(uberDateRegex),s=[],l=0;l<a.length;l++){var u=a[l],c=geocortex.framework.utils.DateFormatters[u];if(c){var h=c.call(this,o);s.push(h)}else s.push(u)}return s.join("")})).replace(new RegExp(openBraceTempToken,"g"),"{").replace(/}}/g,"}")}}String.format=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return e.format.apply(e,t)},String.quickHashCode=function(e){var t,i=0;if(0==e.length)return i;for(t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i&=i;return i},String.escapeHtml=function(e){return null===e||void 0===e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},String.unescapeHtml=function(e){return null===e||void 0===e?e:e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")},String.escapeHtmlEncode=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},String.isNullOrEmpty=function(e){return void 0===e||null===e||0===e.length},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t},String.prototype.endsWith=function(e,t){t=t||this.length,t-=e.length;var i=this.lastIndexOf(e);return-1!==i&&i===t};var geocortex;!function(e){!function(e){!function(e){function t(e){return void 0!==e}function i(e){return null===e||!t(e)}e.base64keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.isDefined=t,e.isNullOrUndefined=i,e.makeUrlAbsolute=function(e){if(0===e.indexOf("http"))return e;var t="{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if("/"!=t.charAt(t.length-1)||"\\"!=t.charAt(t.length-1)){var i=t.split("/");--i.length,t=i.join("/"),t+="/"}return e="/"===e.charAt(0)||"\\"===e.charAt(0)?window.location.protocol+"//"+window.location.host+"/"+e.substring(1):t+e},e.alphaNumericToken=function(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",i=e||8,r="",n=0;n<i;n++){var o=Math.floor(Math.random()*t.length);r+=t.substring(o,o+1)}return r},e.base64Encode=function(e){var t,i,r,n,o,a,s,l="",u=0;for(e=this.utf8Encode(e);u<e.length;)n=(t=e.charCodeAt(u++))>>2,o=(3&t)<<4|(i=e.charCodeAt(u++))>>4,a=(15&i)<<2|(r=e.charCodeAt(u++))>>6,s=63&r,isNaN(i)?a=s=64:isNaN(r)&&(s=64),l=l+this.base64keyStr.charAt(n)+this.base64keyStr.charAt(o)+this.base64keyStr.charAt(a)+this.base64keyStr.charAt(s);return l},e.base64Decode=function(e){var t="";if(!e||""===e)return t;var i,r,n,o,a,s,l=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(e))throw new Error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i=this.base64keyStr.indexOf(e.charAt(l++))<<2|(o=this.base64keyStr.indexOf(e.charAt(l++)))>>4,r=(15&o)<<4|(a=this.base64keyStr.indexOf(e.charAt(l++)))>>2,n=(3&a)<<6|(s=this.base64keyStr.indexOf(e.charAt(l++))),t+=String.fromCharCode(i),64!=a&&(t+=String.fromCharCode(r)),64!=s&&(t+=String.fromCharCode(n)),i=r=n=null,o=a=s=null}while(l<e.length);return t=this.utf8Decode(t)},e.utf8Encode=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},e.utf8Decode=function(e){for(var t="",i=0,r=0,n=0,o=0;i<e.length;)(r=e.charCodeAt(i))<128?(t+=String.fromCharCode(r),i++):r>191&&r<224?(n=e.charCodeAt(i+1),t+=String.fromCharCode((31&r)<<6|63&n),i+=2):(n=e.charCodeAt(i+1),o=e.charCodeAt(i+2),t+=String.fromCharCode((15&r)<<12|(63&n)<<6|63&o),i+=3);return t},e.isUrl=function(e){if(!e||"string"!=typeof e)return!1;var t=e.trim().toLowerCase();return t.length>=7&&0===t.indexOf("http://")||t.length>=8&&0===t.indexOf("https://")},e.isPercentage=function(e){return!i(e)&&/^(\d+|\d*[.]\d+)%$/.test(e)},e.clamp=function(e,t,i){return e<t?t:e>i?i:e},e.addEventListener=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){var i=function(){return function(e,t){this.handler=e,this.scope=t,this.once=!1}}(),r=function(){function t(e,t){this.app=null,this.isPublishing=!1,this.subscriptions={},this.name=e,this.app=t}return t.prototype.getSubscriptionHandlerByToken=function(e){return this.subscriptions.hasOwnProperty(e)?this.subscriptions[e].handler:null},t.prototype.subscribe=function(t,r){if(null===r||void 0===r)throw new Error("Event handler cannot be null or undefined");var n;do{n=e.framework.utils.alphaNumericToken()}while(this.getSubscriptionHandlerByToken[n]);var o=new i(r,t);return this.subscriptions[n]=o,t&&t instanceof e.framework.FrameworkObject&&t.trackSubscription(this,n),n},t.prototype.once=function(e,t){var i=this.subscribe(e,t);return this.subscriptions[i].once=!0,i},t.prototype.unsubscribe=function(e){return!!this.subscriptions.hasOwnProperty(e)&&(delete this.subscriptions[e],!0)},t.prototype.clear=function(){this.subscriptions={}},t.prototype.publish=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(this.app&&this.app.debugMode){var i="Event '{0}' published.".format(this.name);console.debug?console.debug(i):console.log(i)}this.isPublishing=!0;for(var r in this.subscriptions)if(this.subscriptions.hasOwnProperty(r)){var n=this.subscriptions[r];n.handler.apply(n.scope,arguments),n.once&&delete this.subscriptions[r]}this.isPublishing=!1},t}();t.Event=r}(t.events||(t.events={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var Observable=function(){function e(e){this.bindingEvent=new geocortex.framework.events.Event("__anonymous"),this._syncToken=null,this._syncSource=null,this.value=e}return e.prototype.set=function(e){this.value=e,this.bindingEvent.publish(e)},e.prototype.get=function(){return this.value},e.prototype.equals=function(e){var t=e;if(e&&e.get&&"function"==typeof e.get&&(t=e.get()),this.value instanceof Array&&t instanceof Array){if(this.value.length!==t.length)return!1;for(var i=0;i<this.value.length;i++)if(this.value[i]!==t[i])return!1;return!0}return this.get()===t},e.makeBindableProxy=function(t){if(!t)return null;var i=[];if(t.___clonedObject)return t.___clonedObject;var r=function(){throw new Error("Can't make method calls on a bindable proxy.")},n=function(t,o,a){for(l=0;l<i.length;++l)if(o===i[l])return i[l];if(i.push(o),o&&"string"!=typeof o&&"number"!=typeof o&&"boolean"!=typeof o){if(o instanceof Array){for(var s=new ObservableCollection,l=0;l<o.length;++l){u={};u=n(l,o[l],o),s.addItem(u)}return s}if(o instanceof Object){if(o.isObservable)return o;var u={};for(var c in o)o.hasOwnProperty(c)&&(u[c]=n(c,o[c],o));return u}return o instanceof Function?r:o}var h=new e(o);return h.set=function(e){a[t]=e,h.value=e,h.bindingEvent.publish(e)},h.get=function(){return a[t]},h},o=n("root",{root:t},t);return t.___clonedObject=o.root,t instanceof Array?o.root:new e(o.root)},e.prototype.bind=function(e,t){return this.bindingEvent.subscribe(e,t)},e.prototype.unbind=function(e){return this.bindingEvent.unsubscribe(e)},e.prototype.once=function(e,t){var i=this,r=this.bind(e,function(){i.unbind(r),t.apply(e,arguments)});return r},e.prototype.sync=function(e){this.removeSync(),e&&(this.set(e.get()),this._syncSource=e,this._syncToken=e.bindingEvent.subscribe(this,function(e){this.set(e)}))},e.prototype.removeSync=function(){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null)},e.prototype.syncTransform=function(e,t){this._syncToken&&this._syncSource&&(this._syncSource.unbind(this._syncToken),this._syncToken=null,this._syncSource=null),e&&(this.set(t(e.get())),this._syncSource=e,this._syncToken=e.bindingEvent.subscribe(this,function(e){this.set(t(e))}))},e.prototype.pulse=function(){this.set(this.get())},e}();Observable.prototype.isObservable=!0;var ObservableCollection=function(){function e(e){this.bindingEvent=new geocortex.framework.events.Event("__anonymous"),this.useThrottling=!1,this.throttledOperations=null,this._syncSource=null,this.value=e||[]}return e.prototype.isEmpty=function(){return 0===this.value.length},e.prototype.length=function(){return this.value.length},e.prototype.contains=function(e){return Array.contains(this.value,e)},e.prototype.getAt=function(e){return this.value[e]},e.prototype.getRange=function(e,t){return void 0===t?this.value.slice(e):this.value.slice(e,t+1)},e.prototype.indexOf=function(e){return this.value.indexOf(e)},e.prototype.get=function(){return this.value},e.prototype.getItems=function(){return this.value},e.prototype.getLength=function(){return this.value.length},e.prototype.addItems=function(e){if(e&&!(e.length<1)){var t=new geocortex.framework.events.CollectionChangedArgs;t.type="append",t.rangeStart=this.value.length,this.value=this.value.concat(e),t.rangeEnd=t.rangeStart+e.length-1,t.sender=this,this.bindingEvent.publish(t)}},e.prototype.addItem=function(e){var t=new geocortex.framework.events.CollectionChangedArgs;t.type="append",t.rangeStart=this.value.length,t.rangeEnd=this.value.length,this.value.push(e),t.sender=this,this.bindingEvent.publish(t)},e.prototype.insertItems=function(e,t){if(0!=t.length)if(e>=this.value.length)this.addItems(t);else{var i=new geocortex.framework.events.CollectionChangedArgs;i.type="insert",i.rangeStart=e,i.rangeEnd=e+t.length-1,i.sender=this;for(var r=0;r<t.length;++r)this.value.splice(e+r,0,t[r]);this.bindingEvent.publish(i)}},e.prototype.insertItem=function(e,t){if(e>=this.value.length)this.addItem(t);else{var i=new geocortex.framework.events.CollectionChangedArgs;i.type="insert",i.rangeStart=e,i.rangeEnd=e,i.sender=this,this.value.splice(e,0,t),this.bindingEvent.publish(i)}},e.prototype.removeItem=function(e){for(var t;(t=Array.pos(this.value,e))>-1;){var i=new geocortex.framework.events.CollectionChangedArgs;i.type="remove",i.rangeStart=t,i.rangeEnd=t,i.sender=this,this.bindingEvent.publish(i),Array.remove(this.value,t,t)}},e.prototype.removeAt=function(e){if(0<=e&&e<this.getLength()){var t=new geocortex.framework.events.CollectionChangedArgs;t.type="remove",t.rangeStart=e,t.rangeEnd=e,t.sender=this,this.bindingEvent.publish(t),Array.remove(this.value,e,e)}},e.prototype.removeRange=function(e,t){t||0===t||(t=this.value.length);var i=new geocortex.framework.events.CollectionChangedArgs;i.type="remove",i.rangeStart=e,i.rangeEnd=Math.min(t,this.value.length),i.sender=this,this.bindingEvent.publish(i),Array.remove(this.value,e,t)},e.prototype.removeWhere=function(e){if(e)for(var t=this.value.length-1;t>=0;t--)if(e(this.value[t])){var i=new geocortex.framework.events.CollectionChangedArgs;i.type="remove",i.rangeStart=t,i.rangeEnd=t,i.sender=this,this.bindingEvent.publish(i),Array.remove(this.value,t,t)}},e.prototype.clear=function(){if(this.value&&0!=this.value.length){var e=new geocortex.framework.events.CollectionChangedArgs;e.type="clear",e.rangeStart=0,e.rangeEnd=this.value.length-1,e.sender=this,this.bindingEvent.publish(e),this.value.length=0}},e.prototype.set=function(e){this.clear(),e&&this.addItems(e)},e.prototype.pulse=function(){var e=new geocortex.framework.events.CollectionChangedArgs;e.type="clear",e.rangeStart=0,e.rangeEnd=this.value.length-1,e.sender=this,this.bindingEvent.publish(e),(e=new geocortex.framework.events.CollectionChangedArgs).type="append",e.rangeStart=0,e.rangeEnd=this.value.length-1,e.sender=this,this.bindingEvent.publish(e)},e.prototype.bind=function(e,t){return this.bindingEvent.subscribe(e,t)},e.prototype.unbind=function(e){return this.bindingEvent.unsubscribe(e)},e.prototype.once=function(e,t){var i=this,r=i.bind(e,function(){i.unbind(r),t.apply(e,arguments)});return r},e.prototype.sync=function(e){e.value&&e.bindingEvent&&(this.clear(),this.value=e.value,e.bindingEvent.subscribe(this,function(t){this.value=e.value;var i=new geocortex.framework.events.CollectionChangedArgs;dojo.mixin(i,t),i.sender=this,this.bindingEvent.publish(i),"clear"===t.type&&(this.value=[])}))},e.prototype.equals=function(e){var t=e;if(e&&e.isObservableCollection&&(t=e.get()),!t.hasOwnProperty("length"))throw new Error("Type mismatch");if(this.get().length!==t.length)return!1;for(var i=0;i<this.get().length;i++)if(this.value[i]!==t[i])return!1;return!0},e}();ObservableCollection.prototype.isObservable=!0,ObservableCollection.prototype.isObservableCollection=!0;var geocortex;!function(e){!function(e){!function(e){!function(t){var i=function(e,t){return e===t?0:e>t?1:-1};t.firstOrDefault=function(e,t){var i=e?e.length:0;if((null===t||void 0===t)&&i>0)return e[0];for(var r=0;r<i;r++){var n=e[r];if(t(n,r))return n}return null},t.lastOrDefault=function(e,t){var i=e?e.length:0;if((null===t||void 0===t)&&i>0)return e[i-1];for(var r=i-1;r>=0;r--){var n=e[r];if(t(n,r))return n}return null},t.orderBy=function(t,r){return t?t.slice().sort(function(t,n){var o=r(t),a=r(n);return o instanceof e.Tuple?e.Tuple.compare(o,a):i(o,a)}):[]},t.orderByDescending=function(t,r){return t?t.slice().sort(function(t,n){var o=r(t),a=r(n);return o instanceof e.Tuple?e.Tuple.compare(a,o):i(a,o)}):[]},t.groupBy=function(e,t){var i={},r=[];if(e&&t){for(var n=0;n<e.length;n++){var o=e[n],a=t(o),s=JSON.stringify(a);i.hasOwnProperty(s)?i[s].items.push(o):i[s]={key:a,items:[o]}}for(var l in i)i.hasOwnProperty(l)&&r.push(i[l])}return r},t.distinct=function(e){return e?e.filter(function(e,t,i){return null!=e&&i.indexOf(e)===t}):[]},t.difference=function(e,t){return e?t?e.filter(function(e){return t.indexOf(e)<0}):e.slice(0):[]},t.remove=function(e,t,i){var r=e.slice((i||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r)},t.removeItem=function(e,i){var r=t.pos(e,i);return-1==r?null:t.remove(e,r,r)},t.contains=function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1},t.pos=function(e,t){for(var i=e.length;i--;)if(e[i]===t)return i;return-1},t.flatten=function(e){return e?[].concat.apply([],e):e},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=+(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var n=r>=0?r:Math.max(i-Math.abs(r),0);n<i;n++)if(n in t&&t[n]===e)return n;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=i;arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=+(r>0||-1)*Math.floor(Math.abs(r))));for(var n=r>=0?Math.min(r,i-1):i-Math.abs(r);n>=0;n--)if(n in t&&t[n]===e)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,r;if(null==this)throw new TypeError("this is null or not defined");var n=Object(this),o=n.length>>>0;if("[object Function]"!=={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(i=t),r=0;r<o;){var a;Object.prototype.hasOwnProperty.call(n,r)&&(a=n[r],e.call(i,a,r,n)),r++}}),Array.prototype.every||(Array.prototype.every=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],n=0;n<i;n++)if(n in t&&!e.call(r,t[n],n,t))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments[1],n=0;n<i;n++)if(n in t&&e.call(r,t[n],n,t))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],n=arguments[1],o=0;o<i;o++)if(o in t){var a=t[o];e.call(n,a,o,t)&&r.push(a)}return r}),Array.prototype.map||(Array.prototype.map=function(e,t){var i,r,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),a=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(i=t),r=new Array(a),n=0;n<a;){var s,l;n in o&&(s=o[n],l=e.call(i,s,n,o),r[n]=l),n++}return r}),Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],o=0;o<r;o++)if(t=i[o],e.call(n,t,o,i))return t}),Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],o=0;o<r;o++)if(t=i[o],e.call(n,t,o,i))return o;return-1})}(e.ArrayUtils||(e.ArrayUtils={}))}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={})),Array.remove=geocortex.framework.utils.ArrayUtils.remove,Array.removeItem=geocortex.framework.utils.ArrayUtils.removeItem,Array.contains=geocortex.framework.utils.ArrayUtils.contains,Array.pos=geocortex.framework.utils.ArrayUtils.pos;var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i){this.period=100,this.isActive=!1,this._setTimeoutToken=null,this.period=void 0==e?0:e,this.action=t,this.cancelAction=i;var r=this;this._setTimeoutToken=setTimeout(function(){r.execute(r)},this.period)}return e.prototype.cancel=function(){this._setTimeoutToken&&(clearTimeout(this._setTimeoutToken),this._setTimeoutToken=null,this.isActive=!1,this.cancelAction&&this.cancelAction())},e.prototype.execute=function(e){e.isActive=!0;var t=e.action();null!==e._setTimeoutToken&&t?e._setTimeoutToken=setTimeout(function(){e.execute(e)},e.period):(e._setTimeoutToken=null,e.isActive=!1)},e}();e.ThrottledOperation=t}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=/^on/,i=function(){function e(){this.domElement=null,this.type="attr",this.attributeName=null,this.target=null,this.invert=!1,this._dojoDomEvents=[],this.targetBindings=[],this.templateMode=null,this.templateKey=null,this.templateSelections={},this.parentView=null,this.boundViews=[],this.viewModel=null}return e.prototype.on=function(e,i){var r=this;if(e&&i){if(!this.domElement)throw new Error("Cannot bind before domElement is set.");t.test(e)&&(e=e.substring(2)),require(["dojo/on"],function(t){var n=t(r.domElement,e,i);r._dojoDomEvents.push(n)})}},e.prototype.destroy=function(){if(this.templateSelections)for(var e in this.templateSelections)if(this.templateSelections.hasOwnProperty(e)){var t=this.templateSelections[e];if(t&&t.___domParent){var i=t.___domParent;dojo.place(t,i,"last")}}this.domElement=null,this.target=null,this.parentView=null,this.viewModel=null;for(r=0;r<this._dojoDomEvents.length;++r)this._dojoDomEvents[r].remove();for(this._dojoDomEvents.length=0,r=0;r<this.targetBindings.length;++r)this.targetBindings[r].event.unsubscribe(this.targetBindings[r].token);this.targetBindings=[];for(var r=0;r<this.boundViews.length;++r)this.boundViews[r].destroyBindings();this.boundViews=[]},e}();e.BindingExpression=i}(e.ui||(e.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(){this.domElement=null,this.parent=null,this.children=[],this.expressions=[],this.context=null,this.contextChange=!1,this.domElement=null,this.parent=null,this.context=null}return e.prototype.destroy=function(){this.domElement=null,this.parent=null,this.context=null,this.contextChange=!1;for(e=0;e<this.expressions.length;++e)this.expressions[e].destroy();this.expressions=[];for(var e=0;e<this.children.length;++e)this.children[e].destroy();this.children=[]},e}();e.BindingNode=t}(e.ui||(e.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(i){function r(t,r){i.call(this,t,r),this.isActive=!1,this.isManaged=!1,this.isBusy=new Observable(!1),this.title=new Observable(""),this.description=new Observable(""),this.iconUri=new Observable(""),this.markupResource=null,this.viewModel=null,this.regionName="",this.typeName="",this.root=null,this.bindingTree=null,this.parentView=null,this.childRegions=[],this.bound=!1,this.initiallyBound=!1,this.disposableBindings=[],this.bindingSetupDelegates=[],this.id="View-"+e.framework.utils.alphaNumericToken()}return __extends(r,i),r.prototype.addDisposableBinding=function(e,t){this.disposableBindings.push({event:e.bindingEvent,token:t})},r.prototype.attach=function(e){this.bound||(this.viewModel=e,this.root&&(this.bindingTree=this.buildTree(),null!==this.viewModel&&void 0!==this.viewModel&&this.pulseAll(),this.bound=!0,this.initiallyBound||(this.initiallyBound=!0,this.app.event("ViewInitializedEvent").publish(this))))},r.prototype.activated=function(){},r.prototype.deactivated=function(){},r.prototype.added=function(e){!this.bound&&this.viewModel&&(this.bindingTree=this.buildTree(),this.bound=!0,this.pulseAll(),this.initiallyBound||(this.initiallyBound=!0,this.app.event("ViewInitializedEvent").publish(this)))},r.prototype.removed=function(){this.destroyBindings()},r.prototype.destroy=function(){this.destroyBindings(),i.prototype.destroy.call(this)},r.prototype.destroyBindings=function(){if(this.isActive&&this.app.viewManager.deactivateView(this),this.bindingTree){this.bindingTree.destroy();for(var e=0;e<this.disposableBindings.length;++e){var t=this.disposableBindings[e];t.event.unsubscribe(t.token)}this.bound=!1,this.disposableBindings=[],this.bindingSetupDelegates=[]}},r.prototype.pulseAll=function(){for(var e=0;e<this.bindingSetupDelegates.length;++e)try{this.bindingSetupDelegates[e]()}catch(e){this.app.trace.error("Error performing initial data-bind in view '{0}' with view model '{1}': {2}".format(this.id,this.viewModel.id,e.message),e)}this.bindingSetupDelegates=[]},r.prototype.resolveWidget=function(e,t,i){return null},r.prototype.buildTree=function(){function i(n,o){function a(e){var t=[];if(!e)return t;var i=e.match(/\{(.*?)\}/g);if(!i){if(this.app)return this.app.trace.warning("Invalid data-binding expression '{0}'.".format(e)),[];throw new Error("Invalid data-binding expression '{0}'.".format(e))}for(var r=0;r<i.length;++r){var n=i[r].split(":");2==n.length&&t.push({directive:n[0].replace("{","").trim(),target:n[1].replace("}","").trim()})}return t}if(o&&o.children)for(var s=0;s<o.children.length;++s){var l=o.children[s],u=dojo.attr(l,"data-region-name"),c=dojo.attr(l,"data-binding");if(c||(c=l.___dataBindingExpressions),c){var h=a(c);if(l.___dataBindingExpressions=c,r.app.debugMode||dojo.removeAttr(l,"data-binding"),!h||0===h.length)continue;for(var d=!1,p=0;p<h.length;++p)!function(){var i=n.expressions,o=n.context,s=!1,u=h[p],c=u.directive,f=u.target,g=new e.framework.ui.BindingExpression;if(g.domElement=l,g.target=f,null!=r.viewModel?g.viewModel=r.viewModel:(g.viewModel={},g.viewModel.id="[None]"),r.parentView?g.parentView=r.parentView:g.parentView=r,c.startsWith("@")){var v=c.split("-")[1];if(c.startsWith("@event-"))v?(g.type="event",g.attributeName=v):(this.app.trace.warning("Binding error: Invalid event binding expression '{0}' in view '{1}'.".format(c,r.id)),s=!0);else if(c.startsWith("@var"))g.type="var";else if(c.startsWith("@text"))g.attributeName="innerHTML",g.type="text";else if(c.startsWith("@attach"))g.attributeName="___attachedValue",g.type="attachment";else if(c.startsWith("@style-")){var m=c.indexOf("-"),y=c.substring(m+1);y?(g.type="style",g.attributeName=y):(this.app.trace.warning("Binding error: Invalid style binding expression '{0}' in view '{1}'.".format(c,r.id)),s=!0)}else if(c.startsWith("@dom"))g.type="dom",g.attributeName=v;else if(c.startsWith("@value"))g.type="value",g.attributeName=v;else if(c.startsWith("@widget"))g.type=c.substring(1),g.attributeName=v,g.otherExpressions=h;else if(c.startsWith("@class")||c.startsWith("@noclass")){g.type="class",c.startsWith("@noclass")&&(g.invert=!0);var w=c.indexOf("-"),b=c.substring(w+1);b?g.attributeName=b:(this.app.trace.warning("Binding error: Invalid class binding expression '{0}' in view '{1}'.".format(c,r.id)),s=!0)}else if("@source"===c){g.type="source",g.attributeName="@source",d=!0;g.templateMode="single-inline";for(var _=0;_<h.length;++_){var k=h[_];if(k!==u){var E=k.directive,x=k.target;if("@template"===E){g.templateMode="single-external";var C=new t.config.ViewConfig(null,null,null);if(C.markupResource=x,C.libraryId=r.libraryId,!(A=r.app.viewManager.createView(C))){r.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(x,this.id));break}A.app=r.app,g.templateSelections={"@default":A.root};break}if("@template-selector"===E){g.templateMode="inline-selected",g.templateKey=x,g.templateSelections={};break}}}if("single-external"!==g.templateMode){for(var S=new dojo.NodeList,T=0;T<l.children.length;++T)for(var j=l.children[T],V=a(dojo.attr(j,"data-binding")),I=0;I<V.length;++I){var M=V[I];if("@template-for"===M.directive||"@template-select"===M.directive){if("@template-for"===M.directive&&M.target===g.target){S.push(j);var A=dojo.clone(j);g.templateSelections["@default"]=A,A.___domParent=l}else if("@template-select"===M.directive){S.push(j);for(var O=!1,R=0;R<V.length;++R){var N=V[R];if("@template"===N.directive){var B=new t.config.ViewConfig(null,null,null);if(B.markupResource=N.target,B.libraryId=r.libraryId,!(A=r.app.viewManager.createView(B))){this.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(N.target,this.id));break}A.app=r.app;var D=dojo.clone(j);dojo.place(A.root,D,"last"),g.templateSelections[M.target]=D,O=!0;break}}O||(S.push(j),g.templateSelections[M.target]=j,j.___domParent=l)}break}}S.orphan()}}else"@source-remove"===c?(g.type="source-remove",g.attributeName=v):"@source-add"===c?(g.type="source-add",g.attributeName=v):"@visible"===c||"@hidden"===c?("@hidden"===c&&(g.invert=!0),g.type="visibility",g.attributeName="@visibility"):"@disabled"===c||"@enabled"===c?("@disabled"===c&&(g.invert=!0),g.type="disabledState",g.attributeName="@disabledState"):c.startsWith("@template")?g.type="template":c.startsWith("@halt")?d=!0:(r.app.trace.warning("Unknown binding term '{0}'.".format(c)),s=!0)}else g.type="attr",g.attributeName=c;s||r.applyBinding.apply(r,[l,g,o,n])&&i.push(g)}();var f=new e.framework.ui.BindingNode;f.domElement=l,f.parent=n,f.context=n.context,f.children=[],f.expressions=[],n.children.push(f),0!=d||u||i(f,l)}else u||i(n,l)}}var r=this;if(null!=this.root){var n=new e.framework.ui.BindingNode;return n.domElement=null,n.parent=null,n.children=[],n.context=this.viewModel,i(n,{children:[this.root]}),n}},r.prototype.getBindingTarget=function(e){if("@context"===e.target)return e.viewModel;if(e.target.indexOf("@language-")>-1){var t=e.target.split("-").slice(1).join("-");return this.app.getResource(this.libraryId,"language-"+t)}if(1!=e.viewModel.isObservable)return e.viewModel[e.target];var i=e.viewModel.get();return null==i?i:i[e.target]},r.prototype.setBindingTargetValue=function(e,t){if("@context"!==e.target){if(!(e.target.indexOf("@language-")>-1))if(e.viewModel.isObservable){var i=e.viewModel.get();i&&(i[e.target]?i[e.target].isObservable?i[e.target].set(t):i[e.target]=t:i[e.target]=new Observable(t))}else e.viewModel[e.target].isObservable?e.viewModel[e.target].set(t):e.viewModel[e.target]=t}else e.viewModel&&e.viewModel.isObservable?e.viewModel.set(t):e.viewModel=t},r.prototype.resolveBindingTemplate=function(e,t){var i=null;if("single-inline"===e.templateMode||"single-external"===e.templateMode)i=dojo.clone(e.templateSelections["@default"]);else if("inline-selected"===e.templateMode){var r=null;t[e.templateKey]&&(r=t[e.templateKey]).isObservable&&(r=r.get()),!r&&e.templateSelections.hasOwnProperty("@null")?i=dojo.clone(e.templateSelections["@null"]):e.templateSelections.hasOwnProperty(r)&&(i=dojo.clone(e.templateSelections[r])),!i&&e.templateSelections.hasOwnProperty("@default")&&(i=dojo.clone(e.templateSelections["@default"]),dojo.addClass(i,"empty-div"))}return i||(i=dojo.create("div")),i},r.prototype.buildSourceBinding=function(t,i,r,n){var o=this,a=o.getBindingTarget(i);if(null===a)return!1;if(void 0===a)return o.app.trace.warning("Binding error: '{0}' in view model '{1}' was not bindable.".format(i.target,i.viewModel.id)),!1;var s=a,l=function(){if(s.useThrottling&&s.throttledOperations&&s.throttledOperations.length)for(var e=s.throttledOperations.length-1;e>=0;e--)s.throttledOperations[e].cancel(),s.throttledOperations.splice(e,1)},u=function(r){if(!0!==i.upToDate){for(var u=null,c=null,h=0;h<n.expressions.length;++h){var d=n.expressions[h];u||"source-add"!=d.type||(u=d.target),c||"source-remove"!=d.type||(c=d.target)}var p=this;i.parentView&&(p=i.parentView);var f=p[u],g=p[c];if(void 0!==r&&null!==r){if(r instanceof e.framework.events.CollectionChangedArgs){if(null===r||"clear"===r.type){if(l(),g)for(m=r.rangeStart;m<=r.rangeEnd;++m)g.apply(o,[i,s.getAt(m),r,m]);for(m=0;m<i.boundViews.length;++m)this.app.viewManager.destroyView(i.boundViews[m]);if(i.boundViews=[],!g&&null!=i.domElement&&null!=i.domElement.children){for(var v=new dojo.NodeList,m=0;m<i.domElement.children.length;++m)i.domElement.children[m].___collectionTemplate||v.push(i.domElement.children[m]);v.orphan()}}else if("replace"===r.type){if(l(),g)for(m=r.rangeStart;m<r.rangeEnd+1;++m)g.apply(o,[i,s.getAt(m),r,m]);for(m=0;m<i.boundViews.length;++m)this.app.viewManager.destroyView(i.boundViews[m]);i.boundViews=[],g||dojo.empty(i.domElement),r.type="append",r.rangeStart=0,r.rangeEnd=s.value.length-1}}else{var y=r.isObservable?r.get():r;g&&g.apply(o,[i,y,r,0]);for(m=0;m<i.boundViews.length;++m)this.app.viewManager.destroyView(i.boundViews[m]);if(i.boundViews=[],!g){var w=i.___singleSourceItem;w&&((v=new dojo.NodeList).push(w),v.orphan(),i.___singleSourceItem=null)}if(y)if(f)f.apply(o,[i,y,r,0]);else{var b=o.resolveBindingTemplate(i,y);dojo.place(b,i.domElement,"last");var _=new e.framework.ui.ViewBase(o.app);_.parentView=i.parentView,_.app=_.parentView.app,_.libraryId=o.libraryId;var k={children:[]};k.children.push(b);var E=y;E||((E=new e.framework.ui.ViewModelBase(o.app,o.libraryId)).app=o.app,E.libraryId=o.libraryId),E.___boundViews,E.hasOwnProperty("___boundViews"),_.root=k,_.attach(E),_.root=b,i.___singleSourceItem=_.root,i.boundViews.push(_)}}if("append"===r.type||"insert"===r.type){var x=null;"insert"===r.type&&i.domElement.children.length>r.rangeStart&&(x=i.domElement.children[r.rangeStart]);var C=function(n,a,l){if(n>a)return!1;if(!i||null==i.domElement)return!1;for(var u=l||s,c=n;c<=a;++c){var h=null;if(null!=f)f.apply(o,[i,u.isObservable?u.getAt(c):u[c],r,c]);else{var d=u.isObservable?u.getAt(c):u[c];if(h=o.resolveBindingTemplate(i,d),x&&"insert"===r.type)dojo.place(h,x,"before");else if(x&&"append"===r.type)dojo.place(h,x,"after");else{if(!i||null==i.domElement)return!1;dojo.place(h,i.domElement,"last")}var p=new e.framework.ui.ViewBase(o.app,o.libraryId);p.parentView=i.parentView,p.app=p.parentView.app,p.libraryId=o.libraryId,p.id+="-item"+c;var g={children:[]};g.children.push(h),null!==d&&void 0!==d||((d=new e.framework.ui.ViewModelBase(o.app,o.libraryId)).app=o.app,d.libraryId=o.libraryId),d.___boundViews,d.hasOwnProperty("___boundViews"),p.root=g,p.attach(d),p.root=h,i.boundViews.push(p)}}return t.___populateInitialValueFunc&&(t.___populateInitialValueFunc(),delete t.___populateInitialValueFunc),!0};if(s.useThrottling){s.throttledOperations=s.throttledOperations&&s.throttledOperations.constructor===Array?s.throttledOperations:[];var S=void 0==s.throttleDelay?0:s.throttleDelay,T=r.rangeStart,j=Math.min(T+10-1,r.rangeEnd),V=s.get().slice(0),I=function(){var e=s.throttledOperations.indexOf(M);e>-1&&s.throttledOperations.splice(e,1)},M=new e.framework.utils.ThrottledOperation(S,function(){var e=C(T,j,V);return j>=r.rangeEnd?(I(),!1):(T+=10,j+=10,j=Math.min(j,r.rangeEnd),e||I(),e)});s.throttledOperations.push(M)}else C(r.rangeStart,r.rangeEnd)}else if("remove"===r.type){l();for(var A=r.rangeStart;A<=r.rangeEnd;++A)for(var O=0;O<i.boundViews.length;++O){var R=i.boundViews[O];null!==R.viewModel&&void 0!==R.viewModel&&R.viewModel==a.getAt(A)&&(g?g.apply(o,[i,r[A],r,A]):o.app.viewManager.destroyView(R),Array.removeItem(i.boundViews,R),--O)}}}}else i.upToDate=!1};if(s.bind&&i.targetBindings.push({event:s.bindingEvent,token:s.bind(o,u)}),s.isObservableCollection){var c=s.getLength()-1;this.bindingSetupDelegates.push(function(){var t=new e.framework.events.CollectionChangedArgs;t.type="append",t.rangeStart=0,t.rangeEnd=c,t.sender=s,u.apply(o,[t]),s.isObservable&&s.bindingEvent.isPublishing&&(i.upToDate=!0)})}else this.bindingSetupDelegates.push(function(){u.apply(o,[a]),s.isObservable&&s.bindingEvent.isPublishing&&(i.upToDate=!0)})},r.prototype.buildEventBinding=function(e,t,i){var r=this;if(!this[t.target]&&t.parentView&&t.parentView[t.target]&&(r=t.parentView),!r[t.target])return this.app.trace.warning("Binding error: Event handler '{0}' was not found in view '{1}' or its parent view.".format(t.target,r.id)),!1;e!=t.domElement&&this.app.trace.warning("Binding error: buildEventBinding passed in el that doesn't match binding.domElement."),t.on(t.attributeName,function(n){var o=r[t.target](n,e,i);return o||(n.preventDefault(),n.stopPropagation(),!1)})},r.prototype.buildVarBinding=function(e,t,i){var r=this;t.parentView&&(r=t.parentView);var n=r[t.target];n?n&&n instanceof Array?n.push(e):n&&n.isObservableCollection?n.addItem(e):r[t.target]=e:r[t.target]=e},r.prototype.buildTextBinding=function(e,t,i){var r=this.getBindingTarget(t);if(null===r)return!1;if(void 0===r)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var n=function(){if(null==r||r.isObservable){var i=r.get();i=null===i||void 0===i?"":i.toString(),"innerHTML"===t.attributeName?(dojo.empty(e),e.appendChild(dojo.doc.createTextNode(i))):dojo.attr(e,t.attributeName,String.escapeHtml(i))}else"innerHTML"===t.attributeName?(dojo.empty(e),e.appendChild(document.createTextNode(r))):dojo.attr(e,t.attributeName,String.escapeHtml(r))};r.isObservable&&t.targetBindings.push({event:r.bindingEvent,token:r.bind(this,n)}),this.bindingSetupDelegates.push(function(){n.apply(this,[null])})},r.prototype.buildAttributeBinding=function(e,t,i,r){var n=this.getBindingTarget(t);if(void 0===n)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var o=function(){if(null===n)return dojo.attr(e,t.attributeName,""),!1;if(n.isObservable){var i=n.get();null!==i&&void 0!==i||(i=""),!0===r?e[t.attributeName]=i:dojo.attr(e,t.attributeName,i)}else null!==n&&void 0!==n||(n=""),!0===r?e[t.attributeName]=n:dojo.attr(e,t.attributeName,n)};null!==n&&n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,o)}),this.bindingSetupDelegates.push(function(){o.apply(this,[null])})},r.prototype.buildStyleBinding=function(e,t,i){var r=this,n=this.getBindingTarget(t);if(null===n)return!1;var o=function(e,t){return isNaN(t)||""===t?t:t+"px"};if(void 0===n)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;if(null==n||n.isObservable){if(null!=n){var a=function(){var i=o(t.attributeName,n.get());dojo.style(e,t.attributeName,i)};n.isObservable&&t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,a)}),this.bindingSetupDelegates.push(function(){a.apply(r,[null])})}}else{var s=o(t.attributeName,n);dojo.style(e,t.attributeName,s)}},r.prototype.buildDomBinding=function(e,t,i){var r=this;t.parentView&&(r=t.parentView);var n=r[t.target];if(null==n)return!1;if(void 0===n)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;try{if(n.isObservable){if(t.targetBindings.push({event:n.bindingEvent,token:n.bind(this,function(e){if(!n.get())return!1;t.domElement=dojo.place(n.get(),t.domElement,"replace"),this.app&&this.app.viewManager.notifyDimensionsChanged(this)})}),!n.get())return!1;dojo.place(n.get(),t.domElement,"replace")}else{if(!n)return!1;dojo.place(n,t.domElement,"replace")}}catch(e){this.app.trace.warning("Binding error: An error occurred in view '{0}' while attempting to perform a DOM binding in view model '{1}'.".format(this.id,t.viewModel.id))}},r.prototype._createWidgetViewFromConfig=function(i,r){var n=i.type,o=i.id?"WidgetView-{0}-{1}".format(i.id,e.framework.utils.alphaNumericToken()):"{0}-{1}".format(e.framework.utils.alphaNumericToken(),e.framework.utils.alphaNumericToken()),a=new t.config.ViewConfig(o,null,n||"geocortex.framework.ui.ViewBase");a.isVisible=!0,a.libraryId=i.libraryId,i.markup&&(a.markupResource=i.markup);var s=null;if((i=this.app.translateConfiguration(i.libraryId,i)).viewModelId){if(!(s=this.app.getFrameworkObjectById(i.viewModelId)))throw new Error("Could not bind widget '{0}' to view model with ID '{1}': View model not found.".format(i.Id,i.viewModelId))}else i.viewModelType?(s=this.app.instantiateFrameworkObject(i.viewModelType,i.libraryId),i.id||(i.id=e.framework.utils.alphaNumericToken()),s.id="WidgetViewModel-{0}-{1}".format(i.id,e.framework.utils.alphaNumericToken())):s=r;var l=this.app.viewManager.createView(a);if(!l)throw new Error("Could not create widget '{0}': The widget's view could not be created.".format(i.Id));l.configuration=i.configuration;var u={children:[]};return u.children.push(l.root),l.root=u,l.attach(s),l.root=u.children[0],l},r.prototype.buildWidgetBinding=function(t,i,r){var n=this,o=i.target,a=this.viewModel,s=!0,l=!1,u=null,c=null;if(i.otherExpressions)for(f=0;f<i.otherExpressions.length;++f){var h=i.otherExpressions[f];if("@widget-context"===h.directive){if(i.target=h.target,!(a=this.getBindingTarget(i)))return this.app.trace.error("Error binding widget '{0}' to target '{1}': Target was not found in view model.".format(o,h.target)),!1;u=a}else"@widget-required"===h.directive?s=!("false"===h.target.toLowerCase()):"@widget-replace"===h.directive&&(l="true"===h.target.toLowerCase())}c=a&&a.isObservable;for(var d=this.app.configModel.widgetConfigs,p=null,f=0;f<d.length;++f){var g=d[f];if(g.id===o){p=g;break}}var v=!p,m=function(){var e=u||null;e&&e.isObservable&&(e=e.get());var t=(i.parentView||this).resolveWidget(o,e,i);if(!t){if(s)throw new Error("Widget '{0}' was not found.".format(o));return!1}return t},y=function(t,r){var a=null;if(i.boundViews.length>0)for(var s=0;s<i.boundViews.length;++s){var u=i.boundViews[s];n.app.viewManager.destroyView(u)}dojo.empty(i.domElement);var c=null;if(t){if("string"==typeof t){var h=dojo.create("div");dojo.attr(h,"innerHTML",t),dojo.addClass(h,"empty-div"),a=h.children&&1===h.children.length?h.children[0]:h}else if(t.hasOwnProperty("nodeType")&&[1,2,3,8,9].contains(p.nodeType))a=t;else if(t instanceof e.framework.ui.ViewBase)c=t,i.boundViews.push(c),a=t.root;else{if(!(t instanceof e.framework.config.WidgetConfig))return void n.app.trace.warning("Could not resolve widget '{0}': Object of unknown type provided.".format(o));c=n._createWidgetViewFromConfig(t,r),i.boundViews.push(c),a=c.root}dojo.place(a,i.domElement,l?"replace":"last"),c&&(c.added(n),c.activated())}};this.libraryId;p&&p.libraryId&&p.libraryId,c&&i.targetBindings.push({event:a.bindingEvent,token:a.bind(this,function(e){if(v){var t=m();y(t,e)}else y(p,e)})}),this.bindingSetupDelegates.push(function(){var e=null;if(a&&(e=a.isObservable?a.get():a),v){var t=m();y(t,e)}else y(p,e)})},r.prototype.buildClassBinding=function(e,t,i){var r=this.getBindingTarget(t);if(null===r)return!1;if(void 0===r)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;var n=function(i){var r=o.isTruthy(i);!0===t.invert&&(r=!r);var n=t.attributeName;!0===r?(dojo.removeClass(e,n),dojo.addClass(e,n)):dojo.removeClass(e,n)},o=this;r.isObservable&&t.targetBindings.push({event:r.bindingEvent,token:r.bind(this,n)}),this.bindingSetupDelegates.push(function(){n.apply(o,[r])})},r.prototype.isTruthy=function(t){if(!t)return!1;if(!(t instanceof e.framework.events.CollectionChangedArgs))return t.isObservableCollection?t.getLength()>0:t.isObservable?!!t.get():!!t||"string"==typeof t&&t.length>0;var i=t;if("append"===i.type){if(i.rangeEnd+1-i.rangeStart>0||i.sender.value&&i.sender.value.length>0)return!0}else{if("clear"===i.type)return!1;if("insert"===i.type){if(i.rangeEnd+1-i.rangeStart>0)return!0}else if("remove"===t.type&&i.rangeEnd+1-i.rangeStart<i.sender.value.length)return!0}},r.prototype.buildVisibilityBinding=function(e,t,i){var r=this.getBindingTarget(t);if(null===r)return!1;if(void 0===r)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(t.target,t.viewModel.id)),!1;t.initialVisibility=dojo.style(e,"display")||"block";var n=function(i){var r=o.isTruthy(i);1==t.invert&&(r=!r);var n="";n="inline"===t.initialVisibility?"bound-visible-inline":"bound-visible",1==r?(dojo.removeClass(e,"bound-invisible"),dojo.addClass(e,n)):(dojo.removeClass(e,n),dojo.addClass(e,"bound-invisible"))},o=this;r.isObservable&&t.targetBindings.push({event:r.bindingEvent,token:r.bind(this,n)}),this.bindingSetupDelegates.push(function(){n.apply(o,[r])})},r.prototype.buildDisabledBinding=function(t,i,r){var n=this.getBindingTarget(i);if(void 0===n)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(i.target,i.viewModel.id)),!1;i.initialDisabled=dojo.attr(t,"disabled");var o=function(r){var o=!1;r?n&&(r instanceof e.framework.events.CollectionChangedArgs?"append"==r.type?(r.rangeEnd+1-r.rangeStart>0||n.value&&n.value.length>0)&&(o=!1):"clear"==r.type?o=!0:"insert"==r.type?r.rangeEnd+1-r.rangeStart>0&&(o=!1):"remove"==r.type&&r.rangeEnd+1-r.rangeStart<n.value.length&&(o=!1):o=n.isObservableCollection?!(n.getLength()>0):n.isObservable?!n.get():"string"==typeof r&&0==r.length):o=!0,1==i.invert&&(o=!o),1==o?(dojo.attr(t,"disabled",!0),dojo.attr(t,"tabindex",-1),dojo.addClass(t,"bound-disabled")):(dojo.removeAttr(t,"disabled"),dojo.removeAttr(t,"tabindex"),dojo.removeClass(t,"bound-disabled"))},a=this;n.isObservable&&i.targetBindings.push({event:n.bindingEvent,token:n.bind(this,o)}),this.bindingSetupDelegates.push(function(){o.apply(a,[n])})},r.prototype.buildValueBinding=function(i,r,n){var o=this,a=this.getBindingTarget(r);if(void 0===a)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(r.target,r.viewModel.id)),!1;if(null==a)return!1;var s=a.isObservable||!1,l=a.isObservableCollection||!1,u=i.tagName.toLowerCase(),c=dojo.attr(i,"type")||i.type?i.type:null;if(s){var h=function(e){e!==dojo.attr(i,"value")&&(null!==e&&void 0!==e||(e=""),dojo.attr(i,"value",e))},d=function(e){i.checked=!0===e},p=function(e){var t=dojo.attr(i,"value");dojo.query("input[type=radio]",o.root).forEach(function(e){e.name,i.name}),i.checked=!0===e||t==e},f=function(e){if(e instanceof Date){var t=new Date(e.getTime());t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),i.valueAsDate=t}else i.value=e},g=function(t){var i=t,n=function(e,t){if(void 0!==e.___attachedValue){var r=e.___attachedValue;return r===(void 0===t?i:t)||("number"==typeof r||"boolean"==typeof r?r=r.toString():r&&r.hasOwnProperty("value")&&("number"!=typeof(r=r.value)&&"boolean"!=typeof r||(r=r.toString())),r===(void 0===t?i:t))}var n=void 0===t?i:t;return e.value===n};if(i instanceof e.framework.events.CollectionChangedArgs){for(var o=i,a=o.sender,s=[],l=o.rangeStart;l<=o.rangeEnd;l++){var u=a.getAt(l);s.push(u.value?u.value+"":u)}if("append"===o.type||"insert"===o.type)for(p=0;p<r.domElement.options.length;++p)for(var c=r.domElement.options[p],h=0;h<s.length;h++)n(c,s[h])?c.selected=!0:dojo.attr(r.domElement,"multiple")||(c.selected=!1)}else if("number"!=typeof i&&"boolean"!=typeof i||(i=i.toString()),null===i||void 0===i)for(p=0;p<r.domElement.options.length;++p)(c=r.domElement.options[p]).selected=!1;else if(dojo.isArray(i)){if(r.viewModel[r.target].isObservableCollection){for(var d=!1,p=0;p<r.domElement.options.length;++p)if((c=r.domElement.options[p]).selected=!1,dojo.attr(r.domElement,"multiple")||!d)for(var f=0;f<i.length;++f){var g=i[f];if(n(c,g)){c.selected=!0,d=!0;break}}}else for(p=0;p<r.domElement.options.length;++p)if(n(c=r.domElement.options[p],g)){c.selected=!0;break}}else for(p=0;p<r.domElement.options.length;++p)if(n(c=r.domElement.options[p],g)){c.selected=!0;break}};"select"===u?(r.targetBindings.push({event:a.bindingEvent,token:a.bind(r,g)}),this.bindingSetupDelegates.push(function(){g.apply(o,[a.get()])})):"radio"===c?(r.targetBindings.push({event:a.bindingEvent,token:a.bind(r,p)}),this.bindingSetupDelegates.push(function(){p.apply(o,[a.get()])})):"checkbox"===c?(r.targetBindings.push({event:a.bindingEvent,token:a.bind(r,d)}),this.bindingSetupDelegates.push(function(){d.apply(o,[a.get()])})):"date"===c?(r.targetBindings.push({event:a.bindingEvent,token:a.bind(r,f)}),this.bindingSetupDelegates.push(function(){f.apply(o,[a.get()])})):(r.targetBindings.push({event:a.bindingEvent,token:a.bind(r,h)}),this.bindingSetupDelegates.push(function(){h.apply(o,[a.get()])}))}"textarea"===u||"input"===u&&"text"===c?function(){var e=null,t=function(t){var i=dojo.attr(t.currentTarget,"value");if(i!==e)return e=i,s?a.set(i):o.setBindingTargetValue(r,i),!0};r.on("change",t),r.on("keyup",t),r.on("mouseup",t),r.on("input",t)}():"input"===u&&"checkbox"===c?r.on("change",function(e){var t=dojo.attr(e.currentTarget,"checked");return s?a.set(t):o.setBindingTargetValue(r,t),!0}):"input"===u&&"radio"===c?r.on("click",function(e){return dojo.attr(e.currentTarget,"checked")&&(s?a.set(e.currentTarget.value):o.setBindingTargetValue(r,e.currentTarget.value)),!0}):"input"===u&&"date"===c?r.on("change",function(e){var t=s?a.get():a,i=e.currentTarget.valueAsDate;return i.setMinutes(i.getMinutes()+i.getTimezoneOffset()),t instanceof Date&&!isNaN(t.getTime())&&(i.setHours(t.getHours()),i.setMinutes(t.getMinutes()),i.setSeconds(t.getSeconds()),i.setMilliseconds(t.getMilliseconds())),s?a.set(i):o.setBindingTargetValue(r,i),!0}):"select"===u?(i.___populateInitialValueFunc=function(){g(a.isObservable?a.get():a)},r.on("change",function(){for(var e=dojo.query("option",i),n=[],u=0;u<e.length;++u){var c=e[u];!0===c.selected&&(h=c.___attachedValue,t.utils.isNullOrUndefined(h)?n.push(c.value):n.push(h))}if(0===n.length&&e.length>0&&!i.multiple&&!0===o.app.___uaIsiPad){i.selectedIndex=0;var h=e[0].___attachedValue;n.push(t.utils.isNullOrUndefined(h)?e[0].value:h)}return n.length>0?l?(a.clear(),a.addItems(n)):s?a.set(n[0]):o.setBindingTargetValue(r,n):a.clear(),!0})):r.on("change",function(e){if(void 0!==e.currentTarget){var t=dojo.attr(e.currentTarget,"value");return s?a.set(t):o.setBindingTargetValue(r,t),!0}o.app&&o.app.trace.error("Binding error: bound to change event where currentTarget is undefined")})},r.prototype.applyBinding=function(e,t,i,r){return"source"===t.type?this.buildSourceBinding(e,t,i,r):"event"===t.type?this.buildEventBinding(e,t,i):"text"===t.type?this.buildTextBinding(e,t,i):"var"===t.type?this.buildVarBinding(e,t,i):"class"===t.type?this.buildClassBinding(e,t,i):"style"===t.type?this.buildStyleBinding(e,t,i):"dom"===t.type?this.buildDomBinding(e,t,i):"value"===t.type?this.buildValueBinding(e,t,i):"attr"===t.type?this.buildAttributeBinding(e,t,i):"attachment"===t.type?this.buildAttributeBinding(e,t,i,!0):"visibility"===t.type?this.buildVisibilityBinding(e,t,i):"disabledState"===t.type?this.buildDisabledBinding(e,t,i):"widget"===t.type&&this.buildWidgetBinding(e,t,i),!0},r}(e.framework.FrameworkObject);i.ViewBase=r}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(t){var i=function(){function t(e,t){this._viewActivationTimers=[],this._viewDeactivationTimers=[],this.isActive=!1,this.domElement=null,this.options=null,this.views=[],this.activeViews=[],this.defaultTransitionDelay=10,this.app=t,this.name=e}return t.prototype.host=function(e,t){this.domElement=e,this.options=t||{},this.options.useTransitions?this.options.transitionDelay&&!isNaN(this.options.transitionDelay)||(this.options.transitionDelay=this.defaultTransitionDelay):this.options.useTransitions=!1},t.prototype.unhost=function(){this.domElement=null,this.options=null},t.prototype.activateView=function(t){this.cancelActivate(t),0===this.activeViews.length&&!1===t.isActive&&(this.isActive=!0,this.app.event("RegionActivatedEvent").publish(this),dojo.removeClass(this.domElement,"region-inactive"),dojo.addClass(this.domElement,"region-active")),e.utils.ArrayUtils.contains(this.activeViews,t)?(e.utils.ArrayUtils.removeItem(this.activeViews,t),this.activeViews.push(t)):this.activeViews.push(t),t.activated(),t.isActive=!0,this.options.useTransitions?(dojo.removeClass(t.root,"inactive"),dojo.addClass(t.root,"activating"),this._viewActivationTimers[t.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(t.root,"inactive"),dojo.removeClass(t.root,"activating"),dojo.addClass(t.root,"active"),delete this._viewActivationTimers[t.id]}),this.options.transitionDelay)):(dojo.removeClass(t.root,"inactive"),dojo.addClass(t.root,"active")),this.app.event("ViewActivatedEvent").publish(t)},t.prototype.cancelActivate=function(e){this._viewActivationTimers[e.id]&&(clearTimeout(this._viewActivationTimers[e.id]),delete this._viewActivationTimers[e.id],dojo.removeClass(e.root,"activating"))},t.prototype.cancelDeactivate=function(e){this._viewActivationTimers[e.id]&&(clearTimeout(this._viewActivationTimers[e.id]),delete this._viewActivationTimers[e.id],dojo.removeClass(e.root,"deactivating"))},t.prototype.deactivateView=function(t){this.cancelDeactivate(t),this.activeViews.length<=1&&!0===t.isActive&&(this.isActive=!1,dojo.removeClass(this.domElement,"region-active"),dojo.addClass(this.domElement,"region-inactive"),this.app.event("RegionDeactivatedEvent").publish(this)),this.cancelActivate(t),e.utils.ArrayUtils.removeItem(this.activeViews,t),t.deactivated(),t.isActive=!1,this.options.useTransitions?(dojo.removeClass(t.root,"active"),dojo.addClass(t.root,"deactivating"),this._viewDeactivationTimers[t.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(t.root,"active"),dojo.removeClass(t.root,"deactivating"),dojo.addClass(t.root,"inactive"),delete this._viewDeactivationTimers[t.id]}),this.options.transitionDelay)):(dojo.removeClass(t.root,"active"),dojo.addClass(t.root,"inactive")),this.app.event("ViewDeactivatedEvent").publish(t)},t.prototype.hostView=function(e){e.added(),dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive"),this.app.event("ViewHostedEvent").publish({region:this,view:e})},t.prototype.unhostView=function(e){e.removed(),dojo.removeClass(e.root,"active"),dojo.addClass(e.root,"inactive"),this.app.event("ViewUnhostedEvent").publish({region:this,view:e})},t}();t.RegionAdapterBase=i}(e.ui||(e.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(i){function r(e,t){var n=this;if(i.call(this,e,t),this.activeView=null,this.activeViews=[],this.titleBindingToken=null,this.contentHeader=null,this.contentTitle=null,this.contentContainer=null,this.contentElement=null,this.overlayElement=null,this._scrollTimer=null,this._scrollDelay=50,this._screenReaderNarrationDisabled=!1,r.instance)throw new Error("PopupModalRegionAdapter is a singleton and has already been constructed once.");r.instance=this,null==this.app.modalRegionSingleton&&(this.app.modalRegionSingleton=this),this.app.command("CloseModalRegion").register(this,function(){n.deactivate()}),this.app.event("ViewActivatedEvent").subscribe(this,function(){n.activeViews.length>0&&setTimeout(function(){n.positionContent()},0)}),this.app.event("ViewDimensionsChangedEvent").subscribe(this,function(){n.positionContent()})}return __extends(r,i),r.getInstance=function(){return r.instance},r.prototype.activate=function(){this.activeViews.length>0&&(dojo.style(this.domElement,"opacity",0),dojo.query(this.domElement).removeClass("inactive"),dojo.query(this.domElement).addClass("active"),dojo.query(this.overlayElement).removeClass("inactive"),dojo.query(this.overlayElement).addClass("active"))},r.prototype.deactivate=function(){dojo.query(this.domElement).removeClass("active"),dojo.query(this.domElement).addClass("inactive"),dojo.query(this.overlayElement).removeClass("active"),dojo.query(this.overlayElement).addClass("inactive"),this._screenReaderNarrationDisabled&&(this.app.command("EnableScreenReaderNarrate").execute(),this._screenReaderNarrationDisabled=!1),this.activeView&&(this.activeView=null)},r.prototype.host=function(e){var t=this;i.prototype.host.call(this,e),this.domElement=e,dojo.query(this.domElement).removeClass("active"),dojo.query(this.domElement).addClass("inactive"),this.contentContainer=dojo.query(".modal-container")[0],this.contentElement=dojo.query(".modal-container-inner")[0],this.overlayElement=dojo.query(".modal-overlay")[0],dojo.connect(window,"onresize",function(){t.handleScrollEvent()}),dojo.connect(window,"onscroll",function(){t.handleScrollEvent()}),this.app.event("WorkflowFormTextInputBlurredEvent").subscribe(this,function(){setTimeout(function(){t.positionContent()},100)})},r.prototype.handleScrollEvent=function(){var e=this;null!=this._scrollTimer&&(clearTimeout(this._scrollTimer),this._scrollTimer=null),this._scrollTimer=setTimeout(function(){e.positionContent()},0)},r.prototype.positionContent=function(){var e=this;if(this.contentContainer&&null!=this.activeView&&null!=this.activeView.root){var t=dojo.position(this.contentContainer),i=dojo.window.getBox(),r=t.w;t.w>i.w?(r=i.w,dojo.style(this.contentElement,{"max-width":r+"px"})):dojo.style(this.contentElement,{"max-width":""});var n=t.h;t.h>i.h?(n=i.h,dojo.style(this.contentElement,{"max-height":n+"px"})):dojo.style(this.contentElement,{"max-height":""}),dojo.style(this.contentContainer,{left:i.w/2-r/2+"px",top:i.h/2-n/2+"px"}),setTimeout(function(){return dojo.style(e.domElement,"opacity",1)})}},r.prototype.showActiveView=function(e){e.isActive&&(this.activeView=e,this.hideAllViews(),e.activated(),this.activate(),this.activeView=e,dojo.removeClass(e.root,"inactive"),dojo.addClass(e.root,"active"))},r.prototype.hideAllViews=function(){dojo.query("> .view",this.contentElement).removeClass("active"),dojo.query("> .view",this.contentElement).addClass("inactive")},r.prototype.activateView=function(e){var r=this;t.utils.ArrayUtils.contains(this.activeViews,e)?(t.utils.ArrayUtils.removeItem(this.activeViews,e),this.activeViews.push(e)):this.activeViews.push(e),this._screenReaderNarrationDisabled||(this._screenReaderNarrationDisabled=!0,this.app.command("DisableScreenReaderNarrate").execute()),i.prototype.activateView.call(this,e),this.showActiveView(e),this._repositionOnImageLoaded(e.root),setTimeout(function(){return r.app.command("FocusOnFirstInputInView").execute(e)},400)},r.prototype.deactivateView=function(e){t.utils.ArrayUtils.removeItem(this.activeViews,e),this.activeViews.length>0?(this.showActiveView(this.activeViews[this.activeViews.length-1]),this.positionContent()):this.deactivate(),i.prototype.deactivateView.call(this,e)},r.prototype.deactivateActiveView=function(){if(this.activeView){null!=this.titleBindingToken&&(this.activeView.title.unbind(this.titleBindingToken),this.titleBindingToken=null);var e=this.activeView;this.activeView=null,this.deactivateView(e),t.utils.ArrayUtils.removeItem(this.activeViews,this.activeView)}},r.prototype.hostView=function(t){if(this.views.push(t),null==t.root){var r=e.resourceManager.fetch(t.markupResource,t.libraryId);if(null==r)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;t.root=dojo.create("div",{className:"view {0}".format(t.id)}),t.root.innerHTML=r,dojo.place(t.root,this.contentElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t),this.positionContent()}else dojo.place(t.root,this.contentElement,"last");return i.prototype.hostView.call(this,t),!0},r.prototype.unhostView=function(e){e==this.activeView&&this.deactivateView(e),t.utils.ArrayUtils.removeItem(this.views,e),t.utils.ArrayUtils.removeItem(this.activeViews,e);var r=new dojo.NodeList;r.push(e.root),r.orphan(),i.prototype.unhostView.call(this,e)},r.prototype._repositionOnImageLoaded=function(e){var t=this,i="attached_ModalRegion_ImageLoadedConnection";dojo.forEach(dojo.query("img",e),function(e){e[i]&&(dojo.disconnect(e[i]),delete e[i]);var r=dojo.connect(e,"load",t,function(e){t._imageLoaded(e)});e[i]=r})},r.prototype._imageLoaded=function(e){var t=e.target,i="attached_ModalRegion_ImageLoadedConnection";t[i]&&(dojo.disconnect(t[i]),delete t[i]),this.positionContent()},r.instance=null,r}(i.RegionAdapterBase);i.PopupModalRegionAdapter=r}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(){}return e.createCommands=function(e){},e}();e.ApplicationCommands=t}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(){return function(e,t,i){this.impl=e,this.scope=t,this.canExecute=i}}(),n=function(){function i(e,i,r){this._entries={},this.app=null,this.name=e,this.app=i,this.isWrapper=!0,this.canExecuteChanged=new t.events.Event("{0}.CanExecuteChanged".format(e)),this.preExecute=new t.events.Event("{0}.PreExecute".format(e)),this.postExecute=new t.events.Event("{0}.PostExecute".format(e)),this.canExecuteMode=null!=r&&void 0!=r?r:"all"}return i.prototype.raiseCanExecuteChanged=function(){this.canExecuteChanged.publish()},i.prototype.canExecute=function(e){if(this.isWrapper)return!1;for(var t in this._entries)if(this._entries.hasOwnProperty(t)){var i=this._entries[t];if(i.canExecute&&i.canExecute.apply(i.scope,arguments)){if("any"===this.canExecuteMode)return!0}else if("all"===this.canExecuteMode)return!1}return"any"!==this.canExecuteMode},i.prototype.execute=function(e){var t=!1;if(this._entries)for(var i in this._entries)if(this._entries.hasOwnProperty(i)){t=!0;break}if(t){if("all"!==this.canExecuteMode||this.canExecute.apply(this,arguments)){if(this.app&&this.app.debugMode){var r="Command '{0}' executed.".format(this.name);console.debug?console.debug(r):console.log(r)}this.preExecute.publish.apply(this.preExecute,arguments);for(var i in this._entries)if(this._entries.hasOwnProperty(i)){var n=this._entries[i];("any"!==this.canExecuteMode||n.canExecute.apply(n.scope,arguments))&&n.impl.apply(n.scope,arguments)}this.postExecute.publish.apply(this.postExecute,arguments)}}else this.app.trace.debug("Command '{0}' executed but no implementation registered.".format(this.name))},i.prototype.register=function(t,i,n){this.isWrapper=!1;var o=e.framework.utils.alphaNumericToken(),a=new r(i,t,n||this.defaultCanExecuteFunction);return this._entries[o]=a,t&&t instanceof e.framework.FrameworkObject&&t.trackCommandHandler(this,o),this.app.trace.debug("Registered an implementation for command '{0}'.".format(this.name)),this.raiseCanExecuteChanged(),o},i.prototype.defaultCanExecuteFunction=function(){return!0},i.prototype.unregister=function(e){return this.isWrapper=!1,!!this._entries.hasOwnProperty(e)&&(delete this._entries[e],this.app.trace.debug("Unregistered an implementation for command '{0}'.".format(this.name)),this.raiseCanExecuteChanged(),!0)},i.prototype.clear=function(){this._entries={},this.raiseCanExecuteChanged(),this.app.trace.debug("Cleared all implementations of command '{0}'.".format(this.name))},i}();i.Command=n}(t.commands||(t.commands={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){var i=function(){function t(e){this.commands={},this.app=e}return t.prototype.clear=function(){for(var e in this.commands)this.commands.hasOwnProperty(e)&&this.commands[e].clear()},t.prototype.command=function(t){var i=this.commands[t];if(!i){var r=new e.framework.commands.Command(t,this.app);return r.isWrapper=!0,this.commands[r.name]=r,r}return i},t}();t.CommandRegistry=i}(t.commands||(t.commands={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){function i(t){var i=[-1399014851,-706512510];e._nonConfigs&&(i=e._nonConfigs.map(function(e){return String.quickHashCode(e.toLowerCase())}));var r=document.createElement("a");for(r.href=t.toLowerCase(),t=r.href,t=decodeURIComponent(t);t.indexOf("%")>-1;)t=decodeURIComponent(t);var n=(t=t.replace(/[\\\/:]+/g,"/")).split(/[\\\/:]/),o=(n.length,n.map(function(e){return e.toLowerCase()}).map(function(e,t){return t<n.length-1?[e,n[t+1]]:null}));o.pop();var a=!1;return o.forEach(function(e){var t=String.quickHashCode(e[0]+"/"+e[1]);i.indexOf(t)>-1&&(a=!0)}),a}var r=function(){function e(e){this._targetConfigUri=null,this.app=e}return e.prototype.loadConfigurationTree=function(e,t){var r=this;if(this._targetConfigUri=e,i(this._targetConfigUri)){var n=new Error("Configuration cannot be loaded from this location.");this.app.event("ConfigurationLoadFailedEvent").publish(n)}else this.app.fetchConfigResource({url:this._targetConfigUri,load:function(e){null!=t&&void 0!=t&&t(e)},error:function(e){return r.app.event("ConfigurationLoadFailedEvent").publish(e)}})},e}();t.ConfigurationLoader=r,t.checkList=i}(t.config||(t.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){return function(e,t){this.locales=[],this.position=0,this.omitStyles=!1,this.id=e,this.uri=t}}();e.LibraryConfig=t}(e.config||(e.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){var i=function(e){function t(t,i){e.call(this,t,i)}return __extends(t,e),t.prototype.initialize=function(e){},t.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},t}(e.framework.FrameworkObject);t.ViewModelBase=i}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){return function(e,t,i){this.viewId=e,this.moduleName=t,this.typeName=i}}();e.ViewConfig=t}(e.config||(e.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){return function(e,t,i){this.libraryId="",this.configuration={},this.viewModelId=e,this.moduleName=t,this.typeName=i}}();e.ViewModelConfig=t}(e.config||(e.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){return function(e,t,i,r){this.viewConfigs=[],this.viewModelConfigs=[],this.moduleName=e,this.moduleType=t,this.configuration=i,this.libraryId=r}}();e.ModuleConfig=t}(e.config||(e.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){return function(e,t){this.viewModelType=null,this.configuration={},this.typeName="",this.markup="",this.id=e,this.libraryId=t}}();e.WidgetConfig=t}(e.config||(e.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){var i=function(){function t(e){this.application={},this.version="unknown",this.viewerId="unknown",this.defaultLibraryId="",this.globals=null,this.libraryConfigs=[],this.moduleConfigs=[],this.widgetConfigs=[],this.libraryModules={},this.externalLocaleReferences=[],this.app=e}return t.prototype.parse=function(t,i){var r="object"==typeof t?t:JSON.parse(t);if(!r.configuration){var n={version:"1.0",viewerId:"unknown",application:{},defaultLibraryId:"",libraries:[],modules:[],widgets:[]};r.configuration=n}var o,a,s;try{this.application=r.configuration.application||{},this.version=r.configuration.version||"1.0",this.viewerId=r.configuration.viewerId||"unknown",this.defaultLibraryId=r.configuration.defaultLibraryId||null,o=r.configuration.libraries||[],a=r.configuration.modules||[],s=r.configuration.widgets||[],this.app.trace.debug("Config version: {0}.".format(this.version))}catch(e){return void this.app.trace.error("Error reading configuration: {0}".format(e),e)}if(o&&o.length>0)for(E=0;E<o.length;++E){var l=o[E];l=this.app.translateConfiguration(l.id,l),null==this.defaultLibraryId&&(this.defaultLibraryId=l.id);var u=new e.framework.config.LibraryConfig(l.id,l.uri);if(u.position=E,u.omitStyles=l.omitStyles||!1,this.libraryConfigs.push(u),this.libraryModules[l.id]=[],l.locales)for(h=0;h<l.locales.length;++h){var c=l.locales[h];c.locale=c.locale.toLowerCase(),c.hasOwnProperty("uri")&&(c.libraryId=l.id,u.locales.push(c),this.externalLocaleReferences.push(c))}}if(a&&a.length>0)for(var h=0;h<a.length;++h){var d=a[h],p=d.libraryId;p||(p=this.defaultLibraryId);var f=new e.framework.config.ModuleConfig(d.moduleName,d.moduleType,d.configuration,p);this.libraryModules[p]?this.libraryModules[p].push(f):this.app.trace.error("Unknown library '{0}'.".format(p));var g=d.views;if(g)for(b=0;b<g.length;++b){var v=g[b],m=v.type||"geocortex.framework.ui.ViewBase",y=new e.framework.config.ViewConfig(v.id,d.moduleName,m);f.viewConfigs.push(y),y.libraryId=v.libraryId||p,y.viewModelId=v.viewModelId||null,y.markupResource=v.markup||null,y.configuration=v.configuration||{},y.regionName=v.region||null,y.isManaged=v.isManaged||!1,y.isVisible=v.visible||!1,y.title=v.title||null,y.description=v.description||"",y.iconUri=v.iconUri||""}var w=d.viewModels;if(w)for(var b=0;b<w.length;++b){var _=w[b],k=new e.framework.config.ViewModelConfig(_.id,d.moduleName,_.type);f.viewModelConfigs.push(k),k.libraryId=_.libraryId||p,_.configuration&&(k.configuration=_.configuration)}this.moduleConfigs.push(f)}if(s&&s.length>0)for(var E=0;E<s.length;++E){var x=new e.framework.config.WidgetConfig(s[E].id,s[E].libraryId||this.defaultLibraryId);dojo.safeMixin(x,s[E]),this.widgetConfigs.push(x)}i&&i(this)},t}();t.ConfigurationModel=i}(t.config||(t.config={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){var i=function(){function t(e){this.events={},this.app=e}return t.prototype.clear=function(){for(var e in this.events)this.events.hasOwnProperty(e)&&this.events[e].clear()},t.prototype.event=function(t){var i=this.events[t];return i||(i=new e.framework.events.Event(t,this.app),this.events[t]=i),i},t}();t.EventRegistry=i}(t.events||(t.events={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(){this.capacity=e.UNKNOWN,this.sizeInChars=e.UNKNOWN,this.numKeys=e.UNKNOWN}return e.UNKNOWN=-1,e}();e.StorageStats=t}(e.storage||(e.storage={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function t(e){this.app=e,this.keyNamespace=e.id}return t.prototype.initialize=function(){},t.prototype.isSupported=function(){return!1},t.prototype.isFull=function(){return!1},t.prototype.getStats=function(){return new e.StorageStats},t.prototype.getScore=function(){return 0},t.prototype.clear=function(e,t){},t.prototype.clearAllData=function(e,t){},t.prototype.get=function(e,t,i,r){},t.prototype.set=function(e,t,i,r,n){},t.prototype.remove=function(e,t,i,r){},t}();e.StorageProviderBase=t}(e.storage||(e.storage={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(t){function i(){t.apply(this,arguments),this._isInitializing=!1,this._initializationSuccessCallback=null,this._initializationErrorCallback=null,this._defaultDesiredSize=524288e3,this._storageTypeTemporary=0,this._storageTypePersistent=1,this._error=null,this._isFull=!1,this._isInitialized=!1}return __extends(i,t),i.prototype.initialize=function(e){var i=this;if(!this._isInitialized&&!this._error)if(t.prototype.initialize.call(this),this.isSupported()){e||(this.app.configuration&&this.app.configuration.offlineStorageSpaceMb&&(e=1024*parseInt(this.app.configuration.offlineStorageSpaceMb,10)*1024),e||(e=this._defaultDesiredSize));var r=function(e){i._isInitialized||(i._isInitialized=!0,i.app.trace.debug("Filesystem '{0}' initialized successfully.".format(e.name)),i._filesystem=e,i._error=null,i._initializationSuccessCallback(e))};navigator.webkitPersistentStorage||window.webkitStorageInfo?this._requestQuota(this._storageTypePersistent,e,function(t){this._isInitialized||(i.app.trace.debug("HTML5 File API quota granted. Size: {0} bytes.".format(t)),i._requestFileSystem(window.PERSISTENT,e,r,function(e){e=i._shapeError(e),i._error=e,i._initializationErrorCallback(e)}))},function(e){e=i._shapeError(e),i._error=e,i.app.trace.error("Error requesting filesystem quota: {0}".format(e.toString()),e),i._initializationErrorCallback(e)}):this._requestFileSystem(LocalFileSystem.PERSISTENT,e,r,function(e){e=i._shapeError(e),i._error=e,i._initializationErrorCallback(e)})}else this.app.trace.warning("The HTML5 storage provider could not be initialized. The File API is not supported by this browser.")},i.prototype.isSupported=function(){return!(!window.requestFileSystem&&!window.webkitRequestFileSystem)},i.prototype.isFull=function(){return this._isFull},i.prototype.getScore=function(){return this.initialize(),5},i.prototype.getStats=function(){return this.initialize(),new e.StorageStats},i.prototype._ensureInitializedThen=function(e){var t=null;if(this._isInitialized)e.apply(this,[]);else if(this._isInitializing)t=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(t),e.apply(i,[])});else{var i=this;this._isInitializing=!0,t=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(t),e.apply(i,[])}),this.initialize()}},i.prototype._silentlyEnsureInitializeThen=function(e,t){var i=this;this._isInitialized||this._isInitializing||!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?i._ensureInitializedThen(e):this._queryUsageAndQuota(this._storageTypePersistent,function(r,n){0==r&&0==n?t():i._ensureInitializedThen(e)},function(e){e=i._shapeError(e),i.app.trace.warning("An error occurred while trying to fetch file API usage information: {0}".format(e.toString()))})},i.prototype._requestFileSystem=function(e,t,i,r){if(window.requestFileSystem)window.requestFileSystem(e,t,i,r);else{if(!window.webkitRequestFileSystem)throw new Error("No request filesystem method found");window.webkitRequestFileSystem(e,t,i,r)}},i.prototype._requestQuota=function(e,t,i,r){var n=navigator,o=window;switch(e){case this._storageTypeTemporary:n.webkitTemporaryStorage&&n.webkitTemporaryStorage.requestQuota?n.webkitTemporaryStorage.requestQuota(t,i,r):o.webkitStorageInfo&&o.webkitStorageInfo.requestQuota&&o.webkitStorageInfo.requestQuota(window.TEMPORARY,t,i,r);break;case this._storageTypePersistent:n.webkitPersistentStorage&&n.webkitPersistentStorage.requestQuota?n.webkitPersistentStorage.requestQuota(t,i,r):o.webkitStorageInfo&&o.webkitStorageInfo.requestQuota&&o.webkitStorageInfo.requestQuota(window.PERSISTENT,t,i,r)}},i.prototype._queryUsageAndQuota=function(e,t,i){var r=navigator,n=window;switch(e){case this._storageTypeTemporary:r.webkitTemporaryStorage&&r.webkitTemporaryStorage.queryUsageAndQuota?r.webkitTemporaryStorage.queryUsageAndQuota(t,i):n.webkitStorageInfo&&n.webkitStorageInfo.queryUsageAndQuota&&n.webkitStorageInfo.queryUsageAndQuota(window.TEMPORARY,t,i);break;case this._storageTypePersistent:r.webkitPersistentStorage&&r.webkitPersistentStorage.queryUsageAndQuota?r.webkitPersistentStorage.queryUsageAndQuota(t,i):n.webkitStorageInfo&&n.webkitStorageInfo.queryUsageAndQuota&&n.webkitStorageInfo.queryUsageAndQuota(window.PERSISTENT,t,i)}},i.prototype._writeValue=function(e,t,i,r,n){function o(e){e=a._shapeError(e),r&&r(e)}var a=this,s=n?"":this.keyNamespace;try{!function(t){n?a._filesystem.root.getFile(e+".json",{create:!0,exclusive:!1},t,o):a._filesystem.root.getDirectory(s,{create:!0,exclusive:!1},function(i){a._filesystem.root.getFile(s+"/"+e+".json",{create:!0,exclusive:!1},t,o)},o)}(function(e){e.createWriter(function(e){e.truncate(0)}),e.createWriter(function(e){e.onwriteend=function(e){a.app.trace.debug("Wrote {0} bytes to filesystem.".format(e.total))},e.onerror=function(e){e=a._shapeError(e),a.app.trace.debug("Write failed: {0}".format(e)),r&&r(e)};var n=!1;try{var s=!1;if(void 0!==window.cordova&&window.cordova.exec&&(e.write(t),s=!0),!s&&"undefined"!=typeof Blob)try{var l=new Blob([t],{type:"text/plain"});e.write(l),s=!0}catch(e){a.app.trace.debug('Failed to create blob "'+e+'". Falling back to BlobBuilder.')}if(!s){var u=null;if("undefined"!=typeof BlobBuilder?u=new BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?u=new WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder&&(u=new MSBlobBuilder),!u)throw new Error("Error writing to File API file: No BlobBuilder implementation found.");u.append(t),e.write(u.getBlob("text/plain"))}}catch(e){n=!0,o(e)}n||i()})})}catch(e){o(e)}},i.prototype._readValue=function(e,t,i,r){function n(e){e.code&&e.code===FileError.NOT_FOUND_ERR?t(null):(e=o._shapeError(e),i&&i(e))}var o=this,a=r?"":this.keyNamespace+"/";o._filesystem.root.getFile(a+e+".json",{},function(e){e.file(function(e){var i=new FileReader;i.onloadend=function(e){t(this.result)};try{i.readAsText(e)}catch(e){n(e)}},n)},n)},i.prototype._shapeError=function(e){var t="";if(e.hasOwnProperty("code")){switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="Quota Exceeded.";break;case FileError.NOT_FOUND_ERR:t="File not found.";break;case FileError.SECURITY_ERR:t="Security error.";break;case FileError.INVALID_MODIFICATION_ERR:t="Invalid modification.";break;case FileError.INVALID_STATE_ERR:t="Invalid state.";break;default:t="Unknown Error."}e=new Error("File error: {0}.".format(t))}return e},i.prototype.clear=function(e,t){function i(e){t&&(e=r._shapeError(e),t(e))}var r=this;this._silentlyEnsureInitializeThen(function(){r._filesystem.root.getDirectory(this.keyNamespace,{create:!1},function(t){t.removeRecursively(function(){e&&e()},i)},function(t){t.code===FileError.NOT_FOUND_ERR?e():i(t)})},e)},i.prototype.clearAllData=function(e,t){var i=this;this._silentlyEnsureInitializeThen(function(){try{var r=i._filesystem.root.createReader(),n=[],o=0,a=0,s=new dojo.Deferred,l=new dojo.Deferred,u=new dojo.DeferredList([s,l]);u.then(function(i){a?t&&t(new Error("{0} errors were encountered while clearing the storage provider.".format(a))):e&&e()}),u.addErrback(function(e){t&&(e=i._shapeError(e),t(e))});var c=function(){var e=function(){--o<=0&&(s.resolve(),l.resolve())},t=function(e){e=i._shapeError(e),i.app.trace.warning("Error removing local file: {0}.".format(e.toString())),++a,--o<=0&&s.resolve()};if(0===(o=n.length))s.resolve(),l.resolve();else if(0===n.length)s.resolve(),l.resolve();else for(var r=0;r<n.length;++r)try{i._filesystem.root.getFile(n[r],{},function(i){i.remove(e,t)},function(e){e=i._shapeError(e),i.app.trace.warning("Could not obtain file for removal: {0}.".format(e.toString())),l.errback(e)})}catch(e){e=i._shapeError(e),u.errback(e)}},h=function(){},d=function(e){e=i._shapeError(e),i.app.trace.warning("Error removing local folder: {0}.".format(e.toString())),++a,l.resolve()},p=function(){r.readEntries(function(e){if(e.length){for(var t=0;t<e.length;++t){var i=e[t];i.isDirectory?i.removeRecursively(h,d):n.push(i.fullPath)}p()}else c()},function(e){e=i._shapeError(e),t&&t(e)})};p()}catch(e){e=i._shapeError(e),t&&t(e)}},e)},i.prototype.get=function(e,t,i,r){var n=this;this._silentlyEnsureInitializeThen(function(){try{n._readValue(e,t,i,r)}catch(e){e=n._shapeError(e),i&&i(e)}},function(){t(null)})},i.prototype.set=function(e,t,i,r,n){var o=this;this._ensureInitializedThen(function(){try{o._writeValue(e,t,i,r,n)}catch(e){e=o._shapeError(e),r&&r(e)}})},i.prototype.remove=function(e,t,i,r){var n=this,o=r?"":this.keyNamespace;this._ensureInitializedThen(function(){try{n._filesystem.root.getFile(o+"/"+e+".json",{create:!1},function(e){e.remove(t,function(e){e=n._shapeError(e),i&&i(e)})},function(e){e=n._shapeError(e),n.app.trace.debug("Could not obtain file for removal: {0}.".format(e.toString())),i&&i(e)})}catch(e){e=n._shapeError(e),i&&i(e)}})},i}(e.StorageProviderBase);e.FileStorageProvider=t}(e.storage||(e.storage={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(t){function i(){t.apply(this,arguments),this._isFull=!1}return __extends(i,t),i.prototype.initialize=function(){t.prototype.initialize.call(this),this._localStorage=window.localStorage},i.prototype.isSupported=function(){return this._localStorage||this.initialize(),!!this._localStorage},i.prototype.isFull=function(){return this._localStorage||this.initialize(),this._isFull},i.prototype.getScore=function(){return this._localStorage||this.initialize(),5},i.prototype.getStats=function(){return this._localStorage||this.initialize(),new e.StorageStats},i.prototype.clear=function(e,t){this._localStorage||this.initialize();for(var r=null,n=new RegExp("^"+this.keyNamespace+i._namespaceSeperator),o=0,a=this._localStorage.length;o<a;o++){var s=this._localStorage.key(o);if(n.test(s))try{this._localStorage.removeItem(s),o--,a--}catch(e){r=e}}null!=r?t&&t(r):e&&e()},i.prototype.clearAllData=function(e,t){this._localStorage||this.initialize();try{this._localStorage.clear(),e&&e()}catch(e){t&&t(e)}},i.prototype.get=function(e,t,r,n){e=n?e:"{0}{1}{2}".format(this.keyNamespace,i._namespaceSeperator,e),this._localStorage||this.initialize();try{var o=this._localStorage.getItem(e);t&&t(o)}catch(e){r&&r(e)}},i.prototype.set=function(e,t,r,n,o){e=o?e:"{0}{1}{2}".format(this.keyNamespace,i._namespaceSeperator,e),this._localStorage||this.initialize();try{this._localStorage.setItem(e,t),r&&r()}catch(e){n&&n(e)}},i.prototype.remove=function(e,t,r,n){e=n?e:"{0}{1}{2}".format(this.keyNamespace,i._namespaceSeperator,e),this._localStorage||this.initialize();try{this._localStorage.removeItem(e),t&&t()}catch(e){r&&r(e)}},i._namespaceSeperator="→",i}(e.StorageProviderBase);e.LocalStorageProvider=t}(e.storage||(e.storage={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function t(e,t){this.app=e,this._rootNamespace=this._sanitizeKey(t?t.toString():"framework."+this.app.id)}return t.prototype.initialize=function(t){if(t)this._provider=t;else if(e.HttpStorageProvider.isSupported())this._provider=new e.HttpStorageProvider(this.app);else{var i=new e.FileStorageProvider(this.app);i.isSupported()?this._provider=i:this._provider=new e.LocalStorageProvider(this.app)}this._provider.keyNamespace=this._rootNamespace},t.prototype.hasProvider=function(){return null!=this._provider},t.prototype._yield=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},t.prototype._yieldError=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},t.prototype._yieldGet=function(e){return e?function(){var t=arguments;setTimeout(function(){e.apply(this,t)},0)}:function(){}},t.prototype.clear=function(e,t){this._provider&&this._provider.clear(this._yield(e),this._yieldError(t))},t.prototype.clearAllData=function(e,t){this._provider&&this._provider.clearAllData(this._yield(e),this._yieldError(t))},t.prototype._sanitizeKey=function(e){return e.replace(new RegExp("[/\\\\:,?=|]","gm"),"_")},t.prototype.set=function(e,t,i,r,n){var o=new dojo.Deferred,a=this._sanitizeKey(e);return n=n||!1,this._provider&&this._provider.set(a,t,this._yield(function(){o&&-1==o.fired&&o.resolve(t),i&&i(e,t)}),this._yieldError(function(i){o&&-1==o.fired&&o.resolve(i),r&&r(i,e,t)}),n),o},t.prototype.get=function(e,t,i,r){var n=new dojo.Deferred,o=this._sanitizeKey(e);return r=r||!1,this._provider&&this._provider.get(o,this._yieldGet(function(i){n&&-1==n.fired&&n.resolve(i),t&&t(i,e)}),this._yieldError(function(t){n&&-1==n.fired&&n.resolve(t),i&&i(t,e)}),r),n},t.prototype.remove=function(e,t,i,r){var n=new dojo.Deferred,o=this._sanitizeKey(e);return r=r||!1,this._provider&&this._provider.remove(o,this._yield(function(){n&&-1==n.fired&&n.resolve(e),t&&t(e)}),this._yieldError(function(t){n&&-1==n.fired&&n.resolve(t),i&&i(t,e)}),r),n},t}();e.Store=t}(e.storage||(e.storage={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){return function(e,t){this.view=e,this.region=t}}();e.ViewDimensionsChangedArgs=t}(e.events||(e.events={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(){return function(){}}();i.ViewManagerRegionEntry=r;var n=function(){function i(e){this._views=[],this._hostedRegions=[],this._pendingRegions=[],this.app=e,this._registerCommands()}return i.prototype.shutdown=function(){for(e=0;e<this._hostedRegions.length;++e)this.destroyRegion(this._hostedRegions[e]);this._hostedRegions.length=0;for(i=0;i<this._views.length;++i)this.destroyView(this._views[i]);this._views.length=0;for(var e=0;e<this._pendingRegions.length;++e){for(var t=this._pendingRegions[e],i=0;i<t.views.length;++i)this.destroyView(t.views[i]);t.views=[]}this._pendingRegions.length=0},i.prototype._registerCommands=function(){this.app.commandRegistry.command("ActivateView").register(this,function(e){var t=this.getViewById(e);t?this.activateView(t):this.app.trace.warning("ActivateView: Could not find view '{0}'.".format(e))}),this.app.commandRegistry.command("DeactivateView").register(this,function(e){var t=this.getViewById(e);t?this.deactivateView(t):this.app.trace.warning("DeactivateView: Could not find view '{0}'.".format(e))}),this.app.commandRegistry.command("ToggleView").register(this,function(e){var t=this.getViewById(e);t?this.toggleView(t):this.app.trace.warning("ToggleView: Could not find view '{0}'.".format(e))}),this.app.commandRegistry.command("DestroyView").register(this,function(e){var t=this.getViewById(e);t?this.destroyView(t):this.app.trace.warning("DestroyView: Could not find view '{0}'.".format(e))})},i.prototype.activateView=function(e){if(!e.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to activateView."),!1;var i=this.getRegionForViewId(e.id);if(!i){if(!e.regionName)return this.app.trace.warning("Could not activate view '{0}' - view is not associated with a region.".format(e.id)),!1;if(i=this.getExistingRegionByName(e.regionName))return i.hostView(e),i.activateView(e),!0;var n=this._getPendingRegionEntryByName(e.regionName);if(n)return t.utils.ArrayUtils.contains(n.views,e)?(this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(e.id,e.regionName)),!1):(n.views.push(e),!1);var o=new r;return o.name=e.regionName,o.views=[e],this._pendingRegions.push(o),!1}return i.activateView(e),!0},i.prototype.deactivateView=function(e){if(!e.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to deactivateView."),!1;var t=this.getRegionForViewId(e.id);return t?(t.deactivateView(e),!0):(this.app.trace.debug("Could not find region for view '{0}'.".format(e.id)),!1)},i.prototype.toggleView=function(e){e.isActive?this.deactivateView(e):this.activateView(e)},i.prototype.createView=function(i){var n=i.viewId||i.id;{if(!n||!this.getViewById(n)){var o=i.typeName||i.type||"geocortex.framework.ui.ViewBase",a=null;try{a=this.app.instantiateFrameworkObject(o,i.libraryId)}catch(e){return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(o),e),null}var s=i.isVisible||i.visible;if(a.id=null==n?"View-"+e.framework.utils.alphaNumericToken():n,a.markupResource=i.markupResource||i.markup,a.regionName=i.regionName||i.region,a.configuration=i.configuration||{},a.isManaged=i.isManaged||!1,a.title.set(i.title||""),a.description.set(i.description),a.iconUri.set(i.iconUri),i.viewModel&&(a.viewModel=i.viewModel),this._views.push(a),a.regionName){var l=this.getExistingRegionByName(a.regionName);if(l)return l.hostView(a),s&&l.activateView(a),a;s&&(a.___shouldActivate=!0);var u=this._getPendingRegionEntryByName(a.regionName);if(u){if(t.utils.ArrayUtils.contains(u.views,a))return this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(a.id,a.regionName)),a;u.views.push(a)}else{var c=new r;c.name=a.regionName,c.views=[a],this._pendingRegions.push(c)}return a}var h=e.resourceManager.fetch(a.markupResource,a.libraryId);return null==h?(this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,a.libraryId)),null):(a.root=dojo.create("div"),a.root.innerHTML=h,a.root.children&&1===a.root.children.length&&(a.root=a.root.children[0]),a)}this.app.trace.error("Could not create view '{0}' - a view with that ID already exists.".format(n))}},i.prototype.create=function(e,i,r,n,o){var a=new t.config.ViewConfig(null,null,e);a.markupResource=r,a.regionName=n,a.configuration={};var s=this.createView(a);if(null===s)return s;var l=null;try{(l=this.app.instantiateFrameworkObject(i||"geocortex.framework.ui.ViewModelBase",l.libraryId)).initialize({})}catch(e){return this.app.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(a.typeName,e.message),e),null}return s.attach(l),this.activateView(s),s},i.prototype.destroyView=function(e){for(var i=this.getRegionForViewId(e.id),r=window.document.activeElement;r;){if(e.root===r){window.document.activeElement.blur();break}r=r.parentElement}if(null!=i&&(i.deactivateView(e),i.unhostView(e)),e.destroy(),null!=e.childRegions)for(var n=0;n<e.childRegions.length;++n)this.destroyRegion(e.childRegions[n]);if(e.childRegions.length=0,null!=e.root){var o=new dojo.NodeList;o.push(e.root),o.orphan()}t.utils.ArrayUtils.removeItem(this._views,e),e.onDestroy()},i.prototype.destroyRegion=function(e){if(null!=e.views)for(var i=e.views.length-1;i>=0;i--)this.destroyView(e.views[i]);t.utils.ArrayUtils.removeItem(this._hostedRegions,e),e.unhost()},i.prototype.discoverRegions=function(e,t){var i=this;null!=e&&dojo.query("[data-region-name]",e).forEach(function(e){var r=dojo.attr(e,"data-region-name");if(i.getExistingRegionByName(r))i.app.trace.error("Region '{0}' already exists.".format(r));else{var n=i._getPendingRegionEntryByName(r),o=null;n&&i._removePendingRegionEntry(r);var a=dojo.attr(e,"data-region-adapter");try{a||(a="geocortex.framework.ui.DivRegionAdapter"),o=new(dojo.getObject(a,!0))(r,i.app)}catch(e){return i.app.trace.error("Could not instantiate region with type '{0}' - type was not found.".format(a),e),null}var s=dojo.attr(e,"data-region-options"),l={};if(s)for(var u=s.split(","),c=0;c<u.length;c++){var h=u[c].split("=");l[h[0]]=h.length>1?h[1]:""}if(o.host(e,l),i._hostedRegions.push(o),null!=t&&(t.childRegions.push(o),o.ownerView=t),n)for(var d=0;d<n.views.length;++d){var p=n.views[d];i._views.push(p),o.hostView(p),p.___shouldActivate&&(delete p.___shouldActivate,o.activateView(p))}}})},i.prototype.getExistingRegionByName=function(e){for(var t=0;t<this._hostedRegions.length;++t){var i=this._hostedRegions[t];if(i.name==e)return i}return null},i.prototype._getPendingRegionEntryByName=function(e){for(var t=0;t<this._pendingRegions.length;++t){var i=this._pendingRegions[t];if(i.name==e)return i}return null},i.prototype._removePendingRegionEntry=function(e){for(var i=-1,r=0;r<this._pendingRegions.length;++r)if(this._pendingRegions[r].name==e){i=r;break}return r>-1&&(t.utils.ArrayUtils.remove(this._pendingRegions,i,i),!0)},i.prototype.getRegionForViewId=function(e){for(var t=0;t<this._hostedRegions.length;++t)for(var i=this._hostedRegions[t],r=0;r<i.views.length;++r)if(i.views[r].id===e)return i;return null},i.prototype.getViewById=function(e){for(var t=0;t<this._views.length;++t){var i=this._views[t];if(i.id&&i.id===e)return i}},i.prototype.getViews=function(){return this._views},i.prototype.notifyDimensionsChanged=function(t){var i=this.getRegionForViewId(t.id),r=new e.framework.events.ViewDimensionsChangedArgs(t,i);this.app.eventRegistry.event("ViewDimensionsChangedEvent").publish(r)},i}();i.ViewManager=n}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(e){this.app=e}return e.prototype._traceImpl=function(e,t,i){("debug"!==e&&"trace"!==e||this.app.debugMode)&&this.app&&this.app.event("TraceEvent").publish({level:e,timestamp:new Date,message:t,stack:i})},e.prototype._stackTraceFromException=function(e){return void 0!==e?e.stack||e.backtrace||e.stacktrace:null},e.prototype.debug=function(e){this._traceImpl("debug",e)},e.prototype.trace=function(e){this._traceImpl("trace",e)},e.prototype.info=function(e){this._traceImpl("info",e)},e.prototype.alert=function(e){this._traceImpl("alert",e)},e.prototype.warning=function(e){this._traceImpl("warning",e)},e.prototype.error=function(e,t){this._traceImpl("error",e,this._stackTraceFromException(t))},e.prototype.exception=function(e,t){this._traceImpl("error",e,this._stackTraceFromException(t))},e}();e.Trace=t}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(t){var i=function(t){function i(e,i){t.call(this,e,i),this.behaviorNames=[],this.configuration={}}return __extends(i,t),i.prototype.initialize=function(e){this.configuration=e,this.behaviorNames=this.app.behaviorRegistry.loadBehaviorsFromConfig(this,e)},i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this);for(var e=0;e<this.behaviorNames.length;e++)this.app.behaviorRegistry.remove(this.behaviorNames[e]);this.behaviorNames.length=0},i.prototype.shutdown=function(e){},i.prototype.exportState=function(){return new e.SimplePromise(function(e,t){return e(null)})},i.prototype.applyState=function(t){return new e.SimplePromise(function(e,t){return e()})},i.prototype.getStateFilter=function(){return null},i}(e.FrameworkObject);t.ModuleBase=i}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(e){this._modules={},this.app=e}return e.prototype.shutdown=function(e){for(var t in this._modules)this._modules.hasOwnProperty(t)&&(this._modules[t].shutdown(e),this._modules[t].destroy());this._modules={}},e.prototype.instantiate=function(e,t){return null==e?null:this.app.instantiateFrameworkObject(e,t)},e.prototype.markModuleLoaded=function(e,t){this._modules[e]=t,this.app.event("ModuleInitializedEvent").publish(e)},e.prototype.moduleIsLoaded=function(e){return null!=this._modules[e]},e.prototype.notifyModuleLoaded=function(e,t){if(this.moduleIsLoaded(e)&&null!=t)t(e);else var i=this.app.event("ModuleInitializedEvent").subscribe(this,function(r){if(r==e)try{t(r)}finally{this.app.event("ModuleInitializedEvent").unsubscribe(i)}})},e}();e.ModuleManager=t}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(){function i(i,r,n,o){this.version="2.8",this.allowCrossDomainConfig=!1,this.configuration={},this.localServerAddress="",this.localServerToken=null,this.localServerNamespace=null,this.urlParameters={},this.developmentMode=!1,this.isHttpsMode=!1,this.allLibrariesLoaded=!1,this.configPreprocessor=null,this.modalRegionSingleton=null,this._resourceDictionaries={},this.frameworkObjects={},this._pendingFrameworkObjectRequests={},this._initialStateAppliedCount=0,this.id=n||"default",this.configTokens=o||{},this.trace=new t.utils.Trace(this),this.moduleManager=new e.framework.application.ModuleManager(this),this.commandRegistry=new e.framework.commands.CommandRegistry(this),this.eventRegistry=new e.framework.events.EventRegistry(this),this.behaviorRegistry=new e.framework.behaviors.BehaviorRegistry(this),this.viewManager=new e.framework.ui.ViewManager(this),this.command=dojo.hitch(this.commandRegistry,this.commandRegistry.command),this.event=dojo.hitch(this.eventRegistry,this.eventRegistry.event),this.behavior=dojo.hitch(this.behaviorRegistry,this.behaviorRegistry.behavior),this.hostElement=r||dojo.body(),this.store=new e.framework.storage.Store(this,this.id),this.store.initialize(),null==i?this.configModel=new t.config.ConfigurationModel(this):"object"==typeof i?(this.configObject=i,this.configUri=null):(this.configModel=null,this.configUri=i.trim()),this.isOffline=new Observable(!1),this.isOffline.bind(this,function(e){e?this.eventRegistry.event("ApplicationOfflineEvent").publish():this.eventRegistry.event("ApplicationOnlineEvent").publish()}),this.isNative=new Observable(!1),this.isNative.bind(this,function(e){e?this.eventRegistry.event("ApplicationNativeReadyEvent").publish():this.eventRegistry.event("ApplicationNativeRemovedEvent").publish()}),e.framework.application.ApplicationCommands.createCommands(this);var a=document.URL,s=a.substring(a.indexOf("?")+1,a.length);this.urlParameters=dojo.queryToObject(s)||{};var l=window.location.protocol;l.indexOf(":")<0&&(l+=":");var u=window.location.pathname.lastIndexOf("/"),c="/";u>-1&&(c=window.location.pathname.substr(0,u)),""===c&&(c="/"),this.host=l+"//"+window.location.host.trim()+c.trim(),"/"!==this.host.charAt(this.host.length-1)&&(this.host=this.host+"/"),this.isHttpsMode=this.isHttpsUri(this.host),this.detectBrowserLocale(),e.framework.registerApplication(this)}return i.prototype.getLibraryOrder=function(e){if(!this.configModel.libraryConfigs)return null;for(var t=0;t<this.configModel.libraryConfigs.length;++t)if(this.configModel.libraryConfigs[t].id===e)return t;return null},i.prototype.shouldOmitStylesForLibrary=function(e){if(!this.configModel.libraryConfigs)return null;for(var t=0;t<this.configModel.libraryConfigs.length;++t){var i=this.configModel.libraryConfigs[t];if(i.id===e)return!!i.omitStyles}return!1},i.prototype.translateConfiguration=function(e,t){var i=this,r=function(t,n,o){if("string"==typeof n){if(n.indexOf("@language")>-1){var a=n.split("-");if(a.length<2)throw new Error("Invalid language key '{0}'.".format(n));var s=a.join("-").replace("@",""),l=o||e;return i.getResource(l,s)}return i.performTokenReplacement(n)}if(n instanceof Array){for(var u=[],c=0;c<n.length;++c)u.push(r(c,n[c]));return u}if(n instanceof Function)return n;if(n instanceof Object){var h={},d=n.hasOwnProperty("libraryId")?n.libraryId:void 0;for(var p in n)n.hasOwnProperty(p)&&(h[p]=r(p,n[p],d));return h}return n},n={};for(var o in t)t.hasOwnProperty(o)&&(n[o]=r(o,t[o]));return n},i.prototype.performTokenReplacement=function(e){var t=this;return e?e.replace(/{.+?}/g,function(e){var i=e.substring(1,e.length-1),r=t.configTokens.hasOwnProperty(i)?t.configTokens[i]:e;return!r&&t.configuration&&t.configuration.hasOwnProperty(i)?t.configuration[i]:r||(t.trace.warning("The token syntax \\{{0}\\} was detected, but could not be matched to a valid replacement.".format(i)),"")}):e},i.prototype.isHttpsUri=function(e){var t=e.trim();return t.indexOf("://")>-1&&t.length>=5&&"https"===t.substring(0,5)},i.prototype.makeAbsolute=function(e,t){if(new dojo._Url(e).host)return e;var i=t||"{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if("/"!=i.charAt(i.length-1)||"\\"!=i.charAt(i.length-1)){var r=i.split("/");--r.length,i=r.join("/"),i+="/"}if("/"==e.charAt(0)||"\\"==e.charAt(0)){var n=new dojo._Url(i);e=n.scheme+"://"+n.authority+"/"+e.substring(1)}else{for(var o=i.split("/"),a=e?e.split("../"):[],s=0,l=0;l<a.length;++l)""==a[l]&&++s;var u=o.slice(0,o.length-(s>0?s+1:s)),c=a.slice(s>0?s-1:s);e=u.join("/")+c.join("/")}return e},i.prototype.getHostElement=function(){return this.hostElement},i.prototype.getResource=function(e,t,i){if(i=i||this.locale||"inv",i=i.toLowerCase(),!this._resourceDictionaries||!this._resourceDictionaries.inv)throw new Error("The application is missing its invariant resources.");var r=this._resourceDictionaries[i],n=this._resourceDictionaries.inv;r||(r=n);var o=r[e]||n[e];if(!o)return this.trace.warning("No resource dictionary found for library '{0}' while trying to get resource with key '{1}', using locale '{2}'.".format(e,t,i)),"@"+t;var a=null;if(o.hasOwnProperty(t))a=o[t];else{if(r===n)return"@"+t;if(!1===(o=n[e]).hasOwnProperty(t))return this.trace.warning("The resource with key '{0}' was not found in library '{1}'.".format(t,e)),"@"+t;a=o[t]}return"debug"===i?this._getDebugLocaleString(a):"strings"===i?t:"!!"===i?"!"+a+"!":a},i.prototype.getUri=function(e){if(e.indexOf("://")<0){var t=this.host+e;return this.isHttpsUri(t)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(t)),null==this.proxyUri||String.isNullOrEmpty(this.proxyUri)?t:this.proxyUri+encodeURIComponent(t)}return this.isHttpsUri(e)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(e)),this.proxyUri+encodeURIComponent(e)},i.prototype.getUrlParameter=function(e){if(this.urlParameters)for(var t in this.urlParameters)if(this.urlParameters.hasOwnProperty(t)&&!String.isNullOrEmpty(t)&&!String.isNullOrEmpty(e)&&t.toLowerCase()===e.toLowerCase())return this.urlParameters[t];return null},i.prototype.onLibrariesDownloaded=function(e){},i.prototype.onConfigurationLoaded=function(e){},i.prototype.notifyLibraryDownload=function(t){this.trace.info("Processing downloaded library '{0}' for application '{1}'.".format(t,this.id)),this.eventRegistry.event("LibraryDownloadedEvent").publish(t);var i=e.resourceManager.fetchAllFor(t,"json");if(i&&i.length>0)for(var r=0;r<i.length;++r){var n=i[r],o=e.resourceManager.fetch(n.name,n.library,n.locale);this.injectLibraryResources(t,o,n.locale)}if(this.configModel){var a=this.configModel.libraryModules[t];null!=a?(this.initializeModules(a),this.pendingLibraryDownloads>0&&--this.pendingLibraryDownloads,this._doIfNoPendingLibraryDownloads()):this.trace.warning("No modules found for library '{0}' in application '{1}'.".format(t,this.id))}},i.prototype.hasLibrary=function(t){return e.framework.hasLibrary(t)&&!!this.configModel.libraryModules[t]&&this._resourceDictionaries.inv&&!!this._resourceDictionaries.inv[t]},i.prototype.registerFrameworkObject=function(e){if(!e.id)throw new Error("Could not register framework object. Object was missing an ID.");this.frameworkObjects[e.id]=e;var t=this._pendingFrameworkObjectRequests[e.id];return t&&t.length&&(t.forEach(function(t){return t(e)}),t.length=0,delete this._pendingFrameworkObjectRequests[e.id]),e},i.prototype.freeAllFrameworkObjects=function(){},i.prototype.getFrameworkObjectById=function(e){for(var t in this.frameworkObjects)if(this.frameworkObjects.hasOwnProperty(t)&&t===e)return this.frameworkObjects[t];return null},i.prototype.getFrameworkObjectByIdAsync=function(e,t,i){if(e&&dojo.isString(e)&&t&&dojo.isFunction(t)){var r=this.getFrameworkObjectById(e);r?t(r):(this._pendingFrameworkObjectRequests[e]=this._pendingFrameworkObjectRequests[e]||[],this._pendingFrameworkObjectRequests[e].push(t))}else i&&dojo.isFunction(i)&&i(new Error("Cannot retrieve Framework Object. Object ID or callback unspecified or incorrect."))},i.prototype.initialize=function(){var t=this;dojo.connect(window,"onresize",function(e){t.eventRegistry.event("ApplicationResizedEvent").publish()}),dojo.subscribe("ServiceTokenRefreshed",function(e){t.configuration&&e.serviceUrl===t.configuration.geometryServiceUrl&&(t.configuration.geometryServiceToken=e.token)});var i=new e.framework.config.ConfigurationLoader(this),r=function(i){"string"==typeof i&&(i=JSON.parse(i)),t.configPreprocessor&&(t.configPreprocessor(i),t.configPreprocessor=null);var r=new e.framework.config.ConfigurationModel(t);t.onConfigurationLoaded(i),t.abortInitialization||r.parse(i,function(e){return t.processConfiguration(e)})};if(null!=this.configModel)throw new Error("Configuration model should not be loaded already");if(null!=this.configObject)r(this.configObject),this.configObject=null;else{if(null==this.configUri)throw new Error("No configuration method");i.loadConfigurationTree(this.configUri,function(e){return r(e)})}this.viewManager.discoverRegions(this.hostElement)},i.prototype.shutdown=function(e){this.eventRegistry.event("ApplicationShutdownEvent").publish(e),this.viewManager.shutdown(),this.moduleManager.shutdown(e),this.commandRegistry.clear(),this.eventRegistry.clear()},i.prototype._doIfNoPendingLibraryDownloads=function(){0===this.pendingLibraryDownloads&&(e.resourceManager&&e.resourceManager.performThemeInjection(),this.allLibrariesLoaded=!0,this.eventRegistry.event("ViewerLibrariesDownloadedEvent").publish(this),this.onLibrariesDownloaded(this),this._initialStateAppliedCount<=0&&this.initialStateAppliedCallback&&this.initialStateAppliedCallback(this))},i.prototype.onInitializationComplete=function(){null!=this.initializationCompleteCallback&&void 0!=this.initializationCompleteCallback&&this.initializationCompleteCallback(this)},i.prototype.detectBrowserLocale=function(){navigator.language?this.locale=navigator.language:navigator.userLanguage?this.locale=navigator.userLanguage:navigator.browserLanguage?this.locale=navigator.browserLanguage:this.locale="inv"},i.prototype.downloadLibraries=function(t){this.pendingLibraryDownloads=t.libraryConfigs.length;for(var i=0;i<t.libraryConfigs.length;++i){var r=t.libraryConfigs[i];!0===e.framework.hasLibrary(r.id)?this.notifyLibraryDownload(r.id):(e.framework.libraries[r.id]=!1,r.uri&&this.includeScript(r.uri,function(e){},function(){}))}},i.prototype.injectLibraryResources=function(e,t,i){return i=i.toLowerCase(),!1===this._resourceDictionaries.hasOwnProperty(i)?(this._resourceDictionaries[i]={},void(this._resourceDictionaries[i][e]=t)):void(!1===this._resourceDictionaries[i].hasOwnProperty(e)?this._resourceDictionaries[i][e]=t:dojo.mixin(this._resourceDictionaries[i][e],t))},i.prototype.instantiateFrameworkObject=function(e,t){for(var i=e.split("."),r=window,n=0;n<i.length&&"object"==typeof r;n++)r=r[i[n]];var o=null;if("function"==typeof r&&(o=new r(this,t)),!o)try{o=new(dojo.getObject(e))(this,t)}catch(t){this.trace.error("Could not instantiate object of type '{0}': '{1}'".format(e,t),t)}return o},i.prototype.includeScript=function(e,t,i){var r=this,n={url:e,preventCache:this.debugMode,load:function(i){try{t&&t(i)}catch(t){r.trace.error("Error while including script '{0}': {1}".format(e,t),t)}},error:function(t){r.trace.error("Error while including script '{0}': {1}".format(e,t),t),r.pendingLibraryDownloads>0&&r.pendingLibraryDownloads--,r._doIfNoPendingLibraryDownloads(),i&&i(t)}};dojo.io.script.get(n)},i.prototype.processConfiguration=function(e){var t=this;if(this.configuration=e.application||{},this.configModel=e,this.eventRegistry.event("AppConfigLoaded").publish(this.configModel),this.eventRegistry.event("ApplicationConfigLoadedEvent").publish(this.configModel),this.configuration&&this.configuration.locale&&(this.locale=this.configuration.locale),this.urlParameters&&this.getUrlParameter("locale")&&(this.locale=this.getUrlParameter("locale")),dojo.locale=this.locale,this.pendingLocaleDownloads=e.externalLocaleReferences.length,0==this.pendingLocaleDownloads)this.downloadLibraries(e);else for(var i=function(i,r){try{if(r)if(r.hasOwnProperty("locales")){for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];t.injectLibraryResources(i.libraryId,o,n)}}else{if(!i.hasOwnProperty("locale"))throw new Error("Locale reference missing 'locale' identifier.");t.injectLibraryResources(i.libraryId,r,i.locale)}else t.trace.warning("Error loading locale '{0}' for library '{1}' from offline storage.".format(i.locale,i.libraryId))}catch(e){t.trace.error("Error fetching external locale resource {0}: {1}".format(i.uri,e.message),e)}finally{--t.pendingLocaleDownloads,t.pendingLocaleDownloads<1&&t.downloadLibraries(e)}},r=function(i,r){t.trace.error("Error fetching external locale resource {0}: {1}".format(i.uri,r.message),r),--t.pendingLocaleDownloads,t.pendingLocaleDownloads<1&&t.downloadLibraries(e)},n=0;n<e.externalLocaleReferences.length;++n)!function(e){var n={url:e.uri,handleAs:"json",load:function(t){return i(e,t)},error:function(t){return r(e,t)}};t.fetchConfigResource(n)}(e.externalLocaleReferences[n])},i.prototype.addNativeReadyFunction=function(e){if("undefined"!=typeof gcxNativeReady)e&&e();else{var t=gcxNativeReadyCallback;gcxNativeReadyCallback=function(){t&&t(),e&&e()}}},i.prototype.getInitialState=function(e,i){return new t.SimplePromise(function(e,t){return e(null)})},i.prototype.initializeModules=function(t){for(var i=this,r={},n=0;n<t.length;++n){var o=t[n];if(!this.moduleManager.moduleIsLoaded(o.moduleName)){var a=this.translateConfiguration(o.libraryId,o.configuration),s=this.moduleManager.instantiate(o.moduleType,o.libraryId);if(null!==s){if(s.initialize){this.trace.info("Initializing module '{0}'.".format(o.moduleName));try{s.id="module-{0}-{1}".format(o.libraryId,o.moduleName),s.initialize(a),this.registerFrameworkObject(s),function(e,t){i._initialStateAppliedCount++,i.getInitialState(t.moduleName,t.libraryId).then(function(t){if(t&&"function"==typeof e.applyState)return e.applyState(t)}).then(function(){return i._onInitialStateApplied(t.moduleName)},function(e){return i._onInitialStateApplied(t.moduleName,e)})}(s,o)}catch(e){this.trace.error("Error initializing module '{0}': {1}.".format(o.moduleName,e.message),e);continue}this.moduleManager.markModuleLoaded(o.moduleName,s),this.trace.debug("Module '{0}' initialized.".format(o.moduleName))}if(o.viewModelConfigs&&o.viewModelConfigs.length>0)for(c=0;c<o.viewModelConfigs.length;++c){var l=o.viewModelConfigs[c];if(r[l.viewModelId])this.trace.error("ViewModel '{0}' already exists in module '{1}'.".format(l.viewModelId,o.moduleName));else{var u=null;try{(u=this.instantiateFrameworkObject(l.typeName,l.libraryId)).id=l.viewModelId||e.framework.utils.alphaNumericToken();a=this.translateConfiguration(o.libraryId,l.configuration);u.initialize(a),r[l.viewModelId]=u,this.registerFrameworkObject(u)}catch(e){this.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(l.typeName,e.message),e)}}}}else this.trace.error("Could not instantiate module with type '{0}' - type not found or constructor failed.".format(o.moduleType))}}for(n=0;n<t.length;++n)if((o=t[n]).viewConfigs)for(var c=0;c<o.viewConfigs.length;++c){var h=o.viewConfigs[c];if(!this.getFrameworkObjectById(h.viewId)){var d=null;(h=this.translateConfiguration(o.libraryId,h)).viewModelId?(d=r[h.viewModelId])?d.libraryId=d.libraryId||o.libraryId:this.trace.error("Could not attach view model '{0}' to view '{1}' - view model not found.".format(h.viewModelId,h.viewId)):d=new e.framework.ui.ViewModelBase(this,o.libraryId),h.viewModel=d;var p=this.viewManager.createView(h);p?this.registerFrameworkObject(p):this.trace.warning("Could not instantiate view with type '{0}'.".format(h.typeName))}}this.initializationCompleteCallback&&(this.onInitializationComplete(),this.initializationCompleteCallback=null)},i.prototype._onInitialStateApplied=function(e,t){this._initialStateAppliedCount--,t&&this.trace.error('Error setting initial state for module "{0}": {1}'.format(e,t.message),t),this.allLibrariesLoaded&&this._initialStateAppliedCount<=0&&this.initialStateAppliedCallback&&this.initialStateAppliedCallback(this)},i.prototype.fetchConfigResource=function(t){var i=document.createElement("a");try{i.href=t.url,i.style.display="none",document.body.appendChild(i);var r=e._configDomains;if(!i.hostname||["protocol","hostname"].every(function(e){return i[e]===window.location[e]})||r&&1==r[i.protocol+"//"+i.hostname])return dojo.xhrGet(t);var n=new Error("Could not load viewer because the specified configuration file is not on the same domain as the viewer ({0}).".format(t.url));throw n.name="ConfigurationDomainMismatch",n}finally{document.body.removeChild(i)}},i.prototype._getDebugLocaleString=function(e){for(var t=[9728,9983],i=[],r=0;r<e.length;++r)i.push(Math.floor(Math.random()*(t[1]-t[0]))+t[0]);return String.fromCharCode.apply(String,i)},i}();i.Application=r}(t.application||(t.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){var i=function(){function t(){this.resources=[],this.cachedResources={},this.themesToInject=[]}return t.prototype.fetch=function(t,i,r){r=r||"inv";var n="{0}-{1}-{2}".format(i,r,t);if(this.cachedResources.hasOwnProperty(n))return this.cachedResources[n];var o=this.findResource(t,i,r);if(!o)return null;var a=null;switch(o.format){case"css":case"html":a=e.framework.utils.base64Decode(o.data),this.cachedResources[n]=a;break;case"json":a=e.framework.utils.base64Decode(o.data),a=JSON.parse(a),this.cachedResources[n]=a;break;default:return null}return a},t.prototype.fetchAllFor=function(e,t){for(var i=[],r=0;r<this.resources.length;++r){var n=this.resources[r];if(n.library==e){if(null!=t&&n.format!=t)continue;i.push(n)}}return i},t.prototype.register=function(e,t,i,r,n){if(!this.findResource(i,e)){var o={};o.name=i,o.library=e,o.locale=t,o.format=r,o.data=n,this.resources.push(o)}},t.prototype.remove=function(e,t,i){var r=this.findResource(t,e,i);if(null!=r){Array.removeItem(this.resources,r);var n="{0}-{1}-{2}".format(e,i,t);return this.cachedResources.hasOwnProperty(n)&&delete this.cachedResources[n],!0}return!1},t.prototype.injectTheme=function(e){this.themesToInject.push(e)},t.prototype.performThemeInjection=function(){for(var e=dojo.query("head")[0],t=0;t<this.themesToInject.length;++t){var i=dojo.create("link",{rel:"stylesheet",href:this.themesToInject[t]});dojo.place(i,e,"last")}},t.prototype.findResource=function(e,t,i){i=i||"inv";for(var r=0;r<this.resources.length;++r){var n=this.resources[r];if(n.name==e){if(null!=t&&n.library!=t)continue;if(n.locale==i)return n}}return null},t}();t.ResourceManager=i}(t.application||(t.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){e.resourceManager=new e.framework.application.ResourceManager}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){t.applications=[],t.libraries={},t.injectedStyleBlocks=[],t.initialized=!1,t.registerApplication=function(t){e.framework.applications.push(t)},t.hasLibrary=function(t){return!0===e.framework.libraries[t]},t.notifyLibraryDownload=function(t){if(!e.framework.hasLibrary(t)){e.framework.libraries[t]=!0;for(var i=0,r=!0,n=0;n<e.framework.applications.length;++n){var o=(w=e.framework.applications[n]).getLibraryOrder(t);if(!0===w.shouldOmitStylesForLibrary(t)&&(r=!1),o){i=o+32*n;break}}if(r){var a=e.resourceManager.fetchAllFor(t,"css");a||(a=[]);for(var s="",l=dojo.query("head")[0],u=0;u<a.length;++u){var c=a[u],h=e.resourceManager.fetch(c.name,c.library);h&&(s+=h+" ")}var d=document.createElement("style");if(e.framework.injectedStyleBlocks.push(d),d.setAttribute("type","text/css"),dojo.attr(d,"data-block-order",i),0===i)dojo.place(d,l,"first");else{var p=dojo.query("head style[data-block-order]");if(0===p.length)dojo.place(d,l,"first");else{for(var f=null,g=!1,v=0;v<p.length;++v){var m=p[v];if((dojo.attr(m,"data-block-order")||0)>=i){dojo.place(d,m,"before"),g=!0;break}f=m}g||dojo.place(d,f,"after")}}if(d.styleSheet)d.styleSheet.cssText=s;else{var y=document.createTextNode(s);d.appendChild(y)}}for(n=0;n<e.framework.applications.length;++n){var w=e.framework.applications[n];w.notifyLibraryDownload(t)}}},t.initialize=function(){e.framework.initialized||(e.utils=e.framework.utils,e.framework.initialized=!0)}}(e.framework||(e.framework={}))}(geocortex||(geocortex={})),geocortex.framework.initialize();var geocortex;!function(e){!function(t){!function(i){var r=function(i){function r(e,t){i.call(this,e,t)}return __extends(r,i),r.prototype.unhostAllViews=function(){for(var e=0;e<this.views.length;++e){var t=this.views[e];this.unhostView(t)}this.views.length=0},r.prototype.hostView=function(t){if(this.unhostAllViews(),this.views.push(t),null==t.root){var r=e.resourceManager.fetch(t.markupResource,t.libraryId);if(null===r)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;t.root=dojo.create("div",{className:"view {0}".format(t.id)}),t.root.innerHTML=r,dojo.place(t.root,this.domElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t)}else dojo.place(t.root,this.domElement,"only");return i.prototype.hostView.call(this,t),!0},r.prototype.unhostView=function(e){this.deactivateView(e),t.utils.ArrayUtils.removeItem(this.views,e);var r=new dojo.NodeList;r.push(e.root),r.orphan(),i.prototype.unhostView.call(this,e)},r}(i.RegionAdapterBase);i.DivRegionAdapter=r}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(i){function r(e,t){i.call(this,e,t),this.activeViews=[],this.activateViewsInLastPosition=!0}return __extends(r,i),r.prototype.host=function(e,t){i.prototype.host.call(this,e,t),"false"===this.options.activateViewsInLastPosition&&(this.activateViewsInLastPosition=!1)},r.prototype.activateView=function(e){t.utils.ArrayUtils.contains(this.activeViews,e)?(t.utils.ArrayUtils.removeItem(this.activeViews,e),this.activeViews.push(e)):this.activeViews.push(e),this.activateViewsInLastPosition&&dojo.place(e.root,this.domElement,"last"),i.prototype.activateView.call(this,e)},r.prototype.deactivateView=function(e){e.isActive=!1,t.utils.ArrayUtils.removeItem(this.activeViews,e),this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1]),i.prototype.deactivateView.call(this,e)},r.prototype.hostView=function(t){if(this.views.push(t),null==t.root){var r=e.resourceManager.fetch(t.markupResource,t.libraryId);if(null==r)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;var n=this.getHostedTagName();t.root=dojo.create(n,{className:"view {0}".format(t.id)}),t.root.innerHTML=r,dojo.place(t.root,this.domElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t)}else dojo.place(t.root,this.domElement,"last");return i.prototype.hostView.call(this,t),!0},r.prototype.unhostView=function(e){this.deactivateView(e),t.utils.ArrayUtils.removeItem(this.views,e),t.utils.ArrayUtils.removeItem(this.activeViews,e);var r=new dojo.NodeList;r.push(e.root),r.orphan(),i.prototype.unhostView.call(this,e)},r.prototype.getHostedTagName=function(){return this.options&&this.options.tagName?this.options.tagName:"div"},r}(i.RegionAdapterBase);i.DivStackRegionAdapter=r}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(i){var r=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.activateView=function(e){if(this.hideAllViews(),this.activeViews.length>0){var t=this.activeViews[this.activeViews.length-1];t!==e&&(this.cancelActivate(t),t.deactivated())}i.prototype.activateView.call(this,e)},r.prototype.deactivateView=function(e,t){void 0!==t&&null!==t||(t=!0),i.prototype.deactivateView.call(this,e),t&&this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1])},r.prototype.hideAllViews=function(){dojo.query("> .view",this.domElement).removeClass("active"),dojo.query("> .view",this.domElement).addClass("inactive")},r.prototype.hostView=function(t){if(this.views.push(t),null==t.root){var r=e.resourceManager.fetch(t.markupResource,t.libraryId);if(null==r)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(t.markupResource,t.libraryId)),!1;var n=this.getHostedTagName();t.root=dojo.create(n,{className:"view {0}".format(t.id)}),t.root.innerHTML=r,dojo.place(t.root,this.domElement,"last"),t.viewModel&&t.attach(t.viewModel),this.app.viewManager.discoverRegions(t.root,t)}else dojo.place(t.root,this.domElement,"last");return i.prototype.hostView.call(this,t),!0},r.prototype.getHostedTagName=function(){return this.options&&this.options.tagName?this.options.tagName:"div"},r.prototype.unhostView=function(e){this.deactivateView(e),t.utils.ArrayUtils.removeItem(this.views,e),t.utils.ArrayUtils.removeItem(this.activeViews,e);var r=new dojo.NodeList;r.push(e.root),r.orphan(),i.prototype.unhostView.call(this,e)},r}(i.RegionAdapterBase);i.MultiViewRegionAdapter=r}(t.ui||(t.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getHostedTagName=function(){return"div"},t}(e.MultiViewRegionAdapter);e.MultiDivRegionAdapter=t}(e.ui||(e.ui={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){function t(){return null===r&&(r=(new Date).getTimezoneOffset()),r}var i=/(Z|([+-][012]\d(:?\d\d)?))\s*$/;e.containsTimezone=function(e){return i.test(e)};var r=null,n=null;e.getTimezoneOffset=t,e.getTimezoneString=function(){if(null==n){var e=t(),i=Math.floor(e/60),r=Math.floor(e-60*i);if(0==i&&0==r)return"Z";i<0?(i*=-1,n="+"):n="-",n+=0==i?"00":i<10?"0"+i:i,n+=0==r?":00":r<10?":0"+r:":"+r}return n},function(){var e=new Date("2011-06-02T09:34:29+02:00");Date.fromISO=e&&1307000069e3==+e?function(e){return new Date(e)}:function(e){var t,i,r=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/.exec(e)||[];if(r[1]){for(var n=0,o=(t=r[1].split(/\D/)).length;n<o;n++)t[n]=parseInt(t[n],10)||0;return t[1]-=1,(t=new Date(Date.UTC.apply(Date,t))).getDate()?(r[5]&&(i=60*parseInt(r[5],10),r[6]&&(i+=parseInt(r[6],10)),"+"==r[4]&&(i*=-1),i&&t.setUTCMinutes(t.getUTCMinutes()+i)),t):NaN}return NaN}}(),Date.prototype.toISOString||function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}()}(e.DateUtils||(e.DateUtils={}))}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i){this.delayMS=0,this.func=null,this.delayMS=e,this.func=i?function(){t.apply(i)}:t}return e.prototype.start=function(){this._timerHandle=setTimeout(this.func,this.delayMS)},e.prototype.stop=function(){clearTimeout(this._timerHandle)},e.prototype.reset=function(){this.stop(),this.start()},e}();e.TimeDelayedAction=t}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){var t=function(){function e(t){var i=this;this._state=e.PENDING,this._value=null,this._handlers=[],this._doResolve(t,function(e){return i._resolve(e)},function(e){return i._reject(e)})}return e.resolve=function(t){return e._getThen(t)?t:new e(function(e,i){e(t)})},e.reject=function(t){return new e(function(e,i){i(t)})},e.all=function(t){return e.resolve(t).then(function(t){if(!Array.isArray(t))throw new Error("SimplePromise.all: expecting an array or a thenable.");var i=t.length,r=[];return new e(function(n,o){t.forEach(function(t,a){e.resolve(t).then(function(e){r[a]=e,0==--i&&n(r)},o)})})})},e.prototype.then=function(t,i){var r=this;return new e(function(e,n){return r._done(function(i){if("function"!=typeof t)return e(i);try{return e(t(i))}catch(e){return n(e)}},function(t){if("function"!=typeof i)return n(t);try{return e(i(t))}catch(e){return n(e)}})})},e.prototype._fulfill=function(t){var i=this;this._state=e.FULFILLED,this._value=t,this._handlers.forEach(function(e){return i._handle(e)}),this._handlers=[]},e.prototype._reject=function(t){var i=this;this._state=e.REJECTED,this._value=t,this._handlers.forEach(function(e){return i._handle(e)}),this._handlers=[]},e.prototype._resolve=function(t){var i=this;try{var r=e._getThen(t);if(r)return void this._doResolve(r.bind(t),function(e){return i._resolve(e)},function(e){return i._reject(e)});this._fulfill(t)}catch(e){this._reject(e)}},e._getThen=function(e){var t=typeof e;if(e&&("object"===t||"function"===t)){var i=e.then;if("function"==typeof i)return i}return null},e.prototype._doResolve=function(e,t,i){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,i(e))})}catch(e){if(r)return;r=!0,i(e)}},e.prototype._handle=function(t){this._state===e.PENDING?this._handlers.push(t):(this._state===e.FULFILLED&&"function"==typeof t.onFulfilled&&t.onFulfilled(this._value),this._state===e.REJECTED&&"function"==typeof t.onRejected&&t.onRejected(this._value))},e.prototype._done=function(e,t){var i=this;setTimeout(function(){i._handle({onFulfilled:e,onRejected:t})},0)},e.PENDING=0,e.FULFILLED=1,e.REJECTED=2,e}();e.SimplePromise=t}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(e){function t(t){e.call(this,t),this.fileStorageEndpoint="/filesystem",this._initialized=!1,this.localServerAddress=this.app.localServerAddress?this.app.localServerAddress:"http://127.0.0.1:8181"}return __extends(t,e),t.prototype.initialize=function(){if(!this._initialized){!window.require.has("esri-cors")&&window.Modernizr.cors&&(delete window.require.has.cache["esri-cors"],window.require.has.add("esri-cors",function(){return!0}));var e=this.localServerAddress.replace("http://","");window.esri.config.defaults.io.corsEnabledServers.push(e),this._initialized=!0}},t.isSupported=function(){var e=navigator.userAgent.match(/GeocortexApp[^\/]*\/(\d+.\d+)/);return!!(e&&parseFloat(e[1])>=1.1)},t.prototype.fileStorageRequest=function(e,t,i,r,n){this.initialize();var o={url:this.localServerAddress+this.fileStorageEndpoint+"/"+t,headers:{Authorization:"Token "+this.app.localServerToken},load:function(e){i(e)},error:function(e){e&&e.status&&404===e.status?i(null):r(e)},failOk:!0};n&&(o.putData=n),dojo.xhr(e,o)},t.prototype.clear=function(e,t){this.fileStorageRequest("DELETE",this.keyNamespace+"/",e,t)},t.prototype.clearAllData=function(e,t){this.fileStorageRequest("DELETE","",e,t)},t.prototype.get=function(e,t,i,r){var n=r?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("GET",n,t,i)},t.prototype.set=function(e,t,i,r,n){var o=n?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("PUT",o,i,r,t)},t.prototype.remove=function(e,t,i,r){var n=r?"0/"+e:this.keyNamespace+"/"+e;this.fileStorageRequest("DELETE",n,t,i)},t}(e.StorageProviderBase);e.HttpStorageProvider=t}(e.storage||(e.storage={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){e.DateFormatters={d:function(e){return e.getDate()+""},dd:function(e){return t(e.getDate(),2)},f:function(e){return i(e.getMilliseconds()/1e3,1,!1)},ff:function(e){return i(e.getMilliseconds()/1e3,2,!1)},fff:function(e){return i(e.getMilliseconds()/1e3,3,!1)},ffff:function(e){return i(e.getMilliseconds()/1e3,4,!1)},fffff:function(e){return i(e.getMilliseconds()/1e3,5,!1)},ffffff:function(e){return i(e.getMilliseconds()/1e3,6,!1)},fffffff:function(e){return i(e.getMilliseconds()/1e3,7,!1)},F:function(e){return i(e.getMilliseconds()/1e3,1,!0)},FF:function(e){return i(e.getMilliseconds()/1e3,2,!0)},FFF:function(e){return i(e.getMilliseconds()/1e3,3,!0)},FFFF:function(e){return i(e.getMilliseconds()/1e3,4,!0)},FFFFF:function(e){return i(e.getMilliseconds()/1e3,5,!0)},FFFFFF:function(e){return i(e.getMilliseconds()/1e3,6,!0)},FFFFFFF:function(e){return i(e.getMilliseconds()/1e3,7,!0)},h:function(e){var i=e.getHours();return i>12&&(i-=12),t(i,1)},hh:function(e){var i=e.getHours();return i>12&&(i-=12),t(i,2)},H:function(e){return t(e.getHours(),1)},HH:function(e){return t(e.getHours(),2)},m:function(e){return t(e.getMinutes(),1)},mm:function(e){return t(e.getMinutes(),2)},M:function(e){return t(e.getMonth()+1,1)},MM:function(e){return t(e.getMonth()+1,2)},s:function(e){return t(e.getSeconds(),1)},ss:function(e){return t(e.getSeconds(),2)},y:function(e){return t(e.getFullYear(),1)},yy:function(e){return t(e.getFullYear(),2)},yyy:function(e){return t(e.getFullYear(),3)},yyyy:function(e){return t(e.getFullYear(),4)},yyyyy:function(e){return t(e.getFullYear(),5)}};var t=function(e,t){for(var i=t-(e+="").length,r=[];r.length<i;)r.push("0");return r.join("")+e},i=function(e,i,n){var o=Math.floor(e*Math.pow(10,i)),a=t(o,i);return n?r(a):a},r=function(e){return(e+="").replace(/0*$/g,"")}}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){var t=function(){function e(e,t,i,r,n){this.item1=null,this.item2=null,this.item3=null,this.item4=null,this.item5=null,this.item1=e,this.item2=t,null!=i&&void 0!==i&&(this.item3=i),null!=r&&void 0!==r&&(this.item4=r),null!=n&&void 0!==n&&(this.item5=n)}return e.equals=function(e,t){return null===e?null===t:e.item1===t.item1&&(e.item2===t.item2&&(e.item3===t.item3&&(e.item4===t.item4&&e.item5===t.item5)))},e.compare=function(e,t){var i=function(e,t){return null===e?null===t?0:-1:e===t?0:e>t?1:-1};return i(e.item1,t.item1)||i(e.item2,t.item2)||i(e.item3,t.item3)||i(e.item4,t.item4)||i(e.item5,t.item5)},e}();e.Tuple=t}(e.utils||(e.utils={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));