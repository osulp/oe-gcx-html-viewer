var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},geocortex;!function(e){!function(e){!function(e){!function(e){var r=function(){return function(e){var r=this;void 0===e&&(e=window.location.href);var t=/^.*\?([^#]*).*$/.exec(e);t&&t[1].split("&").forEach(function(e){var t=e.split("="),o=t.shift(),n=t.join("=");r[decodeURIComponent(o)]=n?decodeURIComponent(n):void 0})}}();e.QueryParameters=r}(e.loading||(e.loading={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){var r=function(){function e(e,r){void 0===r&&(r="transition"in document.createElement("span").style),this.splashOverlay=e,this.useTransitions=r}return e.getDefaultSplash=function(){return new e(document.querySelector(".splash-overlay"))},e.prototype.display=function(e){var r=document.querySelector(".splash-plate");r&&(r.className=r.className.replace(" splash-invisible",""));var t=document.querySelector(".splash-image");t&&!t.src&&(t.src=e||"Resources/Images/splash-logo.png");var o=document.querySelector(".splash-pre-loader");return o&&this.splashOverlay&&this.splashOverlay.removeChild(o),this},e.prototype.destroy=function(){return this.splashOverlay&&(this.splashOverlay.parentElement.removeChild(this.splashOverlay),this.splashOverlay=null),this},e.prototype.close=function(e){var r=this;return void 0===e&&(e=1e3),this.splashOverlay&&!this.splashOverlay.hasAttribute("data-closing")&&(this.useTransitions?(this.splashOverlay.setAttribute("data-closing","true"),this.splashOverlay.style.transition="opacity "+e+"ms linear",setTimeout(function(){r.splashOverlay.style.opacity="0",setTimeout(function(){r.destroy()},e)})):this.destroy()),this},e}();e.Splash=r}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var r=function(){function e(e){e&&this.merge(e)}return e.prototype.find=function(e){if(e)for(var r in this)if(this.hasOwnProperty(r)&&e.toLowerCase()===r.toLowerCase())return{name:r,value:this[r]};return null},e.prototype.has=function(e){return!!this.find(e)},e.prototype.get=function(e){var r=this.find(e);return r?r.value:void 0},e.prototype.getAsBoolean=function(e){var r=this.find(e);return!!r&&(("string"!=typeof r.value||"false"!==r.value.toLowerCase())&&!1!==r.value&&null!==r.value)},e.prototype.set=function(e,r){var t=this.find(e);return this[t?t.name:e]=r,this},e.prototype.merge=function(e){for(var r in e)e.hasOwnProperty(r)&&this.set(r,e[r]);return this},e}();e.CaselessMap=r}(e.loading||(e.loading={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Unloaded=0]="Unloaded",e[e.Loading=1]="Loading",e[e.Pending=2]="Pending",e[e.Loaded=3]="Loaded",e[e.Error=4]="Error"}(e.ResourceStatus||(e.ResourceStatus={}));e.ResourceStatus}(e.resources||(e.resources={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var r=function(){function r(r){this.status=e.ResourceStatus.Unloaded,this.name=r}return r.prototype.load=function(e){throw void 0===e&&(e={}),new Error("Not implemented.")},r}();e.Resource=r}(e.resources||(e.resources={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var r=function(r){function t(){r.apply(this,arguments)}return __extends(t,r),t.prototype.load=function(r){var t=this;void 0===r&&(r={}),this.status===e.ResourceStatus.Unloaded&&(this.status=e.ResourceStatus.Loading,require([this.name],function(o){t.status=e.ResourceStatus.Loaded,t.module=o,r.onLoaded&&r.onLoaded(t,o)}),r.onNext&&r.onNext(this))},t.prefixRegex=/^require:(.*)$/i,t}(e.Resource);e.RequireResource=r}(e.resources||(e.resources={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var r=function(e){};!function(e){e[e.Concurrent=0]="Concurrent",e[e.ConcurrentLegacyIE=1]="ConcurrentLegacyIE",e[e.Sequential=2]="Sequential"}(e.ScriptLoadingMode||(e.ScriptLoadingMode={}));var t=e.ScriptLoadingMode,o=function(o){function n(e){o.call(this,e)}return __extends(n,o),n.detectScriptLoadingMode=function(e,r){return void 0===e&&(e=navigator.userAgent),void 0===r&&(r=document.documentMode),!0===document.createElement("script").async?t.Concurrent:r?t.ConcurrentLegacyIE:t.Sequential},n.sniffScriptLoadingMode=function(e,r){return void 0===e&&(e=navigator.userAgent),void 0===r&&(r=document.documentMode),r?r>=10?t.Concurrent:t.ConcurrentLegacyIE:/Chrome/i.test(e)||/Chromium/i.test(e)?t.Concurrent:/Firefox/i.test(e)?t.Sequential:/Safari\//i.test(e)&&!/Chrome\//i.test(e)&&!/Chromium\//i.test(e)&&parseInt(/Version\/([\w]+)/i.exec(e)[1])>5?t.Concurrent:/Opera/i.test(e)&&!/Opera Mini/i.test(e)?t.Concurrent:t.Sequential},n.prototype.load=function(o){var i=this;if(void 0===o&&(o={}),this.status===e.ResourceStatus.Unloaded){this.status=e.ResourceStatus.Loading;var s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("data-injected-script","");try{if(n.loadingMode===t.Concurrent)a.async=!1,a.onload=function(){i.status=e.ResourceStatus.Loaded,o.onLoaded&&o.onLoaded(i),a.onload=null},a.onerror=function(e){var r=new Error("Script failed to load ("+i.name+")");r.name="ResourceLoadError",o.onError?o.onError(i,r):console.error(r),a.onerror=null},a.src=this.name,s.appendChild(a),o.onNext&&o.onNext(this);else if(n.loadingMode===t.ConcurrentLegacyIE){a.onerror=function(){var e=new Error("Script failed to load ("+i.name+")");e.name="ResourceLoadError",r(),o.onError?o.onError(i,e):console.error(e),a.onerror=null},a.src=this.name;var c=setInterval(function(){i.prevResource&&i.prevResource.status!==e.ResourceStatus.Loaded||("loaded"===a.readyState?(i.status=e.ResourceStatus.Pending,i.pendingExecution=a,o.onPending&&o.onPending(i),o.parent||i.executePending()):"complete"===a.readyState&&(clearInterval(c),i.status=e.ResourceStatus.Loaded,o.onLoaded(i)))},n.concurrentLegacyIEInterval);o.onNext&&o.onNext(this)}else if(n.loadingMode===t.Sequential){var u=!1;a.onload=a.onreadystatechange=function(){u||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(i.status=e.ResourceStatus.Loaded,o.onLoaded&&o.onLoaded(i),o.onNext&&o.onNext(i),u=!0,a.onload=a.onreadystatechange=null)},a.onerror=function(){var e=new Error("Script failed to load ("+i.name+")");e.name="ResourceLoadError",o.onError?o.onError(i,e):console.error(e),a.onerror=null},a.src=this.name,s.appendChild(a)}}catch(e){o.onError?o.onError(this,e):console.error(e)}}},n.prototype.executePending=function(){this.status===e.ResourceStatus.Pending&&this.pendingExecution&&(r(this.name),(document.head||document.getElementsByTagName("head")[0]).appendChild(this.pendingExecution),this.pendingExecution=null)},n.loadingMode=n.detectScriptLoadingMode(),n.concurrentLegacyIEInterval=150,n}(e.Resource);e.ScriptResource=o}(e.resources||(e.resources={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var r=function(r){function t(e){r.call(this,e)}return __extends(t,r),t.prototype.load=function(r){if(void 0===r&&(r={}),this.status===e.ResourceStatus.Unloaded){this.status=e.ResourceStatus.Loading;for(var t=document.head||document.getElementsByTagName("head")[0],o=null,n=0;n<t.children.length;n++){var i=t.children[n];"link"===i.tagName.toLowerCase()&&""===i.getAttribute("[data-injected-stylesheet]")&&(o=i)}var s=document.createElement("link");s.rel="stylesheet",s.href=this.name,s.setAttribute("data-injected-stylesheet",""),o?o.nextSibling?t.insertBefore(s,o.nextSibling):t.appendChild(s):t.firstChild?t.insertBefore(s,t.firstChild):t.appendChild(s),this.status=e.ResourceStatus.Loaded,r.onLoaded&&r.onLoaded(this),r.onNext&&r.onNext(this)}},t}(e.Resource);e.StyleResource=r}(e.resources||(e.resources={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(r){!function(r){!function(r){var t=function(t){function o(r,o){t.call(this,r),this.resources=[],e.framework.application.resources.ScriptResource,o&&this.append(o)}return __extends(o,t),o.prototype.load=function(e){function t(e,r){if(e.length<1)return r.onNext(this);e.shift().load({parent:i,onNext:function(o){t(e,r)},onPending:function(e){--a<1&&r.onPending(e)},onLoaded:function(e){--s<1&&r.onLoaded(e)},onError:function(e,t){r.onError(e,t)}})}var n=this;if(void 0===e&&(e={}),this.status===r.ResourceStatus.Unloaded){this.status=r.ResourceStatus.Loading;var i=this,s=this.resources.length,a=0;if(r.ScriptResource.loadingMode===r.ScriptLoadingMode.ConcurrentLegacyIE)for(var c=0;c<this.resources.length;c++){var u=this.resources[c];if(c>0&&(u.prevResource=this.resources[c-1]),u instanceof r.ScriptResource)a++;else if(u instanceof o){u.resources.length>0&&(u.resources[0].prevResource=u.prevResource);for(var l=!1,d=u.getAllResources(),p=0;p<d.length;p++)if(d[p]instanceof r.ScriptResource){l=!0;break}l&&a++}}t(this.resources.slice(),{onNext:function(r){e.onNext&&e.onNext(n)},onPending:function(r){e.onPending&&e.onPending(n),e.parent||n.executePending()},onLoaded:function(t){n.status=r.ResourceStatus.Loaded,e.onLoaded&&e.onLoaded(n)},onError:function(t,o){n.status=r.ResourceStatus.Error,e.onError?e.onError(t,o):console.error(o)}})}},o.prototype.executePending=function(){function e(r){if(r.length){var t=r.shift();t.executePending&&t.executePending(),e(r)}}e(this.resources.slice())},o.prototype.getAllResources=function(){for(var e=[this],r=0,t=this.resources.length;r<t;r++){var n=this.resources[r];if(n instanceof o)for(var i=n.getAllResources(),s=0,a=i.length;s<a;s++)e.push(i[s]);else e.push(n)}return e},o.prototype.find=function(e){for(var r=this.getAllResources(),t=0,o=r.length;t<o;t++){var n=r[t];if(e===n.name)return n}return null},o.prototype.add=function(e,r){void 0===r&&(r=!1);for(var t=0,n=e.length;t<n;t++){var i=o.interpretItemAsResource(e[t]);i&&(r?this.resources.unshift(i):this.resources.push(i))}return this},o.prototype.append=function(e){return this.add(e,!1),this},o.prototype.prepend=function(e){return this.add(e,!0),this},o.interpretItemAsResource=function(e){if("string"==typeof e){if(r.RequireResource.prefixRegex.test(e)){var t=r.RequireResource.prefixRegex.exec(e)[1];return new r.RequireResource(t)}if(/\.js$/i.test(e))return new r.ScriptResource(e);if(/\.css$/i.test(e))return new r.StyleResource(e);throw'Unknown resource type "'+e+'"'}if("object"==typeof e)return e instanceof r.Resource?e:o.generateResourceSetFromLiteral(e);throw new Error("Unknown item type: "+typeof e)},o.generateResourceSetFromLiteral=function(e){if(e instanceof o)return e;for(var r=new o(e.name),t=0,n=e.resources.length;t<n;t++)r.append([e.resources[t]]);return r},o}(r.Resource);r.ResourceSet=t}(r.resources||(r.resources={}))}(r.application||(r.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(r){var t=function(){function r(r){var t=this;this._isUnloading=!1,this.resourceSet=r||new e.resources.ResourceSet("everything"),window.addEventListener("beforeunload",function(e){t._isUnloading=!0})}return r.prototype.initializeApplication=function(e){throw new Error("Not implemented.")},r.prototype.loadAndInitialize=function(e){var r=this;void 0===e&&(e={}),this.resourceSet.load({onLoaded:function(){var t=r.initializeApplication(e);e.onInitialized&&e.onInitialized(t,r)},onError:function(t,o){r.handleError(o,e.onError)}})},r.prototype.handleError=function(e,r,t){if(r)r(e,this);else{if(console.error(e),this._isUnloading)return;var o=!1;if(t)try{t.trace.error("[{0}]: {1}".format(e.name,e.message)),t.command("Alert").execute("[{0}]: {1}".format(e.name,e.message),"Viewer Error"),o=!0}finally{}if(!o){var n=document.createElement("div");n.setAttribute("class","application-error"),n.setAttribute("style","padding: 1em; font-size: 1em; color: #333; border: 1px solid #cccccc; border-radius: 0.25em; margin: 2%;");var i=document.createElement("h1");i.textContent=i.innerText="An error occurred.",i.style.fontSize="1.5em",i.style.fontWeight="normal",i.style.paddingBottom="0.25em",i.style.color="#990000";var s=document.createElement("strong");s.textContent=s.innerText=e.name+": ";var a=document.createTextNode(e.message);n.appendChild(i),n.appendChild(s),n.appendChild(a),document.body.appendChild(n)}}},r}();r.ApplicationLoader=t}(e.loading||(e.loading={}))}(e.application||(e.application={}))}(e.framework||(e.framework={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(r){function t(e){try{var r=JSON.parse(e);if(r&&"object"==typeof r)return r}catch(e){return{error:{message:"Could not parse response. Error: "+e}}}}function o(e,r,o){n(e,function(e,n){var i=t(e);!i||"error"in i?o(new Error(i.error.message),n):r(i,n)},o)}function n(e,r,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.send(),o.onload=function(){var e=null;200===o.status&&o.responseText?r(o.responseText,e,o):(e=new Error("xhrGet request failed. Status: "+o.status+"."),t(e,o))},o.onerror=function(){var e=new Error("xhrGet request failed. Status: "+o.status+".");t(e,o)}}var i=function(t){function n(r){void 0===r&&(r={}),t.call(this),this.aliases=new e.framework.application.loading.CaselessMap;e.framework.application.resources.ResourceSet,e.framework.application.resources.ScriptResource;var o="loaderResourcePrefix"in r?r.loaderResourcePrefix:null;o||(o="baseUrl"in r?r.baseUrl:"./"),"useLocalEsriApi"in r?window.geocortexUseLocalEsriApi=r.useLocalEsriApi:r.useLocalEsriApi="geocortexUseLocalEsriApi"in window&&window.geocortexUseLocalEsriApi,this.resourceSet.append([{name:"dependencies",resources:[{name:"css",resources:[o+"Resources/Styles/jquery.ui.custom.css",o+"Resources/Scripts/esri/css/esri.css",o+"Resources/Styles/common.css",o+"Resources/Styles/Animations.css"]},{name:"tools",resources:[o+"Resources/Scripts/jquery.min.js",o+"Resources/Scripts/jquery.ui.custom.js",o+"Resources/Scripts/jquery.ui.touch-punch.js",o+"Resources/Scripts/jquery-ui-timepicker-addon.min.js",o+"Resources/Scripts/modernizr.js",o+"Resources/Scripts/modernizr-fix.js",o+"Resources/Scripts/bluebird.min.js",o+"Resources/Scripts/iso8601.min.js",o+"Resources/Scripts/remarkable.min.js",o+"Resources/Scripts/globalize/cldr.min.js",o+"Resources/Scripts/globalize/globalize.min.js",o+"Resources/Scripts/caja-html-sanitizer-minified.js"]},{name:"esri",resources:[o+"Resources/Scripts/dojo-config.js",o+"Resources/Scripts/esri.js",o+"Resources/Scripts/dojo-requires.js"]}]},{name:"viewer",resources:[o+"Resources/Compiled/Framework.js",o+"Resources/Compiled/Framework.UI.js",o+"Resources/Compiled/Charting.Infrastructure.js",o+"Resources/Compiled/Essentials.js",o+"Resources/Compiled/Mapping.Infrastructure.js",o+"Resources/Scripts/Insight.EventRelay.js",o+"Resources/Scripts/Bridge.js",o+"Resources/Scripts/moment/moment-timezone-with-data.js"]}]),"function"!=typeof WeakMap&&this.resourceSet.find("tools").append([o+"Resources/Scripts/weakmap.js"]);var n=document.documentMode;n&&n<=8&&this.resourceSet.find("css").prepend([o+"Resources/Styles/IE.css"]),n&&n<=9&&this.resourceSet.find("tools").append([o+"Resources/Scripts/jquery.iframe-transport-1.0.0.min.js"]),(!n||n&&n>=10)&&this.resourceSet.find("tools").append([o+"Resources/Scripts/hammer.js"])}return __extends(n,t),n.determineAppropriateShell=function(e){void 0===e&&(e=navigator.userAgent);var r=function(r){return new RegExp(r,"i").test(e)};return r("Android")&&r("mobile")||r("Windows")&&r("Phone")||r("iPhone")||r("iPod")||r("BlackBerry")||r("BB10")?"Handheld":r("Android")||r("iPad")||r("Playbook")||r("Touch")?"Tablet":"Desktop"},n.prototype.addAlias=function(e,r){return this.aliases.set(e,r),this},n.prototype.initializeApplication=function(t){var o=this;void 0===t&&(t={});try{dojo.contentHandlers.json=function(e){return JSON.parse(e.responseText)};var i=new e.framework.application.loading.CaselessMap(t.query||this.loadQueryParams(t));var s=t.hostElement||document.body,a=i.has("debug")?i.getAsBoolean("debug"):t.debug||!1,c=i.has("offline")?i.getAsBoolean("offline"):t.offline||!1,u=t.configBase,l=!!u;u||(u="Resources/Config/Default/"),/\/$/.test(u)||(u+="/");var d=t.shell||n.determineAppropriateShell(),p=t.viewerConfigUri;if(!p){var f=this.aliases.get("default");f&&!l&&(p=f)}p||(p=u+d+".json.js");var h=p.split("/"),g=h.slice(0,h.length-1).join("/")+"/",m=String.quickHashCode(e.framework.utils.makeUrlAbsolute(g)),v=document.createElement("div");v.setAttribute("class","shell splash-blurred"),v.setAttribute("data-region-name","ApplicationRegion"),v.setAttribute("data-region-adapter","geocortex.framework.ui.MultiDivRegionAdapter"),s.appendChild(v);var w=new e.essentialsHtmlViewer.ViewerApplication(p,s,m);return w.shellName=d,w.viewerConfigPath=g,w.debugMode=a,w.urlParameters=i,w.isOffline.set(c),w.event("SiteInitializedEvent").subscribe(window,function(){r.Splash.getDefaultSplash().close(),t.onSiteInitialized&&t.onSiteInitialized(w,o)}),w.event("SiteInitializationFailedEvent").subscribe(window,function(e){e.name="SiteInitializationFailedEvent/"+e.name,o.handleError(e,t.onError,w)}),w.event("SiteAuthorizationFailedEvent").subscribe(window,function(e){e.name="SiteAuthorizationFailedEvent/"+e.name,o.handleError(e,t.onError,w)}),w.event("ConfigurationLoadFailedEvent").subscribe(window,function(e){e.name="ConfigurationLoadFailed/"+e.name,o.handleError(e,t.onError,w)}),w.event("TraceEvent").subscribe(window,function(e){function r(e,r,t){return t=t||"0",(e+="").length>=r?e:new Array(r-e.length+1).join(t)+e}var t=e.timestamp,o="{0}:{1}:{2}.{3}".format(r(t.getHours(),2),r(t.getMinutes(),2),r(t.getSeconds(),2),r(t.getMilliseconds(),3)),n="[{0}]: {1}: {2}".format(e.level,o,e.message);console.info?console.info(n):console.log(n)}),w.initialize(),w}catch(e){this.handleError(e,t.onError)}},n.prototype.obtainConfigFromAlias=function(e,r,t){var o=this,n=e.query,i=n.get("viewer"),s="",a=n.get("configBase"),c=n.get("viewerConfigUri");i||(a?(i=this.getViewerIDFromConfig(a),s=this.getSiteIDFromConfig(a)):c&&(i=this.getViewerIDFromConfig(c),s=this.getSiteIDFromConfig(c)));var u=window.viewerConfig;u&&u.configurations&&this.aliases.merge(u.configurations||{}),this.aliases.merge(e.aliases||{});var l=this.aliases.get(i);if(u&&u.viewerConfigUri)e.viewerConfigUri=u.viewerConfigUri,r(!0);else if(l)e.viewerConfigUri=l,r(!0);else{var d=0!=s.length?s+"."+i:i,p=function(){a&&0!==a.length?e.configBase=a:c&&0!==c.length&&(e.viewerConfigUri=c),r(!0)};this.getViewerSettingsFromJson(function(t){var n=0!=location.hash.length&&function(e,r){return 0===e.indexOf(r)}(location.hash,"#gcx-"),i=t.endpoints,s=!1;(t.viewerSettings||[]).forEach(function(t){e.splashScreenUrl=t.splashScreenUrl?t.splashScreenUrl:"",d&&t.id.toLowerCase()===d.toLowerCase()&&!s&&(s=!0,o.canPassWithoutRedirect(t,n,t.securityUrl)&&(t.viewerConfigUri?e.viewerConfigUri=t.viewerConfigUri:t.url&&(e.configBase=t.url),r(!0)))}),d&&!s&&i&&i[0]&&i[0].externalUrl?(d=encodeURIComponent(d),o.getConfigBaseFromEndpoints({alias:d,hasToken:n,options:e,endpoints:i,index:0,onSuccess:r,onError:p})):s||p()},p)}},n.prototype.loadAndInitialize=function(t){var o=this;void 0===t&&(t={});var n=t.onError;t.onError=function(e,r){o.handleError(e,n)},t.query=t.query||new e.framework.application.loading.CaselessMap(new e.framework.application.loading.QueryParameters(location.href));var i=0,s=function(e){if(e&&r.Splash.getDefaultSplash().display(t.splashScreenUrl),++i>1){var n=o.initializeApplication(t);window.addEventListener("unload",function(){$(n.getHostElement()).empty().off("*"),$(document.head).empty().off("*"),n.shutdown(null)}),t.onInitialized&&t.onInitialized(n,o)}};this.obtainConfigFromAlias(t,s,function(e){o.handleError(e,t.onError)}),this.resourceSet.find("dependencies").load({onLoaded:function(){window.Globalize&&(window._globalize=window.Globalize,delete window.Globalize),dojo.ready(function(){o.resourceSet.find("viewer").load({onLoaded:function(){s()},onError:function(e,r){o.handleError(r,t.onError)}})}),require.on("error",function(e){o.handleError(e,t.onError)})},onError:function(e,r){o.handleError(r,t.onError)}})},n.prototype.resolveSplashScreenUrl=function(e,r){if(new RegExp("^(?:[a-z]+:)?//","i").test(r))return r;var t=e.indexOf("REST/");return t>=0&&(t+="REST/".length),(e=e.substring(0,t))+r},n.prototype.getViewerSettingsFromJson=function(e,r){o("ViewerSettings.json.js",e,r)},n.prototype.canPassWithoutRedirect=function(e,r,t){return!0===e.isAuthorized||(!(!r&&t&&0!==t.length)||(t+=encodeURIComponent(this.replaceConfigParamsWithAliasInUrl(window.location.toString(),e.id)),location.assign(t),!1))},n.prototype.getConfigBaseFromEndpoints=function(e){var r=this,t=e.alias,n=e.hasToken,i=e.options,s=e.endpoints,a=e.index,c=e.onSuccess,u=e.onError;if(a===s.length)u();else{var l=function(e,r){return e.lastIndexOf(r)===e.length-r.length},d=String(s[a].externalUrl);(l(d,"/")||l(d,"\\"))&&(d=d.slice(0,-1)),o((d+="/")+t+"?f=json",function(e){var t=e.url;(l(t,"/")||l(t,"\\"))&&(t=t.slice(0,-1)),0!==t.indexOf("/")&&0!==t.indexOf("\\")||(t=t.slice(0,1)),i.splashScreenUrl=e.splashScreenUrl?e.splashScreenUrl:"",i.splashScreenUrl&&(i.splashScreenUrl=r.resolveSplashScreenUrl(d,i.splashScreenUrl)),r.canPassWithoutRedirect(e,n,d+e.securityUrl)&&(i.configBase=d+t+"/Resources/Config/Default",c(!0))},function(e,o){e.name="EssentialsEndpointHttpError/"+e.name,e.message+=' - Error with essentials endpoint "'+s[a].externalUrl+'"',console.log(e),++a,r.getConfigBaseFromEndpoints({alias:t,hasToken:n,options:i,endpoints:s,index:a,onSuccess:c,onError:u})})}},n.prototype.replaceConfigParamsWithAliasInUrl=function(e,r){var t="",o=/((\&|\?)configBase=|(\&|\?)viewerConfigUri=)/,n=e.match(o);if(null==n)return e;t=n[0];var i=e.indexOf(t)+1,s=e.substring(i),a=s.indexOf("&")>0?s.indexOf("&"):s.length,c=e.substring(i+a);return e.substring(0,i)+"viewer="+r+c},n.prototype.loadQueryParams=function(e){void 0===e&&(e={});var r=/^.*\?([^#]*).*$/.exec(location.href);return r?dojo.queryToObject(r[1]):{}},n.prototype.getSiteIDFromConfig=function(e){var r=e.toLowerCase(),t=r.indexOf("/sites/")+7||r.indexOf("\\sites\\")+7,o=e.substr(t),n=o.indexOf("/")||o.indexOf("\\");return o.substr(0,n)},n.prototype.getViewerIDFromConfig=function(e){var r=e.toLowerCase(),t=r.toLocaleLowerCase().indexOf("/viewers/")+9||r.indexOf("\\viewers\\")+9,o=e.substr(t),n=o.indexOf("/")||o.indexOf("\\");return o.substr(0,n)},n.prototype.handleError=function(e,o,n){r.Splash.getDefaultSplash().destroy(),n&&(n.getHostElement().className+=" viewer-loader-error"),t.prototype.handleError.call(this,e,o,n)},n}(e.framework.application.loading.ApplicationLoader);r.ViewerLoader=i,r.tryParseJson=t,r.getJson=o,r.xhrGet=n}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={})),window.shellName=geocortex.essentialsHtmlViewer.ViewerLoader.determineAppropriateShell();