dojo.require("esri.urlUtils"),dojo.require("esri.arcgis.utils"),dojo.require("esri.arcgis.Portal"),dojo.require("esri.layers.FeatureLayer"),dojo.require("esri.layers.wms"),dojo.require("esri.layers.wmts"),dojo.require("esri.layers.WebTiledLayer"),dojo.require("esri.virtualearth.VETiledLayer"),dojo.require("dojox.data.CsvStore"),dojo.require("dojo.aspect"),dojo.require("dojo.on"),dojo.require("dojox.gfx.matrix"),dojo.require("esri.toolbars.draw"),dojo.require("esri.toolbars.edit"),dojo.require("moment.moment"),moment=moment.moment;var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},geocortex;!function(e){!function(e){!function(e){e.commandsMetadata=[{"name":"ActivateView","metadata":{"arguments":"string","description":"Activates a view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeactivateView","metadata":{"arguments":"string","description":"Deactivates a view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleView","metadata":{"arguments":"string","description":"Activates or deactivates a view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleLogView","metadata":{"arguments":"none","description":"Activates or deactivates log view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowLog","metadata":{"arguments":"boolean","description":"Shows the log view if the parameter is true.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideLog","metadata":{"arguments":"none","description":"Hides the log view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleResultsFrame","metadata":{"arguments":"none","description":"Activates or deactivates Results frame.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleDataFrame","metadata":{"arguments":"none","description":"Activates or deactivates data frame.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DestroyView","metadata":{"arguments":"string","description":"Destroys a view, wiping out its bindings and DOM substructure.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CloseModalRegion","metadata":{"arguments":"none","description":"Closes the ModalWindowRegion.","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenWebPage","metadata":{"arguments":"string","description":"Opens a web page in another tab/window.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Alert","metadata":{"arguments":"string","description":"Displays an alert.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Confirm","metadata":{"arguments":"list","description":"Displays a confirm.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ConsoleDir","metadata":{"arguments":"object","description":"Displays a representation of the specified parameter object in the browser's debugging console.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Identify","metadata":{"arguments":"esri.geometry.Geometry","description":"Executes an identify operation on a geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"IdentifyBufferedGeometry","metadata":{"arguments":"esri.geometry.Geometry","description":"Activates the Buffer Options dialog, buffers input geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"IdentifyBufferedFeature","metadata":{"arguments":"esri.Graphic|essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Activates the Buffer Options dialog, buffers input feature geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"IdentifyBufferedFeatureSet","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSet|essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection|string","description":"Activates the Buffer Options dialog, buffers input feature set geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"IdentifyBufferedFeatureSetCollection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection|string","description":"Activates the Buffer Options dialog, buffers input feature set collection geometry using settings specified by the user, places temporary markup on the map and identifies using the buffered geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"Prompt","metadata":{"arguments":"object","description":"Displays a prompt.","isHyperlinkable":!0,"visibility":"private"}},{"name":"StartOfflineSyncAndShowProgress","metadata":{"arguments":"string","description":"Starts downloading or syncing an offline map an displays the progress to the user.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StepZoomIn","metadata":{"arguments":"none","description":"Zooms in a step.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StepZoomOut","metadata":{"arguments":"none","description":"Zooms out a step.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RecenterMapOnNextMapResize","metadata":{"arguments":"none","description":"Recenters the map to its existing position the next time the map is resized.","isHyperlinkable":!0,"visibility":"public"}},{"name":"PanToPoint","metadata":{"arguments":"esri.geometry.Geometry","description":"Pans to a point or other type of Geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"PanUp","metadata":{"arguments":"none","description":"Pans the map up.","isHyperlinkable":!0,"visibility":"public"}},{"name":"PlotCoordinates","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateBase|essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateBase[]","description":"Plots a coordinate (or a number of coordinates) on the map.","isHyperlinkable":!1,"visibility":"public"}},{"name":"PanDown","metadata":{"arguments":"none","description":"Pans the map down.","isHyperlinkable":!0,"visibility":"public"}},{"name":"PanLeft","metadata":{"arguments":"none","description":"Pans the map left.","isHyperlinkable":!0,"visibility":"public"}},{"name":"PanRight","metadata":{"arguments":"none","description":"Pans the map right.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToExtent","metadata":{"arguments":"esri.geometry.Extent","description":"Zooms to the given extent.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToScale","metadata":{"arguments":"number","description":"Zooms to the given scale.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomOutToExtent","metadata":{"arguments":"esri.geometry.Extent","description":"Zooms out to the given extent.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToLayerExtent","metadata":{"arguments":"geocortex.essentials.Layer","description":"Zooms to the extent of all the features in a layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ZoomToLayerVisibleScale","metadata":{"arguments":"geocortex.essentials.Layer","description":"Zooms to the scale at which features in a layer become visible.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ZoomToInitialExtent","metadata":{"arguments":"none","description":"Zooms to the initial extent of the current Site.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToPreviousExtent","metadata":{"arguments":"none","description":"Zooms to the previous recorded map extent if any.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToNamedExtent","metadata":{"arguments":"string","description":"Zooms to the bookmarked extent with the specified name.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToNextExtent","metadata":{"arguments":"none","description":"Zooms to the next recorded map extent if any.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToOfflineMapExtent","metadata":{"arguments":"none","description":"Zooms to the extent of the currently active offline map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToFullExtent","metadata":{"arguments":"none","description":"Zooms to the full extent of the current Site.","isHyperlinkable":!0,"visibility":"public"}},{"name":"MapResize","metadata":{"arguments":"none","description":"Tells the map control to resize itself. This should be called after altering the map container's dimensions.","isHyperlinkable":!0,"visibility":"public"}},{"name":"MaximizePanel","metadata":{"arguments":"string","description":"Instructs the region hosting a view to maximize itself if it supports this action. As of v2.4, only the BottomPanelRegion and its sub regions support this action.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RestorePanel","metadata":{"arguments":"string","description":"Instructs the region hosting a view to restore itself to default dimensions if it supports this action. As of v2.4, only the BottomPanelRegion and its sub regions support this action.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddTemporaryMarkupGeometry","metadata":{"arguments":"esri.geometry.Geometry","description":"Adds a temporary markup graphic to the map. The {@link Commands.ClearTemporaryMarkup} command will clear this piece of markup.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ClearTemporaryMarkup","metadata":{"arguments":"none","description":"Removes temporary markup created by the command 'AddTemporaryMarkupGeometry'","isHyperlinkable":!0,"visibility":"public"}},{"name":"RippleClick","metadata":{"arguments":"MouseEvent","description":"Creates a ripple feedback effect when clicking on the map","isHyperlinkable":!1,"visibility":"private"}},{"name":"ToggleRippleClick","metadata":{"arguments":"none","description":"Toggles the visibility of the ripple feedback given for map clicks","isHyperlinkable":!0,"visibility":"private"}},{"name":"ClearTrustedUrls","metadata":{"arguments":"none","description":"Clears list of trusted URLs which are added by clicking 'yes' on potentially untrusted content popup","isHyperlinkable":!0,"visibility":"public"}},{"name":"ZoomToFeature","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Zooms to a feature.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ZoomToFeatureIfOutsideMapExtent","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Zooms to a feature if the it's outside of the map's extent, otherwise nothing happens.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ZoomToFeatures","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSet","description":"Zooms to the extent of all the features in the feature set.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ZoomToFeatureSetCollection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection","description":"Shows all of the features in the Feature Set Collection on the map","isHyperlinkable":!0,"visibility":"private"}},{"name":"ZoomToAllFeatures","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature[]","description":"Zooms to the extent of all the features.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowMap","metadata":{"arguments":"none","description":"Activates map view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowMapElement","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs","description":"Displays an element anchored to a specific point on the map.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowMapCallout","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs","description":"Displays a map callout anchored to a given point.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HideMapElement","metadata":{"arguments":"string","description":"Removes an element previously anchored to the map using {@link Commands.ShowMapElement}.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowMapTipResults","metadata":{"arguments":"string","description":"Shows map tip results for a FeatureSetCollection previously added to the FeatureSetManager.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowMapTipResultsInCallout","metadata":{"arguments":"string","description":"Shows map tip results for a FeatureSetCollection previously added to the FeatureSetManager, in a floating callout window on the map (the default behavior prior to version 2.4).","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenDataFrame","metadata":{"arguments":"none","description":"Opens the DataRegion, if it is present in the current shell.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CloseDataFrame","metadata":{"arguments":"none","description":"Closes the DataRegion, if it is present in the current shell.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ChangeDataFramePosition","metadata":{"arguments":"args: {position: PanelPosition; callback?: () => void","description":"Change the DataRegion position to desidered one, if it is present in the current shell.","isHyperlinkable":!1,"visibility":"private"}},{"name":"OpenBottomRegion","metadata":{"arguments":"none","description":"Opens the BottomPanelRegion, if it is present in the current shell.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CloseBottomRegion","metadata":{"arguments":"none","description":"Closes the BottomPanelRegion, if it is present in the current shell.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RunWorkflowById","metadata":{"arguments":"string","description":"Runs a workflow.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RunWorkflowByUrl","metadata":{"arguments":"string","description":"Runs a GW5 workflow by url.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RunWorkflowByUrlAndInputs","metadata":{"arguments":"object","description":"Runs a GW5 workflow by url and applies the provided inputs.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RunWorkflowWithGeometry","metadata":{"arguments":"object","description":"Runs a workflow with a geometry used as an input argument.","isHyperlinkable":!0,"visibility":"private"}},{"name":"RunWorkflowWithArguments","metadata":{"arguments":"object","description":"Runs a workflow with a set of input arguments.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisplayWorkflowContainerContent","metadata":{"arguments":"object","description":"Displays a view in a workflow container.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ClearActiveTool","metadata":{"arguments":"none","description":"Clears the active tool.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetActiveTool","metadata":{"arguments":"string","description":"Sets the active tool.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Geolocate","metadata":{"arguments":"object","description":"Zooms to the current location of the device when it becomes available.","isHyperlinkable":!0,"visibility":"public"}},{"name":"GeolocateTrack","metadata":{"arguments":"none","description":"Enables the tracking of the device's location when it is available, without panning the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"GeolocateFollow","metadata":{"arguments":"none","description":"Enables the following of the device's location when it is available, panning the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"GeolocateStop","metadata":{"arguments":"none","description":"Stops the tracking and following of the device's location.","isHyperlinkable":!0,"visibility":"public"}},{"name":"GeolocateShowBuffer","metadata":{"arguments":"none","description":"Display a circular buffer showing the accuracy of the latest GPS reading.","isHyperlinkable":!0,"visibility":"public"}},{"name":"GeolocateHideBuffer","metadata":{"arguments":"none","description":"Hide a circular buffer showing the accuracy of the latest GPS reading.","isHyperlinkable":!0,"visibility":"public"}},{"name":"TakeApplicationOffline","metadata":{"arguments":"none","description":"Puts the application in an offline state.","isHyperlinkable":!1,"visibility":"public"}},{"name":"TapToDismiss","metadata":{"arguments":"args: {view: framework.ui.ViewBase; onOtherInteracted?: (evt?: Event) => void ; onElementInteracted?: (evt?: Event) => void}","description":"Dismisses the specified view on the next tap anywhere on the screen. Optionally fires specified callbacks.","isHyperlinkable":!1,"visibility":"private"}},{"name":"TakeApplicationOnline","metadata":{"arguments":"none","description":"Connects the application to the internet.","isHyperlinkable":!1,"visibility":"public"}},{"name":"SetGMAFOfflineButtonState","metadata":{"arguments":"string","description":"Sets the visibility of the online/offline button in the GMAF app.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleConnectivity","metadata":{"arguments":"none","description":"Toggles the connectivity of the app, from offline to online or viceversa","isHyperlinkable":!0,"visibility":"public"}},{"name":"RefreshOfflineMapsList","metadata":{"arguments":"string","description":"Refresh the list of offline maps on the OfflineMapsList view.","isHyperlinkable":!1,"visibility":"public"}},{"name":"OpenFeatureSetCollection","metadata":{"arguments":"string","description":"Opens the FeatureSetCollection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenPortalMyContentWindow","metadata":{"arguments":"none","description":"Opens a new browser window to the authenticated users ArcGIS Portal 'My Content' page.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CloseFeatureSetCollection","metadata":{"arguments":"string","description":"Closes the FeatureSetCollection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveFeatureSetCollection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection","description":"Removes the specified collection from the FeatureSetManager.","isHyperlinkable":!0,"visibility":"private"}},{"name":"RemoveFeatureSetCollectionById","metadata":{"arguments":"string","description":"Removes the collection specified by ID from the FeatureSetManager.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Search","metadata":{"arguments":"string","description":"Performs a search on all active providers.","isHyperlinkable":!0,"visibility":"public"}},{"name":"GlobalSearch","metadata":{"arguments":"string","description":"Performs a search on all active providers.","isHyperlinkable":!0,"visibility":"public"}},{"name":"BufferGeometry","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.buffer.BufferGeometryArgs","description":"Buffers input geometry, adds buffer markup to the map, and fires the callback and event with the buffered geometry. When the source command is specified, buffers using current settings for the command.","isHyperlinkable":!0,"visibility":"private"}},{"name":"CancelEditCoordinate","metadata":{"arguments":"none","description":"Cancels editing of a coordinate if currently active.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CancelSearch","metadata":{"arguments":"none","description":"Cancel the search on all providers.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearSearch","metadata":{"arguments":"none","description":"Clear the search results.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearSelection","metadata":{"arguments":"none","description":"Clears the open identify results/selection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowExportWebMapDialog","metadata":{"arguments":"none","description":"Activates the export web map view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowFeatureDetails","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Creates and displays the Feature Details dialog for the Feature or FeatureSetCollection specified.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowFeatureDetailsCompact","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Creates and displays the Feature Details dialog for the {@link geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature} in Compact View mode. If the feature is not specified, details for the last feature will be displayed.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowFeatureDetailsExpanded","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Creates and displays the Feature Details dialog for the {@link geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature} in Expanded View mode. If the feature is not specified, details for the last feature will be displayed.","isHyperlinkable":!0,"visibility":"private"}},{"name":"SetFeatureDetailsMode","metadata":{"arguments":"string","description":"Sets the feature details dialog to the specified view mode.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowFeatureParentDetails","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Shows the previously opened feature when browsing related features in the feature details view.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowFeatureAttributeEditor","metadata":{"arguments":"none","description":"Shows the feature attribute editor used to set feature attributes.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideFeatureAttributeEditor","metadata":{"arguments":"none","description":"Hides the feature attribute editor used to set feature attributes.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowFeatureTemplatePicker","metadata":{"arguments":"layer","description":"Shows the feature template picker used to create new features. If a layer is supplied, shows the templates for the layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HideFeatureTemplatePicker","metadata":{"arguments":"none","description":"Hides the feature template picker used to create new features.","isHyperlinkable":!0,"visibility":"public"}},{"name":"FSMCollectionSetCommand","metadata":{"arguments":"string, string","description":"Set the preferred command to open the FeatureSetCollection for the given source name.","isHyperlinkable":!0,"visibility":"private"}},{"name":"PanToAllFeatures","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature[]","description":"Pans to the extent of all the features.","isHyperlinkable":!0,"visibility":"private"}},{"name":"PanToFeature","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Pans to a Geocortex feature.","isHyperlinkable":!0,"visibility":"private"}},{"name":"PanToFeatureIfOutsideMapExtent","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Pans to a Geocortex feature if the feature is outside of the map's extent, otherwise nothing happens.","isHyperlinkable":!0,"visibility":"private"}},{"name":"Project","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ProjectArgs","description":"Calls a geometry service to project geometries between different coordinate systems.","isHyperlinkable":!1,"visibility":"private"}},{"name":"InvokeMapTip","metadata":{"arguments":"esri.geometry.Geometry","description":"Executes an Identify operation on the given geometry and sets \"MapTip\" as its source tag.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowMapTip","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Displays a feature in the map tip view.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowMapTipInCallout","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Displays a feature in a map tip callout anchored to the map.","isHyperlinkable":!0,"visibility":"private"}},{"name":"SuspendMapTips","metadata":{"arguments":"none","description":"Suspends the display of map tips, allowing other components the opportunity to interact with the map without invoking map tips on click/tap events.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SwitchToLayerTheme","metadata":{"arguments":"string","description":"Switches to the specified layer theme, identified by ID or display name.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ResumeMapTips","metadata":{"arguments":"none","description":"Resumes the previously suspended display of map tips.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearStorageForApplication","metadata":{"arguments":"none","description":"Clears the offline data for the current application.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearStorageForDomain","metadata":{"arguments":"none","description":"Clears all offline data for the current domain. This includes data for all applications loaded from the current domain.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ListReports","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection","description":"Presents a user interface for choosing to run a report from a list of reports that are available to the given reportable input (group of features).","isHyperlinkable":!1,"visibility":"public"}},{"name":"RunFeatureReport","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Alias to 'ListReports' for backwards compatibility with the Silverlight viewer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RunFeaturesReport","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection","description":"Alias to 'ListReports' for backwards compatibility with the Silverlight viewer.","isHyperlinkable":!1,"visibility":"public"}},{"name":"RunReport","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.RunReportArgs","description":"Runs a given report on the provided features, and displays the result (a download link to the report file) to the user.","isHyperlinkable":!1,"visibility":"public"}},{"name":"RunReportByUrl","metadata":{"arguments":"string","description":"Runs a URL Report given by its Portal Item URL and displays the result (a download link to the report file) to the user.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowResultsList","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection","description":"Displays the list of features in the given FeatureSetCollection as a list.","isHyperlinkable":!1,"visibility":"private"}},{"name":"ShowResultsTable","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection","description":"Displays the list of features in the given FeatureSetCollection in a tabular view.","isHyperlinkable":!1,"visibility":"private"}},{"name":"RestoreTableColumnsOrder","metadata":{"arguments":"none","description":"Restores the initial columns order in the currently visible table.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RestoreTableColumnsVisibility","metadata":{"arguments":"none","description":"Restores the initial columns visibility in the currently visible table.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RestoreTableColumnsWidth","metadata":{"arguments":"none","description":"Restores the initial columns width in the currently visible table.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateResultsTableEditingMode","metadata":{"arguments":"none","description":"Switches the results table into editing mode.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SwitchToListResultsView","metadata":{"arguments":"none","description":"Switches from Results Table to Results List view if the Results Table view is currently active.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SwitchToTabularResultsView","metadata":{"arguments":"none","description":"Switches from Results List to Results Table view if the Results List view is currently active.","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenResultsFrame","metadata":{"arguments":"none","description":"Activates the ResultsRegion.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CloseResultsFrame","metadata":{"arguments":"none","description":"Deactivates the ResultsRegion.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowLayerList","metadata":{"arguments":"none","description":"Displays the layer list.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SwitchToLayerView","metadata":{"arguments":"none","description":"Displays the layer list.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SwitchToLegendView","metadata":{"arguments":"none","description":"Displays the legend view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowLayerActions","metadata":{"arguments":"geocortex.essentials.Layer","description":"Shows available actions for a given layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowMapServiceActions","metadata":{"arguments":"geocortex.essentials.MapService","description":"Shows available actions for a given map service.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HideMapServiceActions","metadata":{"arguments":"none","description":"Closes the map service actions view.","isHyperlinkable":!0,"visibility":"private"}},{"name":"PulseStatus","metadata":{"arguments":"string","description":"Resets the timer of the status view model.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveStatus","metadata":{"arguments":"string","description":"Removes the status indicator from the screen with the specified ID.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddStatus","metadata":{"arguments":"string","description":"Adds a status indicator to the screen.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CreateHighlightLayer","metadata":{"arguments":"string","description":"Creates a new highlight layer with the specified name.","isHyperlinkable":!0,"visibility":"private"}},{"name":"SetActiveHighlightLayer","metadata":{"arguments":"string","description":"Sets the layer with the specified name as active, if there is one.","isHyperlinkable":!0,"visibility":"private"}},{"name":"SetActiveHighlightLayerDefault","metadata":{"arguments":"none","description":"Sets the default highlight layer as the active highlight layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HighlightEsriFeatureSet","metadata":{"arguments":"esri.tasks.FeatureSet","description":"Highlights all of the features in the specified Esri feature set in the active highlight layer.","isHyperlinkable":!1,"visibility":"private"}},{"name":"SetHighlightBorderColor","metadata":{"arguments":"string","description":"Sets the border color used for new highlights, specified in 6 or 8 digit hex in RGB or ARGB form.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetHighlightBorderWidth","metadata":{"arguments":"number","description":"Sets the border width (in pixels) used for new highlights.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetHighlightFillColor","metadata":{"arguments":"string","description":"Sets the current highlight fill color to use for a highlighted feature.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetFocusedBorderColor","metadata":{"arguments":"string","description":"Sets the border color used for an focused feature.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetFocusedFillColor","metadata":{"arguments":"string","description":"Sets the current highlight fill color to use, if the feature does not specify one.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveHighlightLayer","metadata":{"arguments":"string","description":"Removes the highlight layer with the specified name, if there is one.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddMapService","metadata":{"arguments":"essentials.MapService|geocortex.essentialsHtmlViewer.mapping.infrastructure.commandArgs.AddMapServiceArgs","description":"Integrate a map service and its sub-components into the viewer and onto the map.","isHyperlinkable":!0,"visibility":"private"}},{"name":"RemoveMapService","metadata":{"arguments":"essentials.MapService","description":"Removes a user added map service off of the map and out of the viewer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"RemoveUserAddedLayer","metadata":{"arguments":"essentials.Layer","description":"Remove a user added layer (and its parent map service) off of the map and out of the viewer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ClearHighlights","metadata":{"arguments":"string","description":"Removes the highlights from the default highlight layer (no parameter), or from the highlight layer with the supplied name","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearDefaultHighlights","metadata":{"arguments":"none","description":"Removes the highlights from the default highlight layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HighlightFeatureSet","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSet","description":"Highlights all of the features in the specified feature set in the active highlight layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HighlightFeature","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Highlights the feature (or array of features) in the active highlight layer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HighlightFeatures","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature[]","description":"Highlights the feature (or array of features) in the active highlight layer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearAndHighlightFeatures","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature[]","description":"Clears existing highlights and highlights all specified features on the active highlight layer.","isHyperlinkable":!1,"visibility":"public"}},{"name":"FocusFeature","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Focuses the specified feature on the active highlight layer.","isHyperlinkable":!1,"visibility":"public"}},{"name":"ClearFeatureHighlight","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Clears the highlight from a feature if it's currently highlighted.","isHyperlinkable":!1,"visibility":"public"}},{"name":"ClearFeatureFocus","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Clears the feature emphasis from a feature if it's currently focused, returning it to the highlighted state.","isHyperlinkable":!1,"visibility":"public"}},{"name":"HighlightFeatureDefault","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Highlights the feature in the default highlight layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddMarkup","metadata":{"arguments":"esri.geometry.Geometry","description":"Adds the given geometry to the markup layer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddMarkupGeometry","metadata":{"arguments":"esri.geometry.Geometry","description":"Adds the given geometry to the markup layer.  (Identical to the AddMarkup command.)","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddTextMarkup","metadata":{"arguments":"esri.geometry.Geometry","description":"Prompts the user for text to add as markup. When completed, text markup is added at the provided geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ClearMarkup","metadata":{"arguments":"none","description":"Prompts the user for confirmation, and if approved, clears all of the markup from the markup layer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearMarkupQuiet","metadata":{"arguments":"none","description":"Clears all of the markup from the markup layer without prompting for confirmation.","isHyperlinkable":!0,"visibility":"public"}},{"name": "ClearCustomGraphics","metadata": {"arguments":"string","description":"Clears all of the graphics from the custom graphics layer with the given id, or all custom graphics if no id given.","isHyperlinkable": !0,"visibility": "public"}},{"name":"MeasureDistance","metadata":{"arguments":"esri.geometry.Polyline","description":"Computes the total and segment distance measurements for the specified Polyline geometry and plots it on the map along with its measurements. NOTE: An Esri or Geocortex feature may also be provided as arguments in lieu of a polyline geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"MeasureArea","metadata":{"arguments":"esri.geometry.Polygon","description":"Computes the area, perimeter and individual segment distances for the specified Polylgon geometry and plots it on the map along with its measurements. NOTE: An Esri or Geocortex feature may also be provided as arguments in lieu of a polygon geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"DeleteMeasurement","metadata":{"arguments":"esri.geometry.Geometry","description":"Deletes measurement markup within the given geometry","isHyperlinkable":!0,"visibility":"private"}},{"name":"SetMeasurementUnits","metadata":{"arguments":"string, string","description":"Sets the measurement units for the measurements performed by the measurement module. Also updates existing measurements already on the map.","isHyperlinkable":!1,"visibility":"private"}},{"name":"ResizeShell","metadata":{"arguments":"none","description":"Recalculate the size and layout of the shell and refresh the shell accordingly.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateHomePanel","metadata":{"arguments":"none","description":"Activates Home Panel if it is configured to be included.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivatePlotCoordinatesView","metadata":{"arguments":"none","description":"Activates the Plot Coordinates view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ApplyFilterControlQuery","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.eventArgs.FilterControlQueryChangedEventArgs","description":"Applies the current query to the specified Filter Control.","isHyperlinkable":!1,"visibility":"public"}},{"name":"ShowHomePanel","metadata":{"arguments":"none","description":"Activates Home Panel if it is configured to be included.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideHomePanel","metadata":{"arguments":"none","description":"Deactivates/hides the Home Panel if it is configured to be included.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AttachFileToFeature","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Checks for HTML5 FileReader / Cordova support and activates File Attachments if supported.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ToggleToolbar","metadata":{"arguments":"none","description":"Toggles the visibility of the toolbar if present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenToolbar","metadata":{"arguments":"none","description":"Opens the toolbar, if present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CloseToolbar","metadata":{"arguments":"none","description":"Closes the toolbar, if present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideToolbarButton","metadata":{"arguments":"The name of the button to hide, as configured in Manager.","description":"Hides and disables a named toolbar button.","isHyperlinkable":!1,"visibility":"public"}},{"name":"ShowToolbarButton","metadata":{"arguments":"The name of the button to show, as configured in Manager.","description":"Shows a previously hidden named toolbar button.","isHyperlinkable":!1,"visibility":"public"}},{"name":"HideToolbarTab","metadata":{"arguments":"The name of the tab to hide, as configured in Manager.","description":"Hides and disables an entire tab in the tabbed toolbar.","isHyperlinkable":!1,"visibility":"public"}},{"name":"ShowToolbarTab","metadata":{"arguments":"The name of the tab to show, as configured in Manager.","description":"Shows a previously hidden toolbar tab in the toolbar.","isHyperlinkable":!1,"visibility":"public"}},{"name":"PrintMap","metadata":{"arguments":"none","description":"Displays a dialog to create a printable map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowExportMapDialog","metadata":{"arguments":"none","description":"Displays a dialog to save a map image.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowLayerCatalog","metadata":{"arguments":"none","description":"Shows the layer catalog view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateTimeSlider","metadata":{"arguments":"none","description":"Activates and shows the Time Slider if time slider profiles are available in the site.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeactivateTimeSlider","metadata":{"arguments":"none","description":"Deactivates time settings applied to the map and hides the Time Slider.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideTimeSlider","metadata":{"arguments":"none","description":"Hides the time slider if currently visible but does not deactivate time settings applied to the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowTimeSliderSettings","metadata":{"arguments":"none","description":"Shows the time slider settings view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideTimeSliderSettings","metadata":{"arguments":"none","description":"Hides the time slider settings view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleTimeSliderActions","metadata":{"arguments":"none","description":"Toggles the time slider actions container visibility.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StartTimeSliderPlayback","metadata":{"arguments":"none","description":"Starts playback for an open time slider.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StopTimeSliderPlayback","metadata":{"arguments":"none","description":"Stops playback for an open time slider.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StepTimeSliderForward","metadata":{"arguments":"none","description":"Steps the time slider forward in an open time slider.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StepTimeSliderBack","metadata":{"arguments":"none","description":"Steps the time slider backward in an open time slider.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetTimeSliderProfile","metadata":{"arguments":"geocortex.essentials.TimeSliderProfile","description":"Sets a specified time slider profile or updates the existing profile if only a partial profile is specified.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddCatalogLayers","metadata":{"arguments":"Comma seperated string or array of layer ids.","description":"Adds catalog layers.","isHyperlinkable":!1,"visibility":"public"}},{"name":"AppendCatalogLayers","metadata":{"arguments":"Comma seperated string or array of layer ids.","description":"Appends catalog layers.","isHyperlinkable":!1,"visibility":"public"}},{"name":"ClearLayerCatalogLayers","metadata":{"arguments":"none","description":"Clears all catalog layers.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveLayerCatalogIds","metadata":{"arguments":"A string array of CatalogIds to be removed","description":"Removes specific catalog layers","isHyperlinkable":!1,"visibility":"public"}},{"name":"ShowBookmarks","metadata":{"arguments":"none","description":"Displays the Bookmarked Locations menu if the BookmarkViewModel's property, bookmarksEnabled, is set to true.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddBookmark","metadata":{"arguments":"string","description":"Bookmark the current extent with the given name.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowAddBookmark","metadata":{"arguments":"none","description":"Prompts the user to bookmark the current extent by entering a name.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowCoordinateActions","metadata":{"arguments":"string","description":"Shows the configured coordinate actions.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveBookmark","metadata":{"arguments":"string","description":"Removes a bookmark with the given name if exists.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SelectBaseMap","metadata":{"arguments":"string","description":"A map can have a number of basemaps associated with it. SelectBaseMap allows you to programmatically select one of the basemaps to display. All other basemaps are then faded out.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateSelectLayersForIdentify","metadata":{"arguments":"none","description":"Activates the Layer Selector for Identify and applies current settings.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeactivateSelectLayersForIdentify","metadata":{"arguments":"none","description":"Deactivates the Layer Selector for Identify and enables all default identifiable layers.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateBuffering","metadata":{"arguments":"string|string[]","description":"Activates buffering for the specified command(s). Uses currently configured settings for the command.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateBufferingAndDisplayOptions","metadata":{"arguments":"string","description":"Activates buffering for the specified command and displays the associated Buffer Options dialog. ","isHyperlinkable":!0,"visibility":"public"}},{"name":"ActivateTransientElements","metadata":{"arguments":"string","description":"Activates any transient elements configured against a specific ID in the toolbar module.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeactivateBuffering","metadata":{"arguments":"string|string[]","description":"Deactivates buffering, if active, for the specified command(s).","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeactivateBufferingAndDismissOptions","metadata":{"arguments":"string","description":"Deactivates buffering for the specified command and dismisses the associated Buffer Options dialog if its active. ","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeactivateTransientElements","metadata":{"arguments":"string","description":"Deactivates any transient elements configured against a specific ID in the toolbar module.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeleteAllCoordinates","metadata":{"arguments":"none","description":"Deletes all plotted Coordinates from the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeleteCoordinates","metadata":{"arguments":"string|string[]","description":"Deletes one or many plotted Coordinates from the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EditCoordinate","metadata":{"arguments":"string|null","description":"Edits a plotted Coordinate on the map or creates a new coordinate in edit mode if no descriptor Id is provided.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EditMarkup","metadata":{"arguments":"esri.geometry.Geometry","description":"Edits markup that intersects the extent of the provided geometry.","isHyperlinkable":!0,"visibility":"private"}},{"name":"DeleteMarkup","metadata":{"arguments":"esri.geometry.Geometry","description":"Deletes markup within the given geometry","isHyperlinkable":!0,"visibility":"private"}},{"name":"CreateMarkupStyleView","metadata":{"arguments":"string","description":"Activates the style picker if 'point', 'polyline', 'polygon', or 'text' is the string provided. If it is null, then the app will try and detect what style selector to activate.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ChangeMarkupStyle","metadata":{"arguments":"MarkupTemplate","description":"Takes a MarkupTemplate, PointTemplate, PolylineTemplate, PolygonTemplate, or TextTemplate. It will change the style of the markup to suit the template provided.","isHyperlinkable":!0,"visibility":"private"}},{"name":"StopEditingMarkup","metadata":{"arguments":"boolean","description":"Stops editing. If arg is true, clears the active tool, if arg is false, doesn't clear active tool.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StartEditingFeature","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Shows the editing form.","isHyperlinkable":!0,"visibility":"private"}},{"name":"EnableSearchRefinement","metadata":{"arguments":"boolean","description":"Enables or disables the refinement of a global search from within search hints (if any).","isHyperlinkable":!0,"visibility":"public"}},{"name":"ExportResultsTo","metadata":{"arguments":"{ format: string, fsc: geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection }","description":"Enables or disables the refinement of a global search from within search hints (if any).","isHyperlinkable":!0,"visibility":"private"}},{"name":"ExportMarkupLayer","metadata":{"arguments":"none","description":"Exports markup layer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ExportGraphicsLayer","metadata":{"arguments":"{ args:  geocortex.essentialsHtmlViewer.mapping.infrastructure.commandArgs.ExportGraphicsLayerArgs}","description":"Exports graphics layer.","isHyperlinkable":!1,"visibility":"public"}},{"name":"HideAllCoordinates","metadata":{"arguments":"none","description":"Hides all plotted Coordinates temporarily.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideCoordinates","metadata":{"arguments":"string|string[]","description":"Hides one or many plotted Coordinates temporarily.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideCoordinateActions","metadata":{"arguments":"none","description":"Hide any coordinate actions view that is currently open.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SignIn","metadata":{"arguments":"string","description":"Navigates to the sign-in page. The sign in experience can be customized by crafting a custom sign-in URL, otherwise the default sign-in URL for the site will be used.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SignOut","metadata":{"arguments":"string","description":"Navigates to the sign-out page, which will sign the current user out.","isHyperlinkable":!0,"visibility":"public"}},{"name":"LogOptimizerEvent","metadata":{"arguments":"string, string","description":"Logs an event for Geocortex Optimizer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddPushpin","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Creates and displays a pushpin for the Feature specified.","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddPushpins","metadata":{"arguments":"string","description":"Creates and displays pushpins for the FeatureSetCollection specified.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemovePushpin","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Removes the pushpin from the map for the given feature, if there is one.","isHyperlinkable":!0,"visibility":"private"}},{"name":"RemovePushpins","metadata":{"arguments":"none","description":"Removes all pushpins from the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EnablePushpins","metadata":{"arguments":"none","description":"Enables the display of pushpins/markers on the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisablePushpins","metadata":{"arguments":"none","description":"Disables the display of pushpins/markers on the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowPushpins","metadata":{"arguments":"none","description":"Displays pushpins by setting their visibility to true, for each result in the results list or results table.  Pushpins must be enabled for this command to work.","isHyperlinkable":!0,"visibility":"public"}},{"name":"StopFeaturePlacementState","metadata":{"arguments":"none","description":"Cancels any feature placement while a feature is being created or edited.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HidePushpins","metadata":{"arguments":"none","description":"Prevents the display of pushpins by setting their visibility to false.  Pushpins must be enabled for this command to work.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetCollectionOfInterest","metadata":{"arguments":"string","description":"Sets the FeatureSetCollection of interest that will be used to generate data for Charts.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowChartingView","metadata":{"arguments":"none","description":"Activates the charting view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisplayBufferOptions","metadata":{"arguments":"string","description":"Displays the Buffer Options dialog for the specified target command","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisplayChartById","metadata":{"arguments":"string","description":"Opens the specified chart in the charting view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveChartById","metadata":{"arguments":"string","description":"Removes the specified chart from the charting view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearCharts","metadata":{"arguments":"none","description":"Removes all charts from the charting view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearFeatureInformation","metadata":{"arguments":"none","description":"Used to 'reset' the information stored within RelatedFeatures (which features are currently open, etc.)","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisableMapClick","metadata":{"arguments":"none","description":"Prevents the commands configured to execute on map click from executing and also prevents the MapClickedEvent from firing.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisableMapTips","metadata":{"arguments":"none","description":"Disables the display of map tips on the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EnableAllLayersForIdentify","metadata":{"arguments":"none","description":"Enables all identifiable layers such that they participate in Identify operations","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisableAllLayersForIdentify","metadata":{"arguments":"none","description":"Disables all identifiable layers such that they do not participate in Identify operations","isHyperlinkable":!0,"visibility":"public"}},{"name":"EnableLayerForIdentify","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.identify.LayerDescriptor","description":"Enables the specified layer, if it's identifiable, such that it participates in Identify operations.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisableLayerForIdentify","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.identify.LayerDescriptor","description":"Disables the specified layer, if it's in the list of identifiable layers, such that it does not participate in Identify operations.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EnableMapClick","metadata":{"arguments":"none","description":"Enables all configured commands to execute on map click and also wires up the MapClickEvent to fire when the map is clicked.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EnableMapTips","metadata":{"arguments":"none","description":"Enables the display of map tips on the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideAllMapTips","metadata":{"arguments":"none","description":"Prevents the display of map tips by setting their visibility to `false`.  Map tips must be enabled for this command to work.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideMapTips","metadata":{"arguments":"none","description":"Prevents the display of map tips by setting their visibility to `false`, and suspends displaying map tips.  Map tips must be enabled for this command to work.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RestoreAllMapTips","metadata":{"arguments":"none","description":"Displays previously hidden map tips by setting their visibility to `true`.  Map tips must be enabled for this command to work.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowAllCoordinates","metadata":{"arguments":"none","description":"Shows all plotted coordinates (including temporarily hidden ones) on the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowCoordinates","metadata":{"arguments":"string|string[]","description":"Shows one or many plotted, hidden Coordinates on the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowMapTips","metadata":{"arguments":"none","description":"Displays previously hidden map tips by setting their visibility to `true`, and resumes displaying map tips.  Map tips must be enabled for this command to work.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleMouseCoordinates","metadata":{"arguments":"none","description":"Toggles the visibility of the mouse coordinates widget if present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SetTimeExtent","metadata":{"arguments":"esri.TimeExtent","description":"Sets the time extent for the map.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowShareView","metadata":{"arguments":"none","description":"Activates the share view","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShareOn","metadata":{"arguments":"string","description":"Shares the Viewer url on the specified platform","isHyperlinkable":!0,"visibility":"public"}},{"name":"ScreenReaderNarrate","metadata":{"arguments":"string","description":"If a user has screenreader software enabled, then the provided string is immediately spoken to them.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisableScreenReaderNarrate","metadata":{"arguments":"none","description":"Disables the 'ScreenReaderNarrate' command temporarily.","isHyperlinkable":!0,"visibility":"public"}},{"name":"EnableScreenReaderNarrate","metadata":{"arguments":"none","description":"Enables screen reader narration if it was previously disabled using DisableScreenReaderNarrate.","isHyperlinkable":!0,"visibility":"public"}},{"name":"BroadcastCurrentViewpoint","metadata":{"arguments":"string","description":"Broadcasts the viewers current viewpoint to the specified external component.","isHyperlinkable":!0,"visibility":"private"}},{"name":"UpdateStatus","metadata":{"arguments":"string","description":"Updates the message shown on the status indicator.","isHyperlinkable":!0,"visibility":"public"}},{"name":"UploadData","metadata":{"arguments":"none","description":"Prompt the user to upload layers onto the map straight from their own computer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowExternalComponentView","metadata":{"arguments":"none","description":"Activates the external component view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisplayDockedExternalComponentById","metadata":{"arguments":"string","description":"Opens the specified external component in the external components view. If this component is open in a separate window, it will be closed.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DisplayUndockedExternalComponentById","metadata":{"arguments":"string","description":"Opens the specified external component in a separate window from the viewer. If this component is open in the viewer, it will be closed.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveExternalComponentById","metadata":{"arguments":"string","description":"Removes the specified external component from the viewer. If the component is in a separate window, that window will be closed.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ToggleExternalComponentSyncById","metadata":{"arguments":"string","description":"Toggle whether the specified external component is synchronized with the viewer.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ListenToExternalComponentFrame","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.integration.ComponentFrameInfo","description":"Wires up a PostMessage Transport and enables bi-directional communication with the component.","isHyperlinkable":!0,"visibility":"private"}},{"name":"CreateOrEditFeatureFromBarcodeScan","metadata":{"arguments":"object","description":"Launch the barcode scanner, and use the result to create a new feature or edit an existing one.","isHyperlinkable":!0,"visibility":"public"}},{"name":"LaunchBarcodeScannerWithCallback","metadata":{"arguments":"none","description":"Lauches a QR scan, then calls the provided callback with the result.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowMarkers","metadata":{"arguments":"none","description":"Displays markers by setting their visibility to `true`.","isHyperlinkable":!0,"visibility":"private"}},{"name":"HideMarkers","metadata":{"arguments":"none","description":"Prevents the display of markers by setting their visibility to `false`.","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddMarker","metadata":{"arguments":"string","description":"Creates and displays a marker on the map.","isHyperlinkable":!0,"visibility":"private"}},{"name":"RemoveMarker","metadata":{"arguments":"string","description":"Removes the marker from the map.","isHyperlinkable":!0,"visibility":"private"}},{"name":"UpdateMarker","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.MarkerArgs","description":"Updates the marker with the given marker arguments.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ShowAccessibilityView","metadata":{"arguments":"none","description":"Activates the accessibility view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddClusterLayer","metadata":{"arguments":"string","description":"Adds a cluster layer to an existing Geocortex Layer that holds an Esri FeatureLayer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveClusterLayer","metadata":{"arguments":"string","description":"Removes a cluster layer from an existing Geocortex Layer that holds an Esri FeatureLayer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddHeatMap","metadata":{"arguments":"string","description":"Adds a heat map visualization to a given Geocortex layer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Redo","metadata":{"arguments":"none","description":"Reverses the last recorded undo operation or transaction.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveHeatMap","metadata":{"arguments":"string","description":"Removes a heat map visualization from a Geocortex layer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveVisualization","metadata":{"arguments":"string","description":"Removes the visualization from a Geocortex layer, if one is enabled.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowVisualizationView","metadata":{"arguments":"string","description":"Shows the visualization options view for a given Geocortex layer if the layer supports any visualizations.","isHyperlinkable":!0,"visibility":"public"}},{"name":"Undo","metadata":{"arguments":"none","description":"Invokes the last recorded undo operation or transaction.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CreateGraphicsInMemory","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs","description":"Creates new graphics. These edits are only applied to the graphics layer in memory.","isHyperlinkable":!0,"visibility":"private"}},{"name":"UpdateGraphicsInMemory","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.UpdateGraphicsArgs","description":"Updates existing graphics. These edits are only applied to the graphics layer in memory.","isHyperlinkable":!0,"visibility":"private"}},{"name":"DeleteGraphicsInMemory","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs","description":"Deletes graphics. These edits are only applied to the graphics layer in memory.","isHyperlinkable":!0,"visibility":"private"}},{"name":"CutGraphicsInMemory","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.CutGraphicsArgs","description":"Cut graphics using a polyline. These edits are only applied to the graphics layer in memory.","isHyperlinkable":!0,"visibility":"private"}},{"name":"ExplodeGraphicsInMemory","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs","description":"Separates multi-part graphics into individual graphics. These edits are only applied to the graphics layer in memory.","isHyperlinkable":!0,"visibility":"private"}},{"name":"UnionGraphicsInMemory","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.EditInMemoryArgs","description":"Merge graphics into a single graphic. These edits are only applied to the graphics layer in memory.","isHyperlinkable":!0,"visibility":"private"}},{"name":"DeleteProject","metadata":{"arguments":"string","description":"Deletes a project.","isHyperlinkable":!0,"visibility":"public"}},{"name":"LoadProject","metadata":{"arguments":"string","description":"Loads a project and applies it to the viewer.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ListSelections","metadata":{"arguments":"none","description":"List the available selections.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RefreshProjectsList","metadata":{"arguments":"none","description":"Refresh the list of browsable projects.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RegisterChartPointAdapter","metadata":{"arguments":"object","description":"Register the chart point adapter.","isHyperlinkable":!0,"visibility":"private"}},{"name":"SaveAsProject","metadata":{"arguments":"none","description":"Displays the user interface to fill in details about a project to be saved.","isHyperlinkable":!0,"visibility":"public"}},{"name":"SaveProject","metadata":{"arguments":"none","description":"Save the current state of the viewer as a project or displays the user interface to fill in details about the project to be saved.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowProjectEditor","metadata":{"arguments":"string","description":"Shows the user interface for editing a project.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowProjects","metadata":{"arguments":"none","description":"Shows the user interface for browsing and loading projects.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowShareProject","metadata":{"arguments":"string","description":"Shows the user interface for sharing projects.","isHyperlinkable":!0,"visibility":"public"}},{"name":"HideFeatureDetails","metadata":{"arguments":"none","description":"Hides the Feature Details dialog.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowSaveSelectionDialog","metadata":{"arguments":"string","description":"Displays a dialog to save a FeatureSetCollection as a named selection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CreateSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs","description":"Creates a new named, saved selection based on the supplied FeatureSetCollection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"DeleteSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs","description":"Deletes a named selection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"FindSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindSelectionArgs","description":"Looks up a particular named selection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RenameSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.RenameSelectionArgs","description":"Assigns a new name to a saved selection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RestoreSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs","description":"Loads a named, saved selection into the results view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"UpdateSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.SelectionArgs","description":"Updates an existing named, saved selection with the supplied FeatureSetCollection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowSelection","metadata":{"arguments":"none","description":"If there is only a single saved selection, populates this in the results view. Otherwise the saved selection picker is displayed.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddFeatureToStarredSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Add the supplied feature to the 'starred' (default) selected set, if it is not already present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveFeatureFromStarredSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Removes the supplied feature from the 'starred' (default) selected set.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddFeatureSetToStarredSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSet","description":"Adds all features from the supplied FeatureSet to the 'starred' or default selection, if they are not already present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveFeatureSetFromStarredSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSet","description":"Removes all features in the supplied FeatureSet from the 'starred' or default selection, if they are present.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ClearStarredSelection","metadata":{"arguments":"none","description":"Removes all features from the 'starred' (default) selection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowStarredSelection","metadata":{"arguments":"none","description":"Displays the 'starred' or default selection in the results view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"UpdateSelectionFindAllSelectionMetadata","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindAllSelectionMetadataArgs","description":"Lists all the available metadata for named selections.","isHyperlinkable":!0,"visibility":"private"}},{"name":"FindMetadataForSelection","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.FindMetadataForSelectionArgs","description":"Looks up metadata about a particular named selection.","isHyperlinkable":!0,"visibility":"private"}},{"name":"AddFeatureToResults","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Adds an individual feature to the current FeatureSetCollection displayed in the results view at the specified index.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddFeatureToResultsAtIndex","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.AddFeatureToResultsAtIndexArgs","description":"Adds an individual feature to the current FeatureSetCollection displayed in the results view at specified index in the featureSet.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveFeatureFromResults","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Removes an individual feature from the current FeatureSetCollection displayed in the results view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CombineResults","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.CombineResultsArgs","description":"Performs advanced set operations with multiple lists of results.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CombineResultsInteractive","metadata":{"arguments":"object","description":"Performs advanced set operations with multiple lists of results.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ResultsIntersect","metadata":{"arguments":"string","description":"Only keeps results from the current set of results that also appear in the supplied FeatureSetCollection.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ResultsReplace","metadata":{"arguments":"string","description":"Replaces the current set of results with the FeatureSetCollection supplied as argument.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ResultsSubtract","metadata":{"arguments":"string","description":"Removes the supplied FeatureSetCollection from the current set of results.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ResultsUnion","metadata":{"arguments":"string","description":"Adds the supplied FeatureSetCollection to the current set of results.","isHyperlinkable":!0,"visibility":"public"}},{"name":"AddResultsStatus","metadata":{"arguments":"string","description":"Displays a status indicator that can relay short messages in the results list or table.","isHyperlinkable":!0,"visibility":"public"}},{"name":"RemoveResultsStatus","metadata":{"arguments":"none","description":"Removes the status indicator from the results list or table.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowCopyDialogForEvent","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.collaboration.RestEvent","description":"Opens the Collaboration event copy view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenCollaboration","metadata":{"arguments":"none","description":"Opens the Collaboration view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"OpenAfterActionPlayback","metadata":{"arguments":"none","description":"Opens the After Action Playback view.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowEditCollaborationGraphicMessageView","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":"Edit the associated message for a collaboration event using one of its drawn features.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ShowEditCollaborationMessageView","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.collaboration.RestEvent","description":"Edit the associated message for a collaboration event using its rest event","isHyperlinkable":!0,"visibility":"public"}},{"name":"AutoJoinCollaborationRoom","metadata":{"arguments":"string","description":"Add a collaboration room to the auto join list.","isHyperlinkable":!0,"visibility":"public"}},{"name":"ApplyEdits","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.commandArgs.ApplyEditsArgs","description":"Applies edits to features. It can include additions, updates and deletions.","isHyperlinkable":!1,"visibility":"public"}},{"name":"UnionFeaturesInteractive","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.FeatureSet","description":"Presents a user interface showing list of features to be unioned allowing user to pick master feature.","isHyperlinkable":!0,"visibility":"public"}},{"name":"CutFeatureInteractive","metadata":{"arguments":"essentialsHtmlViewer.mapping.infrastructure.Feature","description":" Presents a user interface guiding user to draw cut polyline to cut a feature.","isHyperlinkable":!0,"visibility":"public"}}],e.metadataForCommandName=function(t){for(var i=0;i<e.commandsMetadata.length;i++){var r=e.commandsMetadata[i];if(r.name===t)return r.metadata}return null},e.publicCommands=function(){for(var t=[],i=0;i<e.commandsMetadata.length;i++){var r=e.commandsMetadata[i];"public"===r.metadata.visibility&&t.push(r)}return t}}(e.Commands||(e.Commands={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=[],i=!1,r=function(){function r(e){this._debounceInterval=250,this._flags=0,this._app=e}return r.prototype.hasFlag=function(e){return(this._flags&e)===e},r.prototype.setFlag=function(e){this._flags|=e},r.prototype.screenUris=function(t){this._siteValidator||(this._siteValidator=new e.validation.SiteUrlValidator(this._app));for(var i=[],r=0,n=t;r<n.length;r++){var a=n[r];a.uri;a.uri=this._screenDataUri(a.uri),null!==a.uri?i.push(a):this._app.trace.debug("Skipped unknown, untrusted data URI.")}return this._validateUris(i)},r.prototype.tryScreenNavLinkSynchronously=function(e){if(!this._siteValidator)return!1;var t=this._siteValidator.tryValidateSynchronously(e.uri);return t||(this._getMemoizedResult(e)||!1)},r.prototype._validateUris=function(t){var i=this,r=[],n=[];return n=t.map(function(t){return new Promise(function(n,a){var s=t.uri;if(i.hasFlag(2)&&t.type===e.FilterUtils.UriType.Markup){var o=t;if("img"===o.tag&&"src"===o.attribute)return n(t)}return i._validateUriAgainstSite(t).then(function(i){return null==i.validatedValue||""===i.validatedValue?(t.uri=s,r.push(t),n(null)):(t.type===e.FilterUtils.UriType.NavigableLink&&t.forcePrompt&&r.push(t),n(t))},function(e){return t.uri=s,r.push(t),n(t)})})}),Promise.all(n).then(function(){return i._promptForUris(r)}).then(function(){return t})},r.prototype._validateUriAgainstSite=function(e){if(!this._siteValidator){e.uri="";var t={validatedValue:null};return Promise.resolve(t)}return this._siteValidator.validate(e.uri)},r.prototype._promptForUris=function(e){var t=this;return Promise.map(e,function(e,i){return new Promise(function(i,r){t._enqueueConfirmation({uriDetails:e,resolve:i})})})},r.prototype._enqueueConfirmation=function(e){t.push(e),this._processConfirmationQueue()},r.prototype._processConfirmationQueue=function(){if(!i){i=!0;try{for(;t.length;){var e=t.shift();if(this._getConfirmation(e))return}}catch(e){throw i=!1,e}i=!1}},r.prototype._getConfirmation=function(t){var r=this;if(!t.uriDetails.forcePrompt&&this.hasFlag(1))return t.resolve(t.uriDetails),!1;var n=t.uriDetails.type===e.FilterUtils.UriType.NavigableLink,a=this._getMemoizedResult(t.uriDetails);if(n||!0!==a){if(n||!1!==a){var s=function(e){i=!1,r._memoizeResult(t.uriDetails,e),!0===e?t.resolve(t.uriDetails):(t.uriDetails.uri="",t.resolve(t.uriDetails));try{if(n){var a=t.uriDetails.linkChallengeCallback;a&&a(e,t.uriDetails)}}finally{r._processConfirmationQueue()}},o={okLabel:this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-accept-btn"),cancelLabel:this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-reject-btn")},l=this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-title"),c=this._app.getResource("Mapping.Infrastructure","language-content-policy-prompt-uri-desc");return c=c.format(t.uriDetails.uri),this._app.command("Confirm").canExecute(c,l,s,o)?(this._app.command("Confirm").execute(c,l,s,o),!0):(s(window.confirm(c)),!1)}return t.uriDetails.uri="",t.resolve(t.uriDetails),!1}return t.resolve(t.uriDetails),!1},r.prototype._getMemoizationKey=function(t){var i;i=this.hasFlag(4)?e.UrlUtils.parseUrl(t.uri):e.UrlUtils.getFolder(t.uri);var r=String.quickHashCode(i.toString());return"uri."+e.FilterUtils.UriType[t.type].toLowerCase()+"."+r},r.prototype._memoizeResult=function(e,t){var i=this._getMemoizationKey(e);window.localStorage.setItem(i,t.toString())},r.prototype._getMemoizedResult=function(e){var t=this._getMemoizationKey(e),i=window.localStorage.getItem(t);return null===i?null:"true"===i},r.prototype._screenDataUri=function(t){var i=!!e.FilterUtils.DataUri.parseDataUri(t),r=e.FilterUtils.DataUri.isDataUriSafe(t);return!i||r?t:""},r}();e.ContentPolicy=r}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(e){var t=a[e];if(t)return t;throw new Error("Units cannot be converted because are not supported")}function r(e,t){return t/i(e)}function n(e,t){return t*i(e)}Math.PI;var a={};a[e.essentials.DistanceUnitType.METERS]=1,a[e.essentials.DistanceUnitType.MILLIMETERS]=.001,a[e.essentials.DistanceUnitType.CENTIMETERS]=.01,a[e.essentials.DistanceUnitType.DECIMETERS]=.1,a[e.essentials.DistanceUnitType.KILOMETERS]=1e3,a[e.essentials.DistanceUnitType.INCHES]=.0254,a[e.essentials.DistanceUnitType.FEET]=.3048,a[e.essentials.DistanceUnitType.US_SURVEY_FEET]=.3048006096012192,a[e.essentials.DistanceUnitType.YARDS]=.9144,a[e.essentials.DistanceUnitType.MILES]=1609.344,a[e.essentials.DistanceUnitType.NAUTICAL_MILES]=1852,a[e.essentials.DistanceUnitType.DEGREES]=111319.49079327357,a[e.essentials.DistanceUnitType.GRADS]=100187.54171394621,a[e.essentials.DistanceUnitType.RADIANS]=6378136.999999998,t.canConvert=function(t,i){var r=!1,n=!1;if(t===i)return!0;for(var a in e.essentials.DistanceUnitType)e.essentials.DistanceUnitType.hasOwnProperty(a)&&(e.essentials.DistanceUnitType[a]===t?r=!0:e.essentials.DistanceUnitType[a]===i&&(n=!0));return n&&r},t.convert=function(e,t,i){return t&&e!==i?r(e,n(i,t)):t}}(t.distances||(t.distances={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){e.id&&(this.id=e.id)},e}();e.AccessibilityProviderBase=t}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.MOUSE="mouse",e.KEYBOARD="keyboard",e}();e.InputMethod=t}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){}return t.translate=function(e,t,i,r){if(!e||!t)return null;switch(e.type){case"point":var n=t.toScreen(e);e=t.toMap(n.offset(i,r));break;case"polyline":e=this._applyOffset(e,e.paths,i,r,t);break;case"polygon":e=this._applyOffset(e,e.rings,i,r,t)}return{geometry:e,transform:dojox.gfx.matrix.translate(i,r)}},t.rotate=function(e,t,i,r){if(!e||!t)return null;var n=r||this.getCentroid(e),a=dojox.gfx.matrix.rotategAt(-i,n.x,n.y);switch(e.type){case"polyline":e=this._applyTransform(e,e.paths,a);break;case"polygon":e=this._applyTransform(e,e.rings,a)}var s=t.toScreen(n);return{geometry:e,transform:dojox.gfx.matrix.rotategAt(-i,s.x,s.y)}},t.scale=function(e,t,i,r){if(void 0===r&&(r=null),!e||!t)return null;(isNaN(i)||1/0===i||-1/0===i)&&(i=1),null!==r&&void 0!==r||(r=i);var n=this.getCentroid(e),a=dojox.gfx.matrix.scaleAt(i,r,n.x,n.y);switch(e.type){case"polyline":e=this._applyTransform(e,e.paths,a);break;case"polygon":e=this._applyTransform(e,e.rings,a)}var s=t.toScreen(n);return{geometry:e,transform:dojox.gfx.matrix.scaleAt(i,r,s.x,s.y)}},t.getCentroid=function(t){if(!t||!t.type||!e.GeometryUtils.isValidGeometry(t))return null;var i;switch(t.type){case"point":return t;case"multipoint":case"polyline":case"polygon":if(i=t.getExtent())return i.getCenter();case"extent":return t.getCenter()}return null},t._applyOffset=function(e,t,i,r,n){if(e&&t)for(var a=e.getPoint(0,0),s=n.toMap(n.toScreen(a).offset(i,r)),o=s.x-a.x,l=s.y-a.y,c=0;c<t.length;c++)for(var u=0;u<t[c].length;u++){var p=e.getPoint(c,u);e.setPoint(c,u,p.offset(o,l))}return e},t._applyTransform=function(e,t,i){if(e&&t)for(var r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++){var a=e.getPoint(r,n),s=dojox.gfx.matrix.multiplyPoint(i,a.x,a.y);a.setX(s.x),a.setY(s.y),e.setPoint(r,n,a)}return e},t}();e.MatrixUtils=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,i){this.owner=null,this.graphic=null,this.map=null,this.suspended=!1,this.graphic=e,this.map=t,this.owner=i}return e.prototype.destroy=function(){this.suspended=!1,this.graphic=this.map=this.owner=null},e.prototype.refresh=function(e){void 0===e&&(e=!1)},e.prototype.suspend=function(){this.suspended=!0},e.prototype.resume=function(){this.suspended=!1},e}();e.EditCapabilityBase=t}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(i){function r(e,t,r,n){i.call(this,e,t,r),this._keyDownHandle=null,this._keyUpHandle=null,this._keyDx=0,this._keyDy=0,this._transform=null,this._isMoving=!1,this._isActive=!1,this._vertexControls=null,this._midpointControls=null,this._allControls=null,this._selectedControl=null,this._vertexHandleGraphic=null,this._options={offsetX:10,offsetY:10,preciseOffsetX:1,preciseOffsetY:1,allowAddVertices:!0,allowDeleteVertices:!0},this._snappingInputMovedToken=null,this._options=dojo.mixin(this._options,n||{}),this._init(),this.owner&&this.owner.app&&(this._snappingInputMovedToken=this.owner.app.event("SnappingFeedbackEvent").subscribe(this,this._handleSnappingInputMovedEvent))}return __extends(r,i),r.create=function(e,i,r,n){if(!e||!e.geometry)return null;switch(e.geometry.type){case"multipoint":return new t.MultipointVertexEditor(e,i,r,n);case"polyline":return new t.PolylineVertexEditor(e,i,r,n);case"polygon":return new t.PolygonVertexEditor(e,i,r,n)}return null},r.prototype._handleSnappingInputMovedEvent=function(e){e&&e.snappingPoint&&this.graphic&&this.getSelectedVertex()&&this._vertexHandleGraphic&&this._vertexHandleGraphic.visible&&(this._updateGraphicVertex(e.snappingPoint,this.getSelectedVertex().segmentIndex,this.getSelectedVertex().pointIndex),this.owner.refresh())},r.prototype.isActive=function(){return this._isActive},r.prototype.hideVertexHandle=function(){this._vertexHandleGraphic&&(this._vertexHandleGraphic.hide(),this.owner&&this.owner.app&&this.owner.app.event("VertexHandleHiddenEvent").publish())},r.prototype.showVertexHandle=function(){if(this._selectedControl){var e=this._selectedControl.point.offset(0,0);this._vertexHandleGraphic?(this._vertexHandleGraphic.setGeometry(e).setSymbol(this._options.selectedVertexSymbol),this._vertexHandleGraphic.show()):this._vertexHandleGraphic=this.map.graphics.add(new esri.Graphic(e,this._options.selectedVertexSymbol)),this.owner&&this.owner.app&&this.owner.app.event("VertexHandleShownEvent").publish(e);var t=this._vertexHandleGraphic.getDojoShape();t&&t.moveToFront()}},r.prototype.destroy=function(){this._cleanUp(),i.prototype.destroy.call(this)},r.prototype.refresh=function(e){void 0===e&&(e=!1),this._transform=null,e?(this._removeControllers(),this._addControllers()):this._refreshControllers()},r.prototype.getSelectedVertex=function(){return this._selectedControl},r.prototype.onVertexAdd=function(e){if(e&&e.segmentIndex===this._selectedControl.segmentIndex){var t=null,i=this._selectedControl.segmentIndex,r=this._selectedControl.pointIndex;this._selectedControl.isGhost?(t=this._midpointControls,e.pointIndex<r+1?r+=1:e.pointIndex===r+1&&(r=e.pointIndex,t=this._vertexControls)):(t=this._vertexControls,r+=e.pointIndex<=r?1:0),this._selectedControl=t[i][r]}},r.prototype.onVertexDelete=function(e){if(e&&e.segmentIndex===this._selectedControl.segmentIndex){var t=null,i=this._selectedControl.segmentIndex,r=this._selectedControl.pointIndex;this._selectedControl.isGhost?(t=this._midpointControls,r-=e.pointIndex<=r?1:0):(t=this._vertexControls,r-=e.pointIndex<=r&&r>0?1:0),this._selectedControl=t[i][r]}},r.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler"))},r.prototype._cleanUp=function(){this._isMoving=this._isActive=!1,this._transform=null,this._selectedControl=null,this._removeControllers(),this._vertexHandleGraphic&&(this.map.graphics.remove(this._vertexHandleGraphic),this._vertexHandleGraphic=null),this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null),this.owner.app&&this.owner.app&&this._snappingInputMovedToken&&this.owner.app.event("SnappingFeedbackEvent").unsubscribe(this._snappingInputMovedToken)},r.prototype._getSegments=function(e){throw new Error("This method is abstract")},r.prototype._getMidpointSegments=function(e){throw new Error("This method is abstract")},r.prototype._updatePoints=function(e){throw new Error("This method is abstract")},r.prototype._insertGraphicVertex=function(e,t,i){throw new Error("This method is abstract")},r.prototype._updateGraphicVertex=function(e,t,i){throw new Error("This method is abstract")},r.prototype._deleteGraphicVertex=function(e,t){throw new Error("This method is abstract")},r.prototype._findVertex=function(t,i){for(var r=i?i.length:0,n=0;n<r;n++)for(var a=i[n],s=0;s<a.length;s++){var o=a[s];if(o&&e.GeometryUtils.pointsAreEqual(o.point,t))return o}return null},r.prototype._addControllers=function(){var e=this;this._vertexControls=this._add(this._getSegments(this.graphic.geometry)),this._options.allowAddVertices&&(this._midpointControls=this._add(this._getMidpointSegments(this.graphic.geometry),!0)),this._allControls=[],this._vertexControls.forEach(function(t,i){t.forEach(function(t,r){e._allControls.push(t),e._midpointControls&&e._midpointControls[i]&&r<e._midpointControls[i].length&&e._allControls.push(e._midpointControls[i][r])})})},r.prototype._removeControllers=function(){this._remove(this._vertexControls),this._remove(this._midpointControls),this._vertexControls=this._midpointControls=this._allControls=null},r.prototype._refreshControllers=function(){this._refresh(this._vertexControls,this._getSegments(this.graphic.geometry)),this._options.allowAddVertices&&this._refresh(this._midpointControls,this._getMidpointSegments(this.graphic.geometry),!0)},r.prototype._add=function(e,t){void 0===t&&(t=!1);for(var i=[],r=0;r<e.length;r++){for(var n=e[r],a=[],s=0;s<n.length;s++)a.push({isGhost:t,segmentIndex:r,pointIndex:s,point:n[s]});i.push(a)}return i},r.prototype._remove=function(e){e&&(e.forEach(function(e){e.length=0}),e.length=0)},r.prototype._refresh=function(e,t,i){void 0===i&&(i=!1),e&&t&&e.forEach(function(e,i){e.forEach(function(e,r){e.point=t[i][r]})})},r.prototype._previous=function(){var e=this._allControls.indexOf(this._selectedControl);this._selectedControl=0==e?this._allControls[this._allControls.length-1]:this._allControls[e-1],this.showVertexHandle(),this._refreshControllers()},r.prototype._next=function(){var e=this._allControls.indexOf(this._selectedControl);this._selectedControl=this._allControls[(e+1)%this._allControls.length],this.showVertexHandle(),this._refreshControllers()},r.prototype._onKeyDownHandler=function(e){this.suspended||(this._isActive?this._onKeyDownWhenActive(e):86===(e.keyCode||e.which)&&(e.preventDefault(),e.stopImmediatePropagation(),this._isActive=!0,this.owner.suspend(),this.resume(),this._addControllers(),this._selectedControl=this._vertexControls[0][0],this.showVertexHandle()))},r.prototype._onKeyDownWhenActive=function(e){var t=e.altKey,i=t?this._options.preciseOffsetX:this._options.offsetX,r=t?this._options.preciseOffsetY:this._options.offsetY;switch(e.keyCode||e.which){case 86:return e.preventDefault(),e.stopImmediatePropagation(),void(e.shiftKey?this._previous():this._next());case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:return e.preventDefault(),e.stopImmediatePropagation(),this.owner.resume(),this._isActive=this._isMoving=!1,this._selectedControl=null,void(this._vertexHandleGraphic&&(this.hideVertexHandle(),this.map.graphics.remove(this._vertexHandleGraphic),this._vertexHandleGraphic=null));case 68:return void(this._options.allowDeleteVertices&&(this._delete(this.getSelectedVertex()),e.preventDefault(),e.stopImmediatePropagation()));case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:this._keyDy-=r;break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:this._keyDx+=i;break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:this._keyDy+=r;break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:this._keyDx-=i;break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:this._keyDx+=i,this._keyDy-=r;break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:this._keyDx+=i,this._keyDy+=r;break;case dojo.keys.END:case dojo.keys.NUMPAD_1:this._keyDx-=i,this._keyDy+=r;break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:this._keyDx-=i,this._keyDy-=r;break;default:return}e.preventDefault(),e.stopImmediatePropagation(),this._move(this.getSelectedVertex(),this._keyDx,this._keyDy),this._moveStop(this.getSelectedVertex(),this._keyDx,this._keyDy),this._keyDx=this._keyDy=0},r.prototype._move=function(e,t,i){var r={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex};this._isMoving||(this._isMoving=!0,this.owner.onVertexMoveStart(this.graphic,r),this.owner.onVertexFirstMove(this.graphic,r));var n=this.map.toScreen(e.point).offset(t,i);this._vertexHandleGraphic.setGeometry(this.map.toMap(n)),this.owner.onVertexMove(this.graphic,r,this._transform);var a={sender:this,mapPoint:this.map.toMap(n),screenPoint:n};this._raiseEditVertexMoved(a)},r.prototype._raiseEditVertexMoved=function(e){this.owner&&this.owner.app&&this.owner.app.event("EditVertexMovedEvent").publish(e)},r.prototype._moveStop=function(t,i,r){if(this._isMoving=!1,t&&t.point){var n={isGhost:t.isGhost,pointIndex:t.pointIndex,segmentIndex:t.segmentIndex},a=e.MatrixUtils.translate(t.point,this.map,i,r);this._transform=a.transform,n.isGhost?(n.pointIndex+=1,this._insertGraphicVertex(a.geometry,n.segmentIndex,n.pointIndex)):this._updateGraphicVertex(a.geometry,n.segmentIndex,n.pointIndex),this.owner.refresh(),this.owner.onVertexMoveStop(this.graphic,n,this._transform),n.isGhost&&(n.isGhost=!1,this.owner.onVertexAdd(this.graphic,n))}},r.prototype._delete=function(e){if(e&&!e.isGhost){var t={isGhost:e.isGhost,pointIndex:e.pointIndex,segmentIndex:e.segmentIndex};this._deleteGraphicVertex(e.segmentIndex,e.pointIndex),this.owner.refresh(),this.owner.onVertexDelete(this.graphic,t)}},r}(t.EditCapabilityBase);t.VertexEditor=i}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._getSegments=function(e){for(var t=0,i=[];t<e.points.length;t++)i.push(e.getPoint(t));return[i]},t.prototype._getMidpointSegments=function(e){return[]},t.prototype._insertGraphicVertex=function(e,t,i){},t.prototype._updateGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.setPoint(i,e.offset(0,0)),this.graphic.setGeometry(r)},t.prototype._deleteGraphicVertex=function(e,t){var i=this.graphic.geometry;i.removePoint(t),this.graphic.setGeometry(i)},t}(e.VertexEditor);e.MultipointVertexEditor=t}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype._getSegments=function(e){for(var t=[],i=0;i<e.rings.length;i++){for(var r=e.rings[i].length,n=[],a=0;a<r-1;a++)n.push(e.getPoint(i,a));t.push(n)}return t},i.prototype._getMidpointSegments=function(t){for(var i=[],r=0;r<t.rings.length;r++){for(var n=t.rings[r].length,a=[],s=0;s<n-1;s++){var o=t.getPoint(r,s),l=t.getPoint(r,s+1),c=e.GeometryUtils.getMidpoint(o,l);a.push(c)}i.push(a)}return i},i.prototype._insertGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.insertPoint(t,i,e.offset(0,0)),this.graphic.setGeometry(r)},i.prototype._updateGraphicVertex=function(e,t,i){var r=this.graphic.geometry;if(r.setPoint(t,i,e.offset(0,0)),0===i){var n=r.rings[t];r.setPoint(t,n.length-1,e.offset(0,0))}this.graphic.setGeometry(r)},i.prototype._deleteGraphicVertex=function(e,t){var i=this.graphic.geometry;if(i.removePoint(e,t),0===t){var r=i.rings[e],n=i.getPoint(e,0);i.setPoint(e,r.length-1,n.offset(0,0))}this.graphic.setGeometry(i)},i}(t.VertexEditor);t.PolygonVertexEditor=i}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype._getSegments=function(e){for(var t=[],i=0;i<e.paths.length;i++){for(var r=e.paths[i].length,n=[],a=0;a<r;a++)n.push(e.getPoint(i,a));t.push(n)}return t},i.prototype._getMidpointSegments=function(t){for(var i=[],r=0;r<t.paths.length;r++){for(var n=t.paths[r].length,a=[],s=0;s<n-1;s++){var o=t.getPoint(r,s),l=t.getPoint(r,s+1),c=e.GeometryUtils.getMidpoint(o,l);a.push(c)}i.push(a)}return i},i.prototype._insertGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.insertPoint(t,i,e.offset(0,0)),this.graphic.setGeometry(r)},i.prototype._updateGraphicVertex=function(e,t,i){var r=this.graphic.geometry;r.setPoint(t,i,e.offset(0,0)),this.graphic.setGeometry(r)},i.prototype._deleteGraphicVertex=function(e,t){var i=this.graphic.geometry;i.removePoint(e,t),this.graphic.setGeometry(i)},i}(t.VertexEditor);t.PolylineVertexEditor=i}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this._registeredComponentTypes={"esri.toolbars.draw":"esri.toolbars.Draw","esri.toolbars.edit":"esri.toolbars.Edit","geocortex.accessibility.draw":"geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Draw","geocortex.accessibility.edit":"geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Edit"},this._stack=[],this.app=e,this.app.event("AccessibleComponentStartedEvent").subscribe(this,this._handleAccessibleComponentStarted),this.app.event("AccessibleComponentCompletedEvent").subscribe(this,this._handleAccessibleComponentCompleted)}return e.prototype.registerComponent=function(e,t){if(null==e||null==t)throw new Error("[AccessibilityManager::registerComponent] Null name or typeName passed to registerComponent");this._registeredComponentTypes[e]=t},e.prototype.unregisterComponent=function(e){return!(!e||!this._registeredComponentTypes.hasOwnProperty(e))&&(delete this._registeredComponentTypes[e],!0)},e.prototype.createComponent=function(e,t,i){if(e&&this._registeredComponentTypes.hasOwnProperty(e)){var r=this._registeredComponentTypes[e],n=dojo.getObject(r);if(n)return new n(t,i,this.app);this.app.trace.warning("Could not create component '{0}' from type name '{1}'".format(e,r))}return null},e.prototype._handleAccessibleComponentStarted=function(e){if(e&&this._stack){var t=this._stack.indexOf(e);t>-1&&this._stack.splice(t,1),this._stack.forEach(function(e){return!e.suspended&&e.suspend()}),this._stack.push(e),e.resume()}},e.prototype._handleAccessibleComponentCompleted=function(e){if(e&&this._stack&&0!=this._stack.length){var t=this._stack.indexOf(e);t>-1&&(this._stack.splice(t,1),!e.suspended&&e.suspend()),this._stack.length>0&&this._stack[this._stack.length-1].resume()}},e}();e.AccessibilityManager=t}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(t,i){this.inputMethod=null,this.suspended=!1,this.isKeyboardActive=!1,this.id=e.framework.utils.alphaNumericToken(),this._map=null,this._mapNavState=null,this._mouseDownHandle=null,this._keyDownHandle=null,this._keyUpHandle=null,this.setMap(t),this.setApp(i)}return i.prototype.setMap=function(e){this._map=e},i.prototype.setApp=function(e){this.app=e},i.prototype.setInputMethod=function(e){if(e!==this.inputMethod){var t=this.inputMethod;this.inputMethod=e,this.onInputMethodChange({previousMethod:t,newMethod:this.inputMethod})}},i.prototype.setKeyboardActive=function(e){this.isKeyboardActive=e},i.prototype.suspend=function(){this.suspended=!0},i.prototype.resume=function(){this.suspended=!1},i.prototype.disableMapNavigation=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!0);var r=this._map;return this._mapNavState={isDoubleClickZoom:r.isDoubleClickZoom,isClickRecenter:r.isClickRecenter,isPan:r.isPan,isRubberBandZoom:r.isRubberBandZoom,isKeyboardNavigation:r.isKeyboardNavigation,isScrollWheelZoom:r.isScrollWheelZoom,isShiftDoubleClickZoom:r.isShiftDoubleClickZoom,isPanArrows:r.isPanArrows,isZoomSlider:r.isZoomSlider},r.disableDoubleClickZoom(),r.disableClickRecenter(),r.disablePan(),r.disableRubberBandZoom(),r.disableKeyboardNavigation(),r.disableScrollWheelZoom(),r.disableShiftDoubleClickZoom(),e&&r.isZoomSlider&&r.hideZoomSlider(),t&&r.isPanArrows&&r.hidePanArrows(),i&&r.graphics.disableMouseEvents(),this._mapNavState},i.prototype.enableMapNavigation=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!0);var n=this._map,a=r||this._mapNavState;a&&(a.isDoubleClickZoom&&n.enableDoubleClickZoom(),a.isClickRecenter&&n.enableClickRecenter(),a.isPan&&n.enablePan(),a.isRubberBandZoom&&n.enableRubberBandZoom(),a.isKeyboardNavigation&&n.enableKeyboardNavigation(),a.isScrollWheelZoom&&n.enableScrollWheelZoom(),a.isShiftDoubleClickZoom&&n.enableShiftDoubleClickZoom(),e&&a.isZoomSlider&&n.showZoomSlider(),t&&a.isPanArrows&&n.showPanArrows(),i&&n.graphics.enableMouseEvents())},i.prototype.getMapState=function(){return this._mapNavState},i.prototype.activateMouseControls=function(e){var i=this;void 0===e&&(e=!0),this.deactivateMouseControls(e),this._mouseDownHandle=this.app.map.on("mouse-down",function(){i._mouseDownHandle.remove(),i._mouseDownHandle=null,i.setInputMethod(t.InputMethod.MOUSE)})},i.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),this._mouseDownHandle&&(this._mouseDownHandle.remove(),this._mouseDownHandle=null),e&&this.inputMethod===t.InputMethod.MOUSE&&this.setInputMethod(null)},i.prototype.activateKeyboardControls=function(e){void 0===e&&(e=!0),this.isKeyboardActive&&this.deactivateKeyboardControls(e),this.setKeyboardActive(!0),this._keyDownHandle=dojo.on(this._map.root,"keydown",dojo.hitch(this,"_onKeyDown")),this._keyUpHandle=dojo.on(this._map.root,"keyup",dojo.hitch(this,"_onKeyUp")),this.app.event("AccessibleComponentStartedEvent").publish(this)},i.prototype.deactivateKeyboardControls=function(e){void 0===e&&(e=!0),this.setKeyboardActive(!1),this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null),e&&this.inputMethod===t.InputMethod.KEYBOARD&&this.setInputMethod(null),this.app.event("AccessibleComponentCompletedEvent").publish(this)},i.prototype.toggleKeyboardMode=function(){this.inputMethod===t.InputMethod.KEYBOARD?this.onKeyboardStop():this.onKeyboardStart()},i.prototype.onInputMethodChange=function(e){this.app.event("InputMethodChangedEvent").publish(e)},i.prototype.onKeyboardStart=function(){this._mouseDownHandle&&(this._mouseDownHandle.remove(),this._mouseDownHandle=null),this.setInputMethod(t.InputMethod.KEYBOARD)},i.prototype.onKeyboardStop=function(e){void 0===e&&(e=!1),this.setInputMethod(null)},i.prototype._onKeyDown=function(e){},i.prototype._onKeyUp=function(e){},i}();t.AccessibleMapComponent=i}(t.accessibility||(t.accessibility={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(i){function r(e,t,r,n,a){i.call(this,e,t,r),this._options={rotateEnabled:!1,scaleEnabled:!1,uniformScaling:!1,rotationAngle:15,preciseRotationAngle:1,scaleFactor:.2,preciseScaleFactor:.01},this._scaleEnabled=!1,this._rotateEnabled=!1,this._uniformScaling=!1,this._isTextPoint=!1,this._modified=!1,this._isRotating=!1,this._isScaling=!1,this._lineSymbol=null,this._markerSymbol=null,this._transform=null,this._keyDownHandle=null,this._keyUpHandle=null,this._options=dojo.mixin(this._options,a||{});var s=r.getOptions();this._markerSymbol=this._options.boxHandleSymbol?this._options.boxHandleSymbol:s.boxHandleSymbol,this._lineSymbol=this._options.boxLineSymbol?this._options.boxLineSymbol:s.boxLineSymbol,this._scaleEnabled=!!this._options.scaleEnabled,this._rotateEnabled=!!this._options.rotateEnabled,this._uniformScaling=!!this._options.uniformScaling,this._isTextPoint=n,this._init()}return __extends(r,i),r.prototype.destroy=function(){i.prototype.destroy.call(this),this._cleanUp()},r.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler")),this._keyUpHandle=dojo.on(this.map.root,"keyup",dojo.hitch(this,"_onKeyUpHandler"))},r.prototype._cleanUp=function(){this._scaleEnabled=this._rotateEnabled=this._uniformScaling=this._isTextPoint=!1,this._isRotating=this._isScaling=this._modified=!1,this._lineSymbol=this._markerSymbol=this._transform=null,this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null)},r.prototype._onKeyDownHandler=function(e){if(!this.suspended){var t=e.altKey,i=e.shiftKey,r=!1,n=t?this._options.preciseScaleFactor:this._options.scaleFactor,a=t?this._options.preciseRotationAngle:this._options.rotationAngle,s=e.keyCode||e.which;if(this._scaleEnabled)switch(s){case 83:n=i?-1*n:n,this._scaleGraphic(1+n,1+n),r=!0}if(this._rotateEnabled)switch(s){case 82:a=i?-1*a:a,this._rotateGraphic(a),r=!0}r&&(e.preventDefault(),e.stopPropagation())}},r.prototype._onKeyUpHandler=function(e){if(!this.suspended){e.altKey;var t=e.keyCode||e.which,i=!1;if(this._scaleEnabled)switch(t){case 83:this._isScaling=!1,this.owner.onScaleStop(this.graphic,this._transform),i=!0}if(this._rotateEnabled)switch(t){case 82:this._isRotating=!1,this.owner.onRotateStop(this.graphic,this._transform),i=!0}i&&(e.preventDefault(),e.stopPropagation())}},r.prototype._rotateGraphic=function(i,r){this._isRotating||(this.owner.onRotateStart(this.graphic),this.owner.onRotateFirstMove(this.graphic),this._isRotating=!0);var n=this.graphic.geometry,a=r||t.GeometryUtils.getMiddle(n);if(t.GeometryUtils.isValidGeometry(n)&&!e.framework.utils.isNullOrUndefined(a)){var s=t.MatrixUtils.rotate(n,this.map,i,a);if(this._transform=s.transform,this._modified=!0,this._isTextPoint){var o=this.graphic.symbol;o.angle+=i,this.graphic.setSymbol(o)}else this.graphic.setGeometry(s.geometry);var l={transform:s.transform,angle:i,scaleX:1,scaleY:1,around:this.map.toScreen(a)};this.owner.refresh(),this.owner.onRotate(this.graphic,l)}},r.prototype._scaleGraphic=function(e,i){this._isScaling||(this.owner.onScaleStart(this.graphic),this.owner.onScaleFirstMove(this.graphic),this._isScaling=!0),null!==i&&void 0!==i||(i=e);var r=this.graphic.geometry,n=t.MatrixUtils.scale(r,this.map,e,i);if(this._transform=n.transform,this._modified=!0,this._isTextPoint){var a=this.graphic.symbol;a.font.setSize(Math.round(100*a.font.size*e)/100),this.graphic.setSymbol(a)}else this.graphic.setGeometry(n.geometry);var s={transform:n.transform,angle:0,scaleX:e,scaleY:i,around:null};this.owner.refresh(),this.owner.onScale(this.graphic,s)},r}(i.EditCapabilityBase);i.BoxEditor=r}(t.accessibility||(t.accessibility={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(t){function i(e,i,r,n,a){t.call(this,e,i,r),this._options={offsetX:10,offsetY:10,preciseOffsetX:1,preciseOffsetY:1},this._modified=!1,this._isMoving=!1,this._transform=null,this._textAnchor=null,this._keyDownHandle=null,this._keyUpHandle=null,this._options=dojo.mixin(this._options,a||{}),this._textAnchor=n,this._init()}return __extends(i,t),i.prototype.hasMoved=function(){return this._modified},i.prototype.destroy=function(){t.prototype.destroy.call(this),this._cleanUp()},i.prototype.refresh=function(e){void 0===e&&(e=!1),t.prototype.refresh.call(this,e),this.graphic&&(e||this._needsRefresh())&&(this._cleanUp(),this._init())},i.prototype._needsRefresh=function(){return null==this._keyDownHandle},i.prototype._init=function(){this._keyDownHandle=dojo.on(this.map.root,"keydown",dojo.hitch(this,"_onKeyDownHandler")),this._keyUpHandle=dojo.on(this.map.root,"keyup",dojo.hitch(this,"_onKeyUpHandler"))},i.prototype._cleanUp=function(){this._modified=!1,this._isMoving=!1,this._textAnchor=this._transform=null,this._keyDownHandle&&(this._keyDownHandle.remove(),this._keyDownHandle=null),this._keyUpHandle&&(this._keyUpHandle.remove(),this._keyUpHandle=null)},i.prototype._onKeyDownHandler=function(e){if(!this.suspended){var t=e.altKey,i=t?this._options.preciseOffsetX:this._options.offsetX,r=t?this._options.preciseOffsetY:this._options.offsetY,n=0,a=0;switch(e.keyCode||e.which){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:a=-1;break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:n=1;break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:a=1;break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:n=-1;break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:n=1,a=-1;break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:n=1,a=1;break;case dojo.keys.END:case dojo.keys.NUMPAD_1:n=-1,a=1;break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:n=-1,a=-1;break;default:return}this._moveGraphic(n*i,a*r),e.preventDefault(),e.stopPropagation()}},i.prototype._onKeyUpHandler=function(e){if(!this.suspended){e.altKey;switch(e.keyCode||e.which){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:case dojo.keys.END:case dojo.keys.NUMPAD_1:case dojo.keys.HOME:case dojo.keys.NUMPAD_7:this._isMoving=!1,this.map.enableMapNavigation(),this.owner.onGraphicMoveStop(this.graphic,this._transform);break;default:return}e.preventDefault(),e.stopPropagation()}},i.prototype._moveGraphic=function(t,i){this._isMoving||(this.owner.onGraphicMoveStart(this.graphic),this.owner.onGraphicFirstMove(this.graphic),this._isMoving=!0,this.map.disableMapNavigation());var r=e.MatrixUtils.translate(this.graphic.geometry,this.map,t,i);if(this._transform=r.transform,this._modified=!0,this.graphic.setGeometry(r.geometry),this._textAnchor&&this._textAnchor.setGeometry(new esri.geometry.Point(this.graphic.geometry.toJson())),this.owner.refresh(),this.owner.onGraphicMove(this.graphic,r.transform),this.graphic.geometry instanceof esri.geometry.Point){var n=this.graphic.geometry.offset(0,0),a={sender:this,mapPoint:n,screenPoint:this.map.toScreen(n)};this._raiseEditVertexMoved(a)}},i.prototype._raiseEditVertexMoved=function(e){this.owner&&this.owner.app&&this.owner.app.event("EditVertexMovedEvent").publish(e)},i}(t.EditCapabilityBase);t.GraphicMover=i}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(r){function n(e,t,i){r.call(this,e,i),this._editObject=null,this._options=null,this._defaultOptions=null,this._tool=0,this._isTextPoint=!1,this._isGeo=!1,this._active=!1,this._modified=!1,this._cancelled=!1,this._needsRefresh=!1,this._handles=[],this._snappingFeedbackEventToken=null,this._lastSnapPoint=null,this._graphicMover=null,this._vertexEditor=null,this._boxEditor=null;var n=Modernizr&&!!Modernizr.touch,a={vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([128,128,128])),ghostVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?18:10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([255,255,255,.75])),ghostLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DOT,new esri.Color([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,narrateKeyboardShortcuts:!0,rotateHandleOffset:n?24:16,boxLineSymbol:new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new esri.Color([64,64,64]),1),boxHandleSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,n?16:9,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([255,255,255,.75])),textAnchorSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,null,new esri.Color([255,0,0])),selectedVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,n?25:15,null,new esri.Color([0,0,255,.75]))};this._defaultOptions=dojo.mixin(a,t||{}),this._editObject=new esri.toolbars.Edit(e,t)}return __extends(n,r),n.prototype.activate=function(e,t,i){var r=this;if(this.deactivate(),this.app&&(this._snappingFeedbackEventToken=this.app.event("SnappingFeedbackEvent").subscribe(this,function(e){e&&e.snappingPoint?r._lastSnapPoint=e.snappingPoint:r._lastSnapPoint=null})),this._active=!0,this._graphic=t,this._tool=e,this._options=dojo.mixin(dojo.mixin({},this._defaultOptions),i||{}),e>0){var a=this._map.spatialReference,s=t&&t.geometry?t.geometry.spatialReference:null;if(this._isGeo=a&&s&&!a.equals(s)&&a.isWebMercator()&&4326===s.wkid,t&&t.geometry&&"point"===t.geometry.type){var o=this._getSymbol(t);this._isTextPoint=o&&"textsymbol"===o.type}else this._isTextPoint=!1;t&&t.geometry&&"multipoint"===t.geometry.type&&(this._options.allowAddVertices=!1),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicClick",dojo.hitch(this,"_onGraphicClickImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicFirstMove",dojo.hitch(this,"_onGraphicFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMove",dojo.hitch(this,"_onGraphicMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMoveStart",dojo.hitch(this,"_onGraphicMoveStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onGraphicMoveStop",dojo.hitch(this,"_onGraphicMoveStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotate",dojo.hitch(this,"_onRotateImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateFirstMove",dojo.hitch(this,"_onRotateFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateStart",dojo.hitch(this,"_onRotateStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onRotateStop",dojo.hitch(this,"_onRotateStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScale",dojo.hitch(this,"_onScaleImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleFirstMove",dojo.hitch(this,"_onScaleFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleStart",dojo.hitch(this,"_onScaleStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onScaleStop",dojo.hitch(this,"_onScaleStopImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexAdd",dojo.hitch(this,"_onVertexAddImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexClick",dojo.hitch(this,"_onVertexClickImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexDelete",dojo.hitch(this,"_onVertexDeleteImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexFirstMove",dojo.hitch(this,"_onVertexFirstMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMouseOut",dojo.hitch(this,"_onVertexMouseOutImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMouseOver",dojo.hitch(this,"_onVertexMouseOverImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMove",dojo.hitch(this,"_onVertexMoveImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMoveStart",dojo.hitch(this,"_onVertexMoveStartImpl"),!0)),this._handles.push(dojo.aspect.after(this._editObject,"onVertexMoveStop",dojo.hitch(this,"_onVertexMoveStopImpl"),!0)),this.activateMouseControls(),this.activateKeyboardControls();var l=!1,c=!1,u=!1;(e&n.MOVE)===n.MOVE&&(l=this._enableMove(t));var p=(e&n.SCALE)===n.SCALE,h=(e&n.ROTATE)===n.ROTATE;if((p||h)&&(c=this._enableBoxEditing(t,p,h)),(e&n.EDIT_VERTICES)===n.EDIT_VERTICES&&(u=this._enableVertexEditing(t)),!l&&!c&&!u)throw new Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");this.onKeyboardStart(),this._updateToolStatusMessage(),this.onActivate(e,t);var d={sender:this,graphic:t,tool:e};this.raiseGraphicEditActivated(d)}},n.prototype.deactivate=function(){var e=this._tool;if(this._active=!1,this.app&&this._snappingFeedbackEventToken&&(this.app.event("SnappingFeedbackEvent").unsubscribe(this._snappingFeedbackEventToken),this._snappingFeedbackEventToken=null),e>0){var i=this._modified,r=this._cancelled,n=this._graphic;if(this._graphicMover&&this._graphicMover.hasMoved()&&this._adjustGraphicMoverPoint(n,this._lastSnapPoint),this._clear(),this._graphic=null,this._isGeo=this._isTextPoint=!1,this.deactivateMouseControls(),this.deactivateKeyboardControls(),this.app.toolRegistry&&this.app.toolRegistry.getActiveTool){var a=this.app.toolRegistry.getActiveTool();a instanceof t.tools.MapTool&&a.drawMode===t.tools.DrawMode.EXTENT&&n.setGeometry(this._convertPolygonToExtent(n.geometry))}this.onDeactivate(e,n,{isModified:i,cancelled:r});var s={sender:this,graphic:n,tool:e,isModified:i,cancelled:r};this.raiseGraphicEditDeactivated(s)}},n.prototype._convertPolygonToExtent=function(e){return e.getExtent?e.getExtent():(this.app.trace.warning("Tried to convert polygon to extent, but failed. Polygon object lacks getExtent() method."),null)},n.prototype.getOptions=function(){return this._options||this._defaultOptions||{}},n.prototype.getCurrentState=function(){return{tool:this._tool,graphic:this._graphic,isModified:this._modified}},n.prototype.getEnabledTools=function(){return[this._graphicMover,this._boxEditor,this._vertexEditor].filter(function(t){return!e.framework.utils.isNullOrUndefined(t)})},n.prototype.refresh=function(){this._editObject.refresh(),this._needsRefresh=!1},n.prototype.setNeedsRefresh=function(e){this._needsRefresh=e},n.prototype.suspend=function(){r.prototype.suspend.call(this),this.getEnabledTools().forEach(function(e){return e.suspend()})},n.prototype.resume=function(){r.prototype.resume.call(this),this.getEnabledTools().forEach(function(e){return e.resume()})},n.prototype.isActive=function(){return this._active},n.prototype.activateMouseControls=function(e){if(void 0===e&&(e=!0),r.prototype.activateMouseControls.call(this,e),!(this._tool>0))throw new Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");this._editObject.__attached_stopEvent=!0,this._editObject.activate(this._tool,this._graphic,this._options)},n.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),r.prototype.deactivateMouseControls.call(this,e),this._editObject.__attached_stopEvent=!0,this._editObject.deactivate()},n.prototype.on=function(e,t){throw new Error("[geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibility.Edit] On style events not implemented yet. Use connect instead.")},n.prototype.onActivate=function(e,t){},n.prototype.onDeactivate=function(e,t,i){},n.prototype.onGraphicClick=function(e,t){},n.prototype._onGraphicClickImpl=function(e,t){this.onGraphicClick(e,t)},n.prototype.onGraphicFirstMove=function(e){this._modified=!0},n.prototype._onGraphicFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onGraphicFirstMove(e)},n.prototype.onGraphicMove=function(e,t){},n.prototype._onGraphicMoveImpl=function(e,t){this.onGraphicMove(e,t)},n.prototype.onGraphicMoveStart=function(e){},n.prototype._onGraphicMoveStartImpl=function(e){this.onGraphicMoveStart(e)},n.prototype.onGraphicMoveStop=function(e,t){},n.prototype._onGraphicMoveStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onGraphicMoveStop(e,t)},n.prototype.onRotate=function(e,t){},n.prototype._onRotateImpl=function(e,t){this.onRotate(e,t)},n.prototype.onRotateFirstMove=function(e){this._modified=!0},n.prototype._onRotateFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onRotateFirstMove(e)},n.prototype.onRotateStart=function(e){},n.prototype._onRotateStartImpl=function(e){this.onRotateStart(e)},n.prototype.onRotateStop=function(e,t){},n.prototype._onRotateStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onRotateStop(e,t)},n.prototype.onScale=function(e,t){},n.prototype._onScaleImpl=function(e,t){this.onScale(e,t)},n.prototype.onScaleFirstMove=function(e){this._modified=!0},n.prototype._onScaleFirstMoveImpl=function(e){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onScaleFirstMove(e)},n.prototype.onScaleStart=function(e){},n.prototype._onScaleStartImpl=function(e){this.onScaleStart(e)},n.prototype.onScaleStop=function(e,t){},n.prototype._onScaleStopImpl=function(e,t){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume(),this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle()),this.onScaleStop(e,t)},n.prototype.onVertexAdd=function(e,t){this._modified=!0,null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this._vertexEditor.refresh(!0),this._vertexEditor.onVertexAdd(t),this._vertexEditor.showVertexHandle())},n.prototype._onVertexAddImpl=function(e,t){this.onVertexAdd(e,t)},n.prototype.onVertexClick=function(e,t){},n.prototype._onVertexClickImpl=function(e,t){this.onVertexClick(e,t)},n.prototype.onVertexDelete=function(e,t){this._modified=!0,null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this._vertexEditor.refresh(!0),this._vertexEditor.onVertexDelete(t),this._vertexEditor.showVertexHandle())},n.prototype._onVertexDeleteImpl=function(e,t){this.onVertexDelete(e,t)},n.prototype.onVertexFirstMove=function(e,t){this._modified=!0},n.prototype._onVertexFirstMoveImpl=function(e,t){this.suspend(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&this._vertexEditor.hideVertexHandle(),this.onVertexFirstMove(e,t)},n.prototype.onVertexMouseOut=function(e,t){},n.prototype._onVertexMouseOutImpl=function(e,t){this.onVertexMouseOut(e,t)},n.prototype.onVertexMouseOver=function(e,t){},n.prototype._onVertexMouseOverImpl=function(e,t){this.onVertexMouseOver(e,t)},n.prototype.onVertexMove=function(e,t,i){t&&t.graphic&&this.app.event("EditVertexHandleMovedEvent").publish(t.graphic)},n.prototype._onVertexMoveImpl=function(e,t,i){this.onVertexMove(e,t,i)},n.prototype.onVertexMoveStart=function(e,t){},n.prototype._onVertexMoveStartImpl=function(e,t){this.onVertexMoveStart(e,t)},n.prototype.onVertexMoveStop=function(e,t,i){null!==this._vertexEditor&&this._vertexEditor.isActive()&&!t.isGhost&&(this._vertexEditor.refresh(),this._vertexEditor.showVertexHandle())},n.prototype._onVertexMoveStopImpl=function(e,t,i){this.resume(),null!==this._vertexEditor&&this._vertexEditor.isActive()&&(this.suspend(),this._vertexEditor.resume()),this.onVertexMoveStop(e,t,i)},n.prototype.onKeyboardStart=function(){r.prototype.onKeyboardStart.call(this)},n.prototype.onKeyboardStop=function(e){void 0===e&&(e=!1),r.prototype.onKeyboardStop.call(this,e),this._cancelled=e,this.deactivate()},n.prototype._onKeyDown=function(e){if(r.prototype._onKeyDown.call(this,e),!this.suspended&&this._active&&this.inputMethod!==i.InputMethod.MOUSE){var t=!1;switch(e.keyCode||e.which){case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:this.toggleKeyboardMode(),t=!0;break;case dojo.keys.ESCAPE:this.onKeyboardStop(!0),t=!0}t&&(e.preventDefault(),e.stopPropagation())}},n.prototype.raiseGraphicEditActivated=function(e){this.app.event("GraphicEditActivatedEvent").publish(e)},n.prototype.raiseGraphicEditDeactivated=function(e){this.app.event("GraphicEditDeactivatedEvent").publish(e)},n.prototype._updateToolStatusMessage=function(){if(this._graphic&&this._graphic.geometry&&"point"!==this._graphic.geometry.type){var t=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-desc-shortcuts");if(this.app.toolRegistry&&this.app.toolRegistry.getActiveTool()){var i=this.app.toolRegistry.getActiveTool(),r=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-zoomin-tool"),n=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-zoomout-tool");i.name!==r&&i.name!==n||(t=this.app.getResource("Mapping.Infrastructure","language-toolbar-markup-edit-desc-shortcuts-zoom"))}t&&(this.app.command("UpdateStatus").execute(new e.essentialsHtmlViewer.mapping.infrastructure.commandArgs.AddStatusArgs(t)),this._options.narrateKeyboardShortcuts&&this.app.command("ScreenReaderNarrate").execute(t))}},n.prototype._clear=function(){this._disableMove(),this._disableBoxEditing(),this._disableVertexEditing(),this._tool=0,this._modified=!1,this._cancelled=!1,this.suspended=!1,this.setInputMethod(null)},n.prototype._getSymbol=function(e){if(e){var t=e.symbol;if(t)return t;var i=e.getLayer()?e.getLayer().renderer:null;if(i)return i.getSymbol(e)}return null},n.prototype._enableMove=function(e){switch(e.geometry.type){case"point":var t=this._isTextPoint&&this._editObject._textAnchor?this._editObject._textAnchor:null;return this._graphicMover=new i.GraphicMover(e,this._map,this,t),!0;case"polyline":case"polygon":return this._graphicMover=new i.GraphicMover(e,this._map,this,null),!0}return!1},n.prototype._enableBoxEditing=function(e,t,r){var n={scaleEnabled:t,rotateEnabled:r,uniformScaling:this._options.uniformScaling,boxHandleSymbol:this._options.boxHandleSymbol,boxLineSymbol:this._options.boxLineSymbol};return!!(this._isTextPoint||["polyline","polygon"].indexOf(e.geometry.type)>-1)&&(this._boxEditor=new i.BoxEditor(e,this._map,this,this._isTextPoint,n),!0)},n.prototype._enableVertexEditing=function(e){var t={allowAddVertices:this._options.allowAddVertices,allowDeleteVertices:this._options.allowDeleteVertices,selectedVertexSymbol:this._options.selectedVertexSymbol};switch(e.geometry.type){case"multipoint":case"polyline":case"polygon":return this._vertexEditor=i.VertexEditor.create(e,this._map,this,t),!0}return!1},n.prototype._adjustGraphicMoverPoint=function(e,t){t&&e&&t instanceof esri.geometry.Point&&e.geometry instanceof esri.geometry.Point&&e.setGeometry(t)},n.prototype._disableMove=function(){this._graphicMover&&(this._graphicMover.destroy(),this._graphicMover=null)},n.prototype._disableBoxEditing=function(){this._boxEditor&&(this._boxEditor.destroy(),this._boxEditor=null)},n.prototype._disableVertexEditing=function(){this._vertexEditor&&(this._vertexEditor.destroy(),this._vertexEditor=null)},n._edit=void require(["esri/toolbars/edit"],function(e){n.EDIT_TEXT=e.EDIT_TEXT,n.EDIT_VERTICES=e.EDIT_VERTICES,n.MOVE=e.MOVE,n.ROTATE=e.ROTATE,n.SCALE=e.SCALE}),n}(i.AccessibleMapComponent);i.Edit=r}(t.accessibility||(t.accessibility={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){i=function(i){function r(e,t,n){i.call(this,e,n),this.respectDrawingVertexOrder=!1,this._arrowShapeTemplate=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],this._leftArrowShapeTemplate=[[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],this._rightArrowShapeTemplate=[[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],this._upArrowShapeTemplate=[[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],this._downArrowShapeTemplate=[[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],this._triangleShapeTemplate=[[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],this._rectangleShapeTemplate=[[0,-48],[96,-48],[96,0],[0,0],[0,-48]],this._drawObject=null,this._editObject=null,this._options=null,this._defaultOptions=null,this._active=!1,this._graphic=null,this._createGeometryDeferred=null,this._isPlottingPolyGeometry=!1,this._lastVertexPosition=null,this._vertexAnchor=null,this._ghostLine=null,this._handles=[],this._polyGeometryKeyDownHandle=null,this._editCompletedHandle=null,this._dblClickHandlerToken=null,this._lastSnappingPoint=null;var a=Modernizr&&!!Modernizr.touch,s={enableEditing:!0,vertexOffsetX:10,vertexOffsetY:10,preciseVertexOffsetX:1,preciseVertexOffsetY:1,vertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?20:12,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.5]),1),new esri.Color([128,128,128])),selectedVertexSymbol:new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,a?25:15,null,new esri.Color([0,0,255,.75]))};this._defaultOptions=dojo.mixin(s,t||{}),this._points=[],this._drawObject=new esri.toolbars.Draw(e,t),this._twoClicksWithin300MsFixup(),this._editObject=new r.EditInternal(e,null,n),this.fillSymbol=this._drawObject.fillSymbol,this.lineSymbol=this._drawObject.lineSymbol,this.markerSymbol=this._drawObject.markerSymbol,this.respectDrawingVertexOrder=this._drawObject.respectDrawingVertexOrder,this.setVertexSymbol(this._defaultOptions.vertexSymbol),this.setSelectedVertexSymbol(this._defaultOptions.selectedVertexSymbol),this.app&&this.app.event("SnappingFeedbackEvent").subscribe(this,this._handleSnappingEvent)}return __extends(r,i),r.createEllipse=function(e){for(var t=e.center,i=e.longAxis||48,r=e.shortAxis||24,n=e.numberOfPoints||60,a=e.map,s=[],o=2*Math.PI/n,l=0;l<n;l++){var c=Math.cos(l*o),u=Math.sin(l*o),p=a.toMap(new esri.geometry.ScreenPoint({x:i*c+t.x,y:r*u+t.y}));s.push(p)}s.push(s[0]);var h=new esri.geometry.Polygon(a.spatialReference);return h.addRing(s),h},r.createCircle=function(e){return r.createEllipse({center:e.center,longAxis:e.radius,shortAxis:e.radius,numberOfPoints:e.numberOfPoints,map:e.map})},r.prototype.activate=function(e,t){var i=this;(this._active||this._geometryType)&&this.deactivate(),this._handles.push(this.app.map.on("click",function(e){return i.app.trace.debug("[DrawTool] map-click")})),this._handles.push(this.app.map.on("dbl-click",function(e){return i.app.trace.debug("[DrawTool] map-double-click")})),this._active=!0,this._geometryType=e,this._options=dojo.mixin(dojo.mixin({},this._defaultOptions),t||{}),e===r.MULTI_POINT&&(this._options.enableEditing=!1),this.setVertexSymbol(this._options.vertexSymbol),this.setSelectedVertexSymbol(this._options.selectedVertexSymbol),this._handles.push(dojo.aspect.after(this._drawObject,"onDrawEnd",dojo.hitch(this,"onDrawEnd"),!0)),this._handles.push(dojo.aspect.after(this._drawObject,"onDrawComplete",dojo.hitch(this,"onDrawComplete"),!0)),this._drawObject&&"function"==typeof this._drawObject._onClickHandler&&this._handles.push(dojo.aspect.after(this._drawObject,"_onClickHandler",dojo.hitch(this,"_onClickHandler"),!0)),this._extraPointOnTouchDevicesFixup(),this.activateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.activateKeyboardControls(),this.onActivate(),this.raiseGraphicDrawActivated({sender:this,geometryType:e})},r.prototype.deactivate=function(){var e=this._geometryType;this._active=!1,this._clear(),this.setInputMethod(null),this._dblClickHandlerToken&&(this._dblClickHandlerToken.remove(),this._dblClickHandlerToken=null),this._handles.forEach(function(e){e.remove()}),this._handles.length=0,this._geometryType=this.vertexSymbol=this.selectedVertexSymbol=null,this.onDeactivate(),this.raiseGraphicDrawDeactivated({sender:this,geometryType:e})},r.prototype.finishDrawing=function(){switch(this.inputMethod){case t.InputMethod.MOUSE:this._drawObject.finishDrawing(),this._syncPointsCollection();break;case t.InputMethod.KEYBOARD:this._finishKeyboardDrawing()}},r.prototype.setFillSymbol=function(e){this.fillSymbol=e,this._drawObject.setFillSymbol(e)},r.prototype.setLineSymbol=function(e){this.lineSymbol=e,this._drawObject.setLineSymbol(e)},r.prototype.setMarkerSymbol=function(e){this.markerSymbol=e,this._drawObject.setMarkerSymbol(e)},r.prototype.setRespectDrawingVertexOrder=function(e){this.respectDrawingVertexOrder=e,this._drawObject.setRespectDrawingVertexOrder(e)},r.prototype.setVertexSymbol=function(e){this.vertexSymbol=e},r.prototype.setSelectedVertexSymbol=function(e){this.selectedVertexSymbol=e},r.prototype.activateMouseControls=function(e){void 0===e&&(e=!0),i.prototype.activateMouseControls.call(this,e),this._geometryType&&(this._drawObject.__attached_stopEvent=!0,this._drawObject.activate(this._geometryType,this._options))},r.prototype.deactivateMouseControls=function(e){void 0===e&&(e=!0),i.prototype.deactivateMouseControls.call(this,e),this._drawObject.__attached_stopEvent=!0,this._drawObject.deactivate()},r.prototype.raiseGraphicDrawActivated=function(e){this.app.event("GraphicDrawActivatedEvent").publish(e)},r.prototype.raiseGraphicDrawDeactivated=function(e){this.app.event("GraphicDrawDeactivatedEvent").publish(e)},r.prototype.raiseGraphicVertexAdded=function(e){this.app.event("GraphicVertexAddedEvent").publish(e)},r.prototype.raiseGraphicVertexMoved=function(e){this.app.event("GraphicVertexMovedEvent").publish(e)},r.prototype.on=function(e,t){throw new Error("[geocortex.essentialsHtmlViewer.mapping.infrastructure.accessibilit.Draw::on] On style events not implemented yet. Use connect instead.")},r.prototype.onActivate=function(){},r.prototype.onDeactivate=function(){},r.prototype.onDrawComplete=function(e){this.inputMethod==t.InputMethod.MOUSE&&this._clear()},r.prototype.onDrawEnd=function(e){this.app.trace.debug("[DrawTool] Number of vertices drawn "+this._vertexCount(e)),this.inputMethod==t.InputMethod.MOUSE&&this._clear(),this.app.event("GraphicDrawCompletedEvent").publish(e)},r.prototype.onKeyboardStart=function(){var e=this;i.prototype.onKeyboardStart.call(this),this.deactivateMouseControls();var t=this._map.extent.getCenter();this._plotShape(t,this._geometryType).then(function(t){return e._editShape(t)})},r.prototype.onKeyboardStop=function(e){if(void 0===e&&(e=!1),i.prototype.onKeyboardStop.call(this,e),this._graphic&&!e){var t=this._graphic.geometry;this._clear(),this._drawEnd(t)}else this._clear()},r.prototype._onKeyDown=function(e){if(i.prototype._onKeyDown.call(this,e),!this.suspended&&this._active&&this.inputMethod!==t.InputMethod.MOUSE){var r=!1;switch(e.keyCode||e.which){case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:this.toggleKeyboardMode(),r=!0;break;case dojo.keys.ESCAPE:this.onKeyboardStop(!0),r=!0}r&&(e.preventDefault(),e.stopPropagation())}},r.prototype._onClickHandler=function(e){this.inputMethod===t.InputMethod.MOUSE&&this._syncPointsCollection()},r.prototype._supportsKeyboardInput=function(e){switch(e){case r.ARROW:case r.CIRCLE:case r.DOWN_ARROW:case r.ELLIPSE:case r.EXTENT:case r.LEFT_ARROW:case r.MULTI_POINT:case r.POINT:case r.POLYGON:case r.POLYLINE:case r.RECTANGLE:case r.RIGHT_ARROW:case r.TRIANGLE:case r.UP_ARROW:return!0}return!1},r.prototype._finishKeyboardDrawing=function(e){if(void 0===e&&(e=!0),this._active){var t,i=this._map.spatialReference,n=this._points.slice(0,this._points.length);switch(this._geometryType){case r.POLYLINE:if(!this._graphic||n.length<2)return;(t=new esri.geometry.Polyline(i)).addPath(n),this._graphic.setGeometry(t);break;case r.POLYGON:if(!this._graphic||n.length<2)return;n.push(n[0].offset(0,0)),esri.geometry.Polygon.prototype.isClockwise(n)||this.respectDrawingVertexOrder||(this.app.trace.debug("Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),n.reverse()),(t=new esri.geometry.Polygon(i)).addRing(n),this._graphic.setGeometry(t);break;case r.MULTI_POINT:t=new esri.geometry.Multipoint(i),n.forEach(function(e){t.addPoint(e)}),this._graphic.setGeometry(t);break;default:if(!this._graphic||!this._graphic.geometry)return;t=this._graphic.geometry}e&&this.onKeyboardStop()}},r.prototype._clear=function(){this._graphic&&this._map.graphics.remove(this._graphic),this._ghostLine&&this._map.graphics.remove(this._ghostLine),this._vertexAnchor&&this._map.graphics.remove(this._vertexAnchor),this._editCompletedHandle&&this._editCompletedHandle.remove(),this._polyGeometryKeyDownHandle&&this._polyGeometryKeyDownHandle.remove(),this._editObject&&this._editObject.deactivate(),this._polyGeometryKeyDownHandle=this._editCompletedHandle=this._createGeometryDeferred=this._graphic=this._vertexAnchor=this._ghostLine=null,this._isPlottingPolyGeometry=!1,this._lastVertexPosition=null,this.suspended=!1,this._points.length=0,this.deactivateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.deactivateKeyboardControls(),this.setInputMethod(null),this._active&&(this.activateMouseControls(),this._supportsKeyboardInput(this._geometryType)&&this.activateKeyboardControls())},r.prototype._drawEnd=function(e){if(e){this.onDrawEnd(e);var t,i=this._map.spatialReference;i&&(i.isWebMercator()?t=esri.geometry.webMercatorToGeographic(e):4326===i.wkid&&(t=esri.geometry.fromJson(e.toJson()))),this.onDrawComplete({geometry:e,geographicGeometry:t})}},r.prototype._moveVertexAnchor=function(e,t){if(this._vertexAnchor&&!isNaN(e)&&!isNaN(t)){var i=this._vertexAnchor.geometry,n=this._map.toMap(this._map.toScreen(i).offset(e,t)),a=n.x-i.x,s=n.y-i.y,o=i.offset(a,s);[r.POLYLINE,r.POLYGON].indexOf(this._geometryType)>-1&&this._updateGhostLine(o),this._vertexAnchor.setGeometry(o).setSymbol(this.selectedVertexSymbol),this._vertexAnchor.getDojoShape().moveToFront();var l={sender:this,mapPoint:o,screenPoint:this._map.toScreen(o),snappingPoint:this._lastSnappingPoint};this.raiseGraphicVertexMoved(l)}},r.prototype._handleSnappingEvent=function(e){this._active&&this._editObject.isActive()||(this._lastSnappingPoint=e.snappingPoint,this._lastSnappingPoint&&this._ghostLine&&this._updateGhostLine(this._lastSnappingPoint))},r.prototype._updateGhostLine=function(e){if(this._points&&this._points.length>0){var t=this._points[this._points.length-1],i=this._ghostLine.geometry;i.setPoint(0,0,t.offset(0,0)),i.setPoint(0,1,e),this._ghostLine.setGeometry(i)}},r.prototype._addVertex=function(e){var t=e;this._lastSnappingPoint&&(e=this._lastSnappingPoint);var i,n,a,s;switch(this._points.push(e.offset(0,0)),this._geometryType){case r.POLYLINE:1===this._points.length?((i=new esri.geometry.Polyline(this._map.spatialReference)).addPath(this._points),this._graphic=this._map.graphics.add(new esri.Graphic(i,this.lineSymbol)),(s=new esri.geometry.Polyline(this._map.spatialReference)).addPath([e.offset(0,0),e.offset(0,0)]),this._ghostLine=this._map.graphics.add(new esri.Graphic(s,this.lineSymbol))):((i=this._graphic.geometry).insertPoint(0,i.paths[0].length,e.offset(0,0)),this._graphic.setGeometry(i).setSymbol(this.lineSymbol),(s=this._ghostLine.geometry).setPoint(0,0,e.offset(0,0)),s.setPoint(0,1,e.offset(0,0)),this._ghostLine.setGeometry(s));break;case r.POLYGON:1===this._points.length?((n=new esri.geometry.Polygon(this._map.spatialReference)).addRing(this._points),this._graphic=this._map.graphics.add(new esri.Graphic(n,this.fillSymbol)),(s=new esri.geometry.Polyline(this._map.spatialReference)).addPath([e.offset(0,0),e.offset(0,0)]),this._ghostLine=this._map.graphics.add(new esri.Graphic(s,this.fillSymbol))):((n=this._graphic.geometry).insertPoint(0,n.rings[0].length,e.offset(0,0)),this._graphic.setGeometry(n).setSymbol(this.fillSymbol),(s=this._ghostLine.geometry).setPoint(0,0,e.offset(0,0)),s.setPoint(0,1,e.offset(0,0)),this._ghostLine.setGeometry(s));break;case r.MULTI_POINT:1===this._points.length?((a=new esri.geometry.Multipoint(this._map.spatialReference)).addPoint(e.offset(0,0)),this._graphic=this._map.graphics.add(new esri.Graphic(a,this.markerSymbol))):((a=this._graphic.geometry).addPoint(e.offset(0,0)),this._graphic.setGeometry(a).setSymbol(this.markerSymbol))}this._lastVertexPosition=t.offset(0,0),this._vertexAnchor.setGeometry(t.offset(0,0)).setSymbol(this.selectedVertexSymbol),this._vertexAnchor.getDojoShape().moveToFront()},r.prototype._drawPolyGeometry=function(e,t){var i=this;if(!e||this._isPlottingPolyGeometry)return Promise.resolve(null);this._lastSnappingPoint&&(e=this._lastSnappingPoint),this._isPlottingPolyGeometry=!0,this.app.map.disableMapNavigation(),this.suspend(),this._lastVertexPosition=null,this._vertexAnchor=this._map.graphics.add(new esri.Graphic(e.offset(0,0),this.selectedVertexSymbol));var r={sender:this,mapPoint:e,screenPoint:this._map.toScreen(e),snappingPoint:this._lastSnappingPoint};this.raiseGraphicVertexMoved(r),this._polyGeometryKeyDownHandle&&(this._polyGeometryKeyDownHandle.remove(),this._polyGeometryKeyDownHandle=null);var n=null;return new Promise(function(e,t){return i._polyGeometryKeyDownHandle=i._drawPolyGeometry_handleKeyDown(e,t)}).then(function(e){return n=e}).catch(function(){return i.onKeyboardStop(!0),n=null}).lastly(function(){return i._isPlottingPolyGeometry=!1,i.app.map.enableMapNavigation(),i._polyGeometryKeyDownHandle&&(i._polyGeometryKeyDownHandle.remove(),i._polyGeometryKeyDownHandle=null),i.resume(),n})},r.prototype._drawPolyGeometry_handleKeyDown=function(t,i){var r=this;return dojo.on(this._map.root,"keydown",function(n){var a=n.altKey,s=a?r._options.preciseVertexOffsetX:r._options.vertexOffsetX,o=a?r._options.preciseVertexOffsetY:r._options.vertexOffsetY;switch(n.keyCode||n.which){case dojo.keys.UP_ARROW:case dojo.keys.NUMPAD_8:r._moveVertexAnchor(0,-o);break;case dojo.keys.RIGHT_ARROW:case dojo.keys.NUMPAD_6:r._moveVertexAnchor(s,0);break;case dojo.keys.DOWN_ARROW:case dojo.keys.NUMPAD_2:r._moveVertexAnchor(0,o);break;case dojo.keys.LEFT_ARROW:case dojo.keys.NUMPAD_4:r._moveVertexAnchor(-s,0);break;case dojo.keys.PAGE_UP:case dojo.keys.NUMPAD_9:r._moveVertexAnchor(s,-o);break;case dojo.keys.PAGE_DOWN:case dojo.keys.NUMPAD_3:r._moveVertexAnchor(s,o);break;case dojo.keys.END:case dojo.keys.NUMPAD_1:r._moveVertexAnchor(-s,o);break;case dojo.keys.HOME:case dojo.keys.NUMPAD_7:r._moveVertexAnchor(-s,-o);break;case dojo.keys.ENTER:case dojo.keys.NUMPAD_ENTER:if(e.GeometryUtils.pointsAreEqual(r._vertexAnchor.geometry,r._lastVertexPosition))r._graphic&&r._map.graphics.remove(r._graphic),r._vertexAnchor&&r._map.graphics.remove(r._vertexAnchor),r._finishKeyboardDrawing(!1),t(r._graphic?r._graphic.geometry:null);else{var l=r._vertexAnchor.geometry;r._addVertex(l);var c={sender:r,mapPoint:l,screenPoint:r._map.toScreen(l),snappingPoint:r._lastSnappingPoint};r.raiseGraphicVertexAdded(c)}break;case dojo.keys.ESCAPE:i(null);break;default:return}n.preventDefault(),n.stopPropagation()})},r.prototype._plotShape=function(e,t){var i=this._map.toScreen(e);switch(t){case r.POINT:return Promise.resolve(e.offset(0,0));case r.POLYLINE:case r.POLYGON:case r.MULTI_POINT:return this._drawPolyGeometry(e,t);case r.ARROW:return Promise.resolve(this._toPolygon(this._arrowShapeTemplate,i.x,i.y));case r.LEFT_ARROW:return Promise.resolve(this._toPolygon(this._leftArrowShapeTemplate,i.x,i.y));case r.RIGHT_ARROW:return Promise.resolve(this._toPolygon(this._rightArrowShapeTemplate,i.x,i.y));case r.UP_ARROW:return Promise.resolve(this._toPolygon(this._upArrowShapeTemplate,i.x,i.y));case r.DOWN_ARROW:return Promise.resolve(this._toPolygon(this._downArrowShapeTemplate,i.x,i.y));case r.TRIANGLE:return Promise.resolve(this._toPolygon(this._triangleShapeTemplate,i.x,i.y));case r.RECTANGLE:case r.EXTENT:return Promise.resolve(this._toPolygon(this._rectangleShapeTemplate,i.x-48,i.y+24));case r.CIRCLE:var n=r.createCircle({center:i,radius:48,numberOfPoints:60,map:this._map});return Promise.resolve(n);case r.ELLIPSE:var a=r.createEllipse({center:i,longAxis:48,shortAxis:24,numberOfPoints:60,map:this._map});return Promise.resolve(a)}return Promise.resolve(null)},r.prototype._editShape=function(e){if(e){if(!1===this._options.enableEditing)return this._clear(),void this._drawEnd(e);this.suspend();var t;switch(e.type){case"point":case"multipoint":t=this.markerSymbol;break;case"polyline":t=this.lineSymbol;break;case"polygon":case"extent":t=this.fillSymbol}var i=this._getEditMode(this._geometryType);this._graphic=this._map.graphics.add(new esri.Graphic(e,t)),this._editCompletedHandle&&(this._editCompletedHandle.remove(),this._editCompletedHandle=null),this._editCompletedHandle=dojo.aspect.after(this._editObject,"onDeactivate",dojo.hitch(this,"_onEditShapeCompleted"),!0),this._editObject.activate(i.mode,this._graphic,i.options)}},r.prototype._onEditShapeCompleted=function(e,t,i){var r=!!i&&!!i.isModified,n=!!i&&!!i.cancelled;t&&r&&(this._graphic=t),this.resume(),this.onKeyboardStop(n)},r.prototype._toPolygon=function(e,t,i){var r=this._map,n=e.map(function(e){return r.toMap(new esri.geometry.ScreenPoint(e[0]+t,e[1]+i))}),a=new esri.geometry.Polygon(r.spatialReference);return a.addRing(n),a},r.prototype._syncPointsCollection=function(){this._points=this._drawObject._points},r.prototype._getEditMode=function(e){var i={mode:0,options:{}};switch(e){case r.POINT:i.mode=t.Edit.MOVE;break;case r.MULTI_POINT:i.mode=t.Edit.EDIT_VERTICES,i.options.allowAddVertices=!1,i.options.allowDeleteVertices=!0;break;case r.POLYLINE:case r.ARROW:case r.LEFT_ARROW:case r.RIGHT_ARROW:case r.UP_ARROW:case r.DOWN_ARROW:case r.TRIANGLE:case r.RECTANGLE:case r.POLYGON:i.mode=t.Edit.MOVE|t.Edit.ROTATE|t.Edit.SCALE|t.Edit.EDIT_VERTICES,i.options.allowAddVertices=!0,i.options.allowDeleteVertices=!0,i.options.uniformScaling=!1;break;case r.EXTENT:i.mode=t.Edit.MOVE|t.Edit.SCALE,i.options.allowAddVertices=!1,i.options.allowDeleteVertices=!1,i.options.uniformScaling=!1;break;case r.CIRCLE:i.mode=t.Edit.MOVE|t.Edit.SCALE,i.options.uniformScaling=!0;break;case r.ELLIPSE:i.mode=t.Edit.MOVE|t.Edit.ROTATE|t.Edit.SCALE,i.options.uniformScaling=!1}return i},r.prototype._vertexCount=function(e){return e&&"polyline"===e.type?e.paths[0].length:e&&"polygon"===e.type?e.rings[0].length-1:e&&"multipoint"===e.type?e.points.length:0},r.prototype._twoClicksWithin300MsFixup=function(){var e=this,t=this._drawObject;if(t&&"function"==typeof t._onClickHandler){var i=t._onClickHandler;t._onClickHandler=function(t){return e._twoClicksWithin300MsFixup_handleClick(t,i)}}else this.app.trace.warning("The _drawObject _onClickHandler hook is dysfunctional. Markup and Measurement (tool) functionality may be affected on touch devices.")},r.prototype._twoClicksWithin300MsFixup_handleClick=function(e,t){var i=!1,n=0,a=0;if(this._geometryType===r.POLYLINE||this._geometryType===r.POLYGON||this._geometryType===r.POINT||this._geometryType===r.MULTI_POINT){if(!i&&(e.mapPoint.x!==n||e.mapPoint.y!==a)){i=!0,setTimeout(function(){i=!1},300);var s={sender:this,mapPoint:e.mapPoint,screenPoint:e.screenPoint,snappingPoint:this._lastSnappingPoint};t.apply(this._drawObject,arguments),this.raiseGraphicVertexAdded(s)}!function(e){n=e[0].mapPoint.x,a=e[0].mapPoint.y}(arguments)}else t.apply(this._drawObject,arguments)},r.prototype._extraPointOnTouchDevicesFixup=function(){var e=this;this._dblClickHandlerToken?this.app.trace.debug("[DrawTool] No double click subscribed"):this._dblClickHandlerToken=this.app.map.on("dbl-click",function(t){var i=e._drawObject,r=!!(require&&require.has&&require.has("esri-touch"));e.app.trace.debug("[DrawTool] IsTouch = "+r);var n=i?i._points:null;if(n)if(r){if(n.length>=2){var a=n.push;n.push=function(){e.app.trace.debug("[DrawTool] points.length "+n.length),n.push=a}}}else if(n.length<2||n[n.length-1].x!==t.mapPoint.x&&n[n.length-1].y!==t.mapPoint.y){if(e._lastSnappingPoint)return void e.app.trace.debug("[DrawTool] Bailout due to snapping");n.push(t.mapPoint),e.raiseGraphicVertexAdded({sender:e,mapPoint:t.mapPoint,screenPoint:t.screenPoint,snappingPoint:e._lastSnappingPoint})}})},r._draw=void require(["esri/toolbars/draw"],function(e){r.ARROW=e.ARROW,r.CIRCLE=e.CIRCLE,r.DOWN_ARROW=e.DOWN_ARROW,r.ELLIPSE=e.ELLIPSE,r.EXTENT=e.EXTENT,r.FREEHAND_POLYGON=e.FREEHAND_POLYGON,r.FREEHAND_POLYLINE=e.FREEHAND_POLYLINE,r.LEFT_ARROW=e.LEFT_ARROW,r.LINE=e.LINE,r.MULTI_POINT=e.MULTI_POINT,r.POINT=e.POINT,r.POLYGON=e.POLYGON,r.POLYLINE=e.POLYLINE,r.RECTANGLE=e.RECTANGLE,r.RIGHT_ARROW=e.RIGHT_ARROW,r.TRIANGLE=e.TRIANGLE,r.UP_ARROW=e.UP_ARROW}),r}(t.AccessibleMapComponent);t.Draw=i;var i;!function(t){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.raiseGraphicEditActivated=function(e){this.app.event("GraphicDrawAccessibleEditActivatedEvent").publish(e)},t.prototype.raiseGraphicEditDeactivated=function(e){this.app.event("GraphicDrawAccessibleEditDeactivatedEvent").publish(e)},t}(e.accessibility.Edit);t.EditInternal=i}(i=t.Draw||(t.Draw={}))}(e.accessibility||(e.accessibility={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){this._tokenImpl=new i}return e.prototype.token=function(){return this._tokenImpl},e.prototype.cancel=function(){this._tokenImpl.cancel()},e.prototype.dispose=function(){this._tokenImpl.dispose()},e.none=function(){return this._none||(this._none={isCancellationRequested:!1,register:function(e){}}),this._none},e}();e.CancellationTokenSource=t;var i=function(){function e(){this._listeners=new Array,this.isCancellationRequested=!1}return e.prototype.register=function(e){this._listeners.push(e)},e.prototype.cancel=function(){this.isCancellationRequested=!0;for(var e=0;e<this._listeners.length;e++)this._listeners[e]()},e.prototype.dispose=function(){this._listeners.length=0},e}()}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e[e.Site=0]="Site",e[e.User=1]="User",e[e.Project=2]="Project"}(e.BookmarkSource||(e.BookmarkSource={}));var t=e.BookmarkSource,i=function(){function e(e){if(this._projectBookmarks=[],!e)throw new Error('Parameter "app" required.');this.app=e}return e.prototype.getAll=function(){var e=this;return Promise.join(this.getSiteBookmarks(),this.getUserBookmarks()).spread(function(t,i){return(t||[]).concat(i).concat(e._projectBookmarks)})},e.prototype.getUserBookmarks=function(){var e=this;return new Promise(function(t,i){e.app.store.get("bookmarks",function(i){var r=[];if(i)try{r=JSON.parse(i)}catch(t){e.app.trace.warning("Unable to parse user bookmarks: {0}".format(t))}var n=r.map(function(t){return e._deserialize(t)});t(n)},i)})},e.prototype.getSiteBookmarks=function(){var e=this;return this.app.waitUntilSiteInitialized().then(function(){return(e.app.site.namedExtents||[]).map(function(e){return{name:e.displayName,extent:e.extent,source:t.Site}})})},e.prototype.getProjectBookmarks=function(){return Promise.resolve(this._projectBookmarks)},e.prototype.add=function(e){var i=this;if(!e)throw new Error('Parameter "bookmark" required.');return e.source=e.source||t.User,e.source===t.Project?(this._projectBookmarks.push(e),this.app.event("BookmarksModifiedEvent").publish(""),Promise.resolve()):this.getUserBookmarks().then(function(t){return t.push(e),i._save(t)})},e.prototype.remove=function(e){var t=this;if(e)return"string"==typeof e?this._projectBookmarks=this._projectBookmarks.filter(function(t){return t.name!==e}):"object"==typeof e&&(this._projectBookmarks=this._projectBookmarks.filter(function(t){return t!==e})),this.getUserBookmarks().then(function(i){return"string"==typeof e?i=i.filter(function(t){return t.name!==e}):"object"==typeof e&&(i=i.filter(function(t){return t!==e})),t._save(i)})},e.prototype.export=function(e){var i=this;return e=e||[t.Site,t.User,t.Project],this.getAll().then(function(t){return t.filter(function(t){return e.indexOf(t.source)>=0}).map(function(e){return{name:e.name,extent:i.app.project.convert.fromEsriGeometry(e.extent)}})})},e.prototype._save=function(e){var t=this;return new Promise(function(i,r){var n=JSON.stringify((e||[]).map(function(e){return t._serialize(e)}));t.app.store.set("bookmarks",n,function(e,r){i(),t.app.event("BookmarksModifiedEvent").publish(n)},r)})},e.prototype._serialize=function(e){return{displayName:e.name,extent:this.app.webMap.convert.fromEsriGeometry(e.extent),isUserDefined:!0}},e.prototype._deserialize=function(e){return{name:e.displayName,extent:this.app.webMap.convert.toEsriGeometry(e.extent),source:t.User}},e}();e.BookmarkManager=i}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.AttributeGroup=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){this.dataLink=new Observable,this.table=new Observable}return t.prototype.toAttributes=function(){var e=this.table.get();if(!e)return null;for(var t={},i=0;i<e.columns.length;i++){var r=e.columns[i],n=e.rows.length>0?e.rows[0].row[i]:null;t[r]=n}return t},t.prototype.asAttributeGroup=function(){return this._attributeGroup||(this._attributeGroup=new e.AttributeGroup,this._attributeGroup.owner=this,this._attributeGroup.attributes=this.toAttributes()),this._attributeGroup},t}();e.DataLinkingResult=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function i(i,r,n,a,s,o,l){this.value=new Observable(void 0===i?"":i),this.name=new Observable(void 0===r?"":r),this.alias=new Observable(void 0===n?this.name.get():n),this.displayName=new Observable(void 0===a?this.alias.get()?this.alias.get():this.name.get():a),this.visible=new Observable(void 0===s||s),this.type=new Observable(void 0===l?"":l),o=o||t.PresentableDelegateFactory.valuePresenterDelegate(null,null),this.presentableValue=new e.framework.ui.LazyObservable(null,o(i),!0),this.displayAsUrl=e.framework.utils.isUrl(i)}return i.ignoreAttribute=function(e){return e&&i.ignoreAttributeMatcher.test(e)},i.ignoreAttributeMatcher=/.*\.Name\(\)$/,i}();t.FeatureAttribute=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.DATE_SHORT="d",e.DATE_LONG="D",e.TIME_SHORT="t",e.TIME_LONG="T",e.DATE_TIME_SHORT="g",e.DATE_TIME_LONG="G",e.FULL="f",e.ISO_8601="u",e.ROUND_TRIP="u",e.DEFAULT="g",e.DEFAULT_PARSING_FORMATS=[e.ISO_8601,e.DATE_TIME_SHORT,e.DATE_TIME_LONG,e.DATE_SHORT,e.DATE_LONG],e}();e.DateFormat=t;var i=function(){function e(){}return e.NUMBER="n",e.FIXED_POINT="f",e.CURRENCY="c",e.ACCOUNTING="a",e.PERCENT="p",e.ROUND_TRIP="r",e.DEFAULT=e.FIXED_POINT,e}();e.NumberFormat=i}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){function r(e,i,r){void 0===i&&(i=t.DateFormat.DEFAULT);var a=null;if(!e||!e.getTime||isNaN(e.getTime()))return"";if(!moment)throw new Error('Error: The "moment.js" library is required for formatting dates.');var s=n(e,r);if(r){var l=moment(e.toISOString());r.displayTimeZoneId&&(a=l.tz(r.displayTimeZoneId).format("Z"))}return moment(s).format(o(i,a))}function n(e,i){return i&&(i.timeZoneId||i.displayTimeZoneId)?i.displayTimeZoneId?i.timeZoneId?t.TimeZoneUtils.correctDatesForDisplayInDisplayTimeZone(e,i.timeZoneId,i.displayTimeZoneId):t.TimeZoneUtils.correctDatesForDisplayInDisplayTimeZone(e,t.TimeZoneUtils.UTC_ZONE_ID,i.displayTimeZoneId):t.TimeZoneUtils.correctDatesForDisplayInLocalTime(e,i.timeZoneId):e}function a(e,i,r){if(void 0===i&&(i=t.NumberFormat.DEFAULT),void 0===r&&(r={}),null===e||void 0===e||isNaN(e))return"";if(i=i||t.NumberFormat.DEFAULT,r=r||{},i===t.NumberFormat.ROUND_TRIP)return e.toString();if(!_globalize)throw new Error('Error: The "globalize.js" library is required for formatting numbers.');var n=i.toLowerCase();n===t.NumberFormat.CURRENCY||n===t.NumberFormat.ACCOUNTING?(i=n,i+=void 0!==r.fractionalDigits?r.fractionalDigits:"",i+=r.currency?"$"+r.currency.toUpperCase():""):n!==t.NumberFormat.NUMBER&&n!==t.NumberFormat.FIXED_POINT&&n!==t.NumberFormat.PERCENT||(i=n,i+=void 0!==r.fractionalDigits?r.fractionalDigits:"");var a=(_globalize.locale()?_globalize.locale().locale:"en")+"|"+i,s=u[a];if(!s){s=[];var o=i.split(";",3);1===o.length?(s[0]=l(o[0]),s[1]=s[0],s[2]=s[0]):2===o.length?(s[0]=l(o[0]),s[1]=l(o[1]),s[2]=s[0]):3===o.length&&(s[0]=l(o[0]),s[1]=l(o[1]),s[2]=l(o[2])),u[a]=s}return e>0?s[0](e):e<0?s[1](e):s[2](e)}function s(e,i,r){if(e instanceof Date)return e;if("number"==typeof e)return new Date(e);if(!e||"string"!=typeof e)return c;if(void 0===r){var n=parseFloat(e);if(!isNaN(n)&&isFinite(e))return new Date(n)}if(!moment)throw new Error('Error: The "moment.js" library is required for parsing dates.');r=r||t.DateFormat.DEFAULT_PARSING_FORMATS;var a=[].concat(r);a=a.map(function(e){var t=o(e);return void 0===t?moment.ISO_8601:t});var s;return(s=i?moment.utc(e,a):moment(e,a)).isValid()?s.toDate():c}function o(e,i){var r=(e=e||t.DateFormat.DEFAULT)+(i||"");switch(e){case t.DateFormat.DATE_SHORT:return"L";case t.DateFormat.DATE_LONG:return"LL";case t.DateFormat.TIME_SHORT:return"LT";case t.DateFormat.TIME_LONG:return"LTS";case t.DateFormat.DATE_TIME_SHORT:return"lll";case t.DateFormat.DATE_TIME_LONG:return"LLL";case t.DateFormat.FULL:return"LLLL";case t.DateFormat.ISO_8601:return;default:var n=h[r];if(n)return n;var a=/%?([dfFghHKmMstyz])\1*|\\.|(["'])[^\2]+\2|[^dfFghHKmMstyz\\'"]+/g,s=e.match(a);n="";for(var o=0;o<s.length;o++){var l=s[o];switch(l.startsWith("%")&&(l=l.slice(1)),l[0]){case"y":l.length<=2?n+="YY":l.length<=4?n+="YYYY":n+="YYYYY";break;case"d":l.length<=2?n+=l.slice(0,2).toUpperCase():n+=l.slice(0,4);break;case"f":case"F":n+=l.slice(0,3).replace(/[Ff]/g,"S");break;case"t":n+="A";break;case"z":n+=i?"["+i+"]":"Z";break;case"M":n+=l.slice(0,4);break;case"h":case"H":case"m":case"s":n+=l.slice(0,2);break;case"g":case"K":console.warn('The "{0}" date format specifier is not supported.'.format(l));break;default:l.startsWith('"')||l.startsWith("'")?l=l.slice(1,-1):l.startsWith("\\")&&(l=l.slice(1)),n+="["+l+"]"}}return h[r]=n,n}}function l(i,r){var n=r||{},a=/^([acfnp])(\d*)(?:\$([a-zA-Z]{3}))?$/i;if(p=i.match(a)){var s=p[1].toLowerCase(),o=Math.min(20,parseInt(p[2])),l=p[3];if(s===t.NumberFormat.CURRENCY||s===t.NumberFormat.ACCOUNTING){if(!l){var c=e.framework.applications[0];l=c&&c.configuration&&c.configuration.defaultCurrency?c.configuration.defaultCurrency:"USD"}}else l="",void 0===n.minimumFractionDigits&&(n.minimumFractionDigits=0),void 0===n.maximumFractionDigits&&(n.maximumFractionDigits=Math.max(4,n.minimumFractionDigits));return s===t.NumberFormat.PERCENT?n.style="percent":s===t.NumberFormat.ACCOUNTING?n.style="accounting":s===t.NumberFormat.FIXED_POINT&&(n.useGrouping=!1),isNaN(o)||(n.minimumFractionDigits=o,n.maximumFractionDigits=o),l?_globalize.currencyFormatter(l,n):_globalize.numberFormatter(n)}var u=/[0#]+|\.|,|%|\\.|(["'])[^\1]+\1|[^0#.,\\'"]+/g,p=i.match(u),h=!1,d="",m="",g="",f="";n.minimumFractionDigits=0,n.maximumFractionDigits=0,n.useGrouping=!1;for(var y=0;y<p.length;y++){var b=p[y];switch(b[0]){case".":h=!0;break;case",":n.useGrouping=!0;break;case"%":n.style="percent";break;case"0":case"#":h?m+=b:d+=b;break;default:b.startsWith('"')||b.startsWith("'")?b=b.slice(1,-1):b.startsWith("\\")&&(b=b.slice(1)),d||m?f+=b:g+=b}}if(d){var v=d.indexOf("0");v>=0&&(n.minimumIntegerDigits=d.length-v)}if(m){var I=m.lastIndexOf("0");n.minimumFractionDigits=I>=0?I+1:0,n.maximumFractionDigits=Math.min(20,m.length)}if(d||m){var S=_globalize.numberFormatter(n);return function(e){return void 0!==n.minimumIntegerDigits&&e<0?g+"-"+S(-1*e)+f:g+S(e)+f}}return function(e){return g+f}}var c=new Date(NaN);i.format=function(e){return e instanceof Date?r(e):"number"==typeof e?a(e):null===e||void 0===e?"":e.toString()},i.formatDate=r,i.formatDateFromNow=function(e,t){if(!e||!e.getTime||isNaN(e.getTime()))return"";if(!moment)throw new Error('Error: The "moment.js" library is required for formatting dates.');var i=n(e,t);return moment(i).fromNow()},i.formatNumber=a,i.parseDate=function(e,t){return s(e,!1,t)},i.parseUtcDate=function(e,t){return s(e,!0,t)},i.parseNumber=function(e,t){if("number"==typeof e)return e;if("boolean"==typeof e)return e?1:0;if(null===e||void 0===e)return NaN;if(!_globalize)throw new Error('Error: The "globalize.js" library is required for parsing numbers.');e=e.toString().trim(),e=e.replace(" "," ");var i=_globalize.locale()?_globalize.locale().locale:"en",r=p[i];r||(r=_globalize.numberParser(),p[i]=r);var n=1;e&&"("===e[0]&&")"===e[e.length-1]&&(n=-1,e=e.slice(1,-1));var a=r(e);if(isNaN(a)&&(a=parseFloat(e)),isNaN(a))return a;a*=n;var s=[].concat(t||[]),o=/^([acfnp])(?:\$([a-zA-Z]{3}))?$/i;return!s.length||s.some(function(t){if(r=l(t,{minimumFractionDigits:0,maximumFractionDigits:20}),e===r(a))return!0;if(t.match(o))for(var i=0;i<=20;i++){var r=l(t,{minimumFractionDigits:i,maximumFractionDigits:i});if(e===r(a))return!0}return!1})?a:NaN};var u={},p={},h={}}(t.FormatUtils||(t.FormatUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function i(){}return i.typeIdForLayerAndAttributes=function(e,t){return e.typeIdField?t[e.typeIdField]:null},i.typeFromLayerAndId=function(e,t){for(var i=0;i<e.types.length;i++)if(e.types[i].id==t)return e.types[i];return null},i.makeValueTruthy=function(e){return 0===e?"0":!1===e?"false":e},i.valuePresenterDelegate=function(r,n){var a,s;return"string"==typeof r?(s=r,n&&n.layer&&(a=n.layer.fields.filter(function(e){return e.name===s})[0])):r instanceof e.essentials.Field?s=(a=r).name:r&&r.name&&(s=r.name),function(o){return function(){var l,c=n?n.featureLayer:null,u=n?n.getType():null,p=c?c.getField(s):null;if(r instanceof t.gis.FieldInfo&&(l=r),!(p||a||l)){if(o instanceof Date){var h=n?n.defaultDateFormat:t.DateFormat.DEFAULT;return t.FormatUtils.formatDate(o,h)}if("number"==typeof o){var d=n?n.defaultNumberFormat:t.NumberFormat.DEFAULT;return t.FormatUtils.formatNumber(o,d)}return i.makeValueTruthy(o)}if(a&&a.hyperlinkLabel&&e.framework.utils.isUrl(o)&&(o=a.hyperlinkLabel),n){var m=n.esriFeature.get();if(m&&m.attributes.hasOwnProperty(s+".Name()"))return i.makeValueTruthy(m.attributes[s+".Name()"])}return l||(l=p?t.gis.FieldInfo.fromEsriField(p,c,a):t.gis.FieldInfo.fromGcxField(a)),l.isDate()&&!l.format&&n&&n.defaultDateFormat?l.format="{0:"+n.defaultDateFormat+"}":l.isNumeric()&&!l.format&&n&&n.defaultNumberFormat&&(l.format="{0:"+n.defaultNumberFormat+"}"),l.formatValue(o,u?u.id.toString():null)}}},i}();t.PresentableDelegateFactory=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.id=new Observable,this.contentType=new Observable,this.size=new Observable,this.name=new Observable,this.url=new Observable}}();e.AttachmentInfo=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t,i,r,n){this.geometries=e,this.outputSpatialReference=r,this.callback=t,this.errback=i,this.transformation=n}}();e.ProjectArgs=t}(e.commandArgs||(e.commandArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(e,t,i){if(e===t)return!0;if(null==e||null==t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r=c.difference(r,i),n=c.difference(n,i),r.length!==n.length)return!1;for(var a=0,s=r;a<s.length;a++){var o=s[a];if(e[o]!==t[o])return!1}return!0}function r(e,t){return e===t||e.type===t.type&&e.spatialReference&&t.spatialReference&&e.spatialReference.equals(t.spatialReference)}function n(e,t){return e===t||e.x==t.x&&e.y==t.y&&r(e,t)}function a(e,t){var i=r(e,t);if(i&&e.points.length===t.points.length){for(var n=0;i&&n<e.points.length;n++)i=e.points[n][0]===t.points[n][0]&&e.points[n][1]===t.points[n][1];return i}return!1}function s(e,t){var i=r(e,t);return i&&dojo.forEach(e.paths,function(e,r){if(e.length===t.paths[r].length){for(var n=0;i&&n<e.length;n++)i=e[n][0]===t.paths[r][n][0]&&e[n][1]===t.paths[r][n][1];return i?void 0:i}i=!1}),i}function o(e,t){var i=r(e,t);return i&&dojo.forEach(e.rings,function(e,r){if(e.length===t.rings[r].length){for(var n=0;i&&n<e.length;n++)i=e[n][0]===t.rings[r][n][0]&&e[n][1]===t.rings[r][n][1];return i?void 0:i}i=!1}),i}function l(e,t){return r(e,t)&&e.xmin==t.xmin&&e.xmax==t.xmax&&e.ymin==t.ymin&&e.ymax==t.ymax}var c=e.framework.utils.ArrayUtils;t.stepZoom=function(t,i,r){null==r&&(r=t.extent);var n=e.essentials.GeometryUtilities.scaleEnvelopeWithoutTranslation(r,1/i);return t.setExtent(n,!!t._fitTiledMapsToExtent),n},t.stepZoomWithPriority=function(t,i,r,n){null==r&&(r=t.getMap().extent);var a=t.essentialsMap.getMap(),s=e.essentials.GeometryUtilities.scaleEnvelopeWithoutTranslation(r,1/i),o=a.getLevel();if(void 0!==o&&null!==o&&o>-1){var l=o;return i>1?l=o+1:i<1&&(l=o-1),a.setLevel(l),s}return t.essentialsMap.extentManager.setExtentWithPriority(s,n),s},t.getExtent=function(e){if(e){if("point"==e.type){var t=e;return new esri.geometry.Extent(t.x,t.y,t.x,t.y,e.spatialReference)}return e.getExtent()}return null},t.panToPointWithPriority=function(t,i,r,n){if(i&&i.isInstanceOf(esri.geometry.Geometry)){var a=new e.essentialsHtmlViewer.mapping.infrastructure.commandArgs.ProjectArgs([i],function(e){var i=null,a=null;e&&e.length>0&&(i=e[0]),t.map&&i&&((n||void 0===n)&&t.command("ShowMap").execute(),"point"==i.type?t.site.essentialsMap.extentManager.centerAtWithPriority(i,r):"extent"==i.type?t.site.essentialsMap.extentManager.centerAtWithPriority(i.getCenter(),r):"polyline"!=i.type&&"polygon"!=i.type&&"multipoint"!=i.type||(a=i.getExtent())&&t.site.essentialsMap.extentManager.centerAtWithPriority(a.getCenter(),r))},function(e){t.trace.warning("PanToPoint: "+e.message)});t.command("Project").execute(a)}},t.zoomToExtent=function(e,t,i){this.zoomToExtentWithPriority(e,t,null,null,i)},t.zoomToExtentWithPriority=function(t,i,r,n){var a=function(e){e&&e.length>0&&((n||void 0===n)&&t.command("ShowMap").execute(),null==r?t.map.setExtent(e[0],!!t.map._fitTiledMapsToExtent):t.site.essentialsMap.extentManager.setExtentWithPriority(e[0],r),t.event("MapStartupExtentChangedEvent").publish(e[0]))};if(i&&i.isInstanceOf(esri.geometry.Extent)){if(!i.spatialReference&&t.map.spatialReference)return i.spatialReference=t.map.spatialReference,void a([i]);i.spatialReference&&!i.spatialReference.toJson&&(i.spatialReference.wkid||i.spatialReference.wkt)&&(i.spatialReference=new esri.SpatialReference(i.spatialReference));var s=new e.essentialsHtmlViewer.mapping.infrastructure.commandArgs.ProjectArgs([i],a,function(e){t.trace.warning("ZoomToExtent: "+e.message)});t.command("Project").execute(s)}},t.getClosestScale=function(e,t,i){var r=e.__tileInfo&&e.__tileInfo.lods;if(!r||!r.length)return i;for(var n=0,a=0;a<r.length;a++){if(r[a].scale===i)return i;if(t===u.LessThan){if(i<r[a].scale)continue}else if(r[a].scale>i){n=r[a].scale;continue}return t===u.LessThan?r[a].scale:n}},function(e){e[e.LessThan=0]="LessThan",e[e.GreaterThan=1]="GreaterThan"}(t.ScaleChangeMode||(t.ScaleChangeMode={}));var u=t.ScaleChangeMode;t.cloneEsriFeature=function(e){var t=new esri.Graphic(e.toJson());return t._graphicsLayer=e._graphicsLayer,t},t.esriFeatureAttributesEqual=i,t.esriFeaturesEqual=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;var r=["timestamp","clusterId","clusterCount","extent"],n=e.getLayer();if(n&&n instanceof esri.layers.FeatureLayer||(n=t.getLayer()),n instanceof esri.layers.FeatureLayer){var a=n.objectIdField;if(a&&e.attributes&&t.attributes&&e.attributes[a]===t.attributes[a])return!0;if(n.editFieldsInfo)for(var s=0,o=Object.keys(n.editFieldsInfo);s<o.length;s++){var l=o[s];r.push(n.editFieldsInfo[l])}}return i(e.attributes,t.attributes,r)},t.esriGeometriesEqual=function(e,t){switch(e?e.type:null){case"point":return n(e,t);case"multipoint":return a(e,t);case"polyline":return s(e,t);case"polygon":return o(e,t);case"extent":return l(e,t)}return!1},t.compareTypeSR=r,t.esriPointsEqual=n,t.esriMultipointsEqual=a,t.esriPolylinesEqual=s,t.esriPolygonsEqual=o,t.esriExtentsEqual=l,t.findFeatureInLayer=function(t,i){if(!t||!i)return null;var r=i.objectIdField;t.attributes[r]&&t.attributes[r];var n=i.graphics;if(n.length<1)return null;var a=["timestamp","clusterId","clusterCount","extent"];if(i.editFieldsInfo)for(var s in i.editFieldsInfo)i.editFieldsInfo.hasOwnProperty(s)&&a.push(i.editFieldsInfo[s]);var o=function(t){return e.framework.utils.ArrayUtils.contains(a,t)},l=function(e){var t=0;for(var i in e)!o(i)&&e.hasOwnProperty(i)&&++t;return t},c=n[0].attributes;if(l(c)!==l(t.attributes))return null;var u=0,p=[],h=[];for(var d in c){var m=o(d);if(!(m||c.hasOwnProperty(d)&&t.attributes.hasOwnProperty(d)))return null;m||(p.push(d),h.push(d),++u)}for(var g=0;g<u;++g)if(p[g]!==h[g])return null;for(var f=0;f<n.length;f++){var y=n[f];if(l(c)===l(t.attributes)&&y.attributes[r]===t.attributes[r])return y._graphicsLayer=i,y}return null},t.findFeatureInMap=function(e,t,i){var r=null;if(i&&(r=this.findFeatureInLayer(e,i)))return r._graphicsLayer=i,r;for(var n=t.getFeatureServices(),a=0;a<n.length;a++){var s=n[a].serviceLayer;if((!i||s!==i)&&(r=this.findFeatureInLayer(e,s)))return r}return!r&&e.getLayer&&e.getLayer()&&(r=e),r},t.getThumbnailUri=function(t,i,r,n,a){void 0===r&&(r=150),void 0===n&&(n=150),void 0===a&&(a=20);var s=new e.essentials.ReportParameters;return s.outputFormat="PNG",s.includeData=!0,s.imageWidth=r,s.imageHeight=n,s.resolution={displayName:"custom",dpi:a},s.customExtent=i||t.map.extent,s.extentType=e.essentials.ReportParameters.CUSTOM_EXTENT,s.populateMapGraphicsLayers(t.map),new Promise(function(e,i){t.site.essentialsMap.exportMap(s,function(t){e(t.data?"data:image/png;base64,{0}".format(t.data):t.href?t.href:null)},function(i){t.trace.error("Error exporting map for thumbnail: {0}".format(i.message)),e(null)})})}}(t.MapUtils||(t.MapUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(i){var r=function(){function r(t){var r=this;this._isAttachmentInfosLoaded=!1,this._defaultFieldFormatString="{0}: {1}",this.token=null,this.featureLayer=null,this.featureSet=null,this.labelFormat=new e.framework.ui.LazyObservable,this.minScale=new e.framework.ui.LazyObservable,this.maxScale=new e.framework.ui.LazyObservable,this.zoomScale=new e.framework.ui.LazyObservable,this.zoomFactor=new e.framework.ui.LazyObservable,this.zoomExtent=new Observable,this.borderColor=new e.framework.ui.LazyObservable,this.borderWidth=new e.framework.ui.LazyObservable,this.fillColor=new e.framework.ui.LazyObservable,this.id=new e.framework.ui.LazyObservable,this.attributes=new ObservableCollection,this.label=new e.framework.ui.LazyObservable,this.plainLabel=new e.framework.ui.LazyObservable,this.description=new e.framework.ui.LazyObservable,this.descriptionFormat=new e.framework.ui.LazyObservable,this.longDescription=new e.framework.ui.LazyObservable,this.longDescriptionFormat=new e.framework.ui.LazyObservable,this.hyperlinks=new ObservableCollection,this.extendedProperties=new ObservableCollection,this.attachmentInfos=null,this.attachmentInfosInitialized=new Observable(!1),this.hasAttachments=new Observable(!1),this.hasRelationships=new Observable(!1),this.hasVisibleRelationships=new Observable(!1),this.hasGeometry=new e.framework.ui.LazyObservable,this.hasValidGeometry=new e.framework.ui.LazyObservable,this.iconUri=new e.framework.ui.LazyObservable,this.linkedAttributes=new ObservableCollection,this.dataLinkingResults=new ObservableCollection,this.defaultNumberFormat=i.NumberFormat.DEFAULT,this.defaultDateFormat=i.DateFormat.DEFAULT,this.isModified=!1,this.timeZoneId=null,this.displayTimeZoneId=null,this._allowUnsafeContent=!1,this._resolveLayerFields=!1,this._attributeValueBindingTokens={};var n=null;if(t&&t.hasOwnProperty("graphic")&&(this._graphic=t.graphic),t&&t.hasOwnProperty("featureLayer")&&(this.featureLayer=t.featureLayer),t&&t.hasOwnProperty("layer")&&(n=t.layer)&&!this.featureLayer&&n.getFeatureLayer().then(function(e){r.featureLayer=e,e&&r._refreshPresentableValues()}),t&&t.hasOwnProperty("resolveLayerFields")?this._resolveLayerFields=t.resolveLayerFields:n&&n.fields&&(this._resolveLayerFields=!0),t&&t.hasOwnProperty("allowUnsafeContent")?this._allowUnsafeContent=t.allowUnsafeContent:this._allowUnsafeContent=!1,t&&t.hasOwnProperty("timeZoneId")&&(this.timeZoneId=t.timeZoneId),t&&t.hasOwnProperty("displayTimeZoneId")&&(this.displayTimeZoneId=t.displayTimeZoneId),this.token=e.framework.utils.alphaNumericToken(),this.esriFeature=new Observable(this._graphic),this.esriFeature.bind(this,function(){r._graphic=r.esriFeature.get(),r.loadAttributes(r._resolveLayerFields),r._setupLinkedAttributes(),r.attachmentInfos.clear(),r._isAttachmentInfosLoaded=!1,r.attachmentInfosInitialized.set(!1),r._refreshPresentableValues()}),this.connectDelegates(),n){if(this.layer=n,this.hasAttachments.set(this.layer.hasAttachments),this.layer.relationships&&this.layer.relationships.length>0){this.hasRelationships.set(!0);for(var a=0;a<this.layer.relationships.length;a++)if(this.layer.relationships[a].visible){this.hasVisibleRelationships.set(!0);break}}null!=n.featureHyperlinks&&this.hyperlinks.addItems(n.featureHyperlinks)}this.loadAttributes(this._resolveLayerFields),this.isModified=!1,this._prepAttachmentInfos(),this._graphic&&this._setupLinkedAttributes()}return r.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var i=this.extendedProperties.getAt(t);if(i&&i.name==e)return i.value}return null},r.prototype.setExtendedProperty=function(e,t){for(var i=0;i<this.extendedProperties.getLength();i++){var r=this.extendedProperties.getAt(i);if(r&&r.name==e)return void(r.value=t)}this.extendedProperties.addItem({name:e,value:t})},r.prototype.connectDelegates=function(){var e=this;this.hasGeometry.delegateGetter=function(){return!(!e._graphic||!e._graphic.geometry)},this.hasValidGeometry.delegateGetter=function(){return!(!e._graphic||!e._graphic.geometry)&&i.GeometryUtils.isValidGeometry(e._graphic.geometry)},this.id.cacheDelegateResults=!0,this.id.delegateGetter=function(){var t="";if(e._graphic&&e.layer){var i=null;e.layer&&(i=e.layer.getObjectIdFieldName()),i&&e._graphic.attributes&&e._graphic.attributes.hasOwnProperty(i)&&(t=e._graphic.attributes[i])}return t},this.label.delegateGetter=function(){var t=null,r=e.labelFormat.get();null!=(t=e.formatTemplateString(r))&&void 0!=t&&t.toString().trim()||void 0!=(t=e._getDefaultFieldValue())&&null!=t&&e.layer&&(t=e.layer.displayName&&e.layer.displayName.toString().trim()?e.layer.displayName+(t.toString().trim()?", "+t:""):t.toString().trim()?t:"");var n={allowFrames:!1,uriTransformer:function(e,t){return t.type!==i.FilterUtils.UriType.NavigableLink?e:/^mailto\:/.test(e)?e:"command:OpenWebPage?"+e}};return i.FilterUtils.sanitize(t,n)},this.plainLabel.delegateGetter=function(){return i.FilterUtils.stripHtml(e.label.get())},this.labelFormat.delegateGetter=function(){return e.layer&&e.layer.featureLabel?e.layer.featureLabel:e.layer&&e.layer.displayField?"{"+e._sanitizeFieldName(e.layer.displayField.name)+"}":e.featureSet&&e.featureSet.esriFeatureSet&&e.featureSet.esriFeatureSet.displayFieldName&&e.featureSet.layer&&e.featureSet.layer.displayName?e.featureSet.layer.displayName+", {"+e.featureSet.esriFeatureSet.displayFieldName+"}":e.featureSet&&e.featureSet.esriFeatureSet&&e.featureSet.esriFeatureSet.displayFieldName?"{"+e._sanitizeFieldName(e.featureSet.esriFeatureSet.displayFieldName)+"}":""},this.borderColor.delegateGetter=function(){return e.layer&&e.layer.featureBorderColor?e.layer.featureBorderColor:null},this.borderWidth.delegateGetter=function(){return e.layer&&"number"==typeof e.layer.featureBorderWidth&&e.layer.featureBorderWidth>=0?e.layer.featureBorderWidth:null},this.fillColor.delegateGetter=function(){return e.layer&&e.layer.featureFillColor?e.layer.featureFillColor:null},this.description.delegateGetter=function(){var t=e.descriptionFormat.get();return e.formatTemplateString(t)},this.descriptionFormat.delegateGetter=function(){return e.layer&&e.layer.featureDescription?e.layer.featureDescription:null},this.longDescription.delegateGetter=function(){var t=e.longDescriptionFormat.get();return e.formatTemplateString(t)},this.longDescriptionFormat.delegateGetter=function(){return e.layer&&e.layer.featureLongDescription?e.layer.featureLongDescription:e.descriptionFormat.get()},this.minScale.delegateGetter=function(){return e.layer&&!isNaN(e.layer.minScale)?e.layer.minScale:1/0},this.maxScale.delegateGetter=function(){return e.layer&&!isNaN(e.layer.maxScale)?e.layer.maxScale:null},this.iconUri.delegateGetter=function(){return e.layer&&e.layer.iconUri?e.layer.iconUri:e.featureSet&&e.featureSet.iconUri&&e.featureSet.iconUri.get()?e.featureSet.iconUri.get():null},this.zoomScale.delegateGetter=function(){return e.layer&&e.layer.featureZoomScale?e.layer.featureZoomScale:null},this.zoomFactor.delegateGetter=function(){return e.layer&&e.layer.featureZoomFactor?e.layer.featureZoomFactor:null}},r.prototype.withinScaleRange=function(e){return!!(0==this.maxScale.get()&&this.minScale.get()==1/0||isNaN(this.maxScale.get())&&isNaN(this.minScale.get()))||!!e&&(this.maxScale.get()<=e&&e<=this.minScale.get())},r.prototype.calculateScaleToMakeVisible=function(e){return this.withinScaleRange(e)?e:e<this.maxScale.get()?this.maxScale.get():this.minScale.get()},r.prototype._sanitizeFieldName=function(e){return e?e.replace(/\W/g,""):""},r.prototype._getDefaultFieldValue=function(){var e="",t=this.esriFeature.get();if(t&&this.layer&&this.layer.displayField&&null!==(e=t.attributes[this.layer.displayField.name])&&void 0!==e&&(e=e.toString().trim()),null!=e&&void 0!=e&&e||!t||!t.attributes||null!==(e=t.attributes.OBJECTID)&&void 0!==e&&(e=e.toString().trim()),(null==e||void 0==e||!e)&&t&&t.attributes)for(var i in t.attributes)if(null!==(e=t.attributes[i])&&void 0!==e&&(e=e.toString().trim()),e)break;return String.escapeHtmlEncode(e)},r.prototype._prepAttachmentInfos=function(){var e=this,t=new ObservableCollection,i=t.get;t.get=function(){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),i.call(t)};var r=t.getItems;t.getItems=function(){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),r.call(t)};var n=t.getAt;t.getAt=function(i){return e._isAttachmentInfosLoaded||e._loadAttachmentsInfos(),n.call(t,i)},this.attachmentInfos=t},r.prototype.loadAttributes=function(e){var t=this,i={};this.attributes.get().forEach(function(e){i[e.name.get()]=e.value.get();var r=t._attributeValueBindingTokens[e.name.get()];r&&e.value.unbind(r)}),this.attributes.clear(),this._attributeValueBindingTokens={};var r=this.getAttributesFromEsriFeature(this._graphic.attributes,e);r.forEach(function(e){var r=e.name.get(),n=e.value.get();t._attributeValueBindingTokens[r]=e.value.bind(t,function(){t.isModified=!0}),t.isModified=t.isModified||i.hasOwnProperty(r)&&n!==i[r]||!i.hasOwnProperty(r)});var n=this._graphic.attributes||{};this.isModified=this.isModified||Object.keys(i).some(function(e){return!n.hasOwnProperty(e)}),this.attributes.addItems(r)},r.prototype.getAttributesFromEsriFeature=function(r,n){var a=this,s=[];if(!1!==n&&this.layer&&this.layer.fields){var o=null;this.layer.mapService&&(o=this.layer.mapService.serviceLayer);for(var l=[],c=0;c<this.layer.fields.length;c++){var u,p=this.layer.fields[c];r&&(p.name||p.alias)&&(u=r.hasOwnProperty(p.name)?r[p.name]:r[p.alias]),e.essentialsHtmlViewer.mapping.infrastructure.FeatureAttribute.ignoreAttribute(p.name)?l.push(p):void 0===u||null==u?s.push(new i.FeatureAttribute("",p.name,p.alias,p.displayName,p.visible,i.PresentableDelegateFactory.valuePresenterDelegate(p,this),p.dataType)):s.push(new i.FeatureAttribute(u,p.name,p.alias,p.displayName,p.visible,i.PresentableDelegateFactory.valuePresenterDelegate(p,this),p.dataType))}for(b=0;b<l.length;b++){var h=l[b];if(h.visible){var d=s.filter(function(e){return e.name.get()===h.name.substr(0,h.name.length-".Name()".length)}),m=1===d.length?d[0]:null;m&&(m.visible.get()||m.visible.set(!0),m.alias.set(h.alias),m.displayName.set(h.displayName))}}if(o instanceof esri.layers.WMSLayer)for(var g in r){for(var f=!1,y=r[g],b=0;b<this.layer.fields.length;b++)if(g===this.layer.fields[b].name){f=!0;break}f||s.push(new i.FeatureAttribute(y,g))}}else if(this.featureLayer)this.featureLayer.fields.forEach(function(n){var o=n.alias?n.alias:n.name;if(n.type===e.essentials.EsriFieldTypes.esriFieldTypeDate){var l=t.infrastructure.gis.FieldInfo.fromEsriField(n,a.featureLayer);l.timeZoneId||(l.timeZoneId=a.timeZoneId),l.displayTimeZoneId||(l.displayTimeZoneId=a.displayTimeZoneId),!a.layer&&a.defaultDateFormat&&(l.format="{0:"+a.defaultDateFormat+"}"),s.push(new i.FeatureAttribute(r[n.name],n.name,o,o,!0,i.PresentableDelegateFactory.valuePresenterDelegate(l,null)))}else s.push(new i.FeatureAttribute(r[n.name],n.name,o,o,!0,i.PresentableDelegateFactory.valuePresenterDelegate(n.name,a)))});else if(this.featureSet&&this.featureSet.attributes&&this.featureSet.attributes.length()>0&&r)for(b=0;b<this.featureSet.attributes.length();b++){var v=this.featureSet.attributes.getAt(b),I=v.name.get();e.essentialsHtmlViewer.mapping.infrastructure.FeatureAttribute.ignoreAttribute(I)||r.hasOwnProperty(I)&&s.push(new i.FeatureAttribute(r[I],I,v.alias.get(),v.displayName.get(),v.visible.get(),i.PresentableDelegateFactory.valuePresenterDelegate(I,this)))}else if(r)for(var S in r)s.push(new i.FeatureAttribute(r[S],S,S,S,!0,i.PresentableDelegateFactory.valuePresenterDelegate(S,this)));return s},r.prototype.getAttributes=function(e){for(var t=this.linkedAttributes.get(),r=[],n=0;n<t.length;n++){var a=t[n];if(0===n)for(var s=this.attributes.get(),o=0;o<s.length;o++)r.push(s[o]);else{var l=a.attributes;for(var c in l)l.hasOwnProperty(c)&&r.push(new i.FeatureAttribute(l[c],c,c,c,!0,i.PresentableDelegateFactory.valuePresenterDelegate(null,null)))}}return r},r.prototype.getPrimaryKeyValue=function(){var e=null;if(this.layer&&this.layer.primaryKeyField){var t=this.layer.primaryKeyField;t&&(e=this._graphic.attributes[t.name])}return e},r.prototype.getFeatureUrl=function(){var t=null,i=this.layer.getLayerUrl?this.layer.getLayerUrl():this.layer.url,r=null;if(this.layer instanceof e.essentials.Layer)r=this.getPrimaryKeyValue();else if(this.layer instanceof esri.layers.Layer){var n=this.layer;r=this.esriFeature.get().attributes[n.objectIdField]}return i&&r&&(t=i+"/"+r),t},r.prototype.getType=function(){if(!this.featureLayer)return null;var e=i.PresentableDelegateFactory.typeIdForLayerAndAttributes(this.featureLayer,this._graphic.attributes);return null!==e?i.PresentableDelegateFactory.typeFromLayerAndId(this.featureLayer,e):void 0},r.prototype.structurallyEquals=function(t){return!!(t&&t instanceof e.essentialsHtmlViewer.mapping.infrastructure.Feature)&&(this===t||(!(!this._graphic||!t._graphic||this._graphic!==t._graphic)||null!=this._graphic&&(null!=t._graphic&&(this._getLayerUniqueId()==t._getLayerUniqueId()&&this.id.get()===t.id.get()&&(!String.isNullOrEmpty(this.id.get())||i.MapUtils.esriFeaturesEqual(this._graphic,t._graphic))))))},r.prototype.equals=function(t){if(!(t&&t instanceof e.essentialsHtmlViewer.mapping.infrastructure.Feature&&this._graphic&&t._graphic))return!1;if(this===t)return!0;var r=this._graphic.geometry,n=t._graphic.geometry,a=this.id.get()===t.id.get()||this.id.get()&&t.id.get()&&this.id.get()==t.id.get(),s=this.layer===t.layer||this.layer&&t.layer&&this.layer.id==t.layer.id,o=this.layer===t.layer||this.layer&&t.layer&&this.layer.mapService===t.layer.mapService||this.layer&&t.layer&&this.layer.mapService&&t.layer.mapService&&this.layer.mapService.id==t.layer.mapService.id,l=r===n||r&&n&&r.declaredClass==n.declaredClass;if(!(a&&s&&o&&l))return!1;if(!e.essentialsHtmlViewer.mapping.infrastructure.MapUtils.esriFeaturesEqual(this._graphic,t._graphic))return!1;if(r===n)return!0;switch(r.declaredClass){case"esri.geometry.Point":case"esri.geometry.ScreenPoint":return i.MapUtils.esriPointsEqual(r,n);case"esri.geometry.MultiPoint":return i.MapUtils.esriMultipointsEqual(r,n);case"esri.geometry.Polyline":return i.MapUtils.esriPolylinesEqual(r,n);case"esri.geometry.Polygon":return i.MapUtils.esriPolygonsEqual(r,n);case"esri.geometry.Extent":return i.MapUtils.esriExtentsEqual(r,n);default:throw new Error("Warning: equals() in Feature.ts - declared class does not match known geometry.")}},r.prototype._loadAttachmentsInfos=function(){var t=this;if(this._isAttachmentInfosLoaded=!0,!this.layer)throw new Error("Error fetching attachment infos: Feature was not associated with any known layer.");var i={url:this.getFeatureUrl()+"/attachments/?f=json&ts={0}".format((new Date).getTime()),handleAs:"json"},r=this.layer.mapService&&this.layer.mapService.serviceToken?this.layer.mapService.serviceToken:null,n=this.layer;!this.layer.mapService&&n.credential&&n.credential.token&&(r=n.credential.token),r&&(i.url+="&token="+encodeURIComponent(r));var a=null;try{var s=this.layer.mapService.serviceLayer;a=s.queryAttachmentInfos(parseInt(this.id.get()))}catch(e){a=esri.request(i)}a.then(function(i){if(i.length>0&&!i.attachmentInfos&&i instanceof Array){i.attachmentInfos=[];for(var n=0;n<i.length;n++)i.attachmentInfos[n]=i[n]}if(i&&i.attachmentInfos&&i.attachmentInfos.length>0){var a;for(a=0;a<i.attachmentInfos.length;a++){var s=i.attachmentInfos[a],o=new e.essentialsHtmlViewer.mapping.infrastructure.AttachmentInfo;o.id.set(s.id),o.contentType.set(s.contentType),o.size.set(s.size),o.name.set(s.name);var l="{0}/attachments/{1}".format(t.getFeatureUrl(),s.id);r&&(l+="?token="+r),o.url.set(l),t.attachmentInfos.addItem(o)}}t.attachmentInfosInitialized.set(!0)},function(e){t.attachmentInfosInitialized.set(!0)})},r.prototype.formatTemplateString=function(t){var i=this;return t?t.replace(/{{.+?}}|{.+?}/g,function(t){if(t.match(/{{.+?}}/g))return t.substring(1,t.length-1);var r=t.substring(1,t.length-1),n="",a=r.match(/(.*)\.Name\(\)$/);a&&(r=a[1]);for(var s=i.getAttributes(),o=0;o<s.length;o++)if(s[o].name&&s[o].name.get()===r||s[o].alias&&s[o].alias.get()===r){if(i.layer&&i.layer.getFieldByName(r)&&e.framework.utils.isUrl(s[o].value.get())){n=s[o].value.get();break}n=s[o].presentableValue.get();break}if(!n&&i.layer&&(n=e.essentials.utilities.StringUtilities.replaceLayerTokens(r,i.layer)),!n&&i.layer&&i.layer.mapService&&(n=e.essentials.utilities.StringUtilities.replaceMapServicetokens(r,i.layer.mapService)),!n){var l={};if(i.parseDataLinkId(r,l)&&i.dataLinkingResults.get())for(o=0;o<i.dataLinkingResults.length();o++){var c=i.dataLinkingResults.getAt(o);if(c.dataLink.get()&&c.dataLink.get().id===l.dataLinkId){if("_rowcount"===l.attributeName.toLowerCase())n=c.table?c.table.get().rows.length:0;else if(c.table.get())for(var u=c.table.get(),p=0;p<u.columns.length;p++)if(u.columns[p].toLowerCase()===l.attributeName.toLowerCase()){u.rows.length>0&&(n=u.rows[0].row[p]);break}break}}}return n||"RestToken"!==r||(n=e.essentials.RestHelperHTTPService.token),i._allowUnsafeContent?null==n&&(n=""):n=n||0===n?String.escapeHtmlEncode(n.toString()):"",null!==n&&void 0!==n||(n=""),n}):""},r.prototype.parseDataLinkId=function(e,t){var i=e.indexOf(".");return!(i<0)&&(t.dataLinkId=e.substring(0,i),t.attributeName=e.substring(i+1),!0)},r.prototype._getLayerUniqueId=function(){var e="";return this.layer&&(e=this.layer.id,this.layer.mapService&&(e=this.layer.mapService.id+"/"+e)),e},r.prototype._setupLinkedAttributes=function(){var t=new e.essentialsHtmlViewer.mapping.infrastructure.AttributeGroup;t.owner=this._graphic,t.attributes=this._graphic.attributes,this.linkedAttributes.clear(),this.linkedAttributes.addItem(t)},r.prototype._refreshPresentableValues=function(){this.attributes.get().forEach(function(e){e.presentableValue.clear(),e.presentableValue.pulse()}),this.label.clear(),this.plainLabel.clear(),this.description.clear(),this.longDescription.clear(),this.label.pulse(),this.plainLabel.pulse(),this.description.pulse(),this.longDescription.pulse()},r}();i.Feature=r}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){e.isKmlProperty="__isKml";var t=function(t){function i(i){t.call(this,i);var r=this.esriFeature.get(),n=r?r.attributes||{}:{};this.labelFormat.set(n.hasOwnProperty("name")?"{name}":"{id}"),this.descriptionFormat.set("{snippet}"),this.longDescriptionFormat.set(n.hasOwnProperty("balloonStyleText")?"{balloonStyleText}":"{description}"),r&&!r[e.isKmlProperty]&&(r[e.isKmlProperty]=!0)}return __extends(i,t),i}(e.Feature);e.KmlFeature=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(e){e[e.Unresolved=0]="Unresolved",e[e.Resolving=1]="Resolving",e[e.Resolved=2]="Resolved"}(t.DataLinksState||(t.DataLinksState={}));var i=t.DataLinksState,r=function(){function r(r){var n=this;this.id="",this.featureLayer=null,this.displayName=new e.framework.ui.LazyObservable,this.features=new ObservableCollection,this.attributes=new ObservableCollection,this.iconUri=new e.framework.ui.LazyObservable,this.extendedProperties=new ObservableCollection,this.isSelectedInCollection=new Observable(!1),this.dataLinksResolved=new Observable(!1),this.defaultNumberFormat=t.NumberFormat.DEFAULT,this.defaultDateFormat=t.DateFormat.DEFAULT,this._objectIds=new t.Dictionary,this._watchHandles={},this._dataLinksState=i.Unresolved;var a=null,s=null;(r=r||{}).hasOwnProperty("esriFeatureSet")&&(a=r.esriFeatureSet),r.hasOwnProperty("featureLayer")&&(this.featureLayer=r.featureLayer),r.hasOwnProperty("layer")&&(s=r.layer),r.hasOwnProperty("allowUnsafeContent")?this._allowUnsafeContent=r.allowUnsafeContent:this._allowUnsafeContent=!1,r.hasOwnProperty("app")&&(this.app=r.app),this.defaultDateFormat=r.defaultDateFormat||t.DateFormat.DEFAULT,this.defaultNumberFormat=r.defaultNumberFormat||t.NumberFormat.DEFAULT,this.uniqueId="fs_"+e.framework.utils.alphaNumericToken(),this.esriFeatureSet=a,s&&(this.layer=s,this.layer&&this.layer.mapService&&(this.id="{0}/{1}".format(this.layer.mapService.id,this.layer.id))),this.displayName.delegateGetter=function(){return n.layer&&n.layer.displayName?n.layer.displayName:""},this.iconUri.delegateGetter=function(){return n.layer&&n.layer.iconUri?n.layer.iconUri:""},this.loadFeatures(),this.loadAttributes()}return Object.defineProperty(r.prototype,"dataLinksState",{get:function(){return this._dataLinksState},enumerable:!0,configurable:!0}),r.prototype.setDataLinksState=function(e){this._dataLinksState=e,this.dataLinksResolved.set(e===i.Resolved)},r.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var i=this.extendedProperties.getAt(t);if(i&&i.name==e)return i.value}return null},r.prototype.setExtendedProperty=function(e,t){for(var i=0;i<this.extendedProperties.getLength();i++){var r=this.extendedProperties.getAt(i);if(r&&r.name==e)return void(r.value=t)}this.extendedProperties.addItem({name:e,value:t})},r.prototype.addFeature=function(t,i){var r=new e.framework.events.CollectionChangedArgs,n=this.features.length();return r.type="append",r.rangeStart=n,r.rangeEnd=n,r.sender=this.features,!!this._addFeatureWithoutNotification(t,i)&&(this.features.bindingEvent.publish(r),!0)},r.prototype._addFeatureWithoutNotification=function(e,t){if(!e)throw new Error("Feature cannot be null.");var i=this.features.getItems();return!(!t&&this.containsFeature(e))&&(e.featureSet=this,i.push(e),this.esriFeatureSet&&this.esriFeatureSet.features&&this.esriFeatureSet.features.push(e.esriFeature.get()),!0)},r.prototype.removeFeature=function(t){if(!t)throw new Error("Feature cannot be null.");var i=t.id.get();if(!String.isNullOrEmpty(i)&&!this._objectIds.containsKey(i))return!1;var r=new e.framework.events.CollectionChangedArgs;r.type="remove";for(var n=this.features.length();n--;){var a=this.features.getAt(n);if(a&&a.structurallyEquals(t))return r.rangeStart=n,r.rangeEnd=n,r.sender=this.features,this.features.bindingEvent.publish(r),this._removeWithoutNotificationAt(n),!0}return!1},r.prototype._removeWithoutNotificationAt=function(t){var i=this.features.getItems();if(0<=t&&t<i.length){var r=i[t],n=r.esriFeature.get();return n&&this.esriFeatureSet&&this.esriFeatureSet.features&&e.framework.utils.ArrayUtils.removeItem(this.esriFeatureSet.features,n),r.featureSet=null,e.framework.utils.ArrayUtils.remove(i,t,t),!0}return!1},r.prototype.containsFeature=function(e){if(!e)throw new Error("Feature cannot be null.");var t=e.id.get();if(t&&this._objectIds.containsKey(t))return!0;for(var i=0;i<this.features.length();i++)if(this.features.getAt(i).structurallyEquals(e))return!0;return!1},r.prototype.clearFeatures=function(){if(0!=this.features.length()){var t=new e.framework.events.CollectionChangedArgs;for(t.type="clear",t.rangeStart=0,t.rangeEnd=this.features.length()-1,t.sender=this.features,this.features.bindingEvent.publish(t);this.features.length()>0;)this._removeWithoutNotificationAt(0)}},r.prototype.loadGeometries=function(i,r,n){var a=this,s=new dojo.Deferred;if(!this.layer){o=new Error("loadGeometries: Layer must be present.");return e.deferredReject(s,o),"function"==typeof n&&n(o),s}if(!this.layer.primaryKeyField){var o=new Error("loadGeometries: Layer must have a PrimaryKeyField to load geometries.");return e.deferredReject(s,o),"function"==typeof n&&n(o),s}var l=this.layer.primaryKeyField.name;i||(i=this.features.getItems());var c=[];if(i){var u;for(u=0;u<i.length;u++){var p=i[u];if(!p.hasGeometry.get()){var h=p.esriFeature.get();h&&h.attributes[l]&&c.push(p)}}}if(c.length>0){var d=[];for(u=0;u<c.length;u++)d.push(c[u].esriFeature.get().attributes[l]);var m=t.taskUtils.getQueryTask(this.layer),g=new esri.tasks.Query;g.objectIds=d,g.returnGeometry=!0,g.outFields=[l],this.layer&&this.layer.mapService&&this.layer.mapService.essentialsMap&&this.layer.mapService.essentialsMap.site&&this.layer.mapService.essentialsMap.site.getMap()&&(g.outSpatialReference=this.layer.mapService.essentialsMap.site.getMap().spatialReference),m.execute(g).then(function(t){if(t&&t.features&&t.features.length>0)for(var i=0;i<t.features.length;i++){var n=t.features[i],o=a._findFeature(n.attributes[l],l,c);o&&(o.esriFeature.get().geometry=n.geometry)}e.deferredResolve(s,void 0),"function"==typeof r&&r()},function(t){var i=new Error("loadGeometries: Query error: "+t.message);e.deferredReject(s,i),"function"==typeof n&&n(i)})}else e.deferredResolve(s,void 0),"function"==typeof r&&r();return s},r.prototype.findFeatureById=function(e){return this._objectIds.get(e)},r.prototype.findFeatureByEsriFeature=function(e){var i=null,r=e.getLayer();if(r&&this.layer&&this.layer.mapService&&this.layer.mapService.serviceLayer!==r)return null;for(var n=0;n<this.features.length();n++){var a=this.features.getAt(n);if(a.esriFeature&&(a.esriFeature.get()===e||t.MapUtils.esriFeaturesEqual(a.esriFeature.get(),e))){i=a;break}}return i},r.prototype._findFeature=function(e,t,i){var r,n,a=null;if(i&&i.length>0)for(r=0;r<i.length;r++)if((n=i[r].esriFeature.get())&&n.attributes&&n.attributes[t]==e){a=i[r];break}return a},r.prototype.loadFeatures=function(){this._watchFeatureSetChanges(),this.features.clear();var e,i=[];if(this.esriFeatureSet&&this.esriFeatureSet.features)for(var r=0;r<this.esriFeatureSet.features.length;++r){var n=this.esriFeatureSet.features[r],a={graphic:n,layer:this.layer,featureLayer:this.featureLayer,resolveLayerFields:!0,allowUnsafeContent:this._allowUnsafeContent};(e=n&&n[t.isKmlProperty]?new t.KmlFeature(a):new t.Feature(a)).featureSet=this,e.defaultDateFormat=this.defaultDateFormat,e.defaultNumberFormat=this.defaultNumberFormat,i.push(e)}this.features.useThrottling=!1,this.features.addItems(i)},r.prototype.loadAttributes=function(){this.attributes.clear();var i=[],r=[];if(this.layer&&this.layer.fields){for(var n=0;n<this.layer.fields.length;n++){var a=this.layer.fields[n];e.essentialsHtmlViewer.mapping.infrastructure.FeatureAttribute.ignoreAttribute(a.name)?r.push(a):i.push(new t.FeatureAttribute("",a.name,a.alias,a.displayName,a.visible,t.PresentableDelegateFactory.valuePresenterDelegate(a,null)))}for(var s=0;s<r.length;s++){var o=r[s];if(o.visible){var l=i.filter(function(e){return e.name.get()===o.name.substr(0,o.name.length-".Name()".length)}),c=1===l.length?l[0]:null;c&&(c.visible.get()||c.visible.set(!0),c.alias.set(o.alias),c.displayName.set(o.displayName))}}}else if(this.esriFeatureSet&&this.esriFeatureSet.features&&this.esriFeatureSet.features.length>0){var u=this.esriFeatureSet.features[0];for(var p in u.attributes)u.attributes.hasOwnProperty(p)&&i.push(new t.FeatureAttribute("",p,p,p))}this.attributes.addItems(i)},r.prototype.featureSetChanged=function(e){if("append"==e.type||"insert"==e.type)for(i=e.rangeStart;i<=e.rangeEnd;i++){var t=this.features.getAt(i);t.featureSet=this,(r=t.id.get())&&this._objectIds.set(r,t)}if("remove"==e.type||"clear"==e.type)for(var i=e.rangeStart;i<=e.rangeEnd;i++){this.features.getAt(i).featureSet=null;var r=this.features.getAt(i).id.get();r&&this._objectIds.remove(r)}},r.prototype._applyDataLinks=function(t,i,r,n,a){for(var s=0;s<t.features.length();s++)if((m=t.features.getAt(s)).linkedAttributes.length()>0){var o=m.linkedAttributes.getAt(0);m.linkedAttributes.clear(),m.linkedAttributes.addItem(o),m.dataLinkingResults.clear()}for(var l=0;l<r.length;l++)for(var c=n[l],u=r[l],p=0;p<c.length;p++){var h=c[p],d=new e.essentialsHtmlViewer.mapping.infrastructure.DataLinkingResult;d.table.set(h.linkedData),d.dataLink.set(u);var m=i[h.index];m.dataLinkingResults.addItem(d),a&&a(m),u.isOneToOne&&m.linkedAttributes.addItem(d.asAttributeGroup())}},r.prototype.resolveDataLinks=function(e,r,n,a,s){var o=this,l=this;if(this.dataLinksState!==i.Resolving)if(void 0===r&&(r=!0),l.layer&&l.layer.hasDataLinks&&l.features.length()>0){l.setDataLinksState(i.Resolving);var c=this.features.get().slice(),u=[];u=r?dojo.filter(l.layer.dataLinks,function(e){return e.visible}):l.layer.dataLinks,u=dojo.filter(u,function(e){return!!(e&&e.parameters&&e.parameters.length)});for(var p=[],h=0,d=0,m=!1,g=0;g<u.length&&!m;g++){var f=function(t){return function(r){if(!m&&(p[t]=r,++h>=u.length)){if(o._applyDataLinks(l,c,u,p,e),l.setDataLinksState(i.Resolved),void 0!==o.app)for(var s=0;s<u.length;s++)o.app.event("DatalinkResolutionCompletedEvent").publish(u[s].id,l);a&&a(l,n)}}},y=f(g),b=function(e){return function(r){++d>=u.length?(console.error("There was an error in resolving {0} datalink. Message : {1}".format(u[e].displayName,r.message)),m=!0,l.setDataLinksState(i.Unresolved),s&&s(l,r,n)):(console.error("There was an error in resolving {0} datalink. Message : {1}".format(u[e].displayName,r.message)),f(e)(new t.DataLinkingResult))}}(g);void 0!==this.app&&this.app.event("DatalinkResolutionStartedEvent").publish(u[g].id,l),u[g].performDataLinking(l.esriFeatureSet,y,b)}}else l.setDataLinksState(i.Resolved),a&&a(l,n);else s&&s(this,new Error("Currently performing data linking"),n)},r.prototype.doWhenDataLinkingCompleted=function(e){var t=this;if("function"==typeof e)if(this.dataLinksResolved.get())e(this);else var i=this.dataLinksResolved.bind(this,function(r){r&&(t.dataLinksResolved.unbind(i),e(t))})},r.prototype.append=function(e){for(var t=new Object,i=0;i<this.features.length();i++){n=this.features.getAt(i);this.layer&&this.layer.primaryKeyField&&(r=this.layer.primaryKeyField.name),r&&(t[a=n.esriFeature.get().attributes[r]]=n)}for(i=0;i<e.features.length();i++){var r,n=e.features.getAt(i);if(e.layer&&e.layer.primaryKeyField&&(r=e.layer.primaryKeyField.name),r){var a=n.esriFeature.get().attributes[r];t[a]||this.features.addItem(n)}else this.features.addItem(n)}},r.prototype.union=function(e){for(var t=this.clone(),i=e&&e.features?e.features.length():0,r=0;r<i;r++)t.containsFeature(e.features.getAt(r))||t.addFeature(e.features.getAt(r),!0);return t},r.prototype.unionInPlace=function(t){if(!t||!t.features||0===t.features.length())return!1;var i=new e.framework.events.CollectionChangedArgs;i.type="append",i.rangeStart=this.features.length();for(var r=!1,n=0,a=0;a<t.features.length();a++){var s=t.features.getAt(a);this.containsFeature(s)||this._addFeatureWithoutNotification(s,!0)&&(r=!0,n++)}return r&&(i.rangeEnd=i.rangeStart+n-1,i.sender=this.features,this.features.bindingEvent.publish(i)),r},r.prototype.subtract=function(e){for(var t=this.cloneStructure(),i=0;null!=e&&i<this.features.length();i++)e.containsFeature(this.features.getAt(i))||t.addFeature(this.features.getAt(i));return t},r.prototype.subtractInPlace=function(e){if(!e||!e.features||0===e.features.length())return!1;for(var t=!1,i=this.features.length();i--;){var r=this.features.getAt(i);e.containsFeature(r)&&(this._removeWithoutNotificationAt(i),t=!0)}return t&&this.features.pulse(),t},r.prototype.intersect=function(e){for(var t=this.cloneStructure(),i=0;null!=e&&i<this.features.length();i++)e.containsFeature(this.features.getAt(i))&&t.addFeature(this.features.getAt(i));return t},r.prototype.intersectInPlace=function(e){if(!e||!e.features)return!1;for(var t=!1,i=this.features.length();i--;){var r=this.features.getAt(i);e.containsFeature(r)||(this._removeWithoutNotificationAt(i),t=!0)}return t&&this.features.pulse(),t},r.prototype.clone=function(){for(var e=this.cloneStructure(),t=0;t<this.features.length();t++)e.addFeature(this.features.getAt(t),!0);return e},r.prototype.cloneStructure=function(){var e=new r({app:this.app,layer:this.layer,featureLayer:this.featureLayer,allowUnsafeContent:this._allowUnsafeContent,defaultDateFormat:this.defaultDateFormat,defaultNumberFormat:this.defaultNumberFormat});return e.id=this.id,e.isSelectedInCollection.set(this.isSelectedInCollection.get()),e.setDataLinksState(this.dataLinksState),e.displayName.set(this.displayName.get()),e.iconUri.set(this.iconUri.get()),e.attributes.set(this.attributes.get()),e.extendedProperties.set(this.extendedProperties.get()),e.esriFeatureSet=this._cloneEsriStructure(this.esriFeatureSet),e},r.prototype._cloneEsriStructure=function(e){if(!e)return null;var t=new esri.tasks.FeatureSet;return t.displayFieldName=e.displayFieldName,t.exceededTransferLimit=e.exceededTransferLimit,t.fieldAliases=e.fieldAliases,t.geometryType=e.geometryType,t.spatialReference=e.spatialReference,e.fields&&(t.fields=e.fields),t},r.prototype._watchFeatureSetChanges=function(){var e=this;this._unwatchFeatureSetChanges();var t=this.features.bind(this,this.featureSetChanged),i={remove:function(){return e.features.unbind(t)}};return this._watchHandles.features=i,i},r.prototype._unwatchFeatureSetChanges=function(){var e=this._watchHandles.features;e&&e.remove(),this._watchHandles.features=null},r}();t.FeatureSet=r}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function i(){this.displayName=new Observable(""),this.isModified=new Observable(!1),this.featureSets=new ObservableCollection,this.extendedProperties=new ObservableCollection,this.id="FSC-{0}".format(e.framework.utils.alphaNumericToken()),this.featureSets.useThrottling=!1}return i.prototype.getExtendedPropertyByName=function(e){for(var t=0;t<this.extendedProperties.getLength();t++){var i=this.extendedProperties.getAt(t);if(i&&i.name==e)return i.value}return null},i.prototype.setExtendedProperty=function(e,t){for(var i=0;i<this.extendedProperties.getLength();i++){var r=this.extendedProperties.getAt(i);if(r&&r.name==e)return void(r.value=t)}this.extendedProperties.addItem({name:e,value:t})},i.prototype.getFeatureSetById=function(e){for(var t=0;t<this.featureSets.getLength();++t){var i=this.featureSets.getAt(t);if(i.id==e)return i}return null},i.prototype.getFeatureSetByLayer=function(e){if(!e)return null;for(var t=0;t<this.featureSets.getLength();++t){var i=this.featureSets.getAt(t),r=i.layer,n=e===r||e&&r&&e.id==r.id,a=e===r||e&&r&&e.mapService===r.mapService||e&&r&&e.mapService&&r.mapService&&e.mapService.id==r.mapService.id;if(n&&a)return i}return null},i.prototype.findFeatureByEsriFeature=function(e){for(var t=0;t<this.featureSets.getLength();t++){var i=this.featureSets.getAt(t).findFeatureByEsriFeature(e);if(i)return i}return null},i.prototype.firstFeature=function(){for(var e=0;e<this.featureSets.getLength();e++){var t=this.featureSets.getAt(e);if(t.features.getLength()>0)return t.features.getAt(0)}return null},i.prototype.countFeatures=function(){for(var e=0,t=0;t<this.featureSets.length();t++)e+=this.featureSets.getAt(t).features.length();return e},i.prototype.clear=function(){for(var e=0;e<this.featureSets.getLength();e++)this.featureSets.getAt(e).features.clear();this.featureSets.clear()},i.prototype.clone=function(e){void 0===e&&(e=!1);for(var t=this.cloneStructure(),i=0;i<this.featureSets.length();i++){var r=e?this.featureSets.getAt(i).clone():this.featureSets.getAt(i);t.featureSets.addItem(r)}return t},i.prototype.cloneStructure=function(){var e=new t.FeatureSetCollection;return e.sourceName=this.sourceName,e.displayName.set(this.displayName.get()),e.isModified.set(this.isModified.get()),e.tag=this.tag,this.extendedProperties.getItems().forEach(function(t){return e.setExtendedProperty(t.name,t.value)}),e},i.prototype.unionInPlace=function(e){if(!e||0===e.featureSets.length())return!1;for(var t=this._buildFeatureSetLookup(),i=this._buildLayerLookup(),r=!1,n=0;n<e.featureSets.length();n++){var a=e.featureSets.getAt(n),s=a.id,o=a.layer,l=null;if(s&&t.containsKey(s)&&(l=t.get(s)),!l&&o&&o.mapService){var c=this._generateLayerKey(o.mapService.id,o.id);l=i.get(c)}l?l.unionInPlace(a)&&(r=!0):(this.featureSets.addItem(a),r=!0)}return r},i.prototype.unionManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,i=0;i<e.length;i++)this.unionInPlace(e[i])&&(t=!0);return t},i.prototype.subtractInPlace=function(e){if(!e||0===e.featureSets.length())return!1;for(var t=e._buildFeatureSetLookup(),i=e._buildLayerLookup(),r=!1,n=this.featureSets.length();n--;){var a=this.featureSets.getAt(n),s=a.id,o=a.layer,l=null;if(s&&t.containsKey(s)&&(l=t.get(s)),!l&&o&&o.mapService){var c=this._generateLayerKey(o.mapService.id,o.id);l=i.get(c)}l&&(a.subtractInPlace(l)&&(r=!0),0==a.features.length()&&(this.featureSets.removeAt(n),r=!0))}return r},i.prototype.subtractManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,i=0;i<e.length;i++)this.subtractInPlace(e[i])&&(t=!0);return t},i.prototype.intersectInPlace=function(e){if(!e)return!1;for(var t=e._buildFeatureSetLookup(),i=e._buildLayerLookup(),r=!1,n=this.featureSets.length();n--;){var a=this.featureSets.getAt(n),s=a.id,o=a.layer,l=null;if(s&&t.containsKey(s)&&(l=t.get(s)),!l&&o&&o.mapService){var c=this._generateLayerKey(o.mapService.id,o.id);l=i.get(c)}l?(a.intersectInPlace(l)&&(r=!0),0==a.features.length()&&(this.featureSets.removeAt(n),r=!0)):(this.featureSets.removeAt(n),r=!0)}return r},i.prototype.intersectManyInPlace=function(e){if(!e||0==e.length)return!1;for(var t=!1,i=0;i<e.length;i++)this.intersectInPlace(e[i])&&(t=!0);return t},i.prototype._generateLayerKey=function(e,t){return"{0}/{1}".format(e,t)},i.prototype._buildLayerLookup=function(){for(var e=new t.Dictionary,i=0;i<this.featureSets.length();i++){var r=this.featureSets.getAt(i);if(r&&r.layer&&r.layer.mapService){var n=this._generateLayerKey(r.layer.mapService.id,r.layer.id);e.containsKey(n)||e.set(n,r)}}return e},i.prototype._buildFeatureSetLookup=function(){for(var e=new t.Dictionary,i=0;i<this.featureSets.length();i++){var r=this.featureSets.getAt(i);r&&r.id&&!e.containsKey(r.id)&&e.set(r.id,r)}return e},i}();t.FeatureSetCollection=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e){dojo.safeMixin(this,e)}}();e.FeatureSetManagerEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={})),geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureSetManagerEventArgs=geocortex.essentialsHtmlViewer.mapping.infrastructure.eventArgs.FeatureSetManagerEventArgs;var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function t(e){this.featureSetCollections=new ObservableCollection,this._featureSetCollectionsMap={},this._collectionChangedEventMap={},this._collectionOpenCount={},this._searchSuggestions={},this.app=e,this._registerCommands()}return t.prototype._registerCommands=function(){this.app.command("OpenFeatureSetCollection").register(this,this.openCollection),this.app.command("CloseFeatureSetCollection").register(this,this.closeCollection),this.app.command("RemoveCollection").register(this,this.removeCollection),this.app.command("RemoveFeatureSetCollection").register(this,this.removeCollection),this.app.command("RemoveCollectionById").register(this,this.removeCollectionById),this.app.command("RemoveFeatureSetCollectionById").register(this,this.removeCollectionById)},t.prototype.openCollection=function(t){if(!this._featureSetCollectionsMap.hasOwnProperty(t))return this.app.trace.warning("Cannot open feature set collection '{0}': No feature set collection with matching ID found.".format(t)),null;if(this._collectionOpenCount.hasOwnProperty(t)||(this._collectionOpenCount[t]=0),++this._collectionOpenCount[t],1==this._collectionOpenCount[t]){var i=this._featureSetCollectionsMap[t],r=new e.essentialsHtmlViewer.mapping.infrastructure.eventArgs.FeatureSetManagerEventArgs({sender:this,featureSetCollection:i,featureSetCollectionId:t});this.app.event("FSMCollectionOpenedEvent").publish(r)}return this._featureSetCollectionsMap[t]},t.prototype.closeCollection=function(t){if(!this._featureSetCollectionsMap.hasOwnProperty(t))return this.app.trace.warning("Cannot close feature set collection '{0}': No feature set collection with matching ID found.".format(t)),!1;if(!this._collectionOpenCount.hasOwnProperty(t)||0==this._collectionOpenCount[t])return this.app.trace.warning("Attempted to close an already-closed FeatureSetCollection."),!1;if(--this._collectionOpenCount[t],0==this._collectionOpenCount[t]){var i=new e.essentialsHtmlViewer.mapping.infrastructure.eventArgs.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[t],featureSetCollectionId:t});this.app.event("FSMCollectionClosedEvent").publish(i)}return!0},t.prototype.tryCloseCollection=function(e){return!!this._featureSetCollectionsMap.hasOwnProperty(e)&&(!this.isCollectionOpen(e)||this.closeCollection(e))},t.prototype.isCollectionOpen=function(e){return this._featureSetCollectionsMap.hasOwnProperty(e)?this._collectionOpenCount.hasOwnProperty(e)&&this._collectionOpenCount[e]>0:(this.app.trace.warning("Cannot check open state of feature set collection '{0}': No feature set collection with matching ID found.".format(e)),!1)},t.prototype.addCollection=function(e){return this._addCollectionImpl(e)},t.prototype._addCollectionImpl=function(t){if(!t)throw new Error("FeatureSetManager.addCollection: Parameter 'fsc' required.");var i=this._featureSetCollectionsMap[t.id];if(t===i)return!0;if(i)return this.app.trace.warning("Cannot add feature set collection '{0}': A feature set collection with that ID already exists.".format(t.id)),!1;this._featureSetCollectionsMap[t.id]=t,this.featureSetCollections.addItem(t);var r=t.featureSets.bind(this,dojo.hitch(this,function(e){this.handleCollectionChanged(t,e)}));this._collectionChangedEventMap[t.id]=r;var n=new e.essentialsHtmlViewer.mapping.infrastructure.eventArgs.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[t.id],featureSetCollectionId:t.id});return this.app.event("FSMCollectionAddedEvent").publish(n),!0},t.prototype.handleCollectionChanged=function(t,i){var r=new e.essentialsHtmlViewer.mapping.infrastructure.eventArgs.FeatureSetManagerEventArgs({sender:this,featureSetCollection:t,featureSetCollectionId:t.id,collectionChangedEventArgs:i});this.app.event("FSMCollectionChangedEvent").publish(r)},t.prototype.removeCollection=function(e){return!!this.canRemoveCollection(e)&&this.removeCollectionById(e.id)},t.prototype.removeCollectionById=function(t){if(!this._featureSetCollectionsMap.hasOwnProperty(t))return this.app.trace.warning("Cannot remove feature set collection '{0}': Collection not found.".format(t)),!1;this.isCollectionOpen(t)&&this.closeCollection(t);var i=this._featureSetCollectionsMap[t],r=this._collectionChangedEventMap[t];i.featureSets.unbind(r),this.featureSetCollections.removeItem(this._featureSetCollectionsMap[t]),delete this._collectionOpenCount[t];var n=new e.essentialsHtmlViewer.mapping.infrastructure.eventArgs.FeatureSetManagerEventArgs({sender:this,featureSetCollection:this._featureSetCollectionsMap[t],featureSetCollectionId:t});return this.app.event("FSMCollectionRemovedEvent").publish(n),delete this._featureSetCollectionsMap[t],!0},t.prototype.canRemoveCollection=function(e){return null!=e&&null!=this.getCollectionById(e.id)},t.prototype.getCollectionById=function(e){return this._featureSetCollectionsMap[e]},t.prototype.getCollectionIds=function(){var e=[];for(var t in this._featureSetCollectionsMap)this._featureSetCollectionsMap.hasOwnProperty(t)&&e.push(t);return e},t.prototype.findFeaturesByEsriFeature=function(e){var t=[];return this.featureSetCollections.get().forEach(function(i){var r=i.findFeatureByEsriFeature(e);r&&t.push(r)}),t},t.prototype.addSearchSuggestions=function(e){for(var t in e)if(e.hasOwnProperty(t)){if(this._searchSuggestions.hasOwnProperty(t)){this.app.trace.warning("Cannot add search suggestion '{0}': A search suggestion for that feature set type already exists.".format(e[t]));continue}e[t]&&(this._searchSuggestions[t]=e[t])}},t.prototype.getSearchSuggestion=function(e){return this._searchSuggestions[e]},t}();t.FeatureSetManager=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){t.getColorFromList=function(e){return e&&4===e.length?(e[3]>1&&(e[3]=e[3]/255),new dojo.Color(e)):new dojo.Color(e)},t.getColorFromString=function(e){if("string"==typeof e&&e.startsWith("#")&&9===e.length){var t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),n=parseInt(e.slice(7,9),16);return t/=255,new esri.Color([i,r,n,t])}return new esri.Color(e)},t.getStringFromList=function(e){if(e)return 4===e.length?(e[3]>1&&(e[3]=e[3]/255),"rgba({0}, {1}, {2}, {3})".format(e[0],e[1],e[2],e[3])):3===e.length?"rgb({0}, {1}, {2})".format(e[0],e[1],e[2]):void 0},t.getStringFromHex=function(e){if("string"==typeof e&&e.startsWith("#")){if(9===e.length){var t=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),n=parseInt(e.slice(7,9),16);return t/=255,"rgba({0}, {1}, {2}, {3})".format(i,r,n,t)}if(7===e.length){var i=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);return"rgb({0}, {1}, {2})".format(i,r,n)}}},t.generateRandomColors=function(t){void 0===t&&(t=6);for(var i=[],r=Math.random(),n=0;n<t;n++){var a=r+1/t*n;a-=Math.floor(a);var s=new e.visualization.SymbolColor({h:a,s:.8,v:1});n%3==0&&(s=s.darken(Math.random()/1.8)),n%3==1&&(s=s.lighten(Math.random()/1.1)),i.push(s)}return i.sort(function(e){return.5-Math.random()})},t.generateRandomColor=function(){var t=Math.random();return new e.visualization.SymbolColor({h:t,s:.8,v:1})},t.isColorInputSupported=function(){var e=document.createElement("input");return e.setAttribute("type","color"),"text"!==e.type}}(e.ColorUtils||(e.ColorUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function t(){this.fillColor=new esri.Color([236,236,0,.22745]),this.borderColor=new esri.Color([204,204,51,1]),this.borderWidth=2,this.defaultSymbol=null,this._pictureMarkerSymbolCache={}}return t.prototype.clone=function(){var t=new e.essentialsHtmlViewer.mapping.infrastructure.SimpleRenderer;return t.fillColor=this.fillColor,t.borderColor=this.borderColor,t.borderWidth=this.borderWidth,t},t.prototype.getSymbol=function(e){return e&&e.geometry?e.geometry instanceof esri.geometry.Point||e.geometry instanceof esri.geometry.Multipoint?new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,null,this.borderColor):e.geometry instanceof esri.geometry.Polygon?new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.borderColor,this.borderWidth),this.fillColor):e.geometry instanceof esri.geometry.Polyline?new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.borderColor,this.borderWidth):null:null},t.prototype.getSymbolWithHacks=function(e,t){if(t&&t.renderer&&e&&e.geometry&&(e.geometry instanceof esri.geometry.Point||e.geometry instanceof esri.geometry.Multipoint)){var i=t.renderer.getSymbol(e);if(i instanceof esri.symbol.SimpleMarkerSymbol)return new esri.symbol.SimpleMarkerSymbol(i.style,i.size+2,null,this.fillColor);if(i instanceof esri.symbol.PictureMarkerSymbol)return this._getPictureMarkerSymbolHighlight(i);if(i instanceof esri.symbol.MarkerSymbol)return new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,i.size,null,this.fillColor)}return this.getSymbol(e)},t.prototype._getPictureMarkerSymbolHighlight=function(e){if(this._pictureMarkerSymbolCache.hasOwnProperty(e.url))return this._pictureMarkerSymbolCache[e.url];if(Modernizr&&Modernizr.canvas)try{var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.fillStyle=this.fillColor.toCss(Modernizr.rgba),i.fillRect(0,0,t.width,t.height),i.globalCompositeOperation="destination-atop";var r=new Image;return r.src=e.url,i.drawImage(r,0,0),this._pictureMarkerSymbolCache[e.url]=new esri.symbol.PictureMarkerSymbol(t.toDataURL("image/png"),t.width,t.height)}catch(e){}return this._pictureMarkerSymbolCache[e.url]=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,Math.min(e.width,e.height),null,this.fillColor)},t.prototype.toJson=function(){return{fillColor:this.fillColor,borderColor:this.borderColor,borderWidth:this.borderWidth}},t}();t.SimpleRenderer=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function i(e){this._activeHighlightLayerName=null,this._highlightLayers={},this._managedGraphics={},this._nextHighlightId=0,this._defaultRenderer=new t.SimpleRenderer,this._defaultHighlightLayerName=null,this.app=e}return i.prototype.createHighlightLayer=function(e,i,r){if(!e)throw new Error("Unable to create new highlight layer with null or empty name");if(this._highlightLayers.hasOwnProperty(e))return this.app.trace.warning("Cannot create highlight layer because layer with name '{0}' already exists.".format(e)),null;var n=new esri.layers.GraphicsLayer;return(null!==i&&void 0!==i||null!==r&&void 0!==r)&&(n.renderer=this._defaultRenderer.clone(),null!==i&&void 0!==i&&(n.renderer.fillColor="string"==typeof i?t.ColorUtils.getColorFromString(i):t.ColorUtils.getColorFromList(i)),null!==r&&void 0!==r&&(n.renderer.borderColor="string"==typeof r?t.ColorUtils.getColorFromString(r):t.ColorUtils.getColorFromList(r))),this._highlightLayers[e]=n,this._addLayerToMap(n),this._activeHighlightLayerName&&""!==this._activeHighlightLayerName||(this._activeHighlightLayerName=e),this.app.event("HighlightLayerCreated").publish(e),n},i.prototype.setActiveHighlightLayer=function(e){if(!e)throw new Error("Unable to set the active highlight layer because no layer name was given.");if(!this._highlightLayers.hasOwnProperty(e))throw new Error("Unable to set {0} as the active highlight layer, because a highlight layer with that name does not exist".format(e));this._activeHighlightLayerName=e},i.prototype.highlightEsriFeatureSet=function(e,t){if(e)if(e.features&&0!=e.features.length){var i=this.getHighlightLayerOrActive(t);i&&i.graphics||this.app.trace.warning("Unable to highlight feature because the required layer was not found, or could not accept graphics");for(var r=0;r<e.features.length;r++)this._drawGraphic(e.features[r],i)}else this.app.trace.warning("No features detected in FeatureSet; as such, no features were highlighted");else this.app.trace.warning("No FeatureSet was provided; as such, no features were highlighted")},i.prototype.highlightFeatures=function(e,i){if(e){var r=this.getHighlightLayerOrActive(i);r||this.app.trace.warning("Unable to highlight feature because the required layer was not found, or could not accept graphics");for(var n=this._defaultRenderer.borderColor,a=this._defaultRenderer.fillColor,s=this._defaultRenderer.borderWidth,o=0;o<e.length;o++){var l=e[o];try{var c;if(l.borderColor&&l.borderColor.get()&&(c=t.ColorUtils.getColorFromList(l.borderColor.get()))&&this._setBorderColor(c),l.fillColor&&l.fillColor.get()&&(c=t.ColorUtils.getColorFromList(l.fillColor.get()))&&this._setFillColor(c),l.borderWidth&&l.borderWidth.get()){var u=l.borderWidth.get();u>=0&&this._setBorderWidth(u)}this._drawGraphic(l.esriFeature.get(),r)}finally{this._setBorderColor(n),this._setFillColor(a),this._setBorderWidth(s)}}}else this.app.trace.warning("No Features were provided, as such, no features were highlighted")},i.prototype.highlightGraphics=function(e,t){if(e){var i=this.getHighlightLayerOrActive(t);i||this.app.trace.warning("Unable to highlight feature because the required layer was not found, or could not accept graphics");for(var r=0;r<e.length;r++)this._drawGraphic(e[r],i)}else this.app.trace.warning("No Graphics were provided, as such, no graphics were highlighted")},i.prototype.removeHighlightLayer=function(e){if(!e)throw new Error("Unable to remove a highlight layer with null or empty name");if(!this._highlightLayers.hasOwnProperty(e))throw new Error("Cannot remove highlight layer because layer with name {0} does not exist.".format(e));var t=this._highlightLayers[e];this.clearHighlights(t),this.app.map.removeLayer(t),delete this._highlightLayers[e],this._activeHighlightLayerName===e&&(this._activeHighlightLayerName=null)},i.prototype.clearHighlights=function(e){var t=null;e||this._activeHighlightLayerName&&(t=this._activeHighlightLayerName);var i=null;if((t||"string"==typeof e)&&(t||(t=e),i=this.getHighlightLayer(t)),i||"object"==typeof e&&e instanceof esri.layers.GraphicsLayer)if(i||(i=e),i&&i.graphics)for(var r=i.graphics.length-1;r>=0;r--){var n=i.graphics[r];this._removeClonedGraphic(n)}else this.app.trace.warning("An attempt was made to clear a highlight layer which contained no graphics")},i.prototype.getHighlightFillColor=function(){return this._toARGBHex(this._getFillColor())},i.prototype.getHighlightBorderColor=function(){return this._toARGBHex(this._getBorderColor())},i.prototype.getHighlightBorderWidth=function(){return this._getBorderWidth()},i.prototype.setHighlightFillColor=function(e){this._setFillColor(t.ColorUtils.getColorFromString(e))},i.prototype.setHighlightBorderColor=function(e){this._setBorderColor(t.ColorUtils.getColorFromString(e))},i.prototype.setHighlightBorderWidth=function(e){this._setBorderWidth(e)},i.prototype.getHighlightLayer=function(e){return e?this._highlightLayers[e]:(this.app.trace.warning("Unable to get a highlight layer with null or empty name"),null)},i.prototype.getHighlightLayers=function(){return this._highlightLayers},i.prototype.getHighlightLayerOrActive=function(e){return e?this.getHighlightLayer(e):this._activeHighlightLayer()},i.prototype.activeHighlightLayerGraphics=function(){var e=this._activeHighlightLayer();return e&&e.graphics?e.graphics.slice(0):null},i.prototype.defaultHighlightLayerGraphics=function(){var e=this.getHighlightLayer(this._defaultHighlightLayerName);return e?e.graphics.slice(0):null},i.prototype.exportState=function(){var e=this;return Promise.try(function(){var t=e.app.project.convert,i={highlightLayers:{},activeHighlightLayerName:e._activeHighlightLayerName,highlights:[]};for(var r in e._highlightLayers)i.highlightLayers[r]=t.fromEsriLayer(e._highlightLayers[r]);for(var n in e._managedGraphics)e._managedGraphics[n].forEach(function(e){i.highlights.push({feature:t.fromEsriGraphic(e.managedGraphic),highlightLayer:t.fromEsriLayer(e.layer)})});return i})},i.prototype.applyState=function(i){var r=this,n=this.app.project.convert,a={};for(var s in i.highlightLayers)a[s]=n.toEsriLayer(i.highlightLayers[s]);var o={highlightLayers:t.PromiseUtils.propsSkipRejected(a),highlights:t.PromiseUtils.mapSkipRejected(i.highlights,function(e){return Promise.props({graphic:n.toEsriGraphic(e.feature),highlightLayer:n.toEsriLayer(e.highlightLayer)})})};return Promise.props(o).then(function(t){for(var n in r._highlightLayers)r.clearHighlights(n);r._highlightLayers={},r._managedGraphics={},r._nextHighlightId=0,t.highlights.forEach(function(e){var t=parseInt(r._getHighlightId(e.graphic));r._nextHighlightId=Math.max(r._nextHighlightId,t+1)});for(var a in t.highlightLayers)r._highlightLayers[a]=t.highlightLayers[a];r._activeHighlightLayerName=i.activeHighlightLayerName,t.highlights.forEach(function(t){r._getHighlightId(t.graphic);var i=e.framework.utils.ArrayUtils.firstOrDefault(t.highlightLayer.graphics,function(e){return r._getHighlightId(e)===r._getHighlightId(t.graphic)});i?r._trackGraphic(t.graphic,i,t.highlightLayer):r._drawGraphic(t.graphic,t.highlightLayer)})})},i.prototype._drawGraphic=function(e,t){if(e&&t){this._showHighlightLayer(t);var i=this._getHighlightId(e);if(i||(i=this._nextId(),this._setHighlightId(e,i)),this._managedGraphics.hasOwnProperty(i))for(var r=0;r<this._managedGraphics[i].length;r++)if(this._managedGraphics[i][r].layer===t)return;var n=new esri.Graphic;n.attributes={};for(var a in e.attributes)e.attributes.hasOwnProperty(a)&&(n.attributes[a]=e.attributes[a]);n.geometry=e.geometry,this._setHighlightId(n,i),this._trackGraphic(e,n,t),n.geometry&&(t.renderer||(n.symbol=this._defaultRenderer.getSymbolWithHacks(n,e._graphicsLayer)),t.add(n))}else this.app.trace.error("HighlightManager given null graphic or layer. Skipping...")},i.prototype._trackGraphic=function(e,t,i){var r,n=this._getHighlightId(e);this._managedGraphics.hasOwnProperty(n)?r=this._managedGraphics[n]:(r=[],this._managedGraphics[n]=r);for(var a=0;a<r.length;a++)if(r[a].layer===i)return;var s={layer:i,managedGraphic:e,clonedGraphic:t};r.push(s)},i.prototype._getFillColor=function(){return this._defaultRenderer.fillColor},i.prototype._setFillColor=function(e){this._defaultRenderer.fillColor=e},i.prototype._getBorderColor=function(){return this._defaultRenderer.borderColor},i.prototype._setBorderColor=function(e){this._defaultRenderer.borderColor=e},i.prototype._getBorderWidth=function(){return this._defaultRenderer.borderWidth},i.prototype._setBorderWidth=function(e){this._defaultRenderer.borderWidth=e},i.prototype._toARGBHex=function(e){return"#"+("00"+Math.floor(255*e.a).toString(16)).slice(-2)+("00"+e.r.toString(16)).slice(-2)+("00"+e.g.toString(16)).slice(-2)+("00"+e.b.toString(16)).slice(-2)},i.prototype._nextId=function(){return(this._nextHighlightId++).toString()},i.prototype._getHighlightId=function(e){if(e&&e.attributes)return e.__gcxHlId},i.prototype._setHighlightId=function(e,t){e.__gcxHlId=t},i.prototype._showHighlightLayer=function(e){this.app.map.reorderLayer(e,this.app.map.graphicsLayerIds.length-1),e!=this._highlightLayers[this._defaultHighlightLayerName]&&this.app.map.reorderLayer(this._highlightLayers[this._defaultHighlightLayerName],this.app.map.graphicsLayerIds.length-1)},i.prototype._addLayerToMap=function(e){this.app.map.addLayer(e)},i.prototype._activeHighlightLayer=function(){return this._activeHighlightLayerName?this.getHighlightLayer(this._activeHighlightLayerName):null},i.prototype._removeClonedGraphic=function(t){var i=this._getHighlightId(t);if(this._managedGraphics.hasOwnProperty(i)){var r=e.framework.utils.ArrayUtils.firstOrDefault(this._managedGraphics[i],function(e){return e.clonedGraphic===t});this._removeManagedGraphic(r.managedGraphic,r.layer)}},i.prototype._removeManagedGraphic=function(e,t){var i=this._getHighlightId(e);if(this._managedGraphics.hasOwnProperty(i)){for(var r=this._managedGraphics[i],n=null,a=0;a<r.length;a++)if(r[a].layer===t){n=r[a];break}if(n){t.remove(n.clonedGraphic);var s=r.indexOf(n);r.splice(s,1),0===r.length&&delete this._managedGraphics[i]}}},i}();t.HighlightManager=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function t(t,i){this.app=t,this.libraryId=i,this.id="SearchProvider-"+e.framework.utils.alphaNumericToken(),this.supportsOffline=!1,this.supportsHints=!1,this.status=e.essentialsHtmlViewer.mapping.infrastructure.search.Status.IDLE}return t.prototype.initialize=function(e){},t.prototype.search=function(e,t){},t.prototype.cancelSearch=function(){},t.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},t}();t.SearchProviderBase=i}(t.search||(t.search={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.status=null,this.searchType=null,this.endpointUrl=null,this.error=null,this.message=null,this.results=null,this.query=null}}();e.SearchProgressEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={})),geocortex.essentialsHtmlViewer.mapping.infrastructure.search.SearchProgressEventArgs=geocortex.essentialsHtmlViewer.mapping.infrastructure.eventArgs.SearchProgressEventArgs;var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){!function(e){e.IDLE="Idle",e.SEARCHING="Searching",e.ERROR="Error"}(i.Status||(i.Status={}));var r=function(){function i(e){this._searchProviders=[],this._fscRootID="SearchResultsCollection",this._count=0,this._fscSourceName="Search",this.app=e,this._registerCommands(),this.app.event("SearchProgressEvent").subscribe(this,this._searchProgress)}return i.prototype._resetFeatureSetCollection=function(){this._fsc||(this._fsc=this.app.featureSetManager.getCollectionById(this._fscRootID)),this._fsc?(this.app.featureSetManager.getCollectionById(this._fsc.id)||this.app.featureSetManager.addCollection(this._fsc),this._fsc.clear(),this.app.featureSetManager.tryCloseCollection(this._fsc.id)):(this._fsc=new t.FeatureSetCollection,this._fsc.id=this._fscRootID,this._fsc.sourceName=this._fscSourceName,this.app.featureSetManager.addCollection(this._fsc))},i.prototype.getSearchHints=function(e,t){var i=this._enabledProviders();if(0!=i.length)for(var r=0;r<i.length;r++)i[r].supportsHints&&i[r].getSearchHints(e,t);else this.app.trace.warning("No search providers enabled.")},i.prototype._registerCommands=function(){this.app.command("RegisterSearchProvider").register(this,this._registerProvider),this.app.command("Search").register(this,this._search),this.app.command("GlobalSearch").register(this,this._search),this.app.command("CancelSearch").register(this,this._cancelSearch),this.app.command("ClearSearch").register(this,this._clearSearch)},i.prototype._registerProvider=function(e){if(!e)throw new Error("Search Provider cannot be null.");for(var t=0;t<this._searchProviders.length;t++)if(this._searchProviders[t].id==e.id)throw new Error("Search Provider '{0}' already registered.".format(e.name));this._searchProviders.push(e)},i.prototype._enabledProviders=function(){for(var e=[],t=0;t<this._searchProviders.length;t++){var i=this._searchProviders[t];i.isEnabled&&(!0===this.app.isOffline.get()?i.supportsOffline&&e.push(i):e.push(i))}return e},i.prototype._isSearching=function(){for(var t=0;t<this._searchProviders.length;t++)if(this._searchProviders[t].status==e.essentialsHtmlViewer.mapping.infrastructure.search.Status.SEARCHING)return!0;return!1},i.prototype._cancelSearch=function(){if(this._isSearching())for(var t=0;t<this._searchProviders.length;t++){var i=this._searchProviders[t];i.status==e.essentialsHtmlViewer.mapping.infrastructure.search.Status.SEARCHING&&i.cancelSearch()}},i.prototype._clearSearch=function(){this._isSearching()&&this._cancelSearch(),this._resetFeatureSetCollection()},i.prototype._search=function(e){if(this._isSearching()&&this._cancelSearch(),this._resetFeatureSetCollection(),e&&""!=e.replace(/ /g,"")){var t=this._enabledProviders();if(0!=t.length){var i=this.app.getResource("Mapping","language-search-fsc-display-name");this._fsc.displayName.set(i.format(e)),this.app.featureSetManager.isCollectionOpen(this._fsc.id)||this.app.featureSetManager.openCollection(this._fsc.id);for(var r=0;r<t.length;r++)t[r].search(this._fsc,e)}else this.app.trace.warning("No search providers enabled.")}else this.app.trace.warning("Cannot perform search without search text.")},i.prototype._searchProgress=function(t){var i=!0;if(t.status!=e.essentialsHtmlViewer.mapping.infrastructure.search.Status.SEARCHING){for(var r=0;r<this._searchProviders.length;r++)this._searchProviders[r].status==e.essentialsHtmlViewer.mapping.infrastructure.search.Status.SEARCHING&&(i=!1);i&&this.app.featureSetManager.tryCloseCollection(t.results.id)}},i}();i.SearchManager=r}(t.search||(t.search={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t){t&&t.command?(this.app=e,this.command=e.command(t.command),this.commandParameter=t.commandParameter||null,this.abortBatchOnFailure=!!t.abortBatchOnFailure):e&&e.trace.warning("BatchItemModel: Could not create batch item. Configuration or command not specified.")}}();e.BatchItemModel=t}(e.menus||(e.menus={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(t,i){var r=this;if(!t||!i)throw new Error("MenuItemModel: Required input parameters cannot be undefined");this.menuModel=t,this.app=t.app,this.text=i.text||"",this.description=i.description||"",this.iconUri=i.iconUri||this.menuModel.defaultIconUri,this.hideOnDisable=void 0!=i.hideOnDisable&&i.hideOnDisable,i.batch?(this.batchItems=[],this._setBatchItems(i.batch)):i.command&&(this.command=this.app.command(i.command),this.commandParameter=i.commandParameter||null),i.libraryId&&(e.framework.ui.stringLocalizer.localizeString(this.app,i.libraryId,this.text,function(e){return r.text=e}),e.framework.ui.stringLocalizer.localizeString(this.app,i.libraryId,this.description,function(e){return r.description=e}))}return i.prototype._setBatchItems=function(e){var i=this;e&&e.length&&e.forEach(function(e){e&&e.command&&i.batchItems.push(new t.BatchItemModel(i.app,e))})},i}();t.MenuItemModel=i}(t.menus||(t.menus={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function t(e,t){if(!e||!t||!t.id)throw new Error("MenuModel: Required input parameters cannot be undefined");this.app=e,this.id=t.id,this.title=t.title||"",this.description=t.description||"",this.defaultIconUri=t.defaultIconUri||"",this.items=this._createMenuItems(t.items)}return t.prototype._createMenuItems=function(t){var i=this,r=[];return t&&t.length&&t.forEach(function(t){try{var n=new e.essentialsHtmlViewer.mapping.infrastructure.menus.MenuItemModel(i,t);n&&(n.command||n.batchItems)?r.push(n):i.app.trace.warning("MenuModel: Could not create menu item for menu with id: {0}. Invalid configuration.".format(i.id))}catch(e){i.app.trace.warning("Unexpected configuration error: {0}".format(e.message))}}),r},t}();t.MenuModel=i}(t.menus||(t.menus={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(e){this.menuList=[],this._viewMenuEntries={},this._menuConfig=[],this.app=e}return i.prototype.loadMenus=function(e){var t=this;e&&e.menus&&e.menus.length&&(e.menus.forEach(function(e){return t.register(e)}),this._menuConfig=this._menuConfig.concat(e.menus))},i.prototype.register=function(e){var i=e&&e.id;if(this._validMenuId(i)){var r=e instanceof t.MenuModel?e:new t.MenuModel(this.app,e);this._validateMenuModel(r)?this.menuList.push(r):this.app.trace.warning("Could not register menu with id: {0}. Invalid menu configuration.".format(i))}else this.app.trace.warning("Could not register menu with id: {0}. Menu id should be defined and unique.".format(i))},i.prototype.unregister=function(e){for(var t=this.menuList.length-1;t>=0;t--)this.menuList[t].id===e&&this.menuList.splice(t,1)},i.prototype.getMenu=function(e){for(var t=this.menuList,i=0;i<t.length;i++)if(t[i].id===e)return t[i];return null},i.prototype.getDefaultIconUri=function(e){var t=this.getMenu(e);return t&&t.defaultIconUri?t.defaultIconUri:""},i.prototype.getMenuWidgetsForView=function(e){return this._viewMenuEntries[e.id]||[]},i.prototype.createMenuWidget=function(t,i,r,n){var a=this,s=r.domElement,o=r.viewModel,l=s.getAttribute("data-menu-id");if(!l||!this.getMenu(l))return console.log("Warning: Could not create menu view from DOM element attributes. Menu Id: {0} not registered with the MenuRegistry.".format(l)),null;var c=s.getAttribute("data-menu-template")||"Mapping/infrastructure/menus/MenuView.html",u=s.getAttribute("data-menu-type")||"geocortex.essentialsHtmlViewer.mapping.infrastructure.menus.MenuView",p=s.getAttribute("data-menu-library-id")||n||"Mapping",h=!s.hasAttribute("data-menu-hoist-disabled"),d=this.app.viewManager.createView({typeName:u,markupResource:c,isVisible:!0});if(!d)return console.log("Warning: Could not create menu '{0}' for view '{1}': Could not construct the menu widget view.".format(l,t.id)),null;d.app=this.app,d.configuration.menuId=l,p&&(d.libraryId=p);var m=new e.essentialsHtmlViewer.mapping.infrastructure.menus.MenuViewModel(this.app,p);m.id="MenuViewModel-{0}".format(d.id),m.menuSourceView=t,d.attach(m);var g=i;i&&i.isObservable?m.menuContext.sync(g):o&&r&&o[r.target]&&o[r.target].isObservable?(g=o[r.target],m.menuContext.sync(g)):m.menuContext.set(g);var f={view:t,widgetView:d,widgetViewModel:m,context:g,menuId:l,hoistMenu:h,domElement:s};return this._viewMenuEntries[t.id]||(this._viewMenuEntries[t.id]=[]),this._viewMenuEntries[t.id].push(f),dojo.aspect.after(t,"onDestroy",function(){return a._viewMenuEntries[t.id]=null}),this.app.event("MenuWidgetCreatedForView").publish(f),d},i.prototype.destroyMenuWidget=function(e){var t=this;e.viewModel&&(e.viewModel.menuContext.removeSync(),e.viewModel.destroy());for(var i in this._viewMenuEntries)this._viewMenuEntries.hasOwnProperty(i)&&null!=this._viewMenuEntries[i]&&this._viewMenuEntries[i].filter(function(t){return t.widgetView===e}).forEach(function(e,r){t._viewMenuEntries[i].splice(r,1)})},i.prototype._validMenuId=function(e){var t=e?this.menuList.filter(function(t){return t.id===e}):null;return null!==t&&0===t.length},i.prototype._validateMenuModel=function(e){return!!(e&&e.id&&e.items&&e.items.length)},i}();t.MenuRegistry=i}(t.menus||(t.menus={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.name="",this.isActive=!1,dojo.mixin(this,t),this.app=e}return e.prototype.setActive=function(e){e?(this.isActive=!0,this.onActivated()):(this.isActive=!1,this.onDeactivated())},e.prototype.onActivated=function(){},e.prototype.onDeactivated=function(){},e}();e.ToolBase=t}(e.tools||(e.tools={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(e){this.tools={},this._subscriptions={},this._toolTypes={},this.app=e,this._registerCommands()}return t.prototype._registerCommands=function(){var e=this;this.app.command("SetActiveTool").register(this,function(t){return e.setActiveTool(t)},function(t){return e._setActiveToolCanExecute(t)}),this.app.command("ClearActiveTool").register(this,function(){return e.clearActiveTool()})},t.prototype._setActiveToolCanExecute=function(e){return!!this.tool(e)},t.prototype.clearActiveTool=function(){for(var e in this.tools)if(this.tools.hasOwnProperty(e)){var t=this.tools[e];t&&t.isActive&&t.setActive(!1)}},t.prototype.getActiveTool=function(){for(var e in this.tools)if(this.tools.hasOwnProperty(e)){var t=this.tools[e];if(t&&t.isActive)return t}return null},t.prototype.setActiveTool=function(e){if(this.clearActiveTool(),e){var t=this.tool(e);t?t.setActive(!0):this.app.trace.warning("Could not activate tool '{0}'. The tool does not exist in the registry.".format(e))}},t.prototype.tool=function(e){return this.tools[e]},t.prototype.register=function(t){var i=this;this.unregister(t),t&&t.name&&(this.tools[t.name]=t,this._subscriptions[t.name]=dojo.connect(t,"setActive",function(r){if(!0===r){for(var n in i.tools)if(i.hasOwnProperty(n)){var a=i.tools[n];a&&a!=t&&a.isActive&&a.setActive(!1)}i.app.event("ActiveToolChanged").publish({tool:t,previousTool:null}),i.app.event("ActiveToolChanged").publish({tool:t,previousTool:null}),i.app.event("ActiveToolChangedEvent").publish({tool:t,previousTool:null}),t instanceof e.MapTool&&i.app.event("ToolCommandActivatedEvent").publish(t.command)}else i.getActiveTool()||(i.app.event("ActiveToolChanged").publish({tool:null,previousTool:t}),i.app.event("ActiveToolChangedEvent").publish({tool:null,previousTool:t}),t instanceof e.MapTool&&i.app.event("ToolCommandDeactivatedEvent").publish(t.command))}))},t.prototype.unregister=function(e){if(e&&e.name&&this.tools[e.name]==e){this.tools[e.name]=null;var t=this._subscriptions[e.name];t&&(dojo.disconnect(t),this._subscriptions[e.name]=null)}},t.prototype.clear=function(){for(var e in this.tools){var t=this.tools[e];t&&this.unregister(t)}},t.prototype.createTools=function(e,t){var i=this,r=[];return e&&e.forEach(function(e){var n=e.typeName?e.typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.tools.MapTool";i._toolTypes.hasOwnProperty(e.command)&&(n=i._toolTypes[e.command]);var a=dojo.getObject(n);if(a){var s=new a(i.app,e);r.push(s),t&&i.register(s)}else i.app.trace.warning("Could not create tool '{0}' from type name '{1}'.".format(e.name,n))}),r},t.prototype.registerToolTypeForCommand=function(e,t){this._toolTypes[e]=t},t}();e.ToolRegistry=t}(e.tools||(e.tools={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(e){function t(t,i,r,n){e.call(this,t,i),this.commandName="",this.commandParameter=null,this.canExecute=new Observable(!0),this.notExecuteHidden=new Observable(!1),r&&this._bindToCommand(r,n)}return __extends(t,e),t.prototype.applyContext=function(e){this._command&&e&&this.canExecute.set(this._command.canExecute(e))},t.prototype._bindToCommand=function(e,t){this._canExecuteChangedBindingToken&&this._command&&this._command.canExecuteChanged.unsubscribe(this._canExecuteChangedBindingToken),this.commandName=e,this.commandParameter=t||null,this._command=this.app.command(e),this._canExecuteChangedBindingToken=this._command.canExecuteChanged.subscribe(this,this._handleCanExecuteChanged),this.canExecute.set(this._command.canExecute(t))},t.prototype._handleCanExecuteChanged=function(){this.canExecute.set(this._command.canExecute(this.commandParameter))},t}(e.framework.ui.ViewModelBase);t.CommandViewModel=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){t.CommandViewModel=e.essentialsHtmlViewer.mapping.infrastructure.CommandViewModel}(t.command||(t.command={}))}(t.modules||(t.modules={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function t(t,i,r){this.libraryId="",this.isActive=new Observable(!0),this.activeTransient=new Observable(!1),this.disabled=new Observable(!1),this.hidden=new Observable(!1),this.cssClass=new Observable,this.hasSmallLayout=new Observable(!1),this.selectedTool=new Observable(null),this.toolChangeActive=new Observable(!1),r&&(this.id=r.id,this.app=t,this.libraryId=i,this.type=r.type,this.name=new Observable(r.name),this.tooltip=new Observable(r.tooltip||null),this.hideOnDisable=new Observable(!!r.hideOnDisable),r.libraryId&&e.framework.ui.stringLocalizer.localizeObservables(t,r.libraryId,[this.name,this.tooltip]))}return t.prototype.areAllHidden=function(e){for(var t=0;t<e.length();t++)if(!1===e.getAt(t).disabled.get()||!1===e.getAt(t).hideOnDisable.get())return!1;return!0},t.prototype.setHidden=function(){!0===this.disabled.get()&&!0===this.hideOnDisable.get()?this.hidden.set(!0):this.hidden.set(!1)},t.prototype.execute=function(){},t.prototype.activate=function(){this.isActive.set(!0)},t.prototype.deactivate=function(){this.isActive.set(!1),this.activeTransient.set(!1)},t.prototype.onDestroy=function(){},t}();t.ToolbarGroupItemBase=i}(t.toolbarGroup||(t.toolbarGroup={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(t,i,r){this.libraryId="",this.isActive=new Observable(!1),this.disabled=new Observable(!1),this.cssClass=new Observable,this.app=t,this.libraryId=i,r&&(this.name=new Observable(r.name),this.id=r.id||r.name||e.framework.utils.alphaNumericToken(),this.tooltip=new Observable(r.tooltip||null),this.type=r.type||"toolbarGroup",this.isDefault=!!r.isDefault,this.items=r.items?this.getToolbarGroupItems(r.items):new ObservableCollection,r.libraryId&&e.framework.ui.stringLocalizer.localizeObservables(t,r.libraryId,[this.name,this.tooltip]))}return i.prototype.getToolbarGroupItems=function(e){for(var i=new ObservableCollection,r=0;r<e.length;r++){var n=null;"button"==e[r].type?n=new t.ToolbarButton(this.app,this.libraryId,e[r]):"toggleButton"==e[r].type?n=new t.ToolbarToggleButton(this.app,this.libraryId,e[r]):"region"==e[r].type?n=new t.ToolbarRegion(this.app,this.libraryId,e[r]):"tool"==e[r].type?n=new t.ToolbarTool(this.app,this.libraryId,e[r]):"toolbarGroup"==e[r].type?n=new t.ToolbarGroup(this.app,this.libraryId,e[r]):"flyout"==e[r].type&&(n=new t.ToolbarFlyout(this.app,this.libraryId,e[r])),i.addItem(n)}return i},i}();t.ToolbarGroupBase=i}(t.toolbarGroup||(t.toolbarGroup={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function t(e){this.toolbarGroupList=new ObservableCollection,this._toolbarGroupsConfig=[],this.app=e}return t.prototype.getToolbarGroupById=function(e){if(0===this.toolbarGroupList.get().length||null===e)return null;for(var t=0;t<this.toolbarGroupList.get().length;t++)if(this.toolbarGroupList.getAt(t).id==e)return this.toolbarGroupList.getAt(t);return null},t.prototype.registerToolbarGroups=function(t,i){if(t)for(var r=0;r<t.length;r++){var n=t[r],a=new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarGroupBase(this.app,i,n);this._toolbarGroupsConfig.push(n),this.unregisterToolbarGroup(n.id),this.toolbarGroupList.addItem(a)}},t.prototype.unregisterToolbarGroup=function(e){var t=this.getPosition(e);null!=t&&this.toolbarGroupList.get().splice(t,1)},t.prototype.getPosition=function(e){for(var t=0;t<this.toolbarGroupList.getLength();t++)if(this.toolbarGroupList.getAt(t).id===e)return t;return null},t}();t.ToolbarGroupRegistry=i}(t.toolbarGroup||(t.toolbarGroup={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(e){e.IDLE="Idle",e.UNDOING="Undoing",e.REDOING="Redoing",e.COMMITTING="Committing",e.ROLLINGBACK="RollingBack"}(t.Status||(t.Status={}));var i=function(){function i(t,i){this.maxOperations=0,this.isSuspended=!1,this.isUndoing=!1,this.isRedoing=!1,this.canRedo=!1,this.canUndo=!1,this.length=0,this.position=0,this.rootTransaction=null,this._status=e.undo.Status.IDLE,this._historyStack=[],this.app=t,"number"==typeof(i=i||{}).maxOperations&&this.setMaxOperations(i.maxOperations),this.registerCommands()}return i.prototype.registerCommands=function(){var e=this;this.app.command("Undo").register(this,this.undo,function(t){return e.canUndo}),this.app.command("Redo").register(this,this.redo,function(t){return e.canRedo})},i.prototype.suspend=function(){this.isSuspended=!0},i.prototype.resume=function(){this.isSuspended=!1},i.prototype.setMaxOperations=function(e){this.maxOperations=e},i.prototype.getCurrentState=function(){return{historyStack:(this._historyStack||[]).slice(),position:this.position,rootTransaction:this.rootTransaction,status:this._status}},i.prototype.add=function(e){if(!e)throw new Error("Undo operation cannot be null");for(;this.maxOperations>0&&this._historyStack.length>=this.maxOperations;){var t=this._historyStack.shift();this.app.event("UndoOperationDiscardedEvent").publish({sender:this,operation:t})}this._historyStack.splice(this.position,0,e),this.position++,this.clearRedo(),this.app.event("UndoOperationAddedEvent").publish({sender:this,operation:e}),this._checkAvailability()},i.prototype.undo=function(){var t=this;if(0===this.position)return Promise.resolve();var i=this.peekUndo();return this.position--,i&&"function"==typeof i.performUndo?(this._updateStatus(e.undo.Status.UNDOING),this.app.event("UndoStartedEvent").publish({sender:this,operation:i}),i.performUndo(i.state).lastly(function(){t._updateStatus(e.undo.Status.IDLE),t.app.event("UndoCompletedEvent").publish({sender:t,operation:i}),t._checkAvailability()})):Promise.resolve()},i.prototype.redo=function(){var t=this;if(this.position===this._historyStack.length)return Promise.resolve();var i=this.peekRedo();return this.position++,i&&"function"==typeof i.performRedo?(this._updateStatus(e.undo.Status.REDOING),this.app.event("RedoStartedEvent").publish({sender:this,operation:i}),i.performRedo(i.state).lastly(function(){t._updateStatus(e.undo.Status.IDLE),t.app.event("RedoCompletedEvent").publish({sender:t,operation:i}),t._checkAvailability()})):Promise.resolve()},i.prototype.peekUndo=function(){return this._historyStack.length>0&&this.position>0?this.getAt(this.position-1):null},i.prototype.peekRedo=function(){return this._historyStack.length>0&&this.position<this._historyStack.length?this.getAt(this.position):null},i.prototype.clearUndo=function(){this._historyStack.splice(0,this.position),this.position=0,this._checkAvailability()},i.prototype.clearRedo=function(){this._historyStack.splice(this.position,this._historyStack.length-this.position),this.position=this._historyStack.length,this._checkAvailability()},i.prototype.getAt=function(e){return this._historyStack[e]},i.prototype.removeAt=function(e){0<=e&&e<this._historyStack.length&&(this._historyStack.splice(e,1),this.position>0&&this.position>e&&this.position--,this._checkAvailability())},i.prototype.beginTransaction=function(e,i){var r=new t.UndoTransaction(this,e);return this.rootTransaction?r.parentTransaction=i||this.rootTransaction:this.rootTransaction=r,r},i.prototype.commitTransaction=function(e){var i=this;if(!(e=e||this.rootTransaction))return Promise.reject(new Error("Cannot find the transaction to commit"));if(e.isComplete())return Promise.reject(new Error("Transaction has been closed already"));if(e.transactionStatus=t.TransactionStatus.COMMITTING,!e.hasChanges())return e.transactionStatus=t.TransactionStatus.COMMITTED,this._onTransactionCommitted(e),Promise.resolve();var r=function(i){return i instanceof t.UndoTransaction?i.isComplete()?Promise.resolve():i.commit():i&&"function"==typeof i.performRedo?i.performRedo(i.state,e):void 0},n=function(e,t){return t?r(t):null},a=e.changes[0];return r(a).then(function(){return Promise.reduce(e.changes.slice(1),n,null)}).then(function(){e.transactionStatus==t.TransactionStatus.COMMITTING&&(e.transactionStatus=t.TransactionStatus.COMMITTED,i._onTransactionCommitted(e))})},i.prototype.rollbackTransaction=function(e){var i=this;if(!(e=e||this.rootTransaction))return Promise.reject(new Error("Cannot find the transaction to rollback"));if(e.isComplete())return Promise.reject(new Error("Transaction has been closed already"));if(e.transactionStatus=t.TransactionStatus.ABORTING,!e.hasChanges())return e.transactionStatus=t.TransactionStatus.ABORTED,this._onTransactionAborted(e),Promise.resolve();return Promise.reduce(e.changes.slice().reverse(),function(i,r){return r instanceof t.UndoTransaction?r.isAborted()?Promise.resolve():r.rollback():r&&"function"==typeof r.performUndo?r.performUndo(r.state,e):void 0},null).then(function(){if(e.isAborted()||(e.transactionStatus=t.TransactionStatus.ABORTED,i._onTransactionAborted(e)),!e.isTopLevel()&&!e.parentTransaction.isAborted())return i.rollbackTransaction(e.parentTransaction)})},i.prototype.destroy=function(){this._historyStack=null},i.prototype._onTransactionCommitted=function(e){e&&e.isTopLevel()&&e==this.rootTransaction&&(this.rootTransaction=null,this.add(e))},i.prototype._onTransactionAborted=function(e){if(e){var t=e.parentTransaction;if(t){var i=t.changes.indexOf(e);i>-1&&t.changes.splice(i,1)}e.isTopLevel()&&e==this.rootTransaction&&(this.rootTransaction=null)}},i.prototype._checkAvailability=function(){this.length=this._historyStack.length,this.isUndoing=this._status==e.undo.Status.UNDOING,this.isRedoing=this._status==e.undo.Status.REDOING,0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canUndo=!1,this.canRedo=!0):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canUndo=this.canRedo=!0,this.app.command("Undo").raiseCanExecuteChanged(),this.app.command("Redo").raiseCanExecuteChanged(),this.app.event("UndoStackChangedEvent").publish({sender:this})},i.prototype._updateStatus=function(t){this._status=t||e.undo.Status.IDLE,this.isUndoing=this._status==e.undo.Status.UNDOING,this.isRedoing=this._status==e.undo.Status.REDOING},i}();t.UndoManager=i}(e.undo||(e.undo={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.SIMPLE_MARKER="esriSMS",e.SIMPLE_LINE="esriSLS",e.SIMPLE_FILL="esriSFS",e.PICTURE_MARKER="esriPMS",e.PICTURE_FILL="esriPFS",e.TEXT="esriTS"}(e.SymbolType||(e.SymbolType={}));!function(e){e.CIRCLE="esriSMSCircle",e.CROSS="esriSMSCross",e.DIAMOND="esriSMSDiamond",e.SQUARE="esriSMSSquare",e.X="esriSMSX",e.TRIANGLE="esriSMSTriangle",e.PATH="esriSMSPath"}(e.SimpleMarkerStyle||(e.SimpleMarkerStyle={}));!function(e){e.DASH="esriSLSDash",e.DASH_DOT="esriSLSDashDot",e.DASH_DOT_DOT="esriSLSDashDotDot",e.DOT="esriSLSDot",e.NONE="esriSLSNull",e.SOLID="esriSLSSolid"}(e.SimpleLineStyle||(e.SimpleLineStyle={}));!function(e){e.BACKWARD_DIAGONAL="esriSFSBackwardDiagonal",e.CROSS="esriSFSCross",e.DIAGONAL_CROSS="esriSFSDiagonalCross",e.FORWARD_DIAGONAL="esriSFSForwardDiagonal",e.HORIZONTAL="esriSFSHorizontal",e.NONE="esriSFSNull",e.SOLID="esriSFSSolid",e.VERTICAL="esriSFSVertical"}(e.SimpleFillStyle||(e.SimpleFillStyle={}));!function(e){e.BASELINE="baseline",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom"}(e.VerticalAlignment||(e.VerticalAlignment={}));!function(e){e.LEFT="left",e.RIGHT="right",e.CENTER="center",e.JUSTIFY="justify"}(e.HorizontalAlignment||(e.HorizontalAlignment={}));!function(e){e.ITALIC="italic",e.NORMAL="normal",e.OBLIQUE="oblique"}(e.FontStyle||(e.FontStyle={}));!function(e){e.BOLD="bold",e.BOLDER="bolder",e.LIGHTER="lighter",e.NORMAL="normal"}(e.FontWeight||(e.FontWeight={}));!function(e){e.LINE_THROUGH="line-through",e.UNDERLINE="underline",e.NONE="none"}(e.TextDecoration||(e.TextDecoration={}))}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=e.framework.utils.ArrayUtils,n=function(){return function(){}}();i.CONVERSION_TYPE_PROPERTY="__conversionType";var a,s={type:i.SymbolType.SIMPLE_MARKER,style:i.SimpleMarkerStyle.CIRCLE,size:0,color:[0,0,0,0]};!function(e){e.FeatureLayer="ArcGISFeatureLayer",e.MapService="ArcGISMapServiceLayer",e.TiledMapService="ArcGISTiledMapServiceLayer",e.ImageService="ArcGISImageServiceLayer",e.BingAerial="BingMapsAerial",e.BingHybrid="BingMapsHybrid",e.BingRoad="BingMapsRoad",e.OpenStreetMap="OpenStreetMap",e.WebTiled="WebTiledLayer",e.KML="KML",e.WMS="WMS"}(a||(a={}));var o;!function(e){e.WEB_MAP_SERVICE_LAYER="webMapServiceLayer",e.WEB_MAP_LAYER="webMapLayer",e.WEB_MAP_FEATURE_SET="webMapFeatureSet",e.WEB_MAP_FEATURE="webMapFeature",e.WEB_MAP_GEOMETRY="webMapGeometry",e.WEB_MAP_SYMBOL="webMapSymbol",e.WEB_MAP_RENDERER="webMapRenderer",e.WEB_MAP_SPATIAL_REFERENCE="webMapSpatialReference",e.WEB_MAP_COLOR="webMapColor",e.WEB_MAP_DATA="webMapData",e.GCX_MAP_SERVICE="gcxMapService",e.GCX_LAYER="gcxLayer",e.GCX_FEATURE_SET="gcxFeatureSet",e.GCX_FEATURE="gcxFeature",e.ESRI_LAYER="esriLayer",e.ESRI_FEATURE_SET="esriFeatureSet",e.ESRI_GRAPHIC="esriGraphic",e.ESRI_GEOMETRY="esriGeometry",e.ESRI_SYMBOL="esriSymbol",e.ESRI_RENDERER="esriRenderer",e.ESRI_SPATIAL_REFERENCE="esriSpatialReference",e.ESRI_COLOR="esriColor",e.OBJECT="object"}(o=i.ConversionType||(i.ConversionType={}));var l=function(){function l(e){this._resultCache={},this._nextSymbolId=1,this._nestingLevel=0,this._hasReferences=!1,this._converting={},this.app=e}return l.prototype.fromGcxMapService=function(e){return this._convert(e,o.WEB_MAP_SERVICE_LAYER,this._fromGcxMapService)},l.prototype.fromGcxLayer=function(e){return this._convert(e,o.WEB_MAP_LAYER,this._fromGcxlayer)},l.prototype.fromGcxFeatureSet=function(e){return this._convert(e,o.WEB_MAP_FEATURE_SET,this._fromGcxFeatureSet)},l.prototype.fromGcxFeature=function(e){return this._convert(e,o.WEB_MAP_FEATURE,this._fromGcxFeature)},l.prototype.fromEsriLayer=function(e){return this._convert(e,o.WEB_MAP_SERVICE_LAYER,this._fromEsriLayer)},l.prototype.fromEsriFeatureSet=function(e){return this._convert(e,o.WEB_MAP_FEATURE_SET,this._fromEsriFeatureSet)},l.prototype.fromEsriGraphic=function(e){return this._convert(e,o.WEB_MAP_FEATURE,this._fromEsriGraphic)},l.prototype.fromEsriGeometry=function(e){return this._convert(e,o.WEB_MAP_GEOMETRY,this._fromEsriGeometry)},l.prototype.fromEsriSymbol=function(e){return this._convert(e,o.WEB_MAP_SYMBOL,this._fromEsriSymbol)},l.prototype.fromEsriRenderer=function(e){return this._convert(e,o.WEB_MAP_RENDERER,this._fromEsriRenderer)},l.prototype.fromEsriSpatialReference=function(e){return this._convert(e,o.WEB_MAP_SPATIAL_REFERENCE,this._fromEsriSpatialReference)},l.prototype.fromEsriColor=function(e){return this._convert(e,o.WEB_MAP_COLOR,this._fromEsriColor)},l.prototype.fromObject=function(e){return this._convert(e,o.WEB_MAP_DATA,this._fromObject)},l.prototype.toGcxMapService=function(e){return Promise.resolve(this._convert(e,o.GCX_MAP_SERVICE,this._toGcxMapService))},l.prototype.toGcxLayer=function(e,t){return Promise.resolve(this._convert(e,o.GCX_LAYER,this._toGcxLayer,[t]))},l.prototype.toGcxFeatureSet=function(e){return Promise.resolve(this._convert(e,o.GCX_FEATURE_SET,this._toGcxFeatureSet))},l.prototype.toGcxFeature=function(e){return Promise.resolve(this._convert(e,o.GCX_FEATURE,this._toGcxFeature))},l.prototype.toEsriLayer=function(e){return Promise.resolve(this._convert(e,o.ESRI_LAYER,this._toEsriLayer))},l.prototype.toEsriFeatureSet=function(e){return Promise.resolve(this._convert(e,o.ESRI_FEATURE_SET,this._toEsriFeatureSet))},l.prototype.toEsriGraphic=function(e){return Promise.resolve(this._convert(e,o.ESRI_GRAPHIC,this._toEsriGraphic))},l.prototype.toEsriGeometry=function(e){return this._convert(e,o.ESRI_GEOMETRY,this._toEsriGeometry)},l.prototype.toEsriSymbol=function(e){return this._convert(e,o.ESRI_SYMBOL,this._toEsriSymbol)},l.prototype.toEsriRenderer=function(e){return this._convert(e,o.ESRI_RENDERER,this._toEsriRenderer)},l.prototype.toEsriSpatialReference=function(e){return this._convert(e,o.ESRI_SPATIAL_REFERENCE,this._toEsriSpatialReference)},l.prototype.toEsriColor=function(e){return this._convert(e,o.ESRI_COLOR,this._toEsriColor)},l.prototype.toObject=function(e){return Promise.resolve(this._convert(e,o.OBJECT,this._toObject))},l.prototype.clearCache=function(){this._resultCache={}},l.prototype._convert=function(e,t,i,r){if(void 0===r&&(r=[]),null===e||void 0===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||e instanceof Date)return e;var a=this._resultCache[t];a||(a=this._resultCache[t]=new WeakMap);var s=this._converting[t];if(s||(s=this._converting[t]=new WeakMap),a.has(e))return a.get(e);if(s.has(e)){var o=new n;return a.set(e,o),this._hasReferences=!0,o}var l=void 0;0===this._nestingLevel&&(this._hasReferences=!1),this._nestingLevel++,s.set(e,!0);try{l=i.apply(this,[e].concat(r)),(o=a.get(e))&&(o.result=l),a.set(e,l)}catch(t){throw a.delete(e),t}finally{this._nestingLevel--,s.delete(e)}return 0===this._nestingLevel&&this._hasReferences&&this._resolveReferences(l),l},l.prototype._resolveReferences=function(t){if(t){var i=new WeakMap,r=function(t){if(!(t instanceof e.essentials.MapService||t instanceof e.essentials.Layer)){i.set(t,!0);for(var a in t){var s=t[a];"object"==typeof s&&(s instanceof n?t[a]=s.result:s&&!i.has(s)&&r(s))}}};r(t)}},l.prototype._getWebMapLayerDefinitionFromFeatureLayer=function(e){var t={};return t.definitionExpression=e.getDefinitionExpression(),t.drawingInfo={renderer:this.fromEsriRenderer(e.renderer)},t},l.prototype._getWebMapLayerDefinitionFromDynamicLayer=function(e,t){var i={},n=!1;if(e.layerDefinitions&&e.layerDefinitions[t]&&(n=!0,i.definitionExpression=e.layerDefinitions[t]),e.dynamicLayerInfos){var a=r.firstOrDefault(e.dynamicLayerInfos,function(e){return e.id===t});a&&(n=!0,i.minScale=a.minScale,i.maxScale=a.maxScale,i.source=a.source.toJson())}return e.layerDrawingOptions&&e.layerDrawingOptions[t]&&(n=!0,i.drawingInfo={renderer:this.fromEsriRenderer(e.layerDrawingOptions[t].renderer),fixedSymbols:!e.layerDrawingOptions[t].scaleSymbols}),n?i:null},l.prototype._applyWebMapServiceLayerToMapService=function(e,t){var i=this;return Promise.try(function(){t.setOpacity(e.opacity),t.setVisibility(e.visibility);var r=t.serviceLayer,n=e;return r instanceof esri.layers.FeatureLayer&&(t.layers[0].setVisibility(e.visibility),n.layerDefinition&&n.layerDefinition.definitionExpression&&r.setDefinitionExpression(n.layerDefinition.definitionExpression)),i._isFeatureCollection(e)&&n.featureCollection.layers[0].layerDefinition?i._applyDrawingInfo(n.featureCollection.layers[0].layerDefinition.drawingInfo,t):n.layerDefinition?i._applyDrawingInfo(n.layerDefinition.drawingInfo,t):void 0})},l.prototype._applyWebMapLayersToGcxLayers=function(e,t){var i=this,r=[];return(e.layers||[]).forEach(function(e,n){var a=i._findOrCreateMatchingGcxLayer(e,t).then(function(t){return!!t&&i._applyWebMapLayerToGcxLayer(e,n,t)});r.push(a)}),Promise.all(r).then(function(e){return e.some(function(e){return e})})},l.prototype._applyWebMapLayerToGcxLayer=function(e,t,i){var n=this,a=i.mapService.serviceLayer;if(!(e.layerDefinition&&a instanceof esri.layers.ArcGISDynamicMapServiceLayer))return Promise.resolve(!1);var s=a;return this.app.waitUntilServiceLayerLoaded(a).then(function(){var t=parseInt(i.id),a=!1;if(e.layerDefinition.definitionExpression){var o=(s.layerDefinitions||[]).slice();o[t]=e.layerDefinition.definitionExpression,s.setLayerDefinitions(o,!0),a=!0}if(e.layerDefinition.drawingInfo){i.mapService.convertToDynamicLayers();var l=(s.layerDrawingOptions||[]).slice();if(l[t]=new esri.layers.LayerDrawingOptions,l[t].renderer=n.toEsriRenderer(e.layerDefinition.drawingInfo.renderer),l[t].scaleSymbols=!e.layerDefinition.drawingInfo.fixedSymbols,e.layerDefinition.drawingInfo.hasOwnProperty("showLabels")&&(l[t].showLabels=e.layerDefinition.drawingInfo.showLabels),e.layerDefinition.drawingInfo.hasOwnProperty("labelingInfo")){var c=e.layerDefinition.drawingInfo.labelingInfo;l[t].labelingInfo=l[t].labelingInfo||[],l[t].labelingInfo.length?l[t].labelingInfo[0]=new esri.layers.LabelClass(c[0]):l[t].labelingInfo.push(new esri.layers.LabelClass(c[0]));var u=c[0],p=u.symbol.color,h=u.symbol.haloColor;l[t].labelingInfo[0].symbol.setColor(new esri.Color([p.r,p.g,p.b,p.a])),l[t].labelingInfo[0].symbol.setHaloColor(new esri.Color([h.r,h.g,h.b,h.a]));var d=l[t].labelingInfo[0].symbol;l[t].labelingInfo[0].symbol.font.setSize(.75*d.font.size),l[t].labelingInfo[0].symbol.setHaloSize(.75*d.haloSize)}s.setLayerDrawingOptions(l,!0),a=!0}if(s.dynamicLayerInfos){var m=r.firstOrDefault(s.dynamicLayerInfos,function(e){return e.id===t});m&&(m.minScale=e.layerDefinition.minScale,m.maxScale=e.layerDefinition.maxScale,s.setDynamicLayerInfos(s.dynamicLayerInfos,!0),a=!0)}return a})},l.prototype._applyDrawingInfo=function(e,t){var r=this;if(!e)return Promise.resolve();var n=t.serviceLayer;return this.app.waitUntilServiceLayerLoaded(n).then(function(){if(!t.heatMap||!t.heatMap.userCanToggle||t.isUserCreated&&t.heatMap.enabled||r.app.command("RemoveHeatMap").execute({gcxLayer:t.layers[0]}),e.renderer)if(t.heatMap&&t.heatMap.userCanToggle&&e.renderer.type===i.RendererType.HEATMAP){var a=e.renderer;if(a){var s=t.heatMap;s.intensity=a.blurRadius,s.field=a.field,s.gradient=[],s.offset=[],(a.colorStops||[]).forEach(function(e,t){s.gradient[t]=e.color,s.offset[t]=e.ratio}),r.app.command("AddHeatMap").execute({gcxLayer:t.layers[0]})}}else n instanceof esri.layers.GraphicsLayer&&r._setGraphicsLayerRenderer(n,r.toEsriRenderer(e.renderer))})},l.prototype._setGraphicsLayerRenderer=function(e,t){e.setRenderer(t),e.redraw()},l.prototype._findMatchingGcxMapService=function(e){var t=this.app.site.essentialsMap.findMapServiceById(e.id);return t=t||r.firstOrDefault(this.app.site.essentialsMap.mapServices,function(t){return t.serviceUrl===e.url})},l.prototype._findMatchingGcxLayer=function(e,t){var i="object"==typeof e?e:null,n=null;i&&(n=t.findLayerByName(i.name));var a=i?i.id.toString():e.toString();n=n||t.findLayerById(a);var s=void 0;return!(n=n||r.firstOrDefault(t.layers,function(e){return e.wmsLayerName===a}))&&i&&i.layerDefinition&&i.layerDefinition.source&&"mapLayer"===i.layerDefinition.source.type&&(s=i.layerDefinition.source.mapLayerId),n||null===s||void 0===s||(n=t.findLayerById(s.toString())),n||t.layers.forEach(function(e){if(e.dynamicDefinition){var t=JSON.parse(e.dynamicDefinition);!t||!t.source||"mapLayerId"!==t.source.type||!t.source.mapLayerId&&0!==t.source.mapLayerId||t.source.mapLayerId.toString()!==a&&t.source.mapLayerId.toString()!==s||(n=e)}}),n},l.prototype._findOrCreateMatchingGcxLayer=function(e,t){var i=this._findMatchingGcxLayer(e,t);return!i&&this._canCreateGcxLayer(e,t)?this._createGcxLayer(e,t):Promise.resolve(i)},l.prototype._findOrCreateMatchingGcxMapService=function(e){var t=this._findMatchingGcxMapService(e);return!t&&this._canCreateGcxMapService(e)?this._createGcxMapService(e):Promise.resolve(t)},l.prototype._canCreateGcxLayer=function(e,t){return t.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer},l.prototype._createGcxLayer=function(t,i){if(!this._canCreateGcxLayer(t,i))return Promise.reject(new Error("WebMapConverter._createGcxLayer: Unsupported layer type."));var r={source:{type:"mapLayerId",mapLayerId:t.id}};t.layerDefinition&&t.layerDefinition.drawingInfo&&(r.drawingInfo=t.layerDefinition.drawingInfo);var n={id:t.id.toString(),name:t.name,displayName:t.title||t.name,isDynamic:!0,dynamicDefinition:JSON.stringify(r)},a=new e.essentials.Layer(i.url+"/layers/"+t.id.toString());return a.createFromDefinition(n),i.add(a),Promise.resolve(a)},l.prototype._canCreateGcxMapService=function(e){return this._isFeatureCollection(e)||this._isKmlLayer(e)||this._isLayerCatalogService(e)},l.prototype._createGcxMapService=function(e){var i=this,r=this._getMapServiceDefinition(e);if(this._isLayerCatalogService(e)){var n=e.gcxMapServiceDefinition.catalogId,a=e.layers.map(function(e){return e.gcxLayerDefinition.catalogId});return new Promise(function(t,r){var s={mapServiceId:e.id,layerLookupIds:a,lookupId:n,callback:function(e){e&&t(e),r(new Error("WebMapConverter._createGcxMapService: Unsupported layer catalog id."))}};i.app.waitUntilAllLibrariesLoaded().then(function(){i.app.command("LayerCatalogRestoreMapService").execute(s)})})}if(this._isFeatureCollection(e)){var s=e,o=s.featureCollection.layers[0],l=o.featureSet||{},c=l.features||[],u=o.layerDefinition&&o.layerDefinition.drawingInfo&&o.layerDefinition.drawingInfo.renderer?dojo.clone(o.layerDefinition.drawingInfo.renderer):{};l.features=[];var p={mapService:t.LayerIntegrationUtils.buildLocalFeatureLayerService(o,r),graphics:Promise.map(c,function(e){return i.toEsriGraphic(e)})};return Promise.props(p).then(function(e){var t=e.mapService;return u&&(o.layerDefinition.drawingInfo.renderer=u,s.layerDefinition.drawingInfo.renderer=u,t.serviceLayer.setRenderer(i._toEsriRenderer(u))),e.graphics.forEach(function(e){t.serviceLayer.add(e)}),e.graphics.length&&(t.serviceLayer.fullExtent=esri.graphicsExtent(e.graphics)),i.app.site.essentialsMap.addMapService(t),t})}return this._isKmlLayer(e)?t.LayerIntegrationUtils.buildKmlService(e.url,r).then(function(e){return i.app.site.essentialsMap.addMapService(e),e}):Promise.reject(new Error("WebMapConverter._createGcxMapService: Unsupported service layer type."))},l.prototype._getMapServiceDefinition=function(e){return{id:e.id,displayName:e.title}},l.prototype._isFeatureCollection=function(e){var t=e;return t.featureCollection&&t.featureCollection.layers&&1===t.featureCollection.layers.length&&!!t.featureCollection.layers[0].featureSet},l.prototype._isKmlLayer=function(e){return e.type===i.OperationalLayerType.KML},l.prototype._isGraphicsLayer=function(e){return e.id&&e.id.startsWith("graphics-layer-")},l.prototype._isLayerCatalogService=function(e){var t=e;return t.gcxMapServiceDefinition&&t.gcxMapServiceDefinition.catalogId},l.prototype._addSourceType=function(e,t){return t[i.CONVERSION_TYPE_PROPERTY]=e,t},l.prototype._getWebMapLayerType=function(e){if(e instanceof esri.layers.FeatureLayer)return a.FeatureLayer;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer)return a.MapService;if(e instanceof esri.layers.ArcGISTiledMapServiceLayer)return a.TiledMapService;if(e instanceof esri.layers.ArcGISImageServiceLayer)return a.ImageService;if(e instanceof esri.virtualearth.VETiledLayer)switch(e.mapStyle.toLowerCase()){case esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL.toLowerCase():return a.BingAerial;case esri.virtualearth.VETiledLayer.MAP_STYLE_AERIAL_WITH_LABELS.toLowerCase():return a.BingHybrid;case esri.virtualearth.VETiledLayer.MAP_STYLE_ROAD.toLowerCase():return a.BingRoad}else{if(e instanceof esri.layers.WebTiledLayer)return e.url&&e.url.indexOf("tile.openstreetmap.org")>=0?a.OpenStreetMap:a.WebTiled;if(e instanceof esri.layers.KMLLayer)return a.KML;if(e instanceof esri.layers.WMSLayer)return a.WMS;if(e instanceof esri.layers.WMTSLayer)return a.WebTiled}},l.prototype._inferAttributeType=function(t,i){var n=r.firstOrDefault(t,function(t){return t.attributes&&!e.framework.utils.isNullOrUndefined(t.attributes[i])});if(!n)return e.essentials.EsriFieldTypes.esriFieldTypeString;var a=n.attributes[i];return"number"==typeof a?e.essentials.EsriFieldTypes.esriFieldTypeDouble:a instanceof Date?e.essentials.EsriFieldTypes.esriFieldTypeDate:e.essentials.EsriFieldTypes.esriFieldTypeString},l.prototype._setVisibleLayers=function(t,i){var n=this;if(!i.supportsLayerVisibility())return!1;var a=!1,s=[],o=t.visibleLayers||[],l=t.layers||[];return o.forEach(function(e){var t=void 0;if(l){var a=r.firstOrDefault(l,function(t){return t.id===e});(a=a||r.firstOrDefault(l,function(t){return t.name===e}))&&(t=n._findMatchingGcxLayer(a,i))}t||(t=n._findMatchingGcxLayer(e,i)),t&&s.push(t)}),i.layers.forEach(function(t){if(t.type!==e.essentials.LayerType.GROUP_LAYER){var i=s.indexOf(t)>=0;a=a||i!==t.isVisible(),t.setVisibility(i,!0)}}),a},l.prototype._toGcxMapService=function(e){var t=this,i=void 0,r=e;return Promise.all([this.app.waitUntilSiteInitialized(),this.app.waitUntilMapLoaded()]).then(function(){return t._findOrCreateMatchingGcxMapService(e)}).then(function(r){if(!(i=r))throw new Error('No matching Essentials map service was found for service "{0}".'.format(e.id));return t._applyWebMapServiceLayerToMapService(e,i)}).then(function(){return t._applyWebMapLayersToGcxLayers(r,i)}).then(function(e){return(e=t._setVisibleLayers(r,i)||e)&&i.refresh(),i})},l.prototype._toGcxLayer=function(e,t){var i=this;if(!t)throw new Error('WebMapConverter.toGcxLayer: Parameter "serviceLayer" is required.');return this.toGcxMapService(t).then(function(r){var n=i._findMatchingGcxLayer(e,r);if(!n)throw new Error('No matching Essentials layer was found for layer "{0}" for service "{1}".'.format(e.id,t.id));return n})},l.prototype._toGcxFeatureSet=function(e){var i=this;return this.toEsriFeatureSet(e).then(function(e){return new t.FeatureSet({app:i.app,esriFeatureSet:e})})},l.prototype._toEsriLayer=function(e){if(this._isGraphicsLayer(e))return this._toEsriGraphicsLayer(e);if(e.layerType===a.FeatureLayer)return this._toEsriFeatureLayer(e);throw new Error("WebMapConverter.toEsriLayer: Unsupported layer type.")},l.prototype._toEsriGraphicsLayer=function(e){var t=this,i=e.id.slice("graphics-layer-".length),r=this.app.map.getLayer(i);return!r||r instanceof esri.layers.GraphicsLayer?Promise.all([this.app.waitUntilSiteInitialized(),this.app.waitUntilMapLoaded()]).then(function(){var n=r;n||(n=new esri.layers.GraphicsLayer({id:i}),t.app.map.addLayer(n)),n.setVisibility(e.visibility),n.setOpacity(e.opacity),n.clear();var a=[];return((e.featureCollection||{}).layers||[]).forEach(function(e){if(((e.featureSet||{}).features||[]).forEach(function(e){e.attributes&&(a[e.attributes.__id]=t.toEsriGraphic(e))}),!n.renderer&&e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer){var i=e.layerDefinition.drawingInfo.renderer;i.uniqueValueInfos&&i.uniqueValueInfos[0]&&JSON.stringify(i.uniqueValueInfos[0].symbol)===JSON.stringify(s)||n.setRenderer(t.toEsriRenderer(i))}}),Promise.all(a).then(function(e){return e.forEach(function(e){e&&n.add(e)}),n})}):Promise.resolve(r)},l.prototype._toEsriFeatureLayer=function(e){var t=this;if(e.url){var i=new esri.layers.FeatureLayer(e.url);return i.setVisibility(e.visibility),i.setOpacity(e.opacity),this.app.waitUntilServiceLayerLoaded(i).return(i)}if(this._isFeatureCollection(e)){var r=new esri.layers.FeatureLayer(e.featureCollection.layers[0]);r.setVisibility(e.visibility),r.setOpacity(e.opacity),r.clear();var n=(e.featureCollection.layers[0].featureSet||{}).features||[];return Promise.map(n,function(e){return t.toEsriGraphic(e).then(function(e){return r.add(e)})}).return(r)}throw new Error("WebMapConverter.toEsriLayer: Unsupported layer type.")},l.prototype._toEsriFeatureSet=function(e){var i=this,r=e.features||[];return t.PromiseUtils.mapSkipRejected(r,function(e){return i.toEsriGraphic(e)}).then(function(e){var t=new esri.tasks.FeatureSet;return t.features=e,t})},l.prototype._toGcxFeature=function(e){return this.toEsriGraphic(e).then(function(e){return new t.Feature({graphic:e})})},l.prototype._toEsriGraphic=function(e){var t=this;return this.toObject(e.attributes).then(function(i){var r,n=t.toEsriGeometry(e.geometry),a=!0;i&&(r=i.__symbol,delete i.__symbol,i.hasOwnProperty("__visible")&&(a=i.__visible,delete i.__visible),delete i.__id);var s=new esri.Graphic(n,r,i,null);return s.visible=a,s})},l.prototype._toEsriGeometry=function(e){if(e.hasOwnProperty("x")&&e.hasOwnProperty("y"))return new esri.geometry.Point(e);if(e.hasOwnProperty("points"))return new esri.geometry.Multipoint(e);if(e.hasOwnProperty("paths"))return new esri.geometry.Polyline(e);if(e.hasOwnProperty("rings"))return new esri.geometry.Polygon(e);if(e.hasOwnProperty("xmin")&&e.hasOwnProperty("xmax")&&e.hasOwnProperty("ymin")&&e.hasOwnProperty("ymax"))return new esri.geometry.Extent(e);throw new Error("WebMapConverter.toEsriGeometry: Unrecognized type of geometry object.")},l.prototype._toEsriSymbol=function(e){switch(e.type){case i.SymbolType.SIMPLE_MARKER:var t=new esri.symbol.SimpleMarkerSymbol(e);return e.size!==t.size&&(t.size=e.size),t;case i.SymbolType.SIMPLE_LINE:return new esri.symbol.SimpleLineSymbol(e);case i.SymbolType.SIMPLE_FILL:return new esri.symbol.SimpleFillSymbol(e);case i.SymbolType.PICTURE_MARKER:return new esri.symbol.PictureMarkerSymbol(e);case i.SymbolType.PICTURE_FILL:return new esri.symbol.PictureFillSymbol(e);case i.SymbolType.TEXT:return new esri.symbol.TextSymbol(e);default:throw new Error('WebMapConverter.toEsriSymbol: Unsupported symbol type "{0}".'.format(e.type))}},l.prototype._toEsriRenderer=function(e){var t=this;switch(e.type){case i.RendererType.SIMPLE:var r=new esri.renderer.SimpleRenderer(dojo.clone(e));return r.symbol=this.toEsriSymbol(e.symbol),r;case i.RendererType.UNIQUE_VALUE:var n=new esri.renderer.UniqueValueRenderer(dojo.clone(e));return n.defaultSymbol=this.toEsriSymbol(e.defaultSymbol),n.infos.forEach(function(i,r){i.symbol=t.toEsriSymbol(e.uniqueValueInfos[r].symbol)}),n;case i.RendererType.CLASS_BREAKS:var a=new esri.renderer.ClassBreaksRenderer(dojo.clone(e));return a.defaultSymbol=this.toEsriSymbol(e.defaultSymbol),a.infos.forEach(function(i,r){i.symbol=t.toEsriSymbol(e.classBreakInfos[r].symbol)}),a;case i.RendererType.HEATMAP:return new esri.renderer.HeatmapRenderer(dojo.clone(e));default:throw new Error('WebMapConverter.toEsriRenderer: Unsupported renderer type "{0}".'.format(e.type))}},l.prototype._toEsriSpatialReference=function(e){return new esri.SpatialReference(e)},l.prototype._toEsriColor=function(e){return new esri.Color(e)},l.prototype._toObject=function(e){var t=this;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e||e instanceof Date||null===e||void 0===e)return Promise.resolve(e);if(e.hasOwnProperty(i.CONVERSION_TYPE_PROPERTY))switch(e[i.CONVERSION_TYPE_PROPERTY]){case o.GCX_MAP_SERVICE:return this.toGcxMapService(e);case o.GCX_LAYER:return this.toGcxLayer(e,null);case o.GCX_FEATURE_SET:return this.toGcxFeatureSet(e);case o.GCX_FEATURE:return this.toGcxFeature(e);case o.ESRI_LAYER:return this.toEsriLayer(e);case o.ESRI_FEATURE_SET:return this.toEsriFeatureSet(e);case o.ESRI_GRAPHIC:return this.toEsriGraphic(e);case o.ESRI_GEOMETRY:return Promise.resolve(this.toEsriGeometry(e));case o.ESRI_SYMBOL:return Promise.resolve(this.toEsriSymbol(e));case o.ESRI_RENDERER:return Promise.resolve(this.toEsriRenderer(e));case o.ESRI_SPATIAL_REFERENCE:return Promise.resolve(this.toEsriSpatialReference(e))}var r={},n=[];return Object.keys(e).forEach(function(i){n.push(t.toObject(e[i]).then(function(e){r[i]=e}))}),Promise.all(n).return(r)},l.prototype._fromGcxMapService=function(t){var r=this,n=t.serviceLayer,a={id:t.id,url:t.serviceUrl,opacity:t.opacity,visibility:t.isVisible(),layerType:this._getWebMapLayerType(n)};if(t.mapServiceFunction===e.essentials.MapServiceFunction.OPERATIONAL){var s=a;if(s.title=t.displayName,s.minScale=t.minScale===1/0?0:t.minScale,s.maxScale=t.maxScale,n instanceof esri.layers.ArcGISDynamicMapServiceLayer){s.capabilities=n.capabilities,s.visibleLayers=n.visibleLayers.map(function(e){return parseInt(e)});var o=t.layers;n.dynamicLayerInfos&&(o=[],n.dynamicLayerInfos.forEach(function(e,i){var r=t.findLayerById(e.id.toString());r&&o.push(r)})),s.layers=o.map(function(e){return r.fromGcxLayer(e)})}else n instanceof esri.layers.WMSLayer?(s.visibleLayers=n.visibleLayers,s.type=i.OperationalLayerType.WMS):n instanceof esri.layers.KMLLayer?s.type=i.OperationalLayerType.KML:n instanceof esri.layers.FeatureLayer&&(s.layerDefinition=this._getWebMapLayerDefinitionFromFeatureLayer(n),s.capabilities=n.capabilities,t.isUserCreated&&n.graphics&&n.graphics.length&&(s.featureCollection=this._esriFeatureLayerToFeatureCollection(n),s.featureCollection.showLegend=t.layers[0].includeInLegend));n instanceof esri.layers.GraphicsLayer&&n.renderer instanceof esri.renderer.HeatmapRenderer&&!s.featureCollection&&(s.layerDefinition=s.layerDefinition||{},s.layerDefinition.drawingInfo={renderer:this.fromEsriRenderer(n.renderer)})}else{var l=a;if(n instanceof esri.virtualearth.VETiledLayer)l.type=a.layerType,delete a.url;else if(n instanceof esri.layers.WebTiledLayer)l.type=a.layerType,l.templateUrl=n.url,delete a.url;else if(n instanceof esri.layers.WMTSLayer){if(l.type=i.BaseMapType.WEB_TILED,!t.tileRestUrl)throw new Error('WebMapConverter.fromGcxMapService: WMTS layers are only supported if the "tileRestUrl" property is set.');t.tileRestUrl&&!n.resourceUrls&&(n.resourceUrls=[{template:t.tileRestUrl}]),l.templateUrl=n._getTileUrlTemplate(),delete a.url}}return a},l.prototype._esriFeatureLayerToFeatureCollection=function(e){var t=e.toJson().layerDefinition||{};return{layers:[{featureSet:{geometryType:e.geometryType,features:e.graphics.map(this.fromEsriGraphic,this)},layerDefinition:{displayField:t.displayField,fields:t.fields,geometryType:t.geometryType,hasAttachments:t.hasAttachments,minScale:t.minScale,maxScale:t.maxScale,name:t.name,objectIdField:t.objectIdField,templates:t.templates,type:t.type,typeIdField:t.typeIdField,types:t.types,drawingInfo:{renderer:this.fromEsriRenderer(e.renderer)}}}],showLegend:!0}},l.prototype._fromGcxlayer=function(e){var t={name:e.wmsLayerName,title:e.displayName,layerUrl:e.getLayerUrl(),legendUrl:e.legendUrl},i=parseInt(e.id);isNaN(i)||void 0===i||(t.id=i);var r=e.mapService.serviceLayer;if(r instanceof esri.layers.ArcGISDynamicMapServiceLayer){var n=this._getWebMapLayerDefinitionFromDynamicLayer(r,i);n&&(t.layerDefinition=n)}return t},l.prototype._fromGcxFeatureSet=function(e){var t,r=e.esriFeatureSet;if(r)!(t=i.GeometryType.fromEsriGeometryType(r.geometryType))&&r.features&&r.features.length>0&&r.features[0].geometry&&(t=i.GeometryType.fromEsriGeometryType(r.features[0].geometry.type));else if(e.features.length){var n=e.features.getAt(0);n.hasGeometry.get()&&(t=i.GeometryType.fromEsriGeometryType(n.esriFeature.get().geometry.type))}return{features:e.features.get().map(this.fromGcxFeature,this),geometryType:t||i.GeometryType.POINT}},l.prototype._fromEsriLayer=function(e){if(e instanceof esri.layers.FeatureLayer)return this._fromEsriFeatureLayer(e);if(e instanceof esri.layers.GraphicsLayer)return this._fromEsriGraphicsLayer(e);throw new Error("WebMapConverter.fromEsriLayer: Unsupported layer type.")},l.prototype._fromEsriGraphicsLayer=function(t){var n=this,a={id:"graphics-layer-"+t.id,title:t.id,visibility:t.visible,opacity:t.opacity,minScale:t.minScale,maxScale:t.maxScale},o={};t.graphics.forEach(function(a,l){var c=a.geometry.type,u=o[c];u||(u={featureSet:{features:[],geometryType:i.GeometryType.fromEsriGeometryType(c)},layerDefinition:{geometryType:i.GeometryType.fromEsriGeometryType(c),objectIdField:"__id",name:n.app.getResource("Mapping.Infrastructure","language-webmap-layer-name-"+c),fields:[{name:"__id",alias:"OBJECTID",type:e.essentials.EsriFieldTypes.esriFieldTypeOID,editable:!1,nullable:!1},{name:"__visible",alias:n.app.getResource("Mapping.Infrastructure","language-webmap-field-name-visible"),type:e.essentials.EsriFieldTypes.esriFieldTypeInteger,editable:!0,nullable:!1}],drawingInfo:{renderer:t.renderer?n.fromEsriRenderer(t.renderer):{type:i.RendererType.UNIQUE_VALUE,field1:"__symbolId",uniqueValueInfos:[{value:0,symbol:s}]}}}},o[a.geometry.type]=u);var p=n.fromEsriGraphic(a);if(p.attributes=p.attributes||{},p.attributes.__id=l,Object.keys(p.attributes).forEach(function(e){if("__symbolId"!==e&&"__symbol"!==e){var i=function(e){return r.firstOrDefault(u.layerDefinition.fields,function(t){return t.name===e})}(e);i||(i={name:e,alias:e,type:n._inferAttributeType(t.graphics,e),nullable:!0,editable:!0},u.layerDefinition.fields.push(i))}}),!t.renderer){var h=u.layerDefinition.drawingInfo.renderer,d=p.attributes.__symbolId;d&&!r.firstOrDefault(h.uniqueValueInfos,function(e){return e.value===d})&&h.uniqueValueInfos.push({value:d,symbol:p.attributes.__symbol})}u.featureSet.features.push(p)}),a.featureCollection={layers:[],showLegend:!1};for(var l=0,c=Object.keys(o);l<c.length;l++){var u=c[l];a.featureCollection.layers.push(o[u])}return a},l.prototype._fromEsriFeatureLayer=function(e){var t={id:e.id,title:e.id,visibility:e.visible,opacity:e.opacity,minScale:e.minScale,maxScale:e.maxScale,layerType:a.FeatureLayer};return e.url?t.url=e.url:t.featureCollection=this._esriFeatureLayerToFeatureCollection(e),t},l.prototype._fromEsriFeatureSet=function(e){return{features:e.features.map(this.fromEsriGraphic,this),geometryType:i.GeometryType.fromEsriGeometryType(e.geometryType)}},l.prototype._fromGcxFeature=function(e){var t=this,i={};return e.attributes.get().forEach(function(e){i[e.name.get()]=t.fromObject(e.value.get())}),{attributes:i,geometry:this.fromEsriGeometry(e.esriFeature.get().geometry)}},l.prototype._fromEsriGraphic=function(e){var t={attributes:this.fromObject(e.attributes)||{},geometry:this.fromEsriGeometry(e.geometry)};return t.attributes.__visible=e.visible?1:0,e.symbol&&(t.attributes.__symbol=this._addSourceType(o.ESRI_SYMBOL,this.fromEsriSymbol(e.symbol)),e.symbol.__symbolId||(e.symbol.__symbolId=this._nextSymbolId++),t.attributes.__symbolId=e.visible?e.symbol.__symbolId:0),t},l.prototype._fromEsriGeometry=function(e){var t={spatialReference:this.fromEsriSpatialReference(e.spatialReference)};switch(e.type){case"point":t.x=e.x,t.y=e.y;break;case"multipoint":t.points=e.points;case"polyline":t.paths=e.paths;break;case"polygon":t.rings=e.rings;break;case"extent":t.xmin=e.xmin,t.xmax=e.xmax,t.ymin=e.ymin,t.ymax=e.ymax}return t},l.prototype._fromEsriSymbol=function(e){var t=e.toJson();return e.size!==t.size&&(t.size=e.size),t},l.prototype._fromEsriRenderer=function(e){var t=this,i=e.toJson();return e instanceof esri.renderer.SimpleRenderer?i.symbol=this.fromEsriSymbol(e.symbol):e instanceof esri.renderer.UniqueValueRenderer?(i.defaultSymbol=this.fromEsriSymbol(e.defaultSymbol),i.uniqueValueInfos.forEach(function(i,r){i.symbol=t.fromEsriSymbol(e.infos[r].symbol)})):e instanceof esri.renderer.ClassBreaksRenderer&&(i.defaultSymbol=this.fromEsriSymbol(e.defaultSymbol),i.classBreakInfos.forEach(function(i,r){i.symbol=t.fromEsriSymbol(e.infos[r].symbol)})),i},l.prototype._fromEsriSpatialReference=function(e){return e.toJson()},l.prototype._fromEsriColor=function(e){return e.toRgba()},l.prototype._fromObject=function(i){if(i instanceof e.essentials.MapService)return this._addSourceType(o.GCX_MAP_SERVICE,this.fromGcxMapService(i));if(i instanceof e.essentials.Layer)return this._addSourceType(o.GCX_LAYER,this.fromGcxLayer(i));if(i instanceof t.FeatureSet)return this._addSourceType(o.GCX_FEATURE_SET,this.fromGcxFeatureSet(i));if(i instanceof t.Feature)return this._addSourceType(o.GCX_FEATURE,this.fromGcxFeature(i));if(i instanceof esri.layers.Layer)return this._addSourceType(o.ESRI_LAYER,this.fromEsriLayer(i));if(i instanceof esri.tasks.FeatureSet)return this._addSourceType(o.ESRI_FEATURE_SET,this.fromEsriFeatureSet(i));if(i instanceof esri.Graphic)return this._addSourceType(o.ESRI_GRAPHIC,this.fromEsriGraphic(i));if(i instanceof esri.geometry.Geometry)return this._addSourceType(o.ESRI_GEOMETRY,this.fromEsriGeometry(i));if(i instanceof esri.symbol.Symbol)return this._addSourceType(o.ESRI_SYMBOL,this.fromEsriSymbol(i));if(i instanceof esri.renderer.Renderer)return this._addSourceType(o.ESRI_RENDERER,this.fromEsriRenderer(i));if(i instanceof esri.SpatialReference)return this._addSourceType(o.ESRI_SPATIAL_REFERENCE,this.fromEsriSpatialReference(i));var r={};for(var n in i)i.hasOwnProperty(n)&&"function"!=typeof i[n]&&"__symbolId"!==n&&(r[n]=this.fromObject(i[n]));return r},l}();i.WebMapConverter=l}(t.webMap||(t.webMap={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=e.framework.utils.ArrayUtils;i.PROPERTY_MEASUREMENT_ID="measurementId",i.PROPERTY_HIGHLIGHT_ID="__gcxHlId";var n=function(n){function a(){n.apply(this,arguments)}return __extends(a,n),a.prototype.fromGcxMapService=function(e){return n.prototype.fromGcxMapService.call(this,e)},a.prototype.fromGcxLayer=function(e){return n.prototype.fromGcxLayer.call(this,e)},a.prototype.fromGcxFeatureSetCollection=function(e){return this._convert(e,"projectFeatureSetCollection",this._fromGcxFeatureSetCollection)},a.prototype.fromGcxFeatureSet=function(e){return n.prototype.fromGcxFeatureSet.call(this,e)},a.prototype.fromEsriFeatureSet=function(e){return n.prototype.fromEsriFeatureSet.call(this,e)},a.prototype.fromEsriLayer=function(e){return n.prototype.fromEsriLayer.call(this,e)},a.prototype.fromGcxFeature=function(e){return n.prototype.fromGcxFeature.call(this,e)},a.prototype.fromEsriGraphic=function(e){return n.prototype.fromEsriGraphic.call(this,e)},a.prototype.toGcxFeatureSetCollection=function(e){return Promise.resolve(this._convert(e,"gcxFeatureSetCollection",this._toGcxFeatureSetCollection))},a.prototype._canCreateGcxLayer=function(e,t){return!!e.gcxLayerDefinition},a.prototype._canCreateGcxMapService=function(e){return!!e.gcxMapServiceDefinition},a.prototype._createGcxMapService=function(e){return n.prototype._createGcxMapService.call(this,e).then(function(i){if(i instanceof t.LayerIntegrationUtils.LocalFeatureLayerService){var r=e;r.layers&&r.layers[0]&&r.layers[0].gcxLayerDefinition&&i.layers[0].createFromDefinition(r.layers[0].gcxLayerDefinition)}return i})},a.prototype._createGcxLayer=function(t,i){var r=t.gcxLayerDefinition,n=new e.essentials.Layer(r.url);return n.createFromDefinition(r),i.add(n),n.isUserCreated=!0,Promise.resolve(n)},a.prototype._getMapServiceDefinition=function(e){return e.gcxMapServiceDefinition},a.prototype._getWebMapLayerDefinitionFromDynamicLayer=function(e,t){var i=n.prototype._getWebMapLayerDefinitionFromDynamicLayer.call(this,e,t);return e.layerDrawingOptions&&e.layerDrawingOptions[t]&&(i.drawingInfo.showLabels=e.layerDrawingOptions[t].showLabels,i.drawingInfo.labelingInfo=e.layerDrawingOptions[t].labelingInfo),i},a.prototype._applyDynamicLayerInfo=function(e,t,i){var r=i.mapService.serviceLayer,n=parseInt(i.id);i.mapService.convertToDynamicLayers();var a=r.dynamicLayerInfos||[],s=a.filter(function(e){return e.id===n})[0];if(s){var o=a.indexOf(s);o!=t&&a.splice(t,0,a.splice(o,1)[0])}else(s=new esri.layers.DynamicLayerInfo).id=n,s.name=e.name,e.layerDefinition&&(s.minScale=e.layerDefinition.minScale,s.maxScale=e.layerDefinition.maxScale),a.splice(t,0,s);r.setDynamicLayerInfos(a)},a.prototype._applyDrawingInfo=function(e,t){var i=this;return e?n.prototype._applyDrawingInfo.call(this,e,t).then(function(){var r=e.clustering&&(e.clustering.enabled||void 0===e.clustering.enabled);if(i.app.command("RemoveClusterLayer").execute({gcxLayer:t.layers[0]}),t.featureClustering&&t.featureClustering.userCanToggle&&e.clustering&&(t.featureClustering.radius=e.clustering.radius,t.featureClustering.backgroundColor=e.clustering.backgroundColor,t.featureClustering.labelColor=e.clustering.labelColor,t.featureClustering.maximumFeatures=e.clustering.maximumFeatures),r)i.app.command("AddClusterLayer").execute({gcxLayer:t.layers[0]});else{var n=t.serviceLayer;n.setRenderer(i.toEsriRenderer(e.renderer)),n.redraw()}}):Promise.resolve()},a.prototype._setGraphicsLayerRenderer=function(e,t){},a.prototype._applyWebMapLayerToGcxLayer=function(t,i,r){var a=this;return n.prototype._applyWebMapLayerToGcxLayer.call(this,t,i,r).then(function(n){for(var s=r.mapService.serviceLayer,o=t,l=0,c=r.styles;l<c.length;l++)(u=c[l]).enabled=!1;if(o.layerStyleId){var u=r.styles.filter(function(e){return e.id===o.layerStyleId})[0],p=void 0;if(s instanceof esri.layers.ArcGISDynamicMapServiceLayer)p=JSON.stringify(a.toEsriRenderer(o.layerDefinition.drawingInfo.renderer).toJson());else if(s instanceof esri.layers.FeatureLayer){var h=o.serviceLayer;p=JSON.stringify(a.toEsriRenderer(h.layerDefinition.drawingInfo.renderer).toJson())}u?(p&&u.setRenderer(p),u.enabled=!0):p&&r.styles.push(new e.essentials.LayerStyle(p,o.layerStyleId,o.layerStyleId,!0))}return o.isDynamic&&s instanceof esri.layers.ArcGISDynamicMapServiceLayer?a.app.waitUntilServiceLayerLoaded(s).then(function(){return a._applyDynamicLayerInfo(o,i,r),n}):n})},a.prototype._toGcxLayer=function(e,t){var i=e;return t||(t=i.serviceLayer),n.prototype._toGcxLayer.call(this,e,t)},a.prototype._toGcxFeatureSetCollection=function(e){var i=this,r=this.app.featureSetManager.featureSetCollections.get().filter(function(t){return t.id===e.id})[0];r||((r=new t.FeatureSetCollection).id=e.id,this.app.featureSetManager.addCollection(r)),r.displayName.set(e.displayName),r.sourceName=e.sourceName;var n='feature set collection "{0}"'.format(e.id);return t.PromiseUtils.mapSkipRejected(e.featureSets,function(e){return t.PromiseUtils.warnOnReject(i.toGcxFeatureSet(e),i.app,'Unable to restore feature set "{0}" for {1}: {{0}}'.format(e.id,n))}).then(function(e){r.clear(),r.featureSets.addItems(e)}).then(function(){return t.PromiseUtils.warnOnReject(i.toObject(e.tag),i.app,"Unable to restore tag for {0}: {{0}}".format(n))}).then(function(e){r.tag=e}).then(function(){return i._toGcxExtendedProperties(e.extendedProperties,n)}).then(function(e){r.extendedProperties.addItems(e)}).then(function(){return r})},a.prototype._toGcxFeatureSet=function(e){var i,r=this,n=e.layer,a=n?n.serviceLayer:null,s=e.features||[],o={gcxLayer:this.toGcxLayer(n,a),esriFeatureSet:this.toEsriFeatureSet(e),extendedProperties:this._toGcxExtendedProperties(e.extendedProperties,"feature set")};return Promise.props(o).then(function(a){i=new t.FeatureSet({app:r.app,layer:a.gcxLayer,esriFeatureSet:a.esriFeatureSet,allowUnsafeContent:r.app.configuration&&r.app.configuration.allowUnsafeContent&&e.allowUnsafeContent}),n||(i.loadAttributes(),i.displayName.set(e.displayName),i.iconUri.set(e.iconUri)),i.id=e.id,i.extendedProperties.addItems(a.extendedProperties)}).then(function(){return t.PromiseUtils.mapSkipRejected(s,function(e){return r._findMatchingGcxFeature(e,i).then(function(t){return r._applyFeatureToGcxFeature(e,t)})})}).then(function(){r.app.waitUntilAllLibrariesLoaded().then(function(){i.dataLinksState===t.DataLinksState.Unresolved&&i.resolveDataLinks(function(e){r.app.event("FeatureChangedEvent").publish(e)})})}).then(function(){return i})},a.prototype._toGcxFeature=function(e){var t=this;return e.featureSet?this.toGcxFeatureSet(e.featureSet).then(function(i){return t._findMatchingGcxFeature(e,i)}).then(function(t){if(!t)throw new Error('Unable to restore feature with ID "{0}": feature no longer exists.'.format(e.id));return t}):this._createGcxFeature(e)},a.prototype._createGcxFeature=function(e){var i=this,r=e.layer,n=r?r.serviceLayer:null,a={gcxLayer:this.toGcxLayer(r,n),featureLayer:r?null:this.toEsriLayer(e.featureLayer),graphic:this.toEsriGraphic(e),extendedProperties:this._toGcxExtendedProperties(e.extendedProperties,"feature")};return Promise.props(a).then(function(r){var n={layer:r.gcxLayer,featureLayer:r.featureLayer,graphic:r.graphic,allowUnsafeContent:i.app.configuration&&i.app.configuration.allowUnsafeContent&&e.allowUnsafeContent},a=e[t.isKmlProperty]?new t.KmlFeature(n):new t.Feature(n);return a.defaultDateFormat=e.defaultDateFormat||t.DateFormat.DEFAULT,a.defaultNumberFormat=e.defaultNumberFormat||t.NumberFormat.DEFAULT,a.timeZoneId=e.timeZoneId,a.displayTimeZoneId=e.displayTimeZoneId,a.borderColor.set(e.borderColor),a.fillColor.set(e.fillColor),a.borderWidth.set(e.borderWidth),a.extendedProperties.addItems(r.extendedProperties),a})},a.prototype._applyFeatureToGcxFeature=function(e,i){return e&&i?(i.defaultDateFormat=e.defaultDateFormat||t.DateFormat.DEFAULT,i.defaultNumberFormat=e.defaultNumberFormat||t.NumberFormat.DEFAULT,i.timeZoneId=e.timeZoneId,this._toGcxExtendedProperties(e.extendedProperties,"feature").then(function(e){return i.extendedProperties.addItems(e)})):Promise.resolve()},a.prototype._findMatchingGcxFeature=function(e,t){return e.id?Promise.resolve(t.findFeatureById(e.id)):this.toEsriGraphic(e).then(function(e){return r.firstOrDefault(t.features.get(),function(t){return t.esriFeature.get()===e})})},a.prototype._queryFeatures=function(e,i){var n=this;return e&&e.length&&i&&i.layer?Promise.try(function(){for(var a=e.map(function(e){return e.id}),s=[];a.length>1e3;)s.push(a.splice(0,1e3));s.push(a);var o=i.layer,l=o?o.serviceLayer:null;return n.toGcxLayer(o,l).then(function(e){if(!e||!e.getObjectIdFieldName())throw new Error('Cannot restore features for layer "{0}": no primary key field defined.'.format(e?e.name:""));e.getObjectIdFieldName();var i=t.taskUtils.getQueryTask(e);return t.PromiseUtils.mapSkipRejected(s,function(e){var r=new esri.tasks.Query;return r.objectIds=e.map(function(e){return t.FormatUtils.parseNumber(e)}),r.returnGeometry=!0,r.outFields=["*"],i.execute(r).then(function(e){return e.features})},{concurrency:2}).then(function(e){return r.flatten(e)})})}):Promise.resolve([])},a.prototype._toEsriGraphic=function(e){return n.prototype._toEsriGraphic.call(this,e).then(function(r){return e.hasOwnProperty(i.PROPERTY_MEASUREMENT_ID)&&(r[i.PROPERTY_MEASUREMENT_ID]=e[i.PROPERTY_MEASUREMENT_ID]),e.hasOwnProperty(t.coordinates.coordinateIdentifierProperty)&&(r[t.coordinates.coordinateIdentifierProperty]=e[t.coordinates.coordinateIdentifierProperty]),e.hasOwnProperty(t.isKmlProperty)&&(r[t.isKmlProperty]=e[t.isKmlProperty]),e.hasOwnProperty(i.PROPERTY_HIGHLIGHT_ID)&&(r[i.PROPERTY_HIGHLIGHT_ID]=e[i.PROPERTY_HIGHLIGHT_ID]),r})},a.prototype._toEsriFeatureSet=function(i){var r=this,n=i.layer,a=n?n.serviceLayer:null,s=i.features||[],o=s.filter(function(t){return!e.framework.utils.isNullOrUndefined(t.id)}),l=s.filter(function(t){return e.framework.utils.isNullOrUndefined(t.id)}),c={gcxLayer:this.toGcxLayer(n,a),queryResults:this._queryFeatures(o,i),rehydratedGraphics:t.PromiseUtils.mapSkipRejected(l,function(e){return r.toEsriGraphic(e)})};return Promise.props(c).then(function(e){var t=e.queryResults.concat(e.rehydratedGraphics),i=new esri.tasks.FeatureSet;return i.features=t,i})},a.prototype._fromGcxMapService=function(e){var i,r=this;e.serviceLayer;if(i=e&&e.serviceLayer instanceof esri.layers.WMTSLayer&&!e.tileRestUrl?{id:e.id,url:e.serviceUrl,type:t.webMap.BaseMapType.WEB_TILED,opacity:e.opacity,visibility:e.isVisible(),layers:[]}:n.prototype._fromGcxMapService.call(this,e),e.isUserCreated&&(i.gcxMapServiceDefinition=e.toJson()),i.layers||(i.layers=t.ArrayUtils.mapWithErrorCallback(e.layers,function(e){return r.fromGcxLayer(e)},function(e,t){console.warn('Unable to convert layer "{0}": {1}'.format(e.id,t))})),e.featureClustering){var a=i,s=void 0;this._isFeatureCollection(i)?(a.featureCollection.layers[0].layerDefinition=a.featureCollection.layers[0].layerDefinition||{drawingInfo:{}},s=a.featureCollection.layers[0].layerDefinition):(a.layerDefinition=a.layerDefinition||{drawingInfo:{}},s=a.layerDefinition),s.drawingInfo=s.drawingInfo||{},s.drawingInfo.clustering={radius:e.featureClustering.radius,backgroundColor:e.featureClustering.backgroundColor,labelColor:e.featureClustering.labelColor,maximumFeatures:e.featureClustering.maximumFeatures,enabled:e.featureClustering.enabled};var o=this.app.map.getLayer(e.id+"-cluster");o&&(s.drawingInfo.renderer=this.fromEsriRenderer(o.featureLayerRenderer))}return i},a.prototype._fromGcxlayer=function(e){var t=n.prototype._fromGcxlayer.call(this,e);t.serviceLayer=this.fromGcxMapService(e.mapService);var i=e.mapService.serviceLayer;t.isDynamic=e.isDynamic,i instanceof esri.layers.ArcGISDynamicMapServiceLayer&&i.supportsDynamicLayers&&(t.isDynamic=t.isDynamic||i.dynamicLayerInfos&&!!i.dynamicLayerInfos[parseInt(e.id)]),e.isUserCreated&&(t.gcxLayerDefinition=e.toJson());var r=e.styles.filter(function(e){return e.enabled})[0];return r&&(t.layerStyleId=r.id),t},a.prototype._fromGcxFeatureSetCollection=function(e){var t={id:e.id,displayName:e.displayName.get(),featureSets:e.featureSets.get().map(this.fromGcxFeatureSet,this),sourceName:e.sourceName,tag:this.fromObject(e.tag)};return e.extendedProperties.getLength()&&(t.extendedProperties=this._fromGcxExtendedProperties(e.extendedProperties)),t},a.prototype._fromGcxFeatureSet=function(e){var t=n.prototype._fromGcxFeatureSet.call(this,e);return t.id=e.id,t.layer=this.fromGcxLayer(e.layer),t.allowUnsafeContent=e._allowUnsafeContent,e.layer||(t.displayName=e.displayName.get(),t.iconUri=e.iconUri.get()),t},a.prototype._fromGcxFeature=function(e){var i={};this._canRequeryFeatureData(e)?i={id:e.id.get(),featureSet:this.fromGcxFeatureSet(e.featureSet)}:(i=n.prototype._fromGcxFeature.call(this,e)).featureSet=this.fromGcxFeatureSet(e.featureSet),i.featureSet||(i.layer=this.fromGcxLayer(e.layer)),e.featureLayer&&!e.layer&&(i.featureLayer=this.fromEsriLayer(e.featureLayer)),i.allowUnsafeContent=e._allowUnsafeContent,e.borderColor.get()&&(i.borderColor=e.borderColor.get()),e.fillColor.get()&&(i.fillColor=e.fillColor.get()),e.borderWidth.get()>=0&&(i.borderWidth=e.borderWidth.get()),e.extendedProperties.getLength()&&(i.extendedProperties=this._fromGcxExtendedProperties(e.extendedProperties)),e.defaultDateFormat!==t.DateFormat.DEFAULT&&(i.defaultDateFormat=e.defaultDateFormat),e.defaultNumberFormat!==t.NumberFormat.DEFAULT&&(i.defaultNumberFormat=e.defaultNumberFormat);var r=e.esriFeature.get();return r&&r.hasOwnProperty(t.isKmlProperty)&&(i[t.isKmlProperty]=r[t.isKmlProperty]),e.timeZoneId&&(i.timeZoneId=e.timeZoneId),e.displayTimeZoneId&&i.displayTimeZoneId,i},a.prototype._fromEsriGraphic=function(e){var r=n.prototype._fromEsriGraphic.call(this,e);return e.hasOwnProperty(i.PROPERTY_MEASUREMENT_ID)&&(r[i.PROPERTY_MEASUREMENT_ID]=e[i.PROPERTY_MEASUREMENT_ID]),e.hasOwnProperty(t.coordinates.coordinateIdentifierProperty)&&(r[t.coordinates.coordinateIdentifierProperty]=e[t.coordinates.coordinateIdentifierProperty]),e.hasOwnProperty(t.isKmlProperty)&&(r[t.isKmlProperty]=e[t.isKmlProperty]),e.hasOwnProperty(i.PROPERTY_HIGHLIGHT_ID)&&(r[i.PROPERTY_HIGHLIGHT_ID]=e[i.PROPERTY_HIGHLIGHT_ID]),r},a.prototype._toGcxExtendedProperties=function(e,i){var r=this;return e=e||{},t.PromiseUtils.mapSkipRejected(Object.keys(e),function(n){var a=r.toObject(e[n]).then(function(e){return{name:n,value:e}});return t.PromiseUtils.warnOnReject(a,r.app,"Unable to restore extended property '{0}' for {1}: {{0}}".format(n,i))})},a.prototype._fromGcxExtendedProperties=function(e){var t=this,i={};return e.get().forEach(function(e){i[e.name]=t.fromObject(e.value)}),i},a.prototype._canRequeryFeatureData=function(t){return t&&!t.isModified&&!e.framework.utils.isNullOrUndefined(t.id.get())&&""!==t.id.get()&&t.featureSet&&t.featureSet.layer&&t.featureSet.layer.getLayerUrl()&&t.featureSet.layer.supportsQuery||String.isNullOrEmpty(t.featureSet.layer.catalogId)},a}(t.webMap.WebMapConverter);i.ProjectConverter=n}(t.project||(t.project={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){var i=t.mapping.infrastructure.FormatUtils,r=function(r){function n(i,n,a,s){r.call(this,i,n,a,s),this.version=e.essentialsHtmlViewer.version,this.markupLayer=new Observable,this.isArcGisWebApp=!1,this._workflowActivityDispatcher=null,this._activityTypeHandlerQueue=[],this._activityIdHandlerQueue=[],this._localeResourcesLoaded=!1,this._initialProjectPromise=null,this._momentLocales=["af","ar","ar-MA","ar-SA","ar-TN","az","be","bg","bn","bo","br","bs","ca","cs","cv","cy","da","de","de-AT","el","en-AU","en-CA","en-GB","eo","es","et","eu","fa","fi","fo","fr","fr-CA","fy","gl","he","hi","hr","hu","hy-AM","id","is","it","ja","jv","ka","km","ko","lb","lt","lv","me","mk","ml","mr","ms","ms-MY","my","nb","ne","nl","nn","pl","pt","pt-BR","ro","ru","si","sk","sl","sq","sr","sr-Cyrl","sv","ta","th","tl-PH","tr","tzl","tzm","tzm-Latn","uk","uz","vi","zh-CN","zh-TW"],this._globalizeLocales=["af","ar","ar-MA","ar-SA","ar-TN","az","be","bg","bn","bo","br","bs","ca","cs","cy","da","de","de-AT","el","en","en-AU","en-CA","en-GB","eo","es","et","eu","fa","fi","fo","fr","fr-CA","fy","gl","he","hi","hr","hu","hy","id","is","it","ja","ka","km","ko","lb","lt","lv","mk","ml","mr","ms","my","nb","ne","nl","nn","pl","pt","ro","ru","si","sk","sl","sq","sr","sr-Cyrl","sv","ta","th","tr","tzm","tzm-Latn","uk","uz","vi","zh"],this.___uaIsiPad=!!navigator.userAgent.match(/iPad/i),this.accessibilityManager=new e.essentialsHtmlViewer.mapping.infrastructure.accessibility.AccessibilityManager(this),this.coordinatesManager=new e.essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinatesManager(this),this.featureSetManager=new e.essentialsHtmlViewer.mapping.infrastructure.FeatureSetManager(this),this.searchManager=new e.essentialsHtmlViewer.mapping.infrastructure.search.SearchManager(this),this.highlightManager=new e.essentialsHtmlViewer.mapping.infrastructure.HighlightManager(this),this.nativeManager=new t.mapping.infrastructure.nativeIntegration.NativeManager(this),this.offlineManager=new t.mapping.infrastructure.offline.OfflineManager(this,"Mapping.Infrastructure"),this.toolRegistry=new e.essentialsHtmlViewer.mapping.infrastructure.tools.ToolRegistry(this),this.menuRegistry=new e.essentialsHtmlViewer.mapping.infrastructure.menus.MenuRegistry(this),this.toolbarGroupRegistry=new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarGroupRegistry(this),this.stateManager=new e.essentialsHtmlViewer.mapping.infrastructure.applicationState.StateManager(this,"Mapping.Infrastructure"),this.undoManager=new e.essentialsHtmlViewer.mapping.infrastructure.undo.UndoManager(this),this.project=new t.mapping.infrastructure.project.ProjectManager(this),this.webMap=new t.mapping.infrastructure.webMap.WebMapManager(this),this.bookmarks=new t.mapping.infrastructure.BookmarkManager(this),this._applicationContentPolicy=new t.mapping.infrastructure.ContentPolicy(this),this._registerApplicationLevelCommands()}return __extends(n,r),Object.defineProperty(n.prototype,"defaultContentPolicy",{get:function(){return this._applicationContentPolicy},enumerable:!0,configurable:!0}),n.prototype.followNavigationLink=function(e){e.url;var i=e.element,r={uri:e.url,attribute:"href",tag:"a",type:t.mapping.infrastructure.FilterUtils.UriType.NavigableLink,linkChallengeCallback:function(e,t){if(e){var r="_blank";i&&i.hasAttribute("target")&&(r=i.getAttribute("target")),window.open(t.uri,r)}return!1}};return!!this._applicationContentPolicy.tryScreenNavLinkSynchronously(r)||(this._executeOpenWebPage(e),!1)},n.prototype._registerApplicationLevelCommands=function(){this.command("OpenWebPage").register(this,this._executeOpenWebPage)},n.prototype._executeOpenWebPage=function(e){var i="string"==typeof e?e:e.url,r="string"==typeof e?null:e.element?e.element:null,n=["http","https","ftp","ftps","gopher","mailto"];("string"==typeof e?null:e.isLink?e.isLink:null)||(i=decodeURIComponent(i));var a=new dojo._Url(i);if(n.indexOf(a.scheme)<0)this.trace.warning("Could not open '"+i+"': Invalid URI scheme.");else{var s=function(e,t){var i="_blank";t&&t.hasAttribute("target")&&(i=t.getAttribute("target")),window.open(e,i)},o={uri:i,attribute:"href",tag:"a",type:t.mapping.infrastructure.FilterUtils.UriType.NavigableLink,linkChallengeCallback:function(e,t){return e&&s(t.uri,r),!1}};if(this._applicationContentPolicy.hasFlag(1)||this._applicationContentPolicy.tryScreenNavLinkSynchronously(o))return s(o.uri,r),!1;o.forcePrompt=!0,this._applicationContentPolicy.screenUris([o])}},n.prototype.initialize=function(){var i=this;document.all&&!document.querySelector&&(this.debugMode=!0);var n=this.configUri?this.configUri.split("/"):window.location.href.split("/"),a=n.slice(0,n.length-1).join("/")+"/";this.configTokens.ViewerConfigUri=a,this.getUrlParameter("gcxLocalServer")&&(this.localServerAddress=this.getUrlParameter("gcxLocalServer")),this.getUrlParameter("gcxLocalServerNamespace")&&(this.localServerNamespace=this.getUrlParameter("gcxLocalServerNamespace")),this.getUrlParameter("gcxLocalServerToken")&&(this.localServerToken=this.getUrlParameter("gcxLocalServerToken")),this.offlineManager.load(),r.prototype.initialize.call(this);var s=this.getUrlParameter(t.mapping.infrastructure.project.PROJECT_QUERY_STRING_KEY);if(s){var o=this.getUrlParameter(e.essentials.documents.LINK_QUERY_STRING_KEY);o&&this.waitUntilSiteInitialized().then(function(){return i.site.documentStore.setGuestLink(o)}),this.waitUntilAllLibrariesLoaded().then(function(){return i.event("ProjectLoadingEvent").publish(s)}),this._initialProjectPromise=this.project.read(s).then(function(e){return i.project._beginLoad(e)}).catch(function(e){i.trace.error("Error loading project: {0}".format(e.message),e)});var l=this.initialStateAppliedCallback;this.initialStateAppliedCallback=function(e){i.project.isLoading&&i.project._finishLoad(),l&&l(e)}}},n.prototype.waitUntilSiteInitialized=function(){var e=this;return new Promise(function(t,i){e.site&&e.site.isInitialized?t():(e.event("SiteInitializedEvent").once(e,function(e){t()}),e.event("SiteInitializationFailedEvent").once(e,function(e){i(e)}),e.event("SiteAuthorizationFailedEvent").once(e,function(e){i(e)}))})},n.prototype.waitUntilDocumentStoreInitialized=function(){var e=this;return this.waitUntilSiteInitialized().then(function(){return e.site.documentStore.onInitialized()})},n.prototype.waitUntilMapLoaded=function(){var e=this;return new Promise(function(t,i){if(e.map&&e.map.loaded)t();else if(e.map)var r=e.map.on("load",function(e){r.remove(),t()});else e.event("SiteInitializingEvent").once(e,function(){var i=e.map.on("load",function(e){i.remove(),t()})})})},n.prototype.waitUntilServiceLayerLoaded=function(e){return new Promise(function(t,i){if(e.loadError)i(e.loadError);else if(e.loaded)t();else var r=e.on("load",function(e){r.remove(),n.remove(),t()}),n=e.on("error",function(e){r.remove(),n.remove(),i(e.error)})})},n.prototype.waitUntilSiteServiceLayersLoaded=function(){var e=this;return new Promise(function(t,i){e.site&&e.site.serviceLayersLoaded?t():(e.event("SiteServiceLayersLoadedEvent").once(e,function(e){t()}),e.event("SiteInitializationFailedEvent").once(e,function(e){i(e)}),e.event("SiteAuthorizationFailedEvent").once(e,function(e){i(e)}))})},n.prototype.waitUntilAllLibrariesLoaded=function(){var e=this;return new Promise(function(t,i){e.allLibrariesLoaded?t():e.event("ViewerLibrariesDownloadedEvent").once(e,function(e){t()})})},n.prototype.waitUntilViewInitialized=function(e){var t=this;return new Promise(function(i,r){var n=t.viewManager.getViewById(e);if(n&&n.initiallyBound)i(n);else var a=t.event("ViewInitializedEvent").subscribe(t,function(r){r.id===e&&(i(r),t.event("ViewInitializedEvent").unsubscribe(a))})})},n.prototype.registerActivityTypeHandler=function(e,t){this._workflowActivityDispatcher?this._workflowActivityDispatcher.registerActivityHandler(e,t):this._activityTypeHandlerQueue.push({typeName:e,handler:t})},n.prototype.registerActivityIdHandler=function(e,t){this._workflowActivityDispatcher?this._workflowActivityDispatcher.registerExternalIdHandler(e,t):this._activityIdHandlerQueue.push({id:e,handler:t})},n.prototype.getWorkflowActivityDispatcher=function(){return this._workflowActivityDispatcher},n.prototype.setWorkflowActivityDispatcher=function(e){this._workflowActivityDispatcher=e;for(i=0;i<this._activityTypeHandlerQueue.length;++i){var t=this._activityTypeHandlerQueue[i];this._workflowActivityDispatcher.registerActivityHandler(t.typeName,t.handler)}this._activityTypeHandlerQueue.length=0;for(var i=0;i<this._activityIdHandlerQueue.length;++i){var r=this._activityIdHandlerQueue[i];this._workflowActivityDispatcher.registerExternalIdHandler(r.id,r.handler)}this._activityIdHandlerQueue.length=0},n.prototype.shutdown=function(e){this.toolRegistry.clear(),this.undoManager.destroy(),r.prototype.shutdown.call(this,e)},n.prototype.onConfigurationLoaded=function(n){var a=this,s=n.configuration,o=!0;if(s.hasOwnProperty("application")&&s.application.hasOwnProperty("contentPolicy")){var l=s.application.contentPolicy;l.disableSecurityPrompt&&this._applicationContentPolicy.setFlag(1),!1===l.disablePromptOnImages&&(o=!1),!0===l.trustExactUrl&&this._applicationContentPolicy.setFlag(4)}o&&this._applicationContentPolicy.setFlag(2),this._applicationContentPolicy.screenUris([]),s&&s.hasOwnProperty("application")&&s.application.locale&&(this.locale=s.application.locale),this.urlParameters&&this.getUrlParameter("locale")&&(this.locale=this.getUrlParameter("locale"));var c=this.locale||"en-US";document.documentElement.setAttribute("lang",c),this._loadThirdPartyLocaleResources().then(function(){if($&&$.timepicker){var o=Object.getPrototypeOf($.timepicker);o._onTimeChange&&(o._base_onTimeChange=o._onTimeChange,o._onTimeChange=function(){if(this._base_onTimeChange(),this._defaults&&this._defaults.gcxTimeFormat&&this.$timeObj){var e=i.formatDate($(this.$input).datepicker("getDate"),this._defaults.gcxTimeFormat);this.$timeObj.text(e)}if(this._defaults&&!0===this._defaults.gcxTimeStyle){var t=this.$timeObj?this.$timeObj.prevObject:null;t&&1!==$(".info-message",t).length&&t.append("<div class='info-message'></div>");var r=t?$(".info-message",t):null;r&&(r.text(this._defaults.timeText+": "+this.$timeObj.text()),this.$timeObj.css("display","none"),$(this.$timeObj.selector+"_label").css("display","none"))}})}if($&&$.datepicker&&$.datepicker._showDatepicker&&($.datepicker.__base_showDatepicker=$.datepicker._showDatepicker,$.datepicker._showDatepicker=function(e){this.__base_showDatepicker(e);var t=$(e).siblings(".gcxDatepicker");t.length&&t.focus()}),s.hasOwnProperty("application")&&s.application.hasOwnProperty("geometryServiceUrl")&&(esri.config.defaults.geometryService=new esri.tasks.GeometryService(s.application.geometryServiceUrl)),s.hasOwnProperty("application")&&s.application.hasOwnProperty("datumTransforms")?t.mapping.infrastructure.GeometryUtils.registerDatumTransforms(s.application.datumTransforms):t.mapping.infrastructure.GeometryUtils.registerDefaultDatumTransforms(),n.configuration.application&&n.configuration.application.oAuth2ClientId){window.location.href;if(!e.essentials.OAuth2Client.applicationHasImplicitGrant()&&!e.essentials.OAuth2Client.applicationHasImplicitGrantError()){var l=n.configuration.application.oAuth2AuthorizeUri||"http://www.arcgisonline.com/sharing/oauth2/authorize";return e.essentials.OAuth2Client.redirectToLogOnPage(l,n.configuration.application.oAuth2ClientId),void(a.abortInitialization=!0)}}r.prototype.onConfigurationLoaded.call(a,n)})},n.prototype.getInitialState=function(e,t){var i=this;return!this._initialProjectPromise||this._initialProjectPromise.isRejected()?Promise.resolve(null):this._initialProjectPromise.then(function(){var t=i.project.current;return t&&t.content&&t.content.moduleState?t.content.moduleState[e]:null})},Object.defineProperty(n.prototype,"locale",{get:function(){return this._locale},set:function(e){this._locale=this._canonicalizeLocale(e),this._localeResourcesLoaded&&(moment.locale(this._getMomentLocaleForLocale(this._locale)),_globalize.locale(this._getGlobalizeLocaleForLocale(this._locale)))},enumerable:!0,configurable:!0}),n.prototype.doWhenMapInitialized=function(e){var t=this;if(this.isArcGisWebApp)e();else if(this.site&&this.site.isInitialized)e();else var i=this.eventRegistry.event("SiteServiceLayersLoadedEvent").subscribe(this,function(){t.eventRegistry.event("SiteServiceLayersLoadedEvent").unsubscribe(i),e()})},n.prototype._loadThirdPartyLocaleResources=function(){var e,t=this;return"function"==typeof define&&(e=define.amd,delete define.amd),Promise.all([this._loadMomentLocaleData(),this._loadGlobalizeLocaleData()]).then(function(){"function"==typeof define&&(define.amd=e),t._localeResourcesLoaded=!0},function(t){"function"==typeof define&&(define.amd=e)})},n.prototype._loadMomentLocaleData=function(){var e=this,t=this._getMomentLocaleForLocale(this.locale);return moment.localeData(t)?Promise.resolve():new Promise(function(i,r){if("en"===t)i();else{var n="./Resources/Scripts/moment/locale/"+t+".js";e.includeScript(n,function(e){moment.locale(t),i()},r)}})},n.prototype._loadGlobalizeLocaleData=function(){var e=this._getGlobalizeLocaleForLocale(this.locale),t="./Resources/Scripts/globalize/locale/"+e+".json";return this.fetchConfigResource({url:t}).then(function(t){var i=JSON.parse(t);_globalize.load(i),_globalize.locale(e)})},n.prototype._getMomentLocaleForLocale=function(e){return this._getBestMatchLocale(e,this._momentLocales)},n.prototype._getGlobalizeLocaleForLocale=function(e){return this._getBestMatchLocale(e,this._globalizeLocales)},n.prototype._getBestMatchLocale=function(e,t){e=this._canonicalizeLocale(e);var i=this._parseLocale(e);if(t.indexOf(e)>=0)return e;if(i.script){if(e=i.language+"-"+i.script,t.indexOf(e)>=0)return e;if(e=i.language+"-"+i.territory,t.indexOf(e)>=0)return e}else if(i.territory&&(e=i.language,t.indexOf(e)>=0))return e;return"en"},n.prototype._parseLocale=function(e){if(!e)throw new Error("Invalid locale: {0}".format(e));var t=e.split("-");if(t.length<1||t.length>3||t.some(function(e){return 0===e.length}))throw new Error("Invalid locale: {0}".format(e));var i={language:t[0].toLowerCase()};return 2==t.length?2==t[1].length?i.territory=t[1].toUpperCase():i.script=t[1][0].toUpperCase()+t[1].slice(1).toLowerCase():3===t.length&&(i.script=t[1][0].toUpperCase()+t[1].slice(1).toLowerCase(),i.territory=t[2].toUpperCase()),i},n.prototype._canonicalizeLocale=function(e){var t=this._parseLocale(e),i=t.language;return t.script&&(i+="-"+t.script),t.territory&&(i+="-"+t.territory),i},n}(e.framework.application.Application);t.ViewerApplication=r}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(t){var i=e.framework.utils.isNullOrUndefined;if(i(t))return!1;switch(t.type){case"point":var r=t;return!i(r.x)&&!i(r.y);case"multipoint":var n=t.points;return n&&n.length>0;case"polyline":var a=t.paths;return a&&a.length>0;case"polygon":var s=t.rings;return s&&s.length>0;case"extent":var o=t;return!(i(o.xmin)||i(o.xmax)||i(o.ymin)||i(o.ymax));default:return!1}}function r(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function n(e){if(!e||!e.configuration)return null;if(l&&l.url&&l.url.startsWith(e.configuration.geometryServiceUrl))return l;var t=e.configuration.geometryServiceUrl,i=e.configuration.geometryServiceToken;if(i){t+=(t.indexOf("?")>-1?"&token=":"?token=")+encodeURIComponent(i);var r=dojo.subscribe("ServiceTokenRefreshed",function(t){t.serviceUrl===e.configuration.geometryServiceUrl&&(e.configuration.geometryServiceToken=t.token,l=null,dojo.unsubscribe(r))})}return"https:"!=window.location.protocol||/^(https|\/\/)/.test(t)||e.trace.warning("Mixed Content Warning: This Viewer was loaded over HTTPS but the geometry service was loaded over HTTP. This may limit functionality. Please configure the geometry service to be served securely."),l=new esri.tasks.GeometryService(t)}function a(e){e.forEach(function(e){var t=null;e.fromWkid&&e.fromWkid>0?t=new esri.SpatialReference(e.fromWkid):e.fromWkt&&(t=new esri.SpatialReference(e.fromWkt));var i=null;e.toWkid&&e.toWkid>0?i=new esri.SpatialReference(e.toWkid):e.toWkt&&(i=new esri.SpatialReference(e.toWkt));var r=null;if(e.transformWkid&&e.transformWkid>0?r=new esri.SpatialReference(e.transformWkid):e.transformWkt&&(r=new esri.SpatialReference(e.transformWkt)),!t||!i||!r)throw new Error("Invalid or missing spatial reference. Cannot register datum transform.");o.push({fromSR:t,toSR:i,transformation:r})})}function s(t,i){if(!t||!i||0==o.length)return null;for(var r=e.essentials.GeometryUtilities.spatialRefsAreEqual,n=0;n<o.length;n++){var a=o[n];if(r(t,a.fromSR)&&r(i,a.toSR))return{transformation:a.transformation,transformForward:!0};if(r(t,a.toSR)&&r(i,a.fromSR))return{transformation:a.transformation,transformForward:!1}}return null}t.DEFAULT_GEOMETRY_SERVICE_URI="http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/Geometry/GeometryServer";var o=[],l=null;t.isValidGeometry=i,t.getMiddle=function(e){if(!e||!e.type||!i(e))return null;var t;if("point"==e.type)return e;if("multipoint"==e.type)return(t=e.getExtent())?t.getCenter():null;if("polyline"==e.type){for(var n=e,a=0,s=0;s<n.paths.length;s++)for(var o=0;o<n.paths[s].length-1;o++)a+=r(c=new esri.geometry.Point(n.paths[s][o]),u=new esri.geometry.Point(n.paths[s][o+1]));var l=0;for(s=0;s<n.paths.length;s++)for(o=0;o<n.paths[s].length-1;o++){var c=new esri.geometry.Point(n.paths[s][o]),u=new esri.geometry.Point(n.paths[s][o+1]),p=r(c,u);if(l+p>a/2){var h=p/(a/2-l),d=(u.x-c.x)/h,m=(u.y-c.y)/h;return new esri.geometry.Point(c.x+d,c.y+m,e.spatialReference)}l+=p}}else{if("polygon"==e.type)return(t=e.getExtent())?t.getCenter():null;if("extent"==e.type)return e.getCenter()}return null},t.getMidpoint=function(e,t){if(!e||!t)throw new Error("The beginning and ending points are required.");return new esri.geometry.Point({x:(e.x+t.x)/2,y:(e.y+t.y)/2,spatialReference:e.spatialReference.toJson()})},t.getEsriGeometryType=function(e,t){if(!e)return null;var i=null;switch(e.toLowerCase()){case"rectangle":i=esri.toolbars.Draw.EXTENT;break;case"freehandpolygon":i=esri.toolbars.Draw.FREEHAND_POLYGON;break;case"freehandpolyline":i=esri.toolbars.Draw.FREEHAND_POLYLINE;break;case"mappoint":i=esri.toolbars.Draw.POINT;break;case"multipoint":i=esri.toolbars.Draw.MULTI_POINT;break;case"polygon":i=esri.toolbars.Draw.POLYGON;break;case"polyline":i=esri.toolbars.Draw.POLYLINE;break;default:i=t||esri.toolbars.Draw.EXTENT}return i},t._getGeometryService=function(e){return n(e)},t.getGeometryService=n,t.needsProjection=function(t,i){return!e.essentials.GeometryUtilities.spatialRefsAreEqual(t.spatialReference,i.map.spatialReference,!1)},t.projectGeometry=function(e,t,i,r,n){if(e&&e.spatialReference)if(e.spatialReference.equals(t))i&&i(e);else{var a=new esri.tasks.ProjectParameters;a.outSR=t,a.geometries=[e],this.project(a,function(e){e&&e.length>0&&i&&i(e[0])},r,n)}else r&&r(new Error("Invalid geometry or spatial reference."))},t.projectGeometryWithTransform=function(e,t,i,r,n,a){if(i)if(e&&e.spatialReference)if(e.spatialReference.equals(t))r&&r(e);else{var s=new esri.tasks.ProjectParameters;s.outSR=t,s.geometries=[e],s.transformation={wkid:i},this.project(s,function(e){e&&e.length>0&&r&&r(e[0])},n,a)}else n&&n(new Error("Invalid geometry or spatial reference."));else this.projectGeometry(e,t,r,n)},t.project=function(t,i,r,n){if(t&&(!esri.tasks.hasOwnProperty("ProjectParameters")||t instanceof esri.tasks.ProjectParameters)&&t.hasOwnProperty("outSR")&&t.hasOwnProperty("geometries"))if(i&&dojo.isFunction(i))if(t.outSR){var a=t.geometries,o=!1;if(a&&a.length>0&&(e.essentials.GeometryUtilities.spatialRefsAreEqual(a[0].spatialReference,t.outSR,!1)||(o=!0)),o){var l=this._getGeometryService(n);if(t.outSR.isWebMercator()&&4326===a[0].spatialReference.wkid||4326===t.outSR.wkid&&a[0].spatialReference.isWebMercator())return void this._projectLocally(t.geometries,t.outSR,i,r);if(!l)return void(r&&dojo.isFunction(r)&&(u="Unable to get the geometry service. Make sure a geometry service url is configured in the application.",r(new Error(u))));var c=s(a[0].spatialReference,t.outSR);c&&!t.transformation&&(t.transformation=c.transformation,t.transformForward=c.transformForward),esri.tasks.hasOwnProperty("ProjectParameters")?l.project(t,i,r):l.project(t.geometries,t.outSR,i,r)}else i(a)}else r&&dojo.isFunction(r)&&(u="output spatial reference is required.",r(new Error(u)));else r&&dojo.isFunction(r)&&(u="callback required.",r(new Error(u)));else if(r&&dojo.isFunction(r)){var u="projectParameters required.";r(new Error(u))}},t.simplifyPolygons=function(e,t,i,r){this._getGeometryService(r).simplify(e,t,i)},t.simplifyPolygon=function(e,t,i,r){this.simplifyPolygons([e],function(e){e&&e.length>0?t(e[0]):i()},i,r)},t._projectLocally=function(e,t,i,r){for(var n=[],a=0;a<e.length;a++)e[a].spatialReference.isWebMercator()&&4326===t.wkid?n[a]=esri.geometry.webMercatorToGeographic(e[a]):4326===e[a].spatialReference.wkid&&t.isWebMercator()?n[a]=esri.geometry.geographicToWebMercator(e[a]):(r&&dojo.isFunction(r)&&r(new Error("Unable to get the geometry service. Make sure a geometry service url is configured in the application.")),this.app.trace.error("An operation requiring projection attempted to project while offline, but was not between WebMercator and WGS84"));i(n)},t.createCircle=function(e,t,i,r){var n=[],a=null,s=r||40,o=new esri.geometry.Polygon(e);a=360/s;for(var l=1;l<=s;l++){var c=l*a*Math.PI/180;n.push([t.x+i*Math.cos(c),t.y+i*Math.sin(c)])}return n.push(n[0]),o.addRing(n),o},t.fixAspectRatio=function(e,t){var i=t.getWidth()/t.getHeight(),r=e.getWidth()/e.getHeight(),n=e.getWidth(),a=e.getHeight();r<i?n=i*a:a=1/i*n;var s=e.getCenter();return new esri.geometry.Extent(s.x-n/2,s.y-a/2,s.x+n/2,s.y+a/2,e.spatialReference)},t.extentToPolygon=function(e){var t=new esri.geometry.Polygon(e.spatialReference),i=new Array;return i.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y+e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x+e.getWidth()/2,e.getCenter().y+e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x+e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),i.push(new esri.geometry.Point(e.getCenter().x-e.getWidth()/2,e.getCenter().y-e.getHeight()/2)),t.addRing(i),t},t.pointsAreEqual=function(e,t){return!(e&&!t||!e&&t||e&&(e.x!==t.x||e.y!==t.y||!e.spatialReference&&t.spatialReference||e.spatialReference&&!t.spatialReference||!e.spatialReference.equals(t.spatialReference)))},t.registerDefaultDatumTransforms=function(){var e=[];e.push({transformWkid:108457,fromWkid:28992,toWkid:4326}),e.push({transformWkid:1195,fromWkid:27700,toWkid:4326}),e.push({transformWkid:1623,fromWkid:102067,toWkid:4326}),a(e)},t.registerDatumTransforms=a,t.getDatumTransformParameters=s,t.intersects=function(e,t){return new Promise(function(i,r){try{require(["esri/geometry/geometryEngine"],function(r){i(r.intersects(e,t))})}catch(e){r(e)}})},t.unionGeometries=function(e){return new Promise(function(t,i){try{require(["esri/geometry/geometryEngine"],function(i){t(i.union(e))})}catch(e){i(e)}})},t.explodeGeometry=function(e){switch(e.type){case"polygon":return e.rings.map(function(t){return new esri.geometry.Polygon(t).setSpatialReference(e.spatialReference)});case"polyline":return e.paths.map(function(t){return new esri.geometry.Polyline(t).setSpatialReference(e.spatialReference)});case"multipoint":return e.points.map(function(t){return new esri.geometry.Point(t,e.spatialReference)})}return[e]},t.cutGeometries=function(e,t,i){var r=this;return new Promise(function(n,a){var s=r.getGeometryService(i);if(!s)return Promise.reject(new Error("Unable to get the geometry service. Make sure a geometry service url is configured in the application."));try{s.cut(e,t).then(function(e){for(var t=[],i=0;i<e.geometries.length;i++){var r=e.cutIndexes[i];t[r]||(t[r]=[]),t[r].push(e.geometries[i])}n(t)})}catch(e){a(e)}})},t.toRing=function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}}(t.GeometryUtils||(t.GeometryUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){!function(i){function r(e,r){var l=function(t){var o=null;require(["esri/tasks/BufferParameters"],function(n){(o=new esri.tasks.BufferParameters).geometries=t,o.unit=a(r.bufferUnit),o.bufferSpatialReference=r.bufferSpatialReference||r.outSpatialReference||r.geometries[0].spatialReference||e.map.spatialReference,o.outSpatialReference=r.outSpatialReference||e.map.spatialReference||r.geometries[0].spatialReference||r.bufferSpatialReference,o.distances=[r.bufferDistance],o.unionResults=void 0==r.unionResults||!!r.unionResults,o.geodesic=!!r.geodesic,o.unit==i.GCX_UNIT_YARDS&&(o.unit=esri.tasks.GeometryService.UNIT_FOOT,o.distances=[s(r.bufferDistance,i.GCX_UNIT_YARDS,esri.tasks.GeometryService.UNIT_FOOT)])});return new Promise(function(t,i){n(e,o).then(t,i)})};return new Promise(function(e,i){var n=[];o(r.geometries).forEach(function(e){n.push(l(e))}),Promise.all(n).then(function(n){var a=n[0];if(a.bufferId=r.bufferId,a.sourceCommand=r.sourceCommand,1===n.length)e(a);else{for(var s=1;s<n.length;s++){var o=n[s].geometries;o.length&&(a.geometries=a.geometries.concat(o))}r.unionResults?t.GeometryUtils.unionGeometries(a.geometries).then(function(i){t.GeometryUtils.isValidGeometry(i)&&(a.geometries=[i],a.geometry=i,e(a))},function(e){var t={};t.error=e,t.bufferId=r.bufferId,t.sourceCommand=r.sourceCommand,i(t)}):e(a)}},function(e){e.bufferId=r.bufferId,e.sourceCommand=r.sourceCommand,i(e)})})}function n(e,i){var r=function(e,t){var i={};return e&&(i.geometries=e),t&&(i.error=t),i};return new Promise(function(n,a){var s=t.GeometryUtils.getGeometryService(e);if(!s){var o="BufferUtils: Buffer operation failed. Could not retrieve geometry service.";return e.trace.error(o),void a(r(null,new Error(o)))}var l=function(){s.buffer(i,function(e){return n(r(e,null))},function(e){return a(r(null,e))})};esri.geometry.normalizeCentralMeridian(i.geometries).then(function(e){"polygon"===e[0].type?s.simplify(i.geometries,function(e){i.geometries=e,l()},function(e){a(r(null,e))}):(i.geometries=e,l())})})}function a(t,r){if(!t)return null;var n=null;switch(t){case"feet":case e.essentials.DistanceUnitType.FEET:case esri.tasks.GeometryService.UNIT_FOOT.toString():case esri.Units.FEET:n=esri.tasks.GeometryService.UNIT_FOOT;break;case"kilometer":case e.essentials.DistanceUnitType.KILOMETERS:case esri.tasks.GeometryService.UNIT_KILOMETER.toString():case esri.Units.KILOMETERS:n=esri.tasks.GeometryService.UNIT_KILOMETER;break;case"meter":case e.essentials.DistanceUnitType.METERS:case esri.tasks.GeometryService.UNIT_METER.toString():case esri.Units.METERS:n=esri.tasks.GeometryService.UNIT_METER;break;case"mile":case e.essentials.DistanceUnitType.MILES:case esri.tasks.GeometryService.UNIT_STATUTE_MILE.toString():case esri.Units.MILES:n=esri.tasks.GeometryService.UNIT_STATUTE_MILE;break;case"nauticalmile":case e.essentials.DistanceUnitType.NAUTICAL_MILES:case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE.toString():case esri.Units.NAUTICAL_MILES:n=esri.tasks.GeometryService.UNIT_NAUTICAL_MILE;break;case"yard":case e.essentials.DistanceUnitType.YARDS:case esri.Units.YARDS:n=i.GCX_UNIT_YARDS;break;default:n=r||t}return n}function s(e,t,r){var n=0;switch(t){case esri.tasks.GeometryService.UNIT_METER:n=3.280839895013*e;break;case esri.tasks.GeometryService.UNIT_KILOMETER:n=3280.839895013123*e;break;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:n=5280*e;break;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:n=6076.12*e;break;case i.GCX_UNIT_YARDS:n=3*e;break;default:n=e}switch(r){case esri.tasks.GeometryService.UNIT_METER:return n/3.280839895013;case esri.tasks.GeometryService.UNIT_KILOMETER:return n/3280.839895013123;case esri.tasks.GeometryService.UNIT_STATUTE_MILE:return n/5280;case esri.tasks.GeometryService.UNIT_NAUTICAL_MILE:return n/6076.12;case i.GCX_UNIT_YARDS:return n/3;default:return n}}function o(e){var t=[];return e.forEach(function(e){for(var i=!1,r=0;r<t.length;r++)if(t[r].length&&t[r][0].type===e.type){t[r].push(e),i=!0;break}if(!i){var n=t.length;t[n]=[],t[n].push(e)}}),t}i.SUPPORTED_BUFFER_UNITS={feet:null,yard:null,meter:null,kilometer:null,mile:null,nauticalmile:null};var l=[3819,3821,3824,3889,3906,5013,5233,5246,5252,5264,5324,5340,5354,5360,5365,5371,5373,5381,5393,5451,5464,5467,5489,5524,5527,5546,5561,37257,104e3,104020,104023,104199,104223,104896],c=[[4001,4999],[5228,5229],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700],[37001,37008],[37201,37208],[37211,37235],[37237,37243],[37245,37247],[37249,37255],[37259,37260],[104100,104145],[104256,104259],[104260,104261],[104286,104287],[104304,104305],[104700,104786],[104800,104871],[104900,104970],[104990,104992]];i.GCX_UNIT_YARDS=12345,i.bufferGeometry=function(e,t){var i={bufferId:t.bufferId,geometries:[t.geometry],callback:t.callback,geodesic:t.geodesic,bufferSpatialReference:t.bufferSpatialReference,outSpatialReference:t.outSpatialReference,bufferDistance:t.bufferDistance,bufferUnit:t.bufferUnit,unionResults:t.unionResults,sourceCommand:t.sourceCommand};return new Promise(function(t,n){r(e,i).then(function(e){e.geometry=e.geometries[0]||null,t(e)},function(e){n(e)})})},i.bufferGeometries=r,i.buffer=n,i.isGeographicWkid=function(e){var t=parseInt(e,10);if(isNaN(t))return!1;if(l.indexOf(t)>-1)return!0;for(var i=0;i<c.length;i++)if(t>=c[i][0]&&t<=c[i][1])return!0;return!1},i.getUnitDescFromConfig=function(e){for(var r in t.buffer.BufferUtils.SUPPORTED_BUFFER_UNITS)if(t.buffer.BufferUtils.SUPPORTED_BUFFER_UNITS.hasOwnProperty(r)&&i.SUPPORTED_BUFFER_UNITS[r]&&i.SUPPORTED_BUFFER_UNITS[r].config===e)return t.buffer.BufferUtils.SUPPORTED_BUFFER_UNITS[r];return null},i.getGeometryServiceUnitConstant=a,i.convertLength=s}(i.BufferUtils||(i.BufferUtils={}))}(t.buffer||(t.buffer={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(t){function i(e,i){var r=this;if(t.call(this),this.gcxLayer=null,this.featureLayer=null,this.singleFeatureLayer=null,this.clusterRadius=new Observable(null),this.maxFeaturesInCluster=new Observable(null),this.renderer=null,this.rendererInformation=[],this.featureLayerRenderer=null,this._featureLayerGraphics=[],this._clusters=[],this._hiddenClusters=[],this._clusterLabelColor=null,this._clusterBackgroundColor=null,this._featureSetName=null,this._esriEventHandlers=[],this._gcxEventHandlers=[],this._fontSize="10pt",this._fontFamily="Segoe UI, sans-serif",this._mapClickHandler=null,!(e.mapService.serviceLayer instanceof esri.layers.FeatureLayer))throw new Error("ClusterLayers require an Esri FeatureLayer to be passed in as a parameter.");this.app=i,this.id=e.mapService.id+"-cluster",this._featureSetName=this.id+"FeatureSet",this.gcxLayer=e,this.featureLayer=e.mapService.serviceLayer,this.singleFeatureLayer=new esri.layers.GraphicsLayer,this.url=this.featureLayer.url,this.setVisibility(this.featureLayer.visible&&this.featureLayer.visibleAtMapScale),this.setOpacity(this.featureLayer.opacity),this.featureLayerRenderer=this.featureLayer.renderer,this.featureLayer.setRenderer(null),this.featureLayer.redraw(),this.singleFeatureLayer.id=e.mapService.id+"-explodedClusterLayer",this.singleFeatureLayer.setRenderer(this.featureLayerRenderer),this.singleFeatureLayer.setOpacity(this.featureLayer.opacity),this.singleFeatureLayer.url=this.url,this.clusterRadius.set(e.mapService.featureClustering.radius||50),this.maxFeaturesInCluster.set(e.mapService.featureClustering.maximumFeatures||0),this._clusterLabelColor=new esri.Color(e.mapService.featureClustering.labelColor),this._clusterBackgroundColor=new esri.Color(e.mapService.featureClustering.backgroundColor);for(var n=0;n<4;n++)this.rendererInformation.push({isVisible:new Observable(!1),rangeString:new Observable("")});this.maxFeaturesInCluster.bind(this,function(e){r.gcxLayer.mapService.featureClustering.maximumFeatures=e,r._loadRenderer()}),this.clusterRadius.bind(this,function(e){r.gcxLayer.mapService.featureClustering.radius=e}),this.maxFeaturesInCluster.get()>0&&this._loadRenderer(),this.app.map&&this.app.map.loaded?this._setupEventListeners(this.app.map):this.app.event("MapLoadedEvent").once(this,function(e){r._setupEventListeners(e)}),this.recluster()}return __extends(i,t),i.prototype.recluster=function(){this.singleFeatureLayer.graphics.length>0||(this._featureLayerGraphics=this.featureLayer.graphics.slice(0,this.featureLayer.graphics.length),this._generateClusters(),this.redraw())},i.prototype.destroy=function(){this.app.map.getLayer(this.singleFeatureLayer.id)===this.singleFeatureLayer&&this.app.map.removeLayer(this.singleFeatureLayer),this.app.featureSetManager.getCollectionById(this._featureSetName)&&(this.app.featureSetManager.closeCollection(this._featureSetName),this.app.featureSetManager.removeCollectionById(this._featureSetName)),this.app.map.removeLayer(this),this.featureLayer.setRenderer(this.featureLayerRenderer),this.featureLayer.redraw();for(e=0;e<this._esriEventHandlers.length;e++)this._esriEventHandlers[e].remove();for(var e=0;e<this._gcxEventHandlers.length;e++)this.app.event(this._gcxEventHandlers[e].eventName).unsubscribe(this._gcxEventHandlers[e].token)},i.prototype.onFeatureClicked=function(t){var i=this;if(t.graphic instanceof esri.Graphic&&!this.app.toolRegistry.getActiveTool()){var r=t.graphic;this.singleFeatureLayer.clear(),this._hiddenClusters=[];for(var n=[],a=[],s=0;s<this._featureLayerGraphics.length;s++)if(this._featureLayerGraphics[s].attributes.clusterId===r.attributes.clusterId){var o={graphic:this._featureLayerGraphics[s],layer:this.gcxLayer,resolveLayerFields:!0};o.symbol=this._getRenderedSymbol(this._featureLayerGraphics[s]),n.push(new e.Feature(o)),a.push(this._featureLayerGraphics[s]),this.singleFeatureLayer.add(this._featureLayerGraphics[s])}this._hiddenClusters=this.graphics.slice(0,this.graphics.length),this.clear(),this.redraw(),this.app.map.getLayer(this.singleFeatureLayer.id)||this.app.map.addLayer(this.singleFeatureLayer),this.singleFeatureLayer.redraw();var l=new e.FeatureSet;l.features.set(n),l.layer=this.gcxLayer,l.esriFeatureSet=new esri.tasks.FeatureSet,l.esriFeatureSet.features=a,l.resolveDataLinks(function(e){i.app.event("FeatureChangedEvent").publish(e)});var c=new e.FeatureSetCollection;c.featureSets.addItem(l),c.id=this._featureSetName,c.sourceName="ClusterFeatures",this.app.featureSetManager.getCollectionById(this._featureSetName)&&this.app.featureSetManager.removeCollectionById(this._featureSetName),this.app.featureSetManager.addCollection(c),this.app.featureSetManager.openCollection(this._featureSetName),this.app.featureSetManager.closeCollection(this._featureSetName),this.app.command("DisableMapClick").execute(),this._mapClickHandler=this.app.map.on("click",function(e){if(!(i.app.stateManager.getActiveStates().filter(function(e){return"EditorActiveState"===e.stateDefinition.name}).length>0))return i._mapClickHandler.remove(),i._mapClickHandler=null,i.app.command("EnableMapClick").execute(),i.singleFeatureLayer.clear(),i.recluster(),!1;i.singleFeatureLayer.redraw()})}},i.prototype._setupEventListeners=function(e){var t=this;this._gcxEventHandlers.push({eventName:"MapClickedEvent",token:this.app.event("MapClickedEvent").subscribe(this,function(e){return t._mapClickedEvent(e)})}),this._gcxEventHandlers.push({eventName:"MapExtentChangedEvent",token:this.app.event("MapExtentChangedEvent").subscribe(this,function(e,i){return t._mapExtentChangedEvent(e,i)})}),this._gcxEventHandlers.push({eventName:"MapTipClosedEvent",token:this.app.event("MapTipClosedEvent").subscribe(this,function(){return t._mapTipClosedEvent()})}),this._gcxEventHandlers.push({eventName:"ClusterLayerRemovedEvent",token:this.app.event("ClusterLayerRemovedEvent").subscribe(this,function(e){return t._clusterLayerRemovedEvent(e)})}),this._gcxEventHandlers.push({eventName:"LayerVisibilityChangedEvent",token:this.app.event("LayerVisibilityChangedEvent").subscribe(this,function(e){return t._layerVisibilityChangedEvent(e)})}),this._gcxEventHandlers.push({eventName:"GeometryEditInvokedEvent",token:this.app.event("GeometryEditInvokedEvent").subscribe(this,function(e){return t.recluster()})}),this._gcxEventHandlers.push({eventName:"GeometryEditCompletedEvent",token:this.app.event("GeometryEditCompletedEvent").subscribe(this,function(e){return t._handleGeometryChange()})}),this._gcxEventHandlers.push({eventName:"EditorClosedEvent",token:this.app.event("EditorClosedEvent").subscribe(this,function(){return t._handleEditorClosedEvent()})}),this._esriEventHandlers.push(this.featureLayer.on("update-end",function(e){t.recluster()}))},i.prototype._handleGeometryChange=function(){this.recluster(),this.singleFeatureLayer.graphics.length>0&&this.singleFeatureLayer.redraw()},i.prototype._handleEditorClosedEvent=function(){this.recluster(),this.singleFeatureLayer.graphics.length>0&&this.singleFeatureLayer.redraw()},i.prototype._mapClickedEvent=function(t){if(this.visible){var i=t&&t.graphic?t.graphic:null;if(null===this.app.toolRegistry.getActiveTool()){if(i&&i.getLayer()===this&&i.attributes&&i.geometry instanceof esri.geometry.Point)return i.attributes.clusterId&&i.attributes.clusterCount?void this.onFeatureClicked(t):void this.app.command("ShowMapTip").execute(new e.Feature({graphic:i,layer:this.gcxLayer}));this.singleFeatureLayer.graphics.length>0&&(this.singleFeatureLayer.clear(),this.app.command("RemovePushpins").execute()),this.recluster()}}},i.prototype._mapExtentChangedEvent=function(e,t){this.featureLayer.visibleAtMapScale&&this.featureLayer.visible?this.setVisibility(!0):this.setVisibility(!1),0===this.singleFeatureLayer.graphics.length&&this.visible&&this.featureLayer.visibleAtMapScale&&this.recluster(),this._loadRenderer()},i.prototype._mapTipClosedEvent=function(){this._mapClickHandler&&(this._mapClickHandler.remove(),this._mapClickHandler=null),this.app.command("EnableMapClick").execute(),this.singleFeatureLayer.clear(),this.recluster()},i.prototype._clusterLayerRemovedEvent=function(e){e===this&&this.destroy()},i.prototype._layerVisibilityChangedEvent=function(e){var t=this;e.forEach(function(e){e.layer===t.gcxLayer&&(t.setVisibility(e.visibility&&t.featureLayer.visibleAtMapScale),t._loadRenderer())})},i.prototype._loadRenderer=function(){var e=new esri.renderer.ClassBreaksRenderer(null,"clusterCount"),t=null;if(this.maxFeaturesInCluster.get()>0)t=this.maxFeaturesInCluster.get();else{for(var i=0,r=0;r<this._clusters.length;r++)this._clusters[r].attributes.clusterCount>i&&(i=this._clusters[r].attributes.clusterCount);t=i}var n=Math.ceil(.309999999999*t);1===n&&n++;var a=Math.ceil(.31*t);a<=n&&(a=n+1);var s=Math.ceil(.609999999999*t);s<a&&(s=a);var o=Math.ceil(.61*t);o<=s&&(o=s+1);var l=Math.ceil(.909999999999*t);l<o&&(l=o);var c=Math.ceil(.91*t);c<=l&&(c=l+1),this._addBreak(e,21,2,n,t,0),this._addBreak(e,28,a,s,t,1),this._addBreak(e,35,o,l,t,2),this._addBreak(e,42,c,1/0,t,3),this.setRenderer(e)},i.prototype._addBreak=function(e,t,i,r,n,a){n>=i&&this.visible&&this.featureLayer.visibleAtMapScale?(i!==r?r!==1/0?this.rendererInformation[a].rangeString.set(i+" - "+r):this.rendererInformation[a].rangeString.set(i+"+"):this.rendererInformation[a].rangeString.set(i.toString()),this.rendererInformation[a].isVisible.set(!0)):this.rendererInformation[a].isVisible.set(!1);var s=null;s=8===dojo.isIE?new esri.symbol.SimpleMarkerSymbol({color:this._clusterBackgroundColor.toRgba(),size:t,type:"esriSMS",style:"esriSMSCircle",outline:{color:this._makeTransparent(this._clusterBackgroundColor.toRgba()),width:8,type:"esriSLS",style:"esriSLSSolid"}}):new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,t,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color(this._makeTransparent(this._clusterBackgroundColor.toRgba())),8),this._clusterBackgroundColor),e.addBreak(i,r,s)},i.prototype._makeTransparent=function(e){return 4===e.length&&(e[3]=.25),e},i.prototype._isValidCluster=function(e,t,i){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/i<=this.clusterRadius.get()&&this._isClusterFull(t)},i.prototype._isClusterFull=function(e){return e.attributes.clusterCount<this.maxFeaturesInCluster.get()||0==this.maxFeaturesInCluster.get()||""==this.maxFeaturesInCluster.get().toString()},i.prototype._generateClusters=function(){this.clear(),this._clusters=[],this._addGraphicsToClusters(!1);for(var e=[],t=0;t<this._clusters.length;t++)e[t]={x:this._clusters[t].x,y:this._clusters[t].y,attributes:{clusterCount:0,clusterId:this._clusters[t].attributes.clusterId,extent:this._clusters[t].attributes.extent}};this._clusters=e,this._addGraphicsToClusters(!0),this._showAllClusters()},i.prototype._addGraphicsToClusters=function(e){for(var t=this._featureLayerGraphics.length,i=this.app.map.extent.getWidth()/this.app.map.width,r=0;r<t;r++){var n=null;if(this._featureLayerGraphics[r].geometry instanceof esri.geometry.Point&&this._featureLayerGraphics[r].visible)if(n=this._featureLayerGraphics[r].geometry,this.app.map.extent.contains(n)){for(var a=this._featureLayerGraphics[r],s=[],o=0;o<this._clusters.length;o++){var l=this._clusters[o];this._isValidCluster(n,l,i)&&s.push(l)}if(1===s.length)this._clusterAddPoint(a,n,s[0],e);else if(s.length>1){for(var c=[],o=0;o<s.length;o++)c[o]=Math.sqrt(Math.pow(s[o].x-n.x,2)+Math.pow(s[o].y-n.y,2));for(var u=null,p=null,o=0;o<c.length;o++)(null===p||p>c[o])&&(p=c[o],u=s[o]);this._clusterAddPoint(a,n,u,e)}else this._createCluster(a,n)}else this._featureLayerGraphics[r].attributes.clusterId=-1}},i.prototype._showAllClusters=function(){0!=this.maxFeaturesInCluster.get()&&""!=this.maxFeaturesInCluster.get().toString()||this._loadRenderer();for(var e=0,t=this._clusters.length;e<t;e++)this._showCluster(this._clusters[e])},i.prototype._showCluster=function(e){var t=new esri.geometry.Point(e.x,e.y,this.app.map.spatialReference),i=new esri.Graphic(t,null,e.attributes);if(i.setSymbol(this._getRenderedSymbol(i)),this.add(i),!(e.attributes.clusterCount<2)){var r=null;8===dojo.isIE?(r=new esri.symbol.TextSymbol({type:"esriTS",color:this._clusterLabelColor.toRgba(),xoffset:0,yoffset:-5,font:{family:this._fontFamily,size:this._fontSize,weight:"bold"}})).setText(e.attributes.clusterCount.toString()):((r=new esri.symbol.TextSymbol(e.attributes.clusterCount)).setColor(this._clusterLabelColor),r.setOffset(0,-5),r.setFont(new esri.symbol.Font(this._fontSize).setFamily(this._fontFamily).setWeight(esri.symbol.Font.WEIGHT_BOLD)));var n=new esri.Graphic(t,r,e.attributes);this.add(n)}},i.prototype._getRenderedSymbol=function(e){if(1!==e.attributes.clusterCount)return null;var t=this.featureLayerRenderer;if(!t)return null;if(t instanceof esri.renderer.SimpleRenderer)return t.getSymbol(e);for(var i=0;i<this._featureLayerGraphics.length;i++){var r=this._featureLayerGraphics[i];if(r.attributes.clusterId===e.attributes.clusterId)return t.getSymbol(r)}},i.prototype._clusterAddPoint=function(e,t,i,r){var n,a,s;r||(n=i.attributes.clusterCount,a=(t.x+i.x*n)/(n+1),s=(t.y+i.y*n)/(n+1),i.x=a,i.y=s),t.x<i.attributes.extent[0]?i.attributes.extent[0]=t.x:t.x>i.attributes.extent[2]&&(i.attributes.extent[2]=t.x),t.y<i.attributes.extent[1]?i.attributes.extent[1]=t.y:t.y>i.attributes.extent[3]&&(i.attributes.extent[3]=t.y),i.attributes.clusterCount++,t.hasOwnProperty("attributes")||(t.attributes={}),e.attributes.clusterId=t.attributes.clusterId=i.attributes.clusterId},i.prototype._createCluster=function(e,t){var i=this._clusters.length+1;e.attributes.clusterId=i;var r={x:t.x,y:t.y,attributes:{clusterCount:1,clusterId:i,extent:[t.x,t.y,t.x,t.y]}};this._clusters.push(r)},i}(esri.layers.GraphicsLayer);e.ClusterLayer=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=e.essentials.documents.GrantKind,r=function(){function e(e){if(this.grants=[],this.isGlobal=!1,this.isPublic=!1,this.isRevoked=new Observable(!1),this.canRead=!1,this.canWrite=!1,this.enabled=new Observable(!0),!e.id&&!e.grant)throw new Error('MonikerModel: parameter "id" or "grant" is required.');e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.iconUri&&(this.iconUri=e.iconUri),e.isGlobal&&(this.isGlobal=e.isGlobal),e.isPublic&&(this.isPublic=e.isPublic),e.grant&&(this.id=e.grant.globalId,e.grant.subject&&(this.name=e.grant.subject.title),this.addGrant(e.grant))}return e.prototype.addGrant=function(e){switch(this.grants.push(e),e.kind){case i.READER:this.canRead=!0;break;case i.WRITER:this.canWrite=!0}},e}();t.MonikerModel=r}(t.documents||(t.documents={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.POLAR="polar",e.NORTH_AZIMUTH="north_azimuth",e.SOUTH_AZIMUTH="south_azimuth"}(e.AngleDirectionSystem||(e.AngleDirectionSystem={}))}(e.coordinates||(e.coordinates={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.DD="dd",e.DDM="ddm",e.DMS="dms"}(e.AngleFormat||(e.AngleFormat={}))}(e.coordinates||(e.coordinates={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){i.featureSetExtendedProperty="containsCoordinates",i.coordinateIdentifierProperty="coordinateId";var r=function(){function r(e){this._registeredCoordinateModels=[],this.app=e}return r.prototype.registerModel=function(e,t){return void 0===t&&(t=!1),!!this._validateModelRegistration(e)&&(this._processCoordinatesModel(e),(0===this._registeredCoordinateModels.length||t)&&(this._defaultCoordinatesModel=e),this._registeredCoordinateModels.push(e.id),!0)},r.prototype.getCoordinate=function(e,t,r){var n=this;if(!this.hasRegisteredCoordinatesModel(r)){return Promise.reject(new Error("Coordinates Manager: Could not resolve coordinates. Target coordinates model incorrectly configured or not registered."))}var a=e instanceof esri.geometry.Point?e:new esri.geometry.Point(e.x,e.y,e.spatialReference),s=this._defaultCoordinatesModel;if(!r||s.id===r)return i.CoordinateUtils.getCoordinate(this.app,a,t||s.currentCoordinateSystem.get(),s.fractionalDigits,s.defaultGcsWkid);this.getCoordinatesModel(r).then(function(e){return i.CoordinateUtils.getCoordinate(n.app,a,t||e.currentCoordinateSystem.get(),e.fractionalDigits,e.defaultGcsWkid)},function(e){return Promise.reject(e)})},r.prototype.getCoordinatesModel=function(t){var i=this;return new Promise(function(r,n){i.app.getFrameworkObjectByIdAsync(t,function(i){i instanceof e.essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinatesModel?r(i):n(new Error("CoordinatesManager: getCoordinatesModel - {0} is not an instance of a Coordinates Model.".format(t)))},function(e){return n(e)})})},r.prototype.hasRegisteredCoordinatesModel=function(e){return!(e||!this._defaultCoordinatesModel||!this._defaultCoordinatesModel.isRegistered)||!!e&&this._registeredCoordinateModels.indexOf(e)>-1},r.prototype._validateModelRegistration=function(e){if(!(e&&e.id&&e.coordinateSystems.length()&&e.currentCoordinateSystem.get()))return!1;if(this._registeredCoordinateModels.filter(function(t){return e.id===t}).length)return!1;for(var t=0;t<e.coordinateSystems.length();t++){var i=e.coordinateSystems.getAt(t);if(!this._validateCoordinateSystem(i))return!1}return!0},r.prototype._validateCoordinateSystem=function(e){return null!=e.displayName&&null!=e.output&&(null!=e.wkid||null!=e.wkt)},r.prototype._processCoordinatesModel=function(e){var i=this;this._addModelSubscriptionHooks(e);var r=!1;e.inputStream.bind(this,function(n){if(r||!e.isActive.get()||i._prevCoord&&i._prevCoord.x==n.x&&i._prevCoord.y==n.y&&i._prevCoord.spatialReference&&n.spatialReference&&(i._prevCoord.spatialReference.wkid===n.spatialReference.wkid||i._prevCoord.spatialReference.wkt==n.spatialReference.wkt))i._prevCoord=n;else{i._prevCoord=n;var a=n instanceof esri.geometry.Point?n:new esri.geometry.Point(n.x,n.y,n.spatialReference);r=!0,t.coordinates.CoordinateUtils.getCoordinate(i.app,a,e.currentCoordinateSystem.get(),e.fractionalDigits,e.defaultGcsWkid).then(function(t){e.outputStream.set(t),r=!1},function(t){i.app.trace.error("CoordinatesManager: An error occurred while attempting to map from input to output coordinate streams for model: {0}".format(e.id)),r=!1})}}),e.isRegistered=!0},r.prototype._addModelSubscriptionHooks=function(e){var t=this,i=e.outputStream.bindingEvent;dojo.aspect.after(i,"subscribe",function(r){return t._handleModelSubscriptionsChanged(e,i.subscriptions),r}),dojo.aspect.after(i,"unsubscribe",function(r){return t._handleModelSubscriptionsChanged(e,i.subscriptions),r}),dojo.aspect.after(i,"clear",function(){return t._handleModelSubscriptionsChanged(e,i.subscriptions)}),this._handleModelSubscriptionsChanged(e,i.subscriptions)},r.prototype._handleModelSubscriptionsChanged=function(e,t){var i=!1;for(var r in t)if(t.hasOwnProperty(r)){i=!0;break}i!==e.isActive.get()&&e.isActive.set(i)},r}();i.CoordinatesManager=r}(t.coordinates||(t.coordinates={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this.isActive=new Observable(!1),this.coordinateSystems=new ObservableCollection([]),this.currentCoordinateSystem=new Observable(null),this.fractionalDigits=5,this.defaultGcsWkid=4326,this.inputStream=new Observable(null),this.outputStream=new Observable(null),this.isRegistered=!1}return __extends(t,e),t.prototype.initialize=function(e){this.configuration=e},t}(e.framework.ui.ViewModelBase);t.CoordinatesModel=i}(t.coordinates||(t.coordinates={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(i){function r(e,t){return t=t.startsWith("language-coordinates-")?t:"language-coordinates-"+t,e.getResource("Mapping.Infrastructure",t)}function n(t,i,r,n){void 0===n&&(n=5);var a={};if(a.targetCoordinateSystem=r,a.x=i.x,a.y=i.y,a.spatialReference=i.spatialReference,"xy"==r.output)a.formattedLatitudeOrX=e.FormatUtils.formatNumber(i.x,e.NumberFormat.DEFAULT,{fractionalDigits:n}),a.formattedLongitudeOrY=e.FormatUtils.formatNumber(i.y,e.NumberFormat.DEFAULT,{fractionalDigits:n});else{var s=e.coordinates.CoordinateUtils.formatLatLon(i.y,i.x,r.output,t,n);a.formattedLatitudeOrX=s.latitude,a.formattedLongitudeOrY=s.longitude}return a}function a(t,r,n){return"{0}{1}".format(e.FormatUtils.formatNumber(t,e.NumberFormat.NUMBER,{fractionalDigits:n}),i.getResource(r,"degrees"))}function s(t,r,n){var a=Math.floor(Math.abs(t)),s=Math.floor(60*(Math.abs(t)-a)),o=60*(Math.abs(t)-a-s/60)*60;return"{0}{1} {2}{3} {4}{5}".format(a*l(t),i.getResource(r,"degrees"),s,i.getResource(r,"minutes"),e.FormatUtils.formatNumber(o,e.NumberFormat.NUMBER,{fractionalDigits:n}),i.getResource(r,"seconds"))}function o(t,r,n){var a=Math.floor(Math.abs(t)),s=60*(Math.abs(t)-a);return"{0}{1} {2}{3}".format(a*l(t),i.getResource(r,"degrees"),e.FormatUtils.formatNumber(s,e.NumberFormat.NUMBER,{fractionalDigits:n}),i.getResource(r,"minutes"))}function l(e){return"number"!=typeof e?NaN:e>0?1:e<0?-1:e}i.getCoordinate=function(t,i,r,a,s){void 0===a&&(a=5),void 0===s&&(s=4326);return new Promise(function(o,l){var c=esri.geometry,u=i.spatialReference,p=(t.map.spatialReference.wkt?r.wkt!==t.map.spatialReference.wkt:r.wkid!==t.map.spatialReference.wkid)||"xy"===r.output?new esri.SpatialReference(r.wkid||r.wkt):new esri.SpatialReference(s),h=function(e){var i=n(t,e,r,a);o(i)},d=function(){e.GeometryUtils.projectGeometry(i,p,function(e){h(e)},function(e){l(new Error("Unable to project geometry for coordinate tracking: {0}".format(e.message)))},t)};if(c.canProject(u,p)){var m=c.project(i,p);h(m)}else t.isOffline.get()?t.command("NativeHasCapability").execute("project",function(e){e?d():l(new Error("Offline Mode. Unable to project geometry for coordinate tracking."))}):d()})},i.convertDmsToDecimalDegrees=function(e,t,i,n,a){var s=r(e,"west-abbrev").toUpperCase(),o=r(e,"east-abbrev").toUpperCase(),l=r(e,"north-abbrev").toUpperCase(),c=r(e,"south-abbrev").toUpperCase();a=a.toUpperCase();var u=parseFloat(t),p=parseFloat(i),h=parseFloat(n);if(isNaN(u)||isNaN(p)||isNaN(h)||u<0||u>180||p<0||p>60||h<0||h>60||a!=s&&a!=o&&a!=l&&a!=c)return null;var d=u+p/60+h/3600;return a!==c&&a!==s||(d=-d),d},i.formatAngle=function(e,i,r,n){switch(null!=n&&void 0!==n||(n=4),i||(i=t.AngleFormat.DD),i=i.toLowerCase()){case t.AngleFormat.DDM:return o(e,r,n);case t.AngleFormat.DMS:return s(e,r,n);default:return a(e,r,n)}},i.formatLatLon=function(e,t,r,n,a){var s=null,o=null;return s=e>0?i.getResource(n,"north-abbrev"):i.getResource(n,"south-abbrev"),o=t>0?i.getResource(n,"east-abbrev"):i.getResource(n,"west-abbrev"),{latitude:"{0} {1}".format(i.formatAngle(Math.abs(e),r,n,a),s),longitude:"{0} {1}".format(i.formatAngle(Math.abs(t),r,n,a),o)}},i.formatXYCoordinate=function(t,i,r){return null!=r&&void 0!==r||(r=4),e.FormatUtils.formatNumber(t,e.NumberFormat.NUMBER,{fractionalDigits:r})},i.formatBearing=function(e,t,r,n){if(0===e)return i.getResource(r,"north-abbrev");if(90===e)return i.getResource(r,"east-abbrev");if(180===e)return i.getResource(r,"south-abbrev");if(270===e)return i.getResource(r,"west-abbrev");var a=i.getResource(r,"north-abbrev"),s=i.getResource(r,"east-abbrev");return e>=90&&e<180?(a=i.getResource(r,"south-abbrev"),e=180-e):e>=180&&e<270?(a=i.getResource(r,"south-abbrev"),s=i.getResource(r,"west-abbrev"),e-=180):e>=270&&e<360&&(s=i.getResource(r,"west-abbrev"),e=360-e),"{0} {1} {2}".format(a,i.formatAngle(e,t,r,n),s)},i.getResource=r}(t.CoordinateUtils||(t.CoordinateUtils={}))}(e.coordinates||(e.coordinates={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=e.essentials.documents.DocumentField,r=e.essentials.documents.FilterMethod,n=e.essentials.documents.FilterType,a=function(e){function t(t,i,r){e.call(this,t,i),this._pageSize=10,this._queryParams={},this.isInitialized=!1,this.stopFetching=!1,this.items=new ObservableCollection,this.numberOfItems=new Observable(0),this.currIndexStart=new Observable(0),this.currIndexStartFromOne=new Observable(1),this.currIndexEnd=new Observable(0),this.currPageNumber=new Observable(1),this.firstPageNumber=new Observable(1),this.lastPageNumber=new Observable(1),this.statusFetching=new Observable(!1),this.statusOffline=new Observable(!1),this._mapCallback=r}return __extends(t,e),t.prototype.initialize=function(e){var t=this;void 0===e&&(e={}),e.pageSize&&(this._pageSize=e.pageSize),e.queryParams&&(this._queryParams=dojo.mixin(this._queryParams,e.queryParams)),e.fileType&&this.addFilter({field:i.FILE_TYPE,method:r.VALUES,range:[{string:e.fileType}]}),this.isInitialized=!0,this.currIndexStartFromOne.syncTransform(this.currIndexStart,function(e){return e+1}),this.currPageNumber.bind(this,function(){return t._handlePageChanged()}),this._populateFromDocStore()},t.prototype.getLength=function(){return this.numberOfItems.get()},t.prototype.nextPage=function(){this.currPageNumber.set(this.currPageNumber.get()+1)},t.prototype.prevPage=function(){this.currPageNumber.set(this.currPageNumber.get()-1)},t.prototype.refresh=function(){this._populateFromDocStore()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.items&&this.items.clear()},t.prototype.setQueryParameters=function(e){this._queryParams=e,this.currPageNumber.set(1)},t.prototype.getQueryParameters=function(){return this._queryParams},t.prototype.addFilter=function(e,t){void 0===t&&(t=n.REQUIRE),this._queryParams.filters||(this._queryParams.filters={}),this._queryParams.filters[t]||(this._queryParams.filters[t]=[]),this._queryParams.filters[t]=this._queryParams.filters[t].filter(function(t){return t.field!==e.field}),this._queryParams.filters[t].push(e),this.currPageNumber.set(1)},t.prototype.removeFilter=function(e,t){void 0===t&&(t=n.REQUIRE),this._queryParams.filters&&this._queryParams.filters[t]&&(this._queryParams.filters[t]=this._queryParams.filters[t].filter(function(t){return t.field!==e}),0===this._queryParams.filters[t].length&&delete this._queryParams.filters[t],this.currPageNumber.set(1))},t.prototype.sortBy=function(e){e.fields&&0!==e.fields.length&&(e.descending?(delete this._queryParams.sort,this._queryParams.sortDescending=e.fields):(delete this._queryParams.sortDescending,this._queryParams.sort=e.fields),this.currPageNumber.set(1))},t.prototype._handlePageChanged=function(){this.currPageNumber.value=Math.max(1,Number(this.currPageNumber.get())),this.currPageNumber.get()>this.lastPageNumber.get()&&this.lastPageNumber.get()>0?this.currPageNumber.set(this.lastPageNumber.get()):(this.currIndexStart.set((this.currPageNumber.get()-1)*this._pageSize),this.currIndexEnd.set(Math.min(this.numberOfItems.get(),this.currIndexStart.get()+this._pageSize)),this._populateFromDocStore())},t.prototype._populateFromDocStore=function(){var e=this;if(this.app.site.documentStore.supported&&this.isInitialized&&!this.stopFetching){this.statusFetching.set(!0);var t=this._buildQueryParams();this.app.waitUntilSiteInitialized().then(function(){return e.statusOffline.set(!1)}).then(function(){return e.app.site.documentStore.query(t)}).then(function(t){return e._handleQueryResult(t)}).catch(function(t){e.items.clear(),e.numberOfItems.set(0),e.statusOffline.set(!0),e.app.trace.error("Error fetching documents: {0}".format(t),t)}).finally(function(){return e.statusFetching.set(!1)})}},t.prototype._buildQueryParams=function(){var e=dojo.mixin({},this._queryParams);return e.start=this.currIndexStart.get(),e.limit=this._pageSize,e},t.prototype._handleQueryResult=function(e){this.items.set(e.results.map(this._mapCallback));var t=e.total?e.total:0;this.numberOfItems.set(t);var i=Math.ceil(t/this._pageSize);this.lastPageNumber.set(i),this.firstPageNumber.set(1),this.currIndexStart.set((this.currPageNumber.get()-1)*this._pageSize),this.currIndexEnd.set(Math.min(this.numberOfItems.get(),this.currIndexStart.get()+this._pageSize))},t}(e.framework.FrameworkObject);t.DocumentCollection=a}(t.documents||(t.documents={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this.autoCompleteMinLength=0,this.autoCompleteMaxEntries=10}return __extends(t,e),t.prototype.added=function(t){e.prototype.added.call(this,t),this._setupJQueryAutocomplete()},t.prototype.handleInputChanged=function(e,t,i){this.viewModel.validateSearchInput()},t.prototype.handleAddMonikerButtonClick=function(e,t,i){this.viewModel.addMoniker(),this.viewModel.resetOptions()},t.prototype.handleUpdateMoniker=function(e,t,i){return this.viewModel.updateMoniker(i,t.value),!0},t.prototype.handleAutoCompleteBlur=function(e,t,i){$(t).autocomplete("widget").hide()},t.prototype.getSuggestions=function(e,t){var i=this;this.viewModel.searchMonikers(e.term).then(function(e){return i._processMonikers(e)}).then(function(e){return t(e)}).catch(function(e){return t([])})},t.prototype._processMonikers=function(e){var t=[];return e.length>0&&(t=e.slice(0,this.autoCompleteMaxEntries).map(function(e){return{label:e.title,moniker:e}})),Promise.resolve(t)},t.prototype._setupJQueryAutocomplete=function(){var e=this,t={minLength:this.autoCompleteMinLength,source:function(t,i){e.getSuggestions(t,i)},select:function(t,i){return e._handleAutoCompleteSelect(t,i),!1}};$(this.autoCompleteInput).autocomplete(t)},t.prototype._handleAutoCompleteSelect=function(e,t){this.viewModel.searchText.set(t.item.label),this.viewModel.selectedMoniker.set(t.item.moniker)},t}(e.framework.ui.ViewBase);t.GrantEditorView=i}(t.documents||(t.documents={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=e.framework.utils.ArrayUtils,r=e.essentials.documents.BatchRequestBuilder,n=e.essentials.documents.GrantID,a=e.essentials.documents.GrantKind,s=e.essentials.documents.MonikerKind,o=function(e){function o(t,i){var r=this;e.call(this,t,i),this._supportedGrantKinds=[a.READER,a.WRITER],this._globalGrantIds=[n.PUBLIC,n.USER],this._allowPublicAccess=!1,this._lastSearchResults=[],this.defaultGrantKind=a.READER,this.userIconUri="Resources/Images/Icons/user-24.png",this.roleIconUri="Resources/Images/Icons/team-24.png",this.document=null,this.grants=[],this.monikers=new ObservableCollection,this.isValidMoniker=new Observable(!1),this.monikerKinds=new ObservableCollection,this.selectedMonikerKind=new Observable,this.selectedMoniker=new Observable,this.searchText=new Observable,this.enabled=new Observable(!0),this.searchText.syncTransform(this.selectedMonikerKind,function(){return""}),this.isValidMoniker.syncTransform(this.selectedMoniker,function(e){return!!e}),this.enabled.bind(this,function(){return r._setMonikerEnableds()}),this._setMonikerKinds(),this.app.site&&this.app.site.isInitialized?this.onSiteInitialized():this.app.event("SiteInitializedEvent").once(this,this.onSiteInitialized)}return __extends(o,e),o.prototype.onSiteInitialized=function(){var e=this;this.app.site.documentStore.onInitialized().then(function(){e._allowPublicAccess=e.app.site.documentStore.hasPolicyGrant(function(e){return e.globalId===n.PUBLIC&&e.kind===a.GLOBAL_READER})})},o.prototype.loadById=function(e){var t=this;return this.app.waitUntilSiteInitialized().then(function(){return t.app.site.documentStore.getById(e)}).then(function(e){return t._updateModel(e)}).catch(function(e){t.app.trace.error("Error loading document: {0}".format(e),e),t.reset()})},o.prototype.addMoniker=function(){var e=this._getSelectedMoniker();if(e)if(this._monikerExists(e))this.app.trace.warning("GrantEditorViewModel: Could not add the grant as it already exists.");else{var i=this.addGrant(e.globalId,this.defaultGrantKind);this.monikers.addItem(new t.MonikerModel({grant:i,name:e.title,iconUri:this._isUserKind(this.selectedMonikerKind.get())?this.userIconUri:this.roleIconUri})),this._setMonikerEnableds()}else this.app.trace.error("GrantEditorViewModel: Could not find moniker with title {0}.".format(this.searchText.get()))},o.prototype.addGrant=function(e,t){var i={globalId:e,kind:t,assert:!0};return this.grants.push(i),i},o.prototype.updateMoniker=function(e,t){switch(e.grants.forEach(function(e){e.assert=!1,e.revoke=!0}),t){case a.READER:case a.WRITER:var r=i.firstOrDefault(e.grants,function(e){return e.kind===t});r||(r=this.addGrant(e.id,t),e.addGrant(r)),r.assert=!0,r.revoke=!1,this._globalGrantIds.some(function(t){return t===e.id})||e.isRevoked.set(!1);break;default:this._globalGrantIds.some(function(t){return t===e.id})||e.isRevoked.set(!0)}},o.prototype.searchMonikers=function(e){var t,i=this;return t=this._isUserKind(this.selectedMonikerKind.get())?r.searchUsers(e):r.searchRoles(e),this.app.waitUntilSiteInitialized().then(function(){return i.app.site.documentStore.perform(t)}).then(function(e){return i._lastSearchResults=e.monikers})},o.prototype.validateSearchInput=function(){var e=this;this.selectedMoniker.get()&&this.searchText.get()&&this.isValidMoniker.set(this._lastSearchResults.some(function(t){return t.title===e.searchText.get()}))},o.prototype.resetOptions=function(){this.searchText.set(null),this.selectedMoniker.set(null)},o.prototype.reset=function(){this._updateModel(null)},o.prototype._getSelectedMoniker=function(){var e=this;return this.selectedMoniker.get().title===this.searchText.get()?this.selectedMoniker.get():this._lastSearchResults.filter(function(t){return t.title===e.searchText.get()})[0]},o.prototype._isUserKind=function(e){return e===s.USER},o.prototype._updateModel=function(e){this.document=e,this.grants=e&&e.grants?e.grants:[],this.resetOptions(),this._updateMonikers(this.grants)},o.prototype._updateMonikers=function(e){this.monikers.clear();for(var r=[],a=0;a<this._globalGrantIds.length;a++){var s=this._globalGrantIds[a];r.push(new t.MonikerModel({id:s,name:this.app.getResource(this.libraryId,"language-grant-editor-global-grant-name-{0}".format(s)),iconUri:this.roleIconUri,isGlobal:!0,isPublic:s===n.PUBLIC}))}for(a=0;a<this._supportedGrantKinds.length;a++)for(var o=0;o<e.length;o++){var l=e[o];if(l.kind===this._supportedGrantKinds[a]){var c=i.firstOrDefault(r,function(e){return e.id===l.globalId});c?c.addGrant(l):r.push(new t.MonikerModel({grant:l,iconUri:this._isUserKind(l.subject.kind)?this.userIconUri:this.roleIconUri}))}}this._allowPublicAccess||(r=r.filter(function(e){return!e.isPublic})),this.monikers.addItems(r),this._setMonikerEnableds()},o.prototype._monikerExists=function(e){if(!e)return!1;var t=this.monikers.getItems();if(t.some(function(t){return t.id===e.globalId}))return!0;if(e.aliases)for(var i=0;i<e.aliases.length;i++){var r=e.aliases[i];if(t.some(function(e){return e.id===r}))return!0}return!1},o.prototype._setMonikerKinds=function(){this.monikerKinds.addItems([{kind:s.USER,displayName:this.app.getResource(this.libraryId,"language-grant-editor-moniker-type-user")},{kind:s.ROLE,displayName:this.app.getResource(this.libraryId,"language-grant-editor-moniker-type-role")}]),this.selectedMonikerKind.set(this.monikerKinds.getAt(0).kind)},o.prototype._setMonikerEnableds=function(){for(var e=this.enabled.get(),t=0,i=this.monikers.length();t<i;t++)this.monikers.getAt(t).enabled.set(e)},o}(e.framework.ui.ViewModelBase);t.GrantEditorViewModel=o}(t.documents||(t.documents={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.name=new Observable,this.linkUrl=new Observable,e.kind&&(this.kind=e.kind),e.name&&this.name.set(e.name)}return e.prototype.reset=function(){this.grant=null,this.link=null,this.linkUrl.set(null)},e}();e.GuestLinkModel=t}(e.documents||(e.documents={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,i,r){var n=e+"/"+i;return s.hasOwnProperty(e)&&(n+="/submitjob"),esri.request({callbackParamName:"callback",content:dojo.mixin({f:"json"},r),handleAs:"json",url:n}).then(function(n){return!n.jobStatus&&n.executionType&&n.parameters?(s[e]=!0,t(e,i,r)):n})}function i(e,t,r,n){switch(void 0===n&&(n=1e3),r.jobStatus){case esri.tasks.JobInfo.STATUS_CANCELLED:case esri.tasks.JobInfo.STATUS_DELETED:case esri.tasks.JobInfo.STATUS_FAILED:case esri.tasks.JobInfo.STATUS_TIMED_OUT:return Promise.reject(a(r));case esri.tasks.JobInfo.STATUS_SUCCEEDED:return Promise.resolve(r);default:return Promise.delay(n).then(function(){return esri.request({callbackParamName:"callback",content:{f:"json"},handleAs:"json",url:e+"/"+t+"/jobs/"+r.jobId})}).then(function(r){return i(e,t,r,Math.min(2*n,6e4))})}}function r(e,t,i,r){return esri.request({callbackParamName:"callback",content:{f:"json"},handleAs:"json",url:e+"/"+t+"/jobs/"+i+"/"+r})}function n(e){return esri.request({callbackParamName:"callback",content:{f:"json"},handleAs:"json",url:e})}function a(e){if(!e||!e.messages)return"";var t=e.messages.filter(function(e){return e.type===esri.tasks.GPMessage.TYPE_ERROR}),i=t.filter(function(e){return/^ERROR \d+:/.test(e.description)});return i.length>0&&(t=i),t.reduce(function(e,t){return t.description.length>e.length?t.description:e},"")}var s={};e.exportTiles=function(e,a){for(var s="string"==typeof e?e:e.url;"/"===s[s.length-1];)s=s.substring(0,s.length-1);return t(s,"exportTiles",a).then(function(e){return i(s,"exportTiles",e)}).then(function(e){return r(s,"exportTiles",e.jobId,e.results.out_service_url.paramUrl)}).then(function(e){return n(e.value)}).then(function(e){return e.files})},e.estimateExportTilesSize=function(e,n){for(var a="string"==typeof e?e:e.url;"/"===a[a.length-1];)a=a.substring(0,a.length-1);return t(a,"estimateExportTilesSize",n).then(function(e){return i(a,"estimateExportTilesSize",e)}).then(function(e){return r(a,"estimateExportTilesSize",e.jobId,e.results.out_service_url.paramUrl)}).then(function(e){return"string"==typeof e.value?{totalSize:+e.value,totalTilesToExport:null}:e.value})}}(e.ExportTilesUtils||(e.ExportTilesUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,t){return void 0===t&&(t={}),html4.ATTRIBS["*::aria-label"]=0,html4.ATTRIBS["*::data-replacement-token"]=0,html4.ATTRIBS["a::target"]=0,t.allowFrames&&(html4.ATTRIBS["iframe::src"]=1),html.sanitize(e,function(e,r,n,a){if(t.uriTransformer){e=e.toString();var s=void 0;if("MARKUP"===a.TYPE){var o=a;s={uri:e,type:"a"===o.XML_TAG&&"href"===o.XML_ATTR?i.NavigableLink:i.Markup,tag:o.XML_TAG,attribute:o.XML_ATTR}}else{if("CSS"!==a.TYPE)throw new Error("Unknown URI hint type: '"+a.TYPE+"'");var l=a;s={uri:e,type:i.Css,property:l.CSS_PROP}}return t.uriTransformer(e,s)}return""})}e.sanitize=t,e.stripHtml=function(e){var i=t(e=String.unescapeHtml(e)),r=document.createElement("div");return r.innerHTML=i,r.innerText||r.textContent},function(e){e[e.Markup=0]="Markup",e[e.Css=1]="Css",e[e.NavigableLink=2]="NavigableLink"}(e.UriType||(e.UriType={}));var i=e.UriType,r=function(){function e(e,t){void 0===t&&(t={}),this.sanitize(e,t)}return e.prototype.sanitize=function(e,i){void 0===i&&(i={}),this._unsafeHtml=e,this._safeHtml=t(this._unsafeHtml,i)},Object.defineProperty(e.prototype,"unsafeHtml",{get:function(){return this._unsafeHtml},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"safeHtml",{get:function(){return this._safeHtml},enumerable:!0,configurable:!0}),e}();e.UnsafeHtml=r;!function(e){function t(e){var t=e.match(/^\s*data:(.*?),.+/i);if(!t)return null;for(var i,r,n,a=t[1],s=0,o=a.split(";");s<o.length;s++){var l=o[s];if(/^charset=(.+)$/i.test(l)){if(r)return null;r=l}else if(/^base64$/i.test(l)){if(n)return null;n=l}else if(/^.+$/i.test(l)){if(i)return null;i=l}}return{uri:e,meta:a,mediaType:i,charset:r,extension:n,payloadIndex:e.indexOf(",")+1}}e.dataUriMediaTypeWhitelist=["image/jpeg","image/png","image/gif","image/svg+xml"],e.parseDataUri=t,e.isDataUriSafe=function(i){var r=t(i);if(!r)return!1;var n=r.mediaType;return n||(n="text/plain"),!!e.dataUriMediaTypeWhitelist.some(function(e){return n.toLowerCase()===e.toLowerCase()})}}(e.DataUri||(e.DataUri={}))}(e.FilterUtils||(e.FilterUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(e){e[e.BOTTOM_LEFT=0]="BOTTOM_LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.CALLOUT=2]="CALLOUT"}(t.HighlightedLabelAnchor||(t.HighlightedLabelAnchor={}));var i=t.HighlightedLabelAnchor,r=function(){function r(t,i){if(this.textGraphics=[],this.textSymbols=[],this._height=0,this._width=0,this._padding=0,this._calloutSizeWidthFraction=5,this._tagHeightPercentage=.6,!i||!this._processConfig(t))throw new Error("HighlightedLabelGraphic: Initialization failed.");this.app=i,this.graphicsLayer=e.GraphicUtils.getGraphicsLayer(this._config.layerId,!0,this.app),t._isRestoringState||this._executeSetupRoutine()}return r.prototype.getTextFontFamily=function(){return this.textSymbols&&this.textSymbols.length>0?this.textSymbols[0].font.family:this._config.fontFamily},r.prototype.getTextFontSize=function(){return this.textSymbols&&this.textSymbols.length>0?this.textSymbols[0].font.size+"px":this._config.fontSize},r.prototype.getWidth=function(){return this._width},r.prototype.getTotalWidth=function(){return this._width+this._padding},r.prototype.getHeight=function(){return this._height},r.prototype.getTotalHeight=function(){return this._height+this._padding},r.prototype.getMapPoint=function(){return this._config.mapPoint},r.prototype.getConfig=function(){return this._config},r.prototype.addToLayer=function(t){var i=this;void 0===t&&(t=!0),e.GraphicUtils.addGraphicToLayer(this.highlightGraphic,this._config.layerId,this.app),e.GraphicUtils.addGraphicToLayer(this.highlightIdTagGraphic,this._config.layerId,this.app),this.textGraphics.forEach(function(t){e.GraphicUtils.addGraphicToLayer(t,i._config.layerId,i.app)}),t?this.show():this.hide()},r.prototype.removeFromLayer=function(e){this.hide();var t=function(e){var t=e.getLayer();t&&t.remove(e)};this.textGraphics&&this.textGraphics.length>0&&(this.textGraphics.forEach(function(e){return t(e)}),e&&(this.textGraphics.length=0,this.textSymbols.length=0)),this.highlightIdTagGraphic&&(t(this.highlightIdTagGraphic),e&&(this.highlightIdTagGraphic=null,this.highlightIdTagSymbol=null)),this.highlightGraphic&&(t(this.highlightGraphic),e&&(this.highlightGraphic=null,this.highlightIdTagSymbol=null))},r.prototype.isVisible=function(){return!!this.highlightGraphic&&(this.highlightGraphic.visible&&(!this._config.calloutWithIdTag||this.highlightIdTagGraphic.visible)&&this.textGraphics.filter(function(e){return e.visible}).length>0)},r.prototype.show=function(){return this.highlightGraphic&&this.highlightGraphic.show(),this.highlightIdTagGraphic&&this.highlightIdTagGraphic.show(),this.textGraphics&&this.textGraphics.length>0&&this.textGraphics.forEach(function(e){e.show()}),this},r.prototype.hide=function(){return this.textGraphics&&this.textGraphics.length>0&&this.textGraphics.forEach(function(e){e.hide()}),this.highlightIdTagGraphic&&this.highlightIdTagGraphic.hide(),this.highlightGraphic&&this.highlightGraphic.hide(),this},r.prototype.update=function(e,t){if(this.highlightGraphic&&this.textGraphics.length){var i=this.isVisible(),r=this._key?this.highlightGraphic[this._key]:null;this._config.text=t||"",this._config.mapPoint=e&&e instanceof esri.geometry.Point?e:this._config.mapPoint,this.removeFromLayer(!0),this._executeSetupRoutine(),this.addToLayer(i),r&&this.assignGraphicIdentifierKey(this._key,r)}},r.prototype.refresh=function(e){if(this.highlightGraphic&&this.textGraphics.length){var t=this.isVisible(),i=this._key?this.highlightGraphic[this._key]:null;this._config.text=e||"",this.removeFromLayer(!0),this._executeSetupRoutine(),this.addToLayer(t),i&&this.assignGraphicIdentifierKey(this._key,i)}},r.prototype.moveToTop=function(){var e=this.highlightGraphic.getDojoShape();if(e&&e.moveToFront(),this.highlightIdTagGraphic){var t=this.highlightIdTagGraphic.getDojoShape();t&&t.moveToFront()}for(var i,r=0;r<this.textGraphics.length;r++)(i=this.textGraphics[r].getDojoShape())&&i.moveToFront()},r.prototype.assignGraphicIdentifierKey=function(e,t){this._key=e,this.highlightGraphic[e]=t,this.highlightIdTagGraphic&&(this.highlightIdTagGraphic[e]=t),this.textGraphics.forEach(function(i){i[e]=t})},r.prototype.updateIdTagText=function(e){if(e&&this._config.calloutWithIdTag){this._config.idTagText=e;var t=this.textGraphics[this.textGraphics.length-1];t&&t.symbol&&(t.symbol.setText(e),t.setSymbol(t.symbol))}},r.prototype.setHighlightColor=function(e){if(e&&e instanceof esri.Color&&this.highlightSymbol&&(this._config.highlightColor=e,this.highlightSymbol&&this.highlightGraphic&&(this.highlightSymbol.setColor(e),this.highlightGraphic.setSymbol(this.highlightSymbol))),this._config.calloutWithIdTag){var t=this.textGraphics[this.textGraphics.length-1];this.highlightIdTagSymbol&&this.highlightIdTagGraphic&&(this.highlightIdTagSymbol.outline.setColor(e),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)),t&&(t.symbol.setColor(e),t.setSymbol(t.symbol))}},r.prototype.setTextColor=function(e){if(e&&e instanceof esri.Color){this._config.textColor=e;var t=this.textGraphics.length;this._config.calloutWithIdTag&&(this.highlightIdTagSymbol&&this.highlightIdTagGraphic&&(this.highlightIdTagSymbol.setColor(e),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)),t--);for(var i=0;i<t;i++){var r=this.textGraphics[i];r&&(r.symbol.setColor(e),r.setSymbol(r.symbol))}}},r.prototype.exportState=function(e){var t=e.project.convert,i=this.getConfig();return{highlightGraphic:t.fromEsriGraphic(this.highlightGraphic),highlightSymbol:t.fromEsriSymbol(this.highlightSymbol),textGraphics:this.textGraphics.map(function(e){return t.fromEsriGraphic(e)}),textSymbols:this.textSymbols.map(function(e){return t.fromEsriSymbol(e)}),layerId:i.layerId,mapPoint:t.fromEsriGeometry(this.getMapPoint()),labelXoffset:i.labelXoffset,labelYoffset:i.labelYoffset,text:i.text,fontFamily:i.fontFamily,fontSize:i.fontSize,cornerRadius:i.cornerRadius,angle:i.angle,anchor:i.anchor,textColor:t.fromEsriColor(i.textColor),highlightColor:t.fromEsriColor(i.highlightColor),highlightOutlineSymbol:t.fromEsriSymbol(i.highlightOutlineSymbol)}},r.fromExportedState=function(e,t,i){return Promise.try(function(){if(!e||!e.highlightGraphic)throw new Error("HighlightedLabelGraphic.fromExportedState: Invalid state.");if(!t)throw new Error('HighlightedLabelGraphic.fromExportedState: Parameter "app" is required.');var n=t.project.convert,a={highlightGraphic:n.toEsriGraphic(e.highlightGraphic),textGraphics:Promise.map(e.textGraphics,function(e){return n.toEsriGraphic(e)})};return Promise.props(a).then(function(a){var s={layerId:e.layerId,mapPoint:n.toEsriGeometry(e.mapPoint),text:e.text,labelXoffset:e.labelXoffset,labelYoffset:e.labelYoffset,fontFamily:e.fontFamily,fontSize:e.fontSize,cornerRadius:e.cornerRadius,angle:e.angle,anchor:e.anchor,textColor:n.toEsriColor(e.textColor),highlightColor:n.toEsriColor(e.highlightColor),highlightOutlineSymbol:n.toEsriSymbol(e.highlightOutlineSymbol)};s._isRestoringState=!0,i=i||r.prototype;var o=Object.create(i);return o.constructor.call(o,s,t),o.initializeHighlightDimensions(),o.highlightGraphic=a.highlightGraphic,o.highlightSymbol=n.toEsriSymbol(e.highlightSymbol),o.textGraphics=a.textGraphics,o.textSymbols=e.textSymbols.map(function(e){return n.toEsriSymbol(e)}),o})})},r.prototype._executeSetupRoutine=function(){this.initializeHighlightDimensions(),this.initializeHighlightGraphic(),this.initializeHighlighteIdTagGraphic(),this.initializeTextGraphicsAndSymbols()},r.prototype.setHighlightAnchor=function(){switch(this._config.anchor){case i.BOTTOM_LEFT:this.highlightSymbol.setOffset(this.getTotalWidth()/2,this.getTotalHeight()/2);break;case i.CALLOUT:this.highlightSymbol.setOffset(0,this.getTotalHeight()/2+this._config.calloutPixelSize/4);break;default:this.highlightSymbol.setOffset(0,0)}this.highlightSymbol.setOffset(this.highlightSymbol.xoffset+this._config.labelXoffset,this.highlightSymbol.yoffset+this._config.labelYoffset)},r.prototype.setTextAnchor=function(e,t){switch(this._config.anchor){case i.MIDDLE:this.textSymbols[e].setOffset(0,t);break;case i.BOTTOM_LEFT:this.textSymbols[e].setOffset(this.getTotalWidth()/2,t+this.getTotalHeight()/2);break;case i.CALLOUT:this.textSymbols[e].setOffset(0,t+this.getTotalHeight()/2+this._config.calloutPixelSize/2)}},r.prototype.initializeHighlightDimensions=function(){var t=e.highlightedLabel.HighlightedLabelUtils.getLabelSize(this._config.text,this._config.fontFamily,this._config.fontSize,this._config.layerId),i=.5*t.height,r=this._config.calloutWithIdTag?t.height+i:0;this._height=t.height,this._width=t.width+r,this._padding=i,this._config.calloutPixelSize=this._config.calloutPixelSize||Math.floor(this._width/this._calloutSizeWidthFraction)},r.prototype.initializeHighlightGraphic=function(){this.highlightGraphic=new esri.Graphic,this.highlightGraphic.highlightedTextLabel=!0,this.highlightSymbol=new esri.symbol.SimpleMarkerSymbol,this.highlightGraphic.setGeometry(this._config.mapPoint),this.configureHighlightSymbol(this._config.highlightColor,this._config.highlightOutlineSymbol,this._config.fontSize)},r.prototype.initializeHighlighteIdTagGraphic=function(){this._config.calloutWithIdTag&&(this.highlightIdTagGraphic=new esri.Graphic,this.highlightIdTagSymbol=new esri.symbol.SimpleMarkerSymbol,this.highlightIdTagGraphic.setGeometry(this._config.mapPoint),this.configureHighlightIdTagSymbol(this._config.textColor,this._config.fontSize))},r.prototype.configureHighlightSymbol=function(t,i,r){this.setHighlightAnchor(),this.highlightSymbol.setStyle("STYLE_PATH");var n=e.highlightedLabel.HighlightedLabelUtils.generateSvgHighlightLabelPath(this.getTotalWidth(),this.getTotalHeight(),this._config.cornerRadius,this._config.calloutWithIdTag,this._config.calloutPixelSize);this.highlightSymbol.setPath(n),this.highlightSymbol.setColor(t),this.highlightSymbol.setOutline(i),this.highlightSymbol.setAngle(this._config.angle),this.highlightSymbol.setSize(r),this.highlightGraphic.setSymbol(this.highlightSymbol)},r.prototype.configureHighlightIdTagSymbol=function(e,i){var r=-(this.getTotalWidth()/2-this.getTotalHeight()/2),n=this.getTotalHeight()/2+this._config.calloutPixelSize/2;this.highlightIdTagSymbol.setStyle("STYLE_PATH"),this.highlightIdTagSymbol.setPath(t.HighlightedLabelUtils.generateSvgCirclePath(this.getTotalHeight()*this._tagHeightPercentage/2)),this.highlightIdTagSymbol.setColor(e),this.highlightIdTagSymbol.outline&&this.highlightIdTagSymbol.outline.setColor(e),this.highlightIdTagSymbol.setOffset(r+this._config.labelXoffset,n+this._config.labelYoffset),this.highlightIdTagSymbol.setSize(this.getTotalHeight()*this._tagHeightPercentage),this.highlightIdTagGraphic.setSymbol(this.highlightIdTagSymbol)},r.prototype.initializeTextGraphicsAndSymbols=function(){if(this._config.text){var t=e.highlightedLabel.HighlightedLabelUtils.getTextLines(this._config.text);if(t&&t.length&&0!==t.length){var i=t.length,r=new esri.symbol.Font;r.setSize(this._config.fontSize),r.setFamily(this._config.fontFamily);var n=this.getHeight()/i,a=Math.abs(r.size-n),s=this.getHeight()/2/n;this.textGraphics=[],this.textSymbols=[];for(var o=0;t&&t.length>0&&o<t.length;o++){this.textGraphics[o]||(this.textGraphics[o]=new esri.Graphic),this.textSymbols[o]||(this.textSymbols[o]=new esri.symbol.TextSymbol("")),this.textGraphics[o].geometry!==this._config.mapPoint&&this.textGraphics[o].setGeometry(this._config.mapPoint);var l=(s-(o+1))*n+a;if(this.configureTextSymbol(o,t[o],this._config.textColor,r,this._config.angle,l),1===i){this.textSymbols[o].setHorizontalAlignment(esri.symbol.TextSymbol.ALIGN_MIDDLE);var c=this._config.angle*(Math.PI/180);this.textSymbols[o].setOffset(-n/2/2*Math.sin(c),-Math.abs(n/2/2*Math.cos(c)));u={customVerticalAlignment:"middle",numberOfLines:1};this.textGraphics[o].setAttributes(u)}else{this.textSymbols[o].setHorizontalAlignment(esri.symbol.TextSymbol.ALIGN_START),this.textSymbols[o].setVerticalAlignment(esri.symbol.TextSymbol.ALIGN_START);var u={customVerticalAlignment:"middle",numberOfLines:i};this.textGraphics[o].setAttributes(u)}var p=this._config.calloutWithIdTag?this.getTotalHeight()/2:0;this.textSymbols[o].setOffset(this.textSymbols[o].xoffset+this._config.labelXoffset+p,this.textSymbols[o].yoffset+this._config.labelYoffset),this.textGraphics[o].setSymbol(this.textSymbols[o])}if(this._config.calloutWithIdTag){var h=new esri.symbol.Font;h.setSize(this._config.fontSize),h.setSize(Math.floor(1.25*h.size)),h.setFamily(this._config.fontFamily),h.setWeight(esri.symbol.Font.WEIGHT_BOLD);var d=new esri.Graphic;d.setGeometry(this._config.mapPoint),this.textGraphics.push(d);var m=new esri.symbol.TextSymbol(this._config.idTagText);this.textSymbols.push(m),this.configureTextSymbol(i,this._config.idTagText,this._config.highlightColor,h,0,0);var g=-(this.getTotalWidth()/2-this.getTotalHeight()/2),f=-h.size/3;m.setOffset(m.xoffset+g,m.yoffset+f),d.setSymbol(m)}}}},r.prototype.configureTextSymbol=function(e,t,i,r,n,a){this.textSymbols&&e<this.textSymbols.length&&(this.textSymbols[e].setText(t),this.textSymbols[e].setFont(r),this.textSymbols[e].setColor(i),this.textSymbols[e].setAngle(n),this.setTextAnchor(e,a))},r.prototype._processConfig=function(e){return!!(e&&e.layerId&&e.mapPoint)&&(e.calloutWithIdTag=void 0!=e.calloutWithIdTag&&!!e.calloutWithIdTag,e.idTagText=e.idTagText||"",e.calloutPixelSize=e.calloutPixelSize||0,e.labelXoffset=e.calloutWithIdTag?0:e.labelXoffset||0,e.labelYoffset=e.calloutWithIdTag?0:e.labelYoffset||0,e.layerId=e.layerId,e.mapPoint=e.mapPoint,e.text=e.text||"",e.fontFamily=e.fontFamily||"Arial",e.fontSize=e.fontSize||"12px",e.cornerRadius=void 0==e.cornerRadius?5:e.cornerRadius,e.angle=e.calloutWithIdTag?0:e.angle||0,e.anchor=e.calloutWithIdTag?i.CALLOUT:void 0!=e.anchor?e.anchor:i.MIDDLE,e.textColor=e.textColor&&e.textColor instanceof esri.Color?e.textColor:new esri.Color("white"),e.highlightColor=e.highlightColor&&e.highlightColor instanceof esri.Color?e.highlightColor:new esri.Color("black"),e.highlightOutlineSymbol=e.highlightOutlineSymbol&&e.highlightOutlineSymbol instanceof esri.symbol.SimpleLineSymbol?e.highlightOutlineSymbol:new esri.symbol.SimpleLineSymbol,this._config=e,!0)},r}();t.HighlightedLabelGraphic=r}(e.highlightedLabel||(e.highlightedLabel={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){},e.prototype.filter=function(e,t){return Promise.resolve()},e}();e.LayerCatalogFilterProviderBase=t}(e.layerCatalog||(e.layerCatalog={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){i.discoverFeatureServices=function(e){return new Promise(function(t,i){esri.request({url:e,content:{f:"json"},handleAs:"json"}).then(function(r){if("layers"in r){for(var n=[],a=0,s=r.layers;a<s.length;a++){var o=s[a];o.subLayerIds||n.push(e+"/"+o.id)}t(n)}else"fields"in r?t([e]):i(new Error("Unknown response type from url ("+e+")."))},i)})},i.buildFeatureLayerService=function(t){var i=new e.essentials.FeatureLayerService;return i._createFrom({id:e.framework.utils.alphaNumericToken(),displayName:e.framework.utils.alphaNumericToken(),serviceType:e.essentials.MapServiceType.FEATURE,serviceFunction:e.essentials.MapServiceFunction.OPERATIONAL,connectionString:t}),i.serviceUrl=t,i.outFields="*",i._createServiceLayer(),new Promise(function(t,r){i.serviceLayer.on("load",function(r){i.displayName=i.serviceLayer.name;var n=new e.essentials.Layer;n._createFrom(i.serviceLayer),n.id=i.serviceLayer.layerId.toString(),n.type=e.essentials.LayerType.FEATURE_LAYER;var a=i.serviceLayer;"esriGeometryPoint"===a.geometryType&&(n.featureType="Point"),"esriGeometryPolyline"===a.geometryType&&(n.featureType="Line"),"esriGeometryPolygon"===a.geometryType&&(n.featureType="Polygon"),n.mapService=i,i.layers.push(n),t(i)})})},i.buildKmlService=function(t,i){void 0===i&&(i={});var r=new e.essentials.KmlService;return i=$.extend({id:e.framework.utils.alphaNumericToken(),serviceType:e.essentials.MapServiceType.KML,serviceFunction:e.essentials.MapServiceFunction.OPERATIONAL,serviceUrl:t,drawingBehavior:e.essentials.DrawingBehavior.KML_SERVICE,connectionString:t},i),r._createFrom(i),r._createServiceLayer(),new Promise(function(e,t){r.serviceLayer.on("load",function(t){e(r)})})},i.buildLocalFeatureLayerService=function(t,i){void 0===i&&(i={});var s=new n;i=$.extend({id:e.framework.utils.alphaNumericToken()+":Local",displayName:t.layerDefinition.name,serviceType:e.essentials.MapServiceType.FEATURE,serviceFunction:e.essentials.MapServiceFunction.OPERATIONAL,connectionString:s.url},i),s._createFrom(i);var o=s.serviceLayer=new r(t);o.id=s.id,o.layerId=0,o.name=t.layerDefinition.name,o.graphics.length&&(o.fullExtent=esri.graphicsExtent(o.graphics)),o.setEditable(!1);var l=new a;if(l._createFrom(o),l.id=o.layerId.toString(),l.primaryKeyField=l.getFieldByName(o.objectIdField),l.mapService=s,l.searchable=!0,l.type=e.essentials.LayerType.FEATURE_LAYER,t.layerDefinition&&t.layerDefinition.geometryType){var c=t.layerDefinition.geometryType.toLowerCase();c.indexOf("point")>-1?l.featureType="Point":c.indexOf("line")>-1?l.featureType="Line":c.indexOf("polygon")>-1&&(l.featureType="Polygon")}return l.queryable=!1,l.supportsQuery=!1,s.layers.push(l),Promise.resolve(s)};var r=function(e){function i(t){e.call(this,t,{mode:esri.layers.FeatureLayer.MODE_SNAPSHOT})}return __extends(i,e),i.prototype.queryFeatures=function(i,r,n){var a=new esri.tasks.Query;i.hasOwnProperty("geometry")&&(a.geometry="extent"!==i.geometry.type?i.geometry.getExtent():i.geometry);for(var s=0,o=["num","objectIds","returnGeometry","spatialRelationship"];s<o.length;s++){var l=o[s];a[l]=i[l]}return e.prototype.queryFeatures.call(this,a,r,n).then(function(e){return Promise.all(e.features.map(function(e){return t.GeometryUtils.intersects(i.geometry,e.geometry)})).then(function(t){return e.features.filter(function(e,i){return!!t[i]})}).then(function(t){return e.features=t,e})})},i}(esri.layers.FeatureLayer);i.LocalFeatureLayer=r;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.essentials.FeatureLayerService);i.LocalFeatureLayerService=n;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.essentials.Layer);i.LocalLayer=a}(t.LayerIntegrationUtils||(t.LayerIntegrationUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.selectAllLayers=function(e,t,i){this.viewModel.layerSelector.enableAllLayers()},t.prototype.clearAllLayers=function(e,t,i){this.viewModel.layerSelector.disableAllLayers()},t.prototype.handleExpanderClick=function(e,t,i){i.isExpanded.set(!i.isExpanded.get())},t}(e.framework.ui.ViewBase);t.LayerSelectorViewBase=i}(t.layerSelector||(t.layerSelector={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i;!function(r){var n=function(e){function r(t,i){e.call(this,t,i),this.selectAllButtonText=new Observable(this.app.getResource(i,"language-layer-selector-default-select-all-text")),this.clearAllButtonText=new Observable(this.app.getResource(i,"language-layer-selector-default-clear-all-text")),this.selectAllButtonTitle=new Observable(this.app.getResource(i,"language-layer-selector-default-select-all-tooltip")),this.clearAllButtonTitle=new Observable(this.app.getResource(i,"language-layer-selector-default-clear-all-tooltip")),this.items=new ObservableCollection([])}return __extends(r,e),r.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.app.map&&this.app.site.isInitialized?this._setupLayerSelector():this.app.event("SiteInitializedEvent").once(this,this._setupLayerSelector)},r.prototype.onInitialized=function(e){},r.prototype.onLayerSelectorFolderItemCreated=function(e){},r.prototype.onLayerSelectorLayerItemCreated=function(e){},r.prototype.onLayerSelectorServiceLayerItemCreated=function(e){},r.prototype.filter=function(e){return!0},r.prototype.handleLayerStateChange=function(e){},r.prototype.handleAllLayersEnabled=function(){},r.prototype.handleAllLayersDisabled=function(){},r.prototype.getAllItems=function(){return r._expandItems(this.items.get())},r._expandItems=function(e){return e.concat.apply(e,e.map(function(e){return r._expandItems(e.items.get())}))},r.prototype._setupLayerSelector=function(){var e=this;this.appInfo=t.gis.AppInfo.fromGeocortexApp(this.app);var r={onInitializedHandler:function(t){return e.onInitialized(t)},layerFilter:function(t){return e.filter(t)},layerStateChangeHandler:function(t){return e.handleLayerStateChange(t)},enableAllLayersHandler:function(){return e.handleAllLayersEnabled()},disableAllLayersHandler:function(){return e.handleAllLayersDisabled()},onLayerSelectorFolderItemCreated:function(t){return e.onLayerSelectorFolderItemCreated(t)},onLayerSelectorLayerItemCreated:function(t){return e.onLayerSelectorLayerItemCreated(t)},onLayerSelectorServiceLayerItemCreated:function(t){return e.onLayerSelectorServiceLayerItemCreated(t)}};this.layerSelector=new i.LayerSelector(this.appInfo,r),this._subscribeEvents(),this.items.sync(this.layerSelector.items),this.items.pulse()},r.prototype._subscribeEvents=function(){this.app.event("MapServiceAddedEvent").subscribe(this,this._handleMapServicesAdded),this.app.event("MapServiceRemovedEvent").subscribe(this,this._handleMapServiceRemoved),this.app.event("MapServiceLayersChangedWithResultEvent").subscribe(this,this._handleMapServiceLayersChanged)},r.prototype._handleMapServicesAdded=function(e){this.layerSelector.addUserAddedServiceLayer(e)},r.prototype._handleMapServiceRemoved=function(e){this.layerSelector.removeServiceLayer(e)},r.prototype._handleMapServiceLayersChanged=function(e){e&&this.layerSelector.updateServiceLayer(e.mapService,e.newItems,e.oldItems)},r}(e.framework.ui.ViewModelBase);r.LayerSelectorViewModelBase=n}(i=t.layerSelector||(t.layerSelector={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.app=e}return e.prototype.message=function(e,t,i,r){var n=this;return new Promise(function(a,s){if(n.app.nativeManager.isNative()){var o;i&&i.register(function(){n.cancel(o)});var l;r&&(l=n.app.event("NativeMessageEvent").subscribe(n,function(e){if("JobProgress"===e.type&&e.parameters.jobId===o)if("inProgress"===e.parameters.status)r(e.parameters);else if("complete"===e.parameters.status)a(e.parameters.details),n.app.event("NativeMessageEvent").unsubscribe(l);else if("canceled"===e.parameters.status){var t=new Error(e.parameters.details.message);t.name="OperationCanceled",s(t),n.app.event("NativeMessageEvent").unsubscribe(l)}else"error"===e.parameters.status&&(s(new Error(e.parameters.details.message)),n.app.event("NativeMessageEvent").unsubscribe(l))})),n.app.nativeManager.onNativeInitialized().then(function(){return n.app.nativeManager.xhrPost({url:n.app.localServerAddress+"/message/"+e,postData:JSON.stringify(t),method:"POST"})}).then(function(e){var t=JSON.parse(e);o=t.jobId,i&&i.isCancellationRequested?n.cancel(o):o?n.app.nativeManager.xhrPost({url:n.app.localServerAddress+"/message/JobHandshake",postData:JSON.stringify({jobId:o}),method:"POST"}):a(t.result)}).catch(function(e){try{var t=JSON.parse(e.response.data);s(new Error(t.error.message))}catch(t){s(e)}})}else s(new Error("Method not supported in browser."))})},e.prototype.cancel=function(e){if(e)return this.app.nativeManager.xhrPost({url:this.app.localServerAddress+"/message/CancelJob",postData:JSON.stringify({jobId:e}),method:"POST"})},e}();e.MessageClient=t}(e.nativeIntegration||(e.nativeIntegration={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e.formatByteTransferRateString=function(e,t){var i=t/1024;if(i<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-bytes-per-second").format(Math.round(t));var r=t/1048576;return r<1?e.getResource("Mapping.Infrastructure","language-offline-progress-kilobytes-per-second").format(Math.round(i)):e.getResource("Mapping.Infrastructure","language-offline-progress-megabytes-per-second").format(Math.round(10*r)/10)},e.formatBytesString=function(e,t){var i=t/1024;if(i<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-bytes").format(t);var r=t/1048576;if(r<1)return e.getResource("Mapping.Infrastructure","language-offline-progress-kilobytes").format(Math.round(i));var n=t/1073741824;return n<1?e.getResource("Mapping.Infrastructure","language-offline-progress-megabytes").format(Math.round(r)):e.getResource("Mapping.Infrastructure","language-offline-progress-gigabytes").format(Math.round(100*n)/100)}}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(t){!function(i){var r=function(){function r(e){var i=this;this._numberValidator=new t.validation.NumberValidator,this._xssHtmlValidator=new t.validation.XssHtmlValidator,this.object=function(e){if(!e||"object"!=typeof e)return!0;switch(e[t.webMap.CONVERSION_TYPE_PROPERTY]){case t.webMap.ConversionType.GCX_MAP_SERVICE:case t.webMap.ConversionType.ESRI_LAYER:return function(){return i.serviceLayer};case t.webMap.ConversionType.GCX_LAYER:return function(){return i.layer};case t.webMap.ConversionType.GCX_FEATURE_SET:case t.webMap.ConversionType.ESRI_FEATURE_SET:return function(){return i.featureSet};case t.webMap.ConversionType.GCX_FEATURE:case t.webMap.ConversionType.ESRI_GRAPHIC:return function(){return i.feature};case t.webMap.ConversionType.ESRI_GEOMETRY:return i.geometry;case t.webMap.ConversionType.ESRI_SYMBOL:return i.symbol;case t.webMap.ConversionType.ESRI_RENDERER:return i.renderer;case t.webMap.ConversionType.ESRI_SPATIAL_REFERENCE:return i.spatialReference}for(var r={},n=0,a=Object.keys(e);n<a.length;n++)r[a[n]]=i.object;return r},this.app=e,this._urlValidator=new t.validation.SiteUrlValidator(e),this._webMapFilter=new t.webMap.WebMapFilter(e),this._xssHtmlValidator=new t.validation.XssHtmlValidator(e.defaultContentPolicy)}return Object.defineProperty(r.prototype,"baseMap",{get:function(){return this._webMapFilter.baseMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"baseMapLayer",{get:function(){return this._baseMapLayer||(this._baseMapLayer=$.extend({},this._webMapFilter.baseMapLayer,this._serviceLayerCommon)),this._baseMapLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bookmark",{get:function(){return this._webMapFilter.bookmark},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"color",{get:function(){return this._webMapFilter.color},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"coordinateSystem",{get:function(){return this._coordinateSystem||(this._coordinateSystem={wkid:this._numberValidator,wkt:!0,output:!0}),this._coordinateSystem},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"domain",{get:function(){return this._webMapFilter.domain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inheritedDomain",{get:function(){return this._webMapFilter.inheritedDomain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rangeDomain",{get:function(){return this._webMapFilter.rangeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"codedValueDomain",{get:function(){return this._webMapFilter.codedValueDomain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"drawingInfo",{get:function(){return this._drawingInfo||(this._drawingInfo=$.extend({},this._webMapFilter.drawingInfo,{showLabels:!0,clustering:{radius:this._numberValidator,backgroundColor:this.color,labelColor:this.color,maximumFeatures:this._numberValidator,enabled:!0},labelingInfo:{item:{fieldInfos:{item:this.object},labelExpression:!0,labelExpressionInfo:this.object,labelPlacement:!0,maxScale:this._numberValidator,minScale:this._numberValidator,sizeInfo:this.object,symbol:{align:!0,angle:this._numberValidator,color:{a:this._numberValidator,b:this._numberValidator,g:this._numberValidator,r:this._numberValidator},decoration:!0,font:{decoration:!0,family:!0,size:this._numberValidator,style:!0,variant:!0,weight:!0},haloColor:{a:this._numberValidator,b:this._numberValidator,g:this._numberValidator,r:this._numberValidator},haloSize:!0,horizontalAlignment:!0,kerning:!0,rotated:!0,text:!0,type:!0,verticalAlignment:!0,xoffset:this._numberValidator,yoffset:this._numberValidator},useCodedValues:!0,where:!0}}})),this._drawingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"feature",{get:function(){var t=this;return this._feature||(this._feature=$.extend({},this._webMapFilter.feature,{id:!0,layer:function(){return t.layer},featureLayer:function(){return t.serviceLayer},featureSet:function(){return t.featureSet},allowUnsafeContent:!0,extendedProperties:this.object,defaultNumberFormat:this._xssHtmlValidator,defaultDateFormat:this._xssHtmlValidator,timeZoneId:!0,displayTimeZoneId:!0,borderColor:this.color,fillColor:this.color,borderWidth:!0,attributes:this.object}),this._feature[i.PROPERTY_MEASUREMENT_ID]=!0,this._feature[i.PROPERTY_HIGHLIGHT_ID]=!0,this._feature[e.infrastructure.isKmlProperty]=!0),this._feature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"featureCollection",{get:function(){return this._featureCollection||(this._featureCollection=$.extend({},this._webMapFilter.featureCollection,{layers:{item:this.layer}})),this._featureCollection},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"featureSet",{get:function(){var e=this;return this._featureSet||(this._featureSet=$.extend({},this._webMapFilter.featureSet,{id:!0,features:{item:function(){return e.feature}},allowUnsafeContent:!0,extendedProperties:this.object,layer:function(){return e.layer},displayName:this._xssHtmlValidator,iconUri:this._urlValidator})),this._featureSet},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"featureSetCollection",{get:function(){var e=this;return this._featureSetCollection||(this._featureSetCollection={id:!0,displayName:this._xssHtmlValidator,featureSets:{item:function(){return e.featureSet}},sourceName:!0,tag:this.object,extendedProperties:this.object}),this._featureSetCollection},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"field",{get:function(){return this._webMapFilter.field},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"geometry",{get:function(){return this._webMapFilter.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"graphic",{get:function(){return this._graphic||(this._graphic=$.extend({},this._webMapFilter.feature),this._graphic[i.PROPERTY_MEASUREMENT_ID]=!0,this._graphic[i.PROPERTY_HIGHLIGHT_ID]=!0,this._graphic[e.infrastructure.isKmlProperty]=!0),this._graphic},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"point",{get:function(){return this._webMapFilter.point},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"multiPoint",{get:function(){return this._webMapFilter.multiPoint},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"polyline",{get:function(){return this._webMapFilter.polyline},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"polygon",{get:function(){return this._webMapFilter.polygon},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"extent",{get:function(){return this._webMapFilter.extent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layer",{get:function(){var e=this;return this._layer||(this._layer=$.extend({},this._webMapFilter.layer,{serviceLayer:function(){return e.serviceLayer},layerDefinition:this.layerDefinition,featureSet:function(){return e.featureSet},isDynamic:!0,layerStyleId:!0,gcxLayerDefinition:{id:!0,name:this._xssHtmlValidator,url:this._urlValidator,defaultVisibility:!0,visible:!0,displayName:this._xssHtmlValidator,description:!0,featureType:!0,featureZoomScale:!0,featureZoomFactor:!0,hasAttachments:!0,nativeID:!0,parentLayerId:!0,subLayerIds:!0,styleName:!0,legendUrl:this._urlValidator,isDynamic:!0,dynamicDefinition:!0,defaultDateFormat:!0,defaultNumberFormat:!0,fullExtent:!0,drawIndex:!0,identifiable:!0,includeInLayerList:!0,includeInLegend:!0,featureBorderColor:!0,featureBorderWidth:!0,featureFillColor:!0,minScale:this._numberValidator,maxScale:this._numberValidator,queryable:!0,searchable:!0,snappable:!0,snappingEnabled:!0,showFeatureHyperlinks:!0,canToggleLabels:!0,showLabels:!0,showMapTips:!0,supportsIdentify:!0,supportsQuery:!0,type:!0,fields:!0,primaryKeyField:!0,displayField:!0,catalogId:this.object,featureDescription:!1,featureLongDescription:!1,featureLabel:!1,featureHyperlinks:!1,layerHyperlinks:!1,relationships:!1,dataLinks:!1,reports:!1,charts:!1}})),this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layerDefinition",{get:function(){return this._layerDefinition||(this._layerDefinition=$.extend({},this._webMapFilter.layerDefinition,{drawingInfo:this.drawingInfo})),this._layerDefinition},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"operationalLayer",{get:function(){var e=this;return this._operationalLayer||(this._operationalLayer=$.extend({},this._webMapFilter.operationalLayer,this._serviceLayerCommon,{layers:{item:function(){return e.layer}},featureCollection:this.featureCollection,layerDefinition:this.layerDefinition})),this._operationalLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderer",{get:function(){return this._webMapFilter.renderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"serviceLayer",{get:function(){return this._serviceLayer||(this._serviceLayer=$.extend({},this.operationalLayer,this.baseMapLayer)),this._serviceLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleRenderer",{get:function(){return this._webMapFilter.simpleRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uniqueValueRenderer",{get:function(){return this._webMapFilter.uniqueValueRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classBreaksRenderer",{get:function(){return this._webMapFilter.classBreaksRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"heatmapRenderer",{get:function(){return this._webMapFilter.heatmapRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"spatialReference",{get:function(){return this._webMapFilter.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"symbol",{get:function(){return this._webMapFilter.symbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleMarkerSymbol",{get:function(){return this._webMapFilter.simpleMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleLineSymbol",{get:function(){return this._webMapFilter.simpleLineSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleFillSymbol",{get:function(){return this._webMapFilter.simpleFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pictureMarkerSymbol",{get:function(){return this._webMapFilter.pictureMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pictureFillSymbol",{get:function(){return this._webMapFilter.pictureFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textSymbol",{get:function(){return this._webMapFilter.textSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"template",{get:function(){return this._webMapFilter.template},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"type",{get:function(){return this._webMapFilter.type},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_serviceLayerCommon",{get:function(){var e=this;return{layers:{item:function(){return e.layer}},gcxMapServiceDefinition:{id:!0,url:this._urlValidator,serviceUrl:this._urlValidator,serviceType:!0,serviceFunction:!0,displayName:this._xssHtmlValidator,shortDisplayName:!0,baseMapGroup:!0,baseMapGroupIndex:!0,baseMapGroupIsMutuallyExclusive:!0,description:!0,copyright:!0,hasAttributionData:!0,visible:!0,disableClientCaching:!0,opacity:this._numberValidator,instantSearch:!0,format:!0,isExpanded:!0,serverVersion:!0,failureAction:!0,tileMatrixSet:!0,requestEncoding:!0,operationalSpatialReference:!0,minScale:this._numberValidator,maxScale:this._numberValidator,identifiable:!0,includeCatalogItems:!0,includeMosaicDatasetValues:!0,defaultDateFormat:!0,defaultNumberFormat:!0,tileInfo:!0,includeInLayerList:!0,drawingBehavior:!0,featureClustering:{enabled:!0,userCanToggle:!0,radius:this._numberValidator,maximumFeatures:this._numberValidator,backgroundColor:this.color,labelColor:this.color},featureHeatMap:{enabled:!0,userCanToggle:!0,respectScaleRange:!0,gradient:!0,offset:{item:this._numberValidator},intensity:this._numberValidator,field:!0,defaultRenderer:this.renderer,defaultMinScale:this._numberValidator,defaultMaxScale:this._numberValidator,includeInLegend:!0},catalogId:this.object,layerOptions:!1,layerHyperlinks:!1,attributionDataUrl:!1}}},enumerable:!0,configurable:!0}),r}();i.ProjectFilter=r}(t.project||(t.project={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,t,i,r){var n=this;void 0===r&&(r=200);var a=-1,s=[],o=function(){for(var t=s.length-1;t>=0;t--){var i=s[t];e.event(i.eventName).unsubscribe(i.subscriptionToken),s.pop()}},l=function(){a=setTimeout(function(){a=null,o(),t()},r)};i.forEach(function(t){var i=e.event(t).subscribe(n,function(){null!==a&&(clearTimeout(a),l())});s.push({eventName:t,subscriptionToken:i})}),l()}e.debounceViewEvents=function(e,i,r){void 0===r&&(r=400),t(e,i,["ViewInitializedEvent","ViewActivatedEvent","ViewDeactivatedEvent","ViewDimensionsChangedEvent","ViewHostedEvent","ViewUnhostedEvent","ApplicationResizeEvent"],r)},e.debounceEvents=t}(e.ShellUtils||(e.ShellUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(e){this.app=e,this.nativeInitialized=!1,this._messageClient=new t.MessageClient(e)}return i.prototype.isNative=function(){return/\bGeocortexApp\b/.test(navigator.userAgent)},i.prototype.xhrGet=function(e){var t=this;return this.onNativeInitialized().then(function(){return t.appendAuthorizationHeader(e),dojo.xhrGet(e)})},i.prototype.xhrPost=function(e){var t=this;return this.onNativeInitialized().then(function(){return t.appendAuthorizationHeader(e),dojo.xhrPost(e)})},i.prototype.appendAuthorizationHeader=function(e){e||(e={}),e.headers||(e.headers={}),e.headers.Authorization||(e.headers.Authorization="Token "+this.app.localServerToken)},i.prototype.message=function(e,t,i,r){return this._messageClient.message(e,t,i,r)},i.prototype.onNativeInitialized=function(){var e=this;return this._nativeInitializedPromise?this._nativeInitializedPromise:(this._nativeInitializedPromise=new Promise(function(t,i){e._nativeInitializedResolve=t}),this._nativeInitializedPromise)},i.prototype.signalNativeInitialized=function(){this.onNativeInitialized(),this.nativeInitialized=!0,this._nativeInitializedResolve()},i.prototype.getViewerResourceInfo=function(e){var t=this.app.localServerAddress+"/resource/"+this.app.localServerNamespace+"/"+e+"/info";return this.xhrGet({url:t}).then(function(e){var t=JSON.parse(e);return{name:t.name,exists:t.exists,length:t.length,lastAccessTime:t.lastAccessTime?new Date(t.lastAccessTime):null,lastWriteTime:t.lastWriteTime?new Date(t.lastWriteTime):null}})},i.prototype.hasNativeCapability=function(t){var i=this;return new Promise(function(r,n){i._capabilities?r(i._capabilities.indexOf(t)>-1):/\bGeocortexApp\b/.test(navigator.userAgent)?e.GeocortexNativeApp.capabilities(function(e){i._capabilities=e,r(i._capabilities.indexOf(t)>-1)},function(e){r(!1)}):r(!1)})},i}();t.NativeManager=i}(t.nativeIntegration||(t.nativeIntegration={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){function t(t,i){if(!i)return Promise.reject("basemap cannot be null.");if(!i.filename)return Promise.reject("basemap.filename cannot be null.");switch(i.sourceType){case e.OfflineMapBasemap.Type.PREGENERATED:return t.nativeManager.message("RemoveResource",{fileName:i.filename});case e.OfflineMapBasemap.Type.EXPORT_TILES:return t.nativeManager.message("RemoveExportedTiles",{fileName:i.filename})}return null}e.deleteBasemaps=function(e,i){return Promise.all(i.map(function(i){return t(e,i)})).then(function(){return null})}}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(e,i,a,s,o){if(!a)throw new Error("basemap cannot be null.");if(!a.filename)throw new Error("basemap.filename cannot be null.");if(!a.url)throw new Error("basemap.url cannot be null.");switch(a.sourceType){case t.OfflineMapBasemap.Type.PREGENERATED:return r(e,a,s,o);case t.OfflineMapBasemap.Type.EXPORT_TILES:return n(e,i,a,s,o)}return null}function r(i,r,n,s){var o=i.makeAbsolute(r.url,i.site.url),l=i.site.getTokenFromPrincipal(o,e.essentials.Site)||i.site.getTokenFromPrincipal(o,esri.IdentityManagerBase);null!=l&&(o+=(-1===o.indexOf("?")?"?":"&")+"token="+l);var c={url:o,fileName:r.filename,overwrite:"OnNewer"};return i.nativeManager.message("DownloadResource",c,n,function(e){var n=e.details;switch(n.status){case a.connecting:s&&s({message:i.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-connecting").format(r.filename),percentage:0});break;case a.downloading:if(s){var o=Math.round(n.bytesDownloaded/n.bytesTotal*100),l=t.formatBytesString(i,n.bytesDownloaded),c=t.formatBytesString(i,n.bytesTotal),u=t.formatByteTransferRateString(i,n.bytesPerSecond);s({message:i.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-downloading").format(r.filename,l,c,o,u),percentage:o})}break;default:i.trace.error("Unknown ResourceDownloadEvent status "+n.status)}})}function n(e,i,r,n,s){var o=r.url,l=e.site.getTokenFromPrincipal(o,esri.IdentityManagerBase);null!=l&&(o+=(-1===o.indexOf("?")?"?":"&")+"token="+l);var c={url:o,fileName:r.filename,minLevel:r.minLevel,maxLevel:r.maxLevel,areaOfInterest:JSON.stringify({features:[{geometry:i.content.geometry}]}),refreshInterval:r.refreshInterval};return e.nativeManager.message("ExportTiles",c,n,function(i){var n=i.details;switch(n.status){case a.connecting:s&&s({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-connecting").format(r.filename),percentage:0});break;case a.processing:s&&s({message:n.message||e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-processing").format(r.filename),percentage:0});break;case a.downloading:if(s){var o=Math.round(n.bytesDownloaded/n.bytesTotal*100),l=t.formatBytesString(e,n.bytesDownloaded),c=t.formatBytesString(e,n.bytesTotal),u=t.formatByteTransferRateString(e,n.bytesPerSecond);s({message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapexport-downloading").format(r.filename,l,c,o,u),percentage:o})}break;default:e.trace.error("Unknown ResourceDownloadEvent status "+n.status)}})}t.downloadBasemaps=function(e,t,r,n){var a=0;return Promise.reduce(t.content.basemaps,function(s,o){if(r.isCancellationRequested)throw new Error("Operation cancelled.");return i(e,t,o,r,function(e){var i=(e.percentage+100*a)/t.content.basemaps.length;n&&n({message:e.message,percentage:i})}).catch(function(t){n&&n({isWarning:!0,message:e.getResource("Mapping.Infrastructure","language-offline-progress-basemapdownload-failed").format(o.filename,t.message||t),percentage:100})}).finally(function(){a++})},null)};var a={connecting:"Connecting",processing:"Processing",downloading:"Downloading"}}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){function i(e,t){return t.resources.push(c("__error_offline_no_endpoint",{error:{code:400,message:"This resource is not available offline.",details:[]}})),t.resources.push(c("__no_features",{objectIdFieldName:"OBJECTID",globalIdFieldName:"GlobalID",features:[]})),t.resources.push(c("__no_search_results",{count:0,features:[],ResponseStatus:{}})),t.resources.push(c("__no_data_links",{results:[]})),t.resources.push(c("__empty_attribution_response","")),null}function r(t,i){return new Promise(function(r,n){var a=h(t,t.app.site.url+"/map/layerlist");e.request({url:a,content:{f:"json"},load:function(e){i.resources.push(c("__layerlist_",e)),r(null)},error:function(e){t.app.trace.error("Error fetching '"+a+"': "+e.message),n(e)},callbackParamName:"Callback"})})}function n(t,i){return new Promise(function(r,n){var a=h(t,t.app.site.url);e.request({url:a,content:{f:"json",deep:t.app.site.deepInitialize},load:function(e){e&&e.principal&&(e.principal.isAuthenticated=!1,e.principal.label="Guest",e.principal.expiry=null,e.principal.identities=[],e.principal.tokens={arcgis:{},geocortex:{},site:null}),i.resources.push(c("__site_",e)),r(null)},error:function(e){t.app.trace.error("Error fetching '"+a+"'. "+e.message),n(e)},callbackParamName:"Callback"})})}function a(t,i){var r=[],n=t.app.site.essentialsMap.mapServices;t.app.site.overviewMap&&(n=n.concat(t.app.site.overviewMap.mapServices));var a=n.map(function(n){return-1!=r.indexOf(n.url)?null:(r.push(n.url),n.mapServiceType===e.essentials.MapServiceType.BING||n.mapServiceType===e.essentials.MapServiceType.WMS||n.mapServiceType===e.essentials.MapServiceType.WEBTILED?null:n.mapServiceType===e.essentials.MapServiceType.GEORSS||n.mapServiceType===e.essentials.MapServiceType.KML?l(t,i,n):n instanceof e.essentials.FeatureLayerService?s(t,i,n):o(t,i,n))});return Promise.all(a)}function s(e,t,i){var r=[],n=/^(.*)(\/[0-9]+\/?)$/.exec(i.serviceUrl)[1],a=null;return i.layers[0]?a=i.layers[0].relationships:i.serviceLayer&&(a=i.serviceLayer.relationships),a&&(r=r.concat(a.map(function(r){return new Promise(function(a,s){var o=n+"/"+r.relatedTableId,l={f:"json"},u=i.findServiceToken();u&&(l.token=u),esri.request({url:o,handleAs:"json",content:l,callbackParamName:"Callback"}).then(function(e){t.resources.push(c(d(o),e)),a(null)},function(t){e.app.trace.error("Error fetching '"+o+"'. "+t.message),s(t)})})}))),r.push(o(e,t,i)),Promise.all(r)}function o(e,t,i){return new Promise(function(r,n){var a=p(e,i),s={f:"json"},o=i.findServiceToken();o&&(s.token=o),esri.request({url:a,handleAs:"json",content:s,callbackParamName:"Callback"}).then(function(e){t.resources.push(c(d(a),e)),r(null)},function(t){e.app.trace.error("Error fetching '"+a+"'. "+t.message),n(t)})})}function l(e,t,i){return new Promise(function(r,n){var a=p(e,i);esri.request({url:a,handleAs:"xml",content:{},callbackParamName:"Callback"}).then(function(e){t.resources.push(u(d(a),(new XMLSerializer).serializeToString(e))),r(null)},function(t){e.app.trace.error("Error fetching '"+a+"'. "+t.message),n(t)})})}function c(e,t,i){return void 0===i&&(i=!1),u(e,JSON.stringify(t),i)}function u(t,i,r){return void 0===r&&(r=!1),{isEncoded:r,isJson:!0,key:t,value:r?e.framework.utils.base64Encode(i):i}}function p(e,t){var i=t.serviceUrl;return!i&&t.serviceLayer&&(i=t.serviceLayer.url),i&&(i=h(e,i)),i}function h(e,t){t=e.app.makeAbsolute(t);var i=document.createElement("a");i.href=t;var r=i.href,n=r.charAt(r.length-1);return"/"!==n&&"\\"!==n||(r=r.substr(0,r.length-1)),r}function d(e){var t=e,i=/^[a-z]+:\/\/(.*)/.exec(t);i&&(t=i[1]);var r=/^(services|server)\.arcgisonline\.(.*)/.exec(t);r&&(t="(services|server).arcgisonline."+r[2]),/^[^/]*virtualearth.net\//.exec(t)&&(t="[^/]*virtualearth.net/");var n=/^([a-zA-Z.]+):(80|443)(.*)/.exec(t);return n&&(t=n[1]+n[3]),t=t.replace(/\//g,"/+").replace(/\./g,"\\.")}t.buildBundle=function(e){var s={id:e.bundleId,timestamp:(new Date).getTime(),routingRules:t.buildRoutingRules(e),resources:[]},o=[i(0,s),n(e,s),r(e,s),a(e,s)];return Promise.all(o).then(function(){return s})},t.cleanUpMapServiceUrl=p,t.cleanUpRestUrl=h,t.urlToPattern=d}(t.bundle||(t.bundle={}))}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(){function i(e,i){var r=this;this.app=e,this.libraryId=i,this._router=new t.OfflineRouter(this.app),this._esriRequestHacker=new t.EsriRequestHacker(e,function(e,t){return r._router.handle(e,t)}),this._esriLayerHacker=new t.EsriLayerHacker(e,function(e){return r._router.rewriteUrl(e)}),this._esriLayerHacker.errorReporter=function(e){return r.app.trace.warning(e)},this._serveResourceHandler=new t.offlineHandlers.ServeResourceHandler(this.app,function(e){return r._appStoreGetPromise(e)},function(e,t){return r._appStoreSetPromise(e,t)},function(e){return r._appStoreRemovePromise(e)});var n=new t.offlineHandlers.PassthroughHandler(this.app,function(e,t){return r._esriRequestHacker.unhackedRequest(e,t)});this._router.setDefaultHandler(n),this._router.addHandler(n),this._router.addHandler(this._serveResourceHandler),this._router.addHandler(new t.offlineHandlers.FailHandler),this._router.addHandler(new t.offlineHandlers.RewriteHandler(this.app,function(e,t){return r._esriRequestHacker.unhackedRequest(e,t)})),this._router.addHandler(new t.offlineHandlers.SiteHandler(this.app,function(e){return r._serveResourceHandler.getResourceValue(e)},function(e,t){return r._esriRequestHacker.unhackedRequest(e,t)})),this.app.event("ApplicationStorageClearedEvent").subscribe(this,function(){r._serveResourceHandler.clear(),r._router.clearRoutingRules()})}return i.prototype.createBundle=function(e,t){var i=this;return this._buildBundle(e,t).then(function(e){return i._storeBundle(e)}).then(function(e){})},i.prototype.deleteBundle=function(e){var t=this;return this._getBundle(e).then(function(e){return e?t._serveResourceHandler.unstoreBundle(e):null}).then(function(e){return e?t._appStoreRemovePromise(t._getBundleKey(e)):null}).then(function(){})},i.prototype.updateBundle=function(e,t){var i=this;return this._buildBundle(e,t).then(function(t){return i.deleteBundle(e).catch(function(e){return i.app.trace.warning("Unable to delete old bundle before replacing it. "+(e.message||e)+" Attempting to continue."),null}).then(function(){return t})}).then(function(e){return i._storeBundle(e)}).then(function(e){return i._router.setRoutingRules(e.routingRules)}).then(function(){})},i.prototype.loadBundle=function(e){var t=this;return e?this._getBundle(e).then(function(e){if(!e)throw new Error(t.getResource("language-offline-errors-bundlenotfound"));t._serveResourceHandler.loadBundle(e),t._router.setRoutingRules(e.routingRules)}):Promise.reject(new Error("Bundle ID cannot be null."))},i.prototype.unloadBundle=function(){return this._serveResourceHandler.clear(),this._router.clearRoutingRules(),Promise.resolve()},i.prototype._buildBundle=function(i,r){var n=this;return e.SyncEngine.getSyncInfo(this.app,i).then(function(e){var a={app:n.app,bundleId:i,basemaps:r,featureLayerSyncInfo:e};return n._esriRequestHacker.disable(),t.buildBundle(a).finally(function(){n._esriRequestHacker.enable()})})},i.prototype._storeBundle=function(e){var t=this;return null==e?Promise.reject(new Error("Bundle is null.")):null==e.id?Promise.reject(new Error("Bundle ID is null.")):this._serveResourceHandler.stripAndStoreBundle(e).then(function(){return t._appStoreSetPromise(t._getBundleKey(e),JSON.stringify(e)),e},function(i){throw t.app.trace.warning("Failed to save offline bundle '"+e.id+"'. "+(i.message||i)),22==i.code&&window.localStorage&&window.localStorage.remainingSpace&&t.app.trace.warning("Local storage has "+window.localStorage.remainingSpace+" bytes remaining."),i})},i.prototype._getBundle=function(e){return e?this._appStoreGetPromise(this._getBundleKey(e)).then(function(e){return e?JSON.parse(e):null}):Promise.reject(new Error("Bundle ID is null."))},i.prototype._getBundleKey=function(e){return"__bundle-"+("string"==typeof e?e:e.id)},i.prototype._appStoreGetPromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.get(e,i,r)})},i.prototype._appStoreSetPromise=function(e,t){var i=this;return new Promise(function(r,n){return i.app.store.set(e,t,function(){return r()},n)})},i.prototype._appStoreRemovePromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.remove(e,function(){return i()},r)})},i.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},i}();t.BundleManager=i}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e){e?dojo.safeMixin(this,e):this.key=""}}();e.BundleResourceEntry=t}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.urlRewriter=t,this.errorReporter=function(e){},this._captureHooks(),this._extendEsriLayers()}return e.prototype._captureHooks=function(){this._hooked_esri_getTileUrl=esri.layers.ArcGISTiledMapServiceLayer._meta.hidden.getTileUrl,this._hooked_ogc_getWMTSTileUrl=esri.layers.WMTSLayer._meta.hidden.getTileUrl,this._ogc__tileLoadHandler=esri.layers.WMTSLayer.superclass._tileLoadHandler,this._hooked_BingMaps_getTileUrl=esri.virtualearth.VETiledLayer._meta.hidden.getTileUrl,this._bingMaps__tileLoadHandler=esri.virtualearth.VETiledLayer.superclass._tileLoadHandler,this._hooked_WebTiledLayer_getTileUrl=esri.layers.WebTiledLayer._meta.hidden.getTileUrl,this._webTiledLayer__tileLoadHandler=esri.layers.WebTiledLayer.superclass._tileLoadHandler,this._hooked_esri_getImageUrl=esri.layers.ArcGISDynamicMapServiceLayer._meta.hidden.getImageUrl,this._hooked_ogc_getImageUrl=esri.layers.WMSLayer._meta.hidden.getImageUrl},e.prototype._extendEsriLayers=function(){var e=this;esri.virtualearth.VETiledLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_BingMaps_getTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n},_tileLoadHandler:function(t){e._bingMaps__tileLoadHandler.apply(this,[t])}}),esri.layers.WMTSLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_ogc_getWMTSTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n},_tileLoadHandler:function(t){e._ogc__tileLoadHandler.apply(this,[t])}}),esri.layers.WebTiledLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_WebTiledLayer_getTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n},_tileLoadHandler:function(t){e._webTiledLayer__tileLoadHandler.apply(this,[t])}}),esri.layers.ArcGISTiledMapServiceLayer.extend({getTileUrl:function(t,i,r){var n=e._hooked_esri_getTileUrl.apply(this,[t,i,r]);return e.app.offlineManager.isOfflineMapActive.get()?e.urlRewriter(n)||n:n}}),esri.layers.WMSLayer.extend({getImageUrl:function(t,i,r,n){if(!e.app.offlineManager.isOfflineMapActive.get())return i&&r||e.errorReporter("Invalid dimensions on requested map image. This is usually due to an invalid map resize event."),void e._hooked_ogc_getImageUrl.apply(this,arguments);e._hooked_ogc_getImageUrl.apply(this,[t,i,r,function(t){var i=e.urlRewriter(t)||t;n&&n(i)}])}}),esri.layers.ArcGISDynamicMapServiceLayer.extend({getImageUrl:function(t,i,r,n){if(!e.app.offlineManager.isOfflineMapActive.get())return i&&r||e.errorReporter("Invalid dimensions on requested map image. This is usually due to an invalid map resize event."),void e._hooked_esri_getImageUrl.apply(this,arguments);e._hooked_esri_getImageUrl.apply(this,[t,i,r,function(t){var i=e.urlRewriter(t)||t;n&&n(i)}])}})},e}();e.EsriLayerHacker=t}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.requestHandler=t,this._isEnabled=!0,this._setupEsriRequestHooks()}return e.prototype.unhackedRequest=function(e,t){return this._hooked_esri_request.call(esri,e,t)},e.prototype.disable=function(){this._isEnabled=!1},e.prototype.enable=function(){this._isEnabled=!0},e.prototype._setupEsriRequestHooks=function(){var e=this;if(esri.request){this._hooked_esri_request=esri.request,esri.request=function(t,i){return e.app.offlineManager.getActiveOfflineMap()&&e._isEnabled?e.requestHandler(t,i):e._hooked_esri_request.call(esri,t,i)};var t=null;esri.request.setRequestPreCallback=function(e){t=e},this._hooked_esri_request.setRequestPreCallback(function(e){return/GeocortexApp/.test(navigator.userAgent)&&/^https:\/\/(localhost|127\.0\.0\.1)(:\d+)?\//.test(e.url)&&(e.url="http"+e.url.substring(5)),t&&(e=t(e)),e})}else this.app.trace.error("Offline module could not hook into ESRI API.")},e}();e.EsriRequestHacker=t}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.unhackedRequesthandler=t,this.name="Passthrough"}return e.prototype.handle=function(e,t,i){return this.unhackedRequesthandler(e,e.options).then(function(t){return e.dfd.resolve(t)},function(t){return e.dfd.errback(t)}),!0},e}();e.PassthroughHandler=t}(e.offlineHandlers||(e.offlineHandlers={}))}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){this.name="Fail"}return t.prototype.handle=function(t,i,r){return t.dfd.reject(),e.hookDeferredCallbacks(t),!0},t}();e.FailHandler=t}(e.offlineHandlers||(e.offlineHandlers={}))}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.hookDeferredCallbacks=function(e){var t=e.dfd,i=e.load;i&&t.addCallback(function(e){var r=t._pendingDfd,n=r&&r.ioArgs,a=n&&n.args;return i.call(a,e,n)});var r=e.error;r&&t.addErrback(function(e){var i=t._pendingDfd,n=i&&i.ioArgs,a=n&&n.args;return r.call(a,e,n)})}}(e.offlineHandlers||(e.offlineHandlers={}))}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.unhackedRequesthandler=t,this.name="Rewrite"}return e.prototype.handle=function(e,t,i){return e.url=this.rewriteRequest(e,t,i),!require.has("esri-cors")&&Modernizr.cors&&(delete require.has.cache["esri-cors"],require.has.add("esri-cors",function(){return!0})),this.unhackedRequesthandler(e,e.options).then(function(t){return e.dfd.resolve(t)},function(t){return e.dfd.errback(t)}),!0},e.prototype.rewriteRequest=function(e,t,i){if(!t||!t.parameters||!t.parameters.newUrl)throw new Error("Not a rewrite rule.");var r=t.parameters.newUrl;return r=r.format.apply(r,i),r=r.replace("{localserver}",this.app.localServerAddress),this.app.localServerAddress&&this.app.localServerAddress.length>0&&r.startsWith(this.app.localServerAddress)&&(r=this._appendLocalServerToken(r)),r},e.prototype._appendLocalServerToken=function(e){return this.app.localServerToken&&(e.endsWith("?")||(e+=e.indexOf("?")>0?"&":"?"),e+="localServerToken="+this.app.localServerToken),e},e}();e.RewriteHandler=t}(e.offlineHandlers||(e.offlineHandlers={}))}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(e,t,i,r){this.app=e,this.resourceGetter=t,this.resourceSetter=i,this.resourceRemover=r,this.name="ServeResource",this.isReady=new Observable(!1)}return i.prototype.handle=function(e,i,r){var n=this;if(!this._bundle||!i.parameters||!i.parameters.key)return!1;var a=i.parameters.key;a=a.format.apply(a,r);for(var s=0,o=this._bundle.resources.length;s<o;s++)if(this._bundle.resources[s].key===a)return t.hookDeferredCallbacks(e),this._getResourceValue(this._bundle.resources[s]).then(function(t){e.dfd.resolve(t)}).catch(function(t){n.app.trace.error(t.message),e.dfd.reject(t.message)}),!0;return!1},i.prototype.loadBundle=function(e){this.isReady.set(!0),this._bundle=e},i.prototype.clear=function(){this.isReady.set(!1),this._bundle=null},i.prototype.stripAndStoreBundle=function(e){var t=this;if(!e)return Promise.reject(new Error("Bundle cannot be null."));var r=e.resources.map(function(r){return null==r.value?Promise.reject(new Error("Bundle resoure entry value is already null: "+r.key)):r.value&&r.value.length>i._resourceCachingLength?t.resourceSetter(i._getResourceStorageKey(e,r),r.value).then(function(){r.value=null},function(e){t.app.trace.error("Unable to strip '"+r.key+"' out of the bundle and store it separately. "+e)}):null});return Promise.all(r).then(function(){return e})},i.prototype.unstoreBundle=function(e){var t=this;if(!e)return Promise.reject(new Error("Bundle cannot be null."));var r=e.resources.map(function(r){return null==r.value?t.resourceRemover(i._getResourceStorageKey(e,r)):null});return Promise.all(r).then(function(){return e})},i.prototype.getResourceValue=function(e){for(var t=0,i=this._bundle.resources.length;t<i;t++)if(this._bundle.resources[t].key===e)return this._getResourceValue(this._bundle.resources[t]);return Promise.reject(new Error("No such entry found."))},i.prototype._getResourceValue=function(t){var r=this;return Promise.resolve(t.value).then(function(e){return null==e?r.resourceGetter(i._getResourceStorageKey(r._bundle,t)):e}).then(function(e){if(!e)throw new Error("Resource entry missing for: "+t.key);return e}).then(function(i){return!0===t.isEncoded&&(i=e.framework.utils.base64Decode(i)),!0===t.isJson&&(i=JSON.parse(i)),i})},i._getResourceStorageKey=function(e,t){return e.id+"-"+t.key},i._resourceCachingLength=200,i}();t.ServeResourceHandler=i}(t.offlineHandlers||(t.offlineHandlers={}))}(t.bundle||(t.bundle={}))}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(){function i(e,t,i){this.app=e,this.siteJsonGetter=t,this.unhackedRequesthandler=i,this.name="Site"}return i.prototype.handle=function(e,i,r){var n=this;return t.hookDeferredCallbacks(e),this.siteJsonGetter(i.parameters.key).then(function(t){return n._hasToken(e)?n._getOnlineSitePrincipal(e).then(function(e){return t.principal=e,t},function(e){return n._getGmafPrincipal(t.principal).then(function(e){return t.principal=e,t},function(e){return t})}):t}).then(function(t){e.dfd.resolve(t)},function(t){e.dfd.errback(t)}),!0},i.prototype._hasToken=function(e){return/[?&]token=/.test(e.url)||e.content&&e.content.token},i.prototype._getOnlineSitePrincipal=function(t){var i=this,r=new e.RequestContext({callbackParamName:t.callbackParamName,content:t.content,form:t.form,handleAs:t.handleAs,timeOut:1e4,url:t.url},null,t.options);return new Promise(function(e,t){return i.unhackedRequesthandler(r,r.options).then(e,t)}).then(function(e){if(!e||e.error||!e.principal)throw new Error("Site JSON looks malformed.");return e.principal})},i.prototype._getGmafPrincipal=function(e){return this.app.nativeManager.nativeInitialized?this.app.nativeManager.xhrGet({url:this.app.localServerAddress+"/account/userinfo",handleAs:"json"}).then(function(t){if(!t||!t.token)throw new Error("GMAF has no login info.");return dojo.mixin(e,{isAuthenticated:!0,label:t.userName,expiry:(new Date).toISOString(),tokens:{site:t.token}})}):Promise.reject(new Error("Not a native app."))},i}();t.SiteHandler=i}(e.offlineHandlers||(e.offlineHandlers={}))}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(e){var t=this;this.app=e,this.isReady=new Observable(!1),this._handlers={},this._rules=[],this.app.command("RewriteUrlForOffline").register(this,function(e,i){i(t.rewriteUrl(e))})}return t.prototype.addHandler=function(e){this._handlers[e.name]=e},t.prototype.removeHandler=function(e){return!!this._handlers.hasOwnProperty(e)&&(delete this._handlers[e],!0)},t.prototype.setDefaultHandler=function(e){this._defaultHandler=e},t.prototype.setRoutingRules=function(e){this._rules=e.concat(),this.isReady.set(!0)},t.prototype.setRoutingRulesFromPromise=function(e){var t=this;this._rules.length=0,this.isReady.set(!1),e.then(function(e){if(e)try{t.setRoutingRules(JSON.parse(e))}catch(e){t.app.trace.error("Unable to parse routing rules: {0}".format(e))}else t.app.trace.debug("No offline request routing table was found.")},function(e){t.app.trace.warning("An error occurred while attempting to fetch offline request routing rules: {0}".format(e))})},t.prototype.clearRoutingRules=function(){this._rules.length=0,this.isReady.set(!1)},t.prototype.rewriteUrl=function(e){var t=this._handlers.Rewrite;if(!t)return e;e=this._stripOutProxy(e);for(var i=0;i<this._rules.length;++i){var r=this._rules[i];if("Rewrite"===r.handlerName){var n=new RegExp(r.pattern).exec(e);if(n&&n.length&&n.length>0)return t.rewriteRequest(null,r,n)}}return null},t.prototype.handle=function(t,i){var r=this,n=new dojo.Deferred;return this._whenReady(function(){for(var a=new e.RequestContext(t,n,i),s=r._stripOutProxy(a.url),o=!1,l=0;l<r._rules.length;++l){var c=r._rules[l],u=new RegExp(c.pattern).exec(s),p=!0;if(u&&c.queryParameterPatterns)for(var h in c.queryParameterPatterns){var d=c.queryParameterPatterns[h],m=t.content?t.content[h]:null,g=new RegExp(d.pattern).exec(m);p=p&&!!g}if(u&&u.length&&u.length>0&&p){var f=r._handlers[c.handlerName];if(f){o=!0;try{if(!1===f.handle(a,c,u)){o=!1;continue}break}catch(e){r.app.trace.warning("Offline request failed for resource '"+t.url+"'. "+e),n.errback(new Error("Offline request failed"));break}}else r.app.trace.warning("Offline request failed for resource '"+t.url+"'. Matching rule found without handler.")}}o||r._defaultHandler.handle(a,null,null)}),n},t.prototype._whenReady=function(e){this.isReady.get()?e():this.isReady.once(this,e)},t.prototype._stripOutProxy=function(e){if(!e)return null;var t=this.app.configuration.proxyUri;return e.indexOf(t)>=0?e.replace?e.replace(t,""):null:e},t}();e.OfflineRouter=t}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t,i){this.options=null,this.content=null,this.handleAs=null,this.timeOut=null,this.url=null,e&&dojo.mixin(this,e),this.dfd=t||new dojo.Deferred,this.options=i||null}}();e.RequestContext=t}(e.bundle||(e.bundle={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){function i(e){return[{handlerName:"Rewrite",pattern:e,parameters:{newUrl:"Resources/Images/blank-tile.png"}}]}function r(e,t,i){var r=[],n=-1!==t.serviceLayer.url.indexOf("?")?t.serviceLayer.url.substr(0,t.serviceLayer.url.indexOf("?")):t.serviceLayer.url;n=n.toLowerCase();var a=i.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(t){return e.featureServiceUrl.toLowerCase()===n})[0]})[0];return a?r.push({handlerName:"Rewrite",pattern:e+"/+(.+)",parameters:{newUrl:a.localServerUrl.replace("FeatureServer","MapServer")+"/{1}"}}):r=r.concat(l(e)),r}function n(e){return e=decodeURI(e).replace(/%24/g,"$"),[{handlerName:"Rewrite",pattern:e.replace(/\$?{subDomain}/gi,"(?:.*)").replace(/\$?{level}/gi,"[0-9]*").replace(/\$?{row}/gi,"[0-9]*").replace(/\$?{col}/gi,"[0-9]*"),parameters:{newUrl:"Resources/Images/blank-tile.png"}}]}function a(e,t,i){var r=[],n=/^(.*)(\/\+?[0-9]+\/?\+?)$/.exec(e)[1],a=/^(.*)\/([0-9]+\/?)$/.exec(t.serviceUrl),o=a[1],l=parseInt(a[2]);r.push({handlerName:"ServeResource",pattern:n+"/*$",parameters:{key:n}});var u=-1!==t.serviceLayer.url.indexOf("?")?t.serviceLayer.url.substr(0,t.serviceLayer.url.indexOf("?")):t.serviceLayer.url;u=u.toLowerCase();var p=i.featureLayerSyncInfo.servers.filter(function(e){return!!e.layers.filter(function(t){return(e.featureServiceUrl+"/"+t.id).toLowerCase()===u})[0]})[0];p?r.push({handlerName:"Rewrite",pattern:e+"/+(.+)",parameters:{newUrl:p.localServerUrl+"/"+l+"/{1}"}}):r=r.concat(c(n,l));var h=t.serviceLayer.relationships.map(function(e){return s(n,o,p?p.localServerUrl:null,e,i)});return r=r.concat.apply(r,h)}function s(e,t,i,r,n){var a=[{handlerName:"ServeResource",pattern:e+"/+"+r.relatedTableId+"/*$",parameters:{key:e+"/+"+r.relatedTableId}}];return i&&n.featureLayerSyncInfo.servers.filter(function(e){return e.featureServiceUrl===t}).some(function(e){return e.layers&&e.layers.some(function(e){return e.id===r.relatedTableId})})?a.push({handlerName:"Rewrite",pattern:e+"/+"+r.relatedTableId+"/+(.+)",parameters:{newUrl:i+"/"+r.relatedTableId+"/{1}"}}):a=a.concat(c(e,r.relatedTableId)),a}function o(e,t,r){var n=r.basemaps.filter(function(e){return e.url===t.url||e.url===t.serviceUrl})[0];if(n){var a=u(e);return[{handlerName:"Rewrite",pattern:e+"/+tile/+([0-9]*)/+([0-9]*)/+([0-9]*)",parameters:{newUrl:"{localserver}/"+n.localServicePath+"/{{{0}}}/{{{1}}}/{{{2}}}".format(a+1,a+2,a+3)}}].concat(l(e))}return i(e+"/+(tile|tilemap)").concat(l(e))}function l(e){return[{handlerName:"ServeResource",pattern:e+"/+([^/]*/+)?(query|queryRelatedRecords|identify|find)",parameters:{key:"__no_features"}}]}function c(e,t){return[{handlerName:"ServeResource",pattern:e+"/+"+t+"/+(query|queryRelatedRecords|applyEdits)",parameters:{key:"__no_features"}}]}function u(e){var t;if(e instanceof RegExp){var i=e.toString();i=i.substring(1,i.length-2),t=new RegExp(i+"|")}else t=new RegExp(e.toString()+"|");return t.exec("").length-1}t.buildRoutingRules=function(s){var c=[{handlerName:"Rewrite",pattern:"/arcgis/+rest/+services/+Utilities/+Geometry/+GeometryServer/+(.*)",parameters:{newUrl:"{localserver}/GeometryServer/{1}"}},{handlerName:"ServeResource",pattern:"/map/+layerlist$",parameters:{key:"__layerlist_"}},{handlerName:"ServeResource",pattern:"/search$",parameters:{key:"__no_search_results"}},{handlerName:"Site",pattern:t.urlToPattern(s.app.site.originalUrl)+"/*$",parameters:{key:"__site_"}}],u=[],p=s.app.site.essentialsMap.mapServices;return s.app.site.overviewMap&&(p=p.concat(s.app.site.overviewMap.mapServices)),p.forEach(function(p){if(-1===u.indexOf(p.url)){u.push(p.url);var h=p.serviceLayer&&p.serviceLayer.attributionDataUrl||p.attributionDataUrl;h&&c.push({handlerName:"ServeResource",pattern:t.urlToPattern(h),parameters:{key:"__empty_attribution_response"}});var d=t.urlToPattern(t.cleanUpMapServiceUrl(s,p));p.mapServiceType!==e.essentials.MapServiceType.BING&&p.mapServiceType!==e.essentials.MapServiceType.WMS?p.mapServiceType!==e.essentials.MapServiceType.WMTS&&p.mapServiceType!==e.essentials.MapServiceType.WEBTILED?(c=p instanceof e.essentials.FeatureLayerService?c.concat(a(d,p,s)):c.concat(r(d,p,s)),p.mapServiceType===e.essentials.MapServiceType.TILED&&(c=c.concat(o(d,p,s))),p.mapServiceFunction===e.essentials.MapServiceFunction.BASE||p instanceof e.essentials.FeatureLayerService||(c=c.concat(l(d))),c.push({handlerName:"ServeResource",pattern:d+"/*$",parameters:{key:d}})):c=c.concat(n(d)):c=c.concat(i(d))}}),c.push({handlerName:"ServeResource",pattern:"/+map/+mapservices/+[0-9]+/+layers/+[0-9]+/+datalinks/+[^/]+/+link$",parameters:{key:"__no_data_links"}}),c}}(t.bundle||(t.bundle={}))}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(){function i(e,t){this.app=e,this._enabled=!0,this.matchMapBackground=!1,this.fillColor=null,this.boundaryColor=new esri.Color("red"),this.boundaryWidth=2,this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.layerId="AreaOfInterestMask"}return i.prototype.show=function(e){var i=this;this._aoi=e,this.app.waitUntilSiteServiceLayersLoaded().then(function(){if(i._enabled){var r=i._getLayer();if(r.clear(),(i.fillColor||i.boundaryStyle!==esri.symbol.SimpleFillSymbol.STYLE_NULL)&&r.show(),i.fillColor){for(var n=new esri.geometry.Polygon(e.spatialReference),a=i.app.map.getLayer(i.app.map.layerIds[0]),s=t.GeometryUtils.toRing(a.fullExtent.expand(1.5)),o=0;o<e.rings.length;o++){var l=e.rings[o];n.rings.push(dojo.clone(l).reverse())}n.rings.push(s);var c=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL),i.fillColor),u=new esri.Graphic({geometry:n});u.setSymbol(c),i.app.map.graphics.add(u)}if(i.boundaryStyle!==esri.symbol.SimpleFillSymbol.STYLE_NULL){var p=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL,new esri.symbol.SimpleLineSymbol(i.boundaryStyle,i.boundaryColor,i.boundaryWidth),new esri.Color("white")),h=new esri.Graphic({geometry:e});h.setSymbol(p),r.add(h)}if(i.matchMapBackground&&i.fillColor){var d=i._getMapNode();i._originalMapBackground=d.css("background-color"),d.css("background-color","rgba("+i.fillColor.r+","+i.fillColor.g+","+i.fillColor.b+","+i.fillColor.a+")")}}})},i.prototype.hide=function(){this._aoi=null;var e=this.app.map.getLayer(this.layerId);e&&this.app.map.removeLayer(e),this.matchMapBackground&&this._getMapNode().css("background-color",this._originalMapBackground)},i.prototype.enable=function(){this._enabled=!0,this._aoi&&this.show(this._aoi)},i.prototype.disable=function(){this._enabled=!1},i.prototype.configure=function(t){t&&(e.framework.utils.isNullOrUndefined(t.boundaryColor)||(this.boundaryColor=new esri.Color(t.boundaryColor)),e.framework.utils.isNullOrUndefined(t.boundaryWidth)||(this.boundaryWidth=t.boundaryWidth),e.framework.utils.isNullOrUndefined(t.boundaryStyle)||("null"==t.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_NULL:"solid"==t.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_SOLID:"dash"==t.boundaryStyle?this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_DASH:"dot"==t.boundaryStyle&&(this.boundaryStyle=esri.symbol.SimpleLineSymbol.STYLE_DOT)),e.framework.utils.isNullOrUndefined(t.enabled)||(t.enabled?this.enable():this.disable()),e.framework.utils.isNullOrUndefined(t.fillColor)||(this.fillColor=new esri.Color(t.fillColor)),e.framework.utils.isNullOrUndefined(t.layerId)||(this.layerId=t.layerId),e.framework.utils.isNullOrUndefined(t.matchMapBackground)||(this.matchMapBackground=t.matchMapBackground))},i.prototype._getLayer=function(){var e=this.app.map.getLayer(this.layerId);return e||(e=new esri.layers.GraphicsLayer({id:this.layerId}),this.app.map.addLayer(e)),e},i.prototype._getMapNode=function(){return $(".esriMapContainer").first().parent()},i}();t.AreaOfInterestMask=i}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function r(e,r){this.app=e,this.libraryId=r,this._activeOfflineMapId=null,this._previousActiveOfflineMapId=null,this._offlineMaps=[],this.canCancel=new Observable(!1),this.isOfflineMapActive=new Observable(!1),this._bundleManager=new i.bundle.BundleManager(e,r),this.aoiMask=new t.AreaOfInterestMask(e,{enabled:!1})}return r.prototype.addOfflineMap=function(e,r){var n=this;return this._lastOperation=this._waitForLast().finally(function(){i.OfflineMap.verify(e),n._throwIfNotNativeInitialized(),n.canCancel.set(!0),n._cancellationTokenSource=new t.CancellationTokenSource,r||(r=function(){});var a=i.WorkCalculator.calculateFirstDownloadWork(e),s=i.WorkCalculator.noWork(),o=function(){return i.WorkCalculator.calculatePercentageComplete(s,a)};return Promise.resolve(n.app.site.updateServiceTokensIfStale()).then(function(){return n._appStoreSetPromise(n._getOfflineMapKey(e),JSON.stringify(e))}).then(function(){return r({message:n.getResource("language-offline-progress-savingofflinemap"),percentage:o()}),n._offlineMaps.push(e),n._save()}).then(function(){n._throwIfCanceled(),s.saveProfileWork=a.saveProfileWork,r({message:n.getResource("language-offline-progress-starting-sync"),percentage:o()});var t=i.SyncParameters.buildSyncParameters(n.app,e);return i.SyncEngine.sync(n.app,t,n._cancellationTokenSource.token(),function(e){s.featureLayerWork=e.overallProgress/100*a.featureLayerWork,r({message:e.text,percentage:o()})})}).then(function(){return n._throwIfCanceled(),s.featureLayerWork=a.featureLayerWork,r({message:n.getResource("language-offline-progress-starting-basemap-download"),percentage:o()}),i.downloadBasemaps(n.app,e,n._cancellationTokenSource.token(),function(e){s.basemapWork=e.percentage/100*a.basemapWork,r({message:e.message,percentage:o(),isWarning:e.isWarning})})}).then(function(){return n._throwIfCanceled(),s.basemapWork=a.basemapWork,r({message:n.getResource("language-offline-progress-downloadingsite"),percentage:o()}),n._bundleManager.createBundle(e.id,n._getOfflineMapBasemapMapping(e))}).then(function(){n._throwIfCanceled(),s.bundleWork=a.bundleWork,r({message:n.getResource("language-offline-progress-complete"),percentage:o()}),n.app.event("OfflineMapAddedEvent").publish({offlineMap:e})}).catch(function(t){throw n._removeOfflineMapNow(e,function(){}),new Error(t)}).finally(function(){n._cancellationTokenSource.dispose(),n._cancellationTokenSource=null,n.canCancel.set(!1)})})},r.prototype.removeOfflineMap=function(e,t){var i=this;return this._lastOperation=this._waitForLast().finally(function(){return i._removeOfflineMapNow(e,t)})},r.prototype._removeOfflineMapNow=function(e,t){var r=this;if(!e)throw new Error(this.getResource("language-offline-errors-offlinemapnull"));this._throwIfNotNativeInitialized();var n=this._getOfflineMapIx(e);if(-1===n)throw new Error(this.getResource("language-offline-errors-notfound"));if(this._offlineMaps[n].id===this._activeOfflineMapId)throw new Error(this.getResource("language-offline-errors-isactive"));return i.SyncEngine.deleteData(this.app,this._offlineMaps[n].id).catch(function(e){r.app.trace.error("Error deleting feature data: "+e)}).then(function(){return t&&t(r.getResource("language-offline-progress-unregisteringreplica")),r._bundleManager.deleteBundle(r._offlineMaps[n].id)}).catch(function(e){r.app.trace.error("Error deleting bundle: "+e)}).then(function(){t&&t(r.getResource("language-offline-progress-removingofflinemap"));var a=r._offlineMaps[n].content.basemaps.filter(function(e){return e.sourceType===i.OfflineMapBasemap.Type.EXPORT_TILES});return i.deleteBasemaps(r.app,a).then(null,function(e){r.app.trace.error("Error deleting offline map. "+e)}),r._appStoreRemovePromise(r._getOfflineMapKey(e))}).catch(function(e){r.app.trace.error("Error deleting offline map. "+e)}).then(function(){return r._offlineMaps[n].id===r._previousActiveOfflineMapId&&(r._previousActiveOfflineMapId=null),r._offlineMaps.splice(n,1),r._save()}).finally(function(){r.app.event("OfflineMapRemovedEvent").publish({offlineMap:e})})},r.prototype.syncOfflineMap=function(e,r){var n=this;return this._lastOperation=this._waitForLast().finally(function(){if(!e)throw new Error(n.getResource("language-offline-errors-offlinemapnull"));var a=n._getOfflineMapIx(e);if(-1===a)throw new Error(n.getResource("language-offline-errors-notfound"));n._throwIfNotNativeInitialized(),("string"==typeof e||e instanceof String)&&(e=n._offlineMaps[a]);var s=null;e!==n._offlineMaps[a]&&(s=i.OfflineMap.diff(n._offlineMaps[a],e)),n.canCancel.set(!0),n._cancellationTokenSource=new t.CancellationTokenSource;var o=i.WorkCalculator.calculateSyncWork(e),l=i.WorkCalculator.noWork(),c=function(){return i.WorkCalculator.calculatePercentageComplete(l,o)};return Promise.resolve(n.app.site.updateServiceTokensIfStale()).then(function(){var t=i.SyncParameters.buildSyncParameters(n.app,e);return i.SyncEngine.sync(n.app,t,n._cancellationTokenSource.token(),function(e){l.featureLayerWork=e.overallProgress/100*o.featureLayerWork,r({message:e.text,percentage:c()})})}).then(function(){n._throwIfCanceled(),l.featureLayerWork=o.featureLayerWork;var e=[];return s&&s.content&&s.content.geometry?e=n._offlineMaps[a].content.basemaps.filter(function(e){return e.sourceType===i.OfflineMapBasemap.Type.EXPORT_TILES}):s&&s.content&&s.content.basemaps&&(e=n._offlineMaps[a].content.basemaps.filter(function(e){return e.sourceType===i.OfflineMapBasemap.Type.EXPORT_TILES}).filter(function(e){return!s.content.basemaps.some(function(t){return t.baseMapId===e.baseMapId&&t.sourceType===e.sourceType&&t.url===e.url&&t.minLevel===e.minLevel&&t.maxLevel===e.maxLevel})})),e.length>0?i.deleteBasemaps(n.app,e):null}).then(function(){return n._throwIfCanceled(),r({message:n.getResource("language-offline-progress-starting-basemap-download"),percentage:c()}),i.downloadBasemaps(n.app,e,n._cancellationTokenSource.token(),function(e){l.basemapWork=e.percentage/100*o.basemapWork,r({message:e.message,percentage:c(),isWarning:e.isWarning})})}).then(function(){return n._throwIfCanceled(),n.canCancel.set(!1),l.basemapWork=o.basemapWork,r({message:n.getResource("language-offline-progress-downloadingsite"),percentage:c()}),n._bundleManager.updateBundle(e.id,n._getOfflineMapBasemapMapping(e))}).then(function(){return s?(r({message:n.getResource("language-offline-progress-savingofflinemap"),percentage:c()}),n._appStoreSetPromise(n._getOfflineMapKey(e),JSON.stringify(e))):null}).then(function(){return s?(n._offlineMaps.splice(a,1,e),n._save()):null}).then(function(){l.bundleWork=o.bundleWork,r({message:n.getResource("language-offline-progress-complete"),percentage:c()}),n._offlineMaps[a]=e,n.aoiMask.show(new esri.geometry.Polygon(n._offlineMaps[a].content.geometry)),n.app.site.essentialsMap.mapServices.forEach(function(e){return e.refresh()}),n.app.event("OfflineMapSyncedEvent").publish({offlineMap:e})}).finally(function(){n._cancellationTokenSource.dispose(),n._cancellationTokenSource=null,n.canCancel.set(!1)})})},r.prototype.updateBundle=function(e){var t=this;return this._lastOperation=this._waitForLast().finally(function(){if(!e)throw new Error(t.getResource("language-offline-errors-offlinemapnull"));var i=t._getOfflineMapIx(e);if(-1===i)throw new Error(t.getResource("language-offline-errors-notfound"));return t._throwIfNotNativeInitialized(),t._bundleManager.updateBundle(t._offlineMaps[i].id,t._getOfflineMapBasemapMapping(t._offlineMaps[i]))})},r.prototype.activateOfflineMap=function(t,i){var r=this;return this._lastOperation=this._waitForLast().finally(function(){if(!t)throw new Error(r.getResource("language-offline-errors-offlinemapnull"));var n=r._getOfflineMapIx(t);if(-1===n)throw new Error(r.getResource("language-offline-errors-notfound"));r._throwIfNotNativeInitialized();var a=r._activeOfflineMapId;return r._activeOfflineMapId=r._offlineMaps[n].id,r._bundleManager.loadBundle(r._activeOfflineMapId).then(function(){return r.refreshSyncInfo()}).then(function(){return r._save()}).catch(function(e){return r._activeOfflineMapId=a,Promise.resolve().then(function(){return a?r._bundleManager.loadBundle(r._activeOfflineMapId):r._bundleManager.unloadBundle()}).then(function(){return r.refreshSyncInfo()}).catch(function(e){r.app.trace.error("Error undoing attempt to activate offline map. "+(e.message||e))}).then(function(){throw e})}).then(function(){r.app.isOffline.set(!0),r.isOfflineMapActive.set(!0);var t=new esri.geometry.Polygon(r._offlineMaps[n].content.geometry);r.aoiMask.show(t);var a=r._offlineMaps[n];r._restoreOfflineUserAddedLayers(a),r.app.site.essentialsMap.mapServices.forEach(function(t){if(t instanceof e.essentials.FeatureLayerService){var i=t.serviceLayer;i.suspended&&i.resume()}t.refresh()}),r.app.event("OfflineMapActivatedEvent").publish({offlineMap:r._offlineMaps[n],userAction:!!i})})})},r.prototype.deactivateOfflineMap=function(t){var i=this;return this._lastOperation=this._waitForLast().finally(function(){return i._throwIfNotNativeInitialized(),null==i._activeOfflineMapId?Promise.resolve():(i._previousActiveOfflineMapId=i._activeOfflineMapId,i._activeOfflineMapId=null,i._bundleManager.unloadBundle().then(function(){return i.refreshSyncInfo()}).then(function(){return i._save()}).then(function(){i.app.isOffline.set(!1),i.isOfflineMapActive.set(!1),i.aoiMask.hide(),i.app.site.updateServiceTokensIfStale().then(function(){i.app.site.essentialsMap.mapServices.forEach(function(t){if(t instanceof e.essentials.FeatureLayerService){var i=t.serviceLayer,r=new esri.tasks.Query;r.objectIds=[0],i.queryIds(r,function(){t.refresh()},function(){i.suspend()})}else t.refresh()})}),i.app.event("OfflineMapActivatedEvent").publish({offlineMap:null,userAction:!!t})}))})},r.prototype.cancel=function(){return this.canCancel.get()?(this._cancellationTokenSource.cancel(),this.canCancel.set(!1),this._lastOperation):Promise.reject(this.getResource("language-offline-errors-cancelrejected"))},r.prototype.forgetLast=function(){this._lastOperation=Promise.resolve()},r.prototype.getOfflineMapById=function(e){return this._offlineMaps.filter(function(t){return t.id===e})[0]},r.prototype.getOfflineMaps=function(){return this._offlineMaps.concat()},r.prototype.getActiveOfflineMap=function(){return this._activeOfflineMapId?this.getOfflineMapById(this._activeOfflineMapId):null},r.prototype.refreshSyncInfo=function(){var e=this;return this._activeOfflineMapId?i.SyncEngine.getSyncInfo(this.app,this._activeOfflineMapId).then(function(t){e.syncInfo=t}):(this.syncInfo=null,Promise.resolve())},r.prototype._save=function(){var e=this,t={offlineMapIds:this._offlineMaps.map(function(e){return e.id}),activeOfflineMapId:this._activeOfflineMapId,previousActiveOfflineMapId:this._previousActiveOfflineMapId};return this._appStoreSetPromise("__offlineManager",JSON.stringify(t)).catch(function(t){throw e.app.trace.error("Error saving offline manager state. "+(t.message||t)),t.message=e.getResource("language-offline-errors-savefailed"),t})},r.prototype.load=function(){var e=this;this._lastOperation||(this._lastOperation=this._appStoreGetPromise("__offlineManager").then(function(t){if(!t)return null;var i=JSON.parse(t),r=i.offlineMapIds.map(function(t){return e._loadOfflineMapFromStorage(t).catch(function(i){return e.app.trace.warning("Unable to restore offline map '"+t+"'. "+(i.message||i)),null})});return Promise.filter(r,function(e){return null!=e}).then(function(t){e._offlineMaps=t;var r=e._prioritizeOfflineMaps(i,e._offlineMaps);return e._initializeMap(r)}).then(function(){e.app.event("OfflineMapsLoadedEvent").publish({offlineMaps:e._offlineMaps,activeOfflineMap:e.getActiveOfflineMap()})})}).catch(function(t){throw e.app.trace.error("Error loading offline manager state. "+(t.message||t)),t.message=e.getResource("language-offline-errors-loadfailed"),t}))},r.prototype._prioritizeOfflineMaps=function(e,t){for(var i=[e.activeOfflineMapId,e.previousActiveOfflineMapId],r=0,n=t.map(function(e){return e.id});r<n.length;r++){var a=n[r];a!==e.activeOfflineMapId&&a!==e.previousActiveOfflineMapId&&i.push(a)}return i},r.prototype._initializeMap=function(e){var t=this;if(0===e.length&&this.app.isOffline.get())return Promise.resolve();var i=e[0];return this.app.isOffline.get()&&!i?this._initializeMap(e.slice(1)):i?this._bundleManager.loadBundle(i).then(function(){t._activeOfflineMapId=i,t.app.isOffline.set(!!i),t.isOfflineMapActive.set(!!i);var e=t._getOfflineMapIx(i),r=t._offlineMaps[e],n=new esri.geometry.Polygon(t._offlineMaps[e].content.geometry);return t.aoiMask.show(n),t._restoreOfflineUserAddedLayers(r),t.refreshSyncInfo()}).catch(function(i){return t._initializeMap(e.slice(1))}):Promise.resolve()},r.prototype._waitForLast=function(){return this._lastOperation.catch(function(e){})},r.prototype._throwIfCanceled=function(){if(this._cancellationTokenSource.token().isCancellationRequested)throw new Error(this.getResource("language-offline-errors-canceled"))},r.prototype._throwIfNotNativeInitialized=function(){if(!this.app.nativeManager.nativeInitialized)throw new Error(this.getResource("language-offline-errors-notnativeinitialized"))},r.prototype._loadOfflineMapFromStorage=function(e){var t=this;return this._appStoreGetPromise(this._getOfflineMapKey(e)).then(function(e){if(!e)throw t.app.trace.error("Offline profile '{offlineMapId}' not found."),new Error(t.getResource("language-offline-errors-notfound"));return JSON.parse(e)},function(e){throw t.app.trace.error("Error loading offline map. "+(e.message||e)),e.message=t.getResource("language-offline-errors-loadfailed"),e})},r.prototype._restoreOfflineUserAddedLayers=function(i){var r=this;this.app.waitUntilSiteServiceLayersLoaded().then(function(){var n=[],a=t.gis.AppInfo.fromGeocortexApp(r.app);i.content.layers.forEach(function(t){if(t.isUserCreated&&t.serviceInfo){var r=t.serviceInfo.url;if(r){var s=a.mapInfo.getLayerInfos().filter(function(e){return e.uniqueId===t.layerInfoUniqueId})[0];if(s)s.gcxLayer&&s.gcxLayer.properties.offlineMapId&&(s.gcxLayer.properties.offlineMapId=i.id);else{var o=a.mapInfo.serviceLayers.filter(function(e){return e.serviceLayer.url===r})[0];if(o&&o.gcxMapService){var l=new e.essentials.Layer(t.layerJson.url);l.createFromDefinition(t.layerJson),l.isUserCreated=!0,l.includeInLayerList=!0,l.setInActiveTheme(!0),l.properties.offlineMapId=i.id,l.parentLayerId=null,o.gcxMapService.add(l);var c=n.filter(function(e){return e.service===o.gcxMapService})[0];c?c.layers.push(l):n.push({service:o.gcxMapService,layers:[l]})}}}}}),n.forEach(function(e){r.app.event("MapServiceLayersChangedWithResultEvent").publish({mapService:e.service,newItems:e.layers,oldItems:[]}),r.app.event("MapServiceLayersChangedEvent").publish(e.service)})})},r.prototype._getOfflineMapIx=function(e){for(var t="string"==typeof e?e:e.id,i=0;i<this._offlineMaps.length;i++)if(this._offlineMaps[i].id===t)return i;return-1},r.prototype._getOfflineMapBasemapMapping=function(t){var r=this.app.site.essentialsMap.baseMaps;return t.content.basemaps.map(function(t){var n=r.filter(function(e){return t.baseMapId===e.id})[0];if(!n)return null;var a=n.services.filter(function(t){return t.mapService.mapServiceType===e.essentials.MapServiceType.TILED}).pop();return a?{url:e.essentials.utilities.DecomposedUri.removeQueryParameters(a.mapService.serviceLayer.url,"token"),localServicePath:(t.sourceType===i.OfflineMapBasemap.Type.PREGENERATED?"tile":"viewertile")+"/"+t.filename.replace(" ","_")}:null}).filter(function(e){return!!e})},r.prototype._getOfflineMapKey=function(e){return"string"==typeof e?"__offlineMap-"+e:"__offlineMap-"+e.id},r.prototype._appStoreGetPromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.get(e,i,r)})},r.prototype._appStoreSetPromise=function(e,t){var i=this;return new Promise(function(r,n){return i.app.store.set(e,t,function(){return r()},n)})},r.prototype._appStoreRemovePromise=function(e){var t=this;return new Promise(function(i,r){return t.app.store.remove(e,function(){return i()},r)})},r.prototype.getResource=function(e){return this.app.getResource(this.libraryId,e)},r}();i.OfflineManager=r}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){function t(e,t){return e===t||JSON.stringify(e)===JSON.stringify(t)}e.verify=function(e){if(!e)throw new Error("offlineMap is null or undefined.");if(!e.id)throw new Error("offlineMap.id is null or undefined.");if(!e.content)throw new Error("offlineMap.content is null or undefined.");if(!e.content.geometry)throw new Error("offlineMap.content.geometry is null or undefined.");if(!e.content.basemaps)throw new Error("offlineMap.content.basemaps is null or undefined.");for(var t=0;t<e.content.basemaps.length;t++){if(!e.content.basemaps[t].url)throw new Error("offlineMap.content.basemaps["+t+"].url is null or undefined.");if(!e.content.basemaps[t].baseMapId)throw new Error("offlineMap.content.basemaps["+t+"].baseMapId is null or undefined.");if(!e.content.basemaps[t].filename)throw new Error("offlineMap.content.basemaps["+t+"].filename is null or undefined.");if(!e.content.basemaps[t].sourceType)throw new Error("offlineMap.content.basemaps["+t+"].sourceType is null or undefined.")}if(!e.content.layers)throw new Error("offlineMap.content.layers is null or undefined.");for(var i=0;i<e.content.layers.length;i++)if(!e.content.layers[i].layerInfoUniqueId)throw new Error("offlineMap.content.layers["+i+"].layerInfoUniqueId is null or undefined.");if(!e.properties.siteId)throw new Error("offlineMap.properties.siteId is null or undefined.");if(!e.properties.viewerId)throw new Error("offlineMap.properties.viewerId is null or undefined.")},e.diff=function(e,i){var r={};e.description!==i.description&&(r.description=i.description),t(e.grants,i.grants)||(r.grants=i.grants),t(e.properties,i.properties)||(r.properties=i.properties),t(e.shape,i.shape)||(r.shape=i.shape),t(e.tags||[],i.tags||[])||(r.tags=i.tags),e.title!==i.title&&(r.title=i.title),t(e.thumbnail,i.thumbnail)||(r.thumbnail=i.thumbnail),e.version!==i.version&&(r.version=i.version),null==e.content!=(null==i.content)?r.content=i.content:null==i.content?r.content=null:t(e.content,i.content)||(r.content={},t(e.content.geometry,i.content.geometry)||(r.content.geometry=i.content.geometry),t(e.content.layers,i.content.layers)||(r.content.layers=i.content.layers),t(e.content.basemaps,i.content.basemaps)||(r.content.basemaps=i.content.basemaps),e.content.includeAttachments!==i.content.includeAttachments&&(r.content.includeAttachments=i.content.includeAttachments));for(var n in r)if(r.hasOwnProperty(n))return r;return null}}(e.OfflineMap||(e.OfflineMap={}));!function(e){e.Type={EXPORT_TILES:"exportTiles",PREGENERATED:"pregenerated"}}(e.OfflineMapBasemap||(e.OfflineMapBasemap={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function t(e){this.servers=[];for(var t=0;t<e.servers.length;t++)"string"==typeof e.servers[t].lastSyncTime&&(e.servers[t].lastSyncTime=new Date(e.servers[t].lastSyncTime)),this.servers.push(e.servers[t])}return t.prototype.isSynced=function(e){return!!this.findLayerOrTable(e)},t.prototype.findLayerOrTable=function(t){for(var i=e.essentials.utilities.LayerUtilities.decomposeFeatureLayerUrl(t),r=this.servers.filter(function(e){return e.featureServiceUrl==i.serviceUrl}),n=0;n<r.length;n++){var a=r[n],s=a.layers.filter(function(e){return e.id==i.layerId})[0];if(s)return s;var o=a.layers.filter(function(e){return e.id==i.layerId})[0];if(o)return o}return null},t}();t.SyncInfo=i}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(){}return i.getSyncInfo=function(e,i){var r=e.localServerAddress+"/sync/"+e.localServerNamespace+"/info?profile="+i;return e.nativeManager.xhrGet({url:r}).then(function(e){var i=JSON.parse(e);return new t.SyncInfo(i)})},i.sync=function(e,t,i,r){var n=this;return e.event("FeatureDataSyncStartedEvent").publish(t),this._unregisterOfflineDeletedReplicas(e).then(function(a){return n._sync(e,t,i,r)}).then(function(t){return e.event("FeatureDataSyncCompletedEvent").publish(),t})},i._sync=function(e,t,i,r){var n=this;return i.register(function(){return n._cancel(e)}),new Promise(function(i,a){var s=e.event("NativeMessageEvent").subscribe(n,function(t){"syncStatus"===t.type&&(t.parameters.state===n.STATUS_SUCCESS?(e.event("NativeMessageEvent").unsubscribe(s),r(t.parameters),i(t.parameters)):t.parameters.state===n.STATUS_ERROR?(e.event("NativeMessageEvent").unsubscribe(s),a(t.parameters.text)):t.parameters.state===n.STATUS_IN_PROGRESS&&r(t.parameters))}),o={options:JSON.stringify(t)},l=e.localServerAddress+"/sync/"+e.localServerNamespace+"/execute";e.nativeManager.xhrPost({url:l,content:o,error:function(t){e.event("NativeMessageEvent").unsubscribe(s),a(t.responseText)}})})},i._cancel=function(e){var t=e.localServerAddress+"/sync/"+e.localServerNamespace+"/cancel";return e.nativeManager.xhrPost({url:t,method:"POST"})},i.deleteData=function(e,t){var i=this._getFeatureServiceTokenInfo(e),r=e.localServerAddress+"/sync/"+e.localServerNamespace+"/delete",n={parameters:JSON.stringify({profile:t,serviceInfo:i})};return e.nativeManager.xhrPost({url:r,content:n,method:"POST"})},i._unregisterOfflineDeletedReplicas=function(e){var t=this._getFeatureServiceTokenInfo(e),i=e.localServerAddress+"/sync/"+e.localServerNamespace+"/unregisterDeletedReplicas",r={parameters:JSON.stringify({serviceInfo:t})};return e.nativeManager.xhrPost({url:i,content:r})},i._getFeatureServiceTokenInfo=function(t){return t.site.essentialsMap.mapServices.filter(function(t){return t instanceof e.essentials.FeatureLayerService}).map(function(t){return{serviceUrl:e.essentials.utilities.LayerUtilities.decomposeFeatureLayerUrl(t.serviceUrl).serviceUrl,token:t.serviceToken}})},i.STATUS_IN_PROGRESS="inProgress",i.STATUS_SUCCESS="success",i.STATUS_ERROR="error",i}();t.SyncEngine=i}(t.offline||(t.offline={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(t){t.buildSyncParameters=function(t,i){var r=e.gis.AppInfo.fromGeocortexApp(t).mapInfo.getLayerInfos(),n=[];return i.content.layers.forEach(function(e){var t,i,a,s,o,l=r.filter(function(t){return t.uniqueId==e.layerInfoUniqueId})[0];if(l||e.isUserCreated){if(l){if(i=l.url.substring(0,l.url.lastIndexOf("/")),a=parseInt(l.id),t={id:a,where:e.definitionExpression},l.gcxLayer.isDynamic){var c=l.serviceLayerInfo.serviceLayer,u=c.dynamicLayerInfos.filter(function(e){return e.id===a})[0];u&&(t.dynamicLayerInfo=u.toJson());var p=c.layerDrawingOptions[a];p&&(t.layerDrawingOptions=p.toJson())}o=l.serviceLayerInfo.gcxMapService.serviceToken,s=l.serviceLayerInfo.capabilities}else{if(!(e.isUserCreated&&e.serviceInfo&&e.layerJson))return;i=e.serviceInfo.url,s=e.serviceInfo.capabilities,a=parseInt(e.layerJson.id);var h=JSON.parse(e.layerJson.dynamicDefinition);t={id:a,where:e.definitionExpression,dynamicLayerInfo:h,layerDrawingOptions:h?h.drawingInfo:null}}var d=n.filter(function(e){return e.url===i})[0];d?d.layers.push(t):(d={url:i,layers:[t],capabilities:s,token:o},n.push(d)),l&&l.relationships.forEach(function(e){d.layers.some(function(t){return t.id==e.relatedTableId})||d.layers.push({id:e.relatedTableId})})}}),{profile:i.id,featureServices:n,geometry:i.content.geometry,includeAttachments:i.content.includeAttachments,mapSpatialReference:t.map.spatialReference.toJson()}}}(t.SyncParameters||(t.SyncParameters={}))}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.calculateFirstDownloadWork=function(e){return{saveProfileWork:.25,featureLayerWork:e.content.layers.length+2,basemapWork:4*e.content.basemaps.length,bundleWork:.5}},e.calculateSyncWork=function(e){return{saveProfileWork:0,featureLayerWork:e.content.layers.length+2,basemapWork:2*e.content.basemaps.length,bundleWork:.5}},e.noWork=function(){return{saveProfileWork:0,bundleWork:0,featureLayerWork:0,basemapWork:0}},e.calculatePercentageComplete=function(e,t){return this._calculateTotalWork(e)/this._calculateTotalWork(t)*100},e._calculateTotalWork=function(e){return e.saveProfileWork+e.bundleWork+e.featureLayerWork+e.basemapWork},e}();e.WorkCalculator=t}(e.offline||(e.offline={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){function i(t){return e.SecurityUtils.getIdentity("ags-oauth2",t)}function r(t){var r=i(t);if(!r)return null;var n=e.SecurityUtils.getClaimsByType(r,"http://www.geocortex.com/security/ags/portal")[0];return n?n.value:null}t.getPortalIdentity=i,t.hasAccessToPortal=function(e){return!!i(e)},t.hasCreateContentPrivilege=function(t){var r=i(t);return!!r&&e.SecurityUtils.hasPrivilegeClaim(r,"portal:user:createItem")},t.hasPublishFeaturePrivilege=function(t){var r=i(t);return!!r&&e.SecurityUtils.hasPrivilegeClaim(r,"portal:publisher:publishFeatures")},t.getPortalBaseUrl=r,t.getPortalMyContentUrl=function(e){var t=r(e);if(!t)return null;var i=e.configuration.portalContentRelUrl||"home/content.html";return String.format("{0}{1}",t,i)},t.getPortalItemUrl=function(e,t){var i=r(t);if(!i)return null;var n=t.configuration.portalItemRelUrl||"home/item.html?id=";return String.format("{0}{1}{2}",i,n,e)}}(e.PortalUtils||(e.PortalUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){i.PROJECT_TYPE="gvh-project",i.SITE_ID_PROPERTY_NAME="siteID",i.VIEWER_ID_PROPERTY_NAME="viewerID",i.PROJECT_QUERY_STRING_KEY="project",i.VIEWER_QUERY_STRING_KEY="viewer";var r=function(){function r(e){if(!e)throw new Error("ProjectManager: Parameter 'app' is required.");this.app=e,this.convert=new i.ProjectConverter(e),this.filter=new i.ProjectFilter(e)}return r.prototype.createEmpty=function(e){var t={};return t[i.SITE_ID_PROPERTY_NAME]={string:this.app.site.id},t[i.VIEWER_ID_PROPERTY_NAME]={string:this.app.configModel.viewerId},{title:e,fileType:i.PROJECT_TYPE,contentType:"application/json",content:{moduleState:{}},properties:t}},r.prototype.create=function(e){var t=this.createEmpty(e);return this.update(t).return(t)},r.prototype.update=function(e){return this._exportState().then(function(t){e.content=t})},r.prototype.remove=function(e){var t=this;if(!e)throw new Error('RemoveProject: parameter "project" is required.');var i=this.getProjectID(e);return this.app.waitUntilSiteInitialized().then(function(){return t.app.event("ProjectDeletingEvent").publish(i)}).then(function(){return t.app.site.documentStore.deleteById(i)}).then(function(){t.current&&t.current.id===i&&(t.current=null)}).then(function(){t.app.event("ProjectDeletedEvent").publish(i)}).catch(function(e){t.app.event("ProjectErrorEvent").publish(null,e);var i=t._getResource("language-project-error-title"),r=t._getResource("language-project-error-delete");throw e&&"writer denied"===e.formalCode&&(r=t._getResource("language-project-error-delete-denied")),t.app.command("Alert").execute(r,i),e})},r.prototype.save=function(e,i){var r=this;if(void 0===i&&(i=!0),!e)throw new Error('SaveProject: parameter "project" is required.');return this.app.waitUntilSiteInitialized().then(function(){return r.app.event("ProjectSavingEvent").publish(e)}).then(function(){return i?new Promise(function(e,i){return t.ShellUtils.debounceViewEvents(r.app,function(){return e()})}).then(function(){return r.update(e)}).then(function(){return t.MapUtils.getThumbnailUri(r.app)}).then(function(t){return e.thumbnail={location:t}}).catch(function(t){r.app.event("ProjectErrorEvent").publish(e,t);var i=r._getResource("language-project-error-title"),n=r._getResource("language-project-error-write");throw r.app.command("Alert").execute(n,i),t}):Promise.resolve()}).then(function(){return r.write(e)}).then(function(t){return dojo.mixin(e,t)}).then(function(){return r.app.event("ProjectSavedEvent").publish(e)})},r.prototype.load=function(e){var t=this;if(!e)throw new Error('LoadProject: parameter "project" is required.');var i=this.getProjectID(e);return this.app.event("ProjectLoadingEvent").publish(i),"object"==typeof e&&void 0===e.content&&(e=i),this.getProject(e).then(function(e){return t._beginLoad(e)}).then(function(){if(t.current&&t.current.content)return t._applyState(t.current.content)}).then(function(){return t._finishLoad()}).catch(function(e){t.isLoading=!1})},r.prototype.write=function(t){var i=this;if(!t)throw new Error('ProjectManager.write: Parameter "project" is required.');return t.content&&t.content.isDecoded&&this.encodeReferences(t.content),this.app.waitUntilSiteInitialized().then(function(){return e.framework.utils.isNullOrUndefined(t.id)?i.app.site.documentStore.add(t).then(function(e){return t.id=e.id,e}):i.app.site.documentStore.updateById(t.id,t)}).catch(function(e){i.app.event("ProjectErrorEvent").publish(t,e);var r=i._getResource("language-project-error-title"),n=i._getResource("language-project-error-write");throw!e||"writer denied"!==e.formalCode&&"create denied"!==e.formalCode||(n=i._getResource("language-project-error-write-denied")),i.app.command("Alert").execute(n,r),e})},r.prototype.read=function(e,i){var r=this;if(void 0===i&&(i=!0),!e)throw new Error('ProjectManager.read: parameter "id" is required.');return this.app.waitUntilSiteInitialized().then(function(){return r.app.site.documentStore.getById(e,i)}).then(function(e){return e?(r.decodeReferences(e.content),r._filterApplicationState(e.content).then(function(t){return e.content=t,e})):e}).catch(function(i){r.app.event("ProjectErrorEvent").publish(null,i);var n=r._getResource("language-project-error-title"),a=r._getResource("language-project-error-read");if(i&&"item missing"===i.formalCode)a=r._getResource("language-project-error-read-not-found").format(e);else if(i&&"reader denied"===i.formalCode){if(a=r._getResource("language-project-error-read-denied"),r.app.command("SignIn").canExecute(null)){a=r._getResource("language-project-error-sign-in-required");throw r.app.command("Confirm").execute(a,n,function(e){e?r.app.command("SignIn").execute(null):window.location.assign(t.UrlUtils.removeQueryParameter(window.location.href,"project"))},{okLabel:r._getResource("language-project-sign-in")}),i}a=r._getResource("language-project-error-read-denied")}throw r.app.command("Alert").execute(a,n),i})},r.prototype.getProject=function(e,t){if(void 0===t&&(t=!0),!e)throw new Error('ProjectManager.getProject: parameter "project" is required.');return"string"==typeof e?this.app.project.read(e,t):Promise.resolve(e)},r.prototype.getProjectID=function(e){if(!e)throw new Error('ProjectManager.getProjectID: parameter "project" is required.');return"string"==typeof e?e:e.id},r.prototype.getProjectUrl=function(e){if(!e||!e.id)return null;var r=this.getSiteID(e);if(!r)throw new Error("ProjectManager.getProjectUrl: project siteId is null or undefined.");var n=this.getViewerID(e);if(!n)throw new Error("ProjectManager.getProjectUrl: project viewerId is null or undefined.");var a=window.location.href;a.indexOf("?")>-1?a=a.substring(0,a.indexOf("?")):a.indexOf("#")>-1&&(a=a.substring(0,a.indexOf("#")));var s=new t.Dictionary;if("unknown"!==n){var o=encodeURIComponent("{0}.{1}".format(r,n));s.set(i.VIEWER_QUERY_STRING_KEY,o)}return s.set(i.PROJECT_QUERY_STRING_KEY,encodeURIComponent(e.id)),"{0}{1}".format(a,t.UrlUtils.queryStringDictionaryToString(s))},r.prototype.getSiteID=function(e){if(!e)throw new Error('ProjectManager.getSiteID: parameter "project" is required.');if(!e.properties)return null;var t=e.properties[i.SITE_ID_PROPERTY_NAME];return t?t.string:null},r.prototype.getViewerID=function(e){if(!e)throw new Error('ProjectManager.getViewerID: parameter "project" is required.');if(!e.properties)return null;var t=e.properties[i.VIEWER_ID_PROPERTY_NAME];return t?t.string:null},r.prototype.validateProjectOwnership=function(e){return this.app.site.documentStore.isOwner(e)?Promise.resolve(e):Promise.reject(this._getResource("language-project-error-owner"))},r.prototype._exportState=function(){var e=this;this.convert.clearCache();var i=this._getModules(),r={};return Object.keys(i).forEach(function(e){r[e]=Promise.try(function(){return i[e].exportState()})}),t.PromiseUtils.propsSkipRejected(r).then(function(t){for(var i in t)t[i]||delete t[i];var r={mapScale:e.app.map.getScale(),mapCenter:e.convert.fromEsriGeometry(e.app.map.extent.getCenter()),moduleState:t};return e._filterApplicationState(r)}).then(function(t){return e.encodeReferences(t),t})},r.prototype._applyState=function(e){var t=this;if(!e)return Promise.resolve();this.decodeReferences(e);var i=e.moduleState||[];return Promise.map(Object.keys(i),function(e){var r=t._getModules()[e];if(r){var n=i[e];return n.serialVersion||(n.serialVersion=1),Promise.try(function(){return r.applyState(n)}).catch(function(i){return t.app.trace.warning('Unable to restore project state for module "{0}": {1}'.format(e,i))})}}).return()},r.prototype._applyMapExtent=function(e){this.app.site.essentialsMap.extentManager.setScaleWithPriority(e.content.mapScale,Number.MAX_VALUE);var t=this.convert.toEsriGeometry(e.content.mapCenter);this.app.site.essentialsMap.extentManager.centerAtWithPriority(t,Number.MAX_VALUE)},r.prototype._getResource=function(e){return this.app.getResource("Mapping.Infrastructure",e)},r.prototype._getModules=function(){return this.app.moduleManager._modules},r.prototype._beginLoad=function(e){var t=this;return this.app.waitUntilSiteInitialized().then(function(){if(t.isLoading)throw new Error("Cannot load a new project until the current project has finished loading.");var i=t.getSiteID(e);if(t.app.site.id!==i)throw new Error('The project "{0}" was created for the Essentials site ID "{1}" and is not compatible with this site.'.format(e.title,i));t.convert.clearCache(),t.isLoading=!0,t.current=e,t._applyMapExtent(e)})},r.prototype._finishLoad=function(){var e=this;setTimeout(function(){return e._applyMapExtent(e.current)},150),this.app.event("ProjectLoadedEvent").publish(this.current),this.isLoading=!1},r.prototype._filterApplicationState=function(e){var i=this,r={mapCenter:this.filter.point,mapScale:!0,moduleState:{},isDecoded:!0},n=this._getModules();return Promise.map(Object.keys(n),function(t){var a=n[t];if(a){var s=a.getStateFilter();!e.moduleState[t]||s?(s=$.extend({},s,{serialVersion:!0}),r.moduleState[t]=s):i.app.trace.warning('Module "{0}" has project state, but has no defined state filter. A module that participate in projects must implement ModuleBase.getStateFilter().'.format(t))}}).then(function(){return t.ObjectFilter.filter(e,r,{XssHtmlValidator:{defaultContentPolicy:i.app.defaultContentPolicy}})})},r.prototype.encodeReferences=function(e){if(e){var t=new RegExp("~","g"),i=new WeakMap,r=[],n=function(e){Array.isArray(e)||i.set(e,"~"+r.join("~"));for(var a=0,s=Object.keys(e);a<s.length;a++){var o=s[a],l=e[o];if(l&&"object"==typeof l){var c=i.get(l);c?e[o]=c:(r.push((o+"").replace(t,"\\x7e")),n(l),r.pop())}else l&&"string"==typeof l&&l.startsWith("~")&&(e[o]=l.replace("~","\\x7e"))}};n(e),delete e.isDecoded}},r.prototype.decodeReferences=function(e){if(e&&!e.isDecoded){var t=new RegExp("\\x7e".replace("\\","\\\\"),"g"),i=new WeakMap,r=function(n){if(!i.has(n)){i.set(n,!0);for(var a=0,s=Object.keys(n);a<s.length;a++){var o=s[a],l=n[o];if(l&&"string"==typeof l)if(l.startsWith("~")){for(var c=l.split("~").map(function(e){return e.replace(t,"~")}),u=e,p=1;p<c.length;p++){var h=c[p];h&&u&&(u=u[h])}n[o]=u}else l.startsWith("\\x7e")&&(n[o]=l.replace("\\x7e","~"));else l&&"object"==typeof l&&r(l)}}};r(e),e.isDecoded=!0}},r}();i.ProjectManager=r}(t.project||(t.project={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e.allSkipRejected=function(e){var t={};return Promise.resolve(e).then(function(e){var i=(e||[]).map(function(e){return Promise.resolve(e).catch(function(e){return t})});return Promise.all(i).then(function(e){return e.filter(function(e){return e!==t})})})},e.mapSkipRejected=function(e,t,i){var r={};return Promise.resolve(e).then(function(e){var n=(e||[]).map(function(e){return Promise.resolve(e).catch(function(e){return r})});return Promise.map(n,function(e,i,n){return Promise.try(function(){return t(e,i,n)}).catch(function(e){return r})},i).then(function(e){return e.filter(function(e){return e!==r})})})},e.propsSkipRejected=function(e){return Promise.resolve(e).then(function(e){var t={};return Promise.map(Object.keys(e),function(i){return Promise.resolve(e[i]).then(function(e){t[i]=e},function(e){})}).return(t)})},e.warnOnReject=function(e,t,i){return Promise.resolve(e).catch(function(e){return t.trace.warning(i.format(e)),Promise.reject(e)})}}(e.PromiseUtils||(e.PromiseUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){t.getAllFeaturesFromReportable=function(t){var i=[];if(t instanceof e.FeatureSetCollection)t.featureSets.get().forEach(function(e){e.features.get().forEach(function(e){i.push(e)})});else if(t instanceof e.FeatureSet)t.features.get().forEach(function(e){i.push(e)});else if(t instanceof e.Feature){var r=t;i.push(r)}else t&&t.constructor===Array&&(i=t);return i}}(e.reporting||(e.reporting={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.ClusterLayerArgs=t}(e.commandArgs||(e.commandArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.SnappingFeedbackEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.Default="default",e.MutuallyExclusive="mutuallyExclusive",e}();e.LayerVisibilityType=t}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function i(e,t){this.filteredLayerSelectorLayerItems=[],this.unfilteredLayerSelectorLayerItems=[],this.itemTypes={FOLDER:"folder",LAYER:"layer",SERVICELAYER:"serviceLayer"},this._infrastructureLibraryId="Mapping.Infrastructure",this._unfilteredItems=[],this._userAddedLayersFolder=null,this.appInfo=e,t&&(t.layerFilter&&dojo.isFunction(t.layerFilter)&&(this.layerFilter=t.layerFilter),t.layerStateChangeHandler&&dojo.isFunction(t.layerStateChangeHandler)&&(this.layerStateChangeHandler=t.layerStateChangeHandler),t.enableAllLayersHandler&&dojo.isFunction(t.enableAllLayersHandler)&&(this.enableAllLayersHandler=t.enableAllLayersHandler),t.disableAllLayersHandler&&dojo.isFunction(t.disableAllLayersHandler)&&(this.disableAllLayersHandler=t.disableAllLayersHandler),t.onInitializedHandler&&dojo.isFunction(t.onInitializedHandler)&&(this.onInitializedHandler=t.onInitializedHandler),t.onLayerSelectorFolderItemCreated&&dojo.isFunction(t.onLayerSelectorFolderItemCreated)&&(this.onLayerSelectorFolderItemCreated=t.onLayerSelectorFolderItemCreated),t.onLayerSelectorLayerItemCreated&&dojo.isFunction(t.onLayerSelectorLayerItemCreated)&&(this.onLayerSelectorLayerItemCreated=t.onLayerSelectorLayerItemCreated),t.onLayerSelectorServiceLayerItemCreated&&dojo.isFunction(t.onLayerSelectorServiceLayerItemCreated)&&(this.onLayerSelectorServiceLayerItemCreated=t.onLayerSelectorServiceLayerItemCreated)),this.items=new ObservableCollection,this.initialized=!1,this._suspendLayerStateChangeHandler=!1,this.initialize()}return i.prototype.initialize=function(){this._loadLayerSelectorItems(),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),this.setEnableAllLayersHandler(this.enableAllLayersHandler),this.setDisableAllLayersHandler(this.disableAllLayersHandler),this.onInitializedHandler&&!this.initialized&&this.onInitializedHandler(this),this.initialized=!0},i.prototype.applyFilter=function(e){var t=this;if(this.layerFilter=e&&dojo.isFunction(e)?e:null,this.items.clear(),this.filteredLayerSelectorLayerItems=[],!this.layerFilter)return this.items.set(this._unfilteredItems),void(this.filteredLayerSelectorLayerItems=this.unfilteredLayerSelectorLayerItems.slice(0));var i=function(e){var r=null;return e.itemType===t.itemTypes.FOLDER?(r=t._generateItemCloneForFilter(e),e.items.get().forEach(function(e){var t=i(e);t&&(!t.isFolder||t.isFolder&&t.items.length())&&r.items.addItem(t)}),r):(e.itemType===t.itemTypes.SERVICELAYER&&e.items.getLength()>0?(t.layerFilter(e)?(r=t._generateItemCloneForFilter(e),t.filteredLayerSelectorLayerItems.push(r)):r=t._creatFolderItemFromServiceLayer(e,!0,!0),e.items.get().forEach(function(e){var t=i(e);t&&(!t.isFolder||t.isFolder&&t.items.length())&&r.items.addItem(t)})):t.layerFilter(e)&&(r=e,t.filteredLayerSelectorLayerItems.push(r)),r)};this._unfilteredItems.forEach(function(e){var r=i(e);r&&(!r.isFolder||r.isFolder&&r.items.length())&&t.items.addItem(r)})},i.prototype.reapplyFilter=function(){this.applyFilter(this.layerFilter)},i.prototype.setLayerStateChangeHandler=function(e){var t=this;t.unfilteredLayerSelectorLayerItems.forEach(function(e){e._isEnabledBindingToken&&(e.isEnabled.unbind(e._isEnabledBindingToken),delete e._isEnabledBindingToken)}),this.layerStateChangeHandler=e&&dojo.isFunction(e)?e:null,this.layerStateChangeHandler&&this.unfilteredLayerSelectorLayerItems.forEach(function(e){e._isEnabledBindingToken=e.isEnabled.bind(t,function(){t._suspendLayerStateChangeHandler||t.layerStateChangeHandler(e)})})},i.prototype.setEnableAllLayersHandler=function(e){this.enableAllLayersHandler=e&&dojo.isFunction(e)?e:null},i.prototype.setDisableAllLayersHandler=function(e){this.disableAllLayersHandler=e&&dojo.isFunction(e)?e:null},i.prototype.enableAllLayers=function(){this._suspendLayerStateChangeHandler=!0,this.filteredLayerSelectorLayerItems.forEach(function(e){return e.isEnabled.set(!0)}),this._suspendLayerStateChangeHandler=!1,this.enableAllLayersHandler&&this.enableAllLayersHandler()},i.prototype.disableAllLayers=function(){this._suspendLayerStateChangeHandler=!0,this.filteredLayerSelectorLayerItems.forEach(function(e){return e.isEnabled.set(!1)}),this._suspendLayerStateChangeHandler=!1,this.disableAllLayersHandler&&this.disableAllLayersHandler()},i.prototype.addUserAddedServiceLayer=function(e){var i=this;if(e instanceof t.gis.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;if(this.unfilteredLayerSelectorLayerItems.filter(function(t){return t.serviceLayer&&t.serviceLayer.gcxMapService===e}).length)return!1;var r=t.gis.ServiceLayerInfo.fromGcxMapService(e),n=this._createServiceLayerItemFromServiceLayer(r,!0,!0);return this.unfilteredLayerSelectorLayerItems.push(n),e.layers.forEach(function(e){if(i.unfilteredLayerSelectorLayerItems.filter(function(t){return t.layer&&t.layer.gcxLayer===e}).length)return!1;var a=r.findLayerById(e.id);a||((a=t.gis.LayerInfo.fromGcxLayer(e)).serviceLayerInfo=r,r.layers.push(a));var s=i._createLayerItemFromLayer(a,!0,!0);s&&(n.items.addItem(s),i.unfilteredLayerSelectorLayerItems.push(s))}),this._unfilteredItems.push(n),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},i.prototype.removeServiceLayer=function(e){var i=this;if(e instanceof t.gis.ServiceLayerInfo&&(e=e.gcxMapService),!e)return!1;var r=this.unfilteredLayerSelectorLayerItems.filter(function(t){return t.serviceLayer&&t.serviceLayer.gcxMapService===e});return r.length&&r.forEach(function(e){return i._removeItemFromUnfilteredCollections(e)}),e.layers.forEach(function(e){var t=i.unfilteredLayerSelectorLayerItems.filter(function(t){return t.layer&&t.layer.gcxLayer===e});if(!t.length)return!1;t.forEach(function(e){return i._removeItemFromUnfilteredCollections(e)})}),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},i.prototype.updateServiceLayer=function(i,r,n){var a=this;if(r=r||[],n=n||[],i instanceof t.gis.ServiceLayerInfo&&(i=i.gcxMapService),!i)return!1;for(var s=t.gis.ServiceLayerInfo.fromGcxMapService(i),o=0;n&&o<n.length;o++){u=n[o];(p=this.unfilteredLayerSelectorLayerItems.filter(function(e){return e.layer&&e.layer.gcxLayer===u})).length&&p.forEach(function(e){return a._removeItemFromUnfilteredCollections(e)})}if(!this._userAddedLayersFolder){var l={id:e.framework.utils.alphaNumericToken()+":UserAdded",name:this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerlist-user-added-layers-folder-title"),isExpanded:!0,isVisible:!0,items:[],canToggleVisibility:null,iconUri:null,isVisibleInLayerList:null,layerID:null,mapServiceID:null,layerVisibilityType:null,themeSettings:null,type:null};this._userAddedLayersFolder=this._createFolderItemFromRestItem(l,!0,!0)}for(var c=0;r&&c<r.length;c++){var u=r[c],p=this.unfilteredLayerSelectorLayerItems.filter(function(e){return e.layer&&e.layer.gcxLayer===u});if(!p.length){var h=s.findLayerById(u.id);h||((h=t.gis.LayerInfo.fromGcxLayer(u)).serviceLayerInfo=s,s.layers.push(h));var d=this._createLayerItemFromLayer(h,!0,!0);d&&(this._userAddedLayersFolder.items.addItem(d),this.unfilteredLayerSelectorLayerItems.push(d))}}return this._userAddedLayersFolder&&this._userAddedLayersFolder.items.length()>0&&this._unfilteredItems.indexOf(this._userAddedLayersFolder)<0&&this._unfilteredItems.unshift(this._userAddedLayersFolder),this.applyFilter(this.layerFilter),this.setLayerStateChangeHandler(this.layerStateChangeHandler),!0},i.prototype._removeItemFromUnfilteredCollections=function(e){var t=this;if(e){var i=[],r=function(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)},n=function(e,t){for(var a=e.length-1;a>=0;a--){var s=e[a];s===t?e.splice(a,1):s.isFolder&&s.items.length()&&(r(s.items.get(),t),s.items.pulse(),n(s.items.get(),t),0===s.items.length()&&i.push(s))}};e.isFolder||r(this.unfilteredLayerSelectorLayerItems,e),n(this._unfilteredItems,e),i.length&&i.forEach(function(e){return t._removeItemFromUnfilteredCollections(e)})}},i.prototype._loadLayerSelectorItems=function(){var e=this,t=this.appInfo.gcxApp.site.layerListRestEndpoint,i=this.appInfo.mapInfo;this._unfilteredItems=[],this.unfilteredLayerSelectorLayerItems=[];var r=function(t){var n,a=void 0==t.isExpanded||t.isExpanded;switch(t.type){case"folder":n=e._createFolderItemFromRestItem(t,!0,a);break;case"mapService":var s=i.findMapServiceById(t.mapServiceID);n=e._createServiceLayerItemFromServiceLayer(s,!0,a),e.unfilteredLayerSelectorLayerItems.push(n);break;case"layer":var o=(s=i.findMapServiceById(t.mapServiceID))&&s.findLayerById(t.layerID);n=e._createLayerItemFromLayer(o,!0,a),e.unfilteredLayerSelectorLayerItems.push(n)}if(n&&t.items)for(var l=0;l<t.items.length;l++){var c=r(t.items[l]);c&&n.items.addItem(c)}return"folder"===t.type&&n&&0===n.items.getLength()?null:n};t.items&&t.items.length&&t.items.forEach(function(t){var i=r(t);i&&e._unfilteredItems.push(i)}),this._loadSelectorItemsNotInLayerList()},i.prototype._loadSelectorItemsNotInLayerList=function(){for(var e=0;e<this.appInfo.mapInfo.serviceLayers.length;e++){var t=null,i=this.appInfo.mapInfo.serviceLayers[e];i&&!i.includeInLayerList&&(t=this._createServiceLayerItemFromServiceLayer(i,!0,!0),this._unfilteredItems.push(t),this.unfilteredLayerSelectorLayerItems.push(t));for(var r=0;r<i.layers.length;r++){var n=i.layers[r];if(!(!n||n&&n.includeInLayerList)){var a=this._createLayerItemFromLayer(n,!0,!0);t&&a?(t.items.addItem(a),this.unfilteredLayerSelectorLayerItems.push(a)):null==t&&a&&(this._unfilteredItems.push(a),this.unfilteredLayerSelectorLayerItems.push(a))}}}},i.prototype._createFolderItemFromRestItem=function(e,t,i){if(!e)return null;var r={};return r.itemType=this.itemTypes.FOLDER,r.name=new Observable(e.name||"Layers"),r.isFolder=!0,r.isEnabled=new Observable(!!t),r.isExpanded=new Observable(!!i),r.iconUri=new Observable(""),r.items=new ObservableCollection,this._setTooltips(r),this.onLayerSelectorFolderItemCreated&&this.onLayerSelectorFolderItemCreated(r),r},i.prototype._creatFolderItemFromServiceLayer=function(e,t,i){var r={};return r.itemType=this.itemTypes.FOLDER,r.name=new Observable(e.name.get()||"Layers"),r.isFolder=!0,r.isEnabled=new Observable(!!t),r.isExpanded=new Observable(!!i),r.iconUri=new Observable(e.iconUri.get()||""),r.items=new ObservableCollection,this._setTooltips(r),this.onLayerSelectorFolderItemCreated&&this.onLayerSelectorFolderItemCreated(r),r},i.prototype._createLayerItemFromLayer=function(e,t,i){if(!e)return null;var r={};return r.itemType=this.itemTypes.LAYER,r.isEnabled=new Observable(!!t),r.isExpanded=new Observable(!!i),r.name=new Observable(e.gcxLayer.displayName),r.isFolder=!1,r.iconUri=new Observable(e.gcxLayer.iconUri),r.layer=e,r.items=new ObservableCollection([]),this._setTooltips(r),this.onLayerSelectorLayerItemCreated&&this.onLayerSelectorLayerItemCreated(r),r},i.prototype._createServiceLayerItemFromServiceLayer=function(e,t,i){if(!e)return null;var r={};return r.itemType=this.itemTypes.SERVICELAYER,r.isEnabled=new Observable(!!t),r.isExpanded=new Observable(!!i),r.name=new Observable(e.gcxMapService.displayName),r.isFolder=!1,r.iconUri=new Observable(e.gcxMapService.iconUri),r.serviceLayer=e,r.items=new ObservableCollection([]),this._setTooltips(r),this.onLayerSelectorServiceLayerItemCreated&&this.onLayerSelectorServiceLayerItemCreated(r),r},i.prototype._generateItemCloneForFilter=function(e){var t=dojo.mixin({},e);return t.isEnabled=new Observable(!0),t.items=new ObservableCollection,void 0!=e.serviceLayer&&(t.serviceLayer=e.serviceLayer),t},i.prototype._setTooltips=function(e){var t=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-item-expand").format(e.name.get()),i=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-state-toggle").format(e.name.get()),r=this.appInfo.gcxApp.getResource(this._infrastructureLibraryId,"language-layerselector-icon-tooltip").format(e.name.get());e.expanderTooltip=new Observable(t),e.stateToggleTooltip=new Observable(i),e.iconTooltip=new Observable(r)},i}();i.LayerSelector=r}(t.layerSelector||(t.layerSelector={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t,i,r,n,a,s){this.text=e,this.imageUri=t,this.userClosedCallback=i,this.imageClass=r,this.id=n,this.timeoutMS=a||3e4,this.showBusyIcon=!!s}}();e.AddStatusArgs=t}(e.commandArgs||(e.commandArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function i(e,t,i,r){this.destroyContentView=!1,this.delay=0,this.elementID=e||null,this.mapPoint=t||null,this.content=i||null,this.title=r||null}return i.prototype.getNode=function(){if(this.content){if(this.contentIsView())return this.content.root;if(this.content.nodeName)return this.content;if("string"==typeof this.content){var e=document.createElement("div");return e.innerHTML=new t.FilterUtils.UnsafeHtml(this.content).safeHtml,e}}return null},i.prototype.getTitleNode=function(){if(this.title){if(this.titleIsView())return this.title.root;if(this.title.nodeName)return this.title;if("string"==typeof this.title){var e=document.createElement("div");return e.innerHTML=new t.FilterUtils.UnsafeHtml(this.content).safeHtml,e}}return null},i.prototype.contentIsView=function(){return this.content&&this.content instanceof e.framework.ui.ViewBase},i.prototype.titleIsView=function(){return this.title&&this.title instanceof e.framework.ui.ViewBase},i}();i.ShowMapElementArgs=r}(t.commandArgs||(t.commandArgs={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={})),geocortex.essentialsHtmlViewer.mapping.infrastructure.ShowMapElementArgs=geocortex.essentialsHtmlViewer.mapping.infrastructure.commandArgs.ShowMapElementArgs,geocortex.essentialsHtmlViewer.mapping.infrastructure.AngleFormat=geocortex.essentialsHtmlViewer.mapping.infrastructure.coordinates.AngleFormat,geocortex.essentialsHtmlViewer.mapping.infrastructure.AngleDirectionSystem=geocortex.essentialsHtmlViewer.mapping.infrastructure.coordinates.AngleDirectionSystem,geocortex.essentialsHtmlViewer.mapping.infrastructure.CoordinateUtils=geocortex.essentialsHtmlViewer.mapping.infrastructure.coordinates.CoordinateUtils;var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.result=null,this.username=null,this.token=null}}();e.AuthenticationEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={})),geocortex.essentialsHtmlViewer.mapping.infrastructure.AuthenticationEventArgs=geocortex.essentialsHtmlViewer.mapping.infrastructure.eventArgs.AuthenticationEventArgs;var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.mapPoint=null,this.projectedMapPoint=null,this.location=null,this.typeOfGeolocation=null,this.accuracyThreshold=null,this.timedOut=!1}}();e.GeolocationEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.centerLatLon=null,this.currentScale=null,this.currentResolution=null}}();e.MapExtentEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){this.isCancelled=!1}}();e.UserEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){var i=function(i){function r(e,r){i.call(this,e,r),this._xssHtmlValidator=new t.validation.XssHtmlValidator({contentPolicy:e.defaultContentPolicy})}return __extends(r,i),r.prototype.attach=function(e){var r=this;return e&&e instanceof t.Feature?this.descriptionApply(e,this.root).then(function(){return i.prototype.attach.call(r,e)}):(i.prototype.attach.call(this,e),Promise.resolve())},r.prototype.descriptionGet=function(e){return this.getDescriptionContent(e)},r.prototype.getContentFieldFormat=function(e){switch(this.contentField){case"label":return e.labelFormat.get();case"description":return e.descriptionFormat.get();case"longDescription":default:return e.longDescriptionFormat.get()}},r.prototype.getDescriptionContent=function(e,t){var i=this,r=t;r||(r=this.getContentFieldFormat(e));var n=this._extractCommandHyperlinks(r);return r=n.html,this._sanitizeHtml(e.formatTemplateString(r)).then(function(e){return n.html=e,e=i._injectCommandHyperlinks(n),e=i.insertLinkAndImageBindings(e)})},r.prototype.descriptionApply=function(e,t){return this.applyDescriptiveTemplate(e,t)},r.prototype.applyDescriptiveTemplate=function(e,t){var i=this,r=[],n=this.getContentFieldFormat(e);if(n&&e.hasRelationships){var a=n.match(/{{.[^}]+?\..+?}}|{.[^}]+?\..+?}/g),s=[];for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];l=l.substr(1,l.length-2),s.push(l.match(/[^.].[^.]*/g))}if(s.length&&e.layer&&e.layer.relationships)for(var o in e.layer.relationships)if(e.layer.relationships.hasOwnProperty(o)){var c=e.layer.relationships[o];-1==s.toString().indexOf(c.name)&&-1==s.toString().indexOf(c.displayName)||r.push(new Promise(function(r,o){i.app.command("GetRelatedFeatures").execute({mapService:e.layer.mapService,currentFeature:e,relationshipId:c.id,objectId:e.id.get(),successCallback:function(o){return function(l){if(l.length>0){for(var c in s)if(s.hasOwnProperty(c)){var u=l[0],p=s[c],h=p[0].trim(),d=p[1].trim();if(-1!==o.indexOf(h)&&void 0!==u.attributes[d])for(var c in a)if(a.hasOwnProperty(c)){var m=a[c];-1!==n.indexOf(m)&&-1!==m.indexOf(h)&&-1!==m.indexOf(d)&&(n=n.replace(m,u.attributes[d]),i.getDescriptionContent(e,n).then(function(e){return t.innerHTML=e}).then(function(){return r()}))}}}else r()}}("{0}-{1}".format(c.name,c.displayName)),errorCallback:function(e){e.message="There was an error retrieving related features: "+e.message,i.app.trace.warning(e.message),r(e)}})}))}}return r.push(this.getDescriptionContent(e).then(function(e){return t.innerHTML=e})),Promise.all(r).then(function(){return null})},r.prototype._extractCommandHyperlinks=function(t){var i=[];return t?(t=t.replace(/\bhref="#?command:.*?"/gi,function(t){var r='href="mailto:'+e.framework.utils.alphaNumericToken()+'"';return i.push({commandHyperlink:t,placeholder:r}),r}),{html:t,commandHyperlinkPlaceholders:i}):{html:t,commandHyperlinkPlaceholders:i}},r.prototype._injectCommandHyperlinks=function(e){var t=e.html,i=e.commandHyperlinkPlaceholders;if(!t)return"";return t.replace(/\bhref="mailto:.*?"/gi,function(e){for(var t=0,r=i;t<r.length;t++){var n=r[t];if(e===n.placeholder)return n.commandHyperlink}})},r.prototype._sanitizeHtml=function(e){var i={allowFrames:!0,allowArbitraryHyperlinks:!0,uriTransformer:function(e,i){return i.type!==t.FilterUtils.UriType.NavigableLink?e:/^mailto\:/.test(e)?e:"command:OpenWebPage?"+e}};return this._xssHtmlValidator.validate(e,{sanitizeOptions:i}).then(function(e){return e.validatedValue})},r.prototype.cleansedFormatForFormat=function(e){return this.insertLinkAndImageBindings(e)},r.prototype.insertLinkAndImageBindings=function(e){var t=this;if(null===e)return null;if(e in this._descFormats)return this._descFormats[e];var i=/<a[^>]*(\/?>)/g,r=/(<a.*?href\s*?=\s*?")(command:.+?)(".*?)(\/?>)/,n=e.replace(i,function(e,i,n,a){var s=e.match(r);if(s){var o="",l=e.match(/(title|aria-label)\s*?=\s*?"[^"]*?"/g);return l&&(o=" "+l.join(" ")),'<a _key="'+t.keyForUri(s[2])+'" href="javascript:void(0)" data-binding="{@event-onclick: handleHyperlinkClick}{@event-mouseup: ignoreEvent}{@event-mousedown: ignoreEvent}"'+o+s[4]}return e});return n=n.replace(/<img/g,'<img data-binding="{@event-load: handleImgLoad}"'),this._descFormats[e]=n,n},r.prototype.handleImgLoad=function(e){},r.prototype.keyForUri=function(e){var t=dojo.indexOf(this._uris,e);return t>=0||(t=this._uris.length,this._uris.push(e)),t},r.prototype.parseArguments=function(e,t,i){var r={};if("none"===t)return null;if("string"===t)return this.tryPerformTokenSubstitution(e,i,r)?[r.value]:[e];if("list"===t){var n;try{n=JSON.parse(e)}catch(t){n=e.split("&")}for(var a=0;a<n.length;a++)this.tryPerformTokenSubstitution(n[a],i,r)&&(n[a]=r.value);return n}var s;try{s=JSON.parse(e)}catch(t){if(e.indexOf("=")<0)return this.tryPerformTokenSubstitution(e,i,r)?[r.value]:(this.app.trace.warning("The specified parameter could not be parsed to a valid Object in JSON or Query String format."),[null]);s=dojo.queryToObject(e)}for(var o in s)s.hasOwnProperty(o)&&"function"!=typeof s[o]&&this.tryPerformTokenSubstitution(s[o],i,r)&&(s[o]=r.value);var l=null;if("object"!==t){var c=dojo.getObject(t)();l=s,s=dojo.safeMixin(c,s)}return l&&s.spatialReference&&!l.spatialReference&&(s.spatialReference=null),[s]},r.prototype.tryPerformTokenSubstitution=function(i,r,n){var a=this;if(!(null!==i&&void 0!==i&&r&&r instanceof t.Feature))return n.value=null,!1;var s=r.esriFeature&&r.esriFeature.get&&r.esriFeature.get()||null;if("{$Feature}"===i)return n.value=r,!0;if("{$Graphic}"===i)return n.value=s||null,null!==n.value;if("{$Geometry}"===i)return n.value=s&&s.geometry||null,null!==n.value;if("string"==typeof i){var o=!1,l=i.replace(/{.+?}/g,function(t){o=!0;var i=t.substring(1,t.length-1),n=s&&s.attributes[i];return n||(!n&&r.layer&&(n=e.essentials.utilities.StringUtilities.replaceLayerTokens(i,r.layer)),!n&&r.layer&&r.layer.mapService&&(n=e.essentials.utilities.StringUtilities.replaceMapServicetokens(i,r.layer.mapService)),n.length>0?n:(a.app.trace.warning("The token syntax {"+i+"} was detected, but could not be matched to a valid replacement value."),t))});return n.value=l,o}return!1},r.prototype.decodeHtmlQuotes=function(e){return e=e.replace(/&quot;/g,'"'),e=e.replace(/&39;/g,"'")},r.prototype.decodeHtmlAmpersands=function(e){return e=e.replace(/&amp;/g,"&")},r.prototype.handleHyperlinkClick=function(e,t,i){var r=t.getAttribute("_key"),n=this._uris[r];if(n){var a=new dojo._Url(n);if("command"===a.scheme){var s=a.path,o=a.query;return this.runCommand(s,o,i),!1}}return!1},r.prototype.ignoreEvent=function(e,t,i){return!1},r.prototype.runCommand=function(t,i,r){var n=this.app.command(t),a=e.essentialsHtmlViewer.Commands.metadataForCommandName(t);if(null!==a)if(a.isHyperlinkable){s=[];if(i){i=this.decodeHtmlQuotes(i),i=this.decodeHtmlAmpersands(i);var s=this.parseArguments(i,a.arguments,r)}if("OpenWebPage"==t){var o={url:s[0],isLink:!0},l=[];l.push(o),n.execute.apply(n,l)}else n.execute.apply(n,s)}else this.app.trace.warning('The specified command "{0}" is not able to be hyperlinked.'.format(t));else this.app.trace.warning('The specified command "{0}" has no associated metadata.'.format(t))},r}(e.framework.ui.ViewBase);t.FeatureDescriptionPresenterView=i,i.prototype._uris=[],i.prototype._descFormats={},i.prototype.contentField=null}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(t){t&&e.framework.ui.animation.runWhenIdle(function(){try{if(t===document.activeElement)return;t.focus()}catch(e){}})}t.focusOnFirstInput=function(e){if(e&&e.root&&!(e.app&&e.app.modalRegionSingleton&&e.app.modalRegionSingleton.isActive&&"ModalViewContainerView"!==e.id))try{for(var t=$(e.root).find("input, a, button, select, textarea, [tabindex]").not(".inactive, .bound-invisible, .disabled, .close-16, .back-16, [tabindex=-1], [readonly]:not(.control-readonly)"),r=0;r<t.length;r++){var n=t[r];if(!($(n).parentsUntil(e.root,".inactive, .bound-invisible, .disabled, .invisible, .hidden-hoisted-menu").length>=1)){var a=["select","input","textarea"];if(-1!==$.inArray(n.tagName.toLowerCase(),a)){if(n===document.activeElement)return;$(n).addClass("control-readonly"),n.setAttribute("readonly","true"),i(n),$(n).one("blur",function(e){n.removeAttribute("readonly"),$(n).removeClass("control-readonly")}),$(document).off("keypress.focus-control mousedown.focus-control touchstart.focus-control"),$(document).off("keydown.focus-control"),$(document).on("keydown.focus-control",function(e){return function(e,t){t.getAttribute("readonly")?8===e.keyCode&&e.preventDefault():$(document).off("keydown.focus-control")}(e,n)}),$(document).one("keypress.focus-control mousedown.focus-control touchstart.focus-control",function(e){return function(e,t){if(t.removeAttribute("readonly"),$(t).removeClass("control-readonly"),(e.target||e.srcElement)!==t)t.blur();else{t.blur(),i(t);var r=t.getAttribute("type");r&&r.toLowerCase&&(r=r.toLowerCase()),function(e){return"textarea"===e.tagName.toLowerCase()||"true"===e.contentEditable||!!r&&["date","datetime","datetime-local","email","month","number","password","search","text","tel","time","week"].indexOf(r)>=0}(t)&&"keypress"===e.type&&(0!=e.keyCode&&$(t).val($(t).val()+String.fromCharCode(e.keyCode)),/Edge\/12./i.test(navigator.userAgent)&&setTimeout(function(){t.setSelectionRange(1,1)},10))}$(document).off("keypress.focus-control mousedown.focus-control touchstart.focus-control"),$(document).off("keydown.focus-control")}(e,n)})}else i(n);break}}}catch(t){e.app&&e.app.trace.debug("Could not focus: "+t)}},t.focusOnMap=function(e){if(e){var t=function(e){var t=e.root;$(t).find("svg").attr("focusable","false"),t.tabIndex=0,i(t)};if(e.loaded)t(e);else var r=e.on("load",function(e){r.remove(),t(e.map)})}},t.focus=i}(t.FocusUtils||(t.FocusUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){function i(e,t){if(t&&e&&e.name){if(-1!==e.name.indexOf(".Name()",e.name.length-".Name()".length))return!0;if(t.getFieldByName(e.name+".Name()"))return!0}return!1}function r(e,t,i,r,a,s,o,l){void 0===a&&(a=!1),void 0===l&&(l="Mapping");var c=[],u=[],p=0,h={},d=function(e){r&&r(e)},m=function(){for(var e=0;e<c.length;e++)if(c[e].visible){if(a&&!c[e].hasOwnProperty("measurementId")){c.splice(e,1);continue}var t=c[e].getLayer();t&&t.remove(c[e])}else c.splice(e,1)};if(!(e&&t&&t.length&&i)){var g="Error deleting markup. Required parameters missing.";return i?i.trace.error(g):console.log(g),void d(c)}for(var f=0;f<t.length;f++){var y=i.map.getLayer(t[f]);y&&u.push(y)}if(!u.length)return i.trace.error("Error deleting markup. No graphics layer(s) found."),void d(c);for(var b=0;b<u.length;b++){var v=n(e,u[b],i);v&&v.length&&(c=c.concat(v))}for(var I=0;I<c.length;I++){var S=c[I];if(S.visible&&(S.hasOwnProperty("measurementId")?h.hasOwnProperty(S.measurementId)||(h[S.measurementId]=!0,p++):a||p++),p>1)break}if(0===p)d(c);else if(1!==p&&s){var C=i.getResource(l,s),w=o?i.getResource(l,o):null;i.command("Confirm").execute(C,w,function(e){e?m():c=[],d(c)})}else m(),d(c)}function n(e,t,i,r,n){void 0===n&&(n=6);var l=null,c=[];if(!e||!t||!i){var u="Error retrieving markup. Required parameters missing.";return i?i.trace.error(u):console.log(u),c}if(!t.graphics.length)return c;if("point"==e.type?l=s(e,n,i).getExtent():"polyline"==e.type?l=e.getExtent():"polygon"==e.type&&(l=e.getExtent()),null==l)return i.trace.error("Error retrieving markup. Could not compute extent."),c;for(var p=0;p<t.graphics.length;p++)if(l.intersects(t.graphics[p].geometry))c.push(t.graphics[p]);else if(t.graphics[p].symbol instanceof esri.symbol.SimpleMarkerSymbol){if(t.graphics[p].geometry instanceof esri.geometry.Point){var h=s(t.graphics[p].geometry,r||t.graphics[p].symbol.size,i);l.intersects(h)&&c.push(t.graphics[p])}else if(t.graphics[p].geometry instanceof esri.geometry.Multipoint)for(var d=t.graphics[p].symbol,m=t.graphics[p].geometry,g=0;g<m.points.length;g++){var f=new esri.geometry.Point(m.points[g],m.spatialReference);if(l.intersects(s(f,r||d.size,i))){c.push(t.graphics[p]);break}}}else if(t.graphics[p].symbol instanceof esri.symbol.TextSymbol){var y=t.graphics[p].symbol,b=y,v=i.map.toScreen(t.graphics[p].geometry),I=o(b.text,b.font.family,b.font.size,b.font.weight),S=I.height,C=I.width;switch(v.x+=b.xoffset,v.y-=b.yoffset,b.align){case esri.symbol.TextSymbol.ALIGN_START:var w=new esri.geometry.Point(v.x,v.y-S,null),G=new esri.geometry.Point(v.x+C,v.y-S,null),L=new esri.geometry.Point(v.x,v.y,null),W=new esri.geometry.Point(v.x+C,v.y,null);break;case esri.symbol.TextSymbol.ALIGN_MIDDLE:var w=new esri.geometry.Point(v.x-C/2,v.y-S,null),G=new esri.geometry.Point(v.x+C/2,v.y-S,null),L=new esri.geometry.Point(v.x-C/2,v.y,null),W=new esri.geometry.Point(v.x+C/2,v.y,null);break;case esri.symbol.TextSymbol.ALIGN_END:var w=new esri.geometry.Point(v.x-C,v.y-S,null),G=new esri.geometry.Point(v.x,v.y-S,null),L=new esri.geometry.Point(v.x-C,v.y,null),W=new esri.geometry.Point(v.x,v.y,null)}w=i.map.toMap(w),G=i.map.toMap(G),L=i.map.toMap(L),W=i.map.toMap(W);var _=new esri.geometry.Polygon({rings:[[[w.x,w.y],[G.x,G.y],[W.x,W.y],[L.x,L.y]]],spatialReference:w.spatialReference});_=a(y.angle,t.graphics[p].geometry,_),l.intersects(_)&&c.push(t.graphics[p])}return c}function a(e,t,i){for(var r=new esri.geometry.Polygon(i.toJson()),n=(360-(e<0?360+e:e)%360)*(Math.PI/180),a=0;a<r.rings.length;a++)for(var s=0;s<r.rings[a].length;s++){var o=r.getPoint(a,s),l=(o.x-t.x)*Math.cos(n)-(o.y-t.y)*Math.sin(n)+t.x,c=(o.x-t.x)*Math.sin(n)+(o.y-t.y)*Math.cos(n)+t.y;o.setX(l),o.setY(c),r.setPoint(a,s,o)}return r}function s(e,t,i){t=parseFloat(t);var r=i.map.toScreen(e),n=t/Math.sqrt(2)/2,a=new esri.geometry.Point(r.x-n,r.y-n,null),s=new esri.geometry.Point(r.x+n,r.y-n,null),o=new esri.geometry.Point(r.x-n,r.y+n,null),l=new esri.geometry.Point(r.x+n,r.y+n,null);return a=i.map.toMap(a),s=i.map.toMap(s),o=i.map.toMap(o),l=i.map.toMap(l),new esri.geometry.Polygon({rings:[[[a.x,a.y],[s.x,s.y],[l.x,l.y],[o.x,o.y],[a.x,a.y]]],spatialReference:a.spatialReference})}function o(e,t,i,r){void 0===r&&(r="normal");var n=document.body,a=document.createElement("div"),s={fontFamily:t,fontSize:void 0!=i&&"number"==typeof i?i+"px":i,fontWeight:r,padding:"0",position:"absolute",lineHeight:"1",visibility:"hidden"};for(var o in s)a.style[o]=s[o];a.appendChild(document.createTextNode(e)),n.appendChild(a);var l={width:a.clientWidth,height:a.clientHeight};return n.removeChild(a),l}function l(e,t,i){var r=i.map.getLayer(e);return!r&&t&&((r=new esri.layers.GraphicsLayer).id=e,i.map.addLayer(r)),r}var c={};t.sanitizeAttributeNames=function(e,t){var r,n=t.mapService?"{0}.{1}".format(t.mapService.id,t.id):null;if(n&&c[n])r=c[n];else{r={};for(var a=0;a<t.fields.length;a++){var s=t.fields[a];i(s,t)||(r[s.alias]=s.name)}n&&(c[n]=r)}var o=[];for(var l in r)if(r.hasOwnProperty(l)&&e.attributes.hasOwnProperty(l)){"Null"===e.attributes[l]&&(e.attributes[l]=null);var u=e.attributes[l];if(void 0!==u){var p={alias:l,name:r[l],value:u};p.alias!=p.name&&o.push(p)}}for(var h=0;h<o.length;h++){var d=o[h];delete e.attributes[d.alias],e.attributes[d.name]=d.value}},t._isSEPCodedDomainField=i,t.deleteMarkupSilently=function(e,t,i,n,a){void 0===a&&(a=!1),r(e,t,i,n,a)},t.deleteMarkup=r,t.getMarkupFromGeometry=n,t.rotatePolygon=a,t.getPolygonFromPoint=s,t.getRenderedTextMarkupSize=o,t.addGraphicToLayer=function(e,t,i){if(e){var r=l(t,!0,i);return r.add(e),r.visible||r.setVisibility(!0),!0}return!1},t.getGraphicsLayer=l,t.getUserGraphicsLayers=function(t){var i=function(e){return t.site.essentialsMap.mapServices.some(function(t){return t.serviceLayer===e||t.serviceLayer instanceof esri.layers.KMLLayer&&t.serviceLayer.getLayers().indexOf(e)>=0})},r=[],n=["snapping_graphics","snapping_helper_graphics","DefaultPushpinsLayer"],a=t.highlightManager.getHighlightLayers();for(var s in a)n.push(a[s].id);return t.map.graphicsLayerIds.forEach(function(a){var s=t.map.getLayer(a);i(s)||s instanceof e.ClusterLayer||s.id.endsWith("-explodedClusterLayer")||n.indexOf(a)>=0||r.push(s)}),r}}(e.GraphicUtils||(e.GraphicUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(t,i,r){return e.framework.utils.ArrayUtils.firstOrDefault(t.claims,function(e){return e.type===i&&e.value===r})}var r="http://www.geocortex.net/security/claims/privilege";t.getIdentity=function(t,i){var r=i.site;return r&&r.principal&&r.principal.identities?e.framework.utils.ArrayUtils.firstOrDefault(r.principal.identities,function(e){return e.authenticationType===t}):null},t.getClaimsByType=function(e,t){return e.claims.filter(function(e){return e.type===t})},t.getClaimsByValue=function(e,t){return e.claims.filter(function(e){return e.value===t})},t.getClaimByTypeAndValue=i,t.hasPrivilegeClaim=function(e,t){return!!i(e,r,t)}}(t.SecurityUtils||(t.SecurityUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.REPLACE="replace",e.UNION="union",e.SUBTRACT="subtract",e.INTERSECT="intersect"}(e.CombineMode||(e.CombineMode={}))}(e.selection||(e.selection={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function i(e){this._store=new t.Dictionary,this.app=e}return i.prototype.findByName=function(t){var i={name:t},r=this.find(i);return e.framework.utils.ArrayUtils.firstOrDefault(r)},i.prototype.findByCollectionId=function(t){var i={featureSetCollectionIds:[t]},r=this.find(i);return e.framework.utils.ArrayUtils.firstOrDefault(r)},i.prototype.findById=function(t){var i={ids:[t]},r=this.find(i);return e.framework.utils.ArrayUtils.firstOrDefault(r)},i.prototype.findAll=function(){return this.find()},i.prototype.find=function(e){e=e||{};var t=this._store.values();if(e.ids&&e.ids.length>0&&(t=t.filter(function(t){return e.ids.indexOf(t.id)>-1})),e.featureSetCollectionIds&&e.featureSetCollectionIds.length>0&&(t=t.filter(function(t){return e.featureSetCollectionIds.indexOf(t.featureSetCollectionId)>-1})),e.name&&(t=t.filter(function(t){return t.name&&t.name==e.name})),e.dateCreatedMin&&e.dateCreatedMin instanceof Date){var i=e.dateCreatedMin.getTime();t=t.filter(function(e){return void 0!==e.timeCreated&&e.timeCreated>=i})}if(e.dateCreatedMax&&e.dateCreatedMax instanceof Date){var r=e.dateCreatedMax.getTime();t=t.filter(function(e){return void 0!==e.timeCreated&&e.timeCreated<=r})}if(e.dateModifiedMin&&e.dateModifiedMin instanceof Date){var n=e.dateModifiedMin.getTime();t=t.filter(function(e){return void 0!==e.timeModified&&e.timeModified>=n})}if(e.dateModifiedMax&&e.dateModifiedMax instanceof Date){var a=e.dateModifiedMax.getTime();t=t.filter(function(e){return void 0!==e.timeModified&&e.timeModified<=a})}if(e.dateExpirationMin&&e.dateExpirationMin instanceof Date){var s=e.dateExpirationMin.getTime();t=t.filter(function(e){return void 0!==e.timeExpiration&&e.timeExpiration>=s})}if(e.dateExpirationMax&&e.dateExpirationMax instanceof Date){var o=e.dateExpirationMax.getTime();t=t.filter(function(e){return void 0!==e.timeExpiration&&e.timeExpiration<=o})}return t.map(function(e){return dojo.mixin({},e)})},i.prototype.add=function(e){if(!e)throw new Error("The selection metadata cannot be null.");var t=dojo.mixin({},e),i=t.id=this._generateId();return this._store.set(i,t),i},i.prototype.updateById=function(e,t){if(!e)throw new Error("The metadata ID must be set.");if(!t)throw new Error("The selection metadata cannot be null.");if(!this._store.containsKey(e))throw new Error("Selection metadata with ID '{0}' not found.".format(e));var i=this._store.get(e);this._update(i,t)},i.prototype.removeById=function(e){if(!e)throw new Error("The metadata ID must be set.");this._store.remove(e)},i.prototype.clear=function(){this._store.clear()},i.prototype._update=function(e,t){e.name=t.name,e.count=t.count,e.timeCreated=t.timeCreated,e.timeModified=t.timeModified,e.timeExpiration=e.timeExpiration,e.featureSetCollectionId=t.featureSetCollectionId,e.modified=t.modified},i.prototype._generateId=function(){return e.framework.utils.alphaNumericToken()},i}();i.SelectionMetadataStore=r}(t.selection||(t.selection={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){function i(t){if(!t)return null;var i=null,r=null;return i=t.timeZoneId,t.essentialsMap&&t.essentialsMap.site&&(r=t.essentialsMap.site.timeZoneId),e.framework.utils.ArrayUtils.firstOrDefault([i,r],function(e){return!!e})}function r(e,t){if(!t)return e;var i=-moment.tz(e.getTime(),t).utcOffset();return moment(e).add(i,"minutes").toDate()}t.UTC_ZONE_ID="Etc/UTC",t.getTimeZoneFromLayer=function(t){if(!t)return null;var r=null,n=null;return r=t.timeZoneId,t.mapService&&(n=i(t.mapService)),e.framework.utils.ArrayUtils.firstOrDefault([r,n],function(e){return!!e})},t.getTimeZoneFromMapService=i,t.getDisplayTimeZoneFromMapService=function(e){return e&&e.essentialsMap&&e.essentialsMap.site?e.essentialsMap.site.displayTimeZoneId:null},t.correctDatesForDisplayInDisplayTimeZone=function(e,i,n){if(i||(i=t.UTC_ZONE_ID),!n)return r(e,i);var a=-(-e.getTimezoneOffset()-moment.tz(e.getTime(),n).utcOffset()),s=r(e,i);return moment(s).add(a,"minutes").toDate()},t.correctDatesForDisplayInLocalTime=r,t.correctDatesToSubmitInDatabaseTime=function(e,i,r){i||(i=t.UTC_ZONE_ID);var n=moment.tz(e.getTime(),i).utcOffset();if(!r)return moment(e).add(n,"minutes").toDate();var a=n-moment.tz(e.getTime(),r).utcOffset(),s=-e.getTimezoneOffset();return moment(e).add(s+a,"minutes").toDate()},t.correctDatesToQueryInDatabaseTime=function(e,i,r){i||(i=t.UTC_ZONE_ID);var n=moment.tz(e.getTime(),i).utcOffset();if(!r){var a=e.getTimezoneOffset();return moment(e).add(a+n,"minutes").toDate()}var s=n-moment.tz(e.getTime(),r).utcOffset();return moment(e).add(s,"minutes").toDate()}}(t.TimeZoneUtils||(t.TimeZoneUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){function i(e){void 0===e&&(e=6);for(var t=[],i=Math.random(),n=0;n<e;n++)t.push(i+1/e*n);return t.map(function(e){return r(e,.8,1)})}function r(e,t,i){var r,n,a,s=t*i,o=6*e,l=s*(1-Math.abs(o%2-1)),c=i-s;switch(Math.floor(o)%6){case 0:r=s+c,n=l+c,a=c;break;case 1:r=l+c,n=s+c,a=c;break;case 2:r=c,n=s+c,a=l+c;break;case 3:r=c,n=l+c,a=s+c;break;case 4:r=l+c,n=c,a=s+c;break;case 5:r=s+c,n=c,a=l+c}var u=("00"+Math.floor(255*r).toString(16)).slice(-2),p=("00"+Math.floor(255*n).toString(16)).slice(-2);return"#"+u+("00"+Math.floor(255*a).toString(16)).slice(-2)+p}var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.getSelectedColorSwatch=function(){for(var e=this.viewModel.colorSwatches.get(),t=0;t<e.length;t++){var i=e[t];if(this.colorSwatchFieldSet.children[t].querySelector("input[type=radio]").checked)return i}},t.prototype.activated=function(){e.prototype.activated.call(this),this.reset()},t.prototype.attach=function(t){t.initialize(this.configuration),e.prototype.attach.call(this,t)},t.prototype.added=function(t){t.colorPickerWidget=this,e.prototype.added.call(this,t)},t.prototype.reset=function(){var e=this,t=this.viewModel.configuration;this.viewModel.colorSwatches.clear();var r,n={hex:"#000000",setName:this.viewModel.swatchSetName};r=this.viewModel.originalColor.get()?{hex:this.viewModel.originalColor.get().toHex(),setName:this.viewModel.swatchSetName}:{hex:this.viewModel.defaultColor.get().toHex(),setName:this.viewModel.swatchSetName},this.colorInput.value=r.hex,n.hex!==r.hex&&this.viewModel.colorSwatches.addItem(r),this.viewModel.colorSwatches.addItem(n),this.viewModel.colorSwatches.addItems(i(t.numberOfColorSwatches).map(function(t){return{hex:t,setName:e.viewModel.swatchSetName}})),this.viewModel.colorSwatches.get().forEach(function(t,i){e.colorSwatchFieldSet.children[i].style.backgroundColor=t.hex}),this.colorSwatchFieldSet.querySelector(".color-swatch:first-child > input[type=radio]").checked=!0,this.handleChange()},t.prototype.handleChange=function(){var e=this.viewModel.useColorSwatches.get()?esri.Color.fromHex(this.getSelectedColorSwatch().hex):esri.Color.fromHex(this.colorInput.value);this.viewModel.selectedColor.set(e)},t}(e.framework.ui.ViewBase);t.ColorPickerView=n}(t.ColorPicker||(t.ColorPicker={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){function i(){var e=document.createElement("input");return e.setAttribute("type","color"),"text"!==e.type}var r=function(e){function t(t,i,r){e.call(this,t,i),this.useColorSwatches=new Observable(!0),this.colorSwatches=new ObservableCollection,this.selectedColor=new Observable,this.defaultColor=new Observable,this.originalColor=new Observable,this.swatchSetName=r}return __extends(t,e),t.prototype.initialize=function(e){void 0===e&&(e={}),this.configuration=e,e.alwaysUseColorSwatches=void 0!=e.alwaysUseColorSwatches&&e.alwaysUseColorSwatches,e.numberOfColorSwatches=e.numberOfColorSwatches?6:e.numberOfColorSwatches,this.useColorSwatches.set(e.alwaysUseColorSwatches||!i())},t}(e.framework.ui.ViewModelBase);t.ColorPickerViewModel=r}(t.ColorPicker||(t.ColorPicker={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this.libraryId="Mapping.Infrastructure"}return __extends(t,e),t.prototype.attach=function(e){this.viewModel=e},t.prototype.handlePageFirst=function(e,t,i){this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(1)},t.prototype.handlePagePrev=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()>1){var r=this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()-1;this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handlePageNext=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get()>this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()){var r=this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()+1;this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(r)}},t.prototype.handlePageLast=function(e,t,i){if(this.viewModel.collectionViewModel.presentableResults.currPageNumber.get()<this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get()){var r=this.viewModel.collectionViewModel.presentableResults.lastPageNumber.get();this.viewModel.collectionViewModel.presentableResults.currPageNumber.set(r)}},t}(e.framework.ui.ViewBase);t.PagingControlsView=i}(t.PagingControls||(t.PagingControls={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(t,i){e.call(this,t,"Mapping.Infrastructure"),this.libraryId="Mapping.Infrastructure",this.collectionViewModel=i,this.presentableResults=this.collectionViewModel.presentableResults,this.numberOfItems=this.presentableResults.items.length()}return __extends(t,e),t}(e.framework.ui.ViewModelBase);t.PagingControlsViewModel=i}(t.PagingControls||(t.PagingControls={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this.sliderElement=null,this.sliderMinLabelElement=null,this.sliderMaxLabelElement=null,this._sliderCurrentRawValues=[],this._sliderCurrentHandlePos=[],this._widgetHostElement=null,this._minHandleBindingToken=null,this._maxHandleBindingToken=null,this._isEnabledBindingToken=null,this._isAdded=!1}return __extends(t,e),t.prototype.attach=function(t){t&&(e.prototype.attach.call(this,t),this._isAdded&&this._initializeIfEnabled(this.viewModel.isEnabled.get()))},t.prototype.added=function(t){e.prototype.added.call(this,t),this._isAdded=!0,this._widgetHostElement=t,this._cleanUp(!0),this._isEnabledBindingToken=this.viewModel.isEnabled.bind(this,this._initializeIfEnabled),this._initializeIfEnabled(this.viewModel.isEnabled.get())},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this._cleanUp(!0)},t.prototype.refreshLabelPositions=function(){this._updateLabelPosition(0),this._updateLabelPosition(1)},t.prototype._setupViewModelBindings=function(){var e=this;this._minHandleBindingToken=this.viewModel.sliderMinHandleCurrentItem.bind(this,function(t){return e._setSliderValueAndUpdateLabels(0,e.viewModel.getRawSliderValueForItem(t))}),this.viewModel.range&&(this._maxHandleBindingToken=this.viewModel.sliderMaxHandleCurrentItem.bind(this,function(t){return e._setSliderValueAndUpdateLabels(1,e.viewModel.getRawSliderValueForItem(t))}))},t.prototype._generateJQuerySlider=function(){var e=this,t=this.viewModel,i={animate:t.animate,min:t.isNumeric?t.numericSliderMinVal:0,max:t.isNumeric?t.numericSliderMaxVal:t.items.length()-1,step:t.isNumeric?t.numericSliderStep:1,orientation:"horizontal",range:t.range,slide:function(t,i){return e._handleSliderRawValueSlide(t,i)},change:function(t,i){return e._handleSliderRawValueChange(t,i)}},r=function(){i.range?i.values=[i.min,i.min+i.step]:i.value=i.min},n=function(){if(i.values[0]===i.values[1]){var e=i.values[0]+i.step,t=i.values[0]-i.step;e<=i.max?i.values[1]=e:i.values[0]=t}};if(t.isNumeric&&t.numericSliderHandleStartValues.length)!i.range||isNaN(t.numericSliderHandleStartValues[0])||isNaN(t.numericSliderHandleStartValues[1])?i.range||isNaN(t.numericSliderHandleStartValues[0])?r():i.value=t.numericSliderHandleStartValues[0]:(i.values=t.numericSliderHandleStartValues.slice(0,2),t.lockMinSliderHandleAtMinVal&&(i.values[0]=i.min),n());else if(!t.isNumeric&&t.sliderHandleStartLabels.length){var a=t.getSliderItemByItemLabel(t.sliderHandleStartLabels[0]),s=t.getSliderItemByItemLabel(t.sliderHandleStartLabels[1]);i.range&&a&&s?(i.values=[t.items.indexOf(a)-1,t.items.indexOf(s)-1],t.lockMinSliderHandleAtMinVal&&(i.values[0]=i.min),n()):!i.range&&a?i.value=t.items.indexOf(a)-1:r()}else r();$(this.sliderElement).slider(i);var o=this._widgetHostElement?this._widgetHostElement:this;if(o.isActive)this._applyInitViewModelState(i);else var l=this.app.event("ViewActivatedEvent").subscribe(this,function(t){t===o&&(e.app.event("ViewActivatedEvent").unsubscribe(l),l=null,e._applyInitViewModelState(i))})},t.prototype._applyInitViewModelState=function(e){e.range?(this.viewModel.setSelectedSliderItem(0,this.viewModel.getSliderItemByRawSliderValue(e.values[0])),this.viewModel.setSelectedSliderItem(1,this.viewModel.getSliderItemByRawSliderValue(e.values[1]))):this.viewModel.setSelectedSliderItem(0,this.viewModel.getSliderItemByRawSliderValue(e.value))},t.prototype._handleSliderRawValueChange=function(e,t){var i=this._getSliderHandleIndex(t);this.viewModel.getSliderItemByRawSliderValue(t.value);return this._sliderCurrentRawValues[i]=t.value,!0},t.prototype._handleSliderRawValueSlide=function(e,t){if(!t||!t.handle||void 0===t.value)return!1;var i=this._getSliderHandleIndex(t);if(this.viewModel.range&&this.viewModel.lockMinSliderHandleAtMinVal&&0===i)return!1;var r=this.viewModel.getSliderItemByRawSliderValue(t.value),n=t.value;if(r&&!r.active){var a=this._sliderCurrentRawValues[i];r=void 0===a||t.value>a?this.viewModel.getNextActiveSliderItem(r):this.viewModel.getPreviousActiveSliderItem(r),n=this.viewModel.getRawSliderValueForItem(r)}if(r&&this.viewModel.range){var s=0===i?this.viewModel.sliderMaxHandleCurrentItem.get():this.viewModel.sliderMinHandleCurrentItem.get(),o=0===i?r.value>s.value:r.value<s.value;s&&(o||r.value===s.value)&&(r=0===i?this.viewModel.getPreviousActiveSliderItem(r):this.viewModel.getNextActiveSliderItem(r),n=this.viewModel.getRawSliderValueForItem(r))}return!!r&&(this.viewModel.setSelectedSliderItem(i,r),n===t.value)},t.prototype._getSliderHandleIndex=function(e){var t=0;return e.values&&void 0!==e.values[1]&&(t=e.values[0]===e.values[1]?null===e.handle.nextElementSibling||void 0===e.handle.nextElementSibling?1:0:e.values.indexOf(e.value)),t},t.prototype._setSliderValueAndUpdateLabels=function(e,t){null!==t&&(0!==e&&1!==e||isNaN(parseInt(t,10))?this.app.trace.error("SliderViewBase: Could not set slider values and update UI. Required arguments invalid."):(this._setSliderRawValue(e,t),this._updateLabelPosition(e)))},t.prototype._setSliderRawValue=function(e,t){this.viewModel.range?$(this.sliderElement).slider("values")[e]!==t&&$(this.sliderElement).slider("values",e,t):$(this.sliderElement).slider("value")!==t&&$(this.sliderElement).slider("value",t)},t.prototype._updateLabelPosition=function(e){var t=this;this._updateLabelPositionImpl(e),setTimeout(function(){return t._updateLabelPositionImpl(e)},this.viewModel.animate?400:100)},t.prototype._updateLabelPositionImpl=function(e){if(null!==e&&void 0!==e&&(0===e||1===e)&&(this.viewModel.range||1!==e)){var t=$(".ui-slider-handle",this.sliderElement).toArray();if(0!==t.length){var i=(0===e?$(this.sliderMinLabelElement).width()+5:$(this.sliderMaxLabelElement).width())+5,r=$(this.sliderElement).width(),n=$(t[e]).width(),a=$(t[e]).position().left+$(this.sliderElement).position().left+.5*n-.5*i;a=Math.max($(this.sliderElement).position().left-.5*n,a),a=Math.min(r+$(this.sliderElement).position().left+.5*n-i,a);var s=this._sliderCurrentHandlePos[(e+1)%2],o=(0===e?$(this.sliderMaxLabelElement).width()+5:$(this.sliderMinLabelElement).width())+5;o=o<.5*i?i:o,s=isNaN(s)&&this.viewModel.range?r+$(this.sliderElement).position().left+.5*n-o:s,isNaN(s)||(0===e?(a=s>=i?Math.min(s-i,a):a,a=Math.min(r+$(this.sliderElement).position().left+.5*n-(o+i-5),a)):1===e&&(a=Math.max(s+o+.5*n,a))),this._sliderCurrentHandlePos[e]=a,0===e?this.sliderMinLabelElement.style.left=a+"px":this.sliderMaxLabelElement.style.left=a+"px"}}},t.prototype._processInitRoutine=function(){this._cleanUp(),this._setupViewModelBindings(),this._generateJQuerySlider()},t.prototype._initializeIfEnabled=function(e){e&&this._processInitRoutine()},t.prototype._cleanUp=function(e){void 0===e&&(e=!1),this.sliderElement&&$(this.sliderElement).hasClass("ui-slider")&&$(this.sliderElement).slider("destroy"),this.viewModel&&(this._isEnabledBindingToken&&e&&(this.viewModel.isEnabled.unbind(this._isEnabledBindingToken),this._isEnabledBindingToken=null),this._minHandleBindingToken&&this.viewModel.sliderMinHandleCurrentItem.unbind(this._minHandleBindingToken),this._maxHandleBindingToken&&this.viewModel.sliderMaxHandleCurrentItem.unbind(this._maxHandleBindingToken)),this._sliderCurrentHandlePos=[],this._sliderCurrentRawValues=[],this._minHandleBindingToken=null,this._maxHandleBindingToken=null},t}(e.framework.ui.ViewBase);t.SliderViewBase=i}(t.Slider||(t.Slider={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(t,i,r){e.call(this,t,i),this.items=new ObservableCollection([]),this.sliderMinLabel=new Observable(""),this.sliderMaxLabel=new Observable(""),this.sliderMinHandleLabel=new Observable(""),this.sliderMaxHandleLabel=new Observable(""),this.sliderMinHandleCurrentItem=new Observable(null),this.sliderMaxHandleCurrentItem=new Observable(null),this.range=!1,this.disableSnappingForNumericValues=!0,this.lockMinSliderHandleAtMinVal=!1,this.animate=!1,this.isNumeric=null,this.numericSliderStep=null,this.numericSliderMinVal=null,this.numericSliderMaxVal=null,this.labelGenerator=null,this.itemActivePredicate=null,this.sliderHandleStartLabels=[],this.numericSliderHandleStartValues=[],this.sliderTicks=new ObservableCollection,this.isEnabled=new Observable(!1),this._underlyingCollection=null,this._underlyingCollectionBindingToken=null,this._config=null,this._defaultNumericLabelGenerator=function(e,t){return e+""},this._defaultItemActivePredicate=function(e,t){return!0},this._numericSliderItemCache={},this._maxSliderTicks=50,this._defaultSliderDivisions=5,this.itemActivePredicate=this._defaultItemActivePredicate,r&&this.initialize(r)}return __extends(t,e),t.prototype.initialize=function(e){this._applyConfig(e)},t.prototype.sliderHandleSlide=function(e,t){},t.prototype.setNextSliderItem=function(e){return this._setNextOrPreviousSliderItem(e,"next")},t.prototype.setPreviousSliderItem=function(e){return this._setNextOrPreviousSliderItem(e,"previous")},t.prototype.setSelectedSliderItem=function(e,t){if(0!==e&&1!==e||!t)throw new Error("SliderViewModelBase: Could not set selected slider item.");var i=null;0===e?(i=this.sliderMinHandleCurrentItem.get())&&i.value===t.value||(this.sliderMinHandleLabel.set(t.label),this.sliderMinHandleCurrentItem.set(t)):(i=this.sliderMaxHandleCurrentItem.get())&&i.value===t.value||(this.sliderMaxHandleLabel.set(t.label),this.sliderMaxHandleCurrentItem.set(t)),this.sliderHandleSlide(t,e)},t.prototype.attachToCollection=function(e,t,i,r){var n=this;if(this.cleanUp(),this.isNumeric=!1,!(e&&e instanceof ObservableCollection))throw new Error("SliderViewModelBase: Could not attach to collection.");t&&dojo.isFunction(t)&&(this.labelGenerator=t),r&&r.length&&(this.sliderHandleStartLabels=r.slice(0)),this.itemActivePredicate=i&&dojo.isFunction(i)?i:this._defaultItemActivePredicate,this._underlyingCollection=e,this.items.set(this._underlyingCollection.get().map(function(e,t){return n._createSliderItem(e,t)})),this._underlyingCollectionBindingToken=this._underlyingCollection.bind(this,this._handleUnderlyingCollectionChanges),this._initializeUIObservables()},t.prototype.setupNumericSlider=function(e,t,i,r,n,a){if(this.cleanUp(),this.isNumeric=!0,e=parseFloat(e),t=parseFloat(t),i=parseFloat(i),isNaN(e)||isNaN(t))throw new Error("SliderViewModelBase: Could not set numeric slider range. Minimum and/or maximum values invalid.");if(a&&a.length&&(this.numericSliderHandleStartValues=a.slice(0)),this.numericSliderMinVal=e,this.numericSliderMaxVal=t,this.labelGenerator=r&&dojo.isFunction(r)?r:this._defaultNumericLabelGenerator,this.itemActivePredicate=n&&dojo.isFunction(n)?n:this._defaultItemActivePredicate,this.numericSliderStep=!isNaN(i)&&i<t-e?i:null,null===this.numericSliderStep){var s=t-e;s&&(this.numericSliderStep=s<=1?s/this._defaultSliderDivisions:Math.round(s/this._defaultSliderDivisions))}this._initializeUIObservables()},t.prototype.getSliderItemByRawSliderValue=function(e){if(void 0===e||null===e)return null;var t=null,i=this.isNumeric?e-this.numericSliderMinVal:e;return this.isNumeric?e>=this.numericSliderMinVal&&e<=this.numericSliderMaxVal&&(t=this._getUpdatedNumericItemAndUpdateCache(e,i)):i>-1&&i<this.items.length()&&(t=this.items.getAt(i),this._updateSliderItem(t,i)),t},t.prototype.getSliderItemByItemLabel=function(e){if(!e)return null;var t=null;if(this.isNumeric){if(this.labelGenerator)for(var i=this.numericSliderMinVal,r=0;i<=this.numericSliderMaxVal;i+=this.numericSliderStep,r++)if(this.labelGenerator(i,r)===e){t=this._getUpdatedNumericItemAndUpdateCache(i,r);break}}else for(var n=0,a=this.items.length();n<a;n++){var s=this.items.getAt(n);if(this._updateSliderItem(s,n),s.label===e){t=s;break}}return t},t.prototype.getSliderItemByItemValue=function(e){var t=this;if(void 0===e||null===e||this.isNumeric&&"number"!=typeof e)return null;var i=null;if(this.isNumeric){var r=e-this.numericSliderMinVal;i=this._getUpdatedNumericItemAndUpdateCache(e,r)}else i=(i=this.items.get().filter(function(i,r){return i.value===e&&(t._updateSliderItem(i,r),!0)})[0])||null;return i},t.prototype.getNextSliderItem=function(e){return this._getAdjacentSliderItem(e,"next")},t.prototype.getNextActiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"next","active")},t.prototype.getNextInactiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"next","inactive")},t.prototype.getPreviousSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev")},t.prototype.getPreviousActiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev","active")},t.prototype.getPreviousInactiveSliderItem=function(e){return this._getAdjacentSliderItem(e,"prev","inactive")},t.prototype.getRawSliderValueForItem=function(e){var t=null;if(e)if(this.isNumeric){var i=e.value;i>=this.numericSliderMinVal&&i<=this.numericSliderMaxVal&&(t=i)}else{var r=this.items.get().map(function(e){return e.value}).indexOf(e.value);r>-1&&r<this.items.length()&&(t=r)}return t},t.prototype.cleanUp=function(){this.isEnabled.set(!1),this.labelGenerator=null,this.items.clear(),this.isNumeric=null,this.sliderMaxHandleCurrentItem.set(null),this.sliderMinHandleCurrentItem.set(null),this.sliderMinHandleLabel.set(""),this.sliderMaxHandleLabel.set(""),this.sliderMaxLabel.set(""),this.sliderMinLabel.set(""),this.numericSliderStep=null,this.numericSliderMinVal=null,this.numericSliderMaxVal=null,this._numericSliderItemCache={},this.numericSliderHandleStartValues=[],this.sliderHandleStartLabels=[],this.itemActivePredicate=this._defaultItemActivePredicate,this.sliderTicks.clear(),this._underlyingCollection&&(this._underlyingCollectionBindingToken&&(this._underlyingCollection.unbind(this._underlyingCollectionBindingToken),this._underlyingCollectionBindingToken=null),this._underlyingCollection=null)},t.prototype._setNextOrPreviousSliderItem=function(e,t){if(0!==e&&1!==e)return this.app.trace.error("SliderViewModelBase: Could not set "+t+" slider item. Invalid handle index.Handle index must be 0 or 1."),!1;var i=0===e?this.sliderMinHandleCurrentItem.get():this.sliderMaxHandleCurrentItem.get(),r=0===e?this.sliderMaxHandleCurrentItem.get():this.sliderMinHandleCurrentItem.get();if(!i)return this.app.trace.error("SliderViewModelBase: Could not set "+t+" slider item. Please set current item first."),!1;var n="next"===t?this.getNextActiveSliderItem(i):this.getPreviousActiveSliderItem(i);return!(!n||r&&(!r||r.value===n.value))&&(this.setSelectedSliderItem(e,n),!0)},t.prototype._initializeUIObservables=function(){this._setupSliderTicks(),this._setupSliderMinMaxLabels(),this.isEnabled.set(!0)},t.prototype._setupSliderTicks=function(){this.sliderTicks.clear();var e=this.isNumeric?(this.numericSliderMaxVal-this.numericSliderMinVal)/this.numericSliderStep:this.items.length();e=e>this._maxSliderTicks?this._maxSliderTicks:e;for(var t=Math.round(100/e),i=0;i<100;i+=t)this.sliderTicks.addItem({position:i+"%"})},t.prototype._setupSliderMinMaxLabels=function(){var e=this.isNumeric?this.getSliderItemByItemValue(this.numericSliderMinVal):this.items.getAt(0),t=this.isNumeric?this.getSliderItemByItemValue(this.numericSliderMaxVal):this.items.getAt(this.items.length()-1);this.sliderMinLabel.set(e?e.label:""),this.sliderMaxLabel.set(t?t.label:"")},t.prototype._getAdjacentSliderItem=function(e,t,i){void 0===t&&(t="next"),void 0===i&&(i="any");var r=this.getRawSliderValueForItem(e);if(null===r)return null;var n=null,a=null;do{if(r=this.isNumeric?"prev"===t?r-this.numericSliderStep:r+this.numericSliderStep:"prev"===t?r-1:r+1,a=this.getSliderItemByRawSliderValue(r))switch(i){case"active":n=a.active?a:null;break;case"inactive":n=a.active?null:a;break;default:n=a}}while(a&&!n);return n},t.prototype._applyConfig=function(e){this._config=e||{},this.range=void 0!==this._config.range&&!!this._config.range,this.animate=void 0!==this._config.animate&&!!this._config.animate,this.disableSnappingForNumericValues=void 0===this._config.disableSnappingForNumericValues||!!this._config.disableSnappingForNumericValues,this.lockMinSliderHandleAtMinVal=void 0!==this._config.lockMinSliderHandleAtMinVal&&!!this._config.lockMinSliderHandleAtMinVal},t.prototype._handleUnderlyingCollectionChanges=function(e){var t,i=this;switch(e.type){case"clear":this.items.clear();break;case"insert":t=e.sender.getRange(e.rangeStart,e.rangeEnd),this.items.insertItems(e.rangeStart,t.map(function(t,r){return i._createSliderItem(t,e.rangeStart+r)}));break;case"append":t=e.sender.getRange(e.rangeStart,e.rangeEnd),this.items.addItems(t.map(function(t,r){return i._createSliderItem(t,e.rangeStart+r)}));break;case"remove":this.items.removeRange(e.rangeStart,e.rangeEnd)}this._initializeUIObservables()},t.prototype._createSliderItem=function(e,t){return{value:e,label:this._getItemLabel(e,t),active:this.itemActivePredicate(e,t)}},t.prototype._getItemLabel=function(e,t){var i="";return this.labelGenerator&&(i=null===(i=this.labelGenerator(e,t))||void 0===i?"":i+""),i},t.prototype._updateSliderItem=function(e,t){return e.label=this._getItemLabel(e.value,t),e.active=this.itemActivePredicate(e.value,t),e},t.prototype._getUpdatedNumericItemAndUpdateCache=function(e,t){if(null===e||void 0===e||null===t||void 0===t)return null;var i=this._numericSliderItemCache[e+""];return i?this._updateSliderItem(i,t):i=this._createSliderItem(e,t),this._numericSliderItemCache[e+""]=i,i},t}(e.framework.ui.ViewModelBase);t.SliderViewModelBase=i}(t.Slider||(t.Slider={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e[e.UNSORTED=0]="UNSORTED",e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=2]="DESCENDING"}(e.SortState||(e.SortState={}));e.SortState}(e.Table||(e.Table={}))}(e.components||(e.components={}))}(e.ui||(e.ui={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i){t.call(this,e,i)}return __extends(i,t),i.prototype.attach=function(e){var i=this;t.prototype.attach.call(this,e),this._viewContainerActivatedEventToken||(this._viewContainerActivatedEventToken=this.app.event("ViewContainerActivatedEvent").subscribe(this,function(e){null==i.parentContainer&&i._isViewHostedInContainer(e)&&(i.parentContainer=e)}))},i.prototype._isViewHostedInContainer=function(t){if(t instanceof e.framework.ui.ViewContainer.ViewContainerView){var i=t.viewModel.regionName.get(),r=this.app.viewManager.getRegionForViewId(this.id);if(r&&r.name===i)return!0}return!1},i.prototype.finishWizard=function(){this.parentContainer&&this.parentContainer.finish()},i.prototype.cancelWizard=function(){this.parentContainer&&this.parentContainer.cancel()},i.prototype.destroy=function(){t.prototype.destroy.call(this),this._viewContainerActivatedEventToken&&(this.app.event("ViewContainerActivatedEvent").unsubscribe(this._viewContainerActivatedEventToken),this._viewContainerActivatedEventToken=null),this.parentContainer&&(this.parentContainer=null)},i.prototype._validator=function(){return[]},i.prototype.validate=function(e){return this.validationProblems=this._validator(),this.validationProblems.length<1},i.prototype.reset=function(){this.viewModel.reset()},i.prototype.loadState=function(){},i.prototype.saveState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t]},i.prototype.goNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("This method is abstract")},i.prototype.goBack=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("This method is abstract")},i}(e.framework.ui.ViewBase);t.WizardFragmentView=i}(t.WizardPanel||(t.WizardPanel={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(i){function r(){i.apply(this,arguments),this.resizeY=!1,this.resizeX=!1,this._menuViews={},this._menuItemInvokedSubscriptionToken=null}return __extends(r,i),r.prototype.attach=function(e){var t=this;if(i.prototype.attach.call(this,e),this.configuration.resizableParentRegion)if(this.app.site&&this.app.site.isInitialized){r=this.app.viewManager.getExistingRegionByName(this.configuration.resizableParentRegion);this.resizableRegion=r.domElement}else this.app.event("SiteInitializedEvent").once(this,function(){var e=t.app.viewManager.getExistingRegionByName(t.configuration.resizableParentRegion);t.resizableRegion=e.domElement});else if(this.app.site&&this.app.site.isInitialized){var r=this.app.viewManager.getExistingRegionByName(this.regionName);this.resizableRegion=r.domElement}else this.app.event("SiteInitializedEvent").once(this,function(){var e=t.app.viewManager.getExistingRegionByName(t.regionName);t.resizableRegion=e.domElement});this.viewModel.resizeX?this.resizeX=this.viewModel.resizeX:this.configuration.resizeX&&(this.resizeX=this.configuration.resizeX),this.viewModel.resizeY?this.resizeY=this.viewModel.resizeY:this.configuration.resizeY&&(this.resizeY=this.configuration.resizeY),$(this.app.getHostElement()).on("onclick.handle-resize-error",function(e){$(t.app.getHostElement()).off("mousemove.header-resize touchmove.header-resize"),null!=t.resizePreviewElement.parentNode&&t.resizableRegion.parentNode.removeChild(t.resizePreviewElement)}),this.viewModel.panelMaximized.bind(this,function(e){e?$(t.resizableRegion).attr("data-maximized","true"):$(t.resizableRegion).attr("data-maximized","false")}),this.viewModel.statusRegion?($(this.statusRegionElement).attr("data-region-name",this.viewModel.statusRegion),$(this.statusRegionElement).attr("data-region-adapter",this.viewModel.statusRegionType)):this.statusRegionElement&&this.statusRegionElement.parentNode&&(this.statusRegionElement.parentNode.removeChild(this.statusRegionElement),this.statusRegionElement=null),this._initializeEvents(),this.app.command("MaximizePanel").register(this,function(e){return t._togglePanelMaximized(e,"maximize")},this._canExecuteMaximizeRestoreOperations),this.app.command("RestorePanel").register(this,function(e){return t._togglePanelMaximized(e,"restore")},this._canExecuteMaximizeRestoreOperations)},r.prototype._initializeEvents=function(){var e=this,t=this.app.event("PanelRegionRestoredEvent").subscribe(this,function(t){t===e.resizableRegion&&e.viewModel.panelMaximized.set(!1)}),i=this.app.event("PanelRegionMaximizedEvent").subscribe(this,function(t){t===e.resizableRegion&&e.viewModel.panelMaximized.set(!0)});if(this.trackSubscription(this.app.event("PanelRegionRestoredEvent"),t),this.trackSubscription(this.app.event("PanelRegionMaximizedEvent"),i),this.viewModel.statusRegion){var r=this.app.event("RegionActivatedEvent").subscribe(this,this._handleRegionActivatedOrDeactivated),n=this.app.event("RegionDeactivatedEvent").subscribe(this,this._handleRegionActivatedOrDeactivated);this.trackSubscription(this.app.event("RegionActivatedEvent"),r),this.trackSubscription(this.app.event("RegionDeactivatedEvent"),n)}},r.prototype._handleRegionActivatedOrDeactivated=function(e){var t=this.viewModel?this.viewModel.statusRegion:null;e&&e.name===t&&this.delayedResize()},r.prototype._togglePanelMaximized=function(e,t){e===this.id&&"maximize"===t&&this.maximizePanel(),e===this.id&&"restore"===t&&this.minimizePanel()},r.prototype._canExecuteMaximizeRestoreOperations=function(){return!!this.viewModel.showingMaximizeButton.get()},r.prototype._handleViewActivatedInContainerEvent=function(e){if(i.prototype._handleViewActivatedInContainerEvent.call(this,e),this.viewModel&&this.viewModel.getDescriptorForActiveView(e))if(e instanceof r==!0){e.setParentPanel(this);var t=e.viewModel.currentView;t&&t.viewModel&&t.isActive&&this.hoistMenuForView(t)}else{for(var n,a=this._parentPanel;a;)a.viewModel.headerIsVisible.get()&&(n=a),a=a._parentPanel;if(n)return void n.hoistMenuForView(e);this.hoistMenuForView(e)}},r.prototype.activated=function(){i.prototype.activated.call(this)},r.prototype.deactivated=function(){i.prototype.deactivated.call(this)},r.prototype.destroy=function(){i.prototype.destroy.call(this),this._unsubscribeMenuItemInvokedSubscription();for(var e in this._menuViews)this._menuViews.hasOwnProperty(e)&&this.app.viewManager.destroyView(this._menuViews[e]);this._menuViews=null,this._parentPanel=null},r.prototype.openHoistedMenuInRegion=function(e){this._destroyHoistedMenuOwnerViewIfExists(),this.hoistedMenuOwnerView=this.createMenuView(this.viewModel.hoistedMenuViewModel.get()),this.hoistedMenuOwnerView.regionName=e,this.app.viewManager.activateView(this.hoistedMenuOwnerView)},r.prototype.resolveWidget=function(e,t,i){if("SmartPanelHoistedMenu"===e){if(!this.hoistedMenuId)return;return this._destroyHoistedMenuOwnerViewIfExists(),this.hoistedMenuOwnerView=this.createMenuView(t),this.viewModel.menuRegion?null:this.hoistedMenuOwnerView}return null},r.prototype.createMenuView=function(e){var t=this,i=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/menus/MenuView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.menus.MenuView",libraryId:"Mapping.Infrastructure"});i.libraryId=this.libraryId,i.configuration.menuId=this.hoistedMenuId,e&&(i.attach(e),this.auto(e.hasExecutableMenuItems,this,function(e){e||t.viewModel.menuRegion||t.viewModel.inlineMenuIsOpen.set(!1)})),this._menuViews[i.id]=i,this._unsubscribeMenuItemInvokedSubscription(),this._menuItemInvokedSubscriptionToken=this.app.event("MenuItemInvokedEvent").subscribe(this,function(e){e.menuView.id in t._menuViews&&(t.viewModel.menuRegion||t.viewModel.inlineMenuIsOpen.set(!1),t.app.viewManager.deactivateView(e.menuView))});var r=this.app.event("ViewDeactivatedEvent").subscribe(this,function(e){e===i&&(t.app.event("ViewDeactivatedEvent").unsubscribe(r),e.viewModel=null,t.app.viewManager.destroyView(e),delete t._menuViews[i.id])});return e.menuContext.pulse(),i},r.prototype.handleTapMenuButton=function(){var e=this;if(this.viewModel.menuRegion)if(this.hoistedMenuOwnerView&&this.hoistedMenuOwnerView.regionName===this.viewModel.menuRegion&&this.hoistedMenuOwnerView.isActive){var t=this.hoistedMenuOwnerView.viewModel&&this.hoistedMenuOwnerView.viewModel.menuSourceView;this._destroyHoistedMenuOwnerViewIfExists(),t&&this.app.viewManager.activateView(t)}else this.openHoistedMenuInRegion(this.viewModel.menuRegion);else if(this.viewModel.inlineMenuIsOpen.set(!this.viewModel.inlineMenuIsOpen.get()),this.viewModel.inlineMenuIsOpen.get()){this.app.event("FlyoutActivated").publish(this);var i={view:this.hoistedMenuOwnerView,onOtherInteracted:function(t){e.viewModel.inlineMenuIsOpen.set(!1),e.app.event("FlyoutDeactivated").publish(e)}};this.app.command("TapToDismiss").execute(i)}},r.prototype.hoistMenuForView=function(i){var n=this;if(i!==this.hoistedMenuOwnerView){var a=this.app.menuRegistry.getMenuWidgetsForView(i);if(a&&(a=a.filter(function(e){return e.hoistMenu})),!a||!a.length)return this.viewModel.inlineMenuIsOpen.get()&&this.viewModel.inlineMenuIsOpen.set(!1),this.viewModel.hasHoistedMenu.set(!1),this.viewModel.hoistedMenuViewModel.set(t.SmartPanelViewModel.emptyMenuViewModel),this.viewModel.hasExecutableMenuItems.removeSync(),void this.viewModel.hasExecutableMenuItems.set(!1);var s=a[0],o=new e.essentialsHtmlViewer.mapping.infrastructure.menus.MenuViewModel(this.app,this.libraryId);o.menuSourceView=i,s.context&&s.context.isObservable?o.menuContext.sync(s.context):o.menuContext.sync(s.widgetViewModel.menuContext),this.hoistedMenuId=s.menuId,this.viewModel.hoistedMenuViewModel.set(o),this.viewModel.hasHoistedMenu.set(!0),this.viewModel.hasExecutableMenuItems.sync(o.hasExecutableMenuItems),$(s.domElement).addClass(r.HoistedClassName);var l=this.app.event("ViewUnhostedEvent").subscribe(this,function(e){e.view===i&&(n.app.event("ViewUnhostedEvent").unsubscribe(l),$(s.domElement).removeClass("hidden-hoisted-menu"))})}},r.prototype.setParentPanel=function(e){this._parentPanel=e},r.prototype.handleMaximizeToggleClick=function(e,t,i){this.viewModel.panelMaximized.get()?this.minimizePanel():this.maximizePanel()},r.prototype.maximizePanel=function(){this.viewModel.panelMaximized.set(!0),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish(),this.app.event("PanelRegionMaximizedEvent").publish(this.resizableRegion)},r.prototype.minimizePanel=function(){this.viewModel.panelMaximized.set(!1),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish(),this.app.event("PanelRegionRestoredEvent").publish(this.resizableRegion)},r.prototype._unsubscribeMenuItemInvokedSubscription=function(){this._menuItemInvokedSubscriptionToken&&(this.app.event("MenuItemInvokedEvent").unsubscribe(this._menuItemInvokedSubscriptionToken),this._menuItemInvokedSubscriptionToken=null)},r.prototype.handleHeaderMouseDown=function(e,t,i){var r=this;if(this.viewModel.panelMaximized.get())return!0;if(e.target!==e.currentTarget)return!0;$(this.app.getHostElement()).off("mouseup.header-click touchend.header-click");var n=!0;return $(this.app.getHostElement()).one("mouseup.header-click touchend.header-click",function(){n=!1}),setTimeout(function(){n&&r.resizableRegion&&($(r.app.getHostElement()).off("mouseup.header-click touchend.header-click"),r.resizeSmartPanel(e.pageX,e.pageY),e.preventDefault())},250),e.preventDefault(),e.stopImmediatePropagation(),!0},r.prototype.handleHeaderTouchStart=function(e,t,i){var r=this;if(this.viewModel.panelMaximized.get())return!0;for(var n=e.target||e.srcElement;n!=this.root;){if($(n).is("button")&&!$(n).hasClass("resize-handle"))return!0;n=n.parentElement}$(this.app.getHostElement()).off("touchend.header-click");var a=!0;return $(this.app.getHostElement()).one("touchend.header-click",function(){a=!1}),setTimeout(function(){a&&r.resizableRegion&&(e.preventDefault(),$(r.app.getHostElement()).off("touchend.header-click"),r.resizeSmartPanel(e.targetTouches[0].pageX,e.targetTouches[0].pageY))},250),e.preventDefault(),!0},r.prototype.resize=function(){if(this.headerElement&&this.scrollRegionElement&&this.containerElement){var e=$(this.statusRegionElement),t=$(this.headerElement),i=$(this.footerElement),r=$(this.scrollRegionElement),n=e.length&&"none"!==e.css("display")?e.outerHeight():0,a=t.length&&"none"!==t.css("display")?t.outerHeight():0,s=i.length&&"none"!==i.css("display")?i.outerHeight():0;a+=n,"relative"!==r.css("position")&&r.css("top",a+"px"),r.css("bottom",s+"px")}},r.prototype.resizeSmartPanel=function(e,t){var i=this;if(this.resizeX||this.resizeY){var r={};r.initialX=e,r.initialY=t,this.app.event("PanelResizeStartEvent").publish({viewId:this.id,resizeInformation:r}),null!==this.resizePreviewElement&&void 0!==this.resizePreviewElement||(this.resizePreviewElement=document.createElement("div"),this.resizePreviewElement.className="resize-hint"),null===this.resizePreviewElement.parentElement&&(this.app.getHostElement().appendChild(this.resizePreviewElement),$(this.resizePreviewElement).css("left",this.root.getBoundingClientRect().left)),r.initialPanelHeight=$(this.resizableRegion).height(),r.initialPanelWidth=$(this.resizableRegion).width(),(0===r.initialPanelHeight||r.initialPanelHeight>$(this.resizableRegion.parentElement).height())&&(r.initialPanelHeight=$(this.resizableRegion.parentElement).height()),(0===r.initialPanelWidth||r.initialPanelWidth>$(this.resizableRegion.parentElement).width())&&(r.initialPanelWidth=$(this.resizableRegion.parentElement).width()),this.resizeX?($(this.resizePreviewElement).width(r.initialPanelWidth),$(this.resizePreviewElement).height(r.initialPanelHeight),r.minWidth=parseInt($(this.resizableRegion).css("min-width")),r.maxWidth=parseInt($(this.resizableRegion).css("max-width"))):this.resizeY&&($(this.resizePreviewElement).width(r.initialPanelWidth),$(this.resizePreviewElement).height(r.initialPanelHeight),r.minHeight=parseInt($(this.resizableRegion).css("min-height")),r.maxHeight=parseInt($(this.resizableRegion).css("max-height"))),this._resizeAccordingToSizeConstraints(r,this.resizePreviewElement),$(this.app.getHostElement()).one("mouseup.header-resize touchend.header-resize",function(e){return i._handleResizeEnd(e,r)}),$(this.app.getHostElement()).on("mousemove.header-resize ",function(e){return i.app.event("PanelResizingEvent").publish({viewId:i.id,resizeInformation:r}),r.currentX=e.pageX,r.currentY=e.pageY,i._resizeAccordingToSizeConstraints(r,i.resizePreviewElement),e.preventDefault(),!1}),$(this.app.getHostElement()).on("touchmove.header-resize",function(e){i.app.event("PanelResizingEvent").publish({viewId:i.id,resizeInformation:r});var t=e.originalEvent;return r.currentX=t.targetTouches[0].pageX,r.currentY=t.targetTouches[0].pageY,i._resizeAccordingToSizeConstraints(r,i.resizePreviewElement),e.preventDefault(),!1})}else this.app.trace.debug("This panel is not configured to be resizable!")},r.prototype._handleResizeEnd=function(e,t){$(this.app.getHostElement()).off("mousemove.header-resize touchmove.header-resize"),this.resizePreviewElement.parentNode&&this.resizePreviewElement.parentNode.removeChild(this.resizePreviewElement),this._resizeAccordingToSizeConstraints(t,this.resizableRegion),this.app.event("PanelResizeEndEvent").publish({viewId:this.id,resizeInformation:t}),this.app.command("ResizeShell").execute(),this.app.event("ApplicationResizedEvent").publish()},r.prototype._resizeAccordingToSizeConstraints=function(e,t){if(this.resizeX){var i=e.initialPanelWidth+(e.currentX-e.initialX);i<e.minWidth?$(t).width(e.minWidth):i>e.maxWidth?$(t).width(e.maxWidth):$(t).width(i)}if(this.resizeY){var r=e.initialPanelHeight+(e.initialY-e.currentY);r<e.minHeight?$(t).height(e.minHeight):r>e.maxHeight?$(t).height(e.maxHeight):$(t).height(r)}},r.prototype._destroyHoistedMenuOwnerViewIfExists=function(){if(this.hoistedMenuOwnerView){var e=this.hoistedMenuOwnerView;this.hoistedMenuOwnerView=null,e.viewModel=null,this.app.viewManager.destroyView(e),delete this._menuViews[e.id]}},r.HoistedClassName="hidden-hoisted-menu",r}(e.framework.ui.ViewContainer.ViewContainerView);t.SmartPanelView=i}(t.SmartPanel||(t.SmartPanel={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.finish=function(){this.viewModel.closeAllViews()},t.prototype.cancel=function(){this.viewModel.closeAllViews(!0)},t.prototype.handleClickBack=function(t,i,r){e.prototype.handleClickBack.call(this,t,i,r)},t.prototype.handleClickClose=function(t,i,r){e.prototype.handleClickClose.call(this,t,i,r),this.cancel()},t}(e.ui.components.SmartPanel.SmartPanelView);t.WizardPanelView=i}(t.WizardPanel||(t.WizardPanel={}))}(t.components||(t.components={}))}(e.ui||(e.ui={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){!function(i){!function(i){var r=function(e){function i(r,n){e.call(this,r,n),this.hoistedMenuViewModel=new Observable(i.emptyMenuViewModel),this.hasHoistedMenu=new Observable(!1),this.hasExecutableMenuItems=new Observable(!1),this.inlineMenuIsOpen=new Observable(!1),this.panelMaximized=new Observable(!1),this.showingMaximizeButton=new Observable(!1),this.resizeX=!1,this.resizeY=!1,i.emptyMenuViewModel||(i.emptyMenuViewModel=new t.menus.MenuViewModel(r,n))}return __extends(i,e),i.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.statusRegion=t.statusRegionName,this.statusRegionType=t.statusRegionType||"geocortex.framework.ui.DivRegionAdapter",t.resizeX&&(this.resizeX=t.resizeX),t.resizeY&&(this.resizeY=t.resizeY),this.menuRegion=t.menuRegion||null,void 0!=t.showMaximizeButton&&this.showingMaximizeButton.set(t.showMaximizeButton)},i}(e.framework.ui.ViewContainer.ViewContainerViewModel);i.SmartPanelViewModel=r}(i.SmartPanel||(i.SmartPanel={}))}(i.components||(i.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(t){!function(t){var i=function(e){function t(t,i){e.call(this,t,i)}return __extends(t,e),t.prototype.showOrHideCloseButtons=function(){var e=this.viewDescriptors.getAt(0);if(e){var t=this.currentView===e.view;this.showingBackButton.set(!t),this.showingXButton.set(!0)}},t.prototype.closeAllViews=function(e){for(var t=0;t<this.viewDescriptors.length();t++){var i=this.viewDescriptors.getAt(t).view,r=i.viewModel;this._isWizardFragment(r)&&r.reset(),this.app.viewManager.deactivateView(i)}},t.prototype._isWizardFragment=function(e){return void 0!==e.reset},t}(e.ui.components.SmartPanel.SmartPanelViewModel);t.WizardPanelViewModel=i}(t.WizardPanel||(t.WizardPanel={}))}(t.components||(t.components={}))}(e.ui||(e.ui={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.PENDING="pending",e.COMMITTING="committing",e.COMMITTED="committed",e.ABORTING="aborting",e.ABORTED="aborted"}(e.TransactionStatus||(e.TransactionStatus={}))}(e.undo||(e.undo={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e[e.SCALE=0]="SCALE",e[e.CENTER=1]="CENTER",e[e.EXTENT=2]="EXTENT"}(e.ExtentLinkPriority||(e.ExtentLinkPriority={}));e.ExtentLinkPriority;!function(e){e[e.LAYERTHEME=0]="LAYERTHEME",e[e.LAYERS=1]="LAYERS"}(e.LayerListLinkPriority||(e.LayerListLinkPriority={}));e.LayerListLinkPriority;var t=function(){function e(e,t){this.acceptParameter=!0,this.generateParameter=!0,this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){},e.prototype.generate=function(){return""},e.prototype.apply=function(e){},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();e.SharingLinkProviderBase=t}(e.sharing||(e.sharing={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function i(t,i){e.call(this,t,i),this.menuTitle=new Observable(""),this.menuDescription=new Observable(""),this.menuItems=new ObservableCollection([]),this.visibleMenuItems=new ObservableCollection([]),this.hasExecutableMenuItems=new Observable(!1),this.menuContext=new Observable(null),this.auto(this.menuContext,this,this._handleContextChanged),this.auto(this.menuItems,this,this._handleMenuItemsChanged)}return __extends(i,e),i.prototype.initialize=function(t){e.prototype.initialize.call(this,t),this.menuId=t&&t.menuId||null,this.libraryId=t&&t.libraryId||this.libraryId},i.prototype.setupMenu=function(e){var i=this;if(this.menuId=e||this.menuId,this.menuId){this.menuItems.clear();var r=this.app.menuRegistry.getMenu(this.menuId);if(r){if(r.title&&this.menuTitle.set(r.title),r.description&&this.menuDescription.set(r.description),r.items&&r.items.length){var n=[];r.items.forEach(function(e){var r=new t.MenuItemViewModel(i,e);n.push(r),i.auto(r.canExecute,i,i._computeExecutableMenuItems)}),this.menuItems.addItems(n)}}else this.app.trace.error("MenuViewModel: Could not load menu '{0}'. Menu not registered.".format(this.menuId))}else this.app.trace.error("MenuViewModel: Could not load menu. Menu id not specified.")},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.menuItems.get().forEach(function(e){return e.destroy()}),this.menuItems.clear(),this.visibleMenuItems.clear()},i.prototype._computeExecutableMenuItems=function(){var e=!1,t=[];this.visibleMenuItems.clear();for(var i=0;i<this.menuItems.length();i++){var r=this.menuItems.getAt(i);r.canExecute.get()?(e=!0,t.push(r)):r.menuItem.hideOnDisable||t.push(r)}this.visibleMenuItems.set(t),this.hasExecutableMenuItems.set(e)},i.prototype._handleContextChanged=function(e){this.menuItems.get().forEach(function(e){return e.refreshCanExecute()})},i.prototype._handleMenuItemsChanged=function(e){if("clear"===e.type)this.visibleMenuItems.clear();else if("append"===e.type)this._computeExecutableMenuItems();else if("remove"===e.type)for(var t=e.sender.get().slice(e.rangeStart,e.rangeEnd+1),i=0;i<t.length;i++)this.visibleMenuItems.removeItem(t[i]);else"insert"===e.type&&this._computeExecutableMenuItems()},i.DefaultParameterName="context",i}(e.framework.ui.ViewModelBase);t.MenuViewModel=i}(t.menus||(t.menus={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t){this.stateDefinition=e,this.activatedBy=t}}();e.ActiveState=t}(e.applicationState||(e.applicationState={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,i){this.registeredStates=[],this.activeStates=[],this.modalState=null,this.previousModalState=null,this.commandTokens=[],this.eventTokens=[],this.app=t,this.libraryId=i;for(var r=0;r<e.definedStates.length;r++)this.registerState(e.definedStates[r])}return t.prototype.registerState=function(t){var i=this;if(this.registeredStates.some(function(e){return e.name===t.name}))this.app.trace.info("States with duplicate names registered! New state ignored. Name is: "+t.name);else if(this.registeredStates.filter(function(e){return e.hasOwnProperty("parentState")}).some(function(e){return e.name===t.parentState}))this.app.trace.info("Tried to load a state with a parent that references another state that has a parent. Only parent -> child relationships are allowed. State name: "+t.name);else{var r=dojo.connect(this.app,"onLibrariesDownloaded",this,function(){dojo.disconnect(r),i.app.hasLibrary(i.libraryId)&&-1===t.description.search(" ")&&(t.description=i.app.getResource(i.libraryId,t.description))});t.enterCommands&&t.enterCommands.forEach(function(e){var r=i.app.command(e.name).register(i,function(r){return i._stateEntered(t,e,r)});i.commandTokens.push({instance:e,token:r})}),t.exitCommands&&t.exitCommands.forEach(function(e){var r=i.app.command(e.name).register(i,function(r){return i._stateExited(t,e,r)});i.commandTokens.push({instance:e,token:r})}),t.enterEvents&&t.enterEvents.forEach(function(e){var r=i.app.event(e.name).subscribe(i,function(r){return i._stateEntered(t,e,r)});i.eventTokens.push({instance:e,token:r})}),t.exitEvents&&t.exitEvents.forEach(function(e){var r=i.app.event(e.name).subscribe(i,function(r){return i._stateExited(t,e,r)});i.eventTokens.push({instance:e,token:r})}),this.registeredStates.push(t),"DefaultState"===t.name&&this.activeStates.push(new e.ActiveState(t))}},t.prototype.onDestroy=function(){for(e=0;e<this.eventTokens.length;e++)this.app.event(this.eventTokens[e].instance.name).unsubscribe(this.eventTokens[e].token);for(var e=0;e<this.commandTokens.length;e++)this.app.command(this.commandTokens[e].instance.name).unregister(this.commandTokens[e].token)},t.prototype.getActiveStates=function(){for(var e=[],t=0;t<this.activeStates.length;t++)e[this.activeStates[t].stateDefinition.name]=this.activeStates[t];return this.activeStates.filter(function(t){return t.stateDefinition.parentState&&e[t.stateDefinition.parentState]||!t.stateDefinition.parentState})},t.prototype.getStateByName=function(e){for(var t=0;t<this.registeredStates.length;t++)if(this.registeredStates[t].name===e)return this.registeredStates[t];return null},t.prototype.getModalState=function(){return this.modalState||null},t.prototype.isModalStateActive=function(){return null!==this.modalState},t.prototype.isCurrentlyActive=function(e){return this.activeStates.some(function(t){return t.stateDefinition.name===e})},t.prototype.getAllStateNames=function(){for(var e=[],t=0;t<this.registeredStates.length;t++)e.push(this.registeredStates[t].name);return e},t.prototype._stateEntered=function(t,i,r){if((!t.parentState||this.activeStates.some(function(e){return e.stateDefinition.name===t.parentState}))&&!(this.isCurrentlyActive(t.name)||i.parameter&&i.parameter!==r)){var n=null;("string"==typeof r||r instanceof String)&&(n=r),this.app.trace.debug("State entered: "+t.name),t.isModal&&(null!==this.modalState&&(this.previousModalState=this.modalState,this._exitState(this.modalState,i,n)),this.app.trace.debug("Modal State entered: "+t.name),this.modalState=t),this.activeStates.push(new e.ActiveState(t,i)),this.app.event("StateEnteredEvent").publish({stateDefinition:t,activeStates:this.activeStates,modalState:this.modalState,previousModalState:this.modalState})}},t.prototype._stateExited=function(e,t,i){if(!t.parameter||t.parameter===i){for(var r=!1,n=0;n<this.activeStates.length;n++)this.activeStates[n].stateDefinition===e&&(r=!0);var a=!1;if(e.parentState&&(a=this.activeStates.some(function(t){return t.stateDefinition.name===e.parentState})),r&&(!e.parentState||a)){var s=null;("string"==typeof i||i instanceof String)&&(s=i),this._exitState(e,t,s)}}},t.prototype._exitState=function(e,t,i){this._exitChildStates(e,t,i);for(var r=this.activeStates.length-1;r>=0;r--)this.activeStates[r].stateDefinition===e&&(this.activeStates.splice(r,1),this.app.trace.debug("State exited: "+e.name));this.modalState===e&&(this.modalState=null,this.previousModalState=e,this.app.trace.debug("Modal state exited: "+e.name)),this.app.event("StateExitedEvent").publish({stateDefinition:e,activeStates:this.activeStates,modalState:this.modalState,previousModalState:this.previousModalState})},t.prototype._exitChildStates=function(e,t,i){for(var r=[],n=0;n<this.activeStates.length;n++)if(this.activeStates[n].stateDefinition.parentState===e.name){var a=this.activeStates[n].stateDefinition;if(a.exitCommands)for(s=0;s<a.exitCommands.length;s++)a.exitCommands[s].name!==t.name||a.exitCommands[s].parameter&&a.exitCommands[s].parameter!==i||r.push(a);if(a.exitEvents)for(var s=0;s<a.exitEvents.length;s++)a.exitEvents[s].name!==t.name||a.exitEvents[s].parameter&&a.exitEvents[s].parameter!==i||r.push(a)}for(n=0;n<r.length;n++)this._exitState(r[n],t,i)},t}();e.StateManager=t}(e.applicationState||(e.applicationState={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e.definedStates=[{name:"DefaultState",description:"language-states-default-description",isModal:!1},{name:"TransientActiveState",description:"language-states-transient-active-description",isModal:!1,enterEvents:[{name:"TransientActivatedEvent"}],exitEvents:[{name:"TransientsDeactivatedEvent"}]},{name:"IdentifyState",description:"language-states-identify-state-description",isModal:!1,enterCommands:[{name:"SetActiveTool",parameter:"PointIdentifyTool-Navigation"},{name:"SetActiveTool",parameter:"IdentifyRectangleTool"},{name:"SetActiveTool",parameter:"RectangleIdentifyTool"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"Identify"}]},{name:"IdentifyBufferingState",parentState:"IdentifyState",description:"language-states-buffering-description",isModal:!1,enterEvents:[{name:"BufferingActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"BufferingDeactivatedEvent",parameter:"Identify"}]},{name:"PlotCoordinatesState",description:"language-states-plotcoordinates-state-description",isModal:!1,enterCommands:[{name:"SetActiveTool",parameter:"PlotCoordinatesTool"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"PlotCoordinates"}]},{name:"SnappingState",description:"language-states-snapping-description",isModal:!1,enterCommands:[{name:"ActivateSnapping"}],exitCommands:[{name:"DeactivateSnapping"}]},{name:"FindDataState",description:"language-states-identify-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"Identify"}]},{name:"FindDataBufferingState",parentState:"FindDataState",description:"language-states-buffering-description",isModal:!1,enterEvents:[{name:"BufferingActivatedEvent",parameter:"Identify"}],exitEvents:[{name:"BufferingDeactivatedEvent",parameter:"Identify"}]},{name:"DrawMarkupState",description:"language-states-draw-markup-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"AddMarkup"},{name:"ToolCommandActivatedEvent",parameter:"AddTextMarkup"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"AddMarkup"},{name:"ToolCommandDeactivatedEvent",parameter:"AddTextMarkup"}]},{name:"MeasureState",description:"language-states-measure-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"MeasureDistance"},{name:"ToolCommandActivatedEvent",parameter:"MeasureArea"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"MeasureDistance"},{name:"ToolCommandDeactivatedEvent",parameter:"MeasureArea"}]},{name:"SelectMarkupForEditingState",description:"language-states-edit-state-description",isModal:!0,enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"DeleteMeasurement"},{name:"ToolCommandActivatedEvent",parameter:"DeleteMarkup"},{name:"ToolCommandActivatedEvent",parameter:"EditMarkup"}],exitEvents:[{name:"ToolCommandDeactivatedEvent",parameter:"DeleteMeasurement"},{name:"ToolCommandDeactivatedEvent",parameter:"DeleteMarkup"},{name:"ToolCommandDeactivatedEvent",parameter:"EditMarkup"}]},{name:"EditorActiveState",description:"language-states-editing-active-state-description",isModal:!1,enterCommands:[{name:"StartEditingFeature"},{name:"StartEditingNewFeature"},{name:"StartEditingNewRelatedRecord"}],exitEvents:[{name:"EditorClosedEvent"}]},{name:"EditingMarkupState",description:"language-states-editing-state-description",isModal:!1,enterEvents:[{name:"MarkupEditingStartedEvent"}],exitEvents:[{name:"MarkupEditingStoppedEvent"}]},{name:"EditingMeasurementMarkupState",description:"language-states-editing-state-description",isModal:!1,enterEvents:[{name:"MeasurementEditingStartedEvent"}],exitEvents:[{name:"MarkupEditingStoppedEvent"}]},{name:"FeaturePlacementState",description:"language-states-feature-editing-state-description",isModal:!0,enterEvents:[{name:"StartFeaturePlacementEvent"},{name:"ToolCommandActivatedEvent",parameter:"SetEditorFeatureGeometry"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"FeaturePlacementGraphicState",parentState:"FeaturePlacementState",description:"language-states-feature-editing-state-graphic-description",isModal:!1,enterCommands:[{name:"StartEditingGraphicGeometry"}],enterEvents:[{name:"ToolCommandActivatedEvent",parameter:"SetEditorFeatureGeometry"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]},{name:"FeaturePlacementPointGraphicState",parentState:"FeaturePlacementState",description:"language-states-feature-editing-state-point-graphic-description",isModal:!1,enterEvents:[{name:"GeometryEditPointActivatedEvent"}],exitEvents:[{name:"StopFeaturePlacementEvent"},{name:"ToolCommandDeactivatedEvent",parameter:"SetEditorFeatureGeometry"}]}]}(e.applicationState||(e.applicationState={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){function r(e){var t=null;if(e instanceof esri.layers.ArcGISDynamicMapServiceLayer)(i=e).gdbVersion&&(t=i.gdbVersion);else if(e instanceof esri.layers.FeatureLayer){var i=e;i.gdbVersion&&(t=i.gdbVersion)}return t}function n(e,t){var i=null,r=t.mapService.getDynamicLayerInfoById(t.id);if(r&&r.source&&(r.source instanceof esri.layers.LayerDataSource||r.source instanceof esri.layers.LayerMapSource)){(i=new c).source=r.source.toJson(),r.id&&(i.id=r.id);var n=t.getDefinitionExpression(t.mapService.serviceLayer);return n&&(i.definitionExpression=n),i}throw new Error("A dynamic layer must have a DataSource!")}function a(t,i){if(!t)return null;if(!i)return t;if(i.mapServiceType===e.essentials.MapServiceType.WMS){var r=e.essentials.RestHelperHTTPService.getTokenForScope(i.url);r&&(t+=t.indexOf("?")>-1?"&token=":"?token=",t+=encodeURIComponent(r))}else i.serviceToken&&!/.*token=.*/.test(t)&&(t+=t.indexOf("?")>-1?"&token=":"?token=",t+=encodeURIComponent(i.serviceToken));return t}function s(e){return!!e&&!(!e.identifiable||!e.supportsIdentify)}function o(e){return!!e&&!(!e.queryable||!e.supportsQuery)}function l(t){if(!t||!t.serviceLayer)return!1;if(t.mapServiceType===e.essentials.MapServiceType.WMS){for(var i=0;i<t.layers.length;i++)if(o(t.layers[i]))return!0;return!1}var r=t.serviceLayer;return!!r.capabilities&&(r.version<10||r.capabilities&&r.capabilities.indexOf("Query")>=0)}var c=function(){return function(){}}();i.getQueryTaskUrl=function(t,i){var r,s=null,o=null;if(t instanceof e.essentials.Layer?(r=(s=t).mapService,i&&(o=i.serviceLayer)):t instanceof esri.layers.Layer&&(o=t,i&&(r=i)),o instanceof esri.layers.FeatureLayer&&"table"===o.type||o instanceof esri.layers.FeatureLayer&&!r)return o.url;if(!l(r))return null;var c=null;if(o instanceof esri.layers.WMSLayer){if(!s)return null;c=s.url}else s?c=s.mapService.serviceLayer.url:o&&(c=o.url);var u,p=null;if(s?s.isDynamic?(u="dynamicLayer",p=n(0,s)):u=s.id:o&&(u=o.id),!(o instanceof esri.layers.FeatureLayer||c.match(/\/\d+(\?.*)?$/))){var h=c.indexOf("?"),d=c.indexOf("#");-1!=h?c=c.substring(0,h)+"/"+u+c.substring(h):-1!=d?c=c.substring(0,d)+"/"+u+c.substring(d):c+="/"+u}return c=a(c,i),p&&(c+=c.indexOf("?")>-1?"&layer=":"?layer=",c+=encodeURIComponent(JSON.stringify(p))),c},i.getQueryTask=function(t,n){var a=null,s=null,o=null,l=null;if(t instanceof esri.layers.Layer)s=t,n&&(o=n);else{if(!(t instanceof e.essentials.Layer&&t.mapService&&t.mapService.serviceLayer))throw new Error("Cannot generate a QueryTask from the given parameters.");s=t.mapService.serviceLayer,o=t.mapService,l=t}if(s){var c=r(s);c&&(a={gdbVersion:c})}return new esri.tasks.QueryTask(i.getQueryTaskUrl(l||s,o),a)},i.getIdentifyTaskUrl=function(t){if(!t||!t.serviceUrl)return null;if(t.mapServiceType===e.essentials.MapServiceType.WMS){for(var i=0;i<t.layers.length;i++)if(s(t.layers[i]))return a(t.url,t);return null}return l(t)?t instanceof e.essentials.FeatureLayerService?t.serviceUrl.substring(0,t.serviceUrl.lastIndexOf("/")).replace(/FeatureServer$/i,"MapServer"):t.mapServiceType==e.essentials.MapServiceType.DYNAMIC||t.mapServiceType==e.essentials.MapServiceType.TILED?a(t.serviceUrl,t):null:null},i.getIdentifyTask=function(e){var t=null;if(e.serviceLayer){var n=r(e.serviceLayer);n&&(t={gdbVersion:n})}return new esri.tasks.IdentifyTask(i.getIdentifyTaskUrl(e),t)},i.getTokenizedUrl=a,i.canIdentifyLayer=s,i.canQueryLayer=o,i.canQueryMapService=l,i.getSearchTextWhereClause=function(i,r,n,a){if(!i||!r||0==r.length||!n)return"";for(var s=String(n).toLowerCase(),o="",l=0;l<r.length;l++){var c=r[l];if(c.searchable&&"gml:id"!==c.name)if(c.isCodedValueDomain()||c.hasSubtypeCodedValueDomains()){var u=[],p=c.getCodedValueDomain();p&&p.codedValues.forEach(function(e){return u.push(e)});var h=c.getSubtypeCodedValueDomains();for(var d in h)h.hasOwnProperty(d)&&h[d].codedValues.forEach(function(e){return u.push(e)});u.forEach(function(t){t.name.toLowerCase().indexOf(s)>-1&&(o.length>0&&(o+=" OR "),c.type===e.essentials.EsriFieldTypes.esriFieldTypeString?o+=encodeURI(c.name)+" = '"+t.code.replace("'","''")+"'":o+=encodeURI(c.name)+" = "+t.code)})}else switch(c.type){case e.essentials.EsriFieldTypes.esriFieldTypeString:o.length>0&&(o+=" OR "),i.mapService.serviceLayer instanceof esri.layers.WMSLayer?o+=encodeURI(c.name)+" LIKE '%"+n.replace("'","''")+"%'":o+="LOWER("+c.name+") LIKE '%"+s.replace("'","''")+"%'";break;case e.essentials.EsriFieldTypes.esriFieldTypeSmallInteger:case e.essentials.EsriFieldTypes.esriFieldTypeInteger:case e.essentials.EsriFieldTypes.esriFieldTypeOID:case e.essentials.EsriFieldTypes.esriFieldTypeSingle:case e.essentials.EsriFieldTypes.esriFieldTypeDouble:var m=[t.NumberFormat.ACCOUNTING,t.NumberFormat.CURRENCY,t.NumberFormat.FIXED_POINT,t.NumberFormat.NUMBER,t.NumberFormat.PERCENT,t.NumberFormat.ROUND_TRIP],g=t.FormatUtils.parseNumber(n,m);if(isNaN(g))break;o.length>0&&(o+=" OR ");var f,y=t.FormatUtils.formatNumber(g,t.NumberFormat.ROUND_TRIP);if(y.indexOf(".")){var b=y.length-y.indexOf(".")-1;f=Math.pow(10,-b)}else f=1;var v,I;g<0?(v=t.FormatUtils.formatNumber(g-f,t.NumberFormat.ROUND_TRIP),I=y):(v=y,I=t.FormatUtils.formatNumber(g+f,t.NumberFormat.ROUND_TRIP)),o+="("+encodeURI(c.name.toLowerCase())+" <= "+I+" AND "+encodeURI(c.name.toLowerCase())+" >= "+v+")";break;case e.essentials.EsriFieldTypes.esriFieldTypeDate:break;case e.essentials.EsriFieldTypes.esriFieldTypeGlobalID:case e.essentials.EsriFieldTypes.esriFieldTypeBlob:break;default:a&&a.warning("Unhandled layer data type: '{0}'. Field '{1}' in layer '{2}' has been excluded from search.".format(c.type,c.alias,i.displayName))}}var S=i.getDefinitionExpression(i.mapService.serviceLayer);return S&&(o="("+o+") AND ("+S+")"),o}}(t.taskUtils||(t.taskUtils={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){!function(e){e[e.TOGGLE_BUTTON_OFF=0]="TOGGLE_BUTTON_OFF",e[e.TOGGLE_BUTTON_ON=1]="TOGGLE_BUTTON_ON"}(t.ToggleButtonState||(t.ToggleButtonState={}));var i=t.ToggleButtonState,r=function(t){function r(r,n,a){var s=this;t.call(this,r,n,a),this.state=new Observable(null),this.toggleButtonEntry=a,this.toggleOnCommand=new e.CommandViewModel(this.app,n,a.toggleOn.command,a.toggleOn.commandParameter),this.toggleOffCommand=new e.CommandViewModel(this.app,n,a.toggleOff.command,a.toggleOff.commandParameter),this.isToggledOn=new Observable(!1),this.iconUri=new Observable(null),this.state.bind(this,function(e){return s.setState(e)}),this.toggleButtonEntry.toggleStateName&&""!==this.toggleButtonEntry.toggleStateName?(this.app.event("StateEnteredEvent").subscribe(this,function(e){e.stateDefinition.name===s.toggleButtonEntry.toggleStateName&&s.state.set(i.TOGGLE_BUTTON_ON),s.isToggledOn.get()&&"TransientActiveState"===e.stateDefinition.name&&s.activeTransient.set(!0)}),this.app.event("StateExitedEvent").subscribe(this,function(e){e.stateDefinition.name===s.toggleButtonEntry.toggleStateName&&s.state.set(i.TOGGLE_BUTTON_OFF),"TransientActiveState"===e.stateDefinition.name&&s.activeTransient.set(!1)})):this._setUpBindings(),this.app.site&&this.app.site.isInitialized||this.app.event("SiteInitializedEvent").once(this,function(){s.toggleOffCommand.commandName&&s.app.command(s.toggleOffCommand.commandName).raiseCanExecuteChanged(),s.toggleOnCommand.commandName&&s.app.command(s.toggleOnCommand.commandName).raiseCanExecuteChanged(),s.state.get()===i.TOGGLE_BUTTON_OFF?s.disabled.set(!s.toggleOffCommand.canExecute.get()):s.disabled.set(!s.toggleOnCommand.canExecute.get())}),a.toggleStateName&&this.app.stateManager.isCurrentlyActive(a.toggleStateName)?this.state.set(i.TOGGLE_BUTTON_ON):this.state.set(i.TOGGLE_BUTTON_OFF)}return __extends(r,t),r.prototype.execute=function(){this.command&&this.command.commandName&&(this.command.commandParameter?this.app.commandRegistry.command(this.command.commandName).execute(this.command.commandParameter):this.app.commandRegistry.command(this.command.commandName).execute())},r.prototype.setState=function(e){if(e===i.TOGGLE_BUTTON_OFF)var t=this.toggleButtonEntry.toggleOn.name||this.toggleButtonEntry.name||"",r=this.toggleButtonEntry.toggleOn.iconUri||this.toggleButtonEntry.iconUri||null,n=this.toggleButtonEntry.toggleOn.tooltip||this.toggleButtonEntry.tooltip||null,a=void 0!=this.toggleButtonEntry.toggleOn.hideOnDisable?!!this.toggleButtonEntry.toggleOn.hideOnDisable:!!this.toggleButtonEntry.hideOnDisable,s=!1;else var t=this.toggleButtonEntry.toggleOff.name||this.toggleButtonEntry.name||"",r=this.toggleButtonEntry.toggleOff.iconUri||this.toggleButtonEntry.iconUri||null,n=this.toggleButtonEntry.toggleOff.tooltip||this.toggleButtonEntry.tooltip||null,a=void 0!=this.toggleButtonEntry.toggleOff.hideOnDisable?!!this.toggleButtonEntry.toggleOff.hideOnDisable:!!this.toggleButtonEntry.hideOnDisable,s=!0;this.name.set(t),this.isToggledOn.set(s),this.iconUri.set(r),this.tooltip.set(n),this.command=e===i.TOGGLE_BUTTON_OFF?this.toggleOnCommand:this.toggleOffCommand,this.disabled.set(!this.command.canExecute.get()),this.hideOnDisable.set(a),this.setHidden(),this.app.event("ToggleButtonStateChangedEvent").publish({toggleButtonEntry:this.toggleButtonEntry,state:e})},r.prototype.onDestroy=function(){this._disconnectBindings()},r.prototype._setUpBindings=function(){var e=this;this._toggleOnCommandCanExecuteBindingToken=this.toggleOnCommand.canExecute.bind(this,function(t){return e._handleCommandCanExecuteChanged(e.toggleOnCommand,t)}),this._toggleOnCommandPostExecSubscriptionToken=this.app.command(this.toggleButtonEntry.toggleOn.command).postExecute.subscribe(this,this._handleToggleOnCommandPostExecute),this._toggleOffCommandCanExecuteBindingToken=this.toggleOffCommand.canExecute.bind(this,function(t){return e._handleCommandCanExecuteChanged(e.toggleOffCommand,t)}),this._toggleOffCommandPostExecSubscriptionToken=this.app.command(this.toggleButtonEntry.toggleOff.command).postExecute.subscribe(this,this._handleToggleOffCommandPostExecute)},r.prototype._disconnectBindings=function(){this.toggleOnCommand.canExecute.unbind(this._toggleOnCommandCanExecuteBindingToken),this.app.command(this.toggleButtonEntry.toggleOn.command).postExecute.unsubscribe(this._toggleOnCommandPostExecSubscriptionToken),this.toggleOffCommand.canExecute.unbind(this._toggleOffCommandCanExecuteBindingToken),this.app.command(this.toggleButtonEntry.toggleOff.command).postExecute.unsubscribe(this._toggleOffCommandPostExecSubscriptionToken)},r.prototype._handleToggleOnCommandPostExecute=function(e){e&&this.command.commandParameter!==e||this.state.get()!==i.TOGGLE_BUTTON_ON&&this.state.set(i.TOGGLE_BUTTON_ON)},r.prototype._handleToggleOffCommandPostExecute=function(e){e&&this.command.commandParameter!==e||this.state.get()!==i.TOGGLE_BUTTON_OFF&&this.state.set(i.TOGGLE_BUTTON_OFF)},r.prototype._handleCommandCanExecuteChanged=function(e,t){this.command===e&&(this.disabled.set(!t),this.setHidden())},r}(t.ToolbarGroupItemBase);t.ToolbarToggleButton=r}(e.toolbarGroup||(e.toolbarGroup={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i,r){var n=this;t.call(this,e,i,r),r.layout&&"small"===r.layout.toLowerCase()&&this.hasSmallLayout.set(!0),this.items=new ObservableCollection;for(var a=0;a<r.items.length;a++){var s=this.getToolbarItemType(r.items[a]);s&&this.items.addItem(s)}this.disabled.set(this.areAllHidden(this.items)),this.setHidden(),this.disabled.bind(this,function(e){n.setHidden()})}return __extends(i,t),i.prototype.getToolbarItemType=function(t){return"button"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarButton(this.app,this.libraryId,t):"toggleButton"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarToggleButton(this.app,this.libraryId,t):"region"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarRegion(this.app,this.libraryId,t):"tool"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarTool(this.app,this.libraryId,t):"toolbarGroup"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarGroup(this.app,this.libraryId,t):"flyout"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarFlyout(this.app,this.libraryId,t):void 0},i}(t.ToolbarGroupItemBase);t.ToolbarGroup=i}(t.toolbarGroup||(t.toolbarGroup={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(i){function r(e,t,r){var n=this;i.call(this,e,t,r),this.flyoutButtonDescription=new Observable(""),this.selectedTool.set(this.items.getAt(0)),this.flyoutButtonDescription.set(this.app.getResource(this.libraryId,"language-toolbar-flyout-description").format(this.name.get())),this.app.event("ActiveToolChangedEvent").subscribe(this,function(e){var t=n.items.get().filter(function(t){return n._seeIfActiveToolIsInFlyout(t,e)});t.length>0&&n.selectedTool.set(t[0])})}return __extends(r,i),r.prototype._seeIfActiveToolIsInFlyout=function(e,i){if(!(e.tool instanceof t.tools.MapTool))return!1;var r=e.tool;if(i.tool instanceof t.tools.MapTool){var n=i.tool;return r.command===n.command&&r.drawMode===n.drawMode}return!1},r.prototype.toggleFlyout=function(){this.toolChangeActive.set(!this.toolChangeActive.get())},r.prototype.switchActiveFlyoutTool=function(e){"tool"===e.type&&this.selectedTool.set(e),e.execute()},r.prototype.getToolbarItemType=function(t){return"button"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarButton(this.app,this.libraryId,t):"toggleButton"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarToggleButton(this.app,this.libraryId,t):"region"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarRegion(this.app,this.libraryId,t):"tool"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarTool(this.app,this.libraryId,t):"toolbarGroup"==t.type?new e.essentialsHtmlViewer.mapping.infrastructure.toolbarGroup.ToolbarGroup(this.app,this.libraryId,t):null},r}(i.ToolbarGroup);i.ToolbarFlyout=r}(t.toolbarGroup||(t.toolbarGroup={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(t){!function(t){var i=function(t){function i(i,r,n){var a=this;t.call(this,i,r,n);var s=n.command,o=n.commandParameter;this.command=new e.modules.command.CommandViewModel(this.app,void 0,s,o),this.disabled.set(!this.command.canExecute.get()),this.setHidden(),this.command.canExecute.bind(this,function(e){a.disabled.set(!e),a.setHidden()}),this.iconUri=new Observable(n.iconUri),this.app.site&&this.app.site.isInitialized||this.app.event("SiteInitializedEvent").once(this,this._raiseCommandCanExecuteChanged)}return __extends(i,t),i.prototype.execute=function(){this.command&&this.command.commandName&&(this.command.commandParameter?this.app.commandRegistry.command(this.command.commandName).execute(this.command.commandParameter):this.app.commandRegistry.command(this.command.commandName).execute());var e={commandName:this.command.commandName,commandParameter:this.command.commandParameter,id:this.id,name:this.name.get(),libraryId:this.libraryId};this.app.event("ToolbarButtonClickedEvent").publish(e)},i.prototype._raiseCommandCanExecuteChanged=function(){this.command.commandName&&this.app.command(this.command.commandName).raiseCanExecuteChanged()},i}(t.ToolbarGroupItemBase);t.ToolbarButton=i}(t.toolbarGroup||(t.toolbarGroup={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,i,r){e.call(this,t,i,r),this.regionName=r.regionName}return __extends(t,e),t}(e.ToolbarGroupItemBase);e.ToolbarRegion=t}(e.toolbarGroup||(e.toolbarGroup={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,i,r){var n=this;if(e.call(this,t,i,r),r){var a={};for(var s in r){if(!s)break;a[s]=r[s]}a.name=r.id;var o=[];o.push(a),this.app.allLibrariesLoaded?this._initializeTool(o):(this.disabled.set(!0),this.setHidden(),this.app.event("ViewerLibrariesDownloadedEvent").once(this,function(){n.disabled.set(!1),n.setHidden(),n._initializeTool(o)})),this.isActive.set(!1),this.iconUri=new Observable(r.iconUri),this.app.event("StateEnteredEvent").subscribe(this,function(e){n.isActive.get()&&"TransientActiveState"===e.stateDefinition.name&&n.activeTransient.set(!0)}),this.app.event("StateExitedEvent").subscribe(this,function(e){"TransientActiveState"===e.stateDefinition.name&&n.activeTransient.set(!1)})}}return __extends(t,e),t.prototype.execute=function(){this.isActive.get()||this.tool.isActive?this.app.commandRegistry.command("ClearActiveTool").execute():this.tool.enabled&&!this.tool.enabled.get()||this.app.commandRegistry.command("SetActiveTool").execute(this.tool.id)},t.prototype._initializeTool=function(e){var t=this;this.tool=this.app.toolRegistry.createTools(e,!0)[0],this.tool?this.tool.enabled&&(this.disabled.set(!this.tool.enabled.get()),this.setHidden(),this.tool.enabled.bind(this,function(e){t.disabled.set(!e),t.setHidden(),e||!t.isActive.get()&&!t.tool.isActive||t.app.commandRegistry.command("ClearActiveTool").execute()})):(this.disabled.set(!0),this.setHidden())},t}(e.ToolbarGroupItemBase);e.ToolbarTool=t}(e.toolbarGroup||(e.toolbarGroup={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i){t.call(this,e,i),this._drawIsActive=!1,this._drawEndHandlerToken=null,this._inputMethodChangeHandle=null,this._mapMouseHoverToken=null,this._mapMouseDownToken=null,this._autoPanPixelTolerance=15,this._autoPanStep=1/3,this._unsupportedAutoPanDrawModes=["FREEHAND_POLYGON","FREEHAND_POLYLINE","POINT","MULTI_POINT"],this._drawEndSuspended=!1}return __extends(i,t),i.prototype._createDrawObject=function(){this._drawObject=this.app.accessibilityManager.createComponent("geocortex.accessibility.draw",this.app.map),this._drawObject.setMarkerSymbol(new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.8]))),this._drawObject.setFillSymbol(new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2),new esri.Color([0,0,0,.25]))),this._drawObject.setLineSymbol(new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new esri.Color([0,0,0,.8]),2))},i.prototype._activateToolbar=function(){this._drawObject||this._createDrawObject(),this._drawEndHandlerToken||(this._drawEndHandlerToken=dojo.aspect.after(this._drawObject,"onDrawEnd",dojo.hitch(this,"onDrawEnd"),!0)),this._drawObject instanceof e.essentialsHtmlViewer.mapping.infrastructure.accessibility.Draw&&(this._inputMethodChangeHandle=dojo.aspect.after(this._drawObject,"onInputMethodChange",dojo.hitch(this,"onInputMethodChange"),!0)),this._drawObject.activate(esri.toolbars.Draw[this.drawMode]),this._drawIsActive=!0,this._drawEndSuspended=!1},i.prototype._deactivateToolbar=function(){this._drawEndHandlerToken&&(this._drawEndHandlerToken.remove(),this._drawEndHandlerToken=null),this._inputMethodChangeHandle&&(this._inputMethodChangeHandle.remove(),this._inputMethodChangeHandle=null),this._drawObject&&this._drawIsActive&&(this._drawObject.deactivate(),this._drawIsActive=!1,this._drawEndSuspended=!1)},i.prototype.onActivated=function(){if(this._drawObject||this._createDrawObject(),this._drawIsActive&&this._deactivateToolbar(),"CURRENT_EXTENT"==this.drawMode)this.onDrawEnd(this.app.map.extent);else{if(!this.app.map.graphics)return;this.app.command("ShowMap").execute(),this._activateToolbar()}this._mapMouseDownToken=this.app.event("MapMouseDownEvent").subscribe(this,this.onMapMouseDown),this._mapMouseHoverToken=this.app.event("MapMouseHoverEvent").subscribe(this,this.onMapMouseHover)},i.prototype.onDeactivated=function(){this._mapMouseHoverToken&&(this.app.event("MapMouseHoverEvent").unsubscribe(this._mapMouseHoverToken),this._mapMouseHoverToken=null),this._mapMouseDownToken&&(this.app.event("MapMouseDownEvent").unsubscribe(this._mapMouseDownToken),this._mapMouseDownToken=null),this._deactivateToolbar(),this.app.command("ShowMap").execute()},i.prototype.onDrawEnd=function(e){var t=this;if(!this._drawEndSuspended){if(this.command){var i=this.app.command(this.command);i.canExecute(e)?(i.execute(e),this.app.command("LogOptimizerEvent").execute(this.name,this.command)):this.app.trace.warning("Could not invoke command '{0}' for tool '{1}'.".format(this.command,this.name))}this.isSticky?(this._drawEndSuspended=!0,setTimeout(function(){return t._drawEndSuspended=!1},100)):this.setActive(!1)}},i.prototype.onInputMethodChange=function(e){var t={tool:this,previousMethod:e?e.previousMethod:null,newMethod:e?e.newMethod:null};this.app.event("ToolInputMethodChangedEvent").publish(t)},i.prototype.onMapMouseDown=function(e){3===e.which&&this._drawObject&&(this.app.command("ClearActiveTool").execute(),this._deactivateToolbar(),this.app.command("RemoveStatus").execute())},i.prototype.onMapMouseHover=function(e){if(null!=this._drawObject&&this._drawIsActive&&!(this._unsupportedAutoPanDrawModes.indexOf(this.drawMode)>=0)&&e.hasOwnProperty("clientX")&&e.hasOwnProperty("clientY")){var t=$(this.app.map.root).offset();e.clientX<t.left+this._autoPanPixelTolerance?this.app.command("PanLeft").execute(this._autoPanStep):t.left+this.app.map.width-this._autoPanPixelTolerance<e.clientX?this.app.command("PanRight").execute(this._autoPanStep):e.clientY<t.top+this._autoPanPixelTolerance?this.app.command("PanUp").execute(this._autoPanStep):t.top+this.app.map.height-this._autoPanPixelTolerance<e.clientY&&this.app.command("PanDown").execute(this._autoPanStep)}},i}(t.ToolBase);t.MapTool=i,i.prototype.command=null,i.prototype.drawMode=null,i.prototype.isSticky=!1}(t.tools||(t.tools={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,i){var r=this;if(e.call(this,t,i),this.enabled=new Observable(!0),i.command){var n=t.command(i.command);this.enabled.set(n.canExecute()),n.canExecuteChanged.subscribe(this,function(){var e=n.canExecute();!e&&r.isActive&&r.setActive(!1),r.enabled.set(e)})}}return __extends(t,e),t}(e.MapTool);e.DisablingMapTool=t}(e.tools||(e.tools={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(t,i){e.call(this,t,i),this.currentFeature=new Observable(null),this.providerEnabled=new Observable(!1),this.currentFeature.bind(this,this.handleCurrentFeatureChanged)}return __extends(t,e),t.prototype.initialize=function(e){},t.prototype.handleCurrentFeatureChanged=function(e){},t.prototype.updateProviderState=function(e){var t=!!this.currentFeature.get()&&!!e;this.providerEnabled.get()!==t&&this.providerEnabled.set(t)},t.prototype.createAttachedViews=function(e,t,i,r){var n=this,a=[];if(e.viewType&&e.markup&&t){var s=function(i,s,o){var l=t[s];if(null!==l)if(l){var c=n.app.viewManager.createView({viewId:o,markupResource:i,typeName:e.viewType,iconUri:e.iconUri,title:e.title||"",regionName:l,isVisible:!0,libraryId:e.libraryId||n.libraryId,configuration:e.viewConfig});c.attach(r||n),a.push(c)}else n.app.trace.warning("FeatureProviderBase: Could not resolve target region for view mode {0}. Failed to create view with id {1}".format(s,o))};if("string"==typeof e.markup)s(e.markup,"default",e.viewId||null);else for(var o in e.markup)if(e.markup.hasOwnProperty(o)){var l=e.viewId?"{0}-{1}".format(e.viewId,o):null;s(e.markup[o],o,l)}i&&"function"==typeof i&&i(a)}else this.app.trace.warning("FeatureProviderBase: View type, markup or region not specified. Cannot create view for {0}".format(e.type))},t}(e.framework.ui.ViewModelBase);t.FeatureProviderBase=i}(t.featureDetails||(t.featureDetails={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(){this.layers=[],this.tables=[],this.isUserCreated=!1,this.includeInLayerList=!0,this.isExpanded=!0,this._delayedRefreshToken=null}return i.fromEsriLayer=function(e){var r=new i;if(r.serviceLayer=e,r.serviceType=t.GisUtils.getServiceLayerType(e),r.id=e.id,e instanceof esri.layers.ArcGISDynamicMapServiceLayer||e instanceof esri.layers.ArcGISTiledMapServiceLayer){var n=e;r.capabilities=n.capabilities.split(",");for(var a=0;a<n.layerInfos.length;a++){var s=n.layerInfos[a];(l=t.LayerInfo.fromEsriLayerInfo(s,e)).serviceLayerInfo=r,r.layers.push(l)}}else if(e instanceof esri.layers.FeatureLayer){var o=e;r.displayName=o.name,r.capabilities=o.capabilities.split(",");var l=t.LayerInfo.fromEsriFeatureLayer(o);l.serviceLayerInfo=r,"Table"===o.type?r.tables.push(l):r.layers.push(l)}return r},i.fromGcxMapService=function(r){var n=new i;n.gcxMapService=r,n.serviceType=r.mapServiceType,n.serviceLayerFunction=r.mapServiceFunction,n.serviceLayer=r.serviceLayer,n.id=r.id,n.isExpanded=r.isExpanded,n.isUserCreated=r.isUserCreated,n.includeInLayerList=r.includeInLayerList,n.displayName=r.displayName,r.serviceLayer.capabilities&&(n.capabilities=r.serviceLayer.capabilities.split(","));for(o=0;o<r.layers.length;o++){var a=r.layers[o],s=t.LayerInfo.fromGcxLayer(a);s.serviceLayerInfo=n,a.type===e.essentials.LayerType.TABLE_LAYER?n.tables.push(s):n.layers.push(s)}for(var o=0;o<r.tables.length;o++){var l=r.tables[o],c=t.LayerInfo.fromGcxLayer(l);c.serviceLayerInfo=n,n.tables.push(c)}return n},i.prototype.findLayerById=function(e){for(var t=0,i=this.layers.length;t<i;t++){var r=this.layers[t];if(e===r.id.toString())return r}return null},i.prototype.isVisible=function(){var e=!1;return this.serviceLayer&&"boolean"==typeof this.serviceLayer.visible&&(e=this.serviceLayer.visible),e},i.prototype.setVisibility=function(e){this.gcxMapService?this.gcxMapService.setVisibility(e):null!==this.serviceLayer&&this.serviceLayer.setVisibility(e)},i.prototype.opacity=function(){return this.gcxMapService?this.gcxMapService.opacity:this.serviceLayer?this.serviceLayer.opacity:null},i.prototype.setOpacity=function(e){this.gcxMapService?this.gcxMapService.setOpacity(e):this.serviceLayer&&((null==e||isNaN(e))&&(e=1),e=Math.min(1,Math.max(0,e)),this.serviceLayer.setOpacity(e))},i.prototype.refresh=function(e,t){var i=this,r=this.serviceLayer;if(r&&"function"==typeof r.refresh){var n=function(){if(i._delayedRefreshToken=null,!0===e&&"function"==typeof r.setDisableClientCaching){var e=r.disableClientCaching;r.setDisableClientCaching(!0),r.refresh(),r.setDisableClientCaching(e)}else r.refresh()};this._delayedRefreshToken&&clearTimeout(this._delayedRefreshToken),"number"!=typeof e?n():this._delayedRefreshToken=setTimeout(n,e)}},i.prototype.supportsLayerVisibility=function(){switch(this.serviceType){case e.essentials.MapServiceType.FEATURE:case e.essentials.MapServiceType.GEORSS:case e.essentials.MapServiceType.KML:case e.essentials.MapServiceType.BING:case e.essentials.MapServiceType.TILED:case e.essentials.MapServiceType.WMTS:case e.essentials.MapServiceType.IMAGE:case e.essentials.MapServiceType.WEBTILED:return!1;case e.essentials.MapServiceType.DYNAMIC:return null!==this.serviceLayer&&!!this.serviceLayer.visibleLayers}return!0},i.prototype.loaded=function(){var e=this;if(this._loadedDeferred)return this._loadedDeferred;if(this._loadedDeferred=new dojo.Deferred,this.serviceLayer.loaded)this._loadedDeferred.resolve(this.serviceLayer);else if(this.serviceLayer.loadError)this._loadedDeferred.resolve(this.serviceLayer.loadError);else var t=this.serviceLayer.on("load",function(){t.remove(),i.remove(),e._loadedDeferred.resolve(e.serviceLayer)}),i=this.serviceLayer.on("error",function(r){t.remove(),i.remove(),e._loadedDeferred.errback(r)});return this._loadedDeferred},i}();t.ServiceLayerInfo=i}(t.gis||(t.gis={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.id=new Observable(""),this.children=null,this.parent=null,e&&this.id.set(e),t&&(this.parent=t)}return e.prototype.getRoot=function(){for(var e=this;null!=e.parent;)e=e.parent;return e},e.prototype.getAncestors=function(){var e=null;if(this.parent){e=[];for(var t=this.parent;null!=t;)e.push(t),t=t.parent}return e},e.prototype.getSelfAndAncestors=function(){var e=this.getAncestors();return(e=e&&e.length?e:[]).unshift(this),e},e.prototype.getSiblings=function(e){void 0===e&&(e=!1);var t=null;if(this.parent&&this.parent.children&&(t=this.parent.children.get(),!e)){t=t.slice(0);for(var i=0;i<t.length;i++)if(t[i]===this){t.splice(i,1);break}}return t},e.prototype.getDescendants=function(){if(this.children){for(var e=[],t=this.children.get(),i=0;i<t.length;i++){var r=t[i];e.push(r);for(var n=r.getDescendants(),a=0;a<n.length;a++)e.push(n[a])}return e}},e.prototype.getSelfAndDescendants=function(){var e=this.getDescendants();return(e=e&&e.length?e:[]).unshift(this),e},e}();e.LayerListNode=t}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(r){function n(t,i,n,a){var s=this;if(r.call(this,"GCXLayerListRootNode-".concat(e.framework.utils.alphaNumericToken())),this.layerListInitialized=!1,this.layerListInitializationFailure=null,this.onLayerListInitializationFailed=function(e){},this.onLayerListInitialized=function(e){},this.enableLegendIntegration=!1,this.onlyShowSwatchesOnVisibleLayers=!1,this.autoActivateAncestorVisibilities=!1,this._addedFolderReferences=[],this._handledMapServiceReferences=[],this._allMapServiceReferences=[],this._outOfFolderMapServiceReferences=[],this._initializing=!1,this._groupByOperationalAndBase=!0,this._layerListRestEndpoint=null,this._suspendMapUpdates=!1,!t||!t.mapInfo)throw new Error("LayerList: Initialization failed. AppInfo/MapInfo cannot be null");this.appInfo=t,this.mapInfo=t.mapInfo,this.url=i||"",this._libraryId="Mapping.Infrastructure",this._layerListRestEndpoint=n||null,this.enableLegendIntegration=!(!a||void 0==a.enableLegendIntegration)&&a.enableLegendIntegration,this.onlyShowSwatchesOnVisibleLayers=!(!a||void 0==a.onlyShowSwatchesOnVisibleLayers)&&a.onlyShowSwatchesOnVisibleLayers,this.autoActivateAncestorVisibilities=!(!a||void 0==a.autoActivateAncestorVisibilities)&&a.autoActivateAncestorVisibilities,this._groupByOperationalAndBase=!a||void 0==a.groupByOperationalAndBase||a.groupByOperationalAndBase,this.enableLayerIcons=!(!a||void 0==a.enableLayerIcons)&&a.enableLayerIcons,this.serviceLoadFailureIconUri=a?a.serviceLoadFailureIconUri||"":"",this.serviceLoadFailureIconTooltip=a?a.serviceLoadFailureIconTooltip||"":"",this.multiLegendSwatchElement=a?a.multiLegendSwatchElement||"":"",this.singleLegendIconTooltip=a?a.singleLegendIconTooltip||"":"",this.multiLegendIconTooltip=a?a.multiLegendIconTooltip||"":"",dojo.connect(this.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangingEvent",dojo.hitch(this,function(){return s.suspendMapUpdates=!0})),dojo.connect(this.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangedEvent",dojo.hitch(this,function(){return s.suspendMapUpdates=!1}))}return __extends(n,r),Object.defineProperty(n.prototype,"suspendMapUpdates",{get:function(){return this._suspendMapUpdates},set:function(e){e!==this._suspendMapUpdates&&(this._suspendMapUpdates=e,this._suspendMapUpdates?this._enableDeferredItemVisibilities(this.children.get()):this._applyDeferredItemVisibilities(this.children.get()))},enumerable:!0,configurable:!0}),n.prototype.initialize=function(){this.layerListInitialized||this._initializing||(this._initializing=!0,this.children=new i.LayerListItemCollection(null),this.children.layerList=this,this._layerListRestEndpoint?this._layerListInitializationHandler(this._layerListRestEndpoint):this.url&&this.appInfo.essentialsVersion&&this.appInfo.essentialsVersion>=4.02?e.request({url:this.url,content:{f:"json"},load:dojo.hitch(this,this._layerListInitializationHandler),error:dojo.hitch(this,this._layerListInitializationErrorHandler),callbackParamName:"CallBack"}):this._layerListInitializationHandler(null))},n.prototype.addUserAddedServiceLayer=function(i,r){var n=i;if(!this.layerListInitialized)return!1;if(!(n instanceof t.gis.ServiceLayerInfo))if(n instanceof e.essentials.MapService)n=t.gis.ServiceLayerInfo.fromGcxMapService(n);else{if(!(n instanceof esri.layers.Layer))return this.appInfo.gcxApp.trace.error("addUserAddedServiceLayer: Could not add layer. Invalid layer type."),!1;n=t.gis.ServiceLayerInfo.fromEsriLayer(n)}n.isUserCreated=!0;var a=this._generateLayerListItemsFromServiceLayer(n,this,!0);return!(!a||!a.length)&&(null!==r&&void 0!==r?this._addItemsToUserAddedFolder(a,r):this._addItemsToUserAddedFolder(a))},n.prototype.removeServiceLayer=function(r){var n=r;if(!this.layerListInitialized)return!1;if(!(n instanceof esri.layers.Layer)){if(!(n instanceof e.essentials.MapService||n instanceof t.gis.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("removeServiceLayer: Could not remove layer. Invalid layer type."),!1;n=n.serviceLayer}var a=this.getDescendants();if(a.length){for(var s=0;s<a.length;s++){var o=a[s];if(o.mapService&&o.mapService.serviceLayer===n){var l=o.parent;l?(l.children.removeItem(o),l instanceof i.LayerListItem&&l.refreshOnDemandItemCollection()):this.children.removeItem(o)}}return!0}return!1},n.prototype.updateServiceLayer=function(r,n,a){if(!this.layerListInitialized||!r)return!1;n=n||[],a=a||[];var s;if(r instanceof e.essentials.MapService)s=t.gis.ServiceLayerInfo.fromGcxMapService(r);else{if(!(r instanceof t.gis.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("updateServiceLayer: Could not update layer. Invalid layer type."),!1;s=r}if(!(o=this.getDescendants()).filter(function(e){return e.mapService&&e.mapService&&e.mapService.gcxMapService===s.gcxMapService}).length)return this.addUserAddedServiceLayer(s);if(a&&a.length)for(var o=this.getDescendants(),l=0;l<o.length;l++){var c=o[l];if(c.type===i.LayerListItemType.LAYER){var u=c,p=u.layer&&u.layer.gcxLayer?u.layer.gcxLayer:null;if(p&&p.isUserCreated&&a.indexOf(p)>=0){var h=u.parent;h?(h.children.removeItem(u),h instanceof i.LayerListItem&&h.refreshOnDemandItemCollection()):(this.children.removeItem(u),this.children.pulse())}}}if(n&&n.length){for(var o=this.getDescendants(),d=new Array,l=0;l<n.length;l++){var m=n[l],g=s.findLayerById(m.id);if(g||((g=t.gis.LayerInfo.fromGcxLayer(m)).serviceLayerInfo=s,s.layers.push(g)),!o.filter(function(e){return e.layer&&e.layer.gcxLayer===g.gcxLayer}).length){var f=new i.LayerListLayerItem(g.id,g,this,i.LayerListItemType.LAYER);d.push(f)}}if(d.length)return this._addItemsToUserAddedFolder(d)}return!1},n.prototype.updateServiceLayerLegendSwatch=function(e){if(!this.layerListInitialized)return!1;var t=e.serviceLayer;if(!t)return this.appInfo.gcxApp.trace.error("updateServiceLayerLegendSwatch: Could not update layer swatch. Invalid layer type."),!1;var r=this.getDescendants().filter(function(e){return e.mapService&&e.mapService.serviceLayer.id===t.id});if(r.length>0){for(var n=0;n<r.length;n++){var a=r[n];a&&a instanceof i.LayerListLayerItem&&a.updateLegendItems()}return!0}return!1},n.prototype.getUserAddedLayersFolderIndex=function(i){var r=i;if(!this.layerListInitialized)return null;if(!(r instanceof esri.layers.Layer)){if(!(r instanceof e.essentials.MapService||r instanceof t.gis.ServiceLayerInfo))return this.appInfo.gcxApp.trace.error("removeServiceLayer: Could not remove layer. Invalid layer type."),null;r=r.serviceLayer}var n=this._userAddedLayersFolder||this;if(n.children&&n.children.length)for(var a=n.children.get(),s=0;s<a.length;s++){var o=a[s];if(o.mapService&&o.mapService.serviceLayer===r)return s}return null},n.prototype._applyDeferredItemVisibilities=function(e){var t=this;dojo.forEach(e,function(e){e._applyDeferredInitialVisibility(),e.children&&e.children.length()&&t._applyDeferredItemVisibilities(e.children.get())})},n.prototype._enableDeferredItemVisibilities=function(t){var i=this;t.forEach(function(t){e.framework.utils.isNullOrUndefined(t._deferredVisibilitySetting)&&(t._deferredVisibilitySetting=t.isVisible.get()),i._enableDeferredItemVisibilities(t.children.get())})},n.prototype._layerListInitializationErrorHandler=function(e){this.layerListInitializationFailure=e,this.onLayerListInitializationFailed&&this.onLayerListInitializationFailed(e),this._initializing=!1},n.prototype._layerListInitializationHandler=function(e){var t=this,i=function(){t.layerListInitialized=!0,t._initializing=!1,t._processEligibleSingleMapServiceFolders(),t._processUnhandledMapServices(),t._setupOpacityBindingsForParentsOfHiddenItemsWithOpacityBindings(),t._applyInitialLayerTheme(),t._applyDeferredItemVisibilities(t.children.get()),t.onLayerListInitialized&&t.onLayerListInitialized(t)};e?this._configureLayerListFromRestResponse(e,i,this._layerListInitializationErrorHandler):this._configureLayerListFromMapInfo(this.mapInfo,i,this._layerListInitializationErrorHandler)},n.prototype._configureLayerListFromMapInfo=function(e,t,r){if(e){if(e.gcxMap&&e.serviceLayers.length&&void 0!=e.serviceLayers[0].serviceLayerFunction&&this._groupByOperationalAndBase)var n=new i.LayerListFolderItem(this.id.get()+":Operational",this.appInfo.gcxApp.getResource(this._libraryId,"language-layerlist-operational-maps-folder-title"),this),a=new i.LayerListFolderItem(this.id.get()+":Base",this.appInfo.gcxApp.getResource(this._libraryId,"language-layerlist-base-maps-folder-title"),this);try{for(var s=0;s<e.serviceLayers.length;s++){var o=e.serviceLayers[s],l=this._generateLayerListItemsFromServiceLayer(o,this);if(l&&l.length)if(this._groupByOperationalAndBase)switch(o.serviceLayerFunction){case"Operational":n.children.addItems(l);break;case"Base":a.children.addItems(l);break;default:throw new Error("ServiceLayerFunction undefined or not recognized: {0}".format(o.serviceLayerFunction))}else this.children.addItems(l)}this._groupByOperationalAndBase&&(n.children.length()&&(this._generateThemeSettingsForCoreFolder(n),this.children.addItem(n),n.isExpanded.set(!0),n.isVisible.set(!0),n.configuredVisible=!0),a.children.length()&&(this._generateThemeSettingsForCoreFolder(a),this.children.addItem(a),a.isExpanded.set(!0),a.isVisible.set(!0),a.configuredVisible=!0))}catch(e){return console.error("Layer List Configuration Error: {0}".format(e&&e.message||"Unknown Error")),void r(e)}t()}else this._layerListInitializationErrorHandler(new Error("Error initializing layer list from MapInfo."))},n.prototype._configureLayerListFromRestResponse=function(e,t,i){try{if(!e||!e.items)throw new Error("Layer list failed to load (general data failure).");this._userAddedLayersDestinationId=e.userAddedLayersDestinationId;for(var r=0,n=e.items;r<n.length;r++){var a=n[r],s=this._createLayerListItemFromRestResult(a,this);s&&this.children.addItem(s)}}catch(e){return e.name="LayerListConfigurationError/"+e.name,this._layerListInitializationErrorHandler(e),void i(e)}t()},n.prototype._generateLayerListItemsFromServiceLayer=function(e,t,r){var n=this;void 0===r&&(r=!1);var a=[],s=null,o=function(t,r){var a=t.subLayerIds||[];if(a.length>0)for(var s=0;s<a.length;s++){var c=e.findLayerById(a[s]);if(c&&(c.processed=!0,c.includeInLayerList)){var u=new i.LayerListLayerItem(c.id,c,n);l(u),r.children.addItem(u),o(c,u)}}r.isExpanded.set(t.isExpanded&&!(!t.subLayerIds||!t.subLayerIds.length))},l=function(e){e&&r&&(e.unbindFromActiveTheme(),e.inActiveTheme.set(!0))};return e.includeInLayerList&&(s=new i.LayerListMapServiceItem(e.id,e,this),l(s)),e.serviceLayer instanceof esri.layers.GraphicsLayer&&1===e.layers.length?(s=this._handleGraphicsLayerItem(e,s),l(s&&s.children.length()?s.children.getAt(0):s)):e.layers.length&&(dojo.forEach(e.layers,function(e){if((e.includeInLayerList||e.isUserCreated)&&!e.processed){var t=new i.LayerListLayerItem(e.id,e,n);l(t),s?s.children.addItem(t):a.push(t),o(e,t)}}),s&&s.isExpanded.set(e.isExpanded&&!!e.layers.length)),s&&(a.push(s),t&&(s.parent=t)),a},n.prototype._handleGraphicsLayerItem=function(e,t){var r=t;if(e.layers[0].includeInLayerList||e.layers[0].isUserCreated){var n=e.layers[0],a=new i.LayerListGraphicsLayerItem(n.id,e.layers[0],this);a.isExpanded.set(n.isExpanded&&!(!n.subLayerIds||!n.subLayerIds.length)),r?(r.isVisible.set(a.isVisible.get()),a.isVisible.set(!0),a.canNotAssignVisibility.set(!0),r.children.addItem(a),r.isExpanded.set(e.isExpanded&&!!e.layers.length)):r=a}return r},n.prototype._createLayerListItemFromRestResult=function(e,t){var r=this,n=null,a=function(t){var r=t===i.LayerListItemType.MAPSERVICE?"MapService":t===i.LayerListItemType.LAYER?"Map Layer":"Object";console.error("Layer List Error: {0} with ID: {1} not available. Excluding from layer list. Please check your security settings.".format(r,e.mapServiceID))};switch(e.type){case"folder":n=new i.LayerListFolderItem(e.id,e.name,this),e.items&&e.items.length&&this._subItemIncludedInLayerList(e.items)||(n.displayItem.set(!1),n.isExpanded.set(!1)),this._userAddedLayersDestinationId&&e.id===this._userAddedLayersDestinationId&&(this._userAddedLayersFolder=n);break;case"mapService":(s=this.mapInfo.findMapServiceById(e.mapServiceID))||a(i.LayerListItemType.MAPSERVICE),s&&s.includeInLayerList&&(n=new i.LayerListMapServiceItem(e.id,s,this));break;case"layer":var s=this.mapInfo.findMapServiceById(e.mapServiceID);if(s||a(i.LayerListItemType.MAPSERVICE),s){var o=s.findLayerById(e.layerID);o||a(i.LayerListItemType.LAYER),o&&o.includeInLayerList&&(n=s.serviceLayer instanceof esri.layers.GraphicsLayer?new i.LayerListGraphicsLayerItem(e.id,o,this):new i.LayerListLayerItem(e.id,o,this))}break;default:throw new Error("Unknown layer list item type. Reported type: {0}".format(e.type))}return n&&(t&&(n.parent=t),null!=e.items&&e.items.length&&dojo.forEach(e.items,function(e){var t=r._createLayerListItemFromRestResult(e,n);t&&n.children.addItem(t)}),this._processItem(n,e)),n},n.prototype._subItemIncludedInLayerList=function(e){for(var t=this,i=0;i<e.length;i++)if(function(e){if("folder"===e.type)return!(!e.items||!e.items.length)&&t._subItemIncludedInLayerList(e.items);if("mapService"===e.type)return!!(i=t.mapInfo.findMapServiceById(e.mapServiceID))&&!!i.includeInLayerList;if("layer"===e.type){var i=t.mapInfo.findMapServiceById(e.mapServiceID),r=i.findLayerById(e.layerID);return!!r&&!!r.includeInLayerList}}(e[i]))return!0;return!1},n.prototype._processItem=function(t,r){if(t.type===i.LayerListItemType.FOLDER){if(this.mapInfo.gcxMap&&r.themeSettings&&r.themeSettings.length)for(var n=0;n<r.themeSettings.length;n++){var a=r.themeSettings[n],s=this.mapInfo.gcxMap.layerThemesInfo.getTheme(a.themeID);if(s){var o=void 0!=a.visible?a.visible:r.isVisible;t.layerThemeSettings.push(new e.essentials.LayerThemeSetting(s,o))}}t._deferredVisibilitySetting=r.isVisible,t.isVisible.set(r.isVisible),t.configuredVisible=r.isVisible,t.isExpanded.set(r.isExpanded&&!(!r.items||!r.items.length)),this._disableFolderIfParentTiled(t)}if(t.type===i.LayerListItemType.MAPSERVICE&&t.isExpanded.set(t.mapService.isExpanded),t.type===i.LayerListItemType.LAYER&&t.isExpanded.set(t.layer.isExpanded&&!(!t.layer.subLayerIds||!t.layer.subLayerIds.length)),t.type===i.LayerListItemType.FOLDER){var l=r.iconUri;l&&(this.mapInfo.gcxMap&&this.mapInfo.gcxMap.site&&(l=e.essentials.RestHelper.processClientSideTokens(this.mapInfo.gcxMap.site,l)),t.iconUri.set(l),t.iconTooltip.set(t.name.get()))}if(t.canDisplayItem.set(!1!==r.isVisibleInLayerList),r.layerVisibilityType===i.LayerVisibilityType.MutuallyExclusive&&r.items&&r.items.length>1)for(var c=e.framework.utils.alphaNumericToken(32),u=0;u<t.children.length();u++)t.children.getAt(u).isMutuallyExclusive.set(!0),t.children.getAt(u).hasRadioToggle.set(!0),t.children.getAt(u).radioGroup.set(c)},n.prototype._disableFolderIfParentTiled=function(t){for(var r=t.parent;r&&r.id!==this.id&&(r.type===i.LayerListItemType.MAPSERVICE||r.type===i.LayerListItemType.FOLDER);){if(r.type===i.LayerListItemType.FOLDER&&r.canNotAssignVisibility.get()||r.type===i.LayerListItemType.MAPSERVICE&&r.mapService.serviceType===e.essentials.MapServiceType.TILED){t.canNotAssignVisibility.set(!0);break}r=r.parent}},n.prototype._generateThemeSettingsForCoreFolder=function(t,r){if(void 0===r&&(r=!1),r){if(this.mapInfo.gcxMap&&this.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured)for(var n=this.mapInfo.gcxMap.layerThemesInfo.themes,a=0;a<n.length;a++)t.layerThemeSettings.push(new e.essentials.LayerThemeSetting(n[a],!0));t.inActiveTheme.set(!0)}else for(var s={},a=0,o=t.children.length();a<o;a++){var l=t.children.getAt(a),c=null;switch(l.type){case i.LayerListItemType.FOLDER:c=l.layerThemeSettings;break;case i.LayerListItemType.MAPSERVICE:c=l.mapService.gcxMapService?l.mapService.gcxMapService.layerThemeSettings:null;break;case i.LayerListItemType.LAYER:case i.LayerListItemType.GRAPHICSLAYER:c=l.layer.gcxLayer?l.layer.gcxLayer.layerThemeSettings:null}if(c&&c.length)for(var u=0;u<c.length;u++){var p=c[u].theme.id;void 0==s[p]&&(t.layerThemeSettings.push(new e.essentials.LayerThemeSetting(c[u].theme,!0)),s[p]=!0)}}},n.prototype._applyInitialLayerTheme=function(){this.mapInfo.gcxMap&&this.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured&&this.mapInfo.gcxMap.applyStartupTheme()},n.prototype._processEligibleSingleMapServiceFolders=function(){var e=this._handledMapServiceReferences.slice(0),t=this._getFoldersContainingSingleMapService();t=this._filterEligibleSingleMsFolders(t),t=this._selectDeepestLevelSingleMapServiceFolders(t);for(var i=0;i<t.length;i++){var r=t[i];r.containedMapServices[0].serviceLayer instanceof esri.layers.GraphicsLayer||-1!==e.indexOf(r.containedMapServices[0])||-1!==this._outOfFolderMapServiceReferences.indexOf(r.containedMapServices[0])||(r.linkWithMapService(r.containedMapServices[0]),e.push(r.containedMapServices[0]))}},n.prototype._setupOpacityBindingsForParentsOfHiddenItemsWithOpacityBindings=function(){var e=this.getDescendants();e=dojo.filter(e,function(e){return e.canAdjustOpacity.get()});for(var t=0;t<e.length;t++){var r=e[t];if(!this.isEffectivelyDisplayed(r)){for(var n=r.parent;n instanceof i.LayerListItem&&!this.isEffectivelyDisplayed(n);)n=n.parent;n instanceof i.LayerListItem&&n._setupOpacityBindings()}}},n.prototype.isEffectivelyDisplayed=function(e){return!!e.displayItem.get()&&(!(e.parent instanceof i.LayerListItem)||this.isEffectivelyDisplayed(e.parent))},n.prototype._getFoldersContainingSingleMapService=function(){for(var e=[],t=0;t<this._addedFolderReferences.length;t++)1===this._addedFolderReferences[t].containedMapServices.length&&e.push(this._addedFolderReferences[t]);return e},n.prototype._filterEligibleSingleMsFolders=function(e){var t=this;if(e){for(var i=[],r=this._filterTopLevelFolders(e),n=0;n<e.length;n++){var a=e[n],s=dojo.filter(this._addedFolderReferences,function(e){return e.id!==a.id&&e.containedMapServices.length>0&&-1!==e.containedMapServices.indexOf(a.containedMapServices[0])})||[],o=s.filter(function(e){return e.containedMapServices.length>1})||[];this._noChildItemsWithMapService(a.containedMapServices[0],o)&&this._allFoldersAncestorsOrDescendantsOf(a,s)&&(r.some(function(e){return e.containedMapServices[0]===a.containedMapServices[0]&&!t._allFoldersAncestorsOf(a,[e])&&a.id!==e.id})||i.push(a))}return i}},n.prototype._filterTopLevelFolders=function(e){return this.children.get().filter(function(i){return i.type===t.layerList.LayerListItemType.FOLDER&&-1!==e.indexOf(i)})},n.prototype._selectDeepestLevelSingleMapServiceFolders=function(e){if(e){for(var t=[],i=[],r=0;r<e.length;r++){var n=e[r];if(-1===i.indexOf(n.containedMapServices[0])){var a=dojo.filter(e,function(e){return e.id!==n.id&&-1!==e.containedMapServices.indexOf(n.containedMapServices[0])})||[];if(a.length){var s,o=n;for(s=0;s<a.length;s++){if(!this._onlyFolderItems(o.children.get())||!this._allFoldersDescendantsOf(o,a.slice(s))){o=s>=1?a[s-1]:o;break}if(o.children.length()>1)break;o=a[s]}this._allFoldersDescendantsOf(o,a.slice(s))&&(t.push(o),i.push(o.containedMapServices[0]))}else t.push(n),i.push(n.containedMapServices[0])}}return t}},n.prototype._allFoldersDescendantsOf=function(e,t){for(var i=0;i<t.length;i++){var r=t[i].getAncestors();if(!r||-1===r.indexOf(e))return!1}return!0},n.prototype._allFoldersAncestorsOf=function(e,t){var i=e.getAncestors();if(i){for(var r=0;r<t.length;r++)if(-1===i.indexOf(t[r]))return!1;return!0}return!1},n.prototype._allFoldersAncestorsOrDescendantsOf=function(e,t){var i=Array.prototype.concat(e.getAncestors()||[],e.getDescendants()||[]);if(i){for(var r=0;r<t.length;r++)if(-1===i.indexOf(t[r]))return!1;return!0}return!1},n.prototype._noChildItemsWithMapService=function(e,t){for(var i=0;i<t.length;i++)for(var r=t[i].children.get(),n=0;n<r.length;n++)if(r[n].mapService&&r[n].mapService===e)return!1;return!0},n.prototype._onlyFolderItems=function(e){for(var i=0;i<e.length;i++)if(e[i].type!==t.layerList.LayerListItemType.FOLDER)return!1;return!0},n.prototype._processUnhandledMapServices=function(){var e=this;dojo.filter(this._allMapServiceReferences,function(t){return-1===e._handledMapServiceReferences.indexOf(t)}).forEach(function(e){(e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer||e.serviceLayer instanceof esri.layers.WMSLayer)&&e.serviceLayer.on("visibility-change",function(t){t.visible?e._esriLayerStateBackup&&(e.serviceLayer.setVisibleLayers(e._esriLayerStateBackup),e._esriLayerStateBackup=null):e.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer?(e._esriLayerStateBackup=e.serviceLayer.visibleLayers?e.serviceLayer.visibleLayers.slice(0):[-1],e.serviceLayer.setVisibleLayers(["-1"])):(e._esriLayerStateBackup=e.serviceLayer.visibleLayers?e.serviceLayer.visibleLayers.slice(0):[],e.serviceLayer.setVisibleLayers([]))})})},n.prototype._addItemsToUserAddedFolder=function(e,t){var r=this._userAddedLayersFolder||this,n=t||0,a=e.reduceRight(function(e,t,i){return r.children.validateAndInsertItem(n,t)&&e},!0);return this._userAddedLayersFolder&&(this._userAddedLayersFolder.displayItem.set(!0),this._userAddedLayersFolder.isExpanded.set(!0),this._userAddedLayersFolder.isVisible.set(!0),this._userAddedLayersFolder.parent instanceof i.LayerListFolderItem&&this._userAddedLayersFolder.parent.refreshOnDemandItemCollection()),this._applyDeferredItemVisibilities(r.children.get()),a},n}(i.LayerListNode);i.LayerList=r}(t.layerList||(t.layerList={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){!function(e){e[e.FOLDER=0]="FOLDER",e[e.MAPSERVICE=1]="MAPSERVICE",e[e.LAYER=2]="LAYER",e[e.GRAPHICSLAYER=3]="GRAPHICSLAYER",e[e.KMLFOLDER=4]="KMLFOLDER"}(i.LayerListItemType||(i.LayerListItemType={}));var r=i.LayerListItemType,n=function(n){function a(e,t,r){var a=this;if(n.call(this,e),this.mapService=null,this.opacity=null,this._opacityChangeHandle=null,this._themeChangingHandle=null,this._themeChangedHandle=null,!e)throw new Error("LayerListItem: Initialization failed. Layer list item id cannot be null");if(!r)throw new Error("LayerListItem: Initialization failed. LayerList cannot be null");this.type=t,this.layerList=r,this.allAncestorsVisible=!0,this.isVisible=new Observable(!1),this.isEffectivelyVisible=new Observable(!1),this.parentEffectivelyVisible=new Observable(!0),this.inVisibleScaleRange=new Observable(!0),this.isEffectivelyVisible.syncTransform(this.isVisible,function(e){return e&&!!a.allAncestorsVisible}),this.name=new Observable(""),this.isExpanded=new Observable(!1),this.expandLegend=new Observable(!1),this.canNotAssignVisibility=new Observable(!1),this.canAdjustOpacity=new Observable(!1),this.inActiveTheme=new Observable(!0),this.canDisplayItem=new Observable(!0),this.displayItem=new Observable(!0),this.hasDisplayedChildren=new Observable(!1),this.children=new i.LayerListItemCollection(this),this.onDemandItemCollection=new ObservableCollection([]),this.legendItems=new ObservableCollection([]),this.legendSwatch=new Observable(""),this.legendHasMultipleItems=new Observable(!1),this.enableLayerActions=!1,this.enableMapServiceActions=!1,this.iconUri=new Observable(""),this.iconTooltip=new Observable(""),this.legendTooltip=new Observable(""),this.layerFolderToggleTooltip=new Observable(""),this.layerActionsTooltip=new Observable(""),this.layerToggleTooltip=new Observable(""),this.mapServiceActionsTooltip=new Observable(""),this.isMutuallyExclusive=new Observable(!1),this.hasRadioToggle=new Observable(!1),this.radioGroup=new Observable(""),this.isVisible.bind(this,this.setVisibility),this.isExpanded.bind(this,this.refreshOnDemandItemCollection),this.inActiveTheme.bind(this,this._onActiveThemeChanged),this.canDisplayItem.bind(this,this._updateDisplayItem),this.currentUserClickOriginator=!1,this.legendIsVisible=new Observable(!1),this.layerList.onlyShowSwatchesOnVisibleLayers&&(this.isEffectivelyVisible.bind(this,this._processLegendVisibility),this.inVisibleScaleRange.bind(this,this._processLegendVisibility),this.legendItems.bind(this,this._processLegendVisibility)),this.legendSwatch.bind(this,function(e){a.layerList.enableLegendIntegration&&a._processLegendVisibility()}),this.layerList&&this.layerList.mapInfo&&this.layerList.mapInfo.gcxMap&&this.layerList.mapInfo.gcxMap.layerThemesInfo&&(this._themeChangingHandle=dojo.connect(this.layerList.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangingEvent",dojo.hitch(this,this._handleLayerThemeChangingEvent)),this._themeChangedHandle=dojo.connect(this.layerList.mapInfo.gcxMap.layerThemesInfo,"layerThemeChangedEvent",dojo.hitch(this,this._handleLayerThemeChangedEvent)))}return __extends(a,n),a.prototype.bindToActiveTheme=function(){},a.prototype.unbindFromActiveTheme=function(){},a.prototype.cleanUp=function(){this._opacityChangeHandle&&(this._opacityChangeHandle.remove(),this._opacityChangeHandle=null),this._themeChangingHandle&&(dojo.unsubscribe(this._themeChangingHandle),this._themeChangingHandle=null),this._themeChangedHandle&&(dojo.unsubscribe(this._themeChangedHandle),this._themeChangedHandle=null),this.unbindFromActiveTheme()},a.prototype.notifyActiveThemeChanged=function(e){e&&!this.inActiveTheme.get()&&this.inActiveTheme.set(!0),this.type===r.FOLDER&&!e&&this.inActiveTheme.get()&&this.children&&dojo.every(this.children.get(),function(e){return!e.inActiveTheme.get()})&&this.inActiveTheme.set(!1)},a.prototype.setItemVisibility=function(e){this.currentUserClickOriginator=!0,this.isVisible.set(e)},a.prototype.setVisibility=function(e){if(this._updateDisplayItem(),void 0!==this.allAncestorsVisible)if(void 0==this._deferredVisibilitySetting){if(e&&this.isMutuallyExclusive.get()&&this.parent&&!this.layerList.mapInfo.gcxMap.layerThemesInfo.themeChangeInProgress)for(var t=0;t<this.parent.children.length();t++){var i=this.parent.children.getAt(t);i!==this&&i.isVisible.get()&&i.isVisible.set(!1)}}else this._deferredVisibilitySetting=e},a.prototype.setAncestorVisibility=function(e){this.allAncestorsVisible=e,this.isVisible.pulse()},a.prototype.refreshOnDemandItemCollection=function(e){var t=void 0==e?this.isExpanded.get():e;if(this.onDemandItemCollection.clear(),this.children&&this.children.length()&&t)for(var i=0,r=this.children.length();i<r;i++){var n=this.children.getAt(i);this._notFolderOrContainsAtLeastOneChildLayer(n)&&this.onDemandItemCollection.addItem(n)}},a.prototype.populateMapServicesInParentFolders=function(){var e=this;if(this.type!==t.layerList.LayerListItemType.FOLDER&&this.mapService){for(var i=[],r=this.parent,n=!0;r;){if(r.type===t.layerList.LayerListItemType.MAPSERVICE&&r.mapService===this.mapService)return;r.type===t.layerList.LayerListItemType.FOLDER&&(n=!1,-1===r.containedMapServices.indexOf(this.mapService)&&-1===r.id.get().indexOf(this.layerList.id.get())&&i.push(r)),r=r.parent}n?this.layerList._outOfFolderMapServiceReferences.push(this.mapService):dojo.forEach(i,function(t){t.containedMapServices.push(e.mapService)})}},a.prototype._applyDeferredInitialVisibility=function(){if(void 0!=this._deferredVisibilitySetting&&!this.layerList.suspendMapUpdates){var e=this._deferredVisibilitySetting;delete this._deferredVisibilitySetting,this.setVisibility(e)}},a.prototype._setupOpacityBindings=function(){var i=this;if(this.type!==t.layerList.LayerListItemType.LAYER&&this.type!==t.layerList.LayerListItemType.GRAPHICSLAYER&&this.mapService&&this.mapService.serviceLayer&&void 0!=this.mapService.serviceLayer.opacity&&void 0!=this.mapService.serviceLayer.setOpacity&&this.mapService.serviceType!==e.essentials.MapServiceType.FEATURE){this.canAdjustOpacity.set(!0),this.opacity=new Observable(this.mapService.serviceLayer.opacity);this.opacity.bind(this,function(e){i.mapService.setOpacity(e)}),this._opacityChangeHandle=this.mapService.serviceLayer.on("opacity-change",function(){return i.opacity.set(i.mapService.opacity())})}},a.prototype._notFolderOrContainsAtLeastOneChildLayer=function(e){if(e.type!==t.layerList.LayerListItemType.FOLDER)return!0;if(e.children&&e.children.length())for(var i=0,r=e.children.length();i<r;i++)if(this._notFolderOrContainsAtLeastOneChildLayer(e.children.getAt(i)))return!0;return!1},a.prototype._handleLayerThemeChangingEvent=function(e){this._processLegendVisibility()},a.prototype._handleLayerThemeChangedEvent=function(e){this._processLegendVisibility()},a.prototype._updateDisplayItem=function(){this.displayItem.set(this.canDisplayItem.get()&&this.inActiveTheme.get());var e=this.getSiblings(!0);if(e&&e.length){for(var t=0,i=0;i<e.length;i++)(r=e[i]).displayItem.get()&&t++;for(i=0;i<e.length;i++){var r=e[i];r.hasRadioToggle.set(r.isMutuallyExclusive.get()&&1!==t)}}},a.prototype._onActiveThemeChanged=function(e){this._updateDisplayItem();var t=this.parent;t&&t.id!==this.layerList.id&&t.notifyActiveThemeChanged(e)},a.prototype._processLegendVisibility=function(){this.layerList.onlyShowSwatchesOnVisibleLayers?this.legendIsVisible.set(this.isEffectivelyVisible.get()&&this.inVisibleScaleRange.get()&&!!this.legendItems.length()&&!!this.legendSwatch.get()):this.legendIsVisible.set(!!this.legendItems.length()&&!!this.legendSwatch.get()),1==this.legendItems.length()&&this.expandLegend.set(!1)},a.prototype._setTooltips=function(){var e=this,t=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-toggle").format(this.name.get()),i=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layer-actions-tooltip").format(this.name.get()),r=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-visible-at-extent"),n=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-not-visible-at-extent"),a=this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-expand").format(this.name.get());this.layerActionsTooltip.set(i),this.layerFolderToggleTooltip.set(a),this.inVisibleScaleRange.get()?this.layerToggleTooltip.set(t+" "+r):this.layerToggleTooltip.set(t+" "+n),this.inVisibleScaleRange.bind(this,function(i){i?e.layerToggleTooltip.set(t+" "+r):e.layerToggleTooltip.set(t+" "+n)})},a}(i.LayerListNode);i.LayerListItem=n}(t.layerList||(t.layerList={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(t){function i(i,r,n,a){if(t.call(this,i,e.LayerListItemType.KMLFOLDER,r),!n)throw new Error("LayerListKmlFolderItem: Initialization failed. KML layer object cannot be null.");if(!a)throw new Error("LayerListKmlFolderItem: Initialization failed. KML folder object cannot be null.");this._kmlLayer=n,this._kmlFolder=a,this.name=new Observable(a.name),this._setTooltips(),this.isVisible.set(!!a.visibility)}return __extends(i,t),i.prototype.setItemVisibility=function(e){t.prototype.setItemVisibility.call(this,e),this._kmlLayer.setFolderVisibility(this._kmlFolder,e)},i}(e.LayerListItem);e.LayerListKmlFolderItem=t}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.sortBy=function(e,t){return e.sort(function(e,i){var r=t(e),n=t(i);return r==n?0:r<n?-1:1}),e},e.sum=function(e,t){for(var i=0,r=0;r<e.length;r++)i+=t(e[r]);return i},e.max=function(e,t){for(var i=null,r=0;r<e.length;r++){var n=t(e[r]);(null==i||i<n)&&(i=n)}return i},e.mapWithErrorCallback=function(e,t,i,r){if("function"!=typeof t)throw new Error("Callback required.");if("function"!=typeof i)throw new Error("Error callback required.");if(!e)return e;for(var n=[],a=0;a<e.length;a++){var s=e[a];try{n.push(t.call(r,s,a,e))}catch(e){i.call(r,s,e,n)}}return n},e}();e.ArrayUtils=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){this._backingStore={}}return e.prototype.containsKey=function(e){return this._backingStore.hasOwnProperty(e)},e.prototype.get=function(e){return this._backingStore[e]},e.prototype.set=function(e,t){this._backingStore[e]=t},e.prototype.remove=function(e){return!!this.containsKey(e)&&(delete this._backingStore[e],!0)},e.prototype.clear=function(){this._backingStore={}},e.prototype.values=function(){var e=[];for(var t in this._backingStore)this._backingStore.hasOwnProperty(t)&&e.push(this._backingStore[t]);return e},e.prototype.keys=function(){var e=[];for(var t in this._backingStore)this._backingStore.hasOwnProperty(t)&&e.push(t+"");return e},e}();e.Dictionary=t}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(i){function r(e,r){i.call(this,e,r),this._emptyFeatureSetCollection=null,this._watchHandles=new t.Dictionary,this.featureSetCollection=new Observable,this.featureActions=new ObservableCollection,this.currentFeature=new Observable,this.hasFeatureSets=new Observable(!1),this.isBusy=new Observable(!1),this.isModified=new Observable(!1),this.defaultIsPaged=!0,this.defaultPageSize=50,this.headerText=new Observable(this.app.getResource(this.libraryId,"language-common-results")),this.searchSuggestion=new Observable(this.app.getResource(this.libraryId,"language-common-no-results-desc")),this.featureSetCollection.bind(this,this.handleCollectionChanged),this.registerCommands(),this.subscribeEvents()}return __extends(r,i),r.prototype.subscribeEvents=function(){this.app.event("FSMCollectionOpenedEvent").subscribe(this,this._openFSC),this.app.event("FSMCollectionClosedEvent").subscribe(this,this._closeFSC),this.app.event("FSMCollectionRemovedEvent").subscribe(this,this._removeFSC),this.app.event("FSMCollectionChangedEvent").subscribe(this,this._changeFSC),this.app.event("FeatureEditedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("FeatureDeletedEvent").subscribe(this,this._pulseFeatureSetsInCollection),this.app.event("RelatedRecordEditedEvent").subscribe(this,this._pulseFeatureSetsInCollection)},r.prototype.handleCollectionChanged=function(e){var t=e&&this.app.featureSetManager.getCollectionById(e.id);!t&&e&&e.featureSets&&(t=e),t?(this.isBusy.set(this.app.featureSetManager.isCollectionOpen(t.id)),this.updateHeaderText(t.countFeatures()),this.hasFeatureSets.set(this._featureSetsHaveFeatures(t.featureSets)),this._watchDisplayNameChanges(),this._watchIsModifiedChanges()):(this.isBusy.set(!1),this._unwatchDisplayNameChanges(),this._unwatchIsModifiedChanges()),null!=this.presentableResults&&this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)},r.prototype.handleFeatureSetsChanged=function(e){var t=e.sender,i=this._featureSetsHaveFeatures(t);this.hasFeatureSets.get()!==i&&this.hasFeatureSets.set(i)},r.prototype.updateHeaderText=function(e){var t=null,i="",r=!1;e&&(i=" ("+e+")"),this.featureSetCollection.get()&&(t=this.featureSetCollection.get().displayName.get(),r=this.featureSetCollection.get().isModified.get()),this._count=e;var n="{0}{1}{2}".format(t||this.app.getResource(this.libraryId,"language-common-results"),i,r?"*":"");this.headerText.set(n)},r.prototype._featureSetsHaveFeatures=function(e){if(e)for(var t=0;t<e.length();t++)if(e.getAt(t).features&&e.getAt(t).features.length()>0||e.getAt(t).esriFeatureSet&&e.getAt(t).esriFeatureSet.features&&e.getAt(t).esriFeatureSet.features.length>0)return!0;return!1},r.prototype._openFSC=function(e){if(this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id){this.isBusy.set(!0),this.hasFeatureSets.set(!1);var t=this.app.featureSetManager.getSearchSuggestion(this.featureSetCollection.get().sourceName);this.searchSuggestion.set(t||this.app.getResource(this.libraryId,"language-common-no-results-desc"))}},r.prototype._closeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.isBusy.set(!1),this.featureSetCollection.pulse()},r.prototype._removeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.featureSetCollection.set(this._getEmptyFeatureSetCollection())},r.prototype._changeFSC=function(e){this.featureSetCollection.get()&&e&&e.featureSetCollectionId&&e.featureSetCollectionId==this.featureSetCollection.get().id&&this.featureSetCollection.pulse()},r.prototype._getEmptyFeatureSetCollection=function(){return null==this._emptyFeatureSetCollection?this._emptyFeatureSetCollection=new e.essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection:this._emptyFeatureSetCollection.clear(),this._emptyFeatureSetCollection},r.prototype.registerCommands=function(){var e=this;this.app.command("ShowResultsListFeatureAction").register(this,function(t){e.currentFeature.set(t),e.getResultsFeatureActions(),e.app.command("ActivateView").execute("ResultsFeatureActionsView")}),this.app.command("RemoveUserAddedLayer").register(this,function(t){if(e.featureSetCollection.get()){for(var i=e.featureSetCollection.get().featureSets.get(),r=e.featureSetCollection.get(),n=0;n<i.length;n++)if(i[n].layer===t){r.featureSets.removeItem(i[n]);break}e.featureSetCollection.set(r)}}),this.app.command("ClearSelection").register(this,function(){e.app.command("RemoveFeatureSetCollection").execute(e.featureSetCollection.get())})},r.prototype.getResultsFeatureActions=function(){this.featureActions.clear();var e=this.app.menuRegistry.getMenu("ResultsListFeatureAction");this.app.menuRegistry.getDefaultIconUri("ResultsListFeatureAction");if(!e)throw new Error("Results Feature Actions not found");this.featureActions.addItems(e.items)},r.prototype._pulseFeatureSetsInCollection=function(){this.featureSetCollection&&this.featureSetCollection.get()&&this.featureSetCollection.get().featureSets&&this.featureSetCollection.get().featureSets.length()>0&&this.featureSetCollection.get().featureSets.pulse()},r.prototype._watchDisplayNameChanges=function(){var e=this;this._unwatchDisplayNameChanges();var t=this.featureSetCollection.get()?this.featureSetCollection.get().displayName:null;if(!t)return null;var i=t.bind(this,function(){return e.updateHeaderText(e._count)}),r={remove:function(){return t.unbind(i)}};return this._watchHandles.set("displayName",r),r},r.prototype._unwatchDisplayNameChanges=function(){var e=this._watchHandles.get("displayName");e&&e.remove(),this._watchHandles.remove("displayName")},r.prototype._watchIsModifiedChanges=function(){var e=this;this._unwatchIsModifiedChanges();var t=this.featureSetCollection.get()?this.featureSetCollection.get().isModified:null;if(!t)return null;var i=t.bind(this,function(){return e.updateHeaderText(e._count)}),r={remove:function(){return t.unbind(i)}};return this._watchHandles.set("isModified",r),r},r.prototype._unwatchIsModifiedChanges=function(){var e=this._watchHandles.get("isModified");e&&e.remove(),this._watchHandles.remove("isModified")},r}(e.framework.ui.ViewModelBase);i.ResultsViewModel=r}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(i){function r(t,r){var n=this;i.call(this,t,r),this.pageControlsEnabled=new Observable(!1),this.resultsList=new Observable("results-list"),this.pagingControlClassName=new Observable("paging-control no-pages"),this.contentField=new Observable("description"),this._featureSetsBindingToken=null,this._boundFeatureSetCollection=null,this._featureViewMap={},this.results=new e.framework.ui.ObservableCollectionAggregator(new ObservableCollection),this.presentableResults=new e.framework.ui.PresentableCollection(this.results),this.presentableResults.items.useThrottling=!0,this.resultsPage=this.presentableResults.items,this.presentableResults.pageSize.set(this.defaultPageSize),this.defaultIsPaged!=this.presentableResults.isPaginated.get()&&this.presentableResults.isPaginated.set(this.defaultIsPaged),this.resultsPage.bind(this,this.handlePageResultsChange),this.presentableResults.numberOfItems.bind(this,function(e){e>0?n.pagingControlClassName.set("paging-control has-pages"):n.pagingControlClassName.set("paging-control no-pages"),n.updateHeaderText(e)}),this.app.command("ShowResultsList").register(this,this.showResultsList),this.app.command("SwitchToTabularResultsView").register(this,this._switchToTabularResultsViewImpl,this._canExecuteSwitchToTabularResultsView)}return __extends(r,i),r.prototype.subscribeEvents=function(){i.prototype.subscribeEvents.call(this),this.app.event("FeatureChangedEvent").subscribe(this,this.handleFeatureChanged)},r.prototype.handleCollectionChanged=function(e){if(i.prototype.handleCollectionChanged.call(this,e),this._clearResetUnderlyingCollection(!0),e&&e.featureSets){this._featureSetsBindingToken=e.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSetCollection=e;for(var t=this.results.getCollectionSource(),r=0,n=e.featureSets.length();r<n;r++)t.addItem(e.featureSets.getAt(r).features)}},r.prototype.handleFeatureSetsChanged=function(e){i.prototype.handleFeatureSetsChanged.call(this,e);var t=this.results.getCollectionSource();if("append"===e.type)for(var r=e.sender.getRange(e.rangeStart,e.rangeEnd),n=0;n<r.length;n++)t.addItem(r[n].features);else if("remove"===e.type)for(var a=e.sender.getRange(e.rangeStart,e.rangeEnd),n=0;n<a.length;n++)t.removeItem(a[n].features);else"clear"===e.type&&(this._clearResetUnderlyingCollection(!1),this.results.bindingEvent.publish(e))},r.prototype.handlePageResultsChange=function(e){var i=this;if("clear"===(e=e||{type:null}).type)Object.keys(this._featureViewMap).map(function(e){return i._featureViewMap[e]}).forEach(function(e){return i.app.viewManager.destroyView(e)}),this._featureViewMap={};else if("remove"===e.type&&e.sender.value.length>e.rangeStart){var r=e.sender.getAt(e.rangeStart);this._destroyViewForToken(r.token),this._destroyViewForToken(r.token+"-label")}var n="clear"===e.type||"remove"===e.type&&e.sender.value.length<=1,a=new t.eventArgs.ResultsPageChangedEventArgs;a.featureSetCollection=this.featureSetCollection.get(),a.newValue=n?new ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(a)},r.prototype.handleFeatureChanged=function(e){if(e&&this._featureViewMap.hasOwnProperty(e.token)){var t=this._featureViewMap[e.token],i=this._featureViewMap[e.token+"-label"];i.destroyBindings(),t.destroyBindings(),i.attach(e),t.attach(e)}},r.prototype._destroyViewForToken=function(e){if(e&&this._featureViewMap.hasOwnProperty(e)){var t=this._featureViewMap[e];t&&(this.app.viewManager.destroyView(t),delete this._featureViewMap[e])}},r.prototype.showResultsList=function(e){var t;(t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e)&&t!==this.featureSetCollection.get()?(this.unbindFeatureSet(),this.featureSetCollection.set(t)):this.handlePageResultsChange(),this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsList"),this.presentableResults.numberOfItems.bind(this,this.updateHeaderText)},r.prototype._switchToTabularResultsViewImpl=function(){this.app.command("ShowResultsTable").execute(this.featureSetCollection.get())},r.prototype._canExecuteSwitchToTabularResultsView=function(){return!!this.featureSetCollection.get()},r.prototype.getFeatureView=function(e){return this._featureViewMap[e]},r.prototype.setFeatureView=function(e,t){this._featureViewMap[e]=t},r.prototype.unbindFeatureSet=function(){this._featureSetsBindingToken&&this._boundFeatureSetCollection&&(this._boundFeatureSetCollection.featureSets.unbind(this._featureSetsBindingToken),this._featureSetsBindingToken=null,this._boundFeatureSetCollection=null)},r.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.page=this.presentableResults.currPageNumber.get(),e.viewMode="list"},r.prototype.applyState=function(t){var i=this;t.promises.push(this.app.project.convert.toGcxFeatureSetCollection(t.state.results).then(function(r){r&&(r!==i.featureSetCollection.get()&&(i.unbindFeatureSet(),i.featureSetCollection.set(r)),e.framework.utils.isNullOrUndefined(t.state.page)||i.presentableResults.currPageNumber.set(t.state.page),"list"===t.state.viewMode&&i.app.command("_setResultMappingCommand").execute(r.sourceName,"ShowResultsList"))}))},r.prototype._pulseFeatureSetsInCollection=function(){var e=this.presentableResults.currPageNumber.get();i.prototype._pulseFeatureSetsInCollection.call(this),this.presentableResults.currPageNumber.set(e)},r.prototype._clearResetUnderlyingCollection=function(e){this.results.getCollectionSource().clear(),this.presentableResults.currPageNumber.set(1),e&&(this.unbindFeatureSet(),this._featureViewMap={})},r}(i.ResultsViewModel);i.FlatResultsViewModel=r}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){i=function(){function t(e,t,i,r){this.sortState=new Observable(0),this.sortClass=new Observable(""),this._sortingPredicate=null,this._reverseSortingPredicate=null,this.displayName=t.displayName,this._sharedState=e,"DateTime"===i?(this._sortingPredicate=this.buildDateSortingFunction(r),this._reverseSortingPredicate=this.buildReverseDateSortingFunction(r)):(this._sortingPredicate=this.buildSortingFunction(r),this._reverseSortingPredicate=this.buildReverseSortingFunction(r)),this.sortClass.syncTransform(this.sortState,function(t){switch(t){case 0:return e.unsortedClass;case 1:return e.sortedClass;case 2:return e.reverseSortedClass}return e.unsortedClass}),this.sortState.bind(this,this.onSortStateChange)}return t.prototype.buildSortingFunction=function(t){return function(i,r){return e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(i.attributes.getAt(t).presentableValue.get(),r.attributes.getAt(t).presentableValue.get())}},t.prototype.buildReverseSortingFunction=function(t){return function(i,r){return e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(r.attributes.getAt(t).presentableValue.get(),i.attributes.getAt(t).presentableValue.get())}},t.prototype.buildDateSortingFunction=function(t){return function(i,r){var n=i.attributes.getAt(t).value.get(),a=r.attributes.getAt(t).value.get(),s=new Date(n),o=new Date(a),l="Invalid Date"!=s;return l!==("Invalid Date"!=o)?l?-1:1:l?s.getTime()-o.getTime():e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(n,a)}},t.prototype.buildReverseDateSortingFunction=function(t){return function(i,r){var n=r.attributes.getAt(t).value.get(),a=i.attributes.getAt(t).value.get(),s=new Date(n),o=new Date(a),l="Invalid Date"!=s;return l!==("Invalid Date"!=o)?l?-1:1:l?s.getTime()-o.getTime():e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(n,a)}},t.prototype.onSortStateChange=function(e){if(!this._sharedState.ignoreStateChange){if(e<0||e>2)throw new Error("Illegal column sort state: "+e);if(0==e){if(this._sharedState.lastSortedColumn!=this)throw new Error("Column sort state out of sync");this._sharedState.lastSortedColumn=null,this._sharedState.presentableResults.sortingPredicate=null,this._sharedState.presentableResults.unsortCollection()}else{if(null!=this._sharedState.lastSortedColumn&&this._sharedState.lastSortedColumn!=this&&(this._sharedState.ignoreStateChange=!0,this._sharedState.lastSortedColumn.sortState.set(0),this._sharedState.ignoreStateChange=!1),this._sharedState.lastSortedColumn=this,1==e)this._sharedState.presentableResults.sortingPredicate=this._sortingPredicate;else{if(2!=e)throw new Error("Invalid column sort state.");this._sharedState.presentableResults.sortingPredicate=this._reverseSortingPredicate}this._sharedState.presentableResults.sortCollection()}}},t}();t.ResultsAttributeHeaderViewModel=i;var i;!function(t){t.manualCollator=function(e,t){return isNaN(e)||isNaN(t)?e<t?-1:e>t?1:0:+e-t},t.collator="object"==typeof Intl&&"function"==typeof Intl.Collator?new Intl.Collator(void 0,{numeric:!0}).compare:e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.manualCollator;var i=function(){function e(e,t,i,r){this.lastSortedColumn=null,this.presentableResults=e,this.unsortedClass=t,this.sortedClass=i,this.reverseSortedClass=r,this.reset()}return e.prototype.reset=function(){this.ignoreStateChange=!1,this.lastSortedColumn=null},e}();t.SharedState=i}(i=t.ResultsAttributeHeaderViewModel||(t.ResultsAttributeHeaderViewModel={}))}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.handleMenuItemClick=function(e,t,i){i.execute(this.viewModel.currentFeature.get())},t.prototype.handleGetDescription=function(e,t,i){t.title=i.description.get()},t}(e.framework.ui.ViewBase);t.ResultsFeatureActionsView=i}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i){var r=this;t.call(this,e,i),this.isCollapsed=!0,this.isContainerCollapsed=!0,this._longPressTimer=null,this._pressStartTime=null,this._pressLengthMs=1500,this._firedTouchOrPress=!1,this._ignoreMouseEventFlag=!1,this._pressYStart=null,this._lastTouchY=null,this._scrollYDeltaThreshold=35,this._firstEvent=null,this.app.event("ViewContainerActivatedEvent").subscribe(this,function(e){!r.isCollapsed&&r._isViewHostedInContainer(e)&&(r.app.event("ResultsViewOpenedEvent").publish(r),r.isContainerCollapsed=!1)}),this.app.event("ViewContainerDeactivatedEvent").subscribe(this,function(e){!r.isCollapsed&&r._isViewHostedInContainer(e)&&(r.app.event("ResultsViewCollapsedEvent").publish(r),r.isContainerCollapsed=!0)}),this.app.event("ViewContainerViewClosedEvent").subscribe(this,function(e){e.viewId===r.id&&(r.app.event("ResultsViewClosedEvent").publish(r),r.isContainerCollapsed=!0)})}return __extends(i,t),i.prototype.activated=function(){t.prototype.activated.call(this),this.isCollapsed=!1,this.app.event("ResultsViewOpenedEvent").publish(this)},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.isCollapsed=!0,this.app.event("ResultsViewCollapsedEvent").publish(this)},i.prototype.handleTouchStart=function(e,t,i){return this._firstEvent||(this._firstEvent="touch start",this._beginLongPress(i)),!0},i.prototype.handleTouchMove=function(e,t,i){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},i.prototype.handleTouchEnd=function(e,t,i){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},i.prototype.handleTouchCancel=function(e,t,i){return"touch start"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},i.prototype.handleMouseDown=function(e,t,i){return this._firstEvent||(this._firstEvent="mouse down",this._beginLongPress(i)),!0},i.prototype.handleClick=function(e,t,i){this._firstEvent&&(this._firstEvent=null,this._cancelLongPress());var r=e.target,n=!("IMG"!==r.tagName||!r.parentElement||"A"!==r.parentElement.tagName||!r.parentElement.href);return!("A"!==r.tagName&&!n)||(this.app.command("ClearFeatureInformation").execute(),this.app.event(this.featureClickedEventName).publish(i),!1)},i.prototype.handleMouseUp=function(e,t,i){return"mouse down"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress()),!0},i.prototype.handleMouseOut=function(e,t,i){"mouse down"===this._firstEvent&&(this._firstEvent=null,this._cancelLongPress())},i.prototype._beginLongPress=function(e){var t=this;this._longPressTimer&&clearTimeout(this._longPressTimer),this._longPressTimer=setTimeout(function(){t.app.event(t.featurePressedEventName).publish(e)},this._pressLengthMs)},i.prototype._cancelLongPress=function(){this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null)},i.prototype._isViewHostedInContainer=function(t){if(t instanceof e.framework.ui.ViewContainer.ViewContainerView){var i=t.viewModel.regionName.get(),r=this.app.viewManager.getRegionForViewId(this.id);if(r&&r.name===i)return!0}return!1},i.prototype.scrollView=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},i}(e.framework.ui.ViewBase);t.ResultsViewBase=i,i.prototype.featureClickedEventName="ResultsListFeatureClickedEvent",i.prototype.featurePressedEventName="ResultsListFeaturePressedEvent"}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(t){function i(e,i){t.call(this,e,i),this.featureClickedEventName="ResultsListFeatureClickedEvent",this.featurePressedEventName="ResultsListFeaturePressedEvent",this._subscriptions=null,this._scrollTop=0,this.app.command("ShowResultsList").register(this,this.showResultsList),this.app.command("ShowResultsTable").register(this,this._handleShowResultsTable),this.app.command("SwitchToTabularResultsView").register(this,this._switchToTabularResultsViewImpl,this._canExecuteSwitchToTabularResultsView),this.app.command("_ExportResultsViewState").register(this,this._exportState),this.app.command("_ApplyResultsViewState").register(this,this._applyState)}return __extends(i,t),i.prototype.activated=function(){var e=this;if(t.prototype.activated.call(this),this._unsubscribeFromEvents(),"DataFrameResultsContainerRegion"===this.regionName||"DataRegion"===this.regionName){var i=this.app.event("DataFrameOpenedEvent").subscribe(this,this._dataFrameOpenedEventHandler),r=this.app.event("DataFrameClosedEvent").subscribe(this,this._dataFrameClosedEventHandler);this._subscriptions=[{eventName:"DataFrameOpenedEvent",token:i},{eventName:"DataFrameClosedEvent",token:r}]}if(this.resultsList){var n=this.resultsList;setTimeout(function(){dojo.style(n,{display:"block"})},1)}this.viewModel.featureSetCollection.bind(this,function(t){e.app.trace.debug("View focused in results list: "+e.id),e.app.command("FocusOnFirstInputInView").execute(e)})},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this._unsubscribeFromEvents()},i.prototype.attach=function(e){var i=this;this.title.sync(e.headerText),this.isBusy.sync(e.isBusy),void 0!=this.configuration.isPaged&&e.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&e.presentableResults.pageSize.set(this.configuration.pageSize),this.configuration.contentField&&e.contentField.set(this.configuration.contentField),e.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){i.scrollViewTop()}),this.scrollViewTop(this._scrollTop),t.prototype.attach.call(this,e)},i.prototype.showResultsList=function(e){this.app.viewManager.activateView(this)},i.prototype.handlePageFirst=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.presentableResults.currPageNumber.set(1)},i.prototype.handlePagePrev=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()-1)},i.prototype.handlePageNext=function(e,t,i){this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.currPageNumber.get()+1)},i.prototype.handlePageLast=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()&&this.viewModel.presentableResults.currPageNumber.set(this.viewModel.presentableResults.lastPageNumber.get())},i.prototype.handleScrollChange=function(e,t,i){i&&(this._scrollTop=t.scrollTop)},i.prototype.getDescription=function(e,t,i){t.title=i.description.get()},i.prototype.scrollViewTop=function(e){this.scrollContainerElement&&(this.scrollContainerElement.scrollTop=e||0)},i.prototype.resolveWidget=function(i,r,n){switch(t.prototype.resolveWidget.call(this,i,r),i){case"GetLabel":return(a=new e.FeatureDescriptionPresenterView(this.app,this.libraryId)).contentField="label",a.root=dojo.create("div"),a.root.className="feature-label",a.attach(r),this.viewModel.setFeatureView(r.token+"-label",a),a;case"GetDescription":var a=new e.FeatureDescriptionPresenterView(this.app,this.libraryId);return a.contentField=this.viewModel.contentField.get(),a.root=dojo.create("div"),a.root.className="feature-description",a.attach(r),this.viewModel.setFeatureView(r.token,a),a;case"ResultsListActionsWidget":var s=this.app.menuRegistry.createMenuWidget(this,r,n);if(s)return s;break;default:return}},i.prototype._handleShowResultsTable=function(){this.app.viewManager.deactivateView(this)},i.prototype._switchToTabularResultsViewImpl=function(){this.app.command("CloseDataFrame").execute()},i.prototype._canExecuteSwitchToTabularResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},i.prototype._dataFrameOpenedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewOpenedEvent").publish(this)},i.prototype._dataFrameClosedEventHandler=function(){this.isContainerCollapsed||this.app.event("ResultsViewCollapsedEvent").publish(this)},i.prototype._unsubscribeFromEvents=function(){if(this._subscriptions)for(var e=0;e<this._subscriptions.length;e++){var t=this._subscriptions[e];this.app.event(t.eventName).unsubscribe(t.token)}this._subscriptions=null},i.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},i.prototype._applyState=function(e){this.viewModel.applyState(e)},i}(t.ResultsViewBase);t.ResultsListView=i}(e.results||(e.results={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function e(){}return e.prototype.toJSONString=function(){return JSON.stringify({name:this.name,featureSet:this.featureSet.toJson()})},e}(),n=function(i){function n(){i.apply(this,arguments),this._supportedFormats=["csv","xlsx","shp"],this._showInvisibleAttributes=!1}return __extends(n,i),n.prototype.initialize=function(e){var t=this;i.prototype.initialize.call(this,e),e&&(this.resultMappings=e.resultMappings,e.customSearchSuggestions&&this.app.featureSetManager.addSearchSuggestions(e.customSearchSuggestions)),e.showInvisibleAttributesOnExport&&(this._showInvisibleAttributes=e.showInvisibleAttributesOnExport),this.wireUpResultMapping(),this.app.command("ExportResultsTo").register(this,function(e){var i="csv";e.fsc?(e.format?-1===t._supportedFormats.indexOf(e.format)?t.app.trace.warning("ExportResultsTo: {0} file format not recognized. Defaulting to csv.".format(e.format)):i=e.format:t.app.trace.warning("ExportResultsTo: file format not specified. Defaulting to csv."),t.exportTo({fsc:e.fsc,format:i})):t.app.trace.error("ExportResultsTo: Cannot export, no feature set collection specified.")},this.exportToCanExecute)},n.prototype.getStateFilter=function(){var e=new t.validation.NumberValidator;return{featureSetCollections:{item:this.app.project.filter.featureSetCollection},results:this.app.project.filter.featureSetCollection,viewMode:!0,page:e,tableOptions:{selectedFeatureSet:this.app.project.filter.featureSet,sortColumn:e,sortDirection:!0}}},n.prototype.exportState=function(){var e=this,t={featureSetCollections:this.app.featureSetManager.featureSetCollections.get().map(function(t){return e.app.project.convert.fromGcxFeatureSetCollection(t)})};return Promise.try(function(){return e.app.command("_ExportResultsViewState").execute(t),t})},n.prototype.applyState=function(e){var i=this;return t.PromiseUtils.mapSkipRejected(e.featureSetCollections,function(e){return i.app.project.convert.toGcxFeatureSetCollection(e)}).then(function(){return i.app.waitUntilAllLibrariesLoaded()}).then(function(){var t={state:e,promises:[]};return i.app.command("_ApplyResultsViewState").execute(t),Promise.all(t.promises).return()})},n.prototype.wireUpResultMapping=function(){this.app.event("FSMCollectionOpenedEvent").subscribe(this,this.fsmCollectionOpenedHandler),this.app.command("_setResultMappingCommand").register(this,this.fsmCollectionSetCommand),this.app.command("FSMCollectionSetCommand").register(this,this.fsmCollectionSetCommand)},n.prototype.fsmCollectionOpenedHandler=function(e){var t=e.featureSetCollection;if(this.resultMappings){var i=this.resultMappings[t.sourceName];if(i)for(var r=0;r<i.length;r++){var n=i[r];this.app.command(n).execute(t.id),this._lastCommand=n}}},n.prototype.fsmCollectionSetCommand=function(e,t){if(t){var i=null;if("ShowResultsList"===t?i="ShowResultsTable":"ShowResultsTable"===t&&(i="ShowResultsList"),i&&this.resultMappings&&this.resultMappings[e]){var r=this.resultMappings[e],n=r.indexOf(i);n>-1?r[n]=t:-1===r.indexOf(t)&&r.push(t)}}},n.prototype.exportTo=function(t){var i=this,r=new e.essentialsHtmlViewer.mapping.infrastructure.commandArgs.AddStatusArgs(this.app.getResource(this.libraryId,"language-results-export-to-status-message").format(t.format)),n="exportTo "+t.format+"StatusMessage";r.id=n,r.showBusyIcon=!0,this.app.command("AddStatus").execute(r);var a=this.app.site.url,s=a.substring(0,a.toLowerCase().lastIndexOf("/sites/"))+"/Utilities/Extract";e.request({url:s,content:{format:t.format,featureSets:this.fscToJson(t.fsc),f:"json"},load:dojo.hitch(this,function(e){return i.exportToSuccess(e,t.format)}),error:function(e){i.app.command("RemoveStatus").execute(n),i.app.commandRegistry.command("Alert").execute(e.message,i.app.getResource(i.libraryId,"language-results-export-to-alert-error-message").format(t.format))}})},n.prototype.exportToSuccess=function(e,t){var i=this;if(e&&e.hasOwnProperty("href")){var r=e.href,n=this.app.getResource(this.libraryId,"language-results-export-to-confirm-content").format(t),a=this.app.getResource(this.libraryId,"language-results-export-to-confirm-title").format(t),s="exportTo "+t+"StatusMessage";this.app.command("RemoveStatus").execute(s),this.app.commandRegistry.command("Confirm").execute(n,a,function(e){e&&(i.app.isNative.get()?window.open(r,"_blank"):window.location.assign(r))})}},n.prototype.exportToCanExecute=function(e){var i=null;return e&&(e instanceof t.FeatureSetCollection?i=e:e.fsc&&e.fsc instanceof t.FeatureSetCollection&&(i=e.fsc)),i&&i.featureSets.get()&&i.featureSets.get().length>0},n.prototype.getFields=function(e){var t=[];return e.esriFeatureSet&&e.esriFeatureSet.features&&e.esriFeatureSet.features.length>0&&(t=this.getFieldsFromEsriLayer(e.esriFeatureSet.features[0].getLayer(),e)),0===t.length&&(e.layer&&e.layer.fields&&e.layer.fields.length>0?t=this.getFieldsFromEssentialsLayer(e.layer):e.attributes.get()&&e.attributes.get().length>0?t=this.getFieldsFromGcxFeatureSetAttributes(e.attributes.get(),e):e.features.get()&&e.features.get().length>0&&e.features.getAt(0).attributes.get()&&e.features.getAt(0).attributes.get().length>0?t=this.getFieldsFromGcxFeatureAttributes(e.features.getAt(0).attributes.get(),e):e.esriFeatureSet&&e.esriFeatureSet.features&&e.esriFeatureSet.features.length>0&&e.esriFeatureSet.features[0].attributes&&e.esriFeatureSet.features[0].attributes.length>0?t=this.getFieldsFromEsriFeatureAttributeValues(e.esriFeatureSet.features):e.features.get()&&e.features.get().length>0&&e.features.getAt(0).attributes.get()&&e.features.getAt(0).attributes.get().length>0&&(t=this.getFieldsFromGcxFeatureAttributeValues(e.features.get()))),t},n.prototype.getFieldsFromEsriLayer=function(e,t){var i=[];if(e&&e.fields&&(i=e.fields.slice(0),t&&t.features.get()&&t.features.getAt(0).attributes.get())){var r=t.features.getAt(0).attributes.get();r.length===i.length&&r.forEach(function(e,t){i[t].alias=e.displayName.get()?e.displayName.get():i[t].alias})}return i},n.prototype.getFieldsFromEssentialsLayer=function(t){var i=[],r=new esri.layers.Field;return t.fields.forEach(function(t){(r=new esri.layers.Field).name=t.name,r.alias=t.displayName,r.type=e.essentials.Field.convertToEsriFieldType(t.dataType),i.push(r)}),i},n.prototype.getFieldsFromGcxFeatureSetAttributes=function(t,i){var r=this,n=[],a=new esri.layers.Field;return t.forEach(function(t,s){(a=new esri.layers.Field).name=t.name.get(),a.alias=t.displayName.get(),t.type.get()?a.type=e.essentials.Field.convertToEsriFieldType(t.type.get()):i.features.get().length>0&&i.features.getAt(0).attributes.get()&&i.features.getAt(0).attributes.get().length>0?a.type=r.getTypeFromGcxFeatures(i.features.get(),s):a.type=r.getEsriTypeFromValue(null),n.push(a)}),n},n.prototype.getFieldsFromGcxFeatureAttributes=function(t,i){var r=this,n=[],a=new esri.layers.Field;return t.forEach(function(t,s){(a=new esri.layers.Field).name=t.name.get(),a.alias=t.displayName.get(),t.type.get()?a.type=e.essentials.Field.convertToEsriFieldType(t.type.get()):a.type=r.getTypeFromGcxFeatures(i.features.get(),s),n.push(a)}),n},n.prototype.getFieldsFromEsriFeatureAttributeValues=function(e){var t=0,i=[],r=new esri.layers.Field,n=e[0].attributes,e=e;for(var a in n)n.hasOwnProperty(a)&&((r=new esri.layers.Field).name=a,r.alias=a,r.type=this.getTypeFromEsriFeatures(e,t),i.push(r),t++);return i},n.prototype.getFieldsFromGcxFeatureAttributeValues=function(e){var t=0,i=[],r=new esri.layers.Field,n=e[0].attributes.get(),e=e;for(var a in n)n.hasOwnProperty(a)&&((r=new esri.layers.Field).name=a,r.alias=a,r.type=this.getTypeFromGcxFeatures(e,t),i.push(r),t++);return i},n.prototype.getTypeFromEsriFeatures=function(e,t){var i=this,r=this.getEsriTypeFromValue(null);return e.forEach(function(e){var n=e.attributes[t];n&&(r=i.getEsriTypeFromValue(n))}),r},n.prototype.getTypeFromGcxFeatures=function(e,t){var i=this,r=this.getEsriTypeFromValue(null);return e.forEach(function(e){var n=e.attributes.getAt(t).value.get();n&&(r=i.getEsriTypeFromValue(n))}),r},n.prototype.getEsriTypeFromValue=function(e){var t="esriFieldTypeString";return"number"==typeof e?t="esriFieldTypeDouble":e instanceof Date&&(t="esriFieldTypeDate"),t},n.prototype.getFeatureSets=function(i){var n=this,a=new esri.tasks.FeatureSet,s=new esri.Graphic,o=[];return i.featureSets.get().forEach(function(l,c){var u=n.getFields(l);if(a=new esri.tasks.FeatureSet,l&&l.features.get()&&l.features.get().length>0){var p=[],h=[];l.features.getAt(0).attributes.get().forEach(function(e){e.visible.get()||n._showInvisibleAttributes?p.push(e.name.get()):h.push(e.name.get())}),l.features.get().forEach(function(i){var r={},o=i.esriFeature.get().attributes;i.getAttributes().forEach(function(i){if(i.visible.get()||n._showInvisibleAttributes){var a,s=i.name.get(),l=i.presentableValue.get();for(var c in u){var p=u[c];if(p.name===i.name.get()){a=p.type;var h=u.filter(function(e){return-1!==e.name.indexOf(".Name()",e.name.length-".Name()".length)&&e.name.substr(0,e.name.length-".Name()".length)===p.name});if(h&&h.length>0){var d=h[0].name;if(d&&o&&o.hasOwnProperty(d)){var m=o[p.name],g=m;m=l,l=g,r[d]=m}}break}}l&&s&&(p.domain&&"codedValue"==p.domain.type?(p.type=e.essentials.EsriFieldTypes.esriFieldTypeString,r[s]=i.presentableValue.get()):p.type===e.essentials.EsriFieldTypes.esriFieldTypeDouble||p.type===e.essentials.EsriFieldTypes.esriFieldTypeSingle?r[s]=t.FormatUtils.parseNumber(i.value.get()):a===e.essentials.EsriFieldTypes.esriFieldTypeInteger||p.type===e.essentials.EsriFieldTypes.esriFieldTypeSmallInteger?r[s]=Math.floor(t.FormatUtils.parseNumber(i.value.get())):a===e.essentials.EsriFieldTypes.esriFieldTypeDate?r[s]=t.FormatUtils.parseDate(i.value.get()):r[s]=l)}}),a.displayFieldName=l.esriFeatureSet.displayFieldName,s=new esri.Graphic(i.esriFeature.get().geometry,null,r,null),a.features.push(s)})}else l&&l.features.get().length>0&&l.features.get().forEach(function(e){s=e.esriFeature.get(),a.features.push(s)});if(a.features.length>0){if(u&&u.length>0){var d=[];u.forEach(function(e){-1==$.inArray(e.name,h)&&d.push(e)}),a.fields=d}var m=new r;m.name=i.featureSets.getAt(c).displayName.get(),m.featureSet=a;var g=0;o.forEach(function(e){m.name===e.name&&(g+=1)}),g>0&&(m.name=m.name+g),o.push(m)}}),o},n.prototype.fscToJson=function(e){var t="[";return this.getFeatureSets(e).forEach(function(e,i,n){var a=new r;a.featureSet=e.featureSet,a.name=e.name,t+=a.toJSONString(),i!==n.length-1&&(t+=",")}),t+="]"},n}(e.framework.application.ModuleBase);i.ResultsModule=n}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i){t.call(this,e,i),this.featureClickedEventName="ResultsTableFeatureClickedEvent",this.featurePressedEventName="ResultsTableFeaturePressedEvent",this.scrollContainerElement=null,this.tabContainerElement=null,this.tabElements=null,this.scrollTabLeftElement=null,this.scrollTabRightElement=null,this._fsBindingToken=null,this._boundFs=null,this.app.command("ShowResultsTable").register(this,this.showResultsTable),this.app.command("ShowResultsList").register(this,this._handleShowResultsList),this.app.command("SwitchToListResultsView").register(this,this._switchToListResultsViewImpl,this._canExecuteSwitchToListResultsView),this.app.command("_ExportResultsViewState").register(this,this._exportState),this.app.command("_ApplyResultsViewState").register(this,this._applyState)}return __extends(i,t),i.prototype.attach=function(e){var i=this;this.title.sync(e.headerText),this.isBusy.sync(e.isBusy),void 0!=this.configuration.isPaged&&e.presentableResults.isPaginated.set(this.configuration.isPaged),this.configuration.pageSize&&e.presentableResults.pageSize.set(this.configuration.pageSize),e.presentableResults.currPageNumber.bindingEvent.subscribe(this,function(){var e=i.viewModel.curFeatureSet.get(),t=e?i.viewModel.currScrollPosWithinTab[e.uniqueId]||0:0;i.scrollView(t)}),t.prototype.attach.call(this,e)},i.prototype.resolveWidget=function(i,r,n){switch(t.prototype.resolveWidget.call(this,i,r),i){case"ResultsTableActionsWidget":return this.app.menuRegistry.createMenuWidget(this,r,n);case"TableViewWidget":var a=this.viewModel,s=this.app.viewManager.createView({typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableView",markupResource:"Mapping/infrastructure/ui/components/Table/TableView.html",libraryId:this.libraryId,isVisible:!0});if(s){var o=new e.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableViewModel(this.app,this.libraryId);o.addRecordClickEvents(this.featureClickedEventName),o.addRecordLongPressEvents(this.featurePressedEventName),o.columnHeaders=this.viewModel.columnHeaders,o.attachToPresentableCollection(a.presentableResults),s.attach(o),this.scrollContainerElement=s.tableContainerElement}return s;default:this.app.trace.warning("ResultsTableView: Unknown Widget")}},i.prototype.showResultsTable=function(e){var t=this;this.app.viewManager.activateView(this),this.viewModel.featureSetCollection.get()&&(this._unbindFromPrevFeatureSet(),this._boundFs=this.viewModel.featureSetCollection.get().featureSets,this._boundFs&&(this._fsBindingToken=this.viewModel.featureSetCollection.get().featureSets.bind(this,this._refreshTabControlVisibility)));var i=null,r=this.app.event("ApplicationResizedEvent").subscribe(this,function(){t.isActive?(i&&(clearTimeout(i),i=null),i=setTimeout(function(){t._refreshTabControlVisibility()},200)):(t.app.event("ApplicationResizedEvent").unsubscribe(r),r=null)});this._refreshTabControlVisibility()},i.prototype._refreshTabControlVisibility=function(){var e=this;setTimeout(function(){e.tabContainerElement&&e.tabElements&&(e.viewModel.tabControlsEnabled.set(e.tabElements.offsetWidth>e.tabContainerElement.offsetWidth),e._updateScrollTabDisabledStatus())},100)},i.prototype.handleTabClick=function(e,t,i){this.scrollContainerElement&&(this.viewModel.currScrollPosWithinTab[this.viewModel.curFeatureSet.get().uniqueId]=this.scrollContainerElement.scrollTop);var r=dojo.filter(this.viewModel.featureSetCollection.get().featureSets.get(),function(e){return e.uniqueId===i.uniqueId});r&&r[0]&&this.viewModel.curFeatureSet.get()!==r[0]&&(this.viewModel.setCurrentSelectedFeatureSet(r[0]),this.viewModel.setCurrentPageWithinTab(i.uniqueId)),this.app.command("FocusOnFirstInputInView").execute(this)},i.prototype.handlePageFirst=function(e,t,i){this.viewModel.presentableResults.currPageNumber.get()>1&&(this.viewModel.updateCurrentPageAndScrollPosWithinTab(1,0),this.viewModel.presentableResults.currPageNumber.set(1))},i.prototype.handlePagePrev=function(e,t,i){if(this.viewModel.presentableResults.currPageNumber.get()>1){var r=this.viewModel.presentableResults.currPageNumber.get()-1;this.viewModel.updateCurrentPageAndScrollPosWithinTab(r,0),this.viewModel.presentableResults.currPageNumber.set(r)}},i.prototype.handlePageNext=function(e,t,i){if(this.viewModel.presentableResults.lastPageNumber.get()>this.viewModel.presentableResults.currPageNumber.get()){var r=this.viewModel.presentableResults.currPageNumber.get()+1;this.viewModel.updateCurrentPageAndScrollPosWithinTab(r,0),this.viewModel.presentableResults.currPageNumber.set(r)}},i.prototype.handlePageLast=function(e,t,i){if(this.viewModel.presentableResults.currPageNumber.get()<this.viewModel.presentableResults.lastPageNumber.get()){var r=this.viewModel.presentableResults.lastPageNumber.get();this.viewModel.updateCurrentPageAndScrollPosWithinTab(r,0),this.viewModel.presentableResults.currPageNumber.set(r)}},i.prototype.handleTabScrollBack=function(e,t,i){var r=$(this.tabContainerElement),n=r.scrollLeft()-2*this.scrollTabLeftElement.offsetWidth;r.scrollLeft(n<0?0:n),this._updateScrollTabDisabledStatus()},i.prototype.handleTabScrollForward=function(e,t,i){var r=$(this.tabContainerElement),n=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth,a=r.scrollLeft()+2*this.scrollTabRightElement.offsetWidth;r.scrollLeft(a>n?n:a),this._updateScrollTabDisabledStatus()},i.prototype.handleClickFeature=function(e,t,i){this.app.event("ResultsTableFeatureClickedEvent").publish(i)},i.prototype.handleColumnHeadClick=function(e,t,i){i.sortState.set((i.sortState.get()+1)%3)},i.prototype._handleShowResultsList=function(){this.app.viewManager.deactivateView(this)},i.prototype._switchToListResultsViewImpl=function(){this.app.command("CloseBottomRegion").execute()},i.prototype._canExecuteSwitchToListResultsView=function(){return this.isActive&&!this.app.configuration.mobileMode},i.prototype._updateScrollTabDisabledStatus=function(){if(this.tabContainerElement){var e=this.tabContainerElement.scrollWidth-this.tabContainerElement.offsetWidth;this.viewModel.leftScrollTabDisabled.set(0===this.tabContainerElement.scrollLeft),this.viewModel.rightScrollTabDisabled.set(this.tabContainerElement.scrollLeft>e-1)}},i.prototype._unbindFromPrevFeatureSet=function(){this._fsBindingToken&&this._boundFs&&this._boundFs.unbind(this._fsBindingToken),this._fsBindingToken=this._boundFs=null},i.prototype._exportState=function(e){this.isActive&&this.viewModel.exportState(e)},i.prototype._applyState=function(e){this.viewModel.applyState(e)},i}(t.ResultsViewBase);t.ResultsTableView=i}(t.results||(t.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(i){!function(r){var n=e.framework.utils.ArrayUtils,a=t.infrastructure.ui.components.Table.SortState,s=function(t){function r(i,r){t.call(this,i,r),this.curFeatureSet=new Observable(null),this.currPageWithinTab={},this.currScrollPosWithinTab={},this.presentableResults=new e.framework.ui.PresentableCollection,this.pageControlsEnabled=new Observable(!1),this.tabControlsEnabled=new Observable(!1),this.resultsTable=new Observable("results-table"),this.columnSharedState=null,this.columnHeaders=new ObservableCollection([]),this.leftScrollTabDisabled=new Observable(!1),this.rightScrollTabDisabled=new Observable(!1),this._firstVisibleTab=0,this._emptyFeatureSet=new e.essentialsHtmlViewer.mapping.infrastructure.FeatureSet({app:this.app}),this._boundFeatureSets=null,this._featureSetsBindingToken=null,this.presentableResults.items.useThrottling=!0,this.resultsPage=this.presentableResults.items,this.presentableResults.pageSize.set(this.defaultPageSize),this.defaultIsPaged!=this.presentableResults.isPaginated.get()&&this.presentableResults.isPaginated.set(this.defaultIsPaged),this.curFeatureSet.bind(this,this.handleCurrentFeatureSetChanged),this.presentableResults.numberOfItems.bind(this,this.updateHeaderText),this.resultsPage.bind(this,this._handlePageResultsChange),this.app.command("ShowResultsTable").register(this,this.showResultsTable),this.app.command("SwitchToListResultsView").register(this,this._switchToListResultsViewImpl,this._canExecuteSwitchToListResultsView)}return __extends(r,t),r.prototype.handleCollectionChanged=function(e){if(t.prototype.handleCollectionChanged.call(this,e),this.unbindFeatureSets(),e&&e.featureSets){this._featureSetsBindingToken=e.featureSets.bind(this,this.handleFeatureSetsChanged),this._boundFeatureSets=e.featureSets,this._firstVisibleTab=0;for(var i=null,r=0;r<e.featureSets.length();r++)if(e.featureSets.getAt(r).isSelectedInCollection.get()){i=e.featureSets.getAt(r);break}!i&&e.featureSets.length()>0&&(i=e.featureSets.getAt(0)),i!==this.curFeatureSet.get()&&(this.setCurrentSelectedFeatureSet(i),this.currPageWithinTab={},this.currScrollPosWithinTab={})}},r.prototype.handleCurrentFeatureSetChanged=function(e){this.presentableResults.sortingPredicate=null,this.presentableResults.attachToCollection(e.features),this.buildColumnHeaders(e)},r.prototype.handleFeatureSetsChanged=function(e){t.prototype.handleFeatureSetsChanged.call(this,e);var i=e.sender;if("append"===e.type){0===e.rangeStart&&this.setCurrentSelectedFeatureSet(i.getAt(0));for(var r=e.rangeStart;r<=e.rangeEnd;r++)i.getAt(r).isSelectedInCollection.get()&&this.setCurrentSelectedFeatureSet(i.getAt(r))}else if("remove"===e.type){var n=this.curFeatureSet.get();if(n){var a=i.indexOf(n);a>=e.rangeStart&&a<=e.rangeEnd&&(e.rangeEnd+1<i.length()?this.setCurrentSelectedFeatureSet(i.getAt(e.rangeEnd+1)):e.rangeStart>0?this.setCurrentSelectedFeatureSet(i.getAt(e.rangeStart-1)):this.setCurrentSelectedFeatureSet(null))}}},r.prototype.showResultsTable=function(e){var t;(t="string"==typeof e?this.app.featureSetManager.getCollectionById(e):e)&&(t!==this.featureSetCollection.get()?(this.unbindFeatureSets(),this.featureSetCollection.set(t)):this._handlePageResultsChange(),this.app.command("_setResultMappingCommand").execute(t.sourceName,"ShowResultsTable")),this.currPageWithinTab={},this.currScrollPosWithinTab={}},r.prototype._switchToListResultsViewImpl=function(){this.app.command("ShowResultsList").execute(this.featureSetCollection.get())},r.prototype._canExecuteSwitchToListResultsView=function(){return!!this.featureSetCollection.get()},r.prototype.setCurrentSelectedFeatureSet=function(e){for(var t=this.featureSetCollection.get().featureSets,i=0;i<t.length();i++)t.getAt(i).isSelectedInCollection.set(t.getAt(i)===e);e&&this.curFeatureSet.set(e)},r.prototype.unbindFeatureSets=function(){this._featureSetsBindingToken&&this._boundFeatureSets&&this._boundFeatureSets.unbind(this._featureSetsBindingToken),this._boundFeatureSets=null,this._featureSetsBindingToken=null},r.prototype.buildColumnHeaders=function(t){this.columnHeaders.clear(),this.columnSharedState?this.columnSharedState.reset():this.columnSharedState=new e.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableColumnHeaderViewModel.SharedState(this.presentableResults,"sort","sort-up","sort-down");var i,r={};if(t.layer&&t.layer.fields)for(i=0;i<t.layer.fields.length;i++){var n=t.layer.fields[i];r[n.name]=n.dataType}var a=t.attributes.length();for(a||(t.loadAttributes(),a=t.attributes.length()),i=0;i<a;i++){var s=t.attributes.getAt(i);s.visible&&!s.visible.get()||this.columnHeaders.addItem(new e.essentialsHtmlViewer.mapping.infrastructure.ui.components.Table.TableColumnHeaderViewModel(this.app,this.libraryId,this.columnSharedState,s.displayName.get(),r[s.name.get()],i))}},r.prototype.setCurrentPageWithinTab=function(e){this.currPageWithinTab[e]?this.currPageWithinTab[e]!==this.presentableResults.currPageNumber.get()&&this.presentableResults.currPageNumber.set(this.currPageWithinTab[e]):this.currPageWithinTab[e]=this.presentableResults.currPageNumber.get()},r.prototype.updateCurrentPageAndScrollPosWithinTab=function(e,t){this.currScrollPosWithinTab[this.curFeatureSet.get().uniqueId]=t,this.currPageWithinTab[this.curFeatureSet.get().uniqueId]=e},r.prototype.exportState=function(e){var t=this.featureSetCollection.get();e.results=this.app.project.convert.fromGcxFeatureSetCollection(t),e.viewMode="table",e.page=this.presentableResults.currPageNumber.get();var i=n.firstOrDefault(t.featureSets.get(),function(e){return e.isSelectedInCollection.get()});if(i){e.tableOptions={selectedFeatureSet:this.app.project.convert.fromGcxFeatureSet(i)};var r=n.firstOrDefault(this.columnHeaders.get(),function(e){return e.sortState.get()!==a.UNSORTED});r&&(e.tableOptions.sortColumn=this.columnHeaders.get().indexOf(r),e.tableOptions.sortDirection=r.sortState.get()===a.ASCENDING?"asc":"desc")}},r.prototype.applyState=function(t){var i=this,r={results:this.app.project.convert.toGcxFeatureSetCollection(t.state.results),selectedFeatureSet:t.state.tableOptions?this.app.project.convert.toGcxFeatureSet(t.state.tableOptions.selectedFeatureSet).catch(function(e){}):null};t.promises.push(Promise.props(r).then(function(r){if(r.results){r.results!==i.featureSetCollection.get()&&(i.unbindFeatureSets(),i.featureSetCollection.set(r.results)),"table"===t.state.viewMode&&i.app.command("_setResultMappingCommand").execute(r.results.sourceName,"ShowResultsTable");var s=n.firstOrDefault(r.results.featureSets.get(),function(e){return e===r.selectedFeatureSet});if(s&&(i.setCurrentSelectedFeatureSet(s),e.framework.utils.isNullOrUndefined(t.state.page)||(i.updateCurrentPageAndScrollPosWithinTab(i.presentableResults.currPageNumber.get(),0),i.presentableResults.currPageNumber.set(t.state.page)),!e.framework.utils.isNullOrUndefined(t.state.tableOptions.sortColumn))){var o=i.columnHeaders.getAt(t.state.tableOptions.sortColumn);o&&o.sortState.set("desc"===t.state.tableOptions.sortDirection?a.DESCENDING:a.ASCENDING)}}}))},r.prototype._handlePageResultsChange=function(e){var t="clear"===(e=e||{type:null}).type||"remove"===e.type&&e.sender.value.length<=1,r=new i.eventArgs.ResultsPageChangedEventArgs;r.featureSetCollection=this.featureSetCollection.get(),r.newValue=t?new ObservableCollection:this.resultsPage,this.app.event("ResultsPageChangedEvent").publish(r)},r}(r.ResultsViewModel);r.TabbedResultsViewModel=s}(i.results||(i.results={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(){function t(t,i){var r=this;this.iconUri=new Observable(""),this.text=new Observable(t),this.plainText=new Observable(""),this.plainText.syncTransform(this.text,function(t){return e.FilterUtils.stripHtml(t)}),this.safeText=new Observable(""),this.safeText.syncTransform(this.text,function(e){return r.sanitizeText(e)})}return t.prototype.sanitizeText=function(t){var i={allowFrames:!1,uriTransformer:function(e){return e}};return t?e.FilterUtils.sanitize(t,i):""},t.prototype.toString=function(){return this.plainText.get()},t}();t.SearchHintItem=i}(e.search||(e.search={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.POINT="POINT",e.MULTI_POINT="MULTI_POINT",e.LINE="LINE",e.POLYGON="POLYGON",e.FREEHAND_POLYGON="FREEHAND_POLYGON",e.POLYLINE="POLYLINE",e.FREEHAND_POLYLINE="FREEHAND_POLYLINE",e.RECTANGLE="RECTANGLE",e.TRIANGLE="TRIANGLE",e.CIRCLE="CIRCLE",e.ELLIPSE="ELLIPSE",e.ARROW="ARROW",e.LEFT_ARROW="LEFT_ARROW",e.RIGHT_ARROW="RIGHT_ARROW",e.UP_ARROW="UP_ARROW",e.DOWN_ARROW="DOWN_ARROW",e.EXTENT="EXTENT",e}();e.DrawMode=t}(e.tools||(e.tools={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(){t.apply(this,arguments),this.paneItems=new ObservableCollection,this.defaultPaneItems=new ObservableCollection,this.displayedPaneItems=new ObservableCollection,this.expanded=new Observable(!1),this.headerIsVisible=new Observable(!0),this.showXButton=new Observable(!0),this.selectorIconUri=new Observable(""),this.selectorText=new Observable("")}return __extends(i,t),i.prototype.initialize=function(e){t.prototype.initialize.call(this,e),e&&(e.hasOwnProperty("headerIsVisible")&&this.headerIsVisible.set(!!e.headerIsVisible),e.hasOwnProperty("showXButton")&&this.showXButton.set(!!e.showXButton),e.hasOwnProperty("selectorIconUri")&&this.selectorIconUri.set(e.selectorIconUri),e.hasOwnProperty("selectorText")&&this.selectorText.set(e.selectorText))},i.prototype.findPaneItemById=function(t){return e.framework.utils.ArrayUtils.firstOrDefault(this.paneItems.getItems(),function(e){return e.id&&e.id===t})},i.prototype.findDisplayedPaneItemById=function(t){return e.framework.utils.ArrayUtils.firstOrDefault(this.displayedPaneItems.getItems(),function(e){return e.id&&e.id===t})},i}(e.essentialsHtmlViewer.mapping.infrastructure.ui.components.SmartPanel.SmartPanelViewModel);t.MultiPaneViewModel=i}(t.MultiPane||(t.MultiPane={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this.currentPaneItem=new Observable(null),this.headerIsVisible=new Observable(!0),this.showXButton=new Observable(!0)}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t),t&&(t.hasOwnProperty("headerIsVisible")&&this.headerIsVisible.set(!!t.headerIsVisible),t.hasOwnProperty("showXButton")&&this.showXButton.set(!!t.showXButton))},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.currentPaneItem.set(null),this.currentPaneItem=null,this.app=null},t}(e.framework.ui.ViewModelBase);t.PaneViewModel=i}(t.MultiPane||(t.MultiPane={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this._isDestroyed=!1}return __extends(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this._isDestroyed=!0},t.prototype.onClose=function(e){},t.prototype.handleClickClose=function(e,t,i){this.viewModel&&this.onClose&&this.onClose(this.viewModel.currentPaneItem.get()),this._isDestroyed||this.app.command("DestroyView").execute(this.id)},t}(e.framework.ui.ViewBase);t.PaneView=i}(t.MultiPane||(t.MultiPane={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i){t.call(this,e,i),this._panes=[],this.app.event("ApplicationResizedEvent").subscribe(this,this.handleApplicationResizedEvent),this.app.event("ViewDeactivatedEvent").subscribe(this,this.handleViewDeactivatedEvent)}return __extends(i,t),i.prototype.activated=function(){var e=this;t.prototype.activated.call(this),this.viewModel&&this.viewModel.expanded.set(!0),setTimeout(function(){e.handleApplicationResizedEvent()},0)},i.prototype.deactivated=function(){t.prototype.deactivated.call(this),this.viewModel&&this.viewModel.expanded.set(!1)},i.prototype.addDefaultPanes=function(){if(!(this.viewModel.displayedPaneItems.getLength()>0))for(var e=0;e<this.viewModel.defaultPaneItems.getLength();e++){var t=this.viewModel.defaultPaneItems.getAt(e);this.addPaneItem(t)}},i.prototype.addPaneItemById=function(e){var t=this.viewModel.findPaneItemById(e);this.addPaneItem(t)},i.prototype.addPaneItem=function(e){throw new Error("Not implemented")},i.prototype.canAddPaneItem=function(e){return!(!e||!this.viewModel)&&!this.viewModel.displayedPaneItems.contains(e)},i.prototype.destroyPaneItemById=function(e){var t=this.viewModel.findDisplayedPaneItemById(e);this.destroyPaneItem(t)},i.prototype.destroyPaneItem=function(e){if(e&&this.canDestroyPaneItem(e)){var t=this.findPaneForPaneItem(e);return!!t&&(this.viewModel.displayedPaneItems.removeItem(e),this.selector.unselectItem(e),this.app.command("DestroyView").execute(t.id),0!=this.viewModel.displayedPaneItems.length()||this.viewModel.headerIsVisible.get()||this.app.command("DeactivateView").execute(this.id),!0)}return!1},i.prototype.canDestroyPaneItem=function(e){return!(!e||!this.viewModel)&&this.viewModel.displayedPaneItems.contains(e)},i.prototype.clearPaneItems=function(){for(var e=this.viewModel.displayedPaneItems.getLength();e--;){var t=this.viewModel.displayedPaneItems.getAt(e);this.destroyPaneItem(t)}},i.prototype.handleSelectPane=function(e){this.addPaneItem(e)},i.prototype.handleUnSelectPane=function(e){this.destroyPaneItem(e)},i.prototype.handleClickClose=function(){this.deactivateContainer()},i.prototype.handleApplicationResizedEvent=function(){if(this.viewModel){var e=this.viewModel.regionType.get().indexOf("Stack")>-1,t=this.scrollRegionElement,i=$(".view .pane",t);if(e&&0!==i.length){var r=t.clientWidth/i.length-5;$(i).width(r)}}},i.prototype.handleViewDeactivatedEvent=function(t){e.framework.utils.ArrayUtils.firstOrDefault(this._panes,function(e){return t===e})&&(e.framework.utils.ArrayUtils.removeItem(this._panes,t),this.handleApplicationResizedEvent())},i.prototype.findPaneForPaneItem=function(e){for(var t=0;t<this._panes.length;t++){var i=this._panes[t];if(i.viewModel.currentPaneItem.get()===e)return i}return null},i.prototype._executeShowMultiPaneView=function(){this.app.command("ActivateView").execute(this.id),this.addDefaultPanes(),this.viewModel.displayedPaneItems.getLength()>0&&this.handleApplicationResizedEvent()},i}(e.essentialsHtmlViewer.mapping.infrastructure.ui.components.SmartPanel.SmartPanelView);t.MultiPaneView=i}(t.MultiPane||(t.MultiPane={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){!function(i){!function(i){r=function(){function r(e,t,r,n,a,s){this.visible=new Observable(!0),this.value=new Observable(""),this.presentableValue=new Observable(""),this.columnDescriptor=new Observable(""),this.sortState=new Observable(i.SortState.UNSORTED),this.sortClass=new Observable(""),this._sortingPredicate=null,this._reverseSortingPredicate=null,this.app=e,this.libraryId=t,this.value.set(n),this.presentableValue.set(n),this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-unsorted").format(this.presentableValue.get())),this._sharedState=r,"DateTime"===a?(this._sortingPredicate=this.buildDateSortingFunction(s),this._reverseSortingPredicate=this.buildReverseDateSortingFunction(s)):(this._sortingPredicate=this.buildSortingFunction(s),this._reverseSortingPredicate=this.buildReverseSortingFunction(s)),this.sortClass.syncTransform(this.sortState,function(e){switch(e){case 0:return r.unsortedClass;case 1:return r.sortedClass;case 2:return r.reverseSortedClass}return r.unsortedClass}),this.sortState.bind(this,this.onSortStateChange)}return r.prototype.buildSortingFunction=function(t){return function(i,r){return e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(i.attributes.getAt(t).presentableValue.get(),r.attributes.getAt(t).presentableValue.get())}},r.prototype.buildReverseSortingFunction=function(t){return function(i,r){return e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(r.attributes.getAt(t).presentableValue.get(),i.attributes.getAt(t).presentableValue.get())}},r.prototype.buildDateSortingFunction=function(i){return function(r,n){var a=r.attributes.getAt(i).value.get(),s=n.attributes.getAt(i).value.get(),o=t.FormatUtils.parseDate(a),l=t.FormatUtils.parseDate(s),c="Invalid Date"!=o;return c!==("Invalid Date"!=l)?c?-1:1:c?o.getTime()-l.getTime():e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(a,s)}},r.prototype.buildReverseDateSortingFunction=function(i){return function(r,n){var a=n.attributes.getAt(i).value.get(),s=r.attributes.getAt(i).value.get(),o=t.FormatUtils.parseDate(a),l=t.FormatUtils.parseDate(s),c="Invalid Date"!=o;return c!==("Invalid Date"!=l)?c?-1:1:c?o.getTime()-l.getTime():e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.collator(a,s)}},r.prototype.onSortStateChange=function(e){if(!this._sharedState.ignoreStateChange){if(e<i.SortState.UNSORTED||e>i.SortState.DESCENDING)throw new Error("Illegal column sort state: "+e);if(0==e){if(this._sharedState.lastSortedColumn!=this)throw new Error("Column sort state out of sync");this._sharedState.lastSortedColumn=null,this._sharedState.presentableResults.sortingPredicate=null,this._sharedState.presentableResults.unsortCollection(),this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-unsorted").format(this.presentableValue.get()))}else{if(null!=this._sharedState.lastSortedColumn&&this._sharedState.lastSortedColumn!=this&&(this._sharedState.ignoreStateChange=!0,this._sharedState.lastSortedColumn.sortState.set(i.SortState.UNSORTED),this._sharedState.ignoreStateChange=!1),this._sharedState.lastSortedColumn=this,e==i.SortState.ASCENDING)this._sharedState.presentableResults.sortingPredicate=this._sortingPredicate,this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-sorted-ascending").format(this.presentableValue.get()));else{if(e!=i.SortState.DESCENDING)throw new Error("Invalid column sort state.");this._sharedState.presentableResults.sortingPredicate=this._reverseSortingPredicate,this.columnDescriptor.set(this.app.getResource(this.libraryId,"language-ui-table-sorted-descending").format(this.presentableValue.get()))}this._sharedState.presentableResults.sortCollection()}}},r}();i.TableColumnHeaderViewModel=r;var r;!function(t){t.manualCollator=function(e,t){return isNaN(e)||isNaN(t)?e<t?-1:e>t?1:0:+e-t},t.collator="object"==typeof Intl&&"function"==typeof Intl.Collator?new Intl.Collator(void 0,{numeric:!0}).compare:e.essentialsHtmlViewer.mapping.infrastructure.results.ResultsAttributeHeaderViewModel.manualCollator;var i=function(){function e(e,t,i,r){this.lastSortedColumn=null,this.presentableResults=e,this.unsortedClass=t,this.sortedClass=i,this.reverseSortedClass=r,this.reset()}return e.prototype.reset=function(){this.ignoreStateChange=!1,this.lastSortedColumn=null},e}();t.SharedState=i}(r=i.TableColumnHeaderViewModel||(i.TableColumnHeaderViewModel={}))}(i.Table||(i.Table={}))}(i.components||(i.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.TableColumnViewModelInterface=t}(e.Table||(e.Table={}))}(e.components||(e.components={}))}(e.ui||(e.ui={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(e.TableColumnViewModelInterface);e.TableColumnHeaderViewModelInterface=t}(e.Table||(e.Table={}))}(e.components||(e.components={}))}(e.ui||(e.ui={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(e){function t(){e.apply(this,arguments),this.tableContainerElement=null,this._longPressTimer=null,this._pressStartTime=null,this._firedTouchOrPress=!1,this._ignoreMouseEventFlag=!1,this._pressYStart=null,this._lastTouchY=null,this._scrollYDeltaThreshold=35,this._firstEvent=null}return __extends(t,e),t.prototype.handleColumnHeadClick=function(e,t,i){i.sortState.set((i.sortState.get()+1)%3)},t.prototype.handleMouseDown=function(e,t,i){return this._beginLongPressIfNoEventsInProgress(i,"mouse-down"),!0},t.prototype.handleMouseUp=function(e,t,i){return this._cancelLongPressIfEventInProgress("mouse-down"),!0},t.prototype.handleTouchStart=function(e,t,i){return this._beginLongPressIfNoEventsInProgress(i,"touch-start"),!0},t.prototype.handleTouchMove=function(e,t,i){return this.handleTouchEnd(e,t,i)},t.prototype.handleTouchEnd=function(e,t,i){return this._cancelLongPressIfEventInProgress("touch-start"),!0},t.prototype.handleClick=function(e,t,i){var r=this;return this.viewModel&&this.viewModel.recordClickEvents.length&&this.viewModel.recordClickEvents.forEach(function(e){return r.app.event(e).publish(i)}),!0},t.prototype.handleClickAttributelink=function(e,t,i){return this.app.followNavigationLink({url:i.value.get(),element:t})},t.prototype._beginLongPressIfNoEventsInProgress=function(e,t){this._firstEvent||(this._firstEvent=t,this._beginLongPress(e))},t.prototype._cancelLongPressIfEventInProgress=function(e){this._firstEvent===e&&(this._firstEvent=null,this._cancelLongPress())},t.prototype._beginLongPress=function(e){var t=this;this._cancelLongPress(),this.viewModel&&this.viewModel.recordLongPressEvents.length&&(this._longPressTimer=setTimeout(function(){t.viewModel.recordLongPressEvents.forEach(function(i){t.app.event(i).publish(e)},t.viewModel.recordLongPressDuration||1e3)}))},t.prototype._cancelLongPress=function(){this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null)},t}(e.framework.ui.ViewBase);t.TableView=i}(t.Table||(t.Table={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){!function(t){var i=function(t){function i(e,i){t.call(this,e,i),this.columnHeaders=new ObservableCollection([]),this.records=new ObservableCollection([]),this.presentableRecordCollection=null,this.recordClickEvents=[],this.recordLongPressEvents=[],this.recordLongPressDuration=1e3}return __extends(i,t),i.prototype.attachToPresentableCollection=function(t){t&&t instanceof e.framework.ui.PresentableCollection&&(this.presentableRecordCollection=t,this.records=this.presentableRecordCollection.items)},i.prototype.addRecordClickEvents=function(e){this._executeAddEvents(e,0)},i.prototype.addRecordLongPressEvents=function(e){this._executeAddEvents(e,1)},i.prototype._executeAddEvents=function(e,t){var i=this,r=function(e){e&&"string"==typeof e&&(0===t?(i.recordClickEvents=i.recordClickEvents.filter(function(t){return t!==e}),i.recordClickEvents.push(e)):1===t&&(i.recordLongPressEvents=i.recordLongPressEvents.filter(function(t){return t!==e}),i.recordLongPressEvents.push(e)))};e&&dojo.isArray(e)?e.forEach(function(e){return r(e)}):r(e)},i}(e.framework.ui.ViewModelBase);t.TableViewModel=i}(t.Table||(t.Table={}))}(t.components||(t.components={}))}(t.ui||(t.ui={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,i,r){if(void 0===i&&(i="[anonymous]"),void 0===r&&(r={}),!t)throw new Error("Transaction manager is required");this.owner=t,this.displayName=i,this.state=r,this.transactionStatus=e.TransactionStatus.PENDING,this.changes=[]}return t.prototype.isTopLevel=function(){return!this.parentTransaction},t.prototype.isComplete=function(){return this.isCommitted()||this.isAborted()},t.prototype.isAborted=function(){return this.transactionStatus==e.TransactionStatus.ABORTED},t.prototype.isCommitted=function(){return this.transactionStatus==e.TransactionStatus.COMMITTED},t.prototype.add=function(e,i,r){if(void 0===r&&(r={}),i&&!this.isComplete()){var n;n=i instanceof t?i:this._wrapInTransaction(e,i,r),this.changes.push(n)}},t.prototype._wrapInTransaction=function(i,r,n){void 0===n&&(n={}),r.state=r.state||n;var a=new t(this.owner,i);return a.transactionStatus=e.TransactionStatus.PENDING,a.parentTransaction=this,a.changes.push(r),a},t.prototype.hasChanges=function(){return this.changes.length>0},t.prototype.commit=function(){return this.owner.commitTransaction(this)},t.prototype.rollback=function(){return this.owner.rollbackTransaction(this)},t.prototype.performUndo=function(e,t){var i=this;if(!this.hasChanges())return Promise.resolve();return Promise.reduce(this.changes.slice().reverse(),function(e,t){if(t)return t.performUndo(t.state,i)},null)},t.prototype.performRedo=function(e,t){var i=this;if(!this.hasChanges())return Promise.resolve();return Promise.reduce(this.changes,function(e,t){if(t)return t.performRedo(t.state,i)},null)},t}();e.UndoTransaction=t}(e.undo||(e.undo={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){function i(e){var t="";if(!e)return t;for(var i=e.keys(),r=0;r<i.length;r++)t.length>0&&(t+="&"),t+="{0}={1}".format(i[r],e.get(i[r]));return"{0}{1}".format(t.length>0?"?":"",t)}function r(t){var i=new e.Dictionary;return t?(t.startsWith("?")&&(t=t.slice(1)),t.split(/[&;]/g).forEach(function(e){if(e){var t=e.split("=",2);i.set(t[0],t[1])}}),i):i}function n(e){var t=document.createElement("a");return t.href=e,t}t.queryStringDictionaryToString=i,t.queryStringToDictionary=r,t.parseUrl=n,t.addQueryParameter=function(e,t,a){var s=n(e),o=r(s.search);return o.set(t,a),s.search=i(o),s.toString()},t.removeQueryParameter=function(e,t){var a=n(e),s=r(a.search);return s.remove(t),a.search=i(s),a.toString()},t.getFolder=function(e){var t="string"==typeof e?n(e):dojo.clone(e),i=null==t.pathname?"":t.pathname;if(null==i)return t;var r=i.split("/");return r[r.length-1].indexOf(".")>=0&&(r.pop(),t.pathname=r.join("/")),t.pathname.endsWith("/")||(t.pathname=t.pathname+"/"),t.search="",t.hash="",t.href=t.href.replace(/[\?#]+$/,""),t},t.removeParameters=function(e){var t="string"==typeof e?n(e):dojo.clone(e);return null==(null==t.pathname?"":t.pathname)?t:(t.pathname.endsWith("/")||(t.pathname=t.pathname+"/"),t.search="",t.hash="",t.href=t.href.replace(/[\?#]+$/,""),t)}}(e.UrlUtils||(e.UrlUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function i(){}return i.prototype.validate=function(i,r){var n=r&&!!r.invalidNumbersAsNaN,a=t.FormatUtils.parseNumber(i);return e.framework.utils.isNullOrUndefined(i)?Promise.resolve({validatedValue:i}):isNaN(a)&&!n?Promise.reject(new Error("Invalid number.")):Promise.resolve({validatedValue:a})},i}();i.NumberValidator=r}(t.validation||(t.validation={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(){function t(e){void 0===e&&(e={}),this._tokenLeft="{",this._tokenRight="}",this._tokenLeftEscaped="\\{",this._tokenRightEscaped="\\}",e.contentPolicy&&(this._contentPolicy=e.contentPolicy)}return t.prototype.validate=function(e,t){var i=this;void 0===t&&(t={XssHtmlValidator:{}});var r={html:e,uris:[],contentPolicy:this._contentPolicy||t.XssHtmlValidator.defaultContentPolicy};if(!r.contentPolicy)throw new Error("XssHtmlValidator cannot perform validation without a ContentPolicy instance.");var n=t.sanitizeOptions;return Promise.resolve(r).then(function(e){return i._escape(e)}).then(function(e){return i._sanitize(e,n)}).then(function(e){return i._runUrisThroughContentPolicy(e)}).then(function(e){return i._applyUris(e)}).then(function(e){return i._unescape(e)}).then(function(e){return{validatedValue:e.html}})},t.prototype._escape=function(e){return e.html=e.html.split(this._tokenLeft).join(this._tokenLeftEscaped),e.html=e.html.split(this._tokenRight).join(this._tokenRightEscaped),e},t.prototype._sanitize=function(t,i){var r=this;void 0===i&&(i={});var n=i?i.uriTransformer:null;return i.uriTransformer=function(a,s){return n&&(a=n(a,s),s.uri=a),i.allowArbitraryHyperlinks&&s.type===e.FilterUtils.UriType.NavigableLink?a:(t.uris.push(s),r._tokenize(t.uris.length-1))},t.html=e.FilterUtils.sanitize(t.html,i),t},t.prototype._runUrisThroughContentPolicy=function(e){return this._contentPolicy?this._contentPolicy.screenUris(e.uris).then(function(t){return e}):e.contentPolicy.screenUris(e.uris).then(function(t){return e})},t.prototype._applyUris=function(e){var t=this;return e.uris.forEach(function(i,r){var n=t._tokenize(r);e.html=e.html.replace(n,i.uri)}),e},t.prototype._unescape=function(e){return e.html=e.html.split(this._tokenLeftEscaped).join(this._tokenLeft),e.html=e.html.split(this._tokenRightEscaped).join(this._tokenRight),e},t.prototype._tokenize=function(e){return this._tokenLeft+e.toString()+this._tokenRight},t}();t.XssHtmlValidator=i}(e.validation||(e.validation={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(){function i(e){if(!e)throw new Error('Argument "app" is required.');this.app=e,this._initializeAllowedUrls(),this.app.command("ClearTrustedUrls").register(this,this.executeClearTrustedUrls)}return i.prototype.executeClearTrustedUrls=function(){for(var e=Object.keys(window.localStorage),t=0;t<e.length;t++)e[t].match("^uri.markup|^uri.css|^uri.navigablelink")&&window.localStorage.removeItem(e[t])},i.prototype.validate=function(i,r){var n=this;return i?"string"!=typeof i?Promise.reject(new Error("Input is not a URL.")):this._initializeAllowedUrls().then(function(){var r=t.UrlUtils.parseUrl(e.essentials.RestHelper.processClientSideTokens(n.app.site,i));if(n._allowedUrls.some(function(e){return n._isMatch(e,r)}))return Promise.resolve({validatedValue:i});var a="The following URL is not defined by this Essentials site and will be skipped: {0}".format(i);return Promise.reject(a)}):Promise.resolve({validatedValue:i})},i.prototype.tryValidateSynchronously=function(i){var r=this;if(!this._allowedUrls)return!1;var n=t.UrlUtils.parseUrl(e.essentials.RestHelper.processClientSideTokens(this.app.site,i));return this._allowedUrls.some(function(e){return r._isMatch(e,n)})},i.prototype._isMatch=function(t,i){return"mailto:"===i.protocol||!e.framework.utils.isNullOrUndefined(i.pathname)&&(i.host==t.host&&i.protocol==t.protocol&&(i.pathname.startsWith(t.pathname)||i.pathname+"/"===t.pathname))},i.prototype._initializeAllowedUrls=function(){var e=this;return this._allowedUrls?Promise.resolve():this.app.waitUntilSiteInitialized().then(function(){var t=e.app.site;e._allowedUrls=[],e._allowUrl(t.url),e._allowUrl("http://localhost:8181"),e._allowUrl("http://127.0.0.1:8181");for(var i=0;i<t.trustedUrls.length;i++)e._allowUrl(t.trustedUrls[i].url);if(t.properties.trustedUrls&&t.properties.trustedUrls.split(",").forEach(function(t){e._allowUrl(t)}),t.essentialsMap)t.essentialsMap.mapServices.filter(function(e){return!e.isUserCreated}).forEach(function(t){e._allowUrl(t.serviceUrl),e._allowUrl(t.tileRestUrl),e._allowUrl(t.mapUrl),e._allowUrl(t.iconUri),(t.layerHyperlinks||[]).forEach(function(t){e._allowUrl(t.uri),e._allowUrl(t.iconUri)}),(t.layers||[]).forEach(function(t){e._allowUrl(t.getLayerUrl()),e._allowUrl(t.legendUrl),e._allowUrl(t.iconUri),(t.featureHyperlinks||[]).forEach(function(t){e._allowUrl(t.uri),e._allowUrl(t.iconUri)}),(t.layerHyperlinks||[]).forEach(function(t){e._allowUrl(t.uri),e._allowUrl(t.iconUri)}),e._extractUrls(t.featureLabel).forEach(function(t){return e._allowUrl(t)}),e._extractUrls(t.featureDescription).forEach(function(t){return e._allowUrl(t)}),e._extractUrls(t.featureLongDescription).forEach(function(t){return e._allowUrl(t)})})})})},i.prototype._allowUrl=function(e){if(e)try{this._allowedUrls.push(t.UrlUtils.getFolder(e))}catch(e){}},i.prototype._extractUrls=function(e){return e?(e.match(/(https?:\/\/[A-Za-z0-9\-\._~:\/\?#[\]@!\$&'()*\+,;=%]+)/g)||[]).map(function(e){return e.indexOf("{")>=0?e.slice(0,e.indexOf("{")):e}):[]},i}();i.SiteUrlValidator=r}(t.validation||(t.validation={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e.getFeatureHeatMap=function(e){return e&&e.mapService?(e.includeInLegend&&e.mapService.heatMap&&(e.mapService.heatMap.includeInLegend=e.includeInLegend),e.mapService.heatMap):null},e.getHeatMapRenderer=function(e){if(!e||!e.mapService||!e.mapService.serviceLayer)return null;var t=e.mapService.serviceLayer.renderer;return t instanceof esri.renderer.HeatmapRenderer?t:null}}(e.VisualizationUtils||(e.VisualizationUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){t.WIDGET_ID_BASE="__CLASSWIDGET__";var i=function(i){function r(){i.apply(this,arguments),this.configuring=!1}return __extends(r,i),r.prototype.attach=function(e){e.initialize(this.configuration),i.prototype.attach.call(this,e)},r.prototype.added=function(e){e.attributeSettingsWidget=this,i.prototype.added.call(this,e),this._setupJQuerySliders()},r.prototype.applyConfiguration=function(){var e=this;this.configuring=!0,$(this.classBreaksSlider).slider("option","value",this.viewModel.numBreaks.get()),this.startColorInput.value=this.viewModel.startColors[0].toHex(),this.viewModel.startColorSwatches.set(this.viewModel.startColors.map(function(e){return{hex:e.toHex()}})),this.viewModel.startColorSwatches.get().forEach(function(t,i){e.startColorSwatchFieldSet.children[i].style.backgroundColor=t.hex}),this.startColorSwatchFieldSet.querySelector(".start-color-swatch:first-child > input[type=radio]").checked=!0,this.endColorInput.value=this.viewModel.endColors[0].toHex(),this.viewModel.endColorSwatches.set(this.viewModel.endColors.map(function(e){return{hex:e.toHex()}})),this.viewModel.endColorSwatches.get().forEach(function(t,i){e.endColorSwatchFieldSet.children[i].style.backgroundColor=t.hex}),this.endColorSwatchFieldSet.querySelector(".end-color-swatch:first-child > input[type=radio]").checked=!0,$(this.transparencySlider).slider("option","value",this.viewModel.transparency.get()),$(this.markerSizeSlider).slider("option","value",this.viewModel.markerSize.get()),$(this.lineWidthSlider).slider("option","value",this.viewModel.lineWidth.get()),this.markerStyleInput.selectedIndex=this.viewModel.markerStyleIndex>=0?this.viewModel.markerStyleIndex:0;for(var t=0,i=this.viewModel.classSymbolWidgets;t<i.length;t++)i[t].applyConfiguration();this.configuring=!1,this.handleChange()},r.prototype.reset=function(){if(this.viewModel.reset(),!this.viewModel.currentAttribute.get()){var e=document.createElement("option");e.disabled=!0,e.selected=!0,e.hidden=!0,e.value="",e.text=this.app.getResource(this.libraryId,"language-symbology-settings-attribute-select"),this.attributeInput.add(e,0)}},r.prototype.handleChange=function(){var i=this;if(!this.configuring){var r;if((r=this.viewModel.attributes.getLength()<this.attributeInput.length?this.viewModel.attributes.getAt(this.attributeInput.selectedIndex-1):this.viewModel.attributes.getAt(this.attributeInput.selectedIndex))&&(r.displayName!==this.viewModel.currentAttribute.get()||!this.viewModel.symbolizing&&this.viewModel.isNumericAttribute.get()&&this.viewModel.numBreaks.get()!==this.viewModel.symbologyClasses.getLength())&&(this.viewModel.symbolizing=!0,this.viewModel.getFieldInfo(r).then(function(t){var n={field:r,fieldInfo:t};r.dataType===e.essentials.EssentialsFieldTypes.essentialsFieldTypeString||n.fieldInfo.isCodedValueDomain()||n.fieldInfo.hasSubtypeCodedValueDomains()?(i.viewModel.classBreaksMode.set(!1),i.viewModel.isNumericAttribute.set(!1),i.viewModel.createUniqueValues(n)):(i.viewModel.classBreaksMode.set(!0),i.viewModel.isNumericAttribute.set(!0),i.viewModel.createClassBreaks(n))}),this.viewModel.currentAttribute.set(r.displayName)),this.viewModel.isNumericAttribute.get()){this.viewModel.selectedStartSwatch=this._getSelectedColorSwatch(this.viewModel.startColorSwatches.getItems(),this.startColorSwatchFieldSet),this.viewModel.selectedEndSwatch=this._getSelectedColorSwatch(this.viewModel.endColorSwatches.getItems(),this.endColorSwatchFieldSet);var n=this.viewModel.useColorSwatches.get()?new t.SymbolColor(this.viewModel.selectedStartSwatch.hex):new t.SymbolColor(this.startColorInput.value),a=this.viewModel.useColorSwatches.get()?new t.SymbolColor(this.viewModel.selectedEndSwatch.hex):new t.SymbolColor(this.endColorInput.value);this.viewModel.startColors[0].equals(n)||(this.viewModel.startColors[0]=n,this.viewModel.createRendererClasses()),this.viewModel.endColors[0].equals(a)||(this.viewModel.endColors[0]=a,this.viewModel.createRendererClasses())}if(!this.viewModel.symbolizing&&this.viewModel.markerStyleIndex!==this.markerStyleInput.selectedIndex){this.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex;for(var s=0,o=this.viewModel.classSymbolWidgets;s<o.length;s++){var l=o[s];l.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex,l.applyConfiguration()}}}},r.prototype.handleSymbolClassSelected=function(e){var t=this,i=e.currentTarget.children[0],r=i.textContent||i.innerText,n=this.viewModel.symbologyClasses.getItems().filter(function(e){return e.name===r})[0],a=this.viewModel.symbologyClasses.indexOf(n);if(r===this.viewModel.selectedClass)this.viewModel.selectedClass=null,n.selected=!1,n.color=this.viewModel.classSymbolWidgets[a].viewModel.getColor().toHex();else{var s=this.viewModel.symbologyClasses.getItems().filter(function(e){return e.name===t.viewModel.selectedClass})[0],o=this.viewModel.symbologyClasses.indexOf(s),l=this.viewModel.classSymbolWidgets[o];s&&(s.selected=!1,s.color=l.viewModel.getColor().toHex()),this.viewModel.selectedClass=r,n.selected=!0}this.viewModel.symbologyClasses.pulse(),$(this.viewModel.classSymbolWidgets[a].container).appendTo($("#"+n.widgetId))},r.prototype._setupJQuerySliders=function(){var e=this,t=this.viewModel.config;$(this.classBreaksSlider).slider({min:2,max:this.viewModel.maxRenderClasses,value:5,step:1,slide:function(t,i){return e._handleSliderValueChanged(t,i,e.viewModel.numBreaks)}}),$(this.transparencySlider).slider({min:t.transparency.min,max:t.transparency.max,value:t.transparency.value,step:t.transparency.step,slide:function(t,i){if(e._handleSliderValueChanged(t,i,e.viewModel.transparency),!e.viewModel.symbolizing)for(var r=0,n=e.viewModel.classSymbolWidgets;r<n.length;r++){var a=n[r];a.viewModel.transparency.set(i.value),a.applyConfiguration()}}}),$(this.markerSizeSlider).slider({min:t.markerSize.min,max:t.markerSize.max,value:t.markerSize.value,step:t.markerSize.step,slide:function(t,i){if(e._handleSliderValueChanged(t,i,e.viewModel.markerSize),!e.viewModel.symbolizing)for(var r=0,n=e.viewModel.classSymbolWidgets;r<n.length;r++){var a=n[r];a.viewModel.markerSize.set(i.value),a.applyConfiguration()}}}),$(this.lineWidthSlider).slider({min:t.lineWidth.min,max:t.lineWidth.max,value:t.lineWidth.value,step:t.lineWidth.step,slide:function(t,i){if(e._handleSliderValueChanged(t,i,e.viewModel.lineWidth),!e.viewModel.symbolizing)for(var r=0,n=e.viewModel.classSymbolWidgets;r<n.length;r++){var a=n[r];a.viewModel.lineWidth.set(i.value),a.applyConfiguration()}}});for(var i=0,r=this.viewModel.classSymbolWidgets;i<r.length;i++)r[i].setupJQuerySliders();$(this.classBreaksSlider).add(this.transparencySlider).add(this.markerSizeSlider).add(this.lineWidthSlider).off("slidechange").on("slidechange",function(t){var i=document.createEvent("Event");i.initEvent("change",!0,!0),e.container.dispatchEvent(i)})},r.prototype._handleSliderValueChanged=function(e,t,i){t&&void 0!=t.value&&i.set(t.value)},r.prototype._getSelectedColorSwatch=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(t.children[i].querySelector("input[type=radio]").checked)return r}},r}(e.framework.ui.ViewBase);t.AttributeSymbologySettingsView=i}(t.visualization||(t.visualization={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(i){!function(r){var n=function(n){function a(){n.apply(this,arguments),this.attributes=new ObservableCollection,this.currentAttribute=new Observable(""),this.classBreaksMode=new Observable(!1),this.isNumericAttribute=new Observable(!1),this.symbologyClasses=new ObservableCollection([]),this.classSymbolWidgets=[],this.numBreaks=new Observable(5),this.useColorSwatches=new Observable(!0),this.startColorSwatches=new ObservableCollection,this.endColorSwatches=new ObservableCollection,this.markerSize=new Observable(10),this.lineWidth=new Observable(2),this.transparency=new Observable(10),this.noMarker=new Observable(!1),this.markerStyles=new ObservableCollection([{style:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,label:this.getResource("language-symbology-settings-marker-style-circle")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_CROSS,label:this.getResource("language-symbology-settings-marker-style-cross")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,label:this.getResource("language-symbology-settings-marker-style-diamond")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,label:this.getResource("language-symbology-settings-marker-style-square")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_X,label:this.getResource("language-symbology-settings-marker-style-x")}]),this.markerStyleIdLookup={circle:"esriSMSCircle",cross:"esriSMSCross",diamond:"esriSMSDiamond",square:"esriSMSSquare",x:"esriSMSX"},this.symbolizing=!1}return __extends(a,n),a.prototype.initialize=function(e){void 0===e&&(e={}),this.config=e,this.maxRenderClasses=this.config.maxRenderClasses>1?this.config.maxRenderClasses:12,this.maxSamples=this.config.maxSamples||1e3,e.numberOfColorSwatches=e.numberOfColorSwatches?6:e.numberOfColorSwatches,this.defaultLineSymbol=new esri.symbol.SimpleLineSymbol,this.defaultLineSymbol.setColor(new esri.Color(this.config.defaultLineColor||[75,75,75,1])),this.defaultLineSymbol.setWidth(this.config.defaultLineWidth||2),this.defaultPointSymbol=new esri.symbol.SimpleMarkerSymbol,this.defaultPointSymbol.setColor(new esri.Color(this.config.defaultPointColor||[150,150,150,.8])),this.defaultPointSymbol.setSize(this.config.defaultPointSize||12),this.defaultPointSymbol.setOutline(this.defaultLineSymbol),this.defaultPolygonSymbol=new esri.symbol.SimpleFillSymbol,this.defaultPolygonSymbol.setColor(new esri.Color(this.config.defaultFillColor||[150,150,150,.3])),this.defaultPolygonSymbol.setOutline(this.defaultLineSymbol);for(var t=0;t<this.maxRenderClasses;t++){var r=void 0;r=this.app.viewManager.createView({markupResource:"Mapping/infrastructure/visualization/SymbologySettings/SymbologySettingsView.html",typeName:"geocortex.essentialsHtmlViewer.mapping.infrastructure.visualization.SymbologySettingsView",isVisible:!0,libraryId:"Mapping.Infrastructure"});var n=new i.visualization.SymbologySettingsViewModel(this.app,"Mapping.Infrastructure");r.attach(n),n.initialize(this.config.defaultSymbologySettingsConfig),r.applyConfiguration(),this.classSymbolWidgets.push(r)}this.useColorSwatches.set(e.alwaysUseColorSwatches||!i.ColorUtils.isColorInputSupported()),this.startColors=i.ColorUtils.generateRandomColors(e.numberOfColorSwatches),this.endColors=i.ColorUtils.generateRandomColors(e.numberOfColorSwatches);var a=i.ColorUtils.generateRandomColor();this.startColors[0]=a.lighten(.9),this.endColors[0]=a.darken(.6),this.config.transparency=e.transparency?e.transparency:{min:0,max:90,value:10,step:5},this.transparency.set(this.config.transparency.value),this.config.markerSize=e.markerSize?e.markerSize:{min:1,max:50,value:10,step:1},this.markerSize.set(this.config.markerSize.value),this.config.lineWidth=e.lineWidth?e.lineWidth:{min:0,max:5,value:2,step:1},this.lineWidth.set(this.config.lineWidth.value),this.markerStyles.set(this.classSymbolWidgets[0].viewModel.markerStyles.getItems()),this.markerStyleIndex=0},a.prototype.reset=function(){this.attributes.set([]),this.currentAttribute.set(""),this.classBreaksMode.set(!1),this.isNumericAttribute.set(!1),this.symbologyClasses.set([]),this.selectedClass="",this.transparency.set(this.config.transparency.value),this.markerSize.set(this.config.markerSize.value),this.lineWidth.set(this.config.lineWidth.value),this.markerStyleIndex=0,this.startColors=i.ColorUtils.generateRandomColors(this.config.numberOfColorSwatches),this.endColors=i.ColorUtils.generateRandomColors(this.config.numberOfColorSwatches);var e=i.ColorUtils.generateRandomColor();this.startColors[0]=e.lighten(.9),this.endColors[0]=e.darken(.6);for(var t=0,r=this.classSymbolWidgets;t<r.length;t++)r[t].reset()},a.prototype.getRenderer=function(){var e,t,i=this;if(0===this.symbologyClasses.getLength())return"";t="Point"===this.featureType?this.defaultPointSymbol:"Line"===this.featureType?this.defaultLineSymbol:this.defaultPolygonSymbol;var r=this.attributes.getItems().filter(function(e){return e.displayName===i.currentAttribute.get()})[0];if(this.classBreaksMode.get()){e=new esri.renderer.ClassBreaksRenderer(t,r.name);for(s=0;s<this.symbologyClasses.getLength();s++){var n=this.symbologyClasses.getAt(s),a=this.classSymbolWidgets[s];e.addBreak({minValue:n.min,maxValue:n.max,symbol:esri.symbol.fromJson(JSON.parse(a.viewModel.getSymbol())),label:n.name})}}else{e=new esri.renderer.UniqueValueRenderer(t,r.name);for(var s=0;s<this.symbologyClasses.getLength();s++){var n=this.symbologyClasses.getAt(s),a=this.classSymbolWidgets[s];e.addValue({value:n.value,symbol:esri.symbol.fromJson(JSON.parse(a.viewModel.getSymbol())),label:n.name})}}return JSON.stringify(e.toJson())},a.prototype.setFromRenderer=function(t){var i=this,n=t.toJson();this.symbolizing=!0;var a=this.attributes.getItems().filter(function(e){return e.name===n.field||e.name===n.field1})[0];this.getFieldInfo(a).then(function(t){if(i.isNumericAttribute.set(a.dataType!==e.essentials.EssentialsFieldTypes.essentialsFieldTypeString&&!t.isCodedValueDomain()&&!t.hasSubtypeCodedValueDomains()),"classBreaks"===n.type){i.classBreaksMode.set(!0);var s=n.minValue;i.numBreaks.set(n.classBreakInfos.length);for(o=0;o<n.classBreakInfos.length;o++)!function(e){var a=n.classBreakInfos[e],o=i.classSymbolWidgets[e],l=new esri.Color(a.symbol.color);if(o.reset(),o.viewModel.noMarker.set("Point"!==i.featureType),o.viewModel.noFill.set("Polygon"!==i.featureType),o.viewModel.setFromSymbol(esri.symbol.fromJson(a.symbol)),o.applyConfiguration(),a.classMinValue&&(s=a.classMinValue),i.symbologyClasses.addItem({name:t.formatValue(s)+" - "+t.formatValue(a.classMaxValue),min:s,max:a.classMaxValue,color:l.toHex(),selected:!1,widgetId:r.WIDGET_ID_BASE+e.toString()}),s=a.classMaxValue,0===e){i.startColors[0]=new r.SymbolColor(l.toHex()),i.transparency.set(Math.floor(Math.ceil((255-a.symbol.color[3])/255*100)/i.config.transparency.step)*i.config.transparency.step),i.markerSize.set($.isNumeric(a.symbol.size)?Math.floor(a.symbol.size*r.POINTS_TO_PIXELS):i.config.markerSize.value);var c=i.markerStyles.getItems().filter(function(e){return i.markerStyleIdLookup[e.style]===a.symbol.style})[0];i.markerStyleIndex=c?i.markerStyles.indexOf(c):0;var u="Point"!==i.featureType&&"Polygon"!==i.featureType?a.symbol:a.symbol.outline;i.lineWidth.set($.isNumeric(u.width)?Math.floor(u.width*r.POINTS_TO_PIXELS):i.config.lineWidth.value)}e===n.classBreakInfos.length-1&&(i.endColors[0]=new r.SymbolColor(l.toHex()))}(o)}else if("uniqueValue"===n.type){i.classBreaksMode.set(!1);for(var o=0;o<n.uniqueValueInfos.length;o++)!function(e){var a=n.uniqueValueInfos[e],s=i.classSymbolWidgets[e],o=new esri.Color(a.symbol.color);s.reset(),s.viewModel.noMarker.set("Point"!==i.featureType),s.viewModel.noFill.set("Polygon"!==i.featureType),s.viewModel.setFromSymbol(esri.symbol.fromJson(a.symbol)),s.applyConfiguration();var l=void 0;if((t.isCodedValueDomain()||t.hasSubtypeCodedValueDomains())&&(l=t.esriField.domain.getName(a.value)),l||(l=t.formatValue(a.value)),i.symbologyClasses.addItem({name:l,value:a.value,color:o.toHex(),selected:!1,widgetId:r.WIDGET_ID_BASE+e.toString()}),0===e){i.startColors[0]=new r.SymbolColor(o.toHex()),i.transparency.set(Math.floor(Math.ceil((255-a.symbol.color[3])/255*100)/i.config.transparency.step)*i.config.transparency.step),i.markerSize.set($.isNumeric(a.symbol.size)?Math.floor(a.symbol.size*r.POINTS_TO_PIXELS):i.config.markerSize.value);var c=i.markerStyles.getItems().filter(function(e){return i.markerStyleIdLookup[e.style]===a.symbol.style})[0];i.markerStyleIndex=c?i.markerStyles.indexOf(c):0;var u="Point"!==i.featureType&&"Polygon"!==i.featureType?a.symbol:a.symbol.outline;i.lineWidth.set($.isNumeric(u.width)?Math.floor(u.width*r.POINTS_TO_PIXELS):i.config.lineWidth.value)}e===n.uniqueValueInfos.length-1&&(i.endColors[0]=new r.SymbolColor(o.toHex()))}(o)}i.symbolizing=!1,i.symbologyClasses.pulse()})},a.prototype.createClassBreaks=function(e){var t=this;this.symbologyClasses.set([]);var n=this.app.map.extent;this.executeExtentQuery(e.field,n).then(function(n){t.executeQuery(e.field,n).then(function(n){if(t._findDistinctValues(n,e.field.name).length<=t.numBreaks.get())return t.classBreaksMode.set(!1),void t.createUniqueValues(e);var a=n.features.map(function(t){return t.attributes[e.field.name]}),s=i.DataClassification.findSignificanceFactor(a),o=i.DataClassification.ckmeans(a,t.numBreaks.get());if(0!==s&&1!==s)for(l=0;l<o.length;l++)o[l]=o[l].map(function(e){return e/s});for(var l=0;l<o.length;l++){var c=void 0,u=void 0;if(0===l)c=Math.floor(Math.min.apply(Math,o[l]));else{var p=Math.min.apply(Math,o[l]);p>Math.max.apply(Math,o[l-1])+1?(c=Math.floor(p-(p-Math.max.apply(Math,o[l-1]))/2),1===s&&c++):c=Math.floor(p)}if(l===o.length-1)u=Math.ceil(Math.max.apply(Math,o[l]));else{var h=Math.max.apply(Math,o[l]),d=Math.min.apply(Math,o[l+1]);u=h<d-1?Math.floor(h+(d-h)/2):s<=1?Math.floor(h):Math.floor(d)}0!==s&&1!==s&&(c*=s,u*=s);var m=void 0;m=u-c==0?e.fieldInfo.formatValue(c):e.fieldInfo.formatValue(c)+" - "+e.fieldInfo.formatValue(u),t.symbologyClasses.addItem({name:m,min:c,max:u,count:o[l].length,color:"#FFFFFF",selected:!1,widgetId:r.WIDGET_ID_BASE+t.symbologyClasses.getLength().toString()})}t.createRendererClasses(),t.symbolizing=!1})})},a.prototype.createUniqueValues=function(e){var t=this;this.symbologyClasses.set([]);var i=this.app.map.extent;this.executeExtentQuery(e.field,i).then(function(i){t.executeQuery(e.field,i).then(function(i){for(var n=0,a=i.features;n<a.length;n++)!function(i){var n=null!=i.attributes[e.field.name]&&""!==i.attributes[e.field.name].toString().trim()?i.attributes[e.field.name].toString():null;if(n){var a=void 0;(e.fieldInfo.isCodedValueDomain()||e.fieldInfo.hasSubtypeCodedValueDomains())&&(a=e.fieldInfo.esriField.domain.getName(i.attributes[e.field.name])),a||(a=e.fieldInfo.formatValue(n));var s=t.symbologyClasses.getItems().filter(function(e){return e.value===n})[0];s?s.count++:t.symbologyClasses.addItem({name:a,value:n,count:1,color:"#FFFFFF",selected:!1,widgetId:r.WIDGET_ID_BASE+t.symbologyClasses.getLength().toString()})}}(a[n]);if(0===t.symbologyClasses.getLength())return t.app.command("Alert").execute(t.app.getResource(t.libraryId,"language-symbology-settings-nodata"),t.app.getResource(t.libraryId,"language-symbology-settings-nodata-title")),t.symbolizing=!1,void t.currentAttribute.set("");t.constrainToMaxClasses(e.field).then(function(){t.isNumericAttribute.get()?t.symbologyClasses.getItems().sort(function(e,t){return Number(e.value)-Number(t.value)}):t.symbologyClasses.getItems().sort(),t.createRendererClasses(),t.symbolizing=!1})})})},a.prototype.createRendererClasses=function(){var e,t=[],n=this.symbologyClasses.getLength();if(this.isNumericAttribute.get()){for(s=0;s<n;s++){var a=n>1?s/(n-1):.5;t.push(this.startColors[0].blend(a,this.endColors[0]))}e=this.startColors[0].value>=.7?this.startColors[0].darken(.6):this.startColors[0].lighten(.9)}else t=i.ColorUtils.generateRandomColors(n),e=new r.SymbolColor(this.defaultLineSymbol.color.toHex());for(var s=0;s<n;s++){this.symbologyClasses.getAt(s).color=t[s].toHex();var o=this.classSymbolWidgets[s];o.viewModel.colors[0]=t[s],o.viewModel.outlineColors[0]=e,o.viewModel.noMarker.set("Point"!==this.featureType),o.viewModel.noFill.set("Polygon"!==this.featureType),o.applyConfiguration()}this.symbologyClasses.pulse()},a.prototype.executeQuery=function(e,r){if(e.layer instanceof t.infrastructure.LayerIntegrationUtils.LocalLayer){var n=e.layer.mapService.serviceLayer.graphics,a=new esri.tasks.FeatureSet;return a.features=n,Promise.resolve(a)}var s=new esri.tasks.Query,o=i.taskUtils.getQueryTask(e.layer);return s.returnGeometry=!1,s.geometry=r,s.outFields=[e.name],o.execute(s)},a.prototype.executeExtentQuery=function(e,i){return e.layer instanceof t.infrastructure.LayerIntegrationUtils.LocalLayer?Promise.resolve(i):this.classBreaksMode.get()?this.executeClassBreaksExtentQuery(e,i):this.executeUniqueValueExtentQuery(e,i)},a.prototype.executeUniqueValueExtentQuery=function(e,t){var r=this;return new Promise(function(n,a){var s=0,o=function(){var a=new esri.tasks.Query,l=i.taskUtils.getQueryTask(e.layer);a.returnGeometry=!1,a.geometry=t,a.outFields=[e.name],l.execute(a).then(function(i){var a=r._findDistinctValues(i,e.name).length;a>=(r.isNumericAttribute.get()?r.numBreaks.get():r.maxRenderClasses)||a===s||i.exceededTransferLimit?n(t):(s=a,t=t.expand(2),o())},function(e){n(t)})};o()})},a.prototype.executeClassBreaksExtentQuery=function(e,t){var r=this;return new Promise(function(n,a){var s=0,o=function(){var a=new esri.tasks.Query,l=i.taskUtils.getQueryTask(e.layer);a.returnGeometry=!1,a.geometry=t,l.executeForCount(a).then(function(e){e>=r.maxSamples||e===s?n(t):(s=e,t=t.expand(2),o())},function(e){n(t)})};o()})},a.prototype.constrainToMaxClasses=function(e){var r=this;return new Promise(function(n,a){if(r.symbologyClasses.getLength()>r.maxRenderClasses||r.symbologyClasses.getLength()>r.numBreaks.get()||r.isNumericAttribute.get()){r.symbologyClasses.getLength()>r.maxRenderClasses&&!r.isNumericAttribute.get()&&r.app.command("Alert").execute(r.app.getResource(r.libraryId,"language-symbology-settings-exceeded-max-classes").format(r.maxRenderClasses),r.app.getResource(r.libraryId,"language-symbology-settings-exceeded-max-classes-title"));var s=r.isNumericAttribute.get()?r.numBreaks.get():r.maxRenderClasses;if(e.layer instanceof t.infrastructure.LayerIntegrationUtils.LocalLayer){var o=r.symbologyClasses.getItems().sort(function(e,t){return e.count<t.count?1:e.count>t.count?-1:0});r.symbologyClasses.set(o.slice(0,s)),n()}else{var l=r.app.map.extent,c=new esri.tasks.Query,u=i.taskUtils.getQueryTask(e.layer);c.returnGeometry=!1,c.geometry=l,c.outFields=[e.name],u.execute(c).then(function(t){var i=r._findDistinctValues(t,e.name),a=r.symbologyClasses.getItems().sort(function(e,t){return-1===i.indexOf(e.name)&&i.indexOf(t.name)>-1?1:i.indexOf(e.name)>-1&&-1===i.indexOf(t.name)?-1:e.count<t.count?1:e.count>t.count?-1:0});r.symbologyClasses.set(a.slice(0,s)),n()})}}else n()})},a.prototype._findDistinctValues=function(e,t){for(var i={},r=[],n=e.features.map(function(e){return e.attributes[t]}),a=0;a<n.length;a++)i[n[a]]||r.push(n[a]),i[n[a]]=!0;return r},a.prototype.getFieldInfo=function(e){var t;return new Promise(function(r,n){if(e.layer.mapService.serviceLayer instanceof esri.layers.FeatureLayer){var a=e.layer.mapService.serviceLayer;t=a.getField(e.name),r(i.gis.FieldInfo.fromEsriField(t,a,e))}else e.layer.getFeatureLayer().then(function(n){t=n.getField(e.name),r(i.gis.FieldInfo.fromEsriField(t,n,e))})})},a}(e.framework.ui.ViewModelBase);r.AttributeSymbologySettingsViewModel=n}(i.visualization||(i.visualization={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){e.ckmeans=function(t,i){if(i>t.length)return[];for(var r=t.slice().sort(function(e,t){return e-t}),n=(e.uniqueCountSorted(r),e.createMatrix(i,r.length)),a=e.createMatrix(i,r.length),s=0;s<i;s++)for(var o=r[0],l=Math.max(s,1);l<r.length;l++)if(0===s){var c=Math.pow(r[l]-o,2);n[s][l]=n[s][l-1]+l/(l+1)*c,o=(l*o+r[l])/(l+1)}else for(var u=0,p=0,h=l;h>=s;h--)u+=(l-h)/(l-h+1)*Math.pow(r[h]-p,2),p=(r[h]+(l-h)*p)/(l-h+1),h===l?(n[s][l]=u,a[s][l]=h,h>0&&(n[s][l]+=n[s-1][h-1])):u+n[s-1][h-1]<n[s][l]&&(n[s][l]=u+n[s-1][h-1],a[s][l]=h);for(var d=[],m=a[0].length-1,s=a.length-1;s>=0;s--){var g=a[s][m];d[s]=r.slice(g,m+1),s>0&&(m=g-1)}return d},e.createMatrix=function(e,t){for(var i=[],r=0;r<e;r++){for(var n=[],a=0;a<t;a++)n.push(0);i.push(n)}return i},e.uniqueCountSorted=function(e){for(var t,i=0,r=0;r<e.length;r++)0!==r&&e[r]==t||(t=e[r],i++);return i},e.findSignificanceFactor=function(t){var i,r=e.getDecimalSeparator(),n=t.filter(function(e){return null!==e}).map(function(e){var t=e.toString().split(r)[1];return t?parseFloat(t)/Math.pow(10,t.length):0}),a=t.filter(function(e){return null!==e}).map(function(e){return Math.floor(e)}),s=Math.min.apply(Math,a.filter(function(e){return 0!==e}));i=0===s||s===1/0?0:Math.floor(Math.log(Math.abs(s))/Math.LN10);var o,l=Math.max.apply(Math,a);0===l?i=0:o=Math.floor(Math.log(Math.abs(l))/Math.LN10);var c=o-i,u=Math.max.apply(Math,n.filter(function(e){return 0!==e}));if(0===u||Math.abs(u)===1/0){var p=l-s,h=Math.floor(Math.log(Math.abs(p))/Math.LN10);return Math.pow(10,c-h<0?0:c-h)}var d,m=Math.floor(Math.log(Math.abs(u))/Math.LN10),g=Math.min.apply(Math,n.filter(function(e){return 0!==e}));if(m-(d=0===g||Math.abs(g)===1/0?0:Math.floor(Math.log(Math.abs(g))/Math.LN10))<=1){var f=n.map(function(e){var t=e.toString().split(r)[1];return t?t.length:0}),y=Math.max.apply(Math,f);return Math.pow(10,-y)}return Math.pow(10,d+c)},e.getDecimalSeparator=function(){return 1.1.toLocaleString().substring(1,2)}}(e.DataClassification||(e.DataClassification={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){if(this.isHSV(e))this.hue=this.clamp(e.h,0,1),this.value=this.clamp(e.v,0,1),this.saturation=this.clamp(e.s,0,1);else if(this.isRGB(e)){i=this.fromRGB({r:this.clamp(e.r,0,1),g:this.clamp(e.g,0,1),b:this.clamp(e.b,0,1)});this.hue=i.h,this.value=i.v,this.saturation=i.s}else{var t=this.hexToRGB(e),i=this.fromRGB(t);this.hue=i.h,this.value=i.v,this.saturation=i.s}}return e.prototype.toHex=function(){var e=this.toRGB();return this.rgbToHex(e)},e.prototype.darken=function(t){return t=this.clamp(t,0,1),new e({h:this.hue,v:this.value*(1-t),s:this.saturation})},e.prototype.lighten=function(t){return t=this.clamp(t,0,1),new e({h:this.hue,v:this.value+(1-this.value)*t,s:this.saturation*(1-t)})},e.prototype.blend=function(t,i){t=this.clamp(t,0,1);var r=i.toRGB(),n=this.toRGB(),a=n.r+(r.r-n.r)*t,s=n.b+(r.b-n.b)*t;return new e({r:a,g:n.g+(r.g-n.g)*t,b:s})},e.prototype.toRGB=function(){var e,t,i,r=this.saturation*this.value,n=6*this.hue,a=r*(1-Math.abs(n%2-1)),s=this.value-r;switch(Math.floor(n)%6){case 0:e=r+s,t=a+s,i=s;break;case 1:e=a+s,t=r+s,i=s;break;case 2:e=s,t=r+s,i=a+s;break;case 3:e=s,t=a+s,i=r+s;break;case 4:e=a+s,t=s,i=r+s;break;case 5:e=r+s,t=s,i=a+s}return{r:e,g:t,b:i}},e.prototype.equals=function(e){return e.hue===this.hue&&e.value===this.value&&e.saturation===this.saturation},e.prototype.fromRGB=function(e){var t,i,r,n,a=Math.max(e.r,e.g,e.b),s=a-Math.min(e.r,e.g,e.b);return n=0===s?0:a===e.r?(e.g-e.b)/s:a===e.g?2+(e.b-e.r)/s:4+(e.r-e.g)/s,(t=n/6)<0&&(t+=1),i=0===s?0:s/a,r=a,{h:t,s:i,v:r}},e.prototype.rgbToHex=function(e){return"#"+("00"+Math.floor(255*e.r).toString(16)).slice(-2)+("00"+Math.floor(255*e.g).toString(16)).slice(-2)+("00"+Math.floor(255*e.b).toString(16)).slice(-2)},e.prototype.hexToRGB=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,r){return t+t+i+i+r+r});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16)/255,g:parseInt(i[2],16)/255,b:parseInt(i[3],16)/255}:null},e.prototype.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},e.prototype.isHSV=function(e){return!!($.isNumeric(e.h)&&$.isNumeric(e.s)&&$.isNumeric(e.v))},e.prototype.isRGB=function(e){return!!($.isNumeric(e.r)&&$.isNumeric(e.g)&&$.isNumeric(e.b))},e}();e.SymbolColor=t}(e.visualization||(e.visualization={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.getSelectedColorSwatch=function(){for(var e=this.viewModel.colorSwatches.get(),t=0;t<e.length;t++){var i=e[t];if(this.colorSwatchFieldSet.children[t].querySelector("input[type=radio]").checked)return i}},i.prototype.attach=function(t){t.initialize(this.configuration),e.prototype.attach.call(this,t),this.setupJQuerySliders()},i.prototype.added=function(t){t.symbologySettingsWidget=this,e.prototype.added.call(this,t)},i.prototype.applyConfiguration=function(){var e=this;this.viewModel.config;this.configuring=!0,this.colorInput.value=this.viewModel.colors[0].toHex(),this.markerStyleInput.selectedIndex=this.viewModel.markerStyleIndex>=0?this.viewModel.markerStyleIndex:0,this.lineStyleInput.selectedIndex=this.viewModel.lineStyleIndex>=0?this.viewModel.lineStyleIndex:0,this.fillStyleInput.selectedIndex=this.viewModel.fillStyleIndex>=0?this.viewModel.fillStyleIndex:0,this.viewModel.colorSwatches.set(this.viewModel.colors.map(function(e){return{hex:e.toHex()}})),this.viewModel.colorSwatches.get().forEach(function(t,i){e.colorSwatchFieldSet.children[i].style.backgroundColor=t.hex}),this.colorSwatchFieldSet.querySelector(".color-swatch:first-child > input[type=radio]").checked=!0,$(this.transparencySlider).slider("option","value",this.viewModel.transparency.get()),$(this.markerSizeSlider).slider("option","value",this.viewModel.markerSize.get()),$(this.lineWidthSlider).slider("option","value",this.viewModel.lineWidth.get()),this.configuring=!1,this.handleChange()},i.prototype.reset=function(){this.viewModel.reset()},i.prototype.handleChange=function(){if(!this.configuring){this.viewModel.transparency.set($(this.transparencySlider).slider("value")),this.viewModel.markerSize.set($(this.markerSizeSlider).slider("value")),this.viewModel.lineWidth.set($(this.lineWidthSlider).slider("value"));var e=this.viewModel.useColorSwatches.get()?esri.Color.fromHex(this.getSelectedColorSwatch().hex):esri.Color.fromHex(this.colorInput.value);this.viewModel.markerStyleIndex=this.markerStyleInput.selectedIndex;var i=this.viewModel.markerStyles.getAt(this.viewModel.markerStyleIndex).style;this.viewModel.lineStyleIndex=this.lineStyleInput.selectedIndex;var r=this.viewModel.lineStyles.getAt(this.viewModel.lineStyleIndex).style;this.viewModel.fillStyleIndex=this.fillStyleInput.selectedIndex;var n=this.viewModel.fillStyles.getAt(this.viewModel.fillStyleIndex).style,a=this.viewModel.markerSize.get(),s=this.viewModel.lineWidth.get();e.a=this.viewModel.transparency.get()/100*-1+1;var o=new esri.symbol.SimpleLineSymbol;if(this.viewModel.noFill.get()&&this.viewModel.noMarker.get()||!this.viewModel.noMarker.get()&&("cross"===i||"x"===i))o.setColor(e);else if(this.viewModel.config.selectOutlineColor)o.setColor(esri.Color.fromHex(this.viewModel.outlineColors[0].toHex()));else{var l=new t.SymbolColor(e.toHex());l.value>=.7?o.setColor(esri.Color.fromHex(l.darken(.5).toHex())):o.setColor(esri.Color.fromHex(l.lighten(.9).toHex()))}o.setStyle(r),o.setWidth(s);var c=new esri.symbol.SimpleMarkerSymbol;c.setColor(e),c.setStyle(i),c.setSize(a),c.setOutline(o);var u=new esri.symbol.SimpleFillSymbol;u.setColor(e),u.setStyle(n),u.setOutline(o),this.viewModel.symbols={marker:c,line:o,fill:u},this.viewModel.selectedSwatch=this.getSelectedColorSwatch(),this.viewModel.colors[0]=new t.SymbolColor(this.colorInput.value)}},i.prototype.setupJQuerySliders=function(){var e=this,t=this.viewModel.config;$(this.transparencySlider).slider({min:t.transparency.min,max:t.transparency.max,value:t.transparency.value,step:t.transparency.step,slide:function(t,i){return e._handleSliderValueChanged(t,i,e.viewModel.transparency)}}),$(this.markerSizeSlider).slider({min:t.markerSize.min,max:t.markerSize.max,value:t.markerSize.value,step:t.markerSize.step,slide:function(t,i){return e._handleSliderValueChanged(t,i,e.viewModel.markerSize)}}),$(this.lineWidthSlider).slider({min:t.lineWidth.min,max:t.lineWidth.max,value:t.lineWidth.value,step:t.lineWidth.step,slide:function(t,i){return e._handleSliderValueChanged(t,i,e.viewModel.lineWidth)}}),$(this.transparencySlider).add(this.markerSizeSlider).add(this.lineWidthSlider).off("slidechange").on("slidechange",function(t){var i=document.createEvent("Event");i.initEvent("change",!0,!0),e.container.dispatchEvent(i)})},i.prototype._handleSliderValueChanged=function(e,t,i){t&&void 0!=t.value&&i.set(t.value)},i}(e.framework.ui.ViewBase);t.SymbologySettingsView=i}(t.visualization||(t.visualization={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(e){function r(){e.apply(this,arguments),this.noMarker=new Observable(!1),this.noFill=new Observable(!1),this.transparency=new Observable(10),this.outlineTransparency=new Observable(0),this.markerSize=new Observable(10),this.lineWidth=new Observable(2),this.useColorSwatches=new Observable(!0),this.colorSwatches=new ObservableCollection,this.markerStyleIdLookup={circle:"esriSMSCircle",cross:"esriSMSCross",diamond:"esriSMSDiamond",square:"esriSMSSquare",x:"esriSMSX"},this.lineStyleIdLookup={solid:"esriSLSSolid",dash:"esriSLSDash",dashdot:"esriSLSDashDot",dashdotdot:"esriSLSLDashDotDot",dot:"esriSLSDot",longdash:"esriSLSLongDash",longdashdot:"esriSLSLongDashDot",shortdash:"esriSLSShortDash",shortdashdot:"esriSLSShortDashDot",shortdashdotdot:"esriSLSShortDashDotDot",shortdot:"esriSLSShortDot"},this.fillStyleIdLookup={solid:"esriSFSSolid",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical",cross:"esriSFSCross",diagonalcross:"esriSFSDiagonalCross",forwarddiagonal:"esriSFSForwardDiagonal",backwarddiagonal:"esriSFSBackwardDiagonal",null:"esriSFSNull"},this.markerStyles=new ObservableCollection([{style:esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,label:this.getResource("language-symbology-settings-marker-style-circle")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_CROSS,label:this.getResource("language-symbology-settings-marker-style-cross")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,label:this.getResource("language-symbology-settings-marker-style-diamond")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,label:this.getResource("language-symbology-settings-marker-style-square")},{style:esri.symbol.SimpleMarkerSymbol.STYLE_X,label:this.getResource("language-symbology-settings-marker-style-x")}]),this.lineStyles=new ObservableCollection([{style:esri.symbol.SimpleLineSymbol.STYLE_SOLID,label:this.getResource("language-symbology-settings-line-style-solid"),styleId:"esriSLSSolid"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASH,label:this.getResource("language-symbology-settings-line-style-dash"),styleId:"esriSLSDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,label:this.getResource("language-symbology-settings-line-style-dashdot"),styleId:"esriSLSDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT,label:this.getResource("language-symbology-settings-line-style-dashdotdot"),styleId:"esriSLSDashDotDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_DOT,label:this.getResource("language-symbology-settings-line-style-dot"),styleId:"esriSLSDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_LONGDASH,label:this.getResource("language-symbology-settings-line-style-longdash"),styleId:"esriSLSLongDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_LONGDASHDOT,label:this.getResource("language-symbology-settings-line-style-longdashdot"),styleId:"esriSLSLongDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASH,label:this.getResource("language-symbology-settings-line-style-shortdash"),styleId:"esriSLSShortDash"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASHDOT,label:this.getResource("language-symbology-settings-line-style-shortdashdot"),styleId:"esriSLSShortDashDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDASHDOTDOT,label:this.getResource("language-symbology-settings-line-style-shortdashdotdot"),styleId:"esriSLSShortDashDotDot"},{style:esri.symbol.SimpleLineSymbol.STYLE_SHORTDOT,label:this.getResource("language-symbology-settings-line-style-shortdot"),styleId:"esriSLSShortDot"}]),this.fillStyles=new ObservableCollection([{style:esri.symbol.SimpleFillSymbol.STYLE_SOLID,label:this.getResource("language-symbology-settings-fill-style-solid"),styleId:"esriSFSSolid"},{style:esri.symbol.SimpleFillSymbol.STYLE_HORIZONTAL,label:this.getResource("language-symbology-settings-fill-style-horizontal"),styleId:"esriSFSHorizontal"},{style:esri.symbol.SimpleFillSymbol.STYLE_VERTICAL,label:this.getResource("language-symbology-settings-fill-style-vertical"),styleId:"esriSFSVertical"},{style:esri.symbol.SimpleFillSymbol.STYLE_CROSS,label:this.getResource("language-symbology-settings-fill-style-cross"),styleId:"esriSFSCross"},{style:esri.symbol.SimpleFillSymbol.STYLE_DIAGONAL_CROSS,label:this.getResource("language-symbology-settings-fill-style-diagonal-cross"),styleId:"esriSFSDiagonalCross"},{style:esri.symbol.SimpleFillSymbol.STYLE_FORWARD_DIAGONAL,label:this.getResource("language-symbology-settings-fill-style-forward-diagonal"),styleId:"esriSFSForwardDiagonal"},{style:esri.symbol.SimpleFillSymbol.STYLE_BACKWARD_DIAGONAL,label:this.getResource("language-symbology-settings-fill-style-backward-diagonal"),styleId:"esriSFSBackwardDiagonal"},{style:esri.symbol.SimpleFillSymbol.STYLE_NULL,label:this.getResource("language-symbology-settings-fill-style-null"),styleId:"esriSFSNull"}])}return __extends(r,e),r.prototype.initialize=function(e){void 0===e&&(e={}),this.config=e,e.alwaysUseColorSwatches=void 0!=e.alwaysUseColorSwatches&&e.alwaysUseColorSwatches,e.numberOfColorSwatches=e.numberOfColorSwatches?6:e.numberOfColorSwatches,this.config.transparency=e.transparency?e.transparency:{min:0,max:90,value:10,step:5},this.transparency.set(this.config.transparency.value),this.config.markerSize=e.markerSize?e.markerSize:{min:1,max:25,value:10,step:1},this.markerSize.set(this.config.markerSize.value),this.config.lineWidth=e.lineWidth?e.lineWidth:{min:0,max:5,value:2,step:1},this.lineWidth.set(this.config.lineWidth.value),void 0!==e.markerStyles&&(this.markerStyles.set(e.markerStyles),this.markerStyleIndex=0),void 0!==e.lineStyles&&(this.lineStyles.set(e.lineStyles),this.lineStyleIndex=0),void 0!==e.fillStyles&&(this.fillStyles.set(e.fillStyles),this.fillStyleIndex=0),this.useColorSwatches.set(e.alwaysUseColorSwatches||!t.ColorUtils.isColorInputSupported()),this.colors=t.ColorUtils.generateRandomColors(e.numberOfColorSwatches);var i=0;this.outlineColors=this.colors.map(function(e){return++i%2==0?e.darken(.6):e.lighten(.8)})},r.prototype.reset=function(){this.transparency.set(this.config.transparency.value),this.markerSize.set(this.config.markerSize.value),this.lineWidth.set(this.config.lineWidth.value),this.markerStyleIndex=0,this.lineStyleIndex=0,this.fillStyleIndex=0,this.colors=t.ColorUtils.generateRandomColors(this.config.numberOfColorSwatches)},r.prototype.getRenderer=function(){var e=null;return e=this.noMarker.get()?this.noFill.get()?new esri.renderer.SimpleRenderer(this.symbols.line):new esri.renderer.SimpleRenderer(this.symbols.fill):new esri.renderer.SimpleRenderer(this.symbols.marker),JSON.stringify(e.toJson())},r.prototype.getSymbol=function(){var e=null;return e=this.noMarker.get()?this.noFill.get()?this.symbols.line:this.symbols.fill:this.symbols.marker,JSON.stringify(e.toJson())},r.prototype.getColor=function(){return this.useColorSwatches.get()?new i.SymbolColor(this.selectedSwatch.hex):this.colors[0]},r.prototype.setFromRenderer=function(e){var t=e.toJson();"simple"===t.type&&t.symbol&&this._setFromSymbolObject(t.symbol)},r.prototype.setFromSymbol=function(e){var t=e.toJson();this._setFromSymbolObject(t)},r.prototype._setFromSymbolObject=function(e){var t=this;this.colors[0]=new i.SymbolColor({r:e.color[0]/255,g:e.color[1]/255,b:e.color[2]/255});var r;for(var n in this.markerStyleIdLookup)if(this.markerStyleIdLookup.hasOwnProperty(n)&&e.style===this.markerStyleIdLookup[n]){r=n;break}e.outline&&r!==esri.symbol.SimpleMarkerSymbol.STYLE_CROSS&&r!==esri.symbol.SimpleMarkerSymbol.STYLE_X&&(this.outlineColors[0]=new i.SymbolColor({r:e.outline.color[0]/255,g:e.outline.color[1]/255,b:e.outline.color[2]/255})),this.transparency.set(Math.floor(Math.ceil((255-e.color[3])/255*100)/this.config.transparency.step)*this.config.transparency.step);var a=this.markerStyles.getItems().filter(function(e){return e.style===r})[0];this.markerSize.set($.isNumeric(e.size)?Math.floor(e.size*i.POINTS_TO_PIXELS):this.config.markerSize.value),this.markerStyleIndex=a?this.markerStyles.indexOf(a):0;var s=this.noFill.get()&&this.noMarker.get()?e:e.outline;this.lineWidth.set($.isNumeric(s.width)?Math.floor(s.width*i.POINTS_TO_PIXELS):this.config.lineWidth.value),this.lineStyleIndex=s.style?this.lineStyles.indexOf(this.lineStyles.getItems().filter(function(e){return t.lineStyleIdLookup[e.style]===s.style})[0]):0;var o=this.fillStyles.getItems().filter(function(i){return t.fillStyleIdLookup[i.style]===e.style})[0];this.fillStyleIndex=o?this.fillStyles.indexOf(o):0},r}(e.framework.ui.ViewModelBase);i.SymbologySettingsViewModel=r,i.POINTS_TO_PIXELS=96/72}(t.visualization||(t.visualization={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.visualizations=[],this.enabledVisualization=null,this.currentLayer=new Observable(null),this.isEnabled=new Observable(!1),this.isSupported=new Observable(!1),this.app=e,this.libraryId=t,this.currentLayer.bind(this,this.handleCurrentLayerChanged)}return e.prototype.initialize=function(e){e.viewId&&(this.viewId=e.viewId),e.displayName&&(this.displayName=e.displayName)},e.prototype.canSupport=function(e){return!1},e.prototype.handleCurrentLayerChanged=function(e){throw new Error("Not implemented")},e.prototype.handleActivate=function(e){throw new Error("Not implemented")},e.prototype.handleApply=function(){throw new Error("Not implemented")},e}();e.VisualizationProviderBase=t}(e.visualization||(e.visualization={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){function t(e){return e.split(a)}function i(e){return(a.test(e)?e.match(a).length:0)+1}var r=null,n={},a=/\r\n|\r|\n/g;e.getLabelSize=function(e,a,s,o){for(var l=!0,c=null,u=i(e),p=t(e),h=0,d=0;p&&d<p.length;d++){for(var m=e.length,g=0,f=0;f<m;f++){var y=p[d].charAt(f);y=" "===y?".":y,g+=n.hasOwnProperty(y)?n[y]:function(e){if(l){var t=document.getElementById(o+"_layer");(c=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttributeNS(null,"font-size",s),c.setAttributeNS(null,"font-family",a),c.setAttributeNS(null,"visibility","hidden"),c.textContent=e,t.appendChild(c),l=!1}else c.textContent=e;var i=c.getBBox();return r=null===r?i.height:r,n[e]=c.getComputedTextLength(),n[e]}(y)}g>h&&(h=g)}return{width:Math.ceil(h),height:Math.ceil(r*u)}},e.getTextLines=t,e.generateSvgHighlightLabelPath=function(e,t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=e/5);var a="";return a=0===i?"M1,0h"+e+"v"+t:"M1,0h"+(e-i)+"a"+i+","+i+" 0 0 1 "+i+","+i+"v"+(t-2*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i,a+=r?"h"+(i-(e-n))/2+"l"+-n/2+","+n/2+"l"+-n/2+","+-n/2+"h"+(i-(e-n))/2:"h"+(i-e),a+=0===i?"z":"a"+i+","+i+" 0 0 1 "+-i+","+-i+"v"+(2*i-t)+"a"+i+","+i+" 0 0 1 "+i+","+-i+"z"},e.generateSvgCirclePath=function(e){if(!e)throw new Error("HighlightLabelUtils: Cannot generate SVG circle path. Radius cannot be zero or undefined.");return"M0,0a"+e+","+e+" 0 0 1 "+e+","+e+"a"+e+","+e+" 0 0 1 "+-e+","+e+"a"+e+","+e+" 0 0 1 "+-e+","+-e+"a"+e+","+e+" 0 0 1 "+e+","+-e+"z"}}(e.HighlightedLabelUtils||(e.HighlightedLabelUtils={}))}(e.highlightedLabel||(e.highlightedLabel={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.OPEN_STREET_MAP="OpenStreetMap",e.BING_AERIAL="BingMapsAerial",e.BING_ROAD="BingMapsRoad",e.BING_HYBRID="BingMapsHybrid",e.WEB_TILED="WebTiledLayer"}(e.BaseMapType||(e.BaseMapType={}))}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.CSV="CSV",e.WMS="WMS",e.KML="KML"}(e.OperationalLayerType||(e.OperationalLayerType={}))}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.SIMPLE="simple",e.UNIQUE_VALUE="uniqueValue",e.CLASS_BREAKS="classBreaks",e.HEATMAP="heatmap"}(e.RendererType||(e.RendererType={}));!function(e){e.BY_FIELD="esriNormalizeByField",e.BY_LOG="esriNormalizeByLog",e.BY_PERCENT_OF_TOTAL="esriNormalizeByPercentOfTotal"}(e.NormalizationType||(e.NormalizationType={}));!function(e){e.NATURAL_BREAKS="esriClassifyNaturalBreaks",e.EQUAL_INTERVAL="esriClassifyEqualInterval",e.QUANTILE="esriClassifyQuantile",e.STANDARD_DEVIATION="esriClassifyStandardDeviation",e.GEOMETRICAL_INTERVAL="esriClassifyGeometricalInterval"}(e.ClassificationMethod||(e.ClassificationMethod={}))}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.INHERITED="inherited",e.RANGE="range",e.CODED_VALUE="codedValue"}(e.DomainType||(e.DomainType={}))}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e.POINT="esriGeometryPoint",e.MULTIPOINT="esriGeometryMultipoint",e.POLYLINE="esriGeometryPolyline",e.POLYGON="esriGeometryPolygon",e.EXTENT="esriGeometryEnvelope",e.fromEsriGeometryType=function(t){if(t){if(t.startsWith("esriGeometry"))return t;switch(t){case"point":return e.POINT;case"multipoint":return e.MULTIPOINT;case"polyline":return e.POLYLINE;case"polygon":return e.POLYGON;case"extent":return e.EXTENT;default:throw new Error("GeometryType.fromEsriGeometryType: Unrecognized geometry type.")}}}}(e.GeometryType||(e.GeometryType={}))}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i="__conversionType",r=function(){function r(r){var n=this;this._numberValidator=new e.validation.NumberValidator,this.object=function(e){if(!e||"object"!=typeof e)return!0;if(Array.isArray(e))return{item:n.object};switch(e[i]){case t.ConversionType.GCX_MAP_SERVICE:case t.ConversionType.ESRI_LAYER:return n.serviceLayer;case t.ConversionType.GCX_LAYER:return n.layer;case t.ConversionType.GCX_FEATURE_SET:case t.ConversionType.ESRI_FEATURE_SET:return n.featureSet;case t.ConversionType.GCX_FEATURE:case t.ConversionType.ESRI_GRAPHIC:return n.feature;case t.ConversionType.ESRI_GEOMETRY:return n.geometry;case t.ConversionType.ESRI_SYMBOL:return n.symbol;case t.ConversionType.ESRI_RENDERER:return n.renderer;case t.ConversionType.ESRI_SPATIAL_REFERENCE:return n.spatialReference}for(var r={},a=0,s=Object.keys(e);a<s.length;a++)r[s[a]]=n.object;return r},this.app=r,this._urlValidator=new e.validation.SiteUrlValidator(r)}return Object.defineProperty(r.prototype,"baseMap",{get:function(){return this._baseMap||(this._baseMap={baseMapLayers:{item:this.baseMapLayer},title:!0}),this._baseMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"baseMapLayer",{get:function(){return this._baseMapLayer||(this._baseMapLayer=$.extend({},this._serviceLayerCommon,{type:!0,isReference:!0,templateUrl:this._urlValidator}),this._baseMapLayer[i]=!0),this._baseMapLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bookmark",{get:function(){return this._bookmark||(this._bookmark={name:!0,extent:this.extent}),this._bookmark},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"color",{get:function(){return this._color||(this._color={item:this._numberValidator}),this._color},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"csvLayer",{get:function(){return this._csvLayer||(this._csvLayer=$.extend({},this.operationalLayer,{columnDelimiter:!0,locationInfo:this.locationInfo})),this._csvLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"domain",{get:function(){var e=this;return this._domain||(this._domain=function(i){if(!i)return!1;switch(i.type){case t.DomainType.INHERITED:return e.inheritedDomain;case t.DomainType.RANGE:return e.rangeDomain;case t.DomainType.CODED_VALUE:return e.codedValueDomain;default:return!1}}),this._domain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inheritedDomain",{get:function(){return this._inheritedDomain||(this._inheritedDomain={type:!0}),this._inheritedDomain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rangeDomain",{get:function(){return this._rangeDomain||(this._rangeDomain={type:!0,name:!0,range:{item:this._numberValidator}}),this._rangeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"codedValueDomain",{get:function(){return this._codedValueDomain||(this._codedValueDomain={type:!0,name:!0,codedValues:{item:{name:!0,code:!0}}}),this._codedValueDomain},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"drawingInfo",{get:function(){return this._drawingInfo||(this._drawingInfo={renderer:this.renderer,fixedSymbols:!0}),this._drawingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"feature",{get:function(){return this._feature||(this._feature={attributes:this.object,geometry:this.geometry},this._feature[i]=!0),this._feature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"featureCollection",{get:function(){return this._featureCollection||(this._featureCollection={layers:{item:this.layer},showLegend:!0}),this._featureCollection},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"featureSet",{get:function(){return this._featureSet||(this._featureSet={features:{item:this.feature},geometryType:!0},this._featureSet[i]=!0),this._featureSet},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"field",{get:function(){return this._field||(this._field={alias:!0,domain:this.domain,editable:!0,length:!0,name:!0,nullable:!0,type:!0}),this._field},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"geometry",{get:function(){var e=this;return this._geometry||(this._geometry=function(t){return!!t&&(t.hasOwnProperty("x")?e.point:t.hasOwnProperty("points")?e.multiPoint:t.hasOwnProperty("paths")?e.polyline:t.hasOwnProperty("rings")?e.polygon:!!t.hasOwnProperty("xmin")&&e.extent)}),this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"point",{get:function(){return this._point||(this._point={spatialReference:this.spatialReference,x:this._numberValidator,y:this._numberValidator,z:this._numberValidator,m:this._numberValidator},this._point[i]=!0),this._point},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"multiPoint",{get:function(){return this._multipoint||(this._multipoint={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,points:{item:{item:this._numberValidator}}},this._multipoint[i]=!0),this._multipoint},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"polyline",{get:function(){return this._polyline||(this._polyline={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,paths:{item:{item:{item:this._numberValidator}}}},this._polyline[i]=!0),this._polyline},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"polygon",{get:function(){return this._polygon||(this._polygon={spatialReference:this.spatialReference,hasM:!0,hasZ:!0,rings:{item:{item:{item:this._numberValidator}}}},this._polygon[i]=!0),this._polygon},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"extent",{get:function(){return this._extent||(this._extent={spatialReference:this.spatialReference,xmin:this._numberValidator,xmax:this._numberValidator,ymin:this._numberValidator,ymax:this._numberValidator,zmin:this._numberValidator,zmax:this._numberValidator,mmin:this._numberValidator,mmax:this._numberValidator},this._extent[i]),this._extent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layer",{get:function(){return this._layer||(this._layer={featureSet:this.featureSet,id:!0,layerDefinition:this.layerDefinition,layerUrl:this._urlValidator,legendUrl:this._urlValidator,name:!0,title:!0,popupInfo:this.popupInfo},this._layer[i]=!0),this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layerDefinition",{get:function(){return this._layerDefinition||(this._layerDefinition={definitionExpression:!0,displayField:!0,drawingInfo:this.drawingInfo,fields:{item:this.field},geometryType:!0,hasAttachments:!0,maxScale:this._numberValidator,minScale:this._numberValidator,name:!0,objectIdField:!0,templates:{item:this.template},type:!0,typeIdField:!0,types:{item:this.type},source:{type:!0,mapLayerId:this._numberValidator}}),this._layerDefinition},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"locationInfo",{get:function(){return this._locationInfo||(this._locationInfo={locationType:!0,latitudeFieldName:!0,longitudeFieldName:!0}),this._locationInfo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"operationalLayer",{get:function(){return this._operationalLayer||(this._operationalLayer=$.extend({},this._serviceLayerCommon,{type:!0,capabilities:!0,featureCollection:this.featureCollection,itemId:!0,layerDefinition:this.layerDefinition,layers:{item:this.layer},maxScale:this._numberValidator,minScale:this._numberValidator,mode:this._numberValidator,popupInfo:this.popupInfo,title:!0,visibleLayers:{item:!0}}),this._operationalLayer[i]=!0),this._operationalLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupInfo",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderer",{get:function(){var e=this;return this._renderer||(this._renderer=function(i){if(!i)return!1;switch(i.type){case t.RendererType.SIMPLE:return e.simpleRenderer;case t.RendererType.UNIQUE_VALUE:return e.uniqueValueRenderer;case t.RendererType.CLASS_BREAKS:return e.classBreaksRenderer;case t.RendererType.HEATMAP:return e.heatmapRenderer;default:return!1}}),this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"serviceLayer",{get:function(){return this._serviceLayer||(this._serviceLayer=$.extend({},this.operationalLayer,this.wmsLayer,this.csvLayer,this.baseMapLayer)),this._serviceLayer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleRenderer",{get:function(){return this._simpleRenderer||(this._simpleRenderer={type:!0,symbol:this.symbol,label:!0,description:!0},this._simpleRenderer[i]=!0),this._simpleRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uniqueValueRenderer",{get:function(){return this._uniqueValueRenderer||(this._uniqueValueRenderer={type:!0,field1:!0,field2:!0,field3:!0,fieldDelimiter:!0,defaultSymbol:this.symbol,defaultLabel:!0,uniqueValueInfos:{item:{value:!0,label:!0,description:!0,symbol:this.symbol}}},this._uniqueValueRenderer[i]=!0),this._uniqueValueRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classBreaksRenderer",{get:function(){return this._classBreaksRenderer||(this._classBreaksRenderer={type:!0,field:!0,classificationMethod:!0,normalizationType:!0,normalizationField:!0,normalizationTotal:this._numberValidator,defaultSymbol:this.symbol,defaultLabel:!0,backgroundFillSymbol:this.simpleFillSymbol,minValue:this._numberValidator,classBreakInfos:{item:{classMinValue:this._numberValidator,classMaxValue:this._numberValidator,label:!0,description:!0,symbol:this.symbol}}},this._classBreaksRenderer[i]=!0),this._classBreaksRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"heatmapRenderer",{get:function(){return this._heatmapRenderer||(this._heatmapRenderer={type:!0,blurRadius:this._numberValidator,field:!0,maxPixelIntensity:this._numberValidator,minPixelIntensity:this._numberValidator,colorStops:{item:{ratio:!0,color:this.color}}}),this._heatmapRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_serviceLayerCommon",{get:function(){return{id:!0,url:this._urlValidator,visibility:!0,opacity:this._numberValidator,layerType:!0}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"spatialReference",{get:function(){return this._spatialReference||(this._spatialReference={wkid:this._numberValidator,wkt:!0},this._spatialReference[i]=!0),this._spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"symbol",{get:function(){var e=this;return this._symbol||(this._symbol=function(i){if(!i)return!1;switch(i.type){case t.SymbolType.SIMPLE_MARKER:return e.simpleMarkerSymbol;case t.SymbolType.SIMPLE_LINE:return e.simpleLineSymbol;case t.SymbolType.SIMPLE_FILL:return e.simpleFillSymbol;case t.SymbolType.PICTURE_MARKER:return e.pictureMarkerSymbol;case t.SymbolType.PICTURE_FILL:return e.pictureFillSymbol;case t.SymbolType.TEXT:return e.textSymbol;default:return!1}}),this._symbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleMarkerSymbol",{get:function(){return this._simpleMarkerSymbol||(this._simpleMarkerSymbol={type:!0,style:!0,color:this.color,size:!0,angle:this._numberValidator,path:!0,xoffset:this._numberValidator,yoffset:this._numberValidator,outline:{type:!0,style:!0,color:this.color,width:this._numberValidator}},this._simpleMarkerSymbol[i]=!0),this._simpleMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleLineSymbol",{get:function(){return this._simpleLineSymbol||(this._simpleLineSymbol={type:!0,style:!0,color:this.color,width:this._numberValidator},this._simpleLineSymbol[i]=!0),this._simpleLineSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"simpleFillSymbol",{get:function(){return this._simpleFillSymbol||(this._simpleFillSymbol={type:!0,style:!0,color:this.color,outline:this.simpleLineSymbol},this._simpleFillSymbol[i]=!0),this._simpleFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pictureMarkerSymbol",{get:function(){return this._pictureMarkerSymbol||(this._pictureMarkerSymbol={type:!0,url:this._urlValidator,imageData:!0,contentType:!0,width:this._numberValidator,height:this._numberValidator,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator},this._pictureMarkerSymbol[i]=!0),this._pictureMarkerSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pictureFillSymbol",{get:function(){return this._pictureFillSymbol||(this._pictureFillSymbol={type:!0,url:this._urlValidator,imageData:!0,contentType:!0,outline:this.simpleLineSymbol,width:this._numberValidator,height:this._numberValidator,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator,xscale:this._numberValidator,yscale:this._numberValidator},this._pictureFillSymbol[i]=!0),this._pictureFillSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textSymbol",{get:function(){return this._textSymbol||(this._textSymbol={type:!0,color:this.color,backgroundColor:this.color,borderLineSize:this._numberValidator,borderLineColor:this.color,haloSize:this._numberValidator,haloColor:this.color,verticalAlignment:!0,horizontalAlignment:!0,rightToLeft:!0,angle:this._numberValidator,xoffset:this._numberValidator,yoffset:this._numberValidator,kerning:!0,font:{family:!0,size:this._numberValidator,style:!0,weight:!0,decoration:!0},text:!0},this._textSymbol[i]=!0),this._textSymbol},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"template",{get:function(){return this._template||(this._template={description:!0,drawingTool:!0,name:!0,prototype:this.feature}),this._template},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"type",{get:function(){var e=this;return this._type||(this._type={domains:function(t){if(!t)return!0;for(var i={},r=0,n=Object.keys(t);r<n.length;r++)i[n[r]]=e.domain;return i},id:this._numberValidator,name:!0,templates:{item:this.template}}),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"webMap",{get:function(){return this._webMap||(this._webMap={operationalLayers:{item:this.operationalLayer},baseMap:this.baseMap,bookmarks:{item:this.bookmark},version:!0,applicationProperties:!0}),this._webMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wmsLayer",{get:function(){return this.wmsLayer||(this._wmsLayer=$.extend({},this.operationalLayer,{copyright:!0,extent:this.extent,format:!0,mapUrl:this._urlValidator,maxHeight:this._numberValidator,maxWidth:this._numberValidator,spatialReferences:{item:this._numberValidator},version:!0})),this._wmsLayer},enumerable:!0,configurable:!0}),r}();t.WebMapFilter=r}(e.webMap||(e.webMap={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(i){!function(r){var n=function(){function n(e){if(!e)throw new Error("ProjectManager: Parameter 'app' is required.");this.app=e,this.convert=new r.WebMapConverter(e),this.filter=new r.WebMapFilter(e)}return n.prototype.create=function(){var r=this;if(!this.app.site||!this.app.site.isInitialized)throw new Error("WebMapConverter.fromCurrentMap: The Essentials site for this application is missing or not yet initialized.");this.convert.clearCache();var n=this.app.site.essentialsMap,a=function(e,t){console.warn('Unable to convert map service "{0}" to web map format: {1}'.format(e.displayName,t))},s=n.mapServices.filter(function(t){return t.mapServiceFunction===e.essentials.MapServiceFunction.OPERATIONAL}).reverse(),o=t.infrastructure.ArrayUtils.mapWithErrorCallback(s,function(e){return r.convert.fromGcxMapService(e)},a);i.GraphicUtils.getUserGraphicsLayers(this.app).filter(function(e){return e.graphics.length>0}).forEach(function(e){try{o.push(r.convert.fromEsriLayer(e))}catch(t){console.warn('Unable to convert graphics layer "{0}" to web map format: {1}'.format(e.id,t))}});var l=n.mapServices.filter(function(t){return t.isVisible()&&t.mapServiceFunction===e.essentials.MapServiceFunction.BASE}).reverse(),c="",u=t.infrastructure.ArrayUtils.mapWithErrorCallback(l,function(e){return r.convert.fromGcxMapService(e)},a);if(l.length){var p=n.baseMaps.filter(function(e){return l.every(function(t){return e.services.some(function(e){return e.mapService===t})})});c=1===p.length?p[0].displayName:l[l.length-1].displayName}return u.length||(c="Light Gray Canvas",u[0]={id:"World_Light_Gray_Base_1486",layerType:"ArcGISTiledMapServiceLayer",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"}),this.app.bookmarks.export().then(function(e){return{operationalLayers:o,baseMap:{title:c,baseMapLayers:u},bookmarks:e,version:"1.7"}})},n}();r.WebMapManager=n}(i.webMap||(i.webMap={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){function i(e){return e&&"function"==typeof e.validate}function r(e,r,a,s){if("object"==typeof e&&a.has(e))return Promise.resolve(a.get(e));for(;"function"==typeof r;)r=r(e,s);return i(r)?r.validate(e,s).then(function(e){return e.validatedValue}):"object"==typeof r&&"object"==typeof e?n(e,r,a,s):!0===r?Promise.resolve(e):Promise.reject(t.FILTERED)}function n(t,i,n,a){if(!t)return Promise.resolve(t);if(n.has(t))return n.get(t);for(var s;"function"==typeof i;)i=i(t,a);if("object"==typeof i)if(Array.isArray(t))s=e.PromiseUtils.mapSkipRejected(t,function(e){return r(e,i.item,n,a)}),n.set(t,s);else{var o={};n.set(t,o),s=e.PromiseUtils.mapSkipRejected(Object.keys(i),function(e){if(e in t)return r(t[e],i[e],n,a).then(function(t){o[e]=t})}).return(o)}else s=r(t,i,n);return s}t.FILTERED={},t.filter=function(e,t,i){return t?n(e,t,new WeakMap,i):Promise.reject(new Error("Filter required."))}}(e.ObjectFilter||(e.ObjectFilter={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t){var i=this;this.esriLayer=e,this.templateType="single-item",this.swatchElement=null,this.label=new Observable(""),this.description=new Observable(""),this.isVisible=new Observable(!0),this.isVisibleInLayerListLegend=new Observable(!0),this.isCluster=!1,this.expanded=new Observable(!0),this.expanderClass=new Observable,this.children=new ObservableCollection,this.children.useThrottling=!!t,this.expanderClass.syncTransform(this.expanded,function(e){return e?"tree-expander expanded":"tree-expander collapsed"}),this.expanded.pulse(),this.isVisibleInLayerListLegend.syncTransform(this.isVisible,function(e){return!i.isCluster||e})}}();e.LegendItem=t}(e.legend||(e.legend={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){!function(e){e[e.NotFound=0]="NotFound",e[e.Rendered=1]="Rendered",e[e.Show=2]="Show",e[e.Hide=3]="Hide",e[e.Pending=4]="Pending",e[e.Error=5]="Error"}(e.LegendItemProviderResponseCode||(e.LegendItemProviderResponseCode={}));e.LegendItemProviderResponseCode;var t=function(){return function(e,t){this.code=new Observable(e),this.item=t}}();e.LegendItemProviderResponse=t}(e.legend||(e.legend={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(e,t){this.identifier=e,this._provider=t}}();e.LegendItemProviderEntry=t}(e.legend||(e.legend={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(){function i(){}return i.registerLegendItemProvider=function(i){var r=this,n=function(e,t){for(var i=0;i<r._legendItemCallbacks.length;i++)if(e===r._legendItemCallbacks[i].uniqueId){r._legendItemCallbacks[i].callback(t),r._legendItemCallbacks.splice(i,1);break}},a=function(e){var t=e.children.get();if(t.length)for(var i,r=0;r<t.length;r++){var n=t[r].sublayerId||t[r].essLayer&&t[r].essLayer.id;if(0===r&&(i=n),n!==i||"single-item"!==t[r].templateType)return!1}return!0},s=function(e){if(e.children&&e.children.length())for(var t=0,i=e.children.length();t<i;t++){var r=e.children.getAt(t);c(r)}},o=function(e,t){r._legendItemInfos.push({uniqueId:e,legendItem:t}),n(e,t)},l=function(e){var t=e.essLayer&&e.essLayer.mapService&&e.essLayer.mapService.id||e.children&&e.children.length()&&e.children.getAt(0).essLayer&&e.children.getAt(0).essLayer.mapService&&e.children.getAt(0).essLayer.mapService.id||e.esriLayer.id,i=e.essLayer&&e.essLayer.id||e.sublayerId||null;return t+(null!=i?"."+i:"")},c=function(e){if(e){if("group"===e.templateType){if(e.children.length()&&a(e)){var t=e.children.getAt(0);return void o(l(t),e)}s(e)}"single-item"===e.templateType&&o(l(e),e)}};dojo.aspect.after(i,"provide",function(i){var n=i.code.get();if(n===t.LegendItemProviderResponseCode.Pending||n===t.LegendItemProviderResponseCode.Show){var a=function(){i.item&&c(i.item)};if(n===e.legend.LegendItemProviderResponseCode.Show)a();else var s=i.code.bind(r,function(e){i.code.unbind(s),e===t.LegendItemProviderResponseCode.Show&&a()})}return i}),this._providers.push(i)},i.getProviders=function(){return this._providers},i.getLegendItemWhenAvailable=function(e,t){this.getLegendItemByIdWhenAvailable(e.uniqueId,t)},i.getLegendItemByIdWhenAvailable=function(e,t){if(e&&t){for(var i=null,r=0,n=this._legendItemInfos.length;r<n;r++){var a=this._legendItemInfos[r];a.uniqueId===e&&(i=a.legendItem)}i?t(i):this._legendItemCallbacks.push({uniqueId:e,callback:t})}},i._providers=[],i._legendItemInfos=[],i._legendItemCallbacks=[],i}();t.LegendItemProviderFactory=i}(e.legend||(e.legend={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){return function(){}}();e.ResultsPageChangedEventArgs=t}(e.eventArgs||(e.eventArgs={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(){function i(){}return i.fromGeocortexApp=function(e){var r=new i;return r.gcxApp=e,r.urlParameters=e.urlParameters,e.isArcGisWebApp?r.mapInfo=t.MapInfo.fromEsriMap(e.map):(r.essentialsVersion=e.site.getEssentialsVersion(),r.mapInfo=t.MapInfo.fromViewerApp(e)),r.map=r.mapInfo.map,r},i.prototype.getGeometryService=function(){return this._geometryService?this._geometryService:this.geometryServiceUrl?(this._geometryService=new esri.tasks.GeometryService(this.geometryServiceUrl),this._geometryService):this.gcxApp?e.GeometryUtils.getGeometryService(this.gcxApp):null},i}();t.AppInfo=i}(e.gis||(e.gis={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(i){!function(r){var n=function(){function n(){this.subtypeDomains={},this.subtypeDomainInfos={},this.isVisible=!0}return n.fromEsriField=function(e,i,a){var s=new n;if(s.name=e.name,s.type=e.type,s.alias=a?a.displayName||e.alias:e.alias,s.isVisible=!a||a.visible,s.searchable=!a||a.searchable,s.editable=e.editable,s.nullable=e.nullable,s.length=e.length,s.esriField=e,s.isTypeField=i&&i.typeIdField===e.name,i){if(s.isTypeField&&!e.domain){var o=new esri.layers.CodedValueDomain;o.codedValues=[],o.type="codedValue",i.types.forEach(function(e){o.codedValues.push({name:e.name,code:e.id})}),s.domainInfo=r.DomainInfo.create(o),s.domain=o}else s.domainInfo=r.DomainInfo.create(e.domain),s.domain=e.domain;i.types&&i.types.forEach(function(t){for(var i in t.domains)if(t.domains.hasOwnProperty(i)&&i===e.name&&null!==t.id){var n=t.domains[i];s.subtypeDomains[t.id.toString()]=n,s.subtypeDomainInfos[t.id.toString()]=r.DomainInfo.create(n);break}})}if(a){if(s.format=a.format,!s.format)if(s._isNumericFormat()){var l=[a.layer.defaultNumberFormat,a.layer.mapService.defaultNumberFormat].filter(function(e){return!!e})[0];l&&(s.format="{0:"+l+"}")}else if(s.isDate()){var c=[a.layer.defaultDateFormat,a.layer.mapService.defaultDateFormat].filter(function(e){return!!e})[0];c&&(s.format="{0:"+c+"}")}s.timeZoneId||(s.timeZoneId=t.infrastructure.TimeZoneUtils.getTimeZoneFromLayer(a.layer)),s.displayTimeZoneId||(s.displayTimeZoneId=t.infrastructure.TimeZoneUtils.getDisplayTimeZoneFromMapService(a.layer.mapService))}return s},n.fromGcxField=function(t){var i=new esri.layers.Field;new n;return i.name=t.name,i.type=e.essentials.Field.convertToEsriFieldType(t.dataType),i.alias=t.displayName,i.editable=!1,i.nullable=!0,n.fromEsriField(i,null,t)},n.prototype.isNumeric=function(){var t=[e.essentials.EsriFieldTypes.esriFieldTypeOID,e.essentials.EsriFieldTypes.esriFieldTypeSmallInteger,e.essentials.EsriFieldTypes.esriFieldTypeInteger,e.essentials.EsriFieldTypes.esriFieldTypeSingle,e.essentials.EsriFieldTypes.esriFieldTypeDouble];return dojo.indexOf(t,this.type)>=0},n.prototype.isDate=function(){var t=[e.essentials.EsriFieldTypes.esriFieldTypeDate];return dojo.indexOf(t,this.type)>=0},n.prototype.isText=function(){var t=[e.essentials.EsriFieldTypes.esriFieldTypeString];return dojo.indexOf(t,this.type)>=0},n.prototype.isCodedValueDomain=function(){return this.domainInfo&&this.domainInfo.isCodedValueDomain()},n.prototype.hasSubtypeCodedValueDomains=function(){for(var e in this.subtypeDomainInfos)if(this.subtypeDomainInfos.hasOwnProperty(e)&&this.subtypeDomainInfos[e].isCodedValueDomain())return!0;return!1},n.prototype.getCodedValueDomain=function(){return this.domain},n.prototype.getSubtypeCodedValueDomains=function(){var e={};for(var t in this.subtypeDomainInfos)this.subtypeDomainInfos.hasOwnProperty(t)&&this.subtypeDomainInfos[t].isCodedValueDomain()&&(e[t]=this.subtypeDomainInfos[t].domain);return e},n.prototype.resolveCodedDomainValue=function(e,t){var i=null;if(this.domainInfo&&(i=this.domainInfo.getName(e)),null==i){var r=this.subtypeDomainInfos[t];r&&(i=r.getName(e))}return i},n.prototype.formatValue=function(e,t){var r=this;if(this.isCodedValueDomain()||this.hasSubtypeCodedValueDomains()){var n=this.resolveCodedDomainValue(e,t);if(null!=n)return n}if(this.format)return this.format.replace(/\{0(?::([^}]*))?\}/,function(t,n){if(r.isDate()){var a={timeZoneId:r.timeZoneId,displayTimeZoneId:r.displayTimeZoneId};return i.FormatUtils.formatDate(i.FormatUtils.parseDate(e),n,a)}return r._isNumericFormat()?i.FormatUtils.formatNumber(i.FormatUtils.parseNumber(e),n):null===e||void 0===e?e:e.toString()});if(this.isDate()){var a={timeZoneId:this.timeZoneId,displayTimeZoneId:this.displayTimeZoneId};return i.FormatUtils.formatDate(i.FormatUtils.parseDate(e),null,a)}return this._isNumericFormat()?i.FormatUtils.formatNumber(i.FormatUtils.parseNumber(e)):null===e||void 0===e?e:e.toString()},n.prototype._isNumericFormat=function(){return this.isNumeric()&&this.type!==e.essentials.EsriFieldTypes.esriFieldTypeOID&&(!this.name||"OBJECTID"!==this.name.toUpperCase())},n}();r.FieldInfo=n}(i.gis||(i.gis={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(){function i(){this.fields=new Array,this.isUserCreated=!1,this.includeInLayerList=!0,this.isExpanded=!0,this._visible=!1,this._fieldsRetrieved=!1}return i.fromEsriLayerInfo=function(t,r){var n=new i;return n.esriLayerInfo=t,n.id=t.id+"",n.name=t.name,n.displayName=t.name,n.parentLayerId=t.parentLayerId?t.parentLayerId.toString():null,n.subLayerIds=t.subLayerIds?dojo.map(t.subLayerIds,function(e){return e.toString()}):null,n.uniqueId=r.id.replace(".","..")+"."+t.id,n.url=e.essentials.utilities.DecomposedUri.appendToPath(r.url,"/"+t.id),n.queryable=!0,n.dataProvider="Default",n._visible=t.defaultVisibility,n},i.fromEsriFeatureLayer=function(e){var t=new i;return t.id=e.id+"",t.name=e.name,t.displayName=e.name,t.uniqueId=e.id,t.url=e.url,t.queryable=!0,t.dataProvider="Default",t._featureLayer=e,t._visible=e.defaultVisibility,t.subLayerIds=null,t.parentLayerId=null,t.relationships=e.relationships,t},i.fromGcxLayer=function(t){var r=new i;return r.gcxLayer=t,r.id=t.id,r.name=t.name,r.displayName=t.displayName||t.name,r.uniqueId=t.mapService.id+"."+t.id,r.dataProvider=t.dataProvider||"Default",r.isExpanded=t.isExpanded,r.isUserCreated=t.isUserCreated,r.relationships=t.relationships,t.mapService.drawingBehavior==e.essentials.DrawingBehavior.FEATURE_LAYER?r.url=t.mapService.serviceLayer.url:t.mapService.mapServiceType==e.essentials.MapServiceType.DYNAMIC||t.mapService.mapServiceType==e.essentials.MapServiceType.TILED?r.url=e.essentials.utilities.DecomposedUri.appendToPath(t.mapService.serviceLayer.url,"/"+t.id):t.mapService.serviceLayer instanceof esri.layers.WMSLayer&&(r.url=t.url),t.parentLayerId&&(r.parentLayerId=t.parentLayerId),r.subLayerIds=t.subLayerIds?t.subLayerIds:null,r.includeInLayerList=t.includeInLayerList,r.queryable=t.queryable&&t.fields.length>0&&t.supportsQuery,r._visible=t.configuredVisible,r},i.prototype.getFields=function(){var e=this,i=new dojo.Deferred;return this._fieldsRetrieved?i.resolve(this.fields):this.getInitializedFeatureLayer().then(function(r){for(var n=0;n<r.fields.length;n++){var a=r.fields[n],s=e.gcxLayer?e.gcxLayer.getFieldByName(a.name):null,o=t.FieldInfo.fromEsriField(a,r,s);e.fields.push(o)}e._fieldsRetrieved=!0,i.isCanceled()||i.resolve(e.fields)},function(e){i.errback(e)}),i},i.prototype.getInitializedFeatureLayer=function(){var t=this;return this.gcxLayer?this.gcxLayer.getFeatureLayer():new Promise(function(i,r){if(t._featureLayer||(t._featureLayer=new esri.layers.FeatureLayer(t.url)),t._featureLayer.loaded)i(t._featureLayer);else if(t._featureLayer.__attached_error)r(t._featureLayer.__attached_error);else var n=t._featureLayer.on("load",function(){if(n.remove(),a.remove(),t.gcxLayer.wmsLayerName)for(var r=t.gcxLayer.fields,s=t._featureLayer.fields.length-1;s>=0;s--){var o=t._featureLayer.fields[s];"gml:id"===o.name&&t._featureLayer.fields.splice(s,1),o.type=e.essentials.Field.convertToEsriFieldType(r[s].dataType)}i(t._featureLayer)}),a=t._featureLayer.on("error",function(e){n.remove(),a.remove(),t._featureLayer.__attached_error=e,r(e)})})},i.prototype.setDefinitionExpression=function(e){var t=this.serviceLayerInfo.serviceLayer;if(t instanceof esri.layers.ArcGISDynamicMapServiceLayer){var i=t,r=i.layerDefinitions||[];e&&"1 = 1"!=e?r[parseInt(this.id)]=e:delete r[parseInt(this.id)],i.setLayerDefinitions(r)}else if(t instanceof esri.layers.FeatureLayer){var n=t;e&&"1 = 1"!=e?n.setDefinitionExpression(e):n.setDefinitionExpression(null)}},i.prototype.getDefinitionExpression=function(){var e=this.serviceLayerInfo.serviceLayer;return e instanceof esri.layers.ArcGISDynamicMapServiceLayer?(e.layerDefinitions||[])[parseInt(this.id)]:null},i.prototype.isVisible=function(){return this.gcxLayer?this.gcxLayer.isVisible():this._visible},i.prototype.areAllAncestorsVisible=function(){for(var e=this.serviceLayerInfo.findLayerById(this.parentLayerId);null!==e&&void 0!==e;){if(!e.isVisible())return!1;e=this.serviceLayerInfo.findLayerById(e.parentLayerId)}return!0},i.prototype.setVisibility=function(e,t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=150);var n=!1;i&&this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer&&(n=this.serviceLayerInfo.supportsLayerVisibility()),this.gcxLayer?this.gcxLayer.setVisibility(e,t||n):this.setEsriLayerVisibility(e,t||n),n&&this.serviceLayerInfo.refresh(r)},i.prototype.setEsriLayerVisibility=function(t,i){if(void 0===i&&(i=!1),this._visible=t,t||this.serviceLayerInfo.serviceLayer.visible){var r,n,a={mapServiceId:this.serviceLayerInfo.id,layerId:this.id,visibility:t},s=this.serviceLayerInfo.serviceLayer;switch(this.serviceLayerInfo.serviceType){case e.essentials.MapServiceType.DYNAMIC:if(s instanceof esri.layers.FeatureLayer)t?s.show():s.hide(),dojo.publish("LayerVisibilityChange",[new Array(a)]);else{var o=this.serviceLayerInfo.serviceLayer.visibleLayers.slice(0);if(o&&o.length||s.layerInfos&&s.layerInfos.length){1===o.length&&-1==o[0]&&o.pop();var l=o.indexOf(parseInt(this.id));if(t){if(-1!==l)return;if(this.subLayerIds&&this.subLayerIds.length)return;o.push(parseInt(this.id))}else{if(-1===l)return;o.splice(l,1)}o.length||o.push(-1),o.InternallyChangedLayer=a,this.serviceLayerInfo.serviceLayer.setVisibleLayers(o,i)}else s.setVisibility(t),dojo.publish("LayerVisibilityChange",[new Array(a)])}break;case e.essentials.MapServiceType.WMS:if(null!==s){var c=[];for(c.InternallyChangedLayer=a,r=0,n=0;n<this.serviceLayerInfo.layers.length;n++){var u=this.serviceLayerInfo.layers[n];if(u.isVisible()&&(null===u.subLayerIds||0===u.subLayerIds.length)&&u.areAllAncestorsVisible()){var p=u.gcxLayer?u.gcxLayer.wmsLayerName:u.serviceLayerInfo.serviceLayer.id;(this.gcxLayer&&this.gcxLayer.wmsLayerName===p||this.serviceLayerInfo.serviceLayer.id===p||null!==p&&""!==p)&&(c[r]=p,r++)}}i?(this.serviceLayerInfo.serviceLayer.visibleLayers=c.slice(0),dojo.publish("LayerVisibilityChange",[new Array(a)])):this.serviceLayerInfo.serviceLayer.setVisibleLayers(c)}break;case e.essentials.MapServiceType.FEATURE:case e.essentials.MapServiceType.GEORSS:case e.essentials.MapServiceType.KML:case e.essentials.MapServiceType.BING:case e.essentials.MapServiceType.TILED:case e.essentials.MapServiceType.WMTS:case e.essentials.MapServiceType.IMAGE:case e.essentials.MapServiceType.WEBTILED:if(null!==s){if(1!==this.serviceLayerInfo.layers.length)throw new Error("Visibility of individual layers cannot be set for this Map Service: {0}".format(this.displayName));t?s.show():s.hide(),dojo.publish("LayerVisibilityChange",[new Array(a)])}break;default:throw new Error("Cannot set layer visibility. Unknown MapService type.")}}},i.prototype.getMinScale=function(){var e;return e=this.gcxLayer?this.gcxLayer.minScale:this._featureLayer?this._featureLayer.minScale:this.esriLayerInfo.minScale,this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer.minScale?Math.min(e,this.serviceLayerInfo.serviceLayer.minScale):e},i.prototype.getMaxScale=function(){var e;return e=this.gcxLayer?this.gcxLayer.maxScale:this._featureLayer?this._featureLayer.maxScale:this.esriLayerInfo.maxScale,this.serviceLayerInfo&&this.serviceLayerInfo.serviceLayer.maxScale?Math.max(e,this.serviceLayerInfo.serviceLayer.maxScale):e},i}();t.LayerInfo=i}(t.gis||(t.gis={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(){this.serviceLayers=[],this.markupLayer=new Observable}return t.fromEsriMap=function(i){var r=new t;r.map=i,r.markupLayer.set(i.graphics);for(var n=i.layerIds.concat(i.graphicsLayerIds),a=0;a<n.length;a++){var s=i.getLayer(n[a]),o=e.ServiceLayerInfo.fromEsriLayer(s);r.serviceLayers.push(o)}return r},t.fromViewerApp=function(e){var i=t.fromEssentialsMap(e.site.essentialsMap);return i.markupLayer.sync(e.markupLayer),i},t.fromEssentialsMap=function(i){var r=new t;r.gcxMap=i,r.map=i.getMap(),r.markupLayer.set(i.getMap().graphics);for(var n=0;n<i.mapServices.length;n++){var a=i.mapServices[n],s=e.ServiceLayerInfo.fromGcxMapService(a);r.serviceLayers.push(s)}return r},t.prototype.getLayerInfos=function(){for(var e=new Array,t=0;t<this.serviceLayers.length;t++)for(var i=this.serviceLayers[t].layers,r=0;r<i.length;r++)e.push(i[r]);return e},t.prototype.getTableInfos=function(){for(var e=new Array,t=0;t<this.serviceLayers.length;t++)for(var i=this.serviceLayers[t].tables,r=0;r<i.length;r++)e.push(i[r]);return e},t.prototype.getGraphicsLayers=function(){var e=new Array;e.push(this.map.graphics);for(var t=0;t<this.map.graphicsLayerIds.length;t++)e.push(this.map.getLayer(this.map.graphicsLayerIds[t]));return e},t.prototype.findMapServiceById=function(e){for(var t,i=null,r=0,n=this.serviceLayers.length;r<n;r++){var a=this.serviceLayers[r];if(null==i&&(i=!(!a||!a.gcxMapService)),(t=i?a.gcxMapService:a.serviceLayer)&&t.id===e)return a}return null},t}();e.MapInfo=t}(e.gis||(e.gis={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(){}return e.create=function(t){var i=new e;return i.domain=t,i},e.prototype.isCodedValueDomain=function(){return this.domain&&"codedValue"==this.domain.type},e.prototype.getCodedValueDomain=function(){return this.domain},e.prototype.getName=function(e){if(this.isCodedValueDomain())for(var t=0;t<this.getCodedValueDomain().codedValues.length;t++){var i=this.getCodedValueDomain().codedValues[t];if(i.code+""==e+"")return i.name}return null},e}();e.DomainInfo=t}(e.gis||(e.gis={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.app=e,this.libraryId=t}return e.prototype.initialize=function(e){},e.prototype.search=function(e,t){},e.prototype.cancelSearch=function(){},e.prototype.getResource=function(e,t){return this.app.getResource(this.libraryId,e,t)},e}();e.IdentifyProviderBase=t}(e.identify||(e.identify={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(i){function r(e,r,n){i.call(this,e,t.LayerListItemType.FOLDER,n),this.layerThemeSettings=[],this.containedMapServices=[],this.configuredVisible=!1,this.isUserCreated=!1,this._layerVisibilityHandle=null,this.name=new Observable(r||this.layerList.appInfo.gcxApp.getResource(this.layerList._libraryId,"language-layerlist-default-folder-title")),this._setTooltips(),n._addedFolderReferences.push(this)}return __extends(r,i),r.prototype.setVisibility=function(e){i.prototype.setVisibility.call(this,e),void 0==this._deferredVisibilitySetting&&(this.currentUserClickOriginator=!1,this.mapService&&this.mapService.setVisibility(e&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.mapService.isUserCreated)))},r.prototype.refreshOnDemandItemCollection=function(e){i.prototype.refreshOnDemandItemCollection.call(this,e),this.displayItem.set(!!this.children.length())},r.prototype.linkWithMapService=function(e){var t=this;e&&(this.mapService=e,this.layerList._handledMapServiceReferences.push(this.mapService),-1===this.layerList._allMapServiceReferences.indexOf(this.mapService)&&this.layerList._allMapServiceReferences.push(this.mapService),this._setupOpacityBindings(),this._layerVisibilityHandle=this.mapService.serviceLayer.on("visibility-change",function(e){if(void 0!=t._deferredVisibilitySetting||t.isEffectivelyVisible.get()!==e.visible||t.isEffectivelyVisible.get()&&!t.inActiveTheme.get()&&!t.mapService.isUserCreated){var i=e.visible&&(t.inActiveTheme.get()||t.mapService.isUserCreated);t.isVisible.set(i)}}))},r.prototype._setupOpacityBindings=function(){var e=this;if(1===this.containedMapServices.length)i.prototype._setupOpacityBindings.call(this);else if(this.containedMapServices.length>1){var t=dojo.filter(this.containedMapServices,function(e){return e.serviceLayer&&e.serviceLayer.setOpacity});Math.max.apply(null,t.map(function(e){return e.serviceLayer.opacity}));this.canAdjustOpacity.set(!0),this.opacity=new Observable(1),this.opacity.bind(this,function(t){for(var i=0;i<e.containedMapServices.length;i++)e.containedMapServices[i].gcxMapService&&e.containedMapServices[i].gcxMapService.setOpacityFilter(t)})}},r.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(this._layerVisibilityHandle.remove(),this._layerVisibilityHandle=null)},r.prototype._handleLayerThemeChangingEvent=function(e){e.currTheme&&(this.isUserCreated||this.isVisible.get()||this.isVisible.set(!0))},r.prototype._handleLayerThemeChangedEvent=function(e){var t=this;if(e.currTheme){var i=e.currTheme,r=function(){t._refreshMutuallyExclusiveItemVisibilities()};if(this.isUserCreated)return this._setInActiveThemeIfChildrenPresent(),void r();if(i.isDefaultTheme)return this.isVisible.get()!==this.configuredVisible&&this.isVisible.set(this.configuredVisible),this._setInActiveThemeIfChildrenPresent(),void r();if(this.layerThemeSettings.length)for(var n=0;n<this.layerThemeSettings.length;n++){var a=this.layerThemeSettings[n];if(i.id===a.theme.id){var s=void 0==a.visible?this.configuredVisible:a.visible;return this.isVisible.get()!==s&&this.isVisible.set(s),this._setInActiveThemeIfChildrenPresent(),void r()}}this.isVisible.set(!1),this.inActiveTheme.set(!1),r()}},r.prototype._refreshMutuallyExclusiveItemVisibilities=function(){this.children.get().forEach(function(e){e.isMutuallyExclusive.get()&&e.isVisible.get()&&e.isVisible.pulse()})},r.prototype._setInActiveThemeIfChildrenPresent=function(){var e=this._recursivelyConfirmChildrenInActiveTheme(this.children.get());!e&&this.inActiveTheme.get()&&this.inActiveTheme.set(!1),e&&!this.inActiveTheme.get()&&this.inActiveTheme.set(!0)},r.prototype._recursivelyConfirmChildrenInActiveTheme=function(t){for(var i=this,r=0;r<t.length;r++)if(function(t){return t.type===e.layerList.LayerListItemType.FOLDER?!(!t.children||!t.children.length())&&i._recursivelyConfirmChildrenInActiveTheme(t.children.get()):t.inActiveTheme.get()}(t[r]))return!0;return!1},r}(t.LayerListItem);t.LayerListFolderItem=i}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(i){function r(r,n,a,s){if(i.call(this,r,s||t.LayerListItemType.LAYER,a),this._themeSyncHandle=null,this._layerVisibilityHandle=null,this._zoomEndHandle=null,this._deferRefreshTimeoutMs=200,this._forceSetAncestorVisibilityOperationActive=!1,!n)throw new Error("LayerListLayerItem Initialization failed. Layer cannot be null");if(this.isUserCreated=n.isUserCreated,this.layer=n,this._updateVisibilityAtCurrentScale(),this._zoomEndHandle=this.layerList.appInfo.mapInfo.map.on("zoom-end",dojo.hitch(this,this._updateVisibilityAtCurrentScale)),this.type===e.layerList.LayerListItemType.LAYER){var o=!n.gcxLayer||(n.gcxLayer.isVisible()||n.gcxLayer.configuredVisible);this.canNotAssignVisibility.set(!this.layer.serviceLayerInfo.supportsLayerVisibility()),this._deferredVisibilitySetting=o,this.isVisible.set(o)}this.name.set(n.displayName||n.name),this._setTooltips(),this.mapService=n.serviceLayerInfo,-1===a._allMapServiceReferences.indexOf(this.mapService)&&a._allMapServiceReferences.push(this.mapService),this.enableLayerActions=!0,this._subscribeEvents(),this._setupGcxBindingsIfAvailable()}return __extends(r,i),r.prototype.setVisibility=function(e,t){if(i.prototype.setVisibility.call(this,e),this._forceSetAncestorVisibilityOperationActive=this._forceSetAncestorVisibilityOperationActive||t,!(this.canNotAssignVisibility&&this.canNotAssignVisibility.get()||void 0===this.allAncestorsVisible||void 0!=this._deferredVisibilitySetting)){if((this._forceSetAncestorVisibilityOperationActive||this.layerList.autoActivateAncestorVisibilities&&this.currentUserClickOriginator)&&!0===e&&!this.allAncestorsVisible){this.isVisible.get()!==e&&this.isVisible.set(e);for(var r=this.parent;r&&r.id!==this.layerList.id&&r.isVisible.get();)r=r.parent;if(r&&r.id!==this.layerList.id)return void r.isVisible.set(!0)}var n=!this.currentUserClickOriginator&&this.mapService.supportsLayerVisibility();this.currentUserClickOriginator=!1,this._forceSetAncestorVisibilityOperationActive=!1;var a=e&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.layer.isUserCreated);this.layer.isVisible()!==a&&this.layer.setVisibility(a,!1,n,this._deferRefreshTimeoutMs)}},r.prototype.updateLegendItems=function(){var t=this;e.legend.LegendItemProviderFactory.getLegendItemWhenAvailable(this.layer,dojo.hitch(this,function(e){t.legendItems.clear(),t._populateLegendItem(e)}))},r.prototype.bindToActiveTheme=function(){var e=this;i.prototype.bindToActiveTheme.call(this),this._themeSyncHandle=dojo.subscribe("LayerInActiveThemeChangedEvent",function(t){t&&t===e.layer.gcxLayer&&e.inActiveTheme.set(t.inActiveTheme)})},r.prototype.unbindFromActiveTheme=function(){i.prototype.unbindFromActiveTheme.call(this),this._themeSyncHandle&&dojo.unsubscribe(this._themeSyncHandle),this._themeSyncHandle=null},r.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(dojo.unsubscribe(this._layerVisibilityHandle),this._layerVisibilityHandle=null),this._zoomEndHandle&&(this._zoomEndHandle.remove(),this._zoomEndHandle=null)},r.prototype._subscribeEvents=function(){this._layerVisibilityHandle=dojo.subscribe("LayerVisibilityChange",dojo.hitch(this,this._handleLayerVisibilityChange))},r.prototype._onServiceLayerProcessed=function(){this._setupIconUri(),this.layerList.enableLegendIntegration&&!this.layer.serviceLayerInfo.serviceLayer.loadError&&e.legend.LegendItemProviderFactory.getLegendItemWhenAvailable(this.layer,dojo.hitch(this,this._populateLegendItem))},r.prototype._handleLayerVisibilityChange=function(e){if(e&&e.length&&e[0].mapServiceId===this.layer.serviceLayerInfo.id)for(var t=0;t<e.length;t++)if(e[t].layerId===this.layer.id){if(void 0==this._deferredVisibilitySetting&&this.isEffectivelyVisible.get()===e[t].visibility&&(!this.isEffectivelyVisible.get()||this.inActiveTheme.get()||this.layer.isUserCreated))break;var i=e[t].visibility&&(this.inActiveTheme.get()||this.layer.isUserCreated);this.isVisible.set(i);break}},r.prototype._populateLegendItem=function(e){"single-item"===e.templateType?(this.expandLegend.set(!1),this.legendItems.addItem(e),this.legendSwatch.set(e.swatchElement)):(this.legendItems.addItems(e.children.get()),1===this.legendItems.length()?this.legendSwatch.set(this.legendItems.getAt(0).swatchElement):this.legendItems.length()&&this.legendSwatch.set(this.layerList.multiLegendSwatchElement||this.legendItems.getAt(0).swatchElement)),this.legendItems.length()>1?this.legendHasMultipleItems.set(!0):this.legendHasMultipleItems.set(!1),this.legendItems.length()&&(this.iconUri.set(""),this.legendTooltip.set(1===this.legendItems.length()?this.layerList.singleLegendIconTooltip.format(this.name.get()):this.layerList.multiLegendIconTooltip),this.legendTooltip.set(this.legendTooltip.get().format(this.name.get())))},r.prototype._setupIconUri=function(){var e=this.layer.gcxLayer,i=e?e.mapService:null;this.layer.serviceLayerInfo.serviceLayer.loadError&&this.layerList.serviceLoadFailureIconUri?(this.iconUri.set(this.layerList.serviceLoadFailureIconUri),this.iconTooltip.set(this.layerList.serviceLoadFailureIconTooltip?this.layerList.serviceLoadFailureIconTooltip:"")):this.layerList&&this.layerList.enableLayerIcons&&(e&&e.iconUri||i&&this.type===t.LayerListItemType.GRAPHICSLAYER&&i.iconUri)&&(this.iconUri.set(e.iconUri||i.iconUri),this.iconTooltip.set(this.name.get()))},r.prototype._setupGcxBindingsIfAvailable=function(){var e=this;if(this.layer.gcxLayer)if(this.bindToActiveTheme(),this.layer.serviceLayerInfo.serviceLayer.loaded||this.layer.serviceLayerInfo.serviceLayer.loadError)this._onServiceLayerProcessed();else{var t=null,i=null,r=function(){t&&dojo.disconnect(t),i&&dojo.disconnect(i),t=i=null};t=dojo.connect(this.mapService.serviceLayer,"onLoad",function(){r(),e._onServiceLayerProcessed()}),i=dojo.connect(this.mapService.serviceLayer,"onError",function(){r(),e._onServiceLayerProcessed()})}},r.prototype._updateVisibilityAtCurrentScale=function(){var e=!1,t=esri.geometry.getScale(this.layerList.appInfo.mapInfo.map);(0==this.layer.getMaxScale()&&this.layer.getMinScale()==1/0||isNaN(this.layer.getMaxScale())&&isNaN(this.layer.getMinScale()))&&(e=!0),this.inVisibleScaleRange.set(e||this.layer.getMaxScale()<t&&t<this.layer.getMinScale())},r}(t.LayerListItem);t.LayerListLayerItem=i}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(t){function i(i,r,n){if(t.call(this,i,r,n,e.LayerListItemType.GRAPHICSLAYER),!r)throw new Error("LayerListGraphicsLayerItem Initialization failed. Layer cannot be null.");var a=r.gcxLayer?r.gcxLayer.isVisible()||r.gcxLayer.configuredVisible:r.serviceLayerInfo.serviceLayer.defaultVisibility||r.isVisible();this.canNotAssignVisibility.set(!1),this._deferredVisibilitySetting=a,this.isVisible.set(a)}return __extends(i,t),i}(e.LayerListLayerItem);e.LayerListGraphicsLayerItem=t}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(t){var i=function(i){function r(e,t){void 0===t&&(t=[]),i.call(this,t||[]),this._parent=e}return __extends(r,i),r.prototype.addItem=function(e){if(!e)throw new Error("Layer list item not defined. Cannot insert in collection.");this._prepItemForAddition(e),i.prototype.addItem.call(this,e),this._processItemPostAddition(e)},r.prototype.validateAndAddItem=function(e){return!!e&&(this._validateCanAdd(e)?(this.addItem(e),!0):(console.error("LayerListItemCollection: Cannot add item with id: {0} in collection. Validation failed.".format(e.id.get())),!1))},r.prototype.addItems=function(e){if(!e)throw new Error("Layer list items are not defined. Cannot insert in collection.");this._prepItemsForAddition(e),i.prototype.addItems.call(this,e),this._processItemsPostAddition(e)},r.prototype.validateAndAddItems=function(e){if(!e||!e.length)return!1;for(var t=0;t<e.length;t++)if(!this._validateCanAdd(e[t]))return console.error("LayerListItemCollection: Cannot add items in collection. Validation failed."),!1;return this.addItems(e),!0},r.prototype.insertItem=function(e,t){if(!t)throw new Error("Layer list item not defined. Cannot insert at index "+e+" in collection.");this._prepItemForAddition(t),i.prototype.insertItem.call(this,e,t),this._processItemPostAddition(t)},r.prototype.insertItems=function(e,t){if(!t)throw new Error("Layer list items are not defined. Cannot insert at index "+e+" in collection.");this._prepItemsForAddition(t),i.prototype.insertItems.call(this,e,t),this._processItemsPostAddition(t)},r.prototype.validateAndInsertItem=function(e,t){return this._validateCanAdd(t)?(this.insertItem(e,t),!0):(console.error("LayerListItemCollection: Could not insert item with id: {0} in collection. Validation failed.".format(t.id.get())),!1)},r.prototype.validateAndInsertItems=function(e,t){if(!t||!t.length)return!1;for(var i=0;i<t.length;i++)if(!this._validateCanAdd(t[i]))return console.error("Could not insert items in collection. Validation failed."),!1;return this.insertItems(e,t),!0},r.prototype.removeItem=function(e){if(!e)throw new Error("LayerListItemCollection: Cannot remove item at index from collection.");this._prepItemForRemoval(e),i.prototype.removeItem.call(this,e)},r.prototype.removeAt=function(e){var t=this.getAt(e);if(!t)throw new Error("LayerListItemCollection: Cannot remove item at index "+e+" from collection.");this._prepItemForRemoval(t),i.prototype.removeAt.call(this,e)},r.prototype.removeRange=function(e,t){e=void 0!=e?Math.max(0,e):0,t=void 0!=t?Math.min(t,this.getLength()-1):this.getLength()-1,this._prepItemsForRemoval(this.get().slice(e,t+1)),i.prototype.removeRange.call(this,e,t)},r.prototype.clear=function(){this._prepItemsForRemoval(this.get()),i.prototype.clear.call(this)},r.prototype._prepItemForAddition=function(e){var t=this;this._parent&&(e.parent=this._parent,e.parentEffectivelyVisible.sync(e.parent.isEffectivelyVisible),e.setAncestorVisibility(this._parent.isVisible.get()),e._visibilityBindingToken=this._parent.isVisible.bind(e,function(i){e.setAncestorVisibility(i&&t._parent.allAncestorsVisible)}),this.length()&&this.getAt(0).isMutuallyExclusive.get()&&(e.isMutuallyExclusive.set(!0),e.hasRadioToggle.set(!0),e.radioGroup.set(this.getAt(0).radioGroup.get())),e._displayItemBindingToken=e.displayItem.bind(e,function(e){if(e)t._parent.hasDisplayedChildren.set(!0);else{for(var i=!1,r=0;r<t.length();r++)if(t.getAt(r).displayItem.get()){i=!0;break}t._parent.hasDisplayedChildren.set(i)}}),e.displayItem.pulse())},r.prototype._processItemPostAddition=function(t){t.type!==e.layerList.LayerListItemType.MAPSERVICE&&t.type!==e.layerList.LayerListItemType.LAYER&&t.type!==e.layerList.LayerListItemType.GRAPHICSLAYER||t.populateMapServicesInParentFolders()},r.prototype._prepItemForRemoval=function(e){if(e.parentEffectivelyVisible.removeSync(),e.parent=null,e._visibilityBindingToken&&this._parent&&(this._parent.isVisible.unbind(e._visibilityBindingToken),e._visibilityBindingToken=null),e._displayItemBindingToken&&this._parent&&(e.displayItem.unbind(e._displayItemBindingToken),e._displayItemBindingToken=null,e.displayItem)){for(var t=!1,i=0;i<this.length();i++)if(this.getAt(i)!==e&&this.getAt(i).displayItem.get()){t=!0;break}this._parent.hasDisplayedChildren.set(t)}e.cleanUp()},r.prototype._prepItemsForAddition=function(e){var t=this;dojo.forEach(e,function(e){t._prepItemForAddition(e)})},r.prototype._processItemsPostAddition=function(e){var t=this;dojo.forEach(e,function(e){t._processItemPostAddition(e)})},r.prototype._prepItemsForRemoval=function(e){var t=this;dojo.forEach(e,function(e){t._prepItemForRemoval(e)})},r.prototype._validateCanAdd=function(e){var i=this,r=(this.layerList||this._parent.layerList).getDescendants();if(r.filter(function(t){return t===e}).length)return!1;if(e.type===t.LayerListItemType.FOLDER)return e.children.getItems().every(function(e){return i._validateCanAdd(e)});if(e.type===t.LayerListItemType.MAPSERVICE)return!!e.mapService&&!r.some(function(t){return t.mapService&&(t.mapService===e.mapService||t.mapService.serviceLayer===e.mapService.serviceLayer)});if(e.type===t.LayerListItemType.LAYER){var n=e;return!!n.layer&&!r.some(function(e){return e.layer&&e.layer===n.layer})}return!0},r}(ObservableCollection);t.LayerListItemCollection=i}(e.layerList||(e.layerList={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(i){var r=function(r){function n(e,t,n){var a=this;if(r.call(this,e,i.LayerListItemType.MAPSERVICE,n),this._themeSyncHandle=null,this._layerVisibilityHandle=null,this._forceSetAncestorVisibilityOperationActive=!1,!t)throw new Error("LayerListMapServiceItem Initialization failed. MapService cannot be null");var s;s=this.layerList&&this.layerList.mapInfo&&this.layerList.mapInfo.gcxMap&&this.layerList.mapInfo.gcxMap.layerThemesInfo&&this.layerList.mapInfo.gcxMap.layerThemesInfo.layerThemesConfigured?!t.gcxMapService||!t.gcxMapService.serviceLayer||t.gcxMapService.serviceLayer.visible:!t.gcxMapService||t.gcxMapService.configuredVisible,this.name.set(t.displayName?t.displayName:""),this._setTooltips(),this.mapService=t,n._handledMapServiceReferences.push(t),-1===n._allMapServiceReferences.indexOf(t)&&n._allMapServiceReferences.push(t),this._deferredVisibilitySetting=s,this.isVisible.set(s);this.mapService.serviceType;if(this.isUserCreated=t.isUserCreated,this.enableMapServiceActions=t.isUserCreated,this._setupOpacityBindings(),this._subscribeEvents(),this._setupBindings(),t.serviceLayer instanceof esri.layers.KMLLayer){var o=t.serviceLayer;o.loaded?this._kmlLayerLoadHandler(o):o.on("load",function(e){return a._kmlLayerLoadHandler(e.layer)})}}return __extends(n,r),n.prototype.setVisibility=function(e,t){if(r.prototype.setVisibility.call(this,e),this._forceSetAncestorVisibilityOperationActive=this._forceSetAncestorVisibilityOperationActive||t,this._syncChildVisibilitiesIfApplicable(e),void 0!==this.allAncestorsVisible&&void 0==this._deferredVisibilitySetting){if((this._forceSetAncestorVisibilityOperationActive||this.layerList.autoActivateAncestorVisibilities&&this.currentUserClickOriginator)&&!0===e&&!this.allAncestorsVisible){this.isVisible.get()!==e&&this.isVisible.set(e);for(var i=this.parent;i&&i.id!==this.layerList.id&&i.isVisible.get();)i=i.parent;if(i&&i.id!==this.layerList.id)return void i.isVisible.set(!0)}this.currentUserClickOriginator=!1,this._forceSetAncestorVisibilityOperationActive=!1,this.mapService.setVisibility(e&&this.allAncestorsVisible&&(this.inActiveTheme.get()||this.mapService.isUserCreated))}},n.prototype.bindToActiveTheme=function(){var e=this;r.prototype.bindToActiveTheme.call(this),this._themeSyncHandle=dojo.subscribe("MapServiceInActiveThemeChangedEvent",function(t){t&&t===e.mapService.gcxMapService&&e.inActiveTheme.set(t.inActiveTheme)})},n.prototype.unbindFromActiveTheme=function(){r.prototype.unbindFromActiveTheme.call(this),this._themeSyncHandle&&dojo.unsubscribe(this._themeSyncHandle),this._themeSyncHandle=null},n.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this._layerVisibilityHandle&&(this._layerVisibilityHandle.remove(),this._layerVisibilityHandle=null)},n.prototype._subscribeEvents=function(){var e=this;this._layerVisibilityHandle=this.mapService.serviceLayer.on("visibility-change",function(t){if(void 0!=e._deferredVisibilitySetting||e.isEffectivelyVisible.get()!==t.visible||e.isEffectivelyVisible.get()&&!e.inActiveTheme.get()&&!e.mapService.isUserCreated){var i=t.visible&&(e.inActiveTheme.get()||e.mapService.isUserCreated);e.isVisible.set(i)}})},n.prototype._setupIconUri=function(){this.mapService.serviceLayer.loadError&&this.layerList.serviceLoadFailureIconUri?(this.iconUri.set(this.layerList.serviceLoadFailureIconUri),this.iconTooltip.set(this.layerList.serviceLoadFailureIconTooltip?this.layerList.serviceLoadFailureIconTooltip:"")):this.mapService.gcxMapService&&this.mapService.gcxMapService.iconUri&&(this.iconUri.set(this.mapService.gcxMapService.iconUri),this.iconTooltip.set(this.name.get()))},n.prototype._syncChildVisibilitiesIfApplicable=function(i){var r=this;switch(this.mapService.serviceType){case e.essentials.MapServiceType.BING:case e.essentials.MapServiceType.TILED:case e.essentials.MapServiceType.WMTS:case e.essentials.MapServiceType.IMAGE:case e.essentials.MapServiceType.WEBTILED:this.children.length()>0&&this.getDescendants().forEach(function(e){e.type===t.layerList.LayerListItemType.LAYER&&e.mapService.id===r.mapService.id&&e.isVisible.get()!==i&&e.isVisible.set(i)});break;default:return}},n.prototype._setupBindings=function(){var e=this;if(this.mapService.gcxMapService&&this.bindToActiveTheme(),this.mapService.serviceLayer.loaded||this.mapService.serviceLayer.loadError)this._setupIconUri();else{var t=null,i=null,r=function(){t&&dojo.disconnect(t),i&&dojo.disconnect(i),t=i=null};t=dojo.connect(this.mapService.serviceLayer,"onLoad",function(){r(),e._setupIconUri()}),i=dojo.connect(this.mapService.serviceLayer,"onError",function(){r(),e._setupIconUri()})}if(!this.mapService.serviceLayer.loaded&&!this.mapService.serviceLayer.loadError)var n=this.mapService.serviceLayer.on("load",function(){e._updateVisibilityAtCurrentScale(),n.remove()});if(!this.mapService.serviceLayer.getMap())var a=this.layerList.appInfo.map.on("layer-add",function(t){t.layer===e.mapService.serviceLayer&&(e._updateVisibilityAtCurrentScale(),a.remove())});this._updateVisibilityAtCurrentScale(),this.mapService.serviceLayer.on("scale-visibility-change",function(){return e._updateVisibilityAtCurrentScale()})},n.prototype._kmlLayerLoadHandler=function(e){e.folders&&e.folders.length>1&&(this._createKmlFolders(this,e.folders[1],e),this.refreshOnDemandItemCollection())},n.prototype._createKmlFolders=function(e,i,r){for(var n=r.folders,a=0;a<i.subFolderIds.length;a++){for(var s=i.subFolderIds[a],o=null,l=0;l<n.length;l++)if(n[l].id===s){o=n[l];break}if(!o)throw new Error("Could not find KML folder with ID '{0}'.".format(s));var c=new t.layerList.LayerListKmlFolderItem(this.mapService.id+s,this.layerList,r,o);this._createKmlFolders(c,o,r),e.children.addItem(c)}},n.prototype._updateVisibilityAtCurrentScale=function(){this.mapService.serviceLayer.loaded&&this.mapService.serviceLayer.getMap()&&this.inVisibleScaleRange.set(this.mapService.serviceLayer.visibleAtMapScale)},n.prototype._setTooltips=function(){r.prototype._setTooltips.call(this);var e=this.layerList.appInfo.gcxApp;if(e){var t=e.getResource(this.layerList._libraryId,"language-mapservice-actions-tooltip").format(this.name.get());this.mapServiceActionsTooltip.set(t)}},n}(i.LayerListItem);i.LayerListMapServiceItem=r}(t.layerList||(t.layerList={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){!function(t){t.getServiceLayerType=function(t){return t instanceof esri.layers.DynamicMapServiceLayer?t instanceof esri.layers.ArcGISDynamicMapServiceLayer?e.essentials.MapServiceType.DYNAMIC:t instanceof esri.layers.ArcGISImageServiceLayer?e.essentials.MapServiceType.IMAGE:t instanceof esri.layers.WMSLayer?e.essentials.MapServiceType.WMS:e.essentials.MapServiceType.DYNAMIC:t instanceof esri.layers.TiledMapServiceLayer?t instanceof esri.layers.WMTSLayer?e.essentials.MapServiceType.WMTS:t instanceof esri.layers.WebTiledLayer?e.essentials.MapServiceType.WEBTILED:t instanceof esri.virtualearth.VETiledLayer?e.essentials.MapServiceType.BING:e.essentials.MapServiceType.TILED:t instanceof esri.layers.GraphicsLayer?t instanceof esri.layers.FeatureLayer?esri.layers.StreamLayer&&t instanceof esri.layers.StreamLayer?e.essentials.MapServiceType.STREAM:t instanceof esri.layers.CSVLayer?e.essentials.MapServiceType.CSV:e.essentials.MapServiceType.FEATURE:esri.layers.LabelLayer&&t instanceof esri.layers.LabelLayer?e.essentials.MapServiceType.LABEL:e.essentials.MapServiceType.GRAPHICS:t instanceof esri.layers.GeoRSSLayer?e.essentials.MapServiceType.GEORSS:t instanceof esri.layers.KMLLayer?e.essentials.MapServiceType.KML:t instanceof esri.layers.MapImageLayer?e.essentials.MapServiceType.MAPIMAGE:e.essentials.MapServiceType.UNKNOWN}}(t.GisUtils||(t.GisUtils={}))}(t.gis||(t.gis={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t={r:204,g:51,b:51,a:1};e.defaultSymbolColor=function(e){e||(e={});var i={a:e.a?e.a:t.a,r:e.r?e.r:t.r,g:e.g?e.g:t.g,b:e.b?e.b:t.b};return new dojo.Color(i)},e.defaultMarkerSymbol=function(){return new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,14,null,this.defaultSymbolColor())},e.defaultLineSymbol=function(){return new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,this.defaultSymbolColor({a:.8}),2)},e.defaultFillSymbol=function(){return new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,this.defaultLineSymbol(),this.defaultSymbolColor({a:.5}))},e.defaultTextSymbol=function(){var e=new esri.symbol.TextSymbol(""),t=new esri.symbol.Font;return t.setSize("14pt"),t.setFamily("Arial"),e.setFont(t),e.setAlign(esri.symbol.TextSymbol.ALIGN_START),e}}(e.SymbolUtils||(e.SymbolUtils={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,i){if(this._canExecuteChangedBindingTokens=[],this._contextPropertyBindingTokens={},!e.MenuViewModel||!i)throw new Error("MenuViewModel: Could not create menu view model. Input arguments cannot be undefined.");this.menuViewModel=t,this.menuItem=i,this.app=i.app,this.text=new Observable(i.text),this.description=new Observable(i.description),this.canExecute=new Observable(this.computeCanExecute()),this.iconUri=new Observable(i.iconUri),this._setupBindings()}return t.prototype.execute=function(){var e=this;this.computeCanExecute()&&(this.menuItem.command?this.menuItem.command.execute(t._computeCommandParameter(this,this.menuItem.commandParameter)):this.menuItem.batchItems.forEach(function(i){return i.command.execute(t._computeCommandParameter(e,i.commandParameter))}))},t.prototype.computeCanExecute=function(){if(this.menuItem.batchItems&&this.menuItem.batchItems.length){for(var e=!!this.menuItem.batchItems.length,i=0;i<this.menuItem.batchItems.length;i++){var r=this.menuItem.batchItems[i];e&&r.abortBatchOnFailure&&(e=r.command&&r.command.canExecute(t._computeCommandParameter(this,r.commandParameter)))}return e}return this.menuItem.command&&this.menuItem.command.canExecute(t._computeCommandParameter(this,this.menuItem.commandParameter))},t.prototype.refreshCanExecute=function(){var e=this.computeCanExecute();this.canExecute.get()!==e&&this.canExecute.set(e)},t.prototype.destroy=function(){for(var e=this._canExecuteChangedBindingTokens.length-1;e>=0;e--){var t=this._canExecuteChangedBindingTokens[e];t.canExecuteEvent.unsubscribe(t.token),this._canExecuteChangedBindingTokens.pop()}for(var i in this._contextPropertyBindingTokens)if(this._contextPropertyBindingTokens.hasOwnProperty(i)){var r=this.menuViewModel.menuContext.get();r[i]&&r[i].unbind(this._contextPropertyBindingTokens[i])}this._contextPropertyBindingTokens=null,this._canExecuteChangedBindingTokens=null},t.prototype._setupBindings=function(){var e=this,t=function(t){t&&e._canExecuteChangedBindingTokens.push({canExecuteEvent:t.canExecuteChanged,token:t.canExecuteChanged.subscribe(e,e.refreshCanExecute)})};this.menuItem.batchItems&&this.menuItem.batchItems.length?this.menuItem.batchItems.forEach(function(e){t(e.command)}):t(this.menuItem.command)},t._computeCommandParameter=function(t,i){var r=t.menuViewModel.menuContext.get(),n=function(i){var n=i.trim();return 0===n.indexOf("{{")&&n.indexOf("}}")>0?(n=n.replace("{{","").replace("}}","")).toLowerCase()===e.MenuViewModel.DefaultParameterName.toLowerCase()?r:r&&void 0!==r[n]?(r[n].isObservable&&(t._contextPropertyBindingTokens[n]&&r[n].unbind(t._contextPropertyBindingTokens[n]),t._contextPropertyBindingTokens[n]=r[n].once(t,t.refreshCanExecute)),r[n]):(t.app.trace.warning("Could not find menu item '{0}'.".format(n)),null):n};if(null===i||void 0===i)return r;if("string"==typeof i)return n(i);if(r&&i&&"object"==typeof i){var a={};for(var s in i)if(i.hasOwnProperty(s)){var o=i[s];a[s]="string"==typeof o?n(o):o}return a}return i},t}();e.MenuItemViewModel=t}(e.menus||(e.menus={}))}(e.infrastructure||(e.infrastructure={}))}(e.mapping||(e.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var geocortex;!function(e){!function(t){!function(t){!function(t){!function(t){var i=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.attach=function(i){var r=this.configuration.libraryId||i.libraryId||this.libraryId;if(i instanceof t.MenuViewModel==!1){var n=new t.MenuViewModel(this.app,r);n.menuContext.set(i),i=n}this.viewModel=i,this.viewModel&&!this.viewModel.menuId&&(this.viewModel.menuId=this.configuration&&this.configuration.menuId||null),this.viewModel.setupMenu(),this.viewModel&&this.viewModel.menuId?(this.title.set(this.getResource("language-menu-default-title")),e.prototype.attach.call(this,i)):this.app.trace.warning("Could not set up menu view '{0}'. View model or 'menuId' option not found.".format(this.id))},i.prototype.handleMenuItemClick=function(e,t,i){i&&(this.app.event("MenuItemInvokedEvent").publish({menuView:this,menuId:this.viewModel.menuId,menuItem:i}),i.execute())},i.prototype.getDescription=function(e,t,i){i.description&&(t.title=i.description.get())},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.app.menuRegistry.destroyMenuWidget(this)},i}(e.framework.ui.ViewBase);t.MenuView=i}(t.menus||(t.menus={}))}(t.infrastructure||(t.infrastructure={}))}(t.mapping||(t.mapping={}))}(e.essentialsHtmlViewer||(e.essentialsHtmlViewer={}))}(geocortex||(geocortex={}));var Feature=null,FeatureSet=null,FeatureSetCollection=null;dojo.ready(function(){FeatureAttribute=dojo.getObject("geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureAttribute"),Feature=dojo.getObject("geocortex.essentialsHtmlViewer.mapping.infrastructure.Feature"),FeatureSet=dojo.getObject("geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureSet"),FeatureSetCollection=dojo.getObject("geocortex.essentialsHtmlViewer.mapping.infrastructure.FeatureSetCollection")}),geocortex||(geocortex={}),geocortex.essentialsHtmlViewer||(geocortex.essentialsHtmlViewer={}),geocortex.essentialsHtmlViewer.version="2.8.0.0003",geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/documents/GrantEditorView.html","html","PGRpdiBjbGFzcz0iZ3JhbnQtZWRpdG9yIj4NCiAgICA8ZGl2IGNsYXNzPSJncmFudC1lZGl0b3Itb3B0aW9ucyI+DQogICAgICAgIDxkaXYgY2xhc3M9ImdyYW50LWVkaXRvci1zZWFyY2gtb3B0aW9ucyI+DQogICAgICAgICAgICA8c2VsZWN0IGRhdGEtYmluZGluZz0ie0BlbmFibGVkOiBlbmFibGVkfXtAc291cmNlOiBtb25pa2VyS2luZHN9e0B2YWx1ZTogc2VsZWN0ZWRNb25pa2VyS2luZH0iPg0KICAgICAgICAgICAgICAgIDxvcHRpb24gZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogbW9uaWtlcktpbmRzfXtAdGV4dDogZGlzcGxheU5hbWV9e3ZhbHVlOiBraW5kfSIgLz4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJncmFudC1lZGl0b3Itc2VhcmNoIiB0eXBlPSJ0ZXh0IiBkYXRhLWJpbmRpbmc9IntAZW5hYmxlZDogZW5hYmxlZH17QHZhbHVlOiBzZWFyY2hUZXh0fXtAdmFyOiBhdXRvQ29tcGxldGVJbnB1dH17QGV2ZW50LW9uaW5wdXQ6IGhhbmRsZUlucHV0Q2hhbmdlZH17cGxhY2Vob2xkZXI6IEBsYW5ndWFnZS1ncmFudC1lZGl0b3Itc2VhcmNoLXBsYWNlaG9sZGVyfXt0aXRsZTogQGxhbmd1YWdlLWdyYW50LWVkaXRvci1zZWFyY2gtdGl0bGV9e0BldmVudC1ibHVyOiBoYW5kbGVBdXRvQ29tcGxldGVCbHVyfSIgLz4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tYnRucyI+DQogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidXR0b24gYWRkLWJ1dHRvbiIgZGF0YS1iaW5kaW5nPSJ7QGVuYWJsZWQ6IGlzVmFsaWRNb25pa2VyfXt0aXRsZTogQGxhbmd1YWdlLWdyYW50LWVkaXRvci1hZGQtYnV0dG9uLXRpdGxlfXtAdGV4dDogQGxhbmd1YWdlLWdyYW50LWVkaXRvci1hZGQtYnV0dG9uLXRleHR9e0BldmVudC1vbmNsaWNrOiBoYW5kbGVBZGRNb25pa2VyQnV0dG9uQ2xpY2t9Ij48L2J1dHRvbj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBjbGFzcz0iZ3JhbnQtZWRpdG9yLXRhYmxlIj4NCiAgICAgICAgPHRhYmxlPg0KICAgICAgICAgICAgPHRoZWFkPg0KICAgICAgICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgICAgICAgICAgPHRoPjwvdGg+DQogICAgICAgICAgICAgICAgICAgIDx0aCBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLWdyYW50LWVkaXRvci10YWJsZS1oZWFkZXItbm9uZX0iPjwvdGg+DQogICAgICAgICAgICAgICAgICAgIDx0aCBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLWdyYW50LWVkaXRvci10YWJsZS1oZWFkZXItdmlld30iPjwvdGg+DQogICAgICAgICAgICAgICAgICAgIDx0aCBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLWdyYW50LWVkaXRvci10YWJsZS1oZWFkZXItZWRpdH0iPjwvdGg+DQogICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgIDwvdGhlYWQ+DQogICAgICAgICAgICA8dGJvZHkgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogbW9uaWtlcnN9Ij4NCiAgICAgICAgICAgICAgICA8dHIgZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogbW9uaWtlcnN9e0BjbGFzcy1nbG9iYWwtZ3JhbnQ6IGlzR2xvYmFsfXtAY2xhc3MtZGlzYWJsZWQtZ3JhbnQ6IGlzUmV2b2tlZH0iPg0KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImdyYW50LW5hbWUtY29sdW1uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgZGF0YS1iaW5kaW5nPSJ7c3JjOiBpY29uVXJpfSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJncmFudC1uYW1lLWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogbmFtZX0iPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgPHRkPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBkYXRhLWJpbmRpbmc9IntAZW5hYmxlZDogZW5hYmxlZH17bmFtZTogaWR9e2NoZWNrZWQ6IGlzR2xvYmFsfXtAZXZlbnQtb25jbGljazogaGFuZGxlVXBkYXRlTW9uaWtlcn0iIC8+DQogICAgICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgdmFsdWU9InJlYWRlciIgZGF0YS1iaW5kaW5nPSJ7QGVuYWJsZWQ6IGVuYWJsZWR9e25hbWU6IGlkfXtjaGVja2VkOiBjYW5SZWFkfXtAZXZlbnQtb25jbGljazogaGFuZGxlVXBkYXRlTW9uaWtlcn0iIC8+DQogICAgICAgICAgICAgICAgICAgIDwvdGQ+DQogICAgICAgICAgICAgICAgICAgIDx0ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgdmFsdWU9IndyaXRlciIgZGF0YS1iaW5kaW5nPSJ7QGVuYWJsZWQ6IGVuYWJsZWR9e0BoaWRkZW46IGlzUHVibGljfXtuYW1lOiBpZH17Y2hlY2tlZDogY2FuV3JpdGV9e0BldmVudC1vbmNsaWNrOiBoYW5kbGVVcGRhdGVNb25pa2VyfSIgLz4NCiAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgPC90Ym9keT4NCiAgICAgICAgPC90YWJsZT4NCiAgICA8L2Rpdj4NCjwvZGl2Pg0K"),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/IconMenuView.html","html","PGRpdiBjbGFzcz0ibWVudS1uby1pdGVtcyIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogdmlzaWJsZU1lbnVJdGVtc317QHRleHQ6IEBsYW5ndWFnZS1tZW51LW5vLWl0ZW1zfSI+PCEtLSBObyBJdGVtcy4gLS0+PC9kaXY+DQoNCjxkaXYgY2xhc3M9Imxpc3QtbWVudSBhY3RpdmUgaGFzLWljb24gaWNvbi1tZW51IiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogdmlzaWJsZU1lbnVJdGVtc317QHNvdXJjZTogdmlzaWJsZU1lbnVJdGVtc30iPg0KICAgIDxkaXYgY2xhc3M9Imxpc3QtbWVudS1pdGVtIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiB2aXNpYmxlTWVudUl0ZW1zfXtAZW5hYmxlZDogY2FuRXhlY3V0ZX17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZU1lbnVJdGVtQ2xpY2t9Ij4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibGlzdC1tZW51LWRldGFpbHMiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVNZW51SXRlbUNsaWNrfXt0aXRsZTogZGVzY3JpcHRpb259Ij4NCiAgICAgICAgICAgIDxpbWcgY2xhc3M9Imxpc3QtbWVudS1pY29uIiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogaWNvblVyaX17c3JjOiBpY29uVXJpfSIgYWx0PSIgIiAvPg0KICAgICAgICAgICAgPHN0cm9uZyBjbGFzcz0ibGlzdC1tZW51LW5hbWUiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiB0ZXh0fSI+PC9zdHJvbmc+DQogICAgICAgIDwvYnV0dG9uPg0KICAgIDwvZGl2Pg0KPC9kaXY+DQo="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/MenuHyperlinkView.html","html","PGRpdiBjbGFzcz0ibWVudS1oeXBlcmxpbmtzIj4NCiAgICA8dWwgY2xhc3M9Imxpc3QtbWVudSBhY3RpdmUiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiB2aXNpYmxlTWVudUl0ZW1zfXtAc291cmNlOiB2aXNpYmxlTWVudUl0ZW1zfSI+DQogICAgICAgIDxsaSBjbGFzcz0ibGlzdC1tZW51LWl0ZW0iIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IHZpc2libGVNZW51SXRlbXN9Ij4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Imxpc3QtbWVudS1idXR0b24iIGRhdGEtYmluZGluZz0ie3RpdGxlOiBkZXNjcmlwdGlvbn17QHRleHQ6IHRleHR9e0BldmVudC1vbmNsaWNrOiBoYW5kbGVNZW51SXRlbUNsaWNrfXtAZW5hYmxlZDogY2FuRXhlY3V0ZX0iPjwvYnV0dG9uPg0KICAgICAgICA8L2xpPg0KICAgIDwvdWw+DQo8L2Rpdj4NCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/menus/MenuView.html","html","PGRpdiBjbGFzcz0ibWVudS1uby1pdGVtcyIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogdmlzaWJsZU1lbnVJdGVtc317QHRleHQ6IEBsYW5ndWFnZS1tZW51LW5vLWl0ZW1zfSI+PCEtLSBObyBJdGVtcy4gLS0+PC9kaXY+DQoNCjxkaXYgY2xhc3M9Imxpc3QtbWVudSBhY3RpdmUgaGFzLWljb24iIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiB2aXNpYmxlTWVudUl0ZW1zfXtAc291cmNlOiB2aXNpYmxlTWVudUl0ZW1zfSI+DQogICAgPGRpdiBjbGFzcz0ibGlzdC1tZW51LWl0ZW0iIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IHZpc2libGVNZW51SXRlbXN9e0BlbmFibGVkOiBjYW5FeGVjdXRlfXtAZXZlbnQtb25jbGljazogaGFuZGxlTWVudUl0ZW1DbGlja30iPg0KICAgICAgICA8aW1nIGNsYXNzPSJsaXN0LW1lbnUtaWNvbiIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IGljb25Vcml9e3NyYzogaWNvblVyaX17YWx0OiB0ZXh0fSIgLz4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibGlzdC1tZW51LWRldGFpbHMiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVNZW51SXRlbUNsaWNrfXt0aXRsZTogZGVzY3JpcHRpb259Ij4NCiAgICAgICAgICAgIDxzdHJvbmcgY2xhc3M9Imxpc3QtbWVudS1uYW1lIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogdGV4dH0iPjwvc3Ryb25nPg0KICAgICAgICAgICAgPHNwYW4gY2xhc3M9Imxpc3QtbWVudS1kZXNjIiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogZGVzY3JpcHRpb259e0B0ZXh0OiBkZXNjcmlwdGlvbn0iPjwvc3Bhbj4NCiAgICAgICAgPC9idXR0b24+DQogICAgPC9kaXY+DQo8L2Rpdj4NCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/ResultsFeatureActionsView.html","html","PGRpdiBjbGFzcz0ibGlzdC1tZW51IiBkYXRhLWJpbmRpbmc9IntAc291cmNlOiBmZWF0dXJlQWN0aW9uc30iPg0KICAgIDxkaXYgY2xhc3M9Imxpc3QtbWVudS1pdGVtIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBmZWF0dXJlQWN0aW9uc317QGV2ZW50LW9ubW91c2VvdmVyOiBoYW5kbGVHZXREZXNjcmlwdGlvbn17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZU1lbnVJdGVtQ2xpY2t9Ij4NCiAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibGlzdC1tZW51LWRldGFpbHMiPg0KICAgICAgICAgICAgPHN0cm9uZyBjbGFzcz0ibGlzdC1tZW51LW5hbWUiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiB0ZXh0fSI+PC9zdHJvbmc+DQogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibGlzdC1tZW51LWRlc2MiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBkZXNjcmlwdGlvbn0iPjwvc3Bhbj4NCiAgICAgICAgPC9idXR0b24+DQogICAgPC9kaXY+DQo8L2Rpdj4NCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/ResultsListView.html","html","PGRpdiBjbGFzcz0icmVzdWx0cy1saXN0LWFjdGlvbnMtd2lkZ2V0IiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogZmVhdHVyZVNldENvbGxlY3Rpb259e0B3aWRnZXQ6IFJlc3VsdHNMaXN0QWN0aW9uc1dpZGdldH17QHdpZGdldC1jb250ZXh0OiBmZWF0dXJlU2V0Q29sbGVjdGlvbn17QHdpZGdldC1yZXF1aXJlZDogZmFsc2V9IiBkYXRhLW1lbnUtaWQ9IlJlc3VsdHNMaXN0QWN0aW9ucyIgZGF0YS1tZW51LXRlbXBsYXRlPSJNYXBwaW5nL2luZnJhc3RydWN0dXJlL21lbnVzL01lbnVIeXBlcmxpbmtWaWV3Lmh0bWwiPjwvZGl2Pg0KDQo8ZGl2IGNsYXNzPSJyZXN1bHRzIj4NCiAgICA8IS0tIEJFR0lOOiBObyBSZXN1bHRzIC0tPg0KICAgIDxkaXYgY2xhc3M9Im5vLXJlc3VsdHMiIGRhdGEtYmluZGluZz0ie0BoaWRkZW46IGhhc0ZlYXR1cmVTZXRzfXtAdGV4dDogc2VhcmNoU3VnZ2VzdGlvbn0iIHRhYmluZGV4PSIwIj48L2Rpdj4NCiAgICA8IS0tIEVORDogTm8gUmVzdWx0cyAtLT4NCg0KICAgIDwhLS0gQkVHSU46IFJlc3VsdHMgTGlzdCAtLT4NCiAgICA8IS0tIElmIHRoZSBiZWxvdyAncmVzdWx0cy1saXN0JyBkaXYgaXMgdGFiYmFibGUsIHRoZW4gc2hpZnQrdGFiIGdldHMgc3R1Y2sgaW4gRmlyZUZveC4gLS0+DQogICAgPGRpdiBjbGFzcz0icmVzdWx0cy1saXN0IiBkYXRhLWJpbmRpbmc9IntAdmFyOiBzY3JvbGxDb250YWluZXJFbGVtZW50fXtAZXZlbnQtb25zY3JvbGw6IGhhbmRsZVNjcm9sbENoYW5nZX0iIHRhYmluZGV4PSItMSI+DQoNCiAgICAgICAgPGRpdiBjbGFzcz0ibGlzdC1tZW51IGFjdGl2ZSBoYXMtaWNvbiIgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogcmVzdWx0c1BhZ2V9e0B2aXNpYmxlOiByZXN1bHRzUGFnZX17QHZhcjogcmVzdWx0c0xpc3R9Ij4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Imxpc3QtbWVudS1pdGVtIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiByZXN1bHRzUGFnZX17QGV2ZW50LW1vdXNlZG93bjogaGFuZGxlTW91c2VEb3dufXtAZXZlbnQtY2xpY2s6IGhhbmRsZUNsaWNrfXtAZXZlbnQtbW91c2VvdXQ6IGhhbmRsZU1vdXNlT3V0fXtAZXZlbnQtbW91c2V1cDogaGFuZGxlTW91c2VVcH17QGV2ZW50LXRvdWNoc3RhcnQ6IGhhbmRsZVRvdWNoU3RhcnR9e0BldmVudC10b3VjaG1vdmU6IGhhbmRsZVRvdWNoTW92ZX17QGV2ZW50LXRvdWNoY2FuY2VsOiBoYW5kbGVUb3VjaENhbmNlbH17QGV2ZW50LXRvdWNoZW5kOiBoYW5kbGVUb3VjaEVuZH0iIHRhYmluZGV4PSIwIj4NCiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPSJsaXN0LW1lbnUtaWNvbiIgZGF0YS1iaW5kaW5nPSJ7c3JjOiBpY29uVXJpfXthbHQ6IGxhYmVsfXtAdmlzaWJsZTogaWNvblVyaX0iIGFsdD0iICIgYXJpYS1oaWRkZW49InRydWUiIC8+DQogICAgICAgICAgICAgICAgPGltZyBjbGFzcz0ibGlzdC1tZW51LWljb24iIGRhdGEtYmluZGluZz0ie2FsdDogbGFiZWx9e0BoaWRkZW46IGljb25Vcml9IiBzcmM9IlJlc291cmNlcy9JbWFnZXMvSWNvbnMvbWFwLWRlZmF1bHQtMjQucG5nIiBhbHQ9IiAiIGFyaWEtaGlkZGVuPSJ0cnVlIiAvPg0KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJsaXN0LW1lbnUtZGV0YWlscyI+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Imxpc3QtbWVudS1uYW1lIiBkYXRhLWJpbmRpbmc9IntAd2lkZ2V0OiBHZXRMYWJlbH17QHdpZGdldC1jb250ZXh0OiBAY29udGV4dH17QHZpc2libGU6IGxhYmVsfXtAZXZlbnQtbW91c2Vkb3duOiBoYW5kbGVNb3VzZURvd259e0BldmVudC1jbGljazogaGFuZGxlQ2xpY2t9e0BldmVudC1tb3VzZW91dDogaGFuZGxlTW91c2VPdXR9e0BldmVudC1tb3VzZXVwOiBoYW5kbGVNb3VzZVVwfXtAZXZlbnQtdG91Y2hzdGFydDogaGFuZGxlVG91Y2hTdGFydH17QGV2ZW50LXRvdWNobW92ZTogaGFuZGxlVG91Y2hNb3ZlfXtAZXZlbnQtdG91Y2hjYW5jZWw6IGhhbmRsZVRvdWNoQ2FuY2VsfXtAZXZlbnQtdG91Y2hlbmQ6IGhhbmRsZVRvdWNoRW5kfSI+PC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJsaXN0LW1lbnUtZGVzYyIgZGF0YS1iaW5kaW5nPSJ7QHdpZGdldDogR2V0RGVzY3JpcHRpb259e0B3aWRnZXQtY29udGV4dDogQGNvbnRleHR9Ij48L3NwYW4+DQogICAgICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDwhLS0gRU5EOiBSZXN1bHRzIExpc3QgLS0+DQoNCiAgICA8IS0tIEJFR0lOOiBQYWdpbmcgQ29udHJvbHMgLS0+DQogICAgPGRpdiBjbGFzcz0icGFnaW5nLWNvbnRyb2wiIGRhdGEtYmluZGluZz0ie0Bzb3VyY2U6IHByZXNlbnRhYmxlUmVzdWx0c317Y2xhc3NOYW1lOiBwYWdpbmdDb250cm9sQ2xhc3NOYW1lfSI+DQogICAgICAgIDxkaXYgY2xhc3M9InBhZ2luZy1jb250cm9sLWlubmVyIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBwcmVzZW50YWJsZVJlc3VsdHN9Ij4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhZ2luZy1yZXN1bHQtaW5mbyI+ICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwYWdpbmctcmVzdWx0cy10b3RhbCIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogbnVtYmVyT2ZJdGVtc317QHRleHQ6IEBsYW5ndWFnZS1jb21tb24tbm8tcmVzdWx0c30iPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogbnVtYmVyT2ZJdGVtc30iPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXJlc3VsdHMtZGlzcGxheWluZ30iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogY3VyckluZGV4U3RhcnRGcm9tT25lfSI+PC9zcGFuPiZuYnNwOy0mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogY3VyckluZGV4RW5kfSI+PC9zcGFuPiZuYnNwOyg8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXJlc3VsdHMtdG90YWx9Ij48L3NwYW4+OiZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBudW1iZXJPZkl0ZW1zfSI+PC9zcGFuPikNCiAgICAgICAgICAgICAgICA8L3NwYW4+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhZ2luZy1idXR0b25zIiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogbnVtYmVyT2ZJdGVtc30iPg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImZpcnN0IiBkYXRhLWJpbmRpbmc9IntAZXZlbnQtb25jbGljazogaGFuZGxlUGFnZUZpcnN0fXt0aXRsZTogQGxhbmd1YWdlLXBhZ2UtZmlyc3R9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1maXJzdC00NC5wbmciIGFsdD0iICIvPjwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InByZXYiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlUHJldn17dGl0bGU6IEBsYW5ndWFnZS1wYWdlLXByZXZ9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1wcmV2aW91cy00NC5wbmciIGFsdD0iICIvPjwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwYWdpbmctYnV0dG9ucy1pbmZvIiB0YWJpbmRleD0iMCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2UtcmVzdWx0cy1wYWdlfSI+PC9zcGFuPiZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBjdXJyUGFnZU51bWJlcn0iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXJlc3VsdHMtcGFnZS1vZn0iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogbGFzdFBhZ2VOdW1iZXJ9Ij48L3NwYW4+DQogICAgICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im5leHQiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlTmV4dH17dGl0bGU6IEBsYW5ndWFnZS1wYWdlLW5leHR9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1uZXh0LTQ0LnBuZyIgYWx0PSIgIiAvPjwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Imxhc3QiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlTGFzdH17dGl0bGU6IEBsYW5ndWFnZS1wYWdlLWxhc3R9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1sYXN0LTQ0LnBuZyIgYWx0PSIgIiAvPjwvYnV0dG9uPg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDwhLS0gRU5EOiBQYWdpbmcgQ29udHJvbHMgLS0+DQo8L2Rpdj4NCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/results/ResultsTableView.html","html","PGRpdiBjbGFzcz0icmVzdWx0cy10YWJsZS1hY3Rpb25zLXdpZGdldCIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IGZlYXR1cmVTZXRDb2xsZWN0aW9ufXtAd2lkZ2V0OiBSZXN1bHRzVGFibGVBY3Rpb25zV2lkZ2V0fXtAd2lkZ2V0LWNvbnRleHQ6IGZlYXR1cmVTZXRDb2xsZWN0aW9ufXtAd2lkZ2V0LXJlcXVpcmVkOiBmYWxzZX0iDQogICAgIGRhdGEtbWVudS1pZD0iUmVzdWx0c1RhYmxlQWN0aW9ucyIgZGF0YS1tZW51LXRlbXBsYXRlPSJNYXBwaW5nL2luZnJhc3RydWN0dXJlL21lbnVzL01lbnVIeXBlcmxpbmtWaWV3Lmh0bWwiPjwvZGl2Pg0KDQo8ZGl2IGNsYXNzPSJyZXN1bHRzIj4NCg0KICAgIDwhLS0gQkVHSU46IE5vIFJlc3VsdHMgLS0+DQogICAgPGRpdiBjbGFzcz0ibm8tcmVzdWx0cyIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogaGFzRmVhdHVyZVNldHN9e0B0ZXh0OiBzZWFyY2hTdWdnZXN0aW9ufSI+PC9kaXY+DQogICAgPCEtLSBFTkQ6IE5vIFJlc3VsdHMgLS0+DQoNCiAgICA8IS0tIEJFR0lOOiBTY3JvbGxpbmcgVGFiIENvbnRhaW5lciBBcmVhIC0tPg0KICAgIDxkaXYgY2xhc3M9InRhYi1jb250YWluZXIiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBoYXNGZWF0dXJlU2V0c317QHZhcjogc2Nyb2xsaW5nVGFiQ29udGFpbmVyRWxlbWVudH0iPg0KICAgICAgICA8dGFibGU+DQogICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJ0YWItbGVmdC1zY3JvbGwiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiB0YWJDb250cm9sc0VuYWJsZWR9e0BjbGFzcy1kaXNhYmxlZDogbGVmdFNjcm9sbFRhYkRpc2FibGVkfXtAdmFyOiBzY3JvbGxUYWJMZWZ0RWxlbWVudH0iPg0KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVUYWJTY3JvbGxCYWNrfXt0aXRsZTogQGxhbmd1YWdlLXRhYi1zY3JvbGwtcHJldn0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9IlJlc291cmNlcy9JbWFnZXMvSWNvbnMvY2hldnJvbi1sZWZ0LTE2LnBuZyIgYWx0PSIiPg0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBkYXRhLWJpbmRpbmc9IntAc291cmNlOiBmZWF0dXJlU2V0Q29sbGVjdGlvbn0iPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWItY29udGFpbmVyIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBmZWF0dXJlU2V0Q29sbGVjdGlvbn17QHZhcjogdGFiQ29udGFpbmVyRWxlbWVudH0iPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJ0YWItY29udHJvbCIgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogZmVhdHVyZVNldHN9e0B2YXI6IHRhYkVsZW1lbnRzfSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IGZlYXR1cmVTZXRzfSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InRhYiIgZGF0YS1iaW5kaW5nPSJ7QGNsYXNzLXRhYi1hY3RpdmU6IGlzU2VsZWN0ZWRJbkNvbGxlY3Rpb259e0Bub2NsYXNzLXRhYjogaXNTZWxlY3RlZEluQ29sbGVjdGlvbn17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZVRhYkNsaWNrfSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBkaXNwbGF5TmFtZX17dGl0bGU6IGRpc3BsYXlOYW1lfSI+PC9zdHJvbmc+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3VsPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0idGFiLXJpZ2h0LXNjcm9sbCIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IHRhYkNvbnRyb2xzRW5hYmxlZH17QGNsYXNzLWRpc2FibGVkOiByaWdodFNjcm9sbFRhYkRpc2FibGVkfXtAdmFyOiBzY3JvbGxUYWJSaWdodEVsZW1lbnR9Ij4NCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWJpbmRpbmc9IntAZXZlbnQtb25jbGljazogaGFuZGxlVGFiU2Nyb2xsRm9yd2FyZH17dGl0bGU6IEBsYW5ndWFnZS10YWItc2Nyb2xsLW5leHR9Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgc3JjPSJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL2NoZXZyb24tcmlnaHQtMTYucG5nIj4NCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGFibGU+DQogICAgPC9kaXY+DQogICAgPCEtLSBFTkQ6IFNjcm9sbGluZyBUYWIgQ29udGFpbmVyIEFyZWEgLS0+DQoNCg0KICAgIDwhLS0gQkVHSU46IFJlc3VsdHMgVGFibGUgLS0+DQogICAgPGRpdiBjbGFzcz0id2lkZ2V0IiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogaGFzRmVhdHVyZVNldHN9e0B3aWRnZXQ6IFRhYmxlVmlld1dpZGdldH17QHdpZGdldC1jb250ZXh0OiBAY29udGV4dH17QHdpZGdldC1yZXF1aXJlZDogZmFsc2V9Ij48L2Rpdj4NCiAgICA8IS0tIEVORDogUmVzdWx0cyBUYWJsZSAtLT4NCg0KICAgIDwhLS0gQkVHSU46IFBhZ2luZyBDb250cm9scyAtLT4NCiAgICA8ZGl2IGNsYXNzPSJwYWdpbmctY29udHJvbCIgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogcHJlc2VudGFibGVSZXN1bHRzfSI+DQogICAgICAgIDxkaXYgY2xhc3M9InBhZ2luZy1jb250cm9sLWlubmVyIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBwcmVzZW50YWJsZVJlc3VsdHN9Ij4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhZ2luZy1yZXN1bHQtaW5mbyI+DQogICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogbnVtYmVyT2ZJdGVtc317QHRleHQ6IEBsYW5ndWFnZS1jb21tb24tbm8tcmVzdWx0c30iPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogbnVtYmVyT2ZJdGVtc30iPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXJlc3VsdHMtZGlzcGxheWluZ30iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogY3VyckluZGV4U3RhcnRGcm9tT25lfSI+PC9zcGFuPiZuYnNwOy0mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogY3VyckluZGV4RW5kfSI+PC9zcGFuPiZuYnNwOyg8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXJlc3VsdHMtdG90YWx9Ij48L3NwYW4+OiZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBudW1iZXJPZkl0ZW1zfSI+PC9zcGFuPikNCiAgICAgICAgICAgICAgICA8L3NwYW4+DQogICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0icGFnaW5nLWJ1dHRvbnMiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBudW1iZXJPZkl0ZW1zfSI+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZmlyc3QiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlRmlyc3R9e3RpdGxlOiBAbGFuZ3VhZ2UtcmVzdWx0cy1wYWdlLWZpcnN0fSI+PGltZyBzcmM9IlJlc291cmNlcy9JbWFnZXMvSWNvbnMvcGFnaW5nLWNvbnRyb2wtZmlyc3QtNDQucG5nIiBhbHQ9IiAiLz48L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwcmV2IiBkYXRhLWJpbmRpbmc9IntAZXZlbnQtb25jbGljazogaGFuZGxlUGFnZVByZXZ9e3RpdGxlOiBAbGFuZ3VhZ2UtcmVzdWx0cy1wYWdlLXByZXZ9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1wcmV2aW91cy00NC5wbmciIGFsdD0iICIvPjwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwYWdpbmctYnV0dG9ucy1pbmZvIiB0YWJpbmRleD0iMCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2UtcmVzdWx0cy1wYWdlfSI+PC9zcGFuPiZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBjdXJyUGFnZU51bWJlcn0iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXJlc3VsdHMtcGFnZS1vZn0iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogbGFzdFBhZ2VOdW1iZXJ9Ij48L3NwYW4+DQogICAgICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im5leHQiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlTmV4dH17dGl0bGU6IEBsYW5ndWFnZS1yZXN1bHRzLXBhZ2UtbmV4dH0iPjxpbWcgc3JjPSJSZXNvdXJjZXMvSW1hZ2VzL0ljb25zL3BhZ2luZy1jb250cm9sLW5leHQtNDQucG5nIiBhbHQ9IiAiLz48L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJsYXN0IiBkYXRhLWJpbmRpbmc9IntAZXZlbnQtb25jbGljazogaGFuZGxlUGFnZUxhc3R9e3RpdGxlOiBAbGFuZ3VhZ2UtcmVzdWx0cy1wYWdlLWxhc3R9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1sYXN0LTQ0LnBuZyIgYWx0PSIgIi8+PC9idXR0b24+DQogICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCiAgICA8IS0tIEVORDogUGFnaW5nIENvbnRyb2xzIC0tPg0KPC9kaXY+DQo="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/ColorPicker/ColorPickerView.html","html","PCEtLSBDb2xvciBpbnB1dCAob3Igc3dhdGNoZXMpLiAtLT4NCjxkaXYgY2xhc3M9ImZvcm0tY29udHJvbCIgZGF0YS1iaW5kaW5nPSJ7QGV2ZW50LW9uY2hhbmdlOiBoYW5kbGVDaGFuZ2V9e0BldmVudC1vbmlucHV0OiBoYW5kbGVDaGFuZ2V9Ij4NCiAgICA8aW5wdXQgdHlwZT0iY29sb3IiIGRhdGEtYmluZGluZz0ie0B2YXI6IGNvbG9ySW5wdXR9e0BoaWRkZW46IHVzZUNvbG9yU3dhdGNoZXN9IiAvPg0KICAgIDxkaXYgY2xhc3M9ImlubGluZSBjb2xvci1zd2F0Y2hlcyIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IHVzZUNvbG9yU3dhdGNoZXN9Ij4NCiAgICAgICAgPGZpZWxkc2V0IGNsYXNzPSJyYWRpby1jb250YWluZXIgaW5saW5lIiBkYXRhLWJpbmRpbmc9IntAdmFyOiBjb2xvclN3YXRjaEZpZWxkU2V0fXtAc291cmNlOiBjb2xvclN3YXRjaGVzfSI+DQogICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbG9yLXN3YXRjaCIgZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogY29sb3JTd2F0Y2hlc30iPg0KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgZGF0YS1iaW5kaW5nPSJ7bmFtZTogc2V0TmFtZX0iIC8+DQogICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICA8L2ZpZWxkc2V0Pg0KICAgIDwvZGl2Pg0KPC9kaXY+DQo="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/PagingControls/PagingControlsView.html","html","PGRpdiBjbGFzcz0icGFnaW5nLWNvbnRyb2wiIGRhdGEtYmluZGluZz0ie0Bzb3VyY2U6IHByZXNlbnRhYmxlUmVzdWx0c30iPg0KICAgIDxkaXYgY2xhc3M9InBhZ2luZy1jb250cm9sLWlubmVyIiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBwcmVzZW50YWJsZVJlc3VsdHN9Ij4NCiAgICAgICAgPGRpdiBjbGFzcz0icGFnaW5nLXJlc3VsdC1pbmZvIj4NCiAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0BoaWRkZW46IG51bWJlck9mSXRlbXN9e0B0ZXh0OiBAbGFuZ3VhZ2UtY29tbW9uLW5vLXJlc3VsdHN9Ij48L3NwYW4+DQogICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogbnVtYmVyT2ZJdGVtc30iPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2UtcGFnZS1kaXNwbGF5aW5nfSI+PC9zcGFuPiZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBjdXJySW5kZXhTdGFydEZyb21PbmV9Ij48L3NwYW4+Jm5ic3A7LSZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBjdXJySW5kZXhFbmR9Ij48L3NwYW4+Jm5ic3A7KDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2UtcGFnZS10b3RhbH0iPjwvc3Bhbj46Jm5ic3A7PHNwYW4gZGF0YS1iaW5kaW5nPSJ7QHRleHQ6IG51bWJlck9mSXRlbXN9Ij48L3NwYW4+KQ0KICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8ZGl2IGNsYXNzPSJwYWdpbmctYnV0dG9ucyIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IG51bWJlck9mSXRlbXN9Ij4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImZpcnN0IiBkYXRhLWJpbmRpbmc9IntAZXZlbnQtb25jbGljazogaGFuZGxlUGFnZUZpcnN0fXt0aXRsZTogQGxhbmd1YWdlLXBhZ2UtZmlyc3R9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1maXJzdC00NC5wbmciIGFsdD0iICIgLz48L2J1dHRvbj4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InByZXYiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlUHJldn17dGl0bGU6IEBsYW5ndWFnZS1wYWdlLXByZXZ9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1wcmV2aW91cy00NC5wbmciIGFsdD0iICIgLz48L2J1dHRvbj4NCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwYWdpbmctYnV0dG9ucy1pbmZvIiB0YWJpbmRleD0iMCI+DQogICAgICAgICAgICAgICAgPHNwYW4gZGF0YS1iaW5kaW5nPSJ7QHRleHQ6IEBsYW5ndWFnZS1wYWdlLXBhZ2V9Ij48L3NwYW4+Jm5ic3A7PHNwYW4gZGF0YS1iaW5kaW5nPSJ7QHRleHQ6IGN1cnJQYWdlTnVtYmVyfSI+PC9zcGFuPiZuYnNwOzxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2UtcGFnZS1vZn0iPjwvc3Bhbj4mbmJzcDs8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogbGFzdFBhZ2VOdW1iZXJ9Ij48L3NwYW4+DQogICAgICAgICAgICA8L3NwYW4+DQogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJuZXh0IiBkYXRhLWJpbmRpbmc9IntAZXZlbnQtb25jbGljazogaGFuZGxlUGFnZU5leHR9e3RpdGxlOiBAbGFuZ3VhZ2UtcGFnZS1uZXh0fSI+PGltZyBzcmM9IlJlc291cmNlcy9JbWFnZXMvSWNvbnMvcGFnaW5nLWNvbnRyb2wtbmV4dC00NC5wbmciIGFsdD0iICIgLz48L2J1dHRvbj4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Imxhc3QiIGRhdGEtYmluZGluZz0ie0BldmVudC1vbmNsaWNrOiBoYW5kbGVQYWdlTGFzdH17dGl0bGU6IEBsYW5ndWFnZS1wYWdlLWxhc3R9Ij48aW1nIHNyYz0iUmVzb3VyY2VzL0ltYWdlcy9JY29ucy9wYWdpbmctY29udHJvbC1sYXN0LTQ0LnBuZyIgYWx0PSIgIiAvPjwvYnV0dG9uPg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCjwvZGl2Pg0K"),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Slider/SliderView.html","html","PGRpdiBjbGFzcz0iZ2N4LXNsaWRlci1jb250YWluZXIiPg0KICAgIDxkaXYgY2xhc3M9ImdjeC1zbGlkZXItY3VycmVudC1sYWJlbC1jb250YWluZXIiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJnY3gtc2xpZGVyLWxhYmVsIGdjeC1zbGlkZXItbGFiZWwtY3VycmVudC1taW4iIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBzbGlkZXJNaW5IYW5kbGVMYWJlbH17QHZhcjogc2xpZGVyTWluTGFiZWxFbGVtZW50fXtAdGV4dDogc2xpZGVyTWluSGFuZGxlTGFiZWx9Ij48L2Rpdj4NCiAgICAgICAgPGRpdiBjbGFzcz0iZ2N4LXNsaWRlci1sYWJlbCBnY3gtc2xpZGVyLWxhYmVsLWN1cnJlbnQtbWF4IiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogc2xpZGVyTWF4SGFuZGxlTGFiZWx9e0B2YXI6IHNsaWRlck1heExhYmVsRWxlbWVudH17QHRleHQ6IHNsaWRlck1heEhhbmRsZUxhYmVsfSI+PC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBjbGFzcz0iZ2N4LXNsaWRlci1yYW5nZS1jb250YWluZXIiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJnY3gtc2xpZGVyLXRpY2tzIiBkYXRhLWJpbmRpbmc9IntAc291cmNlOiBzbGlkZXJUaWNrc30iPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ2N4LXRpY2siIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IHNsaWRlclRpY2tzfXtAc3R5bGUtbGVmdDogcG9zaXRpb259Ij48L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICAgIDxkaXYgY2xhc3M9ImdjeC1zbGlkZXIiIGRhdGEtYmluZGluZz0ie0B2YXI6IHNsaWRlckVsZW1lbnR9Ij48L2Rpdj4NCiAgICA8L2Rpdj4NCiAgICA8ZGl2IGNsYXNzPSJnY3gtc2xpZGVyLWxhYmVsLWNvbnRhaW5lciI+DQogICAgICAgIDxzcGFuIGNsYXNzPSJnY3gtc2xpZGVyLWxhYmVsIGdjeC1zbGlkZXItbGFiZWwtbWluIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogc2xpZGVyTWluTGFiZWx9Ij48L3NwYW4+DQogICAgICAgIDxzcGFuIGNsYXNzPSJnY3gtc2xpZGVyLWxhYmVsIGdjeC1zbGlkZXItbGFiZWwtbWF4IiBkYXRhLWJpbmRpbmc9IntAdGV4dDogc2xpZGVyTWF4TGFiZWx9Ij48L3NwYW4+DQogICAgPC9kaXY+DQo8L2Rpdj4NCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/SmartPanel/SmartPanelView.html","html","PGRpdiBjbGFzcz0idmlldy1jb250YWluZXItdmlldyBzbWFydC1wYW5lbCIgZGF0YS1iaW5kaW5nPSJ7QHZhcjogY29udGFpbmVyRWxlbWVudH0iPg0KICAgIDwhLS0gQkVHSU46IEhlYWRlciAtLT4NCiAgICA8YnV0dG9uIGNsYXNzPSJib3R0b20tcGFuZWwtcmVzaXplIHJlc2l6ZS1oYW5kbGUiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiByZXNpemVZfXtAZXZlbnQtbW91c2Vkb3duOiBoYW5kbGVIZWFkZXJNb3VzZURvd259e0BldmVudC10b3VjaHN0YXJ0OiBoYW5kbGVIZWFkZXJUb3VjaFN0YXJ0fXt0aXRsZTogQGxhbmd1YWdlLXNtYXJ0LXBhbmVsLXJlc2l6ZX0iPg0KICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi1kcmFnIj48L3NwYW4+DQogICAgPC9idXR0b24+DQogICAgPGRpdiBjbGFzcz0icGFuZWwtaGVhZGVyIGJhbm5lci1ub3NlbGVjdCIgIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBoZWFkZXJJc1Zpc2libGV9e0B2YXI6IGhlYWRlckVsZW1lbnR9e0BldmVudC1tb3VzZWRvd246IGhhbmRsZUhlYWRlck1vdXNlRG93bn0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7QGV2ZW50LXRvdWNoc3RhcnQ6IGhhbmRsZUhlYWRlclRvdWNoU3RhcnR9e0BjbGFzcy1yZXNpemUtaG9yaXpvbnRhbC1oaW50OiByZXNpemVYfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtAY2xhc3MtcmVzaXplLXZlcnRpY2FsLWhpbnQ6IHJlc2l6ZVl9Ij4NCiAgICAgICAgPGRpdiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogdGl0bGVCYXJJc1Zpc2libGV9Ij4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBhbmVsLWhlYWRlci1idXR0b24gcmlnaHQgY2xvc2UtMTYiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBzaG93aW5nWEJ1dHRvbn17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZUNsaWNrQ2xvc2V9e3RpdGxlOiBAbGFuZ3VhZ2Utc21hcnQtcGFuZWwtY2xvc2V9Ij48L2J1dHRvbj4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBhbmVsLWhlYWRlci1idXR0b24gcmlnaHQiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBzaG93aW5nTWF4aW1pemVCdXR0b259e0BjbGFzcy1taW5pbWl6ZS0xNjogcGFuZWxNYXhpbWl6ZWR9e0Bub2NsYXNzLW1heGltaXplLTE2OiBwYW5lbE1heGltaXplZH17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZU1heGltaXplVG9nZ2xlQ2xpY2t9e3RpdGxlOiBAbGFuZ3VhZ2Utc21hcnQtcGFuZWwtbWF4aW1pemUtcmVzdG9yZX0iPjwvYnV0dG9uPg0KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icGFuZWwtaGVhZGVyLWJ1dHRvbiBtZW51LWJ1dHRvbiIgZGF0YS1iaW5kaW5nPSJ7QGVuYWJsZWQ6IGhhc0V4ZWN1dGFibGVNZW51SXRlbXN9e0B2aXNpYmxlOiBoYXNIb2lzdGVkTWVudX17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZVRhcE1lbnVCdXR0b259e0B2YXI6IG1lbnVCdXR0b25FbGVtZW50fXt0aXRsZTogQGxhbmd1YWdlLXNtYXJ0LXBhbmVsLW1lbnV9Ij48L2J1dHRvbj4NCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBhbmVsLWhlYWRlci1idXR0b24gbGVmdCBiYWNrLTE2IiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogc2hvd2luZ0JhY2tCdXR0b259e0BldmVudC1jbGljazogaGFuZGxlQ2xpY2tCYWNrfXt0aXRsZTogQGxhbmd1YWdlLXNtYXJ0LXBhbmVsLWJhY2t9Ij48L2J1dHRvbj4NCg0KICAgICAgICAgICAgPGgyIGNsYXNzPSJwYW5lbC10aXRsZSBiYW5uZXItbm9zZWxlY3QiPg0KICAgICAgICAgICAgICAgIDxpbWcgc3JjPSJSZXNvdXJjZXMvSW1hZ2VzL2xvYWRlci1zbWFsbC5naWYiIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBzaG93QnVzeUluZGljYXRvcn0iIGFsdD0iICIgLz4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogY29udGFpbmVyVGl0bGV9e0B2aXNpYmxlOiBjb250YWluZXJUaXRsZX0iPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogY29udGFpbmVyVGl0bGV9Ij4mbmJzcDstJm5ic3A7PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiB2aWV3VGl0bGV9e0B2aXNpYmxlOiB2aWV3VGl0bGV9e3RpdGxlOiB2aWV3VGl0bGV9Ij48L3NwYW4+DQogICAgICAgICAgICA8L2gyPg0KICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8ZGl2IGNsYXNzPSJzbWFydC1wYW5lbC1ob2lzdGVkLW1lbnUtaW5saW5lIiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogaW5saW5lTWVudUlzT3Blbn17QHdpZGdldDogU21hcnRQYW5lbEhvaXN0ZWRNZW51fXtAd2lkZ2V0LXJlcXVpcmVkOiBmYWxzZX17QHdpZGdldC1jb250ZXh0OiBob2lzdGVkTWVudVZpZXdNb2RlbH0iPjwvZGl2Pg0KDQogICAgICAgIDxkaXYgZGF0YS1iaW5kaW5nPSJ7QGRvbTogaGVhZGVySW5zZXJ0RG9tRWxlbWVudH0iPjwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDwhLS0gRU5EOiBIZWFkZXIgLS0+DQoNCiAgICA8IS0tIEJFR0lOOiBPcHRpb25hbCBzdGF0dXMgbWVzc2FnZXMgLS0+DQogICAgPGRpdiBjbGFzcz0icmVnaW9uIHBhbmVsLXN0YXR1cy1yZWdpb24iIGRhdGEtYmluZGluZz0ie0B2YXI6IHN0YXR1c1JlZ2lvbkVsZW1lbnR9Ij48L2Rpdj4NCiAgICA8IS0tIEVORDogT3B0aW9uYWwgc3RhdHVzIG1lc3NhZ2VzIC0tPg0KDQogICAgPCEtLSBCRUdJTjogQ29udGVudCByZWdpb24gLS0+DQogICAgPGRpdiBjbGFzcz0icGFuZWwtc2Nyb2xsLWNvbnRhaW5lciIgZGF0YS1iaW5kaW5nPSJ7ZGF0YS1yZWdpb24tbmFtZTogcmVnaW9uTmFtZX17ZGF0YS1yZWdpb24tYWRhcHRlcjogcmVnaW9uVHlwZX17QHZhcjogc2Nyb2xsUmVnaW9uRWxlbWVudH17QGV2ZW50LW9uc2Nyb2xsOiBoYW5kbGVTY3JvbGxDaGFuZ2V9IiB0YWJpbmRleD0iLTEiPjwvZGl2Pg0KICAgIDwhLS0gRU5EOiBDb250ZW50IHJlZ2lvbiAtLT4NCg0KICAgIDwhLS0gQkVHSU46IE9wdGlvbmFsIGZvb3RlciBjb250ZW50IC0tPg0KICAgIDxkaXYgY2xhc3M9InBhbmVsLWZvb3RlciIgZGF0YS1iaW5kaW5nPSJ7QHZhcjogZm9vdGVyRWxlbWVudH17QHZpc2libGU6IGZvb3Rlckluc2VydERvbUVsZW1lbnR9IiBzdHlsZT0icG9zaXRpb246IGFic29sdXRlIj4NCiAgICAgICAgPGRpdiBjbGFzcz0icGFuZWwtZm9vdGVyLWlubmVyIiBkYXRhLWJpbmRpbmc9IntAZG9tOiBmb290ZXJJbnNlcnREb21FbGVtZW50fSI+PC9kaXY+DQogICAgPC9kaXY+DQogICAgPCEtLSBFTkQ6IE9wdGlvbmFsIGhlYWRlciBjb250ZW50IC0tPg0KDQo8L2Rpdj4NCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/ui/components/Table/TableView.html","html","PGRpdiBjbGFzcz0icmVzdWx0cy10YWJsZSIgZGF0YS1iaW5kaW5nPSJ7QHZhcjogdGFibGVDb250YWluZXJFbGVtZW50fSI+DQogICAgPHRhYmxlPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgICA8dHIgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogY29sdW1uSGVhZGVyc30iPg0KICAgICAgICAgICAgICAgIDx0aCBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBjb2x1bW5IZWFkZXJzfXtAdmlzaWJsZTogdmlzaWJsZX17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZUNvbHVtbkhlYWRDbGlja30iIHNjb3BlPSJjb2wiPg0KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtYmluZGluZz0ie2FyaWEtbGFiZWw6IGNvbHVtbkRlc2NyaXB0b3J9Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie2NsYXNzOiBzb3J0Q2xhc3N9e3RpdGxlOiBAbGFuZ3VhZ2UtcmVzdWx0cy1zb3J0fSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InJlc3VsdC1oZWFkaW5nIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogcHJlc2VudGFibGVWYWx1ZX0iPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgPC90aD4NCiAgICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGhlYWQ+DQogICAgICAgIDx0Ym9keSBkYXRhLWJpbmRpbmc9IntAc291cmNlOiByZWNvcmRzfSI+DQogICAgICAgICAgICA8dHIgZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogcmVjb3Jkc30NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtAc291cmNlOiBhdHRyaWJ1dGVzfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge0BldmVudC1tb3VzZWRvd246IGhhbmRsZU1vdXNlRG93bn0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtAZXZlbnQtbW91c2V1cDogaGFuZGxlTW91c2VVcH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtAZXZlbnQtdG91Y2hzdGFydDogaGFuZGxlVG91Y2hTdGFydH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtAZXZlbnQtdG91Y2htb3ZlOiBoYW5kbGVUb3VjaE1vdmV9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7QGV2ZW50LXRvdWNoZW5kOiBoYW5kbGVUb3VjaEVuZH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtAZXZlbnQtY2xpY2s6IGhhbmRsZUNsaWNrfSI+DQogICAgICAgICAgICAgICAgPHRkIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IGF0dHJpYnV0ZXN9e0B2aXNpYmxlOiB2aXNpYmxlfSI+DQogICAgICAgICAgICAgICAgICAgIDxhIGRhdGEtYmluZGluZz0ie0B2aXNpYmxlOiBkaXNwbGF5QXNVcmx9e0BldmVudC1vbmNsaWNrOiBoYW5kbGVDbGlja0F0dHJpYnV0ZWxpbmt9e2hyZWY6IHZhbHVlfXtAdGV4dDogcHJlc2VudGFibGVWYWx1ZX0iIHRhcmdldD0iX2JsYW5rIj48L2E+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogZGlzcGxheUFzVXJsfXtAdGV4dDogcHJlc2VudGFibGVWYWx1ZX0iIHRhYmluZGV4PSIwIj48L2J1dHRvbj4NCiAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgPC90cj4NCiAgICAgICAgPC90Ym9keT4NCiAgICA8L3RhYmxlPg0KPC9kaXY+DQoNCg=="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/visualization/SymbologySettings/AttributeSymbologySettingsView.html","html","PGRpdiBjbGFzcz0iYXR0cmlidXRlLXN5bWJvbG9neS1zZXR0aW5ncyIgZGF0YS1iaW5kaW5nPSJ7QHZhcjogY29udGFpbmVyfXtAZXZlbnQtb25jaGFuZ2U6IGhhbmRsZUNoYW5nZX17QGV2ZW50LW9uaW5wdXQ6IGhhbmRsZUNoYW5nZX0iPg0KDQogICAgPCEtLSBBdHRyaWJ1dGUgc2VsZWN0b3IgZHJvcC1kb3duLiAtLT4NCiAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktZHJvcC1kb3duIj4NCiAgICAgICAgPGxhYmVsIGNsYXNzPSJzeW1ib2xvZ3ktbGFiZWwiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLXBpY2stYXR0cmlidXRlfSI+PC9sYWJlbD4NCiAgICAgICAgPHNlbGVjdCBkYXRhLWJpbmRpbmc9IntAc291cmNlOiBhdHRyaWJ1dGVzfXtAdmFyOiBhdHRyaWJ1dGVJbnB1dH0iPg0KICAgICAgICAgICAgPG9wdGlvbiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBhdHRyaWJ1dGVzfXtAdGV4dDogZGlzcGxheU5hbWV9e0B2YWx1ZSBuYW1lfSI+PC9vcHRpb24+DQogICAgICAgIDwvc2VsZWN0Pg0KICAgIDwvZGl2Pg0KDQogICAgPCEtLSBDbGFzcyBicmVha3Mgc2xpZGVyLiAtLT4NCiAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVycyIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IGlzTnVtZXJpY0F0dHJpYnV0ZX0iPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyIj4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1icmVha3N9Ij48L2xhYmVsPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xpZGVyIiBkYXRhLWJpbmRpbmc9IntAdmFyOiBjbGFzc0JyZWFrc1NsaWRlcn0iPjwvZGl2Pg0KICAgICAgICAgICAgPHNwYW4gY2xhc3M9InN5bWJvbG9neS1zbGlkZXItdmFsdWUiPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBudW1CcmVha3N9Ij48L3NwYW4+DQogICAgICAgICAgICA8L3NwYW4+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KDQogICAgPCEtLSBHcm91cDogQ2xhc3MgQnJlYWtzIGdyYWRpZW50IGNvbG9ycyAtLT4NCiAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktY29sb3JzIiAgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IGlzTnVtZXJpY0F0dHJpYnV0ZX0iPg0KICAgICAgICA8IS0tIFN0YXJ0IENvbG9yIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktY2xhc3NicmVhay1jb2xvcnBpY2tlciI+DQogICAgICAgICAgICA8bGFiZWwgY2xhc3M9InN5bWJvbG9neS1sYWJlbCIgZGF0YS1iaW5kaW5nPSJ7QHRleHQ6IEBsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3Mtc3RhcnRjb2xvcn0iPjwvbGFiZWw+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbmxpbmUiIGRhdGEtYmluZGluZz0ie0BoaWRkZW46IHVzZUNvbG9yU3dhdGNoZXN9Ij4NCiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY29sb3IiIGRhdGEtYmluZGluZz0ie0B2YXI6IHN0YXJ0Q29sb3JJbnB1dH0iIC8+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlubGluZSBjb2xvci1zd2F0Y2hlcyIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IHVzZUNvbG9yU3dhdGNoZXN9Ij4NCiAgICAgICAgICAgICAgICA8ZmllbGRzZXQgY2xhc3M9InJhZGlvLWNvbnRhaW5lciBpbmxpbmUiIGRhdGEtYmluZGluZz0ie0B2YXI6IHN0YXJ0Q29sb3JTd2F0Y2hGaWVsZFNldH17QHNvdXJjZTogc3RhcnRDb2xvclN3YXRjaGVzfSI+DQogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3RhcnQtY29sb3Itc3dhdGNoIGNvbG9yLXN3YXRjaCIgZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogc3RhcnRDb2xvclN3YXRjaGVzfSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InN0YXJ0LWNvbG9yLXN3YXRjaCIgLz4NCiAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2ZpZWxkc2V0Pg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8IS0tIEVuZCBDb2xvciAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0ic3ltYm9sb2d5LWNsYXNzYnJlYWstY29sb3JwaWNrZXIiPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJzeW1ib2xvZ3ktbGFiZWwiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWVuZGNvbG9yfSI+PC9sYWJlbD4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlubGluZSIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogdXNlQ29sb3JTd2F0Y2hlc30iPg0KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjb2xvciIgZGF0YS1iaW5kaW5nPSJ7QHZhcjogZW5kQ29sb3JJbnB1dH0iIC8+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlubGluZSBjb2xvci1zd2F0Y2hlcyIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IHVzZUNvbG9yU3dhdGNoZXN9Ij4NCiAgICAgICAgICAgICAgICA8ZmllbGRzZXQgY2xhc3M9InJhZGlvLWNvbnRhaW5lciBpbmxpbmUiIGRhdGEtYmluZGluZz0ie0B2YXI6IGVuZENvbG9yU3dhdGNoRmllbGRTZXR9e0Bzb3VyY2U6IGVuZENvbG9yU3dhdGNoZXN9Ij4NCiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJlbmQtY29sb3Itc3dhdGNoIGNvbG9yLXN3YXRjaCIgZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogZW5kQ29sb3JTd2F0Y2hlc30iPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJlbmQtY29sb3Itc3dhdGNoIiAvPg0KICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZmllbGRzZXQ+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQoNCiAgICA8IS0tIEdyb3VwOiBBdHRyaWJ1dGUgUmVuZGVyZXIgR2xvYmFsIENvbnRyb2xzLiAtLT4NCiAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVycyIgZGF0YS1iaW5kaW5nPSJ7QHZpc2libGU6IGN1cnJlbnRBdHRyaWJ1dGV9Ij4NCg0KICAgICAgICA8IS0tIFRyYW5zcGFyZW5jeSBzbGlkZXIuIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyIj4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy10cmFuc3BhcmVuY3l9Ij48L2xhYmVsPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xpZGVyIiBkYXRhLWJpbmRpbmc9IntAdmFyOiB0cmFuc3BhcmVuY3lTbGlkZXJ9Ij48L2Rpdj4NCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyLXZhbHVlIj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogdHJhbnNwYXJlbmN5fSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLXRyYW5zcGFyZW5jeS1zdWZmaXh9Ij48L3NwYW4+DQogICAgICAgICAgICA8L3NwYW4+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gTWFya2VyIHNpemUgc2xpZGVyLiAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0ic3ltYm9sb2d5LXNsaWRlciIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogbm9NYXJrZXJ9Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1tYXJrZXItc2l6ZX0iPjwvbGFiZWw+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzbGlkZXIiIGRhdGEtYmluZGluZz0ie0B2YXI6IG1hcmtlclNpemVTbGlkZXJ9e2Rpc2FibGVkOiBub01hcmtlcn0iPjwvZGl2Pg0KICAgICAgICAgICAgPHNwYW4gY2xhc3M9InN5bWJvbG9neS1zbGlkZXItdmFsdWUiPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBtYXJrZXJTaXplfSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zaXplLXN1ZmZpeH0iPjwvc3Bhbj4NCiAgICAgICAgICAgIDwvc3Bhbj4NCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBMaW5lIHdpZHRoIHNsaWRlci4gLS0+DQogICAgICAgIDxkaXYgY2xhc3M9InN5bWJvbG9neS1zbGlkZXIiPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJzeW1ib2xvZ3ktbGFiZWwiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWxpbmUtd2lkdGh9Ij48L2xhYmVsPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xpZGVyIiBkYXRhLWJpbmRpbmc9IntAdmFyOiBsaW5lV2lkdGhTbGlkZXJ9Ij48L2Rpdj4NCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyLXZhbHVlIj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogbGluZVdpZHRofSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWxpbmUtd2lkdGgtc3VmZml4fSI+PC9zcGFuPg0KICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8IS0tIE1hcmtlciBzdHlsZSBkcm9wLWRvd24uIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktZHJvcC1kb3duIiBkYXRhLWJpbmRpbmc9IntAaGlkZGVuOiBub01hcmtlcn0iPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJzeW1ib2xvZ3ktbGFiZWwiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zdHlsZX0iPjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IGRhdGEtYmluZGluZz0ie0Bzb3VyY2U6IG1hcmtlclN0eWxlc317QHZhcjogbWFya2VyU3R5bGVJbnB1dH17ZGlzYWJsZWQ6IG5vTWFya2VyfSI+DQogICAgICAgICAgICAgICAgPG9wdGlvbiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBtYXJrZXJTdHlsZXN9e0B0ZXh0OiBsYWJlbH0iPjwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KDQogICAgPCEtLSBTeW1ib2xpemF0aW9uIENsYXNzZXMgLS0+DQogICAgPGRpdiBjbGFzcz0ic3ltYm9sb2d5LWNsYXNzZXMiIGRhdGEtYmluZGluZz0ie0Bzb3VyY2U6IHN5bWJvbG9neUNsYXNzZXN9Ij4NCiAgICAgICAgPGRpdiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBzeW1ib2xvZ3lDbGFzc2VzfXtAdmFyOiBzeW1ib2xvZ3lDbGFzc0NvbnRhaW5lcn0iPg0KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnV0dG9uIHN5bWJvbG9neS1jbGFzcyIgZGF0YS1iaW5kaW5nPSJ7QGNsYXNzLXNlbGVjdGVkOiBzZWxlY3RlZH17QGV2ZW50LW9uY2xpY2s6IGhhbmRsZVN5bWJvbENsYXNzU2VsZWN0ZWR9e3RpdGxlOiBuYW1lfSI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3ltYm9sb2d5LXRleHQiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBuYW1lfSI+PC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3ltYm9sb2d5LWNvbG9yIiBkYXRhLWJpbmRpbmc9IntAc3R5bGUtYmFja2dyb3VuZC1jb2xvcjogY29sb3J9Ij48L2Rpdj4NCiAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgPCEtLSBTaW1wbGUgc3ltYm9sb2d5IHNldHR0aW5ncyB3aWRnZXQgd2lsbCBiZSBhdHRhY2hlZCBoZXJlIC0tPg0KICAgICAgICAgICAgPGRpdiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogc2VsZWN0ZWR9e2lkOiB3aWRnZXRJZH0iPjwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCg0KPC9kaXY+DQo="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Mapping/infrastructure/visualization/SymbologySettings/SymbologySettingsView.html","html","PGRpdiBjbGFzcz0ic3ltYm9sb2d5LXNldHRpbmdzIiBkYXRhLWJpbmRpbmc9IntAdmFyOiBjb250YWluZXJ9e0BldmVudC1vbmNoYW5nZTogaGFuZGxlQ2hhbmdlfXtAZXZlbnQtb25pbnB1dDogaGFuZGxlQ2hhbmdlfSI+DQoNCiAgICA8IS0tIEdyb3VwOiBDb2xvcnMuIC0tPg0KICAgIDxkaXYgY2xhc3M9InN5bWJvbG9neS1jb2xvcnMiPg0KDQogICAgICAgIDwhLS0gQ29sb3IgaW5wdXQgKG9yIHN3YXRjaGVzKS4gLS0+DQogICAgICAgIDxkaXY+DQogICAgICAgICAgICA8bGFiZWwgY2xhc3M9InN5bWJvbG9neS1sYWJlbCIgZGF0YS1iaW5kaW5nPSJ7QHRleHQ6IEBsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtY29sb3J9Ij48L2xhYmVsPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5saW5lIiBkYXRhLWJpbmRpbmc9IntAaGlkZGVuOiB1c2VDb2xvclN3YXRjaGVzfSI+DQogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNvbG9yIiBkYXRhLWJpbmRpbmc9IntAdmFyOiBjb2xvcklucHV0fSIgLz4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5saW5lIGNvbG9yLXN3YXRjaGVzIiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogdXNlQ29sb3JTd2F0Y2hlc30iPg0KICAgICAgICAgICAgICAgIDxmaWVsZHNldCBjbGFzcz0icmFkaW8tY29udGFpbmVyIGlubGluZSIgZGF0YS1iaW5kaW5nPSJ7QHZhcjogY29sb3JTd2F0Y2hGaWVsZFNldH17QHNvdXJjZTogY29sb3JTd2F0Y2hlc30iPg0KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbG9yLXN3YXRjaCIgZGF0YS1iaW5kaW5nPSJ7QHRlbXBsYXRlLWZvcjogY29sb3JTd2F0Y2hlc30iPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJjb2xvci1zd2F0Y2giIC8+DQogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9maWVsZHNldD4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCg0KICAgIDwhLS0gR3JvdXA6IFNsaWRlcnMuIC0tPg0KICAgIDxkaXYgY2xhc3M9InN5bWJvbG9neS1zbGlkZXJzIj4NCg0KICAgICAgICA8IS0tIFRyYW5zcGFyZW5jeSBzbGlkZXIuIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyIj4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy10cmFuc3BhcmVuY3l9Ij48L2xhYmVsPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xpZGVyIiBkYXRhLWJpbmRpbmc9IntAdmFyOiB0cmFuc3BhcmVuY3lTbGlkZXJ9Ij48L2Rpdj4NCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyLXZhbHVlIj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogdHJhbnNwYXJlbmN5fSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLXRyYW5zcGFyZW5jeS1zdWZmaXh9Ij48L3NwYW4+DQogICAgICAgICAgICA8L3NwYW4+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gTWFya2VyIHNpemUgc2xpZGVyLiAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0ic3ltYm9sb2d5LXNsaWRlciIgZGF0YS1iaW5kaW5nPSJ7QGhpZGRlbjogbm9NYXJrZXJ9Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1tYXJrZXItc2l6ZX0iPjwvbGFiZWw+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzbGlkZXIiIGRhdGEtYmluZGluZz0ie0B2YXI6IG1hcmtlclNpemVTbGlkZXJ9e2Rpc2FibGVkOiBub01hcmtlcn0iPjwvZGl2Pg0KICAgICAgICAgICAgPHNwYW4gY2xhc3M9InN5bWJvbG9neS1zbGlkZXItdmFsdWUiPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBtYXJrZXJTaXplfSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zaXplLXN1ZmZpeH0iPjwvc3Bhbj4NCiAgICAgICAgICAgIDwvc3Bhbj4NCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBMaW5lIHdpZHRoIHNsaWRlci4gLS0+DQogICAgICAgIDxkaXYgY2xhc3M9InN5bWJvbG9neS1zbGlkZXIiPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJzeW1ib2xvZ3ktbGFiZWwiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWxpbmUtd2lkdGh9Ij48L2xhYmVsPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2xpZGVyIiBkYXRhLWJpbmRpbmc9IntAdmFyOiBsaW5lV2lkdGhTbGlkZXJ9Ij48L2Rpdj4NCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJzeW1ib2xvZ3ktc2xpZGVyLXZhbHVlIj4NCiAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWJpbmRpbmc9IntAdGV4dDogbGluZVdpZHRofSI+PC9zcGFuPg0KICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWxpbmUtd2lkdGgtc3VmZml4fSI+PC9zcGFuPg0KICAgICAgICAgICAgPC9zcGFuPg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCg0KICAgIDwhLS0gR3JvdXA6IERyb3AtZG93bnMuIC0tPg0KICAgIDxkaXYgY2xhc3M9InN5bWJvbG9neS1kcm9wLWRvd25zIj4NCg0KICAgICAgICA8IS0tIE1hcmtlciBzdHlsZSBkcm9wLWRvd24uIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktZHJvcC1kb3duIiBkYXRhLWJpbmRpbmc9IntAaGlkZGVuOiBub01hcmtlcn0iPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJzeW1ib2xvZ3ktbGFiZWwiIGRhdGEtYmluZGluZz0ie0B0ZXh0OiBAbGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zdHlsZX0iPjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IGRhdGEtYmluZGluZz0ie0Bzb3VyY2U6IG1hcmtlclN0eWxlc317QHZhcjogbWFya2VyU3R5bGVJbnB1dH17ZGlzYWJsZWQ6IG5vTWFya2VyfSI+DQogICAgICAgICAgICAgICAgPG9wdGlvbiBkYXRhLWJpbmRpbmc9IntAdGVtcGxhdGUtZm9yOiBtYXJrZXJTdHlsZXN9e0B0ZXh0OiBsYWJlbH0iPjwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gTGluZSBzdHlsZSBkcm9wLWRvd24uIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktZHJvcC1kb3duIiBkYXRhLWJpbmRpbmc9IntAdmlzaWJsZTogbm9NYXJrZXJ9Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXN0eWxlfSI+PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogbGluZVN0eWxlc317QHZhcjogbGluZVN0eWxlSW5wdXR9Ij4NCiAgICAgICAgICAgICAgICA8b3B0aW9uIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IGxpbmVTdHlsZXN9e0B0ZXh0OiBsYWJlbH0iPjwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gRmlsbCBzdHlsZSBkcm9wLWRvd24uIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJzeW1ib2xvZ3ktZHJvcC1kb3duIiBkYXRhLWJpbmRpbmc9IntAaGlkZGVuOiBub0ZpbGx9Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ic3ltYm9sb2d5LWxhYmVsIiBkYXRhLWJpbmRpbmc9IntAdGV4dDogQGxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1maWxsLXN0eWxlfSI+PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgZGF0YS1iaW5kaW5nPSJ7QHNvdXJjZTogZmlsbFN0eWxlc317QHZhcjogZmlsbFN0eWxlSW5wdXR9e2Rpc2FibGVkOiBub0ZpbGx9Ij4NCiAgICAgICAgICAgICAgICA8b3B0aW9uIGRhdGEtYmluZGluZz0ie0B0ZW1wbGF0ZS1mb3I6IGZpbGxTdHlsZXN9e0B0ZXh0OiBsYWJlbH0iPjwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KPC9kaXY+DQo="),geocortex.resourceManager.register("Mapping.Infrastructure","inv","Invariant","json","eyJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXRvZ2dsZS1sb2ctdmlldyI6IkFjdGl2YXRlcyBvciBkZWFjdGl2YXRlcyBsb2cgdmlldy4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWZyZWVoYW5kLXRvb2x0aXAiOiJGaW5kIG91dCBhYm91dCBhbiBhcmVhIG9uIHRoZSBtYXAgZGVmaW5lZCBieSBhIGZyZWVoYW5kIHNoYXBlIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zdGFydC1lZGl0aW5nLW5ldy1mZWF0dXJlIjoiQmVnaW5zIGVkaXRpbmcgYSBuZXcgZmVhdHVyZS4iLCJsYW5ndWFnZS1zdGF0ZXMtZmVhdHVyZS1lZGl0aW5nLXN0YXRlLWRlc2NyaXB0aW9uIjoiVGhlIGNyZWF0ZSBhIGZlYXR1cmUgdG9vbCBpcyBjdXJyZW50bHkgYWN0aXZlLiIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9seWxpbmUtZGVzYy1rZXlib2FyZCI6IlRvIGxlYXJuIHdoYXRcdTIwMTlzIHRoZXJlLCB1c2UgYXJyb3dzIHRvIG1vdmUgdGhlIHBvaW50LiBIaXQgRU5URVIgdG8gcGxvdCBhbmQgYmVnaW4gbW92aW5nIHRoZSBuZXh0IHBvaW50LiBIaXQgRU5URVIgdHdpY2UgdG8gZmluaXNoLiIsImxhbmd1YWdlLWNvbW1vbi1jcmVhdGUiOiJDcmVhdGUiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbWFya2VyLXN0eWxlLXgiOiJYIiwibGFuZ3VhZ2UtbWVudS1wcm9qZWN0cy1hY3Rpb25zLXJlZnJlc2gtZGVzYyI6IlJlZnJlc2ggdGhlIGxpc3Qgb2YgcHJvamVjdHMuIiwibGFuZ3VhZ2UtZ3JhbnQtZWRpdG9yLWdsb2JhbC1ncmFudC1uYW1lLXVzZXIiOiJFdmVyeW9uZSAoc2lnbi1pbiByZXF1aXJlZCkiLCJsYW5ndWFnZS1ncmFudC1lZGl0b3Itc2VhcmNoLXBsYWNlaG9sZGVyIjoiU2VhcmNoLi4uIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWV4Y2VlZGVkLW1heC1jbGFzc2VzLXRpdGxlIjoiRXhjZWVkZWQgbWF4aW11bSB1bmlxdWUgdmFsdWVzIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1wb2x5Z29uLWRlc2MiOiJEcmF3IGEgcG9seWdvbiBmb3IgdGhlIGFyZWEgb2YgaW50ZXJlc3QgZ2VvbWV0cnkuIiwibGFuZ3VhZ2UtbGF5ZXJsaXN0LXZpc2libGUtYXQtZXh0ZW50IjoiQ3VycmVudGx5IHdpdGhpbiB2aXNpYmxlIHNjYWxlLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1tYXAtdGlwLXJlc3VsdHMiOiJTaG93cyBtYXAgdGlwIHJlc3VsdHMgZm9yIGEgRmVhdHVyZVNldENvbGxlY3Rpb24gcHJldmlvdXNseSBhZGRlZCB0byB0aGUgRmVhdHVyZVNldE1hbmFnZXIuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1vcGVuLXJlc3VsdHMtZnJhbWUiOiJBY3RpdmF0ZXMgdGhlIFJlc3VsdHNSZWdpb24uIiwibGFuZ3VhZ2Utc3RhdGVzLW1lYXN1cmUtc3RhdGUtZGVzY3JpcHRpb24iOiJUaGUgbWVhc3VyaW5nIHRvb2wgaXMgY3VycmVudGx5IGFjdGl2ZS4iLCJsYW5ndWFnZS1tZW51LXNvY2lhbC1saW5rcy1tZW51LWRlc2MiOiJTb2NpYWwgTGlua3MiLCJsYW5ndWFnZS1tZW51LWFkZC1hLWZlYXR1cmUiOiJDcmVhdGUgYSBmZWF0dXJlIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWdobGlnaHQtZmVhdHVyZS1zZXQiOiJIaWdobGlnaHRzIGFsbCBvZiB0aGUgZmVhdHVyZXMgaW4gdGhlIHNwZWNpZmllZCBmZWF0dXJlIHNldCBpbiB0aGUgYWN0aXZlIGhpZ2hsaWdodCBsYXllci4iLCJsYW5ndWFnZS1wcm9qZWN0LWVycm9yLWRlbGV0ZS1kZW5pZWQiOiJZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBkZWxldGUgdGhpcyBwcm9qZWN0LiIsImxhbmd1YWdlLW1lbnUtZHJhdy1wb2ludCI6IkRyYXcgYSBQb2ludCIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtdXBsb2FkLWRhdGEiOiJVcGxvYWQgRGF0YSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1yZXN1bHRzLWZlYXR1cmUtYWN0aW9uIjoiQ3JlYXRlcyBSZXN1bHRzTGlzdEZlYXR1cmVBY3Rpb25zVmlldyBhbmQgZGlzcGxheXMgdGhlIEZlYXR1cmUgQWN0aW9ucy4iLCJsYW5ndWFnZS1wYWdlLXRvdGFsIjoiVG90YWwiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tcGFuLXRvb2x0aXAiOiJDYW5jZWwgYW55IGFjdGl2ZSB0b29scyBhbmQgcHV0IHRoZSBtYXAgaW50byBwYW4gbW9kZSIsImxhbmd1YWdlLXVpLXRhYmxlLXNvcnRlZC1kZXNjZW5kaW5nIjoiQ29sdW1uIGhlYWRlci4gezB9IC0gU29ydGVkIGRlc2NlbmRpbmcuIiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1iYXNlbWFwZXhwb3J0LWRvd25sb2FkaW5nIjoiezB9IC0gezF9IG9mIHsyfSAoezN9JSkgZG93bmxvYWRlZC4gezR9LiIsImxhbmd1YWdlLWNvbW1vbi1mZWF0dXJlLWVkaXRsb2ctZGVzYyI6IkRpc3BsYXlzIGluZm9ybWF0aW9uIGFib3V0IGVkaXRpbmcgaGlzdG9yeSBvZiB0aGUgZmVhdHVyZSBsYXllci4iLCJsYW5ndWFnZS1jb29yZGluYXRlcy1sb25naXR1ZGUtYWJicmV2IjoiTG9uIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1hZHZhbmNlZC1tZWFzdXJlbWVudCI6IkFkdmFuY2VkIE1lYXN1cmVtZW50IiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi16b29tLXRvLWZlYXR1cmUiOiJab29tcyB0byBhIGZlYXR1cmUuIiwibGFuZ3VhZ2UtbWludXRlcy1hYmJyIjoiTSIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtZmluZC1kYXRhIjoiRmluZCBEYXRhIiwibGFuZ3VhZ2Utd2VibWFwLWxheWVyLW5hbWUtcG9seWdvbiI6IlBvbHlnb25zIiwibGFuZ3VhZ2UtbWVudS1zaG93LXJlc3VsdHMtbGlzdCI6Ikxpc3QgVmlldyIsImxhbmd1YWdlLW1lbnUtY2VudGVyLXRleHRtYXAtZGVzYyI6IkNlbnRlciB0aGUgbWFwIG9uIHRoZSBwb2ludCBzcGVjaWZpZWQuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1mZWF0dXJlLWxheWVyLW1vZHVsZS1yZWZyZXNoLWRhdGEiOiJSZWZyZXNoZXMgbGF5ZXIgZWRpdCBzdW1tYXJpZXMgYW5kIHRoZSBcInN5bmMgbmVlZGVkXCIgZmxhZy4iLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWFuYWx5c2lzIjoiQW5hbHlzaXMiLCJsYW5ndWFnZS1tZW51LXRpdGxlIjoiSSB3YW50IHRvLi4uIiwibGFuZ3VhZ2UtdG9vbGJhci10YWItdG9vbHMiOiJUb29scyIsImxhbmd1YWdlLXRvb2xiYXItaW5mb3JtYXRpb24tYWN0aW9ucyI6IkluZm9ybWF0aW9uICYgQWN0aW9ucyIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZWxsaXBzZS1kZXNjIjoiRHJhdyBhbiBlbGxpcHNlIGZvciB0aGUgYXJlYSBvZiBpbnRlcmVzdCBnZW9tZXRyeS4iLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1sYXllci1kZXRhaWxzIjoiU3luYyBTZXR0aW5ncyBmb3IgezB9IiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zaG93LXJlc3VsdHMtdGFibGUiOiJEaXNwbGF5cyB0aGUgbGlzdCBvZiBmZWF0dXJlcyBpbiB0aGUgZ2l2ZW4gZmVhdHVyZSBzZXQgY29sbGVjdGlvbiBpbiBhIHRhYnVsYXIgdmlldy4iLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWN1cnJlbnRleHRlbnQiOiJDdXJyZW50IEV4dGVudCIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktc25hcHBpbmctdG9vbHRpcCI6IkVuYWJsZS9EaXNhYmxlIHNuYXBwaW5nIHdoaWxlIGlkZW50aWZ5aW5nIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1hZGQtbWFya3VwIjoiQWRkcyB0aGUgZ2l2ZW4gZ2VvbWV0cnkgdG8gdGhlIG1hcmt1cCBsYXllci4iLCJsYW5ndWFnZS1tZW51LXJlbW92ZS11c2VyLWFkZGVkLW1hcHNlcnZpY2UtZGVzYyI6IlJlbW92ZSB0aGlzIHVzZXIgYWRkZWQgc2VydmljZSBmcm9tIHRoZSBtYXAuIiwibGFuZ3VhZ2UtcmVzdWx0cy1leHBvcnQtdG8tY29uZmlybS10aXRsZSI6IkRvd25sb2FkIFwiLnswfVwiIGZpbGUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWhpZ2hsaWdodC1mZWF0dXJlIjoiSGlnaGxpZ2h0cyB0aGUgZmVhdHVyZSBpbiB0aGUgYWN0aXZlIGhpZ2hsaWdodCBsYXllci4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1kcmF3aW5nLXRvb2xzIjoiRHJhdyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtbWVhc3VyZW1lbnQiOiJNZWFzdXJlIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zdGVwLXpvb20tb3V0IjoiWm9vbXMgb3V0IGEgc3RlcCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xlYXItc3RvcmFnZS1mb3ItYXBwbGljYXRpb24iOiJDbGVhcnMgdGhlIG9mZmxpbmUgZGF0YSBmb3IgdGhlIGN1cnJlbnQgYXBwbGljYXRpb24uIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy11cGxvYWQtZGF0YS10b29sdGlwIjoiVXBsb2FkIGxheWVycyBmcm9tIHlvdXIgY29tcHV0ZXIgb250byB0aGUgbWFwIiwibGFuZ3VhZ2UtbWVudS1zaG93LWNoYXJ0aW5nLXZpZXciOiJDaGFydGluZyBWaWV3IiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci1kZWZhdWx0LWhpZ2hsaWdodHMiOiJSZW1vdmVzIHRoZSBoaWdobGlnaHRzIGZyb20gdGhlIGRlZmF1bHQgaGlnaGxpZ2h0IGxheWVyLiIsImxhbmd1YWdlLW1lbnUtem9vbS1vdXQiOiJab29tIG91dCIsImxhbmd1YWdlLW1lbnUtbWFwdGlwLWFjdGlvbnMtZGVzYyI6Ik1hcFRpcCBBY3Rpb25zIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1ydW4td29ya2Zsb3ctd2l0aC1hcmd1bWVudHMiOiJSdW5zIGEgd29ya2Zsb3cgd2l0aCBhIHNldCBvZiBpbnB1dCBhcmd1bWVudHMuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jaGFuZ2UtZWRpdC1sb2ctZW50cnkiOiJDaGFuZ2UgYW4gZXhpc3RpbmcgZWRpdCBsb2cgZW50cnkuIiwibGFuZ3VhZ2UtbGF5ZXItYWN0aW9ucy10b29sdGlwIjoiQ2xpY2sgdG8gc2VlIGxheWVyIGFjdGlvbnMgYXZhaWxhYmxlIGZvciB7MH0gbGF5ZXIiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1yZWN0YW5nbGUtdG9vbHRpcCI6IkRyYXcgYSByZWN0YW5nbGUgb24gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWZyZWVoYW5kLWRlc2MiOiJIb2xkIHRoZSBtb3VzZSBidXR0b24gb3IgeW91ciBmaW5nZXJ0aXAgZG93biwgdGhlbiBkcmF3IGEgZnJlZWhhbmQgbGluZS4iLCJsYW5ndWFnZS10b29sYmFyLXNuYXBwaW5nLWRpc2FibGUiOiJEaXNhYmxlIFNuYXBwaW5nIiwibGFuZ3VhZ2UtbGF5ZXJsaXN0LWRlZmF1bHQtZm9sZGVyLXRpdGxlIjoiTGF5ZXIgTGlzdCBGb2xkZXIiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNvbmZpcm0iOiJEaXNwbGF5cyBhIGNvbmZpcm0uIiwibGFuZ3VhZ2UtdWktdGFibGUtdW5zb3J0ZWQiOiJDb2x1bW4gaGVhZGVyLiB7MH0gLSBVbnNvcnRlZCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdXBkYXRlLWZlYXR1cmUiOiJVcGRhdGVzIGVpdGhlciBhIG5ldyBvciBleGlzdGluZyBmZWF0dXJlLiIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3Mta2lsb2J5dGVzIjoiezB9IGtCIiwibGFuZ3VhZ2UtbWVudS1idWZmZXItaWRlbnRpZnktZmVhdHVyZS1kZXNjIjoiSWRlbnRpZnkgbmVhcmJ5IGZlYXR1cmVzIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWxsaXBzZS10b29sdGlwIjoiRHJhdyBhbiBlbGxpcHNlIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWZzbS1jb2xsZWN0aW9uLXNldC1jb21tYW5kIjoiU2V0IHRoZSBwcmVmZXJyZWQgY29tbWFuZCB0byBvcGVuIHRoZSBmZWF0dXJlIHNldCBjb2xsZWN0aW9uIGZvciB0aGUgZ2l2ZW4gc291cmNlIG5hbWUuIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1wcmludC1tYXAtdG9vbHRpcCI6IkNyZWF0ZSBhIHByaW50YWJsZSB2ZXJzaW9uIG9mIHRoZSBtYXAiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWFyY2dpcyI6IkFyY0dJUyIsImxhbmd1YWdlLXRvb2xiYXItbWVudS1nbG9iYWwtc2F2ZSI6IlNhdmUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXRvZ2dsZS1kYXRhLWZyYW1lIjoiQWN0aXZhdGVzIG9yIGRlYWN0aXZhdGVzIGRhdGEgZnJhbWUuIiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1iYXNlbWFwZG93bmxvYWQtY29tcGxldGVkIjoiezB9IGRvd25sb2FkZWQuIiwibGFuZ3VhZ2UtY29tbW9uLWRlbGV0ZSI6IkRlbGV0ZSIsImxhbmd1YWdlLW1lbnUtcmVzdWx0cy1hZGQtZmVhdHVyZS1kZXNjIjoiQWRkIHRoaXMgZmVhdHVyZSB0byB0aGUgY3VycmVudCBzZXQgb2YgcmVzdWx0cyIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXN0eWxlLWRvdCI6IkRvdCIsImxhbmd1YWdlLWNvbW1vbi1kb25lIjoiRG9uZSIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3MtYnl0ZXMtcGVyLXNlY29uZCI6InswfSBieXRlcy9zIiwibGFuZ3VhZ2UtdG9vbGJhci1zaG93LWxheWVybGlzdC1kZXNjIjoiRGlzcGxheSB0aGUgbGlzdCBvZiBhdmFpbGFibGUgbGF5ZXJzIiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2VhcmNoLWRlc2MiOiJTZWFyY2ggZm9yIGZlYXR1cmVzIG9uIHRoZSBtYXAuIiwibGFuZ3VhZ2UtbWVudS1lbnRlci1vZmZsaW5lIjoiR28gdG8gb2ZmbGluZSBtb2RlIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtaW50ZXJzZWN0LWRlc2MiOiJPbmx5IHNob3cgcmVzdWx0cyB0aGF0IGFyZSBpbiBib3RoIHlvdXIgY3VycmVudCBsaXN0IGFuZCBhIHNhdmVkIHNldCBvZiByZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1zaGFyZSI6IlNoYXJlIiwibGFuZ3VhZ2UtY29udGVudC1wb2xpY3ktcHJvbXB0LXVyaS1yZWplY3QtYnRuIjoiTm8sIGRvIG5vdCBsb2FkIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1wb2x5Z29uLWRlc2Mta2V5Ym9hcmQiOiJUbyBsZWFybiB3aGF0XHUyMDE5cyB0aGVyZSwgdXNlIGFycm93cyB0byBtb3ZlIHRoZSBwb2ludC4gSGl0IEVOVEVSIHRvIHBsb3QgYW5kIGJlZ2luIG1vdmluZyB0aGUgbmV4dCBwb2ludC4gSGl0IEVOVEVSIHR3aWNlIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS1tZW51LXJlc3VsdHMtcmVtb3ZlLWZlYXR1cmUiOiJSZW1vdmUgZnJvbSBSZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtdGV4dCI6IlRleHQiLCJsYW5ndWFnZS1zdGF0ZXMtc25hcHBpbmctZGVzY3JpcHRpb24iOiJTbmFwcGluZyBpcyBlbmFibGVkIGZvciB0aGUgY3VycmVudCB0b29sLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBvaW50LWRlc2Mta2V5Ym9hcmQiOiJVc2UgYXJyb3dzIHRvIG1vdmUgdGhlIHBvaW50LiBIaXQgRU5URVIgdG8gYWRkIGl0IHRvIHRoZSBtYXAuIiwibGFuZ3VhZ2Utb2ZmbGluZS1lcnJvcnMtYnVuZGxlb2ZmaWxpbmUiOiJDYW5ub3QgY3JlYXRlIGEgYnVuZGxlIHdoaWxlIG9mZmxpbmUuIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW5vZGF0YSI6Ik5vIHN5bWJvbGl6YWJsZSBkYXRhIHdhcyBmb3VuZCBpbiB0aGUgc2VsZWN0ZWQgYXR0cmlidXRlLiIsImxhbmd1YWdlLW1lbnUtY29tYmluZS1yZXN1bHRzLXN1YnRyYWN0IjoiU3VidHJhY3Qgc2F2ZWQgcmVzdWx0cyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtZWRpdGluZyI6IkVkaXQgRHJhd2luZ3MiLCJsYW5ndWFnZS1wcm9qZWN0LWVycm9yLXRpdGxlIjoiUHJvamVjdCBFcnJvciIsImxhbmd1YWdlLWNvb3JkaW5hdGVzLXNvdXRoLWFiYnJldiI6IlMiLCJsYW5ndWFnZS1zdGF0ZXMtcGxvdGNvb3JkaW5hdGVzLXN0YXRlLWRlc2NyaXB0aW9uIjoiVGhlIFBsb3QgQ29vcmRpbmF0ZXMgdG9vbCBpcyBjdXJyZW50bHkgYWN0aXZlLiIsImxhbmd1YWdlLXJlc3VsdHMtbWVudS1kZXNjcmlwdGlvbiI6IkZlYXR1cmUgQWN0aW9ucyBmb3IgUmVzdWx0cyBMaXN0IiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zdGVwLXpvb20taW4iOiJab29tcyBpbiBhIHN0ZXAiLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMtdGl0bGUiOiJNYXAgU2VydmljZSBBY3Rpb25zIiwibGFuZ3VhZ2UtY29vcmRpbmF0ZXMtbm9ydGgtYWJicmV2IjoiTiIsImxhbmd1YWdlLWNvbW1vbi1zYXZpbmciOiJTYXZpbmcuLi4iLCJsYW5ndWFnZS1tZW51LWFkZC1hLWZlYXR1cmUtZGVzYyI6IkNyZWF0ZSBhIG5ldyBmZWF0dXJlIG9uIHRoaXMgbGF5ZXIuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWRpdC1kZXNjIjoiQ2xpY2sgb3IgdGFwIGFuIGV4aXN0aW5nIGRyYXdpbmcgdG8gYmVnaW4gZWRpdGluZyBpdC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXRvZ2dsZS12aWV3IjoiQWN0aXZhdGVzIG9yIGRlYWN0aXZhdGVzIGEgdmlldy4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWZyZWVoYW5kIjoiRnJlZWhhbmQiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXRha2UtYXBwbGljYXRpb24tb25saW5lIjoiQ29ubmVjdHMgdGhlIGFwcGxpY2F0aW9uIHRvIHRoZSBpbnRlcm5ldC4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvbHlsaW5lIjoiTGluZSIsImxhbmd1YWdlLWNvbW1vbi1kZWFjdGl2YXRlLXRvb2wiOiJEZWFjdGl2YXRlIFRvb2wiLCJsYW5ndWFnZS10b29sYmFyLW11bHRpdG9vbCI6Ik11bHRpLXRvb2wiLCJsYW5ndWFnZS1tZW51LXNob3ctY2hhcnRpbmctdmlldy1kZXNjIjoiU3dpdGNoIHRvIGNoYXJ0aW5nIHZpZXciLCJsYW5ndWFnZS1tZW51LWxhYmVsLW9wdGlvbnMiOiJDdXN0b21pemUgbGFiZWxzIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1hZGQtdGV4dC1tYXJrdXAiOiJQcm9tcHRzIHRoZSB1c2VyIGZvciB0ZXh0IHRvIGFkZCBhcyBtYXJrdXAuIFdoZW4gY29tcGxldGVkLCB0ZXh0IG1hcmt1cCBpcyBhZGRlZCBhdCB0aGUgcHJvdmlkZWQgZ2VvbWV0cnkuIiwibGFuZ3VhZ2UtdG9vbGJhci10b2dnbGUtYnVmZmVyLW9mZi1uYW1lIjoiQnVmZmVyaW5nIE9uIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi16b29tLW91dC10by1leHRlbnQiOiJab29tcyBvdXQgdG8gdGhlIGdpdmVuIGV4dGVudC4iLCJsYW5ndWFnZS1tZW51LW1hcHRpcC1hY3Rpb25zLXZpZXctZGV0YWlscy1kZXNjIjoiVmlldyBhZGRpdGlvbmFsIGRldGFpbHMgYWJvdXQgdGhpcyBmZWF0dXJlIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWZpbGwtc3R5bGUtdmVydGljYWwiOiJWZXJ0aWNhbCIsImxhbmd1YWdlLW1lbnUtcnVuLXdvcmtmbG93IjoiUGVyZm9ybSBhIHRhc2siLCJsYW5ndWFnZS1wYWdlLWRpc3BsYXlpbmciOiJEaXNwbGF5aW5nIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWZpbGwtc3R5bGUtY3Jvc3MiOiJDcm9zcyIsImxhbmd1YWdlLWdyYW50LWVkaXRvci10YWJsZS1oZWFkZXItbm9uZSI6Ik5vbmUiLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLW1lZ2FieXRlcy1wZXItc2Vjb25kIjoiezB9IE1CL3MiLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctbWFuYWdlLW9mZmxpbmUtZGF0YSI6Ik1hbmFnZSBPZmZsaW5lIERhdGEiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWFkZC1sYXllcnMtdG9vbHRpcCI6IkFkZCBsYXllcnMgdG8gdGhlIG1hcCIsImxhbmd1YWdlLXBhZ2UtZmlyc3QiOiJGaXJzdCBwYWdlIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC10b29scyI6IlRvb2xzIiwibGFuZ3VhZ2UtdG9vbGJhci1lZGl0aW5nLWNyZWF0ZS1uZXctZmVhdHVyZS1nZW9sb2NhdGlvbiI6IlVzZSBHZW9sb2NhdGlvbiIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1icmVha3MiOiJOdW1iZXIgT2YgQ2xhc3NlczoiLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctZGF0YSI6IkRhdGEiLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLXJlbW92aW5nb2ZmbGluZW1hcCI6IlJlbW92aW5nIG9mZmxpbmUgbWFwLiIsImxhbmd1YWdlLW1lbnUtY2VudGVyLW1hcCI6IkNlbnRlciB0aGUgTWFwIEhlcmUiLCJsYW5ndWFnZS1tZW51LXJlc3VsdHMtdGFibGUtYWN0aW9ucy1kZXNjIjoiUmVzdWx0cyBUYWJsZSBBY3Rpb25zIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1vcGVuLWZlYXR1cmUtc2V0LWNvbGxlY3Rpb24iOiJPcGVucyB0aGUgZmVhdHVyZSBzZXQgY29sbGVjdGlvbi4iLCJsYW5ndWFnZS1jb21tb24tbm90aWZpY2F0aW9uIjoiTm90aWZpY2F0aW9uIiwibGFuZ3VhZ2UtbGF5ZXJzZWxlY3Rvci1pY29uLXRvb2x0aXAiOiJ7MH0gaWNvbiIsImxhbmd1YWdlLXN0YXRlcy1kZWZhdWx0LWRlc2NyaXB0aW9uIjoiVGhlIHZpZXdlciBjdXJyZW50bHkgaGFzIG5vdGhpbmcgYWN0aXZlLiIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9pbnQtZGVzYyI6IkNsaWNrIG9yIHRhcCBhIGxvY2F0aW9uIG9uIHRoZSBtYXAgdG8gbGVhcm4gd2hhdFx1MjAxOXMgdGhlcmUuIiwibGFuZ3VhZ2UtdG9vbGJhci1idWZmZXJpbmctZW5hYmxlIjoiRW5hYmxlIGJ1ZmZlcmluZyIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXN0eWxlLXNob3J0ZGFzaGRvdCI6IlNob3J0LWRhc2gtZG90IiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1wb2x5Z29uLXRvb2x0aXAiOiJEcmF3IGEgY3VzdG9tIHNoYXBlIG9uIHRoZSBtYXAgdG8gZmluZCBvdXQgYWJvdXQgYW4gYXJlYSIsImxhbmd1YWdlLXRvb2xiYXItc2VsZWN0LWxheWVycy10b2dnbGUtb2ZmLW5hbWUiOiJMYXllcnMgYXJlIEZpbHRlcmVkIiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1jb21wbGV0ZSI6IkNvbXBsZXRlLiIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3Mtc3RhcnRpbmctc3luYyI6IlN0YXJ0aW5nIGZlYXR1cmUgbGF5ZXIgc3luYy4iLCJsYW5ndWFnZS1tZW51LWV4cG9ydC1yZXN1bHRzLXRvLWNzdiI6IkV4cG9ydCB0byBDU1YiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1jaXJjbGUtdG9vbHRpcCI6IkRyYXcgYSBjaXJjbGUgb24gdGhlIG1hcCIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtcmVjdGFuZ2xlLWRlc2MiOiJEcmF3IGEgcmVjdGFuZ2xlIGZvciB0aGUgYXJlYSBvZiBpbnRlcmVzdCBnZW9tZXRyeS4iLCJsYW5ndWFnZS1tZW51LWdsb2JhbC1vcGVuLWRlc2MiOiJDaG9vc2UgYSBwcmV2aW91c2x5IHNhdmVkIHByb2plY3QgdG8gcmVzdG9yZSB0aGUgc2F2ZWQgc3RhdGUiLCJsYW5ndWFnZS1wcm9qZWN0LWVycm9yLXJlYWQiOiJUaGUgcHJvamVjdCBjb3VsZCBub3QgYmUgb3BlbmVkLiBSZWZlciB0byB0aGUgbG9nIGZvciBtb3JlIGRldGFpbHMuIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWNvbG9yIjoiQ29sb3IiLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXItZGVzYyI6IlNlbGVjdCBhIGZlYXR1cmUgdHlwZS4iLCJsYW5ndWFnZS10b29sYmFyLTNyZC1wYXJ0eS1tYXBzLXNob3ctbWFwcy10b29sdGlwIjoiRGlzcGxheSBsaW5rZWQgbWFwcyBpbiB0aGUgZXh0ZXJuYWwgY29tcG9uZW50IHZpZXciLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNsZWFyLW1hcmt1cC1xdWlldCI6IkNsZWFycyBhbGwgb2YgdGhlIG1hcmt1cCBmcm9tIHRoZSBtYXJrdXAgbGF5ZXIgd2l0aG91dCBwcm9tcHRpbmcgZm9yIGNvbmZpcm1hdGlvbi4iLCJsYW5ndWFnZS1tZW51LXBsb3QtY29vcmRpbmF0ZS1kZXNjIjoiUGxvdCBhIGNvb3JkaW5hdGUgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS10b29sYmFyLWJ1ZmZlcmluZy1hbHQtZW5hYmxlIjoiRW5hYmxlIGJ1ZmZlcmluZyBmb3IgYWN0aXZlIHRvb2wiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWxheWVycy1jaGFuZ2UiOiJJZGVudGlmaWFibGUgTGF5ZXJzIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1wb2x5bGluZS10b29sdGlwIjoiRmluZCBvdXQgYWJvdXQgYW4gYXJlYSBvbiB0aGUgbWFwIGRlZmluZWQgYnkgYSBsaW5lIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci10ZW1wb3JhcnktbWFya3VwIjoiUmVtb3ZlcyB0ZW1wb3JhcnkgbWFya3VwIGNyZWF0ZWQgYnkgQWRkVGVtcG9yYXJ5TWFya3VwR2VvbWV0cnkuIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtZGVzYyI6IlBlcmZvcm0gYWR2YW5jZWQgb3BlcmF0aW9ucyB3aXRoIG11bHRpcGxlIGxpc3RzIG9mIHJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1yZWN0YW5nbGUiOiJSZWN0YW5nbGUiLCJsYW5ndWFnZS1vZmZsaW5lLWVycm9ycy1pc2FjdGl2ZSI6IkNhbm5vdCByZW1vdmUgdGhlIGFjdGl2ZSBvZmZsaW5lIG1hcC4iLCJsYW5ndWFnZS10b29sYmFyLXRhYi1lZGl0aW5nIjoiRWRpdGluZyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWhpZ2hsaWdodC1maWxsLWNvbG9yIjoiU2V0cyB0aGUgZmlsbCBjb2xvciB1c2VkIGZvciBuZXcgaGlnaGxpZ2h0cywgc3BlY2lmaWVkIGluIDYgb3IgOCBkaWdpdCBoZXggaW4gUkdCIG9yIEFSR0IgZm9ybS4iLCJsYW5ndWFnZS10b29sYmFyLWFuYWx5c2lzLWxvY2F0aW9uLWluZm9ybWF0aW9uIjoiTG9jYXRpb24gSW5mb3JtYXRpb24iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS1zdHlsZS1kYXNoZG90ZG90IjoiRGFzaC1kb3QtZG90IiwibGFuZ3VhZ2UtbWVudS1sYWJlbC1vcHRpb25zLXRvZ2dsZSI6IlRvZ2dsZSBsYWJlbHMiLCJsYW5ndWFnZS1ncmFudC1lZGl0b3ItbW9uaWtlci10eXBlLXJvbGUiOiJHcm91cHMiLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLWJhc2VtYXBleHBvcnQtcHJvY2Vzc2luZyI6InswfSBnZW5lcmF0aW5nLi4uIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLXpvb20taW4iOiJab29tIEluIiwibGFuZ3VhZ2UtbWVudS1yZXN1bHRzLWFkZC1mZWF0dXJlIjoiQWRkIHRvIFJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLWNsZWFyLWFsbCI6IkNsZWFyIiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1iYXNlbWFwZXhwb3J0LWZhaWxlZCI6InswfSBmYWlsZWQuIHsxfSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZmVhdHVyZS1sYXllci1jbGVhci1jYWNoZS1zcGVjIjoiU3BlY2lmeSB0aGlzIGxheWVyIGFzIG5vdCB0byBiZSBjYWNoZWQgb24gbmV4dCBzeW5jLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVtb3ZlLWhpZ2hsaWdodC1sYXllciI6IlJlbW92ZXMgdGhlIGhpZ2hsaWdodCBsYXllciB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSwgaWYgdGhlcmUgaXMgb25lLiIsImxhbmd1YWdlLXRvb2xiYXItYXJjZ2lzLXZpZXctbXktY29udGVudC10b29sdGlwIjoiVmlldyB5b3VyIGNvbnRlbnQgc3RvcmVkIGluIEFyY0dJUyIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1tYXJrZXItc3R5bGUtZGlhbW9uZCI6IkRpYW1vbmQiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS1zdHlsZSI6IkxpbmUgU3R5bGUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwLWNhbGxvdXQiOiJEaXNwbGF5cyBhIG1hcCBjYWxsb3V0IGFuY2hvcmVkIHRvIGEgZ2l2ZW4gcG9pbnQuIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1wcmludGluZyI6IlByaW50aW5nIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZHJhd2luZyI6IkNyZWF0ZSIsImxhbmd1YWdlLWNvbnRlbnQtcG9saWN5LXByb21wdC11cmktYWNjZXB0LWJ0biI6IlllcyIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWNoYW5nZS1tYXJrdXAtc3R5bGUiOiJTdHlsZXMiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tZnVsbC1leHRlbnQtdG9vbHRpcCI6IlJldHVybiB0byB0aGUgZnVsbCBleHRlbnQgb2YgdGhlIG1hcCIsImxhbmd1YWdlLXJlc3VsdHMtZXhwb3J0LXRvLWNvbmZpcm0tY29udGVudCI6IlRoZSBcIi57MH1cIiBmaWxlIGlzIGFib3V0IHRvIGJlIGRvd25sb2FkZWQuIENvbmZpcm0/IiwibGFuZ3VhZ2UtbWVudS1mb290ZXItbWVudS1kZXNjIjoiRm9vdGVyIE1lbnUiLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMtZGVzYyI6IkRpc3BsYXkgYSBsaXN0IG9mIG1hcCBzZXJ2aWNlIGFjdGlvbnMiLCJsYW5ndWFnZS1tZW51LW1hcC1sYXllcnMtZXhwYW5kIjoiRXhwYW5kIGFuZCBjb2xsYXBzZSB7MH0gbGF5ZXIgZ3JvdXAiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1mcmVlaGFuZC1wb2x5Z29uLXRvb2x0aXAiOiJEcmF3IGEgZnJlZWhhbmQgc2hhcGUgb24gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItbWVudS1nbG9iYWwtc2F2ZS1hcy1kZXNjIjoiU2F2ZSB0aGUgc3RhdGUgb2YgeW91ciB2aWV3ZXIgaW4gYSBuZXcgcHJvamVjdCIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3MtZ2lnYWJ5dGVzIjoiezB9IEdCIiwibGFuZ3VhZ2UtbWVudS16b29tLXRvLXZpc2libGUtc2NhbGUiOiJab29tIHRvIHZpc2libGUgc2NhbGUiLCJsYW5ndWFnZS1wcm9qZWN0LWVycm9yLXJlYWQtZGVuaWVkIjoiWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gb3BlbiB0aGlzIHByb2plY3QuIiwibGFuZ3VhZ2UtbWVudS1hZGQtdGV4dC1kZXNjIjoiQWRkIHNvbWUgdGV4dCB0byB0aGUgbWFwLiIsImxhbmd1YWdlLW1lbnUtY29tYmluZS1yZXN1bHRzIjoiQ29tYmluZSBSZXN1bHRzIiwibGFuZ3VhZ2UtY29vcmRpbmF0ZXMtd2VzdC1hYmJyZXYiOiJXIiwibGFuZ3VhZ2UtbWVudS1ib29rbWFyay1hZGQtZGVzYyI6IkFkZCB0aGUgY3VycmVudCBtYXAgZXh0ZW50IHRvIHRoZSBsaXN0IG9mIGJvb2ttYXJrcywgc28gdGhhdCBJIGNhbiByZXR1cm4gdG8gaXQgbGF0ZXIuIiwibGFuZ3VhZ2UtdG9vbGJhci1lcmFzZSI6IkVyYXNlIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zdHlsZSI6Ik1hcmtlciBTdHlsZSIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWVsbGlwc2UtZGVzYyI6IkNsaWNrIGFuZCBkcmFnIHRvIGRyYXcgYW4gZWxsaXBzZSBvbiB0aGUgbWFwLiIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1maWxsLXN0eWxlLW51bGwiOiJOb25lIiwibGFuZ3VhZ2Utc2VhcmNoLWZzYy1kaXNwbGF5LW5hbWUiOiJTZWFyY2ggUmVzdWx0czogezB9IiwibGFuZ3VhZ2Utb2ZmbGluZS1lcnJvcnMtY2FuY2VsZWQiOiJDYW5jZWxlZC4iLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLWJhc2VtYXBkb3dubG9hZC1jb25uZWN0aW5nIjoiezB9IGNvbm5lY3RpbmcuLi4iLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWN1cnJlbnRleHRlbnQtZGVzYyI6IlVzZSB0aGUgY3VycmVudCBleHRlbnQgZm9yIHRoZSBhcmVhIG9mIGludGVyZXN0IGdlb21ldHJ5LiIsImxhbmd1YWdlLXRvb2xiYXItc25hcHBpbmctc2VsZWN0LWxheWVycyI6IlNlbGVjdCBTbmFwcGluZyBMYXllcnMiLCJsYW5ndWFnZS1tZW51LXNob3ctcmVzdWx0cy1saXN0LWRlc2MiOiJTd2l0Y2ggdG8gTGlzdCBWaWV3IiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1maW5kLWRhdGEtdG9vbHMiOiJGaW5kIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLXpvb20taW4tdG9vbHRpcCI6IkRyYXcgYW4gYXJlYSBvbiB0aGUgbWFwIHRvIHpvb20gdG8iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvaW50LWRlc2Mta2V5Ym9hcmQiOiJVc2UgYXJyb3dzIHRvIG1vdmUgdGhlIHBvaW50LiBIaXQgRU5URVIgdG8gbGVhcm4gd2hhdFx1MjAxOXMgdGhlcmUuIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1mcmVlaGFuZC1wb2x5Z29uIjoiRnJlZWhhbmQgU2hhcGUgSWRlbnRpZnkiLCJsYW5ndWFnZS1yZXN1bHRzLXBhZ2UiOiJQYWdlIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtdW5pb24tZGVzYyI6IkNvbWJpbmUgYSBzYXZlZCBzZXQgb2YgcmVzdWx0cyB3aXRoIHlvdXIgY3VycmVudCByZXN1bHRzIGxpc3QiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS13aWR0aCI6IkxpbmUgV2lkdGgiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWVkaXQiOiJFZGl0IiwibGFuZ3VhZ2UtbGF5ZXJsaXN0LXVzZXItYWRkZWQtbGF5ZXJzLWZvbGRlci10aXRsZSI6IlVzZXIgQWRkZWQgTGF5ZXJzIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWxpbmUtdG9vbHRpcCI6IkRyYXcgYSBsaW5lIG9uIHRoZSBtYXAiLCJsYW5ndWFnZS1tZW51LXJlbW92ZS11c2VyLWFkZGVkLWxheWVyIjoiUmVtb3ZlIGxheWVyIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtY2lyY2xlIjoiQ2lyY2xlIiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1tZWdhYnl0ZXMiOiJ7MH0gTUIiLCJsYW5ndWFnZS1zbWFydC1wYW5lbC1tYXhpbWl6ZS1yZXN0b3JlIjoiTWF4aW1pemUvUmVzdG9yZSBQYW5lbCIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy10b29scyI6IkVkaXQgRmVhdHVyZXMiLCJsYW5ndWFnZS1tZW51LXJ1bi1yZXBvcnQiOiJSdW4gYSBSZXBvcnQiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtdHJhbnNwYXJlbmN5IjoiVHJhbnNwYXJlbmN5IiwibGFuZ3VhZ2UtdG9vbGJhci10aW1lc2xpZGVyLXNob3d0aW1lc2xpZGVyIjoiVGltZSBTbGlkZXIiLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLXNhdmluZ29mZmxpbmVtYXAiOiJTYXZpbmcgb2ZmbGluZSBtYXAuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZGVsZXRlLXRvb2x0aXAiOiJEZWxldGUgYW4gZXhpc3RpbmcgZHJhd2luZyIsImxhbmd1YWdlLWdyYW50LWVkaXRvci10YWJsZS1oZWFkZXItdmlldyI6IlZpZXciLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS10ZW1wbGF0ZS1waWNrZXIiOiJDcmVhdGUgTmV3IEZlYXR1cmUiLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMiOiJQZXJmb3JtIGFuIGFjdGlvbiBvbiB7MH0iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWluaXRpYWxpemUtc2l0ZSI6IlRlbGxzIHRoZSBHZW9jb3J0ZXggRXNzZW50aWFscyBTaXRlIG9iamVjdCB0byBiZWdpbiBpbml0aWFsaXphdGlvbi4iLCJsYW5ndWFnZS1tZW51LWxhYmVsLW9wdGlvbnMtdG9nZ2xlLWRlc2MiOiJUdXJuIHRoZSBsYXllcidzIGxhYmVscyBvbiBvciBvZmYuIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1mcmVlaGFuZC1wb2x5Z29uLXRvb2x0aXAiOiJJZGVudGlmeSB0aGluZ3Mgb24gdGhlIG1hcCBieSBkcmF3aW5nIGEgZnJlZWhhbmQgc2hhcGUiLCJsYW5ndWFnZS10b29sYmFyLW5hdGl2ZS1zaG93b2ZmbGluZW1hcHMiOiJPZmZsaW5lIE1hcHMiLCJsYW5ndWFnZS1tZW51LXJ1bi13b3JrZmxvdy1kZXNjIjoiU2VsZWN0IGZyb20gYSBsaXN0IG9mIGF2YWlsYWJsZSB0YXNrcy4iLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLWxheWVycyI6IkxheWVycyIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXN0eWxlLXNob3J0ZGFzaGRvdGRvdCI6IlNob3J0LWRhc2gtZG90LWRvdCIsImxhbmd1YWdlLW1lbnUtYnVmZmVyLWlkZW50aWZ5LWZlYXR1cmUiOiJTaG93IEJ1ZmZlciBPcHRpb25zIiwibGFuZ3VhZ2UtcHJvamVjdC1lcnJvci13cml0ZS1kZW5pZWQiOiJZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBzYXZlIHRoaXMgcHJvamVjdC4iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS1zdHlsZS1zaG9ydGRhc2giOiJTaG9ydC1kYXNoIiwibGFuZ3VhZ2UtdG9vbGJhci1vcGVuLXRvb2xiYXIiOiJPcGVuIHRvb2xiYXIiLCJsYW5ndWFnZS1vZmZsaW5lLWVycm9ycy1sb2FkZmFpbGVkIjoiVW5hYmxlIHRvIGxvYWQuIiwibGFuZ3VhZ2UtdG9vbGJhci10YWItbWFwIjoiTWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1mcmVlaGFuZC1kZXNjIjoiQ2xpY2svdGFwIGFuZCBob2xkIGRvd24sIHRoZW4gZHJhdyBhIGZyZWVoYW5kIHNoYXBlIHRvIGxlYXJuIHdoYXRcdTIwMTlzIHRoZXJlLiIsImxhbmd1YWdlLW1lbnUtc3dpdGNoLXRvLWxheWVybGlzdC1kZXNjIjoiRGlzcGxheSB0aGUgbGlzdCBvZiBhdmFpbGFibGUgbGF5ZXJzIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uIjoiTmF2aWdhdGlvbiIsImxhbmd1YWdlLXByb2plY3QtZXJyb3ItcmVhZC1ub3QtZm91bmQiOiJDb3VsZCBub3QgZmluZCBhIHByb2plY3Qgd2l0aCBJRCBcInswfVwiLiIsImxhbmd1YWdlLXRvb2xiYXItbWVudS1nbG9iYWwtb3BlbiI6Ik9wZW4iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS1zdHlsZS1sb25nZGFzaGRvdCI6IkxvbmctZGFzaC1kb3QiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlbGV0ZS1mZWF0dXJlIjoiRGVsZXRlcyBlaXRoZXIgYSBuZXcgb3IgZXhpc3RpbmcgZmVhdHVyZS4iLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tZnVsbC1leHRlbnQiOiJGdWxsIEV4dGVudCIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtcHJpbnQtbWFwIjoiUHJpbnQiLCJsYW5ndWFnZS1zZWNvbmRzLWFiYnIiOiJTIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1lZGl0LWZlYXR1cmVzIjoiRWRpdCBGZWF0dXJlcyIsImxhbmd1YWdlLWxheWVybGlzdC1vcGVyYXRpb25hbC1tYXBzLWZvbGRlci10aXRsZSI6Ik9wZXJhdGlvbmFsIExheWVycyIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtaWRlbnRpZnktdG9vbHRpcCI6IkZpbmQgZGF0YSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2VhcmNoIjoiU2VhcmNoIiwibGFuZ3VhZ2UtdG9vbGJhci1hcmNnaXMtZXhwb3J0LXdlYi1tYXAiOiJTYXZlIHRvIEFyY0dJUyIsImxhbmd1YWdlLWNvbW1vbi1yZXN1bHRzLXVuaW9uLWNvbmZpcm1hdGlvbiI6Iid7MH0nIHVuaW9uZWQgd2l0aCB7MX0iLCJsYW5ndWFnZS1tZW51LXByb2plY3QtYWN0aW9ucy1kZXNjIjoiVmlldyBvcHRpb25zIHJlbGF0ZWQgdG8gdGhlIHByb2plY3QuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWdvbi1kZXNjIjoiQ2xpY2sgb3IgdGFwIGxvY2F0aW9ucyB0byBkZWZpbmUgYSBwb2x5Z29uLiBEb3VibGUtY2xpY2svdGFwIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS1yZXN1bHRzLXBhZ2Utb2YiOiJvZiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24taWRlbnRpZnkiOiJFeGVjdXRlcyBhbiBpZGVudGlmeSBvcGVyYXRpb24gb24gYSBnZW9tZXRyeS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWFkZC10ZW1wb3JhcnktbWFya3VwLWdlb21ldHJ5IjoiQWRkcyBhIHRlbXBvcmFyeSBtYXJrdXAgZ3JhcGhpYyB0byB0aGUgbWFwLiBUaGUgQ2xlYXJUZW1wb3JhcnlNYXJrdXAgY29tbWFuZCB3aWxsIGNsZWFyIHRoaXMgbWFya3VwLiIsImxhbmd1YWdlLWNvbW1vbi1jbG9zZSI6IkNsb3NlIiwibGFuZ3VhZ2UtdG9vbGJhci1zbmFwcGluZy1lbmFibGUiOiJFbmFibGUgU25hcHBpbmciLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNsb3NlLXJlc3VsdHMtZnJhbWUiOiJEZWFjdGl2YXRlcyB0aGUgUmVzdWx0c1JlZ2lvbi4iLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LWJ1ZmZlcmVkLWZlYXR1cmUtc2V0LWNvbGxlY3Rpb24tZGVzYyI6IklkZW50aWZ5IGZlYXR1cmVzIG5lYXIgdGhlc2UgcmVzdWx0cyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtM3JkLXBhcnR5LW1hcHMiOiJMaW5rZWQgTWFwcyIsImxhbmd1YWdlLXN0YXRlcy1mZWF0dXJlLWVkaXRpbmctc3RhdGUtZ3JhcGhpYy1kZXNjcmlwdGlvbiI6IlRoZSBjcmVhdGUgYSBmZWF0dXJlIHRvb2wgaXMgY3VycmVudGx5IGVkaXRpbmcgYSBncmFwaGljLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tYWN0aXZhdGUtdmlldyI6IkFjdGl2YXRlcyBhIHZpZXcuIiwibGFuZ3VhZ2UtcmVzdWx0cy10b2dnbGUtdGFibGUtdmlldyI6IlN3aXRjaCB0byBUYWJsZSIsImxhbmd1YWdlLXJlc3VsdHMtdG9nZ2xlLWxpc3Qtdmlldy1kZXNjIjoiVmlldyByZXN1bHRzIGluIGxpc3QgZm9ybWF0IiwibGFuZ3VhZ2UtbWVudS16b29tLXRvLWxheWVyLWRlc2MiOiJab29tIHRoZSBtYXAgdG8gdGhlIGZ1bGwgZXh0ZW50IG9mIHRoZSBsYXllci4iLCJsYW5ndWFnZS10b29sYmFyLXRhYi1vZmZsaW5lIjoiT2ZmbGluZSIsImxhbmd1YWdlLXRvb2xiYXItbWVudS1nbG9iYWwtc2F2ZS1kZXNjIjoiU2F2ZSB0aGUgc3RhdGUgb2YgeW91ciB2aWV3ZXIgaW4gYSBwcm9qZWN0IiwibGFuZ3VhZ2UtbWVudS1zaG93LXJlc3VsdHMtdGFibGUtZGVzYyI6IlN3aXRjaCB0byBUYWJsZSBWaWV3IiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1zYXZlLWFzIjoiU2F2ZSBhcyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdXBkYXRlLWF0dGFjaG1lbnQiOiJVcGRhdGVzIGEgZmVhdHVyZSBhdHRhY2htZW50LiIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXN0eWxlLWRhc2hkb3QiOiJEYXNoLWRvdCIsImxhbmd1YWdlLWNvbW1vbi1yZXN1bHRzLXJlcGxhY2UtY29uZmlybWF0aW9uIjoiJ3swfScgcmVwbGFjZWQgd2l0aCB7MX0iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbWFya2VyLXNpemUiOiJNYXJrZXIgU2l6ZSIsImxhbmd1YWdlLW1lbnUtaWRlbnRpZnktcG9pbnQiOiJJZGVudGlmeSBieSBwb2ludCIsImxhbmd1YWdlLXRvb2xiYXItdGFiLWhvbWUiOiJIb21lIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1yZW1vdmUtc3RhdHVzIjoiUmVtb3ZlcyB0aGUgc3RhdHVzIGluZGljYXRvciBmcm9tIHRoZSBzY3JlZW4gd2l0aCB0aGUgc3BlY2lmaWVkIElELiIsImxhbmd1YWdlLW1lbnUtZXhwb3J0LXJlc3VsdHMtdG8teGxzeC1kZXNjIjoiRXhwb3J0IHJlc3VsdHMgdG8gWExTWCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdG9nZ2xlLXJlc3VsdHMtZnJhbWUiOiJBY3RpdmF0ZXMgb3IgZGVhY3RpdmF0ZXMgUmVzdWx0cyBmcmFtZS4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0LXRvb2x0aXAiOiJFZGl0IGFuIGV4aXN0aW5nIGRyYXdpbmciLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXJlbW92ZS1mZWF0dXJlLXNldC1jb2xsZWN0aW9uLWJ5LWlkIjoiUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNvbGxlY3Rpb24gZnJvbSB0aGUgZmVhdHVyZSBzZXQgbWFuYWdlci4iLCJsYW5ndWFnZS1sYXllcnNlbGVjdG9yLXN0YXRlLXRvZ2dsZSI6IlRvZ2dsZSB7MH0gbGF5ZXIgdmlzaWJpbGl0eS4iLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24taG9tZSI6IkhvbWUiLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LWRlc2MiOiJDbGljaywgdGFwLCBvciBkcmF3IGEgcmVjdGFuZ2xlIG9uIHRoZSBtYXAgdG8gaWRlbnRpZnkgZmVhdHVyZXMuIiwibGFuZ3VhZ2UtbGF5ZXItYWN0aW9ucy1kZXNjIjoiRGlzcGxheSBhIGxpc3Qgb2YgbGF5ZXIgYWN0aW9ucyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcnVuLXdvcmtmbG93LXdpdGgtZ2VvbWV0cnkiOiJSdW5zIGEgd29ya2Zsb3cgd2l0aCBhIGdlb21ldHJ5IHVzZWQgYXMgYW4gaW5wdXQgYXJndW1lbnQuIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLWluaXRpYWwtZXh0ZW50LXRvb2x0aXAiOiJSZXR1cm4gdG8gdGhlIGluaXRpYWwgcG9zaXRpb24gb2YgdGhlIG1hcCIsImxhbmd1YWdlLWNvb3JkaW5hdGVzLWRlZ3JlZXMiOiLCsCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1mZWF0dXJlLWxheWVyLW1vZGFsLW1lc3NhZ2UiOiJDcmVhdGVzIGEgTW9kZWxNZXNzYWdlVmlldyB2aWV3IGFuZCBkaXNwbGF5cyB0aGUgZ2l2ZW4gbWVzc2FnZS4iLCJsYW5ndWFnZS1ncmFudC1lZGl0b3ItdGFibGUtaGVhZGVyLWVkaXQiOiJFZGl0IiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWRpdCI6IkVkaXQiLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWNsZWFyIjoiQ2xlYXIiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLXNoYXJlLXRvb2x0aXAiOiJTaGFyZSB0aGUgY3VycmVudCBtYXAgb24gdGhlIG1vc3QgY29tbW9uIHNvY2lhbCBtZWRpYSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWVkaXRvci1mZWF0dXJlLWdlb21ldHJ5IjoiU2V0cyB0aGUgZ2VvbWV0cnkgb2YgdGhlIGZlYXR1cmUgdGhhdCBpcyBjdXJyZW50bHkgYmVpbmcgZWRpdGVkIGluIHRoZSBBdHRyaWJ1dGUgRWRpdG9yLCBhbmQgYWN0aXZhdGVzIHRoZSBBdHRyaWJ1dGVFZGl0b3IgVmlldy4iLCJsYW5ndWFnZS10b29sYmFyLXRpbWVzbGlkZXItc2hvd3RpbWVzbGlkZXItdG9vbHRpcCI6IkFjdGl2YXRlIHRoZSB0aW1lIHNsaWRlciIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcGFuLXRvLWZlYXR1cmUiOiJQYW5zIHRvIHRoZSBHZW9jb3J0ZXggZmVhdHVyZS4iLCJsYW5ndWFnZS1tZW51LXZpc3VhbGl6YXRpb24iOiJUdXJuIG9uL29mZiBsYXllciB2aXN1YWxpemF0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWZyZWVoYW5kLXBvbHlnb24tZGVzYyI6IkhvbGQgdGhlIG1vdXNlIGJ1dHRvbiBvciB5b3VyIGZpbmdlcnRpcCBkb3duLCB0aGVuIGRyYXcgYSBmcmVlaGFuZCBzaGFwZS4iLCJsYW5ndWFnZS1vZmZsaW5lLWVycm9ycy1idW5kbGVub3Rmb3VuZCI6IkJ1bmRsZSBub3QgZm91bmQuIiwibGFuZ3VhZ2UtY29tbW9uLXBhbi1kZXNjcmlwdGlvbiI6IlBhbiB0aGUgbWFwIHRvIGNlbnRlciB0aGlzIGZlYXR1cmUiLCJsYW5ndWFnZS1tZW51LW1hcHRpcC1hY3Rpb25zLXZpZXctZGV0YWlscyI6IlZpZXcgQWRkaXRpb25hbCBEZXRhaWxzIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLXByZXZpb3VzLWV4dGVudCI6IlByZXZpb3VzIEV4dGVudCIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtbWVhc3VyZW1lbnQtdG9vbHMiOiJNZWFzdXJlIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWdvbi10b29sdGlwIjoiRHJhdyBhIGN1c3RvbSBzaGFwZSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1kaXNwbGF5LXdvcmtmbG93LWNvbnRhaW5lci1jb250ZW50IjoiRGlzcGxheXMgYSB2aWV3IGluIGEgd29ya2Zsb3cgY29udGFpbmVyLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWVkaXQtZGVzYy1rZXlib2FyZCI6IlVzZSBhcnJvd3MgdG8gbW92ZSB0aGUgcG9pbnQuIEhpdCBFTlRFUiB0byBiZWdpbiBlZGl0aW5nIGFuIGV4aXN0aW5nIGRyYXdpbmcuIiwibGFuZ3VhZ2UtbWVudS1sYXRpdHVkZS1nZW9ncmFwaGljcy1kZXNjIjoiTGF0aXR1ZGUgR2VvZ3JhcGhpY3MgR3JvdXAgTHRkLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBvaW50IjoiUG9pbnQiLCJsYW5ndWFnZS1jb29yZGluYXRlcy1lYXN0LWFiYnJldiI6IkUiLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLWJhc2VtYXBkb3dubG9hZC1jYW5jZWxlZCI6InswfSBjYW5jZWxlZC4iLCJsYW5ndWFnZS1sYXllcnNlbGVjdG9yLWl0ZW0tZXhwYW5kIjoiQ29sbGFwc2Ugb3IgZXhwYW5kIHswfSBsYXllciBncm91cCIsImxhbmd1YWdlLXRvb2xiYXItYnVmZmVyLXRvZ2dsZS10b29sdGlwIjoiQnVmZmVyIGFuIGFyZWEgYXJvdW5kIHlvdXIgc2VsZWN0aW9uIiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2F2ZS1hcyI6IlNhdmUgYXMiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1jaXJjbGUtZGVzYyI6IkRyYWcgYSBjaXJjbGUgb24gdG8gdGhlIG1hcCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24taGlkZS1mZWF0dXJlLWxheWVyLW1vZGFsLW1lc3NhZ2UiOiJSZW1vdmVzIGEgbW9kYWwgbWVzc2FnZS4iLCJsYW5ndWFnZS1jb21tb24tc3luYy1jb21wbGV0ZSI6IlN5bmNocm9uaXphdGlvbiBjb21wbGV0ZSIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXdpZHRoLXN1ZmZpeCI6InB4IiwibGFuZ3VhZ2UtbWVudS1pZGVudGlmeS1mcmVlaGFuZC1kZXNjIjoiRHJhdyBhIHNoYXBlIHRvIHZpZXcgaW5mb3JtYXRpb24gYWJvdXQgdGhhdCBhcmVhLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBhbGV0dGUtc21hbGwtZWRpdCI6IkVkaXQiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtZmlsbC1zdHlsZS1iYWNrd2FyZC1kaWFnb25hbCI6IkJhY2t3YXJkIERpYWdvbmFsIiwibGFuZ3VhZ2UtbWVudS1zaG93LXJlc3VsdHMtdGFibGUiOiJUYWJsZSBWaWV3IiwibGFuZ3VhZ2UtbWVudS1nbG9iYWwtc2F2ZSI6IlNhdmUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctZmVhdHVyZS1kZXRhaWxzIjoiQ3JlYXRlcyBhbmQgZGlzcGxheXMgdGhlIEZlYXR1cmUgRGV0YWlscyBkaWFsb2cgZm9yIHRoZSBmZWF0dXJlIG9yIGZlYXR1cmUgc2V0IGNvbGxlY3Rpb24gc3BlY2lmaWVkLiIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1leGNlZWRlZC1tYXgtY2xhc3NlcyI6Ik1vcmUgdGhhbiB7MH0gdW5pcXVlIHZhbHVlcyB3ZXJlIGZvdW5kIGZvciB0aGlzIGF0dHJpYnV0ZS4gVGhlIHRvcCB7MH0gd2lsbCBiZSBzZWxlY3RlZCBhbmQgdXNlZCBmb3IgdGhlIHJlbmRlcmVyLiIsImxhbmd1YWdlLW1lbnUtYWRkLXRleHQiOiJBZGQgU29tZSBUZXh0IiwibGFuZ3VhZ2Utb2ZmbGluZS1lcnJvcnMtc2F2ZWZhaWxlZCI6IlVuYWJsZSB0byBzYXZlLiIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1uZXh0LWV4dGVudCI6Ik5leHQgRXh0ZW50IiwibGFuZ3VhZ2UtY29udGVudC1wb2xpY3ktcHJvbXB0LXVyaS1kZXNjIjoiVGhlIGFwcGxpY2F0aW9uIGlzIGF0dGVtcHRpbmcgdG8gbG9hZCBjb250ZW50IGZyb20gJ3swfScuIERvIHlvdSByZWNvZ25pemUgYW5kIHRydXN0IHRoaXMgVVJMPyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZ2VvbG9jYXRlIjoiWm9vbXMgdG8gdGhlIGN1cnJlbnQgbG9jYXRpb24gb2YgdGhlIGRldmljZS4iLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLW5hdmlnYXRpb24iOiJOYXZpZ2F0aW9uIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtY2xlYXIiOiJDbGVhciIsImxhbmd1YWdlLXN0YXRlcy1pZGVudGlmeS1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSBpZGVudGlmeSB0b29sIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2UtbWVudS1lbnRlci1vZmZsaW5lLWRlc2MiOiJHbyB0byBvZmZsaW5lIG1vZGUgYW5kIHZpZXcgY2FjaGVkIG1hcCBkYXRhLiIsImxhbmd1YWdlLW1lbnUtem9vbS1pbml0aWFsLWV4dGVudC1kZXNjIjoiUmV0dXJuIHRvIHRoZSBpbml0aWFsIG1hcCBwb3NpdGlvbiBhbmQgem9vbSBsZXZlbC4iLCJsYW5ndWFnZS1jb21tb24tcXVlcnktcmVzdWx0cyI6IlF1ZXJ5IFJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWV4cG9ydC1tYXAtdG9vbHRpcCI6IlNhdmUgYSBtYXAgaW1hZ2UiLCJsYW5ndWFnZS1mcmFtZXdvcmstdWktdmlldy1jb250YWluZXItdmlldy1jbG9zZSI6IkNsb3NlIHswfSIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWZyZWVoYW5kLXRvb2x0aXAiOiJEcmF3IGEgZnJlZWhhbmQgbGluZSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1vcGVuLWRlc2MiOiJDaG9vc2UgYSBwcmV2aW91c2x5IHNhdmVkIHByb2plY3QgdG8gcmVzdG9yZSB0aGUgc2F2ZWQgc3RhdGUiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWxheWVycy1jaGFuZ2UtdG9vbHRpcCI6IkVuYWJsZS9EaXNhYmxlIGxheWVycyBzZWxlY3RlZCBmb3IgaWRlbnRpZnkgb3BlcmF0aW9ucyIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtY2xlYXItZGVzYyI6IkNsZWFyIHRoZSBhcmVhIG9mIGludGVyZXN0IGdlb21ldHJ5LiIsImxhbmd1YWdlLXJlc3VsdHMtZXhwb3J0LXRvLWFsZXJ0LWVycm9yLW1lc3NhZ2UiOiJFcnJvciBleHBvcnRpbmcgdG8gXCIuezB9XCIiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLW1hcC1yZXNpemUiOiJUZWxscyB0aGUgbWFwIGNvbnRyb2wgdG8gcmVzaXplIGl0c2VsZi4gVGhpcyBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIGFsdGVyaW5nIHRoZSBtYXAgY29udGFpbmVyJ3MgZGltZW5zaW9ucy4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNsZWFyLXN0b3JhZ2UtZm9yLWRvbWFpbiI6IkNsZWFycyBhbGwgb2ZmbGluZSBkYXRhIGZvciB0aGUgY3VycmVudCBkb21haW4uIFRoaXMgaW5jbHVkZXMgZGF0YSBmb3IgYWxsIGFwcGxpY2F0aW9ucyBsb2FkZWQgZnJvbSB0aGUgY3VycmVudCBkb21haW4uIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLXRyYW5zcGFyZW5jeS1zdWZmaXgiOiIlIiwibGFuZ3VhZ2UtY29tbW9uLXBhbiI6IlBhbiIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZnJlZWhhbmRwb2x5Z29uLWRlc2MiOiJEcmF3IGEgZnJlZWhhbmQgcG9seWdvbiBmb3IgdGhlIGFyZWEgb2YgaW50ZXJlc3QgZ2VvbWV0cnkuIiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1zdGFydGluZy1iYXNlbWFwLWRvd25sb2FkIjoiU3RhcnRpbmcgYmFzZW1hcCBkb3dubG9hZHMuIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWxpbmUtc3R5bGUtbnVsbCI6Ik5vbmUiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0LXpvb21pbi10b29sIjoiWm9vbUluVG9vbCIsImxhbmd1YWdlLXN0YXRlcy1kcmF3LW1hcmt1cC1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSBkcmF3IHRvb2wgaXMgY3VycmVudGx5IGFjdGl2ZS4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXBvbHlnb24iOiJQb2x5Z29uIiwibGFuZ3VhZ2UtY29tbW9uLWRlYnVnLWxvZy1rZXlzIjoiVG8gdmlldyB0aGUgbG9nIG9uIGEgZGVza3RvcCBtYWNoaW5lLCBwcmVzcyBDdHJsICsgU2hpZnQgKyB+LiBPbiBhIG1vYmlsZSBkZXZpY2UsIHByZXNzIGFuZCBob2xkIHRoZSB0b29sYmFyLiIsImxhbmd1YWdlLWNvbW1vbi12aWV3LWxvZyI6IlZpZXcgTG9nIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1hY3RpdmF0ZS1jb250YWluZXJzLWZvci13b3JrZmxvdyI6IkFjdGl2YXRlcyBhbnkgd29ya2Zsb3cgY29udGFpbmVyIHZpZXdzIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIHdvcmtmbG93LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWVkaXQtbG9nIjoiU2V0cyB0aGUgZWRpdCBsb2csIHBhc3NpbmcgaXQgaW50byBhIGNhbGxiYWNrLiBJZiBhbiBlcnJvciBvY2N1cnMsIHRoZSBlcnJvciBpcyBwYXNzZWQgaW50byB0aGUgY2FsbGJhY2suIiwibGFuZ3VhZ2UtdG9vbGJhci1uYXZpZ2F0aW9uLWluaXRpYWwtZXh0ZW50IjoiSW5pdGlhbCBWaWV3IiwibGFuZ3VhZ2UtY29tbW9uLXNob3ciOiJTaG93IiwibGFuZ3VhZ2UtY29tbW9uLWV4dHJhY3QtZGF0YSI6IkV4dHJhY3QgRGF0YSIsImxhbmd1YWdlLXJlc3VsdHMtdG9nZ2xlLWxpc3QtdmlldyI6IlN3aXRjaCB0byBMaXN0IiwibGFuZ3VhZ2UtdGFiLXNjcm9sbC1wcmV2IjoiUHJldmlvdXMgTGF5ZXIiLCJsYW5ndWFnZS1jb21tb24tcmVzdWx0cy1pbnRlcnNlY3QtY29uZmlybWF0aW9uIjoiJ3swfScgaW50ZXJzZWN0ZWQgd2l0aCB7MX0iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2x5bGluZSI6IkxpbmUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwLWVsZW1lbnQiOiJEaXNwbGF5cyBhbiBlbGVtZW50IGFuY2hvcmVkIHRvIGEgc3BlY2lmaWMgcG9pbnQgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXJlY2VudGVyLW1hcC1vbi1uZXh0LW1hcC1yZXNpemUiOiJSZWNlbnRlcnMgdGhlIG1hcCB0byBpdHMgZXhpc3RpbmcgcG9zaXRpb24gdGhlIG5leHQgdGltZSB0aGUgbWFwIGlzIHJlc2l6ZWQuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtdGV4dC1kZXNjIjoiQ2xpY2sgYSBsb2NhdGlvbiB3aGVyZSB5b3Ugd2FudCB0byBhZGQgdGV4dCBvbiB0aGUgbWFwLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY3JlYXRlLWF0dGFjaG1lbnQiOiJDcmVhdGVzIGEgZmVhdHVyZSBhdHRhY2htZW50LiIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtdGFza3MiOiJUYXNrcyIsImxhbmd1YWdlLXRvb2xiYXItYnVmZmVyaW5nLWFsdC1kaXNhYmxlIjoiRGlzYWJsZSBidWZmZXJpbmcgZm9yIGFjdGl2ZSB0b29sIiwibGFuZ3VhZ2UtbWVudS1wb3dlcmVkLWJ5LWdlb2NvcnRleCI6IlBvd2VyZWQgYnkgR2VvY29ydGV4IiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1iYXNlbWFwZG93bmxvYWQtZmFpbGVkIjoiQmFzZW1hcCAnezB9JyBmYWlsZWQgdG8gZG93bmxvYWQ6IHsxfSIsImxhbmd1YWdlLW1vbnRocy0xMSI6IkRlY2VtYmVyIiwibGFuZ3VhZ2UtbW9udGhzLTEwIjoiTm92ZW1iZXIiLCJsYW5ndWFnZS1sYXllcmxpc3QtZXhwYW5kIjoiQ29sbGFwc2Ugb3IgZXhwYW5kIHswfSBsYXllciBncm91cCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY3JlYXRlLWZlYXR1cmUiOiJDcmVhdGVzIGEgbmV3IGZlYXR1cmUuIiwibGFuZ3VhZ2UtY29tbW9uLXJlc3VsdHMtcmVtb3ZlZC1jb25maXJtYXRpb24iOiJ7MH0gcmVzdWx0KHMpIHJlbW92ZWQgZnJvbSAnezF9JyIsImxhbmd1YWdlLXRvb2xiYXItdGFiLWZpbGUiOiJGaWxlIiwibGFuZ3VhZ2UtY29vcmRpbmF0ZXMteSI6IlkiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWNyZWF0ZS1yZWxhdGVkLXJlY29yZCI6IkNyZWF0ZXMgYSByZWxhdGVkIHRhYmxlIHJlY29yZC4iLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctZWRpdCI6IkVkaXQiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXB1bHNlLXN0YXR1cyI6IlJlc2V0cyB0aGUgdGltZXIgb2YgdGhlIHN0YXR1cyB2aWV3TW9kZWwuIiwibGFuZ3VhZ2UtY29vcmRpbmF0ZXMteCI6IlgiLCJsYW5ndWFnZS1tZW51LXN3aXRjaC10by1sZWdlbmQiOiJTaG93IExlZ2VuZCIsImxhbmd1YWdlLW1lbnUtY29tYmluZS1yZXN1bHRzLXVuaW9uIjoiQWRkIHRvIHJlc3VsdHMiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wYWxldHRlLXNtYWxsLWRlbGV0ZSI6IkRlbGV0ZSIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtaG9tZSI6IkJhc2ljIFRvb2xzIiwibGFuZ3VhZ2UtdG9vbGJhci1hbmFseXNpcy1sb2NhdGlvbi1pbmZvIjoiTG9jYXRpb24gSW5mbyIsImxhbmd1YWdlLWNvbW1vbi1uby1yZXN1bHRzLWRlc2MiOiJJdGVtcyBhcHBlYXIgYWZ0ZXIgeW91IHBlcmZvcm0gYSB2YWxpZCBzZWFyY2ggb3Igb3RoZXIgdGFzayB0aGF0IHJldHVybnMgcmVzdWx0cy4iLCJsYW5ndWFnZS1tZW51LWdsb2JhbC1zYXZlLWRlc2MiOiJTYXZlIHRoZSBzdGF0ZSBvZiB5b3VyIHZpZXdlciBpbiBhIHByb2plY3QiLCJsYW5ndWFnZS1jb21tb24tZWRpdGluZyI6IkVkaXRpbmciLCJsYW5ndWFnZS1jb21tb24tcmVmcmVzaCI6IlJlZnJlc2giLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2x5Z29uIjoiUG9seWdvbiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZGVzdHJveS12aWV3IjoiRGVzdHJveXMgYSB2aWV3LCB3aXBpbmcgb3V0IGl0cyBiaW5kaW5nIGFuZCBET00gc3Vic3RydWN0dXJlcy4iLCJsYW5ndWFnZS1jb21tb24tb2siOiJPSyIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9seWdvbi1kZXNjIjoiVG8gbGVhcm4gd2hhdFx1MjAxOXMgdGhlcmUsIGRyYXcgYSBzaGFwZSBvbiB0aGUgbWFwLiBEb3VibGUtY2xpY2svdGFwIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS1tZW51LW1hcC1jb250ZXh0LW1lbnUtdGl0bGUiOiJQb2ludCBPcHRpb25zIiwibGFuZ3VhZ2Utc3RhdGVzLWZlYXR1cmUtZWRpdGluZy1zdGF0ZS1wb2ludC1ncmFwaGljLWRlc2NyaXB0aW9uIjoiVGhlIGNyZWF0ZSBhIGZlYXR1cmUgdG9vbCBpcyBjdXJyZW50bHkgZWRpdGluZyBhIHBvaW50LWJhc2VkIGdyYXBoaWMuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWRlLW1hcC1lbGVtZW50IjoiUmVtb3ZlcyBhbiBlbGVtZW50IHByZXZpb3VzbHkgYW5jaG9yZWQgdG8gdGhlIG1hcCB1c2luZyBTaG93TWFwRWxlbWVudC4iLCJsYW5ndWFnZS1tZW51LXJ1bi1hLXdvcmtmbG93IjoiUGVyZm9ybSBhIHRhc2siLCJsYW5ndWFnZS10b29sYmFyLW5vdC1hdmFpbGFibGUiOiJUb29sYmFyIGlzIG5vdCBhdmFpbGFibGUiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtZmlsbC1zdHlsZS1kaWFnb25hbC1jcm9zcyI6IkRpYWdvbmFsIENyb3NzIiwibGFuZ3VhZ2UtZ3JhbnQtZWRpdG9yLXJlbW92ZS1idXR0b24tdGl0bGUiOiJSZW1vdmUgdGhlIHVzZXIgb3IgZ3JvdXAiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC10ZXh0LXRvb2x0aXAiOiJBZGQgeW91ciBvd24gdGV4dCB0byB0aGUgbWFwIiwibGFuZ3VhZ2UtZXh0cmFjdC1kYXRhLWRlc2NyaXB0aW9uIjoiRXh0cmFjdCBmZWF0dXJlIGRhdGEgZnJvbSB0aGUgbWFwLiIsImxhbmd1YWdlLWNvbW1vbi12YWxpZGF0aW9uLXN5bWJvbCI6IioiLCJsYW5ndWFnZS1yZXN1bHRzLXNvcnQiOiJTb3J0IFJlc3VsdHMiLCJsYW5ndWFnZS1yZXN1bHRzLXBhZ2UtbmV4dCI6Ik5leHQgcGFnZSIsImxhbmd1YWdlLXRvb2xiYXItdGFza3MtZXhwb3J0LW1hcCI6IkV4cG9ydCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZ2V0LWZlYXR1cmUtZGV0YWlscy1wcm92aWRlcnMiOiJDcmVhdGVzIHZpZXcgZm9yIGFsbCBjb25maWd1cmVkIGZlYXR1cmUgZGV0YWlscyBwcm92aWRlcnMgYW5kIGVtYmVkcyB0aGVtIGludG8gZmVhdHVyZSBkZXRhaWxzIGRpYWxvZy4iLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1sYXllci1kZXRhaWxzLWRlc2MiOiJNYW5hZ2UgY2FjaGluZyBvZiBhIGZlYXR1cmUgbGF5ZXIgZm9yIG9mZmxpbmUgdXNlLiIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9pbnQtdG9vbHRpcCI6IkZpbmQgb3V0IGFib3V0IGEgbG9jYXRpb24gb24gdGhlIG1hcCIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3Mta2lsb2J5dGVzLXBlci1zZWNvbmQiOiJ7MH0ga0IvcyIsImxhbmd1YWdlLWNvbnRlbnQtcG9saWN5LXByb21wdC11cmktdGl0bGUiOiJQb3RlbnRpYWxseSBVbnRydXN0ZWQgQ29udGVudCBFbmNvdW50ZXJlZCIsImxhbmd1YWdlLW1lbnUtcHJvamVjdC1kZWxldGUtcHJvamVjdC1kZXNjIjoiRGVsZXRlIHRoZSBjdXJyZW50IHByb2plY3QiLCJsYW5ndWFnZS1tZW51LW1hcC1sYXllcnMtZGVzYyI6IkFsdGVyIHZpc2liaWxpdHkgb2YgbWFwIGxheWVycywgcGVyZm9ybSBsYXllciBhY3Rpb25zLCBhbmQgdmlldyB0aGUgbGVnZW5kLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcmVtb3ZlLWZlYXR1cmUtc2V0LWNvbGxlY3Rpb24iOiJSZW1vdmVzIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbiBmcm9tIHRoZSBmZWF0dXJlIHNldCBtYW5hZ2VyLiIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy1jcmVhdGUtbmV3LWZlYXR1cmUiOiJDcmVhdGUgTmV3IEZlYXR1cmUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWFkZC1zdGF0dXMiOiJBZGRzIGEgc3RhdHVzIGluZGljYXRvciB0byB0aGUgc2NyZWVuLiIsImxhbmd1YWdlLXRvb2xiYXItdG9nZ2xlLWJ1ZmZlci1vbi1uYW1lIjoiQnVmZmVyIE9wdGlvbnMiLCJsYW5ndWFnZS1tZW51LWFjY2Vzc2liaWxpdHktcGFuZWwiOiJWaWV3IHRoZSBhY2Nlc3NpYmlsaXR5IHBhbmVsIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1kcmF3IjoiRHJhdyIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtZnJlZWhhbmRwb2x5Z29uIjoiRnJlZWhhbmQgUG9seWdvbiIsImxhbmd1YWdlLWNvbW1vbi1zaGFyZSI6IlNoYXJlIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1wb2ludCI6IlBvaW50IiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZHJhd2luZy1lZGl0LXRvb2xzIjoiRWRpdCIsImxhbmd1YWdlLXdlYm1hcC1sYXllci1uYW1lLXBvbHlsaW5lIjoiTGluZXMiLCJsYW5ndWFnZS1wYWdlLW5leHQiOiJOZXh0IHBhZ2UiLCJsYW5ndWFnZS1tZW51LWxpc3Qtb2ZmbGluZS1tYXBzLWFjdGlvbnMtcmVmcmVzaCI6IlJlZnJlc2giLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1mcmVlaGFuZC1wb2x5Z29uIjoiRnJlZWhhbmQgU2hhcGUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlbGV0ZS1yZWxhdGVkLXJlY29yZCI6IkRlbGV0ZXMgYSByZWxhdGVkIHRhYmxlIHJlY29yZC4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLW9wZW4tZGF0YS1mcmFtZSI6Ik9wZW5zIHRoZSBEYXRhUmVnaW9uLCBpZiBwcmVzZW50IGluIHRoZSBjdXJyZW50IHNoZWxsLiIsImxhbmd1YWdlLXByb2plY3QtZXJyb3Itd3JpdGUiOiJUaGUgcHJvamVjdCBjb3VsZCBub3QgYmUgc2F2ZWQuIFJlZmVyIHRvIHRoZSBsb2cgZm9yIG1vcmUgZGV0YWlscy4iLCJsYW5ndWFnZS1tZW51LXJlc3VsdHMtcmVtb3ZlLWZlYXR1cmUtZGVzYyI6IlJlbW92ZSB0aGlzIGZlYXR1cmUgZnJvbSB0aGUgY3VycmVudCBzZXQgb2YgcmVzdWx0cyIsImxhbmd1YWdlLWNvbW1vbi13ZWxjb21lIjoiSG9tZSIsImxhbmd1YWdlLWNvbW1vbi1sb2dpbiI6IkxvZyBJbiIsImxhbmd1YWdlLXRvb2xiYXItdGl0bGUiOiJUb29sYmFyIiwibGFuZ3VhZ2UtbWVudS1tYXAtY29udGV4dC1tZW51LXRpdGxlLWRlc2MiOiJPcHRpb25zIHJlbGF0ZWQgdG8gYSBnaXZlbiBwb2ludCBvbiB0aGUgbWFwLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tem9vbS10by1pbml0aWFsLWV4dGVudCI6Ilpvb21zIHRvIHRoZSBpbml0aWFsIGV4dGVudCBvZiB0aGUgY3VycmVudCBTaXRlLiIsImxhbmd1YWdlLW1lbnUtaWRlbnRpZnkiOiJGaW5kIGRhdGEgb24gdGhlIG1hcCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xlYXItYWN0aXZlLXRvb2wiOiJDbGVhcnMgdGhlIGFjdGl2ZSB0b29sLiIsImxhbmd1YWdlLW1lbnUtcHJvamVjdC1lZGl0LXByb2plY3QtZGVzYyI6IkVkaXQgdGhlIGN1cnJlbnQgcHJvamVjdCIsImxhbmd1YWdlLXN0YXRlcy1lZGl0aW5nLXN0YXRlLWRlc2NyaXB0aW9uIjoiQSBkcmF3aW5nIGlzIGFjdGl2ZWx5IGJlaW5nIGVkaXRlZC4iLCJsYW5ndWFnZS1tYXBzZXJ2aWNlLWFjdGlvbnMtdG9vbHRpcCI6IkNsaWNrIHRvIHNlZSBhY3Rpb25zIGF2YWlsYWJsZSBmb3IgbWFwIHNlcnZpY2UgezB9IiwibGFuZ3VhZ2UtbWVudS1sYWJlbC1vcHRpb25zLWRlc2MiOiJUb2dnbGUgYW5kIGN1c3RvbWl6ZSB0aGUgbGF5ZXIncyBsYWJlbHMuIiwibGFuZ3VhZ2UtbWVudS1ib29rbWFyay1hZGQiOiJCb29rbWFyayBjdXJyZW50IG1hcCBleHRlbnQiLCJsYW5ndWFnZS1tZW51LXByb2plY3RzLWFjdGlvbnMtZGVzYyI6IlByb2plY3RzIEFjdGlvbnMiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXN0YXJ0LWVkaXRpbmctZWRpdC1sb2ctZW50cnkiOiJDcmVhdGVzIGEgYXZpZXcgdG8gY2hhbmdlIGFuIGV4aXN0aW5nIGVkaXQuIiwibGFuZ3VhZ2UtbWVudS16b29tLWluIjoiWm9vbSBpbiIsImxhbmd1YWdlLXRvb2xiYXItYXJjZ2lzLXZpZXctbXktY29udGVudCI6IlZpZXcgTXkgQ29udGVudCIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi16b29tLWluLWRlc2MiOiJDbGljayBvciB0YXAsIHRoZW4gZHJhZyBhcmVhIG9mIGludGVyZXN0IG9uIHRoZSBtYXAuIE1hcCB3aWxsIHpvb20gdG8gdGhhdCBsb2NhdGlvbi4iLCJsYW5ndWFnZS1tZW51LW5vLWl0ZW1zIjoiTm8gbWVudSBvcHRpb25zLiIsImxhbmd1YWdlLXRvb2xiYXItaG9tZS1zdWIiOiJIb21lIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1kZXNjIjoiR2VvbWV0cnkgQWN0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWRlbGV0ZSI6IkVyYXNlIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1yZWdpc3Rlci1zZWFyY2gtcHJvdmlkZXIiOiJSZWdpc3RlcnMgYSBzZWFyY2ggcHJvdmlkZXIgaWYgbm90IGFscmVhZHkgcmVnaXN0ZXJlZC4iLCJsYW5ndWFnZS1jb21tb24tc2F2ZSI6IlNhdmUiLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWxheWVyLWNhdGFsb2ciOiJMYXllciBDYXRhbG9nIiwibGFuZ3VhZ2UtcmVzdWx0cy1kaXNwbGF5aW5nIjoiRGlzcGxheWluZyIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3MtYmFzZW1hcGRvd25sb2FkLWRvd25sb2FkaW5nIjoiezB9IC0gezF9IG9mIHsyfSAoezN9JSkgZG93bmxvYWRlZC4gezR9LiIsImxhbmd1YWdlLWdyYW50LWVkaXRvci1hZGQtYnV0dG9uLXRpdGxlIjoiQWRkIHRoZSB1c2VyIG9yIGdyb3VwIiwibGFuZ3VhZ2UtbWVudS16b29tLXRvLWxheWVyIjoiWm9vbSB0byBmdWxsIGV4dGVudCIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1saW5lLXN0eWxlLXNob3J0ZG90IjoiU2hvcnQtZG90IiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi16b29tLXRvLWVzcmktZmVhdHVyZS1zZXQiOiJab29tcyB0byB0aGUgZXh0ZW50IG9mIGFsbCB0aGUgZmVhdHVyZXMgaW4gdGhlIGZlYXR1cmUgc2V0LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xvc2UtZGF0YS1mcmFtZSI6IkNsb3NlcyB0aGUgRGF0YVJlZ2lvbiwgaWYgaXQgaXMgcHJlc2VudCBpbiB0aGUgY3VycmVudCBzaGVsbC4iLCJsYW5ndWFnZS1tZW51LXJ1bi1yZXBvcnQtZGVzYyI6IlJ1biBhIFJlcG9ydCBvbiB0aGUgc2VsZWN0ZWQgcmVzdWx0cyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtbmF0aXZlIjoiTmF0aXZlIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zdHlsZS1jaXJjbGUiOiJDaXJjbGUiLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctbWFuYWdlLW9mZmxpbmUtZGF0YS10b29sdGlwIjoiU2VsZWN0LCBzeW5jLCBhbmQgY2xlYXIgb2ZmbGluZSBkYXRhIiwibGFuZ3VhZ2UtY29vcmRpbmF0ZXMtc2Vjb25kcyI6IlwiIiwibGFuZ3VhZ2UtdG9vbGJhci10YXNrcy1hZGQtbGF5ZXJzIjoiQWRkIExheWVycyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1yZXN1bHRzLWxpc3QiOiJEaXNwbGF5cyB0aGUgbGlzdCBvZiBmZWF0dXJlcyBpbiB0aGUgZ2l2ZW4gZmVhdHVyZSBzZXQgY29sbGVjdGlvbiBhcyBhIGxpc3QuIiwibGFuZ3VhZ2UtY29tbW9uLWNhbmNlbCI6IkNhbmNlbCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWFjdGl2ZS1oaWdobGlnaHQtbGF5ZXIiOiJTZXRzIHRoZSBsYXllciB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSBhcyBhY3RpdmUsIGlmIHRoZXJlIGlzIG9uZS4iLCJsYW5ndWFnZS1tZW51LXpvb20tdG8tdmlzaWJsZS1zY2FsZS1kZXNjIjoiWm9vbSB0aGUgbWFwIHRvIGEgc2NhbGUgd2hlcmUgdGhlIGxheWVyIGlzIHZpc2libGUuIiwibGFuZ3VhZ2UtdG9vbGJhci10b29sYmFyIjoiVG9vbGJhciIsImxhbmd1YWdlLXRvb2xiYXItaWRlbnRpZnktcG9seWxpbmUtZGVzYyI6IlRvIGxlYXJuIHdoYXRcdTIwMTlzIHRoZXJlLCBkcmF3IGEgbGluZSBvZiBpbnRlcmVzdCBhbG9uZyB0aGUgbWFwLiBEb3VibGUtY2xpY2svdGFwIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS1tZW51LXNhdmUtcmVzdWx0cyI6IlNhdmUgUmVzdWx0cyIsImxhbmd1YWdlLXN0YXRlcy1lZGl0aW5nLWFjdGl2ZS1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSBmZWF0dXJlIGVkaXRvciBpcyBjdXJyZW50bHkgYWN0aXZlLiIsImxhbmd1YWdlLXRvb2xiYXItZmluZC1kYXRhIjoiRmluZCBEYXRhIiwibGFuZ3VhZ2Utd2VibWFwLWZpZWxkLW5hbWUtdmlzaWJsZSI6IlZpc2libGUiLCJsYW5ndWFnZS1jb21tb24tc2hvdy1kZXRhaWxzLWRlc2NyaXB0aW9uIjoiU2VlIGFkZGl0aW9uYWwgZGV0YWlscyBmb3IgdGhpcyBmZWF0dXJlLiIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1maWxsLXN0eWxlLWZvcndhcmQtZGlhZ29uYWwiOiJGb3J3YXJkIERpYWdvbmFsIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZXhwb3J0IjoiRXhwb3J0IERyYXdpbmdzIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1mZWF0dXJlLWxheWVyLWNhY2hlLWRhdGEiOiJDYWNoZXMgdGhlIGRhdGEgZm9yIGEgZ2l2ZW4gbWFwIHNlcnZpY2UgVVJMLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tYWxsb3ctaGlkZS1mZWF0dXJlLWxheWVyLW1vZGFsLW1lc3NhZ2UiOiJTaG93IHRoZSBjbG9zZSBidXR0b24gb24gdGhlIE1vZGFsTWVzc2FnZVZpZXcgYWxsb3dpbmcgdGhlIHVzZXIgdG8gY2xvc2UgaXQuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZGVsZXRlLWRlc2MiOiJDbGljayBvciB0YXAgdG8gaW1tZWRpYXRlbHkgYW5kIHBlcm1hbmVudGx5IGRlbGV0ZSBhIGRyYXdpbmcuIFRoaXMgY2Fubm90IGJlIHVuZG9uZS4iLCJsYW5ndWFnZS1tZW51LW1lbnVzLWRlc2NyaXB0aW9uIjoiSSBXYW50IFRvLi4uIE1lbnVzIiwibGFuZ3VhZ2UtbWVudS1saXN0LW9mZmxpbmUtbWFwcy1hY3Rpb25zLXJlZnJlc2gtZGVzYyI6IlJlZnJlc2ggdGhlIGxpc3Qgb2Ygb2ZmbGluZSBtYXBzLiIsImxhbmd1YWdlLXRvb2xiYXItZWRpdGluZy1jcmVhdGUtbmV3LWZlYXR1cmUtZ2VvbG9jYXRpb24tdG9vbHRpcCI6IkNyZWF0ZSBhIHBvaW50LWJhc2VkIGZlYXR1cmUgdXNpbmcgZ2VvbG9jYXRpb24iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWdldC1lZGl0LWxvZyI6IkdldHMgdGhlIGVkaXQgbG9nLCBwYXNzaW5nIGl0IGludG8gYSBjYWxsYmFjay4gSWYgYW4gZXJyb3Igb2NjdXJzLCB0aGUgZXJyb3IgaXMgcGFzc2VkIGludG8gdGhlIGNhbGxiYWNrLiIsImxhbmd1YWdlLWV4dHJhY3QtZGF0YSI6IkV4dHJhY3QgZGF0YSIsImxhbmd1YWdlLXdlYm1hcC1sYXllci1uYW1lLXBvaW50IjoiUG9pbnRzIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci1tYXJrdXAiOiJQcm9tcHRzIHRoZSB1c2VyIGZvciBjb25maXJtYXRpb24sIGFuZCBpZiBhcHByb3ZlZCwgY2xlYXJzIGFsbCBvZiB0aGUgbWFya3VwIGZyb20gdGhlIG1hcmt1cCBsYXllci4iLCJsYW5ndWFnZS10b29sYmFyLWNoYXJ0aW5nLXNob3ctY2hhcnRzLXRvb2x0aXAiOiJMYXVuY2ggdGhlIGNoYXJ0aW5nIHZpZXciLCJsYW5ndWFnZS1ncmFudC1lZGl0b3Itc2VhcmNoLXRpdGxlIjoiVHlwZSB5b3VyIHNlYXJjaCB0ZXJtcyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24taGlnaGxpZ2h0LWZlYXR1cmUtZGVmYXVsdCI6IkhpZ2hsaWdodHMgdGhlIGZlYXR1cmUgaW4gdGhlIGRlZmF1bHQgaGlnaGxpZ2h0IGxheWVyLiIsImxhbmd1YWdlLWNvbW1vbi1zaG93LWRldGFpbHMiOiJTZWUgRGV0YWlscyIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtZ2xvYmFsLXRhc2tzIjoiR2xvYmFsIFRhc2tzIiwibGFuZ3VhZ2UtbWVudS1zaG93LWxvZy1kZXNjIjoiRGlzcGxheSB0aGUgdmlld2VyJ3MgbG9nLCBpbmNsdWRpbmcgZGlhZ25vc3RpYyBlcnJvcnMgYW5kIHRoZSB2ZXJzaW9uIG51bWJlci4iLCJsYW5ndWFnZS10b29sYmFyLWVkaXRpbmctY3JlYXRlLW5ldy1mZWF0dXJlLXRvb2x0aXAiOiJDcmVhdGUgYSBuZXcgZmVhdHVyZSBvbiB0aGUgbWFwIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zaG93LWZlYXR1cmUtdGVtcGxhdGUtcGlja2VyIjoiU2hvd3MgdGhlIGZlYXR1cmUgdGVtcGxhdGUgcGlja2VyIHVzZWQgdG8gY3JlYXRlIG5ldyBmZWF0dXJlcy4gSWYgYSBsYXllciBpcyBzdXBwbGllZCwgc2hvd3MgdGhlIHRlbXBsYXRlcyBmb3IgdGhlIGxheWVyLiIsImxhbmd1YWdlLW1lbnUtcGxvdC1jb29yZGluYXRlIjoiUGxvdCBhIENvb3JkaW5hdGUiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtdGl0bGUiOiJTeW1ib2xvZ3kgU2V0dGluZ3MiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlbGV0ZS1hdHRhY2htZW50IjoiRGVsZXRlcyBhIGZlYXR1cmUgYXR0YWNobWVudC4iLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLWRvd25sb2FkaW5nc2l0ZSI6IkRvd25sb2FkaW5nIHNpdGUgcmVzb3VyY2VzLiIsImxhbmd1YWdlLWNvbW1vbi1yZXN1bHRzLWFkZGVkLWNvbmZpcm1hdGlvbiI6InswfSByZXN1bHQocykgYWRkZWQgdG8gJ3sxfSciLCJsYW5ndWFnZS1jb29yZGluYXRlcy1sYXRpdHVkZS1hYmJyZXYiOiJMYXQiLCJsYW5ndWFnZS1zdGF0ZXMtdHJhbnNpZW50LWFjdGl2ZS1kZXNjcmlwdGlvbiI6IkF0IGxlYXN0IG9uZSB0cmFuc2llbnQgdG9vbGJhciBpcyBjdXJyZW50bHkgb3Blbi4iLCJsYW5ndWFnZS1ncmFudC1lZGl0b3ItYWRkLWJ1dHRvbi10ZXh0IjoiQWRkIiwibGFuZ3VhZ2UtcmVzdWx0cy1leHBvcnQtdG8tc3RhdHVzLW1lc3NhZ2UiOiJFeHBvcnRpbmcgdG8gXCIuezB9XCIiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbWFya2VyLXN0eWxlLWNyb3NzIjoiQ3Jvc3MiLCJsYW5ndWFnZS1tZW51LWhvbWUtcGFuZWwtZGVzYyI6IlZpZXcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBhcHBsaWNhdGlvbi4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWFsZXJ0IjoiRGlzcGxheXMgYW4gYWxlcnQuIiwibGFuZ3VhZ2UtY29tbW9uLWZlYXR1cmUtZWRpdGluZy1kZXNjIjoiRWRpdCB0aGUgYXR0cmlidXRlcyBvZiB0aGUgZmVhdHVyZSBhbmQgc2F2ZSB0aGVtLiIsImxhbmd1YWdlLW1lbnUtcG93ZXJlZC1ieS1nZW9jb3J0ZXgtZGVzYyI6IlBvd2VyZWQgYnkgR2VvY29ydGV4IiwibGFuZ3VhZ2UtbWVudS1hY2Nlc3NpYmlsaXR5LXBhbmVsLWRlc2MiOiJWaWV3IGluZm9ybWF0aW9uIGFib3V0IHRoZSBhY2Nlc3NpYmlsaXR5IG9mIHRoaXMgYXBwbGljYXRpb24uIiwibGFuZ3VhZ2UtcmVzdWx0cy1wYWdlLWZpcnN0IjoiRmlyc3QgcGFnZSIsImxhbmd1YWdlLW1lbnUtem9vbS1pbml0aWFsLWV4dGVudCI6IlJldHVybiB0byBpbml0aWFsIG1hcCBleHRlbnQiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LWZyZWVoYW5kLXBvbHlnb24tZGVzYyI6IkRyYXcgYSBmcmVlaGFuZCBzaGFwZSBvbiB0aGUgbWFwIHRvIHNlZSB3aGF0J3MgdGhlcmUiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlbGV0ZS1mcm9tLWVkaXQtbG9nIjoiUmVtb3ZlcyB0aGUgZ2l2ZW4gZW50cnkgZnJvbSB0aGUgZWRpdCBsb2csIHRoZW4gc2V0cyB0aGUgZWRpdCBsb2cuIiwibGFuZ3VhZ2UtbGF5ZXJsaXN0LWJhc2UtbWFwcy1mb2xkZXItdGl0bGUiOiJCYXNlbWFwcyIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3MtYmFzZW1hcGV4cG9ydC1jb25uZWN0aW5nIjoiezB9IGNvbm5lY3RpbmcgdG8gZ2VuZXJhdGUuLi4iLCJsYW5ndWFnZS1tZW51LXN3aXRjaC10by1sZWdlbmQtZGVzYyI6IkRpc3BsYXkgdGhlIGxlZ2VuZCBmb3IgdmlzaWJsZSBsYXllcnMiLCJsYW5ndWFnZS10b29sYmFyLWdyb3VwLW9mZmxpbmUtbWFuYWdlbWVudCI6Ik9mZmxpbmUgTWFuYWdlbWVudCIsImxhbmd1YWdlLWNvbW1vbi1lZGl0IjoiRWRpdCIsImxhbmd1YWdlLWNvbW1vbi1mZWF0dXJlLXN5bmMtc2V0dGluZ3MiOiJNYW5hZ2UgU3luYyBTZXR0aW5ncyIsImxhbmd1YWdlLW1lbnUtc2V0dGluZ3MtZGVzY3JpcHRpb24iOiJNb2JpbGUgU2V0dGluZ3MiLCJsYW5ndWFnZS1zdGF0ZXMtZWRpdC1zdGF0ZS1kZXNjcmlwdGlvbiI6IlRoZSB0b29sIHRvIHNlbGVjdCBhbiBpdGVtIGZvciBlZGl0aW5nIGlzIGN1cnJlbnRseSBhY3RpdmUuIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLXN0YXJ0Y29sb3IiOiJTdGFydCBDb2xvciIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcnVuLXdvcmtmbG93LWJ5LWlkIjoiUnVucyBhIHdvcmtmbG93LiIsImxhbmd1YWdlLW1lbnUtcHJvamVjdC1zaGFyZS1wcm9qZWN0LWRlc2MiOiJTaGFyZSB0aGUgY3VycmVudCBwcm9qZWN0IiwibGFuZ3VhZ2UtbGF5ZXJsaXN0LXRvZ2dsZSI6IlRvZ2dsZSB7MH0gbGF5ZXIgdmlzaWJpbGl0eS4iLCJsYW5ndWFnZS1tZW51LWdsb2JhbC1vcGVuIjoiT3BlbiIsImxhbmd1YWdlLW1lbnUtZXhwb3J0LXJlc3VsdHMtdG8tY3N2LWRlc2MiOiJFeHBvcnQgcmVzdWx0cyB0byBDU1YiLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1zeW5jLXNldHRpbmdzLWRlc2MiOiJEaXNwbGF5cyBhIGxpc3Qgb2YgZmVhdHVyZSBsYXllcnMgdG8gY2hvb3NlIGZyb20uIiwibGFuZ3VhZ2UtdG9vbGJhci10YWItdGFza3MiOiJUYXNrcyIsImxhbmd1YWdlLXRvb2xiYXItaG9tZS10b29sdGlwIjoiT3BlbiB0aGUgSG9tZSBQYW5lbCIsImxhbmd1YWdlLW1lbnUtZGVzY3JpcHRpb24iOiJRdWljayBhY2Nlc3MgdG8gY29tbW9uIHRhc2tzIiwibGFuZ3VhZ2UtbWVudS16b29tIjoiWm9vbSB0byBGZWF0dXJlIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWdvbi1kZXNjLWtleWJvYXJkIjoiVXNlIGFycm93cyB0byBtb3ZlIHRoZSBwb2ludC4gSGl0IEVOVEVSIHRvIHBsb3QgYW5kIGJlZ2luIG1vdmluZyB0aGUgbmV4dCBwb2ludC4gSGl0IEVOVEVSIHR3aWNlIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1yZWN0YW5nbGUtZGVzYyI6IkNsaWNrIGFuZCBkcmFnIHRvIGRyYXcgYSByZWN0YW5nbGUgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS1sYXllci1hY3Rpb25zIjoiUGVyZm9ybSBhbiBhY3Rpb24gb24gezB9IiwibGFuZ3VhZ2UtcHJvamVjdC1lcnJvci1vd25lciI6IllvdSBkbyBub3Qgb3duIHRoaXMgcHJvamVjdC4iLCJsYW5ndWFnZS1jb21tb24tY2xlYXIiOiJDbGVhciIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZmVhdHVyZS1sYXllci1tb2R1bGUtc3RhcnQtc3luYyI6IlN0YXJ0cyBzeW5jaHJvbml6ZXMgdGhlIGZlYXR1cmUgZWRpdHMgdG8gdGhlIHNlcnZlci4iLCJsYW5ndWFnZS1tZW51LWhvbWUtcGFuZWwiOiJWaWV3IHRoZSBob21lIHBhbmVsIiwibGFuZ3VhZ2UtY29tbW9uLWZlYXR1cmUtZWRpdGluZyI6IkZlYXR1cmUgQXR0cmlidXRlcyIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1wYW4iOiJQYW4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lZGl0LWRlc2Mtc2hvcnRjdXRzIjoiVXNlIGFycm93cyB0byBtb3ZlLCBSIHRvIHJvdGF0ZSwgUyB0byBzY2FsZSwgViB0byBzZWxlY3QgdmVydGV4LiBDb21iaW5lIHdpdGggQUxUIGZvciBmaW5lciBjb250cm9sLiBDb21iaW5lIHdpdGggU0hJRlQgdG8gcmV2ZXJzZS4iLCJsYW5ndWFnZS1tb250aHMtMiI6Ik1hcmNoIiwibGFuZ3VhZ2UtbW9udGhzLTEiOiJGZWJydWFyeSIsImxhbmd1YWdlLW1vbnRocy00IjoiTWF5IiwibGFuZ3VhZ2Utb2ZmbGluZS1lcnJvcnMtbm90bmF0aXZlaW5pdGlhbGl6ZWQiOiJUaGlzIG9wZXJhdGlvbiBjYW4gb25seSBiZSBwZXJmb3JtZWQgaW4gdGhlIG5hdGl2ZSBjbGllbnQuIiwibGFuZ3VhZ2UtbW9udGhzLTMiOiJBcHJpbCIsImxhbmd1YWdlLW1lbnUtb2ZmbGluZS1tYXAtZWRpdG9yLWdlb21ldHJ5LWFjdGlvbnMtY2lyY2xlIjoiQ2lyY2xlIiwibGFuZ3VhZ2Utc21hcnQtcGFuZWwtbWVudSI6IlBhbmVsIEFjdGlvbnMgTWVudS4gQ2xpY2sgdG8gb3Blbi9jbG9zZS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXNob3ctbWFwIjoiQWN0aXZhdGVzIG1hcCB2aWV3LiIsImxhbmd1YWdlLW1vbnRocy0wIjoiSmFudWFyeSIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi16b29tLW91dC10b29sdGlwIjoiRHJhdyBhbiBhcmVhIG9mIGludGVyZXN0IG9uIHRoZSBtYXAgYW5kIHpvb20gb3V0LCBrZWVwaW5nIHRoZSBhcmVhIGNlbnRlcmVkIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9pbnQtZGVzYyI6IkNsaWNrIG9yIHRhcCBhIG1hcCBsb2NhdGlvbiB0byBhZGQgYSBwb2ludC4iLCJsYW5ndWFnZS10b29sYmFyLXNuYXBwaW5nLWFsdC1kaXNhYmxlIjoiRGlzYWJsZSBzbmFwcGluZyBmb3IgYWN0aXZlIHRvb2wiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wYWxldHRlLXNtYWxsLWNoYW5nZS1zdHlsZSI6IlN0eWxlcyIsImxhbmd1YWdlLW1vbnRocy05IjoiT2N0b2JlciIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi1uZXh0LWV4dGVudC10b29sdGlwIjoiWm9vbSB0byB0aGUgbmV4dCBleHRlbnQiLCJsYW5ndWFnZS1tb250aHMtNiI6Ikp1bHkiLCJsYW5ndWFnZS1tb250aHMtNSI6Ikp1bmUiLCJsYW5ndWFnZS1tZW51LXN3aXRjaC10by1sYXllcmxpc3QiOiJTaG93IExheWVyIExpc3QiLCJsYW5ndWFnZS1wYWdlLXByZXYiOiJQcmV2aW91cyBwYWdlIiwibGFuZ3VhZ2UtbW9udGhzLTgiOiJTZXB0ZW1iZXIiLCJsYW5ndWFnZS1tb250aHMtNyI6IkF1Z3VzdCIsImxhbmd1YWdlLW1lbnUtZXhwb3J0LXJlc3VsdHMtdG8tc2hwLWRlc2MiOiJFeHBvcnQgcmVzdWx0cyB0byBTaGFwZWZpbGUiLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LXBvaW50LWRlc2MiOiJEcmF3IGEgcG9pbnQgb24gdGhlIG1hcCB0byB2aWV3IGluZm9ybWF0aW9uIGF0IHRoYXQgcG9pbnQgb24gdGhlIG1hcC4iLCJsYW5ndWFnZS1zbWFydC1wYW5lbC1yZXNpemUiOiJEcmFnIHRvIHJlc2l6ZSB0aGUgcGFuZWwiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbWFya2VyLXN0eWxlLXNxdWFyZSI6IlNxdWFyZSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24taW52b2tlLW1hcC10aXAiOiJFeGVjdXRlcyBhbiBJZGVudGlmeSBvcGVyYXRpb24gb24gdGhlIGdpdmVuIGdlb21ldHJ5IGFuZCBcIk1hcFRpcFwiIGFzIGl0cyBzb3VyY2UgdGFnLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xvc2UtZmVhdHVyZS1zZXQtY29sbGVjdGlvbiI6IkNsb3NlcyB0aGUgZmVhdHVyZSBzZXQgY29sbGVjdGlvbi4iLCJsYW5ndWFnZS1tZW51LWJyb3dzZS1zYXZlZC1yZXN1bHRzLWRlc2MiOiJDaG9vc2UgZnJvbSBhIGxpc3Qgb2Ygc2F2ZWQgcmVzdWx0cyB0byB2aWV3IHRoZW0iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtZW5kY29sb3IiOiJFbmQgQ29sb3IiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2x5bGluZS1kZXNjLWtleWJvYXJkIjoiVXNlIGFycm93cyB0byBtb3ZlIHRoZSBwb2ludC4gSGl0IEVOVEVSIHRvIHBsb3QgYW5kIGJlZ2luIG1vdmluZyB0aGUgbmV4dCBwb2ludC4gSGl0IEVOVEVSIHR3aWNlIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS11aS10YWJsZS1zb3J0ZWQtYXNjZW5kaW5nIjoiQ29sdW1uIGhlYWRlci4gezB9IC0gU29ydGVkIGFzY2VuZGluZy4iLCJsYW5ndWFnZS1tZW51LWVudGVyLW9ubGluZSI6IkdvIHRvIG9ubGluZSBtb2RlIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1zZWFyY2giOiJQZXJmb3JtcyBhIHNlYXJjaCBvbiBhbGwgYWN0aXZlIHByb3ZpZGVycy4iLCJsYW5ndWFnZS1tZW51LWVkaXQtZmVhdHVyZS1kZXNjcmlwdGlvbiI6IkVkaXQgdGhlIGRldGFpbHMgYWJvdXQgdGhpcyBmZWF0dXJlLiIsImxhbmd1YWdlLW1lbnUtaWRlbnRpZnktZnJlZWhhbmQiOiJJZGVudGlmeSBieSBmcmVlaGFuZCBzaGFwZSIsImxhbmd1YWdlLXByb2plY3Qtc2lnbi1pbiI6IlNpZ24gaW4iLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tem9vbS1vdXQtZGVzYyI6IkRyYWcgYSByZWN0YW5nbGUgb24gdGhlIG1hcCB0byB6b29tIG91dCB3aGlsZSBrZWVwaW5nIHRoYXQgYXJlYSBjZW50ZXJlZCIsImxhbmd1YWdlLXRvb2xiYXItbmF0aXZlLXNob3dvZmZsaW5lbWFwcy10b29sdGlwIjoiT3BlbiB0aGUgbGlzdCBvZiBvZmZsaW5lIG1hcHMiLCJsYW5ndWFnZS1tZW51LWlkZW50aWZ5LWJ1ZmZlcmVkLWZlYXR1cmUtc2V0LWNvbGxlY3Rpb24iOiJTaG93IEJ1ZmZlciBPcHRpb25zIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC1wbG90Y29vcmRpbmF0ZXMiOiJDb29yZGluYXRlcyIsImxhbmd1YWdlLXRvb2xiYXItbmF2aWdhdGlvbi16b29tLW91dCI6Ilpvb20gT3V0IiwibGFuZ3VhZ2UtdG9vbGJhci1zbmFwcGluZy1hbHQtZW5hYmxlIjoiRW5hYmxlIHNuYXBwaW5nIGZvciBhY3RpdmUgdG9vbCIsImxhbmd1YWdlLW9mZmxpbmUtcHJvZ3Jlc3MtdW5yZWdpc3RlcmluZ3JlcGxpY2EiOiJVbnJlZ2lzdGVyaW5nIHJlcGxpY2EuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jbGVhci1oaWdobGlnaHRzIjoiUmVtb3ZlcyB0aGUgaGlnaGxpZ2h0cyBmcm9tIHRoZSBhY3RpdmUgaGlnaGxpZ2h0IGxheWVyLiIsImxhbmd1YWdlLWhvdXJzLWFiYnIiOiJIIiwibGFuZ3VhZ2UtbWVudS1yZW1vdmUtdXNlci1hZGRlZC1tYXBzZXJ2aWNlIjoiUmVtb3ZlIHNlcnZpY2UiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24tcHJldmlvdXMtZXh0ZW50LXRvb2x0aXAiOiJab29tIHRvIHRoZSBwcmV2aW91cyBleHRlbnQiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1kZWxldGUtZGVzYy1rZXlib2FyZCI6IlVzZSBhcnJvd3MgdG8gbW92ZSB0aGUgcG9pbnQuIEhpdCBFTlRFUiB0byBpbW1lZGlhdGVseSBhbmQgcGVybWFuZW50bHkgZGVsZXRlIGEgZHJhd2luZy4gVGhpcyBjYW5ub3QgYmUgdW5kb25lLiIsImxhbmd1YWdlLXRvb2xiYXItc2VsZWN0LWxheWVycy10b2dnbGUtb24tbmFtZSI6IkZpbHRlciBMYXllcnMiLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXJlY3RhbmdsZSI6IlJlY3RhbmdsZSIsImxhbmd1YWdlLXRvb2xiYXItc25hcHBpbmctc2VsZWN0LWxheWVycy10b29sdGlwIjoiQ2hhbmdlIHdoaWNoIGxheWVycyBhcmUgc25hcHBhYmxlIiwibGFuZ3VhZ2Utb2ZmbGluZS1lcnJvcnMtbm90Zm91bmQiOiJPZmZsaW5lIHByb2ZpbGUgbm90IGZvdW5kLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tb3Blbi13ZWItcGFnZSI6Ik9wZW5zIGEgd2ViIHBhZ2UgaW4gYW5vdGhlciB0YWIvd2luZG93LiIsImxhbmd1YWdlLXJlc3VsdHMtcGFnZS1wcmV2IjoiUHJldmlvdXMgcGFnZSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tY2xvc2UtbW9kYWwtcmVnaW9uIjoiQ2xvc2VzIHRoZSBNb2RhbFdpbmRvd1JlZ2lvbi4iLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24taG9tZS1zdWIiOiJIb21lIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jYW5jZWwtc2VhcmNoIjoiQ2FuY2VsIHRoZSBzZWFyY2ggb24gYWxsIHByb3ZpZGVycy4iLCJsYW5ndWFnZS1vZmZsaW5lLWVycm9ycy1jYW5jZWxyZWplY3RlZCI6IkNhbm5vdCBjYW5jZWwgcmlnaHQgbm93LiIsImxhbmd1YWdlLWNvbW1vbi13b3JrZmxvdyI6IldvcmtmbG93IiwibGFuZ3VhZ2UtbWVudS1kb25lIjoiRG9uZSIsImxhbmd1YWdlLW1lbnUtZWRpdC1mZWF0dXJlIjoiRWRpdCB0aGlzIEZlYXR1cmUiLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1wb2ludC10b29sdGlwIjoiQWRkIGEgcG9pbnQgdG8gdGhlIG1hcCIsImxhbmd1YWdlLXRvb2xiYXItM3JkLXBhcnR5LW1hcHMtc2hvdy1tYXBzIjoiTGlua2VkIE1hcHMiLCJsYW5ndWFnZS1sYXllcmxpc3Qtbm90LXZpc2libGUtYXQtZXh0ZW50IjoiQ3VycmVudGx5IG5vdCB3aXRoaW4gdmlzaWJsZSBzY2FsZS4iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS1zdHlsZS1zb2xpZCI6IlNvbGlkIiwibGFuZ3VhZ2UtbWVudS16b29tLWRlc2NyaXB0aW9uIjoiWm9vbSB0byB0aGlzIGZlYXR1cmUgb24gdGhlIG1hcCIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZ2xvYmFsLXNlYXJjaCI6IlBlcmZvcm1zIGEgc2VhcmNoIG9uIGFsbCBhY3RpdmUgcHJvdmlkZXJzLiIsImxhbmd1YWdlLW1lbnUtc2hvdy1sb2ciOiJTaG93IExvZyIsImxhbmd1YWdlLWNvb3JkaW5hdGVzLW1pbnV0ZXMiOiInIiwibGFuZ3VhZ2UtdG9vbGJhci1ncm91cC10aW1lLXNsaWRlciI6IlRpbWUgU2xpZGVyIiwibGFuZ3VhZ2UtdG9vbGJhci1zZWxlY3QtbGF5ZXJzLXRvZ2dsZS10b29sdGlwIjoiRmlsdGVyIGxheWVycyBmb3IgSWRlbnRpZnkgcmVzdWx0cyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWhpZ2hsaWdodC1ib3JkZXItY29sb3IiOiJTZXRzIHRoZSBib3JkZXIgY29sb3IgdXNlZCBmb3IgbmV3IGhpZ2hsaWdodHMsIHNwZWNpZmllZCBpbiA2IG9yIDggZGlnaXQgaGV4IGluIFJHQiBvciBBUkdCIGZvcm0uIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWZpbGwtc3R5bGUtaG9yaXpvbnRhbCI6Ikhvcml6b250YWwiLCJsYW5ndWFnZS1tZW51LW1hcC1sYXllcnMiOiJDaGFuZ2UgdmlzaWJsZSBtYXAgbGF5ZXJzIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1oaWdobGlnaHQtZXNyaS1mZWF0dXJlLXNldCI6IkhpZ2hsaWdodHMgYWxsIG9mIHRoZSBmZWF0dXJlcyBpbiB0aGUgc3BlY2lmaWVkIGZlYXR1cmUgc2V0IGluIHRoZSBhY3RpdmUgaGlnaGxpZ2h0IGxheWVyLiIsImxhbmd1YWdlLWdyYW50LWVkaXRvci1tb25pa2VyLXR5cGUtdXNlciI6IkluZGl2aWR1YWxzIiwibGFuZ3VhZ2UtdG9vbGJhci1jaGFydGluZy1zaG93LWNoYXJ0cyI6IlZpZXcgQ2hhcnRzIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtcG9seWxpbmUtZGVzYyI6IkNsaWNrIG9yIHRhcCBsb2NhdGlvbnMgYWxvbmcgdGhlIG1hcCB0byBjcmVhdGUgYSBsaW5lLiBEb3VibGUgY2xpY2svdGFwIHRvIGZpbmlzaC4iLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWlkZW50aWZ5IjoiSWRlbnRpZnkiLCJsYW5ndWFnZS1tZW51LWNvbWJpbmUtcmVzdWx0cy1zdWJ0cmFjdC1kZXNjIjoiUmVtb3ZlIGEgc2F2ZWQgc2V0IG9mIHJlc3VsdHMgZnJvbSB5b3VyIGN1cnJlbnQgbGlzdCBvZiByZXN1bHRzIiwibGFuZ3VhZ2UtbWVudS1pZGVudGlmeS1yZWN0YW5nbGUtZGVzYyI6IkRyYXcgYSByZWN0YW5nbGUgdG8gdmlldyBpbmZvcm1hdGlvbiBhYm91dCB0aGF0IGFyZWEuIiwibGFuZ3VhZ2UtdG9vbGJhci1pZGVudGlmeS1yZWN0YW5nbGUtZGVzYyI6IlRvIGxlYXJuIHdoYXRcdTIwMTlzIHRoZXJlLCBjbGljayBvciB0YXAgYW5kIGRyYWcgdG8gZHJhdyBhIHJlY3RhbmdsZSBvbiB0aGUgbWFwLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tZGVhY3RpdmF0ZS1jb250YWluZXJzLWZvci13b3JrZmxvdyI6IkRlYWN0aXZhdGVzIGFueSB3b3JrZmxvdyB2aWV3cyBhc3NvY2lhdGVkIHdpdGggYSBnaXZlbiB3b3JrZmxvdy4iLCJsYW5ndWFnZS1wcm9qZWN0LWVycm9yLWRlbGV0ZSI6IlRoZSBwcm9qZWN0IGNvdWxkIG5vdCBiZSBkZWxldGVkLiBSZWZlciB0byB0aGUgbG9nIGZvciBtb3JlIGRldGFpbHMuIiwibGFuZ3VhZ2Utc21hcnQtcGFuZWwtYmFjayI6IkdvIEJhY2sgaW4gUGFuZWwiLCJsYW5ndWFnZS1tZW51LWxpc3Qtb2ZmbGluZS1tYXBzLWFjdGlvbnMtZGVzYyI6Ik9mZmxpbmUgUHJvZmlsZSBBY3Rpb25zIiwibGFuZ3VhZ2UtcHJvamVjdC1lcnJvci1zaWduLWluLXJlcXVpcmVkIjoiVGhpcyBwcm9qZWN0IHJlcXVpcmVzIHlvdSB0byBzaWduIGluLiBQbGVhc2Ugc2lnbiBpbiB0byBvcGVuIHRoZSBwcm9qZWN0LiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1tYXAtdGlwIjoiQ3JlYXRlcyBhIE1hcCBUaXAgVmlldyBhbmQgZGlzcGxheXMgdGhlIGZlYXR1cmUgaW4gaXQuIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtY2xlYXItdG9vbHRpcCI6IkNsZWFyIGFsbCBkcmF3aW5ncyBmcm9tIHRoZSBtYXAiLCJsYW5ndWFnZS1zdGF0ZXMtYnVmZmVyaW5nLWRlc2NyaXB0aW9uIjoiQnVmZmVyaW5nIGlzIGVuYWJsZWQgZm9yIHRoZSBjdXJyZW50IHRvb2wuIiwibGFuZ3VhZ2UtY29tbW9uLWZlYXR1cmUtb2ZmbGluZS10b29scyI6Ik1hbmFnZSBPZmZsaW5lIERhdGEiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWRlYWN0aXZhdGUtdmlldyI6IkRlYWN0aXZhdGVzIGEgdmlldy4iLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtcGljay1hdHRyaWJ1dGUiOiJQaWNrIGFuIGF0dHJpYnV0ZSB0byBzeW1ib2xpemU6IiwibGFuZ3VhZ2UtbWVudS1yZW1vdmUtdXNlci1hZGRlZC1sYXllci1kZXNjIjoiUmVtb3ZlIHRoaXMgdXNlciBhZGRlZCBsYXllciBmcm9tIHRoZSBtYXAuIiwibGFuZ3VhZ2UtdG9vbGJhci1maW5kLWRhdGEtdG9vbHMiOiJGaW5kIERhdGEgVG9vbHMiLCJsYW5ndWFnZS1tZW51LWdsb2JhbC1zYXZlLWFzLWRlc2MiOiJTYXZlIHRoZSBzdGF0ZSBvZiB5b3VyIHZpZXdlciBpbiBhIG5ldyBwcm9qZWN0IiwibGFuZ3VhZ2UtbWVudS1leHBvcnQtcmVzdWx0cy10by1zaHAiOiJFeHBvcnQgdG8gU2hhcGVmaWxlIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWxpbmUtc3R5bGUtbG9uZ2Rhc2giOiJMb25nLWRhc2giLCJsYW5ndWFnZS1zZWFyY2gtd29ybGQtcGxhY2UtbmFtZXMiOiJXb3JsZCBQbGFjZSBOYW1lcyIsImxhbmd1YWdlLWNvbW1vbi1ub3QtYXZhaWxhYmxlLW9mZmxpbmUiOiJUaGlzIGZ1bmN0aW9uIGlzIG5vdCBhdmFpbGFibGUgd2hlbiBvZmZsaW5lLiIsImxhbmd1YWdlLXJlc3VsdHMiOiJSZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1hbmFseXNpcy1tZWFzdXJlbWVudC10b29scyI6Ik1lYXN1cmUiLCJsYW5ndWFnZS10b29sYmFyLW5hdmlnYXRpb24taG9tZS10b29sdGlwIjoiUmV0dXJucyB0byBpbnRyb2R1Y3RvcnkgcGFnZSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2V0LWFjdGl2ZS10b29sIjoiU2V0cyB0aGUgYWN0aXZlIHRvb2wuIiwibGFuZ3VhZ2UtbWVudS1leHBvcnQtcmVzdWx0cy10by14bHN4IjoiRXhwb3J0IHRvIFhMU1giLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLXJlY3RhbmdsZSI6IlJlY3RhbmdsZSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tc2hvdy1sYXllci1saXN0IjoiQWN0aXZhdGVzIHRoZSBMYXllckxpc3QgVmlldy4iLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLWJ5dGVzIjoiezB9IGJ5dGVzIiwibGFuZ3VhZ2UtdG9vbGJhci1zaG93LWxheWVybGlzdCI6IkxheWVyIExpc3QiLCJsYW5ndWFnZS1ncmFudC1lZGl0b3ItZ2xvYmFsLWdyYW50LW5hbWUtcHVibGljIjoiRXZlcnlvbmUgKHNpZ24taW4gbm90IHJlcXVpcmVkKSIsImxhbmd1YWdlLW1lbnUtZHJhdy1wb2ludC1kZXNjIjoiRHJhdyBhIHBvaW50IG9uIHRoZSBtYXAuIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi11cGRhdGUtZmVhdHVyZS1sYXllci1tb2RhbC1tZXNzYWdlIjoiVXBkYXRlIHRoZSB2aXNpYmxlIE1vZGVsTWVzc2FnZVZpZXcgdG8gYWxzbyBpbmNsdWRlIHRoZSBnaXZlbiBtZXNzYWdlLiIsImxhbmd1YWdlLXBhZ2Utb2YiOiJvZiIsImxhbmd1YWdlLXJlc3VsdHMtdG9nZ2xlLXRhYmxlLXZpZXctZGVzYyI6IlZpZXcgcmVzdWx0cyBpbiB0YWJsZSBmb3JtYXQiLCJsYW5ndWFnZS1jb21tb24tZmVhdHVyZS1lZGl0bG9nIjoiVmlldyBFZGl0IExvZyIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tdGFrZS1hcHBsaWNhdGlvbi1vZmZsaW5lIjoiUHV0cyB0aGUgYXBwbGljYXRpb24gaW4gYW4gb2ZmbGluZSBzdGF0ZS4iLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXN0YXJ0LWVkaXRpbmctZmVhdHVyZSI6IkJlZ2lucyBlZGl0aW5nIGFuIGV4aXN0aW5nIGZlYXR1cmUuIiwibGFuZ3VhZ2UtbWVudS1jb21iaW5lLXJlc3VsdHMtaW50ZXJzZWN0IjoiTWF0Y2ggaW50ZXJzZWN0aW5nIHJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWRlZmF1bHQtdGl0bGUiOiJPcHRpb25zIiwibGFuZ3VhZ2UtbWVudS1yZXN1bHRzLWxpc3QtYWN0aW9ucy1kZXNjIjoiUmVzdWx0cyBMaXN0IEFjdGlvbnMiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLXpvb20tdG8tZXh0ZW50IjoiWm9vbXMgdG8gdGhlIGdpdmVuIGV4dGVudC4iLCJsYW5ndWFnZS1wYWdlLXBhZ2UiOiJQYWdlIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLW1hcmtlci1zaXplLXN1ZmZpeCI6InB4IiwibGFuZ3VhZ2Utb2ZmbGluZS1wcm9ncmVzcy1iYXNlbWFwZXhwb3J0LWNvbXBsZXRlZCI6InswfSBnZW5lcmF0ZWQgYW5kIGRvd25sb2FkZWQuIiwibGFuZ3VhZ2UtY29tbW9uLW5vLXJlc3VsdHMtc2hvcnQiOiJObyByZXN1bHRzIiwibGFuZ3VhZ2UtdG9vbGJhci1tZW51LWdsb2JhbC1zYXZlLXNhdmUtYXMiOiJTYXZlL1NhdmUgYXMiLCJsYW5ndWFnZS1wYWdlLWxhc3QiOiJMYXN0IHBhZ2UiLCJsYW5ndWFnZS1tZW51LW9mZmxpbmUtbWFwLWVkaXRvci1nZW9tZXRyeS1hY3Rpb25zLWVsbGlwc2UiOiJFbGxpcHNlIiwibGFuZ3VhZ2UtdG9vbGJhci1tYXJrdXAtZWRpdC1kZXNjLXNob3J0Y3V0cy16b29tIjoiVXNlIGFycm93cyB0byBtb3ZlLCBTIHRvIHNjYWxlLiBDb21iaW5lIHdpdGggQUxUIGZvciBmaW5lciBjb250cm9sLiBDb21iaW5lIHdpdGggU0hJRlQgdG8gcmV2ZXJzZS4iLCJsYW5ndWFnZS10b29sYmFyLWlkZW50aWZ5LXJlY3RhbmdsZS10b29sdGlwIjoiRmluZCBvdXQgYWJvdXQgYW4gYXJlYSBvbiB0aGUgbWFwIGRlZmluZWQgYnkgYSByZWN0YW5nbGUiLCJsYW5ndWFnZS1jb21tb24taGlkZSI6IkhpZGUiLCJsYW5ndWFnZS10b29sYmFyLXRhYi1uYXZpZ2F0aW9uIjoiTmF2aWdhdGlvbiIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1hdHRyaWJ1dGUtc2VsZWN0IjoiUGxlYXNlIENob29zZS4uLiIsImxhbmd1YWdlLWNvbW1vbi1sYXllci1kYXRhIjoiTGF5ZXIgRGF0YSIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1ub2RhdGEtdGl0bGUiOiJObyBEYXRhIiwibGFuZ3VhZ2UtbWVudS1sYXRpdHVkZS1nZW9ncmFwaGljcyI6IkxhdGl0dWRlIEdlb2dyYXBoaWNzIEdyb3VwIEx0ZC4iLCJsYW5ndWFnZS10b29sYmFyLXRhc2tzLWxheWVyLWNhdGFsb2ctdG9vbHRpcCI6IkFkZCBsYXllcnMgdG8gdGhlIG1hcCBmcm9tIGEgbGF5ZXIgY2F0YWxvZyIsImxhbmd1YWdlLXRhYi1zY3JvbGwtbmV4dCI6Ik5leHQgTGF5ZXIiLCJsYW5ndWFnZS1sYXllci1hY3Rpb25zLXRpdGxlIjoiTGF5ZXIgQWN0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWVkaXQtem9vbW91dC10b29sIjoiWm9vbU91dFRvb2wiLCJsYW5ndWFnZS1jb21tb24tbG9hZCI6IkxvYWQiLCJsYW5ndWFnZS1jb21tb24tcmVzdWx0cyI6IlJlc3VsdHMiLCJsYW5ndWFnZS1tZW51LWJyb3dzZS1zYXZlZC1yZXN1bHRzIjoiT3BlbiBTYXZlZCBSZXN1bHRzIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1nZXQtcmVsYXRlZC1mZWF0dXJlIjoiR2V0cyBmZWF0dXJlcyByZWxhdGVkIHRvIHRoZSBmZWF0dXJlLiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWZyZWVoYW5kIjoiRnJlZWhhbmQiLCJsYW5ndWFnZS1tZW51LW1hcHRpcC1hY3Rpb25zIjoiQWN0aW9ucyIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLWV4cG9ydC10b29sdGlwIjoiRXhwb3J0IGRyYXdpbmdzIHRvIHNoYXBlZmlsZSIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcHJvamVjdCI6IkNhbGxzIGEgZ2VvbWV0cnkgc2VydmljZSB0byBwcm9qZWN0IGdlb21ldHJpZXMgYmV0d2VlbiBkaWZmZXJlbnQgY29vcmRpbmF0ZSBzeXN0ZW1zLiIsImxhbmd1YWdlLXRvb2xiYXItZ3JvdXAtdGltZXNsaWRlciI6IlRpbWUgU2xpZGVyIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1wb2x5Z29uIjoiUG9seWdvbiIsImxhbmd1YWdlLXJlc3VsdHMtcGFnZS1sYXN0IjoiTGFzdCBwYWdlIiwibGFuZ3VhZ2UtcmVzdWx0cy10b3RhbCI6IlRvdGFsIiwibGFuZ3VhZ2UtY29tbW9uLWJhY2siOiJCYWNrIiwibGFuZ3VhZ2UtY29tbW9uLXJlc3VsdHMtc3VidHJhY3QtY29uZmlybWF0aW9uIjoiezF9IHN1YnRyYWN0ZWQgZnJvbSAnezB9JyIsImxhbmd1YWdlLXRvb2xiYXItYXJjZ2lzLWV4cG9ydC13ZWItbWFwLXRvb2x0aXAiOiJTYXZlIHRoZSBjdXJyZW50IG1hcCB0byBBcmNHSVMiLCJsYW5ndWFnZS1tZW51LXNhdmUtcmVzdWx0cy1kZXNjIjoiU2F2ZSB0aGUgbGlzdCBvZiByZXN1bHRzIGZvciBmdXR1cmUgdXNlIiwibGFuZ3VhZ2UtbWVudS1lbnRlci1vbmxpbmUtZGVzYyI6IkdvIHRvIG9ubGluZSBtb2RlIGFuZCB2aWV3IGxpdmUgbWFwIGRhdGEgZnJvbSB0aGUgd2ViLiIsImxhbmd1YWdlLWNvbW1hbmQtZGVzY3JpcHRpb24tcHJvbXB0IjoiRGlzcGxheXMgYSBwcm9tcHQuIiwibGFuZ3VhZ2UtY29tbW9uLW5vLXJlc3VsdHMiOiJObyByZXN1bHRzIHRvIGRpc3BsYXkiLCJsYW5ndWFnZS1vZmZsaW5lLXByb2dyZXNzLWJhc2VtYXBleHBvcnQtY2FuY2VsZWQiOiJ7MH0gY2FuY2VsZWQuIiwibGFuZ3VhZ2UtbWVudS1vZmZsaW5lLW1hcC1lZGl0b3ItZ2VvbWV0cnktYWN0aW9ucy1jaXJjbGUtZGVzYyI6IkRyYXcgYSBjaXJjbGUgZm9yIHRoZSBhcmVhIG9mIGludGVyZXN0IGdlb21ldHJ5LiIsImxhbmd1YWdlLXRvb2xiYXItbWFya3VwLXBhbGV0dGUtc21hbGwtY2xlYXItYWxsIjoiQ2xlYXIgQWxsIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1jcmVhdGUtaGlnaGxpZ2h0LWxheWVyIjoiQ3JlYXRlcyBhIG5ldyBoaWdobGlnaHQgbGF5ZXIgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuIiwibGFuZ3VhZ2UtY29tbW9uLWxvYWRpbmciOiJMb2FkaW5nLi4uIiwibGFuZ3VhZ2UtbWVudS12aXN1YWxpemF0aW9uLWRlc2MiOiJDcmVhdGUgYW5kIHZpZXcgY3VzdG9tIGxheWVyIHZpc3VhbGl6YXRpb25zIHN1Y2ggYXMgaGVhdCBtYXBzLCBjbHVzdGVyaW5nLCBhbmQgbGF5ZXIgc3R5bGVzLiIsImxhbmd1YWdlLW1lbnUtaWRlbnRpZnktcmVjdGFuZ2xlIjoiSWRlbnRpZnkgYnkgcmVjdGFuZ2xlIiwibGFuZ3VhZ2Utc3ltYm9sb2d5LXNldHRpbmdzLWZpbGwtc3R5bGUtc29saWQiOiJTb2xpZCIsImxhbmd1YWdlLXN5bWJvbG9neS1zZXR0aW5ncy1maWxsLXN0eWxlIjoiRmlsbCBTdHlsZSIsImxhbmd1YWdlLXRvb2xiYXItYm9va21hcmstb3BlbiI6Ik9wZW4gdGhlIGJvb2ttYXJrcyB2aWV3IiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi1wYW4tdG8tcG9pbnQiOiJQYW5zIHRvIGEgcG9pbnQgb3Igb3RoZXIgdHlwZSBvZiBHZW9tZXRyeS4iLCJsYW5ndWFnZS10b29sYmFyLW1hcmt1cC1lbGxpcHNlIjoiRWxsaXBzZSIsImxhbmd1YWdlLXRvb2xiYXItdGFiLWFuYWx5c2lzIjoiQW5hbHlzaXMiLCJsYW5ndWFnZS1zeW1ib2xvZ3ktc2V0dGluZ3MtbGluZS1zdHlsZS1kYXNoIjoiRGFzaCIsImxhbmd1YWdlLXNtYXJ0LXBhbmVsLWNsb3NlIjoiQ2xvc2UgUGFuZWwiLCJsYW5ndWFnZS1jb21tYW5kLWRlc2NyaXB0aW9uLWZlYXR1cmUtbGF5ZXItY2xlYXItZGF0YSI6IkNsZWFycyB0aGUgZGF0YSBmb3IgYSBnaXZlbiBtYXAgc2VydmljZSBVUkwuIiwibGFuZ3VhZ2UtdG9vbGJhci1idWZmZXJpbmctZGlzYWJsZSI6IkRpc2FibGUgYnVmZmVyaW5nIiwibGFuZ3VhZ2UtY29tbWFuZC1kZXNjcmlwdGlvbi11cGRhdGUtcmVsYXRlZC1yZWNvcmQiOiJVcGRhdGVzIGEgcmVsYXRlZCB0YWJsZSByZWNvcmQuIiwibGFuZ3VhZ2UtdG9vbGJhci1ib29rbWFyayI6IkJvb2ttYXJrcyIsImxhbmd1YWdlLWZyYW1ld29yay11aS12aWV3LWNvbnRhaW5lci12aWV3LWJhY2siOiJHbyBCYWNrIHswfSJ9"),geocortex.framework.notifyLibraryDownload("Mapping.Infrastructure");