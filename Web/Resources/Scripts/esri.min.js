(function(n,t){var o,d=function(){},ar=function(n){for(var t in n)return 0;return 1},ai={}.toString,g=function(n){return"[object Function]"==ai.call(n)},it=function(n){return"[object String]"==ai.call(n)},vi=function(n){return"[object Array]"==ai.call(n)},s=function(n,t){if(n)for(var i=0;i<n.length;)t(n[i++])},u=function(n,t){for(var i in t)n[i]=t[i];return n},l=function(n,t){return u(Error(n),{src:"dojoLoader",info:t})},au=1,vr=function(){return"_"+au++},i=function(n,t,r){return ru(n,t,r,0,i)},rt=this,v=rt.document,vu=v&&v.createElement("DiV"),r=i.has=function(n){return g(nt[n])?nt[n]=nt[n](rt,v,vu):nt[n]},nt=r.cache=t.hasCache,yi,pr,bi,wr,ki,br,ti,p,et,ii,ht,li,cr,lr;r.add=function(n,t,i,u){return(void 0===nt[n]||u)&&(nt[n]=t),i&&r(n)};r.add("host-webworker","undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);r("host-webworker")&&(u(t.hasCache,{"host-browser":0,dom:0,"dojo-dom-ready-api":0,"dojo-sniff":0,"dojo-inject-api":1,"host-webworker":1,"dojo-guarantee-console":0}),t.loaderPatch={injectUrl:function(n,t){try{importScripts(n);t()}catch(i){console.info("failed to load resource ("+n+")");console.error(i)}}});for(yi in n.has)r.add(yi,n.has[yi],0,1);var f=0,ut=[],pi=0,wi=d,yr=d,bt;if(i.isXdUrl=d,i.initSyncLoader=function(n,t,i){return pi||(pi=n,wi=t,yr=i),{sync:"sync",requested:1,arrived:2,nonmodule:3,executing:4,executed:5,syncExecStack:ut,modules:e,execQ:h,getModule:y,injectModule:hi,setArrived:tt,signal:a,finishExec:at,execModule:vt,dojoRequirePlugin:pi,getLegacyMode:function(){return f},guardCheckComplete:pt}},pr=location.protocol,bi=location.host,i.isXdUrl=function(n){return/^\./.test(n)?!1:/^\/\//.test(n)?!0:(n=n.match(/^([^\/\:]+\:)\/+([^\/]+)/))&&(n[1]!=pr||bi&&n[2]!=bi)},r.add("dojo-force-activex-xhr",!v.addEventListener&&"file:"==window.location.protocol),r.add("native-xhr","undefined"!=typeof XMLHttpRequest),r("native-xhr")&&!r("dojo-force-activex-xhr"))bt=function(){return new XMLHttpRequest};else{for(wr=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=0;3>o;)try{ki=wr[o++];new ActiveXObject(ki);break}catch(ef){}bt=function(){return new ActiveXObject(ki)}}i.getXhr=bt;r.add("dojo-gettext-api",1);i.getText=function(n,t,i){var r=bt();if(r.open("GET",oi(n),!1),r.send(null),200!=r.status&&(location.host||r.status))throw l("xhrFailed",r.status);else i&&i(r.responseText,t);return r.responseText};br=r("csp-restrictions")?function(){}:new Function("return eval(arguments[0]);");i.eval=function(n,t){return br(n+"\r\n//# sourceURL="+t)};var di={},a=i.signal=function(n,t){var i=di[n];s(i&&i.slice(0),function(n){n.apply(null,vi(t)?t:[t])})},yu=i.on=function(n,t){var i=di[n]||(di[n]=[]);return i.push(t),{remove:function(){for(var n=0;n<i.length;n++)if(i[n]===t){i.splice(n,1);break}}}},kr=[],pu={},dr=[],w={},gr=i.map={},kt=[],e={},gi="",b={},dt={},gt={},ft=0,ni=function(n){var t,r,i,u;for(t in dt)r=dt[t],(i=t.match(/^url\:(.+)/))?b["url:"+su(i[1],n)]=r:"*now"==t?u=r:"*noref"!=t&&(i=lt(t,n,!0),b[i.mid]=b["url:"+i.url]=r);u&&u(tr(n));dt={}},nu=function(n){return n.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(n){return"\\"+n})},nr=function(n,t){t.splice(0,t.length);for(var i in n)t.push([i,n[i],new RegExp("^"+nu(i)+"(/|$)"),i.length]);return t.sort(function(n,t){return t[3]-n[3]}),t},wu=function(n,t){s(n,function(n){t.push([it(n[0])?new RegExp("^"+nu(n[0])+"$"):n[0],n[1]])})},tu=function(n){var t=n.name;t||(t=n,n={name:t});n=u({main:"main"},n);n.location=n.location?n.location:t;n.packageMap&&(gr[t]=n.packageMap);n.main.indexOf("./")||(n.main=n.main.substring(2));w[t]=n},iu=[],st=function(n,t,e){var o,h,c;for(o in n)"waitSeconds"==o&&(i.waitms=1e3*(n[o]||0)),"cacheBust"==o&&(gi=n[o]?it(n[o])?n[o]:(new Date).getTime()+"":""),("baseUrl"==o||"combo"==o)&&(i[o]=n[o]),"async"==o&&(h=n[o],i.legacyMode=f=it(h)&&/sync|legacyAsync/.test(h)?h:h?!1:"sync",i.async=!f),n[o]!==nt&&(i.rawConfig[o]=n[o],"has"!=o&&r.add("config-"+o,n[o],0,t));i.baseUrl||(i.baseUrl="./");/\/$/.test(i.baseUrl)||(i.baseUrl+="/");for(o in n.has)r.add(o,n.has[o],0,t);s(n.packages,tu);for(c in n.packagePaths)s(n.packagePaths[c],function(n){var t=c+"/"+n;it(n)&&(n={name:n});n.location=t;tu(n)});if(nr(u(gr,n.map),kt),s(kt,function(n){n[1]=nr(n[1],[]);"*"==n[0]&&(kt.star=n)}),nr(u(pu,n.paths),dr),wu(n.aliases,kr),t)iu.push({config:n.config});else for(o in n.config)t=y(o,e),t.config=u(t.config||{},n.config[o]);n.cache&&(ni(),dt=n.cache,n.cache["*noref"]&&ni());a("config",[n,i.rawConfig])};for(r("dojo-cdn"),ti=v.getElementsByTagName("script"),o=0;o<ti.length;)(p=ti[o++],(ii=p.getAttribute("src"))&&(ht=ii.match(/(((.*)\/)|^)dojo\.js(\W|$)/i))&&(et=ht[3]||"",t.baseUrl=t.baseUrl||et,ft=p),ii=p.getAttribute("data-dojo-config")||p.getAttribute("djConfig"))&&(gt=i.eval("({ "+ii+" })","data-dojo-config"),ft=p);i.rawConfig={};st(t,1);r("dojo-cdn")&&((w.dojo.location=et)&&(et+="/"),w.dijit.location=et+"../dijit/",w.dojox.location=et+"../dojox/");st(n,1);st(gt,1);var ct=function(n){pt(function(){s(n.deps,hi)})},ru=function(n,t,r,o,s){var c,p,a,v,w;if(it(n)){if((c=y(n,o,!0))&&c.executed)return c.result;throw l("undefinedModule",n);}if(vi(n)||(st(n,0,o),n=t,t=r),vi(n))if(n.length){for(r="require*"+vr(),a=[],v=0;v<n.length;)p=n[v++],a.push(y(p,o));c=u(ui("",r,0,""),{injected:2,deps:a,def:t||d,require:o?o.require:i,gc:1});e[c.mid]=c;ct(c);w=yt&&"sync"!=f;pt(function(){vt(c,w)});c.executed||h.push(c);ot()}else t&&t();return s},tr=function(n){if(!n)return i;var t=n.require;return t||(t=function(i,r,u){return ru(i,r,u,n,t)},n.require=u(t,i),t.module=n,t.toUrl=function(t){return su(t,n)},t.toAbsMid=function(t){return rr(t,n)},r("dojo-undef-api")&&(t.undef=function(t){i.undef(t,n)}),t.syncLoadNls=function(t){t=lt(t,n);var i=e[t.mid];return i&&i.executed||(k=b[t.mid]||b["url:"+t.url])&&(si(k),i=e[t.mid]),i&&i.executed&&i.result}),t},h=[],ri=[],c={},bu=function(n){n.injected=1;c[n.mid]=1;n.url&&(c[n.url]=n.pack||1);uf()},tt=function(n){n.injected=2;delete c[n.mid];n.url&&delete c[n.url];ar(c)&&(sr(),"xd"==f&&(f="sync"))},ku=i.idle=function(){return!ri.length&&ar(c)&&!h.length&&!yt},ir=function(n,t){if(t)for(var i=0;i<t.length;i++)if(t[i][2].test(n))return t[i];return 0},uu=function(n){var t=[],i,r;for(n=n.replace(/\\/g,"/").split("/");n.length;)i=n.shift(),".."==i&&t.length&&".."!=r?(t.pop(),r=t[t.length-1]):"."!=i&&t.push(r=i);return t.join("/")},ui=function(n,t,r,u){var f=i.isXdUrl(u);return{pid:n,mid:t,pack:r,url:u,executed:0,def:0,isXd:f,isAmd:!!(f||w[n]&&w[n].isAmd)}},fu=function(n,t,i,u,f,e,o,h,c){var v,w,a,p,y;if(p=/^\./.test(n),/(^\/)|(\:)|(\.js$)/.test(n)||p&&!t)return ui(0,n,0,n);if(n=uu(p?t.mid+"/../"+n:n),/^\./.test(n))throw l("irrationalPath",n);return(t&&(a=ir(t.mid,e)),(a=(a=a||e.star)&&ir(n,a[1]))&&(n=a[1]+n.substring(a[3])),t=(ht=n.match(/^([^\/]+)(\/(.+))?$/))?ht[1]:"",(v=i[t])?n=t+"/"+(w=ht[3]||v.main):t="",y=0,s(h,function(t){var i=n.match(t[0]);i&&0<i.length&&(y=g(t[1])?n.replace(t[0],t[1]):t[1])}),y)?fu(y,0,i,u,f,e,o,h,c):(i=u[n])?c?ui(i.pid,i.mid,i.pack,i.url):u[n]:(u=(a=ir(n,o))?a[1]+n.substring(a[3]):t?v.location+"/"+w:r("config-tlmSiblingOfDojo")?"../"+n:n,/(^\/)|(\:)/.test(u)||(u=f+u),ui(t,n,v,uu(u+".js")))},lt=function(n,t,r){return fu(n,t,w,e,i.baseUrl,r?[]:kt,r?[]:dr,r?[]:kr)},eu=function(n,t,i){return n.normalize?n.normalize(t,function(n){return rr(n,i)}):rr(t,i)},ou=0,y=function(n,t,i){var u,r;return(u=n.match(/^(.+?)\!(.*)$/))?(r=y(u[1],t,i),"sync"!=f||r.executed||(hi(r),2!==r.injected||r.executed||pt(function(){vt(r)}),r.executed?ei(r):h.unshift(r)),5!==r.executed||r.load||ei(r),r.load?(u=eu(r,u[2],t),n=r.mid+"!"+(r.dynamic?++ou+"!":"")+u):(u=u[2],n=r.mid+"!"+ ++ou+"!waitingForPlugin"),n={plugin:r,mid:n,req:tr(t),prid:u}):n=lt(n,t),e[n.mid]||!i&&(e[n.mid]=n)},rr=i.toAbsMid=function(n,t){return lt(n,t).mid},su=i.toUrl=function(n,t){var i=lt(n+"/x",t),r=i.url;return oi(0===i.pid?n:r.substring(0,r.length-5))},hu={injected:2,executed:5,def:3,result:3},ur=function(n){return e[n]=u({mid:n},hu)},du=ur("require"),gu=ur("exports"),nf=ur("module"),fi={},fr=0,ei=function(n){var t=n.result;return n.dynamic=t.dynamic,n.normalize=t.normalize,n.load=t.load,n},tf=function(n){var i={},t,r;s(n.loadQ,function(t){var f=eu(n,t.prid,t.req.module),r=n.dynamic?t.mid.replace(/waitingForPlugin$/,f):n.mid+"!"+f,f=u(u({},t),{mid:r,prid:f,injected:0});e[r]&&e[r].injected||cu(e[r]=f);i[t.mid]=e[r];tt(t);delete e[t.mid]});n.loadQ=0;t=function(n){for(var r=n.deps||[],t=0;t<r.length;t++)(n=i[r[t].mid])&&(r[t]=n)};for(r in e)t(e[r]);s(h,t)},at=function(n){for(i.trace("loader-finish-exec",[n.mid]),n.executed=5,n.defOrder=fr++,s(n.provides,function(n){n()}),n.loadQ&&(ei(n),tf(n)),o=0;o<h.length;)h[o]===n?h.splice(o,1):o++;/^require\*/.test(n.mid)&&delete e[n.mid]},rf=[],vt=function(n,t){var u,e;if(4===n.executed)return i.trace("loader-circular-dependency",[rf.concat(n.mid).join("->")]),!n.def||t?fi:n.cjs&&n.cjs.exports;if(!n.executed){if(!n.def)return fi;var u=n.mid,s=n.deps||[],f,o=[],h=0;for(n.executed=4;f=s[h++];){if(f=f===du?tr(n):f===gu?n.cjs.exports:f===nf?n.cjs:vt(f,t),f===fi)return n.executed=0,i.trace("loader-exec-module",["abort",u]),fi;o.push(f)}if(i.trace("loader-run-factory",[n.mid]),u=n.def,ut.unshift(n),r("config-dojo-loader-catches"))try{e=g(u)?u.apply(null,o):u}catch(c){a("error",n.result=l("factoryThrew",[n,c]))}else e=g(u)?u.apply(null,o):u;n.result=void 0===e&&n.cjs?n.cjs.exports:e;ut.shift(n);at(n)}return n.result},yt=0,pt=function(n){try{yt++;n()}catch(t){throw t;}finally{yt--}ku()&&a("idle",[])},ot=function(){yt||pt(function(){wi();for(var t,i,n=0;n<h.length;)t=fr,i=h[n],vt(i),t!=fr?(wi(),n=0):n++})};r("dojo-undef-api")&&(i.undef=function(n,t){var i=y(n,t);tt(i);u(i,{def:0,executed:0,injected:0,node:0,load:0})});void 0===r("dojo-loader-eval-hint-url")&&r.add("dojo-loader-eval-hint-url",1);var oi="function"==typeof n.fixupUrl?n.fixupUrl:function(n){return n+="",n+(gi?(/\?/.test(n)?"&":"?")+gi:"")},cu=function(n){var t=n.plugin,i;5!==t.executed||t.load||ei(t);i=function(t){n.result=t;tt(n);at(n);ot()};t.load?t.load(n.prid,n.req,i):t.loadQ?t.loadQ.push(n):(t.loadQ=[n],h.unshift(t),hi(t))},k=0,wt=0,er=0,si=function(n,t){if(r("config-stripStrict")&&(n=n.replace(/(["'])use strict\1/g,"")),er=1,r("config-dojo-loader-catches"))try{n===k?k.call(null):i.eval(n,r("dojo-loader-eval-hint-url")?t.url:t.mid)}catch(u){a("error",l("evalModuleThrew",t))}else n===k?k.call(null):i.eval(n,r("dojo-loader-eval-hint-url")?t.url:t.mid);er=0},hi=function(n){var o=n.mid,t=n.url,e,v;if(!(n.executed||n.injected||c[o]||n.url&&(n.pack&&c[n.url]===n.pack||1==c[n.url])))if(bu(n),n.plugin)cu(n);else if(e=function(){if(lu(n),2!==n.injected){if(r("dojo-enforceDefine")){a("error",l("noDefine",n));return}tt(n);u(n,hu);i.trace("loader-define-nonmodule",[n.url])}f?!ut.length&&ot():ot()},k=b[o]||b["url:"+n.url])i.trace("loader-inject",["cache",n.mid,t]),si(k,n),e();else{if(f)if(n.isXd)"sync"==f&&(f="xd");else if(!n.isAmd||"sync"==f){if(v=function(r){if("sync"==f){if(ut.unshift(n),si(r,n),ut.shift(),lu(n),n.cjs||(tt(n),at(n)),n.finish){r=o+"*finish";var u=n.finish;delete n.finish;li(r,["dojo",("dojo/require!"+u.join(",")).replace(/\./g,"/")],function(n){s(u,function(t){n.require(t)})});h.unshift(y(r))}e()}else(r=yr(n,r))?(si(r,n),e()):(wt=n,i.injectUrl(oi(t),e,n),wt=0)},i.trace("loader-inject",["xhr",n.mid,t,"sync"!=f]),r("config-dojo-loader-catches"))try{i.getText(t,"sync"!=f,v)}catch(p){a("error",l("xhrInjectFailed",[n,p]))}else i.getText(t,"sync"!=f,v);return}i.trace("loader-inject",["script",n.mid,t]);wt=n;i.injectUrl(oi(t),e,n);wt=0}},or=function(n,t,r){var o,e;if(i.trace("loader-define-module",[n.mid,t]),o=n.mid,2===n.injected)return a("error",l("multipleDefine",n)),n;for(u(n,{deps:t,def:r,cjs:{id:n.mid,uri:n.url,exports:n.result={},setExports:function(t){n.cjs.exports=t},config:function(){return n.config}}}),e=0;t[e];e++)t[e]=y(t[e],n);return f&&!c[o]&&(ct(n),h.push(n),ot()),tt(n),g(r)||t.length||(n.result=r,at(n)),n},lu=function(n,t){for(var r=[],u,i;ri.length;)i=ri.shift(),t&&(i[0]=t.shift()),u=i[0]&&y(i[0])||n,r.push([u,i[1],i[2]]);ni(n);s(r,function(n){ct(or.apply(null,n))})},ci=0,sr=d,uf=d,sr=function(){ci&&clearTimeout(ci);ci=0},uf=function(){sr();i.waitms&&(ci=rt.setTimeout(function(){sr();a("error",l("timeout",c))},i.waitms))};r.add("ie-event-behavior",v.attachEvent&&"undefined"==typeof Windows&&("undefined"==typeof opera||"[object Opera]"!=opera.toString()));var hr=function(n,t,i,u){return r("ie-event-behavior")?(n.attachEvent(i,u),function(){n.detachEvent(i,u)}):(n.addEventListener(t,u,!1),function(){n.removeEventListener(t,u,!1)})},ff=hr(window,"load","onload",function(){i.pageLoaded=1;try{"complete"!=v.readyState&&(v.readyState="complete")}catch(n){}ff()}),ti=v.getElementsByTagName("script");for(o=0;!ft;)/^dojo/.test((p=ti[o++])&&p.type)||(ft=p);i.injectUrl=function(n,t,i){i=i.node=v.createElement("script");var r=hr(i,"load","onreadystatechange",function(n){n=n||window.event;var i=n.target||n.srcElement;("load"===n.type||/complete|loaded/.test(i.readyState))&&(r(),u(),t&&t())}),u=hr(i,"error","onerror",function(t){r();u();a("error",l("scriptError",[n,t]))});return i.type="text/javascript",i.charset="utf-8",i.src=n,ft.parentNode.insertBefore(i,ft),i};i.log=function(){try{for(var n=0;n<arguments.length;n++)console.log(arguments[n])}catch(t){}};i.trace=d;li=function(n,t,u){var f=arguments.length,s=["require","exports","module"],o=[0,n,t];if(1==f?o=[0,g(n)?s:[],n]:2==f&&it(n)?o=[n,g(t)?s:[],t]:3==f&&(o=[n,t,u]),i.trace("loader-define",o.slice(0,2)),(f=o[0]&&y(o[0]))&&!c[f.mid])ct(or(f,o[1],o[2]));else if(!r("ie-event-behavior")||er)ri.push(o);else{if(f=f||wt,!f)for(n in c)if((s=e[n])&&s.node&&"interactive"===s.node.readyState){f=s;break}f?(ni(f),ct(or(f,o[1],o[2]))):a("error",l("ieDefineFailed",o[0]));ot()}};li.amd={vendor:"dojotoolkit.org"};u(u(i,t.loaderPatch),n.loaderPatch);yu("error",function(n){try{if(console.error(n),n instanceof Error){for(var t in n)console.log(t+":",n[t]);console.log(".")}}catch(i){}});u(i,{uid:vr,cache:b,packs:w});rt.define?a("error",l("defineAlreadyDefined",0)):(rt.define=li,rt.require=i,s(iu,function(n){st(n)}),cr=gt.deps||n.deps||t.deps,lr=gt.callback||n.callback||t.callback,i.boot=cr||lr?[cr||[],lr]:0)})(this.dojoConfig||this.djConfig||this.require||{},{async:0,baseUrl:typeof geocortexUseLocalEsriApi!="undefined"&&geocortexUseLocalEsriApi?"Resources/Scripts/dojo":(location.protocol==="file:"?"http:":location.protocol)+"//js.arcgis.com/3.21/dojo",hasCache:{"config-selectorEngine":"acme","config-tlmSiblingOfDojo":1,"dojo-built":1,"dojo-has-api":1,"dojo-loader":1,"dojo-undef-api":0,dom:1,"extend-esri":1,"host-browser":1},packages:[{location:"../dijit",name:"dijit"},{location:"../dojox",name:"dojox"},{location:"../put-selector",main:"put",name:"put-selector"},{location:"../xstyle",name:"xstyle"},{location:"../dgrid",main:"OnDemandGrid",name:"dgrid"},{location:"../dgrid1",main:"OnDemandGrid",name:"dgrid1"},{location:"../dstore",main:"Store",name:"dstore"},{location:"../moment",main:"moment.js",name:"moment"},{location:"../esri",name:"esri"},{location:".",name:"dojo"}]});require({cache:{"dojo/loadInit":function(){define(["./_base/loader"],function(n){return{dynamic:0,normalize:function(n){return n},load:n.loadInit}})},"dojo/_base/loader":function(){define("./kernel ../has require module ../json ./lang ./array".split(" "),function(n,t,i,r,u,f,e){var h=function(n){return n.replace(/\./g,"/")},rt=/\/\/>>built/,a=[],ut=[],v=function(n,t,i){a.push(i);e.forEach(n.split(","),function(n){n=s(n,t.module);ut.push(n);nt(n)});p()},p=function(){var n;for(var t in d)if(n=d[t],void 0===n.noReqPluginCheck&&(n.noReqPluginCheck=/loadInit\!/.test(t)||/require\!/.test(t)?1:0),!n.executed&&!n.noReqPluginCheck&&n.injected==st)return;yt(function(){var n=a;a=[];e.forEach(n,function(n){n(1)})})},ft=function(t,i,r){var u=/\(|\)/g,f=1;for(u.lastIndex=i;(i=u.exec(t))&&(f=")"==i[0]?f-1:f+1,0!=f););if(0!=f)throw"unmatched paren around character "+u.lastIndex+" in: "+t;return[n.trim(t.substring(r,u.lastIndex))+";\n",u.lastIndex]},et=/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/mg,l=/(^|\s)dojo\.(loadInit|require|provide|requireLocalization|requireIf|requireAfterIf|platformRequire)\s*\(/mg,y=/(^|\s)(require|define)\s*\(/m,w=function(n,t){var i,r,u,f=[],e=[];for(i=[],t=t||n.replace(et,function(n){return l.lastIndex=y.lastIndex=0,l.test(n)||y.test(n)?"":n});i=l.exec(t);)r=l.lastIndex,u=r-i[0].length,r=ft(t,r,u),"loadInit"==i[2]?f.push(r[0]):e.push(r[0]),l.lastIndex=r[1];return i=f.concat(e),i.length||!y.test(t)?[n.replace(/(^|\s)dojo\.loadInit\s*\(/g,"\n0 && dojo.loadInit("),i.join(""),i]:0},o=i.initSyncLoader(v,p,function(n,t){var r,f,i=[],o=[],e;if(rt.test(t)||!(r=w(t)))return 0;f=n.mid+"-*loadInit";for(e in s("dojo",n).result.scopeMap)i.push(e),o.push('"'+e+'"');return"// xdomain rewrite of "+n.mid+"\ndefine('"+f+"',{\n\tnames:"+u.stringify(i)+",\n\tdef:function("+i.join(",")+"){"+r[1]+"}});\n\ndefine("+u.stringify(i.concat(["dojo/loadInit!"+f]))+", function("+i.join(",")+"){\n"+r[0]+"});"}),ot=o.sync,st=o.requested,ht=o.arrived,b=o.nonmodule,ct=o.executing,k=o.executed,c=o.syncExecStack,d=o.modules,g=o.execQ,s=o.getModule,nt=o.injectModule,tt=o.setArrived,lt=o.signal,at=o.finishExec,vt=o.execModule,it=o.getLegacyMode,yt=o.guardCheckComplete,v=o.dojoRequirePlugin;return n.provide=function(n){var r=c[0],t=f.mixin(s(h(n),i.module),{executed:ct,result:f.getObject(n,!0)});return tt(t),r&&(r.provides||(r.provides=[])).push(function(){t.result=f.getObject(n);delete t.provides;t.executed!==k&&at(t)}),t.result},t.add("config-publishRequireResult",1,0,0),n.require=function(n,r){var u=function(n,t){var r=s(h(n),i.module),u;if(c.length&&c[0].finish)c[0].finish.push(n);else{if(r.executed||(t&&(r.result=b),u=it(),nt(r),u=it(),r.executed!==k&&r.injected===ht&&o.guardCheckComplete(function(){vt(r)}),r.executed))return r.result;u==ot?r.cjs?g.unshift(r):c.length&&(c[0].finish=[n]):g.push(r)}}(n,r);return t("config-publishRequireResult")&&!f.exists(n)&&void 0!==u&&f.setObject(n,u),u},n.loadInit=function(n){n()},n.registerModulePath=function(n,t){var r={};r[n.replace(/\./g,"/")]=t;i({paths:r})},n.platformRequire=function(t){t=(t.common||[]).concat(t[n._name]||t["default"]||[]);for(var i;t.length;)f.isArray(i=t.shift())?n.require.apply(n,i):n.require(i)},n.requireIf=n.requireAfterIf=function(t,i,r){t&&n.require(i,r)},n.requireLocalization=function(n,t,r){i(["../i18n"],function(i){i.getLocalization(n,t,r)})},{extractLegacyApiApplications:w,require:v,loadInit:function(t,i,u){i([t],function(t){i(t.names,function(){for(var o="",y=[],e=0;e<arguments.length;e++)o+="var "+t.names[e]+"= arguments["+e+"]; ",y.push(arguments[e]);eval(o);var a=i.module,c=[],l,o={provide:function(n){n=h(n);n=s(n,a);n!==a&&tt(n)},require:function(n,t){n=h(n);t&&(s(n,a).result=b);c.push(n)},requireLocalization:function(t,i,r){l||(l=["dojo/i18n"]);r=(r||n.locale).toLowerCase();t=h(t)+"/nls/"+(/root/i.test(r)?"":r+"/")+h(i);s(t,a).isXd&&l.push("dojo/i18n!"+t)},loadInit:function(n){n()}},e={},f;try{for(f in o)e[f]=n[f],n[f]=o[f];t.def.apply(null,y)}catch(p){lt("error",[{src:r.id,id:"failedDojoLoadInit"},p])}finally{for(f in o)n[f]=e[f]}l&&(c=c.concat(l));c.length?v(c.join(","),i,u):u()})})}}})},"dojo/_base/kernel":function(){define(["../has","./config","require","module"],function(n,t,i,r){var e,f,s;e=function(){return this}();var o={},h={},u={config:t,global:e,dijit:o,dojox:h},o={dojo:["dojo",u],dijit:["dijit",o],dojox:["dojox",h]};r=i.map&&i.map[r.id.match(/[^\/]+/)[0]];for(f in r)o[f]?o[f][0]=r[f]:o[f]=[r[f],{}];for(f in o)r=o[f],r[1]._scopeName=r[0],t.noGlobals||(e[r[0]]=r[1]);for(u.scopeMap=o,u.baseUrl=u.config.baseUrl=i.baseUrl,u.isAsync=i.async,u.locale=t.locale,e="$Rev: 594ed6f $".match(/[0-9a-f]{7,}/),u.version={major:1,minor:12,patch:2,flag:"",revision:e?e[0]:NaN,toString:function(){var n=u.version;return n.major+"."+n.minor+"."+n.patch+n.flag+" ("+n.revision+")"}},n("csp-restrictions")||Function("d","d.eval = function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(u),u.exit=function(){},n("host-webworker"),n.add("console-as-object",function(){return Function.prototype.bind&&console&&"object"==typeof console.log}),"undefined"!=typeof console||(console={}),r="assert count debug dir dirxml error group groupEnd info profile profileEnd time timeEnd trace warn log".split(" "),e=0;s=r[e++];)console[s]?n("console-as-object")&&(console[s]=Function.prototype.bind.call(console[s],console)):function(){var n=s+"";console[n]="log"in console?function(){var t=Array.prototype.slice.call(arguments);t.unshift(n+":");console.log(t.join(" "))}:function(){};console[n]._fake=!0}();if(n.add("dojo-debug-messages",!!t.isDebug),u.deprecated=u.experimental=function(){},n("dojo-debug-messages")&&(u.deprecated=function(n,t,i){n="DEPRECATED: "+n;t&&(n+=" "+t);i&&(n+=" -- will be removed in version: "+i);console.warn(n)},u.experimental=function(n,t){var i="EXPERIMENTAL: "+n+" -- APIs subject to change without notice.";t&&(i+=" "+t);console.warn(i)}),t.modulePaths){u.deprecated("dojo.modulePaths","use paths configuration");n={};for(f in t.modulePaths)n[f.replace(/\./g,"/")]=t.modulePaths[f];i({paths:n})}return u.moduleUrl=function(n,t){u.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var r=null;return n&&(r=i.toUrl(n.replace(/\./g,"/")+(t?"/"+t:"")+"/*.*").replace(/\/\*\.\*/,"")+(t?"":"/")),r},u._hasResource={},u})},"dojo/has":function(){define(["require","module"],function(n,t){var i=n.has||function(){};if(!i("dojo-has-api")){var u="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location==location&&window.document==document,e=function(){return this}(),f=u&&document,o=f&&f.createElement("DiV"),r=t.config&&t.config()||{},i=function(n){return"function"==typeof r[n]?r[n]=r[n](e,f,o):r[n]};i.cache=r;i.add=function(n,t,u,f){return("undefined"==typeof r[n]||f)&&(r[n]=t),u&&i(n)}}return i.add("dom-addeventlistener",!!document.addEventListener),i.add("touch","ontouchstart"in document||"onpointerdown"in document&&0<navigator.maxTouchPoints||window.navigator.msMaxTouchPoints),i.add("touch-events","ontouchstart"in document),i.add("pointer-events","pointerEnabled"in window.navigator?window.navigator.pointerEnabled:"PointerEvent"in window),i.add("MSPointer",window.navigator.msPointerEnabled),i.add("touch-action",i("touch")&&i("pointer-events")),i.add("device-width",screen.availWidth||innerWidth),u=document.createElement("form"),i.add("dom-attributes-explicit",0==u.attributes.length),i.add("dom-attributes-specified-flag",0<u.attributes.length&&40>u.attributes.length),i.clearElement=function(n){return n.innerHTML="",n},i.normalize=function(n,t){var u=n.match(/[\?:]|[^:\?]*/g),f=0,r=function(n){var t=u[f++];return":"==t?0:"?"==u[f++]?!n&&i(t)?r():(r(!0),r(n)):t||0};return(n=r())&&t(n)},i.load=function(n,t,i){n?t([n],i):i()},i})},"dojo/_base/config":function(){define(["../has","require"],function(n,t){var i={},r=t.rawConfig;for(var u in r)i[u]=r[u];return!i.locale&&"undefined"!=typeof navigator&&(r=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage)&&(i.locale=r.toLowerCase()),i})},"dojo/json":function(){define(["./has"],function(n){var i="undefined"!=typeof JSON,t;return(n.add("json-parse",i),n.add("json-stringify",i&&'{"a":1}'==JSON.stringify({a:0},function(n,t){return t||1})),n("json-stringify"))?JSON:(t=function(n){return('"'+n.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},{parse:n("json-parse")?JSON.parse:function(n,t){if(t&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(n))throw new SyntaxError("Invalid characters in JSON");return eval("("+n+")")},stringify:function(n,i,r){function u(n,e,o){var s,a,h,v;if(i&&(n=i(o,n)),s=typeof n,"number"==s)return isFinite(n)?n+"":"null";if("boolean"==s)return n+"";if(null===n)return"null";if("string"==typeof n)return t(n);if("function"==s||"undefined"==s)return f;if("function"==typeof n.toJSON)return u(n.toJSON(o),e,o);if(n instanceof Date)return'"{FullYear}-{Month+}-{Date}T{Hours}:{Minutes}:{Seconds}Z"'.replace(/\{(\w+)(\+)?\}/g,function(t,i,r){return t=n["getUTC"+i]()+(r?1:0),10>t?"0"+t:t});if(n.valueOf()!==n)return u(n.valueOf(),e,o);var c=r?e+r:"",a=r?" ":"",l=r?"\n":"";if(n instanceof Array){for(a=n.length,h=[],o=0;o<a;o++)s=u(n[o],c,o),"string"!=typeof s&&(s="null"),h.push(l+c+s);return"["+h.join(",")+l+e+"]"}h=[];for(o in n)if(n.hasOwnProperty(o)){if("number"==typeof o)v='"'+o+'"';else if("string"==typeof o)v=t(o);else continue;s=u(n[o],c,o);"string"==typeof s&&h.push(l+c+v+":"+a+s)}return"{"+h.join(",")+l+e+"}"}var f;return"string"==typeof i&&(r=i,i=null),u(n,"","")}})})},"dojo/_base/lang":function(){define(["./kernel","../has","../sniff"],function(n,t){t.add("bug-for-in-skips-shadowed",function(){for(var n in{toString:1})return 0;return 1});var r=t("bug-for-in-skips-shadowed")?"hasOwnProperty valueOf isPrototypeOf propertyIsEnumerable toLocaleString toString constructor".split(" "):[],o=r.length,u=function(t,i,r){var u,f;r||(r=t[0]&&n.scopeMap[t[0]]?n.scopeMap[t.shift()][1]:n.global);try{for(u=0;u<t.length;u++){if(f=t[u],!(f in r))if(i)r[f]={};else return;r=r[f]}return r}catch(e){}},f=Object.prototype.toString,e=function(n,t,i){return(i||[]).concat(Array.prototype.slice.call(n,t||0))},s=/\{([^\}]+)\}/g,i={_extraNames:r,_mixin:function(n,i,u){var f,e,s,h={};for(f in i)e=i[f],f in n&&(n[f]===e||f in h&&h[f]===e)||(n[f]=u?u(e):e);if(t("bug-for-in-skips-shadowed")&&i)for(s=0;s<o;++s)f=r[s],e=i[f],f in n&&(n[f]===e||f in h&&h[f]===e)||(n[f]=u?u(e):e);return n},mixin:function(n){n||(n={});for(var t=1,r=arguments.length;t<r;t++)i._mixin(n,arguments[t]);return n},setObject:function(n,t,i){var r=n.split(".");return n=r.pop(),(i=u(r,!0,i))&&n?i[n]=t:void 0},getObject:function(n,t,i){return n?u(n.split("."),t,i):i},exists:function(n,t){return void 0!==i.getObject(n,!1,t)},isString:function(n){return"string"==typeof n||n instanceof String},isArray:Array.isArray||function(n){return"[object Array]"==f.call(n)},isFunction:function(n){return"[object Function]"===f.call(n)},isObject:function(n){return void 0!==n&&(null===n||"object"==typeof n||i.isArray(n)||i.isFunction(n))},isArrayLike:function(n){return!!n&&!i.isString(n)&&!i.isFunction(n)&&!(n.tagName&&"form"==n.tagName.toLowerCase())&&(i.isArray(n)||isFinite(n.length))},isAlien:function(n){return n&&!i.isFunction(n)&&/\{\s*\[native code\]\s*\}/.test(String(n))},extend:function(n){for(var t=1,r=arguments.length;t<r;t++)i._mixin(n.prototype,arguments[t]);return n},_hitchArgs:function(t,r){var u=i._toArray(arguments,2),f=i.isString(r);return function(){var o=i._toArray(arguments),e=f?(t||n.global)[r]:r;return e&&e.apply(t||this,u.concat(o))}},hitch:function(t,r){if(2<arguments.length)return i._hitchArgs.apply(n,arguments);if(r||(r=t,t=null),i.isString(r)){if(t=t||n.global,!t[r])throw['lang.hitch: scope["',r,'"] is null (scope="',t,'")'].join("");return function(){return t[r].apply(t,arguments||[])}}return t?function(){return r.apply(t,arguments||[])}:r},delegate:function(){function n(){}return function(t,r){n.prototype=t;var u=new n;return n.prototype=null,r&&i._mixin(u,r),u}}(),_toArray:t("ie")?function(){function n(n,t,i){for(i=i||[],t=t||0;t<n.length;t++)i.push(n[t]);return i}return function(t){return(t.item?n:e).apply(this,arguments)}}():e,partial:function(){return i.hitch.apply(n,[null].concat(i._toArray(arguments)))},clone:function(n){if(!n||"object"!=typeof n||i.isFunction(n))return n;if(n.nodeType&&"cloneNode"in n)return n.cloneNode(!0);if(n instanceof Date)return new Date(n.getTime());if(n instanceof RegExp)return new RegExp(n);var r,t,u;if(i.isArray(n))for(r=[],t=0,u=n.length;t<u;++t)t in n&&(r[t]=i.clone(n[t]));else r=n.constructor?new n.constructor:{};return i._mixin(r,n,i.clone)},trim:String.prototype.trim?function(n){return n.trim()}:function(n){return n.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(n,t,r){return n.replace(r||s,i.isFunction(t)?t:function(n,r){return i.getObject(r,!1,t)})}};return i.mixin(n,i),i})},"dojo/sniff":function(){define(["./has"],function(n){var i=navigator,t=i.userAgent,i=i.appVersion,r=parseFloat(i);if(n.add("air",0<=t.indexOf("AdobeAIR")),n.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),n.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),n.add("khtml",0<=i.indexOf("Konqueror")?r:void 0),n.add("edge",parseFloat(t.split("Edge/")[1])||void 0),n.add("opr",parseFloat(t.split("OPR/")[1])||void 0),n.add("webkit",!n("wp")&&!n("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),n.add("chrome",!n("edge")&&!n("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),n.add("android",!n("wp")&&parseFloat(t.split("Android ")[1])||void 0),n.add("safari",!(0<=i.indexOf("Safari"))||n("wp")||n("chrome")||n("android")||n("edge")||n("opr")?void 0:parseFloat(i.split("Version/")[1])),n.add("mac",0<=i.indexOf("Macintosh")),n.add("quirks","BackCompat"==document.compatMode),!n("wp")&&t.match(/(iPhone|iPod|iPad)/)){var f=RegExp.$1.replace(/P/,"p"),u=t.match(/OS ([\d_]+)/)?RegExp.$1:"1",u=parseFloat(u.replace(/_/,".").replace(/_/g,""));n.add(f,u);n.add("ios",u)}return n.add("bb",(0<=t.indexOf("BlackBerry")||0<=t.indexOf("BB10"))&&parseFloat(t.split("Version/")[1])||void 0),n.add("trident",parseFloat(i.split("Trident/")[1])||void 0),n.add("svg","undefined"!=typeof SVGAngle),n("webkit")||(0<=t.indexOf("Opera")&&n.add("opera",9.8<=r?parseFloat(t.split("Version/")[1])||r:r),!(0<=t.indexOf("Gecko"))||n("wp")||n("khtml")||n("trident")||n("edge")||n.add("mozilla",r),n("mozilla")&&n.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0),document.all&&!n("opera")&&(t=parseFloat(i.split("MSIE ")[1])||void 0,(i=document.documentMode)&&5!=i&&Math.floor(t)!=i&&(t=i),n.add("ie",t)),n.add("wii","undefined"!=typeof opera&&opera.wiiremote)),n})},"dojo/_base/array":function(){define(["./kernel","../has","./lang"],function(n,t,i){function u(n){return r[n]=new Function("item","index","array",n)}function e(n){var t=!n;return function(i,f,e){var o=0,h=i&&i.length||0,s;if(h&&"string"==typeof i&&(i=i.split("")),"string"==typeof f&&(f=r[f]||u(f)),e){for(;o<h;++o)if(s=!f.call(e,i[o],o,i),n^s)return!s}else for(;o<h;++o)if(s=!f(i[o],o,i),n^s)return!s;return t}}function o(n){var r=1,t=0,i=0;return n||(r=t=i=-1),function(u,e,o,h){if(h&&0<r)return f.lastIndexOf(u,e,o);h=u&&u.length||0;var c=n?h+i:t;for(o===s?o=n?t:h+i:0>o?(o=h+o,0>o&&(o=t)):o=o>=h?h+i:o,h&&"string"==typeof u&&(u=u.split(""));o!=c;o+=r)if(u[o]==e)return o;return-1}}var r={},s,f={every:e(!1),some:e(!0),indexOf:o(!0),lastIndexOf:o(!1),forEach:function(n,t,i){var f=0,e=n&&n.length||0;if(e&&"string"==typeof n&&(n=n.split("")),"string"==typeof t&&(t=r[t]||u(t)),i)for(;f<e;++f)t.call(i,n[f],f,n);else for(;f<e;++f)t(n[f],f,n)},map:function(n,t,i,f){var e=0,o=n&&n.length||0;if(f=new(f||Array)(o),o&&"string"==typeof n&&(n=n.split("")),"string"==typeof t&&(t=r[t]||u(t)),i)for(;e<o;++e)f[e]=t.call(i,n[e],e,n);else for(;e<o;++e)f[e]=t(n[e],e,n);return f},filter:function(n,t,i){var f=0,o=n&&n.length||0,s=[],e;if(o&&"string"==typeof n&&(n=n.split("")),"string"==typeof t&&(t=r[t]||u(t)),i)for(;f<o;++f)e=n[f],t.call(i,e,f,n)&&s.push(e);else for(;f<o;++f)e=n[f],t(e,f,n)&&s.push(e);return s},clearCache:function(){r={}}};return i.mixin(n,f),f})},"dojo/require":function(){define(["./_base/loader"],function(n){return{dynamic:0,normalize:function(n){return n},load:n.require}})},"dojo/text":function(){define(["./_base/kernel","require","./has","./request"],function(n,t,i,r){var o=function(n,t,i){r(n,{sync:!!t,headers:{"X-Requested-With":null}}).then(i)};var u={},e=function(n){if(n){n=n.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var t=n.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);t&&(n=t[1])}else n="";return n},s={},f={};return n.cache=function(n,i,r){var f;return("string"==typeof n?/\//.test(n)?(f=n,r=i):f=t.toUrl(n.replace(/\./g,"/")+(i?"/"+i:"")):(f=n+"",r=i),n=void 0!=r&&"string"!=typeof r?r.value:r,r=r&&r.sanitize,"string"==typeof n)?(u[f]=n,r?e(n):n):null===n?(delete u[f],null):(f in u||o(f,!0,function(n){u[f]=n}),r?e(u[f]):u[f])},{dynamic:!0,normalize:function(n,t){var i=n.split("!"),r=i[0];return(/^\./.test(r)?t(r):r)+(i[1]?"!"+i[1]:"")},load:function(n,t,i){var h,c,a;n=n.split("!");var v=1<n.length,l=n[0],r=t.toUrl(n[0]);n="url:"+r;h=s;c=function(n){i(v?e(n):n)};l in u?h=u[l]:t.cache&&n in t.cache?h=t.cache[n]:r in u&&(h=u[r]);h===s?f[r]?f[r].push(c):(a=f[r]=[c],o(r,!t.async,function(n){u[l]=u[r]=n;for(var t=0;t<a.length;)a[t++](n);delete f[r]})):c(h)}}})},"dojo/request":function(){define(["./request/default!"],function(n){return n})},"dojo/request/default":function(){define(["exports","require","../has"],function(n,t,i){var r=i("config-requestProvider");r||(r="./xhr");n.getPlatformDefaultId=function(){return"./xhr"};n.load=function(n,i,u){t(["platform"==n?"./xhr":r],function(n){u(n)})}})},"dojo/i18n":function(){define("./_base/kernel require ./has ./_base/array ./_base/config ./_base/lang ./_base/xhr ./json module".split(" "),function(n,t,i,r,u,f,e,o,s){i.add("dojo-preload-i18n-Api",1);var l=n.i18n={},d=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,g=function(n,t,i,r){var e=[i+r],u,f;for(t=t.split("-"),u="",f=0;f<t.length;f++)(u+=(u?"-":"")+t[f],!n||n[u])&&(e.push(i+u+"/"+r),e.specificity=u);return e},h={},b=function(t,i,r){return r=r?r.toLowerCase():n.locale,t=t.replace(/\./g,"/"),i=i.replace(/\./g,"/"),/root/i.test(r)?t+"/nls/"+i:t+"/nls/"+r+"/"+i},nt=n.getL10nName=function(n,t,i){return s.id+"!"+b(n,t,i)},tt=function(n,t,i,r,u,e){n([t],function(o){var s=f.clone(o.root||o.ROOT),c=g(!o._v1x&&o,u,i,r);n(c,function(){for(var n=1;n<c.length;n++)s=f.mixin(f.clone(s),arguments[n]);h[t+"/"+u]=s;s.$locale=c.specificity;e()})})},it=function(n){var t=u.extraLocale||[],t=f.isArray(t)?t:[t];return t.push(n),t},a=function(t,u,e){var s=d.exec(t),w=s[1]+"/",b=s[5]||s[4],a=w+b,l=(s=s[5]&&s[4])||n.locale||"",k=a+"/"+l,s=s?[l]:it(l),nt=s.length,g=function(){--nt||e(f.delegate(h[k]))},l=t.split("*"),p="preload"==l[1];if(i("dojo-preload-i18n-Api")){if(p&&(h[t]||(h[t]=1,ut(l[2],o.parse(l[3]),1,u)),e(1)),(l=p)||(c&&v.push([t,u,e]),l=c&&!h[k]),l)return}else if(p){e(1);return}r.forEach(s,function(n){var t=a+"/"+n;i("dojo-preload-i18n-Api")&&y(t);h[t]?g():tt(u,a,w,b,n,g)})};i("dojo-preload-i18n-Api");var rt=l.normalizeLocale=function(t){return t=t?t.toLowerCase():n.locale,"root"==t?"ROOT":t},c=0,v=[],ut=l._preloadLocalizations=function(i,u,e,o){function p(n,i){o.isXdUrl(t.toUrl(n+".js"))||e?o([n],i):k([n],i,o)}function s(n,t){for(var i=n.split("-");i.length;){if(t(i.join("-")))return;i.pop()}t("ROOT")}function l(){for(--c;!c&&v.length;)a.apply(null,v.shift())}function y(n){n=rt(n);s(n,function(e){if(0<=r.indexOf(u,e)){var a=i.replace(/\./g,"/")+"_"+e;return c++,p(a,function(i){var a,r,u,v,y,p;for(a in i)r=i[a],u=a.match(/(.+)\/([^\/]+)$/),u&&(v=u[2],u=u[1]+"/",r._localized)&&("ROOT"===e?(p=y=r._localized,delete r._localized,p.root=r,h[t.toAbsMid(a)]=p):(y=r._localized,h[t.toAbsMid(u+v+"/"+e)]=r),e!==n&&function(i,r,u,e){var a=[],v=[];s(n,function(n){e[n]&&(a.push(t.toAbsMid(i+n+"/"+r)),v.push(t.toAbsMid(i+r+"/"+n)))});a.length?(c++,o(a,function(){for(var e=a.length-1;0<=e;e--)u=f.mixin(f.clone(u),arguments[e]),h[v[e]]=u;h[t.toAbsMid(i+r+"/"+n)]=f.clone(u);l()})):h[t.toAbsMid(i+r+"/"+n)]=u}(u,v,r,y));l()}),!0}return!1})}o=o||t;y();r.forEach(n.config.extraLocale,y)},y=function(){},p={},w,k=function(n,t,i){var u=[];r.forEach(n,function(n){function f(i){w||(w=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"));i=w(i,y,n,p);i===p?u.push(h[t]=p.result):(i instanceof Error&&(console.error("failed to evaluate i18n bundle; url="+t,i),i={}),u.push(h[t]=/nls\/[^\/]+\/[^\/]+$/.test(t)?i:{root:i,_v1x:1}))}var t=i.toUrl(n+".js"),r;if(h[t])u.push(h[t]);else if(r=i.syncLoadNls(n),r||(r=y(n.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1"))),r)u.push(r);else if(e)e.get({url:t,sync:!0,load:f,error:function(){u.push(h[t]={})}});else try{i.getText(t,!0,f)}catch(o){u.push(h[t]={})}});t&&t.apply(null,u)},y=function(t){for(var r,u=t.split("/"),i=n.global[u[0]],f=1;i&&f<u.length-1;i=i[u[f++]]);return i&&((r=i[u[f]])||(r=i[u[f].replace(/-/g,"_")]),r&&(h[t]=r)),r};return l.getLocalization=function(n,i,r){var u;return n=b(n,i,r),a(n,t.isXdUrl(t.toUrl(n+".js"))?t:function(n,i){k(n,i,t)},function(n){u=n}),u},f.mixin(l,{dynamic:!0,normalize:function(n,t){return/^\./.test(n)?t(n):n},load:a,cache:h,getL10nName:nt})})},"dojo/_base/xhr":function(){define("./kernel ./sniff require ../io-query ../dom ../dom-form ./Deferred ./config ./json ./lang ./array ../on ../aspect ../request/watch ../request/xhr ../request/util".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var k,w;n._xhrObj=y._create;k=n.config;n.objectToQuery=r.objectToQuery;n.queryToObject=r.queryToObject;n.fieldToObject=f.fieldToObject;n.formToObject=f.toObject;n.formToQuery=f.toQuery;n.formToJson=f.toJson;n._blockAsync=!1;t.add("native-xhr2-blob",function(){var n,i;if(t("native-xhr2"))return n=new XMLHttpRequest,n.open("GET","/",!0),n.responseType="blob",i=n.responseType,n.abort(),"blob"===i});w=n._contentHandlers=n.contentHandlers={text:function(n){return n.responseText},json:function(n){return s.fromJson(n.responseText||null)},"json-comment-filtered":function(n){o.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}&&\nUse djConfig.useCommentedJson=true to turn off this message.");n=n.responseText;var t=n.indexOf("/*"),i=n.lastIndexOf("*/");if(-1==t||-1==i)throw Error("JSON was not comment filtered");return s.fromJson(n.substring(t+2,i))},javascript:function(t){return n.eval(t.responseText)},xml:function(n){var i=n.responseXML,r;return i&&t("dom-qsa2.1")&&!i.querySelectorAll&&t("dom-parser")&&(i=(new DOMParser).parseFromString(n.responseText,"application/xml")),!t("ie")||i&&i.documentElement||(r=function(n){return"MSXML"+n+".DOMDocument"},r=["Microsoft.XMLDOM",r(6),r(4),r(3),r(2)],c.some(r,function(t){try{var r=new ActiveXObject(t);r.async=!1;r.loadXML(n.responseText);i=r}catch(u){return!1}return!0})),i},"json-comment-optional":function(n){return n.responseText&&/^[^{\[]*\/\*/.test(n.responseText)?w["json-comment-filtered"](n):w.json(n)}};t("native-xhr2")&&(w.arraybuffer=w.blob=w.document=function(n,i){return"blob"!==i.args.handleAs||t("native-xhr2-blob")?n.response:new Blob([n.response],{type:n.getResponseHeader("Content-Type")})});n._ioSetArgs=function(t,i,o,s){var l={args:t,url:t.url},v=null,a,c,y,p,w;return t.form&&(v=u.byId(t.form),a=v.getAttributeNode("action"),l.url=l.url||(a?a.value:n.doc?n.doc.URL:null),v=f.toObject(v)),a=[{}],v&&a.push(v),t.content&&a.push(t.content),t.preventCache&&a.push({"dojo.preventCache":(new Date).valueOf()}),l.query=r.objectToQuery(h.mixin.apply(null,a)),l.handleAs=t.handleAs||"text",c=new e(function(n){n.canceled=!0;i&&i(n);var t=n.ioArgs.error;return t||(t=Error("request cancelled"),t.dojoType="cancel",n.ioArgs.error=t),t}),c.addCallback(o),y=t.load,y&&h.isFunction(y)&&c.addCallback(function(n){return y.call(t,n,l)}),p=t.error,p&&h.isFunction(p)&&c.addErrback(function(n){return p.call(t,n,l)}),w=t.handle,w&&h.isFunction(w)&&c.addBoth(function(n){return w.call(t,n,l)}),c.addErrback(function(n){return s(n,c)}),k.ioPublish&&n.publish&&!1!==l.args.ioPublish&&(c.addCallbacks(function(t){return n.publish("/dojo/io/load",[c,t]),t},function(t){return n.publish("/dojo/io/error",[c,t]),t}),c.addBoth(function(t){return n.publish("/dojo/io/done",[c,t]),t})),c.ioArgs=l,c};var g=function(n){return n=w[n.ioArgs.handleAs](n.ioArgs.xhr,n.ioArgs),void 0===n?null:n},nt=function(n,t){return t.ioArgs.args.failOk||console.error(n),n},d=function(t){0>=b&&(b=0,k.ioPublish&&n.publish&&(!t||t&&!1!==t.ioArgs.args.ioPublish)&&n.publish("/dojo/io/stop"))},b=0;return a.after(v,"_onAction",function(){--b}),a.after(v,"_onInFlight",d),n._ioCancelAll=v.cancelAll,n._ioNotifyStart=function(t){k.ioPublish&&n.publish&&!1!==t.ioArgs.args.ioPublish&&(b||n.publish("/dojo/io/start"),b+=1,n.publish("/dojo/io/send",[t]))},n._ioWatch=function(n,t,i,r){n.ioArgs.options=n.ioArgs.args;h.mixin(n,{response:n.ioArgs,isValid:function(){return t(n)},isReady:function(){return i(n)},handleResponse:function(){return r(n)}});v(n);d(n)},n._ioAddQueryToUrl=function(n){n.query.length&&(n.url+=(-1==n.url.indexOf("?")?"?":"&")+n.query,n.query=null)},n.xhr=function(i,r,u){var s,e=n._ioSetArgs(r,function(){s&&s.cancel()},g,nt),o=e.ioArgs,f;"postData"in r?o.query=r.postData:"putData"in r?o.query=r.putData:"rawBody"in r?o.query=r.rawBody:(2<arguments.length&&!u||-1==="POST|PUT".indexOf(i.toUpperCase()))&&n._ioAddQueryToUrl(o);t("native-xhr2")&&(f={arraybuffer:1,blob:1,document:1});f=t("native-xhr2")&&f[r.handleAs]?r.handleAs:"text";"blob"!==f||t("native-xhr2-blob")||(f="arraybuffer");f={method:i,handleAs:f,responseType:r.responseType,timeout:r.timeout,withCredentials:r.withCredentials,ioArgs:o};"undefined"!=typeof r.headers&&(f.headers=r.headers);"undefined"!=typeof r.contentType&&(f.headers||(f.headers={}),f.headers["Content-Type"]=r.contentType);"undefined"!=typeof o.query&&(f.data=o.query);"undefined"!=typeof r.sync&&(f.sync=r.sync);n._ioNotifyStart(e);try{s=y(o.url,f,!0)}catch(h){return e.cancel(),e}return e.ioArgs.xhr=s.response.xhr,s.then(function(){e.resolve(e)}).otherwise(function(n){o.error=n;n.response&&(n.status=n.response.status,n.responseText=n.response.text,n.xhr=n.response.xhr);e.reject(n)}),e},n.xhrGet=function(t){return n.xhr("GET",t)},n.rawXhrPost=n.xhrPost=function(t){return n.xhr("POST",t,!0)},n.rawXhrPut=n.xhrPut=function(t){return n.xhr("PUT",t,!0)},n.xhrDelete=function(t){return n.xhr("DELETE",t)},n._isDocumentOk=function(n){return p.checkStatus(n.status)},n._getText=function(t){var i;return n.xhrGet({url:t,sync:!0,load:function(n){i=n}}),i},h.mixin(n.xhr,{_xhrObj:n._xhrObj,fieldToObject:f.fieldToObject,formToObject:f.toObject,objectToQuery:r.objectToQuery,formToQuery:f.toQuery,formToJson:f.toJson,queryToObject:r.queryToObject,contentHandlers:w,_ioSetArgs:n._ioSetArgs,_ioCancelAll:n._ioCancelAll,_ioNotifyStart:n._ioNotifyStart,_ioWatch:n._ioWatch,_ioAddQueryToUrl:n._ioAddQueryToUrl,_isDocumentOk:n._isDocumentOk,_getText:n._getText,get:n.xhrGet,post:n.xhrPost,put:n.xhrPut,del:n.xhrDelete}),n.xhr})},"dojo/_base/sniff":function(){define(["./kernel","./lang","../sniff"],function(n,t,i){return n._name="browser",t.mixin(n,{isBrowser:!0,isFF:i("ff"),isIE:i("ie"),isKhtml:i("khtml"),isWebKit:i("webkit"),isMozilla:i("mozilla"),isMoz:i("mozilla"),isOpera:i("opera"),isSafari:i("safari"),isChrome:i("chrome"),isMac:i("mac"),isIos:i("ios"),isAndroid:i("android"),isWii:i("wii"),isQuirks:i("quirks"),isAir:i("air")}),i})},"dojo/io-query":function(){define(["./_base/lang"],function(n){var t={};return{objectToQuery:function(i){var e=encodeURIComponent,o=[],u,r,s,f,h;for(u in i)if(r=i[u],r!=t[u])if(s=e(u)+"=",n.isArray(r))for(f=0,h=r.length;f<h;++f)o.push(s+e(r[f]));else o.push(s+e(r));return o.join("&")},queryToObject:function(t){var e=decodeURIComponent,f;t=t.split("&");for(var u={},r,i,o=0,s=t.length;o<s;++o)(i=t[o],i.length)&&(f=i.indexOf("="),0>f?(r=e(i),i=""):(r=e(i.slice(0,f)),i=e(i.slice(f+1))),"string"==typeof u[r]&&(u[r]=[u[r]]),n.isArray(u[r])?u[r].push(i):u[r]=i);return u}}})},"dojo/dom":function(){define(["./sniff","./_base/window","./_base/kernel"],function(n,t,i){var r,u;if(7>=n("ie"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(f){}return r={},r.byId=n("ie")?function(n,i){var u,r,f;if("string"!=typeof n)return n;if(u=i||t.doc,r=n&&u.getElementById(n),r&&(r.attributes.id.value==n||r.id==n))return r;for(u=u.all[n],(!u||u.nodeName)&&(u=[u]),f=0;r=u[f++];)if(r.attributes&&r.attributes.id&&r.attributes.id.value==n||r.id==n)return r}:function(n,i){return("string"==typeof n?(i||t.doc).getElementById(n):n)||null},i=i.global.document||null,n.add("dom-contains",!(!i||!i.contains)),r.isDescendant=n("dom-contains")?function(n,t){return!(!(t=r.byId(t))||!t.contains(r.byId(n)))}:function(n,t){try{for(n=r.byId(n),t=r.byId(t);n;){if(n==t)return!0;n=n.parentNode}}catch(i){}return!1},n.add("css-user-select",function(n,t,i){if(!i)return!1;n=i.style;t=["Khtml","O","Moz","Webkit"];i=t.length;var r="userSelect";do if("undefined"!=typeof n[r])return r;while(i--&&(r=t[i]+"UserSelect"));return!1}),u=n("css-user-select"),r.setSelectable=u?function(n,t){r.byId(n).style[u]=t?"":"none"}:function(n,t){n=r.byId(n);var u=n.getElementsByTagName("*"),i=u.length;if(t)for(n.removeAttribute("unselectable");i--;)u[i].removeAttribute("unselectable");else for(n.setAttribute("unselectable","on");i--;)u[i].setAttribute("unselectable","on")},r})},"dojo/_base/window":function(){define(["./kernel","./lang","../sniff"],function(n,t,i){var r={global:n.global,doc:n.global.document||null,body:function(t){return t=t||n.doc,t.body||t.getElementsByTagName("body")[0]},setContext:function(t,i){n.global=r.global=t;n.doc=r.doc=i},withGlobal:function(t,i,u,f){var e=n.global;try{return n.global=r.global=t,r.withDoc.call(null,t.document,i,u,f)}finally{n.global=r.global=e}},withDoc:function(t,u,f,e){var c=r.doc,l=i("quirks"),a=i("ie"),o,s,h;try{return n.doc=r.doc=t,n.isQuirks=i.add("quirks","BackCompat"==n.doc.compatMode,!0,!0),i("ie")&&(h=t.parentWindow)&&h.navigator&&(o=parseFloat(h.navigator.appVersion.split("MSIE ")[1])||void 0,(s=t.documentMode)&&5!=s&&Math.floor(o)!=s&&(o=s),n.isIE=i.add("ie",o,!0,!0)),f&&"string"==typeof u&&(u=f[u]),u.apply(f,e||[])}finally{n.doc=r.doc=c;n.isQuirks=i.add("quirks",l,!0,!0);n.isIE=i.add("ie",a,!0,!0)}}};return t.mixin(n,r),r})},"dojo/dom-form":function(){define(["./_base/lang","./dom","./io-query","./json"],function(n,t,i,r){var u={fieldToObject:function(n){var r=null,i,u;if((n=t.byId(n))&&(i=n.name,u=(n.type||"").toLowerCase(),i&&u&&!n.disabled))if("radio"==u||"checkbox"==u)n.checked&&(r=n.value);else if(n.multiple)for(r=[],n=[n.firstChild];n.length;)for(i=n.pop();i;i=i.nextSibling)if(1==i.nodeType&&"option"==i.tagName.toLowerCase())i.selected&&r.push(i.value);else{i.nextSibling&&n.push(i.nextSibling);i.firstChild&&n.push(i.firstChild);break}else r=n.value;return r},toObject:function(i){var f={},s,a,o;for(i=t.byId(i).elements,s=0,a=i.length;s<a;++s){var r=i[s],e=r.name,h=(r.type||"").toLowerCase();if(e&&h&&0>"file|submit|image|reset|button".indexOf(h)&&!r.disabled){var c=f,l=e,r=u.fieldToObject(r);null!==r&&(o=c[l],"string"==typeof o?c[l]=[o,r]:n.isArray(o)?o.push(r):c[l]=r);"image"==h&&(f[e+".x"]=f[e+".y"]=f[e].x=f[e].y=0)}}return f},toQuery:function(n){return i.objectToQuery(u.toObject(n))},toJson:function(n,t){return r.stringify(u.toObject(n),null,t?4:0)}};return u})},"dojo/_base/Deferred":function(){define("./kernel ../Deferred ../promise/Promise ../errors/CancelError ../has ./lang ../when".split(" "),function(n,t,i,r,u,f,e){var s=function(){},h=Object.freeze||function(){},o=n.Deferred=function(n){function b(n){if(a)throw Error("This deferred has already been resolved");l=n;a=!0;k()}function k(){for(var o,n,i,r;!o&&e;)if(n=e,e=e.next,(o=n.progress==s)&&(a=!1),i=v?n.error:n.resolved,u("config-useDeferredInstrumentation")&&v&&t.instrumentRejected&&t.instrumentRejected(l,!!i),i)try{r=i(l);r&&"function"==typeof r.then?r.then(f.hitch(n.deferred,"resolve"),f.hitch(n.deferred,"reject"),f.hitch(n.deferred,"progress")):(i=o&&void 0===r,o&&!i&&(v=r instanceof Error),n.deferred[i&&v?"reject":"resolve"](i?l:r))}catch(h){n.deferred.reject(h)}else v?n.deferred.reject(l):n.deferred.resolve(l)}var l,a,d,y,v,p,e,c=this.promise=new i,w;this.isResolved=c.isResolved=function(){return 0==y};this.isRejected=c.isRejected=function(){return 1==y};this.isFulfilled=c.isFulfilled=function(){return 0<=y};this.isCanceled=c.isCanceled=function(){return d};this.resolve=this.callback=function(n){this.fired=y=0;this.results=[n,null];b(n)};this.reject=this.errback=function(n){v=!0;this.fired=y=1;u("config-useDeferredInstrumentation")&&t.instrumentRejected&&t.instrumentRejected(n,!!e);b(n);this.results=[null,n]};this.progress=function(n){for(var i,t=e;t;)i=t.progress,i&&i(n),t=t.next};this.addCallbacks=function(n,t){return this.then(n,t,s),this};c.then=this.then=function(n,t,i){var r=i==s?this:new o(c.cancel);return n={resolved:n,error:t,progress:i,deferred:r},e?p=p.next=n:e=p=n,a&&k(),r.promise};w=this;c.cancel=this.cancel=function(){if(!a){var t=n&&n(w);a||(t instanceof Error||(t=new r(t)),t.log=!1,w.reject(t))}d=!0};h(c)};return f.extend(o,{addCallback:function(){return this.addCallbacks(f.hitch.apply(n,arguments))},addErrback:function(){return this.addCallbacks(null,f.hitch.apply(n,arguments))},addBoth:function(){var t=f.hitch.apply(n,arguments);return this.addCallbacks(t,t)},fired:-1}),o.when=n.when=e,o})},"dojo/Deferred":function(){define(["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(n,t,i,r,u){var c=Object.freeze||function(){},o=function(n,t,i,r,u){for(2===t&&f.instrumentRejected&&0===n.length&&f.instrumentRejected(i,!1,r,u),u=0;u<n.length;u++)h(n[u],t,i,r)},h=function(n,t,i,r){var h=n[t],u=n.deferred,o;if(h)try{if(o=h(i),0===t)"undefined"!=typeof o&&e(u,t,o);else{if(o&&"function"==typeof o.then){n.cancel=o.cancel;o.then(s(u,1),s(u,2),s(u,0));return}e(u,1,o)}}catch(c){e(u,2,c)}else e(u,t,i);2===t&&f.instrumentRejected&&f.instrumentRejected(i,!!h,r,u.promise)},s=function(n,t){return function(i){e(n,t,i)}},e=function(n,t,i){if(!n.isCanceled())switch(t){case 0:n.progress(i);break;case 1:n.resolve(i);break;case 2:n.reject(i)}},f=function(n){var t=this.promise=new r,s=this,u,l,a,y=!1,e=[],v;Error.captureStackTrace&&(Error.captureStackTrace(s,f),Error.captureStackTrace(t,f));this.isResolved=t.isResolved=function(){return 1===u};this.isRejected=t.isRejected=function(){return 2===u};this.isFulfilled=t.isFulfilled=function(){return!!u};this.isCanceled=t.isCanceled=function(){return y};this.progress=function(n,i){if(u){if(!0===i)throw Error("This deferred has already been fulfilled.");return t}return o(e,0,n,null,s),t};this.resolve=function(n,i){if(u){if(!0===i)throw Error("This deferred has already been fulfilled.");return t}return o(e,u=1,l=n,null,s),e=null,t};v=this.reject=function(n,i){if(u){if(!0===i)throw Error("This deferred has already been fulfilled.");return t}return Error.captureStackTrace&&Error.captureStackTrace(a={},v),o(e,u=2,l=n,a,s),e=null,t};this.then=t.then=function(n,i,r){var o=[r,n,i];return o.cancel=t.cancel,o.deferred=new f(function(n){return o.cancel&&o.cancel(n)}),u&&!e?h(o,u,l,a):e.push(o),o.deferred.promise};this.cancel=t.cancel=function(t,r){if(u){if(!0===r)throw Error("This deferred has already been fulfilled.");}else{if(n){var f=n(t);t="undefined"==typeof f?t:f}if(y=!0,!u)return"undefined"==typeof t&&(t=new i),v(t),t;if(2===u&&l===t)return t}};c(t)};return f.prototype.toString=function(){return"[object Deferred]"},u&&u(f),f})},"dojo/errors/CancelError":function(){define(["./create"],function(n){return n("CancelError",null,null,{dojoType:"cancel",log:!1})})},"dojo/errors/create":function(){define(["../_base/lang"],function(n){return function(t,i,r,u){r=r||Error;var f=function(n){if(r===Error){Error.captureStackTrace&&Error.captureStackTrace(this,f);var t=Error.call(this,n);for(var u in t)t.hasOwnProperty(u)&&(this[u]=t[u]);this.message=n;this.stack=t.stack}else r.apply(this,arguments);i&&i.apply(this,arguments)};return f.prototype=n.delegate(r.prototype,u),f.prototype.name=t,f.prototype.constructor=f}})},"dojo/promise/Promise":function(){define(["../_base/lang"],function(n){function t(){throw new TypeError("abstract");}return n.extend(function(){},{then:function(){t()},cancel:function(){t()},isResolved:function(){t()},isRejected:function(){t()},isFulfilled:function(){t()},isCanceled:function(){t()},always:function(n){return this.then(n,n)},otherwise:function(n){return this.then(null,n)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})})},"dojo/promise/instrumentation":function(){define(["./tracer","../has","../_base/lang","../_base/array"],function(n,t,i,r){function o(n,t,i){if(!n||!1!==n.log){var r="";n&&n.stack&&(r+=n.stack);t&&t.stack&&(r+="\n    ----------------------------------------\n    rejected"+t.stack.split("\n").slice(1).join("\n").replace(/^\s+/," "));i&&i.stack&&(r+="\n    ----------------------------------------\n"+i.stack);console.error(n,r)}}function h(n,t,i,r){t||o(n,i,r)}function c(n,t,i,o){r.some(u,function(i){if(i.error===n)return t&&(i.handled=!0),!0})||u.push({error:n,rejection:i,handled:t,deferred:o,timestamp:(new Date).getTime()});e||(e=setTimeout(s,f))}function s(){var n=(new Date).getTime(),t=n-f;u=r.filter(u,function(n){return n.timestamp<t?(n.handled||o(n.error,n.rejection,n.deferred),!1):!0});e=u.length?setTimeout(s,u[0].timestamp+f-n):!1}t.add("config-useDeferredInstrumentation","report-unhandled-rejections");var u=[],e=!1,f=1e3;return function(r){var u=t("config-useDeferredInstrumentation"),e;if(u){n.on("resolved",i.hitch(console,"log","resolved"));n.on("rejected",i.hitch(console,"log","rejected"));n.on("progress",i.hitch(console,"log","progress"));if(e=[],"string"==typeof u&&(e=u.split(","),u=e.shift()),"report-rejections"===u)r.instrumentRejected=h;else if("report-unhandled-rejections"===u||!0===u||1===u)r.instrumentRejected=c,f=parseInt(e[0],10)||f;else throw Error("Unsupported instrumentation usage <"+u+">");}}})},"dojo/promise/tracer":function(){define(["../_base/lang","./Promise","../Evented"],function(n,t,i){function r(n){setTimeout(function(){f.apply(u,n)},0)}var u=new i,f=u.emit;return u.emit=null,t.prototype.trace=function(){var t=n._toArray(arguments);return this.then(function(n){r(["resolved",n].concat(t))},function(n){r(["rejected",n].concat(t))},function(n){r(["progress",n].concat(t))}),this},t.prototype.traceRejected=function(){var t=n._toArray(arguments);return this.otherwise(function(n){r(["rejected",n].concat(t))}),this},u})},"dojo/Evented":function(){define(["./aspect","./on"],function(n,t){function i(){}var r=n.after;return i.prototype={on:function(n,i){return t.parse(this,n,i,function(n,t){return r(n,"on"+t,i,!0)})},emit:function(){var n=[this];return n.push.apply(n,arguments),t.emit.apply(t,n)}},i})},"dojo/aspect":function(){define([],function(){function t(n,t,i,r){var f=n[t],o="around"==t,u,e;if(o?(e=i(function(){return f.advice(this,arguments)}),u={remove:function(){e&&(e=n=i=null)},advice:function(n,t){return e?e.apply(n,t):f.advice(n,t)}}):u={remove:function(){if(u.advice){var f=u.previous,r=u.next;r||f?(f?f.next=r:n[t]=r,r&&(r.previous=f)):delete n[t];n=i=u.advice=null}},id:n.nextId++,advice:i,receiveArguments:r},f&&!o)if("after"==t){for(;f.next&&(f=f.next););f.next=u;u.previous=f}else"before"==t&&(n[t]=u,u.next=f,f.previous=u);else n[t]=u;return u}function n(n){return function(r,u,f,e){var s=r[u],o;return s&&s.target==r||(r[u]=o=function(){for(var u,r,f=o.nextId,t=arguments,n=o.before;n;)n.advice&&(t=n.advice.apply(this,t)||t),n=n.next;for(o.around&&(r=o.around.advice(this,t)),n=o.after;n&&n.id<f;)n.advice&&(n.receiveArguments?(u=n.advice.apply(this,t),r=u===i?r:u):r=n.advice.call(this,r,t)),n=n.next;return r},s&&(o.around={advice:function(n,t){return s.apply(n,t)}}),o.target=r,o.nextId=o.nextId||0),r=t(o||s,n,f,e),f=null,r}}var i,r=n("after"),u=n("before"),f=n("around");return{before:u,around:f,after:r}})},"dojo/on":function(){define(["./has!dom-addeventlistener?:./aspect","./_base/kernel","./sniff"],function(n,t,i){function p(n,t,u,e,o){if(e=t.match(/(.*):(.*)/))return t=e[2],e=e[1],r.selector(e,t).call(o,n,u);if(i("touch")&&(s.test(t)&&(u=y(u)),i("event-orientationchange")||"orientationchange"!=t||(t="resize",n=window,u=y(u))),f&&(u=f(u)),n.addEventListener){var c=t in h,a=c?h[t]:t;return n.addEventListener(a,u,c),{remove:function(){n.removeEventListener(a,u,c)}}}if(l&&n.attachEvent)return l(n,"on"+t,u);throw Error("Target must be an event emitter");}function w(){this.cancelable=!1;this.defaultPrevented=!0}function b(){this.bubbles=!1}var o=window.ScriptEngineMajorVersion,r,s,c,f,u,e;i.add("jscript",o&&o()+ScriptEngineMinorVersion()/10);i.add("event-orientationchange",i("touch")&&!i("android"));i.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&!!window.Event.prototype.stopImmediatePropagation);i.add("event-focusin",function(n,t,i){return"onfocusin"in i});i("touch")&&i.add("touch-can-modify-event-delegate",function(){var t=function(){},n;t.prototype=document.createEvent("MouseEvents");try{return n=new t,n.target=null,null===n.target}catch(i){return!1}});r=function(n,t,i,u){return"function"!=typeof n.on||"function"==typeof t||n.nodeType?r.parse(n,t,i,p,u,this):n.on(t,i)};r.pausable=function(n,t,i,u){var f;return n=r(n,t,function(){if(!f)return i.apply(this,arguments)},u),n.pause=function(){f=!0},n.resume=function(){f=!1},n};r.once=function(n,t,i){var u=r(n,t,function(){return u.remove(),i.apply(this,arguments)});return u};r.parse=function(n,t,i,u,f,e){var s,o,h;if(t.call)return t.call(e,n,i);if(t instanceof Array?s=t:-1<t.indexOf(",")&&(s=t.split(/\s*,\s*/)),s){for(o=[],t=0;h=s[t++];)o.push(r.parse(n,h,i,u,f,e));return o.remove=function(){for(var n=0;n<o.length;n++)o[n].remove()},o}return u(n,t,i,f,e)};s=/^touch/;r.matches=function(n,i,r,u,f){for(f=f&&"function"==typeof f.matches?f:t.query,u=!1!==u,1!=n.nodeType&&(n=n.parentNode);!f.matches(n,i,r);)if(n==r||!1===u||!(n=n.parentNode)||1!=n.nodeType)return!1;return n};r.selector=function(n,t,i){return function(u,f){function e(t){return r.matches(t,n,u,i,s)}var s="function"==typeof n?{matches:n}:this,o=t.bubble;return o?r(u,o(e),f):r(u,t,function(n){var t=e(n.target);if(t)return n.selectorTarget=t,f.call(t,n)})}};var k=[].slice,d=r.emit=function(n,t,i){var f=k.call(arguments,2),e="on"+t,r,u;if("parentNode"in n){r=f[0]={};for(u in i)r[u]=i[u];r.preventDefault=w;r.stopPropagation=b;r.target=n;r.type=t;i=r}do n[e]&&n[e].apply(n,f);while(i&&i.bubbles&&(n=n.parentNode));return i&&i.cancelable&&i},h=i("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(i("event-stopimmediatepropagation")||(c=function(){this.modified=this.immediatelyStopped=!0},f=function(n){return function(t){if(!t.immediatelyStopped)return t.stopImmediatePropagation=c,n.apply(this,arguments)}}),i("dom-addeventlistener"))r.emit=function(n,t,i){var u,f;if(n.dispatchEvent&&document.createEvent){u=(n.ownerDocument||document).createEvent("HTMLEvents");u.initEvent(t,!!i.bubbles,!!i.cancelable);for(f in i)f in u||(u[f]=i[f]);return n.dispatchEvent(u)&&u}return d.apply(r,arguments)};else{r._fixEvent=function(n,t){if(n||(n=(t&&(t.ownerDocument||t.document||t).parentWindow||window).event),!n)return n;try{u&&n.type==u.type&&n.srcElement==u.target&&(n=u)}catch(r){}if(!n.target)switch(n.target=n.srcElement,n.currentTarget=t||n.srcElement,"mouseover"==n.type&&(n.relatedTarget=n.fromElement),"mouseout"==n.type&&(n.relatedTarget=n.toElement),n.stopPropagation||(n.stopPropagation=nt,n.preventDefault=tt),n.type){case"keypress":var i="charCode"in n?n.charCode:n.keyCode;10==i?(i=0,n.keyCode=13):13==i||27==i?i=0:3==i&&(i=99);n.charCode=i;i=n;i.keyChar=i.charCode?String.fromCharCode(i.charCode):"";i.charOrCode=i.keyChar||i.keyCode}return n};e=function(n){this.handle=n};e.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};var g=function(n){return function(t){t=r._fixEvent(t,this);var i=n.call(this,t);return t.modified&&(u||setTimeout(function(){u=null}),u=t),i}},l=function(t,r,u){var o,f;return(u=g(u),((t.ownerDocument?t.ownerDocument.parentWindow:t.parentWindow||t.window||window)!=top||5.8>i("jscript"))&&!i("config-_allow_leaks"))?("undefined"==typeof _dojoIEListeners_&&(_dojoIEListeners_=[]),f=t[r],f&&f.listeners||(o=f,f=Function("event","var callee = arguments.callee; for(var i = 0; i<callee.listeners.length; i++){var listener = _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}"),f.listeners=[],t[r]=f,f.global=this,o&&f.listeners.push(_dojoIEListeners_.push(o)-1)),f.listeners.push(t=f.global._dojoIEListeners_.push(u)-1),new e(t)):n.after(t,r,u,!0)},nt=function(){this.cancelBubble=!0},tt=r._preventDefault=function(){if(this.bubbledKeyCode=this.keyCode,this.ctrlKey)try{this.keyCode=0}catch(n){}this.defaultPrevented=!0;this.returnValue=!1;this.modified=!0}}if(i("touch"))var a=function(){},v=window.orientation,y=function(n){return function(t){var r=t.corrected,e,u,f;if(!r){u=t.type;try{delete t.type}catch(o){}if(t.type){if(i("touch-can-modify-event-delegate"))a.prototype=t,r=new a;else{r={};for(e in t)r[e]=t[e]}r.preventDefault=function(){t.preventDefault()};r.stopPropagation=function(){t.stopPropagation()}}else r=t,r.type=u;if(t.corrected=r,"resize"==u)return v==window.orientation?null:(v=window.orientation,r.type="orientationchange",n.call(this,r));if("rotation"in r||(r.rotation=0,r.scale=1),window.TouchEvent&&t instanceof TouchEvent){u=r.changedTouches[0];for(f in u)delete r[f],r[f]=u[f]}}return n.call(this,r)}};return r})},"dojo/when":function(){define(["./Deferred","./promise/Promise"],function(n,t){return function(i,r,u,f){var e=i&&"function"==typeof i.then,o=e&&i instanceof t;return e?(o||(e=new n(i.cancel),i.then(e.resolve,e.reject,e.progress),i=e.promise),r||u||f?i.then(r,u,f):i):1<arguments.length?r?r(i):i:(new n).resolve(i)}})},"dojo/_base/json":function(){define(["./kernel","../json"],function(n,t){return n.fromJson=function(n){return eval("("+n+")")},n._escapeString=t.stringify,n.toJsonIndentStr="\t",n.toJson=function(i,r){return t.stringify(i,function(n,t){if(t){var i=t.__json__||t.json;if("function"==typeof i)return i.call(t)}return t},r&&n.toJsonIndentStr)},n})},"dojo/request/watch":function(){define("./util ../errors/RequestTimeoutError ../errors/CancelError ../_base/array ../_base/window ../has!host-browser?dom-addeventlistener?:../on:".split(" "),function(n,t,i,r,u,f){function h(){for(var n,r,f,u=+new Date,i=0;i<o.length&&(n=o[i]);i++)r=n.response,f=r.options,n.isCanceled&&n.isCanceled()||n.isValid&&!n.isValid(r)?(o.splice(i--,1),e._onAction&&e._onAction()):n.isReady&&n.isReady(r)?(o.splice(i--,1),n.handleResponse(r),e._onAction&&e._onAction()):n.startTime&&n.startTime+(f.timeout||0)<u&&(o.splice(i--,1),n.cancel(new t("Timeout exceeded",r)),e._onAction&&e._onAction());e._onInFlight&&e._onInFlight(n);o.length||(clearInterval(s),s=null)}function e(n){n.response.options.timeout&&(n.startTime=+new Date);n.isFulfilled()||(o.push(n),s||(s=setInterval(h,50)),n.response.options.sync&&h())}var s=null,o=[];return e.cancelAll=function(){try{r.forEach(o,function(n){try{n.cancel(new i("All requests canceled."))}catch(t){}})}catch(n){}},u&&f&&u.doc.attachEvent&&f(u.global,"unload",function(){e.cancelAll()}),e})},"dojo/request/util":function(){define("exports ../errors/RequestError ../errors/CancelError ../Deferred ../io-query ../_base/array ../_base/lang ../promise/Promise ../has".split(" "),function(n,t,i,r,u,f,e,o,s){function c(n){return h(n)}function l(n){return void 0!==n.data?n.data:n.text}n.deepCopy=function(t,i){var f,u,r;for(f in i)u=t[f],r=i[f],u!==r&&(u&&"object"==typeof u&&r&&"object"==typeof r?n.deepCopy(u,r):t[f]=r);return t};n.deepCreate=function(t,i){i=i||{};var f=e.delegate(t),r,u;for(r in t)(u=t[r])&&"object"==typeof u&&(f[r]=n.deepCreate(u,i[r]));return n.deepCopy(f,i)};var h=Object.freeze||function(n){return n};n.deferred=function(u,f,s,a,v,y){var p=new r(function(n){return f&&f(p,u),n&&(n instanceof t||n instanceof i)?n:new i("Request canceled",u)}),w;p.response=u;p.isValid=s;p.isReady=a;p.handleResponse=v;s=p.then(c).otherwise(function(n){n.response=u;throw n;});n.notify&&s.then(e.hitch(n.notify,"emit","load"),e.hitch(n.notify,"emit","error"));a=s.then(l);v=new o;for(w in a)a.hasOwnProperty(w)&&(v[w]=a[w]);return v.response=s,h(v),y&&p.then(function(n){y.call(p,n)},function(n){y.call(p,u,n)}),p.promise=v,p.then=v.then,p};n.addCommonMethods=function(n,t){f.forEach(t||["GET","POST","PUT","DELETE"],function(t){n[("DELETE"===t?"DEL":t).toLowerCase()]=function(i,r){return r=e.delegate(r||{}),r.method=t,n(i,r)}})};n.parseArgs=function(n,t,i){var f=t.data,r=t.query;return!f||i||"object"!=typeof f||s("native-xhr2")&&(f instanceof ArrayBuffer||f instanceof Blob)||(t.data=u.objectToQuery(f)),r?("object"==typeof r&&(r=u.objectToQuery(r)),t.preventCache&&(r+=(r?"&":"")+"request.preventCache="+ +new Date)):t.preventCache&&(r="request.preventCache="+ +new Date),n&&r&&(n+=(~n.indexOf("?")?"&":"?")+r),{url:n,options:t,getHeader:function(){return null}}};n.checkStatus=function(n){return n=n||0,200<=n&&300>n||304===n||1223===n||!n}})},"dojo/errors/RequestError":function(){define(["./create"],function(n){return n("RequestError",function(n,t){this.response=t})})},"dojo/errors/RequestTimeoutError":function(){define(["./create","./RequestError"],function(n,t){return n("RequestTimeoutError",null,t,{dojoType:"timeout"})})},"dojo/request/xhr":function(){define(["../errors/RequestError","./watch","./handlers","./util","../has"],function(n,t,i,r,u){function v(t,u){var f=t.xhr,e;t.status=t.xhr.status;try{t.text=f.responseText}catch(o){}if("xml"===t.options.handleAs&&(t.data=f.responseXML),!u)try{i(t)}catch(o){u=o}if(u)this.reject(u);else{try{i(t)}catch(o){e=o}r.checkStatus(f.status)?e?this.reject(e):this.resolve(t):(u=e?new n("Unable to load "+t.url+" status: "+f.status+" and an error in handleAs: transformation of response",t):new n("Unable to load "+t.url+" status: "+f.status,t),this.reject(u))}}function y(n){return this.xhr.getResponseHeader(n)}function f(i,p,w){var it=u("native-formdata")&&p&&p.data&&p.data instanceof FormData,g=r.parseArgs(i,r.deepCreate(a,p),it),tt,k,b,d,nt;if(i=g.url,p=g.options,k=r.deferred(g,h,o,c,v,function(){tt&&tt()}),b=g.xhr=f._create(),!b)return k.cancel(new n("XHR was not created")),w?k:k.promise;g.getHeader=y;s&&(tt=s(b,k,g));var rt="undefined"==typeof p.data?null:p.data,ut=!p.sync,ft=p.method;try{if(b.open(ft,i,ut,p.user||l,p.password||l),p.withCredentials&&(b.withCredentials=p.withCredentials),u("native-response-type")&&p.handleAs in e&&(b.responseType=e[p.handleAs]),d=p.headers,i=it?!1:"application/x-www-form-urlencoded",d)for(nt in d)"content-type"===nt.toLowerCase()?i=d[nt]:d[nt]&&b.setRequestHeader(nt,d[nt]);i&&!1!==i&&b.setRequestHeader("Content-Type",i);d&&"X-Requested-With"in d||b.setRequestHeader("X-Requested-With","XMLHttpRequest");r.notify&&r.notify.emit("send",g,k.promise.cancel);b.send(rt)}catch(et){k.reject(et)}return t(k),b=null,w?k:k.promise}var e,o,c,s,h,l,a;if(u.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),u.add("dojo-force-activex-xhr",function(){return u("activex")&&"file:"===window.location.protocol}),u.add("native-xhr2",function(){if(u("native-xhr")&&!u("dojo-force-activex-xhr")){var n=new XMLHttpRequest;return"undefined"!=typeof n.addEventListener&&("undefined"==typeof opera||"undefined"!=typeof n.upload)}}),u.add("native-formdata",function(){return"undefined"!=typeof FormData}),u.add("native-response-type",function(){return u("native-xhr")&&"undefined"!=typeof(new XMLHttpRequest).responseType}),u.add("native-xhr2-blob",function(){var n,t;if(u("native-response-type"))return n=new XMLHttpRequest,n.open("GET","https://dojotoolkit.org/",!0),n.responseType="blob",t=n.responseType,n.abort(),"blob"===t}),e={blob:u("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"},u("native-xhr2")?(o=function(){return!this.isFulfilled()},h=function(n,t){t.xhr.abort()},s=function(t,i,r){function u(){i.handleResponse(r)}function f(t){t=new n("Unable to load "+r.url+" status: "+t.target.status,r);i.handleResponse(r,t)}function e(n){n.lengthComputable?(r.loaded=n.loaded,r.total=n.total,i.progress(r)):3===r.xhr.readyState&&(r.loaded="loaded"in n?n.loaded:n.position,i.progress(r))}return t.addEventListener("load",u,!1),t.addEventListener("error",f,!1),t.addEventListener("progress",e,!1),function(){t.removeEventListener("load",u,!1);t.removeEventListener("error",f,!1);t.removeEventListener("progress",e,!1);t=null}}):(o=function(n){return n.xhr.readyState},c=function(n){return 4===n.xhr.readyState},h=function(n,t){var r=t.xhr,i=typeof r.abort;"function"!==i&&"object"!==i&&"unknown"!==i||r.abort()}),a={data:null,query:null,sync:!1,method:"GET"},f._create=function(){throw Error("XMLHTTP not available");},u("native-xhr")&&!u("dojo-force-activex-xhr"))f._create=function(){return new XMLHttpRequest};else if(u("activex"))try{new ActiveXObject("Msxml2.XMLHTTP");f._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(p){try{new ActiveXObject("Microsoft.XMLHTTP");f._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(w){}}return r.addCommonMethods(f),f})},"dojo/request/handlers":function(){define(["../json","../_base/kernel","../_base/array","../has","../selector/_loader"],function(n,t,i,r){function o(n){var t=e[n.options.handleAs];return n.data=t?t(n):n.data||n.text,n}var s,h,f,u,e;return r.add("activex","undefined"!=typeof ActiveXObject),r.add("dom-parser",function(n){return"DOMParser"in n}),r("activex")&&(h=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML.DOMDocument"],s=function(n){function u(n){try{var i=new ActiveXObject(n);i.async=!1;i.loadXML(e);t=i;f=n}catch(r){return!1}return!0}var t=n.data,e=n.text;return t&&r("dom-qsa2.1")&&!t.querySelectorAll&&r("dom-parser")&&(t=(new DOMParser).parseFromString(e,"application/xml")),t&&t.documentElement||f&&u(f)||i.some(h,u),t}),u=function(n){return r("native-xhr2-blob")||"blob"!==n.options.handleAs||"undefined"==typeof Blob?n.xhr.response:new Blob([n.xhr.response],{type:n.xhr.getResponseHeader("Content-Type")})},e={javascript:function(n){return t.eval(n.text||"")},json:function(t){return n.parse(t.text||null)},xml:s,blob:u,arraybuffer:u,document:u},o.register=function(n,t){e[n]=t},o})},"dojo/selector/_loader":function(){define(["../has","require"],function(n,t){var i,r;return"undefined"!=typeof document&&(i=document.createElement("div"),n.add("dom-qsa2.1",!!i.querySelectorAll),n.add("dom-qsa3",function(){try{return i.innerHTML="<p class='TEST'><\/p>",1==i.querySelectorAll(".TEST:empty").length}catch(n){}})),{load:function(i,u,f,e){if(e&&e.isBuild)f();else{if(e=t,i="default"==i?n("config-selectorEngine")||"css3":i,i="css2"==i||"lite"==i?"./lite":"css2.1"==i?n("dom-qsa2.1")?"./lite":"./acme":"css3"==i?n("dom-qsa3")?"./lite":"./acme":"acme"==i?"./acme":(e=u)&&i,"?"==i.charAt(i.length-1))i=i.substring(0,i.length-1);if(!0&&(n("dom-compliant-qsa")||r))return f(r);e([i],function(n){"./lite"!=i&&(r=n);f(n)})}}}})},"dojo/main":function(){define("./_base/kernel ./has require ./sniff ./_base/lang ./_base/array ./_base/config ./ready ./_base/declare ./_base/connect ./_base/Deferred ./_base/json ./_base/Color ./has!dojo-firebug?./_firebug/firebug ./_base/browser ./_base/loader".split(" "),function(n,t,i,r,u,f,e,o){e.isDebug&&i(["./_firebug/firebug"]);var s=e.require;return s&&(s=f.map(u.isArray(s)?s:[s],function(n){return n.replace(/\./g,"/")}),n.isAsync?i(s):o(1,function(){i(s)})),n})},"dojo/ready":function(){define(["./_base/kernel","./has","require","./domReady","./_base/lang"],function(n,t,i,r,u){var c=0,f=[],h=0,e,o,s;return t=function(){c=1;n._postLoad=n.config.afterOnLoad=!0;e()},e=function(){if(!h){for(h=1;c&&(!r||0==r._Q.length)&&(i.idle?i.idle():1)&&f.length;){var t=f.shift();try{t()}catch(n){if(n.info=n.message,i.signal)i.signal("error",n);else throw n;}}h=0}},i.on&&i.on("idle",e),r&&(r._onQEmpty=e),o=n.ready=n.addOnLoad=function(t,i,r){var o=u._toArray(arguments);for("number"!=typeof t?(r=i,i=t,t=1e3):o.shift(),r=r?u.hitch.apply(n,o):function(){i()},r.priority=t,o=0;o<f.length&&t>=f[o].priority;o++);f.splice(o,0,r);e()},s=n.config.addOnLoad,s&&o[u.isArray(s)?"apply":"call"](n,s),n.config.parseOnLoad&&!n.isAsync&&o(99,function(){n.parser||(n.deprecated("Add explicit require(['dojo/parser']);","","2.0"),i(["dojo/parser"]))}),r?r(t):t(),o})},"dojo/domReady":function(){define(["./has"],function(n){function i(n){r.push(n);u&&y()}function y(){if(!l){for(l=!0;r.length;)try{r.shift()(t)}catch(n){console.error(n,"in domReady callback",n.stack)}l=!1;i._onQEmpty()}}var s=function(){return this}(),t=document,h={loaded:1,complete:1},c="string"!=typeof t.readyState,u=!!h[t.readyState],r=[],l,o,a,v;if(i.load=function(n,t,r){i(r)},i._Q=r,i._onQEmpty=function(){},c&&(t.readyState="loading"),!u){var f=[],e=function(n){n=n||s.event;u||"readystatechange"==n.type&&!h[t.readyState]||(c&&(t.readyState="complete"),u=1,y())},o=function(n,t){n.addEventListener(t,e,!1);r.push(function(){n.removeEventListener(t,e,!1)})};if(!n("dom-addeventlistener")){o=function(n,t){t="on"+t;n.attachEvent(t,e);r.push(function(){n.detachEvent(t,e)})};a=t.createElement("div");try{a.doScroll&&null===s.frameElement&&f.push(function(){try{return a.doScroll("left"),1}catch(n){}})}catch(p){}}o(t,"DOMContentLoaded");o(s,"load");"onreadystatechange"in t?o(t,"readystatechange"):c||f.push(function(){return h[t.readyState]});f.length&&(v=function(){if(!u){for(var n=f.length;n--;)if(f[n]()){e("poller");return}setTimeout(v,30)}},v())}return i})},"dojo/_base/declare":function(){define(["./kernel","../has","./lang"],function(n,t,i){function r(n,t){throw Error("declare"+(t?" "+t:"")+": "+n);}function v(n,t){for(var s=[],c=[{cls:0,refs:[]}],v={},l=1,y=n.length,o=0,u,a,i,f,h;o<y;++o){for((u=n[o])?"[object Function]"!=e.call(u)&&r("mixin #"+o+" is not a callable constructor.",t):r("mixin #"+o+" is unknown. Did you use dojo.require to pull it in?",t),a=u._meta?u._meta.bases:[u],i=0,u=a.length-1;0<=u;--u)f=a[u].prototype,f.hasOwnProperty("declaredClass")||(f.declaredClass="uniqName_"+rt++),f=f.declaredClass,v.hasOwnProperty(f)||(v[f]={count:0,refs:[],cls:a[u]},++l),f=v[f],i&&i!==f&&(f.refs.push(i),++i.count),i=f;++i.count;c[0].refs.push(i)}for(;c.length;){for(i=c.pop(),s.push(i.cls),--l;h=i.refs,1==h.length;){if(i=h[0],!i||--i.count){i=0;break}s.push(i.cls);--l}if(i)for(o=0,y=h.length;o<y;++o)i=h[o],--i.count||c.push(i)}return l&&r("can't build consistent linearization",t),u=n[0],s[0]=u?u._meta&&u===s[s.length-u._meta.bases.length]?u._meta.bases.length:1:0,s}function c(n,t,i,f){var o,h,l,s,e,c,a=this._inherited=this._inherited||{};if("string"==typeof n&&(o=n,n=t,t=i,i=f),"function"==typeof n)l=n,n=t,t=i;else try{l=n.callee}catch(v){if(v instanceof TypeError)r("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass);else throw v;}if((o=o||l.nom)||r("can't deduce a name to call inherited()",this.declaredClass),i=f=0,s=this.constructor._meta,f=s.bases,c=a.p,"constructor"!=o){if(a.c!==l&&(c=0,e=f[0],s=e._meta,s.hidden[o]!==l)){(h=s.chains)&&"string"==typeof h[o]&&r("calling chained method with inherited: "+o,this.declaredClass);do if(s=e._meta,h=e.prototype,s&&(h[o]===l&&h.hasOwnProperty(o)||s.hidden[o]===l))break;while(e=f[++c]);c=e?c:-1}if(e=f[++c])if(h=e.prototype,e._meta&&h.hasOwnProperty(o))i=h[o];else{l=u[o];do if(h=e.prototype,(i=h[o])&&(e._meta?h.hasOwnProperty(o):i!==l))break;while(e=f[++c])}i=e&&i||u[o]}else{if(a.c!==l&&(c=0,(s=f[0]._meta)&&s.ctor!==l)){for((h=s.chains)&&"manual"===h.constructor||r("calling chained constructor with inherited",this.declaredClass);(e=f[++c])&&(!(s=e._meta)||s.ctor!==l););c=e?c:-1}for(;(e=f[++c])&&!(i=(s=e._meta)?s.ctor:e););i=e&&i}return a.c=i,a.p=c,i?!0===t?i:i.apply(this,t||n):void 0}function y(n,t,i){return"string"==typeof n?"function"==typeof t?this.__inherited(n,t,i,!0):this.__inherited(n,t,!0):"function"==typeof n?this.__inherited(n,t,!0):this.__inherited(n,!0)}function p(n,t,i,r){var u=this.getInherited(n,t,i);if(u)return u.apply(this,r||i||t||n)}function w(n){for(var i=this.constructor._meta.bases,t=0,r=i.length;t<r;++t)if(i[t]===n)return!0;return this instanceof n}function b(n,r){var u,f,e;for(u in r)"constructor"!=u&&r.hasOwnProperty(u)&&(n[u]=r[u]);if(t("bug-for-in-skips-shadowed"))for(f=i._extraNames,e=f.length;e;)u=f[--e],"constructor"!=u&&r.hasOwnProperty(u)&&(n[u]=r[u])}function k(n){return f.safeMixin(this.prototype,n),this}function d(n,t){return n instanceof Array||"function"==typeof n||(t=n,n=void 0),t=t||{},n=n||[],f([this].concat(n),t)}function g(n,t){return function(){var r=arguments,o=r,i=r[0],u,f,e;if(f=n.length,!(this instanceof r.callee))return h(r);if(t&&(i&&i.preamble||this.preamble))for(e=Array(n.length),e[0]=r,u=0;;){if((i=r[0])&&(i=i.preamble)&&(r=i.apply(this,r)||r),i=n[u].prototype,(i=i.hasOwnProperty("preamble")&&i.preamble)&&(r=i.apply(this,r)||r),++u==f)break;e[u]=r}for(u=f-1;0<=u;--u)i=n[u],(i=(f=i._meta)?f.ctor:i)&&i.apply(this,e?e[u]:r);(i=this.postscript)&&i.apply(this,o)}}function nt(n,t){return function(){var r=arguments,u=r,i=r[0];if(!(this instanceof r.callee))return h(r);t&&(i&&(i=i.preamble)&&(u=i.apply(this,u)||u),(i=this.preamble)&&i.apply(this,u));n&&n.apply(this,r);(i=this.postscript)&&i.apply(this,r)}}function tt(n){return function(){var i=arguments,r=0,t,u;if(!(this instanceof i.callee))return h(i);for(;t=n[r];++r)if(t=(u=t._meta)?u.ctor:t){t.apply(this,i);break}(t=this.postscript)&&t.apply(this,i)}}function it(n,t,i){return function(){var r,u,f=0,e=1;for(i&&(f=t.length-1,e=-1);r=t[f];f+=e)u=r._meta,(r=(u?u.hidden:r.prototype)[n])&&r.apply(this,arguments)}}function l(n){return s.prototype=n.prototype,n=new s,s.prototype=null,n}function h(n){var t=n.callee,i=l(t);return t.apply(i,n),i}function f(n,s,h){"string"!=typeof n&&(h=s,s=n,n="");h=h||{};var rt,ot,p,et,st,ut,ft,ht=1,ct=s;if("[object Array]"==e.call(s)?(ut=v(s,n),p=ut[0],ht=ut.length-p,s=ut[ht]):(ut=[0],s?"[object Function]"==e.call(s)?(p=s._meta,ut=ut.concat(p?p.bases:s)):r("base class is not a callable constructor.",n):null!==s&&r("unknown base class. Did you use dojo.require to pull it in?",n)),s)for(ot=ht-1;;--ot){if(rt=l(s),!ot)break;p=ut[ot];(p._meta?b:o)(rt,p.prototype);et=t("csp-restrictions")?function(){}:new Function;et.superclass=s;et.prototype=rt;s=rt.constructor=et}else rt={};for(f.safeMixin(rt,h),p=h.constructor,p!==u.constructor&&(p.nom="constructor",rt.constructor=p),ot=ht-1;ot;--ot)(p=ut[ot]._meta)&&p.chains&&(ft=o(ft||{},p.chains));if(rt["-chains-"]&&(ft=o(ft||{},rt["-chains-"])),s&&s.prototype&&s.prototype["-chains-"]&&(ft=o(ft||{},s.prototype["-chains-"])),p=!ft||!ft.hasOwnProperty("constructor"),ut[0]=et=ft&&"manual"===ft.constructor?tt(ut):1==ut.length?nt(h.constructor,p):g(ut,p),et._meta={bases:ut,hidden:h,chains:ft,parents:ct,ctor:h.constructor},et.superclass=s&&s.prototype,et.extend=k,et.createSubclass=d,et.prototype=rt,rt.constructor=et,rt.getInherited=y,rt.isInstanceOf=w,rt.inherited=a,rt.__inherited=c,n&&(rt.declaredClass=n,i.setObject(n,et)),ft)for(st in ft)rt[st]&&"string"==typeof ft[st]&&"constructor"!=st&&(p=rt[st]=it(st,ut,"after"===ft[st]),p.nom=st);return et}var o=i.mixin,u=Object.prototype,e=u.toString,s,rt=0,a;return s=t("csp-restrictions")?function(){}:new Function,a=n.config.isDebug?p:c,n.safeMixin=f.safeMixin=function(n,r){var f,o,s,h;for(f in r)o=r[f],o===u[f]&&f in u||"constructor"==f||("[object Function]"==e.call(o)&&(o.nom=f),n[f]=o);if(t("bug-for-in-skips-shadowed")&&r)for(s=i._extraNames,h=s.length;h;)f=s[--h],o=r[f],o===u[f]&&f in u||"constructor"==f||("[object Function]"==e.call(o)&&(o.nom=f),n[f]=o);return n},n.declare=f})},"dojo/_base/connect":function(){define("./kernel ../on ../topic ../aspect ./event ../mouse ./sniff ./lang ../keys".split(" "),function(n,t,i,r,u,f,e,o){function a(i,u,e,s,h){if(s=o.hitch(e,s),!i||!i.addEventListener&&!i.attachEvent)return r.after(i||n.global,u,s,!0);if("string"==typeof u&&"on"==u.substring(0,2)&&(u=u.substring(2)),i||(i=n.global),!h)switch(u){case"keypress":u=c;break;case"mouseenter":u=f.enter;break;case"mouseleave":u=f.leave}return t(i,u,s,h)}function l(n){n.keyChar=n.charCode?String.fromCharCode(n.charCode):"";n.charOrCode=n.keyChar||n.keyCode}var s;e.add("events-keypress-typed",function(){var n={charCode:0};try{n=document.createEvent("KeyboardEvent");(n.initKeyboardEvent||n.initKeyEvent).call(n,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(t){}return 0==n.charCode&&!e("opera")});var v={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},y=e("mac")?"metaKey":"ctrlKey",h=function(n,t){var i=o.mixin({},n,t);return l(i),i.preventDefault=function(){n.preventDefault()},i.stopPropagation=function(){n.stopPropagation()},i},c;return c=e("events-keypress-typed")?function(n,i){var r=t(n,"keydown",function(n){var t=n.keyCode,r=13!=t&&32!=t&&(27!=t||!e("ie"))&&(48>t||90<t)&&(96>t||111<t)&&(186>t||192<t)&&(219>t||222<t)&&229!=t;if(r||n.ctrlKey){if(r=r?0:t,n.ctrlKey){if(3==t||13==t)return i.call(n.currentTarget,n);r=95<r&&106>r?r-48:!n.shiftKey&&65<=r&&90>=r?r+32:v[r]||r}if(t=h(n,{type:"keypress",faux:!0,charCode:r}),i.call(n.currentTarget,t),e("ie"))try{n.keyCode=t.keyCode}catch(u){}}}),u=t(n,"keypress",function(n){var t=n.charCode;return n=h(n,{charCode:32<=t?t:0,faux:!0}),i.call(this,n)});return{remove:function(){r.remove();u.remove()}}}:e("opera")?function(n,i){return t(n,"keypress",function(n){var t=n.which;return 3==t&&(t=99),t=32>t&&!n.shiftKey?0:t,n.ctrlKey&&!n.shiftKey&&65<=t&&90>=t&&(t+=32),i.call(this,h(n,{charCode:t}))})}:function(n,i){return t(n,"keypress",function(n){return l(n),i.call(this,n)})},s={_keypress:c,connect:function(){var n=arguments,r=[],t=0,i;for(r.push("string"==typeof n[0]?null:n[t++],n[t++]),i=n[t+1],r.push("string"==typeof i||"function"==typeof i?n[t++]:null,n[t++]),i=n.length;t<i;t++)r.push(n[t]);return a.apply(this,r)},disconnect:function(n){n&&n.remove()},subscribe:function(n,t,r){return i.subscribe(n,o.hitch(t,r))},publish:function(n,t){return i.publish.apply(i,[n].concat(t))},connectPublisher:function(n,t,i){var r=function(){s.publish(n,arguments)};return i?s.connect(t,i,r):s.connect(t,r)},isCopyKey:function(n){return n[y]}},s.unsubscribe=s.disconnect,o.mixin(n,s),s})},"dojo/topic":function(){define(["./Evented"],function(n){var t=new n;return{publish:function(){return t.emit.apply(t,arguments)},subscribe:function(){return t.on.apply(t,arguments)}}})},"dojo/_base/event":function(){define(["./kernel","../on","../has","../dom-geometry"],function(n,t,i,r){var f,u;return t._fixEvent&&(f=t._fixEvent,t._fixEvent=function(n,t){return(n=f(n,t))&&r.normalizeEvent(n),n}),u={fix:function(n,i){return t._fixEvent?t._fixEvent(n,i):n},stop:function(n){i("dom-addeventlistener")||n&&n.preventDefault?(n.preventDefault(),n.stopPropagation()):(n=n||window.event,n.cancelBubble=!0,t._preventDefault.call(n))}},n.fixEvent=u.fix,n.stopEvent=u.stop,u})},"dojo/dom-geometry":function(){define(["./sniff","./_base/window","./dom","./dom-style"],function(n,t,i,r){function f(n,t,i,r,u,f){f=f||"px";n=n.style;isNaN(t)||(n.left=t+f);isNaN(i)||(n.top=i+f);0<=r&&(n.width=r+f);0<=u&&(n.height=u+f)}function e(n){return"button"==n.tagName.toLowerCase()||"input"==n.tagName.toLowerCase()&&"button"==(n.getAttribute("type")||"").toLowerCase()}function o(n){return"border-box"==u.boxModel||"table"==n.tagName.toLowerCase()||e(n)}var u={boxModel:"content-box"},s;return n("ie")&&(u.boxModel="BackCompat"==document.compatMode?"border-box":"content-box"),u.getPadExtents=function(n,t){n=i.byId(n);var u=t||r.getComputedStyle(n),f=r.toPixelValue,e=f(n,u.paddingLeft),o=f(n,u.paddingTop),s=f(n,u.paddingRight),u=f(n,u.paddingBottom);return{l:e,t:o,r:s,b:u,w:e+s,h:o+u}},u.getBorderExtents=function(n,t){n=i.byId(n);var f=r.toPixelValue,u=t||r.getComputedStyle(n),e="none"!=u.borderLeftStyle?f(n,u.borderLeftWidth):0,o="none"!=u.borderTopStyle?f(n,u.borderTopWidth):0,s="none"!=u.borderRightStyle?f(n,u.borderRightWidth):0,f="none"!=u.borderBottomStyle?f(n,u.borderBottomWidth):0;return{l:e,t:o,r:s,b:f,w:e+s,h:o+f}},u.getPadBorderExtents=function(n,t){n=i.byId(n);var f=t||r.getComputedStyle(n),e=u.getPadExtents(n,f),f=u.getBorderExtents(n,f);return{l:e.l+f.l,t:e.t+f.t,r:e.r+f.r,b:e.b+f.b,w:e.w+f.w,h:e.h+f.h}},u.getMarginExtents=function(n,t){n=i.byId(n);var u=t||r.getComputedStyle(n),f=r.toPixelValue,e=f(n,u.marginLeft),o=f(n,u.marginTop),s=f(n,u.marginRight),u=f(n,u.marginBottom);return{l:e,t:o,r:s,b:u,w:e+s,h:o+u}},u.getMarginBox=function(t,f){t=i.byId(t);var o=f||r.getComputedStyle(t),o=u.getMarginExtents(t,o),s=t.offsetLeft-o.l,h=t.offsetTop-o.t,e=t.parentNode,c=r.toPixelValue;return 8==n("ie")&&!n("quirks")&&e&&(e=r.getComputedStyle(e),s-="none"!=e.borderLeftStyle?c(t,e.borderLeftWidth):0,h-="none"!=e.borderTopStyle?c(t,e.borderTopWidth):0),{l:s,t:h,w:t.offsetWidth+o.w,h:t.offsetHeight+o.h}},u.getContentBox=function(t,f){var s,l,o,a;t=i.byId(t);var s=f||r.getComputedStyle(t),c=t.clientWidth,e,h=u.getPadExtents(t,s);return e=u.getBorderExtents(t,s),s=t.offsetLeft+h.l+e.l,l=t.offsetTop+h.t+e.t,c?e=t.clientHeight:(c=t.offsetWidth-e.w,e=t.offsetHeight-e.h),8!=n("ie")||n("quirks")||(o=t.parentNode,a=r.toPixelValue,o&&(o=r.getComputedStyle(o),s-="none"!=o.borderLeftStyle?a(t,o.borderLeftWidth):0,l-="none"!=o.borderTopStyle?a(t,o.borderTopWidth):0)),{l:s,t:l,w:c-h.w,h:e-h.h}},u.setContentSize=function(n,t,r){n=i.byId(n);var e=t.w;t=t.h;o(n)&&(r=u.getPadBorderExtents(n,r),0<=e&&(e+=r.w),0<=t&&(t+=r.h));f(n,NaN,NaN,e,t)},s={l:0,t:0,w:0,h:0},u.setMarginBox=function(t,h,c){var l,v;t=i.byId(t);l=c||r.getComputedStyle(t);c=h.w;var a=h.h,y=o(t)?s:u.getPadBorderExtents(t,l),l=u.getMarginExtents(t,l);n("webkit")&&e(t)&&(v=t.style,0<=c&&!v.width&&(v.width="4px"),0<=a&&!v.height&&(v.height="4px"));0<=c&&(c=Math.max(c-y.w-l.w,0));0<=a&&(a=Math.max(a-y.h-l.h,0));f(t,h.l,h.t,c,a)},u.isBodyLtr=function(n){return n=n||t.doc,"ltr"==(t.body(n).dir||n.documentElement.dir||"ltr").toLowerCase()},u.docScroll=function(i){i=i||t.doc;var r=t.doc.parentWindow||t.doc.defaultView;return"pageXOffset"in r?{x:r.pageXOffset,y:r.pageYOffset}:(r=n("quirks")?t.body(i):i.documentElement)&&{x:u.fixIeBiDiScrollLeft(r.scrollLeft||0,i),y:r.scrollTop||0}},u.getIeDocumentElementOffset=function(){return{x:0,y:0}},u.fixIeBiDiScrollLeft=function(i,r){var e;if(r=r||t.doc,e=n("ie"),e&&!u.isBodyLtr(r)){var o=n("quirks"),f=o?t.body(r):r.documentElement,s=t.global;return 6==e&&!o&&s.frameElement&&f.scrollHeight>f.clientHeight&&(i+=f.clientLeft),8>e||o?i+f.clientWidth-f.scrollWidth:-i}return i},u.position=function(r,f){r=i.byId(r);var o=t.body(r.ownerDocument),e=r.getBoundingClientRect(),e={x:e.left,y:e.top,w:e.right-e.left,h:e.bottom-e.top};return 9>n("ie")&&(e.x-=n("quirks")?o.clientLeft+o.offsetLeft:0,e.y-=n("quirks")?o.clientTop+o.offsetTop:0),f&&(o=u.docScroll(r.ownerDocument),e.x+=o.x,e.y+=o.y),e},u.getMarginSize=function(n,t){n=i.byId(n);var e=u.getMarginExtents(n,t||r.getComputedStyle(n)),f=n.getBoundingClientRect();return{w:f.right-f.left+e.w,h:f.bottom-f.top+e.h}},u.normalizeEvent=function(t){if("layerX"in t||(t.layerX=t.offsetX,t.layerY=t.offsetY),!("pageX"in t)){var i=t.target,i=i&&i.ownerDocument||document,r=n("quirks")?i.body:i.documentElement;t.pageX=t.clientX+u.fixIeBiDiScrollLeft(r.scrollLeft||0,i);t.pageY=t.clientY+(r.scrollTop||0)}},u})},"dojo/dom-style":function(){define(["./sniff","./dom","./_base/window"],function(n,t,i){function c(n,t,i){if(t=t.toLowerCase(),"auto"==i){if("height"==t)return n.offsetHeight;if("width"==t)return n.offsetWidth}if("fontweight"==t)switch(i){case 700:return"bold";default:return"normal"}return t in o||(o[t]=a.test(t)),o[t]?e(n,i):i}var f,r={},e;f=n("webkit")?function(n){var t,i;return 1==n.nodeType&&(i=n.ownerDocument.defaultView,t=i.getComputedStyle(n,null),!t&&n.style&&(n.style.display="",t=i.getComputedStyle(n,null))),t||{}}:n("ie")&&(9>n("ie")||n("quirks"))?function(n){return 1==n.nodeType&&n.currentStyle?n.currentStyle:{}}:function(n){if(1===n.nodeType){var t=n.ownerDocument.defaultView;return(t.opener?t:i.global.window).getComputedStyle(n,null)}return{}};r.getComputedStyle=f;e=n("ie")?function(n,t){if(!t)return 0;if("medium"==t)return 4;if(t.slice&&"px"==t.slice(-2))return parseFloat(t);var i=n.style,r=n.runtimeStyle,u=i.left,f=r.left;r.left=n.currentStyle.left;try{i.left=t;t=i.pixelLeft}catch(e){t=0}return i.left=u,r.left=f,t}:function(n,t){return parseFloat(t)||0};r.toPixelValue=e;var u=function(n,t){try{return n.filters.item("DXImageTransform.Microsoft.Alpha")}catch(i){return t?{}:null}},l=9>n("ie")||10>n("ie")&&n("quirks")?function(n){try{return u(n).Opacity/100}catch(t){return 1}}:function(n){return f(n).opacity},s=9>n("ie")||10>n("ie")&&n("quirks")?function(n,t){""===t&&(t=1);var i=100*t;if(1===t?(n.style.zoom="",u(n)&&(n.style.filter=n.style.filter.replace(/\s*progid:DXImageTransform.Microsoft.Alpha\([^\)]+?\)/i,""))):(n.style.zoom=1,u(n)?u(n,1).Opacity=i:n.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(Opacity="+i+")",u(n,1).Enabled=!0),"tr"==n.tagName.toLowerCase())for(i=n.firstChild;i;i=i.nextSibling)"td"==i.tagName.toLowerCase()&&s(i,t);return t}:function(n,t){return n.style.opacity=t},o={left:!0,top:!0},a=/margin|padding|width|height|max|min|offset/,h={cssFloat:1,styleFloat:1,float:1};return r.get=function(n,i){var u=t.byId(n),e=arguments.length,f;return 2==e&&"opacity"==i?l(u):(i=h[i]?"cssFloat"in u.style?"cssFloat":"styleFloat":i,f=r.getComputedStyle(u),1==e?f:c(u,i,f[i]||u.style[i]))},r.set=function(n,i,u){var f=t.byId(n),o=arguments.length,c="opacity"==i,e;if(i=h[i]?"cssFloat"in f.style?"cssFloat":"styleFloat":i,3==o)return c?s(f,u):f.style[i]=u;for(e in i)r.set(n,e,i[e]);return r.getComputedStyle(f)},r})},"dojo/mouse":function(){define(["./_base/kernel","./on","./has","./dom","./_base/window"],function(n,t,i,r,u){function f(n,i){var u=function(u,f){return t(u,n,function(n){return i?i(n,f):r.isDescendant(n.relatedTarget,u)?void 0:f.call(this,n)})};return u.bubble=function(t){return f(n,function(n,i){var r=t(n.target),u=n.relatedTarget;if(r&&r!=(u&&1==u.nodeType&&t(u)))return i.call(r,n)})},u}return i.add("dom-quirks",u.doc&&"BackCompat"==u.doc.compatMode),i.add("events-mouseenter",u.doc&&"onmouseenter"in u.doc.createElement("div")),i.add("events-mousewheel",u.doc&&"onmousewheel"in u.doc),u=i("dom-quirks")&&i("ie")||!i("dom-addeventlistener")?{LEFT:1,MIDDLE:4,RIGHT:2,isButton:function(n,t){return n.button&t},isLeft:function(n){return n.button&1},isMiddle:function(n){return n.button&4},isRight:function(n){return n.button&2}}:{LEFT:0,MIDDLE:1,RIGHT:2,isButton:function(n,t){return n.button==t},isLeft:function(n){return 0==n.button},isMiddle:function(n){return 1==n.button},isRight:function(n){return 2==n.button}},n.mouseButtons=u,n=i("events-mousewheel")?"mousewheel":function(n,i){return t(n,"DOMMouseScroll",function(n){n.wheelDelta=-n.detail;i.call(this,n)})},{_eventHandler:f,enter:f("mouseover"),leave:f("mouseout"),wheel:n,isLeft:u.isLeft,isMiddle:u.isMiddle,isRight:u.isRight}})},"dojo/keys":function(){define(["./_base/kernel","./sniff"],function(n,t){return n.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:t("webkit")?91:224,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,UP_DPAD:175,DOWN_DPAD:176,LEFT_DPAD:177,RIGHT_DPAD:178,copyKey:t("mac")&&!t("air")?t("safari")?91:224:17}})},"dojo/_base/Color":function(){define(["./kernel","./lang","./array","./config"],function(n,t,i,r){var u=n.Color=function(n){n&&this.setColor(n)};return u.named={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],transparent:r.transparentColor||[0,0,0,0]},t.extend(u,{r:255,g:255,b:255,a:1,_set:function(n,t,i,r){this.r=n;this.g=t;this.b=i;this.a=r},setColor:function(n){return t.isString(n)?u.fromString(n,this):t.isArray(n)?u.fromArray(n,this):(this._set(n.r,n.g,n.b,n.a),n instanceof u||this.sanitize()),this},sanitize:function(){return this},toRgb:function(){return[this.r,this.g,this.b]},toRgba:function(){return[this.r,this.g,this.b,this.a]},toHex:function(){return"#"+i.map(["r","g","b"],function(n){return n=this[n].toString(16),2>n.length?"0"+n:n},this).join("")},toCss:function(n){var t=this.r+", "+this.g+", "+this.b;return(n?"rgba("+t+", "+this.a:"rgb("+t)+")"},toString:function(){return this.toCss(!0)}}),u.blendColors=n.blendColors=function(n,t,r,f){var e=f||new u;return i.forEach(["r","g","b","a"],function(i){e[i]=n[i]+(t[i]-n[i])*r;"a"!=i&&(e[i]=Math.round(e[i]))}),e.sanitize()},u.fromRgb=n.colorFromRgb=function(n,t){var i=n.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/);return i&&u.fromArray(i[1].split(/\s*,\s*/),t)},u.fromHex=n.colorFromHex=function(n,t){var r=t||new u,f=4==n.length?4:8,e=(1<<f)-1;return(n=Number("0x"+n.substr(1)),isNaN(n))?null:(i.forEach(["b","g","r"],function(t){var i=n&e;n>>=f;r[t]=4==f?17*i:i}),r.a=1,r)},u.fromArray=n.colorFromArray=function(n,t){var i=t||new u;return i._set(Number(n[0]),Number(n[1]),Number(n[2]),Number(n[3])),isNaN(i.a)&&(i.a=1),i.sanitize()},u.fromString=n.colorFromString=function(n,t){var i=u.named[n];return i&&u.fromArray(i,t)||u.fromRgb(n,t)||u.fromHex(n,t)},u})},"dojo/_base/browser":function(){require.has&&require.has.add("config-selectorEngine","acme");define("../ready ./kernel ./connect ./unload ./window ./event ./html ./NodeList ../query ./xhr ./fx".split(" "),function(n){return n})},"dojo/_base/unload":function(){define(["./kernel","./lang","../on"],function(n,t,i){var r=window,u={addOnWindowUnload:function(u,f){n.windowUnloaded||i(r,"unload",n.windowUnloaded=function(){});i(r,"unload",t.hitch(u,f))},addOnUnload:function(n,u){i(r,"beforeunload",t.hitch(n,u))}};return n.addOnWindowUnload=u.addOnWindowUnload,n.addOnUnload=u.addOnUnload,u})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(n,t,i,r,u,f,e,o){return n.byId=t.byId,n.isDescendant=t.isDescendant,n.setSelectable=t.setSelectable,n.getAttr=r.get,n.setAttr=r.set,n.hasAttr=r.has,n.removeAttr=r.remove,n.getNodeProp=r.getNodeProp,n.attr=function(n,t,i){return 2==arguments.length?r["string"==typeof t?"get":"set"](n,t):r.set(n,t,i)},n.hasClass=f.contains,n.addClass=f.add,n.removeClass=f.remove,n.toggleClass=f.toggle,n.replaceClass=f.replace,n._toDom=n.toDom=e.toDom,n.place=e.place,n.create=e.create,n.empty=function(n){e.empty(n)},n._destroyElement=n.destroy=function(n){e.destroy(n)},n._getPadExtents=n.getPadExtents=o.getPadExtents,n._getBorderExtents=n.getBorderExtents=o.getBorderExtents,n._getPadBorderExtents=n.getPadBorderExtents=o.getPadBorderExtents,n._getMarginExtents=n.getMarginExtents=o.getMarginExtents,n._getMarginSize=n.getMarginSize=o.getMarginSize,n._getMarginBox=n.getMarginBox=o.getMarginBox,n.setMarginBox=o.setMarginBox,n._getContentBox=n.getContentBox=o.getContentBox,n.setContentSize=o.setContentSize,n._isBodyLtr=n.isBodyLtr=o.isBodyLtr,n._docScroll=n.docScroll=o.docScroll,n._getIeDocumentElementOffset=n.getIeDocumentElementOffset=o.getIeDocumentElementOffset,n._fixIeBiDiScrollLeft=n.fixIeBiDiScrollLeft=o.fixIeBiDiScrollLeft,n.position=o.position,n.marginBox=function(n,t){return t?o.setMarginBox(n,t):o.getMarginBox(n)},n.contentBox=function(n,t){return t?o.setContentSize(n,t):o.getContentBox(n)},n.coords=function(r,u){n.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");r=t.byId(r);var f=i.getComputedStyle(r),f=o.getMarginBox(r,f),e=o.position(r,u);return f.x=e.x,f.y=e.y,f},n.getProp=u.get,n.setProp=u.set,n.prop=function(n,t,i){return 2==arguments.length?u["string"==typeof t?"get":"set"](n,t):u.set(n,t,i)},n.getStyle=i.get,n.setStyle=i.set,n.getComputedStyle=i.getComputedStyle,n.__toPixelValue=n.toPixelValue=i.toPixelValue,n.style=function(n,t,r){switch(arguments.length){case 1:return i.get(n);case 2:return i["string"==typeof t?"get":"set"](n,t)}return i.set(n,t,r)},n})},"dojo/dom-attr":function(){define("exports ./sniff ./_base/lang ./dom ./dom-style ./dom-prop".split(" "),function(n,t,i,r,u,f){function o(n,t){var i=n.getAttributeNode&&n.getAttributeNode(t);return!!i&&i.specified}var s={innerHTML:1,textContent:1,className:1,htmlFor:t("ie"),value:1},e={classname:"class",htmlfor:"for",tabindex:"tabIndex",readonly:"readOnly"};n.has=function(n,t){var i=t.toLowerCase();return s[f.names[i]||t]||o(r.byId(n),e[i]||t)};n.get=function(n,t){n=r.byId(n);var u=t.toLowerCase(),h=f.names[u]||t,c=n[h];return s[h]&&"undefined"!=typeof c?c:"textContent"==h?f.get(n,h):"href"!=h&&("boolean"==typeof c||i.isFunction(c))?c:(u=e[u]||t,o(n,u)?n.getAttribute(u):null)};n.set=function(t,o,h){var c,l,a;if(t=r.byId(t),2==arguments.length){for(c in o)n.set(t,c,o[c]);return t}return(c=o.toLowerCase(),l=f.names[c]||o,a=s[l],"style"==l&&"string"!=typeof h)?(u.set(t,h),t):a||"boolean"==typeof h||i.isFunction(h)?f.set(t,o,h):(t.setAttribute(e[c]||o,h),t)};n.remove=function(n,t){r.byId(n).removeAttribute(e[t.toLowerCase()]||t)};n.getNodeProp=function(n,t){n=r.byId(n);var i=t.toLowerCase(),u=f.names[i]||t;return u in n&&"href"!=u?n[u]:(i=e[i]||t,o(n,i)?n.getAttribute(i):null)}})},"dojo/dom-prop":function(){define("exports ./_base/kernel ./sniff ./_base/lang ./dom ./dom-style ./dom-construct ./_base/connect".split(" "),function(n,t,i,r,u,f,e,o){function h(n){var i="",r,t;for(n=n.childNodes,r=0;t=n[r];r++)8!=t.nodeType&&(i=1==t.nodeType?i+h(t):i+t.nodeValue);return i}var s={},l=1,c=t._scopeName+"attrid";i.add("dom-textContent",function(n,t,i){return"textContent"in i});n.names={"class":"className","for":"htmlFor",tabindex:"tabIndex",readonly:"readOnly",colspan:"colSpan",frameborder:"frameBorder",rowspan:"rowSpan",textcontent:"textContent",valuetype:"valueType"};n.get=function(t,r){t=u.byId(t);var f=r.toLowerCase(),f=n.names[f]||r;return"textContent"!=f||i("dom-textContent")?t[f]:h(t)};n.set=function(t,h,a){var v,y,p;if(t=u.byId(t),2==arguments.length&&"string"!=typeof h){for(v in h)n.set(t,v,h[v]);return t}if(v=h.toLowerCase(),v=n.names[v]||h,"style"==v&&"string"!=typeof a)return f.set(t,a),t;if("innerHTML"==v)return i("ie")&&t.tagName.toLowerCase()in{col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1}?(e.empty(t),t.appendChild(e.toDom(a,t.ownerDocument))):t[v]=a,t;if("textContent"==v&&!i("dom-textContent"))return e.empty(t),t.appendChild(t.ownerDocument.createTextNode(a)),t;if(r.isFunction(a)){if(y=t[c],y||(y=l++,t[c]=y),s[y]||(s[y]={}),p=s[y][v],p)o.disconnect(p);else try{delete t[v]}catch(w){}return a?s[y][v]=o.connect(t,v,a):t[v]=null,t}return t[v]=a,t}})},"dojo/dom-construct":function(){define("exports ./_base/kernel ./sniff ./_base/window ./dom ./dom-attr".split(" "),function(n,t,i,r,u,f){function s(n,t){var i=t.parentNode;i&&i.insertBefore(n,t)}function h(n){if("innerHTML"in n)try{n.innerHTML="";return}catch(i){}for(var t;t=n.lastChild;)n.removeChild(t)}var e={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},p=/<\s*([\w\:]+)/,c={},w=0,l="__"+t._scopeName+"ToDomId",o,a,v,y;for(o in e)e.hasOwnProperty(o)&&(t=e[o],t.pre="option"==o?'<select multiple="multiple">':"<"+t.join("><")+">",t.post="<\/"+t.reverse().join("><\/")+">");8>=i("ie")&&(a=function(n){n.__dojo_html5_tested="yes";var t=v("div",{innerHTML:"<nav>a<\/nav>",style:{visibility:"hidden"}},n.body);1!==t.childNodes.length&&"abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\b\w+\b/g,function(t){n.createElement(t)});y(t)});n.toDom=function(n,t){var u;t=t||r.doc;u=t[l];u||(t[l]=u=++w+"",c[u]=t.createElement("div"));8>=i("ie")&&!t.__dojo_html5_tested&&t.body&&a(t);n+="";var f=n.match(p),o=f?f[1].toLowerCase():"",u=c[u];if(f&&e[o])for(f=e[o],u.innerHTML=f.pre+n+f.post,f=f.length;f;--f)u=u.firstChild;else u.innerHTML=n;if(1==u.childNodes.length)return u.removeChild(u.firstChild);for(o=t.createDocumentFragment();f=u.firstChild;)o.appendChild(f);return o};n.place=function(t,i,r){if(i=u.byId(i),"string"==typeof t&&(t=/^\s*</.test(t)?n.toDom(t,i.ownerDocument):u.byId(t)),"number"==typeof r){var f=i.childNodes;!f.length||f.length<=r?i.appendChild(t):s(t,f[0>r?0:r])}else switch(r){case"before":s(t,i);break;case"after":r=t;(f=i.parentNode)&&(f.lastChild==i?f.appendChild(r):f.insertBefore(r,i.nextSibling));break;case"replace":i.parentNode.replaceChild(t,i);break;case"only":n.empty(i);i.appendChild(t);break;case"first":if(i.firstChild){s(t,i.firstChild);break}default:i.appendChild(t)}return t};v=n.create=function(t,i,e,o){var s=r.doc;return e&&(e=u.byId(e),s=e.ownerDocument),"string"==typeof t&&(t=s.createElement(t)),i&&f.set(t,i),e&&n.place(t,e,o),t};n.empty=function(n){h(u.byId(n))};y=n.destroy=function(n){if(n=u.byId(n)){var t=n;n=n.parentNode;t.firstChild&&h(t);n&&(i("ie")&&n.canHaveChildren&&"removeNode"in t?t.removeNode(!1):n.removeChild(t))}}})},"dojo/dom-class":function(){define(["./_base/lang","./_base/array","./dom"],function(n,t,i){function f(n){return"string"==typeof n||n instanceof String?n&&!e.test(n)?(o[0]=n,o):(n=n.split(e),n.length&&!n[0]&&n.shift(),n.length&&!n[n.length-1]&&n.pop(),n):n?t.filter(n,function(n){return n}):[]}var r,e=/\s+/,o=[""],u={};return r={contains:function(n,t){return 0<=(" "+i.byId(n).className+" ").indexOf(" "+t+" ")},add:function(n,t){var o,r,u,s,e;for(n=i.byId(n),t=f(t),r=n.className,r=r?" "+r+" ":" ",o=r.length,u=0,s=t.length;u<s;++u)(e=t[u])&&0>r.indexOf(" "+e+" ")&&(r+=e+" ");o<r.length&&(n.className=r.substr(1,r.length-2))},remove:function(t,r){var u,e,o;if(t=i.byId(t),void 0!==r){for(r=f(r),u=" "+t.className+" ",e=0,o=r.length;e<o;++e)u=u.replace(" "+r[e]+" "," ");u=n.trim(u)}else u="";t.className!=u&&(t.className=u)},replace:function(n,t,f){n=i.byId(n);u.className=n.className;r.remove(u,f);r.add(u,t);n.className!==u.className&&(n.className=u.className)},toggle:function(n,t,u){if(n=i.byId(n),void 0===u){t=f(t);for(var e=0,s=t.length,o;e<s;++e)o=t[e],r[r.contains(n,o)?"remove":"add"](n,o)}else r[u?"add":"remove"](n,t);return u}}})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(n,t,i){t=t.NodeList;var r=t.prototype;return r.connect=t._adaptAsForEach(function(){return n.connect.apply(this,arguments)}),r.coords=t._adaptAsMap(n.coords),t.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" "),i.forEach(t.events,function(n){var t="on"+n;r[t]=function(n,i){return this.connect(t,n,i)}}),n.NodeList=t})},"dojo/query":function(){define("./_base/kernel ./has ./dom ./on ./_base/array ./_base/lang ./selector/_loader ./selector/_loader!default".split(" "),function(n,t,i,r,u,f,e,o){function p(n,t){var r=function(r,u){if("string"==typeof u&&(u=i.byId(u),!u))return new t([]);var f="string"==typeof r?n(r,u):r?r.end&&r.on?r:[r]:[];return f.end&&f.on?f:new t(f)},f;return r.matches=n.match||function(n,t,i){return 0<r.filter([n],t,i).length},r.filter=n.filter||function(n,t,i){return r(t,i).filter(function(t){return-1<u.indexOf(n,t)})},"function"!=typeof n&&(f=n.search,n=function(n,t){return f(t||document,n)}),r}var c;t.add("array-extensible",function(){return 1==f.delegate([],{length:1}).length&&!t("bug-for-in-skips-shadowed")});var w=Array.prototype,l=w.slice,b=w.concat,a=u.forEach,v=function(t,i,r){return i=[0].concat(l.call(i,0)),r=r||n.global,function(n){return i[0]=n,t.apply(r,i)}},h=function(n){var e=this instanceof s&&t("array-extensible"),i;if("number"==typeof n&&(n=Array(n)),i=n&&"length"in n?n:arguments,e||!i.sort){for(var r=e?this:[],o=r.length=i.length,u=0;u<o;u++)r[u]=i[u];if(e)return r;i=r}return f._mixin(i,y),i._NodeListCtor=function(n){return s(n)},i},s=h,y=s.prototype=t("array-extensible")?[]:{};return s._wrap=y._wrap=function(n,t,i){return n=new(i||this._NodeListCtor||s)(n),t?n._stash(t):n},s._adaptAsMap=function(n,t){return function(){return this.map(v(n,arguments,t))}},s._adaptAsForEach=function(n,t){return function(){return this.forEach(v(n,arguments,t)),this}},s._adaptAsFilter=function(n,t){return function(){return this.filter(v(n,arguments,t))}},s._adaptWithCondition=function(t,i,r){return function(){var u=arguments,f=v(t,u,r);return i.call(r||n.global,u)?this.map(f):(this.forEach(f),this)}},a(["slice","splice"],function(n){var t=w[n];y[n]=function(){return this._wrap(t.apply(this,arguments),"slice"==n?this:null)}}),a(["indexOf","lastIndexOf","every","some"],function(t){var i=u[t];y[t]=function(){return i.apply(n,[this].concat(l.call(arguments,0)))}}),f.extend(h,{constructor:s,_NodeListCtor:s,toString:function(){return this.join(",")},_stash:function(n){return this._parent=n,this},on:function(n,t){var i=this.map(function(i){return r(i,n,t)});return i.remove=function(){for(var n=0;n<i.length;n++)i[n].remove()},i},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},concat:function(){var n=l.call(this,0),t=u.map(arguments,function(n){return l.call(n,0)});return this._wrap(b.apply(n,t),this)},map:function(n,t){return this._wrap(u.map(this,n,t),this)},forEach:function(n,t){return a(this,n,t),this},filter:function(n){var t=arguments,i=this,r=0;if("string"==typeof n){if(i=c._filterResult(this,t[0]),1==t.length)return i._stash(this);r=1}return this._wrap(u.filter(i,t[r],t[r+1]),this)},instantiate:function(n,t){var i=f.isFunction(n)?n:f.getObject(n);return t=t||{},this.forEach(function(n){new i(t,n)})},at:function(){var n=new this._NodeListCtor(0);return a(arguments,function(t){0>t&&(t=this.length+t);this[t]&&n.push(this[t])},this),n._stash(this)}}),c=p(o,h),n.query=p(o,function(n){return h(n)}),c.load=function(n,t,i){e.load(n,t,function(n){i(p(n,h))})},n._filterQueryResult=c._filterResult=function(n,t,i){return new h(c.filter(n,t,i))},n.NodeList=c.NodeList=h,c})},"dojo/selector/acme":function(){define(["../dom","../sniff","../_base/array","../_base/lang","../_base/window"],function(n,t,i,r,u){var nt=r.trim,k=i.forEach,tt="BackCompat"==u.doc.compatMode,f=!1,l=function(){return!0},d=function(n){n=0<=">~+".indexOf(n.slice(-1))?n+" * ":n+" ";for(var e=function(t,i){return nt(n.slice(t,i))},h=[],o=-1,y=-1,c=-1,s=-1,p=-1,w=-1,l=-1,b,a="",r="",k,i=0,d=n.length,t=null,u=null,v=function(){if(0<=w&&(t.id=e(w,i).replace(/\\/g,""),w=-1),0<=l){var n=l==i?null:e(l,i);t[0>">~+".indexOf(n)?"tag":"oper"]=n;l=-1}0<=p&&(t.classes.push(e(p+1,i).replace(/\\/g,"")),p=-1)};a=r,r=n.charAt(i),i<d;i++)"\\"!=a&&(t||(k=i,t={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return f?this.otag:this.tag}},l=i),b?r==b&&(b=null):"'"==r||'"'==r?b=r:0<=o?"]"==r?(u.attr?u.matchFor=e(c||o+1,i):u.attr=e(o+1,i),!(o=u.matchFor)||'"'!=o.charAt(0)&&"'"!=o.charAt(0)||(u.matchFor=o.slice(1,-1)),u.matchFor&&(u.matchFor=u.matchFor.replace(/\\/g,"")),t.attrs.push(u),u=null,o=c=-1):"="==r&&(c=0<="|~^$*".indexOf(a)?a:"",u.type=c+r,u.attr=e(o+1,i-c.length),c=i+1):0<=y?")"==r&&(0<=s&&(u.value=e(y+1,i)),s=y=-1):"#"==r?(v(),w=i+1):"."==r?(v(),p=i):":"==r?(v(),s=i):"["==r?(v(),o=i,u={}):"("==r?(0<=s&&(u={name:e(s+1,i),value:null},t.pseudos.push(u)),y=i):" "==r&&a!=r&&(v(),0<=s&&t.pseudos.push({name:e(s+1,i)}),t.loops=t.pseudos.length||t.attrs.length||t.classes.length,t.oquery=t.query=e(k,i),t.otag=t.tag=t.oper?null:t.tag||"*",t.tag&&(t.tag=t.tag.toUpperCase()),h.length&&h[h.length-1].oper&&(t.infixOper=h.pop(),t.query=t.infixOper.query+" "+t.query),h.push(t),t=null));return h},s=function(n,t){return n?t?function(){return n.apply(window,arguments)&&t.apply(window,arguments)}:n:t},a=function(n,t){var i=t||[];return n&&i.push(n),i},p=function(n){return 1==n.nodeType},h=function(n,t){return n?"class"==t?n.className||"":"for"==t?n.htmlFor||"":"style"==t?n.style.cssText||"":(f?n.getAttribute(t):n.getAttribute(t,2))||"":""},it={"*=":function(n,t){return function(i){return 0<=h(i,n).indexOf(t)}},"^=":function(n,t){return function(i){return 0==h(i,n).indexOf(t)}},"$=":function(n,t){return function(i){i=" "+h(i,n);var r=i.lastIndexOf(t);return-1<r&&r==i.length-t.length}},"~=":function(n,t){var i=" "+t+" ";return function(t){return 0<=(" "+h(t,n)+" ").indexOf(i)}},"|=":function(n,t){var i=t+"-";return function(r){return r=h(r,n),r==t||0==r.indexOf(i)}},"=":function(n,t){return function(i){return h(i,n)==t}}};r=u.doc.documentElement;var w=!(r.nextElementSibling||"nextElementSibling"in r),v=w?"nextSibling":"nextElementSibling",pt=w?"previousSibling":"previousElementSibling",y=w?p:l,rt=function(n){for(;n=n[pt];)if(y(n))return!1;return!0},ut=function(n){for(;n=n[v];)if(y(n))return!1;return!0},b=function(n){var i=n.parentNode,i=7!=i.nodeType?i:i.nextSibling,f=0,r=i.children||i.childNodes,u=n._i||n.getAttribute("_i")||-1,e=i._l||("undefined"!=typeof i.getAttribute?i.getAttribute("_l"):-1);if(!r)return-1;if(r=r.length,e==r&&0<=u&&0<=e)return u;for(t("ie")&&"undefined"!=typeof i.setAttribute?i.setAttribute("_l",r):i._l=r,u=-1,i=i.firstElementChild||i.firstChild;i;i=i[v])y(i)&&(t("ie")?i.setAttribute("_i",++f):i._i=++f,n===i&&(u=f));return u},wt=function(n){return!(b(n)%2)},bt=function(n){return b(n)%2},ft={checked:function(){return function(n){return!("checked"in n?!n.checked:!n.selected)}},disabled:function(){return function(n){return n.disabled}},enabled:function(){return function(n){return!n.disabled}},"first-child":function(){return rt},"last-child":function(){return ut},"only-child":function(){return function(n){return rt(n)&&ut(n)}},empty:function(){return function(n){var i=n.childNodes,t;for(n=n.childNodes.length-1;0<=n;n--)if(t=i[n].nodeType,1===t||3==t)return!1;return!0}},contains:function(n,t){var i=t.charAt(0);return('"'==i||"'"==i)&&(t=t.slice(1,-1)),function(n){return 0<=n.innerHTML.indexOf(t)}},not:function(n,t){var i=d(t)[0],r={el:1},u;return"*"!=i.tag&&(r.tag=1),i.classes.length||(r.classes=1),u=e(i,r),function(n){return!u(n)}},"nth-child":function(n,t){var f=parseInt,s;if("odd"==t)return bt;if("even"==t)return wt;if(-1!=t.indexOf("n")){var u=t.split("n",2),r=u[0]?"-"==u[0]?-1:f(u[0]):1,i=u[1]?f(u[1]):0,o=0,e=-1;if(0<r?0>i?i=i%r&&r+i%r:0<i&&(i>=r&&(o=i-i%r),i%=r):0>r&&(r*=-1,0<i&&(e=i,i%=r)),0<r)return function(n){return n=b(n),n>=o&&(0>e||n<=e)&&n%r==i};t=i}return s=f(t),function(n){return b(n)==s}}},kt=9>t("ie")||9==t("ie")&&t("quirks")?function(n){var t=n.toLowerCase();return"class"==t&&(n="className"),function(i){return f?i.getAttribute(n):i[n]||i[t]}}:function(n){return function(t){return t&&t.getAttribute&&t.hasAttribute(n)}},e=function(n,t){if(!n)return l;t=t||{};var i=null;return"el"in t||(i=s(i,p)),"tag"in t||"*"!=n.tag&&(i=s(i,function(t){return t&&(f?t.tagName:t.tagName.toUpperCase())==n.getTag()})),"classes"in t||k(n.classes,function(n,t){var r=new RegExp("(?:^|\\s)"+n+"(?:\\s|$)");i=s(i,function(n){return r.test(n.className)});i.count=t}),"pseudos"in t||k(n.pseudos,function(n){var t=n.name;ft[t]&&(i=s(i,ft[t](t,n.value)))}),"attrs"in t||k(n.attrs,function(n){var t,r=n.attr;n.type&&it[n.type]?t=it[n.type](r,n.matchFor):r.length&&(t=kt(r));t&&(i=s(i,t))}),"id"in t||n.id&&(i=s(i,function(t){return!!t&&t.id==n.id})),i||"default"in t||(i=l),i},dt=function(n){return function(t,i,r){for(;t=t[v];)if(!w||p(t)){(!r||c(t,r))&&n(t)&&i.push(t);break}return i}},gt=function(n){return function(t,i,r){for(t=t[v];t;){if(y(t)){if(r&&!c(t,r))break;n(t)&&i.push(t)}t=t[v]}return i}},et=function(n,t){var r=function(n){var i=[],t,r;try{i=Array.prototype.slice.call(n)}catch(u){for(t=0,r=n.length;t<r;t++)i.push(n[t])}return i};return n=n||l,function(u,f,e){var s=0,o=[],o=r(u.children||u.childNodes);for(t&&i.forEach(o,function(n){1===n.nodeType&&(o=o.concat(r(n.getElementsByTagName("*"))))});u=o[s++];)y(u)&&(!e||c(u,e))&&n(u,s)&&f.push(u);return f}},ot=function(n,t){for(var i=n.parentNode;i&&i!=t;)i=i.parentNode;return!!i},st={},ht=function(t){var r=st[t.query];if(r)return r;var o=t.infixOper,o=o?o.oper:"",f=e(t,{el:1}),h="*"==t.tag,s=u.doc.getElementsByClassName;if(o)s={el:1},h&&(s.tag=1),f=e(t,s),"+"==o?r=dt(f):"~"==o?r=gt(f):">"==o&&(r=et(f));else if(t.id)f=!t.loops&&h?l:e(t,{el:1,id:1}),r=function(r,u){var e=n.byId(t.id,r.ownerDocument||r);return r.ownerDocument&&!ot(r,r.ownerDocument)&&i.some(11===r.nodeType?r.childNodes:[r],function(n){return n=et(function(n){return n.id===t.id},!0)(n,[]),n.length?(e=n[0],!1):void 0}),e&&f(e)&&(9==r.nodeType||ot(e,r))?a(e,u):void 0};else if(s&&/\{\s*\[native code\]\s*\}/.test(String(s))&&t.classes.length&&!tt)var f=e(t,{el:1,classes:1,id:1}),v=t.classes.join(" "),r=function(n,t,i){t=a(0,t);for(var r,u=0,e=n.getElementsByClassName(v);r=e[u++];)f(r,n)&&c(r,i)&&t.push(r);return t};else h||t.loops?(f=e(t,{el:1,tag:1,id:1}),r=function(n,i,r){i=a(0,i);for(var u,e=0,o=(u=t.getTag())?n.getElementsByTagName(u):[];u=o[e++];)f(u,n)&&c(u,r)&&i.push(u);return i}):r=function(n,i,r){i=a(0,i);for(var f=0,u=t.getTag(),u=u?n.getElementsByTagName(u):[];n=u[f++];)c(n,r)&&i.push(n);return i};return st[t.query]=r},ct={},lt={},at=function(n){var t=d(nt(n)),i;return 1==t.length?(i=ht(t[0]),function(n){return(n=i(n,[]))&&(n.nozip=!0),n}):function(n){var r,u,o,s,i,f,e;for(n=a(n),o=t.length,f=0;f<o;f++){for(i=[],r=t[f],u=n.length-1,0<u&&(s={},i.nozip=!0),u=ht(r),e=0;r=n[e];e++)u(r,i,s);if(!i.length)break;n=i}return i}},ni=t("ie")?"commentStrip":"nozip",vt=!!u.doc.querySelectorAll,ti=/\\[>~+]|n\+\d|([^ \\])?([>~+])([^ =])?/g,ii=function(n,t,i,r){return i?(t?t+" ":"")+i+(r?" "+r:""):n},ri=/([^[]*)([^\]]*])?/g,ui=function(n,t,i){return t.replace(ti,ii)+(i||"")},yt=function(n,i){var r,u,f,e;return(n=n.replace(ri,ui),vt&&(r=lt[n],r&&!i))?r:(r=ct[n])?r:(r=n.charAt(0),u=-1==n.indexOf(" "),0<=n.indexOf("#")&&u&&(i=!0),!vt||i||-1!=">~+".indexOf(r)||t("ie")&&-1!=n.indexOf(":")||tt&&0<=n.indexOf(".")||-1!=n.indexOf(":contains")||-1!=n.indexOf(":checked")||-1!=n.indexOf("|="))?(f=n.match(/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g),ct[n]=2>f.length?at(n):function(n){for(var r=0,t=[],i;i=f[r++];)t=t.concat(at(i)(n));return t}):(e=0<=">~+".indexOf(n.charAt(n.length-1))?n+" *":n,lt[n]=function(t){if(9==t.nodeType||u)try{var i=t.querySelectorAll(e);return i[ni]=!0,i}catch(r){}return yt(n,!0)(t)})},o=0,fi=t("ie")?function(n){return f?n.getAttribute("_uid")||n.setAttribute("_uid",++o)||o:n.uniqueID}:function(n){return n._uid||(n._uid=++o)},c=function(n,t){if(!t)return 1;var i=fi(n);return t[i]?0:t[i]=1},ei=function(n){var u,i,r,e;if(n&&n.nozip)return n;if(!n||!n.length)return[];if(2>n.length)return[n[0]];if(u=[],o++,t("ie")&&f)for(e=o+"",i=0;i<n.length;i++)(r=n[i])&&r.getAttribute("_zipIdx")!=e&&(u.push(r),r.setAttribute("_zipIdx",e));else if(t("ie")&&n.commentStrip)try{for(i=0;i<n.length;i++)(r=n[i])&&p(r)&&u.push(r)}catch(s){}else for(i=0;i<n.length;i++)(r=n[i])&&r._zipIdx!=o&&(u.push(r),r._zipIdx=o);return u},g=function(n,t){t=t||u.doc;f="div"===(t.ownerDocument||t).createElement("div").tagName;var i=yt(n)(t);return i&&i.nozip?i:ei(i)};return g.filter=function(t,r,u){for(var s=[],f=d(r),f=1!=f.length||/[^\w#\.]/.test(r)?function(t){return-1!=i.indexOf(g(r,n.byId(u)),t)}:e(f[0]),h=0,o;o=t[h];h++)f(o)&&s.push(o);return s},g})},"dojo/NodeList-dom":function(){define("./_base/kernel ./query ./_base/array ./_base/lang ./dom-class ./dom-construct ./dom-geometry ./dom-attr ./dom-style".split(" "),function(n,t,i,r,u,f,e,o,s){function l(n){return function(t,i,r){return 2==arguments.length?n["string"==typeof i?"get":"set"](t,i):n.set(t,i,r)}}var a=function(n){return 1==n.length&&"string"==typeof n[0]},p=function(n){var t=n.parentNode;t&&t.removeChild(n)},h=t.NodeList,v=h._adaptWithCondition,c=h._adaptAsForEach,y=h._adaptAsMap;return r.extend(h,{_normalize:function(t,i){var e=!0===t.parse,u;return"string"==typeof t.template&&(u=t.templateFunc||n.string&&n.string.substitute,t=u?u(t.template,t):t),u=typeof t,"string"==u||"number"==u?(t=f.toDom(t,i&&i.ownerDocument),t=11==t.nodeType?r._toArray(t.childNodes):[t]):r.isArrayLike(t)?r.isArray(t)||(t=r._toArray(t)):t=[t],e&&(t._runParse=!0),t},_cloneNode:function(n){return n.cloneNode(!0)},_place:function(t,i,r,u){var e,h,o,s;if(1==i.nodeType||"only"!=r)for(h=t.length,o=h-1;0<=o;o--){if(s=u?this._cloneNode(t[o]):t[o],t._runParse&&n.parser&&n.parser.parse)for(e||(e=i.ownerDocument.createElement("div")),e.appendChild(s),n.parser.parse(e),s=e.firstChild;e.firstChild;)e.removeChild(e.firstChild);o==h-1?f.place(s,i,r):i.parentNode.insertBefore(s,i);i=s}},position:y(e.position),attr:v(l(o),a),style:v(l(s),a),addClass:c(u.add),removeClass:c(u.remove),toggleClass:c(u.toggle),replaceClass:c(u.replace),empty:c(f.empty),removeAttr:c(o.remove),marginBox:y(e.getMarginBox),place:function(n,i){var r=t(n)[0];return this.forEach(function(n){f.place(n,r,i)})},orphan:function(n){return(n?t._filterResult(this,n):this).forEach(p)},adopt:function(n,i){return t(n).place(this[0],i)._stash(this)},query:function(n){if(!n)return this;var i=new h;return this.map(function(r){t(n,r).forEach(function(n){void 0!==n&&i.push(n)})}),i._stash(this)},filter:function(n){var r=arguments,u=this,f=0;if("string"==typeof n){if(u=t._filterResult(this,r[0]),1==r.length)return u._stash(this);f=1}return this._wrap(i.filter(u,r[f],r[f+1]),this)},addContent:function(n,t){n=this._normalize(n,this[0]);for(var i=0,r;r=this[i];i++)n.length?this._place(n,r,t,0<i):f.empty(r);return this}}),h})},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),function(n,t,i,r,u,f,e,o,s){var l=i.mixin,h={},p=h._Line=function(n,t){this.start=n;this.end=t},c,b,y;p.prototype.getValue=function(n){return(this.end-this.start)*n+this.start};c=h.Animation=function(n){l(this,n);i.isArray(this.curve)&&(this.curve=new p(this.curve[0],this.curve[1]))};c.prototype=new r;i.extend(c,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var n=this._percent,t=this.easing;return t?t(n):n},_fire:function(n,i){var r=i||[];if(this[n])if(t.debugAtAllCosts)this[n].apply(this,r);else try{this[n].apply(this,r)}catch(u){console.error("exception in animation handler for:",n);console.error(u)}return this},play:function(n,t){if(this._delayTimer&&this._clearTimer(),t)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);var r=n||this.delay,u=i.hitch(this,"_play",t);return 0<r?(this._delayTimer=setTimeout(u,r),this):(u(),this)},_play:function(n){return this._delayTimer&&this._clearTimer(),this._startTime=(new Date).valueOf(),this._paused&&(this._startTime-=this.duration*this._percent),this._active=!0,this._paused=!1,n=this.curve.getValue(this._getStep()),this._percent||(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[n])),this._fire("onPlay",[n]),this._cycle(),this},pause:function(){return(this._delayTimer&&this._clearTimer(),this._stopTimer(),!this._active)?this:(this._paused=!0,this._fire("onPause",[this.curve.getValue(this._getStep())]),this)},gotoPercent:function(n,t){return this._stopTimer(),this._active=this._paused=!0,this._percent=n,t&&this.play(),this},stop:function(n){return(this._delayTimer&&this._clearTimer(),!this._timer)?this:(this._stopTimer(),n&&(this._percent=1),this._fire("onStop",[this.curve.getValue(this._getStep())]),this._active=this._paused=!1,this)},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var n=(new Date).valueOf(),n=0===this.duration?1:(n-this._startTime)/this.duration;1<=n&&(n=1);this._percent=n;this.easing&&(n=this.easing(n));this._fire("onAnimate",[this.curve.getValue(n)]);1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var a=0,v=null,w={run:function(){}};return i.extend(c,{_startTimer:function(){this._timer||(this._timer=f.after(w,"run",i.hitch(this,"_cycle"),!0),a++);v||(v=setInterval(i.hitch(w,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,a--);0>=a&&(clearInterval(v),v=null,a=0)}}),b=e("ie")?function(n){var t=n.style;t.width.length||"auto"!=s.get(n,"width")||(t.width="auto")}:function(){},h._fade=function(n){n.node=o.byId(n.node);var t=l({properties:{}},n);return n=t.properties.opacity={},n.start="start"in t?t.start:function(){return+s.get(t.node,"opacity")||0},n.end=t.end,n=h.animateProperty(t),f.after(n,"beforeBegin",i.partial(b,t.node),!0),n},h.fadeIn=function(n){return h._fade(l({end:1},n))},h.fadeOut=function(n){return h._fade(l({end:0},n))},h._defaultEasing=function(n){return.5+Math.sin((n+1.5)*Math.PI)/2},y=function(n){var i,t;this._properties=n;for(i in n)t=n[i],t.start instanceof u&&(t.tempColor=new u)},y.prototype.getValue=function(n){var e={},f,t,r;for(f in this._properties)t=this._properties[f],r=t.start,r instanceof u?e[f]=u.blendColors(r,t.end,n,t.tempColor).toCss():i.isArray(r)||(e[f]=(t.end-r)*n+r+("opacity"!=f?t.units||"px":0));return e},h.animateProperty=function(t){var r=t.node=o.byId(t.node);return t.easing||(t.easing=n._defaultEasing),t=new c(t),f.after(t,"beforeBegin",i.hitch(t,function(){var o={},t,f,n,e;for(t in this.properties)f=function(n,t){var i={height:n.offsetHeight,width:n.offsetWidth}[t];return void 0!==i?i:(i=s.get(n,t),"opacity"==t?+i:e?i:parseFloat(i))},("width"==t||"height"==t)&&(this.node.display="block"),n=this.properties[t],i.isFunction(n)&&(n=n(r)),n=o[t]=l({},i.isObject(n)?n:{end:n}),i.isFunction(n.start)&&(n.start=n.start(r)),i.isFunction(n.end)&&(n.end=n.end(r)),e=0<=t.toLowerCase().indexOf("color"),"end"in n?"start"in n||(n.start=f(r,t)):n.end=f(r,t),e?(n.start=new u(n.start),n.end=new u(n.end)):n.start="opacity"==t?+n.start:parseFloat(n.start);this.curve=new y(o)}),!0),f.after(t,"onAnimate",i.hitch(s,"set",t.node),!0),t},h.anim=function(n,t,i,r,u,f){return h.animateProperty({node:n,duration:i||c.prototype.duration,properties:t,easing:r,onEnd:u}).play(f||0)},l(n,h),n._Animation=c,h})},"*noref":1}}),function(){var n=this.require;n({cache:{}});n.async||n(["dojo"]);n.boot&&n.apply(null,n.boot)}();require({cache:{"dojo/fx/Toggler":function(){define(["../_base/lang","../_base/declare","../_base/fx","../aspect"],function(n,t,i,r){return t("dojo.fx.Toggler",null,{node:null,showFunc:i.fadeIn,hideFunc:i.fadeOut,showDuration:200,hideDuration:200,constructor:function(t){n.mixin(this,t);this.node=t.node;this._showArgs=n.mixin({},t);this._showArgs.node=this.node;this._showArgs.duration=this.showDuration;this.showAnim=this.showFunc(this._showArgs);this._hideArgs=n.mixin({},t);this._hideArgs.node=this.node;this._hideArgs.duration=this.hideDuration;this.hideAnim=this.hideFunc(this._hideArgs);r.after(this.showAnim,"beforeBegin",n.hitch(this.hideAnim,"stop",!0),!0);r.after(this.hideAnim,"beforeBegin",n.hitch(this.showAnim,"stop",!0),!0)},show:function(n){return this.showAnim.play(n||0)},hide:function(n){return this.hideAnim.play(n||0)}})})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang","../registry","../main"],function(n,t,i,r,u){var f={};return n.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(n){f[n]=r[n]}),i.mixin(f,{defaultDuration:t.defaultDuration||200}),i.mixin(u,f),u})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],function(n,t,i){var u={},r={},f={length:0,add:function(n){if(r[n.id])throw Error("Tried to register widget with id=="+n.id+" but that id is already registered");r[n.id]=n;this.length++},remove:function(n){r[n]&&(delete r[n],this.length--)},byId:function(n){return"string"==typeof n?r[n]:n},byNode:function(n){return r[n.getAttribute("widgetId")]},toArray:function(){var n=[];for(var t in r)n.push(r[t]);return n},getUniqueId:function(n){var t;do t=n+"_"+(n in u?++u[n]:u[n]=0);while(r[t]);return"dijit"==i._scopeName?t:i._scopeName+"_"+t},findWidgets:function(n,t){function i(n){for(n=n.firstChild;n;n=n.nextSibling)if(1==n.nodeType){var f=n.getAttribute("widgetId");f?(f=r[f])&&u.push(f):n!==t&&i(n)}}var u=[];return i(n),u},_destroyAll:function(){i._curFocus=null;i._prevFocus=null;i._activeStack=[];n.forEach(f.findWidgets(t.body()),function(n){n._destroyed||(n.destroyRecursive?n.destroyRecursive():n.destroy&&n.destroy())})},getEnclosingWidget:function(n){for(;n;){var t=1==n.nodeType&&n.getAttribute("widgetId");if(t)return r[t];n=n.parentNode}return null},_hash:r};return i.registry=f})},"dijit/main":function(){define(["dojo/_base/kernel"],function(n){return n.dijit})},"esri/main":function(){define(["./kernel","dojo/i18n!./nls/jsapi","./config","./sniff"],function(n,t){return n.bundle=t,n})},"esri/kernel":function(){define(["dojo/_base/kernel","dojo/_base/config","dojo/has"],function(n,t,i){var e=function(){return this}(),r=e.location,u=r.pathname,f=r.protocol,r={version:"3.21",_appBaseUrl:f+"//"+r.host+u.substring(0,u.lastIndexOf(u.split("/")[u.split("/").length-1]))};return t.noGlobals||(e.esri=r),n.isAsync||i.add("extend-esri",1),(r.dijit=r.dijit||{})._arcgisUrl=("http:"===f||"https:"===f?f:"http:")+"//www.arcgis.com/sharing/rest",r})},"esri/config":function(){define(["dojo/_base/config","dojo/topic","dojo/has","./kernel"],function(n,t,i,r){var u=function(){return this}(),f={defaults:{screenDPI:96,geometryService:null,kmlService:null,map:{width:400,height:400,layerNamePrefix:"layer",graphicsLayerNamePrefix:"graphicsLayer",slider:{left:"30px",top:"30px",width:null,height:"200px"},sliderLabel:{tick:5,labels:null,style:"width:2em; font-family:Verdana; font-size:75%;"},sliderChangeImmediate:!0,zoomSymbol:{color:[0,0,0,64],outline:{color:[255,0,0,255],width:1.25,style:"esriSLSSolid"},style:"esriSFSSolid"},zoomDuration:500,zoomRate:25,panDuration:350,panRate:25,logoLink:"http://www.esri.com"},autoSpatialIndexing:u.Worker&&!1,io:{errorHandler:function(n){t.publish("esri.Error",[n])},proxyUrl:null,alwaysUseProxy:!1,useCors:"with-credentials",corsEnabledServers:"server.arcgisonline.com services.arcgisonline.com www.arcgis.com js.arcgis.com jsdev.arcgis.com jsqa.arcgis.com tiles.arcgis.com tiles1.arcgis.com tiles2.arcgis.com tiles3.arcgis.com tiles4.arcgis.com basemaps.arcgis.com basemapsbeta.arcgis.com elevation3d.arcgis.com services.arcgis.com services1.arcgis.com services2.arcgis.com services3.arcgis.com services4.arcgis.com services5.arcgis.com services6.arcgis.com services7.arcgis.com static.arcgis.com utility.arcgis.com utility.arcgisonline.com geocode.arcgis.com geoenrich.arcgis.com qaext.arcgis.com staticqa.arcgis.com tilesqa.arcgis.com servicesqa.arcgis.com servicesqa1.arcgis.com servicesqa2.arcgis.com servicesqa3.arcgis.com geocodeqa.arcgis.com geoenrichqa.arcgis.com dev.arcgis.com devext.arcgis.com localvtiles.arcgis.com staticdev.arcgis.com tilesdevext.arcgis.com elevation3ddev.arcgis.com servicesdev.arcgis.com servicesdev1.arcgis.com servicesdev2.arcgis.com servicesdev3.arcgis.com geocodedev.arcgis.com geoenrichdev.arcgis.com basemapsdev.arcgis.com basemapsbetadev.arcgis.com".split(" "),corsDetection:u.cordova?!1:!0,corsDetectionTimeout:15,corsStatus:{},webTierAuthServers:[],proxyRules:[],postLength:2e3,timeout:6e4,useWorkers:"on-request",maxRequestWorkers:5,httpsDomains:"arcgis.com arcgisonline.com esrikr.com premiumservices.blackbridge.com esripremium.accuweather.com gbm.digitalglobe.com firstlook.digitalglobe.com msi.digitalglobe.com".split(" ")},workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}}}};return i("extend-esri")&&(r.config=f),n.noGlobals||(u.esriConfig=f),f})},"esri/sniff":function(){define(["dojo/_base/sniff","./kernel"],function(n,t){var e=function(){return this}(),i=n("ff"),r=n("ie"),l=void 0===r&&7<=n("trident"),a=n("edge"),o=n("webkit"),u=n("opera"),s=n("chrome"),c=n("safari"),h=navigator.userAgent,f;return(f=h.match(/(iPhone|iPad|CPU)\s+OS\s+(\d+\_\d+)/i))&&n.add("esri-iphone",parseFloat(f[2].replace("_","."))),(f=h.match(/Android\s+(\d+\.\d+)/i))&&n.add("esri-android",parseFloat(f[1])),(f=h.match(/Fennec\/(\d+\.\d+)/i))&&n.add("esri-fennec",parseFloat(f[1])),0<=h.indexOf("BlackBerry")&&0<=h.indexOf("WebKit")&&n.add("esri-blackberry",1),n.add("esri-touch",n("esri-iphone")||n("esri-android")||n("esri-blackberry")||6<=n("esri-fennec")||(i||o)&&document.createTouch?!0:!1),(f=h.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i))&&n.add("esri-mobile",f),n.add("esri-pointer",navigator.pointerEnabled||navigator.msPointerEnabled),t._getDOMAccessor=function(n){var t="";return i?t="Moz":o?t="Webkit":r?t="ms":u&&(t="O"),t+n.charAt(0).toUpperCase()+n.substr(1)},n.add("esri-phonegap",!!e.cordova),n.add("esri-cors",n("esri-phonegap")||e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),n.add("esri-file-upload",e.FormData&&e.FileList?!0:!1),n.add("esri-workers",e.Worker?!0:!1),n.add("esri-transforms",l||a||9<=r||3.5<=i||4<=s||3.1<=c||10.5<=u||3.2<=n("esri-iphone")||2.1<=n("esri-android")),n.add("esri-transitions",l||a||10<=r||4<=i||4<=s||3.1<=c||10.5<=u||3.2<=n("esri-iphone")||2.1<=n("esri-android")),n.add("esri-transforms3d",l||a||10<=i||12<=s||4<=c||3.2<=n("esri-iphone")||3<=n("esri-android")),n.add("esri-url-encodes-apostrophe",function(){if(e.document)return!1;var n=e.document.createElement("a");return n.href="?'",-1<n.href.indexOf("?%27")}),3>n("esri-android")&&(n.add("esri-transforms",!1,!1,!0),n.add("esri-transitions",!1,!1,!0),n.add("esri-transforms3d",!1,!1,!0)),n.add("esri-will-change",n("esri-transforms")&&(52<=s||9.1<=c)),t._css=function(t){var f=n("esri-transforms3d");void 0!==t&&null!==t?f=t:f&&(s||c&&!n("esri-iphone"))&&(f=!1);var e=f?"translate3d(":"translate(",h=f?s?",-1px)":",0px)":")",l=f?"scale3d(":"scale(",a=f?",1)":")",v=f?"rotate3d(0,0,1,":"rotate(",y=f?"matrix3d(":"matrix(",p=f?",0,0,":",",w=f?",0,0,0,0,1,0,":",",b=f?",0,1)":")";return{names:{transition:o&&"-webkit-transition"||i&&"MozTransition"||u&&"OTransition"||r&&"msTransition"||"transition",transform:o&&"-webkit-transform"||i&&"MozTransform"||u&&"OTransform"||r&&"msTransform"||"transform",transformName:o&&"-webkit-transform"||i&&"-moz-transform"||u&&"-o-transform"||r&&"-ms-transform"||"transform",origin:o&&"-webkit-transform-origin"||i&&"MozTransformOrigin"||u&&"OTransformOrigin"||r&&"msTransformOrigin"||"transformOrigin",endEvent:o&&"webkitTransitionEnd"||i&&"transitionend"||u&&"oTransitionEnd"||r&&"MSTransitionEnd"||"transitionend"},translate:function(n,t){return e+n+"px,"+t+"px"+h},scale:function(n){return l+n+","+n+a},rotate:function(n){return v+n+"deg)"},matrix:function(n){return y+n.xx+","+n.xy+p+n.yx+","+n.yy+w+n.dx.toFixed(10)+(i?"px,":",")+n.dy.toFixed(10)+(i?"px":"")+b},getScaleFromMatrix:function(n){if(!n)return 1;n=n.toLowerCase();var t=-1<n.indexOf("matrix3d")?"matrix3d(":"matrix(";return Number(n.substring(t.length,n.indexOf(",")))}}},n("extend-esri")&&(t.isiPhone=n("esri-iphone"),t.isAndroid=n("esri-android"),t.isFennec=n("esri-fennec"),t.isBlackBerry=n("esri-blackberry"),t.isTouchEnabled=n("esri-touch"),t.isPointerEnabled=n("esri-pointer"),t._hasCors=n("esri-cors"),t._hasFileUpload=n("esri-file-upload"),t._hasTransforms=n("esri-transforms"),t._hasTransitions=n("esri-transitions"),t._has3DTransforms=n("esri-transforms3d")),n})},"esri/map":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/event dojo/on dojo/aspect dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/a11yclick dijit/registry ./kernel ./config ./sniff ./lang ./_coremap ./MapNavigationManager dojo/i18n!./nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){var ot={up:"panUp",right:"panRight",down:"panDown",left:"panLeft"},ht={upperRight:"panUpperRight",lowerRight:"panLowerRight",lowerLeft:"panLowerLeft",upperLeft:"panUpperLeft"},rt=r.connect,ct=r.disconnect,ut=a.create,ft=y.set,lt=u.hitch,et=v.getMarginBox,at=t.deprecated,st=u.mixin,vt=0;return t=i(nt,{declaredClass:"esri.Map",constructor:function(t,i){var r,e,c,l,h;i=i||{};st(this,{_slider:null,_navDiv:null,_mapParams:st({attributionWidth:.45,slider:!0,nav:!1,logo:!0,sliderStyle:"small",sliderPosition:"top-left",sliderOrientation:"vertical",autoResize:!0},i)});st(this,{isMapNavigation:null!=i.isMapNavigation?i.isMapNavigation:!0,isDoubleClickZoom:null!=i.isDoubleClickZoom?i.isDoubleClickZoom:!0,isClickRecenter:null!=i.isClickRecenter?i.isClickRecenter:!0,isPan:null!=i.isPan?i.isPan:!0,isRubberBandZoom:null!=i.isRubberBandZoom?i.isRubberBandZoom:!0,isPinchZoom:null!=i.isPinchZoom?i.isPinchZoom:!0,isKeyboardNavigation:null!=i.isKeyboardNavigation?i.isKeyboardNavigation:!0,isScrollWheel:null!=i.isScrollWheel?i.isScrollWheel:!0,isShiftDoubleClickZoom:!1,isScrollWheelZoom:!1,isPanArrows:!1,isZoomSlider:!1});u.isFunction(b._css)&&(b._css=b._css(this._mapParams.force3DTransforms),this.force3DTransforms=this._mapParams.force3DTransforms);r=d("esri-transforms")&&d("esri-transitions");this.navigationMode=this._mapParams.navigationMode||r&&"css-transforms"||"classic";"css-transforms"!==this.navigationMode||r||(this.navigationMode="classic");this.fadeOnZoom=g.isDefined(this._mapParams.fadeOnZoom)?this._mapParams.fadeOnZoom:"css-transforms"===this.navigationMode;"css-transforms"!==this.navigationMode&&(this.fadeOnZoom=!1);this.setMapCursor("default");this.smartNavigation=i&&i.smartNavigation;g.isDefined(this.smartNavigation)||!d("mac")||d("esri-touch")||d("esri-pointer")||3.5>=d("ff")||(e=navigator.userAgent.match(/Mac\s+OS\s+X\s+([\d]+)(\.|\_)([\d]+)\D/i),e&&g.isDefined(e[1])&&g.isDefined(e[3])&&(r=parseInt(e[1],10),e=parseInt(e[3],10),this.smartNavigation=10<r||10===r&&6<=e));r=!0;r=!1;this.showAttribution=g.isDefined(this._mapParams.showAttribution)?this._mapParams.showAttribution:r;this._onLoadHandler_connect=rt(this,"onLoad",this,"_onLoadInitNavsHandler");c=ut("div",{"class":"esriControlsBR"+(this._mapParams.nav?" withPanArrows":"")},this.root);this.showAttribution&&((r=u.getObject("esri.dijit.Attribution",!1))?this._initAttribution(r,c):(l=vt++,h=this,this._rids&&this._rids.push(l),n(["./dijit/Attribution"],function(n){var t=h._rids?f.indexOf(h._rids,l):-1;-1!==t&&(h._rids.splice(t,1),h._initAttribution(n,c))})));this._mapParams.logo&&(r={},6===d("ie")&&(r.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+n.toUrl("./images/map/logo-med.png")+"')"),this._ogol=ut("div",{style:r,tabIndex:"0",title:"Esri"},c),this._setLogoSize(),this._onMapResizeLogo_connect=rt(this,"onResize",this,"_setLogoSize"),this._ogol_connect=rt(this._ogol,p,this,"_openLogoLink"));this.navigationManager=new tt(this);i&&i.basemap&&(this._onLoadFix=!0,this.setBasemap(i.basemap),this._onLoadFix=!1);(this.autoResize=this._mapParams.autoResize)&&(r=this._getEnclosingResizableWidget(this.container)||window,e=this.resize,this._rszSignal=o.pausable(r,"resize",e),this._oriSignal=o.pausable(window,"orientationchange",e),s.after(r,"resize",e,!0),this._startResizeTimer())},_startResizeTimer:function(){clearTimeout(this._persistentTimer);this._persistentTimer=setTimeout(this._timedResize,2*this.resizeDelay)},_getEnclosingResizableWidget:function(n){var t=w.getEnclosingWidget(n);return t?t.resize?t:this._getEnclosingResizableWidget(n.parentNode):t},_setLogoSize:function(){this._ogol&&(25e4>this.root.clientWidth*this.root.clientHeight?(l.remove(this._ogol,"logo-med"),l.add(this._ogol,"logo-sm")):(l.remove(this._ogol,"logo-sm"),l.add(this._ogol,"logo-med")))},_initAttribution:function(n,t){var i=ut("span",{"class":"esriAttribution"},t,"first");ft(i,"maxWidth",Math.floor(this.width*this._mapParams.attributionWidth)+"px");this._connects.push(rt(i,p,function(){l.contains(this,"esriAttributionOpen")?l.remove(this,"esriAttributionOpen"):this.scrollWidth>this.clientWidth&&l.add(this,"esriAttributionOpen")}));this.attribution=new n({map:this},i)},_cleanUp:function(){var n,t;this.disableMapNavigation();this.navigationManager.destroy();n=this._slider;n&&n.destroy&&!n._destroyed&&n.destroy();n=this._navDiv;t=this.attribution;n&&a.destroy(n);t&&t.destroy();this._connects.push(this._slider_connect,this._ogol_connect,this._rszSignal,this._oriSignal);f.forEach(this._connects,ct);clearInterval(this._persistentTimer);this.attribution=this.navigationManager=this._rids=this._connects=this._slider_connect=this._ogol_connect=this._rszSignal=this._oriSignal=this._persistentTimer=null;this.inherited("_cleanUp",arguments)},_isPanningOrZooming:function(){return this.__panning||this.__zooming},_canZoom:function(n){var t=this.getLevel();return!this.__tileInfo||!(t===this.getMinZoom()&&0>n||t===this.getMaxZoom()&&0<n)},_onLoadInitNavsHandler:function(){var t;if(this._evalMapNavigation(),this._createNav(),"small"!==this._mapParams.sliderStyle&&this._createSlider){if(this._mapParams.slider)if(t=-1!==this._getSliderClass(!0).indexOf("Horizontal"),t=[t?"dijit.form.HorizontalSlider":"dijit.form.VerticalSlider",t?"dijit.form.HorizontalRule":"dijit.form.VerticalRule",t?"dijit.form.HorizontalRuleLabels":"dijit.form.VerticalRuleLabels"],f.some(t,function(n){return!u.getObject(n,!1)})){var t=f.map(t,function(n){return n.replace(/\./g,"/")}),r=vt++,i=this;this._rids&&this._rids.push(r);n(t,function(){var n=i._rids?f.indexOf(i._rids,r):-1;-1!==n&&(i._rids.splice(n,1),i._createSlider.apply(i,arguments))})}else t=f.map(t,function(n){return u.getObject(n,!1)}),this._createSlider.apply(this,t)}else this._createSimpleSlider();ct(this._onLoadHandler_connect)},_createNav:function(){var n,i,t,r,u,e,o,f;if(this._mapParams.nav){r=l.add;u=this.id;this._navDiv=ut("div",{id:u+"_navdiv"},this.root);r(this._navDiv,"navDiv");e=this.width/2;o=this.height/2;for(t in ot)i=ot[t],n=ut("div",{id:u+"_pan_"+t},this._navDiv),r(n,"fixedPan "+i),"up"===t||"down"===t?(f=parseInt(et(n).w,10)/2,ft(n,{left:e-f+"px",zIndex:30})):(f=parseInt(et(n).h,10)/2,ft(n,{top:o-f+"px",zIndex:30})),this._connects.push(rt(n,"onclick",lt(this,this[i])));this._onMapResizeNavHandler_connect=rt(this,"onResize",this,"_onMapResizeNavHandler");for(t in ht)i=ht[t],n=ut("div",{id:u+"_pan_"+t,style:{zIndex:30}},this._navDiv),r(n,"fixedPan "+i),this._connects.push(rt(n,"onclick",lt(this,this[i])));this.isPanArrows=!0}},_onMapResizeNavHandler:function(n,t,i){n=this.id;t/=2;i/=2;var e=h.byId,u,r,f;for(u in ot)r=e(n+"_pan_"+u),"up"===u||"down"===u?(f=parseInt(et(r).w,10)/2,ft(r,"left",t-f+"px")):(f=parseInt(et(r).h,10)/2,ft(r,"top",i-f+"px"))},_createSimpleSlider:function(){var r;if(this._mapParams.slider){var t=this._slider=ut("div",{id:this.id+"_zoom_slider","class":this._getSliderClass(),style:{zIndex:30}}),i=ut("div",{"class":"esriSimpleSliderIncrementButton",tabIndex:"0",role:"button"},t),n=ut("div",{"class":"esriSimpleSliderDecrementButton",tabIndex:"0",role:"button"},t);this._addZoomButtonTooltips(i,n);this._incButton=i;this._decButton=n;this._simpleSliderZoomHandler(null,null,null,this.getLevel());r=it.widgets.zoomSlider;this._addZoomButtonIcon(i,"+",r.zoomIn);this._addZoomButtonIcon(n,"&minus;",r.zoomOut);8>d("ie")&&l.add(n,"dj_ie67Fix");this._connects.push(rt(i,p,this,this._simpleSliderChangeHandler));this._connects.push(rt(n,p,this,this._simpleSliderChangeHandler));(-1<this.getMaxZoom()||-1<this.getMinZoom())&&this._connects.push(rt(this,"onZoomEnd",this,this._simpleSliderZoomHandler));10>d("ie")&&h.setSelectable(t,!1);this.root.appendChild(t);this.isZoomSlider=!0}},_simpleSliderChangeHandler:function(n){e.stop(n);n=-1!==n.currentTarget.className.indexOf("IncrementButton")?!0:!1;this._extentUtil({numLevels:n?1:-1})},_simpleSliderZoomHandler:function(n,t,i,r){var u;n=this._incButton;t=this._decButton;-1<r&&r===this.getMaxZoom()?u=n:-1<r&&r===this.getMinZoom()&&(u=t);u?(l.add(u,"esriSimpleSliderDisabledButton"),l.remove(u===n?t:n,"esriSimpleSliderDisabledButton")):(l.remove(n,"esriSimpleSliderDisabledButton"),l.remove(t,"esriSimpleSliderDisabledButton"))},_getSliderClass:function(n){n=n?"Large":"Simple";var i=this._mapParams.sliderOrientation,t=this._mapParams.sliderPosition||"",i=i&&"horizontal"===i.toLowerCase()?"esri"+n+"SliderHorizontal":"esri"+n+"SliderVertical";if(t)switch(t.toLowerCase()){case"top-left":t="esri"+n+"SliderTL";break;case"top-right":t="esri"+n+"SliderTR";break;case"bottom-left":t="esri"+n+"SliderBL";break;case"bottom-right":t="esri"+n+"SliderBR"}return"esri"+n+"Slider "+i+" "+t},_addZoomButtonIcon:function(n,t,i){a.create("span",{"aria-hidden":"true",role:"presentation",innerHTML:t},n);a.create("span",{"class":"esriIconFallbackText",innerHTML:i},n)},_addZoomButtonTooltips:function(n,t){var i=it.widgets.zoomSlider;c.set(n,"title",i.zoomIn);c.set(t,"title",i.zoomOut)},_openLogoLink:function(n){window.open(k.defaults.map.logoLink,"_blank");e.stop(n)},enableMapNavigation:function(){this.isMapNavigation||(this.isMapNavigation=!0,this._evalMapNavigation())},disableMapNavigation:function(){this.isMapNavigation&&(this.isMapNavigation=!1,this._evalMapNavigation())},_evalMapNavigation:function(){this.isMapNavigation?this.navigationManager.enableNavigation():this.navigationManager.disableNavigation()},_evalNavigationFeature:function(n){this.isMapNavigation&&this["is"+n]?this.navigationManager["enable"+n]():this.navigationManager["disable"+n]()},enableDoubleClickZoom:function(){this.isDoubleClickZoom||(this.isDoubleClickZoom=!0,this._evalNavigationFeature("DoubleClickZoom"))},disableDoubleClickZoom:function(){this.isDoubleClickZoom&&(this.isDoubleClickZoom=!1,this._evalNavigationFeature("DoubleClickZoom"))},enableShiftDoubleClickZoom:function(){this.isShiftDoubleClickZoom||(at(this.declaredClass+": Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",null,"v2.0"),this.navigationManager.enableShiftDoubleClickZoom(),this.isShiftDoubleClickZoom=!0)},disableShiftDoubleClickZoom:function(){this.isShiftDoubleClickZoom&&(at(this.declaredClass+": Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",null,"v2.0"),this.navigationManager.disableShiftDoubleClickZoom(),this.isShiftDoubleClickZoom=!1)},enableClickRecenter:function(){this.isClickRecenter||(this.isClickRecenter=!0,this._evalNavigationFeature("ClickRecenter"))},disableClickRecenter:function(){this.isClickRecenter&&(this.isClickRecenter=!1,this._evalNavigationFeature("ClickRecenter"))},enablePan:function(){this.isPan||(this.isPan=!0,this._evalNavigationFeature("Pan"))},disablePan:function(){this.isPan&&(this.isPan=!1,this._evalNavigationFeature("Pan"))},enableRubberBandZoom:function(){this.isRubberBandZoom||(this.isRubberBandZoom=!0,this._evalNavigationFeature("RubberBandZoom"))},disableRubberBandZoom:function(){this.isRubberBandZoom&&(this.isRubberBandZoom=!1,this._evalNavigationFeature("RubberBandZoom"))},enablePinchZoom:function(){this.isPinchZoom||(this.isPinchZoom=!0,this._evalNavigationFeature("PinchZoom"))},disablePinchZoom:function(){this.isPinchZoom&&(this.isPinchZoom=!1,this._evalNavigationFeature("PinchZoom"))},enableKeyboardNavigation:function(){this.isKeyboardNavigation||(this.isKeyboardNavigation=!0,this._evalNavigationFeature("KeyboardNavigation"))},disableKeyboardNavigation:function(){this.isKeyboardNavigation&&(this.isKeyboardNavigation=!1,this._evalNavigationFeature("KeyboardNavigation"))},enableScrollWheel:function(){this.isScrollWheel||(this.isScrollWheel=!0,this._evalNavigationFeature("ScrollWheel"))},disableScrollWheel:function(){this.isScrollWheel&&(this.isScrollWheel=!1,this._evalNavigationFeature("ScrollWheel"))},enableScrollWheelZoom:function(){this.isScrollWheelZoom||(this.navigationManager.enableScrollWheelZoom(),this.isScrollWheelZoom=!0)},disableScrollWheelZoom:function(){this.isScrollWheelZoom&&(this.navigationManager.disableScrollWheelZoom(),this.isScrollWheelZoom=!1)},enableScrollWheelPan:function(){this.isScrollWheelPan||this.navigationManager.enableScrollWheelPan()},disableScrollWheelPan:function(){this.isScrollWheelPan&&this.navigationManager.disableScrollWheelPan()},showPanArrows:function(){this._navDiv&&(this._navDiv.style.display="block",this.isPanArrows=!0)},hidePanArrows:function(){this._navDiv&&(this._navDiv.style.display="none",this.isPanArrows=!1)},showZoomSlider:function(){this._slider&&(ft(this._slider.domNode||this._slider,"visibility","inherit"),this.isZoomSlider=!0)},hideZoomSlider:function(){this._slider&&(ft(this._slider.domNode||this._slider,"visibility","hidden"),this.isZoomSlider=!1)}}),d("extend-esri")&&(b.Map=t),t})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(n,t,i,r){function e(t){if((t.keyCode===n.ENTER||t.keyCode===n.SPACE)&&!/input|button|textarea/i.test(t.target.nodeName))for(t=t.target;t;t=t.parentNode)if(t.dojoClick)return!0}var f,u;return i(document,"keydown",function(n){e(n)?(f=n.target,n.preventDefault()):f=null}),i(document,"keyup",function(n){e(n)&&n.target==f&&(f=null,i.emit(n.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,metaKey:n.metaKey,altKey:n.altKey,_origType:n.type}))}),u=function(n,t){return n.dojoClick=!0,i(n,"click",t)},u.click=u,u.press=function(u,f){var e=i(u,r.press,function(n){("mousedown"!=n.type||t.isLeft(n))&&f(n)}),o=i(u,"keydown",function(t){t.keyCode!==n.ENTER&&t.keyCode!==n.SPACE||f(t)});return{remove:function(){e.remove();o.remove()}}},u.release=function(u,f){var e=i(u,r.release,function(n){("mouseup"!=n.type||t.isLeft(n))&&f(n)}),o=i(u,"keyup",function(t){t.keyCode!==n.ENTER&&t.keyCode!==n.SPACE||f(t)});return{remove:function(){e.remove();o.remove()}}},u.move=r.move,u})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(n,t,i,r,u,f,e,o,s,h){function v(n,t,i){return k&&i?function(n,t){return f(n,i,t)}:et?function(i,r){var u=f(i,t,function(n){r.call(this,n);y=(new Date).getTime()}),e=f(i,n,function(n){(!y||(new Date).getTime()>y+1e3)&&r.call(this,n)});return{remove:function(){u.remove();e.remove()}}}:function(t,i){return f(t,n,i)}}function ft(n){do if(void 0!==n.dojoClick)return n;while(n=n.parentNode)}function g(n,t,u){var e,s;o.isRight(n)||(e=ft(n.target),(c=!n.target.disabled&&e&&e.dojoClick)&&((b=(p="useTarget"==c)?e:n.target,p&&n.preventDefault(),tt=n.changedTouches?n.changedTouches[0].pageX-h.global.pageXOffset:n.clientX,it=n.changedTouches?n.changedTouches[0].pageY-h.global.pageYOffset:n.clientY,rt=("object"==typeof c?c.x:"number"==typeof c?c:0)||4,ut=("object"==typeof c?c.y:"number"==typeof c?c:0)||4,nt)||(n=function(n){h.doc.addEventListener(n,function(t){var i=t.target;c&&!t._dojo_click&&(new Date).getTime()<=d+1e3&&("INPUT"!=i.tagName||!r.contains(i,"dijitOffScreen"))&&(t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),"click"==n&&("INPUT"!=i.tagName||"radio"==i.type&&(r.contains(i,"dijitCheckBoxInput")||r.contains(i,"mblRadioButton"))||"checkbox"==i.type&&(r.contains(i,"dijitCheckBoxInput")||r.contains(i,"mblCheckBox")))&&"TEXTAREA"!=i.tagName&&"AUDIO"!=i.tagName&&"VIDEO"!=i.tagName&&t.preventDefault())},!0)},s=function(n){c=p?i.isDescendant(h.doc.elementFromPoint(n.changedTouches?n.changedTouches[0].pageX-h.global.pageXOffset:n.clientX,n.changedTouches?n.changedTouches[0].pageY-h.global.pageYOffset:n.clientY),b):c&&(n.changedTouches?n.changedTouches[0].target:n.target)==b&&Math.abs((n.changedTouches?n.changedTouches[0].pageX-h.global.pageXOffset:n.clientX)-tt)<=rt&&Math.abs((n.changedTouches?n.changedTouches[0].pageY-h.global.pageYOffset:n.clientY)-it)<=ut},nt=!0,h.doc.addEventListener(t,function(n){o.isRight(n)||(s(n),p&&n.preventDefault())},!0),h.doc.addEventListener(u,function(n){var r,t;if(!o.isRight(n)&&(s(n),c)){r=function(t){var i=document.createEvent("MouseEvents");return i._dojo_click=!0,i.initMouseEvent(t,!0,!0,n.view,n.detail,u.screenX,u.screenY,u.clientX,u.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,0,null),i};d=(new Date).getTime();t=p?b:n.target;"LABEL"===t.tagName&&(t=i.byId(t.getAttribute("for"))||t);var u=n.changedTouches?n.changedTouches[0]:n,e=r("mousedown"),h=r("mouseup"),l=r("click");setTimeout(function(){f.emit(t,"mousedown",e);f.emit(t,"mouseup",h);f.emit(t,"click",l);d=(new Date).getTime()},0)}},!0),n("click"),n("mousedown"),n("mouseup"))))}var w=5>e("ios"),k=e("pointer-events")||e("MSPointer"),l=function(){var t={};for(var n in{down:1,move:1,up:1,cancel:1,over:1,out:1})t[n]=e("MSPointer")?"MSPointer"+n.charAt(0).toUpperCase()+n.slice(1):"pointer"+n;return t}(),et=e("touch-events"),nt,c,p=!1,b,tt,it,rt,ut,d,y,a;return e("touch")&&(k?s(function(){h.doc.addEventListener(l.down,function(n){g(n,l.move,l.up)},!0)}):s(function(){function n(n){var t=u.delegate(n,{bubbles:!0});return 6<=e("ios")&&(t.touches=n.touches,t.altKey=n.altKey,t.changedTouches=n.changedTouches,t.ctrlKey=n.ctrlKey,t.metaKey=n.metaKey,t.shiftKey=n.shiftKey,t.targetTouches=n.targetTouches),t}a=h.body();h.doc.addEventListener("touchstart",function(n){y=(new Date).getTime();var t=a;a=n.target;f.emit(t,"dojotouchout",{relatedTarget:a,bubbles:!0});f.emit(a,"dojotouchover",{relatedTarget:t,bubbles:!0});g(n,"touchmove","touchend")},!0);f(h.doc,"touchmove",function(t){y=(new Date).getTime();var i=h.doc.elementFromPoint(t.pageX-(w?0:h.global.pageXOffset),t.pageY-(w?0:h.global.pageYOffset));i&&(a!==i&&(f.emit(a,"dojotouchout",{relatedTarget:i,bubbles:!0}),f.emit(i,"dojotouchover",{relatedTarget:a,bubbles:!0}),a=i),f.emit(i,"dojotouchmove",n(t))||t.preventDefault())});f(h.doc,"touchend",function(t){y=(new Date).getTime();var i=h.doc.elementFromPoint(t.pageX-(w?0:h.global.pageXOffset),t.pageY-(w?0:h.global.pageYOffset))||h.body();f.emit(i,"dojotouchend",n(t))})})),t={press:v("mousedown","touchstart",l.down),move:v("mousemove","dojotouchmove",l.move),release:v("mouseup","dojotouchend",l.up),cancel:v(o.leave,"touchcancel",k?l.cancel:null),over:v("mouseover","dojotouchover",l.over),out:v("mouseout","dojotouchout",l.out),enter:o._eventHandler(v("mouseover","dojotouchover",l.over)),leave:o._eventHandler(v("mouseout","dojotouchout",l.out))},n.touch=t})},"esri/lang":function(){define("dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/_base/lang dojo/date dojo/has dojo/number dojo/date/locale ./kernel".split(" "),function(n,t,i,r,u,f,e,o,s){function v(n,t,u){return[r.isString(n)?n.split(""):n,t||i.global,r.isString(u)?new Function("item","index","array",u):u]}function h(n){return void 0!==n&&null!==n}function l(n){return h(n)?n:""}function c(i,f,s){var c=s.match(/([^\(]+)(\([^\)]+\))?/i),a=r.trim(c[1]),v;if(s=f[i],c=t.fromJson((c[2]?r.trim(c[2]):"()").replace(/^\(/,"({").replace(/\)$/,"})")),v=c.utcOffset,-1===n.indexOf(w,a))a=r.getObject(a),r.isFunction(a)&&(s=a(s,i,f,c));else if("number"==typeof s||"string"==typeof s&&s&&!isNaN(Number(s)))switch(s=Number(s),a){case"NumberFormat":return e.format(s,c);case"DateString":return(i=new Date(s),c.local||c.systemLocale)?c.systemLocale?i.toLocaleDateString()+(c.hideTime?"":" "+i.toLocaleTimeString()):i.toDateString()+(c.hideTime?"":" "+i.toTimeString()):(i=i.toUTCString(),c.hideTime&&(i=i.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,"")),i);case"DateFormat":return i=new Date(s),h(v)&&(i=u.add(i,"minute",i.getTimezoneOffset()-v)),o.format(i,c)}return l(s)}function a(n,t){var i;if(t)for(i in n)n.hasOwnProperty(i)&&(void 0===n[i]?delete n[i]:n[i]instanceof Object&&a(n[i],!0));else for(i in n)n.hasOwnProperty(i)&&void 0===n[i]&&delete n[i];return n}var w=["NumberFormat","DateString","DateFormat"],y=/<\/?[^>]+>/g,p={valueOf:function(n,t){for(var i in n)if(n[i]==t)return i;return null},stripTags:function(n){var t,i;if(n)if(t=typeof n,"string"===t)n=n.replace(y,"");else if("object"===t)for(i in n)(t=n[i])&&"string"==typeof t&&(t=t.replace(y,"")),n[i]=t;return n},substitute:function(t,i,u){var s,f,e,o;if(h(u)&&(r.isObject(u)?(s=u.first,f=u.dateFormat,e=u.numberFormat):s=u),i&&"${*}"!==i)return r.replace(i,r.hitch({obj:t},function(t,i){var r=i.split(":");return 1<r.length?(i=r[0],r.shift(),c(i,this.obj,r.join(":"))):f&&-1!==n.indexOf(f.properties||"",i)?c(i,this.obj,f.formatter||"DateString"):e&&-1!==n.indexOf(e.properties||"",i)?c(i,this.obj,e.formatter||"NumberFormat"):l(this.obj[i])}),/\$\{([^\}]+)\}/g);i=[];for(o in t)if(u=t[o],f&&-1!==n.indexOf(f.properties||"",o)?u=c(o,t,f.formatter||"DateString"):e&&-1!==n.indexOf(e.properties||"",o)&&(u=c(o,t,e.formatter||"NumberFormat")),i.push(o+" = "+l(u)+"<br/>"),s)break;return i.join("")},filter:function(n,t,i){t=v(n,i,t);i={};var r;n=t[0];for(r in n)t[2].call(t[r],n[r],r,n)&&(i[r]=n[r]);return i},startsWith:function(n,t,i){return i=i||0,n.indexOf(t,i)===i},endsWith:function(n,t,i){return("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>n.length)&&(i=n.length),i-=t.length,n=n.indexOf(t,i),-1!==n&&n===i},isDefined:h,fixJson:a};return f("extend-esri")&&(r.mixin(s,p),s._isDefined=h,s._getParts=v,s._sanitize=a),p})},"dojo/date":function(){define(["./has","./_base/lang"],function(n,t){var i={getDaysInMonth:function(n){var t=n.getMonth();return 1==t&&i.isLeapYear(n)?29:[31,28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(n){return n=n.getFullYear(),!(n%400)||!(n%4)&&!!(n%100)},getTimezoneName:function(n){var t=n.toString(),i="",r=t.indexOf("(");return-1<r?i=t.substring(++r,t.indexOf(")")):(r=/([A-Z\/]+) \d{4}$/,t=t.match(r))?i=t[1]:(t=n.toLocaleString(),r=/ ([A-Z\/]+)$/,t=t.match(r))&&(i=t[1]),"AM"==i||"PM"==i?"":i},compare:function(n,t,i){return n=new Date(+n),t=new Date(+(t||new Date)),"date"==i?(n.setHours(0,0,0,0),t.setHours(0,0,0,0)):"time"==i&&(n.setFullYear(0,0,0),t.setFullYear(0,0,0)),n>t?1:n<t?-1:0},add:function(n,t,i){var f=new Date(+n),o=!1,r="Date",s,u,e;switch(t){case"day":break;case"weekday":(t=i%5)?s=parseInt(i/5):(t=0<i?5:-5,s=0<i?(i-5)/5:(i+5)/5);u=n.getDay();e=0;6==u&&0<i?e=1:0==u&&0>i&&(e=-1);u+=t;(0==u||6==u)&&(e=0<i?2:-2);i=7*s+t+e;break;case"year":r="FullYear";o=!0;break;case"week":i*=7;break;case"quarter":i*=3;case"month":o=!0;r="Month";break;default:r="UTC"+t.charAt(0).toUpperCase()+t.substring(1)+"s"}return r&&f["set"+r](f["get"+r]()+i),o&&f.getDate()<n.getDate()&&f.setDate(0),f},difference:function(n,t,r){var f,u;t=t||new Date;r=r||"day";f=t.getFullYear()-n.getFullYear();u=1;switch(r){case"quarter":n=n.getMonth();t=t.getMonth();u=Math.floor(t/3)+1+4*f-(Math.floor(n/3)+1);break;case"weekday":if(f=Math.round(i.difference(n,t,"day")),r=parseInt(i.difference(n,t,"week")),0==f%7)f=5*r;else{var u=0,e=n.getDay(),o=t.getDay();if(r=parseInt(f/7),t=f%7,n=new Date(n),n.setDate(n.getDate()+7*r),n=n.getDay(),0<f)switch(!0){case 6==e:u=-1;break;case 0==e:u=0;break;case 6==o:u=-1;break;case 0==o:u=-2;break;case 5<n+t:u=-2}else if(0>f)switch(!0){case 6==e:u=0;break;case 0==e:u=1;break;case 6==o:u=2;break;case 0==o:u=1;break;case 0>n+t:u=2}f=f+u-2*r}u=f;break;case"year":u=f;break;case"month":u=t.getMonth()-n.getMonth()+12*f;break;case"week":u=parseInt(i.difference(n,t,"day")/7);break;case"day":u/=24;case"hour":u/=60;case"minute":u/=60;case"second":u/=1e3;case"millisecond":u*=t.getTime()-n.getTime()}return Math.round(u)}};return t.mixin(t.getObject("dojo.date",!0),i),i})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(n,t,i,r,u){var f={},e;return n.setObject("dojo.number",f),f.format=function(i,r){r=n.mixin({},r||{});var u=t.normalizeLocale(r.locale),u=t.getLocalization("dojo.cldr","number",u);return r.customs=u,u=r.pattern||u[(r.type||"decimal")+"Format"],isNaN(i)||Infinity==Math.abs(i)?null:f._applyPattern(i,u,r)},f._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/,f._applyPattern=function(n,t,i){var u,e,o,r;if(i=i||{},u=i.customs.group,e=i.customs.decimal,t=t.split(";"),r=t[0],t=t[0>n?1:0]||"-"+r,-1!=t.indexOf("%"))n*=100;else if(-1!=t.indexOf(""))n*=1e3;else if(-1!=t.indexOf(""))u=i.customs.currencyGroup||u,e=i.customs.currencyDecimal||e,t=t.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/,function(n,t,r,u){return(n=i[["symbol","currency","displayName"][r.length-1]]||i.currency||"")?t+n+u:""});else if(-1!=t.indexOf("E"))throw Error("exponential notation not supported");if(o=f._numberPatternRE,r=r.match(o),!r)throw Error("unable to find a number expression in pattern: "+t);return!1===i.fractional&&(i.places=0),t.replace(o,f._formatAbsolute(n,r[0],{decimal:e,group:u,places:i.places,round:i.round}))},f.round=function(n,t,i){return i=10/(i||10),(i*+n).toFixed(t)/i},0==.9.toFixed()&&(e=f.round,f.round=function(n,t,i){var r=Math.pow(10,-t||0),u=Math.abs(n);return!n||u>=r?r=0:(u/=r,.5>u||.95<=u)&&(r=0),e(n,t,i)+(0<n?r:-r)}),f._formatAbsolute=function(n,t,i){var e,o,u,h,s;for(i=i||{},!0===i.places&&(i.places=0),Infinity===i.places&&(i.places=6),t=t.split("."),e="string"==typeof i.places&&i.places.indexOf(","),u=i.places,e?u=i.places.substring(e+1):0<=u||(u=(t[1]||[]).length),0>i.round||(n=f.round(n,u,i.round)),n=String(Math.abs(n)).split("."),o=n[1]||"",t[1]||i.places?(e&&(i.places=i.places.substring(0,e)),e=void 0!==i.places?i.places:t[1]&&t[1].lastIndexOf("0")+1,e>o.length&&(n[1]=r.pad(o,e,"0",!0)),u<o.length&&(n[1]=o.substr(0,u))):n[1]&&n.pop(),u=t[0].replace(",",""),e=u.indexOf("0"),-1!=e&&(e=u.length-e,e>n[0].length&&(n[0]=r.pad(n[0],e)),-1==u.indexOf("#")&&(n[0]=n[0].substr(n[0].length-e))),u=t[0].lastIndexOf(","),-1!=u&&(h=t[0].length-u-1,t=t[0].substr(0,u),u=t.lastIndexOf(","),-1!=u&&(s=t.length-u-1)),t=[],u=n[0];u;)e=u.length-h,t.push(0<e?u.substr(e):u),u=0<e?u.slice(0,e):"",s&&(h=s,s=void 0);return n[0]=t.reverse().join(i.group||","),n.join(i.decimal||".")},f.regexp=function(n){return f._parseInfo(n).regexp},f._parseInfo=function(n){var h;n=n||{};var i=t.normalizeLocale(n.locale),i=t.getLocalization("dojo.cldr","number",i),e=n.pattern||i[(n.type||"decimal")+"Format"],r=i.group,o=i.decimal,s=1;return-1!=e.indexOf("%")?s/=100:-1!=e.indexOf("")?s/=1e3:(h=-1!=e.indexOf(""),h&&(r=i.currencyGroup||r,o=i.currencyDecimal||o)),i=e.split(";"),1==i.length&&i.push("-"+i[0]),i=u.buildGroupRE(i,function(t){return t="(?:"+u.escapeString(t,".")+")",t.replace(f._numberPatternRE,function(t){var u={signed:!1,separator:n.strict?r:[r,""],fractional:n.fractional,decimal:o,exponent:!1},i;return t=t.split("."),i=n.places,1==t.length&&1!=s&&(t[1]="###"),1==t.length||0===i?u.fractional=!1:(void 0===i&&(i=n.pattern?t[1].lastIndexOf("0")+1:Infinity),i&&void 0==n.fractional&&(u.fractional=!0),!n.places&&i<t[1].length&&(i+=","+t[1].length),u.places=i),t=t[0].split(","),1<t.length&&(u.groupSize=t.pop().length,1<t.length&&(u.groupSize2=t.pop().length)),"("+f._realNumberRegexp(u)+")"})},!0),h&&(i=i.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(t,i,r,f){return(t=u.escapeString(n[["symbol","currency","displayName"][r.length-1]]||n.currency||""),!t)?"":(i=i?"[\\s\\xa0]":"",f=f?"[\\s\\xa0]":"",n.strict?i+t+f:(i&&(i+="*"),f&&(f+="*"),"(?:"+i+t+f+")?"))})),{regexp:i.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:o,factor:s}},f.parse=function(n,t){var i=f._parseInfo(t),r=new RegExp("^"+i.regexp+"$").exec(n),u;if(!r)return NaN;if(u=r[1],!r[1]){if(!r[2])return NaN;u=r[2];i.factor*=-1}return u=u.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),u*i.factor},f._realNumberRegexp=function(n){n=n||{};"places"in n||(n.places=Infinity);"string"!=typeof n.decimal&&(n.decimal=".");"fractional"in n&&!/^0/.test(n.places)||(n.fractional=[!0,!1]);"exponent"in n||(n.exponent=[!0,!1]);"eSigned"in n||(n.eSigned=[!0,!1]);var t=f._integerRegexp(n),i=u.buildGroupRE(n.fractional,function(t){var i="";return t&&0!==n.places&&(i="\\"+n.decimal,i=Infinity==n.places?"(?:"+i+"\\d+)?":i+("\\d{"+n.places+"}")),i},!0),r=u.buildGroupRE(n.exponent,function(t){return t?"([eE]"+f._integerRegexp({signed:n.eSigned})+")":""}),t=t+i;return i&&(t="(?:(?:"+t+")|(?:"+i+"))"),t+r},f._integerRegexp=function(n){n=n||{};"signed"in n||(n.signed=[!0,!1]);"separator"in n?"groupSize"in n||(n.groupSize=3):n.separator="";var t=u.buildGroupRE(n.signed,function(n){return n?"[-+]":""},!0),i=u.buildGroupRE(n.separator,function(t){if(!t)return"(?:\\d+)";t=u.escapeString(t);" "==t?t="\\s":""==t&&(t="\\s\\xa0");var i=n.groupSize,r=n.groupSize2;return r?(t="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})",0<i-r?"(?:"+t+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":t):"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0);return t+i},f})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(n,t){var r=/[&<>'"\/]/g,u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},i={};return t.setObject("dojo.string",i),i.escape=function(n){return n?n.replace(r,function(n){return u[n]}):""},i.rep=function(n,t){if(0>=t||!n)return"";for(var i=[];;){if(t&1&&i.push(n),!(t>>=1))break;n+=n}return i.join("")},i.pad=function(n,t,r,u){return r||(r="0"),n=String(n),t=i.rep(r,Math.ceil((t-n.length)/r.length)),u?n+t:t+n},i.substitute=function(i,r,u,f){return f=f||n.global,u=u?t.hitch(f,u):function(n){return n},i.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,function(n,i,e){if(""==i)return"$";if(n=t.getObject(i,!1,r),e&&(n=t.getObject(e,!1,f).call(f,n,i)),e=u(n,i),"undefined"==typeof e)throw Error('string.substitute could not find key "'+i+'" in template');return e.toString()})},i.trim=String.prototype.trim?t.trim:function(n){n=n.replace(/^\s+/,"");for(var t=n.length-1;0<=t;t--)if(/\S/.test(n.charAt(t))){n=n.substring(0,t+1);break}return n},i})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(n,t){var i={};return t.setObject("dojo.regexp",i),i.escapeString=function(n,t){return n.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(n){return t&&-1!=t.indexOf(n)?n:"\\"+n})},i.buildGroupRE=function(n,t,r){if(!(n instanceof Array))return t(n);for(var f=[],u=0;u<n.length;u++)f.push(t(n[u]));return i.group(f.join("|"),r)},i.group=function(n,t){return"("+(t?"?:":"")+n+")"},i})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(n,t,i,r,u,f,e,o,s){function v(n,t,i,u){return u.replace(/([a-z])\1*/ig,function(f){var o,c,s=f.charAt(0),l;f=f.length;l=["abbr","wide","narrow"];switch(s){case"G":o=t[4>f?"eraAbbr":"eraNames"][0>n.getFullYear()?0:1];break;case"y":o=n.getFullYear();switch(f){case 1:break;case 2:if(!i.fullYear){o=String(o);o=o.substr(o.length-2);break}default:c=!0}break;case"Q":case"q":o=Math.ceil((n.getMonth()+1)/3);c=!0;break;case"M":case"L":o=n.getMonth();3>f?(o+=1,c=!0):(s=["months","L"==s?"standAlone":"format",l[f-3]].join("-"),o=t[s][o]);break;case"w":o=h._getWeekOfYear(n,0);c=!0;break;case"d":o=n.getDate();c=!0;break;case"D":o=h._getDayOfYear(n);c=!0;break;case"e":case"c":if(o=n.getDay(),2>f){o=(o-r.getFirstDayOfWeek(i.locale)+8)%7;break}case"E":o=n.getDay();3>f?(o+=1,c=!0):(s=["days","c"==s?"standAlone":"format",l[f-3]].join("-"),o=t[s][o]);break;case"a":s=12>n.getHours()?"am":"pm";o=i[s]||t["dayPeriods-format-wide-"+s];break;case"h":case"H":case"K":case"k":c=n.getHours();switch(s){case"h":o=c%12||12;break;case"H":o=c;break;case"K":o=c%12;break;case"k":o=c||24}c=!0;break;case"m":o=n.getMinutes();c=!0;break;case"s":o=n.getSeconds();c=!0;break;case"S":o=Math.round(n.getMilliseconds()*Math.pow(10,f-3));c=!0;break;case"v":case"z":if(o=h._getZone(n,!0,i))break;f=4;case"Z":s=h._getZone(n,!1,i);s=[0>=s?"+":"-",e.pad(Math.floor(Math.abs(s)/60),2),e.pad(Math.abs(s)%60,2)];4==f&&(s.splice(0,0,"GMT"),s.splice(3,0,":"));o=s.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+u);}return c&&(o=e.pad(o,f)),o})}function c(n,i,r,u){var o=function(n){return n},f,e;return i=i||o,r=r||o,u=u||o,f=n.match(/(''|[^'])+/g),e="'"==n.charAt(0),t.forEach(f,function(n,t){n?(f[t]=(e?r:i)(n.replace(/''/g,"'")),e=!e):f[t]=""}),u(f.join(""))}function y(n,t,i,r){return r=f.escapeString(r),i.strict||(r=r.replace(" a"," ?a")),r.replace(/([a-z])\1*/ig,function(r){var u=r.charAt(0);var e=r.length,f="",o="";i.strict?(1<e&&(f="0{"+(e-1)+"}"),2<e&&(o="0{"+(e-2)+"}")):(f="0?",o="0{0,2}");switch(u){case"y":u="\\d{2,4}";break;case"M":case"L":2<e?(u=t["months-"+("L"==u?"standAlone":"format")+"-"+p[e-3]].slice(0).join("|"),i.strict||(u=u.replace(/\./g,""),u="(?:"+u+")\\.?")):u="1[0-2]|"+f+"[1-9]";break;case"D":u="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+f+"[1-9][0-9]|"+o+"[1-9]";break;case"d":u="3[01]|[12]\\d|"+f+"[1-9]";break;case"w":u="[1-4][0-9]|5[0-3]|"+f+"[1-9]";break;case"E":case"e":case"c":u=".+?";break;case"h":u="1[0-2]|"+f+"[1-9]";break;case"k":u="1[01]|"+f+"\\d";break;case"H":u="1\\d|2[0-3]|"+f+"\\d";break;case"K":u="1\\d|2[0-4]|"+f+"[1-9]";break;case"m":case"s":u="[0-5]\\d";break;case"S":u="\\d{"+e+"}";break;case"a":e=i.am||t["dayPeriods-format-wide-am"];f=i.pm||t["dayPeriods-format-wide-pm"];u=e+"|"+f;i.strict||(e!=e.toLowerCase()&&(u+="|"+e.toLowerCase()),f!=f.toLowerCase()&&(u+="|"+f.toLowerCase()),-1!=u.indexOf(".")&&(u+="|"+u.replace(/\./g,"")));u=u.replace(/\./g,"\\.");break;default:u=".*"}return n&&n.push(r),"("+u+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var h={};n.setObject(s.id.replace(/\//g,"."),h);h._getZone=function(n,t){return t?i.getTimezoneName(n):n.getTimezoneOffset()};h.format=function(t,i){var e;i=i||{};var r=u.normalizeLocale(i.locale),o=i.formatLength||"short",r=h._getGregorianBundle(r),f=[],s=n.hitch(this,v,t,r,i);return"year"==i.selector?c(r["dateFormatItem-yyyy"]||"yyyy",s):("date"!=i.selector&&(e=i.timePattern||r["timeFormat-"+o])&&f.push(c(e,s)),"time"!=i.selector&&(e=i.datePattern||r["dateFormat-"+o])&&f.push(c(e,s)),1==f.length?f[0]:r["dateTimeFormat-"+o].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(n,t){return f[t]}))};h.regexp=function(n){return h._parseInfo(n).regexp};h._parseInfo=function(t){t=t||{};var i=u.normalizeLocale(t.locale),i=h._getGregorianBundle(i),r=t.formatLength||"short",f=t.datePattern||i["dateFormat-"+r],e=t.timePattern||i["timeFormat-"+r],r="date"==t.selector?f:"time"==t.selector?e:i["dateTimeFormat-"+r].replace(/\{(\d+)\}/g,function(n,t){return[e,f][t]}),o=[];return{regexp:c(r,n.hitch(this,y,o,i,t)),tokens:o,bundle:i}};h.parse=function(n,r){var e=/[\u200E\u200F\u202A\u202E]/g,f=h._parseInfo(r),l=f.tokens,o=f.bundle,e=new RegExp("^"+f.regexp.replace(e,"")+"$",f.strict?"":"i").exec(n&&n.replace(e,""));if(!e)return null;var a=["abbr","wide","narrow"],u=[1970,0,1,0,0,0,0],c="",e=t.every(e,function(n,i){var s;if(!i)return!0;var e=l[i-1],f=e.length,e=e.charAt(0);switch(e){case"y":if(2!=f&&r.strict)u[0]=n;else if(100>n)n=Number(n),e=""+(new Date).getFullYear(),f=100*e.substring(0,2),e=Math.min(Number(e.substring(2,4))+20,99),u[0]=n<e?f+n:f-100+n;else{if(r.strict)return!1;u[0]=n}break;case"M":case"L":if(2<f){if(f=o["months-"+("L"==e?"standAlone":"format")+"-"+a[f-3]].concat(),r.strict||(n=n.replace(".","").toLowerCase(),f=t.map(f,function(n){return n.replace(".","").toLowerCase()})),n=t.indexOf(f,n),-1==n)return!1}else n--;u[1]=n;break;case"E":case"e":case"c":if(f=o["days-"+("c"==e?"standAlone":"format")+"-"+a[f-3]].concat(),r.strict||(n=n.toLowerCase(),f=t.map(f,function(n){return n.toLowerCase()})),n=t.indexOf(f,n),-1==n)return!1;break;case"D":u[1]=0;case"d":u[2]=n;break;case"a":if(f=r.am||o["dayPeriods-format-wide-am"],e=r.pm||o["dayPeriods-format-wide-pm"],r.strict||(s=/\./g,n=n.replace(s,"").toLowerCase(),f=f.replace(s,"").toLowerCase(),e=e.replace(s,"").toLowerCase()),r.strict&&n!=f&&n!=e)return!1;c=n==e?"p":n==f?"a":"";break;case"K":24==n&&(n=0);case"h":case"H":case"k":if(23<n)return!1;u[3]=n;break;case"m":u[4]=n;break;case"s":u[5]=n;break;case"S":u[6]=n}return!0}),f=+u[3];"p"===c&&12>f?u[3]=f+12:"a"===c&&12==f&&(u[3]=0);f=new Date(u[0],u[1],u[2],u[3],u[4],u[5],u[6]);r.strict&&f.setFullYear(u[0]);var s=l.join(""),v=-1!=s.indexOf("d"),s=-1!=s.indexOf("M");return!e||s&&f.getMonth()>u[1]||v&&f.getDate()>u[2]?null:((s&&f.getMonth()<u[1]||v&&f.getDate()<u[2])&&(f=i.add(f,"hour",1)),f)};var p=["abbr","wide","narrow"],a=[],l={};return h.addCustomFormats=function(n,t){a.push({pkg:n,name:t});l={}},h._getGregorianBundle=function(i){if(l[i])return l[i];var r={};return t.forEach(a,function(t){t=u.getLocalization(t.pkg,t.name,i);r=n.mixin(r,t)},this),l[i]=r},h.addCustomFormats(s.id.replace(/\/date\/locale$/,".cldr"),"gregorian"),h.getNames=function(n,t,i,r){var u;return r=h._getGregorianBundle(r),n=[n,i,t],"standAlone"==i&&(i=n.join("-"),u=r[i],1==u[0]&&(u=void 0)),n[1]="format",(u||r[n.join("-")]).concat()},h.isWeekend=function(n,t){var i=r.getWeekend(t),u=(n||new Date).getDay();return i.end<i.start&&(i.end+=7,u<i.start&&(u+=7)),u>=i.start&&u<=i.end},h._getDayOfYear=function(n){return i.difference(new Date(n.getFullYear(),0,1,n.getHours()),n)+1},h._getWeekOfYear=function(n,t){1==arguments.length&&(t=0);var r=new Date(n.getFullYear(),0,1).getDay(),i=(r-t+7)%7,i=Math.floor((h._getDayOfYear(n)+i-1)/7);return r==t&&i++,i},h})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(n,t){var i={};return n.setObject("dojo.cldr.supplemental",i),i.getFirstDayOfWeek=function(n){return n={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[i._region(n)],void 0===n?1:n},i._region=function(n){n=t.normalizeLocale(n);n=n.split("-");var i=n[1];return i?4==i.length&&(i=n[2]):i={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[n[0]],i},i.getWeekend=function(n){var t=i._region(n);return n={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[t],t={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[t],void 0===n&&(n=6),void 0===t&&(t=0),{start:n,end:t}},i})},"esri/_coremap":function(){define("require module dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/_base/event dojo/_base/unload dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/sniff dijit/registry dojox/gfx/matrix ./kernel ./config ./basemaps ./lang ./Evented ./fx ./deferredUtils ./tileUtils ./urlUtils ./PluginTarget ./Color ./arcade/Dictionary ./geometry/Point ./geometry/ScreenPoint ./geometry/Extent ./geometry/Rect ./geometry/mathUtils ./geometry/scaleUtils ./geometry/screenUtils ./geometry/webMercatorUtils ./layers/GraphicsLayer ./layers/TileInfo ./layers/LOD ./layers/ArcGISTiledMapServiceLayer ./layers/MapImageLayer ./layers/OpenStreetMapLayer ./layers/VectorTileLayer ./dijit/Popup ./plugins/popupManager dojo/uacss".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui){function wi(n,t){var i=n.lods;i.sort(function(n,t){return n.scale>t.scale?-1:n.scale<t.scale?1:0});var r=[],i=o.filter(i,function(n){if(-1===hi(r,n.scale))return r.push(n.scale),!0}),u=t.lods=[],f;o.forEach(i,function(n,t){f=u[t]=new gt(n);f.level=t});t.tileInfo=new dt(li(n,{lods:u}))}var yi,ci=wt.toMapPoint,pi=wt.toScreenPoint,ai=u.connect,si=u.disconnect,fi=e.hitch,oi=p.set,hi=o.indexOf,li=e.mixin,vi=0,ei=g.defaults.map,bi=ei.layerNamePrefix,ki=ei.graphicsLayerNamePrefix,di=new RegExp("^"+bi+"(\\d+)$"),gi=new RegExp("^"+ki+"(\\d+)$"),nr=function(){};return r=r([it,ot],{declaredClass:"esri._CoreMap",resizeDelay:300,invalidExtent:"Map does not have a valid extent.",invalidGeometry:"Geometry (wkid: ${geometry}) cannot be converted to spatial reference of the map (wkid: ${map})",unknownBasemap:'Unable to find basemap definition for: "${basemapName}". Try one of these: ${list}',invalidBasemap:'Unable to add basemap: "${basemapName}".',unknownLayerType:'Unknown basemap layer type: "${type}" found in basemap definition for: "${basemapName}".',visible:!0,_eventMap:{"basemap-change":!0,"extent-change":["extent","delta","levelChange","lod"],"layer-add":["layer"],"layer-add-result":["layer","error"],"layer-remove":["layer"],"layer-reorder":["layer","index"],"layer-resume":["layer"],"layer-suspend":["layer"],"layers-add-result":["layers"],"layers-removed":!0,"layers-reordered":["layerIds"],load:["map"],pan:["extent","delta"],"pan-end":["extent","delta"],"pan-start":["extent","screenPoint"],reposition:["x","y"],resize:["extent","width","height"],scale:["matrix","immediate"],"time-extent-change":["timeExtent"],"before-unload":["map"],unload:["map"],"update-end":["error"],"update-start":!0,zoom:["extent","zoomFactor","anchor"],"zoom-end":["extent","zoomFactor","anchor","level"],"zoom-start":["extent","zoomFactor","anchor","level"],click:!0,"dbl-click":!0,"key-down":!0,"key-up":!0,"mouse-down":!0,"mouse-drag":!0,"mouse-drag-end":!0,"mouse-drag-start":!0,"mouse-move":!0,"mouse-out":!0,"mouse-over":!0,"mouse-up":!0,"mouse-wheel":!0,"basic-tap":!0,"double-tap":!0,"pinch-end":!0,"pinch-move":!0,"pinch-start":!0,"processed-double-tap":!0,"processed-tap":!0,"swipe-end":!0,"swipe-move":!0,"swipe-start":!0,tap:!0,"two-finger-tap":!0},constructor:function(t,i){var k=this,r,f;this.registerConnectEvents();li(this,{_internalLayerIds:[],_layers:[],_layerDivs:[],_layerSize:0,_connects:[],_zoomAnimDiv:null,_zoomAnim:null,_layersDiv:null,_firstLayerId:null,_delta:null,_cursor:null,_ratioW:1,_ratioH:1,_params:null,_minResolution:0,_maxResolution:0,cursor:null,layerIds:[],graphicsLayerIds:[],graphics:null,_labels:null,loaded:!1,__panning:!1,__zooming:!1,__container:null,root:null,__LOD:null,__tileInfo:null,__visibleRect:null,__visibleDelta:null,_rids:[]});r=this.container=c.byId(t);f=this.id=l.get(r,"id")||b.getUniqueId(this.declaredClass);a.add(r,"map");var u=y.getContentBox(r),e=a.add,o=v.create;this.position=new lt(0,0);this._reposition();var s=this.width=0<u.w?u.w:ei.width,p=this.height=0<u.h?u.h:ei.height,w=this.root=o("div",{id:f+"_root",style:{width:s+"px",height:p+"px",direction:"ltr"}});e(w,"esriMapContainer");u=this.__container=o("div",{id:f+"_container"},w);oi(u,"position","absolute");e(u,"esriMapContainer");r.appendChild(w);r=this._params=li({slider:!0,nav:!1,zoom:-1,minZoom:-1,maxZoom:-1,scale:-1,minScale:0,maxScale:0,showInfoWindowOnClick:!0,displayGraphicsOnPan:!0,wrapAround180:!0,fitExtent:!1,optimizePanAnimation:!0},i||{});this.wrapAround180=r.wrapAround180;this.optimizePanAnimation=r.optimizePanAnimation;this.setBackgroundColor(r.backgroundColor);tt.isDefined(r.resizeDelay)&&(this.resizeDelay=r.resizeDelay);r.lods&&(wi({rows:512,cols:512,dpi:96,format:"JPEG",compressionQuality:75,origin:{x:-180,y:90},spatialReference:{wkid:4326},lods:r.lods},r),this.__tileInfo=r.tileInfo);this.extent=r.extent;this._extentUtil({mapCenter:r.center,targetLevel:r.zoom,targetScale:r.scale});this.__visibleRect=new vt(0,0,s,p);this.__visibleDelta=new vt(0,0,s,p);f=this._layersDiv=o("div",{id:f+"_layers"});e(f,"esriMapLayers");u.appendChild(f);this._zoomAnimDiv=o("div",{style:{position:"absolute"}});r.infoWindow?this.infoWindow=r.infoWindow:(e=this.infoWindow=new ui(r.popupOptions,o("div")),e.startup(),e._ootb=!0,oi(e.domNode,"zIndex",40));r.showLabels&&(n(["./layers/LabelLayer"],function(n){yi=n;k._createLabelLayer()}),this.on("load",function(){k._createLabelLayer()}));this.addPlugin(this._getAbsMid("./plugins/popupManager"),{enabled:r.showInfoWindowOnClick});this._zoomStartHandler=fi(this,this._zoomStartHandler);this._zoomingHandler=fi(this,this._zoomingHandler);this._zoomEndHandler=fi(this,this._zoomEndHandler);this._panningHandler=fi(this,this._panningHandler);this._panEndHandler=fi(this,this._panEndHandler);this._endTranslate=fi(this,this._endTranslate);this._timedResize=fi(this,this._timedResize);this._execResize=fi(this,this._execResize);this._processLabelLayers=fi(this,this._processLabelLayers);this._updateLabelLayers=fi(this,this._updateLabelLayers);this.resize=fi(this,this.resize);h.addOnWindowUnload(this,this.destroy)},_getAbsMid:function(i){return n.toAbsMid?n.toAbsMid(i):t.id.replace(/\/[^\/]*$/ig,"/")+i},_cleanUp:function(){var n=this.infoWindow;n&&(n._ootb&&n.destroy?n.destroy():n.unsetMap(this),delete this.infoWindow);si(this._tsTimeExtentChange_connect);this.removePlugin("./plugins/popupManager");v.destroy(this.root);this.root=null},_addLayer:function(n,t,i){var r,u,o,s,e,f;if(n.id&&(r=n.id.match(n instanceof kt?gi:di),r&&r[1]&&(r=Number(r[1]),vi<=r&&(vi=r+1))),u=n.id||(n instanceof kt?ki:bi)+vi++,n.id=u,this._layers[u]=n,(t===this.layerIds||t===this.graphicsLayerIds)&&(o=this._layerSize,this._layerSize++),n._isRefLayer="top"===i,i=!tt.isDefined(i)||0>i||i>t.length||"top"===i?t.length:i,0===o&&(this._firstLayerId=u),!n._isRefLayer)for(;(s=this.getLayer(t[i-1]))&&s._isRefLayer;)i--;return t.splice(i,0,u),e=fi(this,this._addLayerHandler),f=this,i=this._connects,r=function(){n.loaded?f._onLoadFix?(f._onLoadFix=!1,setTimeout(function(){e(n)},0)):e(n):(f["_"+u+"_addtoken_load"]=ai(n,"onLoad",f,"_addLayerHandler"),f["_"+u+"_addtoken_err"]=ai(n,"onError",f,function(i){e(n,i,t)}))},this.loaded||0===o||n.loaded&&-1===hi(this.graphicsLayerIds,u)?r():i.push(ai(this,"onLoad",r)),n},_addLayerHandler:function(n,t,i){var s=this.id,f=n.id,o=hi(n instanceof kt?this.graphicsLayerIds:this.layerIds,f),e=o,h=!1,r=this._params;if(si(this["_"+f+"_addtoken_load"]),si(this["_"+f+"_addtoken_err"]),t)delete this._layers[f],-1!==o&&(i.splice(o,1),this.onLayerAddResult(n,t));else{if(-1===o&&(o=hi(this._internalLayerIds,f),e=20+o,h=!0),f===this._firstLayerId)if(t=n.spatialReference,i=this.extent&&this.extent.spatialReference,!i||i.equals(t)||!n.tileInfo&&n.url||(i=null),i=this.spatialReference=i||t,this.wrapAround180=this.wrapAround180&&i&&i._isWrappable()?!0:!1,n.tileInfo&&(this.__tileInfo?(t=this.__tileInfo.lods,this.__tileInfo=li({},n.tileInfo),this.__tileInfo.lods=t):(wi(li({},n.tileInfo),r),this.__tileInfo=r.tileInfo)),this.wrapAround180&&(t=this.__tileInfo,i=i._getInfo(),(!t||Math.abs(i.origin[0]-t.origin.x)>i.dx)&&(this.wrapAround180=!1),this.wrapAround180&&t&&ft._addFrameInfo(t,i)),r.units=n.units,(t=this.__tileInfo&&this.__tileInfo.lods)&&t.length){i=r.minScale;for(var o=r.maxScale,c=-1,l=-1,a=!1,v=!1,u=0;u<t.length;u++)0<i&&!a&&i>=t[u].scale&&(c=t[u].level,a=!0),0<o&&!v&&o>=t[u].scale&&(l=0<u?t[u-1].level:-1,v=!0);for(-1===r.minZoom&&(r.minZoom=0===i?t[0].level:c),-1===r.maxZoom&&(r.maxZoom=0===o?t[t.length-1].level:l),u=0;u<t.length;u++)r.minZoom===t[u].level&&(r.minScale=t[u].scale,this._minResolution=t[u].resolution),r.maxZoom===t[u].level&&(r.maxScale=t[u].scale,this._maxResolution=t[u].resolution)}else r.minZoom=r.maxZoom=r.zoom=-1;if(n instanceof kt?(this._gc||(this._gc=new kt._GraphicsContainer,this._gc._setMap(this,this._layersDiv).id=s+"_gc"),e=n._setMap(this,this._gc._surface),e.id=s+"_"+f,this._layerDivs[f]=e,this._reorderLayers(this.graphicsLayerIds)):(e=n._setMap(this,this._layersDiv,e,this.__LOD),e.id=s+"_"+f,this._layerDivs[f]=e,this._reorderLayers(this.layerIds),h||-1===n.declaredClass.indexOf("VETiledLayer")||this._onBingLayerAdd(n)),f===this._firstLayerId&&(this.graphics=new kt({id:s+"_graphics",displayOnPan:r.displayGraphicsOnPan}),this._addLayer(this.graphics,this._internalLayerIds,20)),n===this.graphics){if(i=this._layers[this._firstLayerId],s=r.zoom,e=r.scale,t=r.center,i=i.initialExtent||i.fullExtent,this._firstLayerId=null,this.extent&&(this.extent=this._convertGeometry(this,this.extent)),!this.extent&&i&&(t&&(t=this._convertGeometry(i,t)),t&&(i=i.centerAt(t),t=null)),(t=this.extent||i&&new at(i.toJson()))&&(-1<s?t=this.__getExtentForLevel(s,null,t).extent:0<e&&(t=pt.getExtentForScale(this,e,t))),!t){console.log("Map: "+this.invalidExtent);return}r=this._fixExtent(t,r.fitExtent);this.extent=r.extent;this.__LOD=r.lod;this.__setExtent(this.extent);this.loaded=!0;this.attr("data-loaded","");this.infoWindow.setMap(this);this.onLoad(this)}h||(this.onLayerAdd(n),this.onLayerAddResult(n));si(this[f+"_addLayerHandler_connect"])}},_convertGeometry:function(n,t){var i=n&&n.spatialReference,r=t&&t.spatialReference;return i&&r&&!i.equals(r)&&(i._canProject(r)?i.isWebMercator()?t=bt.geographicToWebMercator(t):4326===i.wkid&&(t=bt.webMercatorToGeographic(t,!0)):(console.log("Map: "+tt.substitute({geometry:r.wkid||r.wkt,map:i.wkid||i.wkt},this.invalidGeometry)),t=null)),t},_reorderLayers:function(n){var u=this.onLayerReorder,i=v.place,f=this._layerDivs,e=this._layers,t=this._gc?this._gc._surface.getEventSource():null;if(n===this.graphicsLayerIds)o.forEach(n,function(n,r){var o=f[n];o&&(i(o.getEventSource(),t,r),u(e[n],r))});else{var s=this.graphics,h=s?s.id:null,c=this._layersDiv,r;o.forEach(n,function(n,t){r=f[n];n!==h&&r&&(i(r,c,t),u(e[n],t))});this._mapImageLyr&&this._placeMapImageLyr();t&&(t=9>w("ie")?t.parentNode:t,i(t,t.parentNode,n.length))}this.onLayersReordered([].concat(n))},_zoomStartHandler:function(){this.__zoomStart(this._zoomAnimDiv.startingExtent,this._zoomAnimDiv.anchor)},_zoomingHandler:function(n){var t=parseFloat(n.left),i=parseFloat(n.top);n=new at(t,i-parseFloat(n.height),t+parseFloat(n.width),i,this.spatialReference);t=this.extent.getWidth()/n.getWidth();this.__zoom(n,t,this._zoomAnimDiv.anchor)},_zoomEndHandler:function(){var n=this._zoomAnimDiv,t=n.extent,i=this.extent.getWidth()/t.getWidth(),r=n.anchor,u=n.newLod,f=n.levelChange;n.extent=n.anchor=n.levelChange=n.startingExtent=n.newLod=this._delta=this._zoomAnim=null;this.__zoomEnd(t,i,r,u,f)},_panningHandler:function(n){if(isNaN(parseFloat(n.left))||isNaN(parseFloat(n.top))){var t=Math.round,i=this._panAnim.node;n.left=-1*(this._delta.x-t(this.width/2))+"px";n.top=-1*(this._delta.y-t(this.height/2))+"px";p.set(i,"left",n.left);p.set(i,"top",n.top)}n=new lt(parseFloat(n.left),parseFloat(n.top));t=this.toMap(n);this.onPan(this.extent.offset(this.extent.xmin-t.x,this.extent.ymax-t.y),n)},_panEndHandler:function(n){var i;this.__panning=!1;i=Math.round;n=new lt(-i(parseFloat(n.style.left)),-i(parseFloat(n.style.top)));var i=n.x,r=n.y,t=this.__visibleRect,u=this.__visibleDelta;t.x+=-i;t.y+=-r;u.x+=-i;u.y+=-r;oi(this._zoomAnimDiv,{left:"0px",top:"0px"});var t=this.extent,u=this._ratioW,f=this._ratioH,t=new at(t.xmin+i/u,t.ymin-r/f,t.xmax+i/u,t.ymax-r/f,this.spatialReference);n.setX(-n.x);n.setY(-n.y);this._delta=this._panAnim=null;this._updateExtent(t);this.onPanEnd(t,n);this._fireExtChg([t,n,!1,this.__LOD])},_fixExtent:function(n,t){for(var i=this._reshapeExtent(n),r=1.25;!0===t&&(i.extent.getWidth()<n.getWidth()||i.extent.getHeight()<n.getHeight())&&0<i.lod.level&&3>=r;)i=this._reshapeExtent(n.expand(r)),r+=.25;return i},_getFrameWidth:function(){var t=-1,n=this.spatialReference._getInfo();return this.__LOD?(n=this.__LOD._frameInfo)&&(t=n[3]):n&&(t=Math.round(2*n.valid[1]/(this.extent.getWidth()/this.width))),t},_fixAspectRatio:function(n){var t=n.getWidth(),i=n.getHeight(),e=t/i,r=this.width/this.height,u=0,f=0;return this.width>this.height?t>i?r>e?u=i*r-t:f=t/r-i:u=i*r-t:this.width<this.height?t<i?r>e?u=i*r-t:f=t/r-i:f=t/r-i:t<i?u=i-t:t>i&&(f=t/r-i),u&&(n.xmin-=u/2,n.xmax+=u/2),f&&(n.ymin-=f/2,n.ymax+=f/2),n},_reshapeExtent:function(n){return n=this._fixAspectRatio(n),this._getAdjustedExtent(n)},_getAdjustedExtent:function(n){if(this.__tileInfo)return ft.getCandidateTileInfo(this,this.__tileInfo,n);var r=pt.getScale(this,n),t=this.getMinScale(),i=this.getMaxScale();return!t||r<=t?!i||r>=i||(n=pt.getExtentForScale(this,i,n)):n=pt.getExtentForScale(this,t,n),{extent:n}},_onBingLayerAdd:function(n){this["__"+n.id+"_vis_connect"]=u.connect(n,"onVisibilityChange",this,"_toggleBingLogo");this._toggleBingLogo(n.visible)},_onBingLayerRemove:function(n){u.disconnect(this["__"+n.id+"_vis_connect"]);delete this["__"+n.id+"_vis_connect"];var t=o.some(this.layerIds,function(t){return(n=this._layers[t])&&n.visible&&-1!==n.declaredClass.indexOf("VETiledLayer")},this);this._toggleBingLogo(t)},_toggleBingLogo:function(t){t&&!this._bingLogo?(t={left:this._mapParams&&this._mapParams.nav?"25px":""},6===w("ie")&&(t.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+n.toUrl("./images/map/bing-logo-lg.png")+"')"),t=this._bingLogo=v.create("div",{style:t},this.root),a.add(t,"bingLogo-lg")):!t&&this._bingLogo&&(v.destroy(this._bingLogo),delete this._bingLogo)},__panStart:function(n,t){var r=this._zoomAnim,i=this._panAnim;if(r&&r._active)r.stop(),r._fire("onEnd",[r.node]);else if(i&&i._active){i.stop();this._panAnim=null;var i=i.curve.getValue(i._getStep()),r=Math.round(parseFloat(i.left)),i=Math.round(parseFloat(i.top)),u=this.navigationManager._dragOrigin;this.__pan(r,i);u&&(u.x-=r,u.y-=i);return}this.__panning=!0;this.onPanStart(this.extent,new lt(n,t))},__pan:function(n,t){var i=this.extent,r=this._ratioW,u=this._ratioH;this.onPan(new at(i.xmin-n/r,i.ymin+t/u,i.xmax-n/r,i.ymax+t/u,this.spatialReference),new lt(n,t))},__panEnd:function(n,t){var r=this.__visibleRect,i=this.__visibleDelta;r.x+=n;r.y+=t;i.x+=n;i.y+=t;var r=new lt(n,t),i=this.extent,u=this._ratioW,f=this._ratioH,i=new at(i.xmin-n/u,i.ymin+t/f,i.xmax-n/u,i.ymax+t/f,this.spatialReference);this.__panning=!1;this._updateExtent(i);this.onPanEnd(i,r);this._fireExtChg([i,r,!1,this.__LOD])},__zoomStart:function(n,t){this.__zooming=!0;this.onZoomStart(n,1,t,this.__LOD?this.__LOD.level:null)},__zoom:function(n,t,i){this.onZoom(n,t,i)},__zoomEnd:function(n,t,i,r,u){oi(this._layersDiv,{left:"0px",top:"0px"});this._delta=new lt(0,0);this.__visibleRect.x=this.__visibleRect.y=0;n=new at(n);this.__LOD=r;this._ratioW=this.width/n.getWidth();this._ratioH=this.height/n.getHeight();var f=this._delta;this._delta=null;this.__zooming=!1;this._updateExtent(n,u);this.onZoomEnd(n,t,i,r?r.level:null);this._fireExtChg([n,f,u,r])},_extentUtil:function(n,t,i,r,u){var b=new f,v,y,it,l,d,h,g,nt,o,a,s=this.width,c=this.height,k,ut,p,ft,rt,w;return(n&&(v=n.numLevels,y=n.targetLevel,k=tt.isDefined(y),it=n.factor,l=n.mapAnchor,d=n.screenAnchor,h=n.mapCenter,ut=n.levelOrFactor,g=n.targetScale,nt=tt.isDefined(g)&&0<g),t&&(o=t.dx,a=t.dy,h=t.mapCenter),e.isArray(h)&&(h=new ct(h)),ft=this._panAnim,t=(n=this._stopAnim())?n.divExtent:this.extent,rt=this.__tileInfo,w=this._params,!this.loaded)?(i?(t&&(i=this._convertGeometry(t,i)),i&&(this.extent=i,w.zoom=w.scale=-1,w.center=null)):(h||k||nt)&&(h&&(t?(h=this._convertGeometry(t,h))&&(this.extent=t.centerAt(h),w.center=null):w.center=h),k&&-1<y?(w.zoom=y,w.scale=-1):nt&&(w.scale=g,w.zoom=-1)),b.resolve(),b):h&&(h=this._convertGeometry(this,h),!h)||l&&(l=this._convertGeometry(this,l),!l)||i&&(i=this._convertGeometry(this,i),!i)?(b.reject(),b):(ft&&l&&d&&(l=ci(this.extent,s,c,d)),n&&l&&d&&(l=ci(n.divExtent,s,c,d)),k&&(rt?(v=this.getMinZoom(),k=this.getMaxZoom(),y<v?y=v:y>k&&(y=k),v=y-(n?n.level:this.getLevel())):(v=0<y?-1:1,p=ut?y:null)),i||(tt.isDefined(v)?(rt?(s=n?n.level:this.getLevel(),s=this.__getExtentForLevel(s+v,h,t).extent):(s=(n?n.end:this.extent).expand(p||(0<v?.5*v:2*-v)),p&&h&&(s=s.centerAt(h))),s&&(h?i=s:(o=l||t.getCenter(),c=s.getWidth(),a=s.getHeight(),s=o.x>=t.xmin&&o.x<=t.xmax?(o.x-t.xmin)/t.getWidth():.5,i=o.y>=t.ymin&&o.y<=t.ymax?(o.y-t.ymin)/t.getHeight():.5,s=o.x-s*c,o=o.y-i*a,i=new at(s,o,s+c,o+a,this.spatialReference)))):nt?i=pt.getExtentForScale(this,g,t):tt.isDefined(it)?i=t.expand(it):(o||a)&&(n?(i=n.end,l=i.getCenter(),p=pi(i,s,c,l),p.x+=o,p.y+=a,p=ci(i,s,c,p),i=i.offset(p.x-l.x,p.y-l.y)):(o=new lt(s/2+o,c/2+a),o=ci(t,s,c,o),c=t.getWidth(),a=t.getHeight(),s=o.x-c/2,o=o.y-a/2,i=new at(s,o,s+c,o+a,this.spatialReference)))),i||(h?(t=n?n.end:t,c=t.getWidth(),a=t.getHeight(),s=h.x-c/2,o=h.y-a/2,i=new at(s,o,s+c,o+a,this.spatialReference)):n&&(i=n.end)),i?(this._extentDfd&&-1===this._extentDfd.fired&&(this._extentDfd.then(null,nr),this._extentDfd.reject()),this._extentDfd=b,this.__setExtent(i,null,d,r,n,u)):b.reject(),b)},__setExtent:function(n,t,i,r,u,f){var k,d,e,l,o,a;try{if(this._firstLayerId)this.extent=n;else{var s=!0,v=this.spatialReference,h=u?u.divExtent:this.extent,y=this._fixExtent(n,r||!1);n=y.extent;var w=n.getWidth(),b=n.getHeight(),c=Math.round;if(h)var nt=c(1e6*h.getWidth()),tt=c(1e6*w),it=c(1e6*h.getHeight()),ut=c(1e6*b),s=nt!==tt||it!==ut;if(e=u&&u.rect,l=u&&u.divExtent,ei.zoomDuration&&s&&h){l=l||new at(h);e=e||{left:h.xmin,top:h.ymax,width:h.getWidth(),height:h.getHeight()};d={left:n.xmin,top:n.ymax,width:w,height:b};var ft=new ct(n.xmin,n.ymax,v),et=new ct(n.xmin,n.ymin,v),ot=new ct(this.extent.xmin,this.extent.ymax,v),st=new ct(this.extent.xmin,this.extent.ymin,v);(k=yt.getLineIntersection(ot,ft,st,et,v))||u||(s=!1)}if(this._ratioW=this.width/w,this._ratioH=this.height/b,o=this._zoomAnimDiv,s)(oi(this._layersDiv,{left:"0px",top:"0px"}),t=new lt(0,0),this.__visibleRect.x=this.__visibleRect.y=0,e&&d)?(this._delta=t,o.id="_zAD",o.startingExtent=l,o.extent=n,o.levelChange=s,o.newLod=y.lod,o.anchor=i?i:!k&&u?u.anchor:pi(this.extent,this.width,this.height,k),a=this.extent.getWidth()/n.getWidth(),1024<(1>a?1/a:a)?(this.__zoomStart(l,o.anchor),this.__zoom(l,1,o.anchor),this._fireOnScale(1,o.anchor,!0),this.__zoomEnd(n,a,o.anchor,y.lod,s)):(this._zoomAnim=rt.resize({node:o,start:e,end:d,duration:ei.zoomDuration,rate:ei.zoomRate,beforeBegin:u?null:this._zoomStartHandler,onAnimate:this._zoomingHandler,onEnd:this._zoomEndHandler}).play(),this._fireOnScale(a,o.anchor,f))):(this._updateExtent(n,s,f),this._fireExtChg([this.extent,t,s,this.__LOD=y.lod]));else if(!this.__panning)if(!1===this.loaded||f)this._updateExtent(n,s,f),this._fireExtChg([this.extent,t,s,this.__LOD=y.lod]);else{this.__panning=!0;e=new vt(0,0,this.width,this.height,this.spatialReference).getCenter();e.x=c(e.x);e.y=c(e.y);var p=this._delta=this.toScreen(n.getCenter()),ht=Math.abs(e.x-p.x),pt=Math.abs(e.y-p.y);this.optimizePanAnimation&&(ht>2*this.width||pt>2*this.height)?(this.__panStart(0,0),this.__pan(0,0),this.__visibleRect.x=this.__visibleRect.y=this.__visibleDelta.x=this.__visibleDelta.y=0,this.__panning=!1,this._delta=null,this._updateExtent(n,!1,f),this.onPanEnd(this.extent,new lt(0,0)),this._fireExtChg([this.extent,new lt(0,0),!0,this.__LOD])):(this.onPanStart(this.extent,new lt(0,0)),this._panAnim=rt.slideTo({node:o,left:e.x-p.x,top:e.y-p.y,duration:ei.panDuration,rate:ei.panRate,onAnimate:this._panningHandler,onEnd:this._panEndHandler}),this._panAnim.play())}}}catch(g){console.log(g.stack);console.error(g)}},_fireOnScale:function(n,t,i){if("css-transforms"===this.navigationMode){var r=this.__visibleDelta;this.onScale(k.scaleAt(n,{x:-1*(this.width/2-(t.x-r.x)),y:-1*(this.height/2-(t.y-r.y))}),i)}},_stopAnim:function(){var n=this._zoomAnim,t=this._panAnim;if(n&&n._active){n.stop();var t=n.curve.getValue(n._getStep()),i=parseFloat(t.left),r=parseFloat(t.top),n=n.node;return{anchor:n.anchor,start:n.startingExtent,end:n.extent,level:n.newLod&&n.newLod.level,rect:t,divExtent:new at(i,r-parseFloat(t.height),i+parseFloat(t.width),r,this.spatialReference)}}t&&t._active&&(t.stop(),t._fire("onEnd",[t.node]))},__getExtentForLevel:function(n,t,i){var r=this.__tileInfo,r=r&&r.lods,u;if(n=tt.isDefined(n)?n:0,i=i||this.extent,t=t||i&&i.getCenter(),r){if(t)return i=this.getMinZoom(),u=this.getMaxZoom(),n>u&&(n=u),n<i&&(n=i),n=r[n],r=this.width*n.resolution/2,i=this.height*n.resolution/2,{extent:new at(t.x-r,t.y-i,t.x+r,t.y+i,t.spatialReference),lod:n}}else if(i)return{extent:i.expand(!n||1>n?1:n).centerAt(t)};console.log("Map: "+this.invalidExtent)},_jobs:0,_incr:function(){1==++this._jobs&&(this.updating=!0,this.attr("data-updating",""),this.onUpdateStart())},_decr:function(){var n=--this._jobs;n?0>n&&(this._jobs=0):(this.updating=!1,this.attr("data-updating"),this.onUpdateEnd())},_fireEvent:function(n,t){this[n]&&this[n].apply(this,t)},_updateExtent:function(n,t,i){this.extent=n;n=this.spatialReference;this._viewInfo={view:new ht({viewingMode:"map",scale:this.getScale()}),sr:n};(t||i)&&this._setClipRect();this._calcGeographicExtent()},_calcGeographicExtent:function(){var n=this.spatialReference;n&&(n.isWebMercator()?this.geographicExtent=bt.webMercatorToGeographic(this._getAvailExtent(),!0):4326===n.wkid&&(this.geographicExtent=new at(this._getAvailExtent().toJson())))},_fireExtChg:function(n){this.attr("data-zoom",this.getZoom());this.attr("data-scale",this.getScale());this._fireEvent("onExtentChange",n);(n=this._extentDfd)&&(delete this._extentDfd,n.resolve())},attr:function(n,t){var i=this.container;return i&&(null==t?i.removeAttribute(n):i.setAttribute(n,t)),this},onUpdateStart:function(){},onUpdateEnd:function(){},onLoad:function(){this._setClipRect();this._calcGeographicExtent()},onBeforeUnload:function(){},onUnload:function(){},onExtentChange:function(){},onTimeExtentChange:function(){},onLayerAdd:function(){},onLayerAddResult:function(){},onLayersAddResult:function(){},onLayerRemove:function(){},onLayersRemoved:function(){},onLayerReorder:function(){},onLayersReordered:function(){},onLayerSuspend:function(){},onLayerResume:function(){},onPanStart:function(){},onPan:function(){},onPanEnd:function(){},onScale:function(){},onZoomStart:function(){},onZoom:function(){},onZoomEnd:function(){},onResize:function(){this._setClipRect()},onReposition:function(){},destroy:function(){this._destroyed||(this.onBeforeUnload(this),this.removeAllLayers(),this._cleanUp(),clearTimeout(this._resizeT),this._gc&&this._gc._cleanUp(),this._destroyed=!0,this.onUnload(this))},setCursor:function(n){oi(this.__container,"cursor",this.cursor=n)},setMapCursor:function(n){this.setCursor(this._cursor=n)},resetMapCursor:function(){this.setCursor(this._cursor)},setBackgroundColor:function(n){n&&!n.declaredClass&&(n=new st(n));this.backgroundColor=n||null;var t="";n&&(t=9>w("ie")?n.toHex():"rgba("+n.toRgba().join(",")+")");p.set(this.root,{backgroundColor:t})},setInfoWindow:function(n){var t=this.infoWindow;t&&t.unsetMap(this);this.infoWindow=n;this.loaded&&n&&n.setMap(this)},setInfoWindowOnClick:function(n){this._params.showInfoWindowOnClick=n;this.popupManager&&this.popupManager.set("enabled",n)},getInfoWindowAnchor:function(n){return this.infoWindow&&this.infoWindow._getAnchor&&this.infoWindow._getAnchor(n)||"upperright"},toScreen:function(n,t){return pi(this.extent,this.width,this.height,n,t)},toMap:function(n){return ci(this.extent,this.width,this.height,n)},addLayer:function(n,t){return n&&!this.getLayer(n.id)&&this._addLayer(n,n instanceof kt?this.graphicsLayerIds:this.layerIds,t),n},addLayers:function(n){for(var i=[],r=n.length,e=n.length,f=u.connect(this,"onLayerAddResult",function(t,e){-1!==o.indexOf(n,t)&&(r--,i.push({layer:t,success:!e,error:e}),r||(u.disconnect(f),this.onLayersAddResult(i)))}),t=0;t<e;t++)this.addLayer(n[t]);return this},removeLayer:function(n,t){var i=n.id,r=n instanceof kt?this.graphicsLayerIds:this.layerIds,u=hi(r,i);0<=u&&(r.splice(u,1),n instanceof kt?(si(this["_gl_"+n.id+"_click_connect"]),n.loaded&&n._unsetMap(this,this._gc._surface)):n.loaded&&(n._unsetMap(this,this._layersDiv),-1!==n.declaredClass.indexOf("VETiledLayer")&&this._onBingLayerRemove(n)),delete this._layers[i],delete this._layerDivs[i],t||this._reorderLayers(r),this.onLayerRemove(n))},removeAllLayers:function(){for(var t=this.layerIds,n=t.length-1;0<=n;n--)this.removeLayer(this._layers[t[n]],1);for(t=this.graphicsLayerIds,n=t.length-1;0<=n;n--)this.removeLayer(this._layers[t[n]],1);this.onLayersRemoved()},reorderLayer:function(n,t){e.isString(n)&&(i.deprecated(this.declaredClass+": Map.reorderLayer(/*String*/ id, /*Number*/ index) deprecated. Use Map.reorderLayer(/*Layer*/ layer, /*Number*/ index).",null,"v2.0"),n=this.getLayer(n));var f=n.id,u,r=n instanceof kt?this.graphicsLayerIds:this.layerIds;0>t?t=0:t>=r.length&&(t=r.length-1);u=hi(r,f);-1!==u&&u!==t&&(r.splice(u,1),r.splice(t,0,f),this._reorderLayers(r))},getLayer:function(n){return this._layers[n]},setExtent:function(n,t){n=new at(n.toJson());var i=n.getWidth(),r=n.getHeight();return 0===i&&0===r?this.centerAt(new ct({x:n.xmin,y:n.ymin,spatialReference:n.spatialReference&&n.spatialReference.toJson()})):this._extentUtil(null,null,n,t)},centerAt:function(n){return this._extentUtil(null,{mapCenter:n})},centerAndZoom:function(n,t){return this._extentUtil({targetLevel:t,mapCenter:n,levelOrFactor:!0})},getScale:function(){return this.__LOD?this.__LOD.scale:pt.getScale(this)},getResolution:function(){return this.__LOD?this.__LOD.resolution:this.extent?this.extent.getWidth()/this.width:0},getResolutionInMeters:function(){return this.getResolution()*pt.getUnitValueForSR(this.spatialReference)},getMinResolution:function(){return this._minResolution},getMaxResolution:function(){return this._maxResolution},getMinScale:function(){return this._params.minScale},getMaxScale:function(){return this._params.maxScale},_getViewInfo:function(){return this._viewInfo},setScale:function(n){return this._extentUtil({targetScale:n})},getLayersVisibleAtScale:function(n){var t=[];return(n=n||this.getScale())&&o.forEach(this.layerIds.concat(this.graphicsLayerIds),function(i){i=this.getLayer(i);i.isVisibleAtScale(n)&&t.push(i)},this),t},getNumLevels:function(){var n=this.getMinZoom(),t=this.getMaxZoom();return n===t&&0>n?0:t-n+1},getLevel:function(){return this.__LOD?this.__LOD.level:-1},setLevel:function(n){if(-1<n)return this._extentUtil({targetLevel:n})},getZoom:function(){return this.getLevel()},setZoom:function(n){return this.setLevel(n)},getMinZoom:function(){return this._params.minZoom},getMaxZoom:function(){return this._params.maxZoom},setBasemap:function(n){var i,s,a;if(e.isObject(n)?(i=n,n=i.title):i=nt&&nt[n],i){this._basemapDfd&&-1===this._basemapDfd.fired&&this._basemapDfd.cancel();var r=[],c=[],l=0;if(o.forEach(i.baseMapLayers||i.layers,function(t){var i,u={id:t.id,displayLevels:t.displayLevels,opacity:tt.isDefined(t.opacity)?t.opacity:null,visible:tt.isDefined(t.visibility)?t.visibility:null};if(t.type)switch(t.type){case"OpenStreetMap":i=new ii(u);break;case"VectorTile":i=et.normalize(t.url);i=new ri(i,u);break;default:console.log("Map.setBasemap: "+tt.substitute({basemapName:n,type:t.type},this.unknownLayerType))}else i=et.normalize(t.url),i=new ni(i,u);i&&(r.push(i),c.push(t),t.isReference||l++)},this),r.length&&l)if(s={basemapName:n,infos:c,layers:r},this.loaded){var v=this,t=new f(ut._dfdCanceller),h=function(n){t._pendingLayers--;n=o.indexOf(s.layers,this);-1<n&&(n=t._layerEvents[n])&&(u.disconnect(n[0]),u.disconnect(n[1]));0>=t._pendingLayers&&(delete t._layerEvents,delete v._basemapDfd,0>t.fired&&t.callback(s))};this._basemapDfd=t;t._pendingLayers=0;t._layerEvents={};o.forEach(r,function(n,i){n&&(t._pendingLayers++,n.loaded?h(n):t._layerEvents[i]=[u.connect(n,"onLoad",n,h),u.connect(n,"onError",n,h)])});t.addCallback(fi(this,this._basemapLoaded))}else this._basemapLoaded(s);else console.log("Map.setBasemap: "+tt.substitute({basemapName:n},this.invalidBasemap))}else{i=[];for(a in nt)i.push(a);console.log("Map.setBasemap: "+tt.substitute({basemapName:n,list:i.join(",")},this.unknownBasemap))}},_basemapLoaded:function(n){var i=n.layers,r=n.infos,u=0,f=!0,t;this.loaded&&(o.forEach(i,function(n,t){n.loaded&&(r[t].isReference||u++)}),f=u);f&&(this.basemapLayerIds&&(t={basemapName:this._basemap,infos:nt&&nt[this._basemap]&&nt[this._basemap].baseMapLayers},t.basemapName||(o.forEach(this.basemapLayerIds,function(n){if(this.getLayer(n)instanceof ii)return t.basemapName="osm",t.infos=nt&&nt.osm&&nt.osm.baseMapLayers,!1},this),t.basemapName||(t=null))),this._removeBasemap(),this._basemap=n.basemapName,this.basemapLayerIds=this._addBasemap(i,r),this.attr("data-basemap",this.getBasemap()),this.emit("basemap-change",{current:n,previous:t}))},_addBasemap:function(n,t){var i=[],r=[],u=0;return o.forEach(n,function(n,f){t[f].isReference?i.push(n):(this.addLayer(n,u++),r.push(n.id))},this),i.length&&o.forEach(i,function(n){n.attr("data-reference",!0);this.addLayer(n,"top");r.push(n.id)},this),r},_removeBasemap:function(){var n=this.basemapLayerIds,t;n&&n.length&&o.forEach(n,function(n){(t=this.getLayer(n))&&this.removeLayer(t)},this)},getBasemap:function(){return this._basemap||""},translate:function(n,t){if(n=n||0,t=t||0,!this._txTimer){this._tx=this._ty=0;var i=this.toScreen(this.extent.getCenter());this.__panStart(i.x,i.y)}this._tx+=n;this._ty+=t;this.__pan(this._tx,this._ty);clearTimeout(this._txTimer);this._txTimer=setTimeout(this._endTranslate,150)},_endTranslate:function(){clearTimeout(this._txTimer);this._txTimer=null;var n=this._tx,t=this._ty;this._tx=this._ty=0;this.__panEnd(n,t)},setTimeExtent:function(n){n=(this.timeExtent=n)?new n.constructor(n.toJson()):null;this.onTimeExtentChange(n)},setTimeSlider:function(n){this.timeSlider&&(si(this._tsTimeExtentChange_connect),this.timeSlider=this._tsTimeExtentChange_connect=null);n&&(this.timeSlider=n,this.setTimeExtent(n.getCurrentTimeExtent()),this._tsTimeExtentChange_connect=ai(n,"onTimeExtentChange",this,"setTimeExtent"))},setVisibility:function(n){if(this.visible!==n){if(this.visible=n,n||(this._display=this.container.style.display),this.container.style.display=n?this._display:"none",this.autoResize){var t=n?"resume":"pause";this._rszSignal[t]();this._oriSignal[t]()}n&&this.resize()}return this},resize:function(n){clearTimeout(this._resizeT);this._destroyed||(!0===n?this._execResize():this._resizeT=setTimeout(this._execResize,this.resizeDelay))},_timedResize:function(){this._resizeT||this._execResize()},_execResize:function(){clearTimeout(this._resizeT);this._resizeT=null;this.reposition();this._resize();this.autoResize&&this._startResizeTimer()},_resize:function(){var i=this.width,u=this.height,t=p.get(this.container,"display"),n=y.getContentBox(this.container),r;if(!("none"===t||0>=n.w||0>=n.h||i===n.w&&u===n.h)){(t=this._zoomAnim||this._panAnim)&&(t.stop(),t._fire("onEnd",[t.node]));oi(this.root,{width:(this.width=n.w)+"px",height:(this.height=n.h)+"px"});n=this.width;t=this.height;this.attribution&&this.attribution.domNode&&p.set(this.attribution.domNode,"maxWidth",Math.floor(n*this._mapParams.attributionWidth)+"px");this.__visibleRect.update(this.__visibleRect.x,this.__visibleRect.y,n,t);this.__visibleDelta.update(this.__visibleDelta.x,this.__visibleDelta.y,n,t);r=new vt(this.extent);i=new vt(r.x,r.y,n/i*r.width,t/u*r.height,this.spatialReference).getExtent();this.onResize(i,n,t);this._extentUtil(null,null,i,null,!0)}},reposition:function(){var n=this.position,t=n.x,i=n.y;if(this._reposition(),n=this.position,t!==n.x||i!==n.y)this.onReposition(n.x,n.y)},_reposition:function(){var n=y.position(this.container,!0),t=y.getPadBorderExtents(this.container);this.position.update(n.x+t.l,n.y+t.t)},_setClipRect:function(){var n;if(delete this._clip,n=7>=w("ie")||void 0===w("ie")&&7<=w("trident")?"rect(auto,auto,auto,auto)":"auto",this.wrapAround180){var t=this.width,i=this.height,r=this._getFrameWidth(),u=t-r;0<u&&(n=u/2,n="rect(0px,"+(n+r)+"px,"+i+"px,"+n+"px)",i=this.extent.getWidth(),t=r/t*i,this._clip=[(i-t)/2,t])}oi(this.__container,"clip",n)},_getAvailExtent:function(){var n=this.extent,i=this._clip,t;return i?(n._clip||(t=new vt(n),t.width=i[1],t.x+=i[0],n._clip=t.getExtent()),n._clip):n},_fixedPan:function(n,t){return this._extentUtil(null,{dx:n,dy:t})},panUp:function(){return this._fixedPan(0,-.75*this.height)},panUpperRight:function(){return this._fixedPan(.75*this.width,-.75*this.height)},panRight:function(){return this._fixedPan(.75*this.width,0)},panLowerRight:function(){return this._fixedPan(.75*this.width,.75*this.height)},panDown:function(){return this._fixedPan(0,.75*this.height)},panLowerLeft:function(){return this._fixedPan(-.75*this.width,.75*this.height)},panLeft:function(){return this._fixedPan(-.75*this.width,0)},panUpperLeft:function(){return this._fixedPan(-.75*this.width,-.75*this.height)},enableSnapping:function(t){if(t=t||{},"esri.SnappingManager"===t.declaredClass)this.snappingManager=t;else{var r=vi++,i=this;this._rids&&this._rids.push(r);n(["./SnappingManager"],function(n){var u=i._rids?o.indexOf(i._rids,r):-1;-1!==u&&(i._rids.splice(u,1),i.snappingManager=new n(e.mixin({map:i},t)))})}return this.snappingManager},disableSnapping:function(){this.snappingManager&&this.snappingManager.destroy();this.snappingManager=null},_createLabelLayer:function(){!this._labels&&yi&&this.loaded&&(this._labels=new yi({id:"_internal_LabelLayer"}),this._labels._setMap(this,this._gc._surface),this._processLabelLayers(),this.on("layers-reordered",this._processLabelLayers))},_processLabelLayers:function(){null==this._labelProcessor&&(this._labelProcessor=setTimeout(this._updateLabelLayers,0))},_updateLabelLayers:function(){this._labelProcessor=null;this._labels&&(this._labels.removeAllFeatureLayers(),o.forEach(this.graphicsLayerIds,function(n){n=this.getLayer(n);"function"==typeof n.applyEdits?this._labels.addFeatureLayer(n):"esri.layers.WFSLayer"===n.declaredClass&&this._labels.addFeatureLayer(n)},this))},_getMapImageLyr:function(){return this.loaded&&!this._mapImageLyr&&(this._mapImageLyr=new ti,this._mapImageLyr._setMap(this,this._layersDiv),this._placeMapImageLyr()),this._mapImageLyr},_placeMapImageLyr:function(){for(var r=this.layerIds,f=this._layerDivs,u=!1,n,t,i=r.length-1;0<=i;i--)if(n=r[i],t=this.getLayer(n),n=f[n],t&&n&&!t._isReference){v.place(this._mapImageLyr._div,n,"after");u=!0;break}u||v.place(this._mapImageLyr._div,this._layersDiv,"first")}}),w("extend-esri")&&(d._CoreMap=r),r})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(n,t){var i=n.matrix={},r={};return i._degToRad=function(n){return r[n]||(r[n]=Math.PI*n/180)},i._radToDeg=function(n){return n/Math.PI*180},i.Matrix2D=function(n){var f,e;if(n)if("number"==typeof n)this.xx=this.yy=n;else if(n instanceof Array){if(0<n.length){for(f=i.normalize(n[0]),e=1;e<n.length;++e){var r=f,u=i.normalize(n[e]),f=new i.Matrix2D;f.xx=r.xx*u.xx+r.xy*u.yx;f.xy=r.xx*u.xy+r.xy*u.yy;f.yx=r.yx*u.xx+r.yy*u.yx;f.yy=r.yx*u.xy+r.yy*u.yy;f.dx=r.xx*u.dx+r.xy*u.dy+r.dx;f.dy=r.yx*u.dx+r.yy*u.dy+r.dy}t.mixin(this,f)}}else t.mixin(this,n)},t.extend(i.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0}),t.mixin(i,{identity:new i.Matrix2D,flipX:new i.Matrix2D({xx:-1}),flipY:new i.Matrix2D({yy:-1}),flipXY:new i.Matrix2D({xx:-1,yy:-1}),translate:function(n,t){return 1<arguments.length?new i.Matrix2D({dx:n,dy:t}):new i.Matrix2D({dx:n.x,dy:n.y})},scale:function(n,t){return 1<arguments.length?new i.Matrix2D({xx:n,yy:t}):"number"==typeof n?new i.Matrix2D({xx:n,yy:n}):new i.Matrix2D({xx:n.x,yy:n.y})},rotate:function(n){var t=Math.cos(n);return n=Math.sin(n),new i.Matrix2D({xx:t,xy:-n,yx:n,yy:t})},rotateg:function(n){return i.rotate(i._degToRad(n))},skewX:function(n){return new i.Matrix2D({xy:Math.tan(n)})},skewXg:function(n){return i.skewX(i._degToRad(n))},skewY:function(n){return new i.Matrix2D({yx:Math.tan(n)})},skewYg:function(n){return i.skewY(i._degToRad(n))},reflect:function(n,t){1==arguments.length&&(t=n.y,n=n.x);var u=n*n,f=t*t,r=u+f,e=2*n*t/r;return new i.Matrix2D({xx:2*u/r-1,xy:e,yx:e,yy:2*f/r-1})},project:function(n,t){1==arguments.length&&(t=n.y,n=n.x);var u=n*n,f=t*t,r=u+f,e=n*t/r;return new i.Matrix2D({xx:u/r,xy:e,yx:e,yy:f/r})},normalize:function(n){return n instanceof i.Matrix2D?n:new i.Matrix2D(n)},isIdentity:function(n){return 1==n.xx&&0==n.xy&&0==n.yx&&1==n.yy&&0==n.dx&&0==n.dy},clone:function(n){var r=new i.Matrix2D;for(var t in n)"number"==typeof n[t]&&"number"==typeof r[t]&&r[t]!=n[t]&&(r[t]=n[t]);return r},invert:function(n){n=i.normalize(n);var t=n.xx*n.yy-n.xy*n.yx;return new i.Matrix2D({xx:n.yy/t,xy:-n.xy/t,yx:-n.yx/t,yy:n.xx/t,dx:(n.xy*n.dy-n.yy*n.dx)/t,dy:(n.yx*n.dx-n.xx*n.dy)/t})},_multiplyPoint:function(n,t,i){return{x:n.xx*t+n.xy*i+n.dx,y:n.yx*t+n.yy*i+n.dy}},multiplyPoint:function(n,t,r){return n=i.normalize(n),"number"==typeof t&&"number"==typeof r?i._multiplyPoint(n,t,r):i._multiplyPoint(n,t.x,t.y)},multiplyRectangle:function(n,t){var r=i.normalize(n);if(t=t||{x:0,y:0,width:0,height:0},i.isIdentity(r))return{x:t.x,y:t.y,width:t.width,height:t.height};var u=i.multiplyPoint(r,t.x,t.y),f=i.multiplyPoint(r,t.x,t.y+t.height),e=i.multiplyPoint(r,t.x+t.width,t.y),r=i.multiplyPoint(r,t.x+t.width,t.y+t.height),o=Math.min(u.x,f.x,e.x,r.x),s=Math.min(u.y,f.y,e.y,r.y);return{x:o,y:s,width:Math.max(u.x,f.x,e.x,r.x)-o,height:Math.max(u.y,f.y,e.y,r.y)-s}},multiply:function(n){for(var u=i.normalize(n),f=1;f<arguments.length;++f){var t=u,r=i.normalize(arguments[f]),u=new i.Matrix2D;u.xx=t.xx*r.xx+t.xy*r.yx;u.xy=t.xx*r.xy+t.xy*r.yy;u.yx=t.yx*r.xx+t.yy*r.yx;u.yy=t.yx*r.xy+t.yy*r.yy;u.dx=t.xx*r.dx+t.xy*r.dy+t.dx;u.dy=t.yx*r.dx+t.yy*r.dy+t.dy}return u},_sandwich:function(n,t,r){return i.multiply(i.translate(t,r),n,i.translate(-t,-r))},scaleAt:function(n,t,r,u){switch(arguments.length){case 4:return i._sandwich(i.scale(n,t),r,u);case 3:return"number"==typeof r?i._sandwich(i.scale(n),t,r):i._sandwich(i.scale(n,t),r.x,r.y)}return i._sandwich(i.scale(n),t.x,t.y)},rotateAt:function(n,t,r){return 2<arguments.length?i._sandwich(i.rotate(n),t,r):i._sandwich(i.rotate(n),t.x,t.y)},rotategAt:function(n,t,r){return 2<arguments.length?i._sandwich(i.rotateg(n),t,r):i._sandwich(i.rotateg(n),t.x,t.y)},skewXAt:function(n,t,r){return 2<arguments.length?i._sandwich(i.skewX(n),t,r):i._sandwich(i.skewX(n),t.x,t.y)},skewXgAt:function(n,t,r){return 2<arguments.length?i._sandwich(i.skewXg(n),t,r):i._sandwich(i.skewXg(n),t.x,t.y)},skewYAt:function(n,t,r){return 2<arguments.length?i._sandwich(i.skewY(n),t,r):i._sandwich(i.skewY(n),t.x,t.y)},skewYgAt:function(n,t,r){return 2<arguments.length?i._sandwich(i.skewYg(n),t,r):i._sandwich(i.skewYg(n),t.x,t.y)}}),n.Matrix2D=i.Matrix2D,i})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),function(n,t,i,r,u,f,e,o,s){var h=t.getObject("dojox.gfx",!0),c=h._base={},l,a,y,p,v;return h._hasClass=function(n,t){var i=n.getAttribute("className");return i&&0<=(" "+i+" ").indexOf(" "+t+" ")},h._addClass=function(n,t){var i=n.getAttribute("className")||"";(!i||0>(" "+i+" ").indexOf(" "+t+" "))&&n.setAttribute("className",i+(i?" ":"")+t)},h._removeClass=function(n,t){var i=n.getAttribute("className");i&&n.setAttribute("className",i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)"),"$1$2"))},c._getFontMeasurements=function(){var t={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},i,f,n;r("ie")&&(f=u.doc.documentElement.style.fontSize||"",f||(u.doc.documentElement.style.fontSize="100%"));n=o.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},u.body());for(i in t)n.style.fontSize=i,t[i]=16*Math.round(12*n.offsetHeight/16)/12e3;return r("ie")&&(u.doc.documentElement.style.fontSize=f),u.body().removeChild(n),t},l=null,c._getCachedFontMeasurements=function(n){return(n||!l)&&(l=c._getFontMeasurements()),l},a=null,y={},c._getTextBox=function(n,t,i){var f,r,h=arguments.length,e;if(a||(a=o.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},u.body())),f=a,f.className="",r=f.style,r.borderWidth="0",r.margin="0",r.padding="0",r.outline="0",1<h&&t)for(e in t)e in y||(r[e]=t[e]);return 2<h&&i&&(f.className=i),f.innerHTML=n,f.getBoundingClientRect?(r=f.getBoundingClientRect(),r={l:r.left,t:r.top,w:r.width||r.right-r.left,h:r.height||r.bottom-r.top}):r=s.getMarginBox(f),f.innerHTML="",r},c._computeTextLocation=function(n,t,i,r){var u={};switch(n.align){case"end":u.x=n.x-t;break;case"middle":u.x=n.x-t/2;break;default:u.x=n.x}return u.y=n.y-i*(r?.75:1),u},c._computeTextBoundingBox=function(n){var t,i;return h._base._isRendered(n)?(t=n.getShape(),i=n.getFont()||h.defaultFont,n=n.getTextWidth(),i=h.normalizedLength(i.size),t=c._computeTextLocation(t,n,i,!0),{x:t.x,y:t.y,width:n,height:i}):{x:0,y:0,width:0,height:0}},c._isRendered=function(n){for(n=n.parent;n&&n.getParent;)n=n.parent;return null!==n},p=0,c._getUniqueId=function(){var t;do t=n._scopeName+"xUnique"+ ++p;while(e.byId(t));return t},v=r("pointer-events")?"touchAction":r("MSPointer")?"msTouchAction":null,c._fixMsTouchAction=v?function(n){n.rawNode.style[v]="none"}:function(){},t.mixin(h,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var n={};return function(t){var i=n[t];return i?new i:(i=n[t]=new Function,i.prototype=h["default"+t],new i)}}(),normalizeColor:function(n){return n instanceof i?n:new i(n)},normalizeParameters:function(n,t){var i,r;if(t){r={};for(i in n)i in t&&!(i in r)&&(n[i]=t[i])}return n},makeParameters:function(n,i){var r=null,u;if(!i)return t.delegate(n);u={};for(r in n)r in u||(u[r]=t.clone(r in i?i[r]:n[r]));return u},formatNumber:function(n,t){var i=n.toString(),r;return 0<=i.indexOf("e")?i=n.toFixed(4):(r=i.indexOf("."),0<=r&&5<i.length-r&&(i=n.toFixed(4))),0>n?i:t?" "+i:i},makeFontString:function(n){return n.style+" "+n.variant+" "+n.weight+" "+n.size+" "+n.family},splitFontString:function(n){var t=h.getDefault("Font"),r,i;return n=n.split(/\s+/),5>n.length||(t.style=n[0],t.variant=n[1],t.weight=n[2],r=n[3].indexOf("/"),t.size=0>r?n[3]:n[3].substring(0,r),i=4,0>r&&("/"==n[4]?i=6:"/"==n[4].charAt(0)&&(i=5)),i<n.length&&(t.family=n.slice(i).join(" "))),t},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return h._base._getCachedFontMeasurements()["12pt"]/12},pt2px:function(n){return n*h.px_in_pt()},px2pt:function(n){return n/h.px_in_pt()},normalizedLength:function(n){if(0===n.length)return 0;if(2<n.length){var i=h.px_in_pt(),t=parseFloat(n);switch(n.slice(-2)){case"px":return t;case"pt":return t*i;case"in":return 72*t*i;case"pc":return 12*t*i;case"mm":return t*h.mm_in_pt*i;case"cm":return t*h.cm_in_pt*i}}return parseFloat(n)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,equalSources:function(n,t){return n&&t&&n===t},switchTo:function(n){var t="string"==typeof n?h[n]:n;t&&(f.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath EsriPath Surface createSurface fixTarget".split(" "),function(n){h[n]=t[n]}),"string"==typeof n?h.renderer=n:f.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(n){return h.renderer=h[n]&&h[n].Surface===h.Surface?n:null}))}}),h})},"esri/basemaps":function(){define(["require","dojo/has","./kernel","dojo/i18n!./nls/jsapi"],function(n,t,i,r){return n={streets:{title:r.basemaps.streets,thumbnailUrl:n.toUrl("./images/basemap/streets.jpg"),itemId:"d8855ee4d3d74413babfb0f41203b168",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]},satellite:{title:r.basemaps.satellite,thumbnailUrl:n.toUrl("./images/basemap/satellite.jpg"),itemId:"86de95d4e0244cba80f0fa2c9403a7b2",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]},hybrid:{title:r.basemaps.hybrid,thumbnailUrl:n.toUrl("./images/basemap/hybrid.jpg"),itemId:"413fd05bbd7342f5991d5ec96f4f8b18",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",isReference:!0}]},terrain:{title:r.basemaps.terrain,thumbnailUrl:n.toUrl("./images/basemap/terrain.jpg"),itemId:"aab054ab883c4a4094c72e949566ad40",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer"},{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",isReference:!0}]},topo:{title:r.basemaps.topo,thumbnailUrl:n.toUrl("./images/basemap/topo.jpg"),itemId:"6e03e8c26aad4b9c92a87c1063ddb0e3",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer"}]},gray:{title:r.basemaps.gray,thumbnailUrl:n.toUrl("./images/basemap/gray.jpg"),itemId:"8b3b470883a744aeb60e5fff0a319ce7",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"},{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",isReference:!0}]},"dark-gray":{title:r.basemaps["dark-gray"],thumbnailUrl:n.toUrl("./images/basemap/dark-gray.jpg"),itemId:"da65bacab5bd4defb576f839b6b28098",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer"},{url:"https://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",isReference:!0}]},oceans:{title:r.basemaps.oceans,thumbnailUrl:n.toUrl("./images/basemap/oceans.jpg"),itemId:"48b8cec7ebf04b5fbdcaf70d09daff21",baseMapLayers:[{url:"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{url:"https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",isReference:!0}]},"national-geographic":{title:r.basemaps["national-geographic"],thumbnailUrl:n.toUrl("./images/basemap/national-geographic.jpg"),itemId:"509e2d6b034246d692a461724ae2d62c",baseMapLayers:[{url:"https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer"}]},osm:{title:r.basemaps.osm,thumbnailUrl:n.toUrl("./images/basemap/osm.jpg"),itemId:"5d2bfa736f8448b3a1708e1f6be23eed",baseMapLayers:[{type:"OpenStreetMap"}]},"dark-gray-vector":{title:r.basemaps["dark-gray"],thumbnailUrl:n.toUrl("./images/basemap/dark-gray.jpg"),itemId:"850db44b9eb845d3bd42b19e8aa7a024",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/5ad3948260a147a993ef4865e3fad476/resources/styles/root.json",type:"VectorTile"}]},"gray-vector":{title:r.basemaps.gray,thumbnailUrl:n.toUrl("./images/basemap/gray.jpg"),itemId:"0e02e6f86d02455091796eaae811d9b5",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/5dd75c1a544b46c3af01ba5736bfdfa0/resources/styles/root.json",type:"VectorTile"}]},"streets-vector":{title:r.basemaps.streets,thumbnailUrl:n.toUrl("./images/basemap/streets.jpg"),itemId:"4e1133c28ac04cca97693cf336cd49ad",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/a60a37a27cc140ddad15f919cd5a69f2/resources/styles/root.json",type:"VectorTile"}]},"topo-vector":{title:r.basemaps.topo,thumbnailUrl:n.toUrl("./images/basemap/topo.jpg"),itemId:"6f65bc1351b7411588a8cb43fe23dad7",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/86d5ed4b6dc741de9dad5f0fbe09ae95/resources/styles/root.json",type:"VectorTile"}]},"streets-night-vector":{title:r.basemaps["streets-night-vector"],thumbnailUrl:n.toUrl("./images/basemap/streets-night.jpg"),itemId:"bf79e422e9454565ae0cbe9553cf6471",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/92c551c9f07b4147846aae273e822714/resources/styles/root.json",type:"VectorTile"}]},"streets-relief-vector":{title:r.basemaps["streets-relief-vector"],thumbnailUrl:n.toUrl("./images/basemap/streets-relief.jpg"),itemId:"2e063e709e3446459f8538ed6743f879",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/78c0a9ab4fbf4198a8b951848aab19d8/resources/styles/root.json",type:"VectorTile"}]},"streets-navigation-vector":{title:r.basemaps["streets-navigation-vector"],thumbnailUrl:n.toUrl("./images/basemap/streets-navigation.jpg"),itemId:"dcbbba0edf094eaa81af19298b9c6247",baseMapLayers:[{url:"https://www.arcgis.com/sharing/rest/content/items/e19e9330bf08490ca8353d76b5e2e658/resources/styles/root.json",type:"VectorTile"}]}},t("extend-esri")&&(i.basemaps=n),n})},"esri/Evented":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/Evented dojo/has ./kernel".split(" "),function(n,t,i,r,u,f){return n=n([r],{declaredClass:"esri.Evented",registerConnectEvents:function(){var f=this.constructor,r=this.constructor._meta.parents,i=[{}],e={},n,u,o=function(n,i){var u,r;for(t.isArray(n)||(n=[n]),u=0;u<n.length;u++)r=n[u],r._meta&&r._meta.parents&&o(r._meta.parents,i),r.prototype._eventMap&&i.push(t.mixin({},r.prototype._eventMap));return i};if(!f._onMap){o(r,i);i.push(this._eventMap);r=t.mixin.apply(this,i);for(n in this)/^on\w/.test(n)&&t.isFunction(this[n])&&(i=this._hyphenLower(n).toLowerCase(),r[i]||(e[i]={method:n}));for(u in r)n=this._onCamelCase(u),e[u]={method:n,argKeys:r[u]};return f._onMap=e,f._onMap}},on:function(n,r){if(-1<n.indexOf(",")){for(var u=n.split(/\s*,\s*/),e=u.length,o=[];e--;)o.push(this.on(u[e],r));return o.remove=function(){for(var n=0;n<o.length;n++)o[n].remove()},o}var u=this.constructor._onMap||this.registerConnectEvents(),e="string"==typeof n&&n.toLowerCase(),f=this._onCamelCase(e),s=u&&u[e];return(f=s&&s.method||this[f]&&t.isFunction(this[f])&&f)?s&&t.isArray(s.argKeys)?(u=this._onArr2Obj(r,u[e].argKeys),i.after(this,f,u,!0)):i.after(this,f,function(n){n=n||{};n.target||(n.target=this);r.call(this,n)},!0):this.inherited(arguments)},emit:function(n,i){var f,e,s,u,o=n.toLowerCase(),r;return u=this._onCamelCase(n),r=this.constructor._onMap||this.registerConnectEvents(),u=(s=r&&r[o]&&r[o].method||t.isFunction(this[u])&&u)&&this[s],s&&r&&r[o]&&this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},r[o].argKeys)(i),i=i||{},i.target||(i.target=this),u&&(f=e&&e.length?e:[i],f=u.apply(this,f)),this.inherited(arguments,[n,i]),f},_onObj2Arr:function(n,t){if(t){var i=this;return function(r){for(var f=[],e=t.length,u=0;u<e;u++)f[u]=r[t[u]];n.apply(i,f)}}return n},_onArr2Obj:function(n,t){if(t){var i=this;return function(){for(var u={},f=arguments.length,r=0;r<f;r++)u[t[r]]=arguments[r];u.target||(u.target=i);n.call(i,u)}}return n},_hyphenLower:function(n){return n.replace(/^on/,"").replace(/[A-Z](?=[a-z])/g,function(n,t){return(t?"-":"")+n.toLowerCase()})},_onCamelCase:function(n){return"on"+n.substr(0,1).toUpperCase()+n.substr(1).replace(/\-([a-z])/g,function(n,t){return t.toUpperCase()})}}),u("extend-esri")&&(f.Evented=n),n})},"esri/fx":function(){define("dojo/_base/connect dojo/_base/fx dojo/_base/lang dojo/dom dojo/dom-geometry dojo/dom-style dojo/fx dojo/has ./kernel".split(" "),function(n,t,i,r,u,f,e,o,s){var h={animateRange:function(n){var r=n.range;return new t.Animation(i.mixin({curve:new t._Line(r.start,r.end)},n))},resize:function(n){var e=n.node=r.byId(n.node),f=n.start,o=n.end;return f||(f=u.getMarginBox(e),e=u.getPadBorderExtents(e),f=n.start={left:f.l+e.l,top:f.t+e.t,width:f.w-e.w,height:f.h-e.h}),o||(o=n.anchor?n.anchor:{x:f.left,y:f.top},e=n.size,o=n.end={left:f.left-(e.width-f.width)*(o.x-f.left)/f.width,top:f.top-(e.height-f.height)*(o.y-f.top)/f.height,width:e.width,height:e.height}),t.animateProperty(i.mixin({properties:{left:{start:f.left,end:o.left},top:{start:f.top,end:o.top},width:{start:f.width,end:o.width},height:{start:f.height,end:o.height}}},n))},slideTo:function(e){var o=e.node=r.byId(e.node),c=f.getComputedStyle,s=null,h=null,l=function(){return function(){var n="absolute"==o.style.position?"absolute":"relative";s="absolute"==n?o.offsetTop:parseInt(c(o).top)||0;h="absolute"==n?o.offsetLeft:parseInt(c(o).left)||0;"absolute"!=n&&"relative"!=n&&(n=u.position(o,!0),s=n.y,h=n.x,o.style.position="absolute",o.style.top=s+"px",o.style.left=h+"px")}}();return l(),e=t.animateProperty(i.mixin({properties:{top:{start:s,end:e.top||0},left:{start:h,end:e.left||0}}},e)),n.connect(e,"beforeBegin",e,l),e},flash:function(n){var u,o;n=i.mixin({end:"#f00",duration:500,count:1},n);n.duration/=2*n.count;u=r.byId(n.node);o=n.start;o||(o=f.getComputedStyle(u).backgroundColor);var h=n.end,s=[],c=n.count,u={node:u,duration:n.duration};for(n=0;n<c;n++)s.push(t.animateProperty(i.mixin({properties:{backgroundColor:{start:o,end:h}}},u))),s.push(t.animateProperty(i.mixin({properties:{backgroundColor:{start:h,end:o}}},u)));return e.chain(s)}};return o("extend-esri")&&i.mixin(i.getObject("fx",!0,s),h),h})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){var l,a;return i.isAsync||h(0,function(){c(["./fx/Toggler"])}),i=i.fx={},h={_fire:function(n,t){return this[n]&&this[n].apply(this,t||[]),this}},l=function(n){this._index=-1;this._animations=n||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;r.forEach(this._animations,function(n){n&&("undefined"!=typeof n.duration&&(this.duration+=n.duration),n.delay&&(this.duration+=n.delay))},this)},l.prototype=new t,n.extend(l,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=u.after(this._current,"onAnimate",n.hitch(this,"_onAnimate"),!0),this._onEndCtx=u.after(this._current,"onEnd",n.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(t,i){if(this._current||(this._current=this._animations[this._index=0]),!i&&"playing"==this._current.status())return this;var r=u.after(this._current,"beforeBegin",n.hitch(this,function(){this._fire("beforeBegin")}),!0),f=u.after(this._current,"onBegin",n.hitch(this,function(){this._fire("onBegin",arguments)}),!0),e=u.after(this._current,"onPlay",n.hitch(this,function(){this._fire("onPlay",arguments);r.remove();f.remove();e.remove()}));return this._onAnimateCtx&&this._onAnimateCtx.remove(),this._onAnimateCtx=u.after(this._current,"onAnimate",n.hitch(this,"_onAnimate"),!0),this._onEndCtx&&this._onEndCtx.remove(),this._onEndCtx=u.after(this._current,"onEnd",n.hitch(this,"_onEnd"),!0),this._current.play.apply(this._current,arguments),this},pause:function(){if(this._current){var t=u.after(this._current,"onPause",n.hitch(this,function(){this._fire("onPause",arguments);t.remove()}),!0);this._current.pause()}return this},gotoPercent:function(n,t){this.pause();var i=this.duration*n;return this._current=null,r.some(this._animations,function(n,t){return i<=n.duration?(this._current=n,this._index=t,!0):(i-=n.duration,!1)},this),this._current&&this._current.gotoPercent(i/this._current.duration),t&&this.play(),this},stop:function(t){if(this._current){if(t){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var i=u.after(this._current,"onStop",n.hitch(this,function(){this._fire("onStop",arguments);i.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}}),n.extend(l,h),i.chain=function(t){return new l(n.isArray(t)?t:Array.prototype.slice.call(t,0))},a=function(t){this._animations=t||[];this._connects=[];this.duration=this._finished=0;r.forEach(t,function(t){var i=t.duration;t.delay&&(i+=t.delay);this.duration<i&&(this.duration=i);this._connects.push(u.after(t,"onEnd",n.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=new f.Animation({curve:[0,1],duration:this.duration});var i=this;r.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(n){i._connects.push(u.after(i._pseudoAnimation,n,function(){i._fire(n,arguments)},!0))})},n.extend(a,{_doAction:function(n,t){return r.forEach(this._animations,function(i){i[n].apply(i,t)}),this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(n,t){var i=this._pseudoAnimation;i[n].apply(i,t)},play:function(){return this._finished=0,this._doAction("play",arguments),this._call("play",arguments),this},pause:function(){return this._doAction("pause",arguments),this._call("pause",arguments),this},gotoPercent:function(n,t){var i=this.duration*n;return r.forEach(this._animations,function(n){n.gotoPercent(n.duration<i?1:i/n.duration,t)}),this._call("gotoPercent",arguments),this},stop:function(){return this._doAction("stop",arguments),this._call("stop",arguments),this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop();r.forEach(this._connects,function(n){n.remove()})}}),n.extend(a,h),i.combine=function(t){return new a(n.isArray(t)?t:Array.prototype.slice.call(t,0))},i.wipeIn=function(t){var r=t.node=e.byId(t.node),i=r.style,h,s;return t=f.animateProperty(n.mixin({properties:{height:{start:function(){if(h=i.overflow,i.overflow="hidden","hidden"==i.visibility||"none"==i.display)return i.height="1px",i.display="",i.visibility="",1;var n=o.get(r,"height");return Math.max(n,1)},end:function(){return r.scrollHeight}}}},t)),s=function(){i.height="auto";i.overflow=h},u.after(t,"onStop",s,!0),u.after(t,"onEnd",s,!0),t},i.wipeOut=function(t){var i=(t.node=e.byId(t.node)).style,o,r;return t=f.animateProperty(n.mixin({properties:{height:{end:1}}},t)),u.after(t,"beforeBegin",function(){o=i.overflow;i.overflow="hidden";i.display=""},!0),r=function(){i.overflow=o;i.height="auto";i.display="none"},u.after(t,"onStop",r,!0),u.after(t,"onEnd",r,!0),t},i.slideTo=function(t){var i=null,r=null,h=function(n){return function(){var t=o.getComputedStyle(n),u=t.position;i="absolute"==u?n.offsetTop:parseInt(t.top)||0;r="absolute"==u?n.offsetLeft:parseInt(t.left)||0;"absolute"!=u&&"relative"!=u&&(t=s.position(n,!0),i=t.y,r=t.x,n.style.position="absolute",n.style.top=i+"px",n.style.left=r+"px")}}(t.node=e.byId(t.node));return h(),t=f.animateProperty(n.mixin({properties:{top:t.top||0,left:t.left||0}},t)),u.after(t,"beforeBegin",h,!0),t},i})},"esri/deferredUtils":function(){define(["dojo/_base/lang","dojo/has","./kernel"],function(n,t,i){var r={_dfdCanceller:function(n){n.canceled=!0;var t=n._pendingDfd;-1===n.fired&&t&&-1===t.fired&&t.cancel();n._pendingDfd=null},_fixDfd:function(n){var t=n.then;return n.then=function(n,i,r){if(n){var u=n;n=function(n){return n&&n._argsArray?u.apply(null,n):u(n)}}return t.call(this,n,i,r)},n},_resDfd:function(n,t,i){var r=t.length;1===r?i?n.errback(t[0]):n.callback(t[0]):1<r?(t._argsArray=!0,n.callback(t)):n.callback()}};return t("extend-esri")&&n.mixin(i,r),r})},"esri/tileUtils":function(){define(["dojo/_base/array","dojo/has","./kernel","./geometry/Point","./geometry/Extent"],function(n,t,i,r,u){var f={_addFrameInfo:function(t,i){var r,u,o=2*i.origin[1],s=i.origin[0],h=t.origin.x,e=t.width,f;n.forEach(t.lods,function(n){r=Math.round(o/n.resolution);u=Math.ceil(r/e);f=Math.floor((s-h)/(e*n.resolution));n._frameInfo||(n._frameInfo=[u,f,f+u-1,r])})},getContainingTileCoords:function(n,t,i){var r=n.origin;return i=i.resolution,{row:Math.floor((r.y-t.y)/(n.height*i)),col:Math.floor((t.x-r.x)/(n.width*i))}},getCandidateTileInfo:function(n,t,i){for(var y=n.width,o=n.height,s=i.xmax-i.xmin,h=i.ymax-i.ymin,e=n.__tileInfo===t,c=e?n.getMinZoom():-1,e=e?n.getMaxZoom():-1,l=-1,a=t.lods,v=Math.abs,f,p,w,e=-1<e?e:a.length-1,c=-1<c?c:0;c<=e;c++)if(p=a[c])if(w=s>h?v(h-o*p.resolution):v(s-y*p.resolution),0>l||w<=l)f=p,l=w;else break;return y=f,f=y.resolution,o=(i.xmin+i.xmax)/2,s=(i.ymin+i.ymax)/2,h=n.width/2*f,f*=n.height/2,o=new u(o-h,s-f,o+h,s+f,i.spatialReference),i=new r(o.xmin,o.ymax,i.spatialReference),e=y.resolution,h=t.width,s=t.height,t=t.origin,n=n.__visibleDelta,f=Math.floor,a=h*e,v=s*e,e=f((t.y-i.y)/v),l=f((i.x-t.x)/a),c=t.y-e*v,t=f(Math.abs((i.x-(t.x+l*a))*h/a))+n.x,n=f(Math.abs((i.y-c)*s/v))+n.y,{tile:{point:i,coords:{row:e,col:l},offsets:{x:t,y:n}},lod:y,extent:o}},getTileExtent:function(n,t,i,r){var f=n.origin,e,o;return t=n.lods[t].resolution,e=n.width,o=n.height,new u(r*t*e+f.x,f.y-(i+1)*t*o,(r+1)*t*e+f.x,f.y-i*t*o,n.spatialReference)}};return t("extend-esri")&&(i.TileUtils=f),f})},"esri/geometry/Point":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ../srUtils".split(" "),function(n,t,i,r,u,f,e,o){function s(n,t){89.99999<t?t=89.99999:-89.99999>t&&(t=-89.99999);var i=.017453292519943*t;return[111319.49079327169*n,3189068.5*Math.log((1+Math.sin(i))/(1-Math.sin(i)))]}function h(n,t,i){return n=n/6378137*57.295779513082323,i?[n,57.295779513082323*(1.5707963267948966-2*Math.atan(Math.exp(t/-6378137)))]:[n-360*Math.floor((n+180)/360),57.295779513082323*(1.5707963267948966-2*Math.atan(Math.exp(t/-6378137)))]}var c={type:"point",x:0,y:0};return n=n(e,{declaredClass:"esri.geometry.Point",constructor:function(n,i,r){t.mixin(this,c);t.isArray(n)?(this.x=n[0],this.y=n[1],this.spatialReference=i):t.isObject(n)?(t.mixin(this,n),u.isDefined(this.latitude)&&(this.y=this.latitude),u.isDefined(this.longitude)&&(this.x=this.longitude),this.spatialReference&&(this.spatialReference=o.createSpatialReference(this.spatialReference))):(this.x=n,this.y=i,this.spatialReference=r);this.verifySR()},offset:function(n,t){return new this.constructor(this.x+n,this.y+t,this.spatialReference)},setX:function(n){return this.x=n,this.clearCache(),this},setY:function(n){return this.y=n,this.clearCache(),this},setLongitude:function(n){var t=this.spatialReference;return t&&(t._isWebMercator()?this.setX(s(n,this.y)[0]):4326===t.wkid&&this.setX(n)),this},setLatitude:function(n){var t=this.spatialReference;return t&&(t._isWebMercator()?this.setY(s(this.x,n)[1]):4326===t.wkid&&this.setY(n)),this},getLongitude:function(){var n=this.spatialReference,t;return n&&(n._isWebMercator()?t=h(this.x,this.y)[0]:4326===n.wkid&&(t=this.x)),t},getLatitude:function(){var n=this.spatialReference,t;return n&&(n._isWebMercator()?t=h(this.x,this.y)[1]:4326===n.wkid&&(t=this.y)),t},update:function(n,t){return this.x=n,this.y=t,this.clearCache(),this},normalize:function(){var n=this.x,t=this.spatialReference,i;return t&&(i=t._getInfo(),i&&(n=this._normalizeX(n,i))),new this.constructor(n,this.y,t)},_normalizeX:function(n,t){var i=t.valid[0],u=t.valid[1],r=2*u;return n>u?(i=Math.ceil(Math.abs(n-u)/r),n-=i*r):n<i&&(i=Math.ceil(Math.abs(n-i)/r),n+=i*r),n},toJson:function(){var n={x:this.x,y:this.y},t=this.spatialReference;return t&&(n.spatialReference=t.toJson()),n}}),n.lngLatToXY=s,n.xyToLngLat=h,n.defaultProps=c,n.metersPerDegree=6378137*Math.PI/180,i("extend-esri")&&(t.setObject("geometry.Point",n,r),r.geometry.defaultPoint=c),n})},"esri/SpatialReference":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ./kernel ./lang".split(" "),function(n,t,i,r,u,f){var e=[-20037508.342788905,20037508.342788905],o=[-20037508.342787,20037508.342787];return n=n(null,{declaredClass:"esri.SpatialReference",constructor:function(n){n&&(i.isObject(n)?i.mixin(this,n):i.isString(n)?this.wkt=n:this.wkid=n)},wkid:null,wkt:null,_info:{102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:e,origin:o,dx:1e-5},102100:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:e,origin:o,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:e,origin:o,dx:1e-5},3857:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:e,origin:o,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",${Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,180],dx:1e-5}},_isWebMercator:function(){return-1!==t.indexOf([102113,102100,3857,3785],this.wkid)},_isWrappable:function(){return-1!==t.indexOf([102113,102100,3857,3785,4326],this.wkid)},_getInfo:function(){return this.wkid?this._info[this.wkid]:null},_canProject:function(n){var t=!1;return n&&(t=this.isWebMercator()&&4326===n.wkid||n.isWebMercator()&&4326===this.wkid),t},isWebMercator:function(){return this._isWebMercator()},equals:function(n){var t=!1;return n&&(this===n&&(t=!0),this.wkid||n.wkid?t=this.wkid===n.wkid||this.isWebMercator()&&n.isWebMercator()||this.wkid===n.latestWkid||n.wkid===this.latestWkid:this.wkt&&n.wkt&&(t=this.wkt.toUpperCase()===n.wkt.toUpperCase())),t},toJson:function(){var n=null,t=f.isDefined;return t(this.wkid)?n={wkid:this.wkid}:t(this.wkt)&&(n={wkt:this.wkt}),n&&t(this.latestWkid)&&(n.latestWkid=this.latestWkid),n}}),r("extend-esri")&&(u.SpatialReference=n),n})},"esri/geometry/Geometry":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../SpatialReference"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.geometry.Geometry",spatialReference:null,type:null,cache:void 0,setSpatialReference:function(n){return this.spatialReference=n,this},verifySR:function(){this.spatialReference||this.setSpatialReference(new u(4326))},getExtent:function(){return null},clearCache:function(){this.cache=void 0},getCacheValue:function(n){return this.cache&&this.cache[n]},setCacheValue:function(n,t){this.cache||(this.cache={});this.cache[n]=t}}),i("extend-esri")&&t.setObject("geometry.Geometry",n,r),n})},"esri/srUtils":function(){define(["./SpatialReference","./ImageSpatialReference","./kernel","./sniff","dojo/_base/lang"],function(n,t,i,r,u){function f(n){var t=!1;return n&&(n.ics||n.icsid)&&(t=!0),t}var e={isICS:f,createSpatialReference:function(i){var r=null;return i&&(r=f(i)?new t(i):new n(i)),r}};return r("extend-esri")&&u.mixin(i,e),e})},"esri/ImageSpatialReference":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./lang ./SpatialReference".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.ImageSpatialReference",constructor:function(n){n&&t.isObject(n)&&t.mixin(this,n)},icsid:null,icsns:null,ics:null,_isWebMercator:function(){return!1},_isWrappable:function(){return!1},equals:function(n){var t=!1;return n&&(this.icsid&&n.icsid?(t=this.icsid===n.icsid,this.icsns||n.icsns)&&(t=t&&this.icsns===n.icsns):this.ics&&n.ics&&(t=this.ics===n.ics)),t},toJson:function(n){var t=null,i=u.isDefined;return n=i(n)?n:!0,i(this.icsid)?(t={icsid:this.icsid},i(this.icsns)&&(t.icsns=this.icsns)):i(this.ics)&&(t={ics:this.ics}),i(this.url)&&i(t)&&n&&(t.url=this.url),t}}),i("extend-esri")&&(r.ImageSpatialReference=n),n})},"esri/geometry/Extent":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./webMercatorUtils ./mathUtils ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){var v={type:"extent",xmin:0,ymin:0,xmax:0,ymax:0},a=n(o,{declaredClass:"esri.geometry.Extent",constructor:function(n,t,r,u,f){i.mixin(this,v);i.isObject(n)?(i.mixin(this,n),this.spatialReference&&(this.spatialReference=l.createSpatialReference(this.spatialReference))):this.update(n,t,r,u,f);this.verifySR()},getWidth:function(){return Math.abs(this.xmax-this.xmin)},getHeight:function(){return Math.abs(this.ymax-this.ymin)},getCenter:function(){return new s((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2,this.spatialReference)},centerAt:function(n){var t=this.getCenter(),i=n.x-t.x;return n=n.y-t.y,new a(this.xmin+i,this.ymin+n,this.xmax+i,this.ymax+n,this.spatialReference)},update:function(n,t,i,r,u){return this.xmin=n,this.ymin=t,this.xmax=i,this.ymax=r,this.spatialReference=u,this.clearCache(),this},offset:function(n,t){return new a(this.xmin+n,this.ymin+t,this.xmax+n,this.ymax+t,this.spatialReference)},expand:function(n){var t=(1-n)/2;return n=this.getWidth()*t,t*=this.getHeight(),new a(this.xmin+n,this.ymin+t,this.xmax-n,this.ymax-t,this.spatialReference)},intersects:function(n){if(!n)return!1;var r=n.type,t=this.spatialReference,i=n.spatialReference;t&&i&&!t.equals(i)&&t._canProject(i)&&(n=t.isWebMercator()?h.geographicToWebMercator(n):h.webMercatorToGeographic(n,!0));switch(r){case"point":return this.contains(n);case"multipoint":return this._intersectsMultipoint(n);case"extent":return this._intersectsExtent(n);case"polygon":return this._intersectsPolygon(n);case"polyline":return this._intersectsPolyline(n)}},normalize:function(){var n=this._normalize(!1,!0);return i.isArray(n)||(n=[n]),n},shiftCentralMeridian:function(){return this._normalize(!0)},bisect:function(){var i=this.spatialReference,t=i&&i._getInfo(),r=[],h=0;if(t&&this._isOutOfBounds(t)){var n=this,h=n.xmin,u=n.ymin,f=n.ymax,c=t.valid[0],o=t.valid[1];n.getWidth()>2*o&&(n=n.getCenter(),n=new a(n.x-o,u,n.x+o,f,new e(i.toJson())));var h=n.xmin-h,s=this._normalizeX(n.xmin,t),t=this._normalizeX(n.xmax,t);s.frameId===t.frameId?r.push(new a(s.x,u,t.x,f,new e(i.toJson()))):r.push(new a(s.x,u,o,f,new e(i.toJson())),new a(c,u,t.x,f,new e(i.toJson())))}else r.push(this.getExtent());return{extents:r,marginLeft:h}},_intersectsMultipoint:function(n){for(var i=n.points.length,t=0;t<i;t++)if(this.contains(n.getPoint(t)))return!0;return!1},_intersectsExtent:function(n){var t,i,u,f,r=!1;return this.xmin<=n.xmin?(t=n.xmin,this.xmax<t?r=!0:u=Math.min(this.xmax,n.xmax)-t):(t=this.xmin,n.xmax<t?r=!0:u=Math.min(this.xmax,n.xmax)-t),this.ymin<=n.ymin?(i=n.ymin,this.ymax<i?r=!0:f=Math.min(this.ymax,n.ymax)-i):(i=this.ymin,n.ymax<i?r=!0:f=Math.min(this.ymax,n.ymax)-i),r?null:new a(t,i,t+u,i+f,this.spatialReference)},_intersectsPolygon:function(n){for(var o=[this.xmin,this.ymax],t=[this.xmax,this.ymax],u=[this.xmin,this.ymin],h=[this.xmax,this.ymin],i=[o,t,u,h],o=[[u,o],[o,t],[t,h],[h,u]],u=n.rings,h=u.length,r=new s(0,0,this.spatialReference),f,e,c=i.length,t=0;t<c;t++)if(r.update(i[t][0],i[t][1]),n.contains(r))return!0;for(r.setSpatialReference(n.spatialReference),t=0;t<h;t++)if(i=u[t],c=i.length){if(f=i[0],r.update(f[0],f[1]),this.contains(r))return!0;for(n=1;n<c;n++){if(e=i[n],r.update(e[0],e[1]),this.contains(r)||this._intersectsLine([f,e],o))return!0;f=e}}return!1},_intersectsPolyline:function(n){var h=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],r,e=n.paths,c=e.length,u,o,t,i,f=new s(0,0,n.spatialReference);for(n=0;n<c;n++)if(u=e[n],o=u.length){if(t=u[0],f.update(t[0],t[1]),this.contains(f))return!0;for(r=1;r<o;r++){if(i=u[r],f.update(i[0],i[1]),this.contains(f)||this._intersectsLine([t,i],h))return!0;t=i}}return!1},_intersectsLine:function(n,t){for(var r=c._getLineIntersection2,u=t.length,i=0;i<u;i++)if(r(n,t[i]))return!0;return!1},contains:function(n){var t;if(!n)return!1;if(t=n.type,"point"===t){var i=this.spatialReference,r=n.spatialReference,t=n.x;return n=n.y,i&&r&&!i.equals(r)&&i._canProject(r)&&(n=i.isWebMercator()?s.lngLatToXY(t,n):s.xyToLngLat(t,n,!0),t=n[0],n=n[1]),t>=this.xmin&&t<=this.xmax&&n>=this.ymin&&n<=this.ymax}return"extent"===t?this._containsExtent(n):!1},_containsExtent:function(n){var t=n.xmin,i=n.ymin,f=n.xmax,r=n.ymax,u=n.spatialReference;return n=new s(t,i,u),t=new s(t,r,u),r=new s(f,r,u),i=new s(f,i,u),this.contains(n)&&this.contains(t)&&this.contains(r)&&this.contains(i)?!0:!1},union:function(n){return new a(Math.min(this.xmin,n.xmin),Math.min(this.ymin,n.ymin),Math.max(this.xmax,n.xmax),Math.max(this.ymax,n.ymax),this.spatialReference)},getExtent:function(){var n=this.spatialReference;return new a(this.xmin,this.ymin,this.xmax,this.ymax,n&&new e(n.toJson()))},_shiftCM:function(n){var t=this.getCacheValue("_shifted"),r,i,u;return t||(t=new a(this.toJson()),r=t.spatialReference,(n=n||r._getInfo())&&(i=this._getCM(n),i&&(u=r._isWebMercator()?h.webMercatorToGeographic(i):i,t.xmin-=i.x,t.xmax-=i.x,r._isWebMercator()||(u.x=this._normalizeX(u.x,n).x),t.setSpatialReference(new e(f.substitute({Central_Meridian:u.x},4326===r.wkid?n.altTemplate:n.wkTemplate))))),this.setCacheValue("_shifted",t)),t},_getCM:function(n){var t;return this._isOutOfBounds(n)&&(t=this.getCenter()),t},_isOutOfBounds:function(n){var r=n.valid[0],t,i;return n=n.valid[1],t=this.xmin,i=this.xmax,!(t>=r&&t<=n&&i>=r&&i<=n)},_normalize:function(n,i,r){var u=new a(this.toJson()),e=u.spatialReference,f;return e&&(r=r||e._getInfo())?(f=t.map(this._getParts(r),function(n){return n.extent}),2<f.length?n?this._shiftCM(r):u.update(r.valid[0],u.ymin,r.valid[1],u.ymax,e):2===f.length?n?this._shiftCM(r):i?f:{rings:t.map(f,function(n){return[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]}),spatialReference:e}:f[0]||u):u},_getParts:function(n){var c=this.getCacheValue("_parts");if(!c){var c=[],t=this.xmin,e=this.xmax,f=this.ymin,r=this.ymax,i=this.spatialReference,l=this.getWidth(),v=t,y=e,h=0,u=0,o,s;if(n=n||i._getInfo(),o=n.valid[0],s=n.valid[1],u=this._normalizeX(t,n),t=u.x,h=u.frameId,u=this._normalizeX(e,n),e=u.x,u=u.frameId,n=t===e&&0<l,l>2*s){for(l=new a(v<y?t:e,f,s,r,i),t=new a(o,f,v<y?e:t,r,i),s=new a(0,f,s,r,i),f=new a(o,f,0,r,i),i=[],o=[],l.contains(s)&&i.push(h),l.contains(f)&&o.push(h),t.contains(s)&&i.push(u),t.contains(f)&&o.push(u),r=h+1;r<u;r++)i.push(r),o.push(r);c.push({extent:l,frameIds:[h]},{extent:t,frameIds:[u]},{extent:s,frameIds:i},{extent:f,frameIds:o})}else t>e||n?c.push({extent:new a(t,f,s,r,i),frameIds:[h]},{extent:new a(o,f,e,r,i),frameIds:[u]}):c.push({extent:new a(t,f,e,r,i),frameIds:[h]});this.setCacheValue("_parts",c)}return c},_normalizeX:function(n,t){var i=0,f=t.valid[0],u=t.valid[1],r=2*u;return n>u?(i=Math.ceil(Math.abs(n-u)/r),n-=i*r):n<f&&(i=Math.ceil(Math.abs(n-f)/r),n+=i*r,i=-i),{x:n,frameId:i}},toJson:function(){var n={xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax},t=this.spatialReference;return t&&(n.spatialReference=t.toJson()),n}});return a.defaultProps=v,r("extend-esri")&&(i.setObject("geometry.Extent",a,u),u.geometry.defaultExtent=v),a})},"esri/geometry/webMercatorUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/has ../kernel ../SpatialReference ./Point".split(" "),function(n,t,i,r,u,f){function e(t,i,r,f){var s,e,o,c,h;return"point"===t.type?(e=i(t.x,t.y,f),new t.constructor(e[0],e[1],new u(r))):"extent"===t.type?(e=i(t.xmin,t.ymin,f),s=i(t.xmax,t.ymax,f),new t.constructor(e[0],e[1],s[0],s[1],new u(r))):"polyline"===t.type||"polygon"===t.type?(e="polyline"===t.type,o=[],n.forEach(e?t.paths:t.rings,function(t){o.push(c=[]);n.forEach(t,function(n){c.push(i(n[0],n[1],f))})}),e?new t.constructor({paths:o,spatialReference:new u(r)}):new t.constructor({rings:o,spatialReference:new u(r)})):"multipoint"===t.type?(h=[],n.forEach(t.points,function(n){h.push(i(n[0],n[1],f))}),new t.constructor({points:h,spatialReference:new u(r)})):void 0}function o(n,t){var i=n&&(null!=n.wkid?n:n.spatialReference),r=t&&(null!=t.wkid?t:t.spatialReference);return i&&r?r.equals(i)?!0:r._canProject(i):!1}var s={canProject:o,project:function(n,t){var r=n&&n.spatialReference,i=t&&(null!=t.wkid?t:t.spatialReference);return r&&i?r.equals(i)?n=new n.constructor(n.toJson()):o(r,i)?i.isWebMercator()?n=e(n,f.lngLatToXY,{wkid:102100}):4326===i.wkid&&(n=e(n,f.xyToLngLat,{wkid:4326})):n=null:n=null,n},lngLatToXY:f.lngLatToXY,xyToLngLat:f.xyToLngLat,metersPerDegree:f.metersPerDegree,geographicToWebMercator:function(n){return e(n,f.lngLatToXY,{wkid:102100})},webMercatorToGeographic:function(n,t){return e(n,f.xyToLngLat,{wkid:4326},t)}};return i("extend-esri")&&t.mixin(t.getObject("geometry",!0,r),s),s})},"esri/geometry/mathUtils":function(){define(["dojo/_base/lang","dojo/has","../kernel","./Point"],function(n,t,i,r){function f(n,t,i){return n instanceof r?new r(n.x+i*(t.x-n.x),n.y+i*(t.y-n.y)):[n[0]+i*(t[0]-n[0]),n[1]+i*(t[1]-n[1])]}function u(n,t){return 1e-8>Math.abs(n-t)}function e(n,t,i,r){var f,e=u(n[0],t[0])?1e10:(n[1]-t[1])/(n[0]-t[0]),s=u(i[0],r[0])?1e10:(i[1]-r[1])/(i[0]-r[0]),o=n[1]-e*n[0],h=i[1]-s*i[0];if(u(e,s)){if(u(o,h)){if(u(n[0],t[0]))if(Math.min(n[1],t[1])<Math.max(i[1],r[1])||Math.max(n[1],t[1])>Math.min(i[1],r[1]))n=(n[1]+t[1]+i[1]+r[1]-Math.min(n[1],t[1],i[1],r[1])-Math.max(n[1],t[1],i[1],r[1]))/2,f=(n-o)/e;else return null;else if(Math.min(n[0],t[0])<Math.max(i[0],r[0])||Math.max(n[0],t[0])>Math.min(i[0],r[0]))f=(n[0]+t[0]+i[0]+r[0]-Math.min(n[0],t[0],i[0],r[0])-Math.max(n[0],t[0],i[0],r[0]))/2,n=e*f+o;else return null;return[f,n]}return null}return u(e,1e10)?(f=n[0],n=s*f+h):u(s,1e10)?(f=i[0],n=e*f+o):(f=-(o-h)/(e-s),n=n[1]===t[1]?n[1]:i[1]===r[1]?i[1]:e*f+o),[f,n]}var o={getLength:function(n,t){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)},_getLength:function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(i*i+r*r)},getPointOnLine:f,getMidpoint:function(n,t){return f(n,t,.5)},_equals:u,_getLineIntersection:e,getLineIntersection:function(n,t,i,u,f){return(n=e([n.x,n.y],[t.x,t.y],[i.x,i.y],[u.x,u.y]))&&(n=new r(n[0],n[1],f)),n},_getLineIntersection2:function(n,t){var u=n[0],f=n[1],i=t[0],e=t[1],o=u[0],u=u[1],c=f[0],f=f[1],r=i[0],s=i[1],i=e[0]-r,r=o-r,l=c-o,e=e[1]-s,s=u-s,a=f-u,h=e*l-i*a;return 0===h?!1:(i=(i*s-e*r)/h,r=(l*s-a*r)/h,0<=i&&1>=i&&0<=r&&1>=r?[o+i*(c-o),u+i*(f-u)]:!1)},_pointLineDistance:function(n,t){var i=t[0],r=t[1],e=i[0],u=i[1],i=n[0],c=n[1],o=r[0]-e,s=r[1]-u,h=i-e,a=c-u,r=Math.sqrt,f=Math.pow,l=r(f(o,2)+f(s,2)),h=(h*o+a*s)/(l*l),u=u+h*s;return r(f(i-(e+h*o),2)+f(c-u,2))}};return t("extend-esri")&&n.mixin(n.getObject("geometry",!0,i),o),o})},"esri/urlUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/url dojo/io-query ./kernel ./lang ./config ./sniff dojo/i18n!./nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s){var c=function(){return this}(),h={},l=e.defaults.io,y=/^[a-z][a-z0-9\+\-\.]*:/i,a=/^\s*http:/i,v=/^\s*https:/i;return h.isHTTP=function(n){var t=c.location.protocol;return null==n?"http:"===t||"https:"===t:n?"https:"===t:"http:"===t},h.getProtocolForWebResource=function(n){return h.isHTTP()?c.location.protocol:n?"https:":"http:"},h.urlToObject=function(n){var t={},u=new i(n),f=n.indexOf("?");return null===u.query?t={path:n,query:null}:(t.path=n.substring(0,f),t.query=r.queryToObject(u.query)),u.fragment&&(t.hash=u.fragment,null===u.query&&(t.path=t.path.substring(0,t.path.length-(u.fragment.length+1)))),t},h.getProxyUrl=function(t,i){var r=n.isString(t)?0===n.trim(t).toLowerCase().indexOf("https:"):t,u=l.proxyUrl,f,e,o=s.io.proxyNotSet;if(n.isString(t)&&(e=h.getProxyRule(t))&&(u=e.proxyUrl),!u)throw console.log(o),Error(o);return r&&!1!==i&&0!==c.location.href.toLowerCase().indexOf("https:")&&(r=u,0!==r.toLowerCase().indexOf("http")&&(r=h.getAbsoluteUrl(r)),r=r.replace(/^http:/i,"https:"),h.canUseXhr(r)&&(u=r,f=1)),u=h.urlToObject(u),u._xo=f,u},h.addProxy=function(t){var u=h.getProxyRule(t),i;return u?i=h.urlToObject(u.proxyUrl):l.alwaysUseProxy&&(i=h.getProxyUrl()),i&&(u=h.urlToObject(t),t=i.path+"?"+u.path,(i=r.objectToQuery(n.mixin(i.query||{},u.query)))&&(t+="?"+i)),t},h.addProxyRule=function(n){for(var u=n.urlPrefix=h.urlToObject(n.urlPrefix).path.replace(/([^\/])$/,"$1/").replace(/^https?:\/\//ig,"").toLowerCase(),f=l.proxyRules,e=f.length,i,r=e,t=0;t<e;t++)if(i=f[t].urlPrefix,0===u.indexOf(i)){if(u.length===i)return-1;r=t;break}else 0===i.indexOf(u)&&(r=t+1);return f.splice(r,0,n),r},h.getProxyRule=function(n){var t=l.proxyRules,r=t.length,u=h.urlToObject(n).path.replace(/([^\/])$/,"$1/").replace(/^https?:\/\//ig,"").toLowerCase(),i;for(n=0;n<r;n++)if(0===u.indexOf(t[n].urlPrefix)){i=t[n];break}return i},h.hasSameOrigin=function(t,r,u){t=t.toLowerCase();r=r.toLowerCase();var f=c.location.href.toLowerCase();return t=0===t.indexOf("http")?new i(t):f=new i(f),r=0===r.indexOf("http")?new i(r):n.isString(f)?new i(f):f,(u||t.scheme===r.scheme)&&t.host===r.host&&t.port===r.port},h.canUseXhr=function(i,r){var u=o("esri-phonegap")?!0:!1,s=h.hasSameOrigin,f=l.corsEnabledServers,e,c=-1;return!u&&o("esri-cors")&&f&&f.length&&(u=t.some(f,function(t,r){var u=t&&"object"==typeof t?t.host:t;return u&&(e=0!==n.trim(u).toLowerCase().indexOf("http"),s(i,e?"http://"+u:u)||e&&s(i,"https://"+u))?(c=r,!0):!1})),r?c:u},h.getAbsoluteUrl=function(t){var i=h.getProtocolForWebResource();return n.isString(t)&&!y.test(t)?0===t.indexOf("//")?i+t:0===t.indexOf("/")?i+"//"+c.location.host+t:u._appBaseUrl+t:t},h.fixUrl=function(t){return t=n.trim(t),t=h.getAbsoluteUrl(t),t=h.downgradeToHTTP(t),t=h.upgradeToHTTPS(t),t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")},h.normalize=function(n){return h.fixUrl(n)},h.downgradeToHTTP=function(n){return h.isHTTP(!1)&&v.test(n)&&h.hasSameOrigin(c.location.href,n,!0)&&!h.canUseXhr(n)?n.replace(v,"http:"):n},h.upgradeToHTTPS=function(t){var o=e.defaults.io.httpsDomains,r=h.isHTTP(!1),u=h.isHTTP(!0),s;if(!a.test(t))return t;t=n.trim(t);var i=t.indexOf("/",7),i=-1===i?t:t.slice(0,i),i=i.toLowerCase().slice(7);if(r&&i===c.location.host)return t;if(r=!1,u&&i===c.location.host)r=!0;else if(o)for(u=0;u<o.length;u++)if(s=o[u],i===s||f.endsWith(i,"."+s)){r=!0;break}return r&&(t=t.replace(a,"https:")),t},o("extend-esri")&&(n.mixin(u,h),u._getProxyUrl=h.getProxyUrl,u._getProxiedUrl=h.addProxy,u._hasSameOrigin=h.hasSameOrigin,u._canDoXOXHR=h.canUseXhr,u._getAbsoluteUrl=h.getAbsoluteUrl,u.fixUrl=h.fixUrl),h})},"dojo/_base/url":function(){define(["./kernel"],function(n){var i=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/,r=/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,t=function(){for(var u,e,f=arguments,n=[f[0]],o=1;o<f.length;o++)if(f[o]){if(u=new t(f[o]+""),n=new t(n[0]+""),""!=u.path||u.scheme||u.authority||u.query){if(!u.scheme&&(u.scheme=n.scheme,!u.authority&&(u.authority=n.authority,"/"!=u.path.charAt(0)))){for(n=(n.path.substring(0,n.path.lastIndexOf("/")+1)+u.path).split("/"),e=0;e<n.length;e++)"."==n[e]?e==n.length-1?n[e]="":(n.splice(e,1),e--):0<e&&(1!=e||""!=n[0])&&".."==n[e]&&".."!=n[e-1]&&(e==n.length-1?(n.splice(e,1),n[e-1]=""):(n.splice(e-1,2),e-=2));u.path=n.join("/")}}else null!=u.fragment&&(n.fragment=u.fragment),u=n;n=[];u.scheme&&n.push(u.scheme,":");u.authority&&n.push("//",u.authority);n.push(u.path);u.query&&n.push("?",u.query);u.fragment&&n.push("#",u.fragment)}this.uri=n.join("");f=this.uri.match(i);this.scheme=f[2]||(f[1]?"":null);this.authority=f[4]||(f[3]?"":null);this.path=f[5];this.query=f[7]||(f[6]?"":null);this.fragment=f[9]||(f[8]?"":null);null!=this.authority&&(f=this.authority.match(r),this.user=f[3]||null,this.password=f[4]||null,this.host=f[6]||f[7],this.port=f[9]||null)};return t.prototype.toString=function(){return this.uri},n._Url=t})},"esri/PluginTarget":function(){define("require dojo/aspect dojo/_base/array dojo/_base/lang dojo/Deferred dojo/when".split(" "),function(n,t,i,r,u,f){function e(){t.after(this.constructor._meta,"ctor",this._pluginsHandler,!0);this._plugins={}}return e.prototype={addPlugin:function(t,i){var o=this,e=this._plugins,r=new u;try{n([t],function(n){t in e?r.resolve({id:e[t].declaredId||t.replace(/\//g,".")}):(e[t]=n,f(n.add(o,i),function(){var i={id:n.declaredId||t.replace(/\//g,".")};o.emit("plugin-add",i);r.resolve(i)},function(n){r.reject(n)}))})}catch(s){r.reject(s)}return r.promise},removePlugin:function(n){if(n in this._plugins){var t=this._plugins[n];t.remove(this);delete this._plugins[n];this.emit("plugin-remove",{id:t.declaredId||n.replace(/\//g,".")})}},_pluginsHandler:function(){var n=this;i.some(arguments,function(t){if(t&&t.plugins&&t.plugins instanceof Array){t=t.plugins;for(var i,u,r=0;r<t.length;r++)i=t[r],u=i instanceof Object?i.id:i,n.addPlugin(u,i.options);return!0}})}},e})},"esri/Color":function(){define(["dojo/_base/declare","dojo/_base/Color","dojo/has","./kernel"],function(n,t,i,r){n=n([t],{declaredClass:"esri.Color"});n.toJsonColor=function(n){return n&&[n.r,n.g,n.b,1<n.a?n.a:Math.round(255*n.a)]};n.toDojoColor=function(n){return n&&new t([n[0],n[1],n[2],n[3]/255])};for(var f="named blendColors fromRgb fromHex fromArray fromString".split(" "),u=0;u<f.length;u++)n[f[u]]=t[f[u]];return i("extend-esri")&&(r.Color=n),n})},"esri/arcade/Dictionary":function(){define(["require","exports","./languageUtils","../geometry/Geometry","./ImmutableArray"],function(n,t,i,r,u){return function(){function n(t){this.attributes=null;this.plain=!1;this.immutable=!0;this.attributes=t instanceof n?t.attributes:void 0===t?{}:null===t?{}:t}return n.prototype.field=function(n){var i=n.toLowerCase(),t;if(n=this.attributes[n],void 0!==n)return n;for(t in this.attributes)if(t.toLowerCase()===i)return this.attributes[t];throw Error("Field not Found");},n.prototype.setField=function(n,t){var r,i;if(this.immutable)throw Error("Dictionary is Immutable");if(r=n.toLowerCase(),void 0===this.attributes[n])for(i in this.attributes)if(i.toLowerCase()===r){this.attributes[i]=t;return}this.attributes[n]=t},n.prototype.hasField=function(n){var i=n.toLowerCase(),t;if(void 0!==this.attributes[n])return!0;for(t in this.attributes)if(t.toLowerCase()===i)return!0;return!1},n.prototype.keys=function(){var n=[];for(var t in this.attributes)n.push(t);return n.sort()},n.prototype.castToText=function(){var t="",f,n;for(f in this.attributes)""!==t&&(t+=","),n=this.attributes[f],null==n?n="null":i.isBoolean(n)||i.isNumber(n)||i.isString(n)?t+=JSON.stringify(f)+":"+JSON.stringify(n):n instanceof r?t+=JSON.stringify(f)+":"+i.toStringExplicit(n):n instanceof u?t+=JSON.stringify(f)+":"+i.toStringExplicit(n):n instanceof Array?t+=JSON.stringify(f)+":"+i.toStringExplicit(n):n instanceof Date?t+=JSON.stringify(f)+":"+JSON.stringify(n):null!==n&&"object"==typeof n&&void 0!==n.castToText&&(t+=JSON.stringify(f)+":"+n.castToText());return"{"+t+"}"},n}()})},"esri/arcade/languageUtils":function(){define("require exports ../geometry/Geometry ../moment dojo/number ./ImmutableArray ../kernel ./ImmutablePointArray ./ImmutablePathArray dojo/_base/array ../geometry/Point ../geometry/Polyline ../geometry/Polygon ../geometry/Extent ../geometry/Multipoint ./FunctionWrapper".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function tt(n,t,i){if(""===t||null===t||void 0===t||t===i||t===i)return n;do n=n.replace(t,i);while(-1!==n.indexOf(t));return n}function et(n){return n instanceof at||n instanceof p||n instanceof vt}function k(n){return"string"==typeof n||n instanceof String}function g(n){return"boolean"==typeof n}function nt(n){return"number"==typeof n}function it(n){return n instanceof Array}function d(n){return n instanceof Date}function ot(n,t){return!1===isNaN(n)?void 0===t||null===t||""===t?n.toString():(t=tt(t,"",""),t=tt(t,"",""),u.format(n,{pattern:t})):n.toString()}function ut(n,t){var i=r(n);return void 0===t||null===t||""===t?i.format():i.format(st(t))}function st(n){return n.replace(/(LTS)|L|l/g,function(n){return"["+n+"]"})}function w(n,t,i){switch(i){case">":return n>t;case"<":return n<t;case">=":return n>=t;case"<=":return n<=t}return!1}function ht(n,i){if(n===i||null===n&&i===t.voidOperation||null===i&&n===t.voidOperation)return!0;if(d(n)&&d(i))return n.getTime()===i.getTime();if(n instanceof s||n instanceof o)return n.equalityTest(i);if(n instanceof c&&i instanceof c){var r=void 0,u=void 0;if(t.isVersion4?(r=n.cache._arcadeCacheId,u=i.cache._arcadeCacheId):(r=n.getCacheValue("_arcadeCacheId"),u=i.getCacheValue("_arcadeCacheId")),void 0!==r&&null!==r)return r===u}return void 0!==n&&void 0!==i&&null!==n&&null!==i&&"object"==typeof n&&"object"==typeof i&&(n._arcadeCacheId===i._arcadeCacheId&&void 0!==n._arcadeCacheId&&null!==n._arcadeCacheId||n._underlyingGraphic===i._underlyingGraphic&&void 0!==n._underlyingGraphic&&null!==n._underlyingGraphic)?!0:!1}function rt(n,t){if(k(n))return n;if(null===n)return"";if(nt(n))return ot(n,t);if(g(n))return n.toString();if(d(n))return ut(n,t);if(n instanceof i)return JSON.stringify(n.toJson());if(it(n)){for(var u=[],r=0;r<n.length;r++)u[r]=ft(n[r]);return"["+u.join(",")+"]"}if(n instanceof f){for(u=[],r=0;r<n.length();r++)u[r]=ft(n.get(r));return"["+u.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():et(n)?"object, Function":""}function ct(n,t){if(k(n))return n;if(null===n)return"";if(nt(n))return ot(n,t);if(g(n))return n.toString();if(d(n))return ut(n,t);if(n instanceof i)return JSON.stringify(n.toJson());if(it(n)){for(var u=[],r=0;r<n.length;r++)u[r]=ft(n[r]);return"["+u.join(",")+"]"}if(n instanceof f){for(u=[],r=0;r<n.length();r++)u[r]=ft(n.get(r));return"["+u.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():et(n)?"object, Function":""}function ft(n){if(null!==n){if(g(n)||nt(n)||k(n))return JSON.stringify(n);if(n instanceof i||n instanceof f||n instanceof Array)return ct(n);if(n instanceof Date)return JSON.stringify(ut(n,""));if(null!==n&&"object"==typeof n&&void 0!==n.castToText)return n.castToText()}return"null"}function b(n,i){return nt(n)?n:null===n||""===n?0:d(n)?NaN:g(n)?n?1:0:it(n)||""===n||void 0===n?NaN:void 0!==i&&k(n)?(i=tt(i,"",""),i=tt(i,"",""),u.parse(n,{pattern:i})):n===t.voidOperation?0:Number(n)}function lt(n,t){var i;return h.some(t.fields,function(t){return t.name===n&&(i=t.domain),!!i}),i}Object.defineProperty(t,"__esModule",{value:!0});n=function(){return function(n){this.value=n}}();var yt=function(){return function(n){this.value=n}}(),at=function(){return function(n){this.fn=n}}(),vt=function(){return function(n){this.fn=n}}();t.NativeFunction=at;t.ImplicitResult=yt;t.ReturnResult=n;t.SizzleFunction=vt;t.isVersion4=0===e.version.indexOf("4.");t.voidOperation={type:"VOID"};t.breakResult={type:"BREAK"};t.continueResult={type:"CONTINUE"};t.multiReplace=tt;t.isFunctionParameter=et;t.isSimpleType=function(n){return k(n)||nt(n)||d(n)||g(n)||null===n||n===t.voidOperation||"number"==typeof n?!0:!1};t.defaultUndefined=function(n,t){return void 0===n?t:n};t.isString=k;t.isBoolean=g;t.isNumber=nt;t.isArray=it;t.isFeatureCursor=function(n){return n&&void 0!==n.isFeatureCursor};t.isImmutableArray=function(n){return n instanceof f};t.isDate=d;t.pcCheck=function(n,t,i){if(n.length<t||n.length>i)throw Error("Function called with wrong number of Parameters");};t.generateUUID=function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===t?i:i&3|8).toString(16)})};t.formatNumber=ot;t.formatDate=ut;t.standardiseDateFormat=st;t.greaterThanLessThan=function(n,i,r){if(null===n){if(null===i||i===t.voidOperation)return w(null,null,r);if(nt(i))return w(0,i,r);if(k(i)||g(i))return w(0,b(i),r);if(d(i))return w(0,i.getTime(),r)}if(n===t.voidOperation){if(null===i||i===t.voidOperation)return w(null,null,r);if(nt(i))return w(0,i,r);if(k(i)||g(i))return w(0,b(i),r);if(d(i))return w(0,i.getTime(),r)}else if(nt(n)){if(nt(i))return w(n,i,r);if(g(i))return w(n,b(i),r);if(null===i||i===t.voidOperation)return w(n,0,r);if(k(i))return w(n,b(i),r);if(d(i))return w(n,i.getTime(),r)}else if(k(n)){if(k(i))return w(rt(n),rt(i),r);if(d(i))return w(b(n),i.getTime(),r);if(nt(i))return w(b(n),i,r);if(null===i||i===t.voidOperation)return w(b(n),0,r);if(g(i))return w(b(n),b(i),r)}else if(d(n)){if(d(i))return w(n,i,r);if(null===i||i===t.voidOperation)return w(n.getTime(),0,r);if(nt(i))return w(n.getTime(),i,r);if(g(i)||k(i))return w(n.getTime(),b(i),r)}else if(g(n)){if(g(i))return w(n,i,r);if(nt(i))return w(b(n),b(i),r);if(d(i))return w(b(n),i.getTime(),r);if(null===i||i===t.voidOperation)return w(b(n),0,r);if(k(i))return w(b(n),b(i),r)}return!ht(n,i)||"<="!==r&&">="!==r?!1:!0};t.equalityTest=ht;t.toString=rt;t.toNumberArray=function(n){var i=[],t;if(!1===it(n))return null;if(n instanceof f){for(t=0;t<n.length();t++)i[t]=b(n.get(t));return i}for(t=0;t<n.length;t++)i[t]=b(n[t]);return i};t.toStringExplicit=ct;t.toNumber=b;t.toDate=function(n,t){if(d(n))return n;if(k(n)){var i=r(n,[void 0===t||null===t||""===t?r.ISO_8601:t]);if(i.isValid())return i.toDate()}return null};t.toDateM=function(n,t){if(d(n))return r(n);if(k(n)){var i=r(n,[void 0===t||null===t||""===t?r.ISO_8601:t]);if(i.isValid())return i}return null};t.toBoolean=function(n){if(g(n))return n;if(k(n)){if(n=n.toLowerCase(),"true"===n)return!0}else if(nt(n))return 0===n||isNaN(n)?!1:!0;return!1};t.fixSpatialReference=function(n,t){return null===n||void 0===n?null:((null===n.spatialReference||void 0===n.spatialReference)&&(n.spatialReference=t),n)};t.fixNullGeometry=function(n){return null===n?null:n instanceof c?"NaN"===n.x||null===n.x||isNaN(n.x)?null:n:n instanceof a?0===n.rings.length?null:n:n instanceof l?0===n.paths.length?null:n:n instanceof y?0===n.points.length?null:n:n instanceof v?"NaN"===n.xmin||null===n.xmin||isNaN(n.xmin)?null:n:null};t.getDomainValue=function(n,t){var i,r,u;if(!n||!n.domain)return null;for(i=null,t="string"===n.field.type||"esriFieldTypeString"===n.field.type?rt(t):b(t),r=0;r<n.domain.codedValues.length;r++)u=n.domain.codedValues[r],u.code===t&&(i=u);return null===i?null:i.name};t.getDomainCode=function(n,t){var i,r,u;if(!n||!n.domain)return null;for(i=null,t=rt(t),r=0;r<n.domain.codedValues.length;r++)u=n.domain.codedValues[r],u.name===t&&(i=u);return null===i?null:i.code};t.getDomain=function(n,t,i,r){var u,e,o,f,s;if(void 0===i&&(i=null),!t||!t.fields)return null;for(u=null,e=0;e<t.fields.length;e++)o=t.fields[e],o.name.toLowerCase()===n.toString().toLowerCase()&&(u=o);return null===u?null:(r||(r=i&&t.typeIdField&&i._field(t.typeIdField)),null!=r&&h.some(t.types,function(n){return n.id===r?((f=n.domains&&n.domains[u.name])&&"inherited"===f.type&&(f=lt(u.name,t),s=!0),!0):!1}),s||f||(f=lt(n,t)),{field:u,domain:f})}})},"esri/moment":function(){define(["require","exports","./plugins/moment!"],function(n,t,i){return i})},"esri/plugins/moment":function(){define(["require","exports","dojo/_base/kernel","moment/moment"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});var u={ar:1,"ar-dz":1,"ar-kw":1,"ar-ly":1,"ar-ma":1,"ar-sa":1,"ar-tn":1,bs:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":1,"en-gb":1,"en-ie":1,"en-nz":1,es:1,"es-do":1,et:1,fi:1,fr:1,"fr-ca":1,"fr-ch":1,he:1,hi:1,hr:1,id:1,it:1,ja:1,ko:1,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,sr:1,"sr-cyrl":1,sv:1,th:1,tr:1,vi:1,"zh-cn":1,"zh-hk":1,"zh-tw":1};t.load=function(n,t,f){var e,o;n=i.locale;e=n in u;e||(o=n.split("-"),1<o.length&&o[0]in u&&(n=o[0],e=!0));e?t(["moment/locale/"+n],function(){f(r)}):f(r)}})},"moment/moment":function(){(function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.moment=t()})(this,function(){function t(){return ae.apply(null,arguments)}function tt(n){return n instanceof Array||"[object Array]"===Object.prototype.toString.call(n)}function hi(n){return null!=n&&"[object Object]"===Object.prototype.toString.call(n)}function w(n){return void 0===n}function ri(n){return"number"==typeof n||"[object Number]"===Object.prototype.toString.call(n)}function bi(n){return n instanceof Date||"[object Date]"===Object.prototype.toString.call(n)}function tf(n,t){for(var r=[],i=0;i<n.length;++i)r.push(t(n[i],i));return r}function l(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function vt(n,t){for(var i in t)l(t,i)&&(n[i]=t[i]);return l(t,"toString")&&(n.toString=t.toString),l(t,"valueOf")&&(n.valueOf=t.valueOf),n}function ut(n,t,i,r){return df(n,t,i,r,!0).utc()}function u(n){return null==n._pf&&(n._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),n._pf}function yr(n){if(null==n._isValid){var t=u(n),i=ns.call(t.parsedDateParts,function(n){return null!=n}),i=!isNaN(n._d.getTime())&&0>t.overflow&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&i);if(n._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(n))return i;n._isValid=i}return n._isValid}function ki(n){var t=ut(NaN);return null!=n?vt(u(t),n):u(t).userInvalidated=!0,t}function pr(n,t){var i,r,f;if(w(t._isAMomentObject)||(n._isAMomentObject=t._isAMomentObject),w(t._i)||(n._i=t._i),w(t._f)||(n._f=t._f),w(t._l)||(n._l=t._l),w(t._strict)||(n._strict=t._strict),w(t._tzm)||(n._tzm=t._tzm),w(t._isUTC)||(n._isUTC=t._isUTC),w(t._offset)||(n._offset=t._offset),w(t._pf)||(n._pf=u(t)),w(t._locale)||(n._locale=t._locale),0<hu.length)for(i=0;i<hu.length;i++)r=hu[i],f=t[r],w(f)||(n[r]=f);return n}function ci(n){pr(this,n);this._d=new Date(null!=n._d?n._d.getTime():NaN);this.isValid()||(this._d=new Date(NaN));!1===cu&&(cu=!0,t.updateOffset(this),cu=!1)}function yt(n){return n instanceof ci||null!=n&&null!=n._isAMomentObject}function d(n){return 0>n?Math.ceil(n)||0:Math.floor(n)}function f(n){n=+n;var t=0;return 0!==n&&isFinite(n)&&(t=d(n)),t}function rf(n,t,i){for(var e=Math.min(n.length,t.length),o=Math.abs(n.length-t.length),u=0,r=0;r<e;r++)(i&&n[r]!==t[r]||!i&&f(n[r])!==f(t[r]))&&u++;return u+o}function uf(n){!1===t.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+n)}function g(n,i){var r=!0;return vt(function(){var e,u,f,o;if(null!=t.deprecationHandler&&t.deprecationHandler(null,n),r){for(e=[],f=0;f<arguments.length;f++){if(u="","object"==typeof arguments[f]){u+="\n["+f+"] ";for(o in arguments[0])u+=o+": "+arguments[0][o]+", ";u=u.slice(0,-2)}else u=arguments[f];e.push(u)}uf(n+"\nArguments: "+Array.prototype.slice.call(e).join("")+"\n"+Error().stack);r=!1}return i.apply(this,arguments)},i)}function ff(n,i){null!=t.deprecationHandler&&t.deprecationHandler(n,i);ve[n]||(uf(i),ve[n]=!0)}function ft(n){return n instanceof Function||"[object Function]"===Object.prototype.toString.call(n)}function ef(n,t){var r=vt({},n);for(var i in t)l(t,i)&&(hi(n[i])&&hi(t[i])?(r[i]={},vt(r[i],n[i]),vt(r[i],t[i])):null!=t[i]?r[i]=t[i]:delete r[i]);for(i in n)l(n,i)&&!l(t,i)&&hi(n[i])&&(r[i]=vt({},r[i]));return r}function wr(n){null!=n&&this.set(n)}function b(n,t){var i=n.toLowerCase();vi[i]=vi[i+"s"]=vi[t]=n}function nt(n){if("string"==typeof n)return vi[n]||vi[n.toLowerCase()]}function br(n){var i={},r;for(var t in n)l(n,t)&&(r=nt(t))&&(i[r]=n[t]);return i}function oo(n){var t=[];for(var i in n)t.push({unit:i,priority:p[i]});return t.sort(function(n,t){return n.priority-t.priority}),t}function ui(n,i){return function(r){return null!=r?(this.isValid()&&this._d["set"+(this._isUTC?"UTC":"")+n](r),t.updateOffset(this,i),this):di(this,n)}}function di(n,t){return n.isValid()?n._d["get"+(n._isUTC?"UTC":"")+t]():NaN}function ht(n,t,i){var r=""+Math.abs(n);return(0<=n?i?"+":"":"-")+Math.pow(10,Math.max(0,t-r.length)).toString().substr(1)+r}function r(n,t,i,r){var u=r;"string"==typeof r&&(u=function(){return this[r]()});n&&(si[n]=u);t&&(si[t[0]]=function(){return ht(u.apply(this,arguments),t[1],t[2])});i&&(si[i]=function(){return this.localeData().ordinal(u.apply(this,arguments),n)})}function so(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function ho(n){for(var t=n.match(ye),i=0,r=t.length;i<r;i++)t[i]=si[t[i]]?si[t[i]]:so(t[i]);return function(i){for(var f="",u=0;u<r;u++)f+=ft(t[u])?t[u].call(i,n):t[u];return f}}function kr(n,t){return n.isValid()?(t=of(t,n.localeData()),lu[t]=lu[t]||ho(t),lu[t](n)):n.localeData().invalidDate()}function of(n,t){function r(n){return t.longDateFormat(n)||n}var i=5;for(er.lastIndex=0;0<=i&&er.test(n);)n=n.replace(er,r),er.lastIndex=0,--i;return n}function i(n,t,i){yu[n]=ft(t)?t:function(n){return n&&i?i:t}}function co(n,t){return l(yu,n)?yu[n](t._strict,t._locale):new RegExp(lo(n))}function lo(n){return dt(n.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(n,t,i,r,u){return t||i||r||u}))}function dt(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function s(n,t){var i,r=t;for("string"==typeof n&&(n=[n]),ri(t)&&(r=function(n,i){i[t]=f(n)}),i=0;i<n.length;i++)pu[n[i]]=r}function li(n,t){s(n,function(n,i,r,u){r._w=r._w||{};t(n,r._w,r,u)})}function dr(n,t){return new Date(Date.UTC(n,t+1,0)).getUTCDate()}function sf(n,t){var i;if(!n.isValid())return n;if("string"==typeof t)if(/^\d+$/.test(t))t=f(t);else if(t=n.localeData().monthsParse(t),!ri(t))return n;return i=Math.min(n.date(),dr(n.year(),t)),n._d["set"+(n._isUTC?"UTC":"")+"Month"](t,i),n}function hf(n){return null!=n?(sf(this,n),t.updateOffset(this,!0),this):di(this,"Month")}function cf(){function f(n,t){return t.length-n.length}for(var i=[],r=[],t=[],u,n=0;12>n;n++)u=ut([2e3,n]),i.push(this.monthsShort(u,"")),r.push(this.months(u,"")),t.push(this.months(u,"")),t.push(this.monthsShort(u,""));for(i.sort(f),r.sort(f),t.sort(f),n=0;12>n;n++)i[n]=dt(i[n]),r[n]=dt(r[n]);for(n=0;24>n;n++)t[n]=dt(t[n]);this._monthsShortRegex=this._monthsRegex=new RegExp("^("+t.join("|")+")","i");this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+i.join("|")+")","i")}function fi(n){return 0==n%4&&0!=n%100||0==n%400}function ao(n,t,i,r,u,f,e){return t=new Date(n,t,i,r,u,f,e),100>n&&0<=n&&isFinite(t.getFullYear())&&t.setFullYear(n),t}function gi(n){var t=new Date(Date.UTC.apply(null,arguments));return 100>n&&0<=n&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(n),t}function nr(n,t,i){return i=7+t-i,-((7+gi(n,0,i).getUTCDay()-t)%7)+i-1}function lf(n,t,i,r,u){return i=(7+i-r)%7,r=nr(n,r,u),r=1+7*(t-1)+i+r,0>=r?(t=n-1,n=(fi(t)?366:365)+r):r>(fi(n)?366:365)?(t=n+1,n=r-(fi(n)?366:365)):(t=n,n=r),{year:t,dayOfYear:n}}function ai(n,t,i){var r=nr(n.year(),t,i),r=Math.floor((n.dayOfYear()-r-1)/7)+1;return 1>r?(n=n.year()-1,t=r+gt(n,t,i)):r>gt(n.year(),t,i)?(t=r-gt(n.year(),t,i),n=n.year()+1):(n=n.year(),t=r),{week:t,year:n}}function gt(n,t,i){var r=nr(n,t,i);return t=nr(n+1,t,i),((fi(n)?366:365)-r+t)/7}function vo(n,t,i){var r,u;if(n=n.toLocaleLowerCase(),!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;7>r;++r)u=ut([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(u,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(u,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(u,"").toLocaleLowerCase();if(i)t="dddd"===t?y.call(this._weekdaysParse,n):"ddd"===t?y.call(this._shortWeekdaysParse,n):y.call(this._minWeekdaysParse,n);else if("dddd"===t){if((t=y.call(this._weekdaysParse,n),-1!==t)||(t=y.call(this._shortWeekdaysParse,n),-1!==t))return t;t=y.call(this._minWeekdaysParse,n)}else if("ddd"===t){if((t=y.call(this._shortWeekdaysParse,n),-1!==t)||(t=y.call(this._weekdaysParse,n),-1!==t))return t;t=y.call(this._minWeekdaysParse,n)}else{if((t=y.call(this._minWeekdaysParse,n),-1!==t)||(t=y.call(this._weekdaysParse,n),-1!==t))return t;t=y.call(this._shortWeekdaysParse,n)}return-1!==t?t:null}function gr(){function f(n,t){return t.length-n.length}for(var e=[],r=[],u=[],t=[],i,o,s,n=0;7>n;n++)i=ut([2e3,1]).day(n),o=this.weekdaysMin(i,""),s=this.weekdaysShort(i,""),i=this.weekdays(i,""),e.push(o),r.push(s),u.push(i),t.push(o),t.push(s),t.push(i);for(e.sort(f),r.sort(f),u.sort(f),t.sort(f),n=0;7>n;n++)r[n]=dt(r[n]),u[n]=dt(u[n]),t[n]=dt(t[n]);this._weekdaysMinRegex=this._weekdaysShortRegex=this._weekdaysRegex=new RegExp("^("+t.join("|")+")","i");this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+e.join("|")+")","i")}function nu(){return this.hours()%12||12}function af(n,t){r(n,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function vf(n,t){return t._meridiemParse}function yf(n){return n?n.toLowerCase().replace("_","-"):n}function pf(n){var t=null;if(!a[n]&&"undefined"!=typeof module&&module&&module.exports)try{t=ar._abbr;require("./locale/"+n);ei(t)}catch(i){}return a[n]}function ei(n,t){var i;return n&&(i=w(t)?pt(n):tu(n,t))&&(ar=i),ar._abbr}function tu(n,t){if(null!==t){var i=de;if(t.abbr=n,null!=a[n])ff("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),i=a[n]._config;else if(null!=t.parentLocale)if(null!=a[t.parentLocale])i=a[t.parentLocale]._config;else return pi[t.parentLocale]||(pi[t.parentLocale]=[]),pi[t.parentLocale].push({name:n,config:t}),null;return a[n]=new wr(ef(i,t)),pi[n]&&pi[n].forEach(function(n){tu(n.name,n.config)}),ei(n),a[n]}return delete a[n],null}function pt(n){var t,i,r,f,u;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return ar;if(!tt(n)){if(t=pf(n))return t;n=[n]}n:{for(t=0;t<n.length;){for(u=yf(n[t]).split("-"),i=u.length,r=(r=yf(n[t+1]))?r.split("-"):null;0<i;){if(f=pf(u.slice(0,i).join("-"))){n=f;break n}if(r&&r.length>=i&&rf(u,r,!0)>=i-1)break;i--}t++}n=null}return n}function iu(n){var t;return(t=n._a)&&-2===u(n).overflow&&(t=0>t[ct]||11<t[ct]?ct:1>t[ot]||t[ot]>dr(t[it],t[ct])?ot:0>t[v]||24<t[v]||24===t[v]&&(0!==t[rt]||0!==t[lt]||0!==t[ii])?v:0>t[rt]||59<t[rt]?rt:0>t[lt]||59<t[lt]?lt:0>t[ii]||999<t[ii]?ii:-1,u(n)._overflowDayOfYear&&(t<it||t>ot)&&(t=ot),u(n)._overflowWeeks&&-1===t&&(t=rs),u(n)._overflowWeekday&&-1===t&&(t=us),u(n).overflow=t),n}function wf(n){var t,r,i,o,e,f,s;if(t=n._i,i=es.exec(t)||os.exec(t),i){for(u(n).iso=!0,t=0,r=vr.length;t<r;t++)if(vr[t][1].exec(i[1])){e=vr[t][0];o=!1!==vr[t][2];break}if(null==e)n._isValid=!1;else{if(i[3]){for(t=0,r=ku.length;t<r;t++)if(ku[t][1].exec(i[3])){f=(i[2]||" ")+ku[t][0];break}if(null==f){n._isValid=!1;return}}if(o||null==f){if(i[4])if(ss.exec(i[4]))s="Z";else{n._isValid=!1;return}n._f=e+(f||"")+(s||"");tr(n)}else n._isValid=!1}}else n._isValid=!1}function bf(n){var t,f,e,o,i={" GMT":" +0000"," EDT":" -0400"," EST":" -0500"," CDT":" -0500"," CST":" -0600"," MDT":" -0600"," MST":" -0700"," PDT":" -0700"," PST":" -0800"},r,s;if(t=n._i.replace(/\([^\)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s|\s$/g,""),t=cs.exec(t)){if(f=t[1]?"ddd"+(5===t[1].length?", ":" "):"",e="D MMM "+(10<t[2].length?"YYYY ":"YY "),o="HH:mm"+(t[4]?":ss":""),t[1]&&(s="Sun Mon Tue Wed Thu Fri Sat".split(" ")[new Date(t[2]).getDay()],t[1].substr(0,3)!==s)){u(n).weekdayMismatch=!0;n._isValid=!1;return}switch(t[5].length){case 2:0===r?i=" +0000":(r="YXWVUTSRQPONZABCDEFGHIKLM".indexOf(t[5][1].toUpperCase())-12,i=(0>r?" -":" +")+(""+r).replace(/^-?/,"0").match(/..$/)[0]+"00");break;case 4:i=i[t[5]];break;default:i=i[" GMT"]}t[5]=i;n._i=t.splice(1).join("");n._f=f+e+o+" ZZ";tr(n);u(n).rfc2822=!0}else n._isValid=!1}function yo(n){var i=hs.exec(n._i);null!==i?n._d=new Date(+i[1]):(wf(n),!1===n._isValid&&(delete n._isValid,bf(n),!1===n._isValid&&(delete n._isValid,t.createFromInputFallback(n))))}function oi(n,t,i){return null!=n?n:null!=t?t:i}function ru(n){var i,a=[],f,r,l,o,e,s,h;if(!n._d){for(f=new Date(t.now()),f=n._useUTC?[f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate()]:[f.getFullYear(),f.getMonth(),f.getDate()],n._w&&null==n._a[ot]&&null==n._a[ct]&&(r=n._w,null!=r.GG||null!=r.W||null!=r.E?(s=1,h=4,l=oi(r.GG,n._a[it],ai(c(),1,4).year),o=oi(r.W,1),e=oi(r.E,1),1>e||7<e)&&(i=!0):(s=n._locale._week.dow,h=n._locale._week.doy,o=ai(c(),s,h),l=oi(r.gg,n._a[it],o.year),o=oi(r.w,o.week),null!=r.d)?(e=r.d,0>e||6<e)&&(i=!0):null!=r.e?(e=r.e+s,0>r.e||6<r.e)&&(i=!0):e=s,1>o||o>gt(l,s,h)?u(n)._overflowWeeks=!0:null!=i?u(n)._overflowWeekday=!0:(i=lf(l,o,e,s,h),n._a[it]=i.year,n._dayOfYear=i.dayOfYear)),null!=n._dayOfYear&&(i=oi(n._a[it],f[it]),(n._dayOfYear>(fi(i)?366:365)||0===n._dayOfYear)&&(u(n)._overflowDayOfYear=!0),i=gi(i,0,n._dayOfYear),n._a[ct]=i.getUTCMonth(),n._a[ot]=i.getUTCDate()),i=0;3>i&&null==n._a[i];++i)n._a[i]=a[i]=f[i];for(;7>i;i++)n._a[i]=a[i]=null==n._a[i]?2===i?1:0:n._a[i];24===n._a[v]&&0===n._a[rt]&&0===n._a[lt]&&0===n._a[ii]&&(n._nextDay=!0,n._a[v]=0);n._d=(n._useUTC?gi:ao).apply(null,a);null!=n._tzm&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm);n._nextDay&&(n._a[v]=24)}}function tr(n){if(n._f===t.ISO_8601)wf(n);else if(n._f===t.RFC_2822)bf(n);else{n._a=[];u(n).empty=!0;for(var i=""+n._i,f,e,h,o=i.length,c=0,r=of(n._f,n._locale).match(ye)||[],s=0;s<r.length;s++)e=r[s],(f=(i.match(co(e,n))||[])[0])&&(h=i.substr(0,i.indexOf(f)),0<h.length&&u(n).unusedInput.push(h),i=i.slice(i.indexOf(f)+f.length),c+=f.length),si[e]?(f?u(n).empty=!1:u(n).unusedTokens.push(e),h=n,null!=f&&l(pu,e))&&pu[e](f,h._a,h,e):n._strict&&!f&&u(n).unusedTokens.push(e);u(n).charsLeftOver=o-c;0<i.length&&u(n).unusedInput.push(i);12>=n._a[v]&&!0===u(n).bigHour&&0<n._a[v]&&(u(n).bigHour=void 0);u(n).parsedDateParts=n._a.slice(0);u(n).meridiem=n._meridiem;i=n._a;s=v;o=n._locale;r=n._a[v];c=n._meridiem;null!=c&&(null!=o.meridiemHour?r=o.meridiemHour(r,c):null!=o.isPM&&((o=o.isPM(c))&&12>r&&(r+=12),o||12!==r||(r=0)));i[s]=r;ru(n);iu(n)}}function po(n){if(!n._d){var t=br(n._i);n._a=tf([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(n){return n&&parseInt(n,10)});ru(n)}}function kf(n){var t=n._i,r=n._f,i,e,f;if(n._locale=n._locale||pt(n._l),null===t||void 0===r&&""===t)return ki({nullInput:!0});if("string"==typeof t&&(n._i=t=n._locale.preparse(t)),yt(t))return new ci(iu(t));if(bi(t))n._d=t;else if(tt(r))if(0===n._f.length)u(n).invalidFormat=!0,n._d=new Date(NaN);else{for(t=0;t<n._f.length;t++)(r=0,i=pr({},n),null!=n._useUTC&&(i._useUTC=n._useUTC),i._f=n._f[t],tr(i),yr(i)&&(r+=u(i).charsLeftOver,r+=10*u(i).unusedTokens.length,u(i).score=r,null==f||r<f))&&(f=r,e=i);vt(n,e||i)}else r?tr(n):wo(n);return yr(n)||(n._d=null),n}function wo(n){var i=n._i;w(i)?n._d=new Date(t.now()):bi(i)?n._d=new Date(i.valueOf()):"string"==typeof i?yo(n):tt(i)?(n._a=tf(i.slice(0),function(n){return parseInt(n,10)}),ru(n)):hi(i)?po(n):ri(i)?n._d=new Date(i):t.createFromInputFallback(n)}function df(n,t,i,r,u){var f={},e,o;if((!0===i||!1===i)&&(r=i,i=void 0),e=hi(n))n:{e=n;for(o in e){e=!1;break n}e=!0}return(e||tt(n)&&0===n.length)&&(n=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=u,f._l=i,f._i=n,f._f=t,f._strict=r,n=new ci(iu(kf(f))),n._nextDay&&(n.add(1,"d"),n._nextDay=void 0),n}function c(n,t,i,r){return df(n,t,i,r,!1)}function gf(n,t){var r,i;if(1===t.length&&tt(t[0])&&(t=t[0]),!t.length)return c();for(r=t[0],i=1;i<t.length;++i)(!t[i].isValid()||t[i][n](r))&&(r=t[i]);return r}function bo(n){var t,i;for(t in n)if(-1===wi.indexOf(t)||null!=n[t]&&isNaN(n[t]))return!1;for(t=!1,i=0;i<wi.length;++i)if(n[wi[i]]){if(t)return!1;parseFloat(n[wi[i]])!==f(n[wi[i]])&&(t=!0)}return!0}function ir(n){n=br(n);var t=n.year||0,i=n.quarter||0,r=n.month||0,u=n.week||0,f=n.day||0,e=n.hour||0,o=n.minute||0,s=n.second||0,h=n.millisecond||0;this._isValid=bo(n);this._milliseconds=+h+1e3*s+6e4*o+36e5*e;this._days=+f+7*u;this._months=+r+3*i+12*t;this._data={};this._locale=pt();this._bubble()}function uu(n){return n instanceof ir}function fu(n){return 0>n?-1*Math.round(-1*n):Math.round(n)}function ne(n,t){r(n,0,0,function(){var n=this.utcOffset(),i="+";return 0>n&&(n=-n,i="-"),i+ht(~~(n/60),2)+t+ht(~~n%60,2)})}function eu(n,t){var i=(t||"").match(n),r;return null===i?null:(i=((i[i.length-1]||[])+"").match(ge)||["-",0,0],r=+(60*i[1])+f(i[2]),0===r?0:"+"===i[0]?r:-r)}function ou(n,i){var r,u;return i._isUTC?(r=i.clone(),u=(yt(n)||bi(n)?n.valueOf():c(n).valueOf())-r.valueOf(),r._d.setTime(r._d.valueOf()+u),t.updateOffset(r,!1),r):c(n).local()}function te(){return this.isValid()?this._isUTC&&0===this._offset:!1}function et(n,t){var i=n,r=null;return uu(n)?i={ms:n._milliseconds,d:n._days,M:n._months}:ri(n)?(i={},t?i[t]=n:i.milliseconds=n):(r=no.exec(n))?(i="-"===r[1]?-1:1,i={y:0,d:f(r[ot])*i,h:f(r[v])*i,m:f(r[rt])*i,s:f(r[lt])*i,ms:f(fu(1e3*r[ii]))*i}):(r=to.exec(n))?(i="-"===r[1]?-1:1,i={y:ni(r[2],i),M:ni(r[3],i),w:ni(r[4],i),d:ni(r[5],i),h:ni(r[6],i),m:ni(r[7],i),s:ni(r[8],i)}):null==i?i={}:"object"==typeof i&&("from"in i||"to"in i)&&(r=c(i.from),i=c(i.to),r.isValid()&&i.isValid()?(i=ou(i,r),r.isBefore(i)?i=ie(r,i):(i=ie(i,r),i.milliseconds=-i.milliseconds,i.months=-i.months),r=i):r={milliseconds:0,months:0},i={},i.ms=r.milliseconds,i.M=r.months),i=new ir(i),uu(n)&&l(n,"_locale")&&(i._locale=n._locale),i}function ni(n,t){var i=n&&parseFloat(n.replace(",","."));return(isNaN(i)?0:i)*t}function ie(n,t){var i={milliseconds:0,months:0};return i.months=t.month()-n.month()+12*(t.year()-n.year()),n.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+n.clone().add(i.months,"M"),i}function re(n,t){return function(i,r){var u;return null===r||isNaN(+r)||(ff(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),u=i,i=r,r=u),u=et("string"==typeof i?+i:i,r),ue(this,u,n),this}}function ue(n,i,r,u){var f=i._milliseconds,e=fu(i._days);i=fu(i._months);n.isValid()&&(u=null==u?!0:u,f&&n._d.setTime(n._d.valueOf()+f*r),e&&(f=di(n,"Date")+e*r,n.isValid())&&n._d["set"+(n._isUTC?"UTC":"")+"Date"](f),i&&sf(n,di(n,"Month")+i*r),u&&t.updateOffset(n,e||i))}function fe(n){return void 0===n?this._locale._abbr:(n=pt(n),null!=n&&(this._locale=n),this)}function ee(){return this._locale}function rr(n,t){r(0,[n,n.length],0,t)}function oe(n,t,i,r,u){var f;return null==n?ai(this,r,u).year:(f=gt(n,r,u),t>f&&(t=f),n=lf(n,t,i,r,u),n=gi(n.year,0,n.dayOfYear),this.year(n.getUTCFullYear()),this.month(n.getUTCMonth()),this.date(n.getUTCDate()),this)}function ko(n,t){t[ii]=f(1e3*("0."+n))}function se(n){return n}function ur(n,t,i,r){var u=pt();return t=ut().set(r,t),u[i](t,n)}function he(n,t,i){if(ri(n)&&(t=n,n=void 0),n=n||"",null!=t)return ur(n,t,i,"month");var r=[];for(t=0;12>t;t++)r[t]=ur(n,t,i,"month");return r}function su(n,t,i,r){"boolean"!=typeof n&&(i=t=n,n=!1);ri(t)&&(i=t,t=void 0);t=t||"";var u=pt();if(n=n?u._week.dow:0,null!=i)return ur(t,(i+n)%7,r,"day");for(u=[],i=0;7>i;i++)u[i]=ur(t,(i+n)%7,r,"day");return u}function ce(n,t,i,r){return t=et(t,i),n._milliseconds+=r*t._milliseconds,n._days+=r*t._days,n._months+=r*t._months,n._bubble()}function le(n){return 0>n?Math.floor(n):Math.ceil(n)}function wt(n){return function(){return this.as(n)}}function ti(n){return function(){return this.isValid()?this._data[n]:NaN}}function go(n,t,i,r,u){return u.relativeTime(t||1,!!i,n,r)}function fr(){if(!this.isValid())return this.localeData().invalidDate();var t=nf(this._milliseconds)/1e3,u=nf(this._days),i=nf(this._months),n,r;n=d(t/60);r=d(n/60);t%=60;n%=60;var f=d(i/12),i=i%12,e=this.asSeconds();return e?(0>e?"-":"")+"P"+(f?f+"Y":"")+(i?i+"M":"")+(u?u+"D":"")+(r||n||t?"T":"")+(r?r+"H":"")+(n?n+"M":"")+(t?t+"S":""):"P0D"}var ae,ns=Array.prototype.some?Array.prototype.some:function(n){for(var i=Object(this),r=i.length>>>0,t=0;t<r;t++)if(t in i&&n.call(this,i[t],t,i))return!0;return!1},hu=t.momentProperties=[],cu=!1,ve={},wu,bu,ge,no,to,io,ro,du,gu,uo,fo,bt,eo,n,o;t.suppressDeprecationWarnings=!1;t.deprecationHandler=null;var ts=Object.keys?Object.keys:function(n){var t,i=[];for(t in n)l(n,t)&&i.push(t);return i},vi={},p={},ye=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,er=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,lu={},si={},pe=/\d/,k=/\d\d/,we=/\d{3}/,au=/\d{4}/,or=/[+-]?\d{6}/,h=/\d\d?/,be=/\d\d\d\d?/,ke=/\d\d\d\d\d\d?/,sr=/\d{1,3}/,vu=/\d{1,4}/,hr=/[+-]?\d{1,6}/,cr=/[+-]?\d+/,is=/Z|[+-]\d\d:?\d\d/gi,lr=/Z|[+-]\d\d(?::?\d\d)?/gi,yi=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,yu={},pu={},it=0,ct=1,ot=2,v=3,rt=4,lt=5,ii=6,rs=7,us=8,y=Array.prototype.indexOf?Array.prototype.indexOf:function(n){for(var t=0;t<this.length;++t)if(this[t]===n)return t;return-1};r("M",["MM",2],"Mo",function(){return this.month()+1});r("MMM",0,0,function(n){return this.localeData().monthsShort(this,n)});r("MMMM",0,0,function(n){return this.localeData().months(this,n)});b("month","M");p.month=8;i("M",h);i("MM",h,k);i("MMM",function(n,t){return t.monthsShortRegex(n)});i("MMMM",function(n,t){return t.monthsRegex(n)});s(["M","MM"],function(n,t){t[ct]=f(n)-1});s(["MMM","MMMM"],function(n,t,i,r){r=i._locale.monthsParse(n,r,i._strict);null!=r?t[ct]=r:u(i).invalidMonth=n});wu=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;r("Y",0,0,function(){var n=this.year();return 9999>=n?""+n:"+"+n});r(0,["YY",2],0,function(){return this.year()%100});r(0,["YYYY",4],0,"year");r(0,["YYYYY",5],0,"year");r(0,["YYYYYY",6,!0],0,"year");b("year","y");p.year=1;i("Y",cr);i("YY",h,k);i("YYYY",vu,au);i("YYYYY",hr,or);i("YYYYYY",hr,or);s(["YYYYY","YYYYYY"],it);s("YYYY",function(n,i){i[it]=2===n.length?t.parseTwoDigitYear(n):f(n)});s("YY",function(n,i){i[it]=t.parseTwoDigitYear(n)});s("Y",function(n,t){t[it]=parseInt(n,10)});t.parseTwoDigitYear=function(n){return f(n)+(68<f(n)?1900:2e3)};bu=ui("FullYear",!0);r("w",["ww",2],"wo","week");r("W",["WW",2],"Wo","isoWeek");b("week","w");b("isoWeek","W");p.week=5;p.isoWeek=5;i("w",h);i("ww",h,k);i("W",h);i("WW",h,k);li(["w","ww","W","WW"],function(n,t,i,r){t[r.substr(0,1)]=f(n)});r("d",0,"do","day");r("dd",0,0,function(n){return this.localeData().weekdaysMin(this,n)});r("ddd",0,0,function(n){return this.localeData().weekdaysShort(this,n)});r("dddd",0,0,function(n){return this.localeData().weekdays(this,n)});r("e",0,0,"weekday");r("E",0,0,"isoWeekday");b("day","d");b("weekday","e");b("isoWeekday","E");p.day=11;p.weekday=11;p.isoWeekday=11;i("d",h);i("e",h);i("E",h);i("dd",function(n,t){return t.weekdaysMinRegex(n)});i("ddd",function(n,t){return t.weekdaysShortRegex(n)});i("dddd",function(n,t){return t.weekdaysRegex(n)});li(["dd","ddd","dddd"],function(n,t,i,r){r=i._locale.weekdaysParse(n,r,i._strict);null!=r?t.d=r:u(i).invalidWeekday=n});li(["d","e","E"],function(n,t,i,r){t[r]=f(n)});r("H",["HH",2],0,"hour");r("h",["hh",2],0,nu);r("k",["kk",2],0,function(){return this.hours()||24});r("hmm",0,0,function(){return""+nu.apply(this)+ht(this.minutes(),2)});r("hmmss",0,0,function(){return""+nu.apply(this)+ht(this.minutes(),2)+ht(this.seconds(),2)});r("Hmm",0,0,function(){return""+this.hours()+ht(this.minutes(),2)});r("Hmmss",0,0,function(){return""+this.hours()+ht(this.minutes(),2)+ht(this.seconds(),2)});af("a",!0);af("A",!1);b("hour","h");p.hour=13;i("a",vf);i("A",vf);i("H",h);i("h",h);i("k",h);i("HH",h,k);i("hh",h,k);i("kk",h,k);i("hmm",be);i("hmmss",ke);i("Hmm",be);i("Hmmss",ke);s(["H","HH"],v);s(["k","kk"],function(n,t){n=f(n);t[v]=24===n?0:n});s(["a","A"],function(n,t,i){i._isPm=i._locale.isPM(n);i._meridiem=n});s(["h","hh"],function(n,t,i){t[v]=f(n);u(i).bigHour=!0});s("hmm",function(n,t,i){var r=n.length-2;t[v]=f(n.substr(0,r));t[rt]=f(n.substr(r));u(i).bigHour=!0});s("hmmss",function(n,t,i){var r=n.length-4,e=n.length-2;t[v]=f(n.substr(0,r));t[rt]=f(n.substr(r,2));t[lt]=f(n.substr(e));u(i).bigHour=!0});s("Hmm",function(n,t,i){i=n.length-2;t[v]=f(n.substr(0,i));t[rt]=f(n.substr(i))});s("Hmmss",function(n,t,i){i=n.length-4;var r=n.length-2;t[v]=f(n.substr(0,i));t[rt]=f(n.substr(i,2));t[lt]=f(n.substr(r))});var fs=ui("Hours",!0),de={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),week:{dow:0,doy:6},weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),meridiemParse:/[ap]\.?m?\.?/i},a={},pi={},ar,es=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,os=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ss=/Z|[+-]\d\d(?::?\d\d)?/,vr=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],ku=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],hs=/^\/?Date\((\-?\d+)/i,cs=/^((?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d?\d\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(?:\d\d)?\d\d\s)(\d\d:\d\d)(\:\d\d)?(\s(?:UT|GMT|[ECMP][SD]T|[A-IK-Za-ik-z]|[+-]\d{4}))$/;t.createFromInputFallback=g("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))});t.ISO_8601=function(){};t.RFC_2822=function(){};var ls=g("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=c.apply(null,arguments);return this.isValid()&&n.isValid()?n<this?this:n:ki()}),as=g("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=c.apply(null,arguments);return this.isValid()&&n.isValid()?n>this?this:n:ki()}),wi="year quarter month week day hour minute second millisecond".split(" ");for(ne("Z",":"),ne("ZZ",""),i("Z",lr),i("ZZ",lr),s(["Z","ZZ"],function(n,t,i){i._useUTC=!0;i._tzm=eu(lr,n)}),ge=/([\+\-]|\d\d)/gi,t.updateOffset=function(){},no=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,to=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/,et.fn=ir.prototype,et.invalid=function(){return et(NaN)},io=re(1,"add"),ro=re(-1,"subtract"),t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]",du=g("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(n){return void 0===n?this.localeData():this.locale(n)}),r(0,["gg",2],0,function(){return this.weekYear()%100}),r(0,["GG",2],0,function(){return this.isoWeekYear()%100}),rr("gggg","weekYear"),rr("ggggg","weekYear"),rr("GGGG","isoWeekYear"),rr("GGGGG","isoWeekYear"),b("weekYear","gg"),b("isoWeekYear","GG"),p.weekYear=1,p.isoWeekYear=1,i("G",cr),i("g",cr),i("GG",h,k),i("gg",h,k),i("GGGG",vu,au),i("gggg",vu,au),i("GGGGG",hr,or),i("ggggg",hr,or),li(["gggg","ggggg","GGGG","GGGGG"],function(n,t,i,r){t[r.substr(0,2)]=f(n)}),li(["gg","GG"],function(n,i,r,u){i[u]=t.parseTwoDigitYear(n)}),r("Q",0,"Qo","quarter"),b("quarter","Q"),p.quarter=7,i("Q",pe),s("Q",function(n,t){t[ct]=3*(f(n)-1)}),r("D",["DD",2],"Do","date"),b("date","D"),p.date=9,i("D",h),i("DD",h,k),i("Do",function(n,t){return n?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),s(["D","DD"],ot),s("Do",function(n,t){t[ot]=f(n.match(h)[0],10)}),gu=ui("Date",!0),r("DDD",["DDDD",3],"DDDo","dayOfYear"),b("dayOfYear","DDD"),p.dayOfYear=4,i("DDD",sr),i("DDDD",we),s(["DDD","DDDD"],function(n,t,i){i._dayOfYear=f(n)}),r("m",["mm",2],0,"minute"),b("minute","m"),p.minute=14,i("m",h),i("mm",h,k),s(["m","mm"],rt),uo=ui("Minutes",!1),r("s",["ss",2],0,"second"),b("second","s"),p.second=15,i("s",h),i("ss",h,k),s(["s","ss"],lt),fo=ui("Seconds",!1),r("S",0,0,function(){return~~(this.millisecond()/100)}),r(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),r(0,["SSS",3],0,"millisecond"),r(0,["SSSS",4],0,function(){return 10*this.millisecond()}),r(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),r(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),r(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),r(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),r(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),b("millisecond","ms"),p.millisecond=16,i("S",sr,pe),i("SS",sr,k),i("SSS",sr,we),bt="SSSS";9>=bt.length;bt+="S")i(bt,/\d+/);for(bt="S";9>=bt.length;bt+="S")s(bt,ko);eo=ui("Milliseconds",!1);r("z",0,0,"zoneAbbr");r("zz",0,0,"zoneName");n=ci.prototype;n.add=io;n.calendar=function(n,i){var u=n||c(),r=ou(u,this).startOf("day"),r=t.calendarFormat(this,r)||"sameElse",f=i&&(ft(i[r])?i[r].call(this,u):i[r]);return this.format(f||this.localeData().calendar(r,this,c(u)))};n.clone=function(){return new ci(this)};n.diff=function(n,t,i){var r,u,f;return this.isValid()?(n=ou(n,this),!n.isValid())?NaN:(r=6e4*(n.utcOffset()-this.utcOffset()),t=nt(t),"year"===t||"month"===t||"quarter"===t?(r=12*(n.year()-this.year())+(n.month()-this.month()),u=this.clone().add(r,"months"),0>n-u?(f=this.clone().add(r-1,"months"),n=(n-u)/(u-f)):(f=this.clone().add(r+1,"months"),n=(n-u)/(f-u)),n=-(r+n)||0,"quarter"===t?n/=3:"year"===t&&(n/=12)):(n=this-n,n="second"===t?n/1e3:"minute"===t?n/6e4:"hour"===t?n/36e5:"day"===t?(n-r)/864e5:"week"===t?(n-r)/6048e5:n),i?n:d(n)):NaN};n.endOf=function(n){return(n=nt(n),void 0===n||"millisecond"===n)?this:("date"===n&&(n="day"),this.startOf(n).add(1,"isoWeek"===n?"week":n).subtract(1,"ms"))};n.format=function(n){return n||(n=this.isUtc()?t.defaultFormatUtc:t.defaultFormat),n=kr(this,n),this.localeData().postformat(n)};n.from=function(n,t){return this.isValid()&&(yt(n)&&n.isValid()||c(n).isValid())?et({to:this,from:n}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()};n.fromNow=function(n){return this.from(c(),n)};n.to=function(n,t){return this.isValid()&&(yt(n)&&n.isValid()||c(n).isValid())?et({from:this,to:n}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()};n.toNow=function(n){return this.to(c(),n)};n.get=function(n){return n=nt(n),ft(this[n])?this[n]():this};n.invalidAt=function(){return u(this).overflow};n.isAfter=function(n,t){var i=yt(n)?n:c(n);return!this.isValid()||!i.isValid()?!1:(t=nt(w(t)?"millisecond":t),"millisecond"===t?this.valueOf()>i.valueOf():i.valueOf()<this.clone().startOf(t).valueOf())};n.isBefore=function(n,t){var i=yt(n)?n:c(n);return!this.isValid()||!i.isValid()?!1:(t=nt(w(t)?"millisecond":t),"millisecond"===t?this.valueOf()<i.valueOf():this.clone().endOf(t).valueOf()<i.valueOf())};n.isBetween=function(n,t,i,r){return r=r||"()",("("===r[0]?this.isAfter(n,i):!this.isBefore(n,i))&&(")"===r[1]?this.isBefore(t,i):!this.isAfter(t,i))};n.isSame=function(n,t){var i=yt(n)?n:c(n);return!this.isValid()||!i.isValid()?!1:(t=nt(t||"millisecond"),"millisecond"===t)?this.valueOf()===i.valueOf():(i=i.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf())};n.isSameOrAfter=function(n,t){return this.isSame(n,t)||this.isAfter(n,t)};n.isSameOrBefore=function(n,t){return this.isSame(n,t)||this.isBefore(n,t)};n.isValid=function(){return yr(this)};n.lang=du;n.locale=fe;n.localeData=ee;n.max=as;n.min=ls;n.parsingFlags=function(){return vt({},u(this))};n.set=function(n,t){if("object"==typeof n){n=br(n);for(var r=oo(n),i=0;i<r.length;i++)this[r[i].unit](n[r[i].unit])}else if(n=nt(n),ft(this[n]))return this[n](t);return this};n.startOf=function(n){n=nt(n);switch(n){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===n&&this.weekday(0),"isoWeek"===n&&this.isoWeekday(1),"quarter"===n&&this.month(3*Math.floor(this.month()/3)),this};n.subtract=ro;n.toArray=function(){return[this.year(),this.month(),this.date(),this.hour(),this.minute(),this.second(),this.millisecond()]};n.toObject=function(){return{years:this.year(),months:this.month(),date:this.date(),hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()}};n.toDate=function(){return new Date(this.valueOf())};n.toISOString=function(){if(!this.isValid())return null;var n=this.clone().utc();return 0>n.year()||9999<n.year()?kr(n,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):ft(Date.prototype.toISOString)?this.toDate().toISOString():kr(n,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")};n.inspect=function(){var t,n,i;return this.isValid()?(n="moment",t="",this.isLocal()||(n=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z"),n="["+n+'("]',i=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY",this.format(n+i+"-MM-DD[T]HH:mm:ss.SSS"+(t+'[")]'))):"moment.invalid(/* "+this._i+" */)"};n.toJSON=function(){return this.isValid()?this.toISOString():null};n.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")};n.unix=function(){return Math.floor(this.valueOf()/1e3)};n.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)};n.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}};n.year=bu;n.isLeapYear=function(){return fi(this.year())};n.weekYear=function(n){return oe.call(this,n,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)};n.isoWeekYear=function(n){return oe.call(this,n,this.isoWeek(),this.isoWeekday(),1,4)};n.quarter=n.quarters=function(n){return null==n?Math.ceil((this.month()+1)/3):this.month(3*(n-1)+this.month()%3)};n.month=hf;n.daysInMonth=function(){return dr(this.year(),this.month())};n.week=n.weeks=function(n){var t=this.localeData().week(this);return null==n?t:this.add(7*(n-t),"d")};n.isoWeek=n.isoWeeks=function(n){var t=ai(this,1,4).week;return null==n?t:this.add(7*(n-t),"d")};n.weeksInYear=function(){var n=this.localeData()._week;return gt(this.year(),n.dow,n.doy)};n.isoWeeksInYear=function(){return gt(this.year(),1,4)};n.date=gu;n.day=n.days=function(n){var t,i;return this.isValid()?(t=this._isUTC?this._d.getUTCDay():this._d.getDay(),null!=n)?(i=this.localeData(),"string"==typeof n&&(isNaN(n)?(n=i.weekdaysParse(n),n="number"==typeof n?n:null):n=parseInt(n,10)),this.add(n-t,"d")):t:null!=n?this:NaN};n.weekday=function(n){if(!this.isValid())return null!=n?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==n?t:this.add(n-t,"d")};n.isoWeekday=function(n){if(!this.isValid())return null!=n?this:NaN;if(null!=n){var t=this.localeData();return n="string"==typeof n?t.weekdaysParse(n)%7||7:isNaN(n)?null:n,this.day(this.day()%7?n:n-7)}return this.day()||7};n.dayOfYear=function(n){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==n?t:this.add(n-t,"d")};n.hour=n.hours=fs;n.minute=n.minutes=uo;n.second=n.seconds=fo;n.millisecond=n.milliseconds=eo;n.utcOffset=function(n,i,r){var u=this._offset||0,f;if(!this.isValid())return null!=n?this:NaN;if(null!=n){if("string"==typeof n){if(n=eu(lr,n),null===n)return this}else 16>Math.abs(n)&&!r&&(n*=60);return!this._isUTC&&i&&(f=15*-Math.round(this._d.getTimezoneOffset()/15)),this._offset=n,this._isUTC=!0,null!=f&&this.add(f,"m"),u!==n&&(!i||this._changeInProgress?ue(this,et(n-u,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,t.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?u:15*-Math.round(this._d.getTimezoneOffset()/15)};n.utc=function(n){return this.utcOffset(0,n)};n.local=function(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract(15*-Math.round(this._d.getTimezoneOffset()/15),"m")),this};n.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var n=eu(is,this._i);null!=n?this.utcOffset(n):this.utcOffset(0,!0)}return this};n.hasAlignedHourOffset=function(n){return this.isValid()?(n=n?c(n).utcOffset():0,0==(this.utcOffset()-n)%60):!1};n.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()};n.isLocal=function(){return this.isValid()?!this._isUTC:!1};n.isUtcOffset=function(){return this.isValid()?this._isUTC:!1};n.isUtc=te;n.isUTC=te;n.zoneAbbr=function(){return this._isUTC?"UTC":""};n.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""};n.dates=g("dates accessor is deprecated. Use date instead.",gu);n.months=g("months accessor is deprecated. Use month instead",hf);n.years=g("years accessor is deprecated. Use year instead",bu);n.zone=g("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(n,t){return null!=n?("string"!=typeof n&&(n=-n),this.utcOffset(n,t),this):-this.utcOffset()});n.isDSTShifted=g("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){var n,t;return w(this._isDSTShifted)?(n={},pr(n,this),n=kf(n),n._a?(t=n._isUTC?ut(n._a):c(n._a),this._isDSTShifted=this.isValid()&&0<rf(n._a,t.toArray())):this._isDSTShifted=!1,this._isDSTShifted):this._isDSTShifted});o=wr.prototype;o.calendar=function(n,t,i){return n=this._calendar[n]||this._calendar.sameElse,ft(n)?n.call(t,i):n};o.longDateFormat=function(n){var t=this._longDateFormat[n],i=this._longDateFormat[n.toUpperCase()];return t||!i?t:(this._longDateFormat[n]=i.replace(/MMMM|MM|DD|dddd/g,function(n){return n.slice(1)}),this._longDateFormat[n])};o.invalidDate=function(){return this._invalidDate};o.ordinal=function(n){return this._ordinal.replace("%d",n)};o.preparse=se;o.postformat=se;o.relativeTime=function(n,t,i,r){var u=this._relativeTime[i];return ft(u)?u(n,t,i,r):u.replace(/%d/i,n)};o.pastFuture=function(n,t){var i=this._relativeTime[0<n?"future":"past"];return ft(i)?i(t):i.replace(/%s/i,t)};o.set=function(n){var t;for(var i in n)t=n[i],ft(t)?this[i]=t:this["_"+i]=t;this._config=n;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)};o.months=function(n,t){return n?tt(this._months)?this._months[n.month()]:this._months[(this._months.isFormat||wu).test(t)?"format":"standalone"][n.month()]:tt(this._months)?this._months:this._months.standalone};o.monthsShort=function(n,t){return n?tt(this._monthsShort)?this._monthsShort[n.month()]:this._monthsShort[wu.test(t)?"format":"standalone"][n.month()]:tt(this._monthsShort)?this._monthsShort:this._monthsShort.standalone};o.monthsParse=function(n,t,i){var r,u;if(this._monthsParseExact){n:{if(n=n.toLocaleLowerCase(),!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;12>r;++r)u=ut([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(u,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(u,"").toLocaleLowerCase();if(i)t="MMM"===t?y.call(this._shortMonthsParse,n):y.call(this._longMonthsParse,n);else if("MMM"===t){if(t=y.call(this._shortMonthsParse,n),-1!==t)break n;t=y.call(this._longMonthsParse,n)}else{if(t=y.call(this._longMonthsParse,n),-1!==t)break n;t=y.call(this._shortMonthsParse,n)}t=-1!==t?t:null}return t}for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;12>r;r++)if(u=ut([2e3,r]),i&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(u,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(u,"").replace(".","")+"$","i")),i||this._monthsParse[r]||(u="^"+this.months(u,"")+"|^"+this.monthsShort(u,""),this._monthsParse[r]=new RegExp(u.replace(".",""),"i")),i&&"MMMM"===t&&this._longMonthsParse[r].test(n)||i&&"MMM"===t&&this._shortMonthsParse[r].test(n)||!i&&this._monthsParse[r].test(n))return r};o.monthsRegex=function(n){return this._monthsParseExact?(l(this,"_monthsRegex")||cf.call(this),n?this._monthsStrictRegex:this._monthsRegex):(l(this,"_monthsRegex")||(this._monthsRegex=yi),this._monthsStrictRegex&&n?this._monthsStrictRegex:this._monthsRegex)};o.monthsShortRegex=function(n){return this._monthsParseExact?(l(this,"_monthsRegex")||cf.call(this),n?this._monthsShortStrictRegex:this._monthsShortRegex):(l(this,"_monthsShortRegex")||(this._monthsShortRegex=yi),this._monthsShortStrictRegex&&n?this._monthsShortStrictRegex:this._monthsShortRegex)};o.week=function(n){return ai(n,this._week.dow,this._week.doy).week};o.firstDayOfYear=function(){return this._week.doy};o.firstDayOfWeek=function(){return this._week.dow};o.weekdays=function(n,t){return n?tt(this._weekdays)?this._weekdays[n.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][n.day()]:tt(this._weekdays)?this._weekdays:this._weekdays.standalone};o.weekdaysMin=function(n){return n?this._weekdaysMin[n.day()]:this._weekdaysMin};o.weekdaysShort=function(n){return n?this._weekdaysShort[n.day()]:this._weekdaysShort};o.weekdaysParse=function(n,t,i){var r,u;if(this._weekdaysParseExact)return vo.call(this,n,t,i);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;7>r;r++)if(u=ut([2e3,1]).day(r),i&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(u,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(u,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(u,"").replace(".",".?")+"$","i")),this._weekdaysParse[r]||(u="^"+this.weekdays(u,"")+"|^"+this.weekdaysShort(u,"")+"|^"+this.weekdaysMin(u,""),this._weekdaysParse[r]=new RegExp(u.replace(".",""),"i")),i&&"dddd"===t&&this._fullWeekdaysParse[r].test(n)||i&&"ddd"===t&&this._shortWeekdaysParse[r].test(n)||i&&"dd"===t&&this._minWeekdaysParse[r].test(n)||!i&&this._weekdaysParse[r].test(n))return r};o.weekdaysRegex=function(n){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||gr.call(this),n?this._weekdaysStrictRegex:this._weekdaysRegex):(l(this,"_weekdaysRegex")||(this._weekdaysRegex=yi),this._weekdaysStrictRegex&&n?this._weekdaysStrictRegex:this._weekdaysRegex)};o.weekdaysShortRegex=function(n){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||gr.call(this),n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(l(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=yi),this._weekdaysShortStrictRegex&&n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)};o.weekdaysMinRegex=function(n){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||gr.call(this),n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(l(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=yi),this._weekdaysMinStrictRegex&&n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)};o.isPM=function(n){return"p"===(n+"").toLowerCase().charAt(0)};o.meridiem=function(n,t,i){return 11<n?i?"pm":"PM":i?"am":"AM"};ei("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var t=n%10,t=1===f(n%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return n+t}});t.lang=g("moment.lang is deprecated. Use moment.locale instead.",ei);t.langData=g("moment.langData is deprecated. Use moment.localeData instead.",pt);var at=Math.abs,vs=wt("ms"),ys=wt("s"),ps=wt("m"),ws=wt("h"),bs=wt("d"),ks=wt("w"),ds=wt("M"),gs=wt("y"),nh=ti("milliseconds"),th=ti("seconds"),ih=ti("minutes"),rh=ti("hours"),uh=ti("days"),fh=ti("months"),eh=ti("years"),kt=Math.round,st={ss:44,s:45,m:45,h:22,d:26,M:11},nf=Math.abs,e=ir.prototype;return e.isValid=function(){return this._isValid},e.abs=function(){var n=this._data;return this._milliseconds=at(this._milliseconds),this._days=at(this._days),this._months=at(this._months),n.milliseconds=at(n.milliseconds),n.seconds=at(n.seconds),n.minutes=at(n.minutes),n.hours=at(n.hours),n.months=at(n.months),n.years=at(n.years),this},e.add=function(n,t){return ce(this,n,t,1)},e.subtract=function(n,t){return ce(this,n,t,-1)},e.as=function(n){if(!this.isValid())return NaN;var t,i=this._milliseconds;if(n=nt(n),"month"===n||"year"===n)return t=this._days+i/864e5,t=this._months+4800*t/146097,"month"===n?t:t/12;t=this._days+Math.round(146097*this._months/4800);switch(n){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return 24*t+i/36e5;case"minute":return 1440*t+i/6e4;case"second":return 86400*t+i/1e3;case"millisecond":return Math.floor(864e5*t)+i;default:throw Error("Unknown unit "+n);}},e.asMilliseconds=vs,e.asSeconds=ys,e.asMinutes=ps,e.asHours=ws,e.asDays=bs,e.asWeeks=ks,e.asMonths=ds,e.asYears=gs,e.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*f(this._months/12):NaN},e._bubble=function(){var n=this._milliseconds,t=this._days,i=this._months,r=this._data;return 0<=n&&0<=t&&0<=i||0>=n&&0>=t&&0>=i||(n+=864e5*le(146097*i/4800+t),i=t=0),r.milliseconds=n%1e3,n=d(n/1e3),r.seconds=n%60,n=d(n/60),r.minutes=n%60,n=d(n/60),r.hours=n%24,t+=d(n/24),n=d(4800*t/146097),i+=n,t-=le(146097*n/4800),n=d(i/12),r.days=t,r.months=i%12,r.years=n,this},e.get=function(n){return n=nt(n),this.isValid()?this[n+"s"]():NaN},e.milliseconds=nh,e.seconds=th,e.minutes=ih,e.hours=rh,e.days=uh,e.weeks=function(){return d(this.days()/7)},e.months=fh,e.years=eh,e.humanize=function(n){var u,r;if(!this.isValid())return this.localeData().invalidDate();u=this.localeData();r=!n;var t=et(this).abs(),i=kt(t.as("s")),f=kt(t.as("m")),e=kt(t.as("h")),o=kt(t.as("d")),s=kt(t.as("M")),t=kt(t.as("y")),i=i<=st.ss&&["s",i]||i<st.s&&["ss",i]||1>=f&&["m"]||f<st.m&&["mm",f]||1>=e&&["h"]||e<st.h&&["hh",e]||1>=o&&["d"]||o<st.d&&["dd",o]||1>=s&&["M"]||s<st.M&&["MM",s]||1>=t&&["y"]||["yy",t];return i[2]=r,i[3]=0<+this,i[4]=u,r=go.apply(null,i),n&&(r=u.pastFuture(+this,r)),u.postformat(r)},e.toISOString=fr,e.toString=fr,e.toJSON=fr,e.locale=fe,e.localeData=ee,e.toIsoString=g("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",fr),e.lang=du,r("X",0,0,"unix"),r("x",0,0,"valueOf"),i("x",cr),i("X",/[+-]?\d+(\.\d{1,3})?/),s("X",function(n,t,i){i._d=new Date(1e3*parseFloat(n,10))}),s("x",function(n,t,i){i._d=new Date(f(n))}),t.version="2.18.1",ae=c,t.fn=n,t.min=function(){var n=[].slice.call(arguments,0);return gf("isBefore",n)},t.max=function(){var n=[].slice.call(arguments,0);return gf("isAfter",n)},t.now=function(){return Date.now?Date.now():+new Date},t.utc=ut,t.unix=function(n){return c(1e3*n)},t.months=function(n,t){return he(n,t,"months")},t.isDate=bi,t.locale=ei,t.invalid=ki,t.duration=et,t.isMoment=yt,t.weekdays=function(n,t,i){return su(n,t,i,"weekdays")},t.parseZone=function(){return c.apply(null,arguments).parseZone()},t.localeData=pt,t.isDuration=uu,t.monthsShort=function(n,t){return he(n,t,"monthsShort")},t.weekdaysMin=function(n,t,i){return su(n,t,i,"weekdaysMin")},t.defineLocale=tu,t.updateLocale=function(n,t){if(null!=t){var i;i=de;null!=a[n]&&(i=a[n]._config);t=ef(i,t);i=new wr(t);i.parentLocale=a[n];a[n]=i;ei(n)}else null!=a[n]&&(null!=a[n].parentLocale?a[n]=a[n].parentLocale:null!=a[n]&&delete a[n]);return a[n]},t.locales=function(){return ts(a)},t.weekdaysShort=function(n,t,i){return su(n,t,i,"weekdaysShort")},t.normalizeUnits=nt,t.relativeTimeRounding=function(n){return void 0===n?kt:"function"==typeof n?(kt=n,!0):!1},t.relativeTimeThreshold=function(n,t){return void 0===st[n]?!1:void 0===t?st[n]:(st[n]=t,"s"===n&&(st.ss=t-1),!0)},t.calendarFormat=function(n,t){var i=n.diff(t,"days",!0);return-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse"},t.prototype=n,t})},"esri/arcade/ImmutableArray":function(){define(["require","exports"],function(){return function(){function n(n){void 0===n&&(n=[]);this._elements=n}return n.prototype.length=function(){return this._elements.length},n.prototype.get=function(n){return this._elements[n]},n.prototype.toArray=function(){for(var t=[],n=0;n<this.length();n++)t.push(this.get(n));return t},n}()})},"esri/arcade/ImmutablePointArray":function(){define("require exports ../core/tsSupport/extendsHelper ./ImmutableArray ../geometry/Point ../kernel".split(" "),function(n,t,i,r,u,f){var e=0===f.version.indexOf("4.");return function(n){function t(t,i,r,u,f,e){return t=n.call(this,t)||this,t._lazyPt=[],t._hasZ=!1,t._hasM=!1,t._spRef=i,t._hasZ=r,t._hasM=u,t._cacheId=f,t._partId=e,t}return i(t,n),t.prototype.get=function(n){var t;if(void 0===this._lazyPt[n]){if(t=this._elements[n],void 0===t)return;var i=this._hasZ,r=this._hasM,f=null,f=i&&!r?new u(t[0],t[1],t[2],void 0,this._spRef):r&&i?new u(t[0],t[1],void 0,t[2],this._spRef):i&&r?new u(t[0],t[1],t[2],t[3],this._spRef):new u(t[0],t[1],this._spRef);e?f.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+n.toString():f.setCacheValue("_arcadeCacheId",this._cacheId.toString()+"-"+this._partId.toString()+"-"+n.toString());this._lazyPt[n]=f}return this._lazyPt[n]},t.prototype.equalityTest=function(n){return n===this?!0:null===n||!1==n instanceof t?!1:n.getUniqueHash()===this.getUniqueHash()},t.prototype.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()},t}(r)})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})},"esri/arcade/ImmutablePathArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","./ImmutablePointArray"],function(n,t,i,r,u){return function(n){function t(t,i,r,u,f){return t=n.call(this,t)||this,t._lazyPath=[],t._hasZ=!1,t._hasM=!1,t._hasZ=r,t._hasM=u,t._spRef=i,t._cacheId=f,t}return i(t,n),t.prototype.get=function(n){if(void 0===this._lazyPath[n]){var t=this._elements[n];if(void 0===t)return;this._lazyPath[n]=new u(t,this._spRef,this._hasZ,this._hasM,this._cacheId,n)}return this._lazyPath[n]},t.prototype.equalityTest=function(n){return n===this?!0:null===n||!1==n instanceof t?!1:n.getUniqueHash()===this.getUniqueHash()},t.prototype.getUniqueHash=function(){return this._cacheId.toString()},t}(r)})},"esri/geometry/Polyline":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./Extent ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){var l={type:"polyline",paths:null};return n=n(o,{declaredClass:"esri.geometry.Polyline",constructor:function(n){i.mixin(this,l);this.paths=[];this._path=0;n&&(i.isArray(n)?this.paths=i.isArray(n[0][0])?n:[n]:n.paths?i.mixin(this,n):this.spatialReference=n,this.spatialReference&&(this.spatialReference=c.createSpatialReference(this.spatialReference)));this.verifySR()},addPath:function(n){return this.clearCache(),this._path=this.paths.length,this.paths[this._path]=[],i.isArray(n[0])?t.forEach(n,this._addPointArr,this):t.forEach(n,this._addPoint,this),this},_addPointArr:function(n){this.paths[this._path].push(n)},_addPoint:function(n){this.paths[this._path].push([n.x,n.y])},_insertPoints:function(n,i){this.clearCache();this._path=i;this.paths[this._path]||(this.paths[this._path]=[]);t.forEach(n,this._addPoint,this)},_validateInputs:function(n,t){return null!==n&&void 0!==n&&(0>n||n>=this.paths.length)||null!==t&&void 0!==n&&(0>t||t>=this.paths[n].length)?!1:!0},getPoint:function(n,t){if(this._validateInputs(n,t))return new s(this.paths[n][t],this.spatialReference)},setPoint:function(n,t,i){if(this._validateInputs(n,t))return this.clearCache(),this.paths[n][t]=[i.x,i.y],this},insertPoint:function(n,t,i){if(this._validateInputs(n)&&f.isDefined(t)&&0<=t&&t<=this.paths[n].length)return this.clearCache(),this.paths[n].splice(t,0,[i.x,i.y]),this},removePath:function(n){if(this._validateInputs(n,null)){this.clearCache();n=this.paths.splice(n,1)[0];for(var i=n.length,r=this.spatialReference,t=0;t<i;t++)n[t]=new s(n[t],r);return n}},removePoint:function(n,t){if(this._validateInputs(n,t))return this.clearCache(),new s(this.paths[n].splice(t,1)[0],this.spatialReference)},getExtent:function(){var n,t,b;if(n=this.getCacheValue("_extent"),t=this.getCacheValue("_partwise"),n)return n=new h(n),n._partwise=t,n;if(n=this.paths,b=n.length,b&&n[0].length){for(var r,i,u,f,e,s,g,k=f=n[0][0][0],d=e=n[0][0][1],c=Math.min,l=Math.max,a=this.spatialReference,t=[],v,y,p,w,o=0;o<b;o++){for(r=n[o],v=y=r[0]&&r[0][0],p=w=r[0]&&r[0][1],g=r.length,s=0;s<g;s++)i=r[s],u=i[0],i=i[1],k=c(k,u),d=c(d,i),f=l(f,u),e=l(e,i),v=c(v,u),p=c(p,i),y=l(y,u),w=l(w,i);t.push(new h({xmin:v,ymin:p,xmax:y,ymax:w,spatialReference:a?a.toJson():null}))}return n={xmin:k,ymin:d,xmax:f,ymax:e,spatialReference:a?a.toJson():null},t=1<t.length?t:null,this.setCacheValue("_extent",n),this.setCacheValue("_partwise",t),n=new h(n),n._partwise=t,n}},toJson:function(){var n={paths:i.clone(this.paths)},t=this.spatialReference;return t&&(n.spatialReference=t.toJson()),n}}),n.defaultProps=l,r("extend-esri")&&(i.setObject("geometry.Polyline",n,u),u.geometry.defaultPolyline=l),n})},"esri/geometry/Polygon":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./Extent ./mathUtils ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){var v={type:"polygon",rings:null},a=n(o,{declaredClass:"esri.geometry.Polygon",constructor:function(n){i.mixin(this,v);this.rings=[];this._ring=0;n&&(i.isArray(n)?this.rings=i.isArray(n[0][0])?n:[n]:n.rings?i.mixin(this,n):this.spatialReference=n,this.spatialReference&&(this.spatialReference=l.createSpatialReference(this.spatialReference)));this.verifySR()},addRing:function(n){return this.clearCache(),this._ring=this.rings.length,this.rings[this._ring]=[],i.isArray(n[0])?t.forEach(n,this._addPointArr,this):t.forEach(n,this._addPoint,this),this},_addPointArr:function(n){this.rings[this._ring].push(n)},_addPoint:function(n){this.rings[this._ring].push([n.x,n.y])},_insertPoints:function(n,i){this.clearCache();this._ring=i;this.rings[this._ring]||(this.rings[this._ring]=[]);t.forEach(n,this._addPoint,this)},_validateInputs:function(n,t){return null!==n&&void 0!==n&&(0>n||n>=this.rings.length)||null!==t&&void 0!==n&&(0>t||t>=this.rings[n].length)?!1:!0},getPoint:function(n,t){if(this._validateInputs(n,t))return new s(this.rings[n][t],this.spatialReference)},setPoint:function(n,t,i){if(this._validateInputs(n,t))return this.clearCache(),this.rings[n][t]=[i.x,i.y],this},insertPoint:function(n,t,i){if(this._validateInputs(n)&&f.isDefined(t)&&0<=t&&t<=this.rings[n].length)return this.clearCache(),this.rings[n].splice(t,0,[i.x,i.y]),this},removeRing:function(n){if(this._validateInputs(n,null)){this.clearCache();n=this.rings.splice(n,1)[0];for(var i=n.length,r=this.spatialReference,t=0;t<i;t++)n[t]=new s(n[t],r);return n}},removePoint:function(n,t){if(this._validateInputs(n,t))return this.clearCache(),new s(this.rings[n].splice(t,1)[0],this.spatialReference)},getExtent:function(){var n,t,b;if(n=this.getCacheValue("_extent"),t=this.getCacheValue("_partwise"),n)return n=new h(n),n._partwise=t,n;if(n=this.rings,b=n.length,b&&n[0].length){for(var r,i,u,f,e,s,g,k=f=n[0][0][0],d=e=n[0][0][1],c=Math.min,l=Math.max,a=this.spatialReference,t=[],v,y,p,w,o=0;o<b;o++){for(r=n[o],v=y=r[0]&&r[0][0],p=w=r[0]&&r[0][1],g=r.length,s=0;s<g;s++)i=r[s],u=i[0],i=i[1],k=c(k,u),d=c(d,i),f=l(f,u),e=l(e,i),v=c(v,u),p=c(p,i),y=l(y,u),w=l(w,i);t.push(new h({xmin:v,ymin:p,xmax:y,ymax:w,spatialReference:a?a.toJson():null}))}return n={xmin:k,ymin:d,xmax:f,ymax:e,spatialReference:a?a.toJson():null},t=1<t.length?t:null,this.setCacheValue("_extent",n),this.setCacheValue("_partwise",t),n=new h(n),n._partwise=t,n}},contains:function(n){var l=this.rings,i,h=!1,t,r,c,u,e,o,a=l.length,f;for(i=this.spatialReference,t=n.spatialReference,f=n.x,n=n.y,i&&t&&!i.equals(t)&&i._canProject(t)&&(n=i.isWebMercator()?s.lngLatToXY(f,n):s.xyToLngLat(f,n,!0),f=n[0],n=n[1]),o=0;o<a;o++)for(i=l[o],c=i.length,e=u=0;e<c;e++)u++,u===c&&(u=0),t=i[e],r=i[u],(t[1]<n&&r[1]>=n||r[1]<n&&t[1]>=n)&&t[0]+(n-t[1])/(r[1]-t[1])*(r[0]-t[0])<f&&(h=!h);return h},getCentroid:function(){var n=this.getCacheValue("_centroid");if(void 0!==n)return n;var n=this.rings,i,r,u,h,f=[],e,o,c=Infinity,l=-Infinity,a=Infinity,v=-Infinity;return t.forEach(n,function(n){i=r=u=0;t.forEach(n,function(t,f){f<n.length-1&&(e=n[f+1],o=t[0]*e[1]-e[0]*t[1],i+=(t[0]+e[0])*o,r+=(t[1]+e[1])*o,u+=o,t[0]<c&&(c=t[0]),t[0]>l&&(l=t[0]),t[1]<a&&(a=t[1]),t[1]>v&&(v=t[1]))});0<u&&(u*=-1);u&&f.push([i,r,u/2])}),f.sort(function(n,t){return n[2]-t[2]}),i=r=void 0,f[0]&&(h=6*f[0][2],i=f[0][0]/h,r=f[0][1]/h,i<c||i>l||r<a||r>v)&&(i=r=void 0),(void 0===i||void 0===r)&&(n=n[0]&&n[0].length?this._getLineCentroid(n[0]):null)&&(i=n.x,r=n.y),n=isNaN(i)||isNaN(r)?null:new s(i,r,this.spatialReference),this.setCacheValue("_centroid",n),n},_getLineCentroid:function(n){for(var i,f=0,h=0,l=0,t,r,e={x:0,y:0},o={x:0,y:0},a=n.length,s,u=0;u<a-1;u++)t=n[u],r=n[u+1],t&&r&&(e.x=t[0],e.y=t[1],o.x=r[0],o.y=r[1],i=c.getLength(e,o),0<i&&(f+=i,t=c.getMidpoint(t,r),h+=i*t[0],l+=i*t[1]));return 0<f?s={x:h/f,y:l/f}:n[0]&&(s={x:n[0][0],y:n[0][1]}),s},isClockwise:function(n){for(var r=0,u=n.length,f=i.isArray(n[0])?function(n,t){return n[0]*t[1]-t[0]*n[1]}:function(n,t){return n.x*t.y-t.x*n.y},t=0;t<u;t++)r+=f(n[t],n[(t+1)%u]);return 0>=r/2},isSelfIntersecting:function(n){n=n||this;for(var r,u,f,e,o,i,h=n.rings.length,s,t=0;t<h;t++){for(r=0;r<n.rings[t].length-1;r++)for(e=[[n.rings[t][r][0],n.rings[t][r][1]],[n.rings[t][r+1][0],n.rings[t][r+1][1]]],u=t+1;u<h;u++)for(f=0;f<n.rings[u].length-1;f++)if(o=[[n.rings[u][f][0],n.rings[u][f][1]],[n.rings[u][f+1][0],n.rings[u][f+1][1]]],(i=c._getLineIntersection2(e,o))&&!(i[0]===e[0][0]&&i[1]===e[0][1]||i[0]===o[0][0]&&i[1]===o[0][1]||i[0]===e[1][0]&&i[1]===e[1][1]||i[0]===o[1][0]&&i[1]===o[1][1]))return!0;if(f=n.rings[t].length,!(4>=f))for(r=0;r<f-3;r++)for(s=f-1,0===r&&(s=f-2),e=[[n.rings[t][r][0],n.rings[t][r][1]],[n.rings[t][r+1][0],n.rings[t][r+1][1]]],u=r+2;u<s;u++)if(o=[[n.rings[t][u][0],n.rings[t][u][1]],[n.rings[t][u+1][0],n.rings[t][u+1][1]]],(i=c._getLineIntersection2(e,o))&&!(i[0]===e[0][0]&&i[1]===e[0][1]||i[0]===o[0][0]&&i[1]===o[0][1]||i[0]===e[1][0]&&i[1]===e[1][1]||i[0]===o[1][0]&&i[1]===o[1][1]))return!0}return!1},toJson:function(){var n={rings:i.clone(this.rings)},t=this.spatialReference;return t&&(n.spatialReference=t.toJson()),n}});return a.defaultProps=v,a.createEllipse=function(n){var i=n.center.x,s=n.center.y,h=n.longAxis,c=n.shortAxis,f=n.numberOfPoints,e=n.map,r,t,o,u;for(n=[],u=2*Math.PI/f,t=0;t<f;t++)r=Math.cos(t*u),o=Math.sin(t*u),r=e.toMap({x:h*r+i,y:c*o+s}),n.push(r);return n.push(n[0]),i=new a(e.spatialReference),i.addRing(n),i},a.createCircle=function(n){return a.createEllipse({center:n.center,longAxis:n.r,shortAxis:n.r,numberOfPoints:n.numberOfPoints,map:n.map})},a.fromExtent=function(n){var i=n.normalize();return n=n.spatialReference,new a({rings:t.map(i,function(n){return[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]}),spatialReference:n?n.toJson():null})},r("extend-esri")&&(i.setObject("geometry.Polygon",a,u),u.geometry.defaultPolygon=v,u.geometry.createEllipse=a.createEllipse,u.geometry.createCircle=a.createCircle,u.geometry.isClockwise=a.prototype.isClockwise,u.geometry.polygonSelfIntersecting=a.prototype.isSelfIntersecting),a})},"esri/geometry/Multipoint":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ./Geometry ./Point ./Extent ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s){var h={type:"multipoint",points:null};return n=n(f,{declaredClass:"esri.geometry.Multipoint",constructor:function(n){t.mixin(this,h);this.points=[];n&&(n.points?t.mixin(this,n):this.spatialReference=n,this.spatialReference&&(this.spatialReference=s.createSpatialReference(this.spatialReference)));this.verifySR()},addPoint:function(n){return this.clearCache(),t.isArray(n)?this.points.push(n):this.points.push([n.x,n.y]),this},removePoint:function(n){if(this._validateInputs(n))return this.clearCache(),new e(this.points.splice(n,1)[0],this.spatialReference)},getExtent:function(){var n=this.getCacheValue("_extent"),f;if(n)return new o(n);if(n=this.points,f=n.length,f){for(var t=n[0],i,r,e=i=t[0],s=r=t[1],c=Math.min,l=Math.max,a=this.spatialReference,h,u=0;u<f;u++)t=n[u],h=t[0],t=t[1],e=c(e,h),s=c(s,t),i=l(i,h),r=l(r,t);return n={xmin:e,ymin:s,xmax:i,ymax:r,spatialReference:a?a.toJson():null},this.setCacheValue("_extent",n),new o(n)}},_validateInputs:function(n){return null===n||0>n||n>=this.points.length?!1:!0},getPoint:function(n){if(this._validateInputs(n))return n=this.points[n],new e(n[0],n[1],this.spatialReference)},setPoint:function(n,t){if(this._validateInputs(n))return this.clearCache(),this.points[n]=[t.x,t.y],this},toJson:function(){var n={points:t.clone(this.points)},i=this.spatialReference;return i&&(n.spatialReference=i.toJson()),n}}),n.defaultProps=h,i("extend-esri")&&(t.setObject("geometry.Multipoint",n,r),r.geometry.defaultMultipoint=h),n})},"esri/arcade/FunctionWrapper":function(){define(["require","exports"],function(){return function(){return function(n,t){this.context=this.definition=null;this.definition=n;this.context=t}}()})},"esri/geometry/ScreenPoint":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./Point"],function(n,t,i,r,u){return n=n(u,{declaredClass:"esri.geometry.ScreenPoint",verifySR:function(){}}),i("extend-esri")&&t.setObject("geometry.ScreenPoint",n,r),n})},"esri/geometry/Rect":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojox/gfx/_base ../kernel ../SpatialReference ./Geometry ./Point ./Extent ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h){function l(n){return new s(parseFloat(n.x),parseFloat(n.y)-parseFloat(n.height),parseFloat(n.x)+parseFloat(n.width),parseFloat(n.y),n.spatialReference)}var c=n(e,{declaredClass:"esri.geometry.Rect",constructor:function(n,i,u,f,e){t.mixin(this,r.defaultRect);t.isObject(n)&&"extent"===n.type&&(i=n.ymax,u=n.getWidth(),f=n.getHeight(),e=n.spatialReference,n=n.xmin);t.isObject(n)?(t.mixin(this,n),this.spatialReference&&(this.spatialReference=h.createSpatialReference(this.spatialReference))):(this.x=n,this.y=i,this.width=u,this.height=f,this.spatialReference=e);this.verifySR()},getCenter:function(){return new o(this.x+this.width/2,this.y+this.height/2,this.spatialReference)},offset:function(n,t){return new c(this.x+n,this.y+t,this.width,this.height,this.spatialReference)},intersects:function(n){return n.x+n.width<=this.x||n.y+n.height<=this.y||n.y>=this.y+this.height||n.x>=this.x+this.width?!1:!0},getExtent:function(){return l(this)},update:function(n,t,i,r,u){return this.x=n,this.y=t,this.width=i,this.height=r,this.spatialReference=u,this.clearCache(),this}});return i("extend-esri")&&(t.setObject("geometry.Rect",c,u),u.geometry._rectToExtent=l,u.geometry._extentToRect=function(n){return new c(n)}),c})},"esri/geometry/scaleUtils":function(){define("dojo/_base/lang dojo/has ../kernel ../config ../lang ../WKIDUnitConversion".split(" "),function(n,t,i,r,u,f){function h(n,t,i){return n&&t?n.getWidth()/t*(i||s)*39.37*l.screenDPI:0}function c(n,t,i,r,u){return n.expand(r*t/(39.37*((u?i:o.values[o[i]])||s)*l.screenDPI)/n.getWidth())}var s=6370997*Math.PI/180,l=r.defaults,o=f,e={getUnitValueForSR:function(n){return this.getUnitValue(n)||s},getUnitValue:function(n){var i,t,r;return n&&("object"==typeof n?(i=n.wkid,t=n.wkt):"number"==typeof n?i=n:"string"==typeof n&&(t=n)),i?r=o.values[o[i]]:t&&-1!==t.search(/^PROJCS/i)&&(n=/UNIT\[([^\]]+)\]\]$/i.exec(t))&&n[1]&&(r=parseFloat(n[1].split(",")[1])),r},getScale:function(n,t,i){var r,f,o;return 1<arguments.length&&u.isDefined(t)&&!t.declaredClass?(r=n,f=t,t=null,o=e.getUnitValue(i)):(r=t||n.extent,f=n.width,o=e.getUnitValue(r&&r.spatialReference)),h(r,f,o)},getExtentForScale:function(n,t,i){return c(i||n.extent,n.width,e.getUnitValue(n.spatialReference),t,!0)}};return t("extend-esri")&&(n.mixin(n.getObject("geometry",!0,i),e),i.geometry._getScale=h,i.geometry._getExtentForScale=c),e})},"esri/WKIDUnitConversion":function(){define(["dojo/has","./kernel"],function(n,t){for(var r={values:[1,.3048,.30480060960121919,.3047972654,.9143917962,.201166195164,.91439841461602867,.3047994715386762,20.116765121552628,20.116782494375869,.91439853074444077,.91439523,.30479971018150881,20.116756,5e4,15e4],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53034:0,53048:0,53049:0,54034:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103695:2},i=2e3;2045>=i;i++)r[i]=0;for(i=2056;2065>=i;i++)r[i]=0;for(i=2067;2135>=i;i++)r[i]=0;for(i=2137;2154>=i;i++)r[i]=0;for(i=2161;2170>=i;i++)r[i]=0;for(i=2172;2193>=i;i++)r[i]=0;for(i=2195;2198>=i;i++)r[i]=0;for(i=2200;2203>=i;i++)r[i]=0;for(i=2205;2217>=i;i++)r[i]=0;for(i=2222;2224>=i;i++)r[i]=1;for(i=2225;2250>=i;i++)r[i]=2;for(i=2251;2253>=i;i++)r[i]=1;for(i=2257;2264>=i;i++)r[i]=2;for(i=2274;2279>=i;i++)r[i]=2;for(i=2280;2282>=i;i++)r[i]=1;for(i=2283;2289>=i;i++)r[i]=2;for(i=2290;2292>=i;i++)r[i]=0;for(i=2308;2313>=i;i++)r[i]=0;for(i=2315;2491>=i;i++)r[i]=0;for(i=2494;2866>=i;i++)r[i]=0;for(i=2867;2869>=i;i++)r[i]=1;for(i=2870;2888>=i;i++)r[i]=2;for(i=2891;2895>=i;i++)r[i]=2;for(i=2896;2898>=i;i++)r[i]=1;for(i=2902;2908>=i;i++)r[i]=2;for(i=2915;2920>=i;i++)r[i]=2;for(i=2921;2923>=i;i++)r[i]=1;for(i=2924;2930>=i;i++)r[i]=2;for(i=2931;2962>=i;i++)r[i]=0;for(i=2964;2968>=i;i++)r[i]=2;for(i=2969;2973>=i;i++)r[i]=0;for(i=2975;2991>=i;i++)r[i]=0;for(i=2995;3051>=i;i++)r[i]=0;for(i=3054;3079>=i;i++)r[i]=0;for(i=3081;3088>=i;i++)r[i]=0;for(i=3092;3101>=i;i++)r[i]=0;for(i=3106;3138>=i;i++)r[i]=0;for(i=3146;3151>=i;i++)r[i]=0;for(i=3153;3166>=i;i++)r[i]=0;for(i=3168;3172>=i;i++)r[i]=0;for(i=3174;3203>=i;i++)r[i]=0;for(i=3294;3358>=i;i++)r[i]=0;for(i=3367;3403>=i;i++)r[i]=0;for(i=3408;3416>=i;i++)r[i]=0;for(i=3417;3438>=i;i++)r[i]=2;for(i=3441;3446>=i;i++)r[i]=2;for(i=3447;3450>=i;i++)r[i]=0;for(i=3451;3459>=i;i++)r[i]=2;for(i=3460;3478>=i;i++)r[i]=0;for(i=3554;3559>=i;i++)r[i]=0;for(i=3560;3570>=i;i++)r[i]=2;for(i=3571;3581>=i;i++)r[i]=0;for(i=3594;3597>=i;i++)r[i]=0;for(i=3601;3604>=i;i++)r[i]=0;for(i=3637;3639>=i;i++)r[i]=0;for(i=3665;3667>=i;i++)r[i]=0;for(i=3693;3695>=i;i++)r[i]=0;for(i=3701;3727>=i;i++)r[i]=0;for(i=3728;3739>=i;i++)r[i]=2;for(i=3740;3751>=i;i++)r[i]=0;for(i=3753;3760>=i;i++)r[i]=2;for(i=3761;3773>=i;i++)r[i]=0;for(i=3775;3777>=i;i++)r[i]=0;for(i=3779;3781>=i;i++)r[i]=0;for(i=3783;3785>=i;i++)r[i]=0;for(i=3788;3791>=i;i++)r[i]=0;for(i=3797;3802>=i;i++)r[i]=0;for(i=3814;3816>=i;i++)r[i]=0;for(i=3825;3829>=i;i++)r[i]=0;for(i=3832;3841>=i;i++)r[i]=0;for(i=3844;3852>=i;i++)r[i]=0;for(i=3873;3885>=i;i++)r[i]=0;for(i=3890;3893>=i;i++)r[i]=0;for(i=3907;3912>=i;i++)r[i]=0;for(i=3942;3950>=i;i++)r[i]=0;for(i=3968;3970>=i;i++)r[i]=0;for(i=3973;3976>=i;i++)r[i]=0;for(i=3986;3989>=i;i++)r[i]=0;for(i=3994;3997>=i;i++)r[i]=0;for(i=4048;4051>=i;i++)r[i]=0;for(i=4056;4063>=i;i++)r[i]=0;for(i=4093;4096>=i;i++)r[i]=0;for(i=4390;4398>=i;i++)r[i]=0;for(i=4399;4413>=i;i++)r[i]=2;for(i=4418;4433>=i;i++)r[i]=2;for(i=4455;4457>=i;i++)r[i]=2;for(i=4484;4489>=i;i++)r[i]=0;for(i=4491;4554>=i;i++)r[i]=0;for(i=4568;4589>=i;i++)r[i]=0;for(i=4652;4656>=i;i++)r[i]=0;for(i=4766;4800>=i;i++)r[i]=0;for(i=5014;5016>=i;i++)r[i]=0;for(i=5069;5072>=i;i++)r[i]=0;for(i=5105;5130>=i;i++)r[i]=0;for(i=5173;5188>=i;i++)r[i]=0;for(i=5253;5259>=i;i++)r[i]=0;for(i=5269;5275>=i;i++)r[i]=0;for(i=5292;5311>=i;i++)r[i]=0;for(i=5329;5331>=i;i++)r[i]=0;for(i=5343;5349>=i;i++)r[i]=0;for(i=5355;5357>=i;i++)r[i]=0;for(i=5387;5389>=i;i++)r[i]=0;for(i=5459;5463>=i;i++)r[i]=0;for(i=5479;5482>=i;i++)r[i]=0;for(i=5518;5520>=i;i++)r[i]=0;for(i=5530;5539>=i;i++)r[i]=0;for(i=5550;5552>=i;i++)r[i]=0;for(i=5562;5583>=i;i++)r[i]=0;for(i=5623;5625>=i;i++)r[i]=2;for(i=5631;5639>=i;i++)r[i]=0;for(i=5649;5653>=i;i++)r[i]=0;for(i=5663;5680>=i;i++)r[i]=0;for(i=5682;5685>=i;i++)r[i]=0;for(i=5875;5877>=i;i++)r[i]=0;for(i=5921;5940>=i;i++)r[i]=0;for(i=6050;6125>=i;i++)r[i]=0;for(i=6244;6275>=i;i++)r[i]=0;for(i=6328;6348>=i;i++)r[i]=0;for(i=6350;6356>=i;i++)r[i]=0;for(i=6366;6372>=i;i++)r[i]=0;for(i=6381;6387>=i;i++)r[i]=0;for(i=6393;6404>=i;i++)r[i]=0;for(i=6480;6483>=i;i++)r[i]=0;for(i=6511;6514>=i;i++)r[i]=0;for(i=6579;6581>=i;i++)r[i]=0;for(i=6619;6624>=i;i++)r[i]=0;for(i=6625;6627>=i;i++)r[i]=2;for(i=6628;6632>=i;i++)r[i]=0;for(i=6634;6637>=i;i++)r[i]=0;for(i=6669;6692>=i;i++)r[i]=0;for(i=6707;6709>=i;i++)r[i]=0;for(i=6720;6723>=i;i++)r[i]=0;for(i=6732;6738>=i;i++)r[i]=0;for(i=6931;6933>=i;i++)r[i]=0;for(i=6956;6959>=i;i++)r[i]=0;for(i=7005;7007>=i;i++)r[i]=0;for(i=7057;7070>=i;i++)r[i]=2;for(i=7074;7082>=i;i++)r[i]=0;for(i=7109;7118>=i;i++)r[i]=0;for(i=7119;7127>=i;i++)r[i]=1;for(i=7374;7376>=i;i++)r[i]=0;for(i=7528;7586>=i;i++)r[i]=0;for(i=7587;7645>=i;i++)r[i]=2;for(i=7845;7859>=i;i++)r[i]=0;for(i=20002;20032>=i;i++)r[i]=0;for(i=20062;20092>=i;i++)r[i]=0;for(i=20135;20138>=i;i++)r[i]=0;for(i=20248;20258>=i;i++)r[i]=0;for(i=20348;20358>=i;i++)r[i]=0;for(i=20436;20440>=i;i++)r[i]=0;for(i=20822;20824>=i;i++)r[i]=0;for(i=20934;20936>=i;i++)r[i]=0;for(i=21035;21037>=i;i++)r[i]=0;for(i=21095;21097>=i;i++)r[i]=0;for(i=21148;21150>=i;i++)r[i]=0;for(i=21413;21423>=i;i++)r[i]=0;for(i=21473;21483>=i;i++)r[i]=0;for(i=21780;21782>=i;i++)r[i]=0;for(i=21891;21894>=i;i++)r[i]=0;for(i=21896;21899>=i;i++)r[i]=0;for(i=22171;22177>=i;i++)r[i]=0;for(i=22181;22187>=i;i++)r[i]=0;for(i=22191;22197>=i;i++)r[i]=0;for(i=22234;22236>=i;i++)r[i]=0;for(i=22521;22525>=i;i++)r[i]=0;for(i=22991;22994>=i;i++)r[i]=0;for(i=23028;23038>=i;i++)r[i]=0;for(i=23830;23853>=i;i++)r[i]=0;for(i=23866;23872>=i;i++)r[i]=0;for(i=23877;23884>=i;i++)r[i]=0;for(i=23886;23894>=i;i++)r[i]=0;for(i=23946;23948>=i;i++)r[i]=0;for(i=24311;24313>=i;i++)r[i]=0;for(i=24342;24347>=i;i++)r[i]=0;for(i=24370;24374>=i;i++)r[i]=10;for(i=24375;24381>=i;i++)r[i]=0;for(i=24718;24721>=i;i++)r[i]=0;for(i=24817;24821>=i;i++)r[i]=0;for(i=24877;24882>=i;i++)r[i]=0;for(i=24891;24893>=i;i++)r[i]=0;for(i=25391;25395>=i;i++)r[i]=0;for(i=25828;25838>=i;i++)r[i]=0;for(i=26191;26195>=i;i++)r[i]=0;for(i=26391;26393>=i;i++)r[i]=0;for(i=26701;26722>=i;i++)r[i]=0;for(i=26729;26799>=i;i++)r[i]=2;for(i=26801;26803>=i;i++)r[i]=2;for(i=26811;26813>=i;i++)r[i]=2;for(i=26847;26870>=i;i++)r[i]=2;for(i=26891;26899>=i;i++)r[i]=0;for(i=26901;26923>=i;i++)r[i]=0;for(i=26929;26946>=i;i++)r[i]=0;for(i=26948;26998>=i;i++)r[i]=0;for(i=27037;27040>=i;i++)r[i]=0;for(i=27205;27232>=i;i++)r[i]=0;for(i=27258;27260>=i;i++)r[i]=0;for(i=27391;27398>=i;i++)r[i]=0;for(i=27561;27564>=i;i++)r[i]=0;for(i=27571;27574>=i;i++)r[i]=0;for(i=27581;27584>=i;i++)r[i]=0;for(i=27591;27594>=i;i++)r[i]=0;for(i=28191;28193>=i;i++)r[i]=0;for(i=28348;28358>=i;i++)r[i]=0;for(i=28402;28432>=i;i++)r[i]=0;for(i=28462;28492>=i;i++)r[i]=0;for(i=29118;29122>=i;i++)r[i]=0;for(i=29168;29172>=i;i++)r[i]=0;for(i=29177;29185>=i;i++)r[i]=0;for(i=29187;29195>=i;i++)r[i]=0;for(i=29900;29903>=i;i++)r[i]=0;for(i=30161;30179>=i;i++)r[i]=0;for(i=30491;30494>=i;i++)r[i]=0;for(i=30729;30732>=i;i++)r[i]=0;for(i=31251;31259>=i;i++)r[i]=0;for(i=31265;31268>=i;i++)r[i]=0;for(i=31275;31279>=i;i++)r[i]=0;for(i=31281;31297>=i;i++)r[i]=0;for(i=31461;31469>=i;i++)r[i]=0;for(i=31491;31495>=i;i++)r[i]=0;for(i=31917;31922>=i;i++)r[i]=0;for(i=31965;32e3>=i;i++)r[i]=0;for(i=32001;32003>=i;i++)r[i]=2;for(i=32005;32031>=i;i++)r[i]=2;for(i=32033;32060>=i;i++)r[i]=2;for(i=32064;32067>=i;i++)r[i]=2;for(i=32074;32077>=i;i++)r[i]=2;for(i=32081;32086>=i;i++)r[i]=0;for(i=32107;32130>=i;i++)r[i]=0;for(i=32133;32158>=i;i++)r[i]=0;for(i=32164;32167>=i;i++)r[i]=2;for(i=32180;32199>=i;i++)r[i]=0;for(i=32201;32260>=i;i++)r[i]=0;for(i=32301;32360>=i;i++)r[i]=0;for(i=32601;32662>=i;i++)r[i]=0;for(i=32664;32667>=i;i++)r[i]=2;for(i=32701;32761>=i;i++)r[i]=0;for(i=53001;53004>=i;i++)r[i]=0;for(i=53008;53019>=i;i++)r[i]=0;for(i=53021;53032>=i;i++)r[i]=0;for(i=53042;53046>=i;i++)r[i]=0;for(i=53074;53080>=i;i++)r[i]=0;for(i=54001;54004>=i;i++)r[i]=0;for(i=54008;54019>=i;i++)r[i]=0;for(i=54021;54032>=i;i++)r[i]=0;for(i=54042;54046>=i;i++)r[i]=0;for(i=54048;54053>=i;i++)r[i]=0;for(i=54074;54080>=i;i++)r[i]=0;for(i=102001;102040>=i;i++)r[i]=0;for(i=102042;102063>=i;i++)r[i]=0;for(i=102065;102067>=i;i++)r[i]=0;for(i=102070;102117>=i;i++)r[i]=0;for(i=102122;102216>=i;i++)r[i]=0;for(i=102221;102377>=i;i++)r[i]=0;for(i=102382;102388>=i;i++)r[i]=0;for(i=102389;102398>=i;i++)r[i]=2;for(i=102399;102444>=i;i++)r[i]=0;for(i=102445;102447>=i;i++)r[i]=2;for(i=102448;102458>=i;i++)r[i]=0;for(i=102459;102468>=i;i++)r[i]=2;for(i=102469;102496>=i;i++)r[i]=0;for(i=102500;102519>=i;i++)r[i]=1;for(i=102520;102524>=i;i++)r[i]=0;for(i=102525;102529>=i;i++)r[i]=2;for(i=102530;102561>=i;i++)r[i]=0;for(i=102570;102588>=i;i++)r[i]=0;for(i=102590;102598>=i;i++)r[i]=0;for(i=102601;102603>=i;i++)r[i]=0;for(i=102605;102628>=i;i++)r[i]=0;for(i=102629;102646>=i;i++)r[i]=2;for(i=102648;102700>=i;i++)r[i]=2;for(i=102701;102703>=i;i++)r[i]=0;for(i=102707;102730>=i;i++)r[i]=2;for(i=102733;102758>=i;i++)r[i]=2;for(i=102767;102798>=i;i++)r[i]=0;for(i=102965;102969>=i;i++)r[i]=0;for(i=102971;102973>=i;i++)r[i]=0;for(i=102975;102989>=i;i++)r[i]=0;for(i=102990;102992>=i;i++)r[i]=1;for(i=102997;103002>=i;i++)r[i]=0;for(i=103003;103008>=i;i++)r[i]=2;for(i=103009;103011>=i;i++)r[i]=0;for(i=103012;103014>=i;i++)r[i]=2;for(i=103019;103021>=i;i++)r[i]=0;for(i=103022;103024>=i;i++)r[i]=2;for(i=103029;103031>=i;i++)r[i]=0;for(i=103032;103034>=i;i++)r[i]=2;for(i=103065;103068>=i;i++)r[i]=0;for(i=103074;103076>=i;i++)r[i]=0;for(i=103077;103079>=i;i++)r[i]=1;for(i=103080;103082>=i;i++)r[i]=0;for(i=103083;103085>=i;i++)r[i]=2;for(i=103090;103093>=i;i++)r[i]=0;for(i=103097;103099>=i;i++)r[i]=0;for(i=103100;103102>=i;i++)r[i]=2;for(i=103107;103109>=i;i++)r[i]=0;for(i=103110;103112>=i;i++)r[i]=2;for(i=103113;103116>=i;i++)r[i]=0;for(i=103117;103120>=i;i++)r[i]=2;for(i=103153;103157>=i;i++)r[i]=0;for(i=103158;103162>=i;i++)r[i]=2;for(i=103163;103165>=i;i++)r[i]=0;for(i=103166;103168>=i;i++)r[i]=1;for(i=103169;103171>=i;i++)r[i]=2;for(i=103186;103188>=i;i++)r[i]=0;for(i=103189;103191>=i;i++)r[i]=2;for(i=103192;103195>=i;i++)r[i]=0;for(i=103196;103199>=i;i++)r[i]=2;for(i=103200;103224>=i;i++)r[i]=0;for(i=103225;103227>=i;i++)r[i]=1;for(i=103232;103237>=i;i++)r[i]=0;for(i=103238;103243>=i;i++)r[i]=2;for(i=103244;103246>=i;i++)r[i]=0;for(i=103247;103249>=i;i++)r[i]=2;for(i=103254;103256>=i;i++)r[i]=0;for(i=103257;103259>=i;i++)r[i]=2;for(i=103264;103266>=i;i++)r[i]=0;for(i=103267;103269>=i;i++)r[i]=2;for(i=103300;103375>=i;i++)r[i]=0;for(i=103381;103383>=i;i++)r[i]=0;for(i=103384;103386>=i;i++)r[i]=1;for(i=103387;103389>=i;i++)r[i]=0;for(i=103390;103392>=i;i++)r[i]=2;for(i=103397;103399>=i;i++)r[i]=0;for(i=103400;103471>=i;i++)r[i]=2;for(i=103476;103478>=i;i++)r[i]=0;for(i=103479;103481>=i;i++)r[i]=2;for(i=103486;103488>=i;i++)r[i]=0;for(i=103489;103491>=i;i++)r[i]=2;for(i=103492;103495>=i;i++)r[i]=0;for(i=103496;103499>=i;i++)r[i]=2;for(i=103528;103543>=i;i++)r[i]=0;for(i=103544;103548>=i;i++)r[i]=2;for(i=103549;103551>=i;i++)r[i]=0;for(i=103552;103554>=i;i++)r[i]=1;for(i=103555;103557>=i;i++)r[i]=2;for(i=103558;103560>=i;i++)r[i]=0;for(i=103571;103573>=i;i++)r[i]=0;for(i=103574;103576>=i;i++)r[i]=2;for(i=103577;103580>=i;i++)r[i]=0;for(i=103581;103583>=i;i++)r[i]=2;for(i=103600;103694>=i;i++)r[i]=0;for(i=103700;103793>=i;i++)r[i]=2;for(i=103794;103871>=i;i++)r[i]=0;for(i=103900;103971>=i;i++)r[i]=2;return n("extend-esri")&&(t.WKIDUnitConversion=r),r})},"esri/geometry/screenUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/sniff ../kernel ./Point ./ScreenPoint ./Polyline ./Polygon ./Multipoint ./Extent".split(" "),function(n,t,i,r,u,f,e,o,s,h){var l=function(){return 9>i("ie")?function(n,t,i,r,u,f,e,o,s){for(var p=[],l=Math.round,k=e.length,c,a,b,h,v,y,w=0;w<k;w++)if(c=e[w],h=o?o(c[0][0],c[0][1],s):c[0],1<(b=c.length))for(v=l((h[0]-n)*i+u),y=l((t-h[1])*r+f),h=o?o(c[1][0],c[1][1],s):c[1],a=l((h[0]-n)*i+u),h=l((t-h[1])*r+f),p.push("M",v+","+y,"L",a+","+h),a=2;a<b;a++)h=o?o(c[a][0],c[a][1],s):c[a],v=l((h[0]-n)*i+u),y=l((t-h[1])*r+f),p.push(v+","+y);else v=l((h[0]-n)*i+u),y=l((t-h[1])*r+f),p.push("M",v+","+y);return p}:function(n,t,i,r,u,f,e,o,s,h){for(var a=[],c,w,l,y,b=Math.round,v=0,p=e?e.length:0;v<p;v++){for(l=e[v],a.push("M"),c=0,w=l?l.length:0;c<w;c++)y=o?o(l[c][0],l[c][1],s):l[c],a.push(b((y[0]-n)*i+u)+","+b((t-y[1])*r+f));h||a.push("Z")}return a}}(),c={toScreenPoint:function(n,t,i,r,e){var s=n.spatialReference,h=r.spatialReference,o=r.x;return r=r.y,s&&h&&!s.equals(h)&&s._canProject(h)&&(s=s.isWebMercator()?u.lngLatToXY(o,r):u.xyToLngLat(o,r,!0),o=s[0],r=s[1]),o=(o-n.xmin)*(t/n.getWidth()),r=(n.ymax-r)*(i/n.getHeight()),e||(o=Math.round(o),r=Math.round(r)),new f(o,r)},toScreenGeometry:function(t,i,r,f){var a=t.xmin,v=t.ymax,l=i/t.getWidth(),y=r/t.getHeight(),p=n.forEach,c=Math.round,w,b,k,d,g;return f instanceof u?new u(c((f.x-a)*l),c((v-f.y)*y)):f instanceof s?(t=new s,w=t.points,p(f.points,function(n,t){w[t]=[c((n[0]-a)*l),c((v-n[1])*y)]}),t):f instanceof h?new h(c((f.xmin-a)*l),c((v-f.ymin)*y),c((f.xmax-a)*l),c((v-f.ymax)*l)):f instanceof e?(t=new e,b=t.paths,p(f.paths,function(n,t){k=b[t]=[];p(n,function(n,t){k[t]=[c((n[0]-a)*l),c((v-n[1])*y)]})}),t):f instanceof o?(t=new o,d=t.rings,p(f.rings,function(n,t){g=d[t]=[];p(n,function(n,t){g[t]=[c((n[0]-a)*l),c((v-n[1])*y)]})}),t):void 0},_toScreenPath:function(n,t,i,r,f,o){var a=r instanceof e,s=n.spatialReference,h=r.spatialReference,c,v;return s&&h&&!s.equals(h)&&s._canProject(h)&&(s.isWebMercator()?c=u.lngLatToXY:(c=u.xyToLngLat,v=!0)),l(n.xmin,n.ymax,t/n.getWidth(),i/n.getHeight(),f,o,a?r.paths:r.rings,c,v,a)},toMapPoint:function(n,t,i,r){return new u(n.xmin+r.x/(t/n.getWidth()),n.ymax-r.y/(i/n.getHeight()),n.spatialReference)},toMapGeometry:function(t,i,r,f){var c=t.xmin,l=t.ymax,y=t.spatialReference,a=i/t.getWidth(),v=r/t.getHeight(),p=n.forEach,w,b,k,d,g;return f instanceof u?new u(c+f.x/a,l-f.y/v,y):f instanceof s?(t=new s(y),w=t.points,p(f.points,function(n,t){w[t]=[c+n[0]/a,l-n[1]/v]}),t):f instanceof h?new h(c+f.xmin/a,l-f.ymin/v,c+f.xmax/a,l-f.ymax/v,y):f instanceof e?(t=new e(y),b=t.paths,p(f.paths,function(n,t){k=b[t]=[];p(n,function(n,t){k[t]=[c+n[0]/a,l-n[1]/v]})}),t):f instanceof o?(t=new o(y),d=t.rings,p(f.rings,function(n,t){g=d[t]=[];p(n,function(n,t){g[t]=[c+n[0]/a,l-n[1]/v]})}),t):void 0}};return i("extend-esri")&&t.mixin(t.getObject("geometry",!0,r),c),c})},"esri/layers/GraphicsLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom dojox/gfx dojox/gfx/matrix ./gfxSniff!esri-svg?dojox/gfx/filters ./layer ../kernel ../lang ../sniff ../Color ../domUtils ../symbols/MarkerSymbol ../symbols/SimpleMarkerSymbol ../geometry/Point ../geometry/ScreenPoint ../geometry/Extent ../geometry/mathUtils ../geometry/screenUtils ../PluginTarget ./gfxSniff!esri-svg?dojox/gfx/svgext".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){var st,et=-1!==h.renderer.toLowerCase().indexOf("svg"),ot=-1!==h.renderer.toLowerCase().indexOf("canvas"),ft=9>p("ie"),lt=9===p("ie");k=10===p("ie");var ht=void 0===p("ie")&&7==p("trident"),at=k||ht,ct=p("esri-touch");return k=n(null,{declaredClass:"esri.layers._GraphicsContainer",_setMap:function(n,i){var r,u=this._connects=[];return this._map=n,this._useWillChange="css-transforms"===n.navigationMode&&et&&p("esri-will-change"),ot?(r=e.create("div",{style:"overflow: visible; position: absolute;"},i),this._surface={getEventSource:function(){return r}},u.push(t.connect(r,"onmousedown",this,this._canvasDownHandler)),u.push(t.connect(r,"onmouseup",this,this._canvasUpHandler)),u.push(t.connect(r,"onclick",this,this._canvasClickHandler)),st.prototype._canvas=!0):(r=(this._surface=h.createSurface(i,n.width,n.height)).getEventSource(),this._useWillChange&&o.set(r,"will-change","transform"),o.set(r=ft?r.parentNode:r,{overflow:"visible",position:"absolute"})),u.push(t.connect(n,"onResize",this,"_onResizeHandler")),this._useWillChange&&(u.push(t.connect(n,"onPan",this,"_onPanHandler")),u.push(t.connect(n,"onPanEnd",this,"_onPanEndHandler")),u.push(t.connect(n,"onExtentChange",this,"_onExtentChangeHandler"))),r},_onPanHandler:function(n,t){var i=this._map.__visibleRect,r=i.x+t.x,i=i.y+t.y;this._panDx=r;this._panDy=i;o.set(this._surface.getEventSource(),v._css.names.transform,v._css.translate(r,i))},_onPanEndHandler:function(){var n=this._map.__visibleRect,t=n.x,n=n.y;this._panDx=t;this._panDy=n;o.set(this._surface.getEventSource(),v._css.names.transform,v._css.translate(t,n))},_onExtentChangeHandler:function(n,t,i){i&&(this._panDy=this._panDx=0,o.set(this._surface.getEventSource(),v._css.names.transform,v._css.translate(0,0)))},_getTransform:function(){return{dx:this._panDx||0,dy:this._panDy||0}},_onResizeHandler:function(n,t,i){n=this._surface.getEventSource();var u=this._map,e;ft&&o.set(n=n.parentNode,{width:t+"px",height:i+"px",clip:"rect(0px "+t+"px "+i+"px 0px)"});f.set(n,"width",t);f.set(n,"height",i);this._surface.declaredClass||r.forEach(n.childNodes,function(n){f.set(n,"width",t);f.set(n,"height",i)});u.loaded&&(u.graphics.suspended||(u.graphics._resized=!0),r.forEach(u.graphicsLayerIds,function(n){e=u.getLayer(n);e.suspended||(e._resized=!0,e._childLayer&&(e._childLayer._resized=!0));e._updateSVGFilters(null,null,t,i)}),u.graphics._updateSVGFilters(null,null,t,i),u._labels&&u._labels._updateSVGFilters(null,null,t,i))},_cleanUp:function(){r.forEach(this._connects,t.disconnect,t);this._map=this._surface=null},_processEvent:function(n){var t=this._map;n.screenPoint=new nt(n.pageX-t.position.x,n.pageY-t.position.y);n.mapPoint=t.toMap(n.screenPoint)},_canvasDownHandler:function(n){this._processEvent(n);this._downPt=n.screenPoint.x+","+n.screenPoint.y},_canvasUpHandler:function(n){this._processEvent(n);this._upPt=n.screenPoint.x+","+n.screenPoint.y},_tolerance:15,_isPrimaryMatch:function(n,t,i,u){if(!n.visible||!t)return!1;var f=t.getTransformedBoundingBox(),e;return f?(e=new tt(f[0].x,f[0].y,f[2].x,f[2].y),delete e.spatialReference,ct?e.intersects(i):e.contains(u)):r.some(t.children||[],function(n){return f=n.getTransformedBoundingBox(),e=new tt(f[0].x,f[0].y,f[2].x,f[2].y),delete e.spatialReference,ct?e.intersects(i):e.contains(u)})},_canvasClickHandler:function(n){var i,t;if(this._downPt&&this._upPt&&this._downPt===this._upPt){this._processEvent(n);i=this._map;t=r.map(i.graphicsLayerIds,function(n){return i.getLayer(n)});t.push(i.graphics);t.reverse();var t=r.filter(t,function(n){return n.loaded&&n._mouseEvents&&!n.suspended&&(!y.isDefined(n.opacity)||0<n.opacity)}),u=n.screenPoint,f=this._tolerance,e=u.x-f,o=u.y+f,s=u.x+f,f=u.y-f,c=new tt(e,f,s,o),e=i.toMap(new nt(e,o)),s=i.toMap(new nt(s,f)),o=e.spatialReference._getInfo(),l=new tt(tt.prototype._normalizeX(e.x,o).x,e.y,tt.prototype._normalizeX(s.x,o).x,s.y,e.spatialReference),h;delete c.spatialReference;r.some(t,function(n){if(n=r.filter(n.graphics,function(n){return this._isPrimaryMatch(n,n.getDojoShape(),c,u)||!(!n._bgShape||!this._isPrimaryMatch(n,n._bgShape,c,u))},this),n.reverse(),0<n.length){var t;if(r.some(n,function(n){return n.geometry&&l.intersects(n.geometry)?(t=n,!0):!1}),t)return h=t,!0}return!1},this);h&&(t=h.getLayer())&&(n.graphic=h,t.onClick(n))}}}),st=n(a,{declaredClass:"esri.layers._GraphicsLayer",managedSuspension:!0,surfaceType:ot?"canvas-2d":h.renderer,_eventMap:{"graphic-add":["graphic"],"graphic-remove":["graphic"],"renderer-change":["renderer"]},constructor:function(n,t){n&&(i.isString(n)||i.isObject(n)&&(n.layerDefinition||n.query))&&(n=t);this._params=i.mixin({displayOnPan:!0,drawMode:!0,styling:!0},n||{});var r=this._params.dataAttributes;"string"==typeof r&&(r=[r]);this.styling=et?this._params.styling:!0;this.dataAttributes=r;this.infoTemplate=n&&n.infoTemplate;this.graphics=[];this._draw=i.hitch(this,this._draw);this._refresh=i.hitch(this,this._refresh);this.registerConnectEvents()},getNode:function(){return this._div&&this._div.getEventSource()},setDrawMode:function(n){this._params.drawMode=n},renderer:null,_setMap:function(n,t){return this.inherited(arguments),this._map=n,this._wrap=n.wrapAround180,this._srInfo=n.spatialReference._getInfo(),this._svgFilters={},this._lineMarkers={},this._canvas?(t=h.createSurface(t.getEventSource(),n.width,n.height),o.set(t.rawNode,"position","absolute"),this._div=t.createGroup(),this._renderProto=this._div.constructor.prototype._render,this._div._render=i.hitch(this,this._canvasRender)):this._div=t.createGroup(),this._bgGroup=this._div.createGroup(),this._div.getEventSource().id=this.id+"_layer",this._initOpacity(),this._div},_unsetMap:function(n,t){r.forEach(this.graphics,function(n){n._shape=null});this._canvas?(t=this._div.getParent(),t._parent={},e.destroy(t.rawNode),t.destroy()):(this._div.clear(),t.remove(this._div),e.destroy(this._div.getEventSource()));this._map=this._div=this._svgFilters=this._lineMarkers=null;clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors();this.inherited(arguments)},_initOpacity:function(){var n=this.opacity;y.isDefined(n)&&1>n&&this.setOpacity(n,!0)},_onZoomStartHandler:function(){b.hide(this._div.getEventSource())},_onExtentChangeHandler:function(n,t,i){clearTimeout(this._wakeTimer);this._wakeTimer=null;i?(n=this._map.__visibleRect,t=this._div,this._evalSDRenderer(),this._refresh(!0),this._updateTransform(t,n.x,n.y,!0),this._renderProto&&t.surface.pendingRender?this._dirty=!0:this.suspended||b.show(t.getEventSource())):this._resized&&(this._resized=!1,this._refresh(!1));0<this.graphics.length&&this.onUpdate()},_canvasRender:function(){var n=this._div;return this._dirty&&(delete this._dirty,this.suspended||b.show(n.getEventSource())),this._renderProto.apply(n,arguments)},_refresh:function(n){for(var i=this.graphics,r=i.length,u=this._draw,t=0;t<r;t++)u(i[t],n)},refresh:function(){this._refresh(!0)},redraw:function(){this._refresh(!0)},_getTransform:function(){var n={dx:0,dy:0};return this._map&&(this._map._gc._useWillChange?n=this._map._gc._getTransform():this._div&&(n=this._div.getTransform())),n},_onPanHandler:function(n,t){this._panDx=t.x;this._panDy=t.y;var i=this._map.__visibleRect;this._updateTransform(this._div,i.x+t.x,i.y+t.y);ht&&this._updateSVGMarkers()},_onPanEndUpdateHandler:function(n,t){var i=this._map.__visibleRect;this._params._child||t.x===this._panDx&&t.y===this._panDy?(this._updateSVGFilters(-i.x,-i.y),this._updateSVGMarkers()):this._updateTransform(this._div,i.x,i.y,!0);this._refresh(!1);this.graphics.length&&this.onUpdate()},_onPanStartHandler:function(){b.hide(this._div.getEventSource())},_onPanEndHandler:function(){var t=this._map.__visibleRect,n=this._div;this._updateTransform(n,t.x,t.y,!0);this._refresh(!1);this._renderProto&&n.surface.pendingRender?this._dirty=!0:b.show(n.getEventSource());this.graphics.length&&this.onUpdate()},_updateTransform:function(n,t,i,r){this._map._gc._useWillChange||n.setTransform(c.translate({x:t,y:i}));r&&(this._updateSVGFilters(-t,-i),this._updateSVGMarkers())},onSuspend:function(){this.inherited(arguments);b.hide(this._div.getEventSource());clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors()},onResume:function(n){this.inherited(arguments);n.firstOccurrence&&this._evalSDRenderer();this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(i.hitch(this,function(){this.suspended||this._map.__zooming||this._onExtentChangeHandler(null,null,!0)}),0)},_enableDrawConnectors:function(){var n=this._map,i=t.connect;this._disableDrawConnectors();this._params.displayOnPan?(this._params._child||(this._onPanHandler_connect=i(n,"onPan",this,"_onPanHandler")),this._onPanEndHandler_connect=i(n,"onPanEnd",this,"_onPanEndUpdateHandler")):(this._onPanStartHandler_connect=i(n,"onPanStart",this,"_onPanStartHandler"),this._onPanEndHandler_connect=i(n,"onPanEnd",this,"_onPanEndHandler"));this._onZoomStartHandler_connect=i(n,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=i(n,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var n=t.disconnect;n(this._onExtentChangeHandler_connect);n(this._onZoomStartHandler_connect);n(this._onPanHandler_connect);n(this._onPanStartHandler_connect);n(this._onPanEndHandler_connect);this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null},_updateExtent:function(n){var t=n.geometry,i,r;if(t){if(!(n._extent=t.getExtent())){if("esri.geometry.Point"===t.declaredClass)i=t.x,r=t.y;else if("esri.geometry.Multipoint"===t.declaredClass)i=t.points[0][0],r=t.points[0][1];else{n._extent=null;return}n._extent=new tt(i,r,i,r,t.spatialReference)}}else n._extent=null},_intersects:function(n,t,i){var s=n.spatialReference,u=t.spatialReference,e=s&&u&&!s.equals(u)&&s._canProject(u)&&4326===u.wkid;if(this._wrap&&!i){i=[];var s=n._getFrameWidth(),o=this._srInfo,h=n._clip?n._getAvailExtent():n.extent,f,v,c,l,a=[];if(f=t._partwise,e&&(h=n.geographicExtent,o=u._getInfo()),n=h._getParts(o),f&&f.length)for(t=[],u=0,e=f.length;u<e;u++)t=t.concat(f[u]._getParts(o));else t=t._getParts(o);for(u=0,e=t.length;u<e;u++)for(c=t[u],o=0,h=n.length;o<h;o++)if(l=n[o],l.extent.intersects(c.extent))for(f=0,v=c.frameIds.length;f<v;f++)i.push((l.frameIds[0]-c.frameIds[f])*s);for(u=0,e=i.length;u<e;u++)f=i[u],r.indexOf(i,f)===u&&a.push(f);return a.length?a:null}return(e?n.geographicExtent:n.extent).intersects(t)?[0]:null},_defaultMarker:{type:"simplemarkersymbol",style:"square",size:1,xoffset:0,yoffset:0,angle:0},_draw:function(n,t){var s,r,v,h,c,y;if(this._params.drawMode&&this._map&&!this.suspended&&!this._map.__zooming&&!this._resized)try{var o=n._extent,f,i,e=!et||this.styling,p=et&&this.dataAttributes,l=n.getDojoShape(),w;if(n.visible&&o&&(f=this._intersects(this._map,o,n.geometry._originOnly))&&(i=e?this._getSymbol(n):this._defaultMarker)){if(n._offsets&&n._offsets.join(",")===f.join(",")?w=!0:n._offsets=f,!l||t||!w){var r=n.geometry.type,o={graphic:n},a=n._bgShape,u=e&&!n.symbol?this._getRenderer(n):null,b=u&&u.backgroundFillSymbol;"point"===r?(this._isInvalidShape(i,l)&&this._removeShape(n),n._shape=this._drawPoint(this._div,n.geometry,i,n.getDojoShape(),f,u,n),e&&this._symbolizePoint(n.getDojoShape(),i,u,n)):"multipoint"===r?(this._drawMarkers(n,i,f,u),e&&this._symbolizeMarkers(n,i,u)):(r=i,e&&(r=(s="simplemarkersymbol"===i.type||"picturemarkersymbol"===i.type||"textsymbol"===i.type?i:null)?b:i),e&&r&&-1<r.type.indexOf("fillsymbol")&&(v=this._bgGroup,c=!(!v||!s)),a&&!c&&this._removeBgShape(n),r&&(!c&&this._isInvalidShape(r,n._shape)&&this._removeShape(n,!1),h=this._drawShape(n,f,v||this._div,c?a:n.getDojoShape()),e&&this._symbolizeShape(h,r,u,r===b,n),n[c?"_bgShape":"_shape"]=h),s&&(this._isInvalidShape(s,n._shape)&&this._removeShape(n,!1),y=n.geometry.getCentroid(),(h=y&&this._drawPoint(this._div,y,s,n._shape,f,u,n))&&this._symbolizePoint(h,s,u,n),n._shape=h));ot||(n._bgShape&&this._initNode(n,n._bgShape,n._bgShape!==a,o,p),n._shape&&this._initNode(n,n._shape,n._shape!==l,o,p));o.node=n.getNode();this.onGraphicDraw(o)}}else l&&this._removeShape(n)}catch(k){this._errorHandler(k,n)}},_initNode:function(n,t,i,r,u){(t=t&&t.getNode())&&(t.e_graphic=n,this._addDataAttrs(n,u,t),i&&(r.node=t,this.onGraphicNodeAdd(r)))},_removeShape:function(n,t,i){var r=n.getDojoShape(),u=r&&r.getNode();if(r&&!i&&(r.removeShape(),r.destroy()),n._shape=n._offsets=null,!1!==t&&this._removeBgShape(n,i),u&&(u.e_graphic=null,!ot))this.onGraphicNodeRemove({graphic:n,node:u})},_removeBgShape:function(n,t){var i=n._bgShape,r=i&&i.getNode();if(i&&!t&&(i.removeShape(),i.destroy()),n._bgShape=null,r&&(r.e_graphic=null,!ot))this.onGraphicNodeRemove({graphic:n,node:r})},_addDataAttrs:function(n,t,i){var f=n.attributes,u,e=t?t.length:0,r=this._getRenderer(n);if(i&&f){for(u=0;u<e;u++)(i=t[u])&&n.attr("data-"+i,f[i]);!this.styling&&r&&(r.getBreakIndex?(t=r.getBreakIndex(n),n.attr("data-class-break",-1!==t?t:null)):r.getUniqueValueInfo&&(t=r.getUniqueValueInfo(n),n.attr("data-unique-value",t?t.value:null)))}},_drawShape:function(n,t,i,r){n=n.geometry;var u=n.type,o=this._map,s=o.extent,h=o.width,c=o.height,o=o.__visibleRect,f=[],e,l;if(e="extent"===u,"rect"===u||e)f={x:0,y:0,spatialReference:n.spatialReference},f.x=e?n.xmin:n.x,f.y=e?n.ymax:n.y,u=rt.toScreenPoint(s,h,c,f),f.x=e?n.xmax:n.x+n.width,f.y=e?n.ymin:n.y+n.height,n=rt.toScreenPoint(s,h,c,f),t={x:u.x-o.x+t[0],y:u.y-o.y,width:Math.abs(n.x-u.x),height:Math.abs(n.y-u.y)},0===t.width&&(t.width=1),0===t.height&&(t.height=1),r=this._drawRect(i,r,t);else if("polyline"===u||"polygon"===u){for(e=0,l=t.length;e<l;e++)f=f.concat(rt._toScreenPath(s,h,c,n,-o.x+t[e],-o.y));r=this._drawPath(i,r,f);this._rendererLimits&&("polyline"===u?this._clipPolyline(r,n):this._clipPolygon(r,n))}return r},_drawRect:function(n,t,i){return t?t.setShape(i):n.createRect(i)},_drawImage:function(n,t,i){return t?t.setShape(i):n.createImage(i)},_drawCircle:function(n,t,i){return t?t.setShape(i):n.createCircle(i)},_drawPath:function(){return ft?function(n,t,i,r){return(i=r?i:i.join(" "),t)?t.setShape(i):(t=n.createObject(r?h.Path:h.EsriPath,i),n._overrideSize(t.getEventSource()),t)}:function(n,t,i,r){return i=r?i:i.join(" "),t?t.setShape(i):n.createPath(i)}}(),_drawText:function(n,t,i){return t?t.setShape(i):n.createText(i)},_evalSDRenderer:function(n){var t=this._map,i=this.renderer,r,u=this._rndForScale;t&&t.loaded&&i&&i.getRendererInfo&&(r="zoom"===i.rangeType?i.getRendererInfoByZoom(t.getZoom()):i.getRendererInfoByScale(t.getScale()));this._rndForScale=r&&r.renderer;(t=this._getRenderer())&&t.prepareForViewChange();n||this._rndForScale==u||this.emit("renderer-change",{renderer:this._rndForScale})},_getRenderer:function(n){var t=this._rndForScale||this.renderer;return n&&t&&t.getObservationRenderer&&(t=t.getObservationRenderer(n)),t},_getSymbol:function(n){var t=this._getRenderer();return n.symbol||t&&t.getSymbol(n)},_getVariable:function(n,t,i){var r;return n&&(r=(n=n.getVisualVariablesForType(t,i))&&n[0]),r},_applyOpacity:function(n,t,i,r){return t=t.getOpacity(r,{opacityInfo:i}),null!=t&&(n=new w(n),n.a=t),n},_symbolizeShape:function(n,t,r,u,f){var l=t.getStroke(),a=t.getFill(),y=t.type,e,o,v=-1!==y.indexOf("linesymbol"),s=-1!==y.indexOf("fillsymbol")?null:this._getVariable(r,"sizeInfo",!1),h=this._getVariable(r,"colorInfo",!1),c=this._getVariable(r,"opacityInfo",!1),w=v?"none"!==t.style:t.outline&&"none"!==t.outline.style,p=v?null:this._getVariable(r,"sizeInfo","outline"),s=(s=u?p:p||s)?r.getSize(f,{sizeInfo:s,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):null;u&&(h=c=null);(h||c)&&"picturefillsymbol"!==y&&(v?(e=l&&l.color,h&&(e=r.getColor(f,{colorInfo:h})||e),e&&c&&(e=this._applyOpacity(e,r,c,f))):a&&a.toCss&&(o=a,h&&(o=r.getColor(f,{colorInfo:h})||o),o&&c&&(o=this._applyOpacity(o,r,c,f))));n.setStroke(!w||null==s&&!e?l:i.mixin({},l,null!=s?{width:s}:null,e&&{color:e})).setFill(o||a);v&&this._applyLineMarker(n,t)},_smsToPath:function(){return ft?function(n,t,i,r,u,f,e,o,s){switch(t){case n.STYLE_SQUARE:return["M",u+","+e,"L",f+","+e,f+","+o,u+","+o,"X","E"];case n.STYLE_CROSS:return["M",i+","+e,"L",i+","+o,"M",u+","+r,"L",f+","+r,"E"];case n.STYLE_X:return["M",u+","+e,"L",f+","+o,"M",u+","+o,"L",f+","+e,"E"];case n.STYLE_DIAMOND:return["M",i+","+e,"L",f+","+r,i+","+o,u+","+r,"X","E"];case n.STYLE_TARGET:return["M",u+","+e,"L",f+","+e,f+","+o,u+","+o,u+","+e,"M",u-s+","+r,"L",u+","+r,"M",i+","+(e-s),"L",i+","+e,"M",f+s+","+r,"L",f+","+r,"M",i+","+(o+s),"L",i+","+o,"E"]}}:function(n,t,i,r,u,f,e,o,s){switch(t){case n.STYLE_SQUARE:return["M",u+","+e,f+","+e,f+","+o,u+","+o,"Z"];case n.STYLE_CROSS:return["M",i+","+e,i+","+o,"M",u+","+r,f+","+r];case n.STYLE_X:return["M",u+","+e,f+","+o,"M",u+","+o,f+","+e];case n.STYLE_DIAMOND:return["M",i+","+e,f+","+r,i+","+o,u+","+r,"Z"];case n.STYLE_TARGET:return["M",u+","+e,f+","+e,f+","+o,u+","+o,u+","+e,"M",u-s+","+r,u+","+r,"M",i+","+(e-s),i+","+e,"M",f+s+","+r,f+","+r,"M",i+","+(o+s),i+","+o]}}}(),_pathStyles:{square:1,cross:1,x:1,diamond:1,target:1},_typeMaps:{picturemarkersymbol:"image",picturefillsymbol:"path",simplefillsymbol:"path",simplelinesymbol:"path",cartographiclinesymbol:"path",textsymbol:"text"},_isInvalidShape:function(n,t){var r=t&&t.shape&&t.shape.type,u=n&&n.type,i=n&&n.style;return"rect"===r&&(r="path"),u&&(i=this._typeMaps[u]||i),this._pathStyles[i]&&(i="path"),"shieldlabelsymbol"===u?!0:!(!r||!i||r===i)},_reArialFont:/\s*(^|,)\s*arial\s*(,|$)\s*/i,_fallbackFont:"Arial",_drawPoint:function(n,t,i,r,u,f,e){var y=i.type,s=this._map,l=s.__visibleRect,h=rt.toScreenPoint(s.extent,s.width,s.height,t).offset(-l.x+u[0],-l.y),l=h.x,a=h.y,o;t=[];var v,p=this._getVariable(f,"rotationInfo",!1),p=p?f.getRotationAngle(e,{rotationInfo:p}):null,w=this._getVariable(f,"sizeInfo",!1),s=w?f.getSize(e,{sizeInfo:w,shape:i.style,resolution:s.getResolutionInMeters(),scale:s.getScale()}):null;if(p&&t.push(c.rotategAt(p,h)),(0!==i.xoffset||0!==i.yoffset)&&(v=c.translate(i.xoffset,-i.yoffset),t.push(v)),0!==i.angle&&t.push(c.rotategAt(i.angle,h)),"simplemarkersymbol"===y)switch(o=i.style,f=Math.round,s=null!=s?s:i.size,o){case d.STYLE_SQUARE:case d.STYLE_CROSS:case d.STYLE_X:case d.STYLE_DIAMOND:i=isNaN(s)?16:s/2;o=this._drawPath(n,r,this._smsToPath(d,o,l,a,f(l-i),f(l+i),f(a-i),f(a+i)));break;case d.STYLE_TARGET:e=i._targetWidth/2;h=i._targetHeight/2;o=this._drawPath(n,r,this._smsToPath(d,o,l,a,f(l-e),f(l+e),f(a-h),f(a+h),i._spikeSize));break;case d.STYLE_PATH:o=this._drawPath(n,r,i.path,!0);i=o.getBoundingBox();n=this._getScaleMatrix(i,s);1===n.xx&&1===n.yy||t.push(c.scaleAt(n.xx,n.yy,h));t.push(c.translate(-(i.x+i.width/2)+l,-(i.y+i.height/2)+a));break;default:i=isNaN(s)?16:s/2;o=this._drawCircle(n,r,{cx:l,cy:a,r:i})}else"shieldlabelsymbol"===y?(o=i.width,h=i.height,r=n.createGroup(),o=n.createImage({x:l-o/2,y:a-h/2,width:o,height:h,src:i.url}),r.add(o),null!=i.font&&(a+=.2*i.getHeight(),n=n.createText({type:"text",text:i.text,x:l,y:a,align:"middle",decoration:i.decoration,rotated:i.rotated,kerning:i.kerning}),n.setFont(i.font),n.setFill(i.color),r.add(n)),o=r):"picturemarkersymbol"===y?(null==s?(o=i.width,h=i.height):(h=s,o=i.width/i.height*h,v&&(null!=v.dx&&(v.dx=v.dx/i.width*o),null!=v.dy&&(v.dy=v.dy/i.height*h))),o=this._drawImage(n,r,{x:l-o/2,y:a-h/2,width:o,height:h,src:i.url}),et&&(n=o.getNode()))&&(i=(i=this._getVariable(f,"opacityInfo",!1))?f.getOpacity(e,{opacityInfo:i}):null,null!=i?n.setAttribute("opacity",i):n.setAttribute("opacity",1)):"textsymbol"===y&&((f=i.font)&&(o=null!=s,e=f.family&&!this._reArialFont.test(f.family),(o||e)&&(f=new f.constructor(f.toJson())),o&&f.setSize(s),e&&f.setFamily(f.family+","+this._fallbackFont)),o=this._drawText(n,r,{type:"text",text:i.text,x:l,y:a,align:i.getSVGAlign(),decoration:i.decoration||f&&f.decoration,rotated:i.rotated,kerning:i.kerning}),f&&o.setFont(f),et&&(n=o.getNode(),l=i.getSVGBaseline(),a=i.getSVGBaselineShift(),n&&(n.setAttribute("dominant-baseline",l),a&&n.setAttribute("baseline-shift",a),this._applyHalo(o,i.haloColor,i.haloSize))));return o.setTransform(c.multiply(t)),o._wrapOffsets=u,o},_applyLineMarker:function(n,t){var f,r;if(et&&!lt){var i=n&&n.rawNode,u=t.color,r=t.marker;i&&u&&r&&"arrow"===r.style&&r.placement?i.getTotalLength&&0===i.getTotalLength()?this._removeSVGMarkers(i):(f=-1!==r.placement.indexOf("begin"),r=-1!==r.placement.indexOf("end"),f||r?(i.removeAttribute("stroke-opacity"),i.setAttribute("opacity",u.a),f?this._applySVGMarker(i,u,"spear","start"):i.removeAttribute("marker-start"),r?this._applySVGMarker(i,u,"spear","end"):i.removeAttribute("marker-end")):this._removeSVGMarkers(i)):i&&this._removeSVGMarkers(i)}},_lineMarkerInfo:{marker:{markerWidth:"6",markerHeight:"6",markerUnits:"strokeWidth",orient:"auto"},spear:{marker:{end:{viewBox:"0 0 25.4 23.43",refX:"20",refY:"12.76"},start:{viewBox:"-25.4 0 25.4 23.43",refX:"-20",refY:"12.76"}},path:{common:{d:"M1.63 23.43 L5.37 16.6 L5.37 8.93 L1.63 2.09 L25.4 12.76 L1.63 23.43 Z","stroke-width":"0","fill-opacity":"1"},start:{transform:"matrix(-1, 0, 0, 1, 0, 0)"}}}},_applySVGMarker:function(n,t,i,r){var u=this._getSVGMarkerId(t,r);this._getSVGMarker(u)||this._createSVGMarker(t,u,i,r);n.setAttribute("marker-"+r,"url(#"+u+")")},_removeSVGMarkers:function(n){n.removeAttribute("marker-start");n.removeAttribute("marker-end");n.removeAttribute("opacity")},_getSVGMarkerId:function(n,t){return"marker_"+this._map.id+"_"+n.r+"_"+n.g+"_"+n.b+"_"+t},_getSVGMarker:function(n){return this._lineMarkers[n]},_createSVGMarker:function(n,t,i,r){var f=this._lineMarkerInfo,e;return i=f[i],e=u.doc.createElementNS("http://www.w3.org/2000/svg","marker"),e.setAttribute("id",t),this._setAttributes(e,f.marker),this._setAttributes(e,i.marker[r]),f=u.doc.createElementNS("http://www.w3.org/2000/svg","path"),f.setAttribute("fill",n.toCss()),this._setAttributes(f,i.path.common),this._setAttributes(f,i.path[r]),e.appendChild(f),this._div.getParent().defNode.appendChild(e),this._lineMarkers[t]=e},_setAttributes:function(n,t){for(var i in t)n.setAttribute(i,t[i])},_updateSVGMarkers:function(){var t,n,i;if(et&&at){t=this._lineMarkers;for(n in t)i=t[n],i.setAttribute("id",n+"_temp"),i.setAttribute("id",n)}},_applyHalo:function(n,t,i){var r=t&&i?this._getHaloId(t,i):null;n.setFilter(t&&i?p("webkit")||p("ff")?this._getDilateFilter(t,i,r):this._getOffsetFilter(t,i,r):null)},_getDilateFilter:function(n,t,i){var r=this._getSVGFilter(i);return r||(r=this._createSVGFilter({id:i},[l.feMorphology({operator:"dilate",radius:t,result:"dilated"}),l.feFlood({"flood-color":n.toCss(!0)}),l.feComposite({in2:"dilated",operator:"in",result:"composite"}),l.feMerge("composite","SourceGraphic")])),r},_getOffsetFilter:function(n,t,i){var r=this._getSVGFilter(i);if(!r){n=n.toCss(!0);for(var r=this._offsetPrimitives,c=r.length,e=[],o=[],u=0;u<c;u++){var f=r[u],s="offset"+f.dir,h="composite"+f.dir;o.push(h);e.push(l.feOffset({dx:f.dx*t,dy:f.dy*t,"in":"SourceAlpha",result:s}),l.feFlood({"flood-color":n}),l.feComposite({in2:s,operator:"in",result:h}))}o.push("SourceGraphic");e.push(l.feMerge.apply(l.feMerge,o));r=this._createSVGFilter({id:i},e)}return r},_offsetPrimitives:[{dir:"L",dx:-1,dy:0},{dir:"TL",dx:-1,dy:-1},{dir:"T",dx:0,dy:-1},{dir:"TR",dx:1,dy:-1},{dir:"R",dx:1,dy:0},{dir:"BR",dx:1,dy:1},{dir:"B",dx:0,dy:1},{dir:"BL",dx:-1,dy:1}],_getHaloId:function(n,t){return"halo_"+this._map.id+"_"+this.id+"_"+n.r+"_"+n.g+"_"+n.b+"_"+n.a+"_"+t},_getSVGFilter:function(n){return this._svgFilters[n]},_createSVGFilter:function(n,t){var i=l.createFilter(n,t),r=this._map,u=r.__visibleRect;return i.x=-u.x,i.y=-u.y,i.width=r.width,i.height=r.height,this._svgFilters[n.id]=i},_updateSVGFilters:function(n,t,i,r){var o=this._svgFilters,u,e,f;for(e in o)(u=o[e])&&((f=s.byId(e))&&(null!=n&&f.setAttribute("x",n),null!=t&&f.setAttribute("y",t),null!=i&&f.setAttribute("width",i),null!=r&&f.setAttribute("height",r)),null!=n&&(u.x=n),null!=t&&(u.y=t),null!=i&&(u.width=i),null!=r&&(u.height=r))},_getScaleMatrix:function(n,t){var i=n.width/n.height,r=1,u=1;return isNaN(t)||(1<i?(r=t/n.width,u=t/i/n.height):(u=t/n.height,r=t*i/n.width)),{xx:r,yy:u}},_symbolizePoint:function(n,t,r,u){var o=t.type,s=t.style,e,h,c;if("shieldlabelsymbol"!==o&&"picturemarkersymbol"!==o){e=t.getStroke();t=t.getFill();var s=s===d.STYLE_X||s===d.STYLE_CROSS,l=e&&e.color,f=s?l:t;r&&(h=this._getVariable(r,"colorInfo",!1),c=this._getVariable(r,"opacityInfo",!1),h&&(f=r.getColor(u,{colorInfo:h})||f),f&&c&&(f=this._applyOpacity(f,r,c,u)),f&&(s?f!==l&&(e=e?i.mixin({},e):{},e.color=f):f!==t&&(t=f)));"textsymbol"===o?n.setFill(t):"simplemarkersymbol"===o&&n.setFill(t).setStroke(e)}},_drawMarkers:function(n,t,i,r){var h=n.geometry,c=h.points,u=n.getDojoShape()||this._div.createGroup(),o,f,s=c.length,l=[],a=0,e,v=i?i.length:0;for(u.children[0]&&this._isInvalidShape(t,u.children[0])&&u.clear(),f=0;f<s;f++)for(o=c[f],e=0;e<v;e++)l[0]=i[e],this._drawPoint(u,{x:o[0],y:o[1],spatialReference:h.spatialReference},t,u.children[a++],l,r,n);if(t=u.children.length,s*i.length<t)for(f=t-1;f>=s*i.length;f--)u.children[f].removeShape();n._shape=u},_symbolizeMarkers:function(n,t,i){for(var u=n.getDojoShape().children,f=u.length,r=0;r<f;r++)this._symbolizePoint(u[r],t,i,n)},_errorHandler:function(n,t){n.message=t?"Unable to draw graphic (geometry:"+(t.geometry?t.geometry.declaredClass:null)+", symbol:"+(t.symbol?t.symbol.declaredClass:null)+"): "+n.message:"Unable to draw graphic (null): "+n.message;this.inherited(arguments)},_rendererLimits:function(){var n,t,i;return p("ff")?(n=16125,t=-32250,i=32250):ft?(n=1e5,t=-1e5,i=1e5):p("chrome")&&6>p("chrome")&&(n=8150,t=-1e4,i=1e4),n?{clipLimit:n,rangeMin:t,rangeMax:i,clipBBox:[-n,-n,n,n],clipSegments:[[[-n,-n],[n,-n]],[[n,-n],[n,n]],[[n,n],[-n,n]],[[-n,n],[-n,-n]]]}:void 0}(),_clipPolyline:function(n,t){var e=this._getCorners(n,t),v=e.br,i=this._rendererLimits,o=i.rangeMin,s=i.rangeMax,f=i.clipBBox,h=i.clipSegments,i=this._isPointWithinRange,c=this._isPointWithinBBox,l=this._getClipperIntersection,a=this._getPlaneIndex,u;i(e.tl,o,s)&&i(v,o,s)||(ft&&this._createSegments(n),u=[],r.forEach(n.segments,function(n){var v,r,s;for(n=n.args,v=n.length,r=[],s=0;s<v;s+=2){var t=[n[s],n[s+1]],o=[n[s+2],n[s+3]],e=c(t,f),i=c(o,f);e^i?(i=l([t,o],h))&&(e?(s?r.push(i[1]):r.push(t,i[1]),u.push(r),r=[]):r.push(i[1],o)):e?s?r.push(o):r.push(t,o):(i=a(t,f),e=a(o,f),-1!==i&&-1!==e&&i!==e&&(t=l([t,o],h,!0),0<t.length&&(t[i]||(i=t[i[0]]?i[0]:i[1]),t[e]||(e=t[e[0]]?e[0]:e[1]),o=t[i],t=t[e],o&&r.push(o),t&&(r.push(t),u.push(r),r=[]))))}u.push(r)}),n.setShape(this._getPathStringFromPaths(u)))},_clipPolygon:function(n,t){var o=this._getCorners(n,t),p=o.br,e=this._rendererLimits,u=e.clipLimit,s=e.rangeMin,h=e.rangeMax,f=e.clipBBox,c=e.clipSegments,e=this._isPointWithinRange,l=this._isPointWithinBBox,a=this._getClipperIntersection,v=this._getPlaneIndex,y=it._pointLineDistance;e(o.tl,s,h)&&e(p,s,h)||(ft&&this._createSegments(n),o=r.filter(n.segments,function(n){return n.args&&n.args.length}),o=r.map(o,function(n){var o=n.args,h=o.length,t=[],s,e,b,p,w,k,it,rt;for(n=[],s=0;s<h;s+=2){if(e=[o[s],o[s+1]],b=[o[s+2],o[s+3]],s===h-2){t.push(e);break}w=l(e,f);p=l(b,f);t.push(e);w^p?(p=a([e,b],c))&&(e=p[1],e[w?"inOut":"outIn"]=!0,t.push(e),n.push([w?"INOUT":"OUTIN",t.length-1,p[0]])):w||(w=v(e,f),k=v(b,f),-1!==w&&-1!==k&&w!==k&&(p=a([e,b],c,!0),0<p.length?(p[w]||(w=p[w[0]]?w[0]:w[1]),p[k]||(k=p[k[0]]?k[0]:k[1]),e=p[w],b=p[k],e&&(e.outIn=!0,t.push(e),n.push(["OUTIN",t.length-1,w])),b&&(b.inOut=!0,t.push(b),n.push(["INOUT",t.length-1,k]))):i.isArray(w)&&i.isArray(k)&&(p=w.concat(k),p.sort(),"0123"===p.join("")&&(p=[],3===w[0]+w[1]?p.push([u,-u],[-u,u]):p.push([-u,-u],[u,u]),w=y(p[0],[e,b]),e=y(p[1],[e,b]),t.push(w<e?p[0]:p[1])))))}var d=f[0],g=f[1],nt=f[2],tt=f[3];if(r.forEach(t,function(n){n[0]<d&&(n[1]>=g&&n[1]<=tt?n[0]=d:(n[0]=d,n[1]=n[1]<g?g:tt))}),r.forEach(t,function(n){n[1]<g&&(n[0]>=d&&n[0]<=nt?n[1]=g:(n[1]=g,n[0]=n[0]<d?d:nt))}),r.forEach(t,function(n){n[0]>nt&&(n[1]>=g&&n[1]<=tt?n[0]=nt:(n[0]=nt,n[1]=n[1]<g?g:tt))}),r.forEach(t,function(n){n[1]>tt&&(n[0]>=d&&n[0]<=nt?n[1]=tt:(n[1]=tt,n[0]=n[0]<d?d:nt))}),o=0,h=n.length,0<h)do{if(b=n[o],s=n[(o+1)%h],b[2]===s[2]&&"INOUT"===b[0]&&"OUTIN"===s[0])if(e=b[1],s=s[1],e<s)for(e+=1;e<s;e++)t[e][2]=!0;else if(e>s){for(e+=1;e<t.length;e++)t[e][2]=!0;for(e=0;e<s;e++)t[e][2]=!0}o=(o+1)%h}while(0!==o);for(h=t[0],o=t[t.length-1],h[2]&&(o[2]=!0,r.some(n,function(n){return 1===n[1]?(t.splice(t.length-1,0,i.clone(t[1])),!0):!1})),t=r.filter(t,function(n){return n[2]?!1:!0}),o=0;o<t.length-1;o++)h=t[o],(s=t[o+1])&&h[0]===s[0]&&h[1]===s[1]&&(s.outIn?h.outIn=!0:s.inOut&&(h.inOut=!0),t.splice(o+1,1));for(h=Math.abs,n=[],o=0;o<t.length-1;o++)b=t[o],e=b[0],b=b[1],w=h(e)===u,p=h(b)===u,s=t[o+1],k=s[0],s=s[1],it=h(k)===u,rt=h(s)===u,w&&rt?n.push([o+1,[e,s]]):p&&it&&n.push([o+1,[k,b]]);for(o=n.length-1;0<=o;o--)s=n[o],e=t[s[0]-1],h=t[s[0]],e.outIn||e.inOut||h.outIn||h.inOut||t.splice(s[0],0,s[1]);return h=t[0],o=t[t.length-1],h[0]===o[0]&&h[1]===o[1]||t.push(h),t}),n.setShape(this._getPathStringFromPaths(o)))},_getCorners:function(n,t){if(ft){var u=this._map,i=t.getExtent(),f=i.spatialReference,r=u.toScreen(new g(i.xmin,i.ymax,f)),u=u.toScreen(new g(i.xmax,i.ymin,f));return{tl:r,br:u}}return r=n.getTransformedBoundingBox(),{tl:r[0],br:r[2]}},_createSegments:function(n){n.shape.path=n.vmlPath;n.segmented=!1;n._confirmSegmented();var t=n.segments;1<t.length&&(n.segments=r.filter(t,function(n,t,i){return t=i[t+1],"M"===n.action&&t&&"L"===t.action?(n.args=n.args.concat(t.args),!0):!1}))},_getPathStringFromPaths:function(n){return ft?(n=r.map(n,function(n){return"m "+r.map(n,function(n,t){return(1===t?"l ":"")+n.join(",")}).join(" ")}),n.push("e")):n=r.map(n,function(n){return"M "+r.map(n,function(n){return n.join(",")}).join(" ")}),n.join(" ")},_isPointWithinBBox:function(n,t){var u=t[1],f=t[2],e=t[3],i=n[0],r=n[1];return i>t[0]&&i<f&&r>u&&r<e?!0:!1},_isPointWithinRange:function(n,t,i){var r=n.x;return n=n.y,r<t||n<t||r>i||n>i?!1:!0},_getClipperIntersection:function(n,t,i){for(var o=it._getLineIntersection2,e=Math.round,f={length:0},r,u=0;4>u;u++)if(r=o(n,t[u]),r)if(r[0]=e(r[0]),r[1]=e(r[1]),i)f[u]=r,f.length++;else return[u,r];return i?f:null},_getPlaneIndex:function(n,t){var i=n[0],r=n[1],u=t[0],f=t[1],e=t[2],o=t[3];return i<=u?r>=f&&r<=o?3:r<f?[0,3]:[2,3]:r<=f?i>=u&&i<=e?0:i<u?[3,0]:[1,0]:i>=e?r>=f&&r<=o?1:r<f?[0,1]:[2,1]:r>=o?i>=u&&i<=e?2:i<u?[3,2]:[1,2]:-1},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicNodeAdd:function(){},onGraphicNodeRemove:function(){},onGraphicDraw:function(){},onGraphicsClear:function(){},onRendererChange:function(){},onOpacityChange:function(){},setInfoTemplate:function(n){this.infoTemplate=n},add:function(n,t){if(n._graphicsLayer===this)return n;if(t||this.graphics.push(n),n._graphicsLayer=this,n._sourceLayer||(n._layer&&"esri.layers.GraphicsLayer"!==n._layer.declaredClass?n._sourceLayer=n._layer:"esri.layers.GraphicsLayer"!==this.declaredClass&&(n._sourceLayer=this)),n._layer=this,this._updateExtent(n),this._draw(n),!t)this.onGraphicAdd(n);return n},remove:function(n,t,i){if(!t&&!i){if(t=this.graphics,-1===(n=r.indexOf(t,n)))return null;n=t.splice(n,1)[0]}n.getDojoShape()&&this._removeShape(n,null,i);n._shape=n._graphicsLayer=null;this.onGraphicRemove(n);return n},clear:function(n,t){for(var r=this.graphics,u=!ft,i=r.length-1;0<=i;i--)this.remove(r[i],null,u);this.graphics=[];this._destroyAllNodes();t||this.onGraphicsClear()},_destroyAllNodes:function(){if(!ft&&this._div){var n;this._childLayer&&(n=this._childLayer.getNode())&&n.parentNode&&n.parentNode.removeChild(n);this._bgGroup.clear();this._div.clear();this._bgGroup=this._div.createGroup();n&&this._div.getEventSource().appendChild(n);this._initOpacity()}},clearNodes:function(){for(var t=this.graphics,i=t.length,n=0;n<i;n++)this._removeShape(t[n],!0,!0);this._destroyAllNodes()},_setIEOpacity:function(n,t){var u=n&&n.getNode(),r,i;u&&(r=n.strokeStyle,i=u.stroke,r&&i&&(i.opacity=r.color.a*t),r=n.fillStyle,i=u.fill,r&&i&&("tile"===i.type?o.set(u,"opacity",t):i.opacity=r.a*t))},setOpacity:function(n,t){if(t||this.opacity!=n){var i=this._div;if(i&&(ft?(r.forEach(this.graphics,function(t){this._setIEOpacity(t._shape,n);this._setIEOpacity(t._bgShape,n)},this),i._esriIeOpacity=n,this._bgGroup._esriIeOpacity=n):this._canvas?o.set(i.getEventSource(),"opacity",n):i.getEventSource().setAttribute("opacity",n)),this.opacity=n,!t)this.onOpacityChange(n)}},setRenderer:function(n){this.renderer=n;this._evalSDRenderer(!0);this.emit("renderer-change",{renderer:this._rndForScale||n})}}),n=n([st,ut],{declaredClass:"esri.layers.GraphicsLayer",constructor:function(){this.enableMouseEvents=i.hitch(this,this.enableMouseEvents);this.disableMouseEvents=i.hitch(this,this.disableMouseEvents);this._processEvent=i.hitch(this,this._processEvent);this._initLayer()},_initLayer:function(){this.loaded=!0;this.onLoad(this)},_setMap:function(){var n=this.inherited("_setMap",arguments);return this.enableMouseEvents(),n},_unsetMap:function(){this.disableMouseEvents();this.inherited("_unsetMap",arguments)},_processEvent:function(n){var i=this._map,t=n.target,r;for(n.screenPoint=new nt(n.pageX-i.position.x,n.pageY-i.position.y),n.mapPoint=i.toMap(n.screenPoint);t&&!(r=t.e_graphic);)t=t.parentNode;if(r)return n.graphic=r,n},_onMouseOverHandler:function(n){if(this._processEvent(n))this.onMouseOver(n)},_onMouseMoveHandler:function(n){if(this._processEvent(n))this.onMouseMove(n)},_onMouseDragHandler:function(n){if(this._processEvent(n))this.onMouseDrag(n)},_onMouseOutHandler:function(n){if(this._processEvent(n))this.onMouseOut(n)},_onMouseDownHandler:function(n){this._downGr=this._downPt=null;this._processEvent(n)&&(t.disconnect(this._onmousemove_connect),t.disconnect(this._onmousedrag_connect),this._onmousedrag_connect=t.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler"),this._downGr=n.graphic,this._downPt=n.screenPoint.x+","+n.screenPoint.y,this.onMouseDown(n))},_onMouseUpHandler:function(n){this._upGr=this._upPt=null;this._processEvent(n)&&(t.disconnect(this._onmousedrag_connect),t.disconnect(this._onmousemove_connect),this._onmousemove_connect=t.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler"),this._upGr=n.graphic,this._upPt=n.screenPoint.x+","+n.screenPoint.y,this.onMouseUp(n))},_onClickHandler:function(n){if(this._processEvent(n)){var t=this._downGr,i=this._upGr;t&&i&&t===i&&this._downPt===this._upPt&&(ft&&(v._ieGraphic=n.graphic),this.onClick(n))}},_onDblClickHandler:function(n){if(this._processEvent(n))this.onDblClick(n)},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(!this._mouseEvents){var n=t.connect,i=this._div.getEventSource();ot||(this._onmouseover_connect=n(i,"onmouseover",this,"_onMouseOverHandler"),this._onmousemove_connect=n(i,"onmousemove",this,"_onMouseMoveHandler"),this._onmouseout_connect=n(i,"onmouseout",this,"_onMouseOutHandler"),this._onmousedown_connect=n(i,"onmousedown",this,"_onMouseDownHandler"),this._onmouseup_connect=n(i,"onmouseup",this,"_onMouseUpHandler"),this._onclick_connect=n(i,"onclick",this,"_onClickHandler"),this._ondblclick_connect=n(i,"ondblclick",this,"_onDblClickHandler"));this._mouseEvents=!0}},disableMouseEvents:function(){if(this._mouseEvents){var n=t.disconnect;n(this._onmouseover_connect);n(this._onmousemove_connect);n(this._onmousedrag_connect);n(this._onmouseout_connect);n(this._onmousedown_connect);n(this._onmouseup_connect);n(this._onclick_connect);n(this._ondblclick_connect);this._mouseEvents=!1}}}),n._GraphicsContainer=k,n._GraphicsLayer=st,p("extend-esri")&&(i.setObject("layers.GraphicsLayer",n,v),i.setObject("layers._GraphicsContainer",k,v),i.setObject("layers._GraphicsLayer",st,v)),n})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(n,t,i){return t.switchTo(i),t})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(n,t,i,r,u){var f=null;return i.add("vml",function(n,t,i){return i.innerHTML='<v:shape adj="1"/>',n="adj"in i.firstChild,i.innerHTML="",n}),{load:function(e,o,s){function a(){o(["dojox/gfx/"+h],function(t){n.renderer=h;f=t;s(t)})}var h,l,c;if(f&&"force"!=e)s(f);else{for(h=u.forceGfxRenderer,e=!h&&(t.isString(u.gfxRenderer)?u.gfxRenderer:"svg,vml,canvas,silverlight").split(",");!h&&e.length;)switch(e.shift()){case"svg":"SVGAngle"in r.global&&(h="svg");break;case"vml":i("vml")&&(h="vml");break;case"silverlight":try{i("ie")?(l=new ActiveXObject("AgControl.AgControl"),l.IsVersionSupported("1.0"))&&(c=!0):navigator.plugins["Silverlight Plug-In"]&&(c=!0)}catch(v){c=!1}finally{l=null}c&&(h="silverlight");break;case"canvas":r.global.CanvasRenderingContext2D&&(h="canvas")}"canvas"===h&&!1!==u.canvasEvents&&(h="canvasWithEvents");u.isDebug&&console.log("gfx renderer = "+h);"svg"==h&&"undefined"!=typeof svgweb?window.svgweb.addOnLoad(a):a()}}}})},"esri/layers/gfxSniff":function(){define(["dojo/has","dojox/gfx"],function(n,t){return n.add("esri-svg",function(){return-1!==t.renderer.toLowerCase().indexOf("svg")}),n})},"esri/layers/layer":function(){define("dojo/_base/declare dojo/_base/config dojo/_base/connect dojo/_base/lang dojo/_base/Deferred dojo/_base/json dojo/has ../Evented ../kernel ../lang ../request ../deferredUtils ../urlUtils ../SpatialReference ../geometry/Extent".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){var p=n([o],{declaredClass:"esri.layers.Layer",_eventMap:{error:["error"],load:["layer"],"opacity-change":["opacity"],"update-end":["error"],"visibility-change":["visible"]},constructor:function(n,t){if(this._attrs={},n&&r.isString(n)?this._url=a.urlToObject(this.url=n):(this.url=this._url=null,(t=t||n)&&(t.layerDefinition||t.query)&&(t=null)),this.spatialReference=new v(4326),this.initialExtent=new y(-180,-90,180,90,new v(4326)),this._map=this._div=null,this.normalization=!0,t&&(t.id&&(this.id=t.id),!1===t.visible&&(this.visible=!1),h.isDefined(t.opacity)&&(this.opacity=t.opacity),h.isDefined(t.minScale)&&this.setMinScale(t.minScale),h.isDefined(t.maxScale)&&this.setMaxScale(t.maxScale),this.attributionDataUrl=t.attributionDataUrl||"",this.hasAttributionData=!!this.attributionDataUrl,h.isDefined(t.showAttribution)&&(this.showAttribution=t.showAttribution),this.className=t.className,this.refreshInterval=t.refreshInterval||0),this._errorHandler=r.hitch(this,this._errorHandler),this.refresh=r.hitch(this,this.refresh),this.managedSuspension){var u=this._setMap;this._setMap=function(n){var r=u.apply(this,arguments),t;return this.evaluateSuspension(),this.suspended&&!n.loaded&&(t=i.connect(n,"onLoad",this,function(){i.disconnect(t);t=null;this.evaluateSuspension()})),r}}this.registerConnectEvents()},id:null,visible:!0,opacity:1,loaded:!1,loadError:null,minScale:0,maxScale:0,visibleAtMapScale:!1,suspended:!0,attributionDataUrl:"",hasAttributionData:!1,showAttribution:!0,refreshInterval:0,_errorHandler:function(n){this.loaded||(this.loadError=n);this.onError(n)},_setMap:function(n){if(this._map=n,this._lyrZEHandle=i.connect(n,"onZoomEnd",this,this._processMapScale),n.loaded)this.visibleAtMapScale=this._isMapAtVisibleScale();else var t=i.connect(n,"onLoad",this,function(){i.disconnect(t);t=null;this._processMapScale()})},_unsetMap:function(){i.disconnect(this._lyrZEHandle);this._toggleRT();this._map=this._lyrZEHandle=null;this._resumedOnce=void 0;this.suspended=!0},_cleanUp:function(){this._map=this._div=null},_fireUpdateStart:function(){this.updating||(this.updating=!0,this.attr("data-updating",""),this._toggleRT(),this.onUpdateStart(),this._map&&this._map._incr())},_fireUpdateEnd:function(n,t){this.updating&&(this.updating=!1,this.attr("data-updating"),this._toggleRT(!0),this.onUpdateEnd(n,t),this._map&&this._map._decr())},_getToken:function(){var n=this._url,t=this.credential;return n&&n.query&&n.query.token||t&&t.token||void 0},_findCredential:function(){this.credential=s.id&&this._url&&s.id.findCredential(this._url.path)},_useSSL:function(){var n=this._url,t=/^http:/i;this.url&&(this.url=this.url.replace(t,"https:"));n&&n.path&&(n.path=n.path.replace(t,"https:"))},refresh:function(){},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},setMinScale:function(n){this.setScaleRange(n)},setMaxScale:function(n){this.setScaleRange(null,n)},setScaleRange:function(n,t){var i=h.isDefined(n),r=h.isDefined(t),u,f;this.loaded||(this._hasMin=this._hasMin||i,this._hasMax=this._hasMax||r);u=this.minScale;f=this.maxScale;this.minScale=(i?n:this.minScale)||0;this.maxScale=(r?t:this.maxScale)||0;(u!==this.minScale||f!==this.maxScale)&&(this.onScaleRangeChange(),this._processMapScale())},suspend:function(){this._suspended=!0;this.evaluateSuspension()},resume:function(){this._suspended=!1;this.evaluateSuspension()},canResume:function(){return this.loaded&&this._map&&this._map.loaded&&this.visible&&this.visibleAtMapScale&&!this._suspended},evaluateSuspension:function(){this.canResume()?this.suspended&&this._resume():this.suspended||this._suspend()},_suspend:function(){if(this.suspended=!0,this.attr("data-suspended",""),this._toggleRT(),this.onSuspend(),this._map)this._map.onLayerSuspend(this)},_resume:function(){var r;this.suspended=!1;this.attr("data-suspended");var f=void 0===this._resumedOnce,u=this.className,t=this._attrs,n=this.getNode(),i;if(f&&(this._resumedOnce=!0,u&&n&&(r=n.getAttribute("class")||"",new RegExp("(^|\\s)"+u+"(\\s|$)","i").test(r)||n.setAttribute("class",r+((r?" ":"")+u))),t&&n))for(i in t)t.hasOwnProperty(i)&&n.setAttribute(i,t[i]);this._toggleRT(!0);this.onResume({firstOccurrence:f});if(this._map)this._map.onLayerResume(this)},_processMapScale:function(){var n=this.visibleAtMapScale;this.visibleAtMapScale=this._isMapAtVisibleScale();n!==this.visibleAtMapScale&&(this.onScaleVisibilityChange(),this.evaluateSuspension())},isVisibleAtScale:function(n){return n?p.prototype._isMapAtVisibleScale.apply(this,arguments):!1},_isMapAtVisibleScale:function(n,t){var i;if(!(n||this._map&&this._map.loaded))return!1;i=this._map;n=n||i.getScale();var r=this.minScale,u=this.maxScale,f=!r,e=!u,o;return t&&(o=i.width>i.height?i.width:i.height),f||(n<=r?f=!0:t&&(f=Math.abs(r-n)/r<1/o)),e||(n>=u?e=!0:t&&(e=Math.abs(u-n)/u<1/o)),f&&e},getAttributionData:function(){var i=this.attributionDataUrl,n=new u(l._dfdCanceller);return this.hasAttributionData&&i?(n._pendingDfd=c({url:i,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),n._pendingDfd.then(function(t){n.callback(t)},function(t){n.errback(t)})):(i=Error("Layer does not have attribution data"),i.log=!!t.isDebug,n.errback(i)),n},getResourceInfo:function(){var n=this.resourceInfo;return r.isString(n)?f.fromJson(n):r.clone(n)},getMap:function(){return this._map},getNode:function(){return this._div},attr:function(n,t){var i=this.getNode();return"data-reference"===n&&11>e("ie")?this:(i&&(null==t?i.removeAttribute(n):i.setAttribute(n,t)),this._attrs&&(null==t?delete this._attrs[n]:this._attrs[n]=t),this)},setRefreshInterval:function(n){var t=this.refreshInterval;return this.refreshInterval=n,this._toggleRT(),n&&(this.updating||this.suspended||this._toggleRT(!0)),t!==n&&this.onRefreshIntervalChange(),this},_toggleRT:function(n){n&&this.refreshInterval?(clearTimeout(this._refreshT),this._refreshT=setTimeout(this.refresh,6e4*this.refreshInterval)):this._refreshT&&(clearTimeout(this._refreshT),this._refreshT=null)},setNormalization:function(n){this.normalization=n},setVisibility:function(n){this.visible!==n&&(this.visible=n,this.onVisibilityChange(this.visible),this.evaluateSuspension());this.attr("data-hidden",n?null:"")},onLoad:function(){},onVisibilityChange:function(){},onScaleRangeChange:function(){},onScaleVisibilityChange:function(){},onSuspend:function(){},onResume:function(){},onUpdate:function(){},onUpdateStart:function(){},onUpdateEnd:function(){},onRefreshIntervalChange:function(){},onError:function(){}});return e("extend-esri")&&r.setObject("layers.Layer",p,s),p})},"esri/request":function(){define("require dojo/_base/array dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/_base/url dojo/_base/xhr dojo/io/script dojo/io/iframe dojo/dom-construct dojo/io-query ./kernel ./config ./sniff ./lang ./urlUtils ./deferredUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){function tt(n){return n=new f(n),(n.host+(n.port?":"+n.port:"")).toLowerCase()}function et(n){return this._xhr?this._xhr.getResponseHeader(n):null}function it(n,f,a,w){var bt=!1,ii=!1,tt,et,kt,dt,ft,ni,wt,ti;y.isDefined(f)&&(u.isObject(f)?(bt=!!f.useProxy,ii=!!f.usePost,tt=f.crossOrigin):bt=!!f);n=u.mixin({},n);n._ssl&&(n.url=n.url.replace(/^http:/i,"https:"));10>v("ie")&&!ht.test(n.url)&&(n.url=encodeURI(n.url));f=n.content;var k=n.url,d=a&&n.form,it=b;tt=y.isDefined(tt)?tt:it.useCors;n.load=function(t){var r;return t&&(t.error?(r=u.mixin(Error(),t.error),r.log=!!i.isDebug):"error"===t.status&&(r=u.mixin(Error(),t),r.log=!!i.isDebug),r&&(n.failOk=!r.log,y.isDefined(r.httpCode)||(r.httpCode=r.code))),r||t};n.error=function(n,t){return t&&t.xhr&&t.xhr.abort(),n instanceof Error||(n=u.mixin(Error(),n)),n.log=!!i.isDebug,it.errorHandler(n,t),n};n._token&&(n.content=n.content||{},n.content.token=n._token);et=0;f&&k&&(kt=c.objectToQuery(f),et=kt.length+k.length+1,v("esri-url-encodes-apostrophe")&&(et=kt.replace(/'/g,"%27").length+k.length+1));n.timeout=y.isDefined(n.timeout)?n.timeout:it.timeout;n.handleAs=n.handleAs||"json";try{var ot,rt,ct=tt&&p.canUseXhr(n.url)&&!/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i.test(n.url),ri=p.hasSameOrigin(n.url,window.location.href)||ct,ut=ii||a||et>it.postLength?!0:!1,ui=ri||-1===n.handleAs.indexOf("json")||!n.callbackParamName||a?!1:!0,g=p.getProxyRule(n.url)||it.alwaysUseProxy||bt||(!ui||ut)&&!ri?!0:!1;if(a&&!v("esri-file-upload")&&!g&&ct&&(g=!0),g&&((ot=p.getProxyUrl(k,tt),rt=ot.path,ot._xo&&(ct=!0),!ut&&rt.length+1+et>it.postLength&&(ut=!0),n.url=rt+"?"+k,ut)?n.content=u.mixin(ot.query||{},f):(dt=c.objectToQuery(u.mixin(ot.query||{},f)),dt&&(n.url+="?"+dt),n.content=null)),ui&&!ut)return!y.isDefined(n.isAsync)&&4>v("ff")&&(n.isAsync=!0),o.get(nt?nt(n):n);if(ft=n.headers,!ct||ft&&ft.hasOwnProperty("X-Requested-With")||(ft=n.headers=ft||{},ft["X-Requested-With"]=null),a){var vt=n.callbackParamName||"callback.html",fi=n.callbackElementName||"textarea",lt,yt,at,pt,ei=d.elements?d.elements.length:0,gt;if(f=n.content)for(lt in f.token&&-1<k.toLowerCase().indexOf("/sharing/servers/")&&(k+=(-1===k.indexOf("?")?"?":"&")+"token="+f.token,n.url=g?rt+"?"+k:k,delete f.token),f)if(at=f[lt],y.isDefined(at)){for(yt=null,pt=0;pt<ei;pt++)if(gt=d.elements[pt],gt.name===lt){yt=gt;break}yt?yt.value=at:w?d.append(lt,at):d.appendChild(h.create("input",{type:"hidden",name:lt,value:at}))}v("esri-file-upload")?(t.forEach(d.elements,function(n){n.name===vt&&d.removeChild(n)}),n.contentType=!1,n.postData=w?d:new FormData(d),delete n.form):(d.enctype="multipart/form-data",9>v("ie")&&(d.encoding="multipart/form-data"),d.method="post",t.some(d.elements,function(n){return n.name===vt})||d.appendChild(h.create("input",{type:"hidden",name:vt,value:fi})),(-1!==k.toLowerCase().indexOf("addattachment")||-1!==k.toLowerCase().indexOf("updateattachment"))&&(k+=(-1===k.indexOf("?")?"?":"&")+vt+"="+fi,n.url=g?rt+"?"+k:k),delete n.content)}return(ct&&!n.hasOwnProperty("withCredentials")&&"with-credentials"===b.useCors&&(w=g?rt:k,ni=p.canUseXhr(w,!0),wt=-1<ni?b.corsEnabledServers[ni]:null,wt&&wt.hasOwnProperty("withCredentials")?wt.withCredentials&&(n.withCredentials=!0):l.id&&(ti=l.id.findServerInfo(w),ti&&ti.webTierAuth&&(n.withCredentials=!0))),n=nt?nt(n):n,ut)?a&&!v("esri-file-upload")?s.send(n):(!g&&v("safari")&&(n.url+=(-1===n.url.indexOf("?")?"?":"&")+"_ts="+(new Date).getTime()+st++),e.post(n)):e.get(n)}catch(oi){return a=new r,a.errback(n.error(oi)),a}}function rt(n){var f=b.corsStatus,t=p.canUseXhr(n,!0),u;return-1<t&&b.corsEnabledServers.splice(t,1),u=new r,u.reject({log:!!i.isDebug}),f[tt(n)]=u.promise,t}function ut(n){var u=b.corsStatus,i,t;try{if(i=tt(n),b.corsDetection&&b.useCors&&v("esri-cors")&&n&&-1!==n.toLowerCase().indexOf("/rest/services")&&!p.hasSameOrigin(n,window.location.href)&&!p.canUseXhr(n))return u[i]?u[i]:(t=new r,u[i]=t.promise,e.get({url:n.substring(0,n.toLowerCase().indexOf("/rest/")+6)+"info",content:{f:"json"},failOk:!0,handleAs:"json",headers:{"X-Requested-With":null},timeout:1e3*b.corsDetectionTimeout}).then(function(r){r?(p.canUseXhr(n)||b.corsEnabledServers.push(i),t.resolve()):t.reject()},function(){t.reject()}),t.promise)}catch(f){console.log("esri._detectCors: an unknown error occurred while detecting CORS support")}return ct}function ft(n){nt=n}function g(r,u,f,o){function c(n){if(n._pendingDfd=it(f,o,ft,ut),!n._pendingDfd){n.ioArgs=n._pendingDfd&&n._pendingDfd.ioArgs;var r=Error("Deferred object is missing");return r.log=!!i.isDebug,n.errback(r),n._pendingDfd=null,n}n._pendingDfd.addCallback(function(t){n.ioArgs=n._pendingDfd&&n._pendingDfd.ioArgs;o.returnFullResponse&&(t={data:t,_xhr:n.ioArgs&&n.ioArgs.xhr,getHeader:et});n.callback(t);n._pendingDfd=null}).addErrback(function(i){var r,u,e;if(i&&(r=i.code,u=i.subcode,e=(e=i.messageCode)&&e.toUpperCase()),i&&403==r&&(4==u||i.message&&-1<i.message.toLowerCase().indexOf("ssl")&&-1===i.message.toLowerCase().indexOf("permission"))){if(!f._ssl){f._ssl=f._sslFromServer=!0;g(n,!0,f,o);return}}else if(i&&415==i.status){if(rt(f.url),!f._err415){f._err415=1;g(n,!0,f,o);return}}else if(l.id&&-1!==t.indexOf(l.id._errorCodes,r)&&!l.id._isPublic(f.url)&&!nt&&(403!=r||-1===t.indexOf(ot,e)&&(!y.isDefined(u)||2==u&&f._token))){n._pendingDfd=l.id.getCredential(f.url,{token:f._token,error:i});n._pendingDfd.addCallback(function(t){f._token=t.token;f._credential=t;f._ssl=f._sslFromServer||t.ssl;g(n,!0,f,o)}).addErrback(function(t){n.errback(t);n._pendingDfd=null});return}n.ioArgs=n._pendingDfd&&n._pendingDfd.ioArgs;n.errback(i);n._pendingDfd=null})}var s=f.form,nt=o.disableIdentityLookup,ht=o._preLookup,a=!1,h,w,k;v("esri-workers")&&!1!==b.useWorkers&&(!0===o.useWorkers||!0===b.useWorkers?a=!0:o.workerOptions&&(h=o.workerOptions,(h.callback||h.worker&&h.worker.worker instanceof Worker)&&(a=!0)));var ut=s&&v("esri-file-upload")&&s instanceof FormData,ft=s&&(s.elements?t.some(s.elements,function(n){return"file"===n.type}):ut),st=-1!==f.url.toLowerCase().indexOf("token=")||f.content&&f.content.token||ft&&t.some(s.elements,function(n){return"token"===n.name})?1:0;return u||(r.addCallback(function(n){var t,i,r;(/\/sharing\/rest\/accounts\/self/i.test(f.url)||/\/sharing\/rest\/portals\/self/i.test(f.url))&&!st&&!f._token&&n.user&&n.user.username&&(b.webTierAuthServers.push(tt(f.url)),n=b.corsEnabledServers,t=p.canUseXhr(f.url,!0),i={host:tt(f.url),withCredentials:!0},-1===t?n.push(i):(r=n[t],"object"==typeof r?r.withCredentials=!0:n.splice(t,1,i)));(n=f._credential)&&(t=(t=l.id.findServerInfo(n.server))&&t.owningSystemUrl)&&(t=t.replace(/\/?$/,"/sharing"),(n=l.id.findCredential(t,n.userId))&&-1===l.id._getIdenticalSvcIdx(t,n)&&n.resources.splice(0,0,t))}),r.addBoth(function(n){delete f._credential;!n||v("ie")&&n.nodeType||(n._ssl=f._ssl)}),w=f.load,k=f.error,w&&r.addCallback(function(n){var t=r._pendingDfd,t=t&&t.ioArgs;return w.call(t&&t.args,n,t)}),k&&r.addErrback(function(n){var t=r._pendingDfd,t=t&&t.ioArgs;return k.call(t&&t.args,n,t)})),l.id&&!st&&!f._token&&!l.id._isPublic(f.url)&&(!nt||ht)&&(u=l.id.findCredential(f.url))&&(f._token=u.token,f._ssl=u.ssl),a?o.workerOptions&&o.workerOptions.worker?(d||(d=e),e=o.workerOptions.worker,c(r)):n(["./workers/RequestClient"],function(n){if(d||(d=e),o.workerOptions){var t=o.workerOptions;e=n.getClient(t.callback,t.cbFunction)}else e=n.getClient();c(r)}):(d&&(e=d,d=null),c(r)),r}function k(n,t){n.url=p.fixUrl(n.url);t=t||{};var i=new r(w._dfdCanceller);return ut(n.url).always(function(){g(i,!1,n,t)}),i}var d=null,nt,b=a.defaults.io,ot=["COM_0056","COM_0057"],st=0,ht=/%[0-9A-F]{2}/i,ct=function(){var n=new r;return n.resolve(),n.promise}();return k._makeRequest=it,k._processRequest=g,k._disableCors=rt,k._detectCors=ut,k.setRequestPreCallback=ft,v("extend-esri")&&(l.request=k,l._makeRequest=it,l._processRequest=g,l._disableCors=rt,l._detectCors=ut,l.setRequestPreCallback=ft),k})},"dojo/io/script":function(){define("../_base/connect ../_base/kernel ../_base/lang ../sniff ../_base/window ../_base/xhr ../dom ../dom-construct ../request/script ../aspect".split(" "),function(n,t,i,r,u,f,e,o,s,h){t.deprecated("dojo/io/script","Use dojo/request/script.","2.0");var c={get:function(n){var r,t=this._makeScriptDeferred(n,function(){r&&r.cancel()}),i=t.ioArgs;return f._ioAddQueryToUrl(i),f._ioNotifyStart(t),r=s.get(i.url,{timeout:n.timeout,jsonp:i.jsonp,checkString:n.checkString,ioArgs:i,frameDoc:n.frameDoc,canAttach:function(n){return i.requestId=n.id,i.scriptId=n.scriptId,i.canDelete=n.canDelete,c._canAttach(i)}},!0),h.around(r,"isValid",function(n){return function(i){return c._validCheck(t),n.call(this,i)}}),r.then(function(){t.resolve(t)}).otherwise(function(n){t.ioArgs.error=n;t.reject(n)}),t},attach:s._attach,remove:s._remove,_makeScriptDeferred:function(n,i){var u=f._ioSetArgs(n,i||this._deferredCancel,this._deferredOk,this._deferredError),r=u.ioArgs;return r.id=t._scopeName+"IoScript"+(n.callbackSuffix||this._counter++),r.canDelete=!1,r.jsonp=n.callbackParamName||n.jsonp,r.jsonp&&(r.query=r.query||"",0<r.query.length&&(r.query+="&"),r.query+=r.jsonp+"="+(n.frameDoc?"parent.":"")+t._scopeName+".io.script.jsonp_"+r.id+"._jsonpCallback",r.frameDoc=n.frameDoc,r.canDelete=!0,u._jsonpCallback=this._jsonpCallback,this["jsonp_"+r.id]=u),u.addBoth(function(n){r.canDelete&&(n instanceof Error?c["jsonp_"+r.id]._jsonpCallback=function(){delete c["jsonp_"+r.id];r.requestId&&t.global[s._callbacksProperty][r.requestId]()}:c._addDeadScript(r))}),u},_deferredCancel:function(n){n.canceled=!0},_deferredOk:function(n){return n=n.ioArgs,n.json||n.scriptLoaded||n},_deferredError:function(n){return console.log("dojo.io.script error",n),n},_deadScripts:[],_counter:1,_addDeadScript:function(n){c._deadScripts.push({id:n.id,frameDoc:n.frameDoc});n.frameDoc=null},_validCheck:function(n){if((n=c._deadScripts)&&0<n.length){for(var t=0;t<n.length;t++)c.remove(n[t].id,n[t].frameDoc),delete c["jsonp_"+n[t].id],n[t].frameDoc=null;c._deadScripts=[]}return!0},_ioCheck:function(n){return n=n.ioArgs,n.json||n.scriptLoaded&&!n.args.checkString?!0:(n=n.args.checkString)&&eval("typeof("+n+") != 'undefined'")},_resHandle:function(n){c._ioCheck(n)?n.callback(n):n.errback(Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(n){this.ioArgs.json=n;this.ioArgs.requestId&&t.global[s._callbacksProperty][this.ioArgs.requestId](n)}};return i.setObject("dojo.io.script",c),c})},"dojo/request/script":function(){define("module ./watch ./util ../_base/kernel ../_base/array ../_base/lang ../on ../dom ../dom-construct ../has ../_base/window".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){function p(n,t){n.canDelete&&l._remove(n.id,t.options.frameDoc,!0)}function w(n){return v&&v.length&&(u.forEach(v,function(n){l._remove(n.id,n.frameDoc);n.frameDoc=null}),v=[]),n.options.jsonp?!n.data:!0}function b(){return!!this.scriptLoaded}function k(n){return(n=n.options.checkString)&&eval("typeof("+n+') !== "undefined"')}function d(n,t){if(this.canDelete){var i=this.response.options;v.push({id:this.id,frameDoc:i.ioArgs?i.ioArgs.frameDoc:i.frameDoc});i.ioArgs&&(i.ioArgs.frameDoc=null);i.frameDoc=null}t?this.reject(t):this.resolve(n)}function l(n,r,u){var s=i.parseArgs(n,i.deepCopy({},r)),o,h,c;return n=s.url,r=s.options,o=i.deferred(s,p,w,r.jsonp?null:r.checkString?k:b,d),f.mixin(o,{id:y+g++,canDelete:!1}),r.jsonp&&(new RegExp("[?&]"+r.jsonp+"=").test(n)||(n+=(~n.indexOf("?")?"&":"?")+r.jsonp+"="+(r.frameDoc?"parent.":"")+y+"_callbacks."+o.id),o.canDelete=!0,a[o.id]=function(n){s.data=n;o.handleResponse(s)}),i.notify&&i.notify.emit("send",s,o.promise.cancel),(!r.canAttach||r.canAttach(o))&&(h=l._attach(o.id,n,r.frameDoc,function(n){if(!(n instanceof Error)){var t=Error("Error loading "+(n.target?n.target.src:"script"));t.source=n;n=t}o.reject(n);l._remove(o.id,r.frameDoc,!0)}),r.jsonp||r.checkString||(c=e(h,nt,function(n){("load"===n.type||tt.test(h.readyState))&&(c.remove(),o.scriptLoaded=n)}))),t(o),u?o:o.promise}h.add("script-readystatechange",function(n,t){return"undefined"!=typeof t.createElement("script").onreadystatechange&&("undefined"==typeof n.opera||"[object Opera]"!==n.opera.toString())});var y=n.id.replace(/[\/\.\-]/g,"_"),g=0,nt=h("script-readystatechange")?"readystatechange":"load",tt=/complete|loaded/,a=r.global[y+"_callbacks"]={},v=[];return l.get=l,l._attach=function(n,t,i,r){i=i||c.doc;var u=i.createElement("script");if(r)e.once(u,"error",r);u.type="text/javascript";try{u.src=t}catch(f){r&&r(u)}return u.id=n,u.async=!0,u.charset="utf-8",i.getElementsByTagName("head")[0].appendChild(u)},l._remove=function(n,t,i){s.destroy(o.byId(n,t));a[n]&&(i?a[n]=function(){delete a[n]}:delete a[n])},l._callbacksProperty=y+"_callbacks",l})},"dojo/io/iframe":function(){define("../_base/config ../_base/json ../_base/kernel ../_base/lang ../_base/xhr ../sniff ../_base/window ../dom ../dom-construct ../query require ../aspect ../request/iframe".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){i.deprecated("dojo/io/iframe","Use dojo/request/iframe.","2.0");f=a._iframeName;f=f.substring(0,f.lastIndexOf("_"));var v=r.delegate(a,{create:function(){return v._frame=a.create.apply(a,arguments)},get:null,post:null,send:function(r){var f,e=u._ioSetArgs(r,function(){f&&f.cancel()},function(n){var r=null,u;n=n.ioArgs;try{u=n.handleAs;"xml"===u||"html"===u?r=f.response.data:(r=f.response.text,"json"===u?r=t.fromJson(r):"javascript"===u&&(r=i.eval(r)))}catch(e){r=e}return r},function(n,t){return t.ioArgs._hasError=!0,n}),s=e.ioArgs,c="GET",h=o.byId(r.form),v;return r.method&&"POST"===r.method.toUpperCase()&&h&&(c="POST"),r={method:c,handleAs:"json"===r.handleAs||"javascript"===r.handleAs?"text":r.handleAs,form:r.form,query:h?null:r.content,data:h?r.content:null,timeout:r.timeout,ioArgs:s},r.method&&(r.method=r.method.toUpperCase()),n.ioPublish&&i.publish&&!1!==s.args.ioPublish&&(v=l.after(a,"_notifyStart",function(n){n.options.ioArgs===s&&(v.remove(),u._ioNotifyStart(e))},!0)),f=a(s.url,r,!0),s._callNext=f._callNext,f.then(function(){e.resolve(e)}).otherwise(function(n){e.ioArgs.error=n;e.reject(n)}),e},_iframeOnload:e.global[f+"_onload"]});return r.setObject("dojo.io.iframe",v),v})},"dojo/request/iframe":function(){define("module require ./watch ./util ./handlers ../_base/lang ../io-query ../query ../has ../dom ../dom-construct ../_base/window ../NodeList-dom".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){function w(){return!this.isFulfilled()}function b(){return!!this._finished}function k(n,t){var r;if(!t)try{var s=n.options,i=a.doc(a._frame),e=s.handleAs;"html"!==e?("xml"===e?"html"===i.documentElement.tagName.toLowerCase()?(o("a",i.documentElement).orphan(),r=i.documentElement.innerText||i.documentElement.textContent,r=r.replace(/>\s+</g,"><"),n.text=f.trim(r)):n.data=i:n.text=i.getElementsByTagName("textarea")[0].value,u(n)):n.data=i}catch(h){t=h}t?this.reject(t):this._finished?this.resolve(n):this.reject(Error("Invalid dojo/request/iframe request state"))}function d(){this._callNext()}function a(n,t,u){var f=r.parseArgs(n,r.deepCreate(p,t),!0);if(n=f.url,t=f.options,"GET"!==t.method&&"POST"!==t.method)throw Error(t.method+" not supported by dojo/request/iframe");return a._frame||(a._frame=a.create(a._iframeName,y+"();")),n=r.deferred(f,null,w,b,k,d),n._callNext=function(){this._calledNext||(this._calledNext=!0,a._currentDfd=null,a._fireNextRequest())},n._legacy=u,a._dfdQueue.push(n),a._fireNextRequest(),i(n),u?n:n.promise}var v=n.id.replace(/[\/\.\-]/g,"_"),y=v+"_onload",p;return l.global[y]||(l.global[y]=function(){var n=a._currentDfd,t,u,i,e,r,f;if(n){if(t=h.byId(n.response.options.form)||n._tmpForm,t){for(u=n._contentToClean,i=0;i<u.length;i++)for(e=u[i],r=0;r<t.childNodes.length;r++)if(f=t.childNodes[r],f.name===e){c.destroy(f);break}n._originalAction&&t.setAttribute("action",n._originalAction);n._originalMethod&&(t.setAttribute("method",n._originalMethod),t.method=n._originalMethod);n._originalTarget&&(t.setAttribute("target",n._originalTarget),t.target=n._originalTarget)}n._tmpForm&&(c.destroy(n._tmpForm),delete n._tmpForm);n._finished=!0}else a._fireNextRequest()}),p={method:"POST"},a.create=function(n,i,r){return l.global[n]?l.global[n]:l.global.frames[n]?l.global.frames[n]:(r||(s("config-useXDomain")&&!s("config-dojoBlankHtmlUrl")&&console.warn("dojo/request/iframe: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set dojoConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),r=s("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html")),i=c.place('<iframe id="'+n+'" name="'+n+'" src="'+r+'" onload="'+i+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',l.body()),l.global[n]=i)},a.doc=function(n){var t,i;if(n.contentDocument)return n.contentDocument;if(t=n.name,t){if(i=l.doc.getElementsByTagName("iframe"),n.document&&i[t].contentWindow&&i[t].contentWindow.document)return i[t].contentWindow.document;if(l.doc.frames[t]&&l.doc.frames[t].document)return l.doc.frames[t].document}return null},a.setSrc=function(n,t,i){n=l.global.frames[n.name];n.contentWindow&&(n=n.contentWindow);try{i?n.location.replace(t):n.location=t}catch(r){console.log("dojo/request/iframe.setSrc: ",r)}},a._iframeName=v+"_IoIframe",a._notifyStart=function(){},a._dfdQueue=[],a._currentDfd=null,a._fireNextRequest=function(){var t,o,w,y;try{if(!a._currentDfd&&a._dfdQueue.length){do t=a._currentDfd=a._dfdQueue.shift();while(t&&(t.canceled||t.isCanceled&&t.isCanceled())&&a._dfdQueue.length);if(!t||t.canceled||t.isCanceled&&t.isCanceled())a._currentDfd=null;else{var i=t.response,u=i.options,nt=t._contentToClean=[],n=h.byId(u.form),k=r.notify,b=u.data||null,p;if(t._legacy||"POST"!==u.method||n?"GET"===u.method&&n&&-1<i.url.indexOf("?")&&(p=i.url.slice(i.url.indexOf("?")+1),b=f.mixin(e.queryToObject(p),b)):n=t._tmpForm=c.create("form",{name:v+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},l.body()),n){if(!t._legacy){o=n;do o=o.parentNode;while(o&&o!==l.doc.documentElement);o||(n.style.position="absolute",n.style.left="-1000px",n.style.top="-1000px",l.body().appendChild(n));n.name||(n.name=v+"_form")}if(b){o=function(t,i){c.create("input",{type:"hidden",name:t,value:i},n);nt.push(t)};for(w in b)if(y=b[w],f.isArray(y)&&1<y.length)for(p=0;p<y.length;p++)o(w,y[p]);else n[w]?n[w].value=y:o(w,y)}var d=n.getAttributeNode("action"),s=n.getAttributeNode("method"),g=n.getAttributeNode("target");i.url&&(t._originalAction=d?d.value:null,d?d.value=i.url:n.setAttribute("action",i.url));t._legacy?s&&s.value||(s?s.value=u.method:n.setAttribute("method",u.method)):(t._originalMethod=s?s.value:null,s?s.value=u.method:n.setAttribute("method",u.method));t._originalTarget=g?g.value:null;g?g.value=a._iframeName:n.setAttribute("target",a._iframeName);n.target=a._iframeName;k&&k.emit("send",i,t.promise.cancel);a._notifyStart(i);n.submit()}else u="",i.options.data&&(u=i.options.data,"string"!=typeof u&&(u=e.objectToQuery(u))),o=i.url+(-1<i.url.indexOf("?")?"&":"?")+u,k&&k.emit("send",i,t.promise.cancel),a._notifyStart(i),a.setSrc(a._frame,o,!0)}}}catch(tt){t.reject(tt)}},r.addCommonMethods(a,["GET","POST"]),a})},"esri/domUtils":function(){define(["./kernel","dojo/_base/connect","dojo/_base/lang","dojo/dom-style","dojo/has"],function(n,t,i,r,u){var f={show:function(n){(n=f.getNode(n))&&(n.style.display="block")},getNode:function(n){return n&&n.domNode||n},hide:function(n){(n=f.getNode(n))&&(n.style.display="none")},toggle:function(n){(n=f.getNode(n))&&(n.style.display="none"===n.style.display?"block":"none")},documentBox:8>=u("ie")?{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}:{w:window.innerWidth,h:window.innerHeight},setScrollable:function(n){if(n=this.getNode(n)){var i=0,u=0,f=0,e=0,o=0,s=0;return[t.connect(n,"ontouchstart",function(t){i=t.touches[0].screenX;u=t.touches[0].screenY;f=n.scrollWidth;e=n.scrollHeight;o=n.clientWidth;s=n.clientHeight}),t.connect(n,"ontouchmove",function(t){var h;t.preventDefault();h=n.firstChild;h instanceof Text&&(h=n.childNodes[1]);var c=h._currentX||0,l=h._currentY||0,c=c+(t.touches[0].screenX-i);0<c?c=0:0>c&&Math.abs(c)+o>f&&(c=-1*(f-o));h._currentX=c;l+=t.touches[0].screenY-u;0<l?l=0:0>l&&Math.abs(l)+s>e&&(l=-1*(e-s));h._currentY=l;r.set(h,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+c+"px, "+l+"px)"});i=t.touches[0].screenX;u=t.touches[0].screenY})]}}};return u("extend-esri")&&i.mixin(n,f),f})},"esri/symbols/MarkerSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojox/gfx/_base ../kernel ./Symbol".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.symbol.MarkerSymbol",angle:0,xoffset:0,yoffset:0,size:12,constructor:function(n){n&&t.isObject(n)&&(this.size="auto"===this.size?this.size:r.pt2px(this.size),this.xoffset=r.pt2px(this.xoffset),this.yoffset=r.pt2px(this.yoffset),this.angle&&(this.angle*=-1))},setAngle:function(n){return this.angle=n,this},setSize:function(n){return this.size=n,this},setOffset:function(n,t){return this.xoffset=n,this.yoffset=t,this},toJson:function(){var n=r.px2pt(this.size),n=isNaN(n)?void 0:n,i=r.px2pt(this.xoffset),i=isNaN(i)?void 0:i,u=r.px2pt(this.yoffset),u=isNaN(u)?void 0:u;return t.mixin(this.inherited("toJson",arguments),{size:"auto"===this.size?this.size:n,angle:this.angle&&-1*this.angle,xoffset:i,yoffset:u})}}),i("extend-esri")&&t.setObject("symbol.MarkerSymbol",n,u),n})},"esri/symbols/Symbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../Color".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.symbol.Symbol",color:new f([0,0,0,1]),type:null,constructor:function(n){n&&t.isObject(n)&&(t.mixin(this,n),this.color&&u.isDefined(this.color[0])&&(this.color=f.toDojoColor(this.color)),(n=this.type)&&0===n.indexOf("esri")&&(this.type={esriSMS:"simplemarkersymbol",esriPMS:"picturemarkersymbol",esriSLS:"simplelinesymbol",esriCLS:"cartographiclinesymbol",esriSFS:"simplefillsymbol",esriPFS:"picturefillsymbol",esriTS:"textsymbol",esriSHD:"shieldlabelsymbol"}[n]))},setColor:function(n){return this.color=n,this},toJson:function(){return{color:f.toJsonColor(this.color)}}}),i("extend-esri")&&t.setObject("symbol.Symbol",n,r),n})},"esri/symbols/SimpleMarkerSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base ../kernel ../lang ./MarkerSymbol ./SimpleLineSymbol".split(" "),function(n,t,i,r,u,f,e,o,s){var h={STYLE_CIRCLE:"circle",STYLE_SQUARE:"square",STYLE_CROSS:"cross",STYLE_X:"x",STYLE_DIAMOND:"diamond",STYLE_PATH:"path",STYLE_TARGET:"target"},c={style:h.STYLE_CIRCLE,color:[255,255,255,.25],size:12,angle:0,xoffset:0,yoffset:0};return n=n(o,{declaredClass:"esri.symbol.SimpleMarkerSymbol",type:"simplemarkersymbol",_styles:{circle:"esriSMSCircle",square:"esriSMSSquare",cross:"esriSMSCross",x:"esriSMSX",diamond:"esriSMSDiamond",path:"esriSMSPath"},constructor:function(n,r,f,o){n?t.isString(n)?(this.style=n,r&&(this.size=r),f&&(this.outline=f),o&&(this.color=o)):(this.style=e.valueOf(this._styles,this.style),n.outline&&(this.outline=new s(n.outline))):(t.mixin(this,c),this.size=u.pt2px(this.size),this.outline=new s(this.outline),this.color=new i(this.color));this.style||(this.style=h.STYLE_CIRCLE)},setStyle:function(n){return this.style=n,this},setPath:function(n){return this.path=n,this.setStyle(h.STYLE_PATH),this},setOutline:function(n){return this.outline=n,this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){return this.color},_setDim:function(n,t,i){this._targetWidth=n;this._targetHeight=t;this._spikeSize=i},getShapeDescriptors:function(){var i,r,n,l=this.style,s=(this.size||u.pt2px(c.size))/2,t=0-s,e=0+s,o=0-s,f=0+s;switch(l){case h.STYLE_CIRCLE:i={type:"circle",cx:0,cy:0,r:s};r=this.getFill();(n=this.getStroke())&&(n.style=n.style||"Solid");break;case h.STYLE_CROSS:i={type:"path",path:"M "+t+",0 L "+e+",0 M 0,"+o+" L 0,"+f+" E"};r=null;n=this.getStroke();break;case h.STYLE_DIAMOND:i={type:"path",path:"M "+t+",0 L 0,"+o+" L "+e+",0 L 0,"+f+" L "+t+",0 Z"};r=this.getFill();n=this.getStroke();break;case h.STYLE_SQUARE:i={type:"path",path:"M "+t+","+f+" L "+t+","+o+" L "+e+","+o+" L "+e+","+f+" L "+t+","+f+" Z"};r=this.getFill();n=this.getStroke();break;case h.STYLE_X:i={type:"path",path:"M "+t+","+f+" L "+e+","+o+" M "+t+","+o+" L "+e+","+f+" E"};r=null;n=this.getStroke();break;case h.STYLE_PATH:i={type:"path",path:this.path||""};r=this.getFill();n=this.getStroke()}return{defaultShape:i,fill:r,stroke:n}},toJson:function(){var i=this.style,r=this.outline,n=t.mixin(this.inherited("toJson",arguments),{type:"esriSMS",style:this._styles[i]||"esriSMSCircle"});return r&&(n.outline=r.toJson()),"x"===i||"cross"===i?delete n.color:"target"===i&&(n.style="esriSMSSquare",delete n.color,0<this._targetHeight&&0<this._targetWidth&&(n.size=u.px2pt(Math.max(this._targetHeight,this._targetWidth)))),n.path=this.path,e.fixJson(n)}}),t.mixin(n,h),n.defaultProps=c,r("extend-esri")&&(t.setObject("symbol.SimpleMarkerSymbol",n,f),f.symbol.defaultSimpleMarkerSymbol=c),n})},"esri/symbols/SimpleLineSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base ../kernel ../lang ./LineSymbol".split(" "),function(n,t,i,r,u,f,e,o){var s={STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dashdot",STYLE_DASHDOTDOT:"longdashdotdot",STYLE_NULL:"none",STYLE_SHORTDASH:"shortdash",STYLE_SHORTDOT:"shortdot",STYLE_SHORTDASHDOT:"shortdashdot",STYLE_SHORTDASHDOTDOT:"shortdashdotdot",STYLE_LONGDASH:"longdash",STYLE_LONGDASHDOT:"longdashdot"},h={color:[0,0,0,1],style:s.STYLE_SOLID,width:1};return n=n(o,{declaredClass:"esri.symbol.SimpleLineSymbol",type:"simplelinesymbol",marker:null,_styles:{solid:"esriSLSSolid",dash:"esriSLSDash",dot:"esriSLSDot",dashdot:"esriSLSDashDot",longdashdotdot:"esriSLSDashDotDot",none:"esriSLSNull",insideframe:"esriSLSInsideFrame",shortdash:"esriSLSShortDash",shortdot:"esriSLSShortDot",shortdashdot:"esriSLSShortDashDot",shortdashdotdot:"esriSLSShortDashDotDot",longdash:"esriSLSLongDash",longdashdot:"esriSLSLongDashDot"},constructor:function(n,r,f){n?t.isString(n)?(this.style=n,r&&(this.color=r),f&&(this.width=f)):(this.style=e.valueOf(this._styles,n.style)||s.STYLE_SOLID,this.marker=n.marker):(t.mixin(this,h),this.color=new i(this.color),this.width=u.pt2px(this.width))},setStyle:function(n){return this.style=n,this},setMarker:function(n){this.marker=n},getStroke:function(){return this.style===s.STYLE_NULL||0===this.width?null:{color:this.color,style:this.style,width:this.width}},getFill:function(){return null},getShapeDescriptors:function(){return{defaultShape:{type:"path",path:"M -15,0 L 15,0 E"},fill:null,stroke:this.getStroke()}},toJson:function(){return e.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriSLS",style:this._styles[this.style],marker:this.marker&&t.clone(this.marker)}))}}),t.mixin(n,s),n.defaultProps=h,r("extend-esri")&&(t.setObject("symbol.SimpleLineSymbol",n,f),f.symbol.defaultSimpleLineSymbol=h),n})},"esri/symbols/LineSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojox/gfx/_base ../kernel ./Symbol".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.symbol.LineSymbol",constructor:function(n){this.width=t.isObject(n)?r.pt2px(this.width):12},setWidth:function(n){return this.width=n,this},toJson:function(){var n=r.px2pt(this.width),n=isNaN(n)?void 0:n;return t.mixin(this.inherited("toJson",arguments),{width:n})}}),i("extend-esri")&&t.setObject("symbol.LineSymbol",n,u),n})},"esri/layers/TileInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../SpatialReference ../geometry/Point ./LOD".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(null,{declaredClass:"esri.layers.TileInfo",constructor:function(n){t.mixin(this,n);this.width=this.cols;this.height=this.rows;n=this.spatialReference;var r=this.origin;n&&(n=this.spatialReference=new e(n.toJson?n.toJson():n));r&&(this.origin=new o(r.toJson?r.toJson():r),!r.spatialReference&&n&&this.origin.setSpatialReference(new e(n.toJson())));this.lods=i.map(this.lods,function(n){return new s(n)})},toJson:function(){return f.fixJson({rows:this.rows,cols:this.cols,dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin&&this.origin.toJson(),spatialReference:this.spatialReference&&this.spatialReference.toJson(),lods:this.lods&&i.map(this.lods,function(n){return n.toJson()})})}}),r("extend-esri")&&t.setObject("layers.TileInfo",n,u),n})},"esri/layers/LOD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.LOD",constructor:function(n){t.mixin(this,n)},toJson:function(){return u.fixJson({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})}}),i("extend-esri")&&t.setObject("layers.LOD",n,r),n})},"esri/layers/ArcGISTiledMapServiceLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/io-query ../kernel ../urlUtils ../SpatialReference ./TiledMapServiceLayer ./ArcGISMapServiceLayer ./TileInfo ./TimeInfo ./TileMap".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){return t=t([c,l],{declaredClass:"esri.layers.ArcGISTiledMapServiceLayer",_agolAttrs:"Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" "),_isReference:!1,_referenceLayers:"Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Reference Ocean/World_Ocean_Reference Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Reference_Overlay Reference/World_Transportation".split(" "),constructor:function(t,r){r&&(r.roundrobin&&(n.deprecated(this.declaredClass+" : Constructor option 'roundrobin' deprecated. Use option 'tileServers'."),r.tileServers=r.roundrobin),this._setTileServers(r.tileServers),this._loadCallback=r.loadCallback);this._params=i.mixin({},this._url.query);this._initLayer=i.hitch(this,this._initLayer);var u=r&&r.resourceInfo;u?this._initLayer(u):(this._load=i.hitch(this,this._load),this._load())},_TILE_FORMATS:{PNG:"png",PNG8:"png",PNG24:"png",PNG32:"png",JPG:"jpg",JPEG:"jpg",GIF:"gif"},_setTileServers:function(n){if(n&&0<n.length){this.tileServers=n;for(var i=n.length,t=0;t<i;t++)n[t]=s.urlToObject(n[t]).path}},_initLayer:function(n){var i,e;this.inherited(arguments);this.resourceInfo=u.toJson(n);this.tileInfo=new a(n.tileInfo);!1!==this.resampling&&(n.capabilities&&-1<n.capabilities.indexOf("Tilemap")?(this.resampling=!0,this.tileMap=new y(this)):this.resampling=!!n.resampling);!this.spatialReference&&this.tileInfo.spatialReference&&(this.spatialReference=new h(this.tileInfo.spatialReference.toJson()));this.isPNG32="PNG24"===this.tileInfo.format||"PNG32"===this.tileInfo.format;n.timeInfo&&(this.timeInfo=new v(n.timeInfo));n.mensurationCapabilities&&(this.mensurationCapabilities=n.mensurationCapabilities);var t=this._url.path,f=this._loadCallback,o=s.getProtocolForWebResource(!0),r=t.match(/^https?\:\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i),r=r&&r[2];if(this.tileServers||(n.tileServers?this._setTileServers(n.tileServers):(i=-1!==t.search(/^https?\:\/\/server\.arcgisonline\.com/i),e=-1!==t.search(/^https?\:\/\/services\.arcgisonline\.com/i),(i||e)&&this._setTileServers([t,t.replace(i?/server\.arcgisonline/i:/services\.arcgisonline/i,i?"services.arcgisonline":"server.arcgisonline")]))),r){for(r=r.toLowerCase(),t=0;t<this._agolAttrs.length;t++)if(i=this._agolAttrs[t],i.toLowerCase()===r){this.hasAttributionData=!0;this.attributionDataUrl=this.attributionDataUrl||o+"//static.arcgis.com/attribution/"+i;break}for(t=0;t<this._referenceLayers.length;t++)if(i=this._referenceLayers[t],i.toLowerCase()===r){this._isReference=!0;break}}this.loaded=!0;this.onLoad(this);f&&(delete this._loadCallback,f(this))},getTileUrl:function(n,t,i){var u=this.tileServers,f=this._getToken(),r=this._url.query;return n=(u?u[t%u.length]:this._url.path)+"/tile/"+n+"/"+t+"/"+i,n=s.upgradeToHTTPS(n),this.resampling&&!this.tileMap&&(n+="?blankTile=false"),r&&(n=this.resampling&&!this.tileMap?n+("&"+e.objectToQuery(r)):n+("?"+e.objectToQuery(r))),!f||r&&r.token||(n+=(-1===n.indexOf("?")?"?":"&")+"token="+f),n=this.addTimestampToURL(n),s.addProxy(n)}}),f("extend-esri")&&i.setObject("layers.ArcGISTiledMapServiceLayer",t,o),t})},"esri/layers/TiledMapServiceLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/url dojo/dom-construct dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/dom dojox/collections/ArrayList dojox/gfx/matrix ../kernel ../config ../sniff ../domUtils ../tileUtils ../geometry/Point ../geometry/Rect ../geometry/Extent ./layer".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){return n=n(g,{declaredClass:"esri.layers.TiledMapServiceLayer",constructor:function(n,r){t.connect(this,"onLoad",this,"_initTiledLayer");this._lowestLevel=(this._displayLevels=r?r.displayLevels:null)?this._displayLevels[0]:0;this.resampling=r?r.resampling:void 0;this._resamplingTolerance=r?r.resamplingTolerance:null;this.exclusionAreas=r?r.exclusionAreas:null;var u=i.hitch;this._addImage=u(this,this._addImage);this._tileLoadHandler=u(this,this._tileLoadHandler);this._tileErrorHandler=u(this,this._tileErrorHandler);this._popTile=u(this,this._popTile);this._cleanUpRemovedImages=u(this,this._cleanUpRemovedImages);this._fireOnUpdateEvent=u(this,this._fireOnUpdateEvent);this._transitionEnd=u(this,this._transitionEnd);this._tileMapCallback=u(this,this._tileMapCallback)},opacity:1,isPNG32:!1,_multiple:1,isResampling:!1,_initTiledLayer:function(){var i=this.tileInfo,s=i.lods;this.resampling=null!=this.resampling?this.resampling:!1;this._tileW=i.width;this._tileH=i.height;for(var l=this.scales=[],h=this._displayLevels,u=-Infinity,f=Infinity,e=this.fullExtent,a=new b(e.xmin,e.ymax),e=new b(e.xmax,e.ymin),c=w.getContainingTileCoords,t,n,v=s.length,o=0;o<v;o++)n=s[o],t=c(i,a,n),n.startTileRow=0>t.row?0:t.row,n.startTileCol=0>t.col?0:t.col,t=c(i,e,n),n.endTileRow=t.row,n.endTileCol=t.col,h&&-1===r.indexOf(h,n.level)||(l[o]=n.scale,u=n.scale>u?n.scale:u,f=n.scale<f?n.scale:f);-Infinity===u||this._hasMin||this.setMinScale(u);Infinity===f||this._hasMax||this.setMaxScale(f);this.setExclusionAreas(this.exclusionAreas);this._patchIE=6<=y("ie")&&7>y("ie")&&(this.isPNG32||"Mixed"===i.format)},isVisibleAtScale:function(n){return n?g.prototype._isMapAtVisibleScale.call(this,n,!0):!1},_isMapAtVisibleScale:function(n){var i=this.inherited(arguments,[n,!0]),t;if(i){t=this._map;var i=this.scales,u=t.getScale(),r=!1,f=t.width>t.height?t.width:t.height;for(t=0;t<i.length;t++)if(Math.abs(i[t]-u)/i[t]<1/f){r=!0;break}i=r}return i},_setMap:function(n,i){var c;this.inherited(arguments);this._map=n;var h=this._div=f.create("div",null,i),r=n.__visibleDelta,o=t.connect,u=a._css.names,e={position:"absolute",width:n.width+"px",height:n.height+"px",overflow:"visible"},l=v.defaults.map.zoomDuration;return"css-transforms"===n.navigationMode?(e[u.transform]=a._css.translate(-r.x,-r.y),s.set(h,e),delete e[u.transform],e[u.transition]=u.transformName+" "+l+"ms ease",s.set(this._active=f.create("div",null,h),e),this._active._remove=0,this._passives=[]):(e.left=-r.x+"px",e.top=-r.y+"px",s.set(h,e)),this._onResizeHandler_connect=o(n,"onResize",this,"_onResizeHandler"),this._opacityChangeHandler_connect=o(this,"onOpacityChange",this,"_opacityChangeHandler"),r=this.tileInfo,o=r.spatialReference,u=o._getInfo(),(this._wrap=n.wrapAround180&&o._isWrappable()&&Math.abs(u.origin[0]-r.origin.x)<=u.dx)&&w._addFrameInfo(r,u),this.setExclusionAreas(this.exclusionAreas),this.evaluateSuspension(),this.suspended&&!n.loaded&&(c=t.connect(n,"onLoad",this,function(){t.disconnect(c);c=null;this.setExclusionAreas(this.exclusionAreas);this.evaluateSuspension()})),h},_unsetMap:function(){this.suspended||this._suspendImpl();f.destroy(this._div);this._map=this._div=null;var n=t.disconnect;n(this._onResizeHandler_connect);n(this._opacityChangeHandler_connect);this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._suspendImpl()},_suspendImpl:function(){var r;p.hide(this._div);clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors();var s=this._tiles,u=this._tileIds,n=this._loadingList,i,e,o=t.disconnect,h=f.destroy;for(n&&0<n.count&&(n.forEach(function(n){(i=s[n])&&(o(i._onload_connect),o(i._onerror_connect),o(i._onabort_connect),i._onload_connect=i._onerror_connect=i._onabort_connect=null)}),n.clear(),this._fireUpdateEnd()),this._removeList.clear(),n=u.length-1;0<=n;n--)(i=(e=u[n])&&s[e])&&h(i);if("css-transforms"===this._map.navigationMode){for(u=this._active,e=this._passives,this._noDom=0,n=e.length-1;0<=n;n--)r=e[n],r._endHandle&&o(r._endHandle),r._matrix=r._multiply=r._endHandle=null,r._marked=r._remove=0,e.splice(n,1),h(r);u._matrix=u._multiply=null;u._marked=u._remove=0}this._tileIds=this._tiles=this._tileBounds=this._ct=this._loadingList=this._removeList=this._standby=null},onResume:function(){this.inherited(arguments);this._tileIds=[];this._tiles=[];this._tileBounds=[];this._ct=null;this._removeList=new c;this._loadingList=new c;p.show(this._div);this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(i.hitch(this,function(){this.suspended||this._onExtentChangeHandler(this._map.extent,null,!0,this._map.__LOD)}),0)},_enableDrawConnectors:function(){var n=this._map,i=t.connect,u,r;"css-transforms"===n.navigationMode?(this._onScaleHandler_connect=i(n,"onScale",this,this._onScaleHandler),y("esri-mobile"))&&(this._standby=[],u=this,r=function(){u._noDom=1},this._onPanStartHandler_connect=i(n,"onPanStart",r),this._onZoomStartHandler_connect=i(n,"onZoomStart",r)):this._onZoomHandler_connect=i(n,"onZoom",this,"_onZoomHandler");this._onPanHandler_connect=i(n,"onPan",this,"_onPanHandler");this._onExtentChangeHandler_connect=i(n,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var n=t.disconnect;n(this._onPanHandler_connect);n(this._onZoomHandler_connect);n(this._onScaleHandler_connect);n(this._onExtentChangeHandler_connect);n(this._onPanStartHandler_connect);n(this._onZoomStartHandler_connect);this._onPanHandler_connect=this._onZoomHandler_connect=this._onScaleHandler_connect=this._onExtentChangeHandler_connect=this._onPanStartHandler_connect=this._onZoomStartHandler_connect=null},_onResizeHandler:function(n,t,i){if(n={width:t+"px",height:i+"px"},t=s.set,t(this._div,n),"css-transforms"===this._map.navigationMode)for(this._active&&t(this._active,n),i=this._passives.length-1;0<=i;i--)t(this._passives[i],n)},_onExtentChangeHandler:function(n,t,i,r){var e,u;if(t=this._map,e=this._standby,clearTimeout(this._wakeTimer),this._wakeTimer=null,!t._isPanningOrZooming()){if("css-transforms"===t.navigationMode){if(i)for(r=this._passives.length-1;0<=r;r--)u=this._passives[r],s.set(u,a._css.names.transition,"none"),u._marked?(this._passives.splice(r,1),u.parentNode&&u.parentNode.removeChild(u),f.destroy(u)):0<u.childNodes.length&&(u._multiply=u._multiply?l.multiply(u._matrix,u._multiply):u._matrix);if(this._noDom=0,e&&e.length)for(r=e.length-1;0<=r;r--)u=e[r],s.set(u,"visibility","inherit"),this._popTile(u),e.splice(r,1)}if(this._fireUpdateStart(),this._rrIndex=0,r=w.getCandidateTileInfo(t,this.tileInfo,n),n=t.__visibleDelta,!this._ct||r.lod.level!==this._ct.lod.level||i){u=r&&this._ct&&r.lod.level!==this._ct.lod.level;this._ct=r;var v=this._tiles,h=this._tileIds,y=this._tileBounds,p=this._removeList,c,b=h.length;for(this._cleanUpRemovedImages(),r=0;r<b;r++)e=h[r],c=v[e],y[e]=h[r]=null,"css-transforms"===t.navigationMode&&u&&c.parentNode&&t.fadeOnZoom&&(c._fadeOut=u,c.parentNode._remove++),p.add(c);i&&(this._tileIds=[],this._tiles=[],this._tileBounds=[])}for(r=n.x,i=n.y,"css-transforms"===t.navigationMode?(e={},e[a._css.names.transform]=a._css.translate(r,i),s.set(this._div,e)):s.set(this._div,{left:r+"px",top:i+"px"}),this.__coords_dx=r,this.__coords_dy=i,this._updateImages(new k(0,0,n.width,n.height)),0===this._loadingList.count?(this._cleanUpRemovedImages(),this.onUpdate(),this._fireUpdateEnd()):this._fireOnUpdate=!0,i=this._tileW,v=this._tileH,n=new k(-n.x,-n.y,n.width,n.height),r=this._tileIds.length-1;0<=r;r--)(e=this._tileIds[r])?(u=this._tiles[e],h=o.getMarginBox(u),h=new k(h.l,h.t,i,v),"css-transforms"===t.navigationMode&&(h.x=u._left,h.y=u._top),n.intersects(h)?this._tileBounds[e]=h:(this._loadingList.contains(e)&&this._popTile(u),f.destroy(u),this._tileIds.splice(r,1),delete this._tileBounds[e],delete this._tiles[e])):(this._tileIds.splice(r,1),delete this._tileBounds[e],delete this._tiles[e])}},_onPanHandler:function(n,t){var r=this._map,i=r.__visibleDelta.offset(t.x,t.y);this.__coords_dx=this.__coords_dy=0;"css-transforms"===r.navigationMode?(r={},r[a._css.names.transform]=a._css.translate(i.x,i.y),s.set(this._div,r),y("esri-mobile")||this._updateImages({x:-i.x,y:-i.y,width:i.width,height:i.height})):(s.set(this._div,{left:i.x+"px",top:i.y+"px"}),this._updateImages({x:-i.x,y:-i.y,width:i.width,height:i.height}));0<this._loadingList.count&&(this._fireUpdateStart(),this._fireOnUpdate=!0)},_onScaleHandler:function(n,t){for(var u={},i=a._css.names,h=this._map,o=v.defaults.map.zoomDuration,r,e=this._passives.length-1;0<=e;e--)r=this._passives[e],0===r.childNodes.length?(this._passives.splice(e,1),f.destroy(r)):("none"===r.style[i.transition]&&s.set(r,i.transition,i.transformName+" "+o+"ms ease"),s.set(r,i.transition,t?"none":i.transformName+" "+o+"ms ease"),r._matrix=n,u[i.transform]=a._css.matrix(r._multiply?l.multiply(n,r._multiply):n),s.set(r,u));this._active&&0===this._active.childNodes.length||(s.set(this._active,i.transition,t?"none":i.transformName+" "+o+"ms ease"),this._active._matrix=n,u[i.transform]=a._css.matrix(this._active._matrix),s.set(this._active,u),this._passives.push(this._active),u={position:"absolute",width:h.width+"px",height:h.height+"px",overflow:"visible"},u[i.transition]=i.transformName+" "+o+"ms ease",s.set(this._active=f.create("div",null,this._div),u),this._active._remove=0,h.fadeOnZoom&&f.place(this._active,this._div,"first"))},_onZoomHandler:function(n,t,i){var b,k,d,g;n=o.getMarginBox(this._div);i=i.offset(-n.l,-n.t);this._previousScale&&1!==t||(this._previousScale=1);var u,l=this._tileW*t,a=this._tileH*t,v=this._tileBounds,e=this._tiles,p=this._previousScale,h=this._multiple,w=s.set,c,f;(n=y("ie"))&&8>n?r.forEach(this._tileIds,function(n){f="";u=v[n];c=e[n].style.margin.split(" ");r.forEach(c,function(n){""!==f&&(f+=" ");n=parseFloat(n);f+=n/p*t+"px"});w(e[n],{left:u.x-(l-u.width)*(i.x-u.x)/u.width+"px",top:u.y-(a-u.height)*(i.y-u.y)/u.height+"px",margin:1!==h&&-1===f.indexOf("NaN")?f:"",zoom:t})}):(b=l*h,k=a*h,r.forEach(this._tileIds,function(n){f="";u=v[n];d=u.x-(l-u.width)*(i.x-u.x)/u.width;g=u.y-(a-u.height)*(i.y-u.y)/u.height;c=e[n].style.margin.split(" ");r.forEach(c,function(n){""!==f&&(f+=" ");n=parseFloat(n);f+=n/p*t+"px"});w(e[n],{left:d+"px",top:g+"px",margin:1!==h&&-1===f.indexOf("NaN")?f:"",width:b+"px",height:k+"px"})}));this._previousScale=t},_updateImages:function(n){var f,c,v,k;if(this._ct){var i,o=this._tileW,s=this._tileH,l=this._ct;i=l.lod;var l=l.tile,y=l.offsets,p=l.coords,g=p.row,p=p.col,w=i.level,nt=this.opacity,d=this._tileIds,tt=this._loadingList,it=this._addImage,rt=this._map.id,ut=this.id,u=n.x,h=n.y,ft=i.startTileRow,et=i.endTileRow,ot=i.startTileCol,st=i.endTileCol,ht=r.indexOf,e,t,b=y.x-this.__coords_dx,a=y.y-this.__coords_dy;for(t=o-b+-n.x,f=s-a+-n.y,e=Math.ceil,t=0<t?t%o:o-Math.abs(t)%o,f=0<f?f%s:s-Math.abs(f)%s,u=0<u?Math.floor((u+b)/o):e((u-(o-b))/o),h=0<h?Math.floor((h+a)/s):e((h-(s-a))/s),a=u+e((n.width-t)/o),n=h+e((n.height-f)/s),this._wrap&&(c=i._frameInfo,v=c[0],k=c[1],c=c[2]),f=u;f<=a;f++)for(u=h;u<=n;u++)e=g+u,t=p+f,this._wrap&&(t<k?(t%=v,t=t<k?t+v:t):t>c&&(t%=v)),!this._isExcluded(w,e,t)&&e>=ft&&e<=et&&t>=ot&&t<=st&&(i=rt+"_"+ut+"_tile_"+w+"_"+u+"_"+f,-1===ht(d,i)&&(tt.add(i),d.push(i),it(w,u,e,f,t,i,o,s,nt,l,y)))}},_cleanUpRemovedImages:function(){var u=this._removeList,e=f.destroy,i,r=a._css.names,n;if(u.forEach(function(n){n._fadeOut||(n.style.filter="",n.style.zoom=1,e(n))}),"css-transforms"===this._map.navigationMode)for(i=this._passives.length-1;0<=i;i--)n=this._passives[i],0===n.childNodes.length?(this._passives.splice(i,1),e(n)):this._map.fadeOnZoom&&!n._marked&&n._remove===n.childNodes.length&&(n._marked=1,2048>a._css.getScaleFromMatrix(s.get(n,r.transform))?(s.set(n,r.transition,"opacity 0.65s"),s.set(n,"opacity",0),t.disconnect(n._endHandle),n._endHandle=t.connect(n,r.endEvent,this._transitionEnd)):this._transitionEnd({propertyName:"opacity",target:n}));u.clear()},_transitionEnd:function(n){var i=n.target;"opacity"===n.propertyName&&(t.disconnect(i._endHandle),i._endHandle=null,n=r.indexOf(this._passives,i),-1<n&&this._passives.splice(n,1),i.parentNode&&i.parentNode.removeChild(i),f.destroy(i))},_addImage:function(n,r,u,o,h,c,l,v,y,p,w){var b,k;this._patchIE?(p=this._tiles[c]=f.create("div"),p.id=c,e.add(p,"layerTile"),s.set(p,{left:l*o-w.x+"px",top:v*r-w.y+"px",width:l+"px",height:v+"px",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.getTileUrl(n,u,h)+"', sizingMethod='scale')"}),1>y&&s.set(p,"opacity",y),n=p.appendChild(f.create("div")),s.set(n,{opacity:0,width:l+"px",height:v+"px"}),this._div.appendChild(p),p=null,this._loadingList.remove(c),this._fireOnUpdateEvent()):(p=this._tiles[c]=f.create("img"),b=t.connect,p.id=c,p._uid=n+"_"+u+"_"+h,p.alt="",e.add(p,"layerTile"),o=l*o-w.x,w=v*r-w.y,r=this._map,k=a._css.names,l={width:l+"px",height:v+"px",visibility:"hidden"},"css-transforms"===r.navigationMode?(l[k.transform]=a._css.translate(o,w),s.set(p,l),p._left=o,p._top=w):(l.left=o+"px",l.top=w+"px",s.set(p,l)),1>y&&s.set(p,"opacity",y),p._onload_connect=b(p,"onload",this,"_tileLoadHandler"),p._onerror_connect=b(p,"onerror",i.hitch(this,"_tileErrorHandler",u,h)),p._onabort_connect=b(p,"onabort",this,"_tileAbortHandler"),this.tileMap?this.tileMap.getTile(n,u,h,c,this._tileMapCallback):(c=this.getTileUrl(n,u,h,p))&&(this._failedRequests&&this._failedRequests[c]?(s.set(p,this._failedRequests[c].css),p.src=this._failedRequests[c].src,this._multiple=parseInt(this._failedRequests[c].css.width)/this._tileW,this.isResampling=1!==this._multiple):(this._multiple=1,this.isResampling=!1,p.src=c)),"css-transforms"===r.navigationMode?this._active.appendChild(p):this._div.appendChild(p),p=null)},_tileMapCallback:function(n,t){var r,i;this.suspended||(i=this._tiles[t.id]||h.byId(t.id),r=t.level+"_"+t.row+"_"+t.col,i&&i._uid===r?(this._multiple=2*(t.level-n.level)||1,this.isResampling=1!==this._multiple,r=this.tileMap.style(n,t),s.set(i,r),i.src=this.getTileUrl(n.level,n.row,n.col)):this._popTile(t))},getTileUrl:function(){},_reCheckTS:/[\?\&]_ts=/ig,_reReplaceTS:/([\?\&]_ts=)[0-9]+/ig,addTimestampToURL:function(n){var t=this._refreshTS;return t&&(n=this._reCheckTS.test(n)?n.replace(this._reReplaceTS,"$$$1"+t):n+((-1===n.indexOf("?")?"?":"&")+"_ts="+t)),n},refresh:function(){this.suspended||(this._refreshTS=(new Date).getTime(),this._onExtentChangeHandler(this._map.extent,null,!0,this._map.__LOD))},_popTile:function(n){var i=t.disconnect;i(n._onload_connect);i(n._onerror_connect);i(n._onabort_connect);n._onload_connect=n._onerror_connect=n._onabort_connect=null;this._loadingList.remove(n.id);this._fireOnUpdateEvent()},_tileLoadHandler:function(n){n=n.currentTarget;this._noDom?this._standby.push(n):(s.set(n,"visibility","inherit"),this._popTile(n))},_tileAbortHandler:function(n){n=n.currentTarget;this.onError(Error("Unable to load tile: "+n.src));s.set(n,"visibility","hidden");this._popTile(n)},_tileErrorHandler:function(n,t,i){i=i.currentTarget;var r,e,f=!0;this.tileMap||!this.resampling?f=!1:(r=new u(i.src),r=r.path.split("/"),r=parseInt(r[r.length-3]),e=this._ct.lod.level-r+1,this._multiple=Math.pow(2,e),r===this._lowestLevel||0===this._resamplingTolerance||this._resamplingTolerance&&Math.log(this._multiple)/Math.LN2>this._resamplingTolerance)&&(f=!1);f?(this.isResampling=!0,this._resample(i,n,t)):(this.onError(Error("Unable to load tile: "+i.src)),s.set(i,"visibility","hidden"),this._popTile(i))},_resample:function(n,t,i){var f=new u(n.src).path.split("/"),r=this._multiple,o=parseInt(f[f.length-3])-1,e=parseInt(t/r),h=parseInt(i/r),f=i%r,c=t%r,e=this.getTileUrl(o,e,h);t=this.getTileUrl(o+Math.log(r)/Math.LN2,t,i);r={width:this._tileW*r+"px",height:this._tileH*r+"px",margin:"-"+this._tileW*c+"px 0 0 "+("-"+this._tileH*f+"px")};this._failedRequests||(this._failedRequests={});this._failedRequests[t]={src:e,css:r};s.set(n,r);y("chrome")&&n.setAttribute("src",null);n.src=e},_fireOnUpdateEvent:function(){0===this._loadingList.count&&(this._cleanUpRemovedImages(),this._fireOnUpdate&&(this._fireOnUpdate=!1,this.onUpdate(),this._fireUpdateEnd()))},setOpacity:function(n){if(this.opacity!=n)this.onOpacityChange(this.opacity=n)},onOpacityChange:function(){},_opacityChangeHandler:function(n){var u=s.set,t,r,i;if("css-transforms"===this._map.navigationMode){if(this._active)for(i=this._active.childNodes,t=i.length-1;0<=t;t--)u(i[t],"opacity",n);for(t=this._passives.length-1;0<=t;t--)for(i=this._passives[t].childNodes,r=i.length-1;0<=r;r--)u(i[r],"opacity",n)}else for(i=this._div.childNodes,t=i.length-1;0<=t;t--)u(i[t],"opacity",n)},setExclusionAreas:function(n){if(this.exclusionAreas=n,this.loaded&&this._map&&this._map.loaded){var s=this._map.spatialReference,h=this.tileInfo,c=h.origin,u=h.lods,p=u[0].level,v=u[u.length-1].level,i,l,y,r,e,a,o,f,t;if(this.exclusionAreas&&this.exclusionAreas.length){for(this._exclusionsPerZoom=[],l=0,y=n.length;l<y;l++)if(i=n[l],(t=i.geometry)&&"extent"===t.type&&t.xmin<=t.xmax&&t.ymin<=t.ymax){if(!s.equals(t.spatialReference))if(s._canProject(t.spatialReference))s.isWebMercator()?(f=b.lngLatToXY(t.xmin,t.ymin),t=b.lngLatToXY(t.xmax,t.ymax)):(f=b.xyToLngLat(t.xmin,t.ymin,!0),t=b.xyToLngLat(t.xmax,t.ymax,!0)),t=new d(f[0],f[1],t[0],t[1],s);else continue;if(o=-1,i.minZoom&&-1!==i.minZoom)o=i.minZoom;else if(i.minScale&&-1!==i.minScale)for(r=0,e=u.length;r<e;r++)if(u[r].scale<=i.minScale){o=u[r].level;break}if(o=Math.max(o,p),f=-1,i.maxZoom&&-1!==i.maxZoom)f=i.maxZoom;else if(i.maxScale&&-1!==i.maxScale)for(r=0,e=u.length;r<e;r++)if(u[r].scale<i.maxScale){f=u[r-1].level;break}else if(u[r].scale===i.maxScale){f=u[r].level;break}for(f=-1===f?v:Math.min(f,v),i=o;i<=f;i++){for(r=0,e=u.length;r<e;r++)if(u[r].level===i){a=u[r];break}a&&(this._exclusionsPerZoom[i]||(this._exclusionsPerZoom[i]=[]),r=1/a.resolution/h.rows,e=1/a.resolution/h.cols,this._exclusionsPerZoom[i].push({rowFrom:Math.floor((c.y-t.ymax)*r),rowTo:Math.ceil((c.y-t.ymin)*r),colFrom:Math.floor((t.xmin-c.x)*e),colTo:Math.ceil((t.xmax-c.x)*e)}))}}}else this._exclusionsPerZoom=null;this.suspended||this._onExtentChangeHandler(this._map.extent,null,!0,this._map.__LOD)}},_isExcluded:function(n,t,i){var r,u,f;if(!this._exclusionsPerZoom||(r=this._exclusionsPerZoom[n],!r))return!1;for(u=0,f=r.length;u<f;u++)if(n=r[u],t>=n.rowFrom&&t<n.rowTo&&i>=n.colFrom&&i<n.colTo)return!0;return!1}}),y("extend-esri")&&i.setObject("layers.TiledMapServiceLayer",n,a),n})},"dojox/collections/ArrayList":function(){define(["dojo/_base/kernel","dojo/_base/array","./_base"],function(n,t,i){return i.ArrayList=function(t){var r=[];t&&(r=r.concat(t));this.count=r.length;this.add=function(n){r.push(n);this.count=r.length};this.addRange=function(n){if(n.getIterator)for(n=n.getIterator();!n.atEnd();)this.add(n.get());else for(var t=0;t<n.length;t++)r.push(n[t]);this.count=r.length};this.clear=function(){r.splice(0,r.length);this.count=0};this.clone=function(){return new i.ArrayList(r)};this.contains=function(n){for(var t=0;t<r.length;t++)if(r[t]==n)return!0;return!1};this.forEach=function(t,i){n.forEach(r,t,i)};this.getIterator=function(){return new i.Iterator(r)};this.indexOf=function(n){for(var t=0;t<r.length;t++)if(r[t]==n)return t;return-1};this.insert=function(n,t){r.splice(n,0,t);this.count=r.length};this.item=function(n){return r[n]};this.remove=function(n){n=this.indexOf(n);0<=n&&r.splice(n,1);this.count=r.length};this.removeAt=function(n){r.splice(n,1);this.count=r.length};this.reverse=function(){r.reverse()};this.sort=function(n){n?r.sort(n):r.sort()};this.setByIndex=function(n,t){r[n]=t;this.count=r.length};this.toArray=function(){return[].concat(r)};this.toString=function(n){return r.join(n||",")}},i.ArrayList})},"dojox/collections/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array"],function(n,t,i){return n=t.getObject("dojox.collections",!0),n.DictionaryEntry=function(n,t){this.key=n;this.value=t;this.valueOf=function(){return this.value};this.toString=function(){return String(this.value)}},n.Iterator=function(n){var t=0;this.element=n[t]||null;this.atEnd=function(){return t>=n.length};this.get=function(){return this.atEnd()?null:this.element=n[t++]};this.map=function(t,r){return i.map(n,t,r)};this.reset=function(){t=0;this.element=n[t]}},n.DictionaryIterator=function(n){var t=[],f={},u,r;for(u in n)f[u]||t.push(n[u]);r=0;this.element=t[r]||null;this.atEnd=function(){return r>=t.length};this.get=function(){return this.atEnd()?null:this.element=t[r++]};this.map=function(n,r){return i.map(t,n,r)};this.reset=function(){r=0;this.element=t[r]}},n})},"esri/layers/ArcGISMapServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../request ../SpatialReference ../geometry/Extent ./LayerInfo".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n(null,{declaredClass:"esri.layers.ArcGISMapServiceLayer",infoTemplates:null,constructor:function(n,t){this.layerInfos=[];t&&(this.infoTemplates=t.infoTemplates||null);var r=this._params={},i=this._url.query?this._url.query.token:null;i&&(r.token=i)},setInfoTemplates:function(n){this.infoTemplates=n},_load:function(){e({url:this._url.path,content:t.mixin({f:"json"},this._params),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler})},spatialReference:null,initialExtent:null,fullExtent:null,description:null,units:null,_initLayer:function(n){try{this._findCredential();(this.credential&&this.credential.ssl||n&&n._ssl)&&this._useSSL();this.description=n.description;this.copyright=n.copyrightText;this.spatialReference=n.spatialReference&&new o(n.spatialReference);this.initialExtent=n.initialExtent&&new s(n.initialExtent);this.fullExtent=n.fullExtent&&new s(n.fullExtent);this.units=n.units;this.maxRecordCount=n.maxRecordCount;this.maxImageHeight=n.maxImageHeight;this.maxImageWidth=n.maxImageWidth;this.supportsDynamicLayers=n.supportsDynamicLayers;var r=this.layerInfos=[],u=n.layers,t=this._defaultVisibleLayers=[];i.forEach(u,function(n,i){r[i]=new h(n);n.defaultVisibility&&t.push(n.id)});this.visibleLayers||(this.visibleLayers=t);this.version=n.currentVersion;this.version||(this.version="capabilities"in n||"tables"in n?10:"supportedImageFormatTypes"in n?9.31:9.3);this.capabilities=n.capabilities;f.isDefined(n.minScale)&&!this._hasMin&&this.setMinScale(n.minScale);f.isDefined(n.maxScale)&&!this._hasMax&&this.setMaxScale(n.maxScale)}catch(e){this._errorHandler(e)}}}),r("extend-esri")&&t.setObject("layers.ArcGISMapServiceLayer",n,u),n})},"esri/layers/LayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.LayerInfo",constructor:function(n){t.mixin(this,n)},toJson:function(){return u.fixJson({defaultVisibility:this.defaultVisibility,id:this.id,maxScale:this.maxScale,minScale:this.minScale,name:this.name,parentLayerId:this.parentLayerId,subLayerIds:this.subLayerIds})}}),i("extend-esri")&&t.setObject("layers.LayerInfo",n,r),n})},"esri/layers/TimeInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../TimeExtent ./TimeReference ./LayerTimeOptions".split(" "),function(n,t,i,r,u,f,e){return n=n(null,{declaredClass:"esri.layers.TimeInfo",constructor:function(n){null!==n&&(t.mixin(this,n),n.exportOptions&&(this.exportOptions=new e(n.exportOptions)),this.timeExtent=null,n.timeExtent&&2===n.timeExtent.length&&(this.timeExtent=new u(n.timeExtent)),this.timeReference=new f(n.timeReference))}}),t.mixin(n,{UNIT_CENTURIES:"esriTimeUnitsCenturies",UNIT_DAYS:"esriTimeUnitsDays",UNIT_DECADES:"esriTimeUnitsDecades",UNIT_HOURS:"esriTimeUnitsHours",UNIT_MILLISECONDS:"esriTimeUnitsMilliseconds",UNIT_MINUTES:"esriTimeUnitsMinutes",UNIT_MONTHS:"esriTimeUnitsMonths",UNIT_SECONDS:"esriTimeUnitsSeconds",UNIT_UNKNOWN:"esriTimeUnitsUnknown",UNIT_WEEKS:"esriTimeUnitsWeeks",UNIT_YEARS:"esriTimeUnitsYears"}),i("extend-esri")&&t.setObject("layers.TimeInfo",n,r),n})},"esri/TimeExtent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./kernel"],function(n,t,i,r){var u=n(null,{declaredClass:"esri.TimeExtent",constructor:function(n){if(1<arguments.length)this._create(arguments[0],arguments[1]);else if(n)if(t.isArray(n)){var i=n[0],r=n[1];this.startTime=null===i||"null"===i?null:new Date(i);this.endTime=null===r||"null"===r?null:new Date(r)}else n instanceof Date&&this._create(n,null)},offset:function(n,t){var i=new u,r=this.startTime,f=this.endTime;return r&&(i.startTime=this._getOffsettedDate(r,n,t)),f&&(i.endTime=this._getOffsettedDate(f,n,t)),i},intersection:function(n){return this._intersection(this,n)},toJson:function(){var t=[],n=this.startTime;return t.push(n?n.getTime():"null"),n=this.endTime,t.push(n?n.getTime():"null"),t},_create:function(n,t){this.startTime=n?new Date(n.getTime()):null;this.endTime=t?new Date(t.getTime()):null},_refData:{esriTimeUnitsMilliseconds:{getter:"getUTCMilliseconds",setter:"setUTCMilliseconds",multiplier:1},esriTimeUnitsSeconds:{getter:"getUTCSeconds",setter:"setUTCSeconds",multiplier:1},esriTimeUnitsMinutes:{getter:"getUTCMinutes",setter:"setUTCMinutes",multiplier:1},esriTimeUnitsHours:{getter:"getUTCHours",setter:"setUTCHours",multiplier:1},esriTimeUnitsDays:{getter:"getUTCDate",setter:"setUTCDate",multiplier:1},esriTimeUnitsWeeks:{getter:"getUTCDate",setter:"setUTCDate",multiplier:7},esriTimeUnitsMonths:{getter:"getUTCMonth",setter:"setUTCMonth",multiplier:1},esriTimeUnitsYears:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:1},esriTimeUnitsDecades:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:10},esriTimeUnitsCenturies:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:100}},_intersection:function(n,t){if(n&&t){var i=n.startTime,r=n.endTime,f=t.startTime,e=t.endTime,i=i?i.getTime():-Infinity,f=f?f.getTime():-Infinity,r=r?r.getTime():Infinity,e=e?e.getTime():Infinity,o,s;return(f>=i&&f<=r?o=f:i>=f&&i<=e&&(o=i),r>=f&&r<=e?s=r:e>=i&&e<=r&&(s=e),isNaN(o)||isNaN(s))?null:(i=new u,i.startTime=-Infinity===o?null:new Date(o),i.endTime=Infinity===s?null:new Date(s),i)}return null},_getOffsettedDate:function(n,t,i){var r=this._refData;return n=new Date(n.getTime()),t&&i&&(r=r[i],n[r.setter](n[r.getter]()+t*r.multiplier)),n}});return i("extend-esri")&&(r.TimeExtent=u),u})},"esri/layers/TimeReference":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.layers.TimeReference",constructor:function(n){n&&t.mixin(this,n)}}),i("extend-esri")&&t.setObject("layers.TimeReference",n,r),n})},"esri/layers/LayerTimeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.LayerTimeOptions",constructor:function(n){n&&t.mixin(this,n)},toJson:function(){return u.fixJson({timeDataCumulative:this.timeDataCumulative,timeOffset:this.timeOffset,timeOffsetUnits:this.timeOffsetUnits,useTime:this.useTime})}}),i("extend-esri")&&t.setObject("layers.LayerTimeOptions",n,r),n})},"esri/layers/TileMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/io-query ../request ../urlUtils ../sniff".split(" "),function(n,t,i,r,u,f,e,o){var s=o("esri-iphone");return n(null,{declaredClass:"esri.layers.TileMap",constructor:function(n){this.layer=n;this._tileMaps={}},getTile:function(n,t,i,r,u){n={id:r,level:n,row:t,col:i};t=this._getResamplingBudget();0<t?this._process({tile:n,requestedTile:n,callback:u,resamplingBudget:t}):(u||this.callback).call(this,n,n)},statusOf:function(n,t,i){var r=this._getResamplingBudget();if(n={level:n,row:t,col:i},0===r)return 1;for(;0<=r;){if((t=this._tileToTileMap(n),!this._tileMaps[t.uid])||(t=this._tileMaps[t.uid],!t.promise.isFulfilled()))return-1;if(this._isTileAvailable(n,t))return 1;if(n=this._parentTile(n),!n)break;r--}return 0},style:function(n,t){if(n.level!==t.level||n.row!==t.row||n.col!==t.col){for(var f=this.layer.tileInfo,i=f.lods,o=f.cols,f=f.rows,r,u,e=i.length-1;!r||!u;)r||i[e].level!==n.level||(r=i[e]),u||i[e].level!==t.level||(u=i[e]),e--;return r=Math.round(r.resolution/u.resolution),u=t.col%r*-1*o,i=t.row%r*-1*f,r={width:o*r+"px",height:f*r+"px",margin:i+"px 0 0 "+u+"px","will-change":"transform"},s&&(u=0===u?0:-1*u,i=0===i?0:-1*i,r.clip="rect("+i+"px,"+(u+o)+"px,"+(i+f)+"px,"+u+"px)"),r}},_process:function(n){var i=n.tile,r=this._tileToTileMap(i),u=this._parentTile(i);this._getTileMap(r).then(t.hitch(this,function(t){r=t;this._isTileAvailable(i,r)?(n.callback||this.callback).call(this,i,n.requestedTile):0<n.resamplingBudget&&u?(n.resamplingBudget--,n.tile=u,this._process(n)):(n.callback||this.callback).call(this,n.requestedTile,n.requestedTile)}),t.hitch(this,function(){(n.callback||this.callback).call(this,n.requestedTile,n.requestedTile)}))},_getTileMap:function(n){var o,u,e,s,i=null;return this._tileMaps[n.uid]?(n=this._tileMaps[n.uid],o=n.promise):(this._tileMaps[n.uid]=n,u=new r,f({url:this._getTileMapUrl(n.level,n.row,n.col),handleAs:"json",callbackParamName:"callback",timeout:3e3,load:function(r){if(t.mixin(n,r),n.data&&0<n.data.length){if(s=n.data.length,1===s)i=n.data[0];else for(i=n.data[0],e=1;e<s;e++)if(n.data[e]!==i){i=null;break}null!==i&&(delete n.data,n.value=i)}u.resolve(n)},error:function(){u.reject()}}),o=n.promise=u.promise),o},_parentTile:function(n){var t=this.layer.tileInfo.lods,r,u,f=null;return i.some(t,function(t,i){return n.level===t.level?(r=t,u=i,!0):!1}),0<u&&(t=t[u-1],f={id:n.id,level:t.level,row:Math.floor(n.row*r.resolution/t.resolution+.01),col:Math.floor(n.col*r.resolution/t.resolution+.01)}),f},_tileToTileMap:function(n){var t=8*Math.floor(n.row/8),i=8*Math.floor(n.col/8);return{uid:n.level+"_"+t+"_"+i,level:n.level,row:t,col:i}},_isTileAvailable:function(n,t){var i,r;return t.valid?void 0!==t.value?i=t.value:(i=t.location.left,r=t.location.top,i=(n.row-r)*t.location.width+(n.col-i),i=i<t.data.length?t.data[i]:0):i=0,i},_getTileMapUrl:function(n,t,i){var r=this.layer,e=r.tileServers,o=r._getToken(),f=r._url.query;return n=(e?e[t%e.length]:r._url.path)+"/tilemap/"+n+"/"+t+"/"+i+"/8/8",f&&(n+="?"+u.objectToQuery(f)),!o||f&&f.token||(n+=(-1===n.indexOf("?")?"?":"&")+"token="+o),r.addTimestampToURL(n)},_getResamplingBudget:function(){var t=this.layer,n=0;return t.resampling&&(n=t._resamplingTolerance,null===n||void 0===n)&&(n=t.tileInfo.lods.length),n}})})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style ../kernel ../config ../sniff ../domUtils ../geometry/Point ../geometry/webMercatorUtils ./layer".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=n([a],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(n){this.inherited(arguments,[null,n]);this._mapImages=[];var r=i.hitch;this._panStart=r(this,this._panStart);this._pan=r(this,this._pan);this._extentChange=r(this,this._extentChange);this._zoom=r(this,this._zoom);this._zoomStart=r(this,this._zoomStart);this._scale=r(this,this._scale);this._resize=r(this,this._resize);t.connect(this,"onSuspend",this,this._onSuspend);t.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},opacity:1,addImage:function(n){var t=this._mapImages.push(n),t=t-1;n._idx=t;n._layer=this;this._div&&this._createImage(n,t)},removeImage:function(n){if(n){var t=n._idx,i=this._mapImages;i[t]===n&&(delete i[t],(t=n._node)&&(this._clearEvents(t),t.e_idx=t.e_bl=t.e_tr=t.e_l=t.e_t=t.e_w=t.e_h=null,t.parentNode&&(t.parentNode.removeChild(t),u.destroy(t))),n._node=n._idx=n._layer=null)}},removeAllImages:function(){for(var i=this._mapImages,r=i.length,t,n=0;n<r;n++)t=i[n],t&&this.removeImage(t);this._mapImages=[]},getImages:function(){for(var t=this._mapImages,i=[],r=t.length,n=0;n<r;n++)t[n]&&i.push(t[n]);return i},setOpacity:function(n){this.opacity!=n&&(this._opacityChanged(this.opacity=n),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(n){var t=this._div,r,i;if(t)if(!s("ie")||8<s("ie"))f.set(t,"opacity",n);else for(i=t.childNodes,r=i.length,t=0;t<r;t++)f.set(i[t],"opacity",n)},_createImage:function(n,i){var r=u.create("img");f.set(r,{position:"absolute"});1>n.opacity?f.set(r,"opacity",n.opacity):8>=s("ie")&&f.set(r,"opacity",this.opacity);!n.rotation||9>s("ie")||f.set(r,e._css.names.transform,e._css.rotate(360-n.rotation));n._node=r;r.e_idx=i;r.e_layer=this;r.e_load=t.connect(r,"onload",v.prototype._imageLoaded);r.e_error=t.connect(r,"onerror",v.prototype._imageError);r.e_abort=t.connect(r,"onabort",v.prototype._imageError);r.src=n.href},_imageLoaded:function(n,t){var r=t||n.target||n.currentTarget,i=r.e_layer,f=i._mapImages[r.e_idx],u=i._map;u&&(u.__zooming||u.__panning||!i._sr)?i._standby.push(r):(i._clearEvents(r),f&&f._node===r&&u&&i._attach(f))},_imageError:function(n){n=n.target||n.currentTarget;var t=n.e_layer,i=t._mapImages[n.e_idx];t._clearEvents(n);i&&(i._node=null)},_clearEvents:function(n){var i=t.disconnect;i(n.e_load);i(n.e_error);i(n.e_abort);n.e_load=n.e_error=n.e_abort=n.e_layer=null},_attach:function(n){var t=n.extent,i=t.spatialReference,f=this._sr,e=this._div,u=n._node,r=new c({x:t.xmin,y:t.ymin,spatialReference:i}),t=new c({x:t.xmax,y:t.ymax,spatialReference:i});f.equals(i)||(f.isWebMercator()&&4326===i.wkid?(r=l.geographicToWebMercator(r),t=l.geographicToWebMercator(t)):i.isWebMercator()&&4326===f.wkid&&(r=l.webMercatorToGeographic(r),t=l.webMercatorToGeographic(t)));u.e_bl=r;u.e_tr=t;n.visible&&(this._setPos(u,e._left,e._top),(this._active||e).appendChild(u))},_setPos:function(n,t,i){var u=n.e_bl,r=n.e_tr,o=this._map,u=o.toScreen(u),r=o.toScreen(r);t=u.x-t;i=r.y-i;var s=Math.abs(r.x-u.x),u=Math.abs(u.y-r.y),r={width:s+"px",height:u+"px"},h=this._mapImages[n.e_idx];"css-transforms"===o.navigationMode?r[e._css.names.transform]=e._css.translate(t,i)+(h.rotation?" "+e._css.rotate(360-h.rotation):""):(r.left=t+"px",r.top=i+"px");f.set(n,r);n.e_l=t;n.e_t=i;n.e_w=s;n.e_h=u},managedSuspension:!0,_setMap:function(n,t){var l;this.inherited(arguments);var r=this._div=u.create("div",null,t),c=e._css.names,i={position:"absolute"},o=n.__visibleDelta;for((!s("ie")||8<s("ie"))&&(i.opacity=this.opacity),"css-transforms"===n.navigationMode?(i[c.transform]=e._css.translate(o.x,o.y),f.set(r,i),r._left=o.x,r._top=o.y,i={position:"absolute",width:n.width+"px",height:n.height+"px",overflow:"visible"},this._active=u.create("div",null,r),f.set(this._active,i),this._passive=u.create("div",null,r),f.set(this._passive,i)):(r._left=0,r._top=0,f.set(r,i)),this._standby=[],c=this._mapImages,o=c.length,i=0;i<o;i++)l=c[i],l._node||this._createImage(l,l._idx);return h.hide(r),r},_unsetMap:function(n,t){var r,o,f,s,e,i;if(this._disconnect(),r=this._div,r){for(o=this._mapImages,s=o.length,f=0;f<s;f++)e=o[f],e&&(i=e._node,i&&(this._clearEvents(i),i.e_idx=i.e_bl=i.e_tr=i.e_l=i.e_t=i.e_w=i.e_h=null),e._node=null);t.removeChild(r);u.destroy(r)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();h.hide(this._div)},_onResume:function(n){n.firstOccurrence&&(this._sr=this._map.spatialReference,this._processStandbyList());n=this._map;var t=this._div,i=n.__visibleDelta;"css-transforms"===n.navigationMode&&(t._left=i.x,t._top=i.y,f.set(t,e._css.names.transform,e._css.translate(t._left,t._top)));this._redraw("css-transforms"===n.navigationMode);this._connect(n);h.show(t)},_connect:function(n){if(!this._connections){var i=t.connect,r="css-transforms"===n.navigationMode;this._connections=[i(n,"onPanStart",this._panStart),i(n,"onPan",this._pan),i(n,"onExtentChange",this._extentChange),r&&i(n,"onZoomStart",this._zoomStart),r?i(n,"onScale",this._scale):i(n,"onZoom",this._zoom),r&&i(n,"onResize",this._resize)]}},_disconnect:function(){this._connections&&(r.forEach(this._connections,t.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(n,t){var i=this._div;i._left=this._panL+t.x;i._top=this._panT+t.y;"css-transforms"===this._map.navigationMode?f.set(i,e._css.names.transform,e._css.translate(i._left,i._top)):f.set(i,{left:i._left+"px",top:i._top+"px"})},_extentChange:function(n,t,i){i?this._redraw("css-transforms"===this._map.navigationMode):t&&this._pan(n,t);this._processStandbyList()},_processStandbyList:function(){var n,t=this._standby;if(t&&t.length)for(n=t.length-1;0<=n;n--)this._imageLoaded(null,t[n]),t.splice(n,1)},_redraw:function(n){var t;n&&(n=this._passive,t=e._css.names,f.set(n,t.transition,"none"),this._moveImages(n,this._active),f.set(n,t.transform,"none"));n=this._active||this._div;for(var t=this._div._left,u=this._div._top,o=n.childNodes.length,r,i=0;i<o;i++)r=n.childNodes[i],this._setPos(r,t,u)},_zoom:function(n,t,i){n=this._div;for(var c=n._left,l=n._top,a=n.childNodes.length,r,u=0;u<a;u++){r=n.childNodes[u];var s=r.e_w*t,h=r.e_h*t,e=(i.x-c-r.e_l)*(s-r.e_w)/r.e_w,o=(i.y-l-r.e_t)*(h-r.e_h)/r.e_h,e=isNaN(e)?0:e,o=isNaN(o)?0:o;f.set(r,{left:r.e_l-e+"px",top:r.e_t-o+"px",width:s+"px",height:h+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(n,t){var r=n.childNodes,i;if(i=r.length,0<i)for(--i;0<=i;i--)t.appendChild(r[i])},_scale:function(n,t){var i=e._css.names,r=this._passive;f.set(r,i.transition,t?"none":i.transformName+" "+o.defaults.map.zoomDuration+"ms ease"),{}[i.transform]=e._css.matrix(n);f.set(r,i.transform,e._css.matrix(n))},_resize:function(n,t,i){f.set(this._active,{width:t+"px",height:i+"px"});f.set(this._passive,{width:t+"px",height:i+"px"})}});return s("extend-esri")&&i.setObject("layers.MapImageLayer",v,e),v})},"esri/layers/OpenStreetMapLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(o,{declaredClass:"esri.layers.OpenStreetMapLayer",constructor:function(n){this.spatialReference=new f({wkid:102100});this.tileInfo=new s({rows:256,cols:256,dpi:96,format:"PNG8",compressionQuality:0,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:102100},lods:[{level:0,scale:591657527.591555,resolution:156543.033928},{level:1,scale:295828763.795777,resolution:78271.5169639999},{level:2,scale:147914381.897889,resolution:39135.7584820001},{level:3,scale:73957190.948944,resolution:19567.8792409999},{level:4,scale:36978595.474472,resolution:9783.93962049996},{level:5,scale:18489297.737236,resolution:4891.96981024998},{level:6,scale:9244648.868618,resolution:2445.98490512499},{level:7,scale:4622324.434309,resolution:1222.99245256249},{level:8,scale:2311162.217155,resolution:611.49622628138},{level:9,scale:1155581.108577,resolution:305.748113140558},{level:10,scale:577790.554289,resolution:152.874056570411},{level:11,scale:288895.277144,resolution:76.4370282850732},{level:12,scale:144447.638572,resolution:38.2185141425366},{level:13,scale:72223.819286,resolution:19.1092570712683},{level:14,scale:36111.909643,resolution:9.55462853563415},{level:15,scale:18055.954822,resolution:4.77731426794937},{level:16,scale:9027.977411,resolution:2.38865713397468},{level:17,scale:4513.988705,resolution:1.19432856685505},{level:18,scale:2256.994353,resolution:.597164283559817},{level:19,scale:1128.497176,resolution:.298582141647617}]});this.fullExtent=new e({xmin:-20037508.34,ymin:-20037508.34,xmax:20037508.34,ymax:20037508.34,spatialReference:{wkid:102100}});this.initialExtent=new e({xmin:-20037508.34,ymin:-20037508.34,xmax:20037508.34,ymax:20037508.34,spatialReference:{wkid:102100}});this.tileServers=n&&n.tileServers||["//a.tile.openstreetmap.org","//b.tile.openstreetmap.org","//c.tile.openstreetmap.org"];this.serversLength=this.tileServers.length;this._displayLevels=n?n.displayLevels:null;this.copyright=n&&n.copyright||"Map data  OpenStreetMap contributors, CC-BY-SA";this.loaded=!0;this.onLoad(this);(n=n&&n.loadCallback)&&n(this)},getTileUrl:function(n,t,i){return n=this.tileServers[t%this.serversLength]+"/"+n+"/"+i+"/"+t+".png",n=u.normalize(n),n=this.addTimestampToURL(n),u.addProxy(n)}}),i("extend-esri")&&t.setObject("layers.OpenStreetMapLayer",n,r),n})},"esri/layers/VectorTileLayer":function(){(function(){var n=function(){var n,t;try{n=window.WebGLRenderingContext}catch(e){n=!1}try{for(var f=document.createElement("canvas"),u=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,r=0;r<u.length;++r){try{i=f.getContext(u[r])}catch(e){}if(i)break}t=i}catch(e){t=!1}return n&&t?!0:!1}(),t=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];n&&t.push("./VectorTileLayerImpl");define(t,function(t,i,r,u,f,e){return f=e?e:f.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var n=new r;n.reject(Error("esri.layers.VectorTileLayer is not supported"));n.promise.otherwise(t.hitch(this,function(n){this._errorHandler(n)}))}}),f.ACCESS_TOKEN=null,f.supported=function(){return n},i("extend-esri")&&t.setObject("layers.VectorTileLayer",f,u),f})})()},"esri/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/window dojo/Stateful dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/registry ../kernel ../lang ../domUtils ../geometry/Polyline ../geometry/Polygon ../geometry/normalizeUtils ../InfoWindowBase ../PopupBase dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){return n=n([tt,it,o],{declaredClass:"esri.dijit.Popup",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:25,marginTop:25,highlight:!0,pagingControls:!0,pagingInfo:!0,keepHighlightOnHide:!1,popupWindow:!0,titleInBody:!0,anchor:"auto",visibleWhenEmpty:!0,hideDelay:1e3,location:null,constructor:function(n,i){this.initialize();t.mixin(this,n);this.domNode=h.byId(i);var e=this._nls=t.mixin({},rt.widgets.popup),o=this.domNode;l.add(o,"esriPopup");(this._isRTL=!v.isBodyLtr())&&y.set(o,"direction","rtl");c.set(o,"innerHTML","<div class='esriPopupWrapper' style='position: absolute;'><div class='sizer'><div class='titlePane'><div class='spinner hidden' title='"+e.NLS_searching+"...'><\/div><div class='title'><\/div><div class='titleButton prev hidden' title='"+e.NLS_prevFeature+"'><\/div><div class='titleButton next hidden' title='"+e.NLS_nextFeature+"'><\/div><div class='titleButton maximize' title='"+e.NLS_maximize+"'><\/div><div class='titleButton close' title='"+e.NLS_close+"'><\/div><\/div><\/div><div class='sizer content'><div class='contentPane'><\/div><\/div><div class='sizer'><div class='actionsPane'><div class='actionList hidden'><a title="+e.NLS_zoomTo+" class='action zoomTo' href='javascript:void(0);'><span>"+e.NLS_zoomTo+"<\/span><\/a><\/div><\/div><\/div><div class='pointer hidden'><\/div><\/div><div class='outerPointer hidden'><\/div>");this._sizers=u.query(".sizer",o);e=u.query(".titlePane",o)[0];h.setSelectable(e,!1);this._title=u.query(".title",e)[0];this._prevFeatureButton=u.query(".prev",e)[0];this._nextFeatureButton=u.query(".next",e)[0];this._maxButton=u.query(".maximize",e)[0];this._spinner=u.query(".spinner",e)[0];this._contentPane=u.query(".contentPane",o)[0];this._positioner=u.query(".esriPopupWrapper",o)[0];this._pointer=u.query(".pointer",o)[0];this._outerPointer=u.query(".outerPointer",o)[0];this._actionList=u.query(".actionsPane .actionList",o)[0];this._eventConnections=[r.connect(u.query(".close",e)[0],"onclick",this,this.hide),r.connect(this._prevFeatureButton,"onclick",this,this.selectPrevious),r.connect(this._nextFeatureButton,"onclick",this,this.selectNext),r.connect(this._maxButton,"onclick",this,this._toggleSize),r.connect(u.query(".zoomTo",this._actionList)[0],"onclick",this,this._zoomToFeature),r.connect(this,"onClearFeatures",this,this._featuresCleared),r.connect(this,"onSelectionChange",this,this._featureSelected),r.connect(this,"onDfdComplete",this,this._updateUI)];f("esri-touch")&&(o=k.setScrollable(this._contentPane),this._eventConnections.push(o[0],o[1]));this._toggleVisibility(!1)},onMaximize:function(){},onRestore:function(){},setMap:function(n){this.inherited(arguments);a.place(this.domNode,n.root);this.highlight&&this.enableHighlight(n);this._maxHeight=y.get(this._contentPane,"maxHeight")},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(n){this.popupWindow&&(b.isDefined(n)&&""!==n||(n="&nbsp;"),this.destroyDijits(this._title),this.place(n,this._title),this.isShowing&&(this.startupDijits(this._title),this.reposition()))},setContent:function(n){this.popupWindow&&(b.isDefined(n)&&""!==n||(n="&nbsp;"),this.destroyDijits(this._contentPane),this.place(n,this._contentPane),this.isShowing&&(this.startupDijits(this._contentPane),this.reposition()))},show:function(n,t){var i,r,u;if(this.popupWindow)if(this._delayHide=!1,n){if(i=this.map,n.spatialReference?(this.location=n,r=i.toScreen(n)):(this.location=i.toMap(n),r=n),u=i._getFrameWidth(),-1!==u&&(r.x%=u,0>r.x&&(r.x+=u),i.width>u))for(i=(i.width-u)/2;r.x<i;)r.x+=u;this._maximized?this.restore():this._setPosition(r);t&&t.closestFirst&&this.showClosestFirst(this.location);this.isShowing||(this._toggleVisibility(!0),this._followMap(),this.startupDijits(this._title),this.startupDijits(this._contentPane),this.reposition(),this.showHighlight(),this.onShow())}else this._toggleVisibility(!0)},hide:function(){this.isShowing&&(this._toggleVisibility(!1),this._unfollowMap(),this.keepHighlightOnHide||this.hideHighlight(),this.onHide())},resize:function(n,t){this.popupWindow&&(this._sizers.style({width:n+"px"}),y.set(this._contentPane,"maxHeight",t+"px"),this._maxHeight=t,this.isShowing&&this.reposition())},reposition:function(){this.popupWindow&&this.map&&this.location&&!this._maximized&&this.isShowing&&this._setPosition(this.map.toScreen(this.location))},maximize:function(){var t=this.map,n;if(t&&!this._maximized&&this.popupWindow){this._maximized=!0;n=this._maxButton;l.remove(n,"maximize");l.add(n,"restore");c.set(n,"title",this._nls.NLS_restore);var n=this.marginLeft,i=this.marginTop,r=t.width-2*n,t=t.height-2*i;y.set(this.domNode,{left:this._isRTL?null:n+"px",right:this._isRTL?n+"px":null,top:i+"px",bottom:null});y.set(this._positioner,{left:null,right:null,top:null,bottom:null});this._savedWidth=y.get(this._sizers[0],"width");this._savedHeight=y.get(this._contentPane,"maxHeight");this._sizers.style({width:r+"px"});y.set(this._contentPane,{maxHeight:t-65+"px",height:t-65+"px"});this._showPointer("");this._unfollowMap();l.add(this.domNode,"esriPopupMaximized");this.onMaximize()}},restore:function(){if(this.map&&this._maximized&&this.popupWindow){this._maximized=!1;var n=this._maxButton;l.remove(n,"restore");l.add(n,"maximize");c.set(n,"title",this._nls.NLS_maximize);y.set(this._contentPane,"height",null);this.resize(this._savedWidth,this._savedHeight);this._savedWidth=this._savedHeight=null;this.show(this.location);this._followMap();l.remove(this.domNode,"esriPopupMaximized");this.onRestore()}},startup:function(){},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._content);i.forEach(this._eventConnections,r.disconnect);a.destroy(this.domNode);this._sizers=this._contentPane=this._actionList=this._positioner=this._pointer=this._outerPointer=this._title=this._prevFeatureButton=this._nextFeatureButton=this._spinner=this._eventConnections=this._pagerScope=this._targetLocation=this._nls=this._maxButton=null},selectNext:function(){this.select(this.selectedIndex+1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},postscript:null,_highlightSetter:function(n){var i=this.highlight,t=this.map;this.highlight=n;t&&n!==i&&(n?(this.enableHighlight(t),n=this.features&&this.features[this.selectedIndex])&&(this.updateHighlight(t,n),this.showHighlight()):this.disableHighlight(t))},_pagingControlsSetter:function(n){var t=this.pagingControls,i=this.map;this.pagingControls=n;i&&n!==t&&this._updatePagingControls()},_pagingInfoSetter:function(n){var t=this.pagingInfo,i=this.map;this.pagingInfo=n;i&&n!==t&&this.features&&this.features.length&&this._updatePagingInfo()},_popupWindowSetter:function(n){var t=this.popupWindow,i=this.map;this.popupWindow=n;i&&n!==t&&(n?(this._updateUI(),this._updateWindow()):(this.hide(),this.showHighlight()))},_anchorSetter:function(n){var t=this.anchor;this.anchor=n;this.map&&n!==t&&this.reposition()},_featuresCleared:function(){this.setTitle("&nbsp;");this.setContent("&nbsp;");this._setPagerCallbacks(this);this._updateUI();this.hideHighlight()},_featureSelected:function(){this._updateUI();this._updateWindow()},_updateWindow:function(){var r=this.selectedIndex,n,i;0<=r&&(n=this.features[r].getContent(),!this.titleInBody&&n&&t.isString(n.id)&&(i=p.byId(n.id))&&i.set&&/_PopupRenderer/.test(i.declaredClass)&&i.set("showTitle",!1),this.setContent(n),this.updateHighlight(this.map,this.features[r]),this.showHighlight())},_toggleVisibility:function(n){this._setVisibility(n);this.isShowing=n},_setVisibility:function(n){l.toggle(this.domNode,"esriPopupVisible",n);l.toggle(this.domNode,"esriPopupHidden",!n)},_waitAndHide:function(n){var t=this;this._delayHide=!0;setTimeout(function(){t._delayHide&&(t._delayHide=!1,t.hide())},n)},_followMap:function(){this._unfollowMap();var n=this.map;this._handles=[r.connect(n,"onPanStart",this,this._onPanStart),r.connect(n,"onPan",this,this._onPan),r.connect(n,"onZoomStart",this,this._onZoomStart),r.connect(n,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var n=this._handles;n&&(i.forEach(n,r.disconnect),this._handles=null)},_onPanStart:function(){var n=this.domNode.style;this._panOrigin={left:n.left,top:n.top,right:n.right,bottom:n.bottom}},_onPan:function(n,t){var i=this._panOrigin,e=t.x,o=t.y,r=i.left,u=i.top,f=i.right,i=i.bottom;r&&(r=parseFloat(r)+e+"px");u&&(u=parseFloat(u)+o+"px");f&&(f=parseFloat(f)-e+"px");i&&(i=parseFloat(i)-o+"px");y.set(this.domNode,{left:r,top:u,right:f,bottom:i})},_onZoomStart:function(){this._setVisibility(!1)},_onExtentChange:function(n,t,i){i&&(this._setVisibility(!0),this.show(this._targetLocation||this.location));this._targetLocation=null},_toggleSize:function(){this._maximized?this.restore():this.maximize()},_setPosition:function(n){var f=n.x,nt=n.y;n=this.offsetX||0;var tt=this.offsetY||0,a=0,p=0,u=v.position(this.map.container,!0),w=u.w,b=u.h,i="Left",r="bottom",o=v.getContentBox(this._positioner),k=o.w/2,it=o.h/2,s=y.get(this._sizers[0],"height")+this._maxHeight+y.get(this._sizers[2],"height"),h=s/2,d=0,g=0,c=f,l=nt,t=this.anchor.toLowerCase();"auto"===t?((t=e.getBox)&&(t=t(),d=Math.max(t.l,u.x),w=Math.min(t.l+t.w,u.x+u.w),g=Math.max(t.t,u.y),b=Math.min(t.t+t.h,u.y+u.h),c+=u.x,l+=u.y),u=l-g>=s,s=b-l>=s,t=w-c>=o.w,o=c-d>=o.w,l-g>h&&b-l>=h&&(t?(r="",i="Left"):o&&(r="",i="Right")),i&&r&&c-d>k&&w-c>=k&&(u?(i="",r="bottom"):s&&(i="",r="top")),i&&r&&(t&&u?(i="Left",r="bottom"):t&&s?(i="Left",r="top"):o&&s?(i="Right",r="top"):o&&u&&(i="Right",r="bottom"))):(r=i="",-1!==t.indexOf("top")?r="bottom":-1!==t.indexOf("bottom")&&(r="top"),-1!==t.indexOf("left")?i="Right":-1!==t.indexOf("right")&&(i="Left"));h=r+i;switch(h){case"top":case"bottom":p=14;break;case"Left":case"Right":a=13;break;case"topLeft":case"topRight":case"bottomLeft":case"bottomRight":p=14;a=-16}y.set(this.domNode,{left:f+"px",top:nt+"px",right:null,bottom:null});f={left:null,right:null,top:null,bottom:null};i?f[i.toLowerCase()]=a+n+"px":f.left=-k+"px";r?f[r]=p+tt+"px":f.top=-it+"px";y.set(this._positioner,f);this._showPointer(h)},_showPointer:function(n){l.remove(this._pointer,"top bottom right left topLeft topRight bottomRight bottomLeft hidden".split(" "));l.remove(this._outerPointer,["right","left","hidden"]);"Right"===n||"Left"===n?(n=n.toLowerCase(),l.add(this._outerPointer,n)):l.add(this._pointer,n)},_setPagerCallbacks:function(n,t,i){if(this.pagingControls&&(n!==this||this._pagerScope&&this._pagerScope!==this)&&n!==this._pagerScope){this._pagerScope=n;n===this&&(t=this.selectPrevious,i=this.selectNext);var u=this._eventConnections;r.disconnect(u[1]);r.disconnect(u[2]);t&&(u[1]=r.connect(this._prevFeatureButton,"onclick",n,t));i&&(u[2]=r.connect(this._nextFeatureButton,"onclick",n,i))}},_getLocation:function(n){var t,i;if(n=n&&n.geometry)switch(n.type){case"point":t=n;break;case"multipoint":t=n.getPoint(0);i=nt.getDenormalizedExtent(n);break;case"polyline":case"polygon":t=n.getPoint(0,0);i=nt.getDenormalizedExtent(n)}return[t,i]},_zoomToFeature:function(n){var i,t;if(n.preventDefault(),i=this.features,t=this.selectedIndex,n=this.map,i)if(t=this._getLocation(i[t]),i=t[0],t=t[1],i||(i=this.location),t&&t.intersects(this.location)||(this.location=i),t&&t.getWidth()&&t.getHeight())n.setExtent(t,!0);else{var r=n.getNumLevels(),t=n.getLevel(),u=n.getMaxZoom(),f=this.zoomFactor||1;0<r?t!==u&&(r=t+f,r>u&&(r=u),n.navigationManager._wheelZoom({value:r-t,mapPoint:i},!0)):n.navigationManager._wheelZoom({value:2/Math.pow(2,f),mapPoint:i},!0)}},_updatePagingControls:function(){var n=this._prevFeatureButton,t=this._nextFeatureButton,i=this.selectedIndex,r=this.features?this.features.length:0;this.pagingControls&&1<r?(0===i?l.add(n,"hidden"):l.remove(n,"hidden"),i===r-1?l.add(t,"hidden"):l.remove(t,"hidden")):(l.add(n,"hidden"),l.add(t,"hidden"))},_updatePagingInfo:function(){var t=this.features?this.features.length:0,n=this._nls,i="&nbsp;";this.pagingInfo&&1<t&&n.NLS_pagingInfo&&(i=b.substitute({index:this.selectedIndex+1,total:t},n.NLS_pagingInfo));t&&(n=this.getSelectedFeature(),t=n.getInfoTemplate(),n=n.getTitle(),t&&!/esri\.InfoTemplate/.test(t.declaredClass)&&this.titleInBody||!n||(i=n+("&nbsp;"===i?"":" "+i)));this.setTitle(i)},_updateUI:function(){if(this.popupWindow){var n=this.features,t=this.deferreds,i=n?n.length:0,r=this._spinner,u=this._actionList,f=this._nls;this._updatePagingControls();this._updatePagingInfo();i?l.remove(u,"hidden"):l.add(u,"hidden");t&&t.length?n?l.remove(r,"hidden"):this.setContent("<div style='text-align: center;'>"+f.NLS_searching+"...<\/div>"):(l.add(r,"hidden"),i||(this.setContent("<div style='text-align: center;'>"+f.NLS_noInfo+".<\/div>"),this.visibleWhenEmpty||this._waitAndHide(this.hideDelay)))}}}),f("extend-esri")&&t.setObject("dijit.Popup",n,w),n})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),function(n,t,i,r,u,f,e){t.add("rtl-adjust-position-for-verticalScrollBar",function(n,t){var f=i.body(t),r=e.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},f,"last"),o=e.create("div",{style:{overflow:"hidden",direction:"ltr"}},r,"last"),s=0!=u.position(o).x;return r.removeChild(o),f.removeChild(r),s});t.add("position-fixed-support",function(n,t){var f=i.body(t),r=e.create("span",{style:{visibility:"hidden",position:"fixed",left:"1px",top:"1px"}},f,"last"),o=e.create("span",{style:{position:"fixed",left:"0",top:"0"}},r,"last"),s=u.position(o).x!=u.position(r).x;return r.removeChild(o),f.removeChild(r),s});var o={getBox:function(n){var r,f,e;return n=n||i.doc,r="BackCompat"==n.compatMode?i.body(n):n.documentElement,f=u.docScroll(n),t("touch")?(e=o.get(n),n=e.innerWidth||r.clientWidth,r=e.innerHeight||r.clientHeight):(n=r.clientWidth,r=r.clientHeight),{l:f.x,t:f.y,w:n,h:r}},get:function(n){if(t("ie")&&o!==document.parentWindow){n.parentWindow.execScript("document._parentWindow = window;","Javascript");var i=n._parentWindow;return n._parentWindow=null,i}return n.parentWindow||n.defaultView},scrollIntoView:function(n,e){var w,a,b;try{n=r.byId(n);var h=n.ownerDocument||i.doc,l=i.body(h),v=h.documentElement||l.parentNode,p=t("ie")||t("trident"),k=t("webkit");if(n!=l&&n!=v)if(!(t("mozilla")||p||k||t("opera")||t("trident")||t("edge"))&&"scrollIntoView"in n)n.scrollIntoView(!1);else{var tt="BackCompat"==h.compatMode,it=Math.min(l.clientWidth||v.clientWidth,v.clientWidth||l.clientWidth),rt=Math.min(l.clientHeight||v.clientHeight,v.clientHeight||l.clientHeight),h=k||tt?l:v,y=e||u.position(n),s=n.parentNode,k=function(n){return 6>=p||7==p&&tt?!1:t("position-fixed-support")&&"fixed"==f.get(n,"position").toLowerCase()},ht=this,ft=function(n,t,i){"BODY"==n.tagName||"HTML"==n.tagName?ht.get(n.ownerDocument).scrollBy(t,i):(t&&(n.scrollLeft+=t),i&&(n.scrollTop+=i))};if(!k(n))for(;s;){s==l&&(s=h);var o=u.position(s),et=k(s),ut="rtl"==f.getComputedStyle(s).direction.toLowerCase();s==h?(o.w=it,o.h=rt,h==v&&(p||t("trident"))&&ut&&(o.x+=h.offsetWidth-o.w),o.x=0,o.y=0):(w=u.getPadBorderExtents(s),o.w-=w.w,o.h-=w.h,o.x+=w.l,o.y+=w.t,a=s.clientWidth,b=o.w-a,0<a&&0<b&&(ut&&t("rtl-adjust-position-for-verticalScrollBar")&&(o.x+=b),o.w=a),a=s.clientHeight,b=o.h-a,0<a&&0<b&&(o.h=a));et&&(0>o.y&&(o.h+=o.y,o.y=0),0>o.x&&(o.w+=o.x,o.x=0),o.y+o.h>rt&&(o.h=rt-o.y),o.x+o.w>it&&(o.w=it-o.x));var d=y.x-o.x,g=y.y-o.y,ot=d+y.w-o.w,st=g+y.h-o.h,c,nt;0<ot*d&&(s.scrollLeft||s==h||s.scrollWidth>s.offsetHeight)&&(c=Math[0>d?"max":"min"](d,ot),ut&&(8==p&&!tt||5<=t("trident"))&&(c=-c),nt=s.scrollLeft,ft(s,c,0),c=s.scrollLeft-nt,y.x-=c);0<st*g&&(s.scrollTop||s==h||s.scrollHeight>s.offsetHeight)&&(c=Math.ceil(Math[0>g?"max":"min"](g,st)),nt=s.scrollTop,ft(s,0,c),c=s.scrollTop-nt,y.y-=c);s=s!=h&&!et&&s.parentNode}}}catch(ct){console.error("scrollIntoView: "+ct);n.scrollIntoView(!1)}}};return n.setObject("dojo.window",o),o})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(n,t,i,r){return n("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(n){var t=this._attrPairNames;return t[n]?t[n]:t[n]={s:"_"+n+"Setter",g:"_"+n+"Getter"}},postscript:function(n){n&&this.set(n)},_get:function(n,t){return"function"==typeof this[t.g]?this[t.g]():this[n]},get:function(n){return this._get(n,this._getAttrNames(n))},set:function(n,t){var i,u,f,e;if("object"==typeof n){for(i in n)n.hasOwnProperty(i)&&"_watchCallbacks"!=i&&this.set(i,n[i]);return this}return i=this._getAttrNames(n),u=this._get(n,i),i=this[i.s],"function"==typeof i?f=i.apply(this,Array.prototype.slice.call(arguments,1)):this[n]=t,this._watchCallbacks&&(e=this,r(f,function(){e._watchCallbacks(n,u,t)})),this},_changeAttrValue:function(n,t){var i=this.get(n);return this[n]=t,this._watchCallbacks&&this._watchCallbacks(n,i,t),this},watch:function(n,t){var r=this._watchCallbacks,e,u,f;return r||(e=this,r=this._watchCallbacks=function(n,t,i,u){var f=function(r){if(r){r=r.slice();for(var u=0,f=r.length;u<f;u++)r[u].call(e,n,t,i)}};f(r["_"+n]);u||f(r["*"])}),t||"function"!=typeof n?n="_"+n:(t=n,n="*"),u=r[n],"object"!=typeof u&&(u=r[n]=[]),u.push(t),f={},f.unwatch=f.remove=function(){var n=i.indexOf(u,t);-1<n&&u.splice(n,1)},f}})})},"esri/geometry/normalizeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/has ../kernel ../config ../deferredUtils ./Extent ./Polyline ./Polygon ./webMercatorUtils ./jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){function a(n,t){return Math.ceil((n-t)/(2*t))}function y(n,t){for(var u=n.paths||n.rings,r,o=u.length,f,e,i=0;i<o;i++)for(f=u[i].length,r=0;r<f;r++)e=n.getPoint(i,r),n.setPoint(i,r,e.offset(t,0));return n}function b(t,i){if(!(t instanceof s||t instanceof h))throw console.error("_straightLineDensify: the input geometry is neither polyline nor polygon"),Error("_straightLineDensify: the input geometry is neither polyline nor polygon");var f=t instanceof s,u=[],r;return n.forEach(f?t.paths:t.rings,function(n){u.push(r=[]);r.push([n[0][0],n[0][1]]);for(var o,s,h,c,f,l,y,p,a,v,e,t=0;t<n.length-1;t++){if(o=n[t][0],s=n[t][1],h=n[t+1][0],c=n[t+1][1],l=Math.sqrt((h-o)*(h-o)+(c-s)*(c-s)),y=(c-s)/l,p=(h-o)/l,a=l/i,1<a){for(f=1;f<=a-1;f++)e=f*i,v=p*e+o,e=y*e+s,r.push([v,e]);f=(l+Math.floor(a-1)*i)/2;v=p*f+o;e=y*f+s;r.push([v,e])}r.push([h,c])}}),f?new s({paths:u,spatialReference:t.spatialReference}):new h({rings:u,spatialReference:t.spatialReference})}function p(n,t,i){return t&&(n=b(n,1e6),n=c.webMercatorToGeographic(n,!0)),i&&(n=y(n,i)),n}function w(n,t,i){var r=n.x||n[0],u;return r>t?(u=a(r,t),n.x?n=n.offset(-2*u*t,0):n[0]=r+-2*u*t):r<i&&(u=a(r,i),n.x?n=n.offset(-2*u*i,0):n[0]=r+-2*u*i),n}function k(t,i){var r=-1;return n.forEach(i.cutIndexes,function(u,f){var e=i.geometries[f];n.forEach(e.rings||e.paths,function(t,i){n.some(t,function(n){if(!(180>n[0])){n=0;for(var f=t.length,u,r=0;r<f;r++)u=t[r][0],n=u>n?u:n;for(n=Number(n.toFixed(9)),n=-360*a(n,180),f=t.length,r=0;r<f;r++)u=e.getPoint(i,r),e.setPoint(i,r,u.offset(n,0))}return!0})});u===r?e.rings?n.forEach(e.rings,function(n){t[u]=t[u].addRing(n)}):n.forEach(e.paths,function(n){t[u]=t[u].addPath(n)}):(r=u,t[u]=e)}),t}function d(t,r,u,e){var d=new i,rt,ht,et;d.addCallbacks(u,e);r=r||f.defaults.geometryService;var o=[],g=[],it,ut,nt,v,b,ft,ot,st,tt=0;for(n.forEach(t,function(t){if(t)if(it||(it=t.spatialReference,ut=it._getInfo(),v=(nt=it._isWebMercator())?20037508.342788905:180,b=nt?-20037508.342788905:-180,ft=nt?102100:4326,ot=new s({paths:[[[v,b],[v,v]]],spatialReference:{wkid:ft}}),st=new s({paths:[[[b,b],[b,v]]],spatialReference:{wkid:ft}})),ut){var i=l.fromJson(t.toJson()),r=t.getExtent();"point"===t.type?o.push(w(i,v,b)):"multipoint"===t.type?(i.points=n.map(i.points,function(n){return w(n,v,b)}),o.push(i)):"extent"===t.type?(i=r._normalize(null,null,ut),o.push(i.rings?new h(i):i)):r?(t=2*a(r.xmin,b)*v,i=0===t?i:y(i,t),r=r.offset(t,0),r.intersects(ot)&&r.xmax!==v?(tt=r.xmax>tt?r.xmax:tt,i=p(i,nt),g.push(i),o.push("cut")):r.intersects(st)&&r.xmin!==b?(tt=2*r.xmax*v>tt?2*r.xmax*v:tt,i=p(i,nt,360),g.push(i),o.push("cut")):o.push(i)):o.push(i)}else o.push(t);else o.push(t)}),u=new s,e=a(tt,v),rt=-90,ht=e;0<e;)et=-180+360*e,u.addPath([[et,rt],[et,-1*rt]]),rt*=-1,e--;return 0<g.length&&0<ht?r?r.cut(g,u,function(i){g=k(g,i);var u=[];n.forEach(o,function(n,i){if("cut"===n){var r=g.shift();t[i].rings&&1<t[i].rings.length&&r.rings.length>=t[i].rings.length?(o[i]="simplify",u.push(r)):o[i]=!0===nt?c.geographicToWebMercator(r):r}});0<u.length?r.simplify(u,function(t){n.forEach(o,function(n,i){"simplify"===n&&(o[i]=!0===nt?c.geographicToWebMercator(t.shift()):t.shift())});d.callback(o)},function(n){d.errback(n)}):d.callback(o)},function(n){d.errback(n)}):d.errback(Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing.")):(n.forEach(o,function(n,t){if("cut"===n){var i=g.shift();o[t]=!0===nt?c.geographicToWebMercator(i):i}}),d.callback(o)),d}function v(i,r,u,f){var o=!1,e;t.isObject(i)&&i&&(t.isArray(i)?i.length&&((e=i[0]&&i[0].declaredClass)&&-1!==e.indexOf("Graphic")?(i=n.map(i,function(n){return n.geometry}),o=i.length?!0:!1):e&&-1!==e.indexOf("esri.geometry.")&&(o=!0)):(e=i.declaredClass)&&-1!==e.indexOf("FeatureSet")?(i=n.map(i.features||[],function(n){return n.geometry}),o=i.length?!0:!1):e&&-1!==e.indexOf("esri.geometry.")&&(o=!0));o&&r.push({index:u,property:f,value:i})}function g(i,r){var u=[];return n.forEach(r,function(r){var e=r.i,f=i[e],o;if(r=r.p,t.isObject(f)&&f)if(r)if("*"===r[0])for(o in f)f.hasOwnProperty(o)&&v(f[o],u,e,o);else n.forEach(r,function(n){v(t.getObject(n,!1,f),u,e,n)});else v(f,u,e)}),u}function nt(i,r){var f=0,u={};return n.forEach(r,function(n){var r=n.index,o=n.property,s=n.value,h=s.length||1,e=i.slice(f,f+h);t.isArray(s)||(e=e[0]);f+=h;delete n.value;o?(u[r]=u[r]||{},u[r][o]=e):u[r]=e}),u}function tt(n){for(var f=[],i=0,r=0,s=Math.min,h=Math.max,e=0;e<n.length;e++){for(var o=n[e],t=null,u=0;u<o.length;u++)t=o[u],f.push(t),0===u?r=i=t[0]:(i=s(i,t[0]),r=h(r,t[0]));t&&f.push([(i+r)/2,0])}return f}var it={normalizeCentralMeridian:d,_foldCutResults:k,_prepareGeometryForCut:p,_offsetMagnitude:a,_pointNormalization:w,_updatePolyGeometry:y,_straightLineDensify:b,_createWrappers:function(r){var u=t.isObject(r)?r.prototype:t.getObject(r+".prototype");n.forEach(u.__msigns,function(t){var r=u[t.n];u[t.n]=function(){var f=this,o=[],s,u=new i(e._dfdCanceller),l,a,h,c;for(t.f&&e._fixDfd(u),s=0;s<t.c;s++)o[s]=arguments[s];return l={dfd:u},o.push(l),h=[],f.normalization&&!f._isTable&&(a=g(o,t.a),n.forEach(a,function(n){h=h.concat(n.value)}),h.length&&(c=d(h))),c?(u._pendingDfd=c,c.addCallbacks(function(n){u.canceled||(l.assembly=nt(n,a),u._pendingDfd=r.apply(f,o))},function(n){var i=f.declaredClass;i&&-1!==i.indexOf("FeatureLayer")?f._resolve([n],null,o[t.e],u,!0):f._errorHandler(n,o[t.e],u)})):u._pendingDfd=r.apply(f,o),u}})},_disassemble:g,_addToBucket:v,_reassemble:nt,getDenormalizedExtent:function(n){var t,i,f,u;if(!n||(t=n.getExtent(),!t))return null;if(i=n.spatialReference&&n.spatialReference._getInfo(),!i)return t;var l=i.valid[0],i=i.valid[1],r=2*i,e=t.getWidth(),s=t.xmax,h=t.xmin;if("extent"===n.type||0===e||e<=i||e>r||s<l||h>i)return t;switch(n.type){case"polygon":if(1<n.rings.length)f=tt(n.rings);else return t;break;case"polyline":if(1<n.paths.length)f=tt(n.paths);else return t;break;case"multipoint":f=n.points}n=Math.min;for(var l=Math.max,r=new o(t.toJson()),c=0;c<f.length;c++)u=f[c][0],0>u?(u+=i,h=l(u,h)):(u-=i,s=n(u,s));return r.xmin=s,r.xmax=h,r.getWidth()<e?(r.xmin-=i,r.xmax-=i,r):t}};return r("extend-esri")&&t.mixin(t.getObject("geometry",!0,u),it),it})},"esri/geometry/jsonUtils":function(){define("dojo/_base/lang dojo/has ../kernel ./Point ./Polyline ./Polygon ./Multipoint ./Extent".split(" "),function(n,t,i,r,u,f,e,o){var s={fromJson:function(n){return void 0!==n.x&&void 0!==n.y?new r(n):void 0!==n.paths?new u(n):void 0!==n.rings?new f(n):void 0!==n.points?new e(n):void 0!==n.xmin&&void 0!==n.ymin&&void 0!==n.xmax&&void 0!==n.ymax?new o(n):void 0},getJsonType:function(n){return n instanceof r?"esriGeometryPoint":n instanceof u?"esriGeometryPolyline":n instanceof f?"esriGeometryPolygon":n instanceof o?"esriGeometryEnvelope":n instanceof e?"esriGeometryMultipoint":null},getGeometryType:function(n){return"esriGeometryPoint"===n?r:"esriGeometryPolyline"===n?u:"esriGeometryPolygon"===n?f:"esriGeometryEnvelope"===n?o:"esriGeometryMultipoint"===n?e:null}};return t("extend-esri")&&n.mixin(n.getObject("geometry",!0,i),s),s})},"esri/InfoWindowBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/dom-construct dojo/has dijit/registry ./kernel ./lang ./geometry/ScreenPoint".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.InfoWindowBase",constructor:function(){var n=t.hitch;this.__set_title=n(this,this.__set_title);this.__err_title=n(this,this.__err_title);this.__set_content=n(this,this.__set_content);this.__err_content=n(this,this.__err_content)},setMap:function(n){this.map=n},unsetMap:function(){delete this.map},setTitle:function(){},setContent:function(){},show:function(){},hide:function(){},resize:function(){},onShow:function(){},onHide:function(){},place:function(n,i){h.isDefined(n)?t.isObject(n)?f.place(n,i,"only"):i.innerHTML=n:i.innerHTML=""},startupDijits:function(n){this._processDijits(n)},destroyDijits:function(n){this._processDijits(n,!0)},_processDijits:function(n,t){var u,r;n&&1===n.children.length&&(r=n.children[0],r&&(u=o.byNode(r),r=u?[u]:o.findWidgets(r),i.forEach(r,function(n){if(t){if(n._started&&!n._destroyed)try{n.destroyRecursive?n.destroyRecursive():n.destroy&&n.destroy()}catch(i){console.debug("An error occurred when destroying a widget embedded within InfoWindow: "+i.message)}}else if(!n._started)try{n.startup()}catch(i){console.debug("An error occurred when starting a widget embedded within InfoWindow: "+i.message)}})))},__registerMapListeners:function(){this.__unregisterMapListeners();var n=this.map;this.__handles=[r.connect(n,"onPan",this,this.__onMapPan),r.connect(n,"onZoomStart",this,this.__onMapZmStart),r.connect(n,"onExtentChange",this,this.__onMapExtChg)]},__unregisterMapListeners:function(){var n=this.__handles;n&&(i.forEach(n,r.disconnect,r),this.__handles=null)},__onMapPan:function(n,t){this.move(t,!0)},__onMapZmStart:function(){this.__mcoords=this.mapCoords||this.map.toMap(new c(this.coords));this.hide(null,!0)},__onMapExtChg:function(n,t,i){n=this.map;var r=this.mapCoords;r?this.show(r,null,!0):(t=i?n.toScreen(this.__mcoords):this.coords.offset(t&&t.x||0,t&&t.y||0),this.show(t,null,!0))},__setValue:function(n,t){this[n].innerHTML="";var i="_dfd"+n,r=this[i];r&&-1===r.fired&&(r.cancel(),this[i]=null);h.isDefined(t)&&(t instanceof u?(this[i]=t,t.addCallbacks(this["__set"+n],this["__err"+n])):this.__render(n,t))},__set_title:function(n){this._dfd_title=null;this.__render("_title",n)},__err_title:function(){this._dfd_title=null},__set_content:function(n){this._dfd_content=null;this.__render("_content",n)},__err_content:function(){this._dfd_content=null},__render:function(n,t){var i=this[n];this.place(t,i);this.isShowing&&(this.startupDijits(i),"_title"===n&&this._adjustContentArea&&this._adjustContentArea())}}),e("extend-esri")&&(s.InfoWindowBase=n),n})},"esri/PopupBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has ./kernel ./graphic ./geometry/Point ./geometry/jsonUtils ./geometry/mathUtils ./geometry/webMercatorUtils ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./symbols/CartographicLineSymbol ./symbols/SimpleFillSymbol ./tasks/query ./Evented".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function k(n){return"sizeInfo"===n.type}return n=n(b,{declaredClass:"esri.PopupBase",_featureLayers:{},_updateEndHandles:[],_evtMap:{"set-features":!0,"clear-features":!0,"selection-change":!0,"dfd-complete":!0},onSetFeatures:function(){},onClearFeatures:function(){},onSelectionChange:function(){},onDfdComplete:function(){},initialize:function(){this.count=0;this.selectedIndex=-1;this.on("clear-features",t.hitch(this,this._resetUpdateEndListeners));this.on("dfd-complete",t.hitch(this,this._processFeatures));this.on("set-features",t.hitch(this,this._processFeatures))},cleanup:function(){this.features=this.deferreds=null;this._resetUpdateEndListeners()},setFeatures:function(n){if(n&&n.length){this.clearFeatures();var f,r;n[0]instanceof u?r=n:f=n;f?this._updateFeatures(null,f):(this.deferreds=r,r=r.slice(0),i.forEach(r,function(n){n.addBoth(t.hitch(this,this._updateFeatures,n))},this))}},clearFeatures:function(){this.features=this.deferreds=this._marked=null;this.count=0;var n=this.selectedIndex;this.selectedIndex=-1;-1<n&&this.onSelectionChange();this.onClearFeatures()},getSelectedFeature:function(){var n=this.features;if(n)return n[this.selectedIndex]},select:function(n){0>n||n>=this.count||(this.selectedIndex=n,this.onSelectionChange())},enableHighlight:function(n){this._highlighted=n.graphics.add(new o(new s(0,0,n.spatialReference)));this._highlighted.hide();this.markerSymbol||(n=this.markerSymbol=new a,n.setStyle(a.STYLE_TARGET),n._setDim(16,16,0),n.setOutline(new y(v.STYLE_SOLID,new r([0,255,255]),2,y.CAP_ROUND,y.JOIN_ROUND)),n.setColor(new r([0,0,0,0])));this.lineSymbol||(this.lineSymbol=new v(v.STYLE_SOLID,new r([0,255,255]),2));this.fillSymbol||(this.fillSymbol=new p(p.STYLE_NULL,new v(v.STYLE_SOLID,new r([0,255,255]),2),new r([0,0,0,0])))},disableHighlight:function(n){var t=this._highlighted;t&&(t.hide(),n.graphics.remove(t),delete this._highlighted);this.markerSymbol=this.lineSymbol=this.fillSymbol=null},showHighlight:function(){var n=this.features&&this.features[this.selectedIndex];this._highlighted&&n&&n.geometry&&this._highlighted.show()},hideHighlight:function(){this._highlighted&&this._highlighted.hide()},updateHighlight:function(n,t){var i=t.geometry,u=this._highlighted,r,f;if(i&&u){u.hide();!u._graphicsLayer&&n&&n.graphics.add(u);u.setGeometry(h.fromJson(i.toJson()));switch(i.type){case"point":case"multipoint":if(f=t.getLayer(),i=t.symbol||f&&f._getSymbol(t),f&&i){var e,o,s=0,c=0,l=0;if(r=t.symbol?null:f._getRenderer(t),f=this._getSizeInfo(r))e=o=r.getSize(t,{sizeInfo:f,shape:i.style,resolution:n&&n.getResolutionInMeters&&n.getResolutionInMeters()});else switch(i.type){case"simplemarkersymbol":e=o=i.size||0;break;case"picturemarkersymbol":e=i.width||0;o=i.height||0}s=i.xoffset||0;c=i.yoffset||0;l=i.angle||0;r=this.markerSymbol;r.setOffset(0,0);r.setAngle(0);e&&o&&r._setDim(e+1,o+1,0);r.setOffset(s,c);r.setAngle(l)}break;case"polyline":r=this.lineSymbol;break;case"polygon":r=this.fillSymbol}u.setSymbol(r)}else u&&u.hide()},showClosestFirst:function(n){var t=this.features;if(t&&t.length){if(1<t.length){var r,h=Infinity,s=-1,u,a=c.getLength,f,e=n.spatialReference,o,i;for(n=n.normalize(),r=t.length-1;0<=r;r--)if(u=t[r].geometry){o=u.spatialReference;f=0;try{i="point"===u.type?u:u.getExtent().getCenter();i=i.normalize();e&&o&&!e.equals(o)&&e._canProject(o)&&(i=e.isWebMercator()?l.geographicToWebMercator(i):l.webMercatorToGeographic(i));f=a(n,i)}catch(v){}0<f&&f<h&&(h=f,s=r)}0<s&&(t.splice(0,0,t.splice(s,1)[0]),this.select(0))}}else this.deferreds&&(this._marked=n)},_unbind:function(n){return n=i.indexOf(this.deferreds,n),-1!==n?(this.deferreds.splice(n,1),this.deferreds.length?1:(this.deferreds=null,2)):void 0},_fireComplete:function(n){var t=this._marked;t&&(this._marked=null,this.showClosestFirst(t));this.onDfdComplete(n)},_updateFeatures:function(n,t){var r,u;n?this.deferreds&&(r=this._unbind(n),r&&(t&&t instanceof Error?(this._fireComplete(t),2===r)&&this.onSetFeatures():t&&t.length?this.features?(u=i.filter(t,function(n){return-1===i.indexOf(this.features,n)},this),this.features=this.features.concat(u),this.count=this.features.length,this._fireComplete(),2===r&&this.onSetFeatures()):(this.features=t,this.count=t.length,this.selectedIndex=0,this._fireComplete(),2===r&&this.onSetFeatures(),this.select(0)):(this._fireComplete(),2===r)&&this.onSetFeatures())):(this.features=t,this.count=t.length,this.selectedIndex=0,this.onSetFeatures(),this.select(0))},_getSizeInfo:function(n){return n?n.sizeInfo||i.filter(n.visualVariables,k)[0]:null},_resetUpdateEndListeners:function(){this._featureLayers={};i.forEach(this._updateEndHandles,function(n){n.remove()});this._updateEndHandles=[]},_processFeatures:function(){i.forEach(this.features,function(n){(n=n.getLayer())&&!this._featureLayers[n.id]&&(1===n.currentMode||0===n.currentMode&&6===n.mode)&&n.objectIdField&&n.hasXYFootprint&&n.queryFeatures&&("esriGeometryPolygon"===n.geometryType||"esriGeometryPolyline"===n.geometryType||n.hasXYFootprint())&&(this._featureLayers[n.id]=n,n=n.on("update-end",t.hitch(this,this._fLyrUpdateEndHandler)),this._updateEndHandles.push(n))},this)},_fLyrUpdateEndHandler:function(n){if(!n.error){var e=this,t=n.target,u=t.getSelectedFeatures(),o=0===t.currentMode&&6===t.mode,f={},r=[];i.forEach(this.features,function(n){if(n.getLayer()===t){var i=n.attributes[t.objectIdField];f[i]=n;r.push(i)}});r.length&&(n=new w,n.objectIds=r,t.queryFeatures(n,function(n){i.forEach(n.features,function(n){var r=f[n.attributes[t.objectIdField]],e=!1;r.geometry!==n.geometry?(r.setGeometry(n.geometry),e=!0):o&&u&&-1!==i.indexOf(u,n)&&(e=!0);e&&this._highlighted&&r===this.getSelectedFeature()&&this._highlighted.setGeometry(n.geometry)},e)}))}}}),f("extend-esri")&&(e.PopupBase=n),n})},"esri/graphic":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./domUtils ./lang ./InfoTemplate ./geometry/jsonUtils ./symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(null,{declaredClass:"esri.Graphic",constructor:function(n,t,i,r){n&&!n.declaredClass?(this.geometry=n.geometry?o.fromJson(n.geometry):null,this.symbol=n.symbol?s.fromJson(n.symbol):null,this.attributes=n.attributes||null,this.infoTemplate=n.infoTemplate?new e(n.infoTemplate):null):(this.geometry=n,this.symbol=t,this.attributes=i,this.infoTemplate=r)},_shape:null,_graphicsLayer:null,_visible:!0,visible:!0,getDojoShape:function(){return this._shape},getShapes:function(){var n=[];return this._shape&&n.push(this._shape),this._bgShape&&n.push(this._bgShape),n},getNode:function(){var n=this._shape&&this._shape.getNode();return n&&n.nodeType?n:null},getNodes:function(){for(var t=this.getShapes(),i,u=t.length,r=[],n=0;n<u;n++)(i=t[n]&&t[n].getNode())&&i.nodeType&&r.push(i);return r},getLayer:function(){return this._layer},getSourceLayer:function(){return this._sourceLayer||this._layer},draw:function(){var n=this._graphicsLayer;return n&&n._draw(this,!0),this},setGeometry:function(n){this.geometry=n;var t=this._graphicsLayer;return t&&(t._updateExtent(this),t._draw(this,!0),n&&"polyline"===n.type&&t._updateSVGMarkers()),this},setSymbol:function(n,t){var i=this._graphicsLayer,r=this._shape;return this.symbol=n,i&&(t&&r&&i._removeShape(this),i._draw(this,!0)),this},setAttributes:function(n){return this.attributes=n,this._clearCache(),this},setInfoTemplate:function(n){return this.infoTemplate=n,this},getInfoTemplate:function(){return this._getEffInfoTemplate()},_getEffInfoTemplate:function(){var n=this.getLayer();return this.infoTemplate||n&&n.infoTemplate},getTitle:function(){var i=this.getInfoTemplate(),n=i&&i.title,r;return t.isFunction(n)?n=n.call(i,this):t.isString(n)&&(r=(i=this.getLayer())&&i._getDateOpts,n=f.substitute(this.attributes,n,{first:!0,dateFormat:r&&r.call(i)})),n},getContent:function(){var i=this.getInfoTemplate(),n=i&&i.content,r;return t.isFunction(n)?n=n.call(i,this):t.isString(n)&&(r=(i=this.getLayer())&&i._getDateOpts,n=f.substitute(this.attributes,n,{dateFormat:r&&r.call(i)})),n},attr:function(n,t){for(var r=this.getNodes(),u=r.length,i=0;i<u;i++)null==t?r[i].removeAttribute(n):r[i].setAttribute(n,t);return this},show:function(){this.visible=this._visible=!0;var t,n,i;if(this.getShapes().length)for(t=this.getNodes(),i=t.length,this.attr("data-hidden"),n=0;n<i;n++)u.show(t[n]);else this._graphicsLayer&&this._graphicsLayer._draw(this,!0);return this},hide:function(){this.visible=this._visible=!1;var n=this._graphicsLayer,t,i;if(n)if("canvas-2d"===n.surfaceType)n._removeShape(this);else if(n=this.getNodes(),i=n.length)for(this.attr("data-hidden",""),t=0;t<i;t++)u.hide(n[t]);return this},toJson:function(){var n={};return this.geometry&&(n.geometry=this.geometry.toJson()),this.attributes&&(n.attributes=t.mixin({},this.attributes)),this.symbol&&(n.symbol=this.symbol.toJson()),this.infoTemplate&&(n.infoTemplate=this.infoTemplate.toJson()),n},_getViewInfo:function(n){return(n=(n=n||this.getLayer())&&n.getMap())&&n._getViewInfo()},_getDataValue:function(n,i,r,u){var o=this._getCacheItem(n,i);if(void 0===o.value){var f=null,e=this.attributes,s=n.field;i.hasExpr?f=r.executeFunction(i.compiledFunc,r.createExecContext(this,this._getViewInfo(u))):t.isFunction(s)?f=s(this,n):e&&(f=e[s],(n=n.normalizationField)&&this._isValidNumber(f)&&(e=parseFloat(e[n]),f=this._isValidNumber(e)&&0!==e?f/e:null));this._isValidNumber(f)||(f=null);o.value=f}return o.value},_isValidNumber:function(n){return"number"==typeof n&&!isNaN(n)&&Infinity!==n&&-Infinity!==n},_getCacheItem:function(n,t){var i=this._findCacheItem(n);return i?i.version!==t.version&&(i.version=t.version,i.value=void 0):i=this._createCacheItem(n,t),i},_findCacheItem:function(n){var u,i=this._cache,t,f,r;if(i)for(f=i.length,t=0;t<f;t++)if(r=i[t],r.variable===n){u=r;break}return u},_createCacheItem:function(n,t){var i=this._cache,r;return i||(i=this._cache=[]),r={variable:n,version:t.version,value:void 0},i.push(r),r},_clearCache:function(){this._cache=null}}),n.prototype.getShape=n.prototype.getDojoShape,i("extend-esri")&&(r.Graphic=n),n})},"esri/InfoTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./kernel","./lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.InfoTemplate",constructor:function(n,i){n&&t.isObject(n)&&!t.isFunction(n)?t.mixin(this,n):(this.title=n||"${*}",this.content=i||"${*}")},setTitle:function(n){return this.title=n,this},setContent:function(n){return this.content=n,this},toJson:function(){return u.fixJson({title:this.title,content:this.content})}}),i("extend-esri")&&(r.InfoTemplate=n),n})},"esri/symbols/jsonUtils":function(){define("dojo/_base/lang dojo/has ../kernel ./SimpleMarkerSymbol ./PictureMarkerSymbol ./SimpleLineSymbol ./CartographicLineSymbol ./SimpleFillSymbol ./PictureFillSymbol ./TextSymbol".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c={fromJson:function(n){var t=null;switch(n.type){case"esriSMS":t=new r(n);break;case"esriPMS":t=new u(n);break;case"esriTS":t=new h(n);break;case"esriSLS":t=void 0!==n.cap?new e(n):new f(n);break;case"esriCLS":t=new e(n);break;case"esriSFS":t=new o(n);break;case"esriPFS":t=new s(n)}return t},getShapeDescriptors:function(n){return n&&n.getShapeDescriptors?n.getShapeDescriptors():{defaultShape:null,fill:null,stroke:null}}};return t("extend-esri")&&n.mixin(n.getObject("symbol",!0,i),c),c})},"esri/symbols/PictureMarkerSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/sniff dojox/gfx/_base ../kernel ../lang ../urlUtils ./MarkerSymbol".split(" "),function(n,t,i,r,u,f,e,o){var s={url:"",width:12,height:12,angle:0,xoffset:0,yoffset:0};return n=n(o,{declaredClass:"esri.symbol.PictureMarkerSymbol",type:"picturemarkersymbol",constructor:function(n,u,f){n?t.isString(n)?(this.url=n,u&&(this.width=u),f&&(this.height=f)):(this.width=r.pt2px(n.width),this.height=r.pt2px(n.height),u=n.imageData,9>i("ie")||!u||(f=this.url,this.url="data:"+(n.contentType||"image")+";base64,"+u,this.imageData=f)):(t.mixin(this,s),this.width=r.pt2px(this.width),this.height=r.pt2px(this.height))},getStroke:function(){return null},getFill:function(){return null},setWidth:function(n){return this.width=n,this},setHeight:function(n){return this.height=n,this},setUrl:function(n){return n!==this.url&&(delete this.imageData,delete this.contentType),this.url=n,this},getShapeDescriptors:function(){return{defaultShape:{type:"image",x:-Math.round(this.width/2),y:-Math.round(this.height/2),width:this.width,height:this.height,src:this.url||""},fill:null,stroke:null}},toJson:function(){var n=this.url,u=this.imageData;if(0===n.indexOf("data:"))var i=n,n=u,u=i.indexOf(";base64,")+8,u=i.substr(u);t.isString(n)&&(0===n.indexOf("/")||0===n.indexOf("//")||0===n.indexOf("./")||0===n.indexOf("../"))&&(n=e.getAbsoluteUrl(n));var i=r.px2pt(this.width),i=isNaN(i)?void 0:i,o=r.px2pt(this.height),o=isNaN(o)?void 0:o,n=f.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriPMS",url:n,imageData:u,contentType:this.contentType,width:i,height:o}));return delete n.color,delete n.size,n.imageData||delete n.imageData,n}}),n.defaultProps=s,i("extend-esri")&&(t.setObject("symbol.PictureMarkerSymbol",n,u),u.symbol.defaultPictureMarkerSymbol=s),n})},"esri/symbols/CartographicLineSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base ../kernel ../lang ./SimpleLineSymbol".split(" "),function(n,t,i,r,u,f,e,o){var s={STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dashdot",STYLE_DASHDOTDOT:"longdashdotdot",STYLE_NULL:"none",STYLE_INSIDE_FRAME:"insideframe",STYLE_SHORTDASH:"shortdash",STYLE_SHORTDOT:"shortdot",STYLE_SHORTDASHDOT:"shortdashdot",STYLE_SHORTDASHDOTDOT:"shortdashdotdot",STYLE_LONGDASH:"longdash",STYLE_LONGDASHDOT:"longdashdot",CAP_BUTT:"butt",CAP_ROUND:"round",CAP_SQUARE:"square",JOIN_MITER:"miter",JOIN_ROUND:"round",JOIN_BEVEL:"bevel"},h={color:[0,0,0,1],style:s.STYLE_SOLID,width:1,cap:s.CAP_BUTT,join:s.JOIN_MITER,miterLimit:10};return n=n(o,{declaredClass:"esri.symbol.CartographicLineSymbol",type:"cartographiclinesymbol",_caps:{butt:"esriLCSButt",round:"esriLCSRound",square:"esriLCSSquare"},_joins:{miter:"esriLJSMiter",round:"esriLJSRound",bevel:"esriLJSBevel"},constructor:function(n,r,f,o,s,c){n?t.isString(n)?(this.style=n,r&&(this.color=r),void 0!==f&&(this.width=f),o&&(this.cap=o),s&&(this.join=s),void 0!==c&&(this.miterLimit=c)):(this.cap=e.valueOf(this._caps,n.cap),this.join=e.valueOf(this._joins,n.join),this.width=u.pt2px(n.width),this.miterLimit=u.pt2px(n.miterLimit)):(t.mixin(this,h),this.color=new i(this.color),this.width=u.pt2px(this.width),this.miterLimit=u.pt2px(this.miterLimit))},setCap:function(n){return this.cap=n,this},setJoin:function(n){return this.join=n,this},setMiterLimit:function(n){return this.miterLimit=n,this},getStroke:function(){return t.mixin(this.inherited("getStroke",arguments),{cap:this.cap,join:this.join===s.JOIN_MITER?this.miterLimit:this.join})},getFill:function(){return null},getShapeDescriptors:function(){return{defaultShape:{type:"path",path:"M -15,0 L 15,0 E"},fill:null,stroke:this.getStroke()}},toJson:function(){var n=u.px2pt(this.miterLimit),n=isNaN(n)?void 0:n;return e.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriCLS",cap:this._caps[this.cap],join:this._joins[this.join],miterLimit:n}))}}),t.mixin(n,s),n.defaultProps=h,r("extend-esri")&&(t.setObject("symbol.CartographicLineSymbol",n,f),f.symbol.defaultCartographicLineSymbol=h),n})},"esri/symbols/SimpleFillSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base ../kernel ../lang ./FillSymbol ./SimpleLineSymbol require".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c={STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forwarddiagonal",STYLE_BACKWARD_DIAGONAL:"backwarddiagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonalcross",STYLE_FORWARDDIAGONAL:"forwarddiagonal",STYLE_BACKWARDDIAGONAL:"backwarddiagonal",STYLE_DIAGONALCROSS:"diagonalcross"},l={style:c.STYLE_SOLID,color:[0,0,0,.25]};return n=n(o,{declaredClass:"esri.symbol.SimpleFillSymbol",type:"simplefillsymbol",_styles:{solid:"esriSFSSolid",none:"esriSFSNull",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical",forwarddiagonal:"esriSFSForwardDiagonal",backwarddiagonal:"esriSFSBackwardDiagonal",cross:"esriSFSCross",diagonalcross:"esriSFSDiagonalCross"},constructor:function(n,r,u){n?t.isString(n)?(this.style=n,void 0!==r&&(this.outline=r),void 0!==u&&(this.color=u)):this.style=e.valueOf(this._styles,n.style):(t.mixin(this,l),this.outline=new s(this.outline),this.color=new i(this.color))},setStyle:function(n){return this.style=n,this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){var n=this.style;return n===c.STYLE_NULL?null:n===c.STYLE_SOLID?this.color:t.mixin({},u.defaultPattern,{src:h.toUrl("../images/symbol/sfs/"+n+".png"),width:10,height:10})},getShapeDescriptors:function(){return{defaultShape:{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"},fill:this.getFill(),stroke:this.getStroke()}},toJson:function(){return e.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriSFS",style:this._styles[this.style]}))}}),t.mixin(n,c),n.defaultProps=l,r("extend-esri")&&(t.setObject("symbol.SimpleFillSymbol",n,f),f.symbol.defaultSimpleFillSymbol=l),n})},"esri/symbols/FillSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ./Symbol ./SimpleLineSymbol".split(" "),function(n,t,i,r,u,f){return n=n(u,{declaredClass:"esri.symbol.FillSymbol",constructor:function(n){n&&t.isObject(n)&&n.outline&&(this.outline=new f(n.outline))},setOutline:function(n){return this.outline=n,this},toJson:function(){var n=this.inherited("toJson",arguments);return this.outline&&(n.outline=this.outline.toJson()),n}}),i("extend-esri")&&t.setObject("symbol.FillSymbol",n,r),n})},"esri/symbols/PictureFillSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/sniff dojox/gfx/_base ../kernel ../lang ../urlUtils ./FillSymbol".split(" "),function(n,t,i,r,u,f,e,o){var s={xoffset:0,yoffset:0,width:12,height:12};return n=n(o,{declaredClass:"esri.symbol.PictureFillSymbol",type:"picturefillsymbol",xscale:1,yscale:1,xoffset:0,yoffset:0,constructor:function(n,u,f,e){n?t.isString(n)?(this.url=n,void 0!==u&&(this.outline=u),void 0!==f&&(this.width=f),void 0!==e&&(this.height=e)):(this.xoffset=r.pt2px(n.xoffset),this.yoffset=r.pt2px(n.yoffset),this.width=r.pt2px(n.width),this.height=r.pt2px(n.height),u=n.imageData,9>i("ie")||!u||(f=this.url,this.url="data:"+(n.contentType||"image")+";base64,"+u,this.imageData=f)):(t.mixin(this,s),this.width=r.pt2px(this.width),this.height=r.pt2px(this.height))},setWidth:function(n){return this.width=n,this},setHeight:function(n){return this.height=n,this},setOffset:function(n,t){return this.xoffset=n,this.yoffset=t,this},setUrl:function(n){return n!==this.url&&(delete this.imageData,delete this.contentType),this.url=n,this},setXScale:function(n){return this.xscale=n,this},setYScale:function(n){return this.yscale=n,this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){return t.mixin({},r.defaultPattern,{src:this.url,width:this.width*this.xscale,height:this.height*this.yscale,x:this.xoffset,y:this.yoffset})},getShapeDescriptors:function(){return{defaultShape:{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"},fill:this.getFill(),stroke:this.getStroke()}},toJson:function(){var n=this.url,u=this.imageData;if(0===n.indexOf("data:"))var i=n,n=u,u=i.indexOf(";base64,")+8,u=i.substr(u);t.isString(n)&&(0===n.indexOf("/")||0===n.indexOf("//")||0===n.indexOf("./")||0===n.indexOf("../"))&&(n=e.getAbsoluteUrl(n));var i=r.px2pt(this.width),i=isNaN(i)?void 0:i,o=r.px2pt(this.height),o=isNaN(o)?void 0:o,s=r.px2pt(this.xoffset),s=isNaN(s)?void 0:s,h=r.px2pt(this.yoffset),h=isNaN(h)?void 0:h,n=f.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriPFS",url:n,imageData:u,contentType:this.contentType,width:i,height:o,xoffset:s,yoffset:h,xscale:this.xscale,yscale:this.yscale}));return n.imageData||delete n.imageData,n}}),n.defaultProps=s,i("extend-esri")&&(t.setObject("symbol.PictureFillSymbol",n,u),u.symbol.defaultPictureFillSymbol=s),n})},"esri/symbols/TextSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojox/gfx/_base ../kernel ../lang ../Color ./Symbol ./Font".split(" "),function(n,t,i,r,u,f,e,o,s){var h={type:"textsymbol",x:0,y:0,text:"",rotated:!1,kerning:!0,color:[0,0,0,1],font:r.defaultFont,angle:0,xoffset:0,yoffset:0,horizontalAlignment:"center"},l={start:"left",middle:"center",end:"right"},a={left:"start",center:"middle",right:"end",justify:"start"},v={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},c=document.createElement("canvas");return n=n(o,{declaredClass:"esri.symbol.TextSymbol",angle:0,xoffset:0,yoffset:0,constructor:function(n,i,u){t.mixin(this,h);this.font=new s(this.font);this.color=new e(this.color);n&&(t.isObject(n)?(t.mixin(this,n),this.color&&f.isDefined(this.color[0])&&(this.color=e.toDojoColor(this.color)),this.type="textsymbol",this.font=new s(this.font),this.xoffset=r.pt2px(this.xoffset),this.yoffset=r.pt2px(this.yoffset),this.angle&&(this.angle*=-1),this.haloSize&&(this.haloSize=r.pt2px(this.haloSize)),this.haloColor&&(this.haloColor=e.toDojoColor(this.haloColor))):(this.text=n,i&&(this.font=i),u&&(this.color=u)));this.setAlign(this.align||this.getSVGAlign())},setFont:function(n){return this.font=n,this},setSize:function(n){return this.font.size=n,this},setAngle:function(n){return this.angle=n,this},setOffset:function(n,t){return this.xoffset=n,this.yoffset=t,this},setHaloColor:function(n){return this.haloColor=n,this},setHaloSize:function(n){return this.haloSize=n,this},setAlign:function(n){return this.align=n,this.setHorizontalAlignment(n&&l[n.toLowerCase()]||"center"),this},setHorizontalAlignment:function(n){return this.horizontalAlignment=n,this},getSVGAlign:function(){var n=this.horizontalAlignment;return n&&a[n.toLowerCase()]||"middle"},setVerticalAlignment:function(n){return this.verticalAlignment=n,this},getSVGBaseline:function(){var n=this.verticalAlignment;return n&&v[n.toLowerCase()]||"alphabetic"},getSVGBaselineShift:function(){return"bottom"===this.verticalAlignment?"super":null},setDecoration:function(n){return this.decoration=n,this.font||this.setFont(new s),this.font.setDecoration(n),this},setRotated:function(n){return this.rotated=n,this},setKerning:function(n){return this.kerning=n,this},setText:function(n){return this.text=n,this},getStroke:function(){return null},getFill:function(){return this.color},getWidth:function(){var t=c&&c.getContext&&c.getContext("2d"),n,i,u;if(t)return n=this.font,t.font=(n.style?n.style:r.defaultFont.style)+" "+(n.weight?n.weight:r.defaultFont.weight)+" "+(n.size?n.size:r.defaultFont.size)+"px "+(n.family?n.family:r.defaultFont.family),t.measureText(this.text).width;for(t=this.getHeight(),n=0,i=0;i<this.text.length;i++)u=this.text.charAt(i),n=u==u.toUpperCase()?n+.7*t:n+.5*t;return n},getHeight:function(){return r.normalizedLength(this.font.size)},getShapeDescriptors:function(){var n=this.font,t;return n&&(t={},n.size&&(t.size=n.size),n.style&&(t.style=n.style),n.variant&&(t.variant=n.variant),n.decoration&&(t.decoration=n.decoration),n.weight&&(t.weight=n.weight),n.family&&(t.family=n.family)),{defaultShape:{type:"text",text:this.text,x:0,y:this.getHeight()/4,align:"middle",decoration:this.decoration||n&&n.decoration,rotated:this.rotated,kerning:this.kerning},font:t,fill:this.getFill(),stroke:this.getStroke()}},toJson:function(){var n=r.px2pt(this.xoffset),i=r.px2pt(this.yoffset),u=r.px2pt(this.haloSize),n=isNaN(n)?void 0:n,i=isNaN(i)?void 0:i,u=isNaN(u)?void 0:u;return f.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriTS",backgroundColor:this.backgroundColor,borderLineColor:this.borderLineColor,borderLineSize:this.borderLineSize,haloSize:u,haloColor:this.haloColor&&e.toJsonColor(this.haloColor),verticalAlignment:this.verticalAlignment,horizontalAlignment:this.horizontalAlignment,rightToLeft:this.rightToLeft,width:this.width,angle:this.angle&&-1*this.angle,xoffset:n,yoffset:i,text:this.text,rotated:this.rotated,kerning:this.kerning,font:this.font.toJson()}))}}),t.mixin(n,{ALIGN_START:"start",ALIGN_MIDDLE:"middle",ALIGN_END:"end",DECORATION_NONE:"none",DECORATION_UNDERLINE:"underline",DECORATION_OVERLINE:"overline",DECORATION_LINETHROUGH:"line-through"}),n.defaultProps=h,i("extend-esri")&&(t.setObject("symbol.TextSymbol",n,u),u.symbol.defaultTextSymbol=h),n})},"esri/symbols/Font":function(){define("dojo/_base/declare dojo/_base/lang dojo/sniff dojox/gfx/_base ../kernel ../lang".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.symbol.Font",constructor:function(n,u,f,e,o){n?t.isObject(n)?t.mixin(this,n):(this.size=n,parseFloat(this.size)==this.size&&(this.size+="px"),void 0!==u&&(this.style=u),void 0!==f&&(this.variant=f),void 0!==e&&(this.weight=e),void 0!==o&&(this.family=o)):t.mixin(this,r.defaultFont);parseFloat(this.size)==this.size&&(this.size+="pt");9>i("ie")&&this.size&&t.isString(this.size)&&-1<this.size.indexOf("em")&&(this.size=r.pt2px(12*parseFloat(this.size))+"px");this.size=this._convert2PxSize(this.size)},setSize:function(n){return this.size=this._convert2PxSize(n),this},_convert2PxSize:function(n){var i;return parseFloat(n)==n?i=n:t.isString(n)&&(-1<n.indexOf("pt")?i=r.pt2px(parseFloat(n)):-1<n.indexOf("px")?i=parseFloat(n):-1<n.indexOf("em")?i=r.pt2px(12*parseFloat(n)):-1<n.indexOf("%")&&(i=r.pt2px(.12*parseFloat(n)))),i},setStyle:function(n){return this.style=n,this},setVariant:function(n){return this.variant=n,this},setWeight:function(n){return this.weight=n,this},setFamily:function(n){return this.family=n,this},setDecoration:function(n){return this.decoration=n,this},toJson:function(){return f.fixJson({size:r.px2pt(this.size),style:this.style,variant:this.variant,decoration:this.decoration,weight:this.weight,family:this.family})}}),t.mixin(n,{STYLE_NORMAL:"normal",STYLE_ITALIC:"italic",STYLE_OBLIQUE:"oblique",VARIANT_NORMAL:"normal",VARIANT_SMALLCAPS:"small-caps",WEIGHT_NORMAL:"normal",WEIGHT_BOLD:"bold",WEIGHT_BOLDER:"bolder",WEIGHT_LIGHTER:"lighter"}),i("extend-esri")&&t.setObject("symbol.Font",n,u),n})},"esri/tasks/query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils ./SpatialRelationship dojo/has!extend-esri?./QueryTask dojo/has!extend-esri?./RelationshipQuery dojo/has!extend-esri?./StatisticDefinition".split(" "),function(n,t,i,r,u,f,e,o){var s=n(null,{declaredClass:"esri.tasks.Query",constructor:function(){this.spatialRelationship=s.SPATIAL_REL_INTERSECTS},text:null,where:"",geometry:null,groupByFieldsForStatistics:null,objectIds:null,returnGeometry:!1,returnDistinctValues:!1,orderByFields:null,outSpatialReference:null,outFields:null,outStatistics:null,timeExtent:null,relationParam:null,pixelSize:null,distance:null,units:null,resultOffset:null,resultRecordCount:null,resultType:null,sqlFormat:null,quantizationParameters:null,_units:{meters:"esriSRUnit_Meter",kilometers:"esriSRUnit_Kilometer",feet:"esriSRUnit_Foot",miles:"esriSRUnit_StatuteMile","nautical-miles":"esriSRUnit_NauticalMile","us-nautical-miles":"esriSRUnit_USNauticalMile"},toJson:function(n){var t={text:this.text,where:this.where,returnGeometry:this.returnGeometry,spatialRel:this.spatialRelationship,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision,sqlFormat:this.sqlFormat},u=n&&n.geometry||this.geometry,h=this.objectIds,c=this.outFields,f=this.outSpatialReference,l=this.groupByFieldsForStatistics,a=this.orderByFields,v=this.outStatistics,o;return n=this.distance,u&&(t.geometry=u,t.geometryType=e.getJsonType(u),t.inSR=u.spatialReference.wkid||r.toJson(u.spatialReference.toJson())),h&&(t.objectIds=h.join(",")),c&&(t.outFields=c.join(",")),this.returnDistinctValues&&(t.returnDistinctValues=!0),l&&(t.groupByFieldsForStatistics=l.join(",")),a&&(t.orderByFields=a.join(",")),v&&(o=[],i.forEach(v,function(n){o.push(n.toJson())}),t.outStatistics=r.toJson(o)),f?t.outSR=f.wkid||r.toJson(f.toJson()):u&&(t.outSR=u.spatialReference.wkid||r.toJson(u.spatialReference.toJson())),u=this.timeExtent,t.time=u?u.toJson().join(","):null,(u=this.relationParam)&&this.spatialRelationship===s.SPATIAL_REL_RELATION&&(t.relationParam=u),n&&(t.distance=this.distance,this.hasOwnProperty("units")?t.units=this._units[this.units]||this._units.meters:(console.warn("esri/tasks/query::no distance unit provided, defaulting to meters"),t.units=this._units.meters)),this.hasOwnProperty("start")&&(t.resultOffset=this.start,t.resultRecordCount=10,""===t.where&&(t.where="1=1")),this.hasOwnProperty("num")&&(t.resultRecordCount=this.num),t.resultType=this.resultType,t.pixelSize=this.pixelSize?r.toJson(this.pixelSize.toJson()):null,t.multipatchOption=this.multipatchOption,this.quantizationParameters&&(t.quantizationParameters=r.toJson(this.quantizationParameters)),t._ts=this._ts,t}});return t.mixin(s,o),u("extend-esri")&&t.setObject("tasks.Query",s,f),s})},"esri/tasks/SpatialRelationship":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(n,t,i){var r={SPATIAL_REL_INTERSECTS:"esriSpatialRelIntersects",SPATIAL_REL_CONTAINS:"esriSpatialRelContains",SPATIAL_REL_CROSSES:"esriSpatialRelCrosses",SPATIAL_REL_ENVELOPEINTERSECTS:"esriSpatialRelEnvelopeIntersects",SPATIAL_REL_INDEXINTERSECTS:"esriSpatialRelIndexIntersects",SPATIAL_REL_OVERLAPS:"esriSpatialRelOverlaps",SPATIAL_REL_TOUCHES:"esriSpatialRelTouches",SPATIAL_REL_WITHIN:"esriSpatialRelWithin",SPATIAL_REL_RELATION:"esriSpatialRelRelation"};return t("extend-esri")&&n.setObject("tasks._SpatialRelationship",r,i),r})},"esri/plugins/popupManager":function(){define(["../PopupManager"],function(n){return{add:function(t,i){t.popupManager||(t.popupManager=new n(i),t.popupManager.setMap(t))},remove:function(n){var t=n.popupManager;t&&(t.unsetMap(),n.popupManager=void 0)}}})},"esri/PopupManager":function(){define("./geometry/Extent ./geometry/ScreenPoint ./kernel ./layerUtils ./tasks/query dijit/registry dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/has dojo/on dojo/promise/all dojo/Stateful require".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){var p;return o=o(v,{declaredClass:"esri.PopupManager",enabled:!1,map:null,_mapClickHandle:null,_featureLayersCache:{},constructor:function(){this._mapClickHandler=h.hitch(this,this._mapClickHandler)},setMap:function(n){if(this.map)if(n!==this.map)this.unsetMap();else return;this.map=n;this._setupClickHandler()},unsetMap:function(){this.map&&(this.map=null);this._mapClickHandle&&(this._mapClickHandle.remove(),this._mapClickHandle=null)},getMapLayer:function(n){var t,i;return n&&(t=n.getLayer())&&(n=t.id,this._featureLayersCache[n])&&(i=n.lastIndexOf("_"),-1<i&&(n=n.substring(0,i),t=this.map.getLayer(n))),t},_enabledSetter:function(n){this.enabled=n;this._setupClickHandler()},_setupClickHandler:function(){this._mapClickHandle&&(this._mapClickHandle.remove(),this._mapClickHandle=null);this.enabled&&this.map&&(this._mapClickHandle=this.map.on("click",this._mapClickHandler))},_mapClickHandler:function(n){var t=this.map.infoWindow,i=n.graphic;t&&this.map.loaded&&(t.clearFeatures&&t.setFeatures?this._showPopup(n):i&&i.getInfoTemplate()&&this._showInfoWindow(i,n.mapPoint))},_showPopup:function(i){var r=this.map,h=r.infoWindow,f=this,o=[],l=[r.graphics].concat(e.map(r.graphicsLayerIds,r.getLayer,r)),c;e.forEach(l,function(n){n&&n.loaded&&n.infoTemplate&&!n.suspended&&o.push(n)});c=[];e.forEach(r.layerIds,function(n){(n=r.getLayer(n))&&n.loaded&&!n.suspended&&(f._isImageServiceLayer(n)&&n.infoTemplate?o.push(n):"esri.layers.WMSLayer"===n.declaredClass&&n.getFeatureInfoURL?o.push(n):"esri.layers.ArcGISDynamicMapServiceLayer"!==n.declaredClass&&"esri.layers.ArcGISTiledMapServiceLayer"!==n.declaredClass||!n.infoTemplates||c.push(n))});this._getSubLayerFeatureLayers(c).then(function(c){var a,y,l,p;if(o=o.concat(c),a=null,i.graphic&&i.graphic.getInfoTemplate()&&!f._isImageServiceLayer(i.graphic._layer)&&(a=i.graphic),(o.length||a)&&(l=f._calculateClickTolerance(o),y=i.screenPoint,c=r.toMap(new t(y.x-l,y.y+l)),l=r.toMap(new t(y.x+l,y.y-l)),p=new n(c.x,c.y,l.x,l.y,r.spatialReference),p=p.intersects(r.extent))){var w=new u,v=!!a,b=!0;c=e.map(o,function(n){var o,t,u;return w.timeExtent=n.useMapTime?r.timeExtent:null,o=f._isAggregationEnabled(n),n=o?n.getAggregationLayer():n,f._isImageServiceLayer(n)?(w.geometry=i.mapPoint,b=!1,t=n.queryVisibleRasters(w,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),t.addCallback(function(){var t=n.getVisibleRasters();return v=v||0<t.length,t})):"esri.layers.WMSLayer"===n.declaredClass?(t=new s,u=n._getPopupGraphic(r,i.screenPoint),u?(t.resolve([u]),v=!0):t.resolve([])):f._featureLayersCache[n.id]||"function"==typeof n.queryFeatures&&(0===n.currentMode||1===n.currentMode)?(w.geometry=p,t=n.queryFeatures(w),t.addCallback(function(n){return n=n.features,n=e.filter(n,function(n){return n.visible}),v=v||0<n.length,n})):(t=new s,u=e.filter(n.graphics,function(n){return n&&n.visible&&p.intersects(n.geometry)}),o&&f._isParentLayer(n,a)&&(o=f._findGraphicById(u,a,"clusterId"))&&(a=o),v=v||0<u.length,t.resolve(u)),t});a&&(l=new s,l.resolve([a]),c.unshift(l));e.some(c,function(n){return!n.isFulfilled()})||v?(h.setFeatures(c),h.show(i.mapPoint,{closestFirst:b})):(h.hide(),h.clearFeatures())}})},_getSubLayerFeatureLayers:function(n,t){var v=t||new s,o=[],ut=n.length,ft=Math.floor(this.map.extent.getWidth()/this.map.width),g=this.map.getScale(),rt=!1,et=this,nt=0,i,h,w,k,u,it,d;n:for(;nt<ut;nt++)if(i=n[nt],h=i.dynamicLayerInfos||i.layerInfos,h){w=null;i._params&&(i._params.layers||i._params.dynamicLayers)&&(w=i.visibleLayers);for(var w=r._getVisibleLayers(h,w),ot=r._getLayersForScale(g,h),st=h.length,tt=0;tt<st;tt++){var b=h[tt],f=b.id,c=i.infoTemplates[f];if(!b.subLayerIds&&c&&c.infoTemplate&&-1<e.indexOf(w,f)&&-1<e.indexOf(ot,f)){if(!p){rt=!0;break n}k=i.id+"_"+f;u=this._featureLayersCache[k];u&&u.loadError||(u||((u=c.layerUrl)||(u=b.source?this._getLayerUrl(i.url,"/dynamicLayer"):this._getLayerUrl(i.url,f)),u=new p(u,{id:k,drawMode:!1,mode:p.MODE_SELECTION,outFields:this._getOutFields(c.infoTemplate),resourceInfo:c.resourceInfo,source:b.source}),this._featureLayersCache[k]=u),u.setDefinitionExpression(i.layerDefinitions&&i.layerDefinitions[f]),u.setGDBVersion(i.gdbVersion),u.setInfoTemplate(c.infoTemplate),u.setMaxAllowableOffset(ft),u.setUseMapTime(!!i.useMapTime),i.layerDrawingOptions&&i.layerDrawingOptions[f]&&i.layerDrawingOptions[f].renderer&&u.setRenderer(i.layerDrawingOptions[f].renderer),o.push(u))}}}return rt?(it=new s,y(["./layers/FeatureLayer"],function(n){p=n;it.resolve()}),it.then(function(){et._getSubLayerFeatureLayers(n,v)})):(d=[],e.forEach(o,function(n){if(!n.loaded){var t=new s;l.once(n,"load, error",function(){t.resolve()});d.push(t.promise)}}),d.length?a(d).then(function(){o=e.filter(o,function(n){return!n.loadError&&n.isVisibleAtScale(g)});v.resolve(o)}):(o=e.filter(o,function(n){return n.isVisibleAtScale(g)}),v.resolve(o))),v.promise},_getLayerUrl:function(n,t){var i=n.indexOf("?");return-1===i?n+"/"+t:n.substring(0,i)+"/"+t+n.substring(i)},_getOutFields:function(n){var t;return n.info&&"esri.dijit.PopupTemplate"===n.declaredClass?(t=[],e.forEach(n.info.fieldInfos,function(n){var i=n.fieldName&&n.fieldName.toLowerCase();i&&"shape"!==i&&0!==i.indexOf("relationships/")&&t.push(n.fieldName)})):t=["*"],t},_calculateClickTolerance:function(n){var i=6,r,t;return e.forEach(n,function(n){(r=n.renderer)&&("esri.renderer.SimpleRenderer"===r.declaredClass?((t=r.symbol)&&t.xoffset&&(i=Math.max(i,Math.abs(t.xoffset))),t&&t.yoffset&&(i=Math.max(i,Math.abs(t.yoffset)))):"esri.renderer.UniqueValueRenderer"!==r.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==r.declaredClass||e.forEach(r.infos,function(n){(t=n.symbol)&&t.xoffset&&(i=Math.max(i,Math.abs(t.xoffset)));t&&t.yoffset&&(i=Math.max(i,Math.abs(t.yoffset)))}))}),i},_showInfoWindow:function(n,t){var e=this.map.infoWindow,r=n.geometry,r=r&&"point"===r.type?r:t,u=n.getContent(),i;e.setTitle(n.getTitle());u&&h.isString(u.id)&&(i=f.byId(u.id),i&&i.set&&/_PopupRenderer/.test(i.declaredClass)&&i.set("showTitle",!1));e.setContent(u);e.show(r)},_findGraphicById:function(n,t,i){var r,u=(t=t.attributes)&&t[i];return e.some(n,function(n){var t=n.attributes;return t&&t[i]===u&&(r=n),!!r}),r},_isParentLayer:function(n,t){var i=t&&t.getLayer();return n&&i===n},_isAggregationEnabled:function(n){return n&&n.isAggregationEnabled&&n.isAggregationEnabled()},_isImageServiceLayer:function(n){return"esri.layers.ArcGISImageServiceLayer"===n.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===n.declaredClass}}),c("extend-esri")&&(i.PopupManager=o),o})},"esri/layerUtils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/has","./kernel"],function(n,t,i,r,u){var f={_serializeLayerDefinitions:function(n,r){var f=[],e=/[:;]/,u;return n&&(t.forEach(n,function(n,t){n&&(f.push([t,n]),!r&&e.test(n)&&(r=!0))}),0<f.length)?(r?(u={},t.forEach(f,function(n){u[n[0]]=n[1]}),u=i.toJson(u)):(u=[],t.forEach(f,function(n){u.push(n[0]+":"+n[1])}),u=u.join(";")),u):null},_serializeTimeOptions:function(n,r){if(n){var u=[];if(t.forEach(n,function(n,f){if(n){var e=n.toJson();r&&-1!==t.indexOf(r,f)&&(e.useTime=!1);u.push('"'+f+'":'+i.toJson(e))}}),u.length)return"{"+u.join(",")+"}"}},_getVisibleLayers:function(n,i){var r=[],u,e,f;if(!n)return r;if(i)for(r=i.concat(),f=0;f<n.length;f++)u=n[f],e=t.indexOf(n,u.id),u.subLayerIds&&-1<e&&(r.splice(e,1),r=r.concat(u.subLayerIds));else r=this._getDefaultVisibleLayers(n);return r},_getDefaultVisibleLayers:function(n){var r=[],i;if(!n)return r;for(i=0;i<n.length;i++)0<=n[i].parentLayerId&&-1===t.indexOf(r,n[i].parentLayerId)&&t.some(n,function(t){return t.id===n[i].parentLayerId})||n[i].defaultVisibility&&r.push(n[i].id);return r},_getLayersForScale:function(n,i){var o=[],r;if(0<n&&i)for(r=0;r<i.length;r++)if(!(0<=i[r].parentLayerId&&-1===t.indexOf(o,i[r].parentLayerId)&&t.some(i,function(n){return n.id===i[r].parentLayerId}))&&0<=i[r].id){var e=!0,u=i[r].maxScale,f=i[r].minScale;(0<u||0<f)&&(0<u&&0<f?e=u<=n&&n<=f:0<u?e=u<=n:0<f&&(e=n<=f));e&&o.push(i[r].id)}return o}};return r("extend-esri")&&n.mixin(u,f),f})},"dojo/promise/all":function(){define(["../_base/array","../Deferred","../when"],function(n,t,i){var r=n.some;return function(n){var e,u,o,s,h,f,c;if(n instanceof Array?u=n:n&&"object"==typeof n&&(e=n),s=[],e){u=[];for(h in e)Object.hasOwnProperty.call(e,h)&&(s.push(h),u.push(e[h]));o={}}else u&&(o=[]);return!u||!u.length?(new t).resolve(o):(f=new t,f.promise.always(function(){o=s=null}),c=u.length,r(u,function(n,t){return e||s.push(t),i(n,function(n){f.isFulfilled()||(o[s[t]]=n,0==--c&&f.resolve(o))},f.reject),f.isFulfilled()}),f.promise)}})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(n,t,i,r,u){var o=u.doc.documentElement,e,h;u=r("ie");var c=r("trident"),f=r("opera"),s=Math.floor,l=r("ff"),a=n.boxModel.replace(/-/,""),f={dj_quirks:r("quirks"),dj_opera:f,dj_khtml:r("khtml"),dj_webkit:r("webkit"),dj_safari:r("safari"),dj_chrome:r("chrome"),dj_edge:r("edge"),dj_gecko:r("mozilla"),dj_ios:r("ios"),dj_android:r("android")};u&&(f.dj_ie=!0,f["dj_ie"+s(u)]=!0,f.dj_iequirks=r("quirks"));c&&(f.dj_trident=!0,f["dj_trident"+s(c)]=!0);l&&(f["dj_ff"+s(l)]=!0);f["dj_"+a]=!0;e="";for(h in f)f[h]&&(e+=h+" ");return o.className=t.trim(o.className+" "+e),i(function(){if(!n.isBodyLtr()){var i="dj_rtl dijitRtl "+e.replace(/ /g,"-rtl ");o.className=t.trim(o.className+" "+i+"dj_rtl dijitRtl "+e.replace(/ /g,"-rtl "))}}),r})},"esri/MapNavigationManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/mouse dojo/keys dijit/focus ./kernel ./MouseEvents ./TouchEvents ./PointerEvents ./config ./sniff ./lang ./fx ./graphic ./tileUtils ./geometry/ScreenPoint ./geometry/Extent ./geometry/Rect ./geometry/mathUtils ./symbols/SimpleFillSymbol".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){var it=r.connect,rt=r.disconnect,ut=v("chrome"),ft=v("safari"),et=[e.NUMPAD_PLUS,61,187,e.NUMPAD_MINUS,173,189,e.UP_ARROW,e.NUMPAD_8,e.RIGHT_ARROW,e.NUMPAD_6,e.DOWN_ARROW,e.NUMPAD_2,e.LEFT_ARROW,e.NUMPAD_4,e.PAGE_UP,e.NUMPAD_9,e.PAGE_DOWN,e.NUMPAD_3,e.END,e.NUMPAD_1,e.HOME,e.NUMPAD_7];return n=n(null,{declaredClass:"esri.MapNavigationManager",eventModel:"",constructor:function(n,i){this.map=n;t.mixin(this,i);var r=n.__container;v("esri-pointer")?(this.pointerEvents=new l(r,{map:n}),this.eventModel="pointer"):v("esri-touch")?(v("ios")||(this.mouseEvents=new h(r,{map:n})),this.touchEvents=new c(r,{map:n,mouseEvents:this.mouseEvents}),this.eventModel="touch"):(this.mouseEvents=new h(r,{map:n}),this.eventModel="mouse");this._zoomRect=new w(null,new tt(a.defaults.map.zoomSymbol));this._keyDx=this._keyDy=0;this._adjustPinch=t.hitch(this,this._adjustPinch);this._adjustPinchEnd=t.hitch(this,this._adjustPinchEnd)},_panInit:function(n){var i=this.mouseEvents;f.isLeft(n)&&this.map.isPan&&!n.shiftKey&&(this._dragOrigin=new k(0,0),t.mixin(this._dragOrigin,n.screenPoint),rt(this._panStartHandle),rt(this._panHandle),rt(this._panEndHandle),this._panStartHandle=it(i,"onMouseDragStart",this,this._panStart),this._panHandle=it(i,"onMouseDrag",this,this._pan),this._panEndHandle=it(i,"onMouseUp",this,this._panEnd),ut||ft)&&(n.preventDefault(),o.curNode&&o.curNode.blur())},_panStart:function(n){this.map.setCursor("move");this.map.__panStart(n.screenPoint.x,n.screenPoint.y)},_pan:function(n){this.map.__pan(n.screenPoint.x-this._dragOrigin.x,n.screenPoint.y-this._dragOrigin.y)},_panEnd:function(n){rt(this._panStartHandle);rt(this._panHandle);rt(this._panEndHandle);this._panStartHandle=this._panHandle=this._panEndHandle=null;var t=this.map;t.__panning&&(t.__panEnd(n.screenPoint.x-this._dragOrigin.x,n.screenPoint.y-this._dragOrigin.y),t.resetMapCursor())},_zoomInit:function(n){var r=this.map,i=this.pointerEvents||this.mouseEvents;(f.isLeft(n)||n.pointerType)&&r.isRubberBandZoom&&n.shiftKey&&(r.setCursor("crosshair"),this._dragOrigin=t.mixin({},n.screenPoint),this._zoomDir=n.ctrlKey||n.metaKey?-1:1,this.pointerEvents?(this._zoomHandle=it(i,"onSwipeMove",this,this._zoom),this._zoomEndHandle=it(i,"onSwipeEnd",this,this._zoomEnd)):(this._zoomHandle=it(i,"onMouseDrag",this,this._zoom),this._zoomEndHandle=it(i,"onMouseUp",this,this._zoomEnd)),ut&&n.preventDefault())},_zoom:function(n){var i=this.map,t=this._normalizeRect(n).offset(i.__visibleRect.x,i.__visibleRect.y),r;n=i.graphics;r=this._zoomRect;r.geometry||i.setCursor("crosshair");r.geometry&&n.remove(r,!0);var u=i.toMap(new k(t.x,t.y)),t=i.toMap(new k(t.x+t.width,t.y+t.height)),t=new g(u.x,u.y,t.x-u.x,u.y-t.y,i.spatialReference);t._originOnly=!0;r.setGeometry(t);n.add(r,!0)},_zoomEnd:function(n){var r=this._zoomRect,t=this.map,i=t.extent,u=t.spatialReference,f;rt(this._zoomHandle);rt(this._zoomEndHandle);this._zoomHandle=this._zoomEndHandle=null;t._canZoom(this._zoomDir)&&r.getDojoShape()&&(t.graphics.remove(r),r.geometry=null,n=this._normalizeRect(n),n.x+=t.__visibleRect.x,n.y+=t.__visibleRect.y,-1===this._zoomDir?(f=i.getWidth(),n=(f*t.width/n.width-f)/2,u=new d(i.xmin-n,i.ymin-n,i.xmax+n,i.ymax+n,u)):(i=t.toMap({x:n.x,y:n.y+n.height}),n=t.toMap({x:n.x+n.width,y:n.y}),u=new d(i.x,i.y,n.x,n.y,u)),t._extentUtil(null,null,u));r.getDojoShape()&&t.graphics.remove(r,!0);this._zoomDir=0;t.resetMapCursor()},_wheelZoom:function(n,t){var r=this.map,i;if(!t){if(r.smartNavigation&&!n.shiftKey&&!r._isPanningOrZooming()){r.disableScrollWheelZoom();this._setScrollWheelPan(!0);this._wheelPan(n);return}if(i=n.timeStamp,(!y.isDefined(i)||0>=i)&&(i=(new Date).getTime()),100>(this._mwts?i-this._mwts:i))return;this._mwts=i}r._canZoom(n.value)&&r._extentUtil({numLevels:n.value,mapAnchor:n.mapPoint,screenAnchor:n.screenPoint})},_wheelPan:function(n){var r=this.map,t,i;n.shiftKey&&!r._isPanningOrZooming()?(this._setScrollWheelPan(!1),r.enableScrollWheelZoom(),this._wheelZoom(n)):(t=0,i=0,v("ff")?n.axis===n.HORIZONTAL_AXIS?t=-n.detail:i=-n.detail:(t=n.wheelDeltaX,i=n.wheelDeltaY),r.translate(t,i))},_setScrollWheelPan:function(n){this.map.isScrollWheelPan=n;this.mouseEvents.enableMouseWheel(n);rt(this._mwMacHandle);this._mwMacHandle=null;n&&(this._mwMacHandle=it(this.mouseEvents,"onMouseWheel",this,this._wheelPan))},_recenter:function(n){n.shiftKey&&!this.map._isPanningOrZooming()&&this.map.centerAt(n.mapPoint)},_recenterZoom:function(n){n.shiftKey&&!this.map._isPanningOrZooming()&&(n.value=n.ctrlKey||n.metaKey?-1:1,this._wheelZoom(n,!0))},_dblClickZoom:function(n){this.map._isPanningOrZooming()||(n.value=1,this._wheelZoom(n,!0))},_twoFingerTap:function(n){this.map._isPanningOrZooming()||(n.value=-1,this._wheelZoom(n,!0))},_keyDown:function(n){var t=n.keyCode,r=this.map;if(-1!==i.indexOf(et,t)){if(t===e.NUMPAD_PLUS||61===t||187===t)r._extentUtil({numLevels:1});else if(t===e.NUMPAD_MINUS||173===t||189===t)r._extentUtil({numLevels:-1});else{r.__panning||r.__panStart(0,0);switch(t){case e.UP_ARROW:case e.NUMPAD_8:this._keyDy+=10;break;case e.RIGHT_ARROW:case e.NUMPAD_6:this._keyDx-=10;break;case e.DOWN_ARROW:case e.NUMPAD_2:this._keyDy-=10;break;case e.LEFT_ARROW:case e.NUMPAD_4:this._keyDx+=10;break;case e.PAGE_UP:case e.NUMPAD_9:this._keyDx-=10;this._keyDy+=10;break;case e.PAGE_DOWN:case e.NUMPAD_3:this._keyDx-=10;this._keyDy-=10;break;case e.END:case e.NUMPAD_1:this._keyDx+=10;this._keyDy-=10;break;case e.HOME:case e.NUMPAD_7:this._keyDx+=10;this._keyDy+=10;break;default:return}r.__pan(this._keyDx,this._keyDy)}u.stop(n)}},_keyEnd:function(n){var t=this.map;t.__panning&&n.keyCode!==e.SHIFT&&(t.__panEnd(this._keyDx,this._keyDy),this._keyDx=this._keyDy=0)},_swipeInit:function(n){var i=this.map,i=i._zoomAnim||i._panAnim;if(n.shiftKey)return!1;i&&i._active&&(i.stop(),i._fire("onEnd",[i.node]));this._dragOrigin=new k(0,0);t.mixin(this._dragOrigin,n.screenPoint);rt(this._swipeHandle);rt(this._swipeEndHandle);this._swipeHandle=it(this.touchEvents||this.pointerEvents,"onSwipeMove",this,this._swipe);this._swipeEndHandle=it(this.touchEvents||this.pointerEvents,"onSwipeEnd",this,this._swipeEnd)},_swipe:function(n){var t=this.map;t.__panning?(this._panX=n.screenPoint.x,this._panY=n.screenPoint.y,t.__pan(n.screenPoint.x-this._dragOrigin.x,n.screenPoint.y-this._dragOrigin.y)):(t.setCursor("move"),t.__panStart(n.screenPoint.x,n.screenPoint.y))},_swipeEnd:function(n){rt(this._swipeHandle);rt(this._swipeEndHandle);this._swipeHandle=this._swipeEndHandle=null;var t=this.map;t.__panning&&(t.resetMapCursor(),t.__panEnd(n.screenPoint.x-this._dragOrigin.x,n.screenPoint.y-this._dragOrigin.y))},_pinchInit:function(n){var i=this.map,t=i._zoomAnim||i._panAnim;t&&t._active?(t.stop(),t._fire("onEnd",[t.node])):i.__panning&&(n.screenPoint=new k(this._panX,this._panY),n.mapPoint=i.toMap(n.screenPoint),this._swipeEnd(n));rt(this._pinchHandle);rt(this._pinchEndHandle);this._pinchHandle=it(this.touchEvents||this.pointerEvents,"onPinchMove",this,this._pinch);this._pinchEndHandle=it(this.touchEvents||this.pointerEvents,"onPinchEnd",this,this._pinchEnd)},_pinch:function(n){var t=this.map,i;n.screenPoints&&(this.currLength=nt.getLength(n.screenPoints[0],n.screenPoints[1]),t.__zooming?(i=this.currLength/this._length,this._zoomStartExtent=this.__scaleExtent(t.extent,i,this._dragOrigin),t.__zoom(this._zoomStartExtent,i,this._dragOrigin)):(this._dragOrigin=new k((n.screenPoints[0].x+n.screenPoints[1].x)/2,(n.screenPoints[0].y+n.screenPoints[1].y)/2),this._length=this.currLength,t.__zoomStart(t.extent,this._dragOrigin)),this._pinchScale=i,t._fireOnScale(this.currLength/this._length,this._dragOrigin,!0))},_pinchEnd:function(n){var r,u;if(n=this.map,rt(this._pinchHandle),rt(this._pinchEndHandle),this._pinchHandle=this._pinchEndHandle=null,this._pinchScale=0,n.__zooming&&null===n._zoomAnim)if(r=this.currLength/this._length,u=n.extent.getWidth(),this._zoomAnimAnchor=n.toMap(this._dragOrigin),this._zoomStartExtent=this.__scaleExtent(n.extent,1/r,this._zoomAnimAnchor),n.__tileInfo){var f=b.getCandidateTileInfo(n,n.__tileInfo,this._zoomStartExtent),i=n.__getExtentForLevel(f.lod.level,this._zoomAnimAnchor),s=n.getMinZoom(),h=n.getMaxZoom(),e=i.extent,i=i.lod,o=u/e.getWidth(),t=f.lod.level;1>r?o>r&&t--:o<r&&t++;t<s?t=s:t>h&&(t=h);t!==f.lod.level&&(i=n.__getExtentForLevel(t,this._zoomAnimAnchor),e=i.extent,i=i.lod);this._zoomEndExtent=e;this._zoomEndLod=i;n._zoomAnim=p.animateRange({range:{start:u/this._zoomStartExtent.getWidth(),end:o},duration:a.defaults.map.zoomDuration,rate:a.defaults.map.zoomRate,onAnimate:this._adjustPinch,onEnd:this._adjustPinchEnd});n._zoomAnim.play();n._fireOnScale(n.extent.getWidth()/this._zoomEndExtent.getWidth(),this._dragOrigin)}else this._zoomEndExtent=this._zoomStartExtent,n._fireOnScale(n.extent.getWidth()/this._zoomEndExtent.getWidth(),this._dragOrigin),this._adjustPinchEnd()},_adjustPinch:function(n){var t=this.__scaleExtent(this.map.extent,n,this._zoomAnimAnchor);this.map.__zoom(t,n,this._dragOrigin)},_adjustPinchEnd:function(){var n=this.map,t=n.extent.getWidth()/this._zoomEndExtent.getWidth(),i=this.__scaleExtent(n.extent,1/t,this._zoomAnimAnchor),r=this._dragOrigin,u=this._zoomEndLod;this._zoomStartExtent=this._zoomEndExtent=this._zoomEndLod=this._dragOrigin=n._zoomAnim=this._zoomAnimAnchor=null;n.__zoomEnd(i,t,r,u,!0)},__scaleExtent:function(n,t,i){i=i||n.getCenter();t=n.expand(t);var r=n.xmin-(t.getWidth()-n.getWidth())*(i.x-n.xmin)/n.getWidth();return i=n.ymax-(t.getHeight()-n.getHeight())*(i.y-n.ymax)/n.getHeight(),new d(r,i-t.getHeight(),r+t.getWidth(),i,n.spatialReference)},_normalizeRect:function(n){n=n.screenPoint;var t=this._dragOrigin.x,i=this._dragOrigin.y;return n=new g((n.x<t?n.x:t)-this.map.__visibleRect.x,(n.y<i?n.y:i)-this.map.__visibleRect.y,Math.abs(n.x-t),Math.abs(n.y-i)),delete n.spatialReference,0===n.width&&(n.width=1),0===n.height&&(n.height=1),n},setImmediateClick:function(n){switch(this.eventModel){case"mouse":this.mouseEvents.setImmediateClick(n);break;case"touch":this.touchEvents.setImmediateTap(n);this.mouseEvents&&this.mouseEvents.setImmediateClick(n);break;case"pointer":this.pointerEvents.setImmediateTap(n)}},enablePan:function(){this.disablePan();switch(this.eventModel){case"mouse":this._panInitHandle=it(this.mouseEvents,"onMouseDown",this,this._panInit);break;case"touch":this._panInitHandle=it(this.mouseEvents,"onMouseDown",this,this._panInit);this._swipeInitHandle=it(this.touchEvents,"onSwipeStart",this,this._swipeInit);break;case"pointer":this._swipeInitHandle=it(this.pointerEvents,"onSwipeStart",this,this._swipeInit)}},disablePan:function(){rt(this._panInitHandle);this._panInitHandle=null;rt(this._swipeInitHandle);this._swipeInitHandle=null},enableRubberBandZoom:function(){this.disableRubberBandZoom();this._zoomInitHandle=this.pointerEvents?it(this.pointerEvents,"onSwipeStart",this,this._zoomInit):it(this.mouseEvents,"onMouseDown",this,this._zoomInit)},disableRubberBandZoom:function(){rt(this._zoomInitHandle);this._zoomInitHandle=null},enablePinchZoom:function(){this.disablePinchZoom();("touch"===this.eventModel||"pointer"===this.eventModel)&&(this._pinchInitHandle=it(this.touchEvents||this.pointerEvents,"onPinchStart",this,this._pinchInit))},disablePinchZoom:function(){rt(this._pinchInitHandle);this._pinchInitHandle=null},enableScrollWheelZoom:function(){this.disableScrollWheelZoom();this._wheelHandle=it(this.mouseEvents||this.pointerEvents,"onMouseWheel",this,this._wheelZoom)},disableScrollWheelZoom:function(){rt(this._wheelHandle);this._wheelHandle=null},enableScrollWheelPan:function(){var n=this.map;n&&n.loaded&&n.smartNavigation&&(this.disableScrollWheelPan(),this._setScrollWheelPan(!0))},disableScrollWheelPan:function(){var n=this.map;n&&n.loaded&&n.smartNavigation&&this._setScrollWheelPan(!1)},enableDoubleClickZoom:function(){this.disableDoubleClickZoom();switch(this.eventModel){case"mouse":this._dblClickHandle=it(this.mouseEvents,"onDblClick",this,this._dblClickZoom);break;case"touch":this._dblClickHandle=it(this.mouseEvents,"onDblClick",this,this._dblClickZoom);this._dblTapHandle=it(this.touchEvents,"onDoubleTap",this,this._dblClickZoom);this._zoomOutHandle=it(this.touchEvents,"onTwoFingerTap",this,this._twoFingerTap);break;case"pointer":this._dblTapHandle=it(this.pointerEvents,"onDoubleTap",this,this._dblClickZoom);this._zoomOutHandle=it(this.pointerEvents,"onTwoFingerTap",this,this._twoFingerTap)}},disableDoubleClickZoom:function(){rt(this._dblClickHandle);rt(this._zoomOutHandle);this._dblTapHandle&&rt(this._dblTapHandle);this._dblClickHandle=this._zoomOutHandle=this._dblTapHandle=null},enableShiftDoubleClickZoom:function(){this.disableShiftDoubleClickZoom();this._sDblClickHandle=it(this.pointerEvents||this.mouseEvents,"onDblClick",this,this._recenterZoom)},disableShiftDoubleClickZoom:function(){rt(this._sDblClickHandle);this._sDblClickHandle=null},enableClickRecenter:function(){this.disableClickRecenter();this._recenterHandle=it(this.pointerEvents||this.mouseEvents,"onClick",this,this._recenter)},disableClickRecenter:function(){rt(this._recenterHandle);this._recenterHandle=null},enableKeyboardNavigation:function(){this.disableKeyboardNavigation();this._keyHandle=it(this.pointerEvents||this.mouseEvents,"onKeyDown",this,this._keyDown);this._keyEndHandle=it(this.pointerEvents||this.mouseEvents,"onKeyUp",this,this._keyEnd)},disableKeyboardNavigation:function(){rt(this._keyHandle);rt(this._keyEndHandle);this._keyHandle=this._keyEndHandle=null},enableScrollWheel:function(){var n=this.map;n&&(n.smartNavigation?this.enableScrollWheelPan():n.enableScrollWheelZoom())},disableScrollWheel:function(){var n=this.map;n&&(n.disableScrollWheelZoom(),n.smartNavigation&&this.disableScrollWheelPan())},enableNavigation:function(){var n=this.map;n&&n.loaded&&(n._evalNavigationFeature("DoubleClickZoom"),n._evalNavigationFeature("ClickRecenter"),n._evalNavigationFeature("Pan"),n._evalNavigationFeature("RubberBandZoom"),n._evalNavigationFeature("PinchZoom"),n._evalNavigationFeature("KeyboardNavigation"),n._evalNavigationFeature("ScrollWheel"))},disableNavigation:function(){var n=this.map;n&&n.loaded&&(n._evalNavigationFeature("DoubleClickZoom"),n._evalNavigationFeature("ClickRecenter"),n._evalNavigationFeature("Pan"),n._evalNavigationFeature("RubberBandZoom"),n._evalNavigationFeature("PinchZoom"),n._evalNavigationFeature("KeyboardNavigation"),n._evalNavigationFeature("ScrollWheel"))},destroy:function(){this.touchEvents&&this.touchEvents.destroy();this.mouseEvents&&this.mouseEvents.destroy();this.pointerEvents&&this.pointerEvents.destroy();for(var t=[this._panInitHandle,this._panStartHandle,this._panHandle,this._panEndHandle,this._zoomInitHandle,this._zoomHandle,this._zoomEndHandle,this._wheelHandle,this._mwMacHandle,this._dblClickHandle,this._zoomOutHandle,this._recenterHandle,this._sDblClickHandle,this._dblTapHandle,this._keyHandle,this._keyEndHandle,this._swipeInitHandle,this._swipeHandle,this._swipeEndHandle,this._pinchInitHandle,this._pinchHandle,this._pinchEndHandle],n=0;n<t.length;n++)rt(t[n]);this.map=this.touchEvents=this.mouseEvents=this.eventModel=this.pointerEvents=this._zoomRect=this._dragOrigin=this._panInitHandle=this._panStartHandle=this._panHandle=this._panEndHandle=this._zoomInitHandle=this._zoomHandle=this._zoomEndHandle=this._wheelHandle=this._mwMacHandle=this._dblClickHandle=this._zoomOutHandle=this._recenterHandle=this._sDblClickHandle=this._dblTapHandle=this._keyHandle=this._keyEndHandle=this._swipeInitHandle=this._swipeHandle=this._swipeEndHandle=this._pinchInitHandle=this._pinchHandle=this._pinchEndHandle=null}}),v("extend-esri")&&(s.MapNavigationManager=n),n})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var d,g,b=new(t([l,e],{curNode:null,activeStack:[],constructor:function(){var t=o.hitch(this,function(n){i.isDescendant(this.curNode,n)&&this.set("curNode",null);i.isDescendant(this.prevNode,n)&&this.set("prevNode",null)});n.before(f,"empty",t);n.before(f,"destroy",t)},registerIframe:function(n){return this.registerWin(n.contentWindow,n)},registerWin:function(n,t){var i=this,r=n.document&&n.document.body;if(r){var o=c("pointer-events")?"pointerdown":c("MSPointer")?"MSPointerDown":c("touch-events")?"mousedown, touchstart":"mousedown",u=s(n.document,o,function(n){n&&n.target&&null==n.target.parentNode||i._onTouchNode(t||n.target,"mouse")}),f=s(r,"focusin",function(n){if(n.target.tagName){var r=n.target.tagName.toLowerCase();"#document"!=r&&"body"!=r&&(y.isFocusable(n.target)?i._onFocusNode(t||n.target):i._onTouchNode(t||n.target))}}),e=s(r,"focusout",function(n){i._onBlurNode(t||n.target)});return{remove:function(){u.remove();f.remove();e.remove();r=u=f=e=null}}}},_onBlurNode:function(n){n=(new Date).getTime();n<d+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(o.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),n<g+100||(this._clearActiveWidgetsTimer=setTimeout(o.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(n,t){var f,e,i,o;g=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);u.contains(n,"dijitPopup")&&(n=n.firstChild);f=[];try{for(;n;)if(e=r.get(n,"dijitPopupParent"),e)n=p.byId(e).domNode;else if(n.tagName&&"body"==n.tagName.toLowerCase()){if(n===a.body())break;n=v.get(n.ownerDocument).frameElement}else i=n.getAttribute&&n.getAttribute("widgetId"),o=i&&p.byId(i),!o||"mouse"==t&&o.get("disabled")||f.unshift(i),n=n.parentNode}catch(s){}this._setStack(f,t)},_onFocusNode:function(n){n&&9!=n.nodeType&&(d=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(n),n!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",n)))},_setStack:function(n,t){var u=this.activeStack,i=u.length-1,f=n.length-1,r;if(n[f]!=u[i]){for(this.set("activeStack",n),r=i;0<=r&&u[r]!=n[r];r--)(i=p.byId(u[r]))&&(i._hasBeenBlurred=!0,i.set("focused",!1),i._focusManager==this&&i._onBlur(t),this.emit("widget-blur",i,t));for(r++;r<=f;r++)(i=p.byId(n[r]))&&(i.set("focused",!0),i._focusManager==this&&i._onFocus(t),this.emit("widget-focus",i,t))}},focus:function(n){if(n)try{n.focus()}catch(t){}}})),k;h(function(){var n=b.registerWin(v.get(document));c("ie")&&s(window,"unload",function(){n&&(n.remove(),n=null)})});w.focus=function(n){b.focus(n)};for(k in b)/^_/.test(k)||(w.focus[k]="function"==typeof b[k]?o.hitch(b,k):b[k]);return b.watch(function(n,t,i){w.focus[n]=i}),b})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(n,t,i,r,u,f,e){var o={_isElementShown:function(n){var t=r.get(n);return"hidden"!=t.visibility&&"collapsed"!=t.visibility&&"none"!=t.display&&"hidden"!=i.get(n,"type")},hasDefaultTabStop:function(n){var t,r;switch(n.nodeName.toLowerCase()){case"a":return i.has(n,"href");case"area":case"button":case"input":case"object":case"select":case"textarea":return!0;case"iframe":try{if(r=n.contentDocument,"designMode"in r&&"on"==r.designMode)return!0;t=r.body}catch(u){try{t=n.contentWindow.document.body}catch(f){return!1}}return t&&("true"==t.contentEditable||t.firstChild&&"true"==t.firstChild.contentEditable);default:return"true"==n.contentEditable}},effectiveTabIndex:function(n){if(!i.get(n,"disabled"))return i.has(n,"tabIndex")?+i.get(n,"tabIndex"):o.hasDefaultTabStop(n)?0:void 0},isTabNavigable:function(n){return 0<=o.effectiveTabIndex(n)},isFocusable:function(n){return-1<=o.effectiveTabIndex(n)},_getTabNavigable:function(n){function s(n){return n&&"input"==n.tagName.toLowerCase()&&n.type&&"radio"==n.type.toLowerCase()&&n.name&&n.name.toLowerCase()}function t(n){return a[s(n)]||n}var r,h,u,c,e,l,a={},v=o._isElementShown,p=o.effectiveTabIndex,y=function(n){for(n=n.firstChild;n;n=n.nextSibling)if(!(1!=n.nodeType||9>=f("ie")&&"HTML"!==n.scopeName)&&v(n)){var t=p(n);0<=t&&(0==t?(r||(r=n),h=n):0<t&&((!u||t<c)&&(c=t,u=n),(!e||t>=l)&&(l=t,e=n)),t=s(n),i.get(n,"checked")&&t&&(a[t]=n));"SELECT"!=n.nodeName.toUpperCase()&&y(n)}};return v(n)&&y(n),{first:t(r),last:t(h),lowest:t(u),highest:t(e)}},getFirstInTabbingOrder:function(n,i){var r=o._getTabNavigable(t.byId(n,i));return r.lowest?r.lowest:r.first},getLastInTabbingOrder:function(n,i){var r=o._getTabNavigable(t.byId(n,i));return r.last?r.last:r.highest}};return u.mixin(e,o),o})},"esri/MouseEvents":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/sniff dojo/_base/connect dojo/_base/event ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c=u.connect,l=u.disconnect;return n=n([o],{declaredClass:"esri.MouseEvents",doubleClickDuration:300,minWheelValue:1,maxWheelValue:1,mozWheelDivisor:-1!==r("mac")?1:3,wheelDivisor:2>r("chrome")?360:120,preventPageScroll:!0,map:null,constructor:function(n,u){this.node=n;i.mixin(this,u);var e=function(n){return f.stop(n),!1};r("mozilla")&&t.style(n,"MozUserSelect","none");this._handles=[c(n,"onselectstart",e),c(n,"ondragstart",e),c(n,"onmouseenter",this,this._onMouseEnterHandler),c(n,"onmouseleave",this,this._onMouseLeaveHandler),c(n,"onmousedown",this,this._onMouseDownHandler),c(n,"onclick",this,this._onClickHandler),c(n,"ondblclick",this,this._onDblClickHandler)];this._onMouseMoveHandler_connect=c(n,"onmousemove",this,this._onMouseMoveHandler);this._onMouseUpHandler_connect=c(n,"onmouseup",this,this._onMouseUpHandler);this._fireClickEvent=i.hitch(this,this._fireClickEvent);this._initialDuration=this.doubleClickDuration;this.preventPageScroll=(e=this.map)?e.isScrollWheelZoom||e.isScrollWheelPan:this.preventPageScroll;this.enableMouseWheel(!1)},_fire:function(n,t){this._preventClick&&("onClick"===n||"onDblClick"===n)||(this[n]&&this[n](t),this.map&&this.map[n]&&this.map[n](t))},_processEvent:function(n){n=f.fix(n,n.target);var i=this.map,t=i&&i.position;return t&&(n.screenPoint="DOMMouseScroll"===n.type&&3>r("ff")?new h(window.scrollX+n.screenX-t.x,window.scrollY+n.screenY-t.y):new h(n.pageX-t.x,n.pageY-t.y),n.mapPoint=i.extent?i.toMap(n.screenPoint):new s),n.numPoints=0,n},_onMouseEnterHandler:function(n){l(this._onKeyDown_connect);l(this._onKeyUp_connect);this._onKeyDown_connect=c(document,"onkeydown",this,this._onKeyDownHandler);this._onKeyUp_connect=c(document,"onkeyup",this,this._onKeyUpHandler);this._fire("onMouseOver",this._processEvent(n))},_onMouseLeaveHandler:function(n){l(this._onKeyDown_connect);l(this._onKeyUp_connect);this._onKeyDown_connect=this._onKeyUp_connect=null;this._fire("onMouseOut",this._processEvent(n))},_onMouseMoveHandler:function(n){this._dragEnd?this._dragEnd=!1:this._fire("onMouseMove",this._processEvent(n))},_onMouseDownHandler:function(n){l(this._onMouseMoveHandler_connect);this._onMouseMoveHandler_connect=null;this.node.setCapture&&this.node.setCapture(!1);l(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=c(document,"onmousemove",this,this._onMouseDragHandler);this._startX=n.pageX;this._startY=n.pageY;this._fire("onMouseDown",this._processEvent(n))},_onMouseUpHandler:function(n){var t=this.node;t.releaseCapture&&t.releaseCapture();l(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=null;l(this._onMouseMoveHandler_connect);this._onMouseMoveHandler_connect=c(t,"onmousemove",this,this._onMouseMoveHandler);this._fire("onMouseUp",this._processEvent(n))},_onMouseDragHandler:function(n){l(this._onMouseDragHandler_connect);this._onMouseDragHandler_connect=c(document,"onmousemove",this,this._onMouseDraggingHandler);l(this._onMouseUpHandler_connect);this._onMouseUpHandler_connect=c(document,"onmouseup",this,this._onDragMouseUpHandler);this._docLeaveConnect=c(document,"onmouseout",this,this._onDocMouseOut);this._fire("onMouseDragStart",this._processEvent(n))},_onMouseDraggingHandler:function(n){f.stop(n);this._fire("onMouseDrag",this._processEvent(n))},_onDragMouseUpHandler:function(n){var t=this.node;t.releaseCapture&&t.releaseCapture();this._dragEnd=!0;l(this._docLeaveConnect);l(this._onMouseDragHandler_connect);l(this._onMouseUpHandler_connect);this._docLeaveConnect=this._onMouseDragHandler_connect=null;this._onMouseMoveHandler_connect=c(t,"onmousemove",this,this._onMouseMoveHandler);this._onMouseUpHandler_connect=c(t,"onmouseup",this,this._onMouseUpHandler);n=this._processEvent(n);this._fire("onMouseDragEnd",n);this._fire("onMouseUp",n)},_onDocMouseOut:function(n){var t=9>r("ie")?n.toElement:n.relatedTarget,i=t&&t.nodeName.toLowerCase();(!t||(r("chrome")||r("safari"))&&"html"===i)&&this._onDragMouseUpHandler(n)},_onClickHandler:function(n){if(n=this._processEvent(n),n.pageX===this._startX&&n.pageY===this._startY){clearTimeout(this._clickTimer);var i={},r="movementX"in n;for(var t in n)r&&("webkitMovementX"===t||"webkitMovementY"===t)||(i[t]=n[t]);this._clickEvent=i;this._clickTimer=setTimeout(this._fireClickEvent,this.doubleClickDuration)}},_fireClickEvent:function(){clearTimeout(this._clickTimer);9>r("ie")&&(this._clickEvent.graphic=e._ieGraphic,delete e._ieGraphic);this._fire("onClick",this._clickEvent)},_onDblClickHandler:function(n){clearTimeout(this._clickTimer);this._fire("onDblClick",this._processEvent(n))},_onMouseWheelHandler:function(n){var t=this.map;(t?t.isScrollWheelZoom||t.isScrollWheelPan:this.preventPageScroll)&&f.stop(n);var t=r("ff")||r("mozilla")?-n.detail/this.mozWheelDivisor:n.wheelDelta/this.wheelDivisor,i=Math.abs(t),i=i<=this.minWheelValue?this.minWheelValue:this.maxWheelValue;n.value=0>t?-i:i;this._fire("onMouseWheel",this._processEvent(n))},_onKeyDownHandler:function(n){this._fire("onKeyDown",n)},_onKeyUpHandler:function(n){this._fire("onKeyUp",n)},enableMouseWheel:function(n){l(this._scrollHandle);this._scrollHandle=c(this.node,r("ff")||r("mozilla")?n?"MozMousePixelScroll":"DOMMouseScroll":"onmousewheel",this,this._onMouseWheelHandler)},setImmediateClick:function(n){this.doubleClickDuration=n?0:this._initialDuration},preventClickEvents:function(n){this._preventClick=n},destroy:function(){for(var t=this._handles.concat([this._onMouseMoveHandler_connect,this._onMouseUpHandler_connect,this._onMouseDragHandler_connect,this._scrollHandle,this._onKeyDown_connect,this._onKeyUp_connect,this._docLeaveConnect]),n=0;n<t.length;n++)l(t[n]);clearTimeout(this._clickTimer);this.node=this.map=this._handles=this._clickEvent=this._onMouseMoveHandler_connect=this._onMouseUpHandler_connect=this._onMouseDragHandler_connect=this._scrollHandle=this._onKeyDown_connect=this._onKeyUp_connect=this._docLeaveConnect=null}}),r("extend-esri")&&(e.MouseEvents=n),n})},"esri/TouchEvents":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/sniff dojo/dom ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n([e],{declaredClass:"esri.TouchEvents",tapRadius:8,doubleTapRadius:10,tapStartTolerance:50,doubleTapDuration:300,map:null,constructor:function(n,u){this.node=n;i.mixin(this,u);t.setSelectable(n,!1);this._touchStart=i.hitch(this,this._touchStart);this._touchMove=i.hitch(this,this._touchMove);this._touchEnd=i.hitch(this,this._touchEnd);this._touchCancel=i.hitch(this,this._touchCancel);n.addEventListener("touchstart",this._touchStart,!1);n.addEventListener("touchmove",this._touchMove,!1);n.addEventListener("touchend",this._touchEnd,!1);n.addEventListener("touchcancel",this._touchCancel,!1);this.map&&r("ios")&&(this._mouseOver=i.hitch(this,this._mouseOver),this._mouseOut=i.hitch(this,this._mouseOut),this._mouseDown=i.hitch(this,this._mouseDown),this._mouseUp=i.hitch(this,this._mouseUp),this._mouseClick=i.hitch(this,this._mouseClick),n.addEventListener("mouseover",this._mouseOver,!1),n.addEventListener("mouseout",this._mouseOut,!1),n.addEventListener("mousedown",this._mouseDown,!1),n.addEventListener("mouseup",this._mouseUp,!1),n.addEventListener("click",this._mouseClick,!1));this._numTouches=0;this._nodeTouches=[];this._touches={};this._touchIds=[];this._taps=[];this._immediate=!1},_touchStart:function(n){var e=this._touches,f,s=n.changedTouches.length,u,i,t,o,h=(new Date).getTime();if(!(r("android")&&r("safari")&&1===n.targetTouches.length&&n.touches.length===n.targetTouches.length&&n.targetTouches.length===n.changedTouches.length&&0===n.changedTouches[0].identifier&&e[n.changedTouches[0].identifier])){for(this._addTouch(n),f=0;f<s;f++)u=n.changedTouches[f],i=e[u.identifier]={},i.startX=u.pageX,i.startY=u.pageY,i.startTS=h,-1===this._touchIds.indexOf(u.identifier)&&this._touchIds.push(u.identifier);this._swipeActive&&(t=this._nodeTouches[0]);this._pinchActive&&(o=this._nodeTouches[1]);1===this._numTouches?this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,t))):this._pinchActive&&(this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(n,[t,o]))):2===this._numTouches?this._swipeActive&&(t&&(i=e[this._touchIds[0]],i.startX=t.pageX,i.startY=t.pageY,i.moved=!1),this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,t))):this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,t))):this._pinchActive&&(this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(n,[t,o])))}},_touchMove:function(n){n.preventDefault();this._updateTouch(n);var u=this._touches,f,e=n.changedTouches.length,o,t,s,i;if(!(r("android")&&r("safari")&&1===n.targetTouches.length&&n.touches.length===n.targetTouches.length&&n.targetTouches.length===n.changedTouches.length&&0===n.changedTouches[0].identifier&&u[n.changedTouches[0].identifier]&&1<this._touchIds.length)){for(f=0;f<e;f++)(o=n.changedTouches[f],t=u[o.identifier])&&(s=Math.abs(o.pageX-t.startX),o=Math.abs(o.pageY-t.startY),!t.moved&&(s>=this.tapRadius||o>=this.tapRadius)&&(t.moved=t.absMoved=!0),i=i?i:t.moved);1===this._numTouches?(u=n.changedTouches[0],this._swipeActive?this._fire("onSwipeMove",this._processTouchEvent(n,u)):i&&(this._swipeActive=!0,this._fire("onSwipeStart",this._processTouchEvent(n,u)))):2===this._numTouches&&(f=this._nodeTouches[0],e=this._nodeTouches[1],this._pinchActive?this._fire("onPinchMove",this._processTouchEvent(n,[f,e])):i&&(i=u[f.identifier],t=u[e.identifier],u=Math.abs(i.startX-t.startX),i=Math.abs(i.startY-t.startY),t=Math.abs(f.pageX-e.pageX),s=Math.abs(f.pageY-e.pageY),Math.abs(Math.sqrt(t*t+s*s)-Math.sqrt(u*u+i*i))>=2*this.tapRadius&&(this._pinchActive=!0,this._fire("onPinchStart",this._processTouchEvent(n,[f,e])))))}},_touchEnd:function(n){this._removeTouch(n);for(var u=this._touches,r=n.changedTouches,e=r.length,f,t,s=(new Date).getTime(),h=this._touchIds,i=0;i<e;i++)(t=u[r[i].identifier])&&(t.absMoved&&(f=!0),t.pageX=r[i].pageX,t.pageY=r[i].pageY,t.endTS=s);if(0===this._numTouches){if(this._touches={},this._touchIds=[],this._swipeActive)this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,r[0]));else if(this._pinchActive)this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(n,r));else if(!f){e=Infinity;f=-Infinity;var s=Infinity,c=-Infinity,l=this.tapStartTolerance,o=[],a=!0;for(i=0;i<h.length;i++)t=u[h[i]],o.push(t),t.startTS<e&&(e=t.startTS),t.startTS>f&&(f=t.startTS),t.endTS<s&&(s=t.endTS),t.endTS>c&&(c=t.endTS),delete u[h[i]];1===o.length&&r[0]&&(u=Math.abs(r[0].pageY-o[0].startY),Math.abs(r[0].pageX-o[0].startX)>=this.tapRadius||u>=this.tapRadius)&&(a=!1);a&&Math.abs(f-e)<=l&&Math.abs(c-s)<=l&&this._basicTap(n,o)}}else 1===this._numTouches&&this._pinchActive&&(i=this._nodeTouches[0],t=u[i.identifier],t.startX=i.pageX,t.startY=i.pageY,this._pinchActive=t.moved=!1,this._fire("onPinchEnd",this._processTouchEvent(n,[r[0],i])))},_touchCancel:function(n){this._numTouches&&this._touchEnd(n)},_basicTap:function(n,t){var r=(new Date).getTime(),i=this;n=this._processTouchEvent(n,t);this._taps.push({touchInfos:t,ts:r,event:n});2<this._taps.length&&this._taps.shift();this._fire("onBasicTap",n);clearTimeout(this._tapTimer);this._immediate?this._analyzeTap(!0):this._tapTimer=setTimeout(function(){var n=i;i=null;clearTimeout(n._tapTimer);n._analyzeTap()},2===this._taps.length?this.doubleTapDuration/2:this.doubleTapDuration)},_analyzeTap:function(n){var r=this._taps,u=r[0],i=r[1],t=u.touchInfos,f=i&&i.touchInfos;r.length&&(n||(this._taps=[]),u&&i?t.length===f.length?i.ts-u.ts<=this.doubleTapDuration?(1===t.length?(n=Math.abs(t[0].startX-f[0].startX),t=Math.abs(t[0].startY-f[0].startY),t=n<=this.doubleTapRadius&&t<=this.doubleTapRadius):t=!0,t?this._processedDoubleTap(r):this._processedTap(i)):this._processedTap(i):this._processedTap(i):this._processedTap(u||i))},_processedTap:function(n){var t=n.event;this._fire("onProcessedTap",t);1===n.touchInfos.length?this._fire("onTap",this._fixEvent(t)):2===n.touchInfos.length&&this._fire("onTwoFingerTap",t)},_processedDoubleTap:function(n){var i=1===n[1].touchInfos.length,t;i&&(t=[this._fixEvent(n[0].event),this._fixEvent(n[1].event)],t[1].relatedEvents=t);n=[n[0].event,n[1].event];n[1].relatedEvents=n;this._fire("onProcessedDoubleTap",n[1]);i&&(this._fire("onDoubleTap",t[1]),this._fire("onDblClick",t[1]))},_addTouch:function(n){var i=n.changedTouches,t=this._nodeTouches,r,e,f;for(this._numTouches+=i.length,n=0;n<i.length;n++){for(e=t.length,f=!1,r=0;r<e&&!(f=t[r].identifier===i[n].identifier);r++);f?this._numTouches--:t.push(i[n])}for(n=t.length-1;0<=n;n--)u.isDescendant(t[n].target,document.body)||(t.splice(n,1),this._numTouches--);0>this._numTouches&&(this._numTouches=0)},_removeTouch:function(n){var r=[],u=[],t=n.changedTouches,i=this._nodeTouches;for(this._numTouches-=t.length,0>this._numTouches&&(this._numTouches=0),n=0;n<t.length;n++)r.push(t[n].identifier);for(n=i.length-1;0<=n;n--)-1!==r.indexOf(i[n].identifier)&&u.push(i.splice(n,1)[0]);return u},_updateTouch:function(n){var u=[],t,i=n.changedTouches,r=this._nodeTouches;for(n=0;n<i.length;n++)u.push(i[n].identifier);for(n=0;n<r.length;n++)t=u.indexOf(r[n].identifier),-1!==t&&r.splice(n,1,i[t])},_mouseOver:function(n){this._fire("onMouseOver",this._processMouseEvent(n))},_mouseOut:function(n){this._fire("onMouseOut",this._processMouseEvent(n))},_mouseDown:function(n){this._fire("onMouseDown",this._processMouseEvent(n))},_mouseUp:function(n){this._fire("onMouseUp",this._processMouseEvent(n))},_mouseClick:function(n){this._fire("onClick",this._processMouseEvent(n))},_fire:function(n,t){if("onDblClick"===n&&this.mouseEvents){this.mouseEvents.preventClickEvents(!0);var i=this;setTimeout(function(){i.mouseEvents.preventClickEvents(!1)},350)}this[n]&&this[n](t);this.map&&this.map[n]&&this.map[n](t)},_fixEvent:function(n){var t={};for(var i in n)t[i]=n[i];return this.map&&(t.screenPoint=t.screenPoints[0],t.mapPoint=t.mapPoints[0]),t},_processTouchEvent:function(n,t){var r=this.map,f=r&&r.position,h=0,u,e;if(f&&t)if(i.isArray(t))for(n.screenPoints=[],n.mapPoints=[],u=0;u<t.length;u++)t[u]?(e=new s(t[u].pageX-f.x,t[u].pageY-f.y),n.screenPoints.push(e),n.mapPoints.push(r.extent?r.toMap(e):new o)):h++;else n.screenPoint=new s(t.pageX-f.x,t.pageY-f.y),n.mapPoint=r.extent?r.toMap(n.screenPoint):new o;return n.numPoints=t?i.isArray(t)?t.length-h:1:0,n},_processMouseEvent:function(n){var t=this.map,i=t&&t.position;return i&&(n.screenPoint=new s(n.pageX-i.x,n.pageY-i.y),n.mapPoint=t.extent?t.toMap(n.screenPoint):new o),n},setImmediateTap:function(n){this._immediate=n},destroy:function(){var n=this.node;n.removeEventListener("touchstart",this._touchStart,!1);n.removeEventListener("touchmove",this._touchMove,!1);n.removeEventListener("touchend",this._touchEnd,!1);n.removeEventListener("touchcancel",this._touchCancel,!1);this.map&&(n.removeEventListener("mouseover",this._mouseOver,!1),n.removeEventListener("mouseout",this._mouseOut,!1),n.removeEventListener("mousedown",this._mouseDown,!1),n.removeEventListener("mouseup",this._mouseUp,!1),n.removeEventListener("click",this._mouseClick,!1));t.setSelectable(n,!0);clearTimeout(this._tapTimer);this.node=this.map=this._numTouches=this._nodeTouches=this._touches=this._touchIds=this._taps=null}}),r("extend-esri")&&(f.TouchEvents=n),n})},"esri/PointerEvents":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ./kernel ./Evented ./geometry/Point ./geometry/ScreenPoint".split(" "),function(n,t,i,r,u,f,e,o){return n=n([f],{declaredClass:"esri.PointerEvents",tapRadius:8,clickRadius:2,doubleTapRadius:10,tapStartTolerance:50,doubleTapDuration:300,minWheelValue:1,maxWheelValue:1,mozWheelDivisor:-1!==r("mac")?1:3,wheelDivisor:120,preventPageScroll:!0,_dragging:!1,constructor:function(n,i){this.node=n;t.mixin(this,i);void 0!==n.style.msTouchAction?n.style.msTouchAction="none":void 0!==n.style.touchAction&&(n.style.touchAction="none");var r=navigator.msPointerEnabled,u=function(n){n.preventDefault()};n.addEventListener("selectstart",u,!1);n.addEventListener("dragstart",u,!1);this._pointerDown=t.hitch(this,this._pointerDown);this._pointerMove=t.hitch(this,this._pointerMove);this._pointerUp=t.hitch(this,this._pointerUp);this._pointerCancel=t.hitch(this,this._pointerCancel);n.addEventListener(r?"MSPointerDown":"pointerdown",this._pointerDown,!1);n.addEventListener(r?"MSPointerMove":"pointermove",this._pointerMove,!1);n.addEventListener(r?"MSPointerUp":"pointerup",this._pointerUp,!1);n.addEventListener(r?"MSPointerCancel":"pointercancel",this._pointerCancel,!1);this.map&&(this._mouseOver=t.hitch(this,this._mouseOver),this._mouseOut=t.hitch(this,this._mouseOut),this._mouseLeave=t.hitch(this,this._mouseLeave),this._mouseDown=t.hitch(this,this._mouseDown),this._mouseUp=t.hitch(this,this._mouseUp),this._mouseClick=t.hitch(this,this._mouseClick),this._mouseWheel=t.hitch(this,this._mouseWheel),this._mouseMove=t.hitch(this,this._mouseMove),this._mouseEnter=t.hitch(this,this._mouseEnter),this._onKeyDown=t.hitch(this,this._onKeyDown),this._onKeyUp=t.hitch(this,this._onKeyUp),n.addEventListener("mouseover",this._mouseOver,!1),n.addEventListener("mouseout",this._mouseOut,!1),n.addEventListener("mouseleave",this._mouseLeave,!1),n.addEventListener("mousedown",this._mouseDown,!1),n.addEventListener("mouseup",this._mouseUp,!1),n.addEventListener("click",this._mouseClick,!1),n.addEventListener("mousewheel",this._mouseWheel,!1),n.addEventListener("mousemove",this._mouseMove,!1),n.addEventListener("mouseenter",this._mouseEnter,!1));this._numTouches=0;this._touches={};this._touchIds=[];this._taps=[];this._immediate=!1},_pointerDown:function(n){if(-1<i.indexOf(this._touchIds,n.pointerId))this._pointerUp(n);else{var u=this._touches,t=n.target,f=n.pointerId,e=this._touchIds,r,o=(new Date).getTime();r=u[f]={};r.pointerId=f;r.startX=r.pageX=n.pageX;r.startY=r.pageY=n.pageY;r.startTS=o;e.push(f);this._numTouches++;t.setPointerCapture?t.setPointerCapture(f):t.msSetPointerCapture&&t.msSetPointerCapture(f);t=u[e[0]];u=u[e[1]];1!==this._numTouches&&(2===this._numTouches?this._swipeActive&&(t&&(t.startX=t.pageX,t.startY=t.pageY,t.moved=!1),this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,t))):this._swipeActive?(this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,t))):this._pinchActive&&(this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(n,[t,u]))))}},_pointerMove:function(n){var i=this._touches,r=this._touchIds,t,u,f,e;(t=i[n.pointerId])&&(t.pageX!==n.pageX||t.pageY!==n.pageY)&&((t.pageX=n.pageX,t.pageY=n.pageY,u=Math.abs(t.pageX-t.startX),f=Math.abs(t.pageY-t.startY),!t.moved&&(u>=this.tapRadius||f>=this.tapRadius)&&(t.moved=t.absMoved=!0),1===this._numTouches)?this._swipeActive?this._fire("onSwipeMove",this._processTouchEvent(n,n)):t.moved&&(this._swipeActive=!0,this._fire("onSwipeStart",this._processTouchEvent(n,n))):2===this._numTouches&&((t=i[r[0]],i=i[r[1]],this._pinchActive)?this._fire("onPinchMove",this._processTouchEvent(n,[t,i])):(t.moved||i.moved)&&(r=Math.abs(t.startX-i.startX),u=Math.abs(t.startY-i.startY),f=Math.abs(t.pageX-i.pageX),e=Math.abs(t.pageY-i.pageY),Math.abs(Math.sqrt(f*f+e*e)-Math.sqrt(r*r+u*u))>=2*this.tapRadius&&(this._pinchActive=!0,this._fire("onPinchStart",this._processTouchEvent(n,[t,i]))))))},_pointerUp:function(n){var e=this._touches,t,a=this.node,r=n.target,f=n.pointerId,u=this._touchIds,o=u.slice(0),c=i.map(o,function(n){return e[n]}),s=(new Date).getTime();if(t=e[f])if(t.pageX=n.pageX,t.pageY=n.pageY,t.endTS=s,this._numTouches--,r.releasePointerCapture?r.releasePointerCapture(f):r.msReleasePointerCapture&&r.msReleasePointerCapture(f),0===this._numTouches){if(this._touches={},this._touchIds=[],this._swipeActive)this._swipeActive=!1,this._fire("onSwipeEnd",this._processTouchEvent(n,n));else if(this._pinchActive)this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(n,n));else if(!t.absMoved){for(var r=Infinity,f=-Infinity,u=Infinity,s=-Infinity,l=this.tapStartTolerance,h=0;h<o.length;h++)t=c[h],t.startTS<r&&(r=t.startTS),t.startTS>f&&(f=t.startTS),t.endTS<u&&(u=t.endTS),t.endTS>s&&(s=t.endTS);Math.abs(f-r)<=l&&Math.abs(s-u)<=l&&this._basicTap(n,c)}}else 1===this._numTouches&&this._pinchActive&&(u.splice(i.indexOf(u,n.pointerId),1),delete e[n.pointerId],t=e[u[0]],t.startX=t.pageX,t.startY=t.pageY,t.moved=!1,document.msElementsFromPoint&&(o=document.msElementsFromPoint(t.pageX,t.pageY),i.some(o,function(n){return n===a})||(this._touches={},this._touchIds=[],this._numTouches=0)),this._pinchActive=!1,this._fire("onPinchEnd",this._processTouchEvent(n,[n,t])))},_pointerCancel:function(n){this._numTouches&&this._pointerUp(n)},_basicTap:function(n,t){var i=(new Date).getTime(),r=this,u=this._immediate;n=this._processTouchEvent(n,t);this._taps.push({touchInfos:t,ts:i,event:n});2<this._taps.length&&this._taps.shift();this._fire("onBasicTap",n);clearTimeout(this._tapTimer);i=2===this._taps.length?this.doubleTapDuration/2:this.doubleTapDuration;this._tapTimer=setTimeout(function(){var n=r;r=null;clearTimeout(n._tapTimer);n._analyzeTap(u)},u?0:i)},_analyzeTap:function(n){var r=this._taps,u=r[0],i=r[1],t=u.touchInfos,f=i&&i.touchInfos;r.length&&(n||(this._taps=[]),u&&i?t.length===f.length?i.ts-u.ts<=this.doubleTapDuration?(1===t.length?(n=Math.abs(t[0].startX-f[0].startX),t=Math.abs(t[0].startY-f[0].startY),t=n<=this.doubleTapRadius&&t<=this.doubleTapRadius):t=!0,t?this._processedDoubleTap(r):this._processedTap(i)):this._processedTap(i):this._processedTap(i):this._processedTap(u||i))},_processedTap:function(n){var t=n.event;this._fire("onProcessedTap",t);1===n.touchInfos.length?this._fire("onTap",this._fixEvent(t)):2===n.touchInfos.length&&this._fire("onTwoFingerTap",t)},_processedDoubleTap:function(n){var i=1===n[1].touchInfos.length,t;i&&(t=[this._fixEvent(n[0].event),this._fixEvent(n[1].event)],t[1].relatedEvents=t);n=[n[0].event,n[1].event];n[1].relatedEvents=n;this._fire("onProcessedDoubleTap",n[1]);i&&(this._fire("onDoubleTap",t[1]),this._fire("onDblClick",t[1]))},_mouseOver:function(n){this._fire("onMouseOver",this._processMouseEvent(n))},_mouseMove:function(n){this._dragging?this._fire("onMouseDrag",this._processMouseEvent(n)):this._fire("onMouseMove",this._processMouseEvent(n))},_mouseOut:function(n){this._fire("onMouseOut",this._processMouseEvent(n))},_mouseLeave:function(){document.removeEventListener("keydown",this._onKeyDown,!1);document.removeEventListener("keyup",this._onKeyUp,!1);this._fire("onMouseOut",this._processMouseEvent(event))},_mouseDown:function(n){this._downX=n.pageX;this._downY=n.pageY;this._fire("onMouseDown",this._processMouseEvent(n));0===n.button&&(this._dragging=!0,this._fire("onMouseDragStart",this._processMouseEvent(n)))},_mouseUp:function(n){this._dragging&&(this._dragging=!1,this._fire("onMouseDragEnd",this._processMouseEvent(n)));this._fire("onMouseUp",this._processMouseEvent(n))},_mouseClick:function(n){Math.abs(n.pageX-this._downX)<=this.clickRadius&&Math.abs(n.pageY-this._downY)<=this.clickRadius&&this._fire("onClick",this._processMouseEvent(n))},_mouseWheel:function(n){var t=this.map;(t?t.isScrollWheelZoom||t.isScrollWheelPan:this.preventPageScroll)&&n.preventDefault();var t=n.wheelDelta?n.wheelDelta/this.wheelDivisor:-n.detail/this.mozWheelDivisor,i=Math.abs(t),i=i<=this.minWheelValue?this.minWheelValue:this.maxWheelValue;n.value=0>t?-i:i;this._fire("onMouseWheel",this._processMouseEvent(n))},_mouseEnter:function(n){document.removeEventListener("keydown",this._onKeyDown,!1);document.removeEventListener("keyup",this._onKeyUp,!1);document.addEventListener("keydown",this._onKeyDown,!1);document.addEventListener("keyup",this._onKeyUp,!1);this._fire("onMouseEnter",this._processMouseEvent(n))},_onKeyDown:function(n){this._fire("onKeyDown",n)},_onKeyUp:function(n){this._fire("onKeyUp",n)},_fire:function(n,t){this[n]&&this[n](t);this.map&&this.map[n]&&this.map[n](t)},_fixEvent:function(n){var t={};for(var i in n)t[i]=n[i];return t.preventDefault=function(){n.preventDefault()},t.stopPropagation=function(){n.stopPropagation()},this.map&&(t.screenPoint=t.screenPoints[0],t.mapPoint=t.mapPoints[0]),t},_processTouchEvent:function(n,i){var r=this.map,f=r&&r.position,h=0,u,s;if(f&&i)if(t.isArray(i))for(n.screenPoints=[],n.mapPoints=[],u=0;u<i.length;u++)i[u]?(s=new o(i[u].pageX-f.x,i[u].pageY-f.y),n.screenPoints.push(s),n.mapPoints.push(r.extent?r.toMap(s):new e)):h++;else n.screenPoint=new o(i.pageX-f.x,i.pageY-f.y),n.mapPoint=r.extent?r.toMap(n.screenPoint):new e;return n.numPoints=i?t.isArray(i)?i.length-h:1:0,n},_processMouseEvent:function(n){var t=this.map,i=t&&t.position;return i&&(n.screenPoint=new o(n.pageX-i.x,n.pageY-i.y),n.mapPoint=t.extent?t.toMap(n.screenPoint):new e),n},setImmediateTap:function(n){this._immediate=n},destroy:function(){var n=this.node;n.removeEventListener("MSPointerDown",this._pointerDown,!1);n.removeEventListener("MSPointerMove",this._pointerMove,!1);n.removeEventListener("MSPointerUp",this._pointerUp,!1);n.removeEventListener("MSPointerCancel",this._pointerCancel,!1);this.map&&(n.removeEventListener("mouseover",this._mouseOver,!1),n.removeEventListener("mousemove",this._mouseMove,!1),n.removeEventListener("mouseout",this._mouseOut,!1),n.removeEventListener("mouseleave",this._mouseLeave,!1),n.removeEventListener("mousedown",this._mouseDown,!1),n.removeEventListener("mouseup",this._mouseUp,!1),n.removeEventListener("click",this._mouseClick,!1),n.removeEventListener("mouseenter",this._mouseEnter,!1));clearTimeout(this._tapTimer);this.node=this.map=this._numTouches=this._touches=this._touchIds=this._taps=null}}),r("extend-esri")&&(u.PointerEvents=n),n})},"esri/geometry":function(){define("./units ./SpatialReference ./geometry/Geometry ./geometry/Point ./geometry/ScreenPoint ./geometry/Multipoint ./geometry/Polyline ./geometry/Polygon ./geometry/Extent ./geometry/Rect ./geometry/geodesicUtils ./geometry/jsonUtils ./geometry/mathUtils ./geometry/normalizeUtils ./geometry/scaleUtils ./geometry/screenUtils ./geometry/webMercatorUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){return{units:n,SpatialReference:t,Geometry:i,Point:r,ScreenPoint:u,Multipoint:f,Polyline:e,Polygon:o,Extent:s,Rect:h,geodesicUtils:c,jsonUtils:l,mathUtils:a,normalizeUtils:v,scaleUtils:y,screenUtils:p,webMercatorUtils:w}})},"esri/units":function(){define(["dojo/has","./kernel"],function(n,t){var i={CENTIMETERS:"esriCentimeters",DECIMAL_DEGREES:"esriDecimalDegrees",DEGREE_MINUTE_SECONDS:"esriDegreeMinuteSeconds",DECIMETERS:"esriDecimeters",FEET:"esriFeet",FEET_US:"esriFeetUS",INCHES:"esriInches",KILOMETERS:"esriKilometers",METERS:"esriMeters",MILES:"esriMiles",MILES_US:"esriMilesUS",MILLIMETERS:"esriMillimeters",NAUTICAL_MILES:"esriNauticalMiles",POINTS:"esriPoints",UNKNOWN:"esriUnknownUnits",YARDS:"esriYards",YARDS_US:"esriYardsUS",ACRES:"esriAcres",ACRES_US:"esriAcresUS",ARES:"esriAres",SQUARE_KILOMETERS:"esriSquareKilometers",SQUARE_MILES:"esriSquareMiles",SQUARE_MILES_US:"esriSquareMilesUS",SQUARE_FEET:"esriSquareFeet",SQUARE_FEET_US:"esriSquareFeetUS",SQUARE_METERS:"esriSquareMeters",HECTARES:"esriHectares",SQUARE_YARDS:"esriSquareYards",SQUARE_YARDS_US:"esriSquareYardsUS",SQUARE_INCHES:"esriSquareInches",SQUARE_MILLIMETERS:"esriSquareMillimeters",SQUARE_CENTIMETERS:"esriSquareCentimeters",SQUARE_DECIMETERS:"esriSquareDecimeters",SQUARE_NAUTICAL_MILES:"esriSquareNauticalMiles",METERS_PER_SECOND:"esriMetersPerSecond",KILOMETERS_PER_HOUR:"esriKilometersPerHour",KNOTS:"esriKnots",FEET_PER_SECOND:"esriFeetPerSecond",MILES_PER_HOUR:"esriMilesPerHour",RADIANS:"esriDURadians"};return n("extend-esri")&&(t.Units=i),i})},"esri/geometry/geodesicUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/has ../kernel ../SpatialReference ./Point ./Polyline ./Polygon".split(" "),function(n,t,i,r,u,f,e,o){function p(n){return!!(n&&n.wkid&&y[n.wkid])}function h(n){return p(n)?y[n.wkid]:y[4326]}function c(n){var e=n.spatialReference,t=h(e),r=t.a,t=t.eSq,u=Math.sqrt(t),i=Math.sin(n.y*s);return new f(r*n.x*s,0<t?r*(1-t)*(i/(1-t*i*i)-1/(2*u)*Math.log((1-u*i)/(1+u*i)))*.5:r*i,e)}function l(n,t,i,r,u){var a=h(u),e=a.a,o=a.b,a=a.f,k=Math.sin(i),v;i=Math.cos(i);v=(1-a)*Math.tan(n);n=1/Math.sqrt(1+v*v);for(var p=v*n,it=Math.atan2(v,i),v=n*k,d=v*v,w=1-d,e=w*(e*e-o*o)/(o*o),g=1+e/16384*(4096+e*(-768+e*(320-175*e))),b=e/1024*(256+e*(-128+e*(74-47*e))),e=r/(o*g),nt=2*Math.PI,l,y,c,tt;1e-12<Math.abs(e-nt);)c=Math.cos(2*it+e),l=Math.sin(e),y=Math.cos(e),tt=b*l*(c+b/4*(y*(-1+2*c*c)-b/6*c*(-3+4*l*l)*(-3+4*c*c))),nt=e,e=r/(o*g)+tt;return r=p*l-n*y*i,o=a/16*w*(4+a*(4-3*w)),new f((t+(Math.atan2(l*k,n*y-p*l*i)-(1-o)*a*v*(e+o*l*(c+o*y*(-1+2*c*c)))))/s,Math.atan2(p*y+n*l*i,(1-a)*Math.sqrt(d+r*r))/s,u)}function a(n,t,i,r,u){var w=h(u),g=w.a;u=w.b;var y=w.f,nt=r-t,o=Math.atan((1-y)*Math.tan(n)),e=Math.atan((1-y)*Math.tan(i)),a=Math.sin(o),o=Math.cos(o),v=Math.sin(e),e=Math.cos(e),s=nt,tt,it=1e3,p,l,f,c,d,b,k;do{if(f=Math.sin(s),c=Math.cos(s),l=Math.sqrt(e*f*e*f+(o*v-a*e*c)*(o*v-a*e*c)),0===l)return 0;c=a*v+o*e*c;d=Math.atan2(l,c);b=o*e*f/l;p=1-b*b;f=c-2*a*v/p;isNaN(f)&&(f=0);k=y/16*p*(4+y*(4-3*p));tt=s;s=nt+(1-k)*y*b*(d+k*l*(f+k*c*(-1+2*f*f)))}while(1e-12<Math.abs(s-tt)&&0<--it);return 0===it?(u=r-t,{azimuth:Math.atan2(Math.sin(u)*Math.cos(i),Math.cos(n)*Math.sin(i)-Math.sin(n)*Math.cos(i)*Math.cos(u)),geodesicDistance:Math.acos(Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos(r-t))*w.radius}):(n=p*(g*g-u*u)/(u*u),t=n/1024*(256+n*(-128+n*(74-47*n))),{azimuth:Math.atan2(e*Math.sin(s),o*v-a*e*Math.cos(s)),geodesicDistance:u*(1+n/16384*(4096+n*(-768+n*(320-175*n))))*(d-t*l*(f+t/4*(c*(-1+2*f*f)-t/6*f*(-3+4*l*l)*(-3+4*f*f)))),reverseAzimuth:Math.atan2(o*Math.sin(s),o*v*Math.cos(s)-a*e)})}function w(t,i){var r,u,c,f;if(!(t instanceof e||t instanceof o))throw console.error("_geodesicDensify: the input geometry is neither polyline nor polygon"),Error("_geodesicDensify: the input geometry is neither polyline nor polygon");return r=t.spatialReference,u=h(r).radius/1e4,i<u&&(i=u),u=t instanceof e,c=[],n.forEach(u?t.paths:t.rings,function(n){var e,t,o,u,v,h,y,p;for(c.push(f=[]),f.push([n[0][0],n[0][1]]),e=n[0][0]*s,t=n[0][1]*s,v=0;v<n.length-1;v++)if(o=n[v+1][0]*s,u=n[v+1][1]*s,e!==o||t!==u){if(u=a(t,e,u,o,r),o=u.azimuth,u=u.geodesicDistance,y=u/i,1<y){for(h=1;h<=y-1;h++)p=l(t,e,o,h*i,r),f.push([p.x,p.y]);h=l(t,e,o,(u+Math.floor(y-1)*i)/2,r);f.push([h.x,h.y])}t=l(t,e,o,u,r);f.push([t.x,t.y]);e=t.x*s;t=t.y*s}}),u?new e({paths:c,spatialReference:r}):new o({rings:c,spatialReference:r})}var v={esriMeters:1,esriKilometers:1e3,esriYards:.9144,esriFeet:.3048,esriMiles:1609.344,esriNauticalMiles:1852,esriInches:.0254,esriDecimeters:.1,esriCentimeters:.01,esriMillimeters:.001,esriSquareMeters:1,esriSquareKilometers:1e6,esriSquareYards:.83612736,esriSquareFeet:.09290304,esriSquareMiles:2589988.110336,esriAcres:4046.8564224,esriHectares:1e4,esriAres:100,esriSquareInches:.00064516,esriSquareMillimeters:1e-6,esriSquareCentimeters:.0001,esriSquareDecimeters:.01},s=Math.PI/180,y={4326:{a:6378137,b:6356752.31424518,f:1/298.257223563,eSq:.0066943799901974139,radius:6371008.7714150595},104900:{a:2439700,b:2439700,f:0,eSq:0,radius:2439700},104901:{a:6051e3,b:6051e3,f:0,eSq:0,radius:6051e3},104902:{a:6051800,b:6051800,f:0,eSq:0,radius:6051800},104903:{a:1737400,b:1737400,f:0,eSq:0,radius:1737400},104904:{a:3393400,b:3375730,f:1/192.04301075,eSq:.01038722,radius:3387510},104905:{a:3396190,b:3376200,f:1/169.89444722,eSq:.01173737,radius:3389526.6666666665},104906:{a:6200,b:6200,f:0,eSq:0,radius:6200},104907:{a:11100,b:11100,f:0,eSq:0,radius:11100},104912:{a:2409300,b:2409300,f:0,eSq:0,radius:2409300},104915:{a:1562090,b:1562090,f:0,eSq:0,radius:1562090},104916:{a:2632345,b:2632345,f:0,eSq:0,radius:2632345},104918:{a:1821460,b:1821460,f:0,eSq:0,radius:1821460},104929:{a:249400,b:249400,f:0,eSq:0,radius:249400},104943:{a:2575e3,b:2575e3,f:0,eSq:0,radius:2575e3},104971:{a:3396190,b:3396190,f:0,eSq:0,radius:3396190},104972:{a:47e4,b:47e4,f:0,eSq:0,radius:47e4},104973:{a:255e3,b:255e3,f:0,eSq:0,radius:255e3},104974:{a:2439400,b:2439400,f:0,eSq:0,radius:2439400}};return u={isSupported:p,getSpheroidInfo:h,geodesicDensify:w,geodesicLengths:function(t,i){var r=[];return n.forEach(t,function(t){var u=0,f=t.spatialReference;n.forEach(t.paths,function(n){for(var h=0,i,r,e,o,t=1;t<n.length;t++)(i=n[t-1][0]*s,r=n[t][0]*s,e=n[t-1][1]*s,o=n[t][1]*s,e!==o||i!==r)&&(i=a(e,i,o,r,f),h+=i.geodesicDistance);u+=h});u/=v[i];r.push(u)}),r},geodesicAreas:function(t,i){var r=[],u=[];return n.forEach(t,function(n){var t=.0015696101447650194*h(n.spatialReference).radius;r.push(w(n,t))}),n.forEach(r,function(t){var e=0,r=t.spatialReference;n.forEach(t.rings,function(n){for(var i=c(new f(n[0][0],n[0][1],r)),u=c(new f(n[n.length-1][0],n[n.length-1][1],r)),o=u.x*i.y-i.x*u.y,t=0;t<n.length-1;t++)i=c(new f(n[t+1][0],n[t+1][1],r)),u=c(new f(n[t][0],n[t][1],r)),o+=u.x*i.y-i.x*u.y;e+=o});e/=v[i];u.push(e/-2)}),u},_unitsDictionary:v,_toEqualAreaPoint:c,_directGeodeticSolver:l,_inverseGeodeticSolver:a},i("extend-esri")&&t.mixin(t.getObject("geometry",!0,r),u),u})},"esri/symbol":function(){define("./symbols/Symbol ./symbols/MarkerSymbol ./symbols/SimpleMarkerSymbol ./symbols/PictureMarkerSymbol ./symbols/LineSymbol ./symbols/SimpleLineSymbol ./symbols/CartographicLineSymbol ./symbols/FillSymbol ./symbols/SimpleFillSymbol ./symbols/PictureFillSymbol ./symbols/Font ./symbols/TextSymbol ./symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return{Symbol:n,MarkerSymbol:t,SimpleMarkerSymbol:i,PictureMarkerSymbol:r,LineSymbol:u,SimpleLineSymbol:f,CartographicLineSymbol:e,FillSymbol:o,SimpleFillSymbol:s,PictureFillSymbol:h,Font:c,TextSymbol:l,jsonUtils:a}})},"esri/renderer":function(){define("./renderers/Renderer ./renderers/SimpleRenderer ./renderers/UniqueValueRenderer ./renderers/ClassBreaksRenderer ./renderers/TemporalRenderer ./renderers/SymbolAger ./renderers/TimeClassBreaksAger ./renderers/TimeRampAger ./renderers/StretchRenderer ./renderers/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h){return{Renderer:n,SimpleRenderer:t,UniqueValueRenderer:i,ClassBreaksRenderer:r,TemporalRenderer:u,SymbolAger:f,TimeClassBreaksAger:e,TimeRampAger:o,StretchRenderer:s,jsonUtils:h}})},"esri/renderers/Renderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojox/gfx/_base ../kernel ../Color ./arcadeUtils".split(" "),function(n,t,i,r,u,f,e,o){var s=Math.PI,h=1;return n=n(null,{declaredClass:"esri.renderer.Renderer",constructor:function(n){if(this._cache={},n&&!n.declaredClass){if(this.rotationInfo=n.rotationInfo,!this.rotationInfo){var i=n.rotationType,r=n.rotationExpression;(i||r)&&(this.rotationInfo={type:i,expression:r})}this.setRotationInfo(this.rotationInfo);this.setSizeInfo(this._readSizeInfo(n.sizeInfo));this.setColorInfo(this._readColorInfo(n.colorInfo));this.setOpacityInfo(this._readOpacityInfo(n.transparencyInfo));this.setVisualVariables(this._readVariables(n.visualVariables));this.setAuthoringInfo(n.authoringInfo)}this.getSymbol=t.hitch(this,this.getSymbol)},getSymbol:function(){},_readSizeInfo:function(n){if(n){var t=n.minSize,r=n.maxSize;t&&(n.minSize="number"==typeof t?u.pt2px(t):this._readSizeInfo(t));r&&(n.maxSize="number"==typeof r?u.pt2px(r):this._readSizeInfo(r));n.stops&&i.forEach(n.stops,function(n){n.size&&"number"==typeof n.size&&(n.size=u.pt2px(n.size))})}return n},_readColorInfo:function(n){return n&&(i.forEach(n.colors,function(i,r){t.isArray(i)&&(n.colors[r]=e.toDojoColor(i))}),i.forEach(n.stops,function(i,r){i.color&&t.isArray(i.color)&&(n.stops[r].color=e.toDojoColor(i.color))})),n},_readOpacityInfo:function(n){var r;return n&&(r=t.mixin({},n),r.transparencyValues&&(r.opacityValues=i.map(r.transparencyValues,function(n){return 1-n/100}),delete r.transparencyValues),r.stops&&(r.stops=i.map(r.stops,function(n){return n=t.mixin({},n),n.opacity=1-n.transparency/100,delete n.transparency,n}))),r},_readVariables:function(n){return n&&(n=i.map(n,function(n){return"sizeInfo"===n.type?n=this._readSizeInfo(n):"colorInfo"===n.type?n=this._readColorInfo(n):"transparencyInfo"===n.type&&(n=this._readOpacityInfo(n),n.type="opacityInfo"),n},this)),n},setAuthoringInfo:function(n){this.authoringInfo=n},setRotationInfo:function(n){if(n=this.rotationInfo="string"==typeof n?{field:n}:n){if(n.expression&&!t.isFunction(n.expression)&&!n.field){var i=n.expression.match(this.rotationRE);i&&i[1]&&(n.field=i[1])}n.rotationType=n.type}return this._cache.rotationInfo=this._processRotationInfo(n),this},rotationRE:/^\[([^\]]+)\]$/i,_processRotationInfo:function(n){return this._createCache(n)},getRotationAngle:function(n,t){var i=this._getVarInfo(t&&t.rotationInfo,"rotationInfo"),u=i.variable,i=this._cache[i.cacheKey],f="arithmetic"===this._getRotationType(u),e=i&&i.hasExpr,r=null;return(u.field||e)&&(r=this._getDataValue(n,u,null,i),null!=r&&(r=(r+(f?-90:0))*(f?-1:1))),r},_getRotationType:function(n){return n&&("rotationInfo"===n.type?n.rotationType:n.type)},_getDataValue:function(n,t,i,r,u){return r||(r=this._getVarInfo(t,i),t=r.variable,r=this._cache[r.cacheKey],"sizeInfo"===i&&(r=r.root)),n._getDataValue(t,r,o,u)},setVisualVariables:function(n){var t=this._cache;return i.forEach(this.visualVariables,function(n,i){t.hasOwnProperty(i)&&(t[i]=null)},this),this.visualVariables=n,i.some(n,function(n){return!!n.target})&&n.sort(function(n,t){return n.target===t.target?0:n.target?1:-1}),i.forEach(n,function(n,i){"colorInfo"===n.type?t[i]=this._processColorInfo(n):"opacityInfo"===n.type?t[i]=this._processOpacityInfo(n):"sizeInfo"===n.type?t[i]=this._processSizeInfo(n):"rotationInfo"===n.type&&(t[i]=this._processRotationInfo(n))},this),this},getVisualVariableValues:function(n){var t=this.visualVariables,r;return t&&(r=i.map(t,function(t){var i;switch(t.type){case"sizeInfo":i=this.getSize(n,{sizeInfo:t});break;case"colorInfo":i=this.getColor(n,{colorInfo:t});break;case"opacityInfo":i=this.getOpacity(n,{opacityInfo:t});break;case"rotationInfo":i=this.getRotationAngle(n,{rotationInfo:t})}return{variable:t,value:i}},this)),r},getFieldsUsedInExpressions:function(){var n=[];return i.forEach(this._getCacheObjects(),function(t){t.syntaxTree&&(n=n.concat(o.extractFieldNames(t.syntaxTree)))}),n.sort(),i.filter(n,function(t,i){return 0===i||n[i-1]!==t})},hasVisualVariables:function(n,t){return n?!!this.getVisualVariablesForType(n,t):!!(this.getVisualVariablesForType("sizeInfo",t)||this.getVisualVariablesForType("colorInfo",t)||this.getVisualVariablesForType("opacityInfo",t)||this.getVisualVariablesForType("rotationInfo",t))},getVisualVariablesForType:function(n,t){var u=this.visualVariables,r;return!t&&this[n]?("rotationInfo"===n&&(this[n].rotationType=this[n].type),r=[this[n]]):u&&(r=i.filter(u,function(i){return i.type===n&&("string"==typeof t?i.target===t:!1===t?!i.target:!0)}))&&0===r.length&&(r=void 0),r},setSizeInfo:function(n){return this.sizeInfo=this.proportionalSymbolInfo=n,this._cache.sizeInfo=this._processSizeInfo(n),this},_processSizeInfo:function(n){return n&&{root:this._createCache(n),minSize:this._createCache(n.minSize),maxSize:this._createCache(n.maxSize)}},_convertExpressionToArcade:function(n){n&&n.expression&&(n.valueExpression="$view.scale")},_getVarInfo:function(n,t){var r;return n&&n.type===t?(r=i.indexOf(this.visualVariables,n),n=this.visualVariables[r]):(r=t,n=this[t]),{variable:n,cacheKey:r}},setProportionalSymbolInfo:function(n){return this.setSizeInfo(n),this},getSize:function(n,t){var i=this._getVarInfo(t&&t.sizeInfo,"sizeInfo"),f=i.variable,i=this._cache[i.cacheKey],r=null;if(f)var u=f.minSize,r=f.maxSize,u="object"==typeof u&&u?this._getSize(n,u,i&&i.minSize,t):u,r="object"==typeof r&&r?this._getSize(n,r,i&&i.maxSize,t):r,r=this._getSize(n,f,i&&i.root,t,[u,r]);return r},_getSize:function(n,t,i,r,u){var o=t.stops,e=0,f=i&&i.hasExpr,b=i&&i.ipData,y=i&&i.isScaleDriven,k="object"==typeof n&&!!n,h="number"==typeof n?n:null,p;if(t.field||y||f){p=r&&r.scale;f=u?u[0]:t.minSize;u=u?u[1]:t.maxSize;var c=t.minDataValue,a=t.maxDataValue,w=t.valueUnit||"unknown",v=t.valueRepresentation,d=t.scaleBy,l=r&&r.shape;if(y?h=p:"number"!=typeof h&&k&&(h=this._getDataValue(n,t,null,i)),!this._isValidNumber(h))return null;o?(f=this._lookupData(h,b),h=f[0],u=f[1],h===u?e=o[h].size:(h=o[h].size,o=o[u].size,e=h+(o-h)*f[2])):null!=f&&null!=u&&null!=c&&null!=a?h<=c?e=f:h>=a?e=u:(o=(h-c)/(a-c),"area"===d&&l?(f=(h="circle"===l)?s*Math.pow(f/2,2):f*f,o=f+o*((h?s*Math.pow(u/2,2):u*u)-f),e=h?2*Math.sqrt(o/s):Math.sqrt(o)):e=f+o*(u-f)):"unknown"===w?null!=f&&null!=c&&(f&&c?(o=h/c,e="circle"===l?2*Math.sqrt(o*Math.pow(f/2,2)):"square"===l||"diamond"===l||"image"===l?Math.sqrt(o*Math.pow(f,2)):o*f):e=h+(f||c),e=e<f?f:e,null!=u&&e>u&&(e=u)):(o=(r&&r.resolution?r.resolution:1)*this._meterIn[w],"area"===v?(e=Math.sqrt(h/s)/o,e*=2):(e=h/o,"radius"===v||"distance"===v)&&(e*=2),null!=f&&e<f&&(e=f),null!=u&&e>u&&(e=u))}else e=o&&o[0]&&o[0].size,null==e&&(e=t.minSize);return isNaN(e)?0:e},getSizeRangeAtScale:function(n,t){var f,i=this._getVarInfo(n,"sizeInfo"),r=this._cache[i.cacheKey],o={scale:t};if((n=i.variable)&&t){var i=n.minSize,e=n.maxSize,u=n.stops;u&&u.length?(i=u[0].size,r=u[u.length-1].size):(i="object"==typeof i&&i?this._getSize({},i,r&&r.minSize,o):i,r="object"==typeof e&&e?this._getSize({},e,r&&r.maxSize,o):e);(null!=i||null!=r)&&(i>r&&(f=r,r=i,i=f),f={minSize:i,maxSize:r})}return f},setColorInfo:function(n){return this.colorInfo=n,this._cache.colorInfo=this._processColorInfo(n),this},prepareForViewChange:function(){i.forEach(this._getCacheObjects(),function(n){(n.dependsOnView||n.isJSFunc)&&(n.version=h++)})},_viewScaleRE:/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,_createCache:function(n){var r=n&&n.valueExpression,i=o.createSyntaxTree(r),u=o.createFunction(i),f=!(!n||!n.expression)||this._viewScaleRE.test(r);return{ipData:this._interpolateData(n),hasExpr:!!r,compiledFunc:u,syntaxTree:i,isScaleDriven:f,dependsOnView:i?o.dependsOnView(i):!1,isJSFunc:t.isFunction(n&&n.field),version:h++}},_getCacheObjects:function(n){var r,i,t;n=n||this._cache;i=[];for(r in n)t=n[r],n.hasOwnProperty(r)&&t&&"object"==typeof t&&(t.hasOwnProperty("version")?i.push(t):i=i.concat(this._getCacheObjects(t)));return i},_processColorInfo:function(n){return n&&(i.forEach(n.colors,function(i,r){t.isArray(i)&&(n.colors[r]=new e(i))}),i.forEach(n.stops,function(i,r){i.color&&t.isArray(i.color)&&(n.stops[r].color=new e(i.color))})),this._createCache(n)},getColor:function(n,t){var i=this._getVarInfo(t&&t.colorInfo,"colorInfo");return this._getColorComponent(n,i.variable,this._cache[i.cacheKey])},setOpacityInfo:function(n){return this.opacityInfo=n,this._cache.opacityInfo=this._processOpacityInfo(n),this},_processOpacityInfo:function(n){return this._createCache(n)},getOpacity:function(n,t){var i=this._getVarInfo(t&&t.opacityInfo,"opacityInfo");return this._getColorComponent(n,i.variable,this._cache[i.cacheKey],!0)},_getColorComponent:function(n,t,i,r,u){var f="number"==typeof n?n:null,s=i&&i.hasExpr,o=i&&i.ipData,e;return t&&t.field||s?("number"!=typeof f&&"object"==typeof n&&n&&(f=this._getDataValue(n,t,null,i)),this._isValidNumber(f)||(f=null),null!=f&&(e=r?this._getOpacity(f,t,o):this._getColor(f,t,o))):t&&(n=t.stops,r?(e=n&&n[0]&&n[0].opacity,null==e&&(e=t.opacityValues&&t.opacityValues[0])):e=n&&n[0]&&n[0].color||t.colors&&t.colors[0]),u&&(u.data=f,u.value=e),u||e},_isValidNumber:function(n){return"number"==typeof n&&!isNaN(n)&&Infinity!==n&&-Infinity!==n},_interpolateData:function(n){var t;if(n)if(n.colors||n.opacityValues){var r=(n.colors||n.opacityValues).length,u=n.minDataValue,f=(n.maxDataValue-u)/(r-1);for(t=[],n=0;n<r;n++)t[n]=u+n*f}else n.stops&&(t=i.map(n.stops,function(n){return n.value}));return t},_getOpacity:function(n,t,i){n=this._lookupData(n,i);var r;return t=t||this.opacityInfo,n&&(i=n[0],r=n[1],i===r?r=this._getOpacValue(t,i):(i=this._getOpacValue(t,i),t=this._getOpacValue(t,r),r=i+(t-i)*n[2])),r},_getOpacValue:function(n,t){return n.opacityValues?n.opacityValues[t]:n.stops[t].opacity},_getColor:function(n,t,i){n=this._lookupData(n,i);var r;return t=t||this.colorInfo,n&&(r=n[0],i=n[1],r=r===i?this._getColorObj(t,r):e.blendColors(this._getColorObj(t,r),this._getColorObj(t,i),n[2])),r},_getColorObj:function(n,t){return n.colors?n.colors[t]:n.stops[t].color},_lookupData:function(n,t){var f,r,u;return t&&(r=0,u=t.length-1,i.some(t,function(t,i){return n<t?(u=i,!0):(r=i,!1)}),f=[r,u,(n-t[r])/(t[u]-t[r])]),f},_meterIn:{inches:1/.0254,feet:1/.3048,yards:1/.9144,miles:1/1609.344,"nautical-miles":1/1852,millimeters:1e3,centimeters:100,decimeters:10,meters:1,kilometers:.001,"decimal-degrees":180/20015077},_writeSizeInfo:function(n){if(n){n=t.mixin({},n);this._convertExpressionToArcade(n);var r=n.minSize,f=n.maxSize;r&&(n.minSize="number"==typeof r?u.px2pt(r):this._writeSizeInfo(r));f&&(n.maxSize="number"==typeof f?u.px2pt(f):this._writeSizeInfo(f));(r=n.legendOptions)&&(n.legendOptions=t.mixin({},r),r=r.customValues)&&(n.legendOptions.customValues=r.slice(0));n.stops&&(n.stops=i.map(n.stops,function(n){return n=t.mixin({},n),n.size&&"number"==typeof n.size&&(n.size=u.px2pt(n.size)),n}))}return n},_writeColorInfo:function(n){return n&&(n=t.mixin({},n),n.colors&&(n.colors=i.map(n.colors,function(n){return e.toJsonColor(n)})),n.stops&&(n.stops=i.map(n.stops,function(n){return n=t.mixin({},n),n.color&&(n.color=e.toJsonColor(n.color)),n})),n.legendOptions&&(n.legendOptions=t.mixin({},n.legendOptions))),n},_writeOpacityInfo:function(n){var r;return n&&(r=t.mixin({},n),r.opacityValues&&(r.transparencyValues=i.map(r.opacityValues,function(n){return 100*(1-n)}),delete r.opacityValues),r.stops&&(r.stops=i.map(r.stops,function(n){return n=t.mixin({},n),n.transparency=100*(1-n.opacity),delete n.opacity,n})),r.legendOptions&&(r.legendOptions=t.mixin({},r.legendOptions))),r},toJson:function(n){var r=this.visualVariables,f=t.clone(this.authoringInfo),o=n&&n.useLegacyRotationProperties,u=(n=(n=this.getVisualVariablesForType("rotationInfo",!1))&&n[0])&&n.field,e;return n&&(n===this.rotationInfo||o)&&(e=n.expression||u&&(t.isFunction(u)?u:"["+u+"]")),r&&(r=i.map(r,function(n){return"sizeInfo"===n.type?n=this._writeSizeInfo(n):"colorInfo"===n.type?n=this._writeColorInfo(n):"opacityInfo"===n.type?(n=this._writeOpacityInfo(n),n.type="transparencyInfo"):"rotationInfo"===n.type&&(n=o?null:t.mixin({},n)),n},this),r=i.filter(r,function(n){return null!=n})),f&&i.forEach(f.visualVariables,function(n){"opacityInfo"===n.type&&(n.type="transparencyInfo")}),{rotationType:e&&(this._getRotationType(n)||"geographic"),rotationExpression:e,colorInfo:this._writeColorInfo(this.colorInfo),transparencyInfo:this._writeOpacityInfo(this.opacityInfo),sizeInfo:this._writeSizeInfo(this.sizeInfo),visualVariables:r,authoringInfo:f}}}),r("extend-esri")&&t.setObject("renderer.Renderer",n,f),n})},"esri/renderers/arcadeUtils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../kernel","../arcade/arcade"],function(n,t,i,r,u){var e={vars:{$feature:"any",$view:"any"}},o=/^\$feature\./i,f={createSyntaxTree:function(t,i){i=i||n.clone(e);var r;try{r=t?u.parseScript(t,i):null}catch(f){r=null}return r},createFunction:function(t,i){i=i||n.clone(e);var o="string"==typeof t?f.createSyntaxTree(t,i):t,r;try{r=o?u.compileScript(o,i):null}catch(s){r=null}return r},createExecContext:function(n,t){return{vars:{$feature:u.constructFeature(n),$view:t&&t.view},spatialReference:t&&t.sr}},evalSyntaxTree:function(n,t){var i;try{i=u.executeScript(n,t,t.spatialReference)}catch(r){i=null}return i},executeFunction:function(n,t){var i;try{i=n?n(t,t.spatialReference):null}catch(r){i=null}return i},extractFieldNames:function(n,i){var e="string"==typeof n?f.createSyntaxTree(n,i):n,e=u.extractFieldLiterals(e),r=[];return t.forEach(e,function(n){o.test(n)&&(n=n.replace(o,""),r.push(n))}),r.sort(),t.filter(r,function(n,t){return 0===t||r[t-1]!==n})},dependsOnView:function(n){return u.referencesMember(n,"$view")}};return i("extend-esri")&&n.setObject("renderer.arcadeUtils",f,r),f})},"esri/arcade/arcade":function(){define("require exports ./arcadeRuntime ./parser ./Feature ./arcadeCompiler dojo/has".split(" "),function(n,t,i,r,u,f,e){Object.defineProperty(t,"__esModule",{value:!0});t.compileScript=function(n,t){return e("csp-restrictions")?function(t,r){return i.executeScript(n,t,r)}:f.compileScript(n,t)};t.constructFeature=function(n){return u.fromFeature(n)};t.parseScript=function(n){return r.parseScript(n)};t.validateScript=function(n,t){return r.validateScript(n,t,"simple")};t.scriptCheck=function(n,t,i){return r.scriptCheck(n,t,i,"full")};t.parseAndExecuteScript=function(n,t,u){return i.executeScript(r.parseScript(n),t,u)};t.executeScript=function(n,t,r){return i.executeScript(n,t,r)};t.referencesMember=function(n,t){return i.referencesMember(n,t)};t.referencesFunction=function(n,t){return i.referencesFunction(n,t)};t.extractFieldLiterals=function(n,t){return void 0===t&&(t=!1),r.extractFieldLiterals(n,t)}})},"esri/arcade/arcadeRuntime":function(){define("require exports ../geometry/Polygon ../graphic ../geometry/Polyline ../geometry/Point ../geometry/Extent ../geometry/Multipoint ../SpatialReference ./languageUtils ./treeAnalysis ./Dictionary ./Feature ./FunctionWrapper ./functions/date ./functions/string ./functions/maths ./functions/geometry ./functions/stats ./ImmutablePathArray ./ImmutablePointArray ../geometry/Geometry".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){function ot(n,t){for(var r=[],i=0;i<t.arguments.length;i++)r.push(tt(n,t.arguments[i]));return r}function rt(n,t,i){try{return i(n,t,ot(n,t))}catch(r){throw r;}}function tt(n,t){var w,d,g,y,ct,nt,lt,it,rt,ut,et,e,u,i,r,ot,o,b,k,p,ht;try{switch(t.type){case"EmptyStatement":return h.voidOperation;case"VariableDeclarator":return w=null===t.init?null:tt(n,t.init),w===h.voidOperation&&(w=null),d=t.id.name.toLowerCase(),null!==n.localScope?n.localScope[d]={value:w,valueset:!0,node:t.init}:n.globalScope[d]={value:w,valueset:!0,node:t.init},h.voidOperation;case"VariableDeclaration":for(i=0;i<t.declarations.length;i++)tt(n,t.declarations[i]);return h.voidOperation;case"BlockStatement":n:{for(y=h.voidOperation,i=0;i<t.body.length;i++)if(y=tt(n,t.body[i]),y instanceof h.ReturnResult||y===h.breakResult||y===h.continueResult){g=y;break n}g=y}return g;case"FunctionDeclaration":return ct=t.id.name.toLowerCase(),n.globalScope[ct]={valueset:!0,node:null,value:new v(t,n)},h.voidOperation;case"ReturnStatement":return null===t.argument?nt=new h.ReturnResult(h.voidOperation):(lt=tt(n,t.argument),nt=new h.ReturnResult(lt)),nt;case"IfStatement":if("AssignmentExpression"===t.test.type||"UpdateExpression"===t.test.type)throw Error(c.nodeErrorMessage(t.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if(rt=tt(n,t.test),!0===rt)it=tt(n,t.consequent);else if(!1===rt)it=null!==t.alternate?tt(n,t.alternate):h.voidOperation;else throw Error(c.nodeErrorMessage(t,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return it;case"ExpressionStatement":return"AssignmentExpression"===t.expression.type||"UpdateExpression"===t.expression.type?ut=tt(n,t.expression):(et=tt(n,t.expression),ut=et===h.voidOperation?h.voidOperation:new h.ImplicitResult(et)),ut;case"AssignmentExpression":var s,f=tt(n,t.right),i=null,r="";if("MemberExpression"===t.left.type){if(i=tt(n,t.left.object),r=!0===t.left.computed?tt(n,t.left.property):t.left.property.name,h.isArray(i))if(h.isNumber(r)){if(0>r&&(r=i.length+r),0>r||r>i.length)throw Error("Assignment outside of array bounds");if(r===i.length&&"="!==t.operator)throw Error("Invalid Parameter");i[r]=ft(f,t.operator,i[r],t)}else throw Error("Invalid Parameter");else if(i instanceof l){if(!1===h.isString(r))throw Error("Dictionary accessor must be a string");if(!0===i.hasField(r))i.setField(r,ft(f,t.operator,i.field(r),t));else{if("="!==t.operator)throw Error("Invalid Parameter");i.setField(r,ft(f,t.operator,null,t))}}else if(i instanceof a){if(!1===h.isString(r))throw Error("Feature accessor must be a string");if(!0===i.hasField(r))i.setField(r,ft(f,t.operator,i.field(r),t));else{if("="!==t.operator)throw Error("Invalid Parameter");i.setField(r,ft(f,t.operator,null,t))}}else{if(h.isImmutableArray(i))throw Error("Array is Immutable");throw Error("Invalid Parameter");}s=h.voidOperation}else if(i=t.left.name.toLowerCase(),null!==n.localScope&&void 0!==n.localScope[i])n.localScope[i]={value:ft(f,t.operator,n.localScope[i].value,t),valueset:!0,node:t.right},s=h.voidOperation;else if(void 0!==n.globalScope[i])n.globalScope[i]={value:ft(f,t.operator,n.globalScope[i].value,t),valueset:!0,node:t.right},s=h.voidOperation;else throw Error("Variable not recognised");return s;case"UpdateExpression":if(i=null,r="","MemberExpression"===t.argument.type){if(i=tt(n,t.argument.object),r=!0===t.argument.computed?tt(n,t.argument.property):t.argument.property.name,h.isArray(i))if(h.isNumber(r)){if(0>r&&(r=i.length+r),0>r||r>=i.length)throw Error("Assignment outside of array bounds");u=h.toNumber(i[r]);i[r]="++"===t.operator?u+1:u-1}else throw Error("Invalid Parameter");else if(i instanceof l){if(!1===h.isString(r))throw Error("Dictionary accessor must be a string");if(!0===i.hasField(r))u=h.toNumber(i.field(r)),i.setField(r,"++"===t.operator?u+1:u-1);else throw Error("Invalid Parameter");}else if(i instanceof a){if(!1===h.isString(r))throw Error("Feature accessor must be a string");if(!0===i.hasField(r))u=h.toNumber(i.field(r)),i.setField(r,"++"===t.operator?u+1:u-1);else throw Error("Invalid Parameter");}else{if(h.isImmutableArray(i))throw Error("Array is Immutable");throw Error("Invalid Parameter");}e=!1===t.prefix?u:"++"===t.operator?u+1:u-1}else if(i=t.argument.name.toLowerCase(),null!==n.localScope&&void 0!==n.localScope[i])u=h.toNumber(n.localScope[i].value),n.localScope[i]={value:"++"===t.operator?u+1:u-1,valueset:!0,node:t},e=!1===t.prefix?u:"++"===t.operator?u+1:u-1;else if(void 0!==n.globalScope[i])u=h.toNumber(n.globalScope[i].value),n.globalScope[i]={value:"++"===t.operator?u+1:u-1,valueset:!0,node:t},e=!1===t.prefix?u:"++"===t.operator?u+1:u-1;else throw Error("Variable not recognised");return e;case"BreakStatement":return h.breakResult;case"ContinueStatement":return h.continueResult;case"ForStatement":null!==t.init&&tt(n,t.init);r={testResult:!0,lastAction:h.voidOperation};do n:{if(s=n,f=t,e=r,null!==f.test){if(e.testResult=tt(s,f.test),!1===e.testResult)break n;if(!0!==e.testResult)throw Error(c.nodeErrorMessage(f,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));}e.lastAction=tt(s,f.body);e.lastAction===h.breakResult?e.testResult=!1:e.lastAction instanceof h.ReturnResult?e.testResult=!1:null!==f.update&&tt(s,f.update)}while(!0===r.testResult);return r.lastAction instanceof h.ReturnResult?r.lastAction:h.voidOperation;case"ForInStatement":return yt(n,t);case"Identifier":try{if(b=t.name.toLowerCase(),null!==n.localScope&&void 0!==n.localScope[b])o=n.localScope[b],!0!==o.valueset&&(o.value=tt(n,o.node),o.valueset=!0),ot=o.value;else if(void 0!==n.globalScope[b])o=n.globalScope[b],!0!==o.valueset&&(o.value=tt(n,o.node),o.valueset=!0),ot=o.value;else throw Error(c.nodeErrorMessage(t,"RUNTIME","VARIABLENOTFOUND"));}catch(st){throw st;}return ot;case"MemberExpression":return pt(n,t);case"Literal":return t.value;case"ThisExpression":throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTED"));case"CallExpression":return dt(n,t);case"UnaryExpression":return wt(n,t);case"BinaryExpression":return bt(n,t);case"LogicalExpression":return kt(n,t);case"ConditionalExpression":throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":try{for(i=[],r=0;r<t.elements.length;r++){if(k=tt(n,t.elements[r]),h.isFunctionParameter(k))throw Error(c.nodeErrorMessage(t,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));k===h.voidOperation?i.push(null):i.push(k)}}catch(st){throw st;}return i;case"ObjectExpression":for(i={},r=0;r<t.properties.length;r++){if(p=tt(n,t.properties[r]),h.isFunctionParameter(p.value))throw Error("Illegal Argument");if(!1===h.isString(p.key))throw Error("Illegal Argument");i[p.key.toString()]=p.value===h.voidOperation?null:p.value}return ht=new l(i),ht.immutable=!1,ht;case"Property":return{key:"Identifier"===t.key.type?t.key.name:tt(n,t.key),value:tt(n,t.value)};case"Array":throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTED"));default:throw Error(c.nodeErrorMessage(t,"RUNTIME","UNREOGNISED"));}}catch(st){throw st;}}function yt(n,t){var r=tt(n,t.right),f,i,u;if("VariableDeclaration"===t.left.type&&tt(n,t.left),f=null,i="VariableDeclaration"===t.left.type?t.left.declarations[0].id.name:t.left.name,null!==n.localScope&&void 0!==n.localScope[i]&&(f=n.localScope[i]),null===f&&void 0!==n.globalScope[i]&&(f=n.globalScope[i]),null===f)throw Error(c.nodeErrorMessage(t,"RUNTIME","VARIABLENOTDECLARED"));if(h.isArray(r)||h.isString(r)){for(r=r.length,u=0;u<r&&(f.value=u,i=tt(n,t.body),i!==h.breakResult);u++)if(i instanceof h.ReturnResult)return i;return h.voidOperation}if(h.isImmutableArray(r)){for(u=0;u<r.length()&&(f.value=u,i=tt(n,t.body),i!==h.breakResult);u++)if(i instanceof h.ReturnResult)return i;return h.voidOperation}if(r instanceof l||r instanceof a){for(r=r.keys(),u=0;u<r.length&&(f.value=r[u],i=tt(n,t.body),i!==h.breakResult);u++)if(i instanceof h.ReturnResult)return i}else return h.voidOperation}function ft(n,t,i,r){switch(t){case"=":return n===h.voidOperation?null:n;case"/=":return h.toNumber(i)/h.toNumber(n);case"*=":return h.toNumber(i)*h.toNumber(n);case"-=":return h.toNumber(i)-h.toNumber(n);case"+=":return h.isString(i)||h.isString(n)?h.toString(i)+h.toString(n):h.toNumber(i)+h.toNumber(n);case"%=":return h.toNumber(i)%h.toNumber(n);default:throw Error(c.nodeErrorMessage(r,"RUNTIME","OPERATORNOTRECOGNISED"));}}function st(n,t,i,r){t=t.toLowerCase();switch(t){case"hasz":return n=n.hasZ,void 0===n?!1:n;case"hasm":return n=n.hasM,void 0===n?!1:n;case"spatialreference":return t=n.spatialReference._arcadeCacheId,void 0===t&&(i=!0,Object.freeze&&Object.isFrozen(n.spatialReference)&&(i=!1),i&&(ut++,t=n.spatialReference._arcadeCacheId=ut)),n=new l({wkt:n.spatialReference.wkt,wkid:n.spatialReference.wkid}),void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}switch(n.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":return n=n[t],void 0!==n?n:null;case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return t=h.isVersion4?n.cache._arcadeCacheId:n.getCacheValue("_arcadeCacheId"),void 0===t&&(ut++,t=ut,h.isVersion4?n.cache._arcadeCacheId=t:n.setCacheValue("_arcadeCacheId",t)),n=new d(n.rings,n.spatialReference,!0===n.hasZ,!0===n.hasM,t);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==n[t]?n[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return t=h.isVersion4?n.cache._arcadeCacheId:n.getCacheValue("_arcadeCacheId"),void 0===t&&(ut++,t=ut,h.isVersion4?n.cache._arcadeCacheId=t:n.setCacheValue("_arcadeCacheId",t)),n=new d(n.paths,n.spatialReference,!0===n.hasZ,!0===n.hasM,t);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return t=h.isVersion4?n.cache._arcadeCacheId:n.getCacheValue("_arcadeCacheId"),void 0===t&&(ut++,t=ut,h.isVersion4?n.cache._arcadeCacheId=t:n.setCacheValue("_arcadeCacheId",t)),n=new g(n.points,n.spatialReference,!0===n.hasZ,!0===n.hasM,t,1);case"type":return"Multipoint"}}throw Error(c.nodeErrorMessage(r,"RUNTIME","PROPERTYNOTFOUND"));}function pt(n,t){var r,i;try{if(r=tt(n,t.object),null===r)throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTFOUND"));if(!1===t.computed){if(r instanceof l||r instanceof a)return r.field(t.property.name);if(r instanceof nt)return st(r,t.property.name,n,t);throw Error(c.nodeErrorMessage(t,"RUNTIME","INVALIDTYPE"));}if(i=tt(n,t.property),r instanceof l||r instanceof a){if(h.isString(i))return r.field(i)}else if(r instanceof nt){if(h.isString(i))return st(r,i,n,t)}else if(h.isArray(r)){if(h.isNumber(i)&&isFinite(i)&&Math.floor(i)===i){if(0>i&&(i=r.length+i),i>=r.length||0>i)throw Error(c.nodeErrorMessage(t,"RUNTIME","OUTOFBOUNDS"));return r[i]}}else if(h.isString(r)){if(h.isNumber(i)&&isFinite(i)&&Math.floor(i)===i){if(0>i&&(i=r.length+i),i>=r.length||0>i)throw Error(c.nodeErrorMessage(t,"RUNTIME","OUTOFBOUNDS"));return r[i]}}else if(h.isImmutableArray(r)&&h.isNumber(i)&&isFinite(i)&&Math.floor(i)===i){if(0>i&&(i=r.length()+i),i>=r.length()||0>i)throw Error(c.nodeErrorMessage(t,"RUNTIME","OUTOFBOUNDS"));return r.get(i)}throw Error(c.nodeErrorMessage(t,"RUNTIME","INVALIDTYPE"));}catch(u){throw u;}}function wt(n,t){try{var i=tt(n,t.argument);if(h.isBoolean(i)){if("!"===t.operator)return!i;if("-"===t.operator)return-1*h.toNumber(i);if("+"===t.operator)return 1*h.toNumber(i);throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===t.operator)return-1*h.toNumber(i);if("+"===t.operator)return 1*h.toNumber(i);throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}catch(r){throw r;}}function bt(n,t){try{var u=[tt(n,t.left),tt(n,t.right)],i=u[0],r=u[1];switch(t.operator){case"==":return h.equalityTest(i,r);case"=":return h.equalityTest(i,r);case"!=":return!h.equalityTest(i,r);case"<":return h.greaterThanLessThan(i,r,t.operator);case">":return h.greaterThanLessThan(i,r,t.operator);case"<=":return h.greaterThanLessThan(i,r,t.operator);case">=":return h.greaterThanLessThan(i,r,t.operator);case"+":return h.isString(i)||h.isString(r)?h.toString(i)+h.toString(r):h.toNumber(i)+h.toNumber(r);case"-":return h.toNumber(i)-h.toNumber(r);case"*":return h.toNumber(i)*h.toNumber(r);case"/":return h.toNumber(i)/h.toNumber(r);case"%":return h.toNumber(i)%h.toNumber(r);default:throw Error(c.nodeErrorMessage(t,"RUNTIME","OPERATORNOTRECOGNISED"));}}catch(f){throw f;}}function kt(n,t){var i,r;try{if("AssignmentExpression"===t.left.type||"UpdateExpression"===t.left.type)throw Error(c.nodeErrorMessage(t.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===t.right.type||"UpdateExpression"===t.right.type)throw Error(c.nodeErrorMessage(t.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if(i=tt(n,t.left),h.isBoolean(i))switch(t.operator){case"||":if(!0===i)return i;if(r=tt(n,t.right),h.isBoolean(r))return r;throw Error(c.nodeErrorMessage(t,"RUNTIME","ONLYORORAND"));case"&&":if(!1===i)return i;if(r=tt(n,t.right),h.isBoolean(r))return r;throw Error(c.nodeErrorMessage(t,"RUNTIME","ONLYORORAND"));default:throw Error(c.nodeErrorMessage(t,"RUNTIME","ONLYORORAND"));}else throw Error(c.nodeErrorMessage(t,"RUNTIME","ONLYBOOLEAN"));}catch(u){throw u;}}function dt(n,t){try{if("Identifier"!==t.callee.type)throw Error(c.nodeErrorMessage(t,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==n.localScope&&void 0!==n.localScope[t.callee.name.toLowerCase()]){var i=n.localScope[t.callee.name.toLowerCase()];if(i.value instanceof h.NativeFunction)return i.value.fn(n,t);if(i.value instanceof v)return vt(n,t,i.value.definition);throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTAFUNCTION"));}if(void 0!==n.globalScope[t.callee.name.toLowerCase()]){if(i=n.globalScope[t.callee.name.toLowerCase()],i.value instanceof h.NativeFunction)return i.value.fn(n,t);if(i.value instanceof v)return vt(n,t,i.value.definition);throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTAFUNCTION"));}throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTFOUND"));}catch(r){throw r;}}function ht(n){return null==n?"":h.isArray(n)||h.isImmutableArray(n)?"Array":h.isDate(n)?"Date":h.isString(n)?"String":h.isBoolean(n)?"Boolean":h.isNumber(n)?"Number":n instanceof l?"Dictionary":n instanceof a?"Feature":n instanceof f?"Point":n instanceof i?"Polygon":n instanceof u?"Polyline":n instanceof o?"Multipoint":n instanceof e?"Extent":h.isFunctionParameter(n)?"Function":n===h.voidOperation?"":"number"==typeof n&&isNaN(n)?"Number":"Unrecognised Type"}function ct(n,t,i,r){var f,u;try{return(f=tt(n,t.arguments[i]),h.equalityTest(f,r))?tt(n,t.arguments[i+1]):(u=t.arguments.length-i,1===u?tt(n,t.arguments[i]):2===u?null:3===u?tt(n,t.arguments[i+2]):ct(n,t,i+2,r))}catch(e){throw e;}}function lt(n,t,i,r){try{if(!0===r)return tt(n,t.arguments[i+1]);if(3==t.arguments.length-i)return tt(n,t.arguments[i+2]);var u=tt(n,t.arguments[i+2]);if(!1===h.isBoolean(u))throw Error("WHEN needs boolean test conditions");return lt(n,t,i+2,u)}catch(f){throw f;}}function et(n,t){var i=n.length,u=Math.floor(i/2),f;if(0===i)return[];if(1===i)return[n[0]];for(var r=et(n.slice(0,u),t),i=et(n.slice(u,i),t),u=[];0<r.length||0<i.length;)0<r.length&&0<i.length?(f=t(r[0],i[0]),isNaN(f)&&(f=0),0>=f?(u.push(r[0]),r=r.slice(1)):(u.push(i[0]),i=i.slice(1))):0<r.length?(u.push(r[0]),r=r.slice(1)):0<i.length&&(u.push(i[0]),i=i.slice(1));return u}function at(n,t,i){var f,u,r;try{if(f=n.body,i.length!==n.params.length)throw Error("Invalid Parameter calls to function.");for(u=0;u<i.length;u++)t.localScope[n.params[u].name.toLowerCase()]={d:null,value:i[u],valueset:!0,node:null};if(r=tt(t,f),r instanceof h.ReturnResult)return r.value;if(r===h.breakResult)throw Error("Cannot Break from a Function");if(r===h.continueResult)throw Error("Cannot Continue from a Function");return r instanceof h.ImplicitResult?r.value:r}catch(e){throw e;}}function vt(n,t,i){return rt(n,t,function(t,r,u){if(t={spatialReference:n.spatialReference,applicationCache:void 0===n.applicationCache?null:n.applicationCache,globalScope:n.globalScope,depthCounter:n.depthCounter+1,console:n.console,localScope:{}},64<t.depthCounter)throw Error("Exceeded maximum function depth");return at(i,t,u)})}function gt(n){return function(){var t={applicationCache:void 0===n.context.applicationCache?null:n.context.applicationCache,spatialReference:n.context.spatialReference,console:n.context.console,localScope:{},depthCounter:n.context.depthCounter+1,globalScope:n.context.globalScope};if(64<t.depthCounter)throw Error("Exceeded maximum function depth");return at(n.definition,t,arguments)}}function ni(n){console.log(n)}Object.defineProperty(t,"__esModule",{value:!0});var ut=0,it={};y.registerFunctions(it,rt);p.registerFunctions(it,rt);w.registerFunctions(it,rt);b.registerFunctions(it,rt);k.registerFunctions(it,rt);it["typeof"]=function(n,t){return rt(n,t,function(n,t,i){if(h.pcCheck(i,1,1),n=ht(i[0]),"Unrecognised Type"===n)throw Error("Unrecognised Type");return n})};it.iif=function(n,t){try{h.pcCheck(null===t.arguments?[]:t.arguments,3,3);var i=tt(n,t.arguments[0]);if(!1===h.isBoolean(i))throw Error("IF Function must have a boolean test condition");return!0===i?tt(n,t.arguments[1]):tt(n,t.arguments[2])}catch(r){throw r;}};it.decode=function(n,t){try{if(2>t.arguments.length)throw Error("Missing Parameters");if(2===t.arguments.length)return tt(n,t.arguments[1]);if(0==(t.arguments.length-1)%2)throw Error("Must have a default value result.");var i=tt(n,t.arguments[0]);return ct(n,t,1,i)}catch(r){throw r;}};it.when=function(n,t){try{if(3>t.arguments.length)throw Error("Missing Parameters");if(0==t.arguments.length%2)throw Error("Must have a default value result.");var i=tt(n,t.arguments[0]);if(!1===h.isBoolean(i))throw Error("WHEN needs boolean test conditions");return lt(n,t,0,i)}catch(r){throw r;}};it.top=function(n,t){return rt(n,t,function(n,t,i){if(h.pcCheck(i,2,2),h.isArray(i[0]))return h.toNumber(i[1])>=i[0].length?i[0].slice(0):i[0].slice(0,h.toNumber(i[1]));if(h.isImmutableArray(i[0]))return h.toNumber(i[1])>=i[0].length()?i[0].slice(0):i[0].slice(0,h.toNumber(i[1]));throw Error("Top cannot accept this parameter type");})};it.first=function(n,t){return rt(n,t,function(n,t,i){return h.pcCheck(i,1,1),h.isArray(i[0])?0===i[0].length?null:i[0][0]:h.isImmutableArray(i[0])?0===i[0].length()?null:i[0].get(0):null})};it.sort=function(n,t){return rt(n,t,function(n,t,i){var u,r,f;if(h.pcCheck(i,1,2),n=i[0],h.isImmutableArray(n)&&(n=n.toArray()),!1===h.isArray(n))throw Error("Illegal Argument");if(1<i.length){if(!1===h.isFunctionParameter(i[1]))throw Error("Illegal Argument");u=gt(i[1]);n=et(n,function(n,t){return u(n,t)})}else{if(0===n.length)return[];for(i={},t=0;t<n.length;t++)r=ht(n[t]),""!==r&&(i[r]=!0);if(!0===i.Array||!0===i.Dictionary||!0===i.Feature||!0===i.Point||!0===i.Polygon||!0===i.Polyline||!0===i.Multipoint||!0===i.Extent||!0===i.Function)return n.slice(0);t=0;r="";for(f in i)t++,r=f;n=1<t||"String"===r?et(n,function(n,t){if(null===n||void 0===n||n===h.voidOperation)return null===t||void 0===t||t===h.voidOperation?0:1;if(null===t||void 0===t||t===h.voidOperation)return-1;var i=h.toString(n),r=h.toString(t);return i<r?-1:i===r?0:1}):"Number"===r?et(n,function(n,t){return n-t}):"Boolean"===r?et(n,function(n,t){return n===t?0:t?-1:1}):"Date"===r?et(n,function(n,t){return t-n}):n.slice(0)}return n})};t.functionHelper={fixSpatialReference:h.fixSpatialReference,parseArguments:ot,standardFunction:rt};t.executeScript=function(n,t,i){var c,u;i||(i=new s(102100));var e=t.vars,o=t.customfunctions,f={};e||(e={});o||(o={});c=new l({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});c.immutable=!1;f.textformatting={value:c,valueset:!0,node:null};f.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};f.pi={value:Math.PI,valueset:!0,node:null};for(u in it)f[u]={value:new h.NativeFunction(it[u]),valueset:!0,node:null};for(u in o)f[u]={value:new h.NativeFunction(o[u]),"native":!0,valueset:!0,node:null};for(u in e)f[u]=e[u]instanceof r?{value:new a(e[u]),valueset:!0,node:null}:{value:e[u],valueset:!0,node:null};if(n=tt({spatialReference:i,globalScope:f,localScope:null,console:t.console?t.console:ni,depthCounter:1,applicationCache:void 0===t.applicationCache?null:t.applicationCache},n.body[0].body),n instanceof h.ReturnResult&&(n=n.value),n instanceof h.ImplicitResult&&(n=n.value),n===h.voidOperation&&(n=null),n===h.breakResult)throw Error("Cannot return BREAK");if(n===h.continueResult)throw Error("Cannot return CONTINUE");if(n instanceof v)throw Error("Cannot return FUNCTION");if(n instanceof h.NativeFunction)throw Error("Cannot return FUNCTION");return n};t.extractFieldLiterals=function(n,t){return void 0===t&&(t=!1),c.findFieldLiterals(n,t)};t.validateScript=function(n,t){return c.validateScript(n,t,"simple")};t.referencesMember=function(n,t){return c.referencesMember(n,t)};t.referencesFunction=function(n,t){return c.referencesFunction(n,t)}})},"esri/arcade/treeAnalysis":function(){define(["require","exports"],function(n,t){function c(n,t,i){return void 0!==n.fmin&&(n.min=n.fmin),void 0!==n.fmax&&(n.max=n.fmax),"0"!==n.min&&i.length<Number(n.min)||"*"!==n.max&&i.length>Number(n.max)?-2:1}function l(n,t,i){if(null!==i.localScope&&void 0!==i.localScope[n.toLowerCase()]){var r=i.localScope[n.toLowerCase()];if("FormulaFunction"===r.type||"any"===r.type)return void 0===r.signature&&(r.signature={min:"0",max:"*"}),c(r.signature,n,t,i)}return void 0!==i.globalScope[n.toLowerCase()]&&(r=i.globalScope[n.toLowerCase()],"FormulaFunction"===r.type||"any"===r.type)?(void 0===r.signature&&(r.signature={min:"0",max:"*"}),c(r.signature,n,t,i)):-1}function r(n,t){var u,e,f;void 0===t&&(t=!0);u=i(n,"SYNTAX","UNREOGNISED");try{switch(n.type){case"VariableDeclarator":return null!==n.init&&"FunctionExpression"===n.init.type?i(n,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):"Identifier"!==n.id.type?i(n,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):null!==n.init?r(n.init,!1):"";case"VariableDeclaration":for(f=0;f<n.declarations.length;f++)if(u=r(n.declarations[f],t),""!==u)return u;return"";case"ForInStatement":if(u=r(n.left,t),""!==u)break;if("VariableDeclaration"===n.left.type){if(1<n.left.declarations.length)return i(n,"SYNTAX","ONLY1VAR");if(null!==n.left.declarations[0].init)return i(n,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==n.left.type)return i(n,"SYNTAX","LEFTNOTVAR");if(u=r(n.right,t),""!==u)break;if(u=r(n.body,t),""!==u)break;return"";case"ForStatement":if(null!==n.test&&(u=r(n.test,t),""!==u))break;if(null!==n.init&&(u=r(n.init,t),""!==u))break;if(null!==n.update&&(u=r(n.update,t),""!==u))break;if(null!==n.body&&(u=r(n.body,t),""!==u))break;return"";case"ContinueStatement":return"";case"EmptyStatement":return"";case"BreakStatement":return"";case"IfStatement":if(u=r(n.test,t),""!==u)break;if(null!==n.consequent&&(u=r(n.consequent,!1),""!==u))break;if(null!==n.alternate&&(u=r(n.alternate,!1),""!==u))break;return"";case"BlockStatement":for(e=[],f=0;f<n.body.length;f++)"EmptyStatement"!==n.body[f].type&&e.push(n.body[f]);for(n.body=e,f=0;f<n.body.length;f++)if(u=r(n.body[f],t),""!==u)return u;return"";case"FunctionDeclaration":return!1===t?i(n,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==n.id.type?i(n,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):r(n.body,!1);case"ReturnStatement":return null!==n.argument?r(n.argument,t):"";case"UpdateExpression":return"Identifier"!==n.argument.type&&"MemberExpression"!==n.argument.type?i(n,"SYNTAX","ASSIGNMENTTOVARSONLY"):r(n.argument,t);case"AssignmentExpression":if("Identifier"!==n.left.type&&"MemberExpression"!==n.left.type)return i(n,"SYNTAX","ASSIGNMENTTOVARSONLY");if(u=r(n.left,t),""!==u)break;switch(n.operator){case"=":case"/=":case"*=":case"%=":case"+=":case"-=":break;default:return i(n,"SYNTAX","OPERATORNOTRECOGNISED")}return r(n.right,!1);case"ExpressionStatement":return r(n.expression,!1);case"Identifier":u="";break;case"MemberExpression":if(u=r(n.object,t),""!==u)break;return!0===n.computed?r(n.property,t):"";case"Literal":return"";case"ThisExpression":return i(n,"SYNTAX","NOTSUPPORTED");case"CallExpression":if("Identifier"!==n.callee.type)return i(n,"SYNTAX","ONLYNODESSUPPORTED");for(u="",f=0;f<n.arguments.length;f++)if(u=r(n.arguments[f],t),""!==u)return u;return"";case"UnaryExpression":u=r(n.argument,t);break;case"BinaryExpression":if(u=r(n.left,t),""!==u)break;if(u=r(n.right,t),""!==u)break;switch(n.operator){case"==":case"!=":case"<":case"<=":case">":case">=":case"+":case"-":case"*":case"/":case"%":break;default:return i(n,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case"LogicalExpression":if(u=r(n.left,t),""!==u)break;if(u=r(n.right),""!==u)break;switch(n.operator){case"&&":case"||":break;default:return i(n,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case"ConditionalExpression":return i(n,"SYNTAX","NOTSUPPORTED");case"ArrayExpression":for(u="",f=0;f<n.elements.length&&(u=r(n.elements[f],t),""===u);f++);break;case"Array":return i(n,"SYNTAX","NOTSUPPORTED");case"ObjectExpression":for(u="",f=0;f<n.properties.length&&(u="",null!==n.properties[f].key&&("Literal"!==n.properties[f].key.type&&"Identifier"!==n.properties[f].key.type&&(u=i(n,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===n.properties[f].key.type&&(e=n.properties[f].key.value,"string"==typeof e||e instanceof String||(u=i(n,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")))),""===u&&(u=r(n.properties[f],t)),""===u);f++);break;case"Property":if("Literal"!==n.key.type&&"Identifier"!==n.key.type)return i(n,"SYNTAX","ONLYLITERAL");if("Identifier"!==n.key.type&&(u=r(n.key,t),""!==u))break;u=r(n.value,t)}return u}catch(o){throw o;}}function u(n,t){var r=i(n,"SYNTAX","UNREOGNISED"),s=null,h="",c,f,e,o,v,p,w;try{switch(n.type){case"VariableDeclarator":return null!==n.init&&"FunctionExpression"===n.init.type?i(n,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):(null!==t.localScope?void 0!==t.localScope[n.id.name.toLowerCase()]&&n.id.name.toLowerCase():void 0!==t.globalScope[n.id.name.toLowerCase()]&&n.id.name.toLowerCase(),c=null===n.init?"":u(n.init,t),""!==c)?c:(null===t.localScope?t.globalScope[n.id.name.toLowerCase()]={type:"any"}:t.localScope[n.id.name.toLowerCase()]={type:"any"},"");case"FunctionDeclaration":return(s=a(n.id.name.toLowerCase(),n,t),h=y(n,t),""!==h)?h:null!==t.localScope?i(n,"SYNTAX","GLOBALFUNCTIONSONLY"):(s.isnative=!1,t.globalScope[n.id.name.toLowerCase()]={type:"FormulaFunction",signature:[s]},"");case"VariableDeclaration":for(r="",f=0;f<n.declarations.length&&(r=u(n.declarations[f],t),""===r);f++);break;case"IfStatement":if(r=u(n.test,t),""!==r)break;if("AssignmentExpression"===n.test.type||"UpdateExpression"===n.test.type)return i(n.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");if(null!==n.consequent&&(r=u(n.consequent,t),""!==r))break;if(null!==n.alternate&&(r=u(n.alternate,t),""!==r))break;return"";case"EmptyStatement":return"";case"BlockStatement":for(f=0;f<n.body.length;f++)if(r=u(n.body[f],t),""!==r)return r;return"";case"ReturnStatement":return null!==n.argument?u(n.argument,t):"";case"ForInStatement":if("VariableDeclaration"===n.left.type){if(1<n.left.declarations.length)return i(n,"SYNTAX","ONLY1VAR");if(null!==n.left.declarations[0].init)return i(n,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==n.left.type)return i(n,"SYNTAX","LEFTNOTVAR");if(r=u(n.left,t),""!==r)break;if(r=u(n.right,t),""!==r)break;if(r=u(n.body,t),""!==r)break;return"";case"ForStatement":if(null!==n.init&&(r=u(n.init,t),""!==r))break;if(null!==n.test&&(r=u(n.test,t),""!==r))break;if(null!==n.body&&(r=u(n.body,t),""!==r))break;if(null!==n.update&&(r=u(n.update,t),""!==r))break;return"";case"BreakStatement":return"";case"ContinueStatement":return"";case"UpdateExpression":return"Identifier"!==n.argument.type&&"MemberExpression"!==n.argument.type?i(n,"SYNTAX","ASSIGNMENTTOVARSONLY"):(e=!1,"MemberExpression"===n.argument.type)?u(n.argument,t):(null!==t.localScope&&void 0!==t.localScope[n.argument.name.toLowerCase()]&&(e=!0),void 0!==t.globalScope[n.argument.name.toLowerCase()]&&(e=!0),!1===e?"Identifier "+n.argument.name+" has not been declared.":"");case"AssignmentExpression":return"Identifier"!==n.left.type&&"MemberExpression"!==n.left.type?i(n,"SYNTAX","ASSIGNMENTTOVARSONLY"):(o=u(n.right,t),""!==o)?o:(e=!1,"MemberExpression"===n.left.type)?(o=u(n.left,t),""!==o?o:""):(null!==t.localScope&&void 0!==t.localScope[n.left.name.toLowerCase()]&&(e=!0),void 0!==t.globalScope[n.left.name.toLowerCase()]&&(e=!0),!1===e?"Identifier "+n.left.name+" has not been declared.":"");case"ExpressionStatement":return u(n.expression,t);case"Identifier":if(v=n.name.toLowerCase(),null!==t.localScope&&void 0!==t.localScope[v])return"";r=void 0!==t.globalScope[v]?"":i(n,"SYNTAX","VARIABLENOTFOUND");break;case"MemberExpression":if(r=u(n.object,t),""!==r)break;return!0===n.computed?u(n.property,t):"";case"Literal":return"";case"ThisExpression":r=i(n,"SYNTAX","NOTSUPPORTED");break;case"CallExpression":if("Identifier"!==n.callee.type)return i(n,"SYNTAX","ONLYNODESSUPPORTED");for(r="",f=0;f<n.arguments.length;f++)if(r=u(n.arguments[f],t),""!==r)return r;p=l(n.callee.name,n.arguments,t);-1===p&&(r=i(n,"SYNTAX","NOTFOUND"));-2===p&&(r=i(n,"SYNTAX","WRONGSIGNATURE"));break;case"UnaryExpression":r=u(n.argument,t);break;case"BinaryExpression":if(r=u(n.left,t),""!==r)break;if(r=u(n.right,t),""!==r)break;return"";case"LogicalExpression":if(r=u(n.left,t),""!==r)break;if("AssignmentExpression"===n.left.type||"UpdateExpression"===n.left.type)return i(n.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");if(r=u(n.right,t),""!==r)break;return"AssignmentExpression"===n.right.type||"UpdateExpression"===n.right.type?i(n.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"";case"ConditionalExpression":return i(n,"SYNTAX","NOTSUPPORTED");case"ArrayExpression":for(r="",f=0;f<n.elements.length&&(r=u(n.elements[f],t),""===r);f++);break;case"ObjectExpression":for(r="",f=0;f<n.properties.length;f++)if(r="",null!==n.properties[f].key&&("Literal"!==n.properties[f].key.type&&"Identifier"!==n.properties[f].key.type&&(r=i(n,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===n.properties[f].key.type)&&(w=n.properties[f].key.value,"string"==typeof w||w instanceof String||(r=i(n,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))),""===r&&(r=u(n.properties[f],t)),""!==r)break;break;case"Property":if("Literal"!==n.key.type&&"Identifier"!==n.key.type)return i(n,"SYNTAX","ONLYLITERAL");if("Identifier"!==n.key.type&&(r=u(n.key,t),""!==r))break;r=u(n.value,t);break;case"Array":return i(n,"SYNTAX","NOTSUPPORTED")}return r}catch(b){throw b;}}function e(n,t){var i=!1,r;try{switch(n.type){case"VariableDeclarator":return null!==n.init?e(n.init,t):i;case"FunctionDeclaration":return e(n.body,t);case"VariableDeclaration":for(r=0;r<n.declarations.length;r++)if(e(n.declarations[r],t))return!0;return i;case"IfStatement":return e(n.test,t)||null!==n.consequent&&e(n.consequent,t)||null!==n.alternate&&e(n.alternate,t)?!0:i;case"EmptyStatement":return i;case"BlockStatement":for(r=0;r<n.body.length;r++)if(e(n.body[r],t))return!0;return i;case"ReturnStatement":return null!==n.argument?e(n.argument,t):i;case"UpdateExpression":return e(n.argument,t);case"AssignmentExpression":return(i=e(n.right,t))?i:e(n.left,t);case"ExpressionStatement":return e(n.expression,t);case"ForInStatement":return(i=e(n.left,t))||(i=e(n.right,t))?i:i=e(n.body,t);case"ForStatement":return null!==n.init&&(i=e(n.init,t))||null!==n.test&&(i=e(n.test,t))||null!==n.body&&(i=e(n.body,t))?i:(null!==n.update&&(i=e(n.update,t)),i);case"BreakStatement":return i;case"ContinueStatement":return i;case"Compound":return i;case"Identifier":return t.toLowerCase()===n.name.toLowerCase();case"MemberExpression":return(i=e(n.object,t))?i:(!0===n.computed&&(i=e(n.property,t)),i);case"Literal":return i;case"ThisExpression":return i;case"CallExpression":for(r=0;r<n.arguments.length;r++)e(n.arguments[r],t)&&(i=!0);return i;case"ArrayExpression":for(r=0;r<n.elements.length;r++)e(n.elements[r],t)&&(i=!0);return i;case"UnaryExpression":return e(n.argument,t);case"BinaryExpression":return(i=e(n.left,t))?i:i=e(n.right,t);case"LogicalExpression":return(i=e(n.left,t))?i:i=e(n.right,t);case"ObjectExpression":for(r=0;r<n.properties.length;r++)e(n.properties[r],t)&&(i=!0);return i;case"Property":return e(n.value,t);case"ConditionalExpression":return i;case"Array":return i;default:return i}}catch(u){throw u;}}function o(n,t){var i=!1,r;try{switch(n.type){case"VariableDeclarator":return null!==n.init?o(n.init,t):i;case"FunctionDeclaration":return o(n.body,t);case"VariableDeclaration":for(r=0;r<n.declarations.length;r++)if(o(n.declarations[r],t))return!0;return i;case"IfStatement":return o(n.test,t)||null!==n.consequent&&o(n.consequent,t)||null!==n.alternate&&o(n.alternate,t)?!0:i;case"EmptyStatement":return i;case"BlockStatement":for(r=0;r<n.body.length;r++)if(o(n.body[r],t))return!0;return i;case"ReturnStatement":return null!==n.argument?o(n.argument,t):i;case"UpdateExpression":return o(n.argument,t);case"AssignmentExpression":return o(n.left,t)?!0:o(n.right,t);case"ExpressionStatement":return o(n.expression,t);case"ForInStatement":return(i=o(n.left,t))||(i=o(n.right,t))?i:i=o(n.body,t);case"ForStatement":return null!==n.init&&(i=o(n.init,t))||null!==n.test&&(i=o(n.test,t))||null!==n.body&&(i=o(n.body,t))?i:(null!==n.update&&(i=o(n.update,t)),i);case"BreakStatement":return i;case"ContinueStatement":return i;case"Compound":return i;case"Identifier":return i;case"MemberExpression":return(i=o(n.object,t))?i:(!0===n.computed&&(i=o(n.property,t)),i);case"Literal":return i;case"ThisExpression":return i;case"CallExpression":if(n.callee.name.toLowerCase()===t.toLowerCase())return!0;for(r=0;r<n.arguments.length;r++)o(n.arguments[r],t)&&(i=!0);return i;case"ArrayExpression":for(r=0;r<n.elements.length;r++)o(n.elements[r],t)&&(i=!0);return i;case"UnaryExpression":return o(n.argument,t);case"BinaryExpression":return(i=o(n.left,t))?i:i=o(n.right,t);case"LogicalExpression":return(i=o(n.left,t))?i:i=o(n.right,t);case"ConditionalExpression":return i;case"ObjectExpression":for(r=0;r<n.properties.length;r++)o(n.properties[r],t)&&(i=!0);return i;case"Property":return o(n.value,t);case"Array":return i;default:return i}}catch(u){throw u;}}function s(n,t){var i=[],r,u;try{switch(n.type){case"VariableDeclarator":return null!==n.init?s(n.init,t):i;case"FunctionDeclaration":return s(n.body,t);case"VariableDeclaration":for(u=0;u<n.declarations.length;u++)r=s(n.declarations[u],t),i=i.concat(r);return i;case"ForInStatement":return r=s(n.left,t),i=i.concat(r),r=s(n.right,t),i=i.concat(r),r=s(n.body,t),i=i.concat(r);case"ForStatement":return null!==n.init&&(r=s(n.init,t),i=i.concat(r)),null!==n.test&&(r=s(n.test,t),i=i.concat(r)),null!==n.body&&(r=s(n.body,t),i=i.concat(r)),null!==n.update&&(r=s(n.update,t),i=i.concat(r)),i;case"IfStatement":return r=s(n.test,t),i=i.concat(r),null!==n.consequent&&(r=s(n.consequent,t),i=i.concat(r)),null!==n.alternate&&(r=s(n.alternate,t),i=i.concat(r)),i;case"EmptyStatement":return i;case"BlockStatement":for(u=0;u<n.body.length;u++)r=s(n.body[u],t),i=i.concat(r);return i;case"ReturnStatement":return null!==n.argument?s(n.argument,t):i;case"UpdateExpression":return s(n.argument,t);case"AssignmentExpression":return i=s(n.left,t),i=i.concat(s(n.right,t));case"ExpressionStatement":return s(n.expression,t);case"BreakStatement":return i;case"ContinueStatement":return i;case"Compound":return i;case"Identifier":return i;case"MemberExpression":if("Identifier"!==n.object.type)return i;if(!1===n.computed)i.push(n.object.name.toLowerCase()+"."+n.property.name.toLowerCase());else try{"Literal"===n.property.type&&"string"==typeof n.property.value&&i.push(n.object.name.toLowerCase()+"."+n.property.value.toString().toLowerCase())}catch(f){}return i;case"Literal":return i;case"ThisExpression":return i;case"CallExpression":for(u=0;u<n.arguments.length;u++)r=s(n.arguments[u],t),i=i.concat(r);return i;case"ArrayExpression":for(u=0;u<n.elements.length;u++)r=s(n.elements[u],t),i=i.concat(r);return i;case"UnaryExpression":return s(n.argument,t);case"ObjectExpression":for(u=0;u<n.properties.length;u++)r=s(n.properties[u],t),i=i.concat(r);return i;case"Property":return s(n.value,t);case"BinaryExpression":return r=s(n.left,t),i=i.concat(r),r=s(n.right,t),i=i.concat(r);case"LogicalExpression":return r=s(n.left,t),i=i.concat(r),r=s(n.right,t),i=i.concat(r);case"ConditionalExpression":return i;case"Array":return i;default:return i}}catch(f){throw f;}}function a(n,t,i){if(i=[],void 0!==t.params&&null!==t.params)for(var r=0;r<t.params.length;r++)i.push("any");return{name:n,"return":"any",params:i}}function y(n,t){for(var r={globalScope:t.globalScope,localScope:{}},i=0;i<n.params.length;i++)r.localScope[n.params[i].name.toLowerCase()]={type:"any"};return u(n.body,r)}function v(n,t,i,r){var f={},u;(void 0===n||null===n)&&(n={});(void 0===i||null===i)&&(i={});f.infinity={type:"any"};f.textformatting={type:"any"};f.pi={type:"any"};for(u in t)("simple"!==r||"simple"===r&&"a"===t[u].av)&&(f[u]={type:"FormulaFunction",signature:t[u]});for(t=0;t<i.length;t++)u=i[t],f[u.name]={type:"FormulaFunction",signature:u};for(u in n)f[u]=n[u],f[u].type="any";return f}function i(n,t,i){var r="";switch(t){case"SYNTAX":r="Syntax Error: ";break;case"RUNTIME":r="Runtime Error: ";break;default:r="Syntax Error: "}try{switch(n.type){case"IfStatement":switch(i){case"CANNOT_USE_ASSIGNMENT_IN_CONDITION":r+=" Assignments not be made in logical tests";break;case"CANNOT_USE_NONBOOLEAN_IN_CONDITION":r+=" Non Boolean used as Condition"}break;case"UpdateExpression":case"AssignmentExpression":switch(i){case"CANNOT_USE_ASSIGNMENT_IN_CONDITION":r+=" Assignments not be made in logical tests";break;case"ASSIGNMENTTOVARSONLY":r+=" Assignments can only be made to identifiers"}break;case"ExpressionStatement":r+=" Assignments can only be made to identifiers";break;case"FunctionDeclaration":switch(i){case"GLOBALFUNCTIONSONLY":r+=" Functions cannot be declared as variables";break;case"FUNCTIONMUSTHAVEIDENTIFIER":r+=" Function Definition must have an identifier"}break;case"VariableDeclaration":r+=" Only 1 variable can be declared at a time";break;case"VariableDeclarator":switch(i){case"FUNCTIONVARIABLEDECLARATOR":r+=" Functions cannot be declared as variables";break;case"VARIABLEMUSTHAVEIDENTIFIER":r+=" Variable Definition must have an identifier"}break;case"Identifier":r+=" Identifier Not Found. ";r+=n.name;break;case"ObjectExpression":switch(i){case"OBJECTPROPERTYMUSTBESTRING":r+=" Property name must be a string"}break;case"ForStatement":switch(i){case"CANNOT_USE_NONBOOLEAN_IN_CONDITION":r+=" Non Boolean used as Condition"}break;case"ForInStatement":switch(i){case"ONLY1VAR":r+=" Can only declare 1 var for use with IN";break;case"CANNOTDECLAREVAL":r+=" Can only declare value for use with IN";break;case"LEFTNOVAR":r+="Must provide a variable to iterate with.";break;case"VARIABLENOTDECLARED":r+="Variable must be declared before it is used..";break;case"CANNOTITERATETHISTYPE":r+="This type cannot be used in an IN loop"}break;case"MemberExpression":switch(i){case"PROPERTYNOTFOUND":r+="Cannot find member property. ";r+=!1===n.computed?n.property.name:"";break;case"OUTOFBOUNDS":r+="Out of Bounds. ";r+=!1===n.computed?n.property.name:"";break;case"NOTFOUND":r+="Cannot call member method on null. ";r+=!1===n.computed?n.property.name:"";break;case"INVALIDTYPE":r+="Cannot call member property on object of this type. ";r+=!1===n.computed?n.property.name:""}break;case"Property":switch(i){case"ONLYLITERAL":r+="Property names must be literals or identifiers"}break;case"Literal":break;case"ThisExpression":r+="THIS construct is not supported.";case"CallExpression":switch(i){case"WRONGSIGNATURE":r+="Function signature does not match: ";r+=n.callee.name;break;case"ONLYNODESUPPORTED":r+="Functions must be declared.";r+=n.callee.name;break;case"NOTAFUNCTION":r+="Not a Function: ";r+=n.callee.name;break;case"NOTFOUND":r+="Function Not Found: "+n.callee.name}break;case"UnaryExpression":switch(i){case"NOTSUPPORTEDUNARYOPERATOR":r+="Operator "+n.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";break;case"NOTSUPPORTEDTYPE":r+="Unary operator "+n.operator+" cannot be used with this argument."}case"BinaryExpression":switch(i){case"OPERATORNOTRECOGNISED":r+="Binary Operator not recognised "+n.operator}break;case"LogicalExpression":switch(i){case"ONLYBOOLEAN":r+="Operator "+n.operator+" cannot be used. Only || or && are allowed values";break;case"ONLYORORAND":r+="Logical Expression "+n.operator+" being applied to parameters that are not boolean."}case"ConditionalExpression":r+="Conditional statements not supported.";break;case"ArrayExpression":switch(i){case"FUNCTIONCONTEXTILLEGAL":r+=" Cannot Put Function inside Array."}break;case"Array":r+="Expression contains unrecognised array structure.";break;default:r+="Expression contains unrecognised code structures."}}catch(u){throw u;}return r}function h(n,t,r){return{line:n.loc.start.line,character:n.loc.start.column,reason:i(n,t,r)}}function p(n,t,i,r,u){for(void 0===u&&(u=!0),t={globalScope:t.globalScope,localScope:{}},u=0;u<n.params.length;u++)t.localScope[n.params[u].name.toLowerCase()]={type:"any"};f(n.body,t,i,r,!1)}function f(n,t,r,u,e){var s,o,c,v;if(void 0===e&&(e=!0),null===n)throw Error("Unnexpexted Expression Syntax");i(n,"SYNTAX","UNREOGNISED");s=null;try{switch(n.type){case"VariableDeclarator":if(null!==n.init&&"FunctionExpression"===n.init.type){u.push(h(n,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"));break}"Identifier"!==n.id.type?u.push(h(n,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(null!==t.localScope?void 0!==t.localScope[n.id.name.toLowerCase()]&&n.id.name.toLowerCase():void 0!==t.globalScope[n.id.name.toLowerCase()]&&n.id.name.toLowerCase(),null===t.localScope?t.globalScope[n.id.name.toLowerCase()]={type:"any"}:t.localScope[n.id.name.toLowerCase()]={type:"any"});null===n.init?"":f(n.init,t,r,u,e);break;case"FunctionDeclaration":!1===e&&u.push(h(n,"SYNTAX","GLOBALFUNCTIONSONLY"));"Identifier"!==n.id.type&&u.push(h(n,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"));s=a("",n,t);p(n,t,r,u,e);null!==t.localScope&&u.push(h(n,"SYNTAX","GLOBALFUNCTIONSONLY"));s.isnative=!1;"Identifier"===n.id.type&&(t.globalScope[n.id.name.toLowerCase()]={type:"FormulaFunction",signature:[s]});break;case"VariableDeclaration":for(o=0;o<n.declarations.length;o++)f(n.declarations[o],t,r,u,e);break;case"IfStatement":null!==n.test&&(f(n.test,t,r,u,e),"AssignmentExpression"!==n.test.type&&"UpdateExpression"!==n.test.type||u.push(h(n.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));null!==n.consequent&&f(n.consequent,t,r,u,e);null!==n.alternate&&f(n.alternate,t,r,u,e);break;case"EmptyStatement":break;case"BlockStatement":if(null!==n.body)for(o=0;o<n.body.length;o++)f(n.body[o],t,r,u,e);break;case"ReturnStatement":null!==n.argument&&f(n.argument,t,r,u,e);break;case"ForInStatement":"VariableDeclaration"===n.left.type?(1<n.left.declarations.length&&u.push(h(n,"SYNTAX","ONLY1VAR")),null!==n.left.declarations[0].init&&u.push(h(n,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==n.left.type&&u.push(h(n,"SYNTAX","LEFTNOTVAR"));f(n.left,t,r,u,e);f(n.right,t,r,u,e);f(n.body,t,r,u,e);break;case"ForStatement":null!==n.init&&f(n.init,t,r,u,e);null!==n.test&&f(n.test,t,r,u,e);null!==n.body&&f(n.body,t,r,u,e);null!==n.update&&f(n.update,t,r,u,e);break;case"BreakStatement":break;case"ContinueStatement":break;case"UpdateExpression":"Identifier"!==n.argument.type&&"MemberExpression"!==n.argument.type?u.push(h(n,"SYNTAX","ASSIGNMENTTOVARSONLY")):("Identifier"===n.argument.type&&(s=!1,!1===r&&(null!==t.localScope&&void 0!==t.localScope[n.argument.name.toLowerCase()]&&(s=!0),void 0!==t.globalScope[n.argument.name.toLowerCase()]&&(s=!0),!1===s&&u.push({line:null===n?0:n.loc.start.line,character:null===n?0:n.loc.start.column,reason:"Identifier "+n.argument.name+" has not been declared."}))),"MemberExpression"===n.argument.type&&f(n.argument,t,r,u,e));break;case"AssignmentExpression":"Identifier"!==n.left.type&&"MemberExpression"!==n.left.type&&u.push(h(n,"SYNTAX","ASSIGNMENTTOVARSONLY"));switch(n.operator){case"=":case"/=":case"*=":case"%=":case"+=":case"-=":break;default:u.push(h(n,"SYNTAX","OPERATORNOTRECOGNISED"))}f(n.right,t,r,u,e);s=!1;"Identifier"===n.left.type&&(null!==t.localScope&&void 0!==t.localScope[n.left.name.toLowerCase()]&&(s=!0),void 0!==t.globalScope[n.left.name.toLowerCase()]&&(s=!0),!1===r&&!1===s&&u.push({line:null===n?0:n.loc.start.line,character:null===n?0:n.loc.start.column,reason:"Identifier "+n.argument.name+" has not been declared."}));"MemberExpression"===n.left.type&&f(n.left,t,r,u,e);break;case"ExpressionStatement":f(n.expression,t,r,u,e);break;case"Identifier":if(c=n.name.toLowerCase(),null!==t.localScope&&void 0!==t.localScope[c])break;void 0===t.globalScope[c]&&!1===r&&u.push(h(n,"SYNTAX","VARIABLENOTFOUND"));break;case"MemberExpression":f(n.object,t,r,u,e);!0===n.computed&&f(n.property,t,r,u,e);break;case"Literal":return"";case"ThisExpression":u.push(h(n,"SYNTAX","NOTSUPPORTED"));break;case"CallExpression":for("Identifier"!==n.callee.type&&u.push(h(n,"SYNTAX","ONLYNODESSUPPORTED")),o=0;o<n.arguments.length;o++)f(n.arguments[o],t,r,u,e);v=l(n.callee.name,n.arguments,t);!1===r&&-1===v&&u.push(h(n,"SYNTAX","NOTFOUND"));-2===v&&u.push(h(n,"SYNTAX","WRONGSIGNATURE"));break;case"UnaryExpression":f(n.argument,t,r,u,e);break;case"BinaryExpression":f(n.left,t,r,u,e);f(n.right,t,r,u,e);switch(n.operator){case"==":case"!=":case"<":case"<=":case">":case">=":case"+":case"-":case"*":case"/":case"%":break;default:u.push(h(n,"SYNTAX","OPERATORNOTRECOGNISED"))}break;case"LogicalExpression":switch(n.operator){case"&&":case"||":break;default:u.push(h(n,"SYNTAX","OPERATORNOTRECOGNISED"))}f(n.left,t,r,u,e);"AssignmentExpression"!==n.left.type&&"UpdateExpression"!==n.left.type||u.push(h(n,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));f(n.right,t,r,u,e);"AssignmentExpression"!==n.right.type&&"UpdateExpression"!==n.right.type||u.push(h(n,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));break;case"ConditionalExpression":u.push(h(n,"SYNTAX","NOTSUPPORTED"));break;case"ArrayExpression":for(o=0;o<n.elements.length;o++)f(n.elements[o],t,r,u,e);break;case"Array":u.push(h(n,"SYNTAX","NOTSUPPORTED"));case"ObjectExpression":for(o=0;o<n.properties.length;o++)f(n.properties[o],t,r,u,e);break;case"Property":"Literal"!==n.key.type&&"Identifier"!==n.key.type&&u.push(h(n,"SYNTAX","ONLYLITERAL"));"Literal"===n.key.type&&f(n.key,t,r,u,e);f(n.value,t,r,u,e);break;default:u.push(h(n,"SYNTAX","UNRECOGNISED"))}}catch(y){u.push({line:null===n?0:n.loc.start.line,character:null===n?0:n.loc.start.column,reason:"Unnexpected Syntax"})}}Object.defineProperty(t,"__esModule",{value:!0});t.functionDecls={concatenate:{min:"0",max:"*",av:"a"},split:{min:"2",max:"4",av:"a"},guid:{min:"0",max:"1",av:"a"},today:{min:"0",max:"0",av:"a"},now:{min:"0",max:"0",av:"a"},timestamp:{min:"0",max:"0",av:"a"},day:{min:"1",max:"1",av:"a"},month:{min:"1",max:"1",av:"a"},year:{min:"1",max:"1",av:"a"},hour:{min:"1",max:"1",av:"a"},second:{min:"1",max:"1",av:"a"},millisecond:{min:"1",max:"1",av:"a"},minute:{min:"1",max:"1",av:"a"},weekday:{min:"1",max:"1",av:"a"},toutc:{min:"1",max:"1",av:"a"},tolocal:{min:"1",max:"1",av:"a"},date:{min:"0",max:"7",av:"a"},datediff:{min:"2",max:"3",av:"a"},dateadd:{min:"2",max:"3",av:"a"},trim:{min:"1",max:"1",av:"a"},text:{min:"1",max:"2",av:"a"},left:{min:"2",max:"2",av:"a"},right:{min:"2",max:"2",av:"a"},mid:{min:"2",max:"3",av:"a"},upper:{min:"1",max:"1",av:"a"},proper:{min:"1",max:"2",av:"a"},lower:{min:"1",max:"1",av:"a"},find:{min:"2",max:"3",av:"a"},iif:{min:"3",max:"3",av:"a"},decode:{min:"2",max:"*",av:"a"},when:{min:"2",max:"*",av:"a"},defaultvalue:{min:"2",max:"2",av:"a"},isempty:{min:"1",max:"1",av:"a"},maplayer:{min:"2",max:"3",av:"f"},domaincode:{min:"3",max:"4",av:"a"},domainname:{min:"2",max:"4",av:"a"},polygon:{min:"1",max:"1",av:"a"},point:{min:"1",max:"1",av:"a"},polyline:{min:"1",max:"1",av:"a"},extent:{min:"1",max:"1",av:"a"},multipoint:{min:"1",max:"1",av:"a"},geometry:{min:"1",max:"1",av:"a"},featurelayer:{min:"1",max:"3",av:"f"},featurecollection:{min:"1",max:"1",av:"f"},buffer:{min:"2",max:"4",av:"f"},area:{min:"1",max:"2",av:"f"},sumarea:{min:"1",max:"2",av:"f"},length:{min:"1",max:"2",av:"f"},sumlength:{min:"1",max:"2",av:"f"},count:{min:"0",max:"*",av:"a"},filter:{min:"2",max:"2",av:"f"},envelopeintersects:{min:"2",max:"2",av:"f"},intersects:{min:"2",max:"2",av:"f"},contains:{min:"2",max:"2",av:"f"},overlaps:{min:"2",max:"2",av:"f"},within:{min:"2",max:"2",av:"f"},touches:{min:"2",max:"2",av:"f"},crosses:{min:"2",max:"2",av:"f"},union:{min:"1",max:"2",av:"f",fmin:1},difference:{min:"2",max:"2",av:"f",fmin:2,fmax:3},intersection:{min:"2",max:"2",av:"f",fmin:2,fmax:3},symmetricdifference:{min:"2",max:"2",av:"f",fmin:2,fmax:3},number:{min:"1",max:"2",av:"a"},acos:{min:"1",max:"1",av:"a"},asin:{min:"1",max:"1",av:"a"},atan:{min:"1",max:"1",av:"a"},atan2:{min:"2",max:"2",av:"a"},ceil:{min:"1",max:"2",av:"a"},floor:{min:"1",max:"2",av:"a"},round:{min:"1",max:"2",av:"a"},cos:{min:"1",max:"1",av:"a"},exp:{min:"1",max:"1",av:"a"},log:{min:"1",max:"1",av:"a"},min:{min:"0",max:"*",av:"a"},console:{min:"0",max:"*",av:"a"},max:{min:"0",max:"*",av:"a"},pow:{min:"2",max:"2",av:"a"},random:{min:"0",max:"0",av:"a"},sqrt:{min:"1",max:"1",av:"a"},sin:{min:"1",max:"1",av:"a"},tan:{min:"1",max:"1",av:"a"},abs:{min:"1",max:"1",av:"a"},isnan:{min:"1",max:"1",av:"a"},stdev:{min:"0",max:"*",av:"a"},average:{min:"0",max:"*",av:"a"},mean:{min:"0",max:"*",av:"a"},sum:{min:"0",max:"*",av:"a"},variance:{min:"0",max:"*",av:"a"},distinct:{min:"0",max:"*",av:"a"},addfield:{min:"3",max:"3",av:"f"},removefield:{min:"2",max:"2",av:"f"},aggregate:{min:"3",max:"3",av:"f"},dissolve:{min:"2",max:"3",av:"f"},changeshape:{min:"2",max:"4",av:"f"},first:{min:"1",max:"1",av:"a"},top:{min:"2",max:"2",av:"a"},orderby:{min:"2",max:"2",av:"f"},boolean:{min:"1",max:"1",av:"a"},dictionary:{min:"0",max:"*",av:"a"},servicearea:{min:"2",max:"*",av:"f"},equals:{min:"2",max:"2",av:"a"},"typeof":{min:"1",max:"1",av:"a"},reverse:{min:"1",max:"1",av:"a"},replace:{min:"3",max:"4",av:"a"},sort:{min:"1",max:"2",av:"a"},feature:{min:"1",max:"*",av:"a"},haskey:{min:"2",max:"2",av:"a"},indexof:{min:"2",max:"2",av:"a"},centroid:{min:"1",max:"1",av:"f"},multiparttosinglepart:{min:"1",max:"1",av:"f"}};t.checkFunctionSignature=c;t.findFunction=l;t.validateLanguageNode=r;t.testValidityOfExpression=u;t.referencesMemberImpl=e;t.referencesMember=function(n,t){return!0===e(n.body[0].body,t.toLowerCase())?!0:!1};t.referencesFunctionImpl=o;t.referencesFunction=function(n,t){return!0===o(n.body[0].body,t)?!0:!1};t.findFieldLiteralsImpl=s;t.findFieldLiterals=function(n,t){return s(n.body[0].body,t)};t.extractFunctionDeclaration=a;t.validateFunction=y;t.constructGlobalScope=v;t.validateScript=function(n,i,r){return void 0===r&&(r="full"),i={globalScope:v(i.vars,t.functionDecls,i.customFunctions,r),localScope:null},u(n.body[0].body,i)};t.validateLanguage=function(n){return"BlockStatement"!==n.body[0].body.type?"Invalid formula content.":r(n.body[0].body)};t.nodeErrorMessage=i;t.makeError=h;t.extractAllIssuesInFunction=p;t.extractAllIssues=f;t.checkScript=function(n,i,r,u){void 0===u&&(u="full");var e=[];if("BlockStatement"!==n.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];(null===i||void 0===i)&&(i={vars:{},customFunctions:[]});i={globalScope:v(i.vars,t.functionDecls,i.customFunctions,u),localScope:null};try{f(n.body[0].body,i,r,e)}catch(o){}return e}})},"esri/arcade/Feature":function(){define("require exports dojo/_base/lang ../geometry/Geometry ../graphic ../geometry/jsonUtils ./Dictionary ./languageUtils ./ImmutableArray ../geometry/Point".split(" "),function(n,t,i,r,u,f,e,o,s,h){return function(){function n(t,i,o){this._layer=this.attributes=this.geometry=null;this.immutable=this._datesfixed=!0;t instanceof n?(this.attributes=t.attributes,this.geometry=t.geometry,t._layer&&(this._layer=t._layer)):t instanceof u?(this.geometry=t.geometry,this.attributes=void 0===t.attributes?{}:null===t.attributes?{}:t.attributes,t._layer?(this._layer=t._layer,this._datesfixed=!1):t.layer&&(this._layer=t.layer,this._datesfixed=!1)):t instanceof e?(this.attributes=t.field("attributes"),null!==this.attributes&&(this.attributes=this.attributes instanceof e?this.attributes.attributes:null),this.geometry=t.field("geometry"),null!==this.geometry&&(this.geometry instanceof e?this.geometry=n.parseGeometryFromDictionary(this.geometry):this.geometry instanceof r||(this.geometry=null))):(i instanceof r||null===i?(this.geometry=i,this.attributes=void 0===t?{}:null===t?{}:t):"string"==typeof t?(t=JSON.parse(t),null!==t.geometry&&void 0!==t.geometry&&(this.geometry=f.fromJson(t.geometry)),this.attributes=void 0===t.attributes?{}:null===t.attributes?{}:t.attributes):(void 0===t?this.attributes={}:null===t&&(this.attributes={}),this.geometry=null),void 0!==o&&(this._layer=o))}return n.prototype.castToText=function(){var t="",i,n;for(i in this.attributes)""!==t&&(t+=","),n=this.attributes[i],null==n?n="null":o.isBoolean(n)||o.isNumber(n)||o.isString(n)?t+=JSON.stringify(i)+":"+JSON.stringify(n):n instanceof r?t+=JSON.stringify(i)+":"+o.toStringExplicit(n):n instanceof s?t+=JSON.stringify(i)+":"+o.toStringExplicit(n):n instanceof Array?t+=JSON.stringify(i)+":"+o.toStringExplicit(n):n instanceof Date?t+=JSON.stringify(i)+":"+JSON.stringify(n):null!==n&&"object"==typeof n&&void 0!==n.castToText&&(t+=JSON.stringify(i)+":"+n.castToText());return'{"geometry":'+(null===this.geometry?"null":o.toStringExplicit(this.geometry))+',"attributes":{'+t+"}}"},n.prototype._fixDates=function(){for(var i,n=[],t=0;t<this._layer.fields.length;t++)i=this._layer.fields[t],"date"!==i.type&&"esriFieldTypeDate"!==i.type||n.push(i.name);0<n.length&&this._fixDateFields(n);this._datesfixed=!0},n.prototype._fixDateFields=function(n){var r,t,u;for(this.attributes=i.mixin({},this.attributes),r=0;r<n.length;r++)if(t=this.attributes[n[r]],null!==t)if(void 0===t){for(u in this.attributes)if(u.toLowerCase()===n[r]){t=this.attributes[u];null===t||t instanceof Date||(this.attributes[u]=new Date(t));break}}else t instanceof Date||(this.attributes[n[r]]=new Date(t))},n.prototype.field=function(n){var t,i;if(!1===this._datesfixed&&this._fixDates(),t=n.toLowerCase(),n=this.attributes[n],void 0!==n)return n;for(i in this.attributes)if(i.toLowerCase()===t)return this.attributes[i];if(this._hasFieldDefinition(t))return null;throw Error("Field not Found");},n.prototype._hasFieldDefinition=function(n){if(null===this._layer)return!1;for(var t=0;t<this._layer.fields.length;t++)if(this._layer.fields[t].name.toLowerCase()===n)return!0;return!1},n.prototype._field=function(n){var i,t;if(!1===this._datesfixed&&this._fixDates(),i=n.toLowerCase(),n=this.attributes[n],void 0!==n)return n;for(t in this.attributes)if(t.toLowerCase()===i)return this.attributes[t];return null},n.prototype.setField=function(n,t){var r,i;if(this.immutable)throw Error("Feature is Immutable");if(!1===o.isSimpleType(t))throw Error("Illegal Value Assignment to Feature");if(r=n.toLowerCase(),void 0===this.attributes[n])for(i in this.attributes)if(i.toLowerCase()===r){this.attributes[i]=t;return}this.attributes[n]=t},n.prototype.hasField=function(n){var t=n.toLowerCase(),i;if(void 0!==this.attributes[n])return!0;for(i in this.attributes)if(i.toLowerCase()===t)return!0;return this._hasFieldDefinition(t)?!0:!1},n.prototype.keys=function(){var t=[],r={},n,i;for(n in this.attributes)t.push(n),r[n.toLowerCase()]=1;if(null!==this._layer)for(n=0;n<this._layer.fields.length;n++)i=this._layer.fields[n],1!==r[i.name.toLowerCase()]&&t.push(i.name);return t.sort()},n.fromFeature=function(t){return new n(t)},n.parseGeometryFromDictionary=function(t){return t=n.convertDictionaryToJson(t,!0),void 0!==t.spatialreference&&(t.spatialReference=t.spatialreference,delete t.spatialreference),void 0!==t.rings&&(t.rings=this.fixPathArrays(t.rings,!0===t.hasZ,!0===t.hasM)),void 0!==t.paths&&(t.paths=this.fixPathArrays(t.paths,!0===t.hasZ,!0===t.hasM)),void 0!==t.points&&(t.points=this.fixPointArrays(t.points,!0===t.hasZ,!0===t.hasM)),f.fromJson(t)},n.fixPathArrays=function(n,t,i){var u=[],r;if(n instanceof Array)for(r=0;r<n.length;r++)u.push(this.fixPointArrays(n[r],t,i));else if(n instanceof s)for(r=0;r<n.length();r++)u.push(this.fixPointArrays(n.get(r),t,i));return u},n.fixPointArrays=function(n,t,i){var u=[],f,r;if(n instanceof Array)for(f=0;f<n.length;f++)r=n[f],r instanceof h?t&&i?u.push([r.x,r.y,r.z,r.m]):t?u.push([r.x,r.y,r.z]):i?u.push([r.x,r.y,r.m]):u.push([r.x,r.y]):u.push(r);else if(n instanceof s)for(f=0;f<n.length();f++)r=n.get(f),r instanceof h?t&&i?u.push([r.x,r.y,r.z,r.m]):t?u.push([r.x,r.y,r.z]):i?u.push([r.x,r.y,r.m]):u.push([r.x,r.y]):u.push(r);return u},n.convertDictionaryToJson=function(t,i){var u,f,r;void 0===i&&(i=!1);u={};for(f in t.attributes)r=t.attributes[f],r instanceof e&&(r=n.convertDictionaryToJson(r)),i?u[f.toLowerCase()]=r:u[f]=r;return u},n.parseAttributesFromDictionary=function(n){var r={},t,i;for(t in n.attributes)if(i=n.attributes[t],o.isSimpleType(i))r[t]=i;else throw Error("Illegal Argument");return r},n.fromJson=function(t){var e=null,r,u,i;if(null!==t.geometry&&void 0!==t.geometry&&(e=f.fromJson(t.geometry)),r={},null!==t.attributes&&void 0!==t.attributes)for(u in t.attributes)if(i=t.attributes[u],o.isString(i)||o.isNumber(i)||o.isBoolean(i)||o.isDate(i))r[u]=i;else throw Error("Illegal Argument");return new n(r,e)},n.prototype.domainValueLookup=function(n,t,i){if(null===this._layer||!this._layer.fields)return null;if(i=o.getDomain(n,this._layer,this,i),void 0===t)try{t=this.field(n)}catch(r){return null}return o.getDomainValue(i,t)},n.prototype.domainCodeLookup=function(n,t,i){return null===this._layer||!this._layer.fields?null:(n=o.getDomain(n,this._layer,this,i),o.getDomainCode(n,t))},n}()})},"esri/arcade/functions/date":function(){define(["require","exports","../../moment","../languageUtils"],function(n,t,i,r){function u(n){return null===n?n:isNaN(n.getTime())?null:n}Object.defineProperty(t,"__esModule",{value:!0});t.registerFunctions=function(n,t){n.today=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,0,0),n=new Date,n.setHours(0,0,0,0),n})};n.now=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,0,0),new Date})};n.timestamp=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,0,0),n=new Date,new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds())})};n.toutc=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?null:new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds())})};n.tolocal=function(n,u){return t(n,u,function(n,t,u){return r.pcCheck(u,1,1),n=r.toDate(u[0]),null===n?null:i.utc([n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()]).toDate()})};n.day=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getDate()})};n.month=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getMonth()})};n.year=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getFullYear()})};n.hour=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getHours()})};n.second=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getSeconds()})};n.millisecond=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getMilliseconds()})};n.minute=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getMinutes()})};n.weekday=function(n,i){return t(n,i,function(n,t,i){return r.pcCheck(i,1,1),n=r.toDate(i[0]),null===n?NaN:n.getDay()})};n.date=function(n,f){return t(n,f,function(n,t,f){return(r.pcCheck(f,0,7),3===f.length)?u(new Date(r.toNumber(f[0]),r.toNumber(f[1]),r.toNumber(f[2]),0,0,0,0)):4===f.length?u(new Date(r.toNumber(f[0]),r.toNumber(f[1]),r.toNumber(f[2]),r.toNumber(f[3]),0,0,0)):5===f.length?u(new Date(r.toNumber(f[0]),r.toNumber(f[1]),r.toNumber(f[2]),r.toNumber(f[3]),r.toNumber(f[4]),0,0)):6===f.length?u(new Date(r.toNumber(f[0]),r.toNumber(f[1]),r.toNumber(f[2]),r.toNumber(f[3]),r.toNumber(f[4]),r.toNumber(f[5]),0)):7===f.length?u(new Date(r.toNumber(f[0]),r.toNumber(f[1]),r.toNumber(f[2]),r.toNumber(f[3]),r.toNumber(f[4]),r.toNumber(f[5]),r.toNumber(f[6]))):2===f.length?(n=r.toString(f[1]),""===n)?null:(n=r.standardiseDateFormat(n),f=i(r.toString(f[0]),n,!0),!0===f.isValid()?f.toDate():null):1===f.length?r.isString(f[0])&&""===f[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")?null:(n=r.toNumber(f[0]),!1===isNaN(n)?u(new Date(n)):r.toDate(f[0])):0===f.length?new Date:void 0})};n.datediff=function(n,i){return t(n,i,function(n,t,i){if(r.pcCheck(i,2,3),n=r.toDateM(i[0]),t=r.toDateM(i[1]),null===n||null===t)return NaN;switch(r.toString(i[2]).toLowerCase()){case"days":case"day":case"d":return n.diff(t,"days",!0);case"months":case"month":return n.diff(t,"months",!0);case"minutes":case"minute":case"m":return"M"===i[2]?n.diff(t,"months",!0):n.diff(t,"minutes",!0);case"seconds":case"second":case"s":return n.diff(t,"seconds",!0);case"milliseconds":case"millisecond":case"ms":return n.diff(t);case"hours":case"hour":case"h":return n.diff(t,"hours",!0);case"years":case"year":case"y":return n.diff(t,"years",!0);default:return n.diff(t)}})};n.dateadd=function(n,i){return t(n,i,function(n,t,i){if(r.pcCheck(i,2,3),n=r.toDateM(i[0]),null===n)return null;t="milliseconds";switch(r.toString(i[2]).toLowerCase()){case"days":case"day":case"d":t="days";break;case"months":case"month":t="months";break;case"minutes":case"minute":case"m":t="M"===i[2]?"months":"minutes";break;case"seconds":case"second":case"s":t="seconds";break;case"milliseconds":case"millisecond":case"ms":t="milliseconds";break;case"hours":case"hour":case"h":t="hours";break;case"years":case"year":case"y":t="years"}return n.add(r.toNumber(i[1]),t),n.toDate()})}}})},"esri/arcade/functions/string":function(){define(["require","exports","../languageUtils","../Feature"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});t.registerFunctions=function(n,t){n.trim=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),i.toString(r[0]).trim()})};n.upper=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),i.toString(r[0]).toUpperCase()})};n.proper=function(n,r){return t(n,r,function(n,t,r){var u;i.pcCheck(r,1,2);n=1;2===r.length&&"firstword"===i.toString(r[1]).toLowerCase()&&(n=2);t=/\s/;r=i.toString(r[0]);for(var o="",f=!0,e=0;e<r.length;e++)u=r[e],t.test(u)?1===n&&(f=!0):u.toUpperCase()!==u.toLowerCase()&&(f?(u=u.toUpperCase(),f=!1):u=u.toLowerCase()),o+=u;return o})};n.lower=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),i.toString(r[0]).toLowerCase()})};n.guid=function(n,r){return t(n,r,function(n,t,r){if(i.pcCheck(r,0,1),0<r.length)switch(i.toString(r[0]).toLowerCase()){case"digits":return i.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return i.generateUUID();case"digits-hyphen-parentheses":return"("+i.generateUUID()+")"}return"{"+i.generateUUID()+"}"})};n.console=function(n,r){return t(n,r,function(t,r,u){return 0!==u.length&&(1===u.length?n.console(i.toString(u[0])):n.console(i.toString(u))),i.voidOperation})};n.mid=function(n,r){return t(n,r,function(n,t,r){return(i.pcCheck(r,2,3),n=i.toNumber(r[1]),isNaN(n))?"":(0>n&&(n=0),2===r.length)?i.toString(r[0]).substr(n):(t=i.toNumber(r[2]),isNaN(t))?"":(0>t&&(t=0),i.toString(r[0]).substr(n,t))})};n.find=function(n,r){return t(n,r,function(n,t,r){if(i.pcCheck(r,2,3),n=0,2<r.length){if(n=i.toNumber(i.defaultUndefined(r[2],0)),isNaN(n))return-1;0>n&&(n=0)}return i.toString(r[1]).indexOf(i.toString(r[0]),n)})};n.left=function(n,r){return t(n,r,function(n,t,r){return(i.pcCheck(r,2,2),n=i.toNumber(r[1]),isNaN(n))?"":(0>n&&(n=0),i.toString(r[0]).substr(0,n))})};n.right=function(n,r){return t(n,r,function(n,t,r){return(i.pcCheck(r,2,2),n=i.toNumber(r[1]),isNaN(n))?"":(0>n&&(n=0),i.toString(r[0]).substr(-1*n,n))})};n.split=function(n,r){return t(n,r,function(n,t,r){if(i.pcCheck(r,2,4),n=i.toNumber(i.defaultUndefined(r[2],-1)),t=i.toBoolean(i.defaultUndefined(r[3],!1)),-1===n||null===n||!0===t?r=i.toString(r[0]).split(i.toString(r[1])):(isNaN(n)&&(n=-1),-1>n&&(n=-1),r=i.toString(r[0]).split(i.toString(r[1]),n)),!1===t)return r;t=[];for(var u=0;u<r.length&&!(-1!==n&&t.length>=n);u++)""!==r[u]&&void 0!==r[u]&&t.push(r[u]);return t})};n.text=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,2),i.toStringExplicit(r[0],r[1])})};n.concatenate=function(n,r){return t(n,r,function(n,t,r){if(n=[],1>r.length)return"";if(i.isArray(r[0])){t=i.defaultUndefined(r[2],"");for(var u=0;u<r[0].length;u++)n[u]=i.toStringExplicit(r[0][u],t);return 1<r.length?n.join(r[1]):n.join("")}if(i.isImmutableArray(r[0])){for(t=i.defaultUndefined(r[2],""),u=0;u<r[0].length();u++)n[u]=i.toStringExplicit(r[0].get(u),t);return 1<r.length?n.join(r[1]):n.join("")}for(u=0;u<r.length;u++)n[u]=i.toStringExplicit(r[u]);return n.join("")})};n.reverse=function(n,r){return t(n,r,function(n,t,r){if(i.pcCheck(r,1,1),i.isArray(r[0]))return n=r[0].slice(0),n.reverse(),n;if(i.isImmutableArray(r[0]))return n=r[0].toArray().slice(0),n.reverse(),n;throw Error("Invalid Parameter");})};n.replace=function(n,r){return t(n,r,function(n,t,r){i.pcCheck(r,3,4);n=i.toString(r[0]);t=i.toString(r[1]);var u=i.toString(r[2]);return(4===r.length?i.toBoolean(r[3]):1)?i.multiReplace(n,t,u):n.replace(t,u)})};n.domainname=function(n,u){return t(n,u,function(n,t,u){if(i.pcCheck(u,2,4),u[0]instanceof r)return u[0].domainValueLookup(i.toString(u[1]),u[2],void 0===u[3]?void 0:i.toNumber(u[3]));throw Error("Invalid Parameter");})};n.domaincode=function(n,u){return t(n,u,function(n,t,u){if(i.pcCheck(u,3,4),u[0]instanceof r)return u[0].domainCodeLookup(i.toString(u[1]),u[2],void 0===u[3]?void 0:i.toNumber(u[3]));throw Error("Invalid Parameter");})}}})},"esri/arcade/functions/maths":function(){define(["require","exports","../languageUtils","dojo/number"],function(n,t,i,r){function u(n,t,i){return"undefined"==typeof i||0==+i?Math[n](t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||0!=i%1)?NaN:(t=t.toString().split("e"),t=Math[n](+(t[0]+"e"+(t[1]?+t[1]-i:-i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+i:i)))}Object.defineProperty(t,"__esModule",{value:!0});t.registerFunctions=function(n,t){n.number=function(n,u){return t(n,u,function(n,t,u){return i.pcCheck(u,1,2),n=u[0],i.isNumber(n)?n:null===n?0:i.isDate(n)||i.isBoolean(n)?Number(n):i.isArray(n)?NaN:""===n||void 0===n?Number(n):i.isString(n)?void 0!==u[1]?(u=i.multiReplace(u[1],"",""),u=i.multiReplace(u,"",""),r.parse(n,{pattern:u})):Number(n.trim()):Number(n)})};n.abs=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.abs(i.toNumber(r[0]))})};n.acos=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.acos(i.toNumber(r[0]))})};n.asin=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.asin(i.toNumber(r[0]))})};n.atan=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.atan(i.toNumber(r[0]))})};n.atan2=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,2,2),Math.atan2(i.toNumber(r[0]),i.toNumber(r[1]))})};n.ceil=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,2),2===r.length?(n=i.toNumber(r[1]),isNaN(n)&&(n=0),u("ceil",i.toNumber(r[0]),-1*n)):Math.ceil(i.toNumber(r[0]))})};n.round=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,2),2===r.length?(n=i.toNumber(r[1]),isNaN(n)&&(n=0),u("round",i.toNumber(r[0]),-1*n)):Math.round(i.toNumber(r[0]))})};n.floor=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,2),2===r.length?(n=i.toNumber(r[1]),isNaN(n)&&(n=0),u("floor",i.toNumber(r[0]),-1*n)):Math.floor(i.toNumber(r[0]))})};n.cos=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.cos(i.toNumber(r[0]))})};n.isnan=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),"number"==typeof r[0]&&isNaN(r[0])})};n.exp=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.exp(i.toNumber(r[0]))})};n.log=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.log(i.toNumber(r[0]))})};n.pow=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,2,2),Math.pow(i.toNumber(r[0]),i.toNumber(r[1]))})};n.random=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,0,0),Math.random()})};n.sin=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.sin(i.toNumber(r[0]))})};n.sqrt=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.sqrt(i.toNumber(r[0]))})};n.tan=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),Math.tan(i.toNumber(r[0]))})};n.defaultvalue=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,2,2),null===r[0]||""===r[0]||void 0===r[0]?r[1]:r[0]})};n.isempty=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),null===r[0]||""===r[0]||void 0===r[0]?!0:!1})};n.boolean=function(n,r){return t(n,r,function(n,t,r){return i.pcCheck(r,1,1),i.toBoolean(r[0])})}}})},"esri/arcade/functions/geometry":function(){define("require exports ../../geometry/Geometry ../../geometry/Polygon ../../geometry/Polyline ../../geometry/Point ../../geometry/Extent ../../geometry/Multipoint ../../geometry/jsonUtils ../languageUtils ../Dictionary ../Feature".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){Object.defineProperty(t,"__esModule",{value:!0});t.registerFunctions=function(n,t){n.polygon=function(n,i){return t(n,i,function(t,i,u){if(h.pcCheck(u,1,1),t=null,u[0]instanceof c){if(t=h.fixSpatialReference(l.parseGeometryFromDictionary(u[0]),n.spatialReference),!1==t instanceof r)throw Error("Illegal Parameter");}else t=u[0]instanceof r?s.fromJson(u[0].toJson()):h.fixSpatialReference(new r(JSON.parse(u[0])),n.spatialReference);if(null!==t&&!1===t.spatialReference.equals(n.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return h.fixNullGeometry(t)})};n.polyline=function(n,i){return t(n,i,function(t,i,r){if(h.pcCheck(r,1,1),t=null,r[0]instanceof c){if(t=h.fixSpatialReference(l.parseGeometryFromDictionary(r[0]),n.spatialReference),!1==t instanceof u)throw Error("Illegal Parameter");}else t=r[0]instanceof u?s.fromJson(r[0].toJson()):h.fixSpatialReference(new u(JSON.parse(r[0])),n.spatialReference);if(null!==t&&!1===t.spatialReference.equals(n.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return h.fixNullGeometry(t)})};n.point=function(n,i){return t(n,i,function(t,i,r){if(h.pcCheck(r,1,1),t=null,r[0]instanceof c){if(t=h.fixSpatialReference(l.parseGeometryFromDictionary(r[0]),n.spatialReference),!1==t instanceof f)throw Error("Illegal Parameter");}else t=r[0]instanceof f?s.fromJson(r[0].toJson()):h.fixSpatialReference(new f(JSON.parse(r[0])),n.spatialReference);if(null!==t&&!1===t.spatialReference.equals(n.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return h.fixNullGeometry(t)})};n.multipoint=function(n,i){return t(n,i,function(t,i,r){if(h.pcCheck(r,1,1),t=null,r[0]instanceof c){if(t=h.fixSpatialReference(l.parseGeometryFromDictionary(r[0]),n.spatialReference),!1==t instanceof o)throw Error("Illegal Parameter");}else t=r[0]instanceof o?s.fromJson(r[0].toJson()):h.fixSpatialReference(new o(JSON.parse(r[0])),n.spatialReference);if(null!==t&&!1===t.spatialReference.equals(n.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return h.fixNullGeometry(t)})};n.extent=function(n,i){return t(n,i,function(t,i,a){if(h.pcCheck(a,1,1),t=null,a[0]instanceof c?t=h.fixSpatialReference(l.parseGeometryFromDictionary(a[0]),n.spatialReference):a[0]instanceof f?(t={xmin:a[0].x,ymin:a[0].y,xmax:a[0].x,ymax:a[0].y,spatialReference:a[0].spatialReference.toJson()},a[0].hasZ?(t.zmin=a[0].z,t.zmax=a[0].z):a[0].hasM&&(t.mmin=a[0].m,t.mmax=a[0].m),t=s.fromJson(t)):t=a[0]instanceof r?s.fromJson(a[0].getExtent().toJson()):a[0]instanceof u?s.fromJson(a[0].getExtent().toJson()):a[0]instanceof o?s.fromJson(a[0].getExtent().toJson()):a[0]instanceof e?s.fromJson(a[0].toJson()):h.fixSpatialReference(new e(JSON.parse(a[0])),n.spatialReference),null!==t&&!1===t.spatialReference.equals(n.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return h.fixNullGeometry(t)})};n.geometry=function(n,i){return t(n,i,function(t,i,r){if(h.pcCheck(r,1,1),t=null,t=r[0]instanceof l?h.fixSpatialReference(r[0].geometry,n.spatialReference):r[0]instanceof c?h.fixSpatialReference(l.parseGeometryFromDictionary(r[0]),n.spatialReference):h.fixSpatialReference(s.fromJson(JSON.parse(r[0])),n.spatialReference),null!==t&&!1===t.spatialReference.equals(n.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return h.fixNullGeometry(t)})};n.feature=function(n,r){return t(n,r,function(t,r,u){var e,o,f;if(0===u.length)throw Error("Missing Parameters");if(t=null,1===u.length)if(h.isString(u[0]))t=l.fromJson(JSON.parse(u[0]));else if(u[0]instanceof l)t=new l(u[0]);else if(u[0]instanceof i)t=new l(null,u[0]);else if(u[0]instanceof c)t=u[0].hasField("geometry")?u[0].field("geometry"):null,r=u[0].hasField("attributes")?u[0].field("attributes"):null,null!==t&&t instanceof c&&(t=l.parseGeometryFromDictionary(t)),null!==r&&(r=l.parseAttributesFromDictionary(r)),t=new l(r,t);else throw Error("Illegal Argument");else{if(2===u.length){if(r=t=null,null!==u[0])if(u[0]instanceof i)t=u[0];else if(t instanceof c)t=l.parseGeometryFromDictionary(u[0]);else throw Error("Illegal Argument");if(null!==u[1])if(u[1]instanceof c)r=l.parseAttributesFromDictionary(u[1]);else throw Error("Illegal Argument");}else{if(t=null,r={},null!==u[0])if(u[0]instanceof i)t=u[0];else if(t instanceof c)t=l.parseGeometryFromDictionary(u[0]);else throw Error("Illegal Argument");for(e=1;e<u.length;e+=2)if(o=h.toString(u[e]),f=u[e+1],null===f||void 0===f||h.isString(f)||isNaN(f)||h.isDate(f)||h.isNumber(f)||h.isBoolean(f)){if(h.isFunctionParameter(f)||!1===h.isSimpleType(f))throw Error("Illegal Argument");r[o]=f===h.voidOperation?null:f}else throw Error("Illegal Argument");}t=new l(r,t)}return t.geometry=h.fixSpatialReference(t.geometry,n.spatialReference),t.immutable=!1,t})};n.dictionary=function(n,i){return t(n,i,function(n,t,i){if(0===i.length)throw Error("Missing Parameters");if(0!=i.length%2)throw Error("Missing Parameters");for(n={},t=0;t<i.length;t+=2){var u=h.toString(i[t]),r=i[t+1];if(null===r||void 0===r||h.isString(r)||isNaN(r)||h.isDate(r)||h.isNumber(r)||h.isBoolean(r)||h.isArray(r)||h.isImmutableArray(r)){if(h.isFunctionParameter(r))throw Error("Illegal Argument");n[u]=r===h.voidOperation?null:r}else throw Error("Illegal Argument");}return i=new c(n),i.immutable=!1,i})};n.haskey=function(n,i){return t(n,i,function(n,t,i){if(h.pcCheck(i,2,2),n=h.toString(i[1]),i[0]instanceof l||i[0]instanceof c)return i[0].hasField(n);throw Error("Illegal Argument");})};n.indexof=function(n,i){return t(n,i,function(n,t,i){if(h.pcCheck(i,2,2),n=i[1],h.isArray(i[0])){for(t=0;t<i[0].length;t++)if(h.equalityTest(n,i[0][t]))return t;return-1}if(h.isImmutableArray(i[0])){var r=i[0].length();for(t=0;t<r;t++)if(h.equalityTest(n,i[0].get(t)))return t;return-1}throw Error("Illegal Argument");})}}})},"esri/arcade/functions/stats":function(){define(["require","exports","../languageUtils","./fieldStats"],function(n,t,i,r){function u(n,t,u,f){if(1===f.length){if(i.isArray(f[0]))return r.calculateStat(n,f[0],-1);if(i.isImmutableArray(f[0]))return r.calculateStat(n,f[0].toArray(),-1)}return r.calculateStat(n,f,-1)}Object.defineProperty(t,"__esModule",{value:!0});t.registerFunctions=function(n,t){n.stdev=function(n,i){return t(n,i,function(n,t,i){return u("stdev",n,t,i)})};n.variance=function(n,i){return t(n,i,function(n,t,i){return u("variance",n,t,i)})};n.average=function(n,i){return t(n,i,function(n,t,i){return u("mean",n,t,i)})};n.mean=function(n,i){return t(n,i,function(n,t,i){return u("mean",n,t,i)})};n.sum=function(n,i){return t(n,i,function(n,t,i){return u("sum",n,t,i)})};n.min=function(n,i){return t(n,i,function(n,t,i){return u("min",n,t,i)})};n.max=function(n,i){return t(n,i,function(n,t,i){return u("max",n,t,i)})};n.distinct=function(n,i){return t(n,i,function(n,t,i){return u("distinct",n,t,i)})};n.count=function(n,r){return t(n,r,function(n,t,r){if(i.pcCheck(r,1,1),i.isArray(r[0])||i.isString(r[0]))return r[0].length;if(i.isImmutableArray(r[0]))return r[0].length();throw Error("Invalid Parameters for Count");})}}})},"esri/arcade/functions/fieldStats":function(){define(["require","exports","../languageUtils"],function(n,t,i){function r(n){for(var i=0,t=0;t<n.length;t++)i+=n[t];return i/n.length}function u(n){for(var u=r(n),i=0,t=0;t<n.length;t++)i+=Math.pow(u-n[t],2);return i/n.length}Object.defineProperty(t,"__esModule",{value:!0});t.decodeStatType=function(n){switch(n.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""};t.calculateStat=function(n,t,f){var e,c,s;void 0===f&&(f=1e3);switch(n.toLowerCase()){case"distinct":n:{n=f;f=[];for(var l={},h=[],o=0;o<t.length;o++){if(void 0!==t[o]&&null!==t[o]&&t[o]!==i.voidOperation)if(e=t[o],i.isNumber(e)||i.isString(e))void 0===l[e]&&(f.push(e),l[e]=1);else{for(c=!1,s=0;s<h.length;s++)!0===i.equalityTest(h[s],e)&&(c=!0);!1===c&&(h.push(e),f.push(e))}if(f.length>=n&&-1!==n){t=f;break n}}t=f}return t;case"avg":case"mean":return r(i.toNumberArray(t));case"min":return Math.min.apply(Math,i.toNumberArray(t));case"sum":for(t=i.toNumberArray(t),f=n=0;f<t.length;f++)n+=t[f];return n;case"max":return Math.max.apply(Math,i.toNumberArray(t));case"stdev":case"stddev":return Math.sqrt(u(i.toNumberArray(t)));case"var":case"variance":return u(i.toNumberArray(t));case"count":return t.length}return 0}})},"esri/arcade/parser":function(){define(["require","exports","./treeAnalysis","./lib/esprima"],function(n,t,i,r){Object.defineProperty(t,"__esModule",{value:!0});t.parseScript=function(n){if(n=r.parse("function _() { "+n+"\n}"),null===n.body||void 0===n.body)throw Error("No formula provided.");if(0===n.body.length)throw Error("No formula provided.");if(0===n.body.length)throw Error("No formula provided.");if("BlockStatement"!==n.body[0].body.type)throw Error("Invalid formula content.");var t=i.validateLanguage(n);if(""!==t)throw Error(t);return n};t.scriptCheck=function(n,t,u,f){var h=[],c,o,s,l;try{if(c=r.parse("function _() { "+n+"\n}",{tolerant:!0,loc:!0}),o=c.errors,0<o.length)for(s=0;s<o.length;s++)h.push({line:o[s].lineNumber,character:o[s].column,reason:o[s].description});for(l=i.checkScript(c,t,u,f),t=0;t<l.length;t++)h.push(l[t])}catch(e){try{"Unexpected token }"===e.description&&(e.index=("function _() { "+n+"\n}").length-1)?h.push({line:e.lineNumber,character:e.column,reason:"Unexpected end of script"}):h.push({line:e.lineNumber,character:e.column,reason:e.description})}catch(a){}}return h};t.extractFieldLiterals=function(n,t){return void 0===t&&(t=!1),i.findFieldLiterals(n,t)};t.validateScript=function(n,t,r){return void 0===r&&(r="full"),i.validateScript(n,t,r)};t.referencesMember=function(n,t){return i.referencesMember(n,t)};t.referencesFunction=function(n,t){return i.referencesFunction(n,t)}})},"esri/arcade/lib/esprima":function(){(function(n,t){"function"==typeof define&&define.amd?define(["exports"],t):"undefined"!=typeof exports?t(exports):t(n.esprima={})})(this,function(n){function vt(n,t){if(!n)throw Error("ASSERT: "+t);}function it(n){return 48<=n&&57>=n}function oi(n){return 0<="0123456789abcdefABCDEF".indexOf(n)}function yt(n){return 0<="01234567".indexOf(n)}function dt(n){return 10===n||13===n||8232===n||8233===n}function ht(n){return 36===n||95===n||65<=n&&90>=n||97<=n&&122>=n||92===n||128<=n&&bi.NonAsciiIdentifierStart.test(String.fromCharCode(n))}function si(n){return 36===n||95===n||65<=n&&90>=n||97<=n&&122>=n||48<=n&&57>=n||92===n||128<=n&&bi.NonAsciiIdentifierPart.test(String.fromCharCode(n))}function wr(n){n=n.toLowerCase();switch(n.length){case 2:return"if"===n||"in"===n;case 3:return"var"===n||"for"===n;case 4:return"else"===n;case 5:return"break"===n;case 6:return"return"===n;case 8:return"function"===n.toLowerCase()||"continue"===n;default:return!1}}function hi(n,t,r,u,f){vt("number"==typeof r,"Comment must have valid position");o.lastCommentStart>=r||(o.lastCommentStart=r,n={type:n,value:t},i.range&&(n.range=[r,u]),i.loc&&(n.loc=f),i.comments.push(n),i.attachComment&&(i.leadingComments.push(n),i.trailingComments.push(n)))}function ci(n){for(var e,u=t-n,f={start:{line:h,column:t-l-n}};t<p;)if(e=r.charCodeAt(t),++t,dt(e)){i.comments&&(n=r.slice(u+n,t-1),f.end={line:h,column:t-l-1},hi("Line",n,u,t-1,f));13===e&&10===r.charCodeAt(t)&&++t;++h;l=t;return}i.comments&&(n=r.slice(u+n,t),f.end={line:h,column:t-l},hi("Line",n,u,t,f))}function ct(){for(var n,f=0===t;t<p;)if(n=r.charCodeAt(t),32===n||9===n||11===n||12===n||160===n||5760<=n&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(n))++t;else if(dt(n))++t,13===n&&10===r.charCodeAt(t)&&++t,++h,l=t,f=!0;else if(47===n)if(n=r.charCodeAt(t+1),47===n)++t,++t,ci(2),f=!0;else if(42===n){++t;++t;n:{var e=n=void 0,u=void 0,u=void 0;for(i.comments&&(n=t-2,e={start:{line:h,column:t-l-2}});t<p;)if(u=r.charCodeAt(t),dt(u))13===u&&10===r.charCodeAt(t+1)&&++t,++h,++t,l=t,t>=p&&y();else{if(42===u&&47===r.charCodeAt(t+1)){++t;++t;i.comments&&(u=r.slice(n+2,t-2),e.end={line:h,column:t-l},hi("Block",u,n,t,e));break n}++t}y()}}else break;else if(f&&45===n)if(45===r.charCodeAt(t+1)&&62===r.charCodeAt(t+2))t+=3,ci(3);else break;else if(60===n)if("!--"===r.slice(t+1,t+4))++t,++t,++t,++t,ci(4);else break;else break}function li(n){var u,f,i=0;for(u="u"===n?4:2,n=0;n<u;++n)if(t<p&&oi(r[t]))f=r[t++],i=16*i+"0123456789abcdef".indexOf(f.toLowerCase());else return"";return String.fromCharCode(i)}function ki(){var n,i;for(n=r.charCodeAt(t++),i=String.fromCharCode(n),92===n&&(117!==r.charCodeAt(t)&&y(),++t,(n=li("u"))&&"\\"!==n&&ht(n.charCodeAt(0))||y(),i=n);t<p;){if(n=r.charCodeAt(t),!si(n))break;++t;i+=String.fromCharCode(n);92===n&&(i=i.substr(0,i.length-1),117!==r.charCodeAt(t)&&y(),++t,(n=li("u"))&&"\\"!==n&&si(n.charCodeAt(0))||y(),i+=n)}return i}function et(){var f=t,n=r.charCodeAt(t),o,e=r[t];switch(n){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++t,i.tokenize&&(40===n?i.openParenToken=i.tokens.length:123===n&&(i.openCurlyToken=i.tokens.length)),{type:u.Punctuator,value:String.fromCharCode(n),lineNumber:h,lineStart:l,start:f,end:t};default:if(o=r.charCodeAt(t+1),61===o)switch(n){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return t+=2,{type:u.Punctuator,value:String.fromCharCode(n)+String.fromCharCode(o),lineNumber:h,lineStart:l,start:f,end:t};case 33:case 61:return t+=2,61===r.charCodeAt(t)&&++t,{type:u.Punctuator,value:r.slice(f,t),lineNumber:h,lineStart:l,start:f,end:t}}}if(n=r.substr(t,4),">>>="===n)return t+=4,{type:u.Punctuator,value:n,lineNumber:h,lineStart:l,start:f,end:t};if(n=n.substr(0,3),">>>"===n||"<<="===n||">>="===n)return t+=3,{type:u.Punctuator,value:n,lineNumber:h,lineStart:l,start:f,end:t};if(n=n.substr(0,2),e===n[1]&&0<="+-<>&|".indexOf(e)||"=>"===n)return t+=2,{type:u.Punctuator,value:n,lineNumber:h,lineStart:l,start:f,end:t};if(0<="<>=!+-*%&|^/".indexOf(e))return++t,{type:u.Punctuator,value:e,lineNumber:h,lineStart:l,start:f,end:t};y()}function di(){var i,f,n;if(n=r[t],vt(it(n.charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),f=t,i="","."!==n){if(i=r[t++],n=r[t],"0"===i){if("x"===n||"X"===n){for(++t,i="";t<p&&oi(r[t]);)i+=r[t++];return 0===i.length&&y(),ht(r.charCodeAt(t))&&y(),{type:u.NumericLiteral,value:parseInt("0x"+i,16),lineNumber:h,lineStart:l,start:f,end:t}}if("b"===n||"B"===n){for(++t,n="";t<p;){if(i=r[t],"0"!==i&&"1"!==i)break;n+=r[t++]}return 0===n.length&&y(),t<p&&(i=r.charCodeAt(t),(ht(i)||it(i))&&y()),{type:u.NumericLiteral,value:parseInt(n,2),lineNumber:h,lineStart:l,start:f,end:t}}if("o"===n||"O"===n||yt(n)){for(yt(n)?(n=!0,i="0"+r[t++]):(n=!1,++t,i="");t<p&&yt(r[t]);)i+=r[t++];return n||0!==i.length||y(),(ht(r.charCodeAt(t))||it(r.charCodeAt(t)))&&y(),{type:u.NumericLiteral,value:parseInt(i,8),octal:n,lineNumber:h,lineStart:l,start:f,end:t}}n&&it(n.charCodeAt(0))&&y()}for(;it(r.charCodeAt(t));)i+=r[t++];n=r[t]}if("."===n){for(i+=r[t++];it(r.charCodeAt(t));)i+=r[t++];n=r[t]}if("e"===n||"E"===n)if(i+=r[t++],n=r[t],("+"===n||"-"===n)&&(i+=r[t++]),it(r.charCodeAt(t)))for(;it(r.charCodeAt(t));)i+=r[t++];else y();return ht(r.charCodeAt(t))&&y(),{type:u.NumericLiteral,value:parseFloat(i),lineNumber:h,lineStart:l,start:f,end:t}}function gi(){f=null;ct();rt("Regular Expression language structures not supported")}function pt(){ct();gi()}function br(){var n;if(n=i.tokens[i.tokens.length-1],!n)return pt();if("Punctuator"===n.type){if("]"===n.value)return et();if(")"===n.value)return n=i.tokens[i.openParenToken-1],!n||"Keyword"!==n.type||"if"!==n.value.toLowerCase()&&"while"!==n.value.toLowerCase()&&"for"!==n.value.toLowerCase()&&"with"!==n.value.toLowerCase()?et():pt();if("}"===n.value){if(i.tokens[i.openCurlyToken-3]&&"Keyword"===i.tokens[i.openCurlyToken-3].type){if(n=i.tokens[i.openCurlyToken-4],!n)return et()}else if(i.tokens[i.openCurlyToken-4]&&"Keyword"===i.tokens[i.openCurlyToken-4].type){if(n=i.tokens[i.openCurlyToken-5],!n)return pt()}else return et();if(0<=pr.indexOf(n.value))return et()}return pt()}return"Keyword"===n.type&&"this"!==n.value?pt():et()}function ai(){var f,o,c,s,n,e,a,v,w;if(ct(),t>=p)return{type:u.EOF,lineNumber:h,lineStart:l,start:t,end:t};if(f=r.charCodeAt(t),ht(f)){if(f=t,92===r.charCodeAt(t))o=ki();else n:{for(o=t++;t<p;){if(c=r.charCodeAt(t),92===c){t=o;o=ki();break n}if(si(c))++t;else break}o=r.slice(o,t)}return{type:1===o.length?u.Identifier:wr(o)?u.Keyword:"null"===o.toLowerCase()?u.NullLiteral:"true"===o.toLowerCase()||"false"===o.toLowerCase()?u.BooleanLiteral:u.Identifier,value:o,lineNumber:h,lineStart:l,start:f,end:t}}if(40===f||41===f||59===f)return et();if(39===f||34===f){for(s="",c=!1,v=h,w=l,f=r[t],vt("'"===f||'"'===f,"String literal must starts with a quote"),o=t,++t;t<p;)if(n=r[t++],n===f){f="";break}else if("\\"===n)if((n=r[t++])&&dt(n.charCodeAt(0)))++h,"\r"===n&&"\n"===r[t]&&++t,l=t;else switch(n){case"u":case"x":if("{"===r[t]){for(++t,e=n=void 0,n=r[t],e=0,"}"===n&&y();t<p;){if(n=r[t++],!oi(n))break;e=16*e+"0123456789abcdef".indexOf(n.toLowerCase())}(1114111<e||"}"!==n)&&y();n=65535>=e?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320);s+=n}else a=t,(e=li(n))?s+=e:(t=a,s+=n);break;case"n":s+="\n";break;case"r":s+="\r";break;case"t":s+="\t";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\x0b";break;default:yt(n)?(e="01234567".indexOf(n),0!==e&&(c=!0),t<p&&yt(r[t])&&(c=!0,e=8*e+"01234567".indexOf(r[t++]),0<="0123".indexOf(n)&&t<p&&yt(r[t])&&(e=8*e+"01234567".indexOf(r[t++]))),s+=String.fromCharCode(e)):s+=n}else if(dt(n.charCodeAt(0)))break;else s+=n;return""!==f&&y(),{type:u.StringLiteral,value:s,octal:c,startLineNumber:v,startLineStart:w,lineNumber:h,lineStart:l,start:o,end:t}}return 46===f?it(r.charCodeAt(t+1))?di():et():it(f)?di():i.tokenize&&47===f?br():et()}function nr(){var f,n,e;return ct(),f={start:{line:h,column:t-l}},n=ai(),f.end={line:h,column:t-l},n.type!==u.EOF&&(e=r.slice(n.start,n.end),f={type:tt[n.type],value:e,range:[n.start,n.end],loc:f},n.regex&&(f.regex={pattern:n.regex.pattern,flags:n.regex.flags}),i.tokens.push(f)),n}function c(){var n;return n=f,t=n.end,h=n.lineNumber,l=n.lineStart,f="undefined"!=typeof i.tokens?nr():ai(),t=n.end,h=n.lineNumber,l=n.lineStart,n}function vi(){var n,r,u;n=t;r=h;u=l;f="undefined"!=typeof i.tokens?nr():ai();t=n;h=r;l=u}function tr(){this.line=h;this.column=t-l}function kr(){this.start=new tr;this.end=null}function dr(n){this.start=n.type===u.StringLiteral?{line:n.startLineNumber,column:n.start-n.startLineStart}:{line:n.lineNumber,column:n.start-n.lineStart};this.end=null}function b(){t=f.start;f.type===u.StringLiteral?(h=f.startLineNumber,l=f.startLineStart):(h=f.lineNumber,l=f.lineStart);i.range&&(this.range=[t,0]);i.loc&&(this.loc=new kr)}function k(n){i.range&&(this.range=[n.start,0]);i.loc&&(this.loc=new dr(n))}function ni(){var i,n,r,u;return i=t,n=h,r=l,ct(),u=h!==n,t=i,h=n,l=r,u}function ti(n,t,i){var r=Error("Line "+n+": "+i);return r.index=t,r.lineNumber=n,r.column=t-l+1,r.description=i,r}function rt(n){var i,r;i=Array.prototype.slice.call(arguments,1);r=n.replace(/%(\d)/g,function(n,t){return vt(t<i.length,"Message reference must be in range"),i[t]});throw ti(h,t,r);}function ut(n){var u,r;if(u=Array.prototype.slice.call(arguments,1),r=n.replace(/%(\d)/g,function(n,t){return vt(t<u.length,"Message reference must be in range"),u[t]}),r=ti(h,t,r),i.errors)i.errors.push(r);else throw r;}function ir(n,i){var r=v.UnexpectedToken;return n&&(r=i?i:n.type===u.EOF?v.UnexpectedEOS:n.type===u.Identifier?v.UnexpectedIdentifier:n.type===u.NumericLiteral?v.UnexpectedNumber:n.type===u.StringLiteral?v.UnexpectedString:v.UnexpectedToken),r=r.replace("%0",n?n.value:"ILLEGAL"),n&&"number"==typeof n.lineNumber?ti(n.lineNumber,n.start,r):ti(h,t,r)}function y(n,t){throw ir(n,t);}function ft(n,t){var r=ir(n,t);if(i.errors)i.errors.push(r);else throw r;}function a(n){var t=c();t.type===u.Punctuator&&t.value===n||y(t)}function rr(){var n;i.errors?(n=f,n.type===u.Punctuator&&","===n.value?c():n.type===u.Punctuator&&";"===n.value?(c(),ft(n)):ft(n,v.UnexpectedToken)):a(",")}function ot(n){var t=c();t.type===u.Keyword&&t.value.toLowerCase()===n.toLowerCase()||y(t)}function e(n){return f.type===u.Punctuator&&f.value===n}function nt(n){return f.type===u.Keyword&&f.value.toLowerCase()===n.toLowerCase()}function lt(){var n;59===r.charCodeAt(t)||e(";")?c():(n=h,ct(),h===n&&(f.type===u.EOF||e("}")||y(f)))}function ii(n){return n.type===s.Identifier||n.type===s.MemberExpression}function ri(n){var t,i,r=new b;return t=w,i=ei(),w=t,r.finishFunctionExpression(null,n,[],i)}function ur(){var t,n;return t=w,w=!0,n=wi(),n=ri(n.params),w=t,n}function ui(){var n,t=new b;return n=c(),n.type===u.StringLiteral||n.type===u.NumericLiteral?(w&&n.octal&&ft(n,v.StrictOctalLiteral),t.finishLiteral(n)):t.finishIdentifier(n.value)}function gr(){var n,t,r,i=new b;if(n=f,n.type===u.Identifier)return t=ui(),"get"!==n.value||e(":")||e("(")?"set"!==n.value||e(":")||e("(")?e(":")?(c(),n=d(),i.finishProperty("init",t,n,!1,!1)):e("(")?(n=ur(),i.finishProperty("init",t,n,!0,!1)):i.finishProperty("init",t,t,!1,!0):(t=ui(),a("("),n=f,n.type!==u.Identifier?(a(")"),ft(n),n=ri([])):(r=[at()],a(")"),n=ri(r,n)),i.finishProperty("set",t,n,!1,!1)):(t=ui(),a("("),a(")"),n=ri([]),i.finishProperty("get",t,n,!1,!1));if(n.type===u.EOF||n.type===u.Punctuator)y(n);else{if(t=ui(),e(":"))return c(),n=d(),i.finishProperty("init",t,n,!1,!1);if(e("("))return n=ur(),i.finishProperty("init",t,n,!0,!1);y(c())}}function yi(n){var u=[],t,i,r={},f=String,o=new b;for(!0!==n&&a("{");!e("}");)n=gr(),t=n.key.type===s.Identifier?n.key.name:f(n.key.value),i="init"===n.kind?st.Data:"get"===n.kind?st.Get:st.Set,t="$"+t,Object.prototype.hasOwnProperty.call(r,t)?(r[t]===st.Data?w&&i===st.Data?ut(v.StrictDuplicateProperty):i!==st.Data&&ut(v.AccessorDataProperty):i===st.Data?ut(v.AccessorDataProperty):r[t]&i&&ut(v.AccessorGetSet),r[t]|=i):r[t]=i,u.push(n),e("}")||rr();return a("}"),o.finishObjectExpression(u)}function fr(){var r,n,s,t,l,h,p,k,tt;if(e("("))return a("("),e(")")?(c(),n=kt.ArrowParameterPlaceHolder):(++o.parenthesisCount,n=g(),a(")")),n;if(e("[")){for(n=[],l=new b,a("[");!e("]");)e(",")?(c(),n.push(null)):(n.push(d()),e("]")||a(","));return c(),l.finishArrayExpression(n)}if(e("{"))return yi();if(r=f.type,t=new b,r===u.Identifier)s=t.finishIdentifier(c().value);else if(r===u.StringLiteral||r===u.NumericLiteral)w&&f.octal&&ft(f,v.StrictOctalLiteral),s=t.finishLiteral(c());else if(r===u.Keyword){if(nt("function"))return t=null,s=[],p=[],tt=new b,ot("function"),e("(")||(t=at()),h=wi(n),s=h.params,p=h.defaults,r=h.stricted,n=h.firstRestricted,h.message&&(l=h.message),k=w,h=ei(),w&&n&&y(n,l),w&&r&&ft(r,l),w=k,tt.finishFunctionExpression(t,s,p,h);nt("this")?(c(),s=t.finishThisExpression()):y(c())}else r===u.BooleanLiteral?(n=c(),n.value="true"===n.value.toLowerCase(),s=t.finishLiteral(n)):r===u.NullLiteral?(n=c(),n.value=null,s=t.finishLiteral(n)):e("/")||e("/=")?(s="undefined"!=typeof i.tokens?t.finishLiteral(pt()):t.finishLiteral(gi()),vi()):y(c());return s}function er(){var n=[];if(a("("),!e(")"))for(;t<p;){if(n.push(d()),e(")"))break;rr()}return a(")"),n}function or(){a(".");var n,t=new b;return n=c(),n.type===u.Identifier||n.type===u.Keyword||n.type===u.BooleanLiteral||n.type===u.NullLiteral||y(n),t.finishIdentifier(n.value)}function sr(){var n;return a("["),n=g(),a("]"),n}function hr(){var n,t,r=new b,i;for(ot("new"),vt(o.allowIn,"callee of new expression always allow in keyword."),i=f,n=nt("new")?hr():fr();;)if(e("["))t=sr(),n=new k(i).finishMemberExpression("[",n,t);else if(e("."))t=or(),n=new k(i).finishMemberExpression(".",n,t);else break;return t=e("(")?er():[],r.finishNewExpression(n,t)}function cr(){var n,t,r=f,i,s=o.allowIn;for(t=f,o.allowIn=!0,n=nt("new")?hr():fr();;)if(e("."))i=or(),n=new k(t).finishMemberExpression(".",n,i);else if(e("("))i=er(),n=new k(t).finishCallExpression(n,i);else if(e("["))i=sr(),n=new k(t).finishMemberExpression("[",n,i);else break;return o.allowIn=s,f.type===u.Punctuator&&(e("++")||e("--"))&&!ni()&&(ii(n)||ut(v.InvalidLHSInAssignment),t=c(),n=new k(r).finishPostfixExpression(t.value,n)),n}function wt(){var t,n,i;return f.type!==u.Punctuator&&f.type!==u.Keyword?n=cr():e("++")||e("--")?(i=f,t=c(),n=wt(),ii(n)||ut(v.InvalidLHSInAssignment),n=new k(i).finishUnaryExpression(t.value,n)):e("+")||e("-")||e("~")||e("!")?(i=f,t=c(),n=wt(),n=new k(i).finishUnaryExpression(t.value,n)):nt("delete")||nt("void")||nt("typeof")?(i=f,t=c(),n=wt(),n=new k(i).finishUnaryExpression(t.value,n),w&&"delete"===n.operator&&n.argument.type===s.Identifier&&ut(v.StrictDelete)):n=cr(),n}function lr(n,t){var i=0;if(n.type!==u.Punctuator&&n.type!==u.Keyword)return 0;switch(n.value){case"||":i=1;break;case"&&":i=2;break;case"|":i=3;break;case"^":i=4;break;case"&":i=5;break;case"==":case"!=":case"===":case"!==":i=6;break;case"<":case">":case"<=":case">=":case"instanceof":i=7;break;case"in":i=t?7:0;break;case"<<":case">>":case">>>":i=8;break;case"+":case"-":i=9;break;case"*":case"/":case"%":i=11}return i}function nu(){var r,n,u,i,t,e;if((r=f,n=wt(),n===kt.ArrowParameterPlaceHolder)||(u=f,i=lr(u,o.allowIn),0===i))return n;for(u.prec=i,c(),r=[r,f],e=wt(),t=[n,u,e];0<(i=lr(f,o.allowIn));){for(;2<t.length&&i<=t[t.length-2].prec;)e=t.pop(),u=t.pop().value,n=t.pop(),r.pop(),n=new k(r[r.length-1]).finishBinaryExpression(u,n,e),t.push(n);u=c();u.prec=i;t.push(u);r.push(f);n=wt();t.push(n)}for(i=t.length-1,n=t[i],r.pop();1<i;)n=new k(r.pop()).finishBinaryExpression(t[i-1].value,t[i-2],n),i-=2;return n}function fi(n){var u,o,t,f,r,e,i;for(f=[],r=[],e=0,i={paramSet:{}},u=0,o=n.length;u<o;u+=1)if(t=n[u],t.type===s.Identifier)f.push(t),r.push(null),pi(i,t,t.name);else if(t.type===s.AssignmentExpression)f.push(t.left),r.push(t.right),++e,pi(i,t.left,t.left.name);else return null;return i.message===v.StrictParamDupe&&(n=w?i.stricted:i.firstRestricted,y(n,i.message)),0===e&&(r=[]),{params:f,defaults:r,rest:null,stricted:i.stricted,firstRestricted:i.firstRestricted,message:i.message}}function d(){var n,r,t,i,h,l,p;return(n=o.parenthesisCount,r=h=f,p=f,t=nu(),t!==kt.ArrowParameterPlaceHolder&&e("?")&&(c(),l=o.allowIn,o.allowIn=!0,r=d(),o.allowIn=l,a(":"),l=d(),t=new k(p).finishConditionalExpression(t,r,l)),(t===kt.ArrowParameterPlaceHolder||e("=>"))&&(o.parenthesisCount===n||o.parenthesisCount===n+1)&&(t.type===s.Identifier?i=fi([t]):t.type===s.AssignmentExpression?i=fi([t]):t.type===s.SequenceExpression?i=fi(t.expressions):t===kt.ArrowParameterPlaceHolder&&(i=fi([])),i))?(n=i,h=new k(h),a("=>"),i=w,t=e("{")?ei():d(),w&&n.firstRestricted&&y(n.firstRestricted,n.message),w&&n.stricted&&ft(n.stricted,n.message),w=i,h.finishArrowFunctionExpression(n.params,n.defaults,t,t.type!==s.BlockStatement)):(f.type!==u.Punctuator?n=!1:(n=f.value,n="="===n||"*="===n||"/="===n||"%="===n||"+="===n||"-="===n||"<<="===n||">>="===n||">>>="===n||"&="===n||"^="===n||"|="===n),n&&(ii(t)||ut(v.InvalidLHSInAssignment),r=c(),n=d(),t=new k(h).finishAssignmentExpression(r.value,t,n)),t)}function g(){var n,i=f;if(n=d(),e(",")){for(n=[n];t<p&&e(",");)c(),n.push(d());n=new k(i).finishSequenceExpression(n)}return n}function at(){var n,t=new b;return n=c(),n.type!==u.Identifier&&y(n),t.finishIdentifier(n.value)}function tu(n){var t=null,i,r=new b;return i=at(),"const"===n?(a("="),t=d()):e("=")&&(c(),t=d()),r.finishVariableDeclarator(i,t)}function ar(n){var i=[];do{if(i.push(tu(n)),!e(","))break;c()}while(t<p);return i}function bt(n){var w=f.type,i,k,it,d,tt,ft,et;if(w===u.EOF&&y(f),w===u.Punctuator&&"{"===f.value){if(n){if(a("{"),it=f,n=t,i=h,k=l,c(),w=e(":"),f=it,t=n,h=i,l=k,(f.type===u.Identifier||f.type===u.StringLiteral)&&w)return yi(!0);for(n=new b,i=[];t<p&&!e("}");){if(k=gt(),"undefined"==typeof k)break;i.push(k)}return a("}"),n.finishBlockStatement(i)}return yi()}if(n=new b,w===u.Punctuator)switch(f.value){case";":return n=new b,a(";"),n.finishEmptyStatement();case"(":return i=g(),lt(),n.finishExpressionStatement(i)}else if(w===u.Keyword)switch(f.value.toLowerCase()){case"break":return i=null,ot("break"),59===r.charCodeAt(t)?(c(),o.inIteration||o.inSwitch||rt(v.IllegalBreak),n=n.finishBreakStatement(null)):ni()?(o.inIteration||o.inSwitch||rt(v.IllegalBreak),n=n.finishBreakStatement(null)):(f.type===u.Identifier&&(i=at(),k="$"+i.name,Object.prototype.hasOwnProperty.call(o.labelSet,k)||rt(v.UnknownLabel,i.name)),lt(),null!==i||o.inIteration||o.inSwitch||rt(v.IllegalBreak),n=n.finishBreakStatement(i)),n;case"continue":return i=null,ot("continue"),59===r.charCodeAt(t)?(c(),o.inIteration||rt(v.IllegalContinue),n=n.finishContinueStatement(null)):ni()?(o.inIteration||rt(v.IllegalContinue),n=n.finishContinueStatement(null)):(f.type===u.Identifier&&(i=at(),k="$"+i.name,Object.prototype.hasOwnProperty.call(o.labelSet,k)||rt(v.UnknownLabel,i.name)),lt(),null!==i||o.inIteration||rt(v.IllegalContinue),n=n.finishContinueStatement(i)),n;case"for":return tt=o.allowIn,d=w=it=null,ot("for"),a("("),e(";")?c():(nt("var")?(o.allowIn=!1,et=new b,d=c(),ft=ar(),d=et.finishVariableDeclaration(ft,d.value),o.allowIn=tt,1===d.declarations.length&&nt("in")&&(c(),i=d,k=g(),d=null)):(o.allowIn=!1,d=g(),o.allowIn=tt,nt("in")&&(ii(d)||ut(v.InvalidLHSInForIn),c(),i=d,k=g(),d=null)),"undefined"==typeof i&&a(";")),"undefined"==typeof i&&(e(";")||(w=g()),a(";"),e(")")||(it=g())),a(")"),ft=o.inIteration,o.inIteration=!0,tt=bt(!0),o.inIteration=ft,"undefined"==typeof i?n.finishForStatement(d,w,it,tt):n.finishForInStatement(i,k,tt);case"function":return vr(n);case"if":return ot("if"),a("("),i=g(),a(")"),k=bt(!0),nt("else")?(c(),w=bt(!0)):w=null,n.finishIfStatement(i,k,w);case"return":return i=null,ot("return"),o.inFunctionBody||ut(v.IllegalReturn),32===r.charCodeAt(t)&&ht(r.charCodeAt(t+1))?(i=g(),lt(),n=n.finishReturnStatement(i)):ni()?n=n.finishReturnStatement(null):(e(";")||e("}")||f.type===u.EOF||(i=g()),lt(),n=n.finishReturnStatement(i)),n;case"var":return ot("var"),i=ar(),lt(),n.finishVariableDeclaration(i,"var")}return(i=g(),i.type===s.Identifier&&e(":"))?(c(),w="$"+i.name,Object.prototype.hasOwnProperty.call(o.labelSet,w)&&rt(v.Redeclaration,"Label",i.name),o.labelSet[w]=!0,k=bt(!1),delete o.labelSet[w],n.finishLabeledStatement(i,k)):(lt(),n.finishExpressionStatement(i))}function ei(){var n,c=[],i,h,l,y,k,d=new b;for(a("{");t<p&&f.type===u.StringLiteral;){if(i=f,n=gt(),c.push(n),n.expression.type!==s.Literal)break;n=r.slice(i.start+1,i.end-1);"use strict"===n?(w=!0,h&&ft(h,v.StrictOctalLiteral)):!h&&i.octal&&(h=i)}for(i=o.labelSet,h=o.inIteration,l=o.inSwitch,y=o.inFunctionBody,k=o.parenthesizedCount,o.labelSet={},o.inIteration=!1,o.inSwitch=!1,o.inFunctionBody=!0,o.parenthesizedCount=0;t<p&&!e("}");){if(n=gt(),"undefined"==typeof n)break;c.push(n)}return a("}"),o.labelSet=i,o.inIteration=h,o.inSwitch=l,o.inFunctionBody=y,o.parenthesizedCount=k,d.finishBlockStatement(c)}function pi(n,t,i){i="$"+i;w?Object.prototype.hasOwnProperty.call(n.paramSet,i)&&(n.stricted=t,n.message=v.StrictParamDupe):!n.firstRestricted&&Object.prototype.hasOwnProperty.call(n.paramSet,i)&&(n.firstRestricted=t,n.message=v.StrictParamDupe);n.paramSet[i]=!0}function wi(n){if(n={params:[],defaultCount:0,defaults:[],firstRestricted:n},a("("),!e(")"))for(n.paramSet={};t<p;){var i=n,r=void 0,o=void 0,u=void 0,r=f,o=at();if(pi(i,r,r.value),e("=")&&(c(),u=d(),++i.defaultCount),i.params.push(o),i.defaults.push(u),e(")"))break;a(",")}return a(")"),0===n.defaultCount&&(n.defaults=[]),{params:n.params,defaults:n.defaults,stricted:n.stricted,firstRestricted:n.firstRestricted,message:n.message}}function vr(){var u,f=[],e=[],n,i,t,r,o,s=new b;return ot("function"),u=at(),n=wi(t),f=n.params,e=n.defaults,i=n.stricted,t=n.firstRestricted,n.message&&(r=n.message),o=w,n=ei(),w&&t&&y(t,r),w&&i&&ft(i,r),w=o,s.finishFunctionDeclaration(u,f,e,n)}function gt(){return f.type===u.Keyword?"function"===f.value.toLowerCase()?vr():bt(!1):f.type!==u.EOF?bt(!1):void 0}function yr(){for(var n,t,u=[],r=0;r<i.tokens.length;++r)n=i.tokens[r],t={type:n.type,value:n.value},n.regex&&(t.regex={pattern:n.regex.pattern,flags:n.regex.flags}),i.range&&(t.range=n.range),i.loc&&(t.loc=n.loc),u.push(t);i.tokens=u}var u,tt,pr,s,kt,st,v,bi,r,w,t,h,l,p,f,o,i;u={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9};tt={};tt[u.BooleanLiteral]="Boolean";tt[u.EOF]="<end>";tt[u.Identifier]="Identifier";tt[u.Keyword]="Keyword";tt[u.NullLiteral]="Null";tt[u.NumericLiteral]="Numeric";tt[u.Punctuator]="Punctuator";tt[u.StringLiteral]="String";tt[u.RegularExpression]="RegularExpression";pr="( { [ in typeof instanceof new return case delete throw void = += -= *= /= %= <<= >>= >>>= &= |= ^= , + - * / % ++ -- << >> >>> & | ^ ! ~ && || ? : === == >= <= < > != !==".split(" ");s={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator"};kt={ArrowParameterPlaceHolder:{type:"ArrowParameterPlaceHolder"}};st={Data:1,Get:2,Set:4};v={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};bi={NonAsciiIdentifierStart:RegExp("[--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:RegExp("[--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")};k.prototype=b.prototype={processComment:function(){var r,e,u,o=i.bottomRightStack,n,f,t=o[o.length-1];if(!(this.type===s.Program&&0<this.body.length)){if(0<i.trailingComments.length){for(u=[],n=i.trailingComments.length-1;0<=n;--n)f=i.trailingComments[n],f.range[0]>=this.range[1]&&(u.unshift(f),i.trailingComments.splice(n,1));i.trailingComments=[]}else t&&t.trailingComments&&t.trailingComments[0].range[0]>=this.range[1]&&(u=t.trailingComments,delete t.trailingComments);if(t)for(;t&&t.range[0]>=this.range[0];)r=t,t=o.pop();if(r)r.leadingComments&&r.leadingComments[r.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=r.leadingComments,r.leadingComments=void 0);else if(0<i.leadingComments.length)for(e=[],n=i.leadingComments.length-1;0<=n;--n)f=i.leadingComments[n],f.range[1]<=this.range[0]&&(e.unshift(f),i.leadingComments.splice(n,1));e&&0<e.length&&(this.leadingComments=e);u&&0<u.length&&(this.trailingComments=u);o.push(this)}},finish:function(){i.range&&(this.range[1]=t);i.loc&&(this.loc.end=new tr,i.source&&(this.loc.source=i.source));i.attachComment&&this.processComment()},finishArrayExpression:function(n){return this.type=s.ArrayExpression,this.elements=n,this.finish(),this},finishAssignmentExpression:function(n,t,i){return this.type=s.AssignmentExpression,this.operator=n,this.left=t,this.right=i,this.finish(),this},finishBinaryExpression:function(n,t,i){return this.type="||"===n||"&&"===n?s.LogicalExpression:s.BinaryExpression,this.operator=n,this.left=t,this.right=i,this.finish(),this},finishBlockStatement:function(n){return this.type=s.BlockStatement,this.body=n,this.finish(),this},finishBreakStatement:function(n){return this.type=s.BreakStatement,this.label=n,this.finish(),this},finishCallExpression:function(n,t){return this.type=s.CallExpression,this.callee=n,this.arguments=t,this.finish(),this},finishConditionalExpression:function(n,t,i){return this.type=s.ConditionalExpression,this.test=n,this.consequent=t,this.alternate=i,this.finish(),this},finishContinueStatement:function(n){return this.type=s.ContinueStatement,this.label=n,this.finish(),this},finishEmptyStatement:function(){return this.type=s.EmptyStatement,this.finish(),this},finishExpressionStatement:function(n){return this.type=s.ExpressionStatement,this.expression=n,this.finish(),this},finishForStatement:function(n,t,i,r){return this.type=s.ForStatement,this.init=n,this.test=t,this.update=i,this.body=r,this.finish(),this},finishForInStatement:function(n,t,i){return this.type=s.ForInStatement,this.left=n,this.right=t,this.body=i,this.each=!1,this.finish(),this},finishFunctionDeclaration:function(n,t,i,r){return this.type=s.FunctionDeclaration,this.id=n,this.params=t,this.defaults=i,this.body=r,this.rest=null,this.expression=this.generator=!1,this.finish(),this},finishFunctionExpression:function(n,t,i,r){return this.type=s.FunctionExpression,this.id=n,this.params=t,this.defaults=i,this.body=r,this.rest=null,this.expression=this.generator=!1,this.finish(),this},finishIdentifier:function(n){return this.type=s.Identifier,this.name=n,this.finish(),this},finishIfStatement:function(n,t,i){return this.type=s.IfStatement,this.test=n,this.consequent=t,this.alternate=i,this.finish(),this},finishLiteral:function(n){return this.type=s.Literal,this.value=n.value,this.raw=r.slice(n.start,n.end),n.regex&&(this.regex=n.regex),this.finish(),this},finishMemberExpression:function(n,t,i){return this.type=s.MemberExpression,this.computed="["===n,this.object=t,this.property=i,this.finish(),this},finishObjectExpression:function(n){return this.type=s.ObjectExpression,this.properties=n,this.finish(),this},finishPostfixExpression:function(n,t){return this.type=s.UpdateExpression,this.operator=n,this.argument=t,this.prefix=!1,this.finish(),this},finishProgram:function(n){return this.type=s.Program,this.body=n,this.finish(),this},finishProperty:function(n,t,i,r,u){return this.type=s.Property,this.key=t,this.value=i,this.kind=n,this.method=r,this.shorthand=u,this.finish(),this},finishReturnStatement:function(n){return this.type=s.ReturnStatement,this.argument=n,this.finish(),this},finishUnaryExpression:function(n,t){return this.type="++"===n||"--"===n?s.UpdateExpression:s.UnaryExpression,this.operator=n,this.argument=t,this.prefix=!0,this.finish(),this},finishVariableDeclaration:function(n,t){return this.type=s.VariableDeclaration,this.declarations=n,this.kind=t,this.finish(),this},finishVariableDeclarator:function(n,t){return this.type=s.VariableDeclarator,this.id=n,this.init=t,this.finish(),this}};n.version="2.0.0-dev";n.tokenize=function(n,e){var v,s;v=String;"string"==typeof n||n instanceof String||(n=v(n));r=n;t=0;h=0<r.length?1:0;l=0;p=r.length;f=null;o={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};i={};e=e||{};e.tokens=!0;i.tokens=[];i.tokenize=!0;i.openParenToken=-1;i.openCurlyToken=-1;i.range="boolean"==typeof e.range&&e.range;i.loc="boolean"==typeof e.loc&&e.loc;"boolean"==typeof e.comment&&e.comment&&(i.comments=[]);"boolean"==typeof e.tolerant&&e.tolerant&&(i.errors=[]);try{if(vi(),f.type===u.EOF)return i.tokens;for(c();f.type!==u.EOF;)try{c()}catch(a){if(i.errors){i.errors.push(a);break}else throw a;}yr();s=i.tokens;"undefined"!=typeof i.comments&&(s.comments=i.comments);"undefined"!=typeof i.errors&&(s.errors=i.errors)}catch(a){throw a;}finally{i={}}return s};n.parse=function(n,e){var k,c,g,a,y,nt,d;c=String;"string"==typeof n||n instanceof String||(n=c(n));r=n;t=0;h=0<r.length?1:0;l=0;p=r.length;f=null;o={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};i={};"undefined"!=typeof e&&(i.range="boolean"==typeof e.range&&e.range,i.loc="boolean"==typeof e.loc&&e.loc,i.attachComment="boolean"==typeof e.attachComment&&e.attachComment,i.loc&&null!==e.source&&void 0!==e.source&&(i.source=c(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(i.tokens=[]),"boolean"==typeof e.comment&&e.comment&&(i.comments=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(i.errors=[]),i.attachComment&&(i.range=!0,i.comments=[],i.bottomRightStack=[],i.trailingComments=[],i.leadingComments=[]));try{for(ct(),vi(),g=new b,w=!1,c=[];t<p;){if(y=f,y.type!==u.StringLiteral)break;if(a=gt(),c.push(a),a.expression.type!==s.Literal)break;nt=r.slice(y.start+1,y.end-1);"use strict"===nt?(w=!0,d&&ft(d,v.StrictOctalLiteral)):!d&&y.octal&&(d=y)}for(;t<p;){if(a=gt(),"undefined"==typeof a)break;c.push(a)}k=g.finishProgram(c);"undefined"!=typeof i.comments&&(k.comments=i.comments);"undefined"!=typeof i.tokens&&(yr(),k.tokens=i.tokens);"undefined"!=typeof i.errors&&(k.errors=i.errors)}catch(tt){throw tt;}finally{i={}}return k};n.Syntax=function(){var n,t={};"function"==typeof Object.create&&(t=Object.create(null));for(n in s)s.hasOwnProperty(n)&&(t[n]=s[n]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()})},"esri/arcade/arcadeCompiler":function(){define("require exports ../geometry/Polygon ../graphic ../geometry/Polyline ../geometry/Point ../geometry/Extent ../geometry/Multipoint ../SpatialReference ./languageUtils ./treeAnalysis ./Dictionary ./Feature ./functions/date ./functions/string ./functions/maths ./functions/geometry ./functions/stats ./ImmutablePathArray ./ImmutablePointArray ../geometry/Geometry".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){function it(n,t,i){try{return i(n,null,t)}catch(r){throw r;}}function nt(n,t){var r,o,s,h,k,p,tt,a,i,it,rt,ut;try{switch(t.type){case"EmptyStatement":return"lc.voidOperation";case"VariableDeclarator":return kt(n,t);case"VariableDeclaration":for(i=[],r=0;r<t.declarations.length;r++)i.push(nt(n,t.declarations[r]));return i.join("\n")+" \n lastStatement=  lc.voidOperation; \n";case"BlockStatement":return lt(n,t);case"FunctionDeclaration":if(r=t.id.name.toLowerCase(),o={applicationCache:void 0===n.applicationCache?null:n.applicationCache,spatialReference:n.spatialReference,console:n.console,symbols:n.symbols,localScope:{_SymbolsMap:{}},depthCounter:n.depthCounter+1,globalScope:n.globalScope},64<o.depthCounter)throw Error("Exceeded maximum function depth");for(s="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement = lc.voidOperation; var lscope = [];\n ",h=0;h<t.params.length;h++)k=t.params[h].name.toLowerCase(),p=et(k,n),o.localScope._SymbolsMap[k]=p,s+="lscope['"+p+"']=arguments["+h.toString()+"];\n";return s+=lt(o,t.body)+"\n return lastStatement; }, runtimeCtx))",s+="\n lastStatement = lc.voidOperation; \n",void 0!==n.globalScope[r]?i="gscope['"+r+"']="+s:void 0!==n.globalScope._SymbolsMap[r]?i="gscope['"+n.globalScope._SymbolsMap[r]+"']="+s:(p=et(r,n),n.globalScope._SymbolsMap[r]=p,i="gscope['"+p+"']="+s),i;case"ReturnStatement":return null===t.argument?"return lc.voidOperation;":"return "+nt(n,t.argument)+";";case"IfStatement":if("AssignmentExpression"===t.test.type||"UpdateExpression"===t.test.type)throw Error(c.nodeErrorMessage(t.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var ot=nt(n,t.test),w=ft(n),d="var "+w+" = "+ot+";\n if ("+w+" === true) {\n"+ct(n,t.consequent)+"\n }\n",d=null!==t.alternate?d+("else if ("+w+"===false)   { \n"+ct(n,t.alternate)+"}\n"):d+("else if ("+w+"===false) { \n lastStatement = lc.voidOperation;\n }\n");return d+("else { lang.error({type: '"+t.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n");case"ExpressionStatement":return"AssignmentExpression"===t.expression.type?"lastStatement = lc.voidOperation; "+nt(n,t.expression)+" \n ":"lastStatement = "+nt(n,t.expression)+";";case"AssignmentExpression":return bt(n,t);case"UpdateExpression":return wt(n,t);case"BreakStatement":return"break;";case"ContinueStatement":return"continue;";case"ForStatement":i="lastStatement = lc.voidOperation; \n";null!==t.init&&(i+=nt(n,t.init));var b=ft(n),g=ft(n),i=i+("var "+b+" = true;")+"\n do { ";return null!==t.update&&(i+=" if ("+b+"===false) {\n "+nt(n,t.update)+"  \n}\n "+b+"=false; \n"),null!==t.test&&(i+="var "+g+" = "+nt(n,t.test)+";",i+="if ("+g+"===false) { break; } else if ("+g+"!==true) { lang.error({type: '"+t.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n"),i+=nt(n,t.body),null!==t.update&&(i+="\n "+nt(n,t.update)),i+("\n"+b+" = true; \n} while(true);  lastStatement = lc.voidOperation;");case"ForInStatement":var e=ft(n),v=ft(n),f=ft(n),u="var "+e+" = "+nt(n,t.right)+";\n";"VariableDeclaration"===t.left.type&&(u+=nt(n,t.left));var l="VariableDeclaration"===t.left.type?t.left.declarations[0].id.name:t.left.name,l=l.toLowerCase(),i="";return null!==n.localScope&&(void 0!==n.localScope[l]?i="lscope['"+l+"']":void 0!==n.localScope._SymbolsMap[l]&&(i="lscope['"+n.localScope._SymbolsMap[l]+"']")),""===i&&(void 0!==n.globalScope[l]?i="gscope['"+l+"']":void 0!==n.globalScope._SymbolsMap[l]&&(i="gscope['"+n.globalScope._SymbolsMap[l]+"']")),u=u+("if ("+e+"===null) {  lastStatement = lc.voidOperation; }\n ")+("else if (lc.isArray("+e+") || lc.isString("+e+")) {")+("var "+v+"="+e+".length; \n")+("for(var "+f+"=0; "+f+"<"+v+"; "+f+"++) {\n"),u+=i+"="+f+";\n",u+=nt(n,t.body),u+="\n}\n",u+=" lastStatement = lc.voidOperation; \n",u+=" \n}\n",u+="else if (lc.isImmutableArray("+e+")) {",u=u+("var "+v+"="+e+".length(); \n")+("for(var "+f+"=0; "+f+"<"+v+"; "+f+"++) {\n"),u+=i+"="+f+";\n",u+=nt(n,t.body),u+="\n}\n",u+=" lastStatement = lc.voidOperation; \n",u+=" \n}\n",u+="else if (( "+e+" instanceof lang.Dictionary) || ( "+e+" instanceof lang.Feature)) {",u=u+("var "+v+"="+e+".keys(); \n")+("for(var "+f+"=0; "+f+"<"+v+".length; "+f+"++) {\n"),u+=i+"="+v+"["+f+"];\n",u+=nt(n,t.body),u+="\n}\n",u+=" lastStatement = lc.voidOperation; \n",u+=" \n}\n",u+"else { lastStatement = lc.voidOperation; } \n";case"Identifier":return gt(n,t);case"MemberExpression":try{i=void 0;i=!0===t.computed?nt(n,t.property):"'"+t.property.name+"'";tt="lang.member("+nt(n,t.object)+","+i+")"}catch(y){throw y;}return tt;case"Literal":return null===t.value||void 0===t.value?"null":JSON.stringify(t.value);case"ThisExpression":throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTED"));case"CallExpression":try{if("Identifier"!==t.callee.type)throw Error(c.nodeErrorMessage(t,"RUNTIME","ONLYNODESSUPPORTED"));if(a=t.callee.name.toLowerCase(),i="",null!==n.localScope&&(void 0!==n.localScope[a]?i="lscope['"+a+"']":void 0!==n.localScope._SymbolsMap[a]&&(i="lscope['"+n.localScope._SymbolsMap[a]+"']")),""===i&&(void 0!==n.globalScope[a]?i="gscope['"+a+"']":void 0!==n.globalScope._SymbolsMap[a]&&(i="gscope['"+n.globalScope._SymbolsMap[a]+"']")),""!==i)for(r="[",o=0;o<t.arguments.length;o++)0<o&&(r+=", "),r+=nt(n,t.arguments[o]);else throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTFOUND"));}catch(y){throw y;}return"lang.callfunc("+i+","+(r+"]")+",runtimeCtx)";case"UnaryExpression":try{it="lang.unary("+nt(n,t.argument)+",'"+t.operator+"')"}catch(y){throw y;}return it;case"BinaryExpression":try{rt="lang.binary("+nt(n,t.left)+","+nt(n,t.right)+",'"+t.operator+"')"}catch(y){throw y;}return rt;case"LogicalExpression":try{if("AssignmentExpression"===t.left.type||"UpdateExpression"===t.left.type)throw Error(c.nodeErrorMessage(t.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===t.right.type||"UpdateExpression"===t.right.type)throw Error(c.nodeErrorMessage(t.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("&&"===t.operator||"||"===t.operator)ut="(lang.logicalCheck("+nt(n,t.left)+") "+t.operator+" lang.logicalCheck("+nt(n,t.right)+"))";else throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));}catch(y){throw y;}return ut;case"ConditionalExpression":throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":try{for(i=[],r=0;r<t.elements.length;r++)"Literal"===t.elements[r].type?i.push(nt(n,t.elements[r])):i.push("lang.aCheck("+nt(n,t.elements[r])+",'ArrayExpression')");s="["+i.join(",")+"]"}catch(y){throw y;}return s;case"ObjectExpression":for(i="lang.dictionary([",r=0;r<t.properties.length;r++){var h=t.properties[r],st="Identifier"===h.key.type?"'"+h.key.name+"'":nt(n,h.key),ht=nt(n,h.value);0<r&&(i+=",");i+="lang.strCheck("+st+",'ObjectExpression'),lang.aCheck("+ht+", 'ObjectExpression')"}return i+"])";case"Property":throw Error("Should not get here");case"Array":throw Error(c.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTED"));default:throw Error(c.nodeErrorMessage(t,"RUNTIME","UNREOGNISED"));}}catch(y){throw y;}}function wt(n,t){var i=null,r="";if("MemberExpression"===t.argument.type)return i=nt(n,t.argument.object),r=!0===t.argument.computed?nt(n,t.argument.property):"'"+t.argument.property.name+"'","lang.memberupdate("+i+","+r+",'"+t.operator+"',"+t.prefix+")";if(i=t.argument.name.toLowerCase(),null!==n.localScope){if(void 0!==n.localScope[i])return"lang.update(lscope, '"+i+"','"+t.operator+"',"+t.prefix+")";if(void 0!==n.localScope._SymbolsMap[i])return"lang.update(lscope, '"+n.localScope._SymbolsMap[i]+"','"+t.operator+"',"+t.prefix+")"}if(void 0!==n.globalScope[i])return"lang.update(gscope, '"+i+"','"+t.operator+"',"+t.prefix+")";if(void 0!==n.globalScope._SymbolsMap[i])return"lang.update(gscope, '"+n.globalScope._SymbolsMap[i]+"','"+t.operator+"',"+t.prefix+")";throw Error("Variable not recognised");}function bt(n,t){var r=nt(n,t.right),i=null,u="";if("MemberExpression"===t.left.type)return i=nt(n,t.left.object),u=!0===t.left.computed?nt(n,t.left.property):"'"+t.left.property.name+"'","lang.assignmember("+i+","+u+",'"+t.operator+"',"+r+");";if(i=t.left.name.toLowerCase(),null!==n.localScope){if(void 0!==n.localScope[i])return"lscope['"+i+"']=lang.assign("+r+",'"+t.operator+"', lscope['"+i+"']); ";if(void 0!==n.localScope._SymbolsMap[i])return"lscope['"+n.localScope._SymbolsMap[i]+"']=lang.assign("+r+",'"+t.operator+"', lscope['"+n.localScope._SymbolsMap[i]+"']); "}if(void 0!==n.globalScope[i])return"gscope['"+i+"']=lang.assign("+r+",'"+t.operator+"', gscope['"+i+"']); ";if(void 0!==n.globalScope._SymbolsMap[i])return"gscope['"+n.globalScope._SymbolsMap[i]+"']=lang.assign("+r+",'"+t.operator+"', gscope['"+n.globalScope._SymbolsMap[i]+"']); ";throw Error("Variable not recognised");}function ct(n,t){return"BlockStatement"===t.type?nt(n,t):"ReturnStatement"===t.type?nt(n,t):"BreakStatement"===t.type?nt(n,t):"ContinueStatement"===t.type?nt(n,t):"UpdateExpression"===t.type?"lastStatement = "+nt(n,t)+";":"ExpressionStatement"===t.type?nt(n,t):"ObjectExpression"===t.type?"lastStatement = "+nt(n,t)+";":nt(n,t)}function lt(n,t){for(var r="",i=0;i<t.body.length;i++)r="ReturnStatement"===t.body[i].type?r+(nt(n,t.body[i])+" \n"):"BreakStatement"===t.body[i].type?r+(nt(n,t.body[i])+" \n"):"ContinueStatement"===t.body[i].type?r+(nt(n,t.body[i])+" \n"):"UpdateExpression"===t.body[i].type?r+("lastStatement = "+nt(n,t.body[i])+"; \n"):"ObjectExpression"===t.body[i].type?r+("lastStatement = "+nt(n,t.body[i])+"; \n"):r+(nt(n,t.body[i])+" \n");return r}function kt(n,t){var r=null===t.init?null:nt(n,t.init),i,u;return(r===h.voidOperation&&(r=null),i=t.id.name.toLowerCase(),null!==n.localScope)?void 0!==n.localScope[i]?"lscope['"+i+"']="+r+";":void 0!==n.localScope._SymbolsMap[i]?"lscope['"+n.localScope._SymbolsMap[i]+"']="+r+";":(u=et(i,n),n.localScope._SymbolsMap[i]=u,"lscope['"+u+"']="+r+";"):void 0!==n.globalScope[i]?"gscope['"+i+"']="+r+";":void 0!==n.globalScope._SymbolsMap[i]?"gscope['"+n.globalScope._SymbolsMap[i]+"']="+r+";":(u=et(i,n),n.globalScope._SymbolsMap[i]=u,"gscope['"+u+"']="+r+";")}function dt(n,t,i){t=t.toLowerCase();switch(t){case"hasz":return n=n.hasZ,void 0===n?!1:n;case"hasm":return n=n.hasM,void 0===n?!1:n;case"spatialreference":return t=n.spatialReference._arcadeCacheId,void 0===t&&(i=!0,Object.freeze&&Object.isFrozen(n.spatialReference)&&(i=!1),i&&(rt++,t=n.spatialReference._arcadeCacheId=rt)),n=new l({wkt:n.spatialReference.wkt,wkid:n.spatialReference.wkid}),void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}switch(n.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":return n=n[t],void 0!==n?n:null;case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return t=h.isVersion4?n.cache._arcadeCacheId:n.getCacheValue("_arcadeCacheId"),void 0===t&&(rt++,t=rt,h.isVersion4?n.cache._arcadeCacheId=t:n.setCacheValue("_arcadeCacheId",t)),n=new k(n.rings,n.spatialReference,!0===n.hasZ,!0===n.hasM,t);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==n[t]?n[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return t=h.isVersion4?n.cache._arcadeCacheId:n.getCacheValue("_arcadeCacheId"),void 0===t&&(rt++,t=rt,h.isVersion4?n.cache._arcadeCacheId=t:n.setCacheValue("_arcadeCacheId",t)),n=new k(n.paths,n.spatialReference,!0===n.hasZ,!0===n.hasM,t);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return t=h.isVersion4?n.cache._arcadeCacheId:n.getCacheValue("_arcadeCacheId"),void 0===t&&(rt++,t=rt,h.isVersion4?n.cache._arcadeCacheId=t:n.setCacheValue("_arcadeCacheId",t)),n=new d(n.points,n.spatialReference,!0===n.hasZ,!0===n.hasM,t,1);case"type":return"Multipoint"}}throw Error(c.nodeErrorMessage(i,"RUNTIME","PROPERTYNOTFOUND"));}function gt(n,t){try{var i=t.name.toLowerCase();if(null!==n.localScope){if(void 0!==n.localScope[i])return"lscope['"+i+"']";if(void 0!==n.localScope._SymbolsMap[i])return"lscope['"+n.localScope._SymbolsMap[i]+"']"}if(void 0!==n.globalScope[i])return"gscope['"+i+"']";if(void 0!==n.globalScope._SymbolsMap[i])return"gscope['"+n.globalScope._SymbolsMap[i]+"']";throw Error(c.nodeErrorMessage(t,"RUNTIME","VARIABLENOTFOUND"));}catch(r){throw r;}}function at(n){return null===n?"":h.isArray(n)||h.isImmutableArray(n)?"Array":h.isDate(n)?"Date":h.isString(n)?"String":h.isBoolean(n)?"Boolean":h.isNumber(n)?"Number":n instanceof l?"Dictionary":n instanceof a?"Feature":n instanceof f?"Point":n instanceof i?"Polygon":n instanceof u?"Polyline":n instanceof o?"Multipoint":n instanceof e?"Extent":h.isFunctionParameter(n)?"Function":n===h.voidOperation?"":"number"==typeof n&&isNaN(n)?"Number":"Unrecognised Type"}function vt(n,t,i,r){try{if(h.equalityTest(t[i],r))return t[i+1];var u=t.length-i;return 1===u?t[i]:2===u?null:3===u?t[i+2]:vt(n,t,i+2,r)}catch(f){throw f;}}function yt(n,t,i,r){try{if(!0===r)return t[i+1];if(3==t.length-i)return t[i+2];var u=t[i+2];if(!1===h.isBoolean(u))throw Error("WHEN needs boolean test conditions");return yt(n,t,i+2,u)}catch(f){throw f;}}function ut(n,t){var i=n.length,u=Math.floor(i/2),f;if(0===i)return[];if(1===i)return[n[0]];for(var r=ut(n.slice(0,u),t),i=ut(n.slice(u,i),t),u=[];0<r.length||0<i.length;)0<r.length&&0<i.length?(f=t(r[0],i[0]),isNaN(f)&&(f=0),0>=f?(u.push(r[0]),r=r.slice(1)):(u.push(i[0]),i=i.slice(1))):0<r.length?(u.push(r[0]),r=r.slice(1)):0<i.length&&(u.push(i[0]),i=i.slice(1));return u}function et(n,t){return t.symbols.symbolCounter++,"_T"+t.symbols.symbolCounter.toString()}function ft(n){return n.symbols.symbolCounter++,"_Tvar"+n.symbols.symbolCounter.toString()}function ni(n,t,i){var r={},u;n||(n={});i||(i={});r._SymbolsMap={};r.textformatting=1;r.infinity=1;r.pi=1;for(u in t)r[u]=1;for(u in i)r[u]=1;for(u in n)r[u]=1;return r}function pt(n){console.log(n)}var rt,tt,ot,st,ht;Object.defineProperty(t,"__esModule",{value:!0});rt=0;tt={};v.registerFunctions(tt,it);y.registerFunctions(tt,it);p.registerFunctions(tt,it);w.registerFunctions(tt,it);b.registerFunctions(tt,it);tt["typeof"]=function(n,t){return it(n,t,function(n,t,i){if(h.pcCheck(i,1,1),n=at(i[0]),"Unrecognised Type"===n)throw Error("Unrecognised Type");return n})};tt.iif=function(n,t){try{return it(n,t,function(n,t,i){if(h.pcCheck(i,3,3),!1===h.isBoolean(i[0]))throw Error("IF Function must have a boolean test condition");return i[0]?i[1]:i[2]})}catch(i){throw i;}};tt.decode=function(n,t){try{return it(n,t,function(t,i,r){if(2>r.length)throw Error("Missing Parameters");if(2===r.length)return r[1];if(0==(r.length-1)%2)throw Error("Must have a default value result.");return vt(n,r,1,r[0])})}catch(i){throw i;}};tt.when=function(n,t){try{return it(n,t,function(t,i,r){if(3>r.length)throw Error("Missing Parameters");if(0==r.length%2)throw Error("Must have a default value result.");if(t=r[0],!1===h.isBoolean(t))throw Error("WHEN needs boolean test conditions");return yt(n,r,0,t)})}catch(i){throw i;}};tt.top=function(n,t){return it(n,t,function(n,t,i){if(h.pcCheck(i,2,2),h.isArray(i[0]))return h.toNumber(i[1])>=i[0].length?i[0].slice(0):i[0].slice(0,h.toNumber(i[1]));if(h.isImmutableArray(i[0]))return h.toNumber(i[1])>=i[0].length()?i[0].slice(0):i[0].slice(0,h.toNumber(i[1]));throw Error("Top cannot accept this parameter type");})};tt.first=function(n,t){return it(n,t,function(n,t,i){return h.pcCheck(i,1,1),h.isArray(i[0])?0===i[0].length?null:i[0][0]:h.isImmutableArray(i[0])?0===i[0].length()?null:i[0].get(0):null})};tt.sort=function(n,t){return it(n,t,function(n,t,i){var r,f,u,e;if(h.pcCheck(i,1,2),t=i[0],h.isImmutableArray(t)&&(t=t.toArray()),!1===h.isArray(t))throw Error("Illegal Argument");if(1<i.length){if(!1===h.isFunctionParameter(i[1]))throw Error("Illegal Argument");t=ut(t,function(t,r){return ht.callfunc(i[1],[t,r],n)})}else{if(0===t.length)return[];for(r={},f=0;f<t.length;f++)u=at(t[f]),""!==u&&(r[u]=!0);if(!0===r.Array||!0===r.Dictionary||!0===r.Feature||!0===r.Point||!0===r.Polygon||!0===r.Polyline||!0===r.Multipoint||!0===r.Extent||!0===r.Function)return t.slice(0);f=0;u="";for(e in r)f++,u=e;t=1<f||"String"===u?ut(t,function(n,t){if(null===n||void 0===n||n===h.voidOperation)return null===t||void 0===t||t===h.voidOperation?0:1;if(null===t||void 0===t||t===h.voidOperation)return-1;var i=h.toString(n),r=h.toString(t);return i<r?-1:i===r?0:1}):"Number"===u?ut(t,function(n,t){return n-t}):"Boolean"===u?ut(t,function(n,t){return n===t?0:t?-1:1}):"Date"===u?ut(t,function(n,t){return t-n}):t.slice(0)}return t})};for(ot in tt)tt[ot]=new h.NativeFunction(tt[ot]);st=function(){};st.prototype=tt;t.functionHelper={fixSpatialReference:h.fixSpatialReference,parseArguments:function(n,t){for(var r=[],i=0;i<t.arguments.length;i++)r.push(nt(n,t.arguments[i]));return r},standardFunction:it};t.executeScript=function(n,t,i){return n(t,i)};t.extractFieldLiterals=function(n,t){return void 0===t&&(t=!1),c.findFieldLiterals(n,t)};t.validateScript=function(n,t){return c.validateScript(n,t,"simple")};t.referencesMember=function(n,t){return c.referencesMember(n,t)};t.referencesFunction=function(n,t){return c.referencesFunction(n,t)};ht={error:function(n,t,i){throw Error(c.nodeErrorMessage(n,t,i));},functionDepthchecker:function(n,t){return function(){if(t.depthCounte++,64<t.depthCounter)throw Error("Exceeded maximum function depth");var i=n.apply(this,arguments);return t.depthCounte--,i}},aCheck:function(n,t){if(h.isFunctionParameter(n))throw Error(c.nodeErrorMessage({type:t},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return n===h.voidOperation?null:n},Dictionary:l,Feature:a,dictionary:function(n){for(var i={},t=0;t<n.length;t+=2){if(h.isFunctionParameter(n[t+1]))throw Error("Illegal Argument");if(!1===h.isString(n[t]))throw Error("Illegal Argument");i[n[t].toString()]=n[t+1]===h.voidOperation?null:n[t+1]}return n=new l(i),n.immutable=!1,n},strCheck:function(n){if(!1===h.isString(n))throw Error("Illegal Argument");return n},unary:function(n,t){if(h.isBoolean(n)){if("!"===t)return!n;if("-"===t)return-1*h.toNumber(n);if("+"===t)return 1*h.toNumber(n);throw Error(c.nodeErrorMessage({type:"UnaryExpression"},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===t)return-1*h.toNumber(n);if("+"===t)return 1*h.toNumber(n);throw Error(c.nodeErrorMessage({type:"UnaryExpression"},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));},logicalCheck:function(n){if(!1===h.isBoolean(n))throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));return n},logical:function(n,t,i){if(h.isBoolean(n)&&h.isBoolean(t))switch(i){case"||":return n||t;case"&&":return n&&t;default:throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));}else throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));},binary:function(n,t,i){switch(i){case"==":return h.equalityTest(n,t);case"=":return h.equalityTest(n,t);case"!=":return!h.equalityTest(n,t);case"<":return h.greaterThanLessThan(n,t,i);case">":return h.greaterThanLessThan(n,t,i);case"<=":return h.greaterThanLessThan(n,t,i);case">=":return h.greaterThanLessThan(n,t,i);case"+":return h.isString(n)||h.isString(t)?h.toString(n)+h.toString(t):h.toNumber(n)+h.toNumber(t);case"-":return h.toNumber(n)-h.toNumber(t);case"*":return h.toNumber(n)*h.toNumber(t);case"/":return h.toNumber(n)/h.toNumber(t);case"%":return h.toNumber(n)%h.toNumber(t);default:throw Error(c.nodeErrorMessage({type:"BinaryExpression"},"RUNTIME","OPERATORNOTRECOGNISED"));}},assign:function(n,t,i){switch(t){case"=":return n===h.voidOperation?null:n;case"/=":return h.toNumber(i)/h.toNumber(n);case"*=":return h.toNumber(i)*h.toNumber(n);case"-=":return h.toNumber(i)-h.toNumber(n);case"+=":return h.isString(i)||h.isString(n)?h.toString(i)+h.toString(n):h.toNumber(i)+h.toNumber(n);case"%=":return h.toNumber(i)%h.toNumber(n);default:throw Error(c.nodeErrorMessage("AssignmentExpression","RUNTIME","OPERATORNOTRECOGNISED"));}},update:function(n,t,i,r){var u=h.toNumber(n[t]);return n[t]="++"===i?u+1:u-1,!1===r?u:"++"===i?u+1:u-1},memberupdate:function(n,t,i,r){var u;if(h.isArray(n))if(h.isNumber(t)){if(0>t&&(t=n.length+t),0>t||t>=n.length)throw Error("Assignment outside of array bounds");u=h.toNumber(n[t]);n[t]="++"===i?u+1:u-1}else throw Error("Invalid Parameter");else if(n instanceof l){if(!1===h.isString(t))throw Error("Dictionary accessor must be a string");if(!0===n.hasField(t))u=h.toNumber(n.field(t)),n.setField(t,"++"===i?u+1:u-1);else throw Error("Invalid Parameter");}else if(n instanceof a){if(!1===h.isString(t))throw Error("Feature accessor must be a string");if(!0===n.hasField(t))u=h.toNumber(n.field(t)),n.setField(t,"++"===i?u+1:u-1);else throw Error("Invalid Parameter");}else{if(h.isImmutableArray(n))throw Error("Array is Immutable");throw Error("Invalid Parameter");}return!1===r?u:"++"===i?u+1:u-1},assignmember:function(n,t,i,r){if(h.isArray(n))if(h.isNumber(t)){if(0>t&&(t=n.length+t),0>t||t>n.length)throw Error("Assignment outside of array bounds");if(t===n.length&&"="!==i)throw Error("Invalid Parameter");n[t]=this.assign(r,i,n[t])}else throw Error("Invalid Parameter");else if(n instanceof l){if(!1===h.isString(t))throw Error("Dictionary accessor must be a string");if(!0===n.hasField(t))n.setField(t,this.assign(r,i,n.field(t)));else{if("="!==i)throw Error("Invalid Parameter");n.setField(t,this.assign(r,i,null))}}else if(n instanceof a){if(!1===h.isString(t))throw Error("Feature accessor must be a string");if(!0===n.hasField(t))n.setField(t,this.assign(r,i,n.field(t)));else{if("="!==i)throw Error("Invalid Parameter");n.setField(t,this.assign(r,i,null))}}else{if(h.isImmutableArray(n))throw Error("Array is Immutable");throw Error("Invalid Parameter");}},member:function(n,t){if(null===n)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","NOTFOUND"));if(n instanceof l||n instanceof a){if(h.isString(t))return n.field(t)}else if(n instanceof g){if(h.isString(t))return dt(n,t,"MemberExpression")}else if(h.isArray(n)){if(h.isNumber(t)&&isFinite(t)&&Math.floor(t)===t){if(0>t&&(t=n.length+t),t>=n.length||0>t)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return n[t]}}else if(h.isString(n)){if(h.isNumber(t)&&isFinite(t)&&Math.floor(t)===t){if(0>t&&(t=n.length+t),t>=n.length||0>t)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return n[t]}}else if(h.isImmutableArray(n)&&h.isNumber(t)&&isFinite(t)&&Math.floor(t)===t){if(0>t&&(t=n.length()+t),t>=n.length()||0>t)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return n.get(t)}throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","INVALIDTYPE"));},callfunc:function(n,t,i){return n instanceof h.NativeFunction?n.fn(i,t):n instanceof h.SizzleFunction?n.fn.apply(this,t):n.apply(this,t)}};t.compileScript=function(n,t){var i,u;return void 0===t&&(t=null),null===t&&(t={vars:{},customfunctions:{}}),i={globalScope:ni(t.vars,tt,t.customfunctions),localScope:null,console:pt,symbols:{symbolCounter:0}},i=nt(i,n.body[0].body),""===i&&(i="lc.voidOperation;"),u={lc:h,lang:ht,postProcess:function(n){if(n instanceof h.ReturnResult&&(n=n.value),n instanceof h.ImplicitResult&&(n=n.value),n===h.voidOperation&&(n=null),n===h.breakResult)throw Error("Cannot return BREAK");if(n===h.continueResult)throw Error("Cannot return CONTINUE");if(h.isFunctionParameter(n))throw Error("Cannot return FUNCTION");return n},prepare:function(n,t){var o,i;t||(t=new s(102100));var f=n.vars,e=n.customfunctions,u=new st;f||(f={});e||(e={});o=new l({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});o.immutable=!1;u._SymbolsMap={textformatting:1,infinity:1,pi:1};u.textformatting=o;u.infinity=Number.POSITIVE_INFINITY;u.pi=Math.PI;for(i in e)u[i]=e[i],u._SymbolsMap[i]=1;for(i in f)u._SymbolsMap[i]=1,u[i]=f[i]instanceof r?new a(f[i]):f[i];return{spatialReference:t,globalScope:u,localScope:null,console:n.console?n.console:pt,symbols:{symbolCounter:0},depthCounter:1,applicationCache:void 0===n.applicationCache?null:n.applicationCache}}},new Function("context","spatialReference","var runtimeCtx=this.prepare(context, spatialReference);\n var lc = this.lc;  var lang = this.lang; var gscope=runtimeCtx.globalScope; \n function mainBody() {\n var lastStatement=lc.voidOperation;\n "+i+"\n return lastStatement; } \n return this.postProcess(mainBody());").bind(u)}})},"esri/renderers/SimpleRenderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../symbols/jsonUtils ./Renderer".split(" "),function(n,t,i,r,u,f,e){return n=n(e,{declaredClass:"esri.renderer.SimpleRenderer",constructor:function(n){if(n&&!n.declaredClass){var t=n;this.symbol=(n=t.symbol)&&(n.declaredClass?n:f.fromJson(n));this.label=t.label;this.description=t.description}else this.symbol=n},getSymbol:function(){return this.symbol},toJson:function(){var n=t.mixin(this.inherited(arguments),{type:"simple",label:this.label,description:this.description,symbol:this.symbol&&this.symbol.toJson()});return u.fixJson(n)}}),i("extend-esri")&&t.setObject("renderer.SimpleRenderer",n,r),n})},"esri/renderers/UniqueValueRenderer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../symbols/jsonUtils ./Renderer ./arcadeUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(o,{declaredClass:"esri.renderer.UniqueValueRenderer",constructor:function(n,i,r,u,f){this.values=[];this._symbols={};this.infos=[];n&&!n.declaredClass?(i=n,this.defaultSymbol=(n=i.defaultSymbol)&&(n.declaredClass?n:e.fromJson(n)),this.attributeField=i.field1,this.attributeField2=i.field2,this.attributeField3=i.field3,this.fieldDelimiter=i.fieldDelimiter,this.defaultLabel=i.defaultLabel,this.setValueExpression(i.valueExpression),this.valueExpressionTitle=i.valueExpressionTitle,this.legendOptions=i.legendOptions,i.backgroundFillSymbol&&(this.backgroundFillSymbol=e.fromJson(i.backgroundFillSymbol)),t.forEach(i.uniqueValueInfos,this._addValueInfo,this)):(this.defaultSymbol=n,this.attributeField=i,this.attributeField2=r,this.attributeField3=u,this.fieldDelimiter=f);this._multiple=!!this.attributeField2},addValue:function(n,t){var r=i.isObject(n)?n:{value:n,symbol:t};this._addValueInfo(r)},removeValue:function(n){var i=t.indexOf(this.values,n);-1!==i&&(this.values.splice(i,1),delete this._symbols[n],this.infos.splice(i,1))},getUniqueValueInfo:function(n){var t=this.attributeField,u=n.attributes,f,r;return this._compiledFunc?t=s.executeFunction(this._compiledFunc,s.createExecContext(n,n._getViewInfo())):this._multiple?(n=this.attributeField2,f=this.attributeField3,r=[],t&&r.push(u[t]),n&&r.push(u[n]),f&&r.push(u[f]),t=r.join(this.fieldDelimiter||"")):t=i.isFunction(t)?t(n):u[t],this._symbols[t]},setValueExpression:function(n){this.valueExpression=n;this._compiledFunc=s.createFunction(n)},getFieldsUsedInExpressions:function(){var n=this.inherited(arguments);return this.valueExpression&&(n=n.concat(s.extractFieldNames(this.valueExpression))),n.sort(),t.filter(n,function(t,i){return 0===i||n[i-1]!==t})},getSymbol:function(n){return(n=this.getUniqueValueInfo(n))&&n.symbol||this.defaultSymbol},_addValueInfo:function(n){var i=n.value,t;this.values.push(i);this.infos.push(n);t=n.symbol;t&&!t.declaredClass&&(n.symbol=e.fromJson(t));this._symbols[i]=n},toJson:function(){var r=f.fixJson,n;return n={type:"uniqueValue",field1:this.attributeField,field2:this.attributeField2,field3:this.attributeField3,fieldDelimiter:this.fieldDelimiter,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:i.clone(this.legendOptions),defaultSymbol:this.defaultSymbol&&this.defaultSymbol.toJson(),defaultLabel:this.defaultLabel,uniqueValueInfos:t.map(this.infos||[],function(n){return n=i.mixin({},n),n.symbol=n.symbol&&n.symbol.toJson(),n.value+="",r(n)})},this.backgroundFillSymbol&&(n.backgroundFillSymbol=this.backgroundFillSymbol.toJson()),n=i.mixin(this.inherited(arguments),n),r(n)}}),r("extend-esri")&&i.setObject("renderer.UniqueValueRenderer",n,u),n})},"esri/renderers/ClassBreaksRenderer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../symbols/jsonUtils ./Renderer ./arcadeUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(o,{declaredClass:"esri.renderer.ClassBreaksRenderer",constructor:function(n,i){var r,u;this.breaks=[];this._symbols={};this.infos=[];this.isMaxInclusive=!0;n&&!n.declaredClass?(r=n,this.attributeField=r.field,this.setValueExpression(r.valueExpression),this.valueExpressionTitle=r.valueExpressionTitle,this.legendOptions=r.legendOptions,this.defaultSymbol=(n=r.defaultSymbol)&&(n.declaredClass?n:e.fromJson(n)),this.backgroundFillSymbol=(n=r.backgroundFillSymbol)&&(n.declaredClass?n:e.fromJson(n)),this._copy(["defaultLabel","classificationMethod:rest","normalizationType:rest","normalizationField","normalizationTotal"],r,this),u=r.minValue,(r=r.classBreakInfos)&&r[0]&&f.isDefined(r[0].classMaxValue)&&t.forEach(r,function(n){var t=n.classMaxValue;n.minValue=u;u=n.maxValue=t},this),t.forEach(r,this._addBreakInfo,this)):(this.defaultSymbol=n,this.attributeField=i)},addBreak:function(n,t,r){n=i.isObject(n)?n:{minValue:n,maxValue:t,symbol:r};this._addBreakInfo(n)},removeBreak:function(n,t){for(var r,u=this.breaks,f=u.length,e=this._symbols,i=0;i<f;i++)if(r=u[i],r[0]==n&&r[1]==t){u.splice(i,1);delete e[n+"-"+t];this.infos.splice(i,1);break}},clearBreaks:function(){this.breaks=[];this._symbols={};this.infos=[]},getBreakIndex:function(n){var t=this.attributeField,r=n.attributes,f=this.breaks,e=f.length,o=this.isMaxInclusive,u;if(this._compiledFunc)n=s.executeFunction(this._compiledFunc,s.createExecContext(n,n._getViewInfo()));else if(i.isFunction(t))n=t(n);else if(n=parseFloat(r[t]),t=this.normalizationType,t)if(u=parseFloat(this.normalizationTotal),r=parseFloat(r[this.normalizationField]),"log"===t)n=Math.log(n)*Math.LOG10E;else if("percent-of-total"!==t||isNaN(u)){if("field"===t){if(isNaN(n)||isNaN(r))return-1;n/=r}}else n=n/u*100;if(null!=n&&!isNaN(n)&&"number"==typeof n)for(r=0;r<e;r++)if(t=f[r],t[0]<=n&&(o?n<=t[1]:n<t[1]))return r;return-1},getBreakInfo:function(n){return n=this.getBreakIndex(n),-1!==n?this.infos[n]:null},getSymbol:function(n){return(n=this.breaks[this.getBreakIndex(n)])?this._symbols[n[0]+"-"+n[1]]:this.defaultSymbol},setMaxInclusive:function(n){this.isMaxInclusive=n},setValueExpression:function(n){this.valueExpression=n;this._compiledFunc=s.createFunction(n)},getFieldsUsedInExpressions:function(){var n=this.inherited(arguments);return this.valueExpression&&(n=n.concat(s.extractFieldNames(this.valueExpression))),n.sort(),t.filter(n,function(t,i){return 0===i||n[i-1]!==t})},isContinuousRenderer:function(){var n=!1;if(this.infos&&1===this.infos.length)var i=this.attributeField,r=this.normalizationField,u=this.valueExpression,n=this.getVisualVariablesForType("colorInfo",!1)||[],f=this.getVisualVariablesForType("sizeInfo",!1)||[],e=this.getVisualVariablesForType("opacityInfo",!1)||[],n=n.concat(f).concat(e),n=t.some(n,function(n){return(n.field===i||n.valueExpression===u)&&n.normalizationField==r});return n},_normalizationTypeEnums:[["field","esriNormalizeByField"],["log","esriNormalizeByLog"],["percent-of-total","esriNormalizeByPercentOfTotal"]],_classificationMethodEnums:[["natural-breaks","esriClassifyNaturalBreaks"],["equal-interval","esriClassifyEqualInterval"],["quantile","esriClassifyQuantile"],["standard-deviation","esriClassifyStandardDeviation"],["geometrical-interval","esriClassifyGeometricalInterval"],["defined-interval","esriClassifyDefinedInterval"]],_copy:function(n,i,r){t.forEach(n,function(n){var t=n.split(":"),u,e,o,f,s;if(1<t.length&&(n=t[0],u=this["_"+n+"Enums"],"rest"===t[1]?(e="1",o="0"):"sdk"===t[1]&&(e="0",o="1")),t=i[n],void 0!==t&&(r[n]=t,u&&e))for(s=u.length,f=0;f<s;f++)if(u[f][e]===t){r[n]=u[f][o];break}},this)},_addBreakInfo:function(n){var i=n.minValue,r=n.maxValue,t;this.breaks.push([i,r]);this.infos.push(n);t=n.symbol;t&&!t.declaredClass&&(n.symbol=e.fromJson(t));this._symbols[i+"-"+r]=n.symbol},toJson:function(){var n=this.infos||[],r=f.fixJson,u=n[0]&&n[0].minValue,e=this.backgroundFillSymbol,n=i.mixin(this.inherited(arguments),{type:"classBreaks",field:this.attributeField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:i.clone(this.legendOptions),defaultSymbol:this.defaultSymbol&&this.defaultSymbol.toJson(),backgroundFillSymbol:e&&e.toJson(),minValue:-Infinity===u?-Number.MAX_VALUE:u,classBreakInfos:t.map(n,function(n){return n=i.mixin({},n),n.symbol=n.symbol&&n.symbol.toJson(),n.classMaxValue=Infinity===n.maxValue?Number.MAX_VALUE:n.maxValue,delete n.minValue,delete n.maxValue,r(n)})});return this._copy(["defaultLabel","classificationMethod:sdk","normalizationType:sdk","normalizationField","normalizationTotal"],this,n),n.hasOwnProperty("normalizationType")&&!n.normalizationType&&delete n.normalizationType,n.hasOwnProperty("classificationMethod")&&!n.classificationMethod&&delete n.classificationMethod,r(n)}}),r("extend-esri")&&i.setObject("renderer.ClassBreaksRenderer",n,u),n})},"esri/renderers/TemporalRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./Renderer"],function(n,t,i,r,u){return n=n(u,{declaredClass:"esri.renderer.TemporalRenderer",constructor:function(n,t,i,r){this.observationRenderer=n;this.latestObservationRenderer=t;this.trackRenderer=i;this.observationAger=r},getSymbol:function(n){var r=n.getLayer(),i=this.getObservationRenderer(n),t=i&&i.getSymbol(n),u=this.observationAger;return r.timeInfo&&r._map.timeExtent&&i===this.observationRenderer&&u&&t&&(t=u.getAgedSymbol(t,n)),t},getObservationRenderer:function(n){return 0===n.getLayer()._getKind(n)?this.observationRenderer:this.latestObservationRenderer||this.observationRenderer},toJson:function(){var n={type:"temporal"};return n.observationRenderer=this.observationRenderer.toJson(),this.latestObservationRenderer&&(n.latestObservationRenderer=this.latestObservationRenderer.toJson()),this.trackRenderer&&(n.trackRenderer=this.trackRenderer.toJson()),this.observationAger&&(n.observationAger=this.observationAger.toJson()),n}}),i("extend-esri")&&t.setObject("renderer.TemporalRenderer",n,r),n})},"esri/renderers/SymbolAger":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.renderer.SymbolAger",getAgedSymbol:function(){},_setSymbolSize:function(n,t){switch(n.type){case"simplemarkersymbol":n.setSize(t);break;case"picturemarkersymbol":n.setWidth(t);n.setHeight(t);break;case"simplelinesymbol":case"cartographiclinesymbol":n.setWidth(t);break;case"simplefillsymbol":case"picturefillsymbol":n.outline&&n.outline.setWidth(t)}}}),i("extend-esri")&&t.setObject("renderer.SymbolAger",n,r),n})},"esri/renderers/TimeClassBreaksAger":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has dojo/date ../kernel ../lang ../symbols/jsonUtils ../Color ./SymbolAger".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c=n(h,{declaredClass:"esri.renderer.TimeClassBreaksAger",constructor:function(n,t){this.infos=n;this.timeUnits=t||"day";n.sort(function(n,t){return n.minAge<t.minAge?-1:n.minAge>t.minAge?1:0})},getAgedSymbol:function(n,i){var s=i.getLayer(),c=i.attributes,h=e.isDefined,r,f;return(n=o.fromJson(n.toJson()),r=s._map.timeExtent.endTime,!r)?n:(f=u.difference(new Date(c[s._startTimeField]),r,this.timeUnits),t.some(this.infos,function(t){if(f>=t.minAge&&f<=t.maxAge){var i=t.color,r=t.size;return t=t.alpha,i&&n.setColor(i),h(r)&&this._setSymbolSize(n,r),h(t)&&n.color&&(n.color.a=t),!0}},this),n)},toJson:function(){var r={agerClassBreakInfos:[]},i,n,t;for(r.timeUnits=this._getRestUnits(this.timeUnits),i=0;i<this.infos.length;i+=1)n=this.infos[i],t={},t.oldestAge=Infinity===n.maxAge?null:n.maxAge,t.size=n.size,n.color&&(t.color=s.toJsonColor(n.color)),n.alpha&&(t.alpha=Math.round(255*n.alpha)),r.agerClassBreakInfos[i]=t;return r},_getRestUnits:function(n){var t="esriTimeUnitsDays";switch(n){case c.UNIT_SECONDS:t="esriTimeUnitsSeconds";break;case c.UNIT_MILLISECONDS:t="esriTimeUnitsMilliseconds";break;case c.UNIT_HOURS:t="esriTimeUnitsHours";break;case c.UNIT_MINUTES:t="esriTimeUnitsMinutes";break;case c.UNIT_MONTHS:t="esriTimeUnitsMonths";break;case c.UNIT_WEEKS:t="esriTimeUnitsWeeks";break;case c.UNIT_YEARS:t="esriTimeUnitsYears"}return t}});return i.mixin(c,{UNIT_DAYS:"day",UNIT_HOURS:"hour",UNIT_MILLISECONDS:"millisecond",UNIT_MINUTES:"minute",UNIT_MONTHS:"month",UNIT_SECONDS:"second",UNIT_WEEKS:"week",UNIT_YEARS:"year"}),r("extend-esri")&&i.setObject("renderer.TimeClassBreaksAger",c,f),c})},"esri/renderers/TimeRampAger":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has ../kernel ../symbols/jsonUtils ../Color ./SymbolAger".split(" "),function(n,t,i,r,u,f,e,o){return n=n(o,{declaredClass:"esri.renderer.TimeRampAger",constructor:function(n,t,i){this.colorRange=n;this.sizeRange=t;this.alphaRange=i},getAgedSymbol:function(n,t){var r=t.getLayer(),o=t.attributes;n=f.fromJson(n.toJson());var u=r._map.timeExtent,e=u.startTime,u=u.endTime;if(!e||!u)return n;if(e=e.getTime(),u=u.getTime(),r=new Date(o[r._startTimeField]),r=r.getTime(),r<e&&(r=e),e=u===e?1:(r-e)/(u-e),(r=this.sizeRange)&&(o=r[0],u=r[1],r=Math.abs(u-o)*e,this._setSymbolSize(n,o<u?o+r:o-r)),r=this.colorRange){var u=r[0],h=r[1],l=Math.round,o=new i,s=u.r,c=h.r,r=Math.abs(c-s)*e;o.r=l(s<c?s+r:s-r);s=u.g;c=h.g;r=Math.abs(c-s)*e;o.g=l(s<c?s+r:s-r);s=u.b;c=h.b;r=Math.abs(c-s)*e;o.b=l(s<c?s+r:s-r);u=u.a;h=h.a;r=Math.abs(h-u)*e;o.a=u<h?u+r:u-r;n.setColor(o)}return o=n.color,(r=this.alphaRange)&&o&&(u=r[0],h=r[1],r=Math.abs(h-u)*e,o.a=u<h?u+r:u-r),n},toJson:function(){var n={};return this.sizeRange&&(n.sizeRange=this.sizeRange),this.colorRange&&(n.colorRange=[e.toJsonColor(this.colorRange[0]),e.toJsonColor(this.colorRange[1])]),this.alphaRange&&(n.alphaRange=[Math.round(255*this.alphaRange[0]),Math.round(255*this.alphaRange[1])]),n}}),r("extend-esri")&&t.setObject("renderer.TimeRampAger",n,u),n})},"esri/renderers/StretchRenderer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../layers/RasterFunction ./colorRampUtils".split(" "),function(n,t,i,r,u,f,e,o){var s={TYPE_NONE:"none",TYPE_STANDARDDEVIATION:"standardDeviation",TYPE_HISTOGRAMEQUALIZATION:"histogramEqualization",TYPE_MINMAX:"minMax",TYPE_PERCENTCLIP:"percentClip",TYPE_SIGMOID:"sigmoid"};return n=n(null,{declaredClass:"esri.renderer.StretchRenderer",constructor:function(n){n=n||{};this.stretchType=s.TYPE_NONE;this.dra=!0;this.statistics=[];this.gamma=[];this.computeGamma=this.useGamma=!1;this.sigmoidStrengthLevel=this.numberOfStandardDeviations=this.minPercent=this.maxPercent=this.min=this.max=null;i.mixin(this,n);this.colorRamp=o.fromJson(n.colorRamp)},toJson:function(){var n={type:"rasterStretch",stretchType:this.stretchType,colorRamp:this.colorRamp&&this.colorRamp.toJson(),min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:i.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:i.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel};return f.fixJson(n)},toRenderingRule:function(){var i=new e,n,t;return i.functionName="Stretch",n=this._convertStretchTypeEnumToIndex(this.stretchType),t={StretchType:n,Statistics:this.statistics,DRA:this.dra,UseGamma:this.useGamma,Gamma:this.gamma,ComputeGamma:this.computeGamma},f.isDefined(this.min)&&(t.Min=this.min),f.isDefined(this.min)&&(t.Max=this.max),3===n?(t.NumberOfStandardDeviations=this.numberOfStandardDeviations,i.outputPixelType="U8"):6===n?(t.MinPercent=parseFloat(this.minPercent),t.MaxPercent=parseFloat(this.maxPercent),i.outputPixelType="U8"):5===n?i.outputPixelType="U8":9===n&&(t.SigmoidStrengthLevel=this.sigmoidStrengthLevel),i.functionArguments=t,i.variableName="Raster",this.colorRamp?(n=new e,t=o.getColorRampName(this.colorRamp),n.functionArguments=t?{colorRamp:t}:{colorRamp:this.colorRamp.toJson()},n.variableName="Raster",n.functionName="Colormap",n.functionArguments.Raster=i,n):i},_convertStretchTypeEnumToIndex:function(n){var t=0;return n===s.TYPE_STANDARDDEVIATION?t=3:n===s.TYPE_HISTOGRAMEQUALIZATION?t=4:n===s.TYPE_MINMAX?t=5:n===s.TYPE_PERCENTCLIP?t=6:n===s.TYPE_SIGMOID&&(t=9),t},_convertStretchTypeIndexToEnum:function(n){var t=0;return 3===n?t=s.TYPE_STANDARDDEVIATION:4===n?t=s.TYPE_HISTOGRAMEQUALIZATION:5===n?t=s.TYPE_MINMAX:6===n?t=s.TYPE_PERCENTCLIP:9===n&&(t=s.TYPE_SIGMOID),t}}),i.mixin(n,s),r("extend-esri")&&i.setObject("renderer.StretchRenderer",n,u),n})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){var f=n(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(n){if(t.isObject(n)){var i=0;if(this.functionName=n.rasterFunction,this.functionArguments=t.clone(n.rasterFunctionArguments||n.arguments),t.mixin(this,n),(n=this.functionArguments)&&(n.Raster=this._toRasterFunction(n.Raster),n.Raster2=this._toRasterFunction(n.Raster2),n.DEM=this._toRasterFunction(n.DEM),n.FillRaster=this._toRasterFunction(n.FillRaster),n.Rasters&&n.Rasters.length))for(i=0;i<n.Rasters.length;i++)n.Rasters[i]=this._toRasterFunction(n.Rasters[i])}},_toRasterFunction:function(n){return n&&(n.rasterFunction||n.functionName)?new f(n):n},_rfToJson:function(n){return n&&"esri.layers.RasterFunction"===n.declaredClass&&(n=n.toJson()),n},toJson:function(){var n=t.clone(this.functionArguments||this.arguments),i,r;if(n&&(n.Raster=this._rfToJson(n.Raster),n.Raster2=this._rfToJson(n.Raster2),n.DEM=this._rfToJson(n.DEM),n.FillRaster=this._rfToJson(n.FillRaster),n.Rasters&&n.Rasters.length)){for(r=[],i=0;i<n.Rasters.length;i++)r.push(this._rfToJson(n.Rasters[i]));n.Rasters=r}return u.filter({rasterFunction:this.functionName,rasterFunctionArguments:n,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(n){if(null!==n&&void 0!==n)return!0})}});return i("extend-esri")&&t.setObject("layers.RasterFunction",f,r),f})},"esri/renderers/colorRampUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/store/Memory ../tasks/AlgorithmicColorRamp ../tasks/MultipartColorRamp ../Color".split(" "),function(n,t,i,r,u,f){function s(n,i,r){if(n){i=i||l;r=r||o;var u=null,s=n.declaredClass,h,f;return(h="string"==typeof n?n:n.name)?t.some(r,function(n){if(n.name===h)return u=n.id,!0}):"esri.tasks.AlgorithmicColorRamp"===s?t.some(i,function(t){if(e(n.fromColor.toRgb(),t.fromColor)&&e(n.toColor.toRgb(),t.toColor))return u=t.id,!0},this):"esri.tasks.MultipartColorRamp"===s&&t.some(i,function(i){if(n.colorRamps&&i.colorRamps&&n.colorRamps.length===i.colorRamps.length&&(f=n.colorRamps,!t.some(i.colorRamps,function(n,t){if(!e(f[t].fromColor.toRgb(),n.fromColor)||!e(f[t].toColor.toRgb(),n.toColor))return!0},this))){if(u)return!0;u=i.id}},this),u}}function h(n){var t=new r;return t.fromColor=f.toDojoColor(n.fromColor),t.toColor=f.toDojoColor(n.toColor),t.algorithm=n.algorithm,t}function e(n,i){return n&&i&&n.length&&i.length&&n.length===i.length?!t.some(n,function(n,t){if(n!==i[t])return!0}):!1}var c={},l=[{id:"none",selected:!0},{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],o=[{name:"Aspect",id:"aspect_predefined"},{name:"Black to White",id:"blackToWhite_predefined"},{name:"Blue Bright",id:"blueBright_predefined"},{name:"Blue Light to Dark",id:"blueLightToDark_predefined"},{name:"Blue-Green Bright",id:"blueGreenBright_predefined"},{name:"Blue-Green Light to Dark",id:"blueGreenLightToDark_predefined"},{name:"Brown Light to Dark",id:"brownLightToDark_predefined"},{name:"Brown to Blue Green Diverging, Bright",id:"brownToBlueGreenDivergingBright_predefined"},{name:"Brown to Blue Green Diverging, Dark",id:"brownToBlueGreenDivergingDark_predefined"},{name:"Coefficient Bias",id:"coefficientBias_predefined"},{name:"Cold to Hot Diverging",id:"coldToHotDiverging_predefined"},{name:"Condition Number",id:"conditionNumber_predefined"},{name:"Cyan to Purple",id:"cyanToPurple_predefined"},{name:"Cyan-Light to Blue-Dark",id:"cyanLightToBlueDark_predefined"},{name:"Distance",id:"distance_predefined"},{id:"elevation1_predefined",name:"Elevation #1"},{id:"elevation2_predefined",name:"Elevation #2"},{id:"errors_predefined",name:"Errors"},{id:"grayLightToDark_predefined",name:"Gray Light to Dark"},{id:"greenBright_predefined",name:"Green Bright"},{id:"greenLightToDark_predefined",name:"Green Light to Dark"},{name:"Green to Blue",id:"greenToBlue_predefined"},{name:"Orange Bright",id:"orangeBright_predefined"},{name:"Orange Light to Dark",id:"orangeLightToDark_predefined"},{id:"partialSpectrum_predefined",name:"Partial Spectrum"},{id:"partialSpectrum1Diverging_predefined",name:"Partial Spectrum 1 Diverging",type:"multipart"},{id:"partialSpectrum2Diverging_predefined",name:"Partial Spectrum 2 Diverging"},{name:"Pink to YellowGreen Diverging, Bright",id:"pinkToYellowGreenDivergingBright_predefined"},{name:"Pink to YellowGreen Diverging, Dark",id:"pinkToYellowGreenDivergingDark_predefined"},{id:"precipitation_predefined",name:"Precipitation"},{id:"prediction_predefined",name:"Prediction"},{name:"Purple Bright",id:"purpleBright_predefined"},{id:"purpleToGreenDivergingBright_predefined",name:"Purple to Green Diverging, Bright"},{id:"purpleToGreenDivergingDark_predefined",name:"Purple to Green Diverging, Dark"},{name:"Purple-Blue Bright",id:"purpleBlueBright_predefined"},{name:"Purple-Blue Light to Dark",id:"purpleBlueLightToDark_predefined"},{name:"Purple-Red Bright",id:"purpleRedBright_predefined"},{name:"Purple-Red Light to Dark",id:"purpleRedLightToDark_predefined"},{name:"Red Bright",id:"redBright_predefined"},{name:"Red Light to Dark",id:"redLightToDark_predefined"},{id:"redToBlueDivergingBright_predefined",name:"Red to Blue Diverging, Bright"},{id:"redToBlueDivergingDark_predefined",name:"Red to Blue Diverging, Dark"},{id:"redToGreen_predefined",name:"Red to Green"},{id:"redToGreenDivergingBright_predefined",name:"Red to Green Diverging, Bright"},{id:"redToGreenDivergingDark_predefined",name:"Red to Green Diverging, Dark"},{name:"Slope",id:"slope_predefined"},{id:"spectrumFullBright_predefined",name:"Spectrum-Full Bright"},{id:"spectrumFullDark_predefined",name:"Spectrum-Full Dark"},{id:"spectrumFullLight_predefined",name:"Spectrum-Full Light"},{id:"surface_predefined",name:"Surface"},{id:"temperature_predefined",name:"Temperature"},{name:"White to Black",id:"whiteToBlack_predefined"},{id:"yellowToDarkRed_predefined",name:"Yellow to Dark Red"},{id:"yellowToGreenToDarkBlue_predefined",name:"Yellow to Green to Dark Blue"},{name:"Yellow to Red",id:"yellowToRed_predefined"},{name:"Yellow-Green Bright",id:"yellowGreenBright_predefined"},{name:"Yellow-Green Light to Dark",id:"yellowGreenLightToDark_predefined"}],a=new i({data:o});return n.mixin(c,{predefinedColorRamps:l,predefinedColorRampNameMap:o,getColorRampName:function(n){return(n=s(n))?(n=a.query({id:n}),n[0]?n[0].name:null):null},fromJson:function(n){var i=null;return n?("multipart"===n.type?(i=new u,i.colorRamps=t.map(n.colorRamps,function(n){return h(n)},this)):"algorithmic"===n.type&&(i=h(n)),i):i},colorsEqual:e,getColorRampId:s}),c})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(n,t,i){return n("dojo.store.Memory",null,{constructor:function(n){for(var t in n)this[t]=n[t];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:i,get:function(n){return this.data[this.index[n]]},getIdentity:function(n){return n[this.idProperty]},put:function(n,t){var u=this.data,r=this.index,i=this.idProperty,i=n[i]=t&&"id"in t?t.id:i in n?n[i]:Math.random();if(i in r){if(t&&!1===t.overwrite)throw Error("Object already exists");u[r[i]]=n}else r[i]=u.push(n)-1;return i},add:function(n,t){return(t=t||{}).overwrite=!1,this.put(n,t)},remove:function(n){var t=this.index,i=this.data;if(n in t)return i.splice(t[n],1),this.setData(i),!0},query:function(n,i){return t(this.queryEngine(n,i)(this.data))},setData:function(n){n.items?(this.idProperty=n.identifier||this.idProperty,n=this.data=n.items):this.data=n;this.index={};for(var t=0,i=n.length;t<i;t++)this.index[n[t][this.idProperty]]=t}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(n,t,i){var r=function(u){function f(t){u[t]=function(){var f=arguments,o=i(u,function(i){return Array.prototype.unshift.call(f,i),r(n[t].apply(n,f))});if("forEach"!==t||e)return o}}if(!u)return u;var e=!!u.then;return e&&(u=t.delegate(u)),f("forEach"),f("filter"),f("map"),null==u.total&&(u.total=i(u,function(n){return n.length})),u};return t.setObject("dojo.store.util.QueryResults",r),r})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(n){return function(t,i){function r(r){var u,f;return r=n.filter(r,t),u=i&&i.sort,u&&r.sort("function"==typeof u?u:function(n,t){for(var f,e=0;f=u[e];e++){var i=n[f.attribute],r=t[f.attribute],i=null!=i?i.valueOf():i,r=null!=r?r.valueOf():r;if(i!=r)return!!f.descending==(null==i||i>r)?-1:1}return 0}),i&&(i.start||i.count)&&(f=r.length,r=r.slice(i.start||0,(i.start||0)+(i.count||Infinity)),r.total=f),r}switch(typeof t){default:throw Error("Can not query with a "+typeof t);case"object":case"undefined":var u=t;t=function(n){var i,t;for(i in u)if(t=u[i],t&&t.test){if(!t.test(n[i],n))return!1}else if(t!=n[i])return!1;return!0};break;case"string":if(!this[t])throw Error("No filter function "+t+" was found in store");t=this[t];case"function":}return r.matches=t,r}})},"esri/tasks/AlgorithmicColorRamp":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../Color ./ColorRamp".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.tasks.AlgorithmicColorRamp",type:"algorithmic",fromColor:null,toColor:null,algorithm:null,toJson:function(){var n;switch(this.algorithm&&this.algorithm.toLowerCase()){case"cie-lab":n="esriCIELabAlgorithm";break;case"hsv":n="esriHSVAlgorithm";break;case"lab-lch":n="esriLabLChAlgorithm"}return n={type:"algorithmic",algorithm:n},n.fromColor=u.toJsonColor(this.fromColor),n.toColor=u.toJsonColor(this.toColor),n}}),i("extend-esri")&&t.setObject("tasks.AlgorithmicColorRamp",n,r),n})},"esri/tasks/ColorRamp":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.ColorRamp",type:null}),i("extend-esri")&&t.setObject("tasks.ColorRamp",n,r),n})},"esri/tasks/MultipartColorRamp":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../symbols/Symbol ./ColorRamp".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.tasks.MultipartColorRamp",type:"multipart",constructor:function(){this.colorRamps=[]},addColorRamp:function(n){this.colorRamps.push(n)},toJson:function(){return{type:"multipart",colorRamps:i.map(this.colorRamps,function(n){return n.toJson()})}}}),r("extend-esri")&&t.setObject("tasks.MultipartColorRamp",n,u),n})},"esri/renderers/jsonUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/has dojox/gfx/_base ../kernel ../Color ../symbols/jsonUtils ./SimpleRenderer ./UniqueValueRenderer ./ClassBreaksRenderer ./VectorFieldRenderer ./DotDensityRenderer ./ScaleDependentRenderer ./TimeClassBreaksAger ./TimeRampAger ./TemporalRenderer ./HeatmapRenderer ./StretchRenderer".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var k={fromJson:function(n){var t;switch(n.type||""){case"simple":t=new o(n);break;case"uniqueValue":t=new s(n);break;case"classBreaks":t=new h(n);break;case"vectorField":t=new c(n);break;case"scaleDependent":t=this._scaleDependentFromJson(n);break;case"dotDensity":t=this._dotDensityFromJson(n);break;case"temporal":t=this._temporalFromJson(n);break;case"heatmap":t=this._heatmapFromJson(n);break;case"rasterStretch":t=new b(n)}return t},_scaleDependentFromJson:function(t){var i={},r=t.minScale;return i.rendererInfos=n.map(t.rendererInfos,function(n){var t=n.maxScale;return n={minScale:r,maxScale:t,renderer:n.renderer&&this.fromJson(n.renderer)},r=t,n},this),new a(i)},_dotDensityFromJson:function(i){return i.backgroundColor&&t.isArray(i.backgroundColor)&&(i.backgroundColor=f.toDojoColor(i.backgroundColor)),0<i.dotSize&&(i.dotSize=r.pt2px(i.dotSize)),i.fields&&n.forEach(i.fields,function(n){n&&t.isArray(n.color)&&(n.color=f.toDojoColor(n.color))}),i.legendOptions&&(i.legendOptions.backgroundColor&&t.isArray(i.legendOptions.backgroundColor)&&(i.legendOptions.backgroundColor=f.toDojoColor(i.legendOptions.backgroundColor)),i.legendOptions.outline&&(i.legendOptions.outline=e.fromJson(i.legendOptions.outline))),i.outline&&(i.outline=e.fromJson(i.outline)),new l(i)},_temporalFromJson:function(n){var t,i,r;return n=n||{},t=this.fromJson(n.observationRenderer),i=n.latestObservationRenderer?this.fromJson(n.latestObservationRenderer):null,r=n.trackRenderer?this.fromJson(n.trackRenderer):null,n=this._agerFromJson(n.observationAger),new p(t,i,r,n)},_agerFromJson:function(n){var t;return n=n||{},n.colorRange||n.sizeRange||n.alphaRange?t=this._timeRampFromJson(n):n.agerClassBreakInfos&&(t=this._timeClassBreaksFromJson(n)),t},_timeRampFromJson:function(n){var t,i,r;return n.colorRange&&1<n.colorRange.length&&(t=[f.toDojoColor(n.colorRange[0]),f.toDojoColor(n.colorRange[1])]),n.sizeRange&&1<n.sizeRange.length&&(i=[n.sizeRange[0],n.sizeRange[1]]),n.alphaRange&&1<n.alphaRange.length&&(r=[n.alphaRange[0]/255,n.alphaRange[1]/255]),new y(t,i,r)},_timeClassBreaksFromJson:function(n){var u=n.agerClassBreakInfos,t,i,e=[],r;t=v.UNIT_DAYS;switch(n.timeUnits){case"esriTimeUnitsSeconds":t=v.UNIT_SECONDS;break;case"esriTimeUnitsMilliseconds":t=v.UNIT_MILLISECONDS;break;case"esriTimeUnitsHours":t=v.UNIT_HOURS;break;case"esriTimeUnitsMinutes":t=v.UNIT_MINUTES;break;case"esriTimeUnitsMonths":t=v.UNIT_MONTHS;break;case"esriTimeUnitsWeeks":t=v.UNIT_WEEKS;break;case"esriTimeUnitsYears":t=v.UNIT_YEARS}for(r=0;r<u.length;r+=1)n=u[r],i={minAge:0,maxAge:n.oldestAge||Infinity},n.color&&(i.color=f.toDojoColor(n.color)),n.alpha&&(i.alpha=n.alpha/255),i.size=n.size,e[r]=i;return new v(e,t)},_heatmapFromJson:function(t){var i=t.colorStops;return i&&i instanceof Array&&n.forEach(i,function(n){n.color=f.toDojoColor(n.color)}),new w(t)}};return i("extend-esri")&&t.mixin(t.getObject("renderer",!0,u),k),k})},"esri/renderers/VectorFieldRenderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/_base/array ../kernel ../lang ../Color ./Renderer ./ClassBreaksRenderer ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils require".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y=n(o,{declaredClass:"esri.renderer.VectorFieldRenderer",iconFolderPath:"../images/symbol/sfs/",constructor:function(t){f.isDefined(t)||(t={});t.attributeField=t.attributeField||"Magnitude";t.rotationInfo=t.rotationInfo||this._getRotationInfo(t);n.safeMixin(this,t);this.style=this.style||y.STYLE_SINGLE_ARROW;this.singleArrowSymbol&&(this.singleArrowSymbol=this.singleArrowSymbol.declaredClass?this.singleArrowSymbol:a.fromJson(this.singleArrowSymbol));this.renderer=new s(this._getDefaultSymbol(),t.attributeField);this._updateRenderer(this.style);this.flowRepresentation=this.flowRepresentation||this.FLOW_FROM},getSymbol:function(n){return this.renderer&&this.renderer.getSymbol(n)},setVisualVariables:function(n){return n=r.filter(n,function(n){if("sizeInfo"===n.type)return f.isDefined(this._updateSizeInfo(n))},this),this.inherited(arguments),this},setSizeInfo:function(n){return this._updateSizeInfo(n),this.inherited(arguments),this},setProportionalSymbolInfo:function(n){return this.setSizeInfo(n),this},setColorInfo:function(){return this},_updateRenderer:function(n){return f.isDefined(this.renderer)?n===y.STYLE_SINGLE_ARROW?this._createSingleArrowRenderer():n===y.STYLE_BEAUFORT_KN?this._createBeaufortKnotsRenderer():n===y.STYLE_BEAUFORT_METER?this._createBeaufortMeterRenderer():n===y.STYLE_BEAUFORT_FEET?this._createBeaufortFeetRenderer():n===y.STYLE_BEAUFORT_MILE?this._createBeaufortMilesRenderer():n===y.STYLE_BEAUFORT_KM?this._createBeaufortKilometersRenderer():n===y.STYLE_OCEAN_CURRENT_M?this._createCurrentMeterRenderer():n===y.STYLE_OCEAN_CURRENT_KN?this._createCurrentKnotsRenderer():n===y.STYLE_SCALAR?this._createSimpleScalarRenderer():n===y.STYLE_WIND_BARBS?this._createWindBarbsRenderer():this._createClassifiedArrowRenderer():Error("Invalid Renderer!")},_updateSizeInfo:function(n){return n&&f.isDefined(n.minSize)&&f.isDefined(n.maxSize)&&f.isDefined(n.minDataValue)&&f.isDefined(n.maxDataValue)?(this.style===y.STYLE_WIND_BARBS&&(n.minSize=n.maxSize),n.field=n.field||"Magnitude",n.type="sizeInfo",n):null},_createClassifiedArrowRenderer:function(){var r,n,t,i;if(this.renderer.defaultSymbol=this._getDefaultSymbol(new e([56,168,0])),n=[0,1e-6,3.5,7,10.5,14],f.isDefined(this.minDataValue)&&f.isDefined(this.maxDataValue))for(r=(this.maxDataValue-this.minDataValue)/5,n=[],i=this.minDataValue,t=0;6>t;t++)n[t]=i,i+=r;this._addBreaks(n,[[56,168,0],[139,309,0],[255,255,0],[255,128,0],[255,0,0]])},_createSingleArrowRenderer:function(){this.renderer.defaultSymbol=this.singleArrowSymbol||this._getDefaultSymbol()},_createBeaufortMeterRenderer:function(){this.renderer.defaultSymbol=this._getDefaultSymbol(new e([214,47,39]));this._addBreaks([0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7],[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])},_createBeaufortKnotsRenderer:function(){this.renderer.defaultSymbol=this._getDefaultSymbol(new e([214,47,39]));this._addBreaks([0,1,3,6,10,16,21,27,33,40,47,55,63],[[40,146,199],[89,162,186],[129,179,171],[160,194,155],[191,212,138],[218,230,119],[250,250,100],[252,213,83],[252,179,102],[250,141,52],[247,110,42],[240,71,29]])},_createBeaufortFeetRenderer:function(){var n=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];r.forEach(n,function(t,i){n[i]*=3.28084});this.renderer.defaultSymbol=this._getDefaultSymbol(new e([214,47,39]));this._addBreaks(n,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])},_createBeaufortMilesRenderer:function(){var n=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];r.forEach(n,function(t,i){n[i]*=2.23694});this.renderer.defaultSymbol=this._getDefaultSymbol(new e([214,47,39]));this._addBreaks(n,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])},_createBeaufortKilometersRenderer:function(){var n=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];r.forEach(n,function(t,i){n[i]*=3.6});this.renderer.defaultSymbol=this._getDefaultSymbol(new e([214,47,39]));this._addBreaks(n,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])},_createCurrentMeterRenderer:function(){this.renderer.defaultSymbol=this._getDefaultSymbol(new e([177,177,177]));this._addBreaks([0,.5,1,1.5,2],[[78,26,153],[179,27,26],[202,128,26],[177,177,177]])},_createCurrentKnotsRenderer:function(){this.renderer.defaultSymbol=this._getDefaultSymbol(new e([177,177,177]));this._addBreaks([0,.25,.5,1,1.5,2,2.5,3,3.5,4],[[0,0,0],[0,37,100],[78,26,153],[151,0,100],[179,27,26],[177,78,26],[202,128,26],[177,179,52],[177,177,177]])},_createSimpleScalarRenderer:function(){this.renderer.defaultSymbol=new c({url:v.toUrl(this.iconFolderPath+"scalar.png"),height:20,width:20,type:"esriPMS",angle:0})},_createWindBarbsRenderer:function(){for(var t=[],r,i,n=0;150>=n;n+=5)t.push(n);for(r="M20 20 M5 20 A15 15 0 1 0 35 20 A15 15 0 1 0 5 20 M20 20 M10 20 A10 10 0 1 0 30 20 A10 10 0 1 0 10 20;M25 0 L25 40 M25 35 L17.5 37.5;M25 0 L25 40 L10 45 L25 40;M25 0 L25 40 L10 45 L25 40 M25 35 L17.5 37.5;M25 0 L25 40 L10 45 L25 40 M25 35 L10 40;M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L17.5 32.5;M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35;M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5;M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30;M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5;M25 0 L25 40 L10 40 L25 35;M25 0 L25 40 L10 40 L25 35 M25 30 L17.5 32.5;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L17.5 17.5;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20;M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20 L25 15 M25 10 L17.5 12.5;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L17.5 27.5;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L17.5 22.5;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L17.5 17.5;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L10 15;M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L10 15 M25 10 M25 5 L17.5 7.5".split(";"),i=new c({url:v.toUrl(this.iconFolderPath+"windbarb.png"),height:20,width:20,type:"esriPMS",angle:0}),this.renderer.defaultSymbol=i,n=0;n<t.length-1;n++)0==n?this.renderer.addBreak({minValue:t[n],maxValue:t[n+1],symbol:i}):this.renderer.addBreak({minValue:t[n],maxValue:t[n+1],symbol:(new h).setPath(r[n]).setOutline((new l).setWidth(1.5)).setSize(20).setColor(new e([0,0,0,255]))})},_getDefaultSymbol:function(n){return(new h).setPath("M14,32 14,18 9,23 16,3 22,23 17,18 17,32 z").setOutline((new l).setWidth(0)).setSize(20).setColor(n||new e([0,92,230]))},_getRotationInfo:function(n){var t=n&&n.flowRepresentation||y.FLOW_FROM,i=n&&n.rotationField||"Direction",r=y.FLOW_FROM;return{field:function(n){return n=n.attributes[i],t===r?n:n+180},type:"geographic"}},_addBreaks:function(n,t){if(!f.isDefined(this.renderer))return Error("Invalid Renderer!");if(!(n&&t&&n.length&&t.length&&n.length>=t.length))return Error("AddBreaks: Input arguments break values and colors not valid");for(var i=0;i<t.length;i++)this.renderer.addBreak({minValue:n[i],maxValue:n[i+1],symbol:this._getDefaultSymbol(new e(t[i]))})},toJson:function(){var n=t.mixin(this.inherited(arguments),{type:"vectorField",style:this.style,attributeField:this.attributeField,flowRepresentation:this.flowRepresentation});return this.renderer&&this.renderer.defaultSymbol&&this.style===y.STYLE_SINGLE_ARROW&&(n.singleArrowSymbol=this.renderer.defaultSymbol.toJson()),f.fixJson(n)}});return t.mixin(y,{STYLE_WIND_BARBS:"wind_speed",STYLE_SINGLE_ARROW:"single_arrow",STYLE_CLASSIFIED_ARROW:"classified_arrow",STYLE_BEAUFORT_KN:"beaufort_kn",STYLE_BEAUFORT_METER:"beaufort_m",STYLE_BEAUFORT_MILE:"beaufort_mi",STYLE_BEAUFORT_FEET:"beaufort_ft",STYLE_BEAUFORT_KM:"beaufort_km",STYLE_OCEAN_CURRENT_M:"ocean_current_m",STYLE_OCEAN_CURRENT_KN:"ocean_current_kn",STYLE_SCALAR:"simple_scalar"},{FLOW_FROM:"flow_from",FLOW_TO:"flow_to"}),i("extend-esri")&&t.setObject("renderer.VectorFieldRenderer",y,u),y})},"esri/renderers/DotDensityRenderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/has dojox/gfx/_base ../kernel ../lang ../Color ./Renderer ../symbols/PictureFillSymbol ../geometry/ScreenPoint ../geometry/Point".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(h,{declaredClass:"esri.renderer.DotDensityRenderer",constructor:function(n){this.dotSize=n.dotSize||3;this.dotValue=n.dotValue;this.fields=n.fields;this.outline=n.outline;this.backgroundColor=n.backgroundColor;this.exactCount=n.exactCount||!0;this.dotShape=n.dotShape||"square";this.legendOptions=n.legendOptions;this._exactCountMinArea=1e4;this._currentMapScale=this._map=this._canvas=null;this._symbolMap={};this._currentGraphic=this._currentResolution=this._objectIdField=null;this._supportsCanvas=window.CanvasRenderingContext2D?!0:!1;window.CanvasRenderingContext2D||console.log("The DotDensityRenderer requires a Canvas enabled Browser.  IE8 and less does not support Canvas.")},getSymbol:function(n){var r,i;return(this._currentGraphic=n,!this._supportsCanvas)?null:(this._map||(this._map=n.getLayer()._map,this._objectIdField=n.getLayer().objectIdField,this._currentMapScale=this._map.getScale(),this._currentResolution=this._map.extent.getWidth()/this._map.width,this._map.on("zoom-end",t.hitch(this,function(n){this._currentMapScale=this._map.getScale();this._currentResolution=n.extent.getWidth()/this._map.width;this._symbolMap[this._currentMapScale]={}}))),this._symbolMap[this._currentMapScale]&&this._symbolMap[this._currentMapScale][n.attributes[this._objectIdField]])?(r=this._symbolMap[this._currentMapScale][n.attributes[this._objectIdField]],i=this._getShapeProperties(n),r.setOffset(i.dx,i.dy),r):(r=this._generateFieldsCount(this.fields,n.attributes,this.dotValue),i=this._getShapeProperties(n),r=new c(this._generateImageSrc(i.width,i.height,r,i.minXY,i.maxXY),this.outline,i.width,i.height),r.setOffset(i.dx,i.dy),this._symbolMap[this._currentMapScale]||(this._symbolMap[this._currentMapScale]={}),this._symbolMap[this._currentMapScale][n.attributes[this._objectIdField]]=r)},_generateFieldsCount:function(n,t,i){for(var u,r=n.length-1;0<=r;r--)u=t[n[r].name]/i,n[r].numPoints=Math.round(u);return n},_getShapeProperties:function(n){var t,i,r,u;return t=n.geometry.getExtent(),t.contains(this._map.extent)&&(t=this._map.extent),r=Math.ceil(t.getWidth()/this._currentResolution),u=Math.ceil(t.getHeight()/this._currentResolution),i=this._map.toScreen(new a(t.xmin,t.ymin,t.spatialReference)),t=this._map.toScreen(new a(t.xmax,t.ymax,t.spatialReference)),n=n.getLayer().getNode().getCTM(),{minXY:i,maxXY:t,dx:(i.x-n.e)%r,dy:(t.y-n.f)%u,width:r,height:u}},_generateImageSrc:function(n,t,i,r,u,f){var s=this.dotSize,e,h,o;for(this._canvas?(this._canvas.width=n,this._canvas.height=t):this._canvas=this._initCanvas(n,t),e=this._canvas.getContext("2d"),(f=f||this.backgroundColor)&&(e.fillStyle=f.toCss(!0),e.fillRect(0,0,n,t),e.fill()),f=i.length-1;0<=f;f--)for(e.fillStyle=i[f].color.toCss(!0),h=i[f].numPoints-1;0<=h;h--)o=this._getRandomPoint(n,t,r,u),"square"===this.dotShape?e.fillRect(o.x,o.y,s,s):"circle"===this.dotShape&&(e.beginPath(),e.arc(o.x,o.y,s/2,0,2*Math.PI,!0)),e.fill();return this._canvas.toDataURL()},_initCanvas:function(n,t){var i=r.create("canvas",{id:"canvas",width:n+"px",height:t+"px",style:"position: absolute; left: -10000px; top: 0px;"},null);return document.body.appendChild(i),i},_getRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1)+n)},_getRandomPoint:function(n,t,i,r){var u={},f=this.outline&&this.outline.width?this.outline.width:0;if(!0===this.exactCount&&n*t>this._exactCountMinArea){n=!1;do u.x=this._getRandomInt(i.x,r.x),u.y=this._getRandomInt(r.y,i.y),n=new l(u.x,u.y),n=this._checkPointShapeBounds(n,this.dotSize+f,this._currentGraphic.geometry),!0===n&&(u.x-=i.x,u.y-=r.y);while(!1===n)}else u.x=this._getRandomInt(0,n),u.y=this._getRandomInt(0,t);return u},_checkPointShapeBounds:function(n,t,i){var r=null,r=!1,f=!0,u=0;do{switch(u){case 1:n.x+=t;break;case 2:n.y+=t;break;case 3:n.x-=t}r=this._map.toMap(n);r=i.contains(r);!1===r&&(f=!1);u+=1}while(3>=u&&!0===f);return r},setDotSize:function(n){0<n&&(this.dotSize=n)},setDotValue:function(n){0<n&&(this.dotValue=n)},setOutline:function(n){this.outline=n},setBackgroundColor:function(n){this.backgroundColor=n},toJson:function(){var n=t.mixin(this.inherited(arguments),{type:"dotDensity",backgroundColor:s.toJsonColor(this.backgroundColor),dotShape:this.dotShape,dotSize:0<this.dotSize?f.px2pt(this.dotSize):0,dotValue:this.dotValue,fields:i.map(this.fields,function(n){return o.fixJson({color:s.toJsonColor(n.color),name:n.name})}),legendOptions:this.legendOptions&&o.fixJson({backgroundColor:s.toJsonColor(this.legendOptions.backgroundColor),dotCoverage:this.legendOptions.dotCoverage,outline:this.legendOptions.outline&&this.legendOptions.outline.toJson(),valueUnit:this.legendOptions.valueUnit}),outline:this.outline&&this.outline.toJson()});return o.fixJson(n)}}),u("extend-esri")&&t.setObject("renderer.DotDensityRenderer",n,e),n})},"esri/renderers/ScaleDependentRenderer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ./Renderer".split(" "),function(n,t,i,r,u,f,e){return n=n(e,{declaredClass:"esri.renderer.ScaleDependentRenderer",constructor:function(n){this.setRendererInfos(n&&n.rendererInfos||[])},setRendererInfos:function(n){return this.rendererInfos=n,this._setRangeType(),this},getSymbol:function(n){var t=this.getRendererInfo(n);return t&&t.renderer&&t.renderer.getSymbol(n)},getRendererInfo:function(n){return n=n.getLayer().getMap(),"zoom"===this.rangeType?this.getRendererInfoByZoom(n.getZoom()):this.getRendererInfoByScale(n.getScale())},getRendererInfoByZoom:function(n){var t,u=this.rendererInfos,i,r=0;do t=u[r],n>=t.minZoom&&n<=t.maxZoom&&(i=t),r++;while(!i&&r<u.length);return i},getRendererInfoByScale:function(n){var t,s=this.rendererInfos,u,f=0,e,o,i,r;do t=s[f],e=t.minScale,o=t.maxScale,i=!e,r=!o,!i&&n<=e&&(i=!0),!r&&n>=o&&(r=!0),i&&r&&(u=t),f++;while(!u&&f<s.length);return u},addRendererInfo:function(n){var r,t=0,u,i=this.rendererInfos,f=n.hasOwnProperty("minZoom")?"minZoom":"minScale",e=i.length;do u=i[t],(e===t||n[f]<u[f])&&(i.splice(t,0,n),this._setRangeType(),r=!0),t++;while(!r&&t<e);return this},_setRangeType:function(){var n=this.rendererInfos;(n=n&&n[0])&&(this.rangeType=n.hasOwnProperty("minZoom")?"zoom":n.hasOwnProperty("minScale")?"scale":"")},toJson:function(){if("zoom"===this.rangeType)return null;var n=this.rendererInfos||[],r=n[0]&&n[0].minScale,n=i.mixin(this.inherited(arguments),{type:"scaleDependent",minScale:0<r?r:0,rendererInfos:t.map(n,function(n){return f.fixJson({maxScale:0<n.maxScale?n.maxScale:0,renderer:n.renderer&&n.renderer.toJson()})})});return f.fixJson(n)}}),r("extend-esri")&&i.setObject("renderer.ScaleDependentRenderer",n,u),n})},"esri/renderers/HeatmapRenderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct ../sniff ../kernel ../lang ../symbols/PictureMarkerSymbol ../Color ./Renderer".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n([h],{declaredClass:"esri.renderer.HeatmapRenderer",colors:null,blurRadius:10,maxPixelIntensity:100,minPixelIntensity:0,field:null,fieldOffset:null,colorStops:null,constructor:function(n){(this._supportsCanvas=window.CanvasRenderingContext2D?!0:!1)?("string"==typeof n&&(n=JSON.parse(n)),t.mixin(this,n),this._canvas=null,this.colors||this.colorStops||(this.colorStops=[{ratio:0,color:"rgba(255, 140, 0, 0)"},{ratio:.75,color:"rgba(255, 140, 0, 1)"},{ratio:.9,color:"rgba(255, 0,   0, 1)"}]),this.gradient=this._generateGradient(this.colorStops||this.colors)):console.log("The HeatmapRenderer requires a Canvas enabled Browser.  IE8 and less does not support Canvas.")},getSymbol:function(n){var t,r,i,f,u;if(!this._supportsCanvas)return!1;if(t=n.attributes.imageData,n=n.attributes.size,!n)return null;if(r=this._getContext(n[0],n[1]),i=r.getImageData(0,0,n[0],n[1]),window.ArrayBuffer&&t instanceof ArrayBuffer?t=window.Uint8ClampedArray?new Uint8ClampedArray(t):new Uint8Array(t):t.BYTES_PER_ELEMENT&&1!==t.BYTES_PER_ELEMENT&&(t=window.Uint8ClampedArray?new Uint8ClampedArray(t.buffer):new Uint8Array(t.buffer)),window.CanvasPixelArray&&i.data instanceof window.CanvasPixelArray)for(f=i.data,u=f.length;u--;)f[u]=t[u];else i.data.set(t);return r.putImageData(i,0,0),new o(r.canvas.toDataURL(),n[0],n[1])},setColors:function(n){return n&&(n instanceof Array||n.colors)&&(this.gradient=this._generateGradient(n.colors||n),this.colors=n),this},setColorStops:function(n){return n&&(n instanceof Array||n.colorStops)&&(this.gradient=this._generateGradient(n.colorStops||n),this.colorStops=n),this},setMaxPixelIntensity:function(n){return this.maxPixelIntensity=n,this},setMinPixelIntensity:function(n){return this.minPixelIntensity=n,this},setField:function(n){return this.field=n,this},setFieldOffset:function(n){return this.fieldOffset=n,this},setBlurRadius:function(n){return this.blurRadius=n,this},getStats:function(){},getHistogramData:function(){},toJson:function(){var n=t.mixin(this.inherited(arguments),{type:"heatmap",blurRadius:this.blurRadius,colorStops:this._colorsToStops(this.colorStops||this.colors),maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity,field:this.field});return null!=this.fieldOffset&&(n.fieldOffset=this.fieldOffset),i.forEach(n.colorStops,function(n){n.color=s.toJsonColor(n.color)}),e.fixJson(n)},_getContext:function(n,t){return this._canvas?(this._canvas.width=n,this._canvas.height=t):this._canvas=this._initCanvas(n,t),this._canvas.getContext("2d")},_initCanvas:function(n,t){var i=r.create("canvas",{id:"hm_canvas-"+Math.floor(1e3*Math.random()),style:"position: absolute; left: 0px; top: -10000px;"},null);return i.width=n,i.height=t,document.body.appendChild(i),i},_generateGradient:function(n,t){t||(t=512);for(var f=this._colorsToStops(n),i=this._getContext(1,t||512),e=i.createLinearGradient(0,0,0,t),r=0,u;r<f.length;r++)u=f[r],e.addColorStop(u.ratio,u.color.toCss(!0));return i.fillStyle=e,i.fillRect(0,0,1,t),i.getImageData(0,0,1,t).data},_colorsToStops:function(n){var t=[],u,o;if(!n[0])return t;if(null!=n[0].ratio)t=i.map(n,function(n){return{ratio:n.ratio,color:this._toColor(n.color)}},this);else if(null!=n[0].value){for(var r=Infinity,t=-Infinity,e=0,f=0;f<n.length;f++)u=n[f].value,u<r&&(r=u),u>t&&(t=u);e=t-r;this.maxPixelIntensity=t;this.minPixelIntensity=r;t=i.map(n,function(n){var t=n.value;return n=this._toColor(n.color),{value:t,ratio:(t-r)/e,color:n}},this)}else o=n.length-1,t=i.map(n,function(n,t){return{color:this._toColor(n),ratio:t/o}},this);return t},_toColor:function(n){return n.toRgba||n.declaredClass||(n=new s(n)),n}}),u("extend-esri")&&t.setObject("renderer.HeatmapRenderer",n,f),n})},"esri/utils":function(){define("./domUtils ./lang ./urlUtils ./request ./tileUtils ./graphicsUtils ./deferredUtils ./layerUtils ./geometry/normalizeUtils".split(" "),function(){return{}})},"esri/graphicsUtils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","./kernel","./geometry/Extent"],function(n,t,i,r,u){var f={graphicsExtent:function(n){if(!n||!n.length)return null;var t=n[0].geometry,i=t.getExtent(),r,f,e=n.length;for(null===i&&(i=new u(t.x,t.y,t.x,t.y,t.spatialReference)),f=1;f<e;f++)r=(t=n[f].geometry).getExtent(),null===r&&(r=new u(t.x,t.y,t.x,t.y,t.spatialReference)),i=i.union(r);return 0>i.getWidth()&&0>i.getHeight()?null:i},getGeometries:function(n){return t.map(n,function(n){return n.geometry})},_encodeGraphics:function(n,i){var e=[],r,u,f;return t.forEach(n,function(n,t){r=n.toJson();u={};r.geometry&&(f=i&&i[t],u.geometry=f&&f.toJson()||r.geometry);r.attributes&&(u.attributes=r.attributes);e[t]=u}),e}};return i("extend-esri")&&n.mixin(r,f),f})},"esri/layers/graphics":function(){define(["./GraphicsLayer","../graphic","../renderer"],function(){return{}})},"esri/layers/agstiled":function(){define(["./agscommon","./ArcGISTiledMapServiceLayer"],function(){return{}})},"esri/layers/agscommon":function(){define("./ArcGISMapServiceLayer ./LayerInfo ./TimeInfo ./LayerTimeOptions ./TimeReference ./Field ./Domain ./RangeDomain ./CodedValueDomain ./InheritedDomain ./LayerSource ./LayerMapSource ./LayerDataSource ./DataSource ./TableDataSource ./QueryDataSource ./JoinDataSource ./RasterDataSource ./DynamicLayerInfo ./LayerDrawingOptions ../geometry ../utils".split(" "),function(){return{}})},"esri/layers/Field":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ./RangeDomain ./CodedValueDomain".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.layers.Field",constructor:function(n){if(n&&t.isObject(n)&&(this.name=n.name,this.type=n.type,this.alias=n.alias,this.length=n.length,this.editable=n.editable,this.nullable=n.nullable,(n=n.domain)&&t.isObject(n)))switch(n.type){case"range":this.domain=new u(n);break;case"codedValue":this.domain=new f(n)}}}),i("extend-esri")&&t.setObject("layers.Field",n,r),n})},"esri/layers/RangeDomain":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./Domain".split(" "),function(n,t,i,r,u,f){return n=n([f],{declaredClass:"esri.layers.RangeDomain",constructor:function(n){n&&t.isObject(n)&&(this.minValue=n.range[0],this.maxValue=n.range[1])},toJson:function(){var n=this.inherited(arguments);return n.range=[this.minValue,this.maxValue],u.fixJson(n)}}),i("extend-esri")&&t.setObject("layers.RangeDomain",n,r),n})},"esri/layers/Domain":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.Domain",constructor:function(n){n&&t.isObject(n)&&(this.name=n.name,this.type=n.type)},toJson:function(){return u.fixJson({name:this.name,type:this.type})}}),i("extend-esri")&&t.setObject("layers.Domain",n,r),n})},"esri/layers/CodedValueDomain":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ./Domain".split(" "),function(n,t,i,r,u,f,e){return n=n([e],{declaredClass:"esri.layers.CodedValueDomain",constructor:function(n){n&&t.isObject(n)&&(this.codedValues=n.codedValues)},getName:function(n){var t;return i.some(this.codedValues,function(i){return i.code==n&&(t=i.name),!!t}),t},toJson:function(){var n=this.inherited(arguments);return n.codedValues=t.clone(this.codedValues),f.fixJson(n)}}),r("extend-esri")&&t.setObject("layers.CodedValueDomain",n,u),n})},"esri/layers/InheritedDomain":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./Domain"],function(n,t,i,r,u){return n=n([u],{declaredClass:"esri.layers.InheritedDomain"}),i("extend-esri")&&t.setObject("layers.InheritedDomain",n,r),n})},"esri/layers/LayerSource":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.layers.LayerSource",type:null,constructor:function(n){n&&t.mixin(this,n)},toJson:function(){}}),i("extend-esri")&&t.setObject("layers.LayerSource",n,r),n})},"esri/layers/LayerMapSource":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./LayerSource".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.layers.LayerMapSource",type:"mapLayer",toJson:function(){return u.fixJson({type:"mapLayer",mapLayerId:this.mapLayerId,gdbVersion:this.gdbVersion})}}),i("extend-esri")&&t.setObject("layers.LayerMapSource",n,r),n})},"esri/layers/LayerDataSource":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./LayerSource ./TableDataSource ./QueryDataSource ./JoinDataSource ./RasterDataSource".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n(f,{declaredClass:"esri.layers.LayerDataSource",type:"dataLayer",constructor:function(n){if(n&&n.dataSource){switch(n.dataSource.type){case"table":n=new e(n.dataSource);break;case"queryTable":n=new o(n.dataSource);break;case"joinTable":n=new s(n.dataSource);break;case"raster":n=new h(n.dataSource);break;default:n=n.dataSource}this.dataSource=n}},toJson:function(){var n={type:"dataLayer",dataSource:this.dataSource&&this.dataSource.toJson()};return u.fixJson(n)}}),i("extend-esri")&&t.setObject("layers.LayerDataSource",n,r),n})},"esri/layers/TableDataSource":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./DataSource".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.layers.TableDataSource",toJson:function(){return u.fixJson({type:"table",workspaceId:this.workspaceId,dataSourceName:this.dataSourceName,gdbVersion:this.gdbVersion})}}),i("extend-esri")&&t.setObject("layers.TableDataSource",n,r),n})},"esri/layers/DataSource":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.layers.DataSource",constructor:function(n){n&&t.mixin(this,n)},toJson:function(){}}),i("extend-esri")&&t.setObject("layers.DataSource",n,r),n})},"esri/layers/QueryDataSource":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./DataSource ../SpatialReference".split(" "),function(n,t,i,r,u,f,e){return n=n(f,{declaredClass:"esri.layers.QueryDataSource",constructor:function(n){n&&(n.oidFields&&t.isString(n.oidFields)&&(this.oidFields=n.oidFields.split(",")),n.spatialReference&&(this.spatialReference=new e(n.spatialReference)))},toJson:function(){var n={type:"queryTable",workspaceId:this.workspaceId,query:this.query,oidFields:this.oidFields&&this.oidFields.join(),spatialReference:this.spatialReference&&this.spatialReference.toJson()},t;return this.geometryType&&(t="point"===this.geometryType.toLowerCase()?"esriGeometryPoint":"multipoint"===this.geometryType.toLowerCase()?"esriGeometryMultipoint":"polyline"===this.geometryType.toLowerCase()?"esriGeometryPolyline":"polygon"===this.geometryType.toLowerCase()?"esriGeometryPolygon":this.geometryType,n.geometryType=t),u.fixJson(n)}}),i("extend-esri")&&t.setObject("layers.QueryDataSource",n,r),n})},"esri/layers/JoinDataSource":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./DataSource ./LayerMapSource ./TableDataSource ./QueryDataSource ./RasterDataSource".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c=n(f,{declaredClass:"esri.layers.JoinDataSource",constructor:function(n){n&&(n.leftTableSource&&(this.leftTableSource=this._createLayerSource(n.leftTableSource)),n.rightTableSource&&(this.rightTableSource=this._createLayerSource(n.rightTableSource)))},_createLayerSource:function(n){var i,t;if("mapLayer"===n.type)i=new e(n);else{i={type:"dataLayer"};switch(n.dataSource.type){case"table":t=new o(n.dataSource);break;case"queryTable":t=new s(n.dataSource);break;case"joinTable":t=new c(n.dataSource);break;case"raster":t=new h(n.dataSource);break;default:t=n.dataSource}i.dataSource=t;i.toJson=function(){var n={type:"dataLayer",dataSource:t.toJson()};return u.fixJson(n)}}return i},toJson:function(){var n={type:"joinTable",leftTableSource:this.leftTableSource&&this.leftTableSource.toJson(),rightTableSource:this.rightTableSource&&this.rightTableSource.toJson(),leftTableKey:this.leftTableKey,rightTableKey:this.rightTableKey},t;return t="left-outer-join"===this.joinType.toLowerCase()?"esriLeftOuterJoin":"left-inner-join"===this.joinType.toLowerCase()?"esriLeftInnerJoin":this.joinType,n.joinType=t,u.fixJson(n)}});return i("extend-esri")&&t.setObject("layers.JoinDataSource",c,r),c})},"esri/layers/RasterDataSource":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./DataSource".split(" "),function(n,t,i,r,u,f){return n=n(f,{declaredClass:"esri.layers.RasterDataSource",toJson:function(){return u.fixJson({type:"raster",workspaceId:this.workspaceId,dataSourceName:this.dataSourceName})}}),i("extend-esri")&&t.setObject("layers.RasterDataSource",n,r),n})},"esri/layers/DynamicLayerInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./LayerInfo ./LayerMapSource ./LayerDataSource".split(" "),function(n,t,i,r,u,f,e,o){return n=n(f,{declaredClass:"esri.layers.DynamicLayerInfo",defaultVisibility:!0,parentLayerId:-1,maxScale:0,minScale:0,constructor:function(n){n&&(n.source?n="mapLayer"===n.source.type?new e(n.source):new o(n.source):(n=new e,n.mapLayerId=this.id),this.source=n)},toJson:function(){var n=this.inherited(arguments);return n.source=this.source&&this.source.toJson(),u.fixJson(n)}}),i("extend-esri")&&t.setObject("layers.DynamicLayerInfo",n,r),n})},"esri/layers/LayerDrawingOptions":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../renderers/jsonUtils ./LabelClass".split(" "),function(n,t,i,r,u,f,e,o){return n=n(null,{declaredClass:"esri.layers.LayerDrawingOptions",constructor:function(n){if(n&&(t.mixin(this,n),n.renderer&&(this.renderer=e.fromJson(n.renderer)),n.labelingInfo&&0<n.labelingInfo.length)){this.labelingInfo=[];var r;i.forEach(n.labelingInfo,function(n){r=new o(n);this.labelingInfo.push(r)},this)}},toJson:function(){var n={renderer:this.renderer&&this.renderer.toJson(),transparency:this.transparency,scaleSymbols:this.scaleSymbols,showLabels:this.showLabels};return this.labelingInfo&&0<this.labelingInfo.length&&(n.labelingInfo=[],i.forEach(this.labelingInfo,function(t){n.labelingInfo.push(t.toJson())})),f.fixJson(n)}}),r("extend-esri")&&t.setObject("layers.LayerDrawingOptions",n,u),n})},"esri/layers/LabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojox/gfx/_base ../kernel ../lang ../symbols/TextSymbol ../symbols/ShieldLabelSymbol".split(" "),function(n,t,i,r,u,f,e,o){var c=RegExp("__begin__","ig"),l=RegExp("__end__","ig"),s=/^__begin__/i,h=/__end__$/i;return n=n(null,{declaredClass:"esri.layers.LabelClass",labelPlacement:null,labelExpression:null,format:null,fieldInfos:null,useCodedValues:null,symbol:null,maxScale:0,minScale:0,where:null,sizeInfo:null,_labelPlacementLookup:{"above-center":"esriServerPointLabelPlacementAboveCenter","above-left":"esriServerPointLabelPlacementAboveLeft","above-right":"esriServerPointLabelPlacementAboveRight","below-center":"esriServerPointLabelPlacementBelowCenter","below-left":"esriServerPointLabelPlacementBelowLeft","below-right":"esriServerPointLabelPlacementBelowRight","center-center":"esriServerPointLabelPlacementCenterCenter","center-left":"esriServerPointLabelPlacementCenterLeft","center-right":"esriServerPointLabelPlacementCenterRight","above-after":"esriServerLinePlacementAboveAfter","above-along":"esriServerLinePlacementAboveAlong","above-before":"esriServerLinePlacementAboveBefore","above-start":"esriServerLinePlacementAboveStart","above-end":"esriServerLinePlacementAboveEnd","below-after":"esriServerLinePlacementBelowAfter","below-along":"esriServerLinePlacementBelowAlong","below-before":"esriServerLinePlacementBelowBefore","below-start":"esriServerLinePlacementBelowStart","below-end":"esriServerLinePlacementBelowEnd","center-after":"esriServerLinePlacementCenterAfter","center-along":"esriServerLinePlacementCenterAlong","center-before":"esriServerLinePlacementCenterBefore","center-start":"esriServerLinePlacementCenterStart","center-end":"esriServerLinePlacementCenterEnd","always-horizontal":"esriServerPolygonPlacementAlwaysHorizontal"},constructor:function(n){n&&(t.mixin(this,n),this._labelPlacementLookup.hasOwnProperty(this.labelPlacement)||(this.labelPlacement=f.valueOf(this._labelPlacementLookup,n.labelPlacement)),n.format&&(this.format=n.format),n.fieldInfos&&(this.fieldInfos=n.fieldInfos),n.symbol&&(this.symbol="esriSHD"===n.symbol.type?new o(n.symbol):new e(n.symbol)),n=this.sizeInfo)&&(n.minSize&&(n.minSize=r.pt2px(n.minSize)),n.maxSize&&(n.maxSize=r.pt2px(n.maxSize)))},getSymbol:function(){return this.symbol},toJson:function(){var n=this.sizeInfo,i;return n&&(n=t.mixin({},n),n.minSize&&(n.minSize=r.px2pt(n.minSize)),n.maxSize&&(n.maxSize=r.px2pt(n.maxSize))),i=f.fixJson(this.labelExpressionInfo&&t.clone(this.labelExpressionInfo)),this._processLabelExpressionInfo(i),n={name:this.name,labelExpression:this.labelExpression,labelExpressionInfo:i,format:this.format||void 0,fieldInfos:this.fieldInfos||void 0,useCodedValues:this.useCodedValues,maxScale:this.maxScale,minScale:this.minScale,where:this.where,sizeInfo:n||void 0,labelPlacement:this._labelPlacementLookup.hasOwnProperty(this.labelPlacement)?this._labelPlacementLookup[this.labelPlacement]:this.labelPlacement,symbol:this.symbol&&this.symbol.toJson()},f.fixJson(n)},_processLabelExpressionInfo:function(n){n&&n.value&&(n.expression=this._convertTemplatedStringToArcade(n.value))},_convertTemplatedStringToArcade:function(n){var i;return n&&(i=t.replace(n,function(n,t){return'__begin__$feature["'+t+'"]__end__'}),i=s.test(i)?i.replace(s,""):'"'+i,i=h.test(i)?i.replace(h,""):i+'"',i=i.replace(c,'" + ').replace(l,' + "')),i}}),i("extend-esri")&&t.setObject("layers.LabelClass",n,u),n})},"esri/symbols/ShieldLabelSymbol":function(){define("dojo/_base/declare dojo/_base/lang dojo/sniff dojox/gfx/_base ../kernel ../lang ../urlUtils ./MarkerSymbol ./Font".split(" "),function(n,t,i,r,u,f,e,o,s){var h={url:"",width:12,height:12,angle:0,xoffset:0,yoffset:0};return n=n(o,{declaredClass:"esri.symbol.ShieldLabelSymbol",type:"shieldlabelsymbol",color:[255,255,255,1],width:32,height:32,font:r.defaultFont,constructor:function(n,u,f,e,o){n?t.isString(n)?(this.url=n,u&&(this.color=u),f&&(this.width=f),e&&(this.height=e),void 0!==o&&(this.font=o)):(this.width=r.pt2px(n.width),this.height=r.pt2px(n.height),u=n.imageData,9>i("ie")||!u||(f=this.url,this.url="data:"+(n.contentType||"image")+";base64,"+u,this.imageData=f)):t.mixin(this,h)},getStroke:function(){return null},getFill:function(){return this.color},setWidth:function(n){return this.width=n,this},setHeight:function(n){return this.height=n,this},setUrl:function(n){return n!==this.url&&(delete this.imageData,delete this.contentType),this.url=n,this},setFont:function(n){return this.font=n,this},setText:function(n){return this.text=n,this},getWidth:function(){return this.width},getHeight:function(){return this.height},getShapeDescriptors:function(){return{defaultShape:{type:"image",x:-Math.round(this.width/2),y:-Math.round(this.height/2),width:this.width,height:this.height,src:this.url||""},fill:null,stroke:null}},toJson:function(){var n=this.url,i=this.imageData;if(0===n.indexOf("data:"))var u=n,n=i,i=u.indexOf(";base64,")+8,i=u.substr(i);var n=e.getAbsoluteUrl(n),u=r.px2pt(this.width),u=isNaN(u)?void 0:u,o=r.px2pt(this.height),o=isNaN(o)?void 0:o,n=f.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriSHD",url:n,imageData:i,contentType:this.contentType,width:u,height:o}));return this.font?(i=new s(this.font),n.font=i.toJson()):n.font=null,delete n.size,n.imageData||delete n.imageData,n}}),n.defaultProps=h,i("extend-esri")&&(t.setObject("symbol.ShieldLabelSymbol",n,u),u.symbol.defaultShieldLabelSymbol=h),n})},"esri/layers/agsdynamic":function(){define(["./agscommon","./ArcGISDynamicMapServiceLayer","../_time"],function(){return{}})},"esri/layers/ArcGISDynamicMapServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/sniff dojo/io-query ../kernel ../config ../request ../urlUtils ../layerUtils ../geometry/scaleUtils ./DynamicMapServiceLayer ./ArcGISMapServiceLayer ./TimeInfo ./LayerTimeOptions ./ImageParameters ./DynamicLayerInfo ./LayerMapSource".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){return n=n([a,v],{declaredClass:"esri.layers.ArcGISDynamicMapServiceLayer",_eventMap:{"visible-layers-change":["visibleLayers"]},constructor:function(n,i,r){var f,u;n=i&&i.imageParameters;f=t.hitch;n&&(u=n.layerDefinitions,u&&this.setLayerDefinitions(u),n.layerOption===w.LAYER_OPTION_SHOW&&(this.visibleLayers=[].concat(n.layerIds),this.onVisibleLayersChange(this.visibleLayers)));this._setIsPNG32=f(this,this._setIsPNG32);this.dpi=n&&n.dpi||96;this.imageFormat=n&&n.format||"png8";this.imageTransparency=n&&!1===n.transparent?!1:!0;this._setIsPNG32();this.gdbVersion=i&&i.gdbVersion;this._params.gdbVersion=this.gdbVersion;u=n&&n.layerDefinitions;t.mixin(this._params,this._url.query,{dpi:this.dpi,transparent:this.imageTransparency,format:this.imageFormat},n?n.toJson():{});u&&(this._params.layerDefs=u);this.getImageUrl=f(this,this.getImageUrl);this._initLayer=f(this,this._initLayer);this._load=f(this,this._load);this.useMapImage=i?i.useMapImage:!1;this._loadCallback=i&&i.loadCallback;(i=i&&i.resourceInfo)?this._initLayer(i):void 0!==r&&!1!==r||this._load();this.registerConnectEvents()},disableClientCaching:!1,layerDefinitions:null,_initLayer:function(n){this.inherited(arguments);n.timeInfo&&(this.timeInfo=new y(n.timeInfo));this.loaded=!0;this.onLoad(this);var t=this._loadCallback;t&&(delete this._loadCallback,t(this))},getImageUrl:function(n,i,u,e){var v=this._url.path+"/export?",l=this._params,a=l.token=this._getToken(),y=n.spatialReference.wkid||r.toJson(n.spatialReference.toJson()),p=this._errorHandler;delete l._ts;t.mixin(l,{bbox:n.xmin+","+n.ymin+","+n.xmax+","+n.ymax,bboxSR:y,imageSR:y,size:i+","+u},this.disableClientCaching?{_ts:(new Date).getTime()}:{});l.layerDefs&&(n=c._serializeLayerDefinitions(l.layerDefs,10.5<=this.version),l=t.mixin({},l),delete l.layerDefs,l.layerDefs=n);n=h.addProxy(v+f.objectToQuery(t.mixin({},l,{f:"image"})));n.length>o.defaults.io.postLength||this.useMapImage?this._jsonRequest=s({url:v,content:t.mixin(l,{f:"json"}),callbackParamName:"callback",load:function(n){n=n.href;a&&(n+=-1===n.indexOf("?")?"?token="+a:"&token="+a);e(h.addProxy(n))},error:p}):e(n)},_setIsPNG32:function(){var n=this.imageFormat.toLowerCase(),t=u("ie");this.isPNG32=t&&6===t&&("png32"===n||"png24"===n)&&this.imageTransparency},_setTime:function(n){var r=this.timeInfo,u;if(n=this._params.time=n?n.toJson().join(","):null,10.02>this.version&&r)if(n)this._params.layerTimeOptions=c._serializeTimeOptions(this.layerTimeOptions);else if(u=this.layerInfos,u){var e=this.layerTimeOptions,f=e?e.slice(0):[],t=[];i.forEach(u,function(n){n.subLayerIds||t.push(n.id)});t.length&&(i.forEach(t,function(n){if(!f[n]){var t=new p;t.useTime=!1;f[n]=t}}),this._params.layerTimeOptions=c._serializeTimeOptions(f,t))}10.02<=this.version&&r&&!n&&!r.hasLiveData&&(this._params.time="null,null")},setDPI:function(n,t){this.dpi=this._params.dpi=n;t||this.refresh(!0)},setImageFormat:function(n,t){this.imageFormat=this._params.format=n;this._setIsPNG32();t||this.refresh(!0)},setImageTransparency:function(n,t){this.imageTransparency=this._params.transparent=n;this._setIsPNG32();t||this.refresh(!0)},setVisibleLayers:function(n,t){this.visibleLayers=n;this._params.layers=w.LAYER_OPTION_SHOW+":"+(n.length?n.join():"-1");this._updateDynamicLayers();t||this.refresh(!0);this.onVisibleLayersChange(this.visibleLayers)},onVisibleLayersChange:function(){},setDefaultVisibleLayers:function(n){this.visibleLayers=this._defaultVisibleLayers;this._params.layers=null;this._updateDynamicLayers();n||this.refresh(!0);this.onVisibleLayersChange(this.visibleLayers)},setLayerDefinitions:function(n,t){this.layerDefinitions=n;this._params.layerDefs=n;this._updateDynamicLayers();t||this.refresh(!0)},setDefaultLayerDefinitions:function(n){this.layerDefinitions=this._params.layerDefs=null;this._updateDynamicLayers();n||this.refresh(!0)},setDisableClientCaching:function(n){this.disableClientCaching=n},setLayerTimeOptions:function(n,t){this.layerTimeOptions=n;this._params.layerTimeOptions=c._serializeTimeOptions(n);this._updateDynamicLayers();t||this.refresh(!0)},refresh:function(n){if(n)this.inherited(arguments);else{var t=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=t}},setLayerDrawingOptions:function(n,t){this.layerDrawingOptions=n;this._updateDynamicLayers();t||this.refresh(!0)},setDynamicLayerInfos:function(n,t){n&&0<n.length?(this.dynamicLayerInfos=n,this.visibleLayers=c._getDefaultVisibleLayers(n),this.onVisibleLayersChange(this.visibleLayers)):this.dynamicLayerInfos=this.layerDrawingOptions=null;this._updateDynamicLayers();t||this.refresh(!0)},createDynamicLayerInfosFromLayerInfos:function(){var t=[],n;return i.forEach(this.layerInfos,function(i){n=new b(i.toJson());n.source=new k({mapLayerId:i.id});t.push(n)}),t},_onDynamicLayersChange:function(){},_updateDynamicLayers:function(){var n;if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length||this.layerDrawingOptions&&0<this.layerDrawingOptions.length){this.dynamicLayerInfos&&0!==this.dynamicLayerInfos.length||(this.dynamicLayerInfos=this.createDynamicLayerInfosFromLayerInfos());n=this.dynamicLayerInfos;var t=[],u=this._map&&l.getScale(this._map),f=this.visibleLayers,e=u?c._getLayersForScale(u,n):f;i.forEach(n,function(n){var u,r,o,s,h;n.subLayerIds||(r=n.id,-1!==i.indexOf(f,r)&&-1!==i.indexOf(e,r)&&(u={id:r,name:n.name},u.source=n.source&&n.source.toJson(),this.layerDefinitions&&this.layerDefinitions[r]&&(o=this.layerDefinitions[r]),o&&(u.definitionExpression=o),this.layerDrawingOptions&&this.layerDrawingOptions[r]&&(s=this.layerDrawingOptions[r]),s&&(u.drawingInfo=s.toJson()),this.layerTimeOptions&&this.layerTimeOptions[r]&&(h=this.layerTimeOptions[r]),h&&(u.layerTimeOptions=h.toJson()),u.minScale=n.minScale||0,u.maxScale=n.maxScale||0,t.push(u)))},this);n=r.toJson(t);this._params.dynamicLayers&&this._params.dynamicLayers.length===n.length&&this._params.dynamicLayers===n||(this._params.dynamicLayers=n,this._onDynamicLayersChange(this._params.dynamicLayers))}else this._params.dynamicLayers?(this._params.dynamicLayers=null,this._onDynamicLayersChange(null)):this._params.dynamicLayers=null},_onExtentChangeHandler:function(n,t,i){i&&this._updateDynamicLayers();this.inherited(arguments)},_setMap:function(n){return this._map=n,this._updateDynamicLayers(),this.inherited(arguments)},onGDBVersionChange:function(){},setGDBVersion:function(n,t){this.gdbVersion=n;this._params.gdbVersion=n;this.onGDBVersionChange();t||this.refresh(!0)},exportMapImage:function(n,i){var r=t.hitch(this,function(){var r=o.defaults.map,u=n&&n.layerDefinitions;n=n?n.toJson(this.normalization):{};u&&(n.layerDefs=u);n=t.mixin({size:r.width+","+r.height},this._params,n,{f:"json"});delete n._ts;n.layerDefs&&(r=c._serializeLayerDefinitions(n.layerDefs,10.5<=this.version),delete n.layerDefs,n.layerDefs=r);this._exportMapImage(this._url.path+"/export",n,i)});if(this.loaded)r();else this.on("load",r)}}),u("extend-esri")&&t.setObject("layers.ArcGISDynamicMapServiceLayer",n,e),n})},"esri/layers/DynamicMapServiceLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../sniff ../request ../domUtils ./layer ./MapImage".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=o.defaults.map.zoomDuration;return n=n(l,{declaredClass:"esri.layers.DynamicMapServiceLayer",_eventMap:{"map-image-export":["mapImage"]},constructor:function(n,t){this.useMapTime=t&&t.hasOwnProperty("useMapTime")?!!t.useMapTime:!0;this.extentProcessor=t&&t.extentProcessor;var r=i.hitch;this._exportMapImageHandler=r(this,this._exportMapImageHandler);this._imgSrcFunc=r(this,this._imgSrcFunc);this._divAlphaImageFunc=r(this,this._divAlphaImageFunc);this._tileLoadHandler=r(this,this._tileLoadHandler);this._tileErrorHandler=r(this,this._tileErrorHandler);this.registerConnectEvents()},opacity:1,isPNG32:!1,_setMap:function(n,i){var c;this.inherited(arguments);this._map=n;var o=this._div=r.create("div",null,i),a=e._css.names,f={position:"absolute",width:n.width+"px",height:n.height+"px",overflow:"visible",opacity:this.opacity},v=s("ie"),l=t.connect,h=n.__visibleDelta;return 8===v&&delete f.opacity,"css-transforms"===n.navigationMode?(this._isChildLayer||(f[a.transform]=e._css.translate(h.x,h.y),u.set(o,f)),this._left=h.x,this._top=h.y):(f.left="0px",f.top="0px",u.set(o,f),this._left=this._top=0),u.set(o,f),this._onResizeHandler_connect=l(n,"onResize",this,"_onResizeHandler"),this._opacityChangeHandler_connect=l(this,"onOpacityChange",this,"_opacityChangeHandler"),this._img_loading=null,this._dragOrigin={x:0,y:0},this.evaluateSuspension(),this.suspended&&!n.loaded&&(c=t.connect(n,"onLoad",this,function(){t.disconnect(c);c=null;this.evaluateSuspension()})),this.extentProcessor&&(this._panEndEvalHandle=t.connect(n,"onPanEnd",this,this.evaluateSuspension),this._zoomEndEvalHandle=t.connect(n,"onZoomEnd",this,this.evaluateSuspension)),o},_unsetMap:function(){this._img&&this._clearEventListeners(this._img);this._img_loading&&this._clearEventListeners(this._img_loading);r.destroy(this._div);this._map=this._div=this._img=this._img_loading=null;var n=t.disconnect;n(this._onResizeHandler_connect);n(this._opacityChangeHandler_connect);n(this._panEndEvalHandle);n(this._zoomEndEvalHandle);this._panEndEvalHandle=this._zoomEndEvalHandle=this._onResizeHandler_connect=this._opacityChangeHandler_connect=null;this._fireUpdateEnd();this._toggleTime();clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors();this.inherited(arguments)},_onResizeHandler:function(n,t,i){u.set(this._div,{width:t+"px",height:i+"px"});this._onExtentChangeHandler(n)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();c.hide(this._div);clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors()},onResume:function(){this.inherited(arguments);var n=this._map;this._toggleTime();"css-transforms"===n.navigationMode&&(n=n.__visibleDelta,this._left=n.x,this._top=n.y,this._isChildLayer||u.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top)));this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(i.hitch(this,function(){this.suspended||this._onExtentChangeHandler(this._map.extent,null,!0)}),0)},canResume:function(){var n=this.inherited(arguments),t;return n&&(t=this._map.extent,this.extentProcessor&&t&&(n=!!this.extentProcessor({layer:this,extent:t,width:this._map.width}).extent)),n},_enableDrawConnectors:function(){var i=t.connect,n=this._map;n&&(this._onPanHandler_connect=i(n,"onPan",this,"_onPanHandler"),this._onExtentChangeHandler_connect=i(n,"onExtentChange",this,"_onExtentChangeHandler"),"css-transforms"===n.navigationMode?this._onScaleHandler_connect=i(n,"onScale",this,this._onScaleHandler):this._onZoomHandler_connect=i(n,"onZoom",this,"_onZoomHandler"))},_disableDrawConnectors:function(){var n=t.disconnect;n(this._onPanHandler_connect);n(this._onExtentChangeHandler_connect);n(this._onZoomHandler_connect);n(this._onScaleHandler_connect);this._onPanHandler_connect=this._onExtentChangeHandler_connect=this._onZoomHandler_connect=this._onScaleHandler_connect=null},_toggleTime:function(){var n=this._map;this.timeInfo&&this.useMapTime&&n&&!this.suspended?(this._timeConnect||(this._timeConnect=t.connect(n,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(n.timeExtent)):(t.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},_setTime:function(n){this._params&&(this._params.time=n?n.toJson().join(","):null)},_onPanHandler:function(n,t){this._panDx=t.x;this._panDy=t.y;var i=this._dragOrigin,r=this._map.__visibleDelta,f=this._img;f&&("css-transforms"===this._map.navigationMode?(this._left=r.x+t.x,this._top=r.y+t.y,this._isChildLayer||u.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top))):u.set(f,{left:i.x+t.x+"px",top:i.y+t.y+"px"}))},_onExtentChangeHandler:function(n,i,o){var k,l;if(!this.suspended){clearTimeout(this._wakeTimer);this._wakeTimer=null;var c=this._map,h=this._img,y=h&&h.style,p=this._dragOrigin;if(i&&!o&&h&&(i.x!==this._panDx||i.y!==this._panDy)&&("css-transforms"===c.navigationMode?(i=c.__visibleDelta,this._left=i.x,this._top=i.y,this._isChildLayer||u.set(this._div,e._css.names.transform,e._css.translate(this._left,this._top))):u.set(h,{left:p.x+i.x+"px",top:p.y+i.y+"px"})),h?(p.x=parseInt(y.left,10),p.y=parseInt(y.top,10)):p.x=p.y=0,"css-transforms"===c.navigationMode&&o&&h&&(u.set(h,e._css.names.transition,"none"),h._multiply=h._multiply?f.multiply(h._matrix,h._multiply):h._matrix),this._fireUpdateStart(),(o=this._img_loading)&&(this._clearEventListeners(o),r.destroy(o),this._img_loading=null,o=this._jsonRequest)){try{o.cancel()}catch(g){}this._jsonRequest=null}if(k=c.width,o=c.height,i=k,l=0,10<=this.version&&c.wrapAround180&&(n=n._normalize(!0)),this.extentProcessor&&(l=this.extentProcessor({layer:this,extent:n,width:i}),n=l.extent,i=l.width,l=l.marginLeft||0),this.isPNG32)h=this._img_loading=r.create("div"),h.id=c.id+"_"+this.id+"_"+(new Date).getTime(),u.set(h,{position:"absolute",left:"0px",top:"0px",width:i+"px",height:o+"px"}),c=h.appendChild(r.create("div")),u.set(c,{opacity:0,width:i+"px",height:o+"px"}),this.getImageUrl(n,i,o,this._divAlphaImageFunc),h=null;else{var a=this._img_loading=r.create("img"),b=e._css.names,d=s("ie"),w={position:"absolute",width:i+"px",height:o+"px"};8===d&&(w.opacity=this.opacity);null!=l&&0!==l&&(w.marginLeft=l+"px");"css-transforms"===c.navigationMode?(w[b.transform]=e._css.translate(-this._left,-this._top),a._tdx=-this._left,a._tdy=-this._top,w[b.transition]=b.transformName+" "+v+"ms ease",this.extentProcessor&&(w[b.origin]=k/2-l+"px "+o/2+"px")):(w.left="0px",w.top="0px");a.id=c.id+"_"+this.id+"_"+(new Date).getTime();u.set(a,w);a._onload_connect=t.connect(a,"onload",this,"_onLoadHandler");a._onerror_connect=t.connect(a,"onerror",this,"_onErrorHandler");a._onabort_connect=t.connect(a,"onabort",this,"_onErrorHandler");this._startRect={left:p.x,top:p.y,width:h?parseInt(y.width,10):i,height:h?parseInt(y.height,10):o,marginLeft:h?parseInt(y.marginLeft||"0",10):l,zoom:y&&y.zoom?parseFloat(y.zoom):1};this.getImageUrl(n,i,o,this._imgSrcFunc);a=null}}},_onTimeExtentChangeHandler:function(n){this.suspended||(this._setTime(n),this.refresh(!0))},getImageUrl:function(){},_imgSrcFunc:function(n){this._img_loading.src=n},_divAlphaImageFunc:function(n){u.set(this._img_loading,"filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+n+"', sizingMethod='scale')");this._onLoadHandler({currentTarget:this._img_loading})},_onLoadHandler:function(n){n=n.currentTarget;var t=this._map;this._clearEventListeners(n);!t||t.__panning||t.__zooming?r.destroy(n):(this._img&&this._div.removeChild(this._img),this._img=n,t=n.style,this._startRect={left:0,top:0,width:parseInt(t.width,10),height:parseInt(t.height,10),marginLeft:parseInt(t.marginLeft||"0",10),zoom:1},this._div.appendChild(n),this.suspended||c.show(this._div),this._img_loading=null,n=this._dragOrigin,n.x=n.y=0,this.onUpdate());this._fireUpdateEnd()},_onErrorHandler:function(n){n=n.currentTarget;u.set(n,"visibility","hidden");this._clearEventListeners(n);n=Error("Unable to load image: "+n.src);this.onError(n);this._fireUpdateEnd(n)},_clearEventListeners:function(n){t.disconnect(n._onload_connect);t.disconnect(n._onerror_connect);t.disconnect(n._onabort_connect);n._onload_connect=n._onerror_connect=n._onabort_connect=null},setUseMapTime:function(n,t){this.useMapTime=n;this._toggleTime();t||this.refresh(!0)},refresh:function(){this._map&&this._onExtentChangeHandler(this._map.extent)},_onScaleHandler:function(n,t){var o={},r=e._css.names,i=this._img;i&&(u.set(i,r.transition,t?"none":r.transformName+" "+v+"ms ease"),i._matrix=n,n=i._multiply?f.multiply(n,i._multiply):n,(i._tdx||i._tdy)&&(n=f.multiply(n,{xx:1,xy:0,yx:0,yy:1,dx:i._tdx,dy:i._tdy})),o[r.transform]=e._css.matrix(n),u.set(i,o))},_onZoomHandler:function(n,t,i){n=this._startRect;var f=n.width*t,e=n.height*t,o=n.marginLeft*t,r=this._img,h=s("ie");r&&(h&&8>h?u.set(r,{left:n.left-(f-n.width)*(i.x-n.left)/n.width+"px",top:n.top-(e-n.height)*(i.y-n.top)/n.height+"px",zoom:t*n.zoom}):u.set(r,{left:n.left-(f-n.width)*(i.x-n.left)/n.width+"px",top:n.top-(e-n.height)*(i.y-n.top)/n.height+"px",width:f+"px",height:e+"px"}),null!=o&&0!==o&&u.set(r,{marginLeft:o+"px"}))},_exportMapImage:function(n,t,i){var r=this._exportMapImageHandler;t.token=this._getToken();h({url:n,content:t,callbackParamName:"callback",load:function(n,t){r(n,t,i)},error:o.defaults.io.errorHandler})},_exportMapImageHandler:function(n,t,i){n=new a(n);this.onMapImageExport(n);i&&i(n)},onMapImageExport:function(){},setOpacity:function(n){if(this.opacity!=n)this.onOpacityChange(this.opacity=n)},onOpacityChange:function(){},_opacityChangeHandler:function(n){var t=8===s("ie")?this._img:this._div;u.set(t,"opacity",n)}}),s("extend-esri")&&i.setObject("layers.DynamicMapServiceLayer",n,e),n})},"esri/layers/MapImage":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-style dojo/has ../kernel ../domUtils ../geometry/Extent".split(" "),function(n,t,i,r,u,f,e){return n=n(null,{declaredClass:"esri.layers.MapImage",constructor:function(n){t.mixin(this,n);this.extent=new e(this.extent)},visible:!0,opacity:1,getLayer:function(){return this._layer},getNode:function(){return this._node},show:function(){if(!this.visible){this.visible=!0;var t=this._node,n=this._layer,i;t&&((i=n&&n._div)&&(n.suspended||n._setPos(t,i._left,i._top),(n._active||i).appendChild(t)),f.show(t))}},hide:function(){if(this.visible){this.visible=!1;var n=this._node;n&&(f.hide(n),n.parentNode&&n.parentNode.removeChild(n))}},setOpacity:function(n){var t=this._node;this.opacity=n;t&&i.set(t,"opacity",n)}}),r("extend-esri")&&t.setObject("layers.MapImage",n,u),n})},"esri/layers/ImageParameters":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../layerUtils".split(" "),function(n,t,i,r,u,f,e,o){return t=t(null,{declaredClass:"esri.layers.ImageParameters",constructor:function(){this.layerDefinitions=[]},bbox:null,extent:null,width:null,height:null,dpi:null,format:null,imageSpatialReference:null,layerOption:null,layerIds:null,transparent:null,timeExtent:null,layerTimeOptions:null,toJson:function(t){var i;this.bbox&&n.deprecated(this.declaredClass+" : Property 'bbox' deprecated. Use property 'extent'.");i=this.bbox||this.extent;i=i&&t&&i._normalize(!0);t=this.layerOption;var f=i?i.spatialReference.wkid||r.toJson(i.spatialReference.toJson()):null,u=this.imageSpatialReference,i={dpi:this.dpi,format:this.format,transparent:this.transparent,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,bbox:i?i.xmin+","+i.ymin+","+i.xmax+","+i.ymax:null,bboxSR:f,layers:t?t+":"+this.layerIds.join(","):null,imageSR:u?u.wkid||r.toJson(u.toJson()):f};return i.layerDefs=o._serializeLayerDefinitions(this.layerDefinitions),t=this.timeExtent,i.time=t?t.toJson().join(","):null,i.layerTimeOptions=o._serializeTimeOptions(this.layerTimeOptions),e.filter(i,function(n){if(null!==n)return!0})}}),i.mixin(t,{LAYER_OPTION_SHOW:"show",LAYER_OPTION_HIDE:"hide",LAYER_OPTION_INCLUDE:"include",LAYER_OPTION_EXCLUDE:"exclude"}),u("extend-esri")&&i.setObject("layers.ImageParameters",t,f),t})},"esri/_time":function(){define(["./TimeExtent"],function(){return{}})},"*now":function(n){n(['dojo/i18n!*preload*esri/nls/jsapi*["ar","az","ca","cs","da","de-de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ro","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});require({cache:{"*noref":1,"dijit/BackgroundIframe":function(){define("dijit/BackgroundIframe","require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(n,t,i,r,u,f,e,o){o.add("config-bgIframe",(o("ie")||o("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var s=new function(){var t=[];this.pop=function(){var f;return t.length?(f=t.pop(),f.style.display=""):(9>o("ie")?(f=i.dojoBlankHtmlUrl||n.toUrl("dojo/resources/blank.html")||'javascript:""',f=document.createElement("<iframe src='"+f+"' role='presentation' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>")):(f=r.create("iframe"),f.src='javascript:""',f.className="dijitBackgroundIframe",f.setAttribute("role","presentation"),u.set(f,"opacity",.1)),f.tabIndex=-1),f};this.push=function(n){n.style.display="none";t.push(n)}};return t.BackgroundIframe=function(n){if(!n.id)throw Error("no id");if(o("config-bgIframe")){var t=this.iframe=s.pop();n.appendChild(t);7>o("ie")||o("quirks")?(this.resize(n),this._conn=e(n,"resize",f.hitch(this,"resize",n))):u.set(t,{width:"100%",height:"100%"})}},f.extend(t.BackgroundIframe,{resize:function(n){this.iframe&&u.set(this.iframe,{width:n.offsetWidth+"px",height:n.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),s.push(this.iframe),delete this.iframe)}}),t.BackgroundIframe})},"dijit/CheckedMenuItem":function(){require({cache:{"url:dijit/templates/CheckedMenuItem.html":'<tr class="dijitReset" data-dojo-attach-point="focusNode" role="${role}" tabIndex="-1" aria-checked="${checked}">\r\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\r\n\t\t<span class="dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point="iconNode"><\/span>\r\n\t\t<span class="dijitMenuItemIconChar dijitCheckedMenuItemIconChar">${!checkedChar}<\/span>\r\n\t<\/td>\r\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,labelNode,textDirNode"><\/td>\r\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"><\/td>\r\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">&#160;<\/td>\r\n<\/tr>\r\n'}});define("dijit/CheckedMenuItem",["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(n,t,i,r){return n("dijit.CheckedMenuItem",i,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:r,checked:!1,_setCheckedAttr:function(n){this.domNode.setAttribute("aria-checked",n?"true":"false");this._set("checked",n)},iconClass:"",role:"menuitemcheckbox",checkedChar:"&#10003;",onChange:function(){},_onClick:function(n){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(n)}})})},"dijit/ColorPalette":function(){require({cache:{"url:dijit/templates/ColorPalette.html":'<div class="dijitInline dijitColorPalette" role="grid">\r\n\t<table data-dojo-attach-point="paletteTableNode" class="dijitPaletteTable" cellSpacing="0" cellPadding="0" role="presentation">\r\n\t\t<tbody data-dojo-attach-point="gridNode"><\/tbody>\r\n\t<\/table>\r\n<\/div>\r\n'}});define("dijit/ColorPalette","require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){var l=s("dijit.ColorPalette",[i,r,u],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:t,baseClass:"dijitColorPalette",_dyeFactory:function(n,t,i,r){return new this._dyeClass(n,t,i,r)},buildRendering:function(){this.inherited(arguments);this._dyeClass=s(l._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],e.getLocalization("dojo","colors",this.lang))}});return l._Color=s("dijit._Color",o,{template:"<span class='dijitInline dijitPaletteImg'><img src='${blankGif}' alt='${alt}' title='${title}' class='dijitColorPaletteSwatch' style='background-color: ${color}'/><\/span>",hcTemplate:"<span class='dijitInline dijitPaletteImg' style='position: relative; overflow: hidden; height: 12px; width: 14px;'><img src='${image}' alt='${alt}' title='${title}' style='position: absolute; left: ${left}px; top: ${top}px; ${size}'/><\/span>",_imagePaths:{"7x10":n.toUrl("./themes/a11y/colors7x10.png"),"3x4":n.toUrl("./themes/a11y/colors3x4.png")},constructor:function(n,t,i,r){this._title=r;this._row=t;this._col=i;this.setColor(o.named[n])},getValue:function(){return this.toHex()},fillCell:function(n,t){var i=c.substitute(f("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:t,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?"height: 145px; width: 206px":"height: 64px; width: 86px"});h.place(i,n)}}),l})},"dijit/Dialog":function(){require({cache:{"url:dijit/templates/Dialog.html":'<div class="dijitDialog" role="dialog" aria-labelledby="${id}_title">\r\n\t<div data-dojo-attach-point="titleBar" class="dijitDialogTitleBar">\r\n\t\t<span data-dojo-attach-point="titleNode" class="dijitDialogTitle" id="${id}_title"\r\n\t\t\t\trole="heading" level="1"><\/span>\r\n\t\t<span data-dojo-attach-point="closeButtonNode" class="dijitDialogCloseIcon" data-dojo-attach-event="ondijitclick: onCancel" title="${buttonCancel}" role="button" tabindex="-1">\r\n\t\t\t<span data-dojo-attach-point="closeText" class="closeText" title="${buttonCancel}">x<\/span>\r\n\t\t<\/span>\r\n\t<\/div>\r\n\t<div data-dojo-attach-point="containerNode" class="dijitDialogPaneContent"><\/div>\r\n\t${!actionBarTemplate}\r\n<\/div>\r\n\r\n'}});define("dijit/Dialog","require dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/ready dojo/sniff dojo/touch dojo/window dojo/dnd/Moveable dojo/dnd/TimedMoveable ./focus ./_base/manager ./_Widget ./_TemplatedMixin ./_CssStateMixin ./form/_FormMixin ./_DialogMixin ./DialogUnderlay ./layout/ContentPane ./layout/utils dojo/text!./templates/Dialog.html ./a11yclick dojo/i18n!./nls/common".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){function yt(){}var vt=new u,at,lt,ct;return vt.resolve(!0),nt=r("dijit._DialogBase"+(p("dojo-bidi")?"_NoBidi":""),[it,ut,ft,rt],{templateString:ht,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:nt.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(n){this._set("draggable",n)},maxRatio:.9,closable:!0,_setClosableAttr:function(n){this.closeButtonNode.style.display=n?"":"none";this._set("closable",n)},postMixInProperties:function(){var n=c.getLocalization("dijit","common");a.mixin(this,n);this.inherited(arguments)},postCreate:function(){s.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);i.after(this,"onExecute",a.hitch(this,"hide"),!0);i.after(this,"onCancel",a.hitch(this,"hide"),!0);v(this.closeButtonNode,w.press,function(n){n.stopPropagation()});this._modalconnects=[]},onLoad:function(){this.resize();this._position();this.autofocus&&lt.isTop(this)&&(this._getFocusItems(),g.focus(this._firstFocusItem));this.inherited(arguments)},focus:function(){this._getFocusItems();g.focus(this._firstFocusItem)},_endDrag:function(){var n=o.position(this.domNode),t=b.getBox(this.ownerDocument);n.y=Math.min(Math.max(n.y,0),t.h-n.h);n.x=Math.min(Math.max(n.x,0),t.w-n.w);this._relativePosition=n;this._position()},_setup:function(){var n=this.domNode;this.titleBar&&this.draggable?(this._moveable=new(6==p("ie")?d:k)(n,{handle:this.titleBar}),i.after(this._moveable,"onMoveStop",a.hitch(this,"_endDrag"),!0)):e.add(n,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,"class":t.map(this["class"].split(/\s/),function(n){return n+"_underlay"}).join(" "),_onKeyDown:a.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!e.contains(this.ownerDocumentBody,"dojoMove")){var r=this.domNode,n=b.getBox(this.ownerDocument),t=this._relativePosition,i=o.position(r);s.set(r,{left:Math.floor(n.l+(t?Math.min(t.x,n.w-i.w):(n.w-i.w)/2))+"px",top:Math.floor(n.t+(t?Math.min(t.y,n.h-i.h):(n.h-i.h)/2))+"px"})}},_onKey:function(n){if(n.keyCode==l.TAB){this._getFocusItems();var t=n.target;this._firstFocusItem==this._lastFocusItem?(n.stopPropagation(),n.preventDefault()):t==this._firstFocusItem&&n.shiftKey?(g.focus(this._lastFocusItem),n.stopPropagation(),n.preventDefault()):t!=this._lastFocusItem||n.shiftKey||(g.focus(this._firstFocusItem),n.stopPropagation(),n.preventDefault())}else this.closable&&n.keyCode==l.ESCAPE&&(this.onCancel(),n.stopPropagation(),n.preventDefault())},show:function(){var n,t;return this.open?vt.promise:(this._started||this.startup(),this._alreadyInitialized||(this._setup(),this._alreadyInitialized=!0),this._fadeOutDeferred&&(this._fadeOutDeferred.cancel(),lt.hide(this)),n=b.get(this.ownerDocument),this._modalconnects.push(v(n,"scroll",a.hitch(this,"resize",null))),this._modalconnects.push(v(this.domNode,"keydown",a.hitch(this,"_onKey"))),s.set(this.domNode,{opacity:0,display:""}),this._set("open",!0),this._onShow(),this.resize(),this._position(),this._fadeInDeferred=new u(a.hitch(this,function(){t.stop();delete this._fadeInDeferred})),this._fadeInDeferred.then(void 0,yt),n=this._fadeInDeferred.promise,t=h.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:a.hitch(this,function(){lt.show(this,this.underlayAttrs)}),onEnd:a.hitch(this,function(){this.autofocus&&lt.isTop(this)&&(this._getFocusItems(),g.focus(this._firstFocusItem));this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred})}).play(),n)},hide:function(){var n,t,i;if(!this._alreadyInitialized||!this.open)return vt.promise;for(this._fadeInDeferred&&this._fadeInDeferred.cancel(),this._fadeOutDeferred=new u(a.hitch(this,function(){n.stop();delete this._fadeOutDeferred})),this._fadeOutDeferred.then(void 0,yt),this._fadeOutDeferred.then(a.hitch(this,"onHide")),t=this._fadeOutDeferred.promise,n=h.fadeOut({node:this.domNode,duration:this.duration,onEnd:a.hitch(this,function(){this.domNode.style.display="none";lt.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred})}).play(),this._scrollConnected&&(this._scrollConnected=!1);i=this._modalconnects.pop();)i.remove();return this._relativePosition&&delete this._relativePosition,this._set("open",!1),t},resize:function(n){var i,r,u;"none"!=this.domNode.style.display&&(this._checkIfSingleChild(),n||(this._shrunk&&(this._singleChild&&"undefined"!=typeof this._singleChildOriginalStyle&&(this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle,delete this._singleChildOriginalStyle),t.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],function(n){n&&s.set(n,{position:"static",width:"auto",height:"auto"})}),this.domNode.style.position="absolute"),i=b.getBox(this.ownerDocument),i.w*=this.maxRatio,i.h*=this.maxRatio,r=o.position(this.domNode),r.w>=i.w||r.h>=i.h?(n={w:Math.min(r.w,i.w),h:Math.min(r.h,i.h)},this._shrunk=!0):this._shrunk=!1),n?(o.setMarginBox(this.domNode,n),i=[],this.titleBar&&i.push({domNode:this.titleBar,region:"top"}),this.actionBarNode&&i.push({domNode:this.actionBarNode,region:"bottom"}),r={domNode:this.containerNode,region:"center"},i.push(r),u=st.marginBox2contentBox(this.domNode,n),st.layoutChildren(this.domNode,u,i),this._singleChild?(i=st.marginBox2contentBox(this.containerNode,r),this._singleChild.resize({w:i.w,h:i.h})):(this.containerNode.style.overflow="auto",this._layoutChildren())):this._layoutChildren(),p("touch")||n||this._position())},_layoutChildren:function(){t.forEach(this.getChildren(),function(n){n.resize&&n.resize()})},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var n;n=this._modalconnects.pop();)n.remove();lt.hide(this);this.inherited(arguments)}}),p("dojo-bidi")&&(nt=r("dijit._DialogBase",nt,{_setTitleAttr:function(n){this._set("title",n);this.titleNode.innerHTML=n;this.applyTextDir(this.titleNode)},_setTextDirAttr:function(n){this._created&&this.textDir!=n&&(this._set("textDir",n),this.set("title",this.title))}})),at=r("dijit.Dialog",[ot,nt],{}),at._DialogBase=nt,lt=at._DialogLevelManager={_beginZIndex:950,show:function(n,t){ct[ct.length-1].focus=g.curNode;var i=ct[ct.length-1].dialog?ct[ct.length-1].zIndex+2:at._DialogLevelManager._beginZIndex;s.set(n.domNode,"zIndex",i);et.show(t,i-1);ct.push({dialog:n,underlayAttrs:t,zIndex:i})},hide:function(n){if(ct[ct.length-1].dialog==n){ct.pop();var i=ct[ct.length-1];if(1==ct.length?et.hide():et.show(i.underlayAttrs,i.zIndex-1),n.refocus&&(n=i.focus,!i.dialog||n&&f.isDescendant(n,i.dialog.domNode)||(i.dialog._getFocusItems(),n=i.dialog._firstFocusItem),n))try{n.focus()}catch(r){}}else i=t.indexOf(t.map(ct,function(n){return n.dialog}),n),-1!=i&&ct.splice(i,1)},isTop:function(n){return ct[ct.length-1].dialog==n}},ct=at._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}],g.watch("curNode",function(n,t,i){if(n=ct[ct.length-1].dialog,i&&n&&!n._fadeOutDeferred&&i.ownerDocument==n.ownerDocument){do if(i==n.domNode||e.contains(i,"dijitPopup"))return;while(i=i.parentNode);n.focus()}}),p("dijit-legacy-requires")&&y(0,function(){n(["dijit/TooltipDialog"])}),at})},"dijit/DialogUnderlay":function(){define("dijit/DialogUnderlay","dojo/_base/declare dojo/_base/lang dojo/aspect dojo/dom-attr dojo/dom-style dojo/on dojo/window ./_Widget ./_TemplatedMixin ./BackgroundIframe ./Viewport ./main".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){var a=n("dijit.DialogUnderlay",[o,s],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' tabIndex='-1' data-dojo-attach-point='node'><\/div><\/div>",dialogId:"","class":"",_modalConnects:[],_setDialogIdAttr:function(n){r.set(this.node,"id",n+"_underlay");this._set("dialogId",n)},_setClassAttr:function(n){this.node.className="dijitDialogUnderlay "+n;this._set("class",n)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.own(f(this.domNode,"keydown",t.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var i=this.node.style,t=this.domNode.style,n;t.display="none";n=e.getBox(this.ownerDocument);t.top=n.t+"px";t.left=n.l+"px";i.width=n.w+"px";i.height=n.h+"px";t.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new h(this.domNode);var n=e.get(this.ownerDocument);this._modalConnects=[c.on("resize",t.hitch(this,"layout")),f(n,"scroll",t.hitch(this,"layout"))]},hide:function(){for(this.bgIframe.destroy(),delete this.bgIframe,this.domNode.style.display="none";this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.inherited(arguments)},_onKeyDown:function(){}});return a.show=function(n,t){var i=a._singleton;!i||i._destroyed?i=l._underlay=a._singleton=new a(n):n&&i.set(n);u.set(i.domNode,"zIndex",t);i.open||i.show()},a.hide=function(){var n=a._singleton;n&&!n._destroyed&&n.hide()},a})},"dijit/DropDownMenu":function(){require({cache:{"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\r\n\t   cellspacing="0">\r\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"><\/tbody>\r\n<\/table>\r\n'}});define("dijit/DropDownMenu",["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(n,t,i,r){return n("dijit.DropDownMenu",r,{templateString:i,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(n){this._moveToPopup(n);n.stopPropagation();n.preventDefault()},_onLeftArrow:function(n){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else n.stopPropagation(),n.preventDefault()}})})},"dijit/Menu":function(){define("dijit/Menu","require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return c("dijit-legacy-requires")&&p(0,function(){n(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])}),i("dijit.Menu",y,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):t.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(n){return a.get(this._iframeContentDocument(n))||this._iframeContentDocument(n).__parent__||n.name&&document.frames[n.name]||null},_iframeContentDocument:function(n){return n.contentDocument||n.contentWindow&&n.contentWindow.document||n.name&&document.frames[n.name]&&document.frames[n.name].document||null},bindDomNode:function(n){var f,t,i,e;n=r.byId(n,this.ownerDocument);"iframe"==n.tagName.toLowerCase()?(t=n,f=this._iframeContentWindow(t),f=l.body(f.document)):f=n==l.body(this.ownerDocument)?this.ownerDocument.documentElement:n;i={node:n,iframe:t};u.set(n,"_dijitMenu"+this.id,this._bindings.push(i));e=s.hitch(this,function(n){var r=this.selector,u=r?function(n){return h.selector(r,n)}:function(n){return n},i=this;return[h(n,u(this.leftClickToOpen?"click":"contextmenu"),function(n){n.stopPropagation();n.preventDefault();(new Date).getTime()<i._lastKeyDown+500||i._scheduleOpen(this,t,{x:n.pageX,y:n.pageY},n.target)}),h(n,u("keydown"),function(n){(93==n.keyCode||n.shiftKey&&n.keyCode==o.F10||i.leftClickToOpen&&n.keyCode==o.SPACE)&&(n.stopPropagation(),n.preventDefault(),i._scheduleOpen(this,t,null,n.target),i._lastKeyDown=(new Date).getTime())})]});i.connects=f?e(f):[];t&&(i.onloadHandler=s.hitch(this,function(){var n=this._iframeContentWindow(t),n=l.body(n.document);i.connects=e(n)}),t.addEventListener?t.addEventListener("load",i.onloadHandler,!1):t.attachEvent("onload",i.onloadHandler))},unBindDomNode:function(n){var i,e,f,t;try{i=r.byId(n,this.ownerDocument)}catch(o){return}if(n="_dijitMenu"+this.id,i&&u.has(i,n)){for(e=u.get(i,n)-1,f=this._bindings[e];t=f.connects.pop();)t.remove();(t=f.iframe)&&(t.removeEventListener?t.removeEventListener("load",f.onloadHandler,!1):t.detachEvent("onload",f.onloadHandler));u.remove(i,n);delete this._bindings[e]}},_scheduleOpen:function(n,t,i,r){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:r,delegatedTarget:n,iframe:t,coords:i})},1))},_openMyself:function(n){function a(){h.refocus&&l&&l.focus();v.close(h)}var u=n.target,t=n.iframe,i=n.coords,y=!i,h,l;if(this.currentTarget=n.delegatedTarget,i){if(t){n=f.position(t,!0);var u=this._iframeContentWindow(t),u=f.docScroll(u.document),o=e.getComputedStyle(t),s=e.toPixelValue,p=(c("ie")&&c("quirks")?0:s(t,o.paddingLeft))+(c("ie")&&c("quirks")?s(t,o.borderLeftWidth):0),t=(c("ie")&&c("quirks")?0:s(t,o.paddingTop))+(c("ie")&&c("quirks")?s(t,o.borderTopWidth):0);i.x+=n.x+p-u.x;i.y+=n.y+t-u.y}}else i=f.position(u,!0),i.x+=10,i.y+=10;h=this;t=this._focusManager.get("prevNode");n=this._focusManager.get("curNode");l=!n||r.isDescendant(n,this.domNode)?t:n;v.open({popup:this,x:i.x,y:i.y,onExecute:a,onCancel:a,orient:this.isLeftToRight()?"L":"R"});this.focus();y||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);v.close(this)}},destroy:function(){t.forEach(this._bindings,function(n){n&&this.unBindDomNode(n.node)},this);this.inherited(arguments)}})})},"dijit/MenuItem":function(){require({cache:{"url:dijit/templates/MenuItem.html":'<tr class="dijitReset" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\r\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\r\n\t\t<span role="presentation" class="dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"><\/span>\r\n\t<\/td>\r\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"\r\n\t\trole="presentation"><\/td>\r\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"><\/td>\r\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\r\n\t\t<span data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\r\n\t\t\t<span class="dijitInline dijitIcon dijitMenuExpand"><\/span>\r\n\t\t\t<span class="dijitMenuExpandA11y">+<\/span>\r\n\t\t<\/span>\r\n\t<\/td>\r\n<\/tr>\r\n'}});define("dijit/MenuItem","dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){return e=n("dijit.MenuItem"+(f("dojo-bidi")?"_NoBidi":""),[o,s,h,c],{templateString:l,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(n){var t,i,r;this._set("label",n);i="";t=n.search(/{\S}/);0<=t?(i=n.charAt(t+1),r=n.substr(0,t),n=n.substr(t+3),t=r+i+n,n=r+'<span class="dijitMenuItemShortcutKey">'+i+"<\/span>"+n):t=n;this.domNode.setAttribute("aria-label",t+" "+this.accelKey);this.containerNode.innerHTML=n;this._set("shortcutKey",i)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(n){!n||"label"in this.params||this._set("label",n.innerHTML)},buildRendering:function(){this.inherited(arguments);i.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&i.set(this.accelKeyNode,"id",this.id+"_accel");t.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==f("ie")&&this.containerNode.focus();this.focusNode.focus()}catch(n){}},_setSelected:function(n){r.toggle(this.domNode,"dijitMenuItemSelected",n)},setLabel:function(n){u.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",n)},setDisabled:function(n){u.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",n)},_setDisabledAttr:function(n){this.focusNode.setAttribute("aria-disabled",n?"true":"false");this._set("disabled",n)},_setAccelKeyAttr:function(n){this.accelKeyNode&&(this.accelKeyNode.style.display=n?"":"none",this.accelKeyNode.innerHTML=n,i.set(this.containerNode,"colSpan",n?"1":"2"));this._set("accelKey",n)}}),f("dojo-bidi")&&(e=n("dijit.MenuItem",e,{_setLabelAttr:function(){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}})),e})},"dijit/MenuSeparator":function(){require({cache:{"url:dijit/templates/MenuSeparator.html":'<tr class="dijitMenuSeparator" role="separator">\r\n\t<td class="dijitMenuSeparatorIconCell">\r\n\t\t<div class="dijitMenuSeparatorTop"><\/div>\r\n\t\t<div class="dijitMenuSeparatorBottom"><\/div>\r\n\t<\/td>\r\n\t<td colspan="3" class="dijitMenuSeparatorLabelCell">\r\n\t\t<div class="dijitMenuSeparatorTop dijitMenuSeparatorLabel"><\/div>\r\n\t\t<div class="dijitMenuSeparatorBottom"><\/div>\r\n\t<\/td>\r\n<\/tr>\r\n'}});define("dijit/MenuSeparator","dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(n,t,i,r,u,f){return n("dijit.MenuSeparator",[i,r,u],{templateString:f,buildRendering:function(){this.inherited(arguments);t.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/PopupMenuItem":function(){define("dijit/PopupMenuItem","dojo/_base/declare dojo/dom-style dojo/_base/lang dojo/query ./popup ./registry ./MenuItem ./hccss".split(" "),function(n,t,i,r,u,f,e){return n("dijit.PopupMenuItem",e,{baseClass:"dijitMenuItem dijitPopupMenuItem",_fillContent:function(){if(this.srcNodeRef){var n=r("*",this.srcNodeRef);this.inherited(arguments,[n[0]]);this.dropDownContainer=this.srcNodeRef}},_openPopup:function(n,t){var r=this.popup;u.open(i.delegate(n,{popup:this.popup,around:this.domNode}));t&&r.focus&&r.focus()},_closePopup:function(){u.close(this.popup);this.popup.parentMenu=null},startup:function(){if(!this._started){if(this.inherited(arguments),!this.popup){var n=r("[widgetId]",this.dropDownContainer)[0];this.popup=f.byNode(n)}this.ownerDocumentBody.appendChild(this.popup.domNode);this.popup.domNode.setAttribute("aria-labelledby",this.containerNode.id);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&t.set(this.arrowWrapper,"visibility","");this.focusNode.setAttribute("aria-haspopup","true")}},destroyDescendants:function(n){this.popup&&(this.popup._destroyed||this.popup.destroyRecursive(n),delete this.popup);this.inherited(arguments)}})})},"dijit/Tooltip":function(){require({cache:{"url:dijit/templates/Tooltip.html":'<div class="dijitTooltip dijitTooltipLeft" id="dojoTooltip" data-dojo-attach-event="mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t><div class="dijitTooltipConnector" data-dojo-attach-point="connectorNode"><\/div\r\n\t><div class="dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point="containerNode" role=\'alert\'><\/div\r\n><\/div>\r\n'}});define("dijit/Tooltip","dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function d(){}var g=t("dijit._MasterTooltip",[v,y],{duration:l.defaultDuration,templateString:w,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new p(this.domNode);this.fadeIn=i.fadeIn({node:this.domNode,duration:this.duration,onEnd:o.hitch(this,"_onShow")});this.fadeOut=i.fadeOut({node:this.domNode,duration:this.duration,onEnd:o.hitch(this,"_onHide")})},show:function(n,t,i,r,u,f,s){if(!this.aroundNode||this.aroundNode!==t||this.containerNode.innerHTML!=n)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=n;u&&this.set("textDir",u);this.containerNode.align=r?"right":"left";var h=a.around(this.domNode,t,i&&i.length?i:k.defaultPosition,!r,o.hitch(this,"orient")),c=h.aroundNodePos;"M"==h.corner.charAt(0)&&"M"==h.aroundCorner.charAt(0)?(this.connectorNode.style.top=c.y+(c.h-this.connectorNode.offsetHeight>>1)-h.y+"px",this.connectorNode.style.left=""):"M"==h.corner.charAt(1)&&"M"==h.aroundCorner.charAt(1)?this.connectorNode.style.left=c.x+(c.w-this.connectorNode.offsetWidth>>1)-h.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");e.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=t;this.onMouseEnter=f||d;this.onMouseLeave=s||d}},orient:function(n,t,i,r,u){var o,e;return this.connectorNode.style.top="",o=r.h,r=r.w,n.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[t+"-"+i],this.domNode.style.width="auto",e=f.position(this.domNode),(c("ie")||c("trident"))&&(e.w+=2),f.setMarginBox(this.domNode,{w:Math.min(Math.max(r,1),e.w)}),"B"==i.charAt(0)&&"B"==t.charAt(0)?(n=f.position(n),t=this.connectorNode.offsetHeight,n.h>o?(this.connectorNode.style.top=o-(u.h+t>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(u.h/2-t/2,0),n.h-t)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom=""),Math.max(0,e.w-r)},_onShow:function(){c("ie")&&(this.domNode.style.filter="")},hide:function(n){this._onDeck&&this._onDeck[1]==n?this._onDeck=null:this.aroundNode===n&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=d},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}}),k;return c("dojo-bidi")&&g.extend({_setAutoTextDir:function(t){this.applyTextDir(t);n.forEach(t.children,function(n){this._setAutoTextDir(n)},this)},_setTextDirAttr:function(n){this._set("textDir",n);"auto"==n?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}}),b.showTooltip=function(t,i,r,u,f,e,o){return r&&(r=n.map(r,function(n){return{after:"after-centered",before:"before-centered"}[n]||n})),k._masterTT||(b._masterTT=k._masterTT=new g),k._masterTT.show(t,i,r,u,f,e,o)},b.hideTooltip=function(n){return k._masterTT&&k._masterTT.hide(n)},k=t("dijit.Tooltip",v,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(t){n.forEach(this._connections||[],function(t){n.forEach(t,function(n){n.remove()})},this);this._connectIds=n.filter(o.isArrayLike(t)?t:t?[t]:[],function(n){return r.byId(n,this.ownerDocument)},this);this._connections=n.map(this._connectIds,function(n){n=r.byId(n,this.ownerDocument);var u=this.selector,t=u?function(n){return h.selector(u,n)}:function(n){return n},i=this;return[h(n,t(s.enter),function(){i._onHover(this)}),h(n,t("focusin"),function(){i._onHover(this)}),h(n,t(s.leave),o.hitch(i,"_onUnHover")),h(n,t("focusout"),o.hitch(i,"set","state","DORMANT"))]},this);this._set("connectId",t)},addTarget:function(t){t=t.id||t;-1==n.indexOf(this._connectIds,t)&&this.set("connectId",this._connectIds.concat(t))},removeTarget:function(t){t=n.indexOf(this._connectIds,t.id||t);0<=t&&(this._connectIds.splice(t,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);u.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var t=this.connectId;n.forEach(o.isArrayLike(t)?t:[t],this.addTarget,this)},getContent:function(){return this.label||this.domNode.innerHTML},state:"DORMANT",_setStateAttr:function(n){if(!(this.state==n||"SHOW TIMER"==n&&"SHOWING"==this.state||"HIDE TIMER"==n&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(n){case"DORMANT":this._connectNode&&(k.hide(this._connectNode),delete this._connectNode,this.onHide());break;case"SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},this.showDelay));break;case"SHOWING":var t=this.getContent(this._connectNode);if(!t){this.set("state","DORMANT");return}k.show(t,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,o.hitch(this,"set","state","SHOWING"),o.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case"HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",n)}},_onHover:function(n){this._connectNode&&n!=this._connectNode&&this.set("state","DORMANT");this._connectNode=n;this.set("state","SHOW TIMER")},_onUnHover:function(){this.set("state","HIDE TIMER")},open:function(n){this.set("state","DORMANT");this._connectNode=n;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");n.forEach(this._connections||[],function(t){n.forEach(t,function(n){n.remove()})},this);this.inherited(arguments)}}),k._MasterTooltip=g,k.show=b.showTooltip,k.hide=b.hideTooltip,k.defaultPosition=["after-centered","before-centered"],k})},"dijit/TooltipDialog":function(){require({cache:{"url:dijit/templates/TooltipDialog.html":'<div role="alertdialog" tabIndex="-1">\r\n\t<div class="dijitTooltipContainer" role="presentation">\r\n\t\t<div data-dojo-attach-point="contentsNode" class="dijitTooltipContents dijitTooltipFocusNode">\r\n\t\t\t<div data-dojo-attach-point="containerNode"><\/div>\r\n\t\t\t${!actionBarTemplate}\r\n\t\t<\/div>\r\n\t<\/div>\r\n\t<div class="dijitTooltipConnector" role="presentation" data-dojo-attach-point="connectorNode"><\/div>\r\n<\/div>\r\n'}});define("dijit/TooltipDialog","dojo/_base/declare dojo/dom-class dojo/has dojo/keys dojo/_base/lang dojo/on ./focus ./layout/ContentPane ./_DialogMixin ./form/_FormMixin ./_TemplatedMixin dojo/text!./templates/TooltipDialog.html ./main".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){return n=n("dijit.TooltipDialog",[o,c,h,s],{title:"",doLayout:!1,autofocus:!0,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,templateString:l,_setTitleAttr:"containerNode",postCreate:function(){this.inherited(arguments);this.own(f(this.domNode,"keydown",u.hitch(this,"_onKey")))},orient:function(n,i,r){n={"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft","BR-TL":"dijitTooltipBelow dijitTooltipABLeft","BL-TR":"dijitTooltipBelow dijitTooltipABRight","TL-BR":"dijitTooltipAbove dijitTooltipABRight","TR-BL":"dijitTooltipAbove dijitTooltipABLeft"}[i+"-"+r];t.replace(this.domNode,n,this._currentOrientClass||"");this._currentOrientClass=n},focus:function(){this._getFocusItems();e.focus(this._firstFocusItem)},onOpen:function(n){this.orient(this.domNode,n.aroundCorner,n.corner);var t=n.aroundNodePos;"M"==n.corner.charAt(0)&&"M"==n.aroundCorner.charAt(0)?(this.connectorNode.style.top=t.y+(t.h-this.connectorNode.offsetHeight>>1)-n.y+"px",this.connectorNode.style.left=""):"M"==n.corner.charAt(1)&&"M"==n.aroundCorner.charAt(1)&&(this.connectorNode.style.left=t.x+(t.w-this.connectorNode.offsetWidth>>1)-n.x+"px");this._onShow()},onClose:function(){this.onHide()},_onKey:function(n){if(n.keyCode==r.ESCAPE)this.defer("onCancel"),n.stopPropagation(),n.preventDefault();else if(n.keyCode==r.TAB){var t=n.target;this._getFocusItems();this._firstFocusItem==this._lastFocusItem?(n.stopPropagation(),n.preventDefault()):t==this._firstFocusItem&&n.shiftKey?(e.focus(this._lastFocusItem),n.stopPropagation(),n.preventDefault()):t!=this._lastFocusItem||n.shiftKey?n.stopPropagation():(e.focus(this._firstFocusItem),n.stopPropagation(),n.preventDefault())}}}),i("dojo-bidi")&&n.extend({_setTitleAttr:function(n){this.containerNode.title=this.textDir&&this.enforceTextDirWithUcc?this.enforceTextDirWithUcc(null,n):n;this._set("title",n)},_setTextDirAttr:function(n){this._created&&this.textDir==n||(this._set("textDir",n),this.textDir&&this.title&&(this.containerNode.title=this.enforceTextDirWithUcc(null,this.title)))}}),n})},"dijit/Viewport":function(){define("dijit/Viewport",["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(n,t,i,r,u){var e=new n,f;return i(function(){var n=u.getBox(),i;e._rlh=t(window,"resize",function(){var t=u.getBox();(n.h!=t.h||n.w!=t.w)&&(n=t,e.emit("resize"))});8==r("ie")&&(i=screen.deviceXDPI,setInterval(function(){screen.deviceXDPI!=i&&(i=screen.deviceXDPI,e.emit("resize"))},500));r("ios")&&(t(document,"focusin",function(n){f=n.target}),t(document,"focusout",function(){f=null}))}),e.getEffectiveBox=function(n){n=u.getBox(n);var t=f&&f.tagName&&f.tagName.toLowerCase();return r("ios")&&f&&!f.readOnly&&("textarea"==t||"input"==t&&/^(color|email|number|password|search|tel|text|url)$/.test(f.type))&&(n.h*=0==orientation||180==orientation?.66:.4,t=f.getBoundingClientRect(),n.h=Math.max(n.h,t.top+t.height)),n},e})},"dijit/WidgetSet":function(){define("dijit/WidgetSet",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","./registry"],function(n,t,i,r){var u=t("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0},add:function(n){if(this._hash[n.id])throw Error("Tried to register widget with id=="+n.id+" but that id is already registered");this._hash[n.id]=n;this.length++},remove:function(n){this._hash[n]&&(delete this._hash[n],this.length--)},forEach:function(n,t){t=t||i.global;var r=0;for(var u in this._hash)n.call(t,this._hash[u],r++,this._hash);return this},filter:function(n,t){var r,e,o,f;t=t||i.global;r=new u;e=0;for(o in this._hash)f=this._hash[o],n.call(t,f,e++,this._hash)&&r.add(f);return r},byId:function(n){return this._hash[n]},byClass:function(n){var i=new u,r,t;for(r in this._hash)t=this._hash[r],t.declaredClass==n&&i.add(t);return i},toArray:function(){var n=[];for(var t in this._hash)n.push(this._hash[t]);return n},map:function(t,i){return n.map(this.toArray(),t,i)},every:function(n,t){t=t||i.global;var r=0;for(var u in this._hash)if(!n.call(t,this._hash[u],r++,this._hash))return!1;return!0},some:function(n,t){t=t||i.global;var r=0;for(var u in this._hash)if(n.call(t,this._hash[u],r++,this._hash))return!0;return!1}});return n.forEach("forEach filter byClass map every some".split(" "),function(n){r[n]=u.prototype[n]}),u})},"dijit/_Contained":function(){define("dijit/_Contained",["dojo/_base/declare","./registry"],function(n){return n("dijit._Contained",null,{_getSibling:function(n){var t=this.getParent();return t&&t._getSiblingOfChild&&t._getSiblingOfChild(this,"previous"==n?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var n=this.getParent();return n&&n.getIndexOfChild?n.getIndexOfChild(this):-1}})})},"dijit/_Container":function(){define("dijit/_Container",["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(n,t,i){return t("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(n,t){var r=this.containerNode;if(0<t){for(r=r.firstChild;0<t;)1==r.nodeType&&t--,r=r.nextSibling;r?t="before":(r=this.containerNode,t="last")}i.place(n.domNode,r,t);this._started&&!n._started&&n.startup()},removeChild:function(n){"number"==typeof n&&(n=this.getChildren()[n]);n&&(n=n.domNode)&&n.parentNode&&n.parentNode.removeChild(n)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(t,i){var r=this.getChildren(),u=n.indexOf(r,t);return r[u+i]},getIndexOfChild:function(t){return n.indexOf(this.getChildren(),t)}})})},"dijit/_CssStateMixin":function(){define("dijit/_CssStateMixin","dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){return t=t("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);n.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(n){this.watch(n,f.hitch(this,"_setStateClass"))},this);for(var t in this.cssStateNodes||{})this._trackMouseState(this[t],this.cssStateNodes[t]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(n){if(!this.disabled)switch(n.type){case"mouseover":case"MSPointerOver":case"pointerover":this._set("hovering",!0);this._set("active",this._mouseDown);break;case"mouseout":case"MSPointerOut":case"pointerout":this._set("hovering",!1);this._set("active",!1);break;case"mousedown":case"touchstart":case"MSPointerDown":case"pointerdown":case"keydown":this._set("active",!0);break;case"mouseup":case"dojotouchend":case"MSPointerUp":case"pointerup":case"keyup":this._set("active",!1)}},_setStateClass:function(){function t(t){i=i.concat(n.map(i,function(n){return n+t}),"dijit"+t)}var i=this.baseClass.split(" "),r,u,f,e;this.isLeftToRight()||t("Rtl");r="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&t(r);this.state&&t(this.state);this.selected&&t("Selected");this._opened&&t("Opened");this.disabled?t("Disabled"):this.readOnly?t("ReadOnly"):this.active?t("Active"):this.hovering&&t("Hover");this.focused&&t("Focused");r=this.stateNode||this.domNode;u={};n.forEach(r.className.split(" "),function(n){u[n]=!0});"_stateClasses"in this&&n.forEach(this._stateClasses,function(n){delete u[n]});n.forEach(i,function(n){u[n]=!0});f=[];for(e in u)f.push(e);r.className=f.join(" ");this._stateClasses=i},_subnodeCssMouseEvent:function(n,t,i){function u(i){r.toggle(n,t+"Active",i)}if(!this.disabled&&!this.readOnly)switch(i.type){case"mouseover":case"MSPointerOver":case"pointerover":r.toggle(n,t+"Hover",!0);break;case"mouseout":case"MSPointerOut":case"pointerout":r.toggle(n,t+"Hover",!1);u(!1);break;case"mousedown":case"touchstart":case"MSPointerDown":case"pointerdown":case"keydown":u(!0);break;case"mouseup":case"MSPointerUp":case"pointerup":case"dojotouchend":case"keyup":u(!1);break;case"focus":case"focusin":r.toggle(n,t+"Focused",!0);break;case"blur":case"focusout":r.toggle(n,t+"Focused",!1)}},_trackMouseState:function(n,t){n._cssState=t}}),o(function(){function t(n,t,r){if(!r||!i.isDescendant(r,t))for(;t&&t!=r;t=t.parentNode)if(t._cssState){var u=l.getEnclosingWidget(t);u&&(t==u.domNode?u._cssMouseEvent(n):u._subnodeCssMouseEvent(t,t._cssState,n))}}var n=h.body(),r;e(n,s.over,function(n){t(n,n.target,n.relatedTarget)});e(n,s.out,function(n){t(n,n.target,n.relatedTarget)});e(n,c.press,function(n){r=n.target;t(n,r)});e(n,c.release,function(n){t(n,r);r=null});e(n,"focusin, focusout",function(n){var t=n.target,i;t._cssState&&!t.getAttribute("widgetId")&&(i=l.getEnclosingWidget(t),i&&i._subnodeCssMouseEvent(t,t._cssState,n))})}),t})},"dijit/_DialogMixin":function(){define("dijit/_DialogMixin",["dojo/_base/declare","./a11y"],function(n,t){return n("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var n=t._getTabNavigable(this.domNode);this._firstFocusItem=n.lowest||n.first||this.closeButtonNode||this.domNode;this._lastFocusItem=n.last||n.highest||this._firstFocusItem}})})},"dijit/_HasDropDown":function(){define("dijit/_HasDropDown","dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return n("dijit._HasDropDown",p,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(n){this.disabled||this.readOnly||("MSPointerDown"!=n.type&&n.preventDefault(),this.own(c.once(this.ownerDocument,l.release,h.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(n){var r=this.dropDown,e=!1,t,i;if(n&&this._opened&&(t=f.position(this._buttonNode,!0),!(n.pageX>=t.x&&n.pageX<=t.x+t.w&&n.pageY>=t.y&&n.pageY<=t.y+t.h))){for(t=n.target;t&&!e;)u.contains(t,"dijitPopup")?e=!0:t=t.parentNode;if(e){if(t=n.target,r.onItemClick){for(;t&&!(i=a.byNode(t));)t=t.parentNode;if(i&&i.onClick&&i.getParent)i.getParent().onItemClick(i,n)}return}}this._opened?r.focus&&(!1!==r.autoFocus||"mouseup"==n.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){r.focus();delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(n){this._stopClickEvents&&(n.stopPropagation(),n.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var n={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";u.add(this._arrowWrapperNode||this._buttonNode,"dijit"+n+"ArrowButton")},postCreate:function(){this.inherited(arguments);var n=this.focusNode||this.domNode;this.own(c(this._buttonNode,l.press,h.hitch(this,"_onDropDownMouseDown")),c(this._buttonNode,"click",h.hitch(this,"_onDropDownClick")),c(n,"keydown",h.hitch(this,"_onKey")),c(n,"keyup",h.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(n){if(!this.disabled&&!this.readOnly){var t=this.dropDown,i=n.target;t&&this._opened&&t.handleKey&&!1===t.handleKey(n)?(n.stopPropagation(),n.preventDefault()):t&&this._opened&&n.keyCode==s.ESCAPE?(this.closeDropDown(),n.stopPropagation(),n.preventDefault()):!this._opened&&(n.keyCode==s.DOWN_ARROW||(n.keyCode==s.ENTER||n.keyCode==s.SPACE&&(!this._searchTimer||n.ctrlKey||n.altKey||n.metaKey))&&("input"!==(i.tagName||"").toLowerCase()||i.type&&"text"!==i.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,n.stopPropagation(),n.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var n=this.dropDown;n&&n.focus&&this.defer(h.hitch(n,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(n){n()},loadAndOpenDropDown:function(){var n=new t,i=h.hitch(this,function(){this.openDropDown();n.resolve(this.dropDown)});return this.isLoaded()?i():this.loadDropDown(i),n},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var n=this.dropDown,i=n.domNode,t=this._aroundNode||this.domNode,e=this,s=y.open({parent:this,popup:n,around:t,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){e.closeDropDown(!0)},onCancel:function(){e.closeDropDown(!0)},onClose:function(){r.set(e._popupStateNode,"popupActive",!1);u.remove(e._popupStateNode,"dijitHasDropDownOpen");e._set("_opened",!1)}}),o;return(this.forceWidth||this.autoWidth&&t.offsetWidth>n._popupWrapper.offsetWidth)&&(t=t.offsetWidth-n._popupWrapper.offsetWidth,o={w:n.domNode.offsetWidth+t},this._origStyle=i.style.cssText,h.isFunction(n.resize)?n.resize(o):f.setMarginBox(i,o),"R"==s.corner[1]&&(n._popupWrapper.style.left=n._popupWrapper.style.left.replace("px","")-t+"px")),r.set(this._popupStateNode,"popupActive","true"),u.add(this._popupStateNode,"dijitHasDropDownOpen"),this._set("_opened",!0),this._popupStateNode.setAttribute("aria-expanded","true"),this._popupStateNode.setAttribute("aria-owns",n.id),"presentation"===i.getAttribute("role")||i.getAttribute("aria-labelledby")||i.setAttribute("aria-labelledby",this.id),s},closeDropDown:function(n){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),n&&this.focus&&this.focus(),y.close(this.dropDown),this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/_KeyNavContainer":function(){define("dijit/_KeyNavContainer","dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(n,t,i,r,u,f,e,o,s,h){return t("dijit._KeyNavContainer",[s,h,o],{connectKeyNavHandlers:function(t,i){var r=this._keyNavCodes={},e=f.hitch(this,"focusPrev"),o=f.hitch(this,"focusNext");n.forEach(t,function(n){r[n]=e});n.forEach(i,function(n){r[n]=o});r[u.HOME]=f.hitch(this,"focusFirstChild");r[u.END]=f.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){r.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);n.forEach(this.getChildren(),f.hitch(this,"_startupChild"))},addChild:function(n){this.inherited(arguments);this._startupChild(n)},_startupChild:function(n){n.set("tabIndex","-1")},_getFirst:function(){var n=this.getChildren();return n.length?n[0]:null},_getLast:function(){var n=this.getChildren();return n.length?n[n.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(n){return(n=e.byNode(n))&&n.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dijit/_KeyNavMixin","dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(n,t,i,r,u,f,e,o){return t("dijit._KeyNavMixin",o,{tabIndex:"0",childSelector:null,postCreate:function(){var t,n;this.inherited(arguments);i.set(this.domNode,"tabIndex",this.tabIndex);this._keyNavCodes||(n=this._keyNavCodes={},n[r.HOME]=u.hitch(this,"focusFirstChild"),n[r.END]=u.hitch(this,"focusLastChild"),n[this.isLeftToRight()?r.LEFT_ARROW:r.RIGHT_ARROW]=u.hitch(this,"_onLeftArrow"),n[this.isLeftToRight()?r.RIGHT_ARROW:r.LEFT_ARROW]=u.hitch(this,"_onRightArrow"),n[r.UP_ARROW]=u.hitch(this,"_onUpArrow"),n[r.DOWN_ARROW]=u.hitch(this,"_onDownArrow"));t=this;n="string"==typeof this.childSelector?this.childSelector:u.hitch(this,"childSelector");this.own(f(this.domNode,"keypress",u.hitch(this,"_onContainerKeypress")),f(this.domNode,"keydown",u.hitch(this,"_onContainerKeydown")),f(this.domNode,"focus",u.hitch(this,"_onContainerFocus")),f(this.containerNode,f.selector(n,"focusin"),function(n){t._onChildFocus(e.getEnclosingWidget(this),n)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(n,t){n&&(this.focusedChild&&n!==this.focusedChild&&this._onChildBlur(this.focusedChild),n.set("tabIndex",this.tabIndex),n.focus(t?"end":"start"))},_onContainerFocus:function(n){n.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){i.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(){i.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(n){n&&n!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),n.set("tabIndex",this.tabIndex),this.lastFocused=n,this._set("focusedChild",n))},_searchString:"",multiCharSearchDuration:1e3,onKeyboardSearch:function(n){n&&this.focusChild(n)},_keyboardSearchCompare:function(n,t){var i=n.domNode,i=(n.label||(i.focusNode?i.focusNode.label:"")||i.innerText||i.textContent||"").replace(/^\s+/,"").substr(0,t.length).toLowerCase();return t.length&&i==t?-1:0},_isFormElement:function(n){return"INPUT"===n.tagName||"TEXTAREA"===n.tagName||"SELECT"===n.tagName||"BUTTON"===n.tagName},_onContainerKeydown:function(n){if(!this._isFormElement(document.activeElement)){var t=this._keyNavCodes[n.keyCode];t?(t(n,this.focusedChild),n.stopPropagation(),n.preventDefault(),this._searchString=""):n.keyCode!=r.SPACE||!this._searchTimer||n.ctrlKey||n.altKey||n.metaKey||(n.stopImmediatePropagation(),n.preventDefault(),this._keyboardSearch(n," "))}},_onContainerKeypress:function(n){this._isFormElement(document.activeElement)||n.charCode<=r.SPACE||n.ctrlKey||n.altKey||n.metaKey||(n.preventDefault(),n.stopPropagation(),this._keyboardSearch(n,String.fromCharCode(n.charCode).toLowerCase()))},_keyboardSearch:function(n,t){var f=null,i,r=0;u.hitch(this,function(){var u,n,e;if(this._searchTimer&&this._searchTimer.remove(),this._searchString+=t,u=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length,i=this._searchString.substr(0,u),this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration),n=this.focusedChild||null,1!=u&&n||(n=this._getNextFocusableChild(n,1),n)){u=n;do{if(e=this._keyboardSearchCompare(n,i),e&&0==r++&&(f=n),-1==e){r=-1;break}n=this._getNextFocusableChild(n,1)}while(n&&n!=u)}})();this.onKeyboardSearch(f,n,i,r)},_onChildBlur:function(){},_getNextFocusableChild:function(n,t){var i=n;do{if(n)n=this._getNext(n,t);else if(n=this[0<t?"_getFirst":"_getLast"](),!n)break;if(null!=n&&n!=i&&n.isFocusable())return n}while(n!=i);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(n,t){if(n)for(n=n.domNode;n;)if((n=n[0>t?"previousSibling":"nextSibling"])&&"getAttribute"in n){var i=e.byNode(n);if(i)return i}return null}})})},"dijit/_MenuBase":function(){define("dijit/_MenuBase","dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){return t("dijit._MenuBase",[l,y,v,a],{selected:null,_setSelectedAttr:function(n){this.selected!=n&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),n&&n._setSelected(!0),this._set("selected",n))},activated:!1,_setActivatedAttr:function(n){u.toggle(this.domNode,"dijitMenuActive",n);u.toggle(this.domNode,"dijitMenuPassive",!n);this._set("activated",n)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(n){var t=c.byNode(n);return n.parentNode==this.containerNode&&t&&t.focus},postCreate:function(){var n=this,t="string"==typeof this.childSelector?this.childSelector:f.hitch(this,"childSelector");this.own(o(this.containerNode,o.selector(t,e.enter),function(){n.onItemHover(c.byNode(this))}),o(this.containerNode,o.selector(t,e.leave),function(){n.onItemUnhover(c.byNode(this))}),o(this.containerNode,o.selector(t,h),function(t){n.onItemClick(c.byNode(this),t);t.stopPropagation()}),o(this.containerNode,o.selector(t,"focusin"),function(){n._onItemFocus(c.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(n,t,i,r){if(this.inherited(arguments),n&&(-1==r||n.popup&&1==r))this.onItemClick(n,t)},_keyboardSearchCompare:function(n,t){return n.shortcutKey?t==n.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(n){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,n);else(n=this._getTopMenu())&&n._isMenuBar&&n.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(n){this.activated?(this.set("selected",n),!n.popup||n.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(n)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(n,{type:"click"})},this.passivePopupDelay));this._hoveredChild=n;n._set("hovering",!0)},_onChildDeselect:function(n){this._stopPopupTimer();this.currentPopupItem==n&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;n._closePopup()},this.popupDelay))},onItemUnhover:function(n){this._hoveredChild==n&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);n._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var n=this;n.parentMenu;n=n.parentMenu);return n},onItemClick:function(n,t){if(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.focusChild(n),n.disabled)return!1;if(n.popup){this.set("selected",n);this.set("activated",!0);var i=/^key/.test(t._origType||t.type)||0==t.clientX&&0==t.clientY;this._openItemPopup(n,i)}else this.onExecute(),n._onClick?n._onClick(t):n.onClick(t)},_openItemPopup:function(n,t){var r,i;n!=this.currentPopupItem&&(this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup()),this._stopPopupTimer(),r=n.popup,r.parentMenu=this,this.own(this._mouseoverHandle=o.once(r.domNode,"mouseover",f.hitch(this,"_onPopupHover"))),i=this,n._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){t&&i.focusChild(n);i._cleanUp()},onExecute:f.hitch(this,"_cleanUp",!0),onClose:function(){i._mouseoverHandle&&(i._mouseoverHandle.remove(),delete i._mouseoverHandle)}},t),this.currentPopupItem=n)},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(r.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(n){if(this._hoveredChild&&this._hoveredChild!=n)this.onItemUnhover(this._hoveredChild);this.set("selected",n)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(n){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);n&&this.set("selected",null)}})})},"dijit/_PaletteMixin":function(){define("dijit/_PaletteMixin","dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n("dijit._PaletteMixin",o,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(n){return new("string"==typeof this.dyeClass?f.getObject(this.dyeClass):this.dyeClass)(n)},_preparePalette:function(n,t){var y,o,p,h,l,i,a,v;for(this._cells=[],y=this._blankGif,this.own(e(this.gridNode,s,f.hitch(this,"_onCellClick"))),o=0;o<n.length;o++)for(p=r.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),h=0;h<n[o].length;h++)i=n[o][h],i&&(l=this._dyeFactory(i,o,h,t[i]),i=r.create("td",{"class":this.cellClass,tabIndex:"-1",title:t[i],role:"gridcell"},p),l.fillCell(i,y),i.idx=this._cells.length,this._cells.push({node:i,dye:l}));this._xDim=n[0].length;this._yDim=n.length;a={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1};for(v in a)this.own(c.addKeyListener(this.domNode,{keyCode:u[v],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var n=a[v];return function(t){this._navigateByKey(n,t)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){h.focus(this._currentFocus)},_onCellClick:function(n){for(var i,t=n.target;"TD"!=t.tagName;){if(!t.parentNode||t==this.gridNode)return;t=t.parentNode}i=this._getDye(t).getValue();this._setCurrent(t);h.focus(t);this._setValueAttr(i,!0);n.stopPropagation();n.preventDefault()},_setCurrent:function(n){"_currentFocus"in this&&t.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=n)&&t.set(n,"tabIndex",this.tabIndex)},_setValueAttr:function(n,t){if(0<=this._selectedCell&&i.remove(this._cells[this._selectedCell].node,this.cellClass+"Selected"),this._selectedCell=-1,n)for(var r=0;r<this._cells.length;r++)if(n==this._cells[r].dye.getValue()){this._selectedCell=r;i.add(this._cells[r].node,this.cellClass+"Selected");break}if(this._set("value",0<=this._selectedCell?n:null),t||void 0===t)this.onChange(n)},onChange:function(){},_navigateByKey:function(n,t){if(-1!=t){var i=this._currentFocus.idx+n;i<this._cells.length&&-1<i&&(i=this._cells[i].node,this._setCurrent(i),this.defer(f.hitch(h,"focus",i)))}},_getDye:function(n){return this._cells[n.idx].dye}})})},"dijit/_base":function(){define("dijit/_base","./main ./a11y ./WidgetSet ./_base/focus ./_base/manager ./_base/place ./_base/popup ./_base/scroll ./_base/sniff ./_base/typematic ./_base/wai ./_base/window".split(" "),function(n){return n._base})},"dijit/_base/focus":function(){define("dijit/_base/focus","dojo/_base/array dojo/dom dojo/_base/lang dojo/topic dojo/_base/window ../focus ../selection ../main".split(" "),function(n,t,i,r,u,f,e,o){f.focus=function(n){var t,i,e,r;if(n){if(t="node"in n?n.node:n,i=n.bookmark,n=n.openedForWindow,e=i?i.isCollapsed:!1,t){if(r="iframe"==t.tagName.toLowerCase()?t.contentWindow:t,r&&r.focus)try{r.focus()}catch(s){}f._onFocusNode(t)}if(i&&u.withGlobal(n||u.global,o.isCollapsed)&&!e){n&&n.focus();try{u.withGlobal(n||u.global,o.moveToBookmark,null,[i])}catch(s){}}}};f.watch("curNode",function(n,t,i){o._curFocus=i;o._prevFocus=t;i&&r.publish("focusNode",i)});f.watch("activeStack",function(n,t,i){o._activeStack=i});f.on("widget-blur",function(n,t){r.publish("widgetBlur",n,t)});f.on("widget-focus",function(n,t){r.publish("widgetFocus",n,t)});return i.mixin(o,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return o.getBookmark().isCollapsed},getBookmark:function(){return(u.global==window?e:new e.SelectionManager(u.global)).getBookmark()},moveToBookmark:function(n){return(u.global==window?e:new e.SelectionManager(u.global)).moveToBookmark(n)},getFocus:function(n,i){var r=!f.curNode||n&&t.isDescendant(f.curNode,n.domNode)?o._prevFocus:f.curNode;return{node:r,bookmark:r&&r==f.curNode&&u.withGlobal(i||u.global,o.getBookmark),openedForWindow:i}},_activeStack:[],registerIframe:function(n){return f.registerIframe(n)},unregisterIframe:function(n){n&&n.remove()},registerWin:function(n,t){return f.registerWin(n,t)},unregisterWin:function(n){n&&n.remove()}}),o})},"dijit/_base/popup":function(){define("dijit/_base/popup",["dojo/dom-class","dojo/_base/window","../popup","../BackgroundIframe"],function(n,t,i){var u=i._createWrapper,r;return i._createWrapper=function(i){return i.declaredClass||(i={_popupWrapper:i.parentNode&&n.contains(i.parentNode,"dijitPopup")?i.parentNode:null,domNode:i,destroy:function(){},ownerDocument:i.ownerDocument,ownerDocumentBody:t.body(i.ownerDocument)}),u.call(this,i)},r=i.open,i.open=function(n){if(n.orient&&"string"!=typeof n.orient&&!("length"in n.orient)){var t=[];for(var i in n.orient)t.push({aroundCorner:i,corner:n.orient[i]});n.orient=t}return r.call(this,n)},i})},"dijit/_base/place":function(){define("dijit/_base/place",["dojo/_base/array","dojo/_base/lang","dojo/window","../place","../main"],function(n,t,i,r,u){var f={getViewport:function(){return i.getBox()}};return f.placeOnScreen=r.at,f.placeOnScreenAroundElement=function(n,i,u,f){var e,o;if(t.isArray(u))e=u;else{e=[];for(o in u)e.push({aroundCorner:o,corner:u[o]})}return r.around(n,i,e,!0,f)},f.placeOnScreenAroundNode=f.placeOnScreenAroundElement,f.placeOnScreenAroundRectangle=f.placeOnScreenAroundElement,f.getPopupAroundAlignment=function(t,i){var r={};return n.forEach(t,function(n){var t=i;switch(n){case"after":r[i?"BR":"BL"]=i?"BL":"BR";break;case"before":r[i?"BL":"BR"]=i?"BR":"BL";break;case"below-alt":t=!t;case"below":r[t?"BL":"BR"]=t?"TL":"TR";r[t?"BR":"BL"]=t?"TR":"TL";break;case"above-alt":t=!t;default:r[t?"TL":"TR"]=t?"BL":"BR";r[t?"TR":"TL"]=t?"BR":"BL"}}),r},t.mixin(u,f),u})},"dijit/_base/scroll":function(){define("dijit/_base/scroll",["dojo/window","../main"],function(n,t){t.scrollIntoView=function(t,i){n.scrollIntoView(t,i)}})},"dijit/_base/sniff":function(){define("dijit/_base/sniff",["dojo/uacss"],function(){})},"dijit/_base/typematic":function(){define("dijit/_base/typematic",["../typematic"],function(){})},"dijit/_base/wai":function(){define("dijit/_base/wai",["dojo/dom-attr","dojo/_base/lang","../main","../hccss"],function(n,t,i){return t.mixin(i,{hasWaiRole:function(n,t){var i=this.getWaiRole(n);return t?-1<i.indexOf(t):0<i.length},getWaiRole:function(i){return t.trim((n.get(i,"role")||"").replace("wairole:",""))},setWaiRole:function(t,i){n.set(t,"role",i)},removeWaiRole:function(i,r){var u=n.get(i,"role");u&&(r?(u=t.trim((" "+u+" ").replace(" "+r+" "," ")),n.set(i,"role",u)):i.removeAttribute("role"))},hasWaiState:function(n,t){return n.hasAttribute?n.hasAttribute("aria-"+t):!!n.getAttribute("aria-"+t)},getWaiState:function(n,t){return n.getAttribute("aria-"+t)||""},setWaiState:function(n,t,i){n.setAttribute("aria-"+t,i)},removeWaiState:function(n,t){n.removeAttribute("aria-"+t)}}),i})},"dijit/_base/window":function(){define("dijit/_base/window",["dojo/window","../main"],function(n,t){t.getDocumentWindow=function(t){return n.get(t)}})},"dijit/form/Button":function(){require({cache:{"url:dijit/form/templates/Button.html":'<span class="dijit dijitReset dijitInline" role="presentation"\r\n\t><span class="dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event="ondijitclick:__onClick" role="presentation"\r\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point="titleNode,focusNode"\r\n\t\t\trole="button" aria-labelledby="${id}_label"\r\n\t\t\t><span class="dijitReset dijitInline dijitIcon" data-dojo-attach-point="iconNode"><\/span\r\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;<\/span\r\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid="${id}_label"\r\n\t\t\t\tdata-dojo-attach-point="containerNode"\r\n\t\t\t><\/span\r\n\t\t><\/span\r\n\t><\/span\r\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\r\n\t\tdata-dojo-attach-event="onclick:_onClick"\r\n\t\ttabIndex="-1" aria-hidden="true" data-dojo-attach-point="valueNode"\r\n/><\/span>\r\n'}});define("dijit/form/Button","require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),function(n,t,i,r,u,f,e,o,s,h){return r("dijit-legacy-requires")&&e(0,function(){n(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])}),e=t("dijit.form.Button"+(r("dojo-bidi")?"_NoBidi":""),[o,s],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:h,_setValueAttr:"valueNode",_setNameAttr:function(n){this.valueNode&&this.valueNode.setAttribute("name",n)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=f.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(n){this.containerNode&&i.toggle(this.containerNode,"dijitDisplayNone",!n);this._set("showLabel",n)},setLabel:function(n){u.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",n)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=f.trim(this.containerNode.innerText||this.containerNode.textContent||""))}}),r("dojo-bidi")&&(e=t("dijit.form.Button",e,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(n){this._created&&this.textDir!=n&&(this._set("textDir",n),this._setLabelAttr(this.label))}})),e})},"dijit/form/CheckBox":function(){require({cache:{"url:dijit/form/templates/CheckBox.html":'<div class="dijit dijitReset dijitInline" role="presentation"\r\n\t><input\r\n\t \t${!nameAttrSetting} type="${type}" role="${type}" aria-checked="false" ${checkedAttrSetting}\r\n\t\tclass="dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point="focusNode"\r\n\t \tdata-dojo-attach-event="ondijitclick:_onClick"\r\n/><\/div>\r\n'}});define("dijit/form/CheckBox","require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(n,t,i,r,u,f,e,o,s){return r("dijit-legacy-requires")&&f(0,function(){n(["dijit/form/RadioButton"])}),t("dijit.form.CheckBox",[e,o],{templateString:s,baseClass:"dijitCheckBox",_setValueAttr:function(n,t){"string"==typeof n&&(this.inherited(arguments),n=!0);this._created&&this.set("checked",n,t)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&u("label[for='"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&u("label[for='"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ComboButton":function(){require({cache:{"url:dijit/form/templates/ComboButton.html":'<table class="dijit dijitReset dijitInline dijitLeft"\r\n\tcellspacing=\'0\' cellpadding=\'0\' role="presentation"\r\n\t><tbody role="presentation"><tr role="presentation"\r\n\t\t><td class="dijitReset dijitStretch dijitButtonNode" data-dojo-attach-point="buttonNode" data-dojo-attach-event="ondijitclick:__onClick,onkeydown:_onButtonKeyDown"\r\n\t\t><div id="${id}_button" class="dijitReset dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point="titleNode"\r\n\t\t\trole="button" aria-labelledby="${id}_label"\r\n\t\t\t><div class="dijitReset dijitInline dijitIcon" data-dojo-attach-point="iconNode" role="presentation"><\/div\r\n\t\t\t><div class="dijitReset dijitInline dijitButtonText" id="${id}_label" data-dojo-attach-point="containerNode" role="presentation"><\/div\r\n\t\t><\/div\r\n\t\t><\/td\r\n\t\t><td id="${id}_arrow" class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\r\n\t\t\tdata-dojo-attach-point="_popupStateNode,focusNode,_buttonNode"\r\n\t\t\tdata-dojo-attach-event="onkeydown:_onArrowKeyDown"\r\n\t\t\ttitle="${optionsTitle}"\r\n\t\t\trole="button" aria-haspopup="true"\r\n\t\t\t><div class="dijitReset dijitArrowButtonInner" role="presentation"><\/div\r\n\t\t\t><div class="dijitReset dijitArrowButtonChar" role="presentation">&#9660;<\/div\r\n\t\t><\/td\r\n\t\t><td style="display:none !important;"\r\n\t\t\t><input ${!nameAttrSetting} type="${type}" value="${value}" data-dojo-attach-point="valueNode"\r\n\t\t\t\tclass="dijitOffScreen" aria-hidden="true" data-dojo-attach-event="onclick:_onClick"\r\n\t\t/><\/td><\/tr><\/tbody\r\n><\/table>\r\n'}});define("dijit/form/ComboButton","dojo/_base/declare dojo/keys ../focus ./DropDownButton dojo/text!./templates/ComboButton.html ../a11yclick".split(" "),function(n,t,i,r,u){return n("dijit.form.ComboButton",r,{templateString:u,_setIdAttr:"",_setTabIndexAttr:["focusNode","titleNode"],_setTitleAttr:"titleNode",optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyDown:function(n){n.keyCode==t[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]&&(i.focus(this._popupStateNode),n.stopPropagation(),n.preventDefault())},_onArrowKeyDown:function(n){n.keyCode==t[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]&&(i.focus(this.titleNode),n.stopPropagation(),n.preventDefault())},focus:function(n){this.disabled||i.focus("start"==n?this.titleNode:this._popupStateNode)}})})},"dijit/form/DropDownButton":function(){require({cache:{"url:dijit/form/templates/DropDownButton.html":'<span class="dijit dijitReset dijitInline"\r\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\r\n\t\tdata-dojo-attach-event="ondijitclick:__onClick" data-dojo-attach-point="_buttonNode"\r\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point="focusNode,titleNode,_arrowWrapperNode,_popupStateNode"\r\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\r\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\r\n\t\t\t\tdata-dojo-attach-point="iconNode"\r\n\t\t\t><\/span\r\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tdata-dojo-attach-point="containerNode"\r\n\t\t\t\tid="${id}_label"\r\n\t\t\t><\/span\r\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"><\/span\r\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;<\/span\r\n\t\t><\/span\r\n\t><\/span\r\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen" tabIndex="-1"\r\n\t\tdata-dojo-attach-event="onclick:_onClick" data-dojo-attach-point="valueNode" aria-hidden="true"\r\n/><\/span>\r\n'}});define("dijit/form/DropDownButton","dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/query ../registry ../popup ./Button ../_Container ../_HasDropDown dojo/text!./templates/DropDownButton.html ../a11yclick".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n("dijit.form.DropDownButton",[e,o,s],{baseClass:"dijitDropDownButton",templateString:h,_fillContent:function(){var i=this.srcNodeRef,r=this.containerNode,n;if(i&&r)for(;i.hasChildNodes();)n=i.firstChild,n.hasAttribute&&(n.hasAttribute("data-dojo-type")||n.hasAttribute("dojoType")||n.hasAttribute("data-"+t._scopeName+"-type")||n.hasAttribute(t._scopeName+"Type"))?(this.dropDownContainer=this.ownerDocument.createElement("div"),this.dropDownContainer.appendChild(n)):r.appendChild(n)},startup:function(){this._started||(!this.dropDown&&this.dropDownContainer&&(this.dropDown=u.byNode(this.dropDownContainer.firstChild),delete this.dropDownContainer),this.dropDown&&f.hide(this.dropDown),this.inherited(arguments))},isLoaded:function(){var n=this.dropDown;return!!n&&(!n.href||n.isLoaded)},loadDropDown:function(n){var t=this.dropDown,r=t.on("load",i.hitch(this,function(){r.remove();n()}));t.refresh()},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}})})},"dijit/form/RadioButton":function(){define("dijit/form/RadioButton",["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(n,t,i){return n("dijit.form.RadioButton",[t,i],{baseClass:"dijitRadio"})})},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":'<table class="dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point="_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing=\'0\' cellpadding=\'0\'\r\n\trole="listbox" aria-haspopup="true"\r\n\t><tbody role="presentation"><tr role="presentation"\r\n\t\t><td class="dijitReset dijitStretch dijitButtonContents" role="presentation"\r\n\t\t\t><div class="dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point="containerNode,textDirNode" role="presentation"><\/div\r\n\t\t\t><div class="dijitReset dijitValidationContainer"\r\n\t\t\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\r\n\t\t\t/><\/div\r\n\t\t\t><input type="hidden" ${!nameAttrSetting} data-dojo-attach-point="valueNode" value="${value}" aria-hidden="true"\r\n\t\t/><\/td\r\n\t\t><td class="dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point="titleNode" role="presentation"\r\n\t\t\t><input class="dijitReset dijitInputField dijitArrowButtonInner" value="&#9660; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/><\/td\r\n\t><\/tr><\/tbody\r\n><\/table>\r\n'}});define("dijit/form/Select","dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){function d(n){return function(t){this._isLoaded?this.inherited(n,arguments):this.loadDropDown(o.hitch(this,n,t))}}var g=t("dijit.form._SelectMenu",a,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(s(this.domNode,"selectstart",function(n){n.preventDefault();n.stopPropagation()}))},focus:function(){var i=!1,t=this.parentWidget.value;o.isArray(t)&&(t=t[t.length-1]);t&&n.forEach(this.parentWidget._getChildren(),function(n){n.option&&t===n.option.value&&(i=!0,this.focusChild(n,!1))},this);i||this.inherited(arguments)}});return u=t("dijit.form.Select"+(h("dojo-bidi")?"_NoBidi":""),[c,l,w],{baseClass:"dijitSelect dijitValidationTextBox",templateString:k,_buttonInputDisabled:h("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){if(this.inherited(arguments),this.options.length&&!this.value&&this.srcNodeRef){var n=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=n?n:0].value)}this.dropDown=new g({id:this.id+"_menu",parentWidget:this});r.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(n){if(n.value||n.label){var t=o.hitch(this,"_setValueAttr",n);return n=new v({option:n,label:("text"===this.labelType?(n.label||"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;"):n.label)||this.emptyLabel,onClick:t,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:n.disabled||!1}),n.focusNode.setAttribute("role","option"),n}return new y({ownerDocument:this.ownerDocument})},_addOptionItem:function(n){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(n))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(n){}},focusChild:function(n){n&&this.set("value",n.option)},_getFirst:function(){var n=this._getChildren();return n.length?n[0]:null},_getLast:function(){var n=this._getChildren();return n.length?n[n.length-1]:null},childSelector:function(n){return(n=b.byNode(n))&&n.getParent()==this.dropDown},onKeyboardSearch:function(n){n&&this.focusChild(n)},_loadChildren:function(t){if(!0===t)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{n.forEach(this._getChildren(),function(n){n.destroyRecursive()});var i=new v({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(i)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(){this.inherited(arguments);i.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(n){this._set("required",n);this.focusNode.setAttribute("aria-required",n);this._refreshState()},_setOptionsAttr:function(n){this._isLoaded=!1;this._set("options",n)},_setDisplay:function(n){n=("text"===this.labelType?(n||"").replace(/&/g,"&amp;").replace(/</g,"&lt;"):n)||this.emptyLabel;this.containerNode.innerHTML='<span role="option" aria-selected="true" class="dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'">'+n+"<\/span>"},validate:function(n){n=this.disabled||this.isValid(n);this._set("state",n?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",n?"false":"true");var t=n?"":this._missingMsg;return t&&this.focused&&this._hasBeenBlurred?p.show(t,this.domNode,this.tooltipPosition,!this.isLeftToRight()):p.hide(this.domNode),this._set("message",t),n},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);p.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=f.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(s(this.domNode,"selectstart",function(n){n.preventDefault();n.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var n=this._keyNavCodes;delete n[e.LEFT_ARROW];delete n[e.RIGHT_ARROW]},_setStyleAttr:function(){this.inherited(arguments);r.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(n){this._loadChildren(!0);this._isLoaded=!0;n()},destroy:function(n){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(n),delete this.dropDown);p.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){p.hide(this.domNode);this.inherited(arguments);this.validate(!1)}}),h("dojo-bidi")&&(u=t("dijit.form.Select",u,{_setDisplay:function(){this.inherited(arguments);this.applyTextDir(this.containerNode)}})),u._Menu=g,u.prototype._onContainerKeydown=d("_onContainerKeydown"),u.prototype._onContainerKeypress=d("_onContainerKeypress"),u})},"dijit/form/TextBox":function(){require({cache:{"url:dijit/form/templates/TextBox.html":'<div class="dijit dijitReset dijitInline dijitLeft" id="widget_${id}" role="presentation"\r\n\t><div class="dijitReset dijitInputField dijitInputContainer"\r\n\t\t><input class="dijitReset dijitInputInner" data-dojo-attach-point=\'textbox,focusNode\' autocomplete="off"\r\n\t\t\t${!nameAttrSetting} type=\'${type}\'\r\n\t/><\/div\r\n><\/div>\r\n'}});define("dijit/form/TextBox","dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return o=n("dijit.form.TextBox"+(e("dojo-bidi")?"_NoBidi":""),[o,s],{templateString:h,_singleNodeTemplate:'<input class="dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point="textbox,focusNode" autocomplete="off" type="${type}" ${!nameAttrSetting} />',_buttonInputDisabled:e("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var n=this.type.toLowerCase();(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==n||"file"==n)&&this.templateString==this.constructor.prototype.templateString)&&(this.templateString=this._singleNodeTemplate);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>e("ie")&&this.defer(function(){var n,r,t;try{if(n=i.getComputedStyle(this.domNode),n&&(r=n.fontFamily,r&&(t=this.domNode.getElementsByTagName("INPUT"),t)))for(n=0;n<t.length;n++)t[n].style.fontFamily=r}catch(u){}})},_setPlaceHolderAttr:function(n){this._set("placeHolder",n);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=t.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(f(this._phspan,"mousedown",function(n){n.preventDefault()}),f(this._phspan,"touchend, pointerup, MSPointerUp",u.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(n));this._updatePlaceHolder()},_onInput:function(){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){return r.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0"),this.get("displayedValue")},setDisplayedValue:function(n){r.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",n)},_onBlur:function(){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),e("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}}),9>e("ie")&&(o.prototype._isTextSelected=function(){var n=this.ownerDocument.selection.createRange();return n.parentElement()==this.textbox&&0<n.text.length},c._setSelectionRange=s._setSelectionRange=function(n,t,i){n.createTextRange&&(n=n.createTextRange(),n.collapse(!0),n.moveStart("character",-99999),n.moveStart("character",t),n.moveEnd("character",i-t),n.select())}),e("dojo-bidi")&&(o=n("dijit.form.TextBox",o,{_setPlaceHolderAttr:function(){this.inherited(arguments);this.applyTextDir(this._phspan)}})),o})},"dijit/form/ToggleButton":function(){define("dijit/form/ToggleButton",["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(n,t,i,r){return n("dijit.form.ToggleButton",[i,r],{baseClass:"dijitToggleButton",setChecked:function(n){t.deprecated("setChecked("+n+") is deprecated. Use set('checked',"+n+") instead.","","2.0");this.set("checked",n)}})})},"dijit/form/ValidationTextBox":function(){require({cache:{"url:dijit/form/templates/ValidationTextBox.html":'<div class="dijit dijitReset dijitInline dijitLeft"\r\n\tid="widget_${id}" role="presentation"\r\n\t><div class=\'dijitReset dijitValidationContainer\'\r\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\r\n\t/><\/div\r\n\t><div class="dijitReset dijitInputField dijitInputContainer"\r\n\t\t><input class="dijitReset dijitInputInner" data-dojo-attach-point=\'textbox,focusNode\' autocomplete="off"\r\n\t\t\t${!nameAttrSetting} type=\'${type}\'\r\n\t/><\/div\r\n><\/div>\r\n'}});define("dijit/form/ValidationTextBox","dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(n,t,i,r,u,f,e){var o=n("dijit.form.ValidationTextBox",u,{templateString:e,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(n,i){i!=o.prototype[n]&&(t.deprecated("ValidationTextBox id="+this.id+", set('"+n+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",i))},_setRegExpGenAttr:function(n){this._deprecateRegExp("regExpGen",n);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(n){this._deprecateRegExp("regExp",n)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(n,t){return new RegExp("^(?:"+this._computeRegexp(t)+")"+(this.required?"":"?")+"$").test(n)&&(!this.required||!this._isEmpty(n))&&(this._isEmpty(n)||void 0!==this.parse(n,t))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(n){return(this.trim?/^\s*$/:/^$/).test(n)},getErrorMessage:function(){var n="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,t="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:n;return this.required&&this._isEmpty(this.textbox.value)?t:n},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(n){var t="",i=this.disabled||this.isValid(n),u,r;return i&&(this._maskValidSubsetError=!0),u=this._isEmpty(this.textbox.value),r=!i&&n&&this._isValidSubset(),this._set("state",i?"":((!this._hasBeenBlurred||n)&&u||r)&&(this._maskValidSubsetError||r&&!this._hasBeenBlurred&&n)?"Incomplete":"Error"),this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false"),"Error"==this.state?(this._maskValidSubsetError=n&&r,t=this.getErrorMessage(n)):"Incomplete"==this.state?(t=this.getPromptMessage(n),this._maskValidSubsetError=!this._hasBeenBlurred||n):u&&(t=this.getPromptMessage(n)),this.set("message",t),i},displayMessage:function(n){n&&this.focused?f.show(n,this.domNode,this.tooltipPosition,!this.isLeftToRight()):f.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(){this.constraints=i.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(n){!n.locale&&this.lang&&(n.locale=this.lang);this._set("constraints",n);this._refreshState()},_setPatternAttr:function(n){this._set("pattern",n);this._refreshState()},_computeRegexp:function(n){var t=this.pattern,i;if("function"==typeof t&&(t=t.call(this,n)),t!=this._lastRegExp){i="";this._lastRegExp=t;".*"!=t&&t.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(n){switch(n.charAt(0)){case"{":case"+":case"?":case"*":case"^":case"$":case"|":case"(":i+=n;break;case")":i+="|$)";break;default:i+="(?:"+n+"|$)"}});try{"".search(i)}catch(r){i=this.pattern;console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+i+")$"}return t},postMixInProperties:function(){this.inherited(arguments);this.messages=r.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(n){this._set("required",n);this.focusNode.setAttribute("aria-required",n);this._refreshState()},_setMessageAttr:function(n){this._set("message",n);this.displayMessage(n)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){f.hide(this.domNode);this.inherited(arguments)}});return o})},"dijit/form/_ButtonMixin":function(){define("dijit/form/_ButtonMixin",["dojo/_base/declare","dojo/dom","dojo/has","../registry"],function(n,t,i,r){var u=n("dijit.form._ButtonMixin"+(i("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(n){return n.stopPropagation(),n.preventDefault(),this.disabled||this.valueNode.click(n),!1},_onClick:function(n){var i,t,u;if(this.disabled)return n.stopPropagation(),n.preventDefault(),!1;if(!1===this.onClick(n)&&n.preventDefault(),i=n.defaultPrevented,!i&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(t=this.domNode;t.parentNode;t=t.parentNode)if(u=r.byNode(t),u&&"function"==typeof u._onSubmit){u._onSubmit(n);n.preventDefault();i=!0;break}return!i},postCreate:function(){this.inherited(arguments);t.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(n){this._set("label",n);(this.containerNode||this.focusNode).innerHTML=n;this.onLabelSet()},onLabelSet:function(){}});return i("dojo-bidi")&&(u=n("dijit.form._ButtonMixin",u,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}})),u})},"dijit/form/_CheckBoxMixin":function(){define("dijit/form/_CheckBoxMixin",["dojo/_base/declare","dojo/dom-attr"],function(n,t){return n("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(n){this._set("readOnly",n);t.set(this.focusNode,"readOnly",n)},_setLabelAttr:void 0,_getSubmitValue:function(n){return null==n||""===n?"on":n},_setValueAttr:function(n){n=this._getSubmitValue(n);this._set("value",n);t.set(this.focusNode,"value",n)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));t.set(this.focusNode,"value",this.value)},_onClick:function(n){return this.readOnly?(n.stopPropagation(),n.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/_FormMixin":function(){define("dijit/form/_FormMixin","dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/on dojo/window".split(" "),function(n,t,i,r,u,f){return t("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(t){var i=[];return n.forEach(t||this.getChildren(),function(n){"value"in n?i.push(n):i=i.concat(this._getDescendantFormWidgets(n.getChildren()))},this),i},reset:function(){n.forEach(this._getDescendantFormWidgets(),function(n){n.reset&&n.reset()})},validate:function(){var t=!1;return n.every(n.map(this._getDescendantFormWidgets(),function(n){n._hasBeenBlurred=!0;var i=n.disabled||!n.validate||n.validate();return i||t||(f.scrollIntoView(n.containerNode||n.domNode),n.focus(),t=!0),i}),function(n){return n})},setValues:function(n){return i.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0"),this.set("value",n)},_setValueAttr:function(t){var f={},e,u,i;n.forEach(this._getDescendantFormWidgets(),function(n){n.name&&(f[n.name]||(f[n.name]=[])).push(n)});for(e in f)f.hasOwnProperty(e)&&(u=f[e],i=r.getObject(e,!1,t),void 0!==i&&(i=[].concat(i),"boolean"==typeof u[0].checked?n.forEach(u,function(t){t.set("value",-1!=n.indexOf(i,t._get("value")))}):u[0].multiple?u[0].set("value",i):n.forEach(u,function(n,t){n.set("value",i[t])})))},getValues:function(){return i.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0"),this.get("value")},_getValueAttr:function(){var t={};return n.forEach(this._getDescendantFormWidgets(),function(n){var u=n.name,i;u&&!n.disabled&&(i=n.get("value"),"boolean"==typeof n.checked?/Radio/.test(n.declaredClass)?!1!==i?r.setObject(u,i,t):(i=r.getObject(u,!1,t),void 0===i&&r.setObject(u,null,t)):(n=r.getObject(u,!1,t),n||(n=[],r.setObject(u,n,t)),!1!==i&&n.push(i)):(n=r.getObject(u,!1,t),"undefined"!=typeof n?r.isArray(n)?n.push(i):r.setObject(u,[n,i],t):r.setObject(u,i,t)))}),t},isValid:function(){return""==this.state},onValidStateChange:function(){},_getState:function(){var t=n.map(this._descendants,function(n){return n.get("state")||""});return 0<=n.indexOf(t,"Error")?"Error":0<=n.indexOf(t,"Incomplete")?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(t){this._descendants=this._getDescendantFormWidgets();n.forEach(this._descendants,function(n){n._started||n.startup()});t||this._onChildChange()},_onChildChange:function(n){n&&"state"!=n&&"disabled"!=n||this._set("state",this._getState());n&&"value"!=n&&"disabled"!=n&&"checked"!=n||(this._onChangeDelayTimer&&this._onChangeDelayTimer.remove(),this._onChangeDelayTimer=this.defer(function(){delete this._onChangeDelayTimer;this._set("value",this.get("value"))},10))},startup:function(){this.inherited(arguments);this._descendants=this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var n=this;this.own(u(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(t){t.target!=n.domNode&&n._onChildChange(t.type.replace("attrmodified-",""))}));this.watch("state",function(n,t,i){this.onValidStateChange(""==i)})},destroy:function(){this.inherited(arguments)}})})},"dijit/form/_FormValueMixin":function(){define("dijit/form/_FormValueMixin","dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on ./_FormWidgetMixin".split(" "),function(n,t,i,r,u,f){return n("dijit.form._FormValueMixin",f,{readOnly:!1,_setReadOnlyAttr:function(n){t.set(this.focusNode,"readOnly",n);this._set("readOnly",n)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(n,t){this._handleOnChange(n,t)},_handleOnChange:function(n){this._set("value",n);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/form/_FormValueWidget":function(){define("dijit/form/_FormValueWidget",["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(n,t,i,r){return n("dijit.form._FormValueWidget",[i,r],{_layoutHackIE7:function(){if(7==t("ie"))for(var i=this.domNode,n=i.parentNode,r=i.firstChild||i,f=r.style.filter,u=this;n&&0==n.clientHeight;)(function(){var t=u.connect(n,"onscroll",function(){u.disconnect(t);r.style.filter=(new Date).getMilliseconds();u.defer(function(){r.style.filter=f})})})(),n=n.parentNode}})})},"dijit/form/_FormWidget":function(){define("dijit/form/_FormWidget","dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),function(n,t,i,r,u,f,e,o){return t("dijit-legacy-requires")&&r(0,function(){require(["dijit/form/_FormValueWidget"])}),n("dijit.form._FormWidget",[u,e,f,o],{setDisabled:function(n){i.deprecated("setDisabled("+n+") is deprecated. Use set('disabled',"+n+") instead.","","2.0");this.set("disabled",n)},setValue:function(n){i.deprecated("dijit.form._FormWidget:setValue("+n+") is deprecated.  Use set('value',"+n+") instead.","","2.0");this.set("value",n)},getValue:function(){return i.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0"),this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!t("msapp")?'name="'+this.name.replace(/"/g,"&quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dijit/form/_FormWidgetMixin","dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(n,t,i,r,u,f,e,o,s,h){return t("dijit.form._FormWidgetMixin",null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(t){this._set("disabled",t);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?i.set(this.focusNode,"disabled",t):this.focusNode.setAttribute("aria-disabled",t?"true":"false");this.valueNode&&i.set(this.valueNode,"disabled",t);t?(this._set("hovering",!1),this._set("active",!1),t="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",n.forEach(u.isArray(t)?t:[t],function(n){n=this[n];o("webkit")||h.hasDefaultTabStop(n)?n.setAttribute("tabIndex","-1"):n.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(n){if("mouse"==n&&this.isFocusable())var t=this.own(e(this.focusNode,"focus",function(){i.remove();t.remove()}))[0],r=o("pointer-events")?"pointerup":o("MSPointer")?"MSPointerUp":o("touch-events")?"touchend, mouseup":"mouseup",i=this.own(e(this.ownerDocumentBody,r,u.hitch(this,function(n){i.remove();t.remove();this.focused&&("touchend"==n.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){s.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=r.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(n){}},compare:function(n,t){return"number"==typeof n&&"number"==typeof t?isNaN(n)&&isNaN(t)?0:n-t:n>t?1:n<t?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(n,t){void 0!=this._lastValueReported||null!==t&&this._onChangeActive||(this._resetValue=this._lastValueReported=n);this._pendingOnChange=this._pendingOnChange||typeof n!=typeof this._lastValueReported||0!=this.compare(n,this._lastValueReported);(this.intermediateChanges||t||void 0===t)&&this._pendingOnChange&&(this._lastValueReported=n,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(n)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_RadioButtonMixin":function(){define("dijit/form/_RadioButtonMixin","dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(n,t,i,r,u,f){return t("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var n=[];return u("input[type=radio]",this.focusNode.form||this.ownerDocument).forEach(r.hitch(this,function(t){t.name==this.name&&t.form==this.focusNode.form&&(t=f.getEnclosingWidget(t))&&n.push(t)})),n},_setCheckedAttr:function(t){this.inherited(arguments);this._created&&t&&n.forEach(this._getRelatedWidgets(),r.hitch(this,function(n){n!=this&&n.checked&&n.set("checked",!1)}))},_getSubmitValue:function(n){return null==n?"on":n},_onClick:function(t){if(this.checked||this.disabled)return t.stopPropagation(),t.preventDefault(),!1;if(this.readOnly)return t.stopPropagation(),t.preventDefault(),n.forEach(this._getRelatedWidgets(),r.hitch(this,function(n){i.set(this.focusNode||this.domNode,"checked",n.checked)})),!1;var f=!1,u;return n.some(this._getRelatedWidgets(),function(n){return n.checked?(u=n,!0):!1}),this.checked=!0,u&&(u.checked=!1),(!1===this.onClick(t)||t.defaultPrevented)&&(f=!0),this.checked=!1,u&&(u.checked=!0),f?t.preventDefault():this.set("checked",!0),!f}})})},"dijit/form/_TextBoxMixin":function(){define("dijit/form/_TextBoxMixin","dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(n,t,i,r,u,f,e,o){var s=t("dijit.form._TextBoxMixin"+(r("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(n,t,i){var r;void 0!==n&&(r=this.filter(n),"string"!=typeof i&&(i=null===r||"number"==typeof r&&isNaN(r)?"":this.filter(this.format(r,this.constraints)),0!=this.compare(r,this.filter(this.parse(i,this.constraints)))&&(i=null)));null==i||"number"==typeof i&&isNaN(i)||this.textbox.value==i||(this.textbox.value=i,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[r,t])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(n){null==n?n="":"string"!=typeof n&&(n=String(n));this.textbox.value=n;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(n){return null==n?"":n.toString?n.toString():n},parse:function(n){return n},_refreshState:function(){},onInput:function(){},_onInput:function(n){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||n);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(e(this.textbox,"keydown, keypress, paste, cut, compositionend",f.hitch(this,function(n){var t,o,i,s;if("keydown"==n.type&&229!=n.keyCode){t=n.keyCode;switch(t){case u.SHIFT:case u.ALT:case u.CTRL:case u.META:case u.CAPS_LOCK:case u.NUM_LOCK:case u.SCROLL_LOCK:return}if(!n.ctrlKey&&!n.metaKey&&!n.altKey){switch(t){case u.NUMPAD_0:case u.NUMPAD_1:case u.NUMPAD_2:case u.NUMPAD_3:case u.NUMPAD_4:case u.NUMPAD_5:case u.NUMPAD_6:case u.NUMPAD_7:case u.NUMPAD_8:case u.NUMPAD_9:case u.NUMPAD_MULTIPLY:case u.NUMPAD_PLUS:case u.NUMPAD_ENTER:case u.NUMPAD_MINUS:case u.NUMPAD_PERIOD:case u.NUMPAD_DIVIDE:return}if(65<=t&&90>=t||48<=t&&57>=t||t==u.SPACE)return;t=!1;for(o in u)if(u[o]===n.keyCode){t=!0;break}if(!t)return}}if((t=32<=n.charCode?String.fromCharCode(n.charCode):n.charCode)||(t=65<=n.keyCode&&90>=n.keyCode||48<=n.keyCode&&57>=n.keyCode||n.keyCode==u.SPACE?String.fromCharCode(n.keyCode):n.keyCode),t||(t=229),"keypress"==n.type){if("string"!=typeof t)return;if(("a"<=t&&"z">=t||"A"<=t&&"Z">=t||"0"<=t&&"9">=t||" "===t)&&(n.ctrlKey||n.metaKey||n.altKey))return}i={faux:!0};for(s in n)/^(layer[XY]|returnValue|keyLocation)$/.test(s)||(o=n[s],"function"!=typeof o&&"undefined"!=typeof o&&(i[s]=o));if(f.mixin(i,{charOrCode:t,_wasConsumed:!1,preventDefault:function(){i._wasConsumed=!0;n.preventDefault()},stopPropagation:function(){n.stopPropagation()}}),this._lastInputProducingEvent=i,!1===this.onInput(i)&&(i.preventDefault(),i.stopPropagation()),!i._wasConsumed&&9>=r("ie"))switch(n.keyCode){case u.TAB:case u.ESCAPE:case u.DOWN_ARROW:case u.UP_ARROW:case u.LEFT_ARROW:case u.RIGHT_ARROW:break;default:n.keyCode==u.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&e.emit(this.textbox,"input",{bubbles:!0})})}})),e(this.textbox,"input",f.hitch(this,"_onInput")),e(this.domNode,"keypress",function(n){n.stopPropagation()}))},_blankValue:"",filter:function(n){return null===n?this._blankValue:"string"!=typeof n?n:(this.trim&&(n=f.trim(n)),this.uppercase&&(n=n.toUpperCase()),this.lowercase&&(n=n.toLowerCase()),this.propercase&&(n=n.replace(/[^\s]+/g,function(n){return n.substring(0,1).toUpperCase()+n.substring(1)})),n)},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(n){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==n&&(this._selectOnClickHandle=e.once(this.domNode,"mouseup, touchend",f.hitch(this,function(){this._isTextSelected()||s.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});return r("dojo-bidi")&&(s=t("dijit.form._TextBoxMixin",s,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}})),s._setSelectionRange=o._setSelectionRange=function(n,t,i){n.setSelectionRange&&n.setSelectionRange(t,i)},s.selectInputText=o.selectInputText=function(n,t,r){n=i.byId(n);isNaN(t)&&(t=0);isNaN(r)&&(r=n.value?n.value.length:0);try{n.focus();s._setSelectionRange(n,t,r)}catch(u){}},s})},"dijit/form/_ToggleButtonMixin":function(){define("dijit/form/_ToggleButtonMixin",["dojo/_base/declare","dojo/dom-attr"],function(n,t){return n("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(){var t=this.checked,n;return this._set("checked",!t),n=this.inherited(arguments),this.set("checked",n?this.checked:t),n},_setCheckedAttr:function(n,i){this._set("checked",n);var r=this.focusNode||this.domNode;this._created&&t.get(r,"checked")!=!!n&&t.set(r,"checked",!!n);r.setAttribute(this._aria_attr,String(n));this._handleOnChange(n,i)},postCreate:function(){this.inherited(arguments);var n=this.focusNode||this.domNode;this.checked&&n.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget","dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return u("dijit.form._FormSelectWidget",a,{multiple:!1,options:null,store:null,_setStoreAttr:function(n){this._created&&this._deprecatedSetStore(n)},query:null,_setQueryAttr:function(n){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:n})},queryOptions:null,_setQueryOptionsAttr:function(n){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:n})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,onLoadDeferred:null,getOptions:function(t){var i=this.options||[];return null==t?i:s.isArrayLike(t)?n.map(t,"return this.getOptions(item);",this):(s.isString(t)&&(t={value:t}),s.isObject(t)&&(n.some(i,function(n,i){for(var r in t)if(!(r in n)||n[r]!=t[r])return!1;return t=i,!0})||(t=-1)),0<=t&&t<i.length?i[t]:null)},addOption:function(t){n.forEach(s.isArrayLike(t)?t:[t],function(n){n&&s.isObject(n)&&this.options.push(n)},this);this._loadChildren()},removeOption:function(t){t=this.getOptions(s.isArrayLike(t)?t:[t]);n.forEach(t,function(t){t&&(this.options=n.filter(this.options,function(n){return n.value!==t.value||n.label!==t.label}),this._removeOptionItem(t))},this);this._loadChildren()},updateOption:function(t){n.forEach(s.isArrayLike(t)?t:[t],function(n){var i=this.getOptions({value:n.value}),t;if(i)for(t in n)i[t]=n[t]},this);this._loadChildren()},setStore:function(n,t,i){o.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.","","2.0");this._deprecatedSetStore(n,t,i)},_deprecatedSetStore:function(u,f,e){var o=this.store,h;if(e=e||{},o!==u){for(;h=this._notifyConnections.pop();)h.remove();u.get||(s.mixin(u,{_oldAPI:!0,get:function(n){var i=new t;return this.fetchItemByIdentity({identity:n,onItem:function(n){i.resolve(n)},onError:function(n){i.reject(n)}}),i.promise},query:function(n,i){var r=new t(function(){u.abort&&u.abort()}),u;return r.total=new t,u=this.fetch(s.mixin({query:n,onBegin:function(n){r.total.resolve(n)},onComplete:function(n){r.resolve(n)},onError:function(n){r.reject(n)}},i)),new l(r)}}),u.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[i.after(u,"onNew",s.hitch(this,"_onNewItem"),!0),i.after(u,"onDelete",s.hitch(this,"_onDeleteItem"),!0),i.after(u,"onSet",s.hitch(this,"_onSetItem"),!0)]));this._set("store",u)}return this.options&&this.options.length&&this.removeOption(this.options),this._queryRes&&this._queryRes.close&&this._queryRes.close(),this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null),e.query&&this._set("query",e.query),e.queryOptions&&this._set("queryOptions",e.queryOptions),u&&u.query&&(this._loadingStore=!0,this.onLoadDeferred=new t,this._queryRes=u.query(this.query,this.queryOptions),c(this._queryRes,s.hitch(this,function(t){if(this.sortByLabel&&!e.sort&&t.length)if(u.getValue)t.sort(r.createSortFunction([{attribute:u.getLabelAttributes(t[0])[0]}],u));else{var i=this.labelAttr;t.sort(function(n,t){return n[i]>t[i]?1:t[i]>n[i]?-1:0})}e.onFetch&&(t=e.onFetch.call(this,t,e));n.forEach(t,function(n){this._addOptionForItem(n)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(s.hitch(this,function(n,t,i){t==i?this._onSetItem(n):(-1!=t&&this._onDeleteItem(n),-1!=i&&this._onNewItem(n))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:f);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(t):this._loadChildren();this.onLoadDeferred.resolve(!0);this.onSetStore()}),s.hitch(this,function(n){console.error("dijit.form.Select: "+n.toString());this.onLoadDeferred.reject(n)}))),o},_setValueAttr:function(t,i){var r,u;this._onChangeActive||(i=null);this._loadingStore?this._pendingValue=t:null!=t&&(t=s.isArrayLike(t)?n.map(t,function(n){return s.isObject(n)?n:{value:n}}):s.isObject(t)?[t]:[{value:t}],t=n.filter(this.getOptions(t),function(n){return n&&n.value}),r=this.getOptions()||[],this.multiple||t[0]&&t[0].value||!r.length||(t[0]=r[0]),n.forEach(r,function(i){i.selected=n.some(t,function(n){return n.value===i.value})}),r=n.map(t,function(n){return n.value}),"undefined"!=typeof r&&"undefined"!=typeof r[0]&&(u=n.map(t,function(n){return n.label}),this._setDisplay(this.multiple?u:u[0]),this.inherited(arguments,[this.multiple?r:r[0],i]),this._updateSelection()))},_getDisplayedValueAttr:function(){var t=n.map([].concat(this.get("selectedOptions")),function(n){return n&&"label"in n?n.label:n?n.value:null},this);return this.multiple?t:t[0]},_setDisplayedValueAttr:function(n){this.set("value",this.getOptions("string"==typeof n?{label:n}:n))},_loadChildren:function(){this._loadingStore||(n.forEach(this._getChildren(),function(n){n.destroyRecursive()}),n.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){var t,i;this.focusedChild=null;this._set("value",this._getValueFromOpts());t=[].concat(this.value);t&&t[0]&&(i=this,n.forEach(this._getChildren(),function(r){var u=n.some(t,function(n){return r.option&&n===r.option.value});u&&!i.multiple&&(i.focusedChild=r);e.toggle(r.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),u);r.domNode.setAttribute("aria-selected",u?"true":"false")},this))},_getValueFromOpts:function(){var t=this.getOptions()||[],i;return!this.multiple&&t.length?(i=n.filter(t,function(n){return n.selected})[0],i&&i.value)?i.value:(t[0].selected=!0,t[0].value):this.multiple?n.map(n.filter(t,function(n){return n.selected}),function(n){return n.value})||[]:""},_onNewItem:function(n,t){t&&t.parent||this._addOptionForItem(n)},_onDeleteItem:function(n){this.removeOption({value:this.store.getIdentity(n)})},_onSetItem:function(n){this.updateOption(this._getOptionObjForItem(n))},_getOptionObjForItem:function(n){var t=this.store,i=this.labelAttr&&this.labelAttr in n?n[this.labelAttr]:t.getLabel(n);return{value:i?t.getIdentity(n):null,label:i,item:n}},_addOptionForItem:function(n){var t=this.store;t.isItemLoaded&&!t.isItemLoaded(n)?t.loadItem({item:n,onItem:function(n){this._addOptionForItem(n)},scope:this}):(n=this._getOptionObjForItem(n),this.addOption(n))},constructor:function(n){this._oValue=(n||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);f.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?h("> *",this.srcNodeRef).map(function(n){return"separator"===n.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:n.getAttribute("data-"+o._scopeName+"-value")||n.getAttribute("value"),label:String(n.innerHTML),selected:n.getAttribute("selected")||!1,disabled:n.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);i.after(this,"onChange",s.hitch(this,"_updateSelection"));var n=this.store;n&&(n.getIdentity||n.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(n,this._oValue,{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var n;n=this._notifyConnections.pop();)n.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/layout/ContentPane":function(){define("dijit/layout/ContentPane","dojo/_base/kernel dojo/_base/lang ../_Widget ../_Container ./_ContentPaneResizeMixin dojo/string dojo/html dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-construct dojo/_base/xhr dojo/i18n dojo/when dojo/i18n!../nls/loading".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return s("dijit.layout.ContentPane",[i,r,u],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:n._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"<span class='dijitContentPaneLoading'><span class='dijitInline dijitIconLoading'><\/span>${loadingState}<\/span>",errorMessage:"<span class='dijitContentPaneError'><span class='dijitInline dijitIconError'><\/span>${errorState}<\/span>",isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(n,t,i){var r=new i(n,t);return!r.href&&r._contentSetter&&r._contentSetter.parseDeferred&&!r._contentSetter.parseDeferred.isFulfilled()?r._contentSetter.parseDeferred.then(function(){return r}):r},create:function(n,i){if(!(n&&n.template||!i||"href"in n||"content"in n)){i=c.byId(i);for(var r=i.ownerDocument.createDocumentFragment();i.firstChild;)r.appendChild(i.firstChild);n=t.delegate(n,{content:r})}this.inherited(arguments,[n,i])},postMixInProperties:function(){this.inherited(arguments);var n=y.getLocalization("dijit","loading",this.lang);this.loadingMessage=f.substitute(this.loadingMessage,n);this.errorMessage=f.substitute(this.errorMessage,n)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&o.forEach(this._contentSetter.parseResults,function(n){n._started||n._destroyed||!t.isFunction(n.startup)||(n.startup(),n._started=!0)},this)},_startChildren:function(){o.forEach(this.getChildren(),function(n){n._started||n._destroyed||!t.isFunction(n.startup)||(n.startup(),n._started=!0)});this._contentSetter&&o.forEach(this._contentSetter.parseResults,function(n){n._started||n._destroyed||!t.isFunction(n.startup)||(n.startup(),n._started=!0)},this)},setHref:function(t){return n.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0"),this.set("href",t)},_setHrefAttr:function(n){return this.cancel(),this.onLoadDeferred=new h(t.hitch(this,"cancel")),this.onLoadDeferred.then(t.hitch(this,"onLoad")),this._set("href",n),this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0,this.onLoadDeferred},setContent:function(t){n.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",t)},_setContentAttr:function(n){return this._set("href",""),this.cancel(),this.onLoadDeferred=new h(t.hitch(this,"cancel")),this._created&&this.onLoadDeferred.then(t.hitch(this,"onLoad")),this._setContent(n||""),this._isDownloaded=!1,this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(){this._beingDestroyed||this.inherited(arguments)},_onShow:function(){return this.inherited(arguments),this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow)?this.refresh():void 0},refresh:function(){return this.cancel(),this.onLoadDeferred=new h(t.hitch(this,"cancel")),this.onLoadDeferred.then(t.hitch(this,"onLoad")),this._load(),this.onLoadDeferred},_load:function(){var n,i,r,u;this._setContent(this.onDownloadStart(),!0);n=this;i={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};t.isObject(this.ioArgs)&&t.mixin(i,this.ioArgs);r=this._xhrDfd=(this.ioMethod||v.get)(i);r.then(function(t){u=t;try{return n._isDownloaded=!0,n._setContent(t,!1)}catch(i){n._onError("Content",i)}},function(t){return r.canceled||n._onError("Download",t),delete n._xhrDfd,t}).then(function(){return n.onDownloadEnd(),delete n._xhrDfd,u});delete this._hrefChanged},_onLoadHandler:function(n){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(n)}catch(t){console.error("Error "+this.widgetId+" running custom onLoad code: "+t.message)}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(n){console.error("Error "+this.widgetId+" running custom onUnload code: "+n.message)}},destroyDescendants:function(n){this.isLoaded&&this._onUnloadHandler();var t=this._contentSetter;o.forEach(this.getChildren(),function(t){t.destroyRecursive?t.destroyRecursive(n):t.destroy&&t.destroy(n);t._destroyed=!0});t&&(o.forEach(t.parseResults,function(t){t._destroyed||(t.destroyRecursive?t.destroyRecursive(n):t.destroy&&t.destroy(n),t._destroyed=!0)}),delete t.parseResults);n||a.empty(this.containerNode);delete this._singleChild},_setContent:function(n,i){var r;n=this.preprocessContent(n);this.destroyDescendants();r=this._contentSetter;r&&r instanceof e._ContentSetter||(r=this._contentSetter=new e._ContentSetter({node:this.containerNode,_onError:t.hitch(this,this._onError),onContentError:t.hitch(this,function(n){n=this.onContentError(n);try{this.containerNode.innerHTML=n}catch(t){console.error("Fatal "+this.id+" could not change content due to "+t.message,t)}})}));var f=t.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!n.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{}),f=r.set(t.isObject(n)&&n.domNode?n.domNode:n,f),u=this;return p(f&&f.then?f:r.parseDeferred,function(){delete u._contentSetterParams;i||(u._started&&(u._startChildren(),u._scheduleLayout()),u._onLoadHandler(n))})},preprocessContent:function(n){return n},_onError:function(n,t,i){this.onLoadDeferred.reject(t);n=this["on"+n+"Error"].call(this,t);i?console.error(i,t):n&&this._setContent(n,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})})},"dijit/layout/_ContentPaneResizeMixin":function(){define("dijit/layout/_ContentPaneResizeMixin","dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/query ../registry ../Viewport ./utils".split(" "),function(n,t,i,r,u,f,e,o,s,h){return t("dijit.layout._ContentPaneResizeMixin",null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var n=this.getParent();this._childOfLayoutWidget=n&&n.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(s.on("resize",f.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var n=[],t=!1;e("> *",this.containerNode).some(function(i){var r=o.byNode(i);r&&r.resize?n.push(r):!/script|link|style/i.test(i.nodeName)&&i.offsetHeight&&(t=!0)});this._singleChild=1!=n.length||t?null:n[0];i.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(n,t){this._resizeCalled=!0;this._scheduleLayout(n,t)},_scheduleLayout:function(n,t){this._isShown()?this._layout(n,t):(this._needLayout=!0,this._changeSize=n,this._resultSize=t)},_layout:function(n,t){var u,i;delete this._needLayout;this._wasShown||!1===this.open||this._onShow();n&&r.setMarginBox(this.domNode,n);u=this.containerNode;u===this.domNode?(i=t||{},f.mixin(i,n||{}),"h"in i&&"w"in i||(i=f.mixin(r.getMarginBox(u),i)),this._contentBox=h.marginBox2contentBox(u,i)):this._contentBox=r.getContentBox(u);this._layoutChildren()},_layoutChildren:function(){var n,t,i;if(this._checkIfSingleChild(),this._singleChild&&this._singleChild.resize)n=this._contentBox||r.getContentBox(this.containerNode),this._singleChild.resize({w:n.w,h:n.h});else for(n=this.getChildren(),i=0;t=n[i++];)t.resize&&t.resize()},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var n=this.domNode,t=this.domNode.parentNode;return"none"!=n.style.display&&"hidden"!=n.style.visibility&&!i.contains(n,"dijitHidden")&&t&&t.style&&"none"!=t.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})})},"dijit/layout/utils":function(){define("dijit/layout/utils",["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],function(n,t,i,r,u){function o(n){return n.substring(0,1).toUpperCase()+n.substring(1)}function f(n,t){var r=n.resize?n.resize(t):i.setMarginBox(n.domNode,t);r?u.mixin(n,r):(u.mixin(n,i.getMarginBox(n.domNode)),u.mixin(n,t))}var e={marginBox2contentBox:function(n,t){var u=r.getComputedStyle(n),f=i.getMarginExtents(n,u),e=i.getPadBorderExtents(n,u);return{l:r.toPixelValue(n,u.paddingLeft),t:r.toPixelValue(n,u.paddingTop),w:t.w-(f.w+e.w),h:t.h-(f.h+e.h)}},layoutChildren:function(i,r,e,s,h){r=u.mixin({},r);t.add(i,"dijitLayoutContainer");e=n.filter(e,function(n){return"center"!=n.region&&"client"!=n.layoutAlign}).concat(n.filter(e,function(n){return"center"==n.region||"client"==n.layoutAlign}));n.forEach(e,function(n){var u=n.domNode,i=n.region||n.layoutAlign,e;if(!i)throw Error("No region setting for "+n.id);e=u.style;e.left=r.l+"px";e.top=r.t+"px";e.position="absolute";t.add(u,"dijitAlign"+o(i));u={};s&&s==n.id&&(u["top"==n.region||"bottom"==n.region?"h":"w"]=h);"leading"==i&&(i=n.isLeftToRight()?"left":"right");"trailing"==i&&(i=n.isLeftToRight()?"right":"left");"top"==i||"bottom"==i?(u.w=r.w,f(n,u),r.h-=n.h,"top"==i?r.t+=n.h:e.top=r.t+r.h+"px"):"left"==i||"right"==i?(u.h=r.h,f(n,u),r.w-=n.w,"left"==i?r.l+=n.w:e.left=r.l+r.w+"px"):"client"!=i&&"center"!=i||f(n,r)})}};return u.setObject("dijit.layout.utils",e),e})},"dijit/place":function(){define("dijit/place","dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(n,t,i,r,u,f,e){function o(r,e,o,s){var h=f.getEffectiveBox(r.ownerDocument),c,a,l;return r.parentNode&&"body"==String(r.parentNode.tagName).toLowerCase()||u.body(r.ownerDocument).appendChild(r),c=null,n.some(e,function(n){var v=n.corner,i=n.pos,e=0,y={w:{L:h.l+h.w-i.x,R:i.x-h.l,M:h.w}[v.charAt(1)],h:{T:h.t+h.h-i.y,B:i.y-h.t,M:h.h}[v.charAt(0)]},u=r.style;u.left=u.right="auto";o&&(e=o(r,n.aroundCorner,v,y,s),e="undefined"==typeof e?0:e);var f=r.style,l=f.display,a=f.visibility;return"none"==f.display&&(f.visibility="hidden",f.display=""),u=t.position(r),f.display=l,f.visibility=a,l={L:i.x,R:i.x-u.w,M:Math.max(h.l,Math.min(h.l+h.w,i.x+(u.w>>1))-u.w)}[v.charAt(1)],a={T:i.y,B:i.y-u.h,M:Math.max(h.t,Math.min(h.t+h.h,i.y+(u.h>>1))-u.h)}[v.charAt(0)],i=Math.max(h.l,l),f=Math.max(h.t,a),l=Math.min(h.l+h.w,l+u.w)-i,a=Math.min(h.t+h.h,a+u.h)-f,e+=u.w-l+(u.h-a),(null==c||e<c.overflow)&&(c={corner:v,aroundCorner:n.aroundCorner,x:i,y:f,w:l,h:a,overflow:e,spaceAvailable:y}),!e}),c.overflow&&o&&o(r,c.aroundCorner,c.corner,c.spaceAvailable,s),e=c.y,a=c.x,l=u.body(r.ownerDocument),/relative|absolute/.test(i.get(l,"position"))&&(e-=i.get(l,"marginTop"),a-=i.get(l,"marginLeft")),l=r.style,l.top=e+"px",l.left=a+"px",l.right="auto",c}var s={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return e.place={at:function(t,i,r,u,f){return r=n.map(r,function(n){var t={corner:n,aroundCorner:s[n],pos:{x:i.x,y:i.y}};return u&&(t.pos.x+="L"==n.charAt(1)?u.x:-u.x,t.pos.y+="T"==n.charAt(0)?u.y:-u.y),t}),o(t,r,f)},around:function(u,f,e,s,h){function l(n,t){nt.push({aroundCorner:n,corner:t,pos:{x:{L:w,R:w+k,M:w+(k>>1)}[n.charAt(1)],y:{T:b,B:b+d,M:b+(d>>1)}[n.charAt(0)]}})}var c,p,g;if("string"==typeof f||"offsetWidth"in f||"ownerSVGElement"in f){if(c=t.position(f,!0),/^(above|below)/.test(e[0])){var v=t.getBorderExtents(f),a=f.firstChild?t.getBorderExtents(f.firstChild):{t:0,l:0,b:0,r:0},y=t.getBorderExtents(u),p=u.firstChild?t.getBorderExtents(u.firstChild):{t:0,l:0,b:0,r:0};c.y+=Math.min(v.t+a.t,y.t+p.t);c.h-=Math.min(v.t+a.t,y.t+p.t)+Math.min(v.b+a.b,y.b+p.b)}}else c=f;if(f.parentNode)for(v="absolute"==i.getComputedStyle(f).position,f=f.parentNode;f&&1==f.nodeType&&"BODY"!=f.nodeName;)a=t.position(f,!0),y=i.getComputedStyle(f),/relative|absolute/.test(y.position)&&(v=!1),!v&&/hidden|auto|scroll/.test(y.overflow)&&(p=Math.min(c.y+c.h,a.y+a.h),g=Math.min(c.x+c.w,a.x+a.w),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y),c.h=p-c.y,c.w=g-c.x),"absolute"==y.position&&(v=!0),f=f.parentNode;var w=c.x,b=c.y,k="w"in c?c.w:c.w=c.width,d="h"in c?c.h:(r.deprecated("place.around: dijit/place.__Rectangle: { x:"+w+", y:"+b+", height:"+c.height+", width:"+k+" } has been deprecated.  Please use { x:"+w+", y:"+b+", h:"+c.height+", w:"+k+" }","","2.0"),c.h=c.height),nt=[];return n.forEach(e,function(n){var t=s;switch(n){case"above-centered":l("TM","BM");break;case"below-centered":l("BM","TM");break;case"after-centered":t=!t;case"before-centered":l(t?"ML":"MR",t?"MR":"ML");break;case"after":t=!t;case"before":l(t?"TL":"TR",t?"TR":"TL");l(t?"BL":"BR",t?"BR":"BL");break;case"below-alt":t=!t;case"below":l(t?"BL":"BR",t?"TL":"TR");l(t?"BR":"BL",t?"TR":"TL");break;case"above-alt":t=!t;case"above":l(t?"TL":"TR",t?"BL":"BR");l(t?"TR":"TL",t?"BR":"BL");break;default:l(n.aroundCorner,n.corner)}}),u=o(u,nt,h,{w:k,h:d}),u.aroundNodePos=c,u}}})},"dijit/popup":function(){define("dijit/popup","dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function w(){this._popupWrapper&&(f.destroy(this._popupWrapper),delete this._popupWrapper)}return i=i(null,{_stack:[],_beginZIndex:1e3,_idGen:1,_repositionAll:function(){var n;if(this._firstAroundNode){var i=this._firstAroundPosition,t=e.position(this._firstAroundNode,!0),r=t.x-i.x,i=t.y-i.y;if(r||i)for(this._firstAroundPosition=t,t=0;t<this._stack.length;t++)n=this._stack[t].wrapper.style,n.top=parseFloat(n.top)+i+"px","auto"==n.right?n.left=parseFloat(n.left)+r+"px":n.right=parseFloat(n.right)-r+"px";this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),r||i?10:50)}},_createWrapper:function(n){var i=n._popupWrapper,r=n.domNode;return i||(i=f.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":n["aria-label"]||n.label||n.name||n.id},n.ownerDocumentBody),i.appendChild(r),r=r.style,r.display="",r.visibility="",r.position="",r.top="0px",n._popupWrapper=i,t.after(n,"destroy",w,!0),"ontouchend"in document&&l(i,"touchend",function(n){/^(input|button|textarea)$/i.test(n.target.tagName)||n.preventDefault()}),i.dojoClick=!0),i},moveOffScreen:function(n){var i=this._createWrapper(n),t;return n=e.isBodyLtr(n.ownerDocument),t={visibility:"hidden",top:"-9999px",display:""},t[n?"left":"right"]="-9999px",t[n?"right":"left"]="auto",o.set(i,t),i},hide:function(n){var t=this._createWrapper(n);o.set(t,{display:"none",height:"auto",overflowY:"visible",border:""});n=n.domNode;"_originalStyle"in n&&(n.style.cssText=n._originalStyle)},getTopPopup:function(){for(var t=this._stack,n=t.length-1;0<n&&t[n].parent===t[n-1].widget;n--);return t[n]},open:function(n){for(var f,b,k,nt,p=this._stack,t=n.popup,i=t.domNode,d=n.orient||["below","below-alt","above","above-alt"],tt=n.parent?n.parent.isLeftToRight():e.isBodyLtr(t.ownerDocument),w=n.around,g=n.around&&n.around.id?n.around.id+"_dropdown":"popup_"+this._idGen++;p.length&&(!n.parent||!r.isDescendant(n.parent.domNode,p[p.length-1].widget.domNode));)this.close(p[p.length-1].widget);if(f=this.moveOffScreen(t),t.startup&&!t._started&&t.startup(),k=e.position(i),"maxHeight"in n&&-1!=n.maxHeight?b=n.maxHeight||Infinity:(b=y.getEffectiveBox(this.ownerDocument),nt=w?e.position(w,!1):{y:n.y-(n.padding||0),h:2*(n.padding||0)},b=Math.floor(Math.max(nt.y,b.h-(nt.y+nt.h)))),k.h>b&&(k=o.getComputedStyle(i),o.set(f,{overflowY:"scroll",height:b+"px",border:k.borderLeftWidth+" "+k.borderLeftStyle+" "+k.borderLeftColor}),i._originalStyle=i.style.cssText,i.style.border="none"),u.set(f,{id:g,style:{zIndex:this._beginZIndex+p.length},"class":"dijitPopup "+(t.baseClass||t["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:n.parent?n.parent.id:""}),0==p.length&&w&&(this._firstAroundNode=w,this._firstAroundPosition=e.position(w,!0),this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),50)),s("config-bgIframe")&&!t.bgIframe&&(t.bgIframe=new v(f)),g=t.orient?c.hitch(t,"orient"):null,d=w?a.around(f,w,d,tt,g):a.at(f,n,"R"==d?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],n.padding,g),f.style.visibility="visible",i.style.visibility="visible",i=[],i.push(l(f,"keydown",c.hitch(this,function(t){t.keyCode==h.ESCAPE&&n.onCancel?(t.stopPropagation(),t.preventDefault(),n.onCancel()):t.keyCode==h.TAB&&(t.stopPropagation(),t.preventDefault(),(t=this.getTopPopup())&&t.onCancel)&&t.onCancel()}))),t.onCancel&&n.onCancel&&i.push(t.on("cancel",n.onCancel)),i.push(t.on(t.onExecute?"execute":"change",c.hitch(this,function(){var n=this.getTopPopup();n&&n.onExecute&&n.onExecute()}))),p.push({widget:t,wrapper:f,parent:n.parent,onExecute:n.onExecute,onCancel:n.onCancel,onClose:n.onClose,handlers:i}),t.onOpen)t.onOpen(d);return d},close:function(t){for(var e,r=this._stack;t&&n.some(r,function(n){return n.widget==t})||!t&&r.length;){var u=r.pop(),i=u.widget,f=u.onClose;for(i.bgIframe&&(i.bgIframe.destroy(),delete i.bgIframe),i.onClose&&i.onClose();e=u.handlers.pop();)e.remove();i&&i.domNode&&this.hide(i);f&&f()}0==r.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null)}}),p.popup=new i})},"dijit/selection":function(){define("dijit/selection","dojo/_base/array dojo/dom dojo/_base/lang dojo/sniff dojo/_base/window dijit/focus".split(" "),function(n,t,i,r,u,f){var e=function(e){var o=e.document;this.getType=function(){if(o.getSelection){var t="text",n;try{n=e.getSelection()}catch(i){}return n&&1==n.rangeCount&&(n=n.getRangeAt(0),n.startContainer==n.endContainer&&1==n.endOffset-n.startOffset&&3!=n.startContainer.nodeType&&(t="control")),t}return o.selection.type.toLowerCase()};this.getSelectedText=function(){if(o.getSelection){var n=e.getSelection();return n?n.toString():""}return"control"==this.getType()?null:o.selection.createRange().text};this.getSelectedHtml=function(){var n,t,i,u,r;if(o.getSelection){if(n=e.getSelection(),n&&n.rangeCount){for(i="",t=0;t<n.rangeCount;t++)u=n.getRangeAt(t).cloneContents(),r=o.createElement("div"),r.appendChild(u),i+=r.innerHTML;return i}return null}return"control"==this.getType()?null:o.selection.createRange().htmlText};this.getSelectedElement=function(){if("control"==this.getType()){if(o.getSelection){var n=e.getSelection();return n.anchorNode.childNodes[n.anchorOffset]}if((n=o.selection.createRange())&&n.item)return o.selection.createRange().item(0)}return null};this.getParentElement=function(){if("control"==this.getType()){var n=this.getSelectedElement();if(n)return n.parentNode}else if(o.getSelection){if(n=o.getSelection()){for(n=n.anchorNode;n&&1!=n.nodeType;)n=n.parentNode;return n}}else return n=o.selection.createRange(),n.collapse(!0),n.parentElement();return null};this.hasAncestorElement=function(){return null!=this.getAncestorElement.apply(this,arguments)};this.getAncestorElement=function(){var n=this.getSelectedElement()||this.getParentElement();return this.getParentOfType(n,arguments)};this.isTag=function(n,t){var u,i,r;if(n&&n.tagName)for(u=n.tagName.toLowerCase(),i=0;i<t.length;i++)if(r=String(t[i]).toLowerCase(),u==r)return r;return""};this.getParentOfType=function(n,t){for(;n;){if(this.isTag(n,t).length)return n;n=n.parentNode}return null};this.collapse=function(n){if(o.getSelection){var t=e.getSelection();t.removeAllRanges?n?t.collapseToStart():t.collapseToEnd():t.collapse(n)}else t=o.selection.createRange(),t.collapse(n),t.select()};this.remove=function(){var n=o.selection;return o.getSelection?(n=e.getSelection(),n.deleteFromDocument()):"none"!=n.type.toLowerCase()&&n.clear(),n};this.selectElementChildren=function(n,i){var u,f;if(n=t.byId(n),o.getSelection)f=e.getSelection(),r("opera")?(u=f.rangeCount?f.getRangeAt(0):o.createRange(),u.setStart(n,0),u.setEnd(n,3==n.nodeType?n.length:n.childNodes.length),f.addRange(u)):f.selectAllChildren(n);else if(u=n.ownerDocument.body.createTextRange(),u.moveToElementText(n),!i)try{u.select()}catch(s){}};this.selectElement=function(n,i){var e,f;if(n=t.byId(n),o.getSelection)f=o.getSelection(),e=o.createRange(),f.removeAllRanges&&(r("opera")&&f.getRangeAt(0)&&(e=f.getRangeAt(0)),e.selectNode(n),f.removeAllRanges(),f.addRange(e));else try{f=n.tagName?n.tagName.toLowerCase():"";e="img"===f||"table"===f?u.body(o).createControlRange():u.body(o).createRange();e.addElement(n);i||e.select()}catch(s){this.selectElementChildren(n,i)}};this.inSelection=function(n){var i,t,r;if(n)if(o.getSelection){if(r=e.getSelection(),r&&0<r.rangeCount&&(t=r.getRangeAt(0)),t&&t.compareBoundaryPoints&&o.createRange)try{if(i=o.createRange(),i.setStart(n,0),1===t.compareBoundaryPoints(t.START_TO_END,i))return!0}catch(u){}}else{t=o.selection.createRange();try{i=n.ownerDocument.body.createTextRange();i.moveToElementText(n)}catch(u){}if(t&&i&&1===t.compareEndPoints("EndToStart",i))return!0}return!1};this.getBookmark=function(){var n,i,t=o.selection,r=f.curNode;if(o.getSelection){if(t=e.getSelection())if(t.isCollapsed){if((n=r?r.tagName:"")&&(n=n.toLowerCase(),"textarea"==n||"input"==n&&(!r.type||"text"==r.type.toLowerCase())))return t={start:r.selectionStart,end:r.selectionEnd,node:r,pRange:!0},{isCollapsed:t.end<=t.start,mark:t};n={isCollapsed:!0};t.rangeCount&&(n.mark=t.getRangeAt(0).cloneRange())}else i=t.getRangeAt(0),n={isCollapsed:!1,mark:i.cloneRange()}}else if(t){if(n=r?r.tagName:"",n=n.toLowerCase(),r&&n&&("button"==n||"textarea"==n||"input"==n))return t.type&&"none"==t.type.toLowerCase()?{isCollapsed:!0,mark:null}:(i=t.createRange(),{isCollapsed:i.text&&i.text.length?!1:!0,mark:{range:i,pRange:!0}});n={};try{i=t.createRange();n.isCollapsed=!("Text"==t.type?i.htmlText.length:i.length)}catch(u){return n.isCollapsed=!0,n}if("CONTROL"==t.type.toUpperCase())if(i.length)for(n.mark=[],t=0,r=i.length;t<r;)n.mark.push(i.item(t++));else n.isCollapsed=!0,n.mark=null;else n.mark=i.getBookmark()}else console.warn("No idea how to store the current selection for this browser!");return n};this.moveToBookmark=function(t){var r,u;(t=t.mark)&&(o.getSelection?(r=e.getSelection(),r&&r.removeAllRanges?t.pRange?(r=t.node,r.selectionStart=t.start,r.selectionEnd=t.end):(r.removeAllRanges(),r.addRange(t)):console.warn("No idea how to restore selection for this browser!")):o.selection&&t&&(t.pRange?u=t.range:i.isArray(t)?(u=o.body.createControlRange(),n.forEach(t,function(n){u.addElement(n)})):(u=o.body.createTextRange(),u.moveToBookmark(t)),u.select()))};this.isCollapsed=function(){return this.getBookmark().isCollapsed}},o=new e(window);return o.SelectionManager=e,o})},"dijit/typematic":function(){define("dijit/typematic","dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(n,t,i,r,u,f){var e=f.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(i.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(n,t,r,u,f,e,o,s){if(f!=this._obj){this.stop();this._initialDelay=o||500;this._subsequentDelay=e||.9;this._minDelay=s||10;this._obj=f;this._node=r;this._count=this._currentTimeout=-1;this._callback=i.hitch(t,u);this._evt={faux:!0};for(var h in n)"layerX"!=h&&"layerY"!=h&&(t=n[h],"function"!=typeof t&&"undefined"!=typeof t&&(this._evt[h]=t));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(u,f,o,s,h,c,l){var a="keyCode"in f?"keyCode":"charCode"in f?"charCode":"charOrCode",v=[r(u,"keyCode"in f?"keydown":"charCode"in f?"keypress":t._keypress,i.hitch(this,function(n){n[a]!=f[a]||void 0!==f.ctrlKey&&f.ctrlKey!=n.ctrlKey||void 0!==f.altKey&&f.altKey!=n.altKey||void 0!==f.metaKey&&f.metaKey!=(n.metaKey||!1)||void 0!==f.shiftKey&&f.shiftKey!=n.shiftKey?e._obj==f&&e.stop():(n.stopPropagation(),n.preventDefault(),e.trigger(n,o,u,s,f,h,c,l))})),r(u,"keyup",i.hitch(this,function(){e._obj==f&&e.stop()}))];return{remove:function(){n.forEach(v,function(n){n.remove()})}}},addMouseListener:function(t,f,o,s,h,c){var l=[r(t,"mousedown",i.hitch(this,function(n){n.preventDefault();e.trigger(n,f,t,o,t,s,h,c)})),r(t,"mouseup",i.hitch(this,function(n){this._obj&&n.preventDefault();e.stop()})),r(t,"mouseout",i.hitch(this,function(n){this._obj&&n.preventDefault();e.stop()})),r(t,"dblclick",i.hitch(this,function(n){n.preventDefault();9>u("ie")&&(e.trigger(n,f,t,o,t,s,h,c),setTimeout(i.hitch(this,e.stop),50))}))];return{remove:function(){n.forEach(l,function(n){n.remove()})}}},addListener:function(t,i,r,u,f,e,o,s){var h=[this.addKeyListener(i,r,u,f,e,o,s),this.addMouseListener(t,u,f,e,o,s)];return{remove:function(){n.forEach(h,function(n){n.remove()})}}}};return e})},"dojo/DeferredList":function(){define("dojo/DeferredList",["./_base/kernel","./_base/Deferred","./_base/array"],function(n,t,i){return n.DeferredList=function(n,r,u,f){var s=[],e,o;t.call(this);e=this;0!==n.length||r||this.resolve([0,[]]);o=0;i.forEach(n,function(t,i){function h(t,r){s[i]=[t,r];o++;o===n.length&&e.resolve(s)}t.then(function(n){r?e.resolve([i,n]):h(!0,n)},function(n){if(u?e.reject(n):h(!1,n),f)return null;throw n;})})},n.DeferredList.prototype=new t,n.DeferredList.prototype.gatherResults=function(t){return t=new n.DeferredList(t,!1,!0,!1),t.addCallback(function(n){var t=[];return i.forEach(n,function(n){t.push(n[1])}),t}),t},n.DeferredList})},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(n,t,i,r){var e={},f,u;return t.setObject("dojo.colors",e),f=function(n,t,i){0>i&&++i;1<i&&--i;var r=6*i;return 1>r?n+(t-n)*r:1>2*i?t:2>3*i?n+(t-n)*(2/3-i)*6:n},n.colorFromRgb=i.fromRgb=function(n,t){var u=n.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(u){var e=u[2].split(/\s*,\s*/),h=e.length,u=u[1];if("rgb"==u&&3==h||"rgba"==u&&4==h)return u=e[0],"%"==u.charAt(u.length-1)?(u=r.map(e,function(n){return 2.56*parseFloat(n)}),4==h&&(u[3]=e[3]),i.fromArray(u,t)):i.fromArray(e,t);if("hsl"==u&&3==h||"hsla"==u&&4==h){var u=(parseFloat(e[0])%360+360)%360/360,s=parseFloat(e[1])/100,o=parseFloat(e[2])/100,s=.5>=o?o*(s+1):o+s-o*s,o=2*o-s,u=[256*f(o,s,u+1/3),256*f(o,s,u),256*f(o,s,u-1/3),1];return 4==h&&(u[3]=e[3]),i.fromArray(u,t)}}return null},u=function(n,t,i){return n=Number(n),isNaN(n)?i:n<t?t:n>i?i:n},i.prototype.sanitize=function(){return this.r=Math.round(u(this.r,0,255)),this.g=Math.round(u(this.g,0,255)),this.b=Math.round(u(this.b,0,255)),this.a=u(this.a,0,1),this},e.makeGrey=i.makeGrey=function(n,t){return i.fromArray([n,n,n,t])},t.mixin(i.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]}),i})},"dojo/cookie":function(){define("dojo/cookie",["./_base/kernel","./regexp"],function(n,t){return n.cookie=function(n,i,r){var u=document.cookie,e,f,o;if(1==arguments.length)e=(e=u.match(new RegExp("(?:^|; )"+t.escapeString(n)+"=([^;]*)")))?decodeURIComponent(e[1]):void 0;else{r=r||{};u=r.expires;"number"==typeof u&&(f=new Date,f.setTime(f.getTime()+864e5*u),u=r.expires=f);u&&u.toUTCString&&(r.expires=u.toUTCString());i=encodeURIComponent(i);u=n+"="+i;for(o in r)u+="; "+o,f=r[o],!0!==f&&(u+="="+f);document.cookie=u}return e},n.cookie.isSupported=function(){return"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1})),navigator.cookieEnabled},n.cookie})},"dojo/data/util/filter":function(){define("dojo/data/util/filter",["../../_base/lang"],function(n){var t={};return n.setObject("dojo.data.util.filter",t),t.patternToRegExp=function(n,t){for(var i="^",u=null,r=0;r<n.length;r++)switch(u=n.charAt(r),u){case"\\":i+=u;r++;i+=n.charAt(r);break;case"*":i+=".*";break;case"?":i+=".";break;case"$":case"^":case"/":case"+":case".":case"|":case"(":case")":case"{":case"}":case"[":case"]":i+="\\";default:i+=u}return i+="$",t?new RegExp(i,"mi"):new RegExp(i,"m")},t})},"dojo/data/util/simpleFetch":function(){define("dojo/data/util/simpleFetch",["../../_base/lang","../../_base/kernel","./sorter"],function(n,t,i){var r={};return n.setObject("dojo.data.util.simpleFetch",r),r.errorHandler=function(n,i){i.onError&&i.onError.call(i.scope||t.global,n,i)},r.fetchHandler=function(n,r){var s=r.abort||null,e=!1,o=r.start?r.start:0,h=r.count&&Infinity!==r.count?o+r.count:n.length,f,u,c;if(r.abort=function(){e=!0;s&&s.call(r)},f=r.scope||t.global,r.store||(r.store=this),r.onBegin&&r.onBegin.call(f,n.length,r),r.sort&&n.sort(i.createSortFunction(r.sort,this)),r.onItem)for(u=o;u<n.length&&u<h;++u)c=n[u],e||r.onItem.call(f,c,r);r.onComplete&&!e&&(u=null,r.onItem||(u=n.slice(o,h)),r.onComplete.call(f,u,r))},r.fetch=function(t){return t=t||{},t.store||(t.store=this),this._fetchItems(t,n.hitch(this,"fetchHandler"),n.hitch(this,"errorHandler")),t},r})},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(n){var t={};return n.setObject("dojo.data.util.sorter",t),t.basicComparator=function(n,t){var i=-1;return null===n&&(n=void 0),null===t&&(t=void 0),n==t?i=0:(n>t||null==n)&&(i=1),i},t.createSortFunction=function(n,i){function c(n,t,i,r){return function(u,f){var e=r.getValue(u,n),o=r.getValue(f,n);return t*i(e,o)}}for(var r,o,f=[],u,s=i.comparatorMap,h=t.basicComparator,e=0;e<n.length;e++)u=n[e],r=u.attribute,r&&(u=u.descending?-1:1,o=h,s&&("string"!=typeof r&&"toString"in r&&(r=r.toString()),o=s[r]||h),f.push(c(r,u,o,i)));return function(n,t){for(var r,i=0;i<f.length;)if(r=f[i++](n,t),0!==r)return r;return 0}},t})},"dojo/dnd/Moveable":function(){define("dojo/dnd/Moveable","../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function p(n,t){"touchAction"in document.body.style?y="touchAction":"msTouchAction"in document.body.style&&(y="msTouchAction");v=function(n,t){n.style[y]=t};v(n,t)}var y,v=function(){};return e("touch-action")&&(v=p),t("dojo.dnd.Moveable",[f],{handle:"",delay:0,skip:!1,constructor:function(n,t){this.node=r.byId(n);v(this.node,"none");t||(t={});this.handle=t.handle?r.byId(t.handle):null;this.handle||(this.handle=this.node);this.delay=0<t.delay?t.delay:0;this.skip=t.skip;this.mover=t.mover?t.mover:l;this.events=[o(this.handle,h.press,i.hitch(this,"onMouseDown")),o(this.handle,"dragstart",i.hitch(this,"onSelectStart")),o(this.handle,"selectstart",i.hitch(this,"onSelectStart"))]},markupFactory:function(n,t,i){return new i(t,n)},destroy:function(){n.forEach(this.events,function(n){n.remove()});v(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(n){if(!this.skip||!c.isFormElement(n)){if(this.delay)this.events.push(o(this.handle,h.move,i.hitch(this,"onMouseMove")),o(this.handle.ownerDocument,h.release,i.hitch(this,"onMouseUp"))),this._lastX=n.pageX,this._lastY=n.pageY;else this.onDragDetected(n);n.stopPropagation();n.preventDefault()}},onMouseMove:function(n){(Math.abs(n.pageX-this._lastX)>this.delay||Math.abs(n.pageY-this._lastY)>this.delay)&&(this.onMouseUp(n),this.onDragDetected(n));n.stopPropagation();n.preventDefault()},onMouseUp:function(n){for(var t=0;2>t;++t)this.events.pop().remove();n.stopPropagation();n.preventDefault()},onSelectStart:function(n){this.skip&&c.isFormElement(n)||(n.stopPropagation(),n.preventDefault())},onDragDetected:function(n){new this.mover(this.node,n,this)},onMoveStart:function(n){s.publish("/dnd/move/start",n);u.add(a.body(),"dojoMove");u.add(this.node,"dojoMoveItem")},onMoveStop:function(n){s.publish("/dnd/move/stop",n);u.remove(a.body(),"dojoMove");u.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(n,t){this.onMoving(n,t);var i=n.node.style;i.left=t.l+"px";i.top=t.t+"px";this.onMoved(n,t)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/Mover":function(){define("dojo/dnd/Mover","../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return t("dojo.dnd.Mover",[s],{constructor:function(n,t,r){function u(n){n.preventDefault();n.stopPropagation()}if(this.node=f.byId(n),this.marginBox={l:t.pageX,t:t.pageY},this.mouseButton=t.button,t=this.host=r,n=n.ownerDocument,this.events=[h(n,c.move,i.hitch(this,"onFirstMove")),h(n,c.move,i.hitch(this,"onMouseMove")),h(n,c.release,i.hitch(this,"onMouseUp")),h(n,"dragstart",u),h(n.body,"selectstart",u)],a.autoScrollStart(n),t&&t.onMoveStart)t.onMoveStart(this)},onMouseMove:function(n){a.autoScroll(n);var t=this.marginBox;this.host.onMove(this,{l:t.l+n.pageX,t:t.t+n.pageY},n);n.preventDefault();n.stopPropagation()},onMouseUp:function(n){(r("webkit")&&r("mac")&&2==this.mouseButton?0==n.button:this.mouseButton==n.button)&&this.destroy();n.preventDefault();n.stopPropagation()},onFirstMove:function(n){var t=this.node.style,i,f=this.host;switch(t.position){case"relative":case"absolute":i=Math.round(parseFloat(t.left))||0;t=Math.round(parseFloat(t.top))||0;break;default:t.position="absolute";t=e.getMarginBox(this.node);i=u.doc.body;var r=o.getComputedStyle(i),s=e.getMarginBox(i,r),r=e.getContentBox(i,r);i=t.l-(r.l-s.l);t=t.t-(r.t-s.t)}if(this.marginBox.l=i-this.marginBox.l,this.marginBox.t=t-this.marginBox.t,f&&f.onFirstMove)f.onFirstMove(this,n);this.events.shift().remove()},destroy:function(){n.forEach(this.events,function(n){n.remove()});var t=this.host;if(t&&t.onMoveStop)t.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/TimedMoveable":function(){define("dojo/dnd/TimedMoveable",["../_base/declare","./Moveable"],function(n,t){var i=t.prototype.onMove;return n("dojo.dnd.TimedMoveable",t,{timeout:40,constructor:function(n,t){t||(t={});t.timeout&&"number"==typeof t.timeout&&0<=t.timeout&&(this.timeout=t.timeout)},onMoveStop:function(n){n._timer&&(clearTimeout(n._timer),i.call(this,n,n._leftTop));t.prototype.onMoveStop.apply(this,arguments)},onMove:function(n,t){if(n._leftTop=t,!n._timer){var r=this;n._timer=setTimeout(function(){n._timer=null;i.call(r,n,n._leftTop)},this.timeout)}}})})},"dojo/dnd/autoscroll":function(){define("dojo/dnd/autoscroll","../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(n,t,i,r,u,f){var e={};n.setObject("dojo.dnd.autoscroll",e);e.getViewport=f.getBox;e.V_TRIGGER_AUTOSCROLL=32;e.H_TRIGGER_AUTOSCROLL=32;e.V_AUTOSCROLL_VALUE=16;e.H_AUTOSCROLL_VALUE=16;var s,o=i.doc,h=Infinity,c=Infinity;return e.autoScrollStart=function(n){o=n;s=f.getBox(o);n=i.body(o).parentNode;h=Math.max(n.scrollHeight-s.h,0);c=Math.max(n.scrollWidth-s.w,0)},e.autoScroll=function(n){var u=s||f.getBox(o),l=i.body(o).parentNode,t=0,r=0;n.clientX<e.H_TRIGGER_AUTOSCROLL?t=-e.H_AUTOSCROLL_VALUE:n.clientX>u.w-e.H_TRIGGER_AUTOSCROLL&&(t=Math.min(e.H_AUTOSCROLL_VALUE,c-l.scrollLeft));n.clientY<e.V_TRIGGER_AUTOSCROLL?r=-e.V_AUTOSCROLL_VALUE:n.clientY>u.h-e.V_TRIGGER_AUTOSCROLL&&(r=Math.min(e.V_AUTOSCROLL_VALUE,h-l.scrollTop));window.scrollBy(t,r)},e._validNodes={div:1,p:1,td:1},e._validOverflow={auto:1,scroll:1},e.autoScrollNodes=function(n){for(var c,v,f,h,s,l=0,a=0,o=n.target;o;){if(1==o.nodeType&&o.tagName.toLowerCase()in e._validNodes&&(f=u.getComputedStyle(o),s=f.overflowX.toLowerCase()in e._validOverflow,h=f.overflowY.toLowerCase()in e._validOverflow,(s||h)&&(c=r.getContentBox(o,f),v=r.position(o,!0)),s&&(f=Math.min(e.H_TRIGGER_AUTOSCROLL,c.w/2),s=n.pageX-v.x,(t("webkit")||t("opera"))&&(s+=i.body().scrollLeft),l=0,0<s&&s<c.w&&(s<f?l=-f:s>c.w-f&&(l=f),o.scrollLeft+=l)),h&&(h=Math.min(e.V_TRIGGER_AUTOSCROLL,c.h/2),f=n.pageY-v.y,(t("webkit")||t("opera"))&&(f+=i.body().scrollTop),a=0,0<f&&f<c.h&&(f<h?a=-h:f>c.h-h&&(a=h),o.scrollTop+=a)),l||a))return;try{o=o.parentNode}catch(y){o=null}}e.autoScroll(n)},e})},"dojo/dnd/common":function(){define("dojo/dnd/common",["../sniff","../_base/kernel","../_base/lang","../dom"],function(n,t,i,r){var u=i.getObject("dojo.dnd",!0);return u.getCopyKeyState=function(t){return t[n("mac")?"metaKey":"ctrlKey"]},u._uniqueId=0,u.getUniqueId=function(){var n;do n=t._scopeName+"Unique"+ ++u._uniqueId;while(r.byId(n));return n},u._empty={},u.isFormElement=function(n){return n=n.target,3==n.nodeType&&(n=n.parentNode),0<=" a button textarea input select option ".indexOf(" "+n.tagName.toLowerCase()+" ")},u})},"dojo/hash":function(){define("dojo/hash","./_base/kernel require ./_base/config ./aspect ./_base/lang ./topic ./domReady ./sniff".split(" "),function(n,t,i,r,u,f,e,o){function v(n,t){var i=n.indexOf(t);return 0<=i?n.substring(i+1):""}function h(){return v(location.href,"#")}function l(){f.publish("/dojo/hashchange",h())}function y(){h()!==s&&(s=h(),l())}function p(n){if(c)if(c.isTransitioning())setTimeout(u.hitch(null,p,n),a);else{var t=c.iframe.location.href,i=t.indexOf("?");c.iframe.location.replace(t.substring(0,i)+"?"+n)}else t=location.href.replace(/#.*/,""),location.replace(t+"#"+n),!w&&y()}function b(){function y(){s=h();w=r?s:v(c.href,"?");e=!1;o=null}var f=document.createElement("iframe"),p=i.dojoBlankHtmlUrl||t.toUrl("./resources/blank.html"),w,e,o,b,r,c;i.useXDomain&&!i.dojoBlankHtmlUrl&&console.warn("dojo/hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html");f.id="dojo-hash-iframe";f.src=p+"?"+h();f.style.display="none";document.body.appendChild(f);this.iframe=n.global["dojo-hash-iframe"];c=this.iframe.location;this.isTransitioning=function(){return e};this.pollLocation=function(){var t,n;if(!r)try{t=v(c.href,"?");document.title!=b&&(b=this.iframe.document.title=document.title)}catch(i){r=!0;console.error("dojo/hash: Error adding history entry. Server unreachable.")}if(n=h(),e&&s===n)if(r||t===o)y(),l();else{setTimeout(u.hitch(this,this.pollLocation),0);return}else if(s!==n||!r&&w!==t){if(s!==n){s=n;e=!0;o=n;f.src=p+"?"+o;r=!1;setTimeout(u.hitch(this,this.pollLocation),0);return}r||(location.href="#"+c.search.substring(1),y(),l())}setTimeout(u.hitch(this,this.pollLocation),a)};y();setTimeout(u.hitch(this,this.pollLocation),a)}n.hash=function(n,t){return arguments.length?("#"==n.charAt(0)&&(n=n.substring(1)),t?p(n):location.hash="#"+n,n):h()};var s,c,w,a=i.hashPollFrequency||100;return e(function(){"onhashchange"in n.global&&(!o("ie")||8<=o("ie")&&"BackCompat"!=document.compatMode)?w=r.after(n.global,"onhashchange",l,!0):document.addEventListener?(s=h(),setInterval(y,a)):document.attachEvent&&(c=new b)}),n.hash})},"dojo/html":function(){define("dojo/html","./_base/kernel ./_base/lang ./_base/array ./_base/declare ./dom ./dom-construct ./parser".split(" "),function(n,t,i,r,u,f,e){var s=0,o={_secureForInnerHtml:function(n){return n.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"")},_emptyNode:f.empty,_setNodeContent:function(n,i){if(f.empty(n),i)if("number"==typeof i&&(i=i.toString()),"string"==typeof i&&(i=f.toDom(i,n.ownerDocument)),!i.nodeType&&t.isArrayLike(i))for(var u=i.length,r=0;r<i.length;r=u==i.length?r+1:0)f.place(i[r],n,"last");else f.place(i,n,"last");return n},_ContentSetter:r("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:n._scopeName,startup:!0,constructor:function(n,i){t.mixin(this,n||{});i=this.node=u.byId(this.node||i);this.id||(this.id=["Setter",i?i.id||i.tagName:"",s++].join("_"))},set:function(n,t){void 0!==n&&(this.content=n);"number"==typeof n&&(n=n.toString());t&&this._mixin(t);this.onBegin();this.setContent();var i=this.onEnd();return i&&i.then?i:this.node},setContent:function(){var n=this.node,t;if(!n)throw Error(this.declaredClass+": setContent given no node");try{n=o._setNodeContent(n,this.content)}catch(r){t=this.onContentError(r);try{n.innerHTML=t}catch(i){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+i.message,i)}}this.node=n},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred);this.parseResults&&this.parseResults.length&&(i.forEach(this.parseResults,function(n){n.destroy&&n.destroy()}),delete this.parseResults);f.empty(this.node)},onBegin:function(){var n=this.content,i;return t.isString(n)&&(this.cleanContent&&(n=o._secureForInnerHtml(n)),this.extractContent)&&(i=n.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im),i&&(n=i[1])),this.empty(),this.content=n,this.node},onEnd:function(){return this.parseContent&&this._parse(),this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(n){return"Error occurred setting content: "+n},onExecError:function(n){return"Error occurred executing scripts: "+n},_mixin:function(n){var i={};for(var t in n)t in i||(this[t]=n[t])},_parse:function(){var r=this.node,n,t;try{n={};i.forEach(["dir","lang","textDir"],function(t){this[t]&&(n[t]=this[t])},this);t=this;this.parseDeferred=e.parse({rootNode:r,noStart:!this.startup,inherited:n,scope:this.parserScope}).then(function(n){return t.parseResults=n},function(n){t._onError("Content",n,"Error parsing in _ContentSetter#"+this.id)})}catch(u){this._onError("Content",u,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(n,t,i){n=this["on"+n+"Error"].call(this,t);i?console.error(i,t):n&&o._setNodeContent(this.node,n,!0)}}),set:function(n,i,r){return void 0==i&&(console.warn("dojo.html.set: no cont argument provided, using empty string"),i=""),"number"==typeof i&&(i=i.toString()),r?new o._ContentSetter(t.mixin(r,{content:i,node:n})).set():o._setNodeContent(n,i,!0)}};return t.setObject("dojo.html",o),o})},"dojo/selector/lite":function(){define("dojo/selector/lite",["../has","../_base/kernel"],function(n,t){var i=document.createElement("div"),u=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector,f=i.querySelectorAll,h=/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g,r,e,o,s;return n.add("dom-matches-selector",!!u),n.add("dom-qsa",!!f),r=function(i,u){var c,h,a,l,v;if(s&&-1<i.indexOf(","))return s(i,u);if(c=u?u.ownerDocument||u:t.doc||document,h=(f?/^([\w]*)#([\w\-]+$)|^(\.)([\w\-\*]+$)|^(\w+$)/:/^([\w]*)#([\w\-]+)(?:\s+(.*))?$|(?:^|(>|.+\s+))([\w\-\*]+)(\S*$)/).exec(i),u=u||c,h){if(a=8===n("ie")&&n("quirks")?u.nodeType===c.nodeType:null!==u.parentNode&&9!==u.nodeType&&u.parentNode===c,h[2]&&a){if(l=t.byId?t.byId(h[2],c):c.getElementById(h[2]),!l||h[1]&&h[1]!=l.tagName.toLowerCase())return[];if(u!=c)for(c=l;c!=u;)if(c=c.parentNode,!c)return[];return h[3]?r(h[3],l):[l]}if(h[3]&&u.getElementsByClassName)return u.getElementsByClassName(h[4]);if(h[5])if(l=u.getElementsByTagName(h[5]),h[4]||h[6])i=(h[4]||"")+h[6];else return l}if(f)return 1===u.nodeType&&"object"!==u.nodeName.toLowerCase()?e(u,i,u.querySelectorAll):u.querySelectorAll(i);for(l||(l=u.getElementsByTagName("*")),h=[],c=0,a=l.length;c<a;c++)v=l[c],1==v.nodeType&&o(v,i,u)&&h.push(v);return h},e=function(n,t,i){var o=n,f=n.getAttribute("id"),u=f||"__dojo__",r=n.parentNode,e=/^\s*[+~]/.test(t);if(e&&!r)return[];for(f?u=u.replace(/'/g,"\\$&"):n.setAttribute("id",u),e&&r&&(n=n.parentNode),t=t.match(h),r=0;r<t.length;r++)t[r]="[id='"+u+"'] "+t[r];t=t.join(",");try{return i.call(n,t)}finally{f||o.removeAttribute("id")}},n("dom-matches-selector")||(o=function(){function r(n,t,i){var r=t.charAt(0),u;return('"'==r||"'"==r)&&(t=t.slice(1,-1)),t=t.replace(/\\/g,""),u=s[i||""],function(i){return(i=i.getAttribute(n))&&u(i,t)}}function u(n){return function(t,i){for(;(t=t.parentNode)!=i;)if(n(t,i))return!0}}function f(n){return function(t,i){return t=t.parentNode,n?t!=i&&n(t,i):t==i}}function n(n,t){return n?function(i,r){return t(i)&&n(i,r)}:t}var e="div"==i.tagName?"toLowerCase":"toUpperCase",o={"":function(n){return n=n[e](),function(t){return t.tagName==n}},".":function(n){var t=" "+n+" ";return function(i){return-1<i.className.indexOf(n)&&-1<(" "+i.className+" ").indexOf(t)}},"#":function(n){return function(t){return t.id==n}}},s={"^=":function(n,t){return 0==n.indexOf(t)},"*=":function(n,t){return-1<n.indexOf(t)},"$=":function(n,t){return n.substring(n.length-t.length,n.length)==t},"~=":function(n,t){return-1<(" "+n+" ").indexOf(" "+t+" ")},"|=":function(n,t){return 0==(n+"-").indexOf(t+"-")},"=":function(n,t){return n==t},"":function(){return!0}},t={};return function(i,e,s){var h=t[e];if(!h){if(e.replace(/(?:\s*([> ])\s*)|(#|\.)?((?:\\.|[\w-])+)|\[\s*([\w-]+)\s*(.?=)?\s*("(?:\\.|[^"])+"|'(?:\\.|[^'])+'|(?:\\.|[^\]])*)\s*\]/g,function(t,i,e,s,c,l,a){return s?h=n(h,o[e||""](s.replace(/\\/g,""))):i?h=(" "==i?u:f)(h):c&&(h=n(h,r(c,a,l))),""}))throw Error("Syntax error in query");if(!h)return!0;t[e]=h}return h(i,s)}}()),n("dom-qsa")||(s=function(n,t){for(var o,i=n.match(h),f=[],u=0;u<i.length;u++){n=new String(i[u].replace(/\s*$/,""));n.indexOf=escape;for(var s=r(n,t),e=0,c=s.length;e<c;e++)o=s[e],f[o.sourceIndex]=o}i=[];for(u in f)i.push(f[u]);return i}),r.match=u?function(n,t,i){return i&&9!=i.nodeType?e(i,t,function(t){return u.call(n,t)}):u.call(n,t)}:o,r})},"dojo/store/util/QueryResults":function(){define("dojo/store/util/QueryResults",["../../_base/array","../../_base/lang","../../when"],function(n,t,i){var r=function(u){function f(t){u[t]=function(){var f=arguments,o=i(u,function(i){return Array.prototype.unshift.call(f,i),r(n[t].apply(n,f))});if("forEach"!==t||e)return o}}if(!u)return u;var e=!!u.then;return e&&(u=t.delegate(u)),f("forEach"),f("filter"),f("map"),null==u.total&&(u.total=i(u,function(n){return n.length})),u};return t.setObject("dojo.store.util.QueryResults",r),r})},"dojox/data/CsvStore":function(){define("dojox/data/CsvStore","dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(n,t,i,r,u,f){return t=t("dojox.data.CsvStore",null,{constructor:function(n){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;n.url&&(this.url=n.url);this._csvData=n.data;n.label?this.label=n.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=n.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in n&&(this.separator=n.separator);"urlPreventCache"in n&&(this.urlPreventCache=n.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(n){if(!this.isItem(n))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(n){return n=this.getIdentity(n),this.identifier&&(n=this._idMap[n]),n},getValue:function(n,t,i){this._assertIsItem(n);var r=i;if("string"==typeof t)t=this._attributeIndexes[t],null!=t&&(r=this._dataArray[this._getIndex(n)][t]||i);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return r},getValues:function(n,t){var i=this.getValue(n,t);return i?[i]:[]},getAttributes:function(n){var i,t;for(this._assertIsItem(n),i=[],n=this._dataArray[this._getIndex(n)],t=0;t<n.length;t++)""!==n[t]&&i.push(this._attributes[t]);return i},hasAttribute:function(n,t){if(this._assertIsItem(n),"string"==typeof t){var i=this._attributeIndexes[t],r=this._dataArray[this._getIndex(n)];return"undefined"!=typeof i&&i<r.length&&""!==r[i]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(n,t,i){var r=void 0;return"string"==typeof i&&(r=u.patternToRegExp(i,!1)),this._containsValue(n,t,i,r)},_containsValue:function(n,t,i,r){for(n=this.getValues(n,t),t=0;t<n.length;++t){var u=n[t];if("string"==typeof u&&r)return null!==u.match(r);if(i===u)return!0}return!1},isItem:function(n){if(n&&n[this._storeProp]===this)if(n=n[this._idProp],this.identifier){if(this._dataArray[this._idMap[n]])return!0}else if(0<=n&&n<this._dataArray.length)return!0;return!1},isItemLoaded:function(n){return this.isItem(n)},loadItem:function(){},getFeatures:function(){return this._features},getLabel:function(n){if(this.label&&this.isItem(n))return this.getValue(n,this.label)},getLabelAttributes:function(){return this.label?[this.label]:null},_fetchItems:function(n,t,r){var f=this,e=function(n,i){var s=null,h,c;if(n.query){var r,e,s=[],o=n.queryOptions?n.queryOptions.ignoreCase:!1,l={};for(r in n.query)e=n.query[r],"string"==typeof e&&(l[r]=u.patternToRegExp(e,o));for(o=0;o<i.length;++o){h=!0;c=i[o];for(r in n.query)e=n.query[r],f._containsValue(c,r,e,l[r])||(h=!1);h&&s.push(c)}}else s=i.slice(0,i.length);t(s,n)},o,s,h;if(this._loadFinished)e(n,this._arrayOfAllItems);else if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:n,filter:e}):(this._loadInProgress=!0,o=i.get({url:f.url,handleAs:"text",preventCache:f.urlPreventCache}),o.addCallback(function(t){try{f._processData(t);e(n,f._arrayOfAllItems);f._handleQueuedFetches()}catch(i){r(i,n)}}),o.addErrback(function(t){if(f._loadInProgress=!1,r)r(t,n);else throw t;}),s=null,n.abort&&(s=n.abort),n.abort=function(){var t=o;t&&-1===t.fired&&(t.cancel(),t=null);s&&s.call(n)});else if(this._csvData)try{this._processData(this._csvData);this._csvData=null;e(n,this._arrayOfAllItems)}catch(c){r(c,n)}else if(h=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input."),r)r(h,n);else throw h;},close:function(){},_getArrayOfArraysFromCsvFileContents:function(t){var r,u;if(n.isString(t)){var c=RegExp("^\\s+","g"),l=RegExp("\\s+$","g"),a=RegExp('""',"g"),f=[],o=this._splitLines(t);for(t=0;t<o.length;++t)if(r=o[t],0<r.length){for(r=r.split(this.separator),u=0;u<r.length;){var s=r[u].replace(c,""),i=s.replace(l,""),h=i.charAt(0),e=i.charAt(i.length-1),v=i.charAt(i.length-2),y=i.charAt(i.length-3);if(2===i.length&&'""'==i)r[u]="";else if('"'==h&&('"'!=e||'"'==e&&'"'==v&&'"'!=y)){if(u+1===r.length)return;r[u]=s+this.separator+r[u+1];r.splice(u+1,1)}else'"'==h&&'"'==e&&(i=i.slice(1,i.length-1),i=i.replace(a,'"')),r[u]=i,u+=1}f.push(r)}for(this._attributes=f.shift(),t=0;t<this._attributes.length;t++)this._attributeIndexes[this._attributes[t]]=t;this._dataArray=f}},_splitLines:function(n){for(var u=[],t="",f=!1,r,i=0;i<n.length;i++){r=n.charAt(i);switch(r){case'"':f=!f;t+=r;break;case"\r":f?t+=r:(u.push(t),t="",i<n.length-1&&"\n"==n.charAt(i+1)&&i++);break;case"\n":f?t+=r:(u.push(t),t="");break;default:t+=r}}return""!==t&&u.push(t),u},_processData:function(n){if(this._getArrayOfArraysFromCsvFileContents(n),this._arrayOfAllItems=[],this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(n=0;n<this._dataArray.length;n++){var t=n;this.identifier&&(t=this._dataArray[n][this._attributeIndexes[this.identifier]],this._idMap[t]=n);this._arrayOfAllItems.push(this._createItemFromIdentity(t))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(n){var t={};return t[this._storeProp]=this,t[this._idProp]=n,t},getIdentity:function(n){return this.isItem(n)?n[this._idProp]:null},fetchItemByIdentity:function(n){var t,f=n.scope?n.scope:r.global,u;if(this._loadFinished)t=this._createItemFromIdentity(n.identity),this.isItem(t)||(t=null),n.onItem&&n.onItem.call(f,t);else if(u=this,""!==this.url)this._loadInProgress?this._queuedFetches.push({args:n}):(this._loadInProgress=!0,t=i.get({url:u.url,handleAs:"text"}),t.addCallback(function(t){try{u._processData(t);var i=u._createItemFromIdentity(n.identity);u.isItem(i)||(i=null);n.onItem&&n.onItem.call(f,i);u._handleQueuedFetches()}catch(r){n.onError&&n.onError.call(f,r)}}),t.addErrback(function(t){this._loadInProgress=!1;n.onError&&n.onError.call(f,t)}));else if(this._csvData)try{u._processData(u._csvData);u._csvData=null;t=u._createItemFromIdentity(n.identity);u.isItem(t)||(t=null);n.onItem&&n.onItem.call(f,t)}catch(e){n.onError&&n.onError.call(f,e)}},getIdentityAttributes:function(){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){var n;if(0<this._queuedFetches.length){for(n=0;n<this._queuedFetches.length;n++){var t=this._queuedFetches[n],i=t.filter,r=t.args;i?i(r,this._arrayOfAllItems):this.fetchItemByIdentity(t.args)}this._queuedFetches=[]}}}),n.extend(t,f),t})},"dojox/gfx/Moveable":function(){define("dojox/gfx/Moveable","dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),function(n,t,i,r,u,f,e,o,s,h){return t("dojox.gfx.Moveable",null,{constructor:function(t,i){this.shape=t;this.delay=i&&0<i.delay?i.delay:0;this.mover=i&&i.mover?i.mover:s;this.leftButtonOnly=i&&i.leftButtonOnly;this.events=[this.shape.on(f.press,n.hitch(this,"onMouseDown"))]},destroy:function(){i.forEach(this.events,function(n){n.remove()});this.events=this.shape=null},onMouseDown:function(t){this.delay?(this.events.push(this.shape.on(f.move,n.hitch(this,"onMouseMove")),this.shape.on(f.release,n.hitch(this,"onMouseUp"))),this._lastX=t.clientX,this._lastY=t.clientY):this.leftButtonOnly&&!h.isLeft(t)||new this.mover(this.shape,t,this);r.stop(t)},onMouseMove:function(n){var t=n.clientY;(Math.abs(n.clientX-this._lastX)>this.delay||Math.abs(t-this._lastY)>this.delay)&&(this.onMouseUp(n),new this.mover(this.shape,n,this));r.stop(n)},onMouseUp:function(){this.events.pop().remove()},onMoveStart:function(n){u.publish("/gfx/move/start",n);e.add(o.body(),"dojoMove")},onMoveStop:function(n){u.publish("/gfx/move/stop",n);e.remove(o.body(),"dojoMove")},onFirstMove:function(){},onMove:function(n,t,i){this.onMoving(n,t,i);this.shape.applyLeftTransform(t);this.onMoved(n,t)},onMoving:function(){},onMoved:function(){}})})},"dojox/gfx/Mover":function(){define("dojox/gfx/Mover","dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(n,t,i,r,u,f){return i("dojox.gfx.Mover",null,{constructor:function(t,i,e){if(this.shape=t,this.lastX=i.clientX,this.lastY=i.clientY,t=this.host=e,i=document,e=r(i,u.move,n.hitch(this,"onFirstMove")),this.events=[r(i,u.move,n.hitch(this,"onMouseMove")),r(i,u.release,n.hitch(this,"destroy")),r(i,"dragstart",n.hitch(f,"stop")),r(i,"selectstart",n.hitch(f,"stop")),e],t&&t.onMoveStart)t.onMoveStart(this)},onMouseMove:function(n){var t=n.clientX,i=n.clientY;this.host.onMove(this,{dx:t-this.lastX,dy:i-this.lastY},n);this.lastX=t;this.lastY=i;f.stop(n)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){t.forEach(this.events,function(n){n.remove()});var n=this.host;if(n&&n.onMoveStop)n.onMoveStop(this);this.events=this.shape=null}})})},"dojox/gfx/canvas":function(){require({cache:{"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(n,t,i,r,u,f,e,o,s,h){function l(n,t){if(!a)return n.splice(t,1);var i=n.length;if(i){for(;t<i;)n[t]=n[t+1],t++;n.length--}}var a=!!u("chrome"),c=n.shape={};return c.Shape=i("dojox.gfx.shape.Shape",null,{constructor:function(){if(this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null,u("gfxRegistry")){var n=c.register(this);this.getUID=function(){return n}}},destroy:function(){u("gfxRegistry")&&c.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var n=this.getBoundingBox(),t;return n?(t=this._getRealMatrix(),[h.multiplyPoint(t,n.x,n.y),h.multiplyPoint(t,n.x+n.width,n.y),h.multiplyPoint(t,n.x+n.width,n.y+n.height),h.multiplyPoint(t,n.x,n.y+n.height)]):null},getEventSource:function(){return this.rawNode},setClip:function(n){this.clip=n},getClip:function(){return this.clip},setShape:function(t){return this.shape=n.makeParameters(this.shape,t),this.bbox=null,this},setFill:function(t){if(!t)return this.fillStyle=null,this;var i=null;if("object"==typeof t&&"type"in t)switch(t.type){case"linear":i=n.makeParameters(n.defaultLinearGradient,t);break;case"radial":i=n.makeParameters(n.defaultRadialGradient,t);break;case"pattern":i=n.makeParameters(n.defaultPattern,t)}else i=n.normalizeColor(t);return this.fillStyle=i,this},setStroke:function(i){return i?(("string"==typeof i||t.isArray(i)||i instanceof s)&&(i={color:i}),i=this.strokeStyle=n.makeParameters(n.defaultStroke,i),i.color=n.normalizeColor(i.color),this):(this.strokeStyle=null,this)},setTransform:function(n){return this.matrix=h.clone(n?h.normalize(n):h.identity),this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var n=this.getParent();return n&&(n._moveChildToFront(this),this._moveToFront()),this},moveToBack:function(){var n=this.getParent();return n&&(n._moveChildToBack(this),this._moveToBack()),this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(n){return n?this.setTransform([this.matrix,n]):this},applyLeftTransform:function(n){return n?this.setTransform([n,this.matrix]):this},applyTransform:function(n){return n?this.setTransform([this.matrix,n]):this},removeShape:function(n){return this.parent&&this.parent.remove(this,n),this},_setParent:function(n,t){return this.parent=n,this._updateParentMatrix(t)},_updateParentMatrix:function(n){return this.parentMatrix=n?h.clone(n):null,this._applyTransform()},_getRealMatrix:function(){for(var t=this.matrix,n=this.parent;n;)n.matrix&&(t=h.multiply(n.matrix,t)),n=n.parent;return t}}),c._eventsProcessing={on:function(t,i){return f(this.getEventSource(),t,c.fixCallback(this,n.fixTarget,i))},connect:function(n,i,r){"on"==n.substring(0,2)&&(n=n.substring(2));return this.on(n,r?t.hitch(i,r):i)},disconnect:function(n){return n.remove()}},c.fixCallback=function(n,i,u,f){if(f||(f=u,u=null),t.isString(f)){if(u=u||r.global,!u[f])throw['dojox.gfx.shape.fixCallback: scope["',f,'"] is null (scope="',u,'")'].join("");return function(t){if(i(t,n))return u[f].apply(u,arguments||[])}}return u?function(t){if(i(t,n))return f.apply(u,arguments||[])}:function(t){if(i(t,n))return f.apply(u,arguments)}},t.extend(c.Shape,c._eventsProcessing),c.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(n){var t=n.getParent();return t&&t.remove(n,!0),this.children.push(n),n._setParent(this,this._getRealMatrix())},remove:function(n,t){for(var i=0;i<this.children.length;++i)if(this.children[i]==n){t||(n.parent=null,n.parentMatrix=null);l(this.children,i);break}return this},clear:function(n){for(var t,i=0;i<this.children.length;++i)t=this.children[i],t.parent=null,t.parentMatrix=null,n&&t.destroy();return this.children=[],this},getBoundingBox:function(){if(this.children){var n=null;return e.forEach(this.children,function(t){var i=t.getBoundingBox();i&&((t=t.getTransform())&&(i=h.multiplyRectangle(t,i)),n?(n.x=Math.min(n.x,i.x),n.y=Math.min(n.y,i.y),n.endX=Math.max(n.endX,i.x+i.width),n.endY=Math.max(n.endY,i.y+i.height)):n={x:i.x,y:i.y,endX:i.x+i.width,endY:i.y+i.height})}),n&&(n.width=n.endX-n.x,n.height=n.endY-n.y),n}return null},_moveChildToFront:function(n){for(var t=0;t<this.children.length;++t)if(this.children[t]==n){l(this.children,t);this.children.push(n);break}return this},_moveChildToBack:function(n){for(var t=0;t<this.children.length;++t)if(this.children[t]==n){l(this.children,t);this.children.unshift(n);break}return this}},c.Surface=i("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){if(e.forEach(this._nodes,o.destroy),this._nodes=[],e.forEach(this._events,function(n){n&&n.remove()}),this._events=[],this.rawNode=null,u("ie"))for(;this._parent.lastChild;)o.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(){},whenLoaded:function(n,i){var r=t.hitch(n,i);if(this.isLoaded)r(this);else f.once(this,"load",function(n){r(n)})}}),t.extend(c.Surface,c._eventsProcessing),c.Rect=i("dojox.gfx.shape.Rect",c.Shape,{constructor:function(t){this.shape=n.getDefault("Rect");this.rawNode=t},getBoundingBox:function(){return this.shape}}),c.Ellipse=i("dojox.gfx.shape.Ellipse",c.Shape,{constructor:function(t){this.shape=n.getDefault("Ellipse");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.rx,y:n.cy-n.ry,width:2*n.rx,height:2*n.ry}}return this.bbox}}),c.Circle=i("dojox.gfx.shape.Circle",c.Shape,{constructor:function(t){this.shape=n.getDefault("Circle");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.r,y:n.cy-n.r,width:2*n.r,height:2*n.r}}return this.bbox}}),c.Line=i("dojox.gfx.shape.Line",c.Shape,{constructor:function(t){this.shape=n.getDefault("Line");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:Math.min(n.x1,n.x2),y:Math.min(n.y1,n.y2),width:Math.abs(n.x2-n.x1),height:Math.abs(n.y2-n.y1)}}return this.bbox}}),c.Polyline=i("dojox.gfx.shape.Polyline",c.Shape,{constructor:function(t){this.shape=n.getDefault("Polyline");this.rawNode=t},setShape:function(n,t){return n&&n instanceof Array?(this.inherited(arguments,[{points:n}]),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[n]),this},_normalizePoints:function(){var n=this.shape.points,r=n&&n.length,i,t;if(r&&"number"==typeof n[0]){for(i=[],t=0;t<r;t+=2)i.push({x:n[t],y:n[t+1]});this.shape.points=i}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var r=this.shape.points,o=r.length,n=r[0],t=n.x,i=n.y,u=n.x,f=n.y,e=1;e<o;++e)n=r[e],t>n.x&&(t=n.x),u<n.x&&(u=n.x),i>n.y&&(i=n.y),f<n.y&&(f=n.y);this.bbox={x:t,y:i,width:u-t,height:f-i}}return this.bbox}}),c.Image=i("dojox.gfx.shape.Image",c.Shape,{constructor:function(t){this.shape=n.getDefault("Image");this.rawNode=t},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}}),c.Text=i(c.Shape,{constructor:function(t){this.fontStyle=null;this.shape=n.getDefault("Text");this.rawNode=t},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?n.splitFontString(t):n.makeParameters(n.defaultFont,t),this._setFont(),this},getBoundingBox:function(){var t=null;return this.getShape().text&&(t=n._base._computeTextBoundingBox(this)),t}}),c.Creator={createShape:function(t){switch(t.type){case n.defaultPath.type:return this.createPath(t);case n.defaultRect.type:return this.createRect(t);case n.defaultCircle.type:return this.createCircle(t);case n.defaultEllipse.type:return this.createEllipse(t);case n.defaultLine.type:return this.createLine(t);case n.defaultPolyline.type:return this.createPolyline(t);case n.defaultImage.type:return this.createImage(t);case n.defaultText.type:return this.createText(t);case n.defaultTextPath.type:return this.createTextPath(t)}return null},createGroup:function(){return this.createObject(n.Group)},createRect:function(t){return this.createObject(n.Rect,t)},createEllipse:function(t){return this.createObject(n.Ellipse,t)},createCircle:function(t){return this.createObject(n.Circle,t)},createLine:function(t){return this.createObject(n.Line,t)},createPolyline:function(t){return this.createObject(n.Polyline,t)},createImage:function(t){return this.createObject(n.Image,t)},createText:function(t){return this.createObject(n.Text,t)},createPath:function(t){return this.createObject(n.Path,t)},createTextPath:function(t){return this.createObject(n.TextPath,{}).setText(t)},createObject:function(){return null}},c})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(n,t,i,r,u){return u=i("dojox.gfx.path.Path",u.Shape,{constructor:function(i){this.shape=t.clone(n.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=i;this.segmented=!1},setAbsoluteMode:function(n){return this._confirmSegmented(),this.absolute="string"==typeof n?"absolute"==n:n,this},getAbsoluteMode:function(){return this._confirmSegmented(),this.absolute},getBoundingBox:function(){return this._confirmSegmented(),this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){var i,n,t,r;if(this._confirmSegmented(),this.tbbox)return this.tbbox;for(i=this.bbox,n=this._getRealMatrix(),this.bbox=null,t=0,r=this.segments.length;t<r;++t)this._updateWithSegment(this.segments[t],n);return n=this.bbox,this.bbox=i,this.tbbox=n?[{x:n.l,y:n.t},{x:n.r,y:n.t},{x:n.r,y:n.b},{x:n.l,y:n.b}]:null},getLastPosition:function(){return this._confirmSegmented(),"x"in this.last?this.last:null},_applyTransform:function(){return this.tbbox=null,this.inherited(arguments)},_updateBBox:function(n,t,i){i&&(t=r.multiplyPoint(i,n,t),n=t.x,t=t.y);this.bbox&&"l"in this.bbox?(this.bbox.l>n&&(this.bbox.l=n),this.bbox.r<n&&(this.bbox.r=n),this.bbox.t>t&&(this.bbox.t=t),this.bbox.b<t&&(this.bbox.b=t)):this.bbox={l:n,b:t,r:n,t:t}},_updateWithSegment:function(t,i){var u=t.args,f=u.length,r,e;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<f;r+=2)this._updateBBox(u[r],u[r+1],i);this.last.x=u[f-2];this.last.y=u[f-1];this.absolute=!0;break;case"H":for(r=0;r<f;++r)this._updateBBox(u[r],this.last.y,i);this.last.x=u[f-1];this.absolute=!0;break;case"V":for(r=0;r<f;++r)this._updateBBox(this.last.x,u[r],i);this.last.y=u[f-1];this.absolute=!0;break;case"m":for(r=0,("x"in this.last)||(this._updateBBox(this.last.x=u[0],this.last.y=u[1],i),r=2);r<f;r+=2)this._updateBBox(this.last.x+=u[r],this.last.y+=u[r+1],i);this.absolute=!1;break;case"l":case"t":for(r=0;r<f;r+=2)this._updateBBox(this.last.x+=u[r],this.last.y+=u[r+1],i);this.absolute=!1;break;case"h":for(r=0;r<f;++r)this._updateBBox(this.last.x+=u[r],this.last.y,i);this.absolute=!1;break;case"v":for(r=0;r<f;++r)this._updateBBox(this.last.x,this.last.y+=u[r],i);this.absolute=!1;break;case"c":for(r=0;r<f;r+=6)this._updateBBox(this.last.x+u[r],this.last.y+u[r+1],i),this._updateBBox(this.last.x+u[r+2],this.last.y+u[r+3],i),this._updateBBox(this.last.x+=u[r+4],this.last.y+=u[r+5],i);this.absolute=!1;break;case"s":case"q":for(r=0;r<f;r+=4)this._updateBBox(this.last.x+u[r],this.last.y+u[r+1],i),this._updateBBox(this.last.x+=u[r+2],this.last.y+=u[r+3],i);this.absolute=!1;break;case"A":for(r=0;r<f;r+=7)this._updateBBox(u[r+5],u[r+6],i);this.last.x=u[f-2];this.last.y=u[f-1];this.absolute=!0;break;case"a":for(r=0;r<f;r+=7)this._updateBBox(this.last.x+=u[r+5],this.last.y+=u[r+6],i);this.absolute=!1}for(e=[t.action],r=0;r<f;++r)e.push(n.formatNumber(u[r],!0));if("string"==typeof this.shape.path)this.shape.path+=e.join("");else for(r=0,f=e.length;r<f;++r)this.shape.path.push(e[r])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(n,t){this.tbbox=null;var i=this._validSegments[n.toLowerCase()];"number"==typeof i&&(i?t.length>=i&&(i={action:n,args:t.slice(0,t.length-t.length%i)},this.segments.push(i),this._updateWithSegment(i)):(i={action:n,args:[]},this.segments.push(i),this._updateWithSegment(i)))},_collectArgs:function(n,t){for(var i,r=0;r<t.length;++r)i=t[r],"boolean"==typeof i?n.push(i?1:0):"number"==typeof i?n.push(i):i instanceof Array?this._collectArgs(n,i):"x"in i&&"y"in i&&n.push(i.x,i.y)},moveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"M":"m",n),this},lineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"L":"l",n),this},hLineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"H":"h",n),this},vLineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"V":"v",n),this},curveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"C":"c",n),this},smoothCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"S":"s",n),this},qCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"Q":"q",n),this},qSmoothCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"T":"t",n),this},arcTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"A":"a",n),this},closePath:function(){return this._confirmSegmented(),this._pushSegment("Z",[]),this},_confirmSegmented:function(){if(!this.segmented){var n=this.shape.path;this.shape.path=[];this._setPath(n);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(i){var e,o;if(i=t.isArray(i)?i:i.match(n.pathSvgRegExp),this.segments=[],this.absolute=!0,this.bbox={},this.last={},i){for(var r="",u=[],s=i.length,f=0;f<s;++f)e=i[f],o=parseFloat(e),isNaN(o)?(r&&this._pushSegment(r,u),u=[],r=e):u.push(o);this._pushSegment(r,u)}},setShape:function(t){return this.inherited(arguments,["string"==typeof t?{path:t}:t]),this.segmented=!1,this.segments=[],n.lazyPathSegmentation||this._confirmSegmented(),this},_2PI:2*Math.PI}),i=i("dojox.gfx.path.TextPath",u,{constructor:function(){"text"in this||(this.text=t.clone(n.defaultTextPath));"fontStyle"in this||(this.fontStyle=t.clone(n.defaultFont))},getText:function(){return this.text},setText:function(t){return this.text=n.makeParameters(this.text,"string"==typeof t?{text:t}:t),this._setText(),this},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?n.splitFontString(t):n.makeParameters(n.defaultFont,t),this._setFont(),this}}),n.path={Path:u,TextPath:i}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(n,t,i){function r(n){var t=Math.cos(n),i;return n=Math.sin(n),i={x:t+4/3*(1-t),y:n-4/3*t*(1-t)/n},{s:{x:t,y:-n},c1:{x:i.x,y:-i.y},c2:i,e:{x:t,y:n}}}var u=2*Math.PI,e=Math.PI/4,f=Math.PI/8,s=e+f,o=r(f);return n.arc={unitArcAsBezier:r,curvePI4:o,arcAsBezier:function(n,t,h,c,l,a,v,y){var w;l=!!l;a=!!a;w=i._degToRad(c);c=t*t;var b=h*h,p=i.multiplyPoint(i.rotate(-w),{x:(n.x-v)/2,y:(n.y-y)/2}),k=p.x*p.x,d=p.y*p.y;for(c=Math.sqrt((c*b-c*d-b*k)/(c*d+b*k)),isNaN(c)&&(c=0),c={x:c*t*p.y/h,y:-c*h*p.x/t},l==a&&(c={x:-c.x,y:-c.y}),c=i.multiplyPoint([i.translate((n.x+v)/2,(n.y+y)/2),i.rotate(w)],c),t=i.normalize([i.translate(c.x,c.y),i.rotate(w),i.scale(t,h)]),c=i.invert(t),n=i.multiplyPoint(c,n),y=i.multiplyPoint(c,v,y),v=Math.atan2(n.y,n.x),c=v-Math.atan2(y.y,y.x),a&&(c=-c),0>c?c+=u:c>u&&(c-=u),h=f,y=o,h=a?h:-h,n=[],l=c;0<l;l-=e)l<s&&(h=l/2,y=r(h),h=a?h:-h,l=0),p=i.normalize([t,i.rotate(v+h)]),a?(c=i.multiplyPoint(p,y.c1),w=i.multiplyPoint(p,y.c2),p=i.multiplyPoint(p,y.e)):(c=i.multiplyPoint(p,y.c2),w=i.multiplyPoint(p,y.c1),p=i.multiplyPoint(p,y.s)),n.push([c.x,c.y,w.x,w.y,p.x,p.y]),v+=2*h;return n}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(n,t,i){function r(n,t){return Math.abs(n-t)<=1e-6*(Math.abs(n)+Math.abs(t))}function u(n,t,i,r){return isFinite(n)?isFinite(i)?(t=Math.abs(t),r=Math.abs(r),(t*n+r*i)/(t+r)):n:i}function f(n){var h;n=i.normalize(n);var u=-n.xx-n.yy,s=n.xx*n.yy-n.xy*n.yx,t=Math.sqrt(u*u-4*s),u=-(u+(0>u?-t:t))/2,s=s/u,t=n.xy/(u-n.xx),e=1,f=n.xy/(s-n.xx),o=1;return r(u,s)&&(t=1,f=e=0,o=1),isFinite(t)||(t=1,e=(u-n.xx)/n.xy,isFinite(e)||(t=(u-n.yy)/n.yx,e=1,isFinite(t)||(t=1,e=n.yx/(u-n.yy)))),isFinite(f)||(f=1,o=(s-n.xx)/n.xy,isFinite(o)||(f=(s-n.yy)/n.yx,o=1,isFinite(f)||(f=1,o=n.yx/(s-n.yy)))),n=Math.sqrt(t*t+e*e),h=Math.sqrt(f*f+o*o),isFinite(t/=n)||(t=0),isFinite(e/=n)||(e=0),isFinite(f/=h)||(f=0),isFinite(o/=h)||(o=0),{value1:u,value2:s,vector1:{x:t,y:e},vector2:{x:f,y:o}}}function e(n,t){var i=0>n.xx*n.yy||0<n.xy*n.yx?-1:1,r=t.angle1=(Math.atan2(n.yx,n.yy)+Math.atan2(-i*n.xy,i*n.xx))/2,i=Math.cos(r),r=Math.sin(r);return t.sx=u(n.xx/i,i,-n.xy/r,r),t.sy=u(n.yy/i,i,n.yx/r,r),t}function o(n,t){var i=0>n.xx*n.yy||0<n.xy*n.yx?-1:1,r=t.angle2=(Math.atan2(i*n.yx,i*n.xx)+Math.atan2(-n.xy,n.yy))/2,i=Math.cos(r),r=Math.sin(r);return t.sx=u(n.xx/i,i,n.yx/r,r),t.sy=u(n.yy/i,i,-n.xy/r,r),t}return n.decompose=function(n){var u=i.normalize(n),h,s;return(n={dx:u.dx,dy:u.dy,sx:1,sy:1,angle1:0,angle2:0},r(u.xy,0)&&r(u.yx,0))?t.mixin(n,{sx:u.xx,sy:u.yy}):r(u.xx*u.yx,-u.xy*u.yy)?e(u,n):r(u.xx*u.xy,-u.yx*u.yy)?o(u,n):(s=new i.Matrix2D(u),h=t.mixin(s,{dx:0,dy:0,xy:s.yx,yx:s.xy}),s=f([u,h]),h=f([h,u]),s=new i.Matrix2D({xx:s.vector1.x,xy:s.vector2.x,yx:s.vector1.y,yy:s.vector2.y}),h=new i.Matrix2D({xx:h.vector1.x,xy:h.vector1.y,yx:h.vector2.x,yy:h.vector2.y}),u=new i.Matrix2D([i.invert(s),u,i.invert(h)]),e(h,n),u.xx*=n.sx,u.yy*=n.sy,o(s,n),u.xx*=n.sx,u.yy*=n.sy,t.mixin(n,{sx:u.xx,sy:u.yy}))}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(n){n=n.bezierutils={};n.tAtLength=function(n,r){var o=0,s=6==n.length,u=0,h=0,c=s?i:f,e=function(i,f){for(var a=0,l=0;l<i.length-2;l+=2)a+=t(i[l],i[l+1],i[l+2],i[l+3]);l=s?t(n[0],n[1],n[4],n[5]):t(n[0],n[1],n[6],n[7]);a-l>f||u+a>r+f?(++h,a=c(i,.5),e(a[0],f),Math.abs(u-r)<=f||e(a[1],f)):(u+=a,o+=1/(1<<h))};return r&&e(n,.5),o};var r=n.computeLength=function(n){for(var o=6==n.length,e=0,f=0;f<n.length-2;f+=2)e+=t(n[f],n[f+1],n[f+2],n[f+3]);return f=o?t(n[0],n[1],n[4],n[5]):t(n[0],n[1],n[6],n[7]),.1<e-f&&(n=o?i(n,.5):u(n,.5),e=r(n[0],o),e+=r(n[1],o)),e},t=n.distance=function(n,t,i,r){return Math.sqrt((i-n)*(i-n)+(r-t)*(r-t))},i=function(n,t){var i=1-t,r=i*i,c=t*t,u=n[0],f=n[1],e=n[2],o=n[3],s=n[4],h=n[5],l=r*u+2*i*t*e+c*s,r=r*f+2*i*t*o+c*h;return[[u,f,i*u+t*e,i*f+t*o,l,r],[l,r,i*e+t*s,i*o+t*h,s,h]]},u=function(n,t){var i=1-t,r=i*i,f=r*i,u=t*t,y=u*t,e=n[0],o=n[1],s=n[2],h=n[3],c=n[4],l=n[5],a=n[6],v=n[7],p=f*e+3*r*t*s+3*i*u*c+y*a,f=f*o+3*r*t*h+3*i*u*l+y*v;return[[e,o,i*e+t*s,i*o+t*h,r*e+2*i*t*s+u*c,r*o+2*i*t*h+u*l,p,f],[p,f,r*s+2*i*t*c+u*a,r*h+2*i*t*l+u*v,i*c+t*a,i*l+t*v,a,v]]},f=n.splitBezierAtT=function(n,t){return 6==n.length?i(n,t):u(n,t)};return n})},"*noref":1}});define("dojox/gfx/canvas","./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(n,t,r,u,f,e,o,s,h,c,l,a,v){function ft(n,t,i,r,u,f,e,o,s,h){var a,c,v=t.length,l=0;for(h?(c=h.l/u,l=h.i):c=t[0]/u;f<e;)f+c>e&&(a={l:(f+c-e)*u,i:l},c=e-f),l%2||(n.beginPath(),n.arc(i,r,u,f,f+c,o),s&&n.stroke()),f+=c,++l,c=t[l%v]/u;return a}function st(n,t,i,r){var e=0,o=0,u,f=0;for(r?(u=r.l,f=r.i):u=t[0];1>o;)o=v.tAtLength(n,u),1==o&&(e=v.computeLength(n),e={l:u-e,i:f}),n=v.splitBezierAtT(n,o),f%2||i.push(n[0]),n=n[1],++f,u=t[f%t.length];return e}function b(n,t,i,r){var u=[t.last.x,t.last.y].concat(i),e=!(n instanceof Array),f;for(i=4===i.length?"quadraticCurveTo":"bezierCurveTo",f=[],t=st(u,t.canvasDash,f,r),r=0;r<f.length;++r)u=f[r],e?(n.moveTo(u[0],u[1]),n[i].apply(n,u.slice(2))):(n.push("moveTo",[u[0],u[1]]),n.push(i,u.slice(2)));return t}function w(n,t,i,r,u,f,e){var p=0,s=0,o=0,h=v.distance(i,r,u,f),c=0;t=t.canvasDash;var a=i,y=r,l,w=!(n instanceof Array);for(e?(o=e.l,c=e.i):o+=t[0];.01<Math.abs(1-s);)o>h&&(p={l:o-h,i:c},o=h),s=o/h,e=i+(u-i)*s,l=r+(f-r)*s,c++%2||(w?(n.moveTo(a,y),n.lineTo(e,l)):(n.push("moveTo",[a,y]),n.push("lineTo",[e,l]))),a=e,y=l,o+=t[c%t.length];return p}var y=n.canvas={},it=null,nt=l.multiplyPoint,k=Math.PI,ht=2*k,d=k/2,rt,ct,ot,g,et,lt,tt;a=t.extend;f.global.CanvasRenderingContext2D&&(f=f.doc.createElement("canvas").getContext("2d"),rt="function"==typeof f.setLineDash,ct="function"==typeof f.fillText);ot={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};y.Shape=u("dojox.gfx.canvas.Shape",s.Shape,{_render:function(n){n.save();this._renderTransform(n);this._renderClip(n);this._renderShape(n);this._renderFill(n,!0);this._renderStroke(n,!0);n.restore()},_renderClip:function(n){this.canvasClip&&(this.canvasClip.render(n),n.clip())},_renderTransform:function(n){if("canvasTransform"in this){var t=this.canvasTransform;n.translate(t.dx,t.dy);n.rotate(t.angle2);n.scale(t.sx,t.sy);n.rotate(t.angle1)}},_renderShape:function(){},_renderFill:function(n,t){var i,s;if("canvasFill"in this){if(i=this.fillStyle,"canvasFillImage"in this){var r=i.width,u=i.height,f=this.canvasFillImage.width,e=this.canvasFillImage.height,o=Math.min(r==f?1:r/f,u==e?1:u/e),h=(r-o*f)/2,c=(u-o*e)/2;it.width=r;it.height=u;s=it.getContext("2d");s.clearRect(0,0,r,u);s.drawImage(this.canvasFillImage,0,0,f,e,h,c,o*f,o*e);this.canvasFill=n.createPattern(it,"repeat");delete this.canvasFillImage}n.fillStyle=this.canvasFill;t&&("pattern"!==i.type||0===i.x&&0===i.y||n.translate(i.x,i.y),n.fill())}else n.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(n,t){var i=this.strokeStyle;i?(n.strokeStyle=i.color.toString(),n.lineWidth=i.width,n.lineCap=i.cap,"number"==typeof i.join?(n.lineJoin="miter",n.miterLimit=i.join):n.lineJoin=i.join,this.canvasDash?rt?(n.setLineDash(this.canvasDash),t&&n.stroke()):this._renderDashedStroke(n,t):t&&n.stroke()):t||(n.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(n){this.inherited(arguments);var t=n?"width"in n?"rect":"cx"in n?"ellipse":"points"in n?"polyline":"d"in n?"path":null:null;return n&&!t?this:(this.canvasClip=n?at(t,n):null,this.parent&&this.parent._makeDirty(),this)}});var at=function(n,i){switch(n){case"ellipse":return{canvasEllipse:et({shape:i}),render:function(n){return y.Ellipse.prototype._renderShape.call(this,n)}};case"rect":return{shape:t.delegate(i,{r:0}),render:function(n){return y.Rect.prototype._renderShape.call(this,n)}};case"path":return{canvasPath:vt(i),render:function(n){this.canvasPath._renderShape(n)}};case"polyline":return{canvasPolyline:i.points,render:function(n){return y.Polyline.prototype._renderShape.call(this,n)}}}return null},vt=function(n){var t=new dojox.gfx.canvas.Path;return t.canvasPath=[],t._setPath(n.d),t},ut=function(n,t,i){var r=n.prototype[t];n.prototype[t]=i?function(){return this.parent&&this.parent._makeDirty(),r.apply(this,arguments),i.call(this),this}:function(){return this.parent&&this.parent._makeDirty(),r.apply(this,arguments)}};return ut(y.Shape,"setTransform",function(){this.matrix?this.canvasTransform=n.decompose(this.matrix):delete this.canvasTransform}),ut(y.Shape,"setFill",function(){var t=this.fillStyle,u,i;if(t){if("object"==typeof t&&"type"in t){i=this.surface.rawNode.getContext("2d");switch(t.type){case"linear":case"radial":u="linear"==t.type?i.createLinearGradient(t.x1,t.y1,t.x2,t.y2):i.createRadialGradient(t.cx,t.cy,0,t.cx,t.cy,t.r);r.forEach(t.colors,function(t){u.addColorStop(t.offset,n.normalizeColor(t.color).toString())});break;case"pattern":it||(it=document.createElement("canvas"));i=new Image;this.surface.downloadImage(i,t.src);this.canvasFillImage=i}}else u=t.toString();this.canvasFill=u}else delete this.canvasFill}),ut(y.Shape,"setStroke",function(){var i=this.strokeStyle,n,t;if(i)if(n=this.strokeStyle.style.toLowerCase(),n in ot&&(n=ot[n]),n instanceof Array){for(this.canvasDash=n=n.slice(),t=0;t<n.length;++t)n[t]*=i.width;if("butt"!=i.cap){for(t=0;t<n.length;t+=2)n[t]-=i.width,1>n[t]&&(n[t]=1);for(t=1;t<n.length;t+=2)n[t]+=i.width}}else delete this.canvasDash;else delete this.canvasDash;this._needsDash=!rt&&!!this.canvasDash}),ut(y.Shape,"setShape"),y.Group=u("dojox.gfx.canvas.Group",y.Shape,{constructor:function(){s.Container._init.call(this)},_render:function(n){n.save();this._renderTransform(n);this._renderClip(n);for(var t=0;t<this.children.length;++t)this.children[t]._render(n);n.restore()},destroy:function(){s.Container.clear.call(this,!0);y.Shape.prototype.destroy.apply(this,arguments)}}),y.Rect=u("dojox.gfx.canvas.Rect",[y.Shape,s.Rect],{_renderShape:function(n){var t=this.shape,i=Math.min(t.r,t.height/2,t.width/2),f=t.x,h=f+t.width,r=t.y,t=r+t.height,u=f+i,e=h-i,o=r+i,s=t-i;n.beginPath();n.moveTo(u,r);i?(n.arc(e,o,i,-d,0,!1),n.arc(e,s,i,0,d,!1),n.arc(u,s,i,d,k,!1),n.arc(u,o,i,k,k+d,!1)):(n.lineTo(e,r),n.lineTo(h,s),n.lineTo(u,t),n.lineTo(f,o));n.closePath()},_renderDashedStroke:function(n,t){var i=this.shape,r=Math.min(i.r,i.height/2,i.width/2),s=i.x,h=s+i.width,u=i.y,c=u+i.height,f=s+r,e=h-r,l=u+r,o=c-r;r?(n.beginPath(),i=w(n,this,f,u,e,u),t&&n.stroke(),i=ft(n,this.canvasDash,e,l,r,-d,0,!1,t,i),n.beginPath(),i=w(n,this,h,l,h,o,i),t&&n.stroke(),i=ft(n,this.canvasDash,e,o,r,0,d,!1,t,i),n.beginPath(),i=w(n,this,e,c,f,c,i),t&&n.stroke(),i=ft(n,this.canvasDash,f,o,r,d,k,!1,t,i),n.beginPath(),i=w(n,this,s,o,s,l,i),t&&n.stroke(),ft(n,this.canvasDash,f,l,r,k,k+d,!1,t,i)):(n.beginPath(),i=w(n,this,f,u,e,u),i=w(n,this,e,u,h,o,i),i=w(n,this,h,o,f,c,i),w(n,this,f,c,s,l,i),t&&n.stroke())}}),g=[],function(){var n=c.curvePI4,t,i;for(g.push(n.s,n.c1,n.c2,n.e),t=45;360>t;t+=45)i=l.rotateg(t),g.push(nt(i,n.c1),nt(i,n.c2),nt(i,n.e))}(),et=function(n){var i,u,f,r=[],t=n.shape,e=l.normalize([l.translate(t.cx,t.cy),l.scale(t.rx,t.ry)]);for(i=nt(e,g[0]),r.push([i.x,i.y]),t=1;t<g.length;t+=3)u=nt(e,g[t]),f=nt(e,g[t+1]),i=nt(e,g[t+2]),r.push([u.x,u.y,f.x,f.y,i.x,i.y]);if(n._needsDash){for(i=[],u=r[0],t=1;t<r.length;++t)f=[],st(u.concat(r[t]),n.canvasDash,f),u=[r[t][4],r[t][5]],i.push(f);n._dashedPoints=i}return r},y.Ellipse=u("dojox.gfx.canvas.Ellipse",[y.Shape,s.Ellipse],{setShape:function(){return this.inherited(arguments),this.canvasEllipse=et(this),this},setStroke:function(){return this.inherited(arguments),rt||(this.canvasEllipse=et(this)),this},_renderShape:function(n){var i=this.canvasEllipse,t;for(n.beginPath(),n.moveTo.apply(n,i[0]),t=1;t<i.length;++t)n.bezierCurveTo.apply(n,i[t]);n.closePath()},_renderDashedStroke:function(n,t){var e=this._dashedPoints,r,f,u,i;for(n.beginPath(),r=0;r<e.length;++r)for(f=e[r],u=0;u<f.length;++u)i=f[u],n.moveTo(i[0],i[1]),n.bezierCurveTo(i[2],i[3],i[4],i[5],i[6],i[7]);t&&n.stroke()}}),y.Circle=u("dojox.gfx.canvas.Circle",[y.Shape,s.Circle],{_renderShape:function(n){var t=this.shape;n.beginPath();n.arc(t.cx,t.cy,t.r,0,ht,1)},_renderDashedStroke:function(n,t){var r=this.shape,u=0,f,e=this.canvasDash.length;for(i=0;u<ht;)f=this.canvasDash[i%e]/r.r,i%2||(n.beginPath(),n.arc(r.cx,r.cy,r.r,u,u+f,0),t&&n.stroke()),u+=f,++i}}),y.Line=u("dojox.gfx.canvas.Line",[y.Shape,s.Line],{_renderShape:function(n){var t=this.shape;n.beginPath();n.moveTo(t.x1,t.y1);n.lineTo(t.x2,t.y2)},_renderDashedStroke:function(n,t){var i=this.shape;n.beginPath();w(n,this,i.x1,i.y1,i.x2,i.y2);t&&n.stroke()}}),y.Polyline=u("dojox.gfx.canvas.Polyline",[y.Shape,s.Polyline],{setShape:function(){this.inherited(arguments);var t=this.shape.points,n=t[0],r,i;if(this.bbox=null,this._normalizePoints(),t.length)if("number"==typeof n)n=t;else for(n=[],i=0;i<t.length;++i)r=t[i],n.push(r.x,r.y);else n=[];return this.canvasPolyline=n,this},_renderShape:function(n){var t=this.canvasPolyline,i;if(t.length)for(n.beginPath(),n.moveTo(t[0],t[1]),i=2;i<t.length;i+=2)n.lineTo(t[i],t[i+1])},_renderDashedStroke:function(n,t){var r=this.canvasPolyline,u=0,i;for(n.beginPath(),i=0;i<r.length;i+=2)u=w(n,this,r[i],r[i+1],r[i+2],r[i+3],u);t&&n.stroke()}}),y.Image=u("dojox.gfx.canvas.Image",[y.Shape,s.Image],{setShape:function(){this.inherited(arguments);var n=new Image;return this.surface.downloadImage(n,this.shape.src),this.canvasImage=n,this},_renderShape:function(n){var t=this.shape;n.drawImage(this.canvasImage,t.x,t.y,t.width,t.height)}}),y.Text=u("dojox.gfx.canvas.Text",[y.Shape,s.Text],{_setFont:function(){this.fontStyle?this.canvasFont=n.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var t=this.shape,i=0,n;return t.text&&(n=this.surface.rawNode.getContext("2d"),n.save(),this._renderTransform(n),this._renderFill(n,!1),this._renderStroke(n,!1),this.canvasFont&&(n.font=this.canvasFont),i=n.measureText(t.text).width,n.restore()),i},_render:function(n){n.save();this._renderTransform(n);this._renderFill(n,!1);this._renderStroke(n,!1);this._renderShape(n);n.restore()},_renderShape:function(n){var t=this.shape;t.text&&(n.textAlign="middle"===t.align?"center":t.align,this.canvasFont&&(n.font=this.canvasFont),this.canvasFill&&n.fillText(t.text,t.x,t.y),this.strokeStyle&&(n.beginPath(),n.strokeText(t.text,t.x,t.y),n.closePath()))}}),ut(y.Text,"setFont"),ct||y.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}}),lt={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"},y.Path=u("dojox.gfx.canvas.Path",[y.Shape,h.Path],{constructor:function(){this.lastControl={}},setShape:function(){return this.canvasPath=[],this._dashedPath=[],this.inherited(arguments)},setStroke:function(){return this.inherited(arguments),rt||(this.segmented=!1,this._confirmSegmented()),this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(n){var i=t.clone(this.last);this[lt[n.action]](this.canvasPath,n.action,n.args,this._needsDash?this._dashedPath:null);this.last=i;this.inherited(arguments)},_renderShape:function(n){var i=this.canvasPath,t;for(n.beginPath(),t=0;t<i.length;t+=2)n[i[t]].apply(n,i[t+1])},_renderDashedStroke:rt?function(){}:function(n,t){var r=this._dashedPath,i;for(n.beginPath(),i=0;i<r.length;i+=2)n[r[i]].apply(n,r[i+1]);t&&n.stroke()},_moveToA:function(n,t,i,r){for(n.push("moveTo",[i[0],i[1]]),r&&r.push("moveTo",[i[0],i[1]]),t=2;t<i.length;t+=2)n.push("lineTo",[i[t],i[t+1]]),r&&(this._dashResidue=w(r,this,i[t-2],i[t-1],i[t],i[t+1],this._dashResidue));this.last.x=i[i.length-2];this.last.y=i[i.length-1];this.lastControl={}},_moveToR:function(n,t,i,r){for(t=("x"in this.last)?[this.last.x+=i[0],this.last.y+=i[1]]:[this.last.x=i[0],this.last.y=i[1]],n.push("moveTo",t),r&&r.push("moveTo",t),t=2;t<i.length;t+=2)n.push("lineTo",[this.last.x+=i[t],this.last.y+=i[t+1]]),r&&(this._dashResidue=w(r,this,r[r.length-1][0],r[r.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(n,t,i,r){for(t=0;t<i.length;t+=2)r&&(this._dashResidue=w(r,this,this.last.x,this.last.y,i[t],i[t+1],this._dashResidue)),n.push("lineTo",[i[t],i[t+1]]);this.last.x=i[i.length-2];this.last.y=i[i.length-1];this.lastControl={}},_lineToR:function(n,t,i,r){for(t=0;t<i.length;t+=2)n.push("lineTo",[this.last.x+=i[t],this.last.y+=i[t+1]]),r&&(this._dashResidue=w(r,this,r[r.length-1][0],r[r.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(n,t,i,r){for(t=0;t<i.length;++t)n.push("lineTo",[i[t],this.last.y]),r&&(this._dashResidue=w(r,this,r[r.length-1][0],r[r.length-1][1],i[t],this.last.y,this._dashResidue));this.last.x=i[i.length-1];this.lastControl={}},_hLineToR:function(n,t,i,r){for(t=0;t<i.length;++t)n.push("lineTo",[this.last.x+=i[t],this.last.y]),r&&(this._dashResidue=w(r,this,r[r.length-1][0],r[r.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(n,t,i,r){for(t=0;t<i.length;++t)n.push("lineTo",[this.last.x,i[t]]),r&&(this._dashResidue=w(r,this,r[r.length-1][0],r[r.length-1][1],this.last.x,i[t],this._dashResidue));this.last.y=i[i.length-1];this.lastControl={}},_vLineToR:function(n,t,i,r){for(t=0;t<i.length;++t)n.push("lineTo",[this.last.x,this.last.y+=i[t]]),r&&(this._dashResidue=w(r,this,r[r.length-1][0],r[r.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(n,t,i,r){for(t=0;t<i.length;t+=6)n.push("bezierCurveTo",i.slice(t,t+6)),r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue));this.last.x=i[i.length-2];this.last.y=i[i.length-1];this.lastControl.x=i[i.length-4];this.lastControl.y=i[i.length-3];this.lastControl.type="C"},_curveToR:function(n,t,i,r){for(t=0;t<i.length;t+=6)n.push("bezierCurveTo",[this.last.x+i[t],this.last.y+i[t+1],this.lastControl.x=this.last.x+i[t+2],this.lastControl.y=this.last.y+i[t+3],this.last.x+i[t+4],this.last.y+i[t+5]]),r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue)),this.last.x+=i[t+4],this.last.y+=i[t+5];this.lastControl.type="C"},_smoothCurveToA:function(n,t,i,r){for(t=0;t<i.length;t+=4){var u="C"==this.lastControl.type;n.push("bezierCurveTo",[u?2*this.last.x-this.lastControl.x:this.last.x,u?2*this.last.y-this.lastControl.y:this.last.y,i[t],i[t+1],i[t+2],i[t+3]]);r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue));this.lastControl.x=i[t];this.lastControl.y=i[t+1];this.lastControl.type="C"}this.last.x=i[i.length-2];this.last.y=i[i.length-1]},_smoothCurveToR:function(n,t,i,r){for(t=0;t<i.length;t+=4){var u="C"==this.lastControl.type;n.push("bezierCurveTo",[u?2*this.last.x-this.lastControl.x:this.last.x,u?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+i[t],this.last.y+i[t+1],this.last.x+i[t+2],this.last.y+i[t+3]]);r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue));this.lastControl.x=this.last.x+i[t];this.lastControl.y=this.last.y+i[t+1];this.lastControl.type="C";this.last.x+=i[t+2];this.last.y+=i[t+3]}},_qCurveToA:function(n,t,i,r){for(t=0;t<i.length;t+=4)n.push("quadraticCurveTo",i.slice(t,t+4));r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue));this.last.x=i[i.length-2];this.last.y=i[i.length-1];this.lastControl.x=i[i.length-4];this.lastControl.y=i[i.length-3];this.lastControl.type="Q"},_qCurveToR:function(n,t,i,r){for(t=0;t<i.length;t+=4)n.push("quadraticCurveTo",[this.lastControl.x=this.last.x+i[t],this.lastControl.y=this.last.y+i[t+1],this.last.x+i[t+2],this.last.y+i[t+3]]),r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue)),this.last.x+=i[t+2],this.last.y+=i[t+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(n,t,i,r){for(t=0;t<i.length;t+=2){var u="Q"==this.lastControl.type;n.push("quadraticCurveTo",[this.lastControl.x=u?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=u?2*this.last.y-this.lastControl.y:this.last.y,i[t],i[t+1]]);r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=i[i.length-2];this.last.y=i[i.length-1]},_qSmoothCurveToR:function(n,t,i,r){for(t=0;t<i.length;t+=2){var u="Q"==this.lastControl.type;n.push("quadraticCurveTo",[this.lastControl.x=u?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=u?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+i[t],this.last.y+i[t+1]]);r&&(this._dashResidue=b(r,this,n[n.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=i[t];this.last.y+=i[t+1]}},_arcTo:function(n,t,i,u){var f,e,o,s;for(t="a"==t,f=0;f<i.length;f+=7)e=i[f+5],o=i[f+6],t&&(e+=this.last.x,o+=this.last.y),s=c.arcAsBezier(this.last,i[f],i[f+1],i[f+2],i[f+3]?1:0,i[f+4]?1:0,e,o),r.forEach(s,function(t){n.push("bezierCurveTo",t)}),u&&(this._dashResidue=b(u,this,p,this._dashResidue)),this.last.x=e,this.last.y=o;this.lastControl={}},_closePath:function(n,t,i,r){n.push("closePath",[]);r&&(this._dashResidue=w(r,this,this.last.x,this.last.y,r[1][0],r[1][1],this._dashResidue));this.lastControl={}}}),r.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(n){ut(y.Path,n)}),y.TextPath=u("dojox.gfx.canvas.TextPath",[y.Shape,h.TextPath],{_renderShape:function(){},_setText:function(){},_setFont:function(){}}),y.Surface=u("dojox.gfx.canvas.Surface",s.Surface,{constructor:function(){s.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){s.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(t,i){if(this.width=n.normalizedLength(t),this.height=n.normalizedLength(i),!this.rawNode)return this;var r=!1;return this.rawNode.width!=this.width&&(this.rawNode.width=this.width,r=!0),this.rawNode.height!=this.height&&(this.rawNode.height=this.height,r=!0),r&&this.makeDirty(),this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(n){this.rawNode&&(n||!this.pendingImageCount)&&(n=this.rawNode.getContext("2d"),n.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(n),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(n){n.save();for(var t=0;t<this.children.length;++t)this.children[t]._render(n);n.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(t.hitch(this,this._render),0))},downloadImage:function(n,i){var r=t.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);n.onload=r;n.onerror=r;n.onabort=r;n.src=i},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}}),y.createSurface=function(t,i,r){var u,f;return i||r||(u=e.position(t),i=i||u.w,r=r||u.h),"number"==typeof i&&(i+="px"),"number"==typeof r&&(r+="px"),u=new y.Surface,t=o.byId(t),f=t.ownerDocument.createElement("canvas"),f.width=n.normalizedLength(i),f.height=n.normalizedLength(r),t.appendChild(f),u.rawNode=f,u._parent=t,u.surface=u},tt=s.Container,u={openBatch:function(){return++this._batch,this},closeBatch:function(){return this._batch=0<this._batch?--this._batch:0,this._makeDirty(),this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(){return this._makeDirty(),tt.add.apply(this,arguments)},remove:function(){return this._makeDirty(),tt.remove.apply(this,arguments)},clear:function(){return this._makeDirty(),tt.clear.apply(this,arguments)},getBoundingBox:tt.getBoundingBox,_moveChildToFront:function(){return this._makeDirty(),tt._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(){return this._makeDirty(),tt._moveChildToBack.apply(this,arguments)}},h={createObject:function(n,t){var i=new n;return i.surface=this.surface,i.setShape(t),this.add(i),i}},a(y.Group,u),a(y.Group,s.Creator),a(y.Group,h),a(y.Surface,u),a(y.Surface,s.Creator),a(y.Surface,h),y.fixTarget=function(){return!0},y})},"dojox/gfx/svg":function(){require({cache:{"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(n,t,i,r,u,f,e,o,s,h){function l(n,t){if(!a)return n.splice(t,1);var i=n.length;if(i){for(;t<i;)n[t]=n[t+1],t++;n.length--}}var a=!!u("chrome"),c=n.shape={};return c.Shape=i("dojox.gfx.shape.Shape",null,{constructor:function(){if(this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null,u("gfxRegistry")){var n=c.register(this);this.getUID=function(){return n}}},destroy:function(){u("gfxRegistry")&&c.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var n=this.getBoundingBox(),t;return n?(t=this._getRealMatrix(),[h.multiplyPoint(t,n.x,n.y),h.multiplyPoint(t,n.x+n.width,n.y),h.multiplyPoint(t,n.x+n.width,n.y+n.height),h.multiplyPoint(t,n.x,n.y+n.height)]):null},getEventSource:function(){return this.rawNode},setClip:function(n){this.clip=n},getClip:function(){return this.clip},setShape:function(t){return this.shape=n.makeParameters(this.shape,t),this.bbox=null,this},setFill:function(t){if(!t)return this.fillStyle=null,this;var i=null;if("object"==typeof t&&"type"in t)switch(t.type){case"linear":i=n.makeParameters(n.defaultLinearGradient,t);break;case"radial":i=n.makeParameters(n.defaultRadialGradient,t);break;case"pattern":i=n.makeParameters(n.defaultPattern,t)}else i=n.normalizeColor(t);return this.fillStyle=i,this},setStroke:function(i){return i?(("string"==typeof i||t.isArray(i)||i instanceof s)&&(i={color:i}),i=this.strokeStyle=n.makeParameters(n.defaultStroke,i),i.color=n.normalizeColor(i.color),this):(this.strokeStyle=null,this)},setTransform:function(n){return this.matrix=h.clone(n?h.normalize(n):h.identity),this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var n=this.getParent();return n&&(n._moveChildToFront(this),this._moveToFront()),this},moveToBack:function(){var n=this.getParent();return n&&(n._moveChildToBack(this),this._moveToBack()),this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(n){return n?this.setTransform([this.matrix,n]):this},applyLeftTransform:function(n){return n?this.setTransform([n,this.matrix]):this},applyTransform:function(n){return n?this.setTransform([this.matrix,n]):this},removeShape:function(n){return this.parent&&this.parent.remove(this,n),this},_setParent:function(n,t){return this.parent=n,this._updateParentMatrix(t)},_updateParentMatrix:function(n){return this.parentMatrix=n?h.clone(n):null,this._applyTransform()},_getRealMatrix:function(){for(var t=this.matrix,n=this.parent;n;)n.matrix&&(t=h.multiply(n.matrix,t)),n=n.parent;return t}}),c._eventsProcessing={on:function(t,i){return f(this.getEventSource(),t,c.fixCallback(this,n.fixTarget,i))},connect:function(n,i,r){"on"==n.substring(0,2)&&(n=n.substring(2));return this.on(n,r?t.hitch(i,r):i)},disconnect:function(n){return n.remove()}},c.fixCallback=function(n,i,u,f){if(f||(f=u,u=null),t.isString(f)){if(u=u||r.global,!u[f])throw['dojox.gfx.shape.fixCallback: scope["',f,'"] is null (scope="',u,'")'].join("");return function(t){if(i(t,n))return u[f].apply(u,arguments||[])}}return u?function(t){if(i(t,n))return f.apply(u,arguments||[])}:function(t){if(i(t,n))return f.apply(u,arguments)}},t.extend(c.Shape,c._eventsProcessing),c.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(n){var t=n.getParent();return t&&t.remove(n,!0),this.children.push(n),n._setParent(this,this._getRealMatrix())},remove:function(n,t){for(var i=0;i<this.children.length;++i)if(this.children[i]==n){t||(n.parent=null,n.parentMatrix=null);l(this.children,i);break}return this},clear:function(n){for(var t,i=0;i<this.children.length;++i)t=this.children[i],t.parent=null,t.parentMatrix=null,n&&t.destroy();return this.children=[],this},getBoundingBox:function(){if(this.children){var n=null;return e.forEach(this.children,function(t){var i=t.getBoundingBox();i&&((t=t.getTransform())&&(i=h.multiplyRectangle(t,i)),n?(n.x=Math.min(n.x,i.x),n.y=Math.min(n.y,i.y),n.endX=Math.max(n.endX,i.x+i.width),n.endY=Math.max(n.endY,i.y+i.height)):n={x:i.x,y:i.y,endX:i.x+i.width,endY:i.y+i.height})}),n&&(n.width=n.endX-n.x,n.height=n.endY-n.y),n}return null},_moveChildToFront:function(n){for(var t=0;t<this.children.length;++t)if(this.children[t]==n){l(this.children,t);this.children.push(n);break}return this},_moveChildToBack:function(n){for(var t=0;t<this.children.length;++t)if(this.children[t]==n){l(this.children,t);this.children.unshift(n);break}return this}},c.Surface=i("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){if(e.forEach(this._nodes,o.destroy),this._nodes=[],e.forEach(this._events,function(n){n&&n.remove()}),this._events=[],this.rawNode=null,u("ie"))for(;this._parent.lastChild;)o.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(){},whenLoaded:function(n,i){var r=t.hitch(n,i);if(this.isLoaded)r(this);else f.once(this,"load",function(n){r(n)})}}),t.extend(c.Surface,c._eventsProcessing),c.Rect=i("dojox.gfx.shape.Rect",c.Shape,{constructor:function(t){this.shape=n.getDefault("Rect");this.rawNode=t},getBoundingBox:function(){return this.shape}}),c.Ellipse=i("dojox.gfx.shape.Ellipse",c.Shape,{constructor:function(t){this.shape=n.getDefault("Ellipse");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.rx,y:n.cy-n.ry,width:2*n.rx,height:2*n.ry}}return this.bbox}}),c.Circle=i("dojox.gfx.shape.Circle",c.Shape,{constructor:function(t){this.shape=n.getDefault("Circle");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.r,y:n.cy-n.r,width:2*n.r,height:2*n.r}}return this.bbox}}),c.Line=i("dojox.gfx.shape.Line",c.Shape,{constructor:function(t){this.shape=n.getDefault("Line");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:Math.min(n.x1,n.x2),y:Math.min(n.y1,n.y2),width:Math.abs(n.x2-n.x1),height:Math.abs(n.y2-n.y1)}}return this.bbox}}),c.Polyline=i("dojox.gfx.shape.Polyline",c.Shape,{constructor:function(t){this.shape=n.getDefault("Polyline");this.rawNode=t},setShape:function(n,t){return n&&n instanceof Array?(this.inherited(arguments,[{points:n}]),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[n]),this},_normalizePoints:function(){var n=this.shape.points,r=n&&n.length,i,t;if(r&&"number"==typeof n[0]){for(i=[],t=0;t<r;t+=2)i.push({x:n[t],y:n[t+1]});this.shape.points=i}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var r=this.shape.points,o=r.length,n=r[0],t=n.x,i=n.y,u=n.x,f=n.y,e=1;e<o;++e)n=r[e],t>n.x&&(t=n.x),u<n.x&&(u=n.x),i>n.y&&(i=n.y),f<n.y&&(f=n.y);this.bbox={x:t,y:i,width:u-t,height:f-i}}return this.bbox}}),c.Image=i("dojox.gfx.shape.Image",c.Shape,{constructor:function(t){this.shape=n.getDefault("Image");this.rawNode=t},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}}),c.Text=i(c.Shape,{constructor:function(t){this.fontStyle=null;this.shape=n.getDefault("Text");this.rawNode=t},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?n.splitFontString(t):n.makeParameters(n.defaultFont,t),this._setFont(),this},getBoundingBox:function(){var t=null;return this.getShape().text&&(t=n._base._computeTextBoundingBox(this)),t}}),c.Creator={createShape:function(t){switch(t.type){case n.defaultPath.type:return this.createPath(t);case n.defaultRect.type:return this.createRect(t);case n.defaultCircle.type:return this.createCircle(t);case n.defaultEllipse.type:return this.createEllipse(t);case n.defaultLine.type:return this.createLine(t);case n.defaultPolyline.type:return this.createPolyline(t);case n.defaultImage.type:return this.createImage(t);case n.defaultText.type:return this.createText(t);case n.defaultTextPath.type:return this.createTextPath(t)}return null},createGroup:function(){return this.createObject(n.Group)},createRect:function(t){return this.createObject(n.Rect,t)},createEllipse:function(t){return this.createObject(n.Ellipse,t)},createCircle:function(t){return this.createObject(n.Circle,t)},createLine:function(t){return this.createObject(n.Line,t)},createPolyline:function(t){return this.createObject(n.Polyline,t)},createImage:function(t){return this.createObject(n.Image,t)},createText:function(t){return this.createObject(n.Text,t)},createPath:function(t){return this.createObject(n.Path,t)},createTextPath:function(t){return this.createObject(n.TextPath,{}).setText(t)},createObject:function(){return null}},c})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(n,t,i,r,u){return u=i("dojox.gfx.path.Path",u.Shape,{constructor:function(i){this.shape=t.clone(n.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=i;this.segmented=!1},setAbsoluteMode:function(n){return this._confirmSegmented(),this.absolute="string"==typeof n?"absolute"==n:n,this},getAbsoluteMode:function(){return this._confirmSegmented(),this.absolute},getBoundingBox:function(){return this._confirmSegmented(),this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){var i,n,t,r;if(this._confirmSegmented(),this.tbbox)return this.tbbox;for(i=this.bbox,n=this._getRealMatrix(),this.bbox=null,t=0,r=this.segments.length;t<r;++t)this._updateWithSegment(this.segments[t],n);return n=this.bbox,this.bbox=i,this.tbbox=n?[{x:n.l,y:n.t},{x:n.r,y:n.t},{x:n.r,y:n.b},{x:n.l,y:n.b}]:null},getLastPosition:function(){return this._confirmSegmented(),"x"in this.last?this.last:null},_applyTransform:function(){return this.tbbox=null,this.inherited(arguments)},_updateBBox:function(n,t,i){i&&(t=r.multiplyPoint(i,n,t),n=t.x,t=t.y);this.bbox&&"l"in this.bbox?(this.bbox.l>n&&(this.bbox.l=n),this.bbox.r<n&&(this.bbox.r=n),this.bbox.t>t&&(this.bbox.t=t),this.bbox.b<t&&(this.bbox.b=t)):this.bbox={l:n,b:t,r:n,t:t}},_updateWithSegment:function(t,i){var u=t.args,f=u.length,r,e;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<f;r+=2)this._updateBBox(u[r],u[r+1],i);this.last.x=u[f-2];this.last.y=u[f-1];this.absolute=!0;break;case"H":for(r=0;r<f;++r)this._updateBBox(u[r],this.last.y,i);this.last.x=u[f-1];this.absolute=!0;break;case"V":for(r=0;r<f;++r)this._updateBBox(this.last.x,u[r],i);this.last.y=u[f-1];this.absolute=!0;break;case"m":for(r=0,("x"in this.last)||(this._updateBBox(this.last.x=u[0],this.last.y=u[1],i),r=2);r<f;r+=2)this._updateBBox(this.last.x+=u[r],this.last.y+=u[r+1],i);this.absolute=!1;break;case"l":case"t":for(r=0;r<f;r+=2)this._updateBBox(this.last.x+=u[r],this.last.y+=u[r+1],i);this.absolute=!1;break;case"h":for(r=0;r<f;++r)this._updateBBox(this.last.x+=u[r],this.last.y,i);this.absolute=!1;break;case"v":for(r=0;r<f;++r)this._updateBBox(this.last.x,this.last.y+=u[r],i);this.absolute=!1;break;case"c":for(r=0;r<f;r+=6)this._updateBBox(this.last.x+u[r],this.last.y+u[r+1],i),this._updateBBox(this.last.x+u[r+2],this.last.y+u[r+3],i),this._updateBBox(this.last.x+=u[r+4],this.last.y+=u[r+5],i);this.absolute=!1;break;case"s":case"q":for(r=0;r<f;r+=4)this._updateBBox(this.last.x+u[r],this.last.y+u[r+1],i),this._updateBBox(this.last.x+=u[r+2],this.last.y+=u[r+3],i);this.absolute=!1;break;case"A":for(r=0;r<f;r+=7)this._updateBBox(u[r+5],u[r+6],i);this.last.x=u[f-2];this.last.y=u[f-1];this.absolute=!0;break;case"a":for(r=0;r<f;r+=7)this._updateBBox(this.last.x+=u[r+5],this.last.y+=u[r+6],i);this.absolute=!1}for(e=[t.action],r=0;r<f;++r)e.push(n.formatNumber(u[r],!0));if("string"==typeof this.shape.path)this.shape.path+=e.join("");else for(r=0,f=e.length;r<f;++r)this.shape.path.push(e[r])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(n,t){this.tbbox=null;var i=this._validSegments[n.toLowerCase()];"number"==typeof i&&(i?t.length>=i&&(i={action:n,args:t.slice(0,t.length-t.length%i)},this.segments.push(i),this._updateWithSegment(i)):(i={action:n,args:[]},this.segments.push(i),this._updateWithSegment(i)))},_collectArgs:function(n,t){for(var i,r=0;r<t.length;++r)i=t[r],"boolean"==typeof i?n.push(i?1:0):"number"==typeof i?n.push(i):i instanceof Array?this._collectArgs(n,i):"x"in i&&"y"in i&&n.push(i.x,i.y)},moveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"M":"m",n),this},lineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"L":"l",n),this},hLineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"H":"h",n),this},vLineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"V":"v",n),this},curveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"C":"c",n),this},smoothCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"S":"s",n),this},qCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"Q":"q",n),this},qSmoothCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"T":"t",n),this},arcTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"A":"a",n),this},closePath:function(){return this._confirmSegmented(),this._pushSegment("Z",[]),this},_confirmSegmented:function(){if(!this.segmented){var n=this.shape.path;this.shape.path=[];this._setPath(n);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(i){var e,o;if(i=t.isArray(i)?i:i.match(n.pathSvgRegExp),this.segments=[],this.absolute=!0,this.bbox={},this.last={},i){for(var r="",u=[],s=i.length,f=0;f<s;++f)e=i[f],o=parseFloat(e),isNaN(o)?(r&&this._pushSegment(r,u),u=[],r=e):u.push(o);this._pushSegment(r,u)}},setShape:function(t){return this.inherited(arguments,["string"==typeof t?{path:t}:t]),this.segmented=!1,this.segments=[],n.lazyPathSegmentation||this._confirmSegmented(),this},_2PI:2*Math.PI}),i=i("dojox.gfx.path.TextPath",u,{constructor:function(){"text"in this||(this.text=t.clone(n.defaultTextPath));"fontStyle"in this||(this.fontStyle=t.clone(n.defaultFont))},getText:function(){return this.text},setText:function(t){return this.text=n.makeParameters(this.text,"string"==typeof t?{text:t}:t),this._setText(),this},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?n.splitFontString(t):n.makeParameters(n.defaultFont,t),this._setFont(),this}}),n.path={Path:u,TextPath:i}})},"*noref":1}});define("dojox/gfx/svg","dojo/_base/lang dojo/_base/sniff dojo/_base/window dojo/dom dojo/_base/declare dojo/_base/array dojo/dom-geometry dojo/dom-attr dojo/_base/Color ./_base ./shape ./path".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){function v(n,t){return i.doc.createElementNS?i.doc.createElementNS(n,t):i.doc.createElement(t)}function p(n,t,i,r){return n.setAttributeNS?n.setAttributeNS(t,i,r):n.setAttribute(i,r)}function w(n){return a.useSvgWeb?i.doc.createTextNode(n,!0):i.doc.createTextNode(n)}var a=h.svg={},k,d,y;a.useSvgWeb="undefined"!=typeof svgweb;var g=navigator.userAgent,nt=t("ios"),b=t("android"),tt=t("chrome")||b&&4<=b?"auto":"optimizeLegibility";return a.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"},a.getRef=function(n){return n&&"none"!=n?n.match(/^url\(#.+\)$/)?r.byId(n.slice(5,-1)):n.match(/^#dojoUnique\d+$/)?r.byId(n.slice(1)):null:null},a.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},k=0,a.Shape=u("dojox.gfx.svg.Shape",c.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var n=this.rawNode.getAttribute("fill");(n=a.getRef(n))&&n.parentNode.removeChild(n)}this.clip&&(n=this.rawNode.getAttribute("clip-path"))&&(n=r.byId(n.match(/gfx_clip[\d]+/)[0]))&&n.parentNode.removeChild(n);c.Shape.prototype.destroy.apply(this,arguments)},setFill:function(n){if(!n)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var t,i=function(n){this.setAttribute(n,t[n].toFixed(8))};if("object"==typeof n&&"type"in n){switch(n.type){case"linear":t=h.makeParameters(h.defaultLinearGradient,n);n=this._setFillObject(t,"linearGradient");f.forEach(["x1","y1","x2","y2"],i,n);break;case"radial":t=h.makeParameters(h.defaultRadialGradient,n);n=this._setFillObject(t,"radialGradient");f.forEach(["cx","cy","r"],i,n);break;case"pattern":t=h.makeParameters(h.defaultPattern,n);n=this._setFillObject(t,"pattern");f.forEach(["x","y","width","height"],i,n)}return this.fillStyle=t,this}return this.fillStyle=t=h.normalizeColor(n),this.rawNode.setAttribute("fill",t.toCss()),this.rawNode.setAttribute("fill-opacity",t.a),this.rawNode.setAttribute("fill-rule","evenodd"),this},setStroke:function(t){var u=this.rawNode,f,i,r;if(!t)return this.strokeStyle=null,u.setAttribute("stroke","none"),u.setAttribute("stroke-opacity",0),this;if(("string"==typeof t||n.isArray(t)||t instanceof s)&&(t={color:t}),t=this.strokeStyle=h.makeParameters(h.defaultStroke,t),t.color=h.normalizeColor(t.color),t){if(f=0>t.width?0:t.width,u.setAttribute("stroke",t.color.toCss()),u.setAttribute("stroke-opacity",t.color.a),u.setAttribute("stroke-width",f),u.setAttribute("stroke-linecap",t.cap),"number"==typeof t.join?(u.setAttribute("stroke-linejoin","miter"),u.setAttribute("stroke-miterlimit",t.join)):u.setAttribute("stroke-linejoin",t.join),i=t.style.toLowerCase(),i in a.dasharray&&(i=a.dasharray[i]),i instanceof Array){for(i=n._toArray(i),r=0;r<i.length;++r)i[r]*=f;if("butt"!=t.cap){for(r=0;r<i.length;r+=2)i[r]-=f,1>i[r]&&(i[r]=1);for(r=1;r<i.length;r+=2)i[r]+=f}i=i.join(",")}u.setAttribute("stroke-dasharray",i);u.setAttribute("dojoGfxStrokeStyle",t.style)}return this},_getParentSurface:function(){for(var n=this.parent;n&&!(n instanceof h.Surface);n=n.parent);return n},_setFillObject:function(n,t){var r=a.xmlns.svg,u,i,f;if(this.fillStyle=n,u=this._getParentSurface().defNode,i=this.rawNode.getAttribute("fill"),i=a.getRef(i))if(i.tagName.toLowerCase()!=t.toLowerCase())f=i.id,i.parentNode.removeChild(i),i=v(r,t),i.setAttribute("id",f),u.appendChild(i);else for(;i.childNodes.length;)i.removeChild(i.lastChild);else i=v(r,t),i.setAttribute("id",h._base._getUniqueId()),u.appendChild(i);if("pattern"==t)i.setAttribute("patternUnits","userSpaceOnUse"),r=v(r,"image"),r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",(0>n.width?0:n.width).toFixed(8)),r.setAttribute("height",(0>n.height?0:n.height).toFixed(8)),p(r,a.xmlns.xlink,"xlink:href",n.src),i.appendChild(r);else for(i.setAttribute("gradientUnits","userSpaceOnUse"),u=0;u<n.colors.length;++u){var f=n.colors[u],e=v(r,"stop"),o=f.color=h.normalizeColor(f.color);e.setAttribute("offset",f.offset.toFixed(8));e.setAttribute("stop-color",o.toCss());e.setAttribute("stop-opacity",o.a);i.appendChild(e)}return this.rawNode.setAttribute("fill","url(#"+i.getAttribute("id")+")"),this.rawNode.removeAttribute("fill-opacity"),this.rawNode.setAttribute("fill-rule","evenodd"),i},_applyTransform:function(){if(this.matrix){var n=this.matrix;this.rawNode.setAttribute("transform","matrix("+n.xx.toFixed(8)+","+n.yx.toFixed(8)+","+n.xy.toFixed(8)+","+n.yy.toFixed(8)+","+n.dx.toFixed(8)+","+n.dy.toFixed(8)+")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(n){n=this.rawNode=n;"image"!=this.shape.type&&n.setAttribute("fill","none");n.setAttribute("fill-opacity",0);n.setAttribute("stroke","none");n.setAttribute("stroke-opacity",0);n.setAttribute("stroke-width",1);n.setAttribute("stroke-linecap","butt");n.setAttribute("stroke-linejoin","miter");n.setAttribute("stroke-miterlimit",4);n.__gfxObject__=this},setShape:function(n){this.shape=h.makeParameters(this.shape,n);for(var t in this.shape)"type"!=t&&(n=this.shape[t],("width"===t||"height"===t)&&(n=0>n?0:n),this.rawNode.setAttribute(t,n));return this.bbox=null,this},_moveToFront:function(){return this.rawNode.parentNode.appendChild(this.rawNode),this},_moveToBack:function(){return this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild),this},setClip:function(t){var u,i,f;return(this.inherited(arguments),u=t?"width"in t?"rect":"cx"in t?"ellipse":"points"in t?"polyline":"d"in t?"path":null:null,t&&!u)?this:("polyline"===u&&(t=n.clone(t),t.points=t.points.join(",")),f=o.get(this.rawNode,"clip-path"),f&&(i=r.byId(f.match(/gfx_clip[\d]+/)[0]))&&i.removeChild(i.childNodes[0]),t?(i?(u=v(a.xmlns.svg,u),i.appendChild(u)):(f="gfx_clip"+ ++k,this.rawNode.setAttribute("clip-path","url(#"+f+")"),i=v(a.xmlns.svg,"clipPath"),u=v(a.xmlns.svg,u),i.appendChild(u),this.rawNode.parentNode.insertBefore(i,this.rawNode),o.set(i,"id",f)),o.set(u,t)):(this.rawNode.removeAttribute("clip-path"),i&&i.parentNode.removeChild(i)),this)},_removeClipNode:function(){var n,t=o.get(this.rawNode,"clip-path");return t&&(n=r.byId(t.match(/gfx_clip[\d]+/)[0]))&&n.parentNode.removeChild(n),n}}),a.Group=u("dojox.gfx.svg.Group",a.Shape,{constructor:function(){c.Container._init.call(this)},setRawNode:function(n){this.rawNode=n;this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0);a.Shape.prototype.destroy.apply(this,arguments)}}),a.Group.nodeType="g",a.Rect=u("dojox.gfx.svg.Rect",[a.Shape,c.Rect],{setShape:function(n){this.shape=h.makeParameters(this.shape,n);this.bbox=null;for(var t in this.shape)"type"!=t&&"r"!=t&&(n=this.shape[t],("width"===t||"height"===t)&&(n=0>n?0:n),this.rawNode.setAttribute(t,n));return null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),this.rawNode.setAttribute("rx",this.shape.r)),this}}),a.Rect.nodeType="rect",a.Ellipse=u("dojox.gfx.svg.Ellipse",[a.Shape,c.Ellipse],{}),a.Ellipse.nodeType="ellipse",a.Circle=u("dojox.gfx.svg.Circle",[a.Shape,c.Circle],{}),a.Circle.nodeType="circle",a.Line=u("dojox.gfx.svg.Line",[a.Shape,c.Line],{}),a.Line.nodeType="line",a.Polyline=u("dojox.gfx.svg.Polyline",[a.Shape,c.Polyline],{setShape:function(n,t){n&&n instanceof Array?(this.shape=h.makeParameters(this.shape,{points:n}),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=h.makeParameters(this.shape,n);this.bbox=null;this._normalizePoints();for(var u=[],r=this.shape.points,i=0;i<r.length;++i)u.push(r[i].x.toFixed(8),r[i].y.toFixed(8));return this.rawNode.setAttribute("points",u.join(" ")),this}}),a.Polyline.nodeType="polyline",a.Image=u("dojox.gfx.svg.Image",[a.Shape,c.Image],{setShape:function(n){var t,i;this.shape=h.makeParameters(this.shape,n);this.bbox=null;n=this.rawNode;for(t in this.shape)"type"!=t&&"src"!=t&&(i=this.shape[t],("width"===t||"height"===t)&&(i=0>i?0:i),n.setAttribute(t,i));return n.setAttribute("preserveAspectRatio","none"),p(n,a.xmlns.xlink,"xlink:href",this.shape.src),n.__gfxObject__=this,this}}),a.Image.nodeType="image",a.Text=u("dojox.gfx.svg.Text",[a.Shape,c.Text],{setShape:function(n){this.shape=h.makeParameters(this.shape,n);this.bbox=null;n=this.rawNode;var t=this.shape;return n.setAttribute("x",t.x),n.setAttribute("y",t.y),n.setAttribute("text-anchor",t.align),n.setAttribute("text-decoration",t.decoration),n.setAttribute("rotate",t.rotated?90:0),n.setAttribute("kerning",t.kerning?"auto":0),n.setAttribute("text-rendering",tt),n.firstChild?n.firstChild.nodeValue=t.text:n.appendChild(w(t.text)),this},getTextWidth:function(){var n=this.rawNode,i=n.parentNode,n=n.cloneNode(!0),t,r;if(n.style.visibility="hidden",t=0,r=n.firstChild.nodeValue,i.appendChild(n),""!=r)for(;!t;)t=n.getBBox?parseInt(n.getBBox().width):68;return i.removeChild(n),t},getBoundingBox:function(){var n=null;if(this.getShape().text)try{n=this.rawNode.getBBox()}catch(t){n={x:0,y:0,width:0,height:0}}return n}}),a.Text.nodeType="text",a.Path=u("dojox.gfx.svg.Path",[a.Shape,l.Path],{_updateWithSegment:function(){this.inherited(arguments);"string"==typeof this.shape.path&&this.rawNode.setAttribute("d",this.shape.path)},setShape:function(){return this.inherited(arguments),this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d"),this}}),a.Path.nodeType="path",a.TextPath=u("dojox.gfx.svg.TextPath",[a.Shape,l.TextPath],{_updateWithSegment:function(){this.inherited(arguments);this._setTextPath()},setShape:function(){return this.inherited(arguments),this._setTextPath(),this},_setTextPath:function(){var t,n,i;if("string"==typeof this.shape.path){if(t=this.rawNode,t.firstChild||(n=v(a.xmlns.svg,"textPath"),i=w(""),n.appendChild(i),t.appendChild(n)),n=(n=t.firstChild.getAttributeNS(a.xmlns.xlink,"href"))&&a.getRef(n),!n&&(i=this._getParentSurface())){var i=i.defNode,n=v(a.xmlns.svg,"path"),r=h._base._getUniqueId();n.setAttribute("id",r);i.appendChild(n);p(t.firstChild,a.xmlns.xlink,"xlink:href","#"+r)}n&&n.setAttribute("d",this.shape.path)}},_setText:function(){var n=this.rawNode,t,i;n.firstChild||(t=v(a.xmlns.svg,"textPath"),i=w(""),t.appendChild(i),n.appendChild(t));n=n.firstChild;t=this.text;n.setAttribute("alignment-baseline","middle");switch(t.align){case"middle":n.setAttribute("text-anchor","middle");n.setAttribute("startOffset","50%");break;case"end":n.setAttribute("text-anchor","end");n.setAttribute("startOffset","100%");break;default:n.setAttribute("text-anchor","start");n.setAttribute("startOffset","0%")}n.setAttribute("baseline-shift","0.5ex");n.setAttribute("text-decoration",t.decoration);n.setAttribute("rotate",t.rotated?90:0);n.setAttribute("kerning",t.kerning?"auto":0);n.firstChild.data=t.text}}),a.TextPath.nodeType="text",d=534<function(){var n=/WebKit\/(\d*)/.exec(g);return n?n[1]:0}(),a.Surface=u("dojox.gfx.svg.Surface",c.Surface,{constructor:function(){c.Container._init.call(this)},destroy:function(){c.Container.clear.call(this,!0);this.defNode=null;this.inherited(arguments)},setDimensions:function(n,t){if(!this.rawNode)return this;var i=0>n?0:n,r=0>t?0:t;return this.rawNode.setAttribute("width",i),this.rawNode.setAttribute("height",r),d&&(this.rawNode.style.width=i,this.rawNode.style.height=r),this},getDimensions:function(){return this.rawNode?{width:h.normalizedLength(this.rawNode.getAttribute("width")),height:h.normalizedLength(this.rawNode.getAttribute("height"))}:null}}),a.createSurface=function(n,t,i){var u=new a.Surface;return u.rawNode=v(a.xmlns.svg,"svg"),u.rawNode.setAttribute("overflow","hidden"),t&&u.rawNode.setAttribute("width",0>t?0:t),i&&u.rawNode.setAttribute("height",0>i?0:i),t=v(a.xmlns.svg,"defs"),u.rawNode.appendChild(t),u.defNode=t,u._parent=r.byId(n),u._parent.appendChild(u.rawNode),h._base._fixMsTouchAction(u),u},t={_setFont:function(){var n=this.fontStyle;this.rawNode.setAttribute("font-style",n.style);this.rawNode.setAttribute("font-variant",n.variant);this.rawNode.setAttribute("font-weight",n.weight);this.rawNode.setAttribute("font-size",n.size);this.rawNode.setAttribute("font-family",n.family)}},y=c.Container,u=a.Container={openBatch:function(){if(!this._batch){var n;n=a.useSvgWeb?i.doc.createDocumentFragment(!0):i.doc.createDocumentFragment();this.fragment=n}return++this._batch,this},closeBatch:function(){return this._batch=0<this._batch?--this._batch:0,this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment),this},add:function(n){return this!=n.getParent()&&(this.fragment?this.fragment.appendChild(n.rawNode):this.rawNode.appendChild(n.rawNode),y.add.apply(this,arguments),n.setClip(n.clip)),this},remove:function(n){return this==n.getParent()&&(this.rawNode==n.rawNode.parentNode&&this.rawNode.removeChild(n.rawNode),this.fragment&&this.fragment==n.rawNode.parentNode&&this.fragment.removeChild(n.rawNode),n._removeClipNode(),y.remove.apply(this,arguments)),this},clear:function(){for(var n,t=this.rawNode;t.lastChild;)t.removeChild(t.lastChild);if(n=this.defNode,n){for(;n.lastChild;)n.removeChild(n.lastChild);t.appendChild(n)}return y.clear.apply(this,arguments)},getBoundingBox:y.getBoundingBox,_moveChildToFront:y._moveChildToFront,_moveChildToBack:y._moveChildToBack},l=a.Creator={createObject:function(n,t){if(!this.rawNode)return null;var i=new n,r=v(a.xmlns.svg,n.nodeType);return i.setRawNode(r),i.setShape(t),this.add(i),i}},n.extend(a.Text,t),n.extend(a.TextPath,t),n.extend(a.Group,u),n.extend(a.Group,c.Creator),n.extend(a.Group,l),n.extend(a.Surface,u),n.extend(a.Surface,c.Creator),n.extend(a.Surface,l),a.fixTarget=function(n){return n.gfxTarget||(n.gfxTarget=nt&&n.target.wholeText?n.target.parentElement.__gfxObject__:n.target.__gfxObject__),!0},a.useSvgWeb&&(a.createSurface=function(n,t,i){var u=new a.Surface,o,f;return t=0>t?0:t,i=0>i?0:i,t&&i||(o=e.position(n),t=t||o.w,i=i||o.h),n=r.byId(n),o=n.id?n.id+"_svgweb":h._base._getUniqueId(),f=v(a.xmlns.svg,"svg"),f.id=o,f.setAttribute("width",t),f.setAttribute("height",i),svgweb.appendChild(f,n),f.addEventListener("SVGLoad",function(){u.rawNode=this;u.isLoaded=!0;var n=v(a.xmlns.svg,"defs");if(u.rawNode.appendChild(n),u.defNode=n,u.onLoad)u.onLoad(u)},!1),u.isLoaded=!1,u},a.Surface.extend({destroy:function(){var n=this.rawNode;svgweb.removeChild(n,n.parentNode)}}),t={connect:function(t,i,r){return"on"===t.substring(0,2)&&(t=t.substring(2)),r=2==arguments.length?i:n.hitch(i,r),this.getEventSource().addEventListener(t,r,!1),[this,t,r]},disconnect:function(n){this.getEventSource().removeEventListener(n[1],n[2],!1);delete n[0]}},n.extend(a.Shape,t),n.extend(a.Surface,t)),a})},"dojox/gfx/vml":function(){require({cache:{"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(n,t,i,r,u,f,e,o,s,h){function l(n,t){if(!a)return n.splice(t,1);var i=n.length;if(i){for(;t<i;)n[t]=n[t+1],t++;n.length--}}var a=!!u("chrome"),c=n.shape={};return c.Shape=i("dojox.gfx.shape.Shape",null,{constructor:function(){if(this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null,u("gfxRegistry")){var n=c.register(this);this.getUID=function(){return n}}},destroy:function(){u("gfxRegistry")&&c.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var n=this.getBoundingBox(),t;return n?(t=this._getRealMatrix(),[h.multiplyPoint(t,n.x,n.y),h.multiplyPoint(t,n.x+n.width,n.y),h.multiplyPoint(t,n.x+n.width,n.y+n.height),h.multiplyPoint(t,n.x,n.y+n.height)]):null},getEventSource:function(){return this.rawNode},setClip:function(n){this.clip=n},getClip:function(){return this.clip},setShape:function(t){return this.shape=n.makeParameters(this.shape,t),this.bbox=null,this},setFill:function(t){if(!t)return this.fillStyle=null,this;var i=null;if("object"==typeof t&&"type"in t)switch(t.type){case"linear":i=n.makeParameters(n.defaultLinearGradient,t);break;case"radial":i=n.makeParameters(n.defaultRadialGradient,t);break;case"pattern":i=n.makeParameters(n.defaultPattern,t)}else i=n.normalizeColor(t);return this.fillStyle=i,this},setStroke:function(i){return i?(("string"==typeof i||t.isArray(i)||i instanceof s)&&(i={color:i}),i=this.strokeStyle=n.makeParameters(n.defaultStroke,i),i.color=n.normalizeColor(i.color),this):(this.strokeStyle=null,this)},setTransform:function(n){return this.matrix=h.clone(n?h.normalize(n):h.identity),this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var n=this.getParent();return n&&(n._moveChildToFront(this),this._moveToFront()),this},moveToBack:function(){var n=this.getParent();return n&&(n._moveChildToBack(this),this._moveToBack()),this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(n){return n?this.setTransform([this.matrix,n]):this},applyLeftTransform:function(n){return n?this.setTransform([n,this.matrix]):this},applyTransform:function(n){return n?this.setTransform([this.matrix,n]):this},removeShape:function(n){return this.parent&&this.parent.remove(this,n),this},_setParent:function(n,t){return this.parent=n,this._updateParentMatrix(t)},_updateParentMatrix:function(n){return this.parentMatrix=n?h.clone(n):null,this._applyTransform()},_getRealMatrix:function(){for(var t=this.matrix,n=this.parent;n;)n.matrix&&(t=h.multiply(n.matrix,t)),n=n.parent;return t}}),c._eventsProcessing={on:function(t,i){return f(this.getEventSource(),t,c.fixCallback(this,n.fixTarget,i))},connect:function(n,i,r){"on"==n.substring(0,2)&&(n=n.substring(2));return this.on(n,r?t.hitch(i,r):i)},disconnect:function(n){return n.remove()}},c.fixCallback=function(n,i,u,f){if(f||(f=u,u=null),t.isString(f)){if(u=u||r.global,!u[f])throw['dojox.gfx.shape.fixCallback: scope["',f,'"] is null (scope="',u,'")'].join("");return function(t){if(i(t,n))return u[f].apply(u,arguments||[])}}return u?function(t){if(i(t,n))return f.apply(u,arguments||[])}:function(t){if(i(t,n))return f.apply(u,arguments)}},t.extend(c.Shape,c._eventsProcessing),c.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(n){var t=n.getParent();return t&&t.remove(n,!0),this.children.push(n),n._setParent(this,this._getRealMatrix())},remove:function(n,t){for(var i=0;i<this.children.length;++i)if(this.children[i]==n){t||(n.parent=null,n.parentMatrix=null);l(this.children,i);break}return this},clear:function(n){for(var t,i=0;i<this.children.length;++i)t=this.children[i],t.parent=null,t.parentMatrix=null,n&&t.destroy();return this.children=[],this},getBoundingBox:function(){if(this.children){var n=null;return e.forEach(this.children,function(t){var i=t.getBoundingBox();i&&((t=t.getTransform())&&(i=h.multiplyRectangle(t,i)),n?(n.x=Math.min(n.x,i.x),n.y=Math.min(n.y,i.y),n.endX=Math.max(n.endX,i.x+i.width),n.endY=Math.max(n.endY,i.y+i.height)):n={x:i.x,y:i.y,endX:i.x+i.width,endY:i.y+i.height})}),n&&(n.width=n.endX-n.x,n.height=n.endY-n.y),n}return null},_moveChildToFront:function(n){for(var t=0;t<this.children.length;++t)if(this.children[t]==n){l(this.children,t);this.children.push(n);break}return this},_moveChildToBack:function(n){for(var t=0;t<this.children.length;++t)if(this.children[t]==n){l(this.children,t);this.children.unshift(n);break}return this}},c.Surface=i("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){if(e.forEach(this._nodes,o.destroy),this._nodes=[],e.forEach(this._events,function(n){n&&n.remove()}),this._events=[],this.rawNode=null,u("ie"))for(;this._parent.lastChild;)o.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(){},whenLoaded:function(n,i){var r=t.hitch(n,i);if(this.isLoaded)r(this);else f.once(this,"load",function(n){r(n)})}}),t.extend(c.Surface,c._eventsProcessing),c.Rect=i("dojox.gfx.shape.Rect",c.Shape,{constructor:function(t){this.shape=n.getDefault("Rect");this.rawNode=t},getBoundingBox:function(){return this.shape}}),c.Ellipse=i("dojox.gfx.shape.Ellipse",c.Shape,{constructor:function(t){this.shape=n.getDefault("Ellipse");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.rx,y:n.cy-n.ry,width:2*n.rx,height:2*n.ry}}return this.bbox}}),c.Circle=i("dojox.gfx.shape.Circle",c.Shape,{constructor:function(t){this.shape=n.getDefault("Circle");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:n.cx-n.r,y:n.cy-n.r,width:2*n.r,height:2*n.r}}return this.bbox}}),c.Line=i("dojox.gfx.shape.Line",c.Shape,{constructor:function(t){this.shape=n.getDefault("Line");this.rawNode=t},getBoundingBox:function(){if(!this.bbox){var n=this.shape;this.bbox={x:Math.min(n.x1,n.x2),y:Math.min(n.y1,n.y2),width:Math.abs(n.x2-n.x1),height:Math.abs(n.y2-n.y1)}}return this.bbox}}),c.Polyline=i("dojox.gfx.shape.Polyline",c.Shape,{constructor:function(t){this.shape=n.getDefault("Polyline");this.rawNode=t},setShape:function(n,t){return n&&n instanceof Array?(this.inherited(arguments,[{points:n}]),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[n]),this},_normalizePoints:function(){var n=this.shape.points,r=n&&n.length,i,t;if(r&&"number"==typeof n[0]){for(i=[],t=0;t<r;t+=2)i.push({x:n[t],y:n[t+1]});this.shape.points=i}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var r=this.shape.points,o=r.length,n=r[0],t=n.x,i=n.y,u=n.x,f=n.y,e=1;e<o;++e)n=r[e],t>n.x&&(t=n.x),u<n.x&&(u=n.x),i>n.y&&(i=n.y),f<n.y&&(f=n.y);this.bbox={x:t,y:i,width:u-t,height:f-i}}return this.bbox}}),c.Image=i("dojox.gfx.shape.Image",c.Shape,{constructor:function(t){this.shape=n.getDefault("Image");this.rawNode=t},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}}),c.Text=i(c.Shape,{constructor:function(t){this.fontStyle=null;this.shape=n.getDefault("Text");this.rawNode=t},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?n.splitFontString(t):n.makeParameters(n.defaultFont,t),this._setFont(),this},getBoundingBox:function(){var t=null;return this.getShape().text&&(t=n._base._computeTextBoundingBox(this)),t}}),c.Creator={createShape:function(t){switch(t.type){case n.defaultPath.type:return this.createPath(t);case n.defaultRect.type:return this.createRect(t);case n.defaultCircle.type:return this.createCircle(t);case n.defaultEllipse.type:return this.createEllipse(t);case n.defaultLine.type:return this.createLine(t);case n.defaultPolyline.type:return this.createPolyline(t);case n.defaultImage.type:return this.createImage(t);case n.defaultText.type:return this.createText(t);case n.defaultTextPath.type:return this.createTextPath(t)}return null},createGroup:function(){return this.createObject(n.Group)},createRect:function(t){return this.createObject(n.Rect,t)},createEllipse:function(t){return this.createObject(n.Ellipse,t)},createCircle:function(t){return this.createObject(n.Circle,t)},createLine:function(t){return this.createObject(n.Line,t)},createPolyline:function(t){return this.createObject(n.Polyline,t)},createImage:function(t){return this.createObject(n.Image,t)},createText:function(t){return this.createObject(n.Text,t)},createPath:function(t){return this.createObject(n.Path,t)},createTextPath:function(t){return this.createObject(n.TextPath,{}).setText(t)},createObject:function(){return null}},c})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(n,t,i,r,u){return u=i("dojox.gfx.path.Path",u.Shape,{constructor:function(i){this.shape=t.clone(n.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=i;this.segmented=!1},setAbsoluteMode:function(n){return this._confirmSegmented(),this.absolute="string"==typeof n?"absolute"==n:n,this},getAbsoluteMode:function(){return this._confirmSegmented(),this.absolute},getBoundingBox:function(){return this._confirmSegmented(),this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){var i,n,t,r;if(this._confirmSegmented(),this.tbbox)return this.tbbox;for(i=this.bbox,n=this._getRealMatrix(),this.bbox=null,t=0,r=this.segments.length;t<r;++t)this._updateWithSegment(this.segments[t],n);return n=this.bbox,this.bbox=i,this.tbbox=n?[{x:n.l,y:n.t},{x:n.r,y:n.t},{x:n.r,y:n.b},{x:n.l,y:n.b}]:null},getLastPosition:function(){return this._confirmSegmented(),"x"in this.last?this.last:null},_applyTransform:function(){return this.tbbox=null,this.inherited(arguments)},_updateBBox:function(n,t,i){i&&(t=r.multiplyPoint(i,n,t),n=t.x,t=t.y);this.bbox&&"l"in this.bbox?(this.bbox.l>n&&(this.bbox.l=n),this.bbox.r<n&&(this.bbox.r=n),this.bbox.t>t&&(this.bbox.t=t),this.bbox.b<t&&(this.bbox.b=t)):this.bbox={l:n,b:t,r:n,t:t}},_updateWithSegment:function(t,i){var u=t.args,f=u.length,r,e;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<f;r+=2)this._updateBBox(u[r],u[r+1],i);this.last.x=u[f-2];this.last.y=u[f-1];this.absolute=!0;break;case"H":for(r=0;r<f;++r)this._updateBBox(u[r],this.last.y,i);this.last.x=u[f-1];this.absolute=!0;break;case"V":for(r=0;r<f;++r)this._updateBBox(this.last.x,u[r],i);this.last.y=u[f-1];this.absolute=!0;break;case"m":for(r=0,("x"in this.last)||(this._updateBBox(this.last.x=u[0],this.last.y=u[1],i),r=2);r<f;r+=2)this._updateBBox(this.last.x+=u[r],this.last.y+=u[r+1],i);this.absolute=!1;break;case"l":case"t":for(r=0;r<f;r+=2)this._updateBBox(this.last.x+=u[r],this.last.y+=u[r+1],i);this.absolute=!1;break;case"h":for(r=0;r<f;++r)this._updateBBox(this.last.x+=u[r],this.last.y,i);this.absolute=!1;break;case"v":for(r=0;r<f;++r)this._updateBBox(this.last.x,this.last.y+=u[r],i);this.absolute=!1;break;case"c":for(r=0;r<f;r+=6)this._updateBBox(this.last.x+u[r],this.last.y+u[r+1],i),this._updateBBox(this.last.x+u[r+2],this.last.y+u[r+3],i),this._updateBBox(this.last.x+=u[r+4],this.last.y+=u[r+5],i);this.absolute=!1;break;case"s":case"q":for(r=0;r<f;r+=4)this._updateBBox(this.last.x+u[r],this.last.y+u[r+1],i),this._updateBBox(this.last.x+=u[r+2],this.last.y+=u[r+3],i);this.absolute=!1;break;case"A":for(r=0;r<f;r+=7)this._updateBBox(u[r+5],u[r+6],i);this.last.x=u[f-2];this.last.y=u[f-1];this.absolute=!0;break;case"a":for(r=0;r<f;r+=7)this._updateBBox(this.last.x+=u[r+5],this.last.y+=u[r+6],i);this.absolute=!1}for(e=[t.action],r=0;r<f;++r)e.push(n.formatNumber(u[r],!0));if("string"==typeof this.shape.path)this.shape.path+=e.join("");else for(r=0,f=e.length;r<f;++r)this.shape.path.push(e[r])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(n,t){this.tbbox=null;var i=this._validSegments[n.toLowerCase()];"number"==typeof i&&(i?t.length>=i&&(i={action:n,args:t.slice(0,t.length-t.length%i)},this.segments.push(i),this._updateWithSegment(i)):(i={action:n,args:[]},this.segments.push(i),this._updateWithSegment(i)))},_collectArgs:function(n,t){for(var i,r=0;r<t.length;++r)i=t[r],"boolean"==typeof i?n.push(i?1:0):"number"==typeof i?n.push(i):i instanceof Array?this._collectArgs(n,i):"x"in i&&"y"in i&&n.push(i.x,i.y)},moveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"M":"m",n),this},lineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"L":"l",n),this},hLineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"H":"h",n),this},vLineTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"V":"v",n),this},curveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"C":"c",n),this},smoothCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"S":"s",n),this},qCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"Q":"q",n),this},qSmoothCurveTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"T":"t",n),this},arcTo:function(){this._confirmSegmented();var n=[];return this._collectArgs(n,arguments),this._pushSegment(this.absolute?"A":"a",n),this},closePath:function(){return this._confirmSegmented(),this._pushSegment("Z",[]),this},_confirmSegmented:function(){if(!this.segmented){var n=this.shape.path;this.shape.path=[];this._setPath(n);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(i){var e,o;if(i=t.isArray(i)?i:i.match(n.pathSvgRegExp),this.segments=[],this.absolute=!0,this.bbox={},this.last={},i){for(var r="",u=[],s=i.length,f=0;f<s;++f)e=i[f],o=parseFloat(e),isNaN(o)?(r&&this._pushSegment(r,u),u=[],r=e):u.push(o);this._pushSegment(r,u)}},setShape:function(t){return this.inherited(arguments,["string"==typeof t?{path:t}:t]),this.segmented=!1,this.segments=[],n.lazyPathSegmentation||this._confirmSegmented(),this},_2PI:2*Math.PI}),i=i("dojox.gfx.path.TextPath",u,{constructor:function(){"text"in this||(this.text=t.clone(n.defaultTextPath));"fontStyle"in this||(this.fontStyle=t.clone(n.defaultFont))},getText:function(){return this.text},setText:function(t){return this.text=n.makeParameters(this.text,"string"==typeof t?{text:t}:t),this._setText(),this},getFont:function(){return this.fontStyle},setFont:function(t){return this.fontStyle="string"==typeof t?n.splitFontString(t):n.makeParameters(n.defaultFont,t),this._setFont(),this}}),n.path={Path:u,TextPath:i}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(n,t,i){function r(n){var t=Math.cos(n),i;return n=Math.sin(n),i={x:t+4/3*(1-t),y:n-4/3*t*(1-t)/n},{s:{x:t,y:-n},c1:{x:i.x,y:-i.y},c2:i,e:{x:t,y:n}}}var u=2*Math.PI,e=Math.PI/4,f=Math.PI/8,s=e+f,o=r(f);return n.arc={unitArcAsBezier:r,curvePI4:o,arcAsBezier:function(n,t,h,c,l,a,v,y){var w;l=!!l;a=!!a;w=i._degToRad(c);c=t*t;var b=h*h,p=i.multiplyPoint(i.rotate(-w),{x:(n.x-v)/2,y:(n.y-y)/2}),k=p.x*p.x,d=p.y*p.y;for(c=Math.sqrt((c*b-c*d-b*k)/(c*d+b*k)),isNaN(c)&&(c=0),c={x:c*t*p.y/h,y:-c*h*p.x/t},l==a&&(c={x:-c.x,y:-c.y}),c=i.multiplyPoint([i.translate((n.x+v)/2,(n.y+y)/2),i.rotate(w)],c),t=i.normalize([i.translate(c.x,c.y),i.rotate(w),i.scale(t,h)]),c=i.invert(t),n=i.multiplyPoint(c,n),y=i.multiplyPoint(c,v,y),v=Math.atan2(n.y,n.x),c=v-Math.atan2(y.y,y.x),a&&(c=-c),0>c?c+=u:c>u&&(c-=u),h=f,y=o,h=a?h:-h,n=[],l=c;0<l;l-=e)l<s&&(h=l/2,y=r(h),h=a?h:-h,l=0),p=i.normalize([t,i.rotate(v+h)]),a?(c=i.multiplyPoint(p,y.c1),w=i.multiplyPoint(p,y.c2),p=i.multiplyPoint(p,y.e)):(c=i.multiplyPoint(p,y.c2),w=i.multiplyPoint(p,y.c1),p=i.multiplyPoint(p,y.s)),n.push([c.x,c.y,w.x,w.y,p.x,p.y]),v+=2*h;return n}}})},"dojox/gfx/gradient":function(){define(["dojo/_base/lang","./matrix","dojo/_base/Color"],function(n,t,i){function r(n,i,r,u,f,e){return n=t.multiplyPoint(r,n,i),u=t.multiplyPoint(u,n),{r:n,p:u,o:t.multiplyPoint(f,u).x/e}}function f(n,t){return n.o-t.o}var u=n.getObject("dojox.gfx.gradient",!0);return u.rescale=function(n,t,r){var o=n.length,h=r<t,u,c,e,s,f;if(h&&(u=t,t=r,r=u),!o)return[];if(r<=n[0].offset)u=[{offset:0,color:n[0].color},{offset:1,color:n[0].color}];else if(t>=n[o-1].offset)u=[{offset:0,color:n[o-1].color},{offset:1,color:n[o-1].color}];else{for(c=r-t,u=[],0>t&&u.push({offset:0,color:new i(n[0].color)}),f=0;f<o&&!(e=n[f],e.offset>=t);++f);for(f?(s=n[f-1],u.push({offset:0,color:i.blendColors(new i(s.color),new i(e.color),(t-s.offset)/(e.offset-s.offset))})):u.push({offset:0,color:new i(e.color)});f<o;++f){if(e=n[f],e.offset>=r)break;u.push({offset:(e.offset-t)/c,color:new i(e.color)})}f<o?(s=n[f-1],u.push({offset:1,color:i.blendColors(new i(s.color),new i(e.color),(r-s.offset)/(e.offset-s.offset))})):u.push({offset:1,color:new i(n[o-1].color)})}if(h)for(u.reverse(),f=0,o=u.length;f<o;++f)e=u[f],e.offset=1-e.offset;return u},u.project=function(n,i,e,o,s,h){n=n||t.identity;var c=t.multiplyPoint(n,i.x1,i.y1),l=t.multiplyPoint(n,i.x2,i.y2);return s=Math.atan2(l.y-c.y,l.x-c.x),h=t.project(l.x-c.x,l.y-c.y),c=t.multiplyPoint(h,c),l=t.multiplyPoint(h,l),c=new t.Matrix2D([t.rotate(-s),{dx:-c.x,dy:-c.y}]),l=t.multiplyPoint(c,l).x,n=[r(e.x,e.y,n,h,c,l),r(o.x,o.y,n,h,c,l),r(e.x,o.y,n,h,c,l),r(o.x,e.y,n,h,c,l)].sort(f),i=u.rescale(i.colors,n[0].o,n[3].o),{type:"linear",x1:n[0].p.x,y1:n[0].p.y,x2:n[3].p.x,y2:n[3].p.y,colors:i,angle:s}},u})},"*noref":1}});define("dojox/gfx/vml","dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/Color dojo/_base/sniff dojo/_base/config dojo/dom dojo/dom-geometry dojo/dom-style dojo/_base/kernel ./_base ./shape ./path ./arc ./gradient ./matrix".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function k(n,t,r){r=r||h.global;t.call(r,n);(n instanceof c.Surface||n instanceof c.Group)&&i.forEach(n.children,function(n){k(n,t,r)})}var w=c.vml={},d=function(){w.xmlns="urn:schemas-microsoft-com:vml";try{document.namespaces.add("v",w.xmlns);var t="* group roundrect oval shape rect imagedata path textpath text".split(" "),n=0,i=1,r=document.createStyleSheet();for(8<=u("ie")&&(n=1,i=t.length);n<i;++n)r.addRule("v\\:"+t[n],"behavior:url(#default#VML); display:inline-block")}catch(f){setTimeout(d,10)}},b;return d(),w.text_alignment={start:"left",middle:"center",end:"right"},w._parseFloat=function(n){return n.match(/^\d+f$/i)?parseInt(n)/65536:parseFloat(n)},w._bool={t:1,"true":1},w._reparentEvents=function(n,t){for(var i in t)"on"==i.substr(0,2).toLowerCase()&&(n[i]=t[i],t[i]=null)},w.Shape=t("dojox.gfx.vml.Shape",l.Shape,{setFill:function(n){var t,u,f,s;if(!n)return this.fillStyle=null,this.rawNode.filled="f",this;if("object"==typeof n&&"type"in n){switch(n.type){case"linear":var h=this._getRealMatrix(),e=this.getBoundingBox(),o=this._getRealBBox?this._getRealBBox():this.getTransformedBoundingBox();for(f=[],this.fillStyle!==n&&(this.fillStyle=c.makeParameters(c.defaultLinearGradient,n)),n=c.gradient.project(h,this.fillStyle,{x:e.x,y:e.y},{x:e.x+e.width,y:e.y+e.height},o[0],o[2]),u=n.colors,"0.00000"!=u[0].offset.toFixed(5)&&f.push("0 "+c.normalizeColor(u[0].color).toHex()),t=0;t<u.length;++t)f.push(u[t].offset.toFixed(5)+" "+c.normalizeColor(u[t].color).toHex());t=u.length-1;"1.00000"!=u[t].offset.toFixed(5)&&f.push("1 "+c.normalizeColor(u[t].color).toHex());t=this.rawNode.fill;t.colors.value=f.join(";");t.method="sigma";t.type="gradient";t.angle=(270-p._radToDeg(n.angle))%360;t.on=!0;break;case"radial":this.fillStyle=n=c.makeParameters(c.defaultRadialGradient,n);var h=parseFloat(this.rawNode.style.left),e=parseFloat(this.rawNode.style.top),o=parseFloat(this.rawNode.style.width),l=parseFloat(this.rawNode.style.height),a=isNaN(o)?1:2*n.r/o;for(u=[],0<n.colors[0].offset&&u.push({offset:1,color:c.normalizeColor(n.colors[0].color)}),i.forEach(n.colors,function(n){u.push({offset:1-n.offset*a,color:c.normalizeColor(n.color)})}),t=u.length-1;0<=t&&0>u[t].offset;)--t;if(t<u.length-1)for(f=u[t],s=u[t+1],s.color=r.blendColors(f.color,s.color,f.offset/(f.offset-s.offset)),s.offset=0;2<u.length-t;)u.pop();for(t=u.length-1,f=[],0<u[t].offset&&f.push("0 "+u[t].color.toHex());0<=t;--t)f.push(u[t].offset.toFixed(5)+" "+u[t].color.toHex());t=this.rawNode.fill;t.colors.value=f.join(";");t.method="sigma";t.type="gradientradial";t.focusposition=isNaN(o)||isNaN(l)||isNaN(h)||isNaN(e)?"0.5 0.5":((n.cx-h)/o).toFixed(5)+" "+((n.cy-e)/l).toFixed(5);t.focussize="0 0";t.on=!0;break;case"pattern":this.fillStyle=n=c.makeParameters(c.defaultPattern,n);t=this.rawNode.fill;t.type="tile";t.src=n.src;n.width&&n.height&&(t.size.x=c.px2pt(n.width),t.size.y=c.px2pt(n.height));t.alignShape="f";t.position.x=0;t.position.y=0;t.origin.x=n.width?n.x/n.width:0;t.origin.y=n.height?n.y/n.height:0;t.on=!0}return this.rawNode.fill.opacity=1,this}return this.fillStyle=c.normalizeColor(n),(t=this.rawNode.fill)||(t=this.rawNode.ownerDocument.createElement("v:fill")),t.method="any",t.type="solid",t.opacity=this.fillStyle.a,(f=this.rawNode.filters["DXImageTransform.Microsoft.Alpha"])&&(f.opacity=Math.round(100*this.fillStyle.a)),this.rawNode.fillcolor=this.fillStyle.toHex(),this.rawNode.filled=!0,this},setStroke:function(t){if(!t)return this.strokeStyle=null,this.rawNode.stroked="f",this;("string"==typeof t||n.isArray(t)||t instanceof r)&&(t={color:t});t=this.strokeStyle=c.makeParameters(c.defaultStroke,t);t.color=c.normalizeColor(t.color);var i=this.rawNode;return i.stroked=!0,i.strokecolor=t.color.toCss(),i.strokeweight=t.width+"px",i.stroke&&(i.stroke.opacity=t.color.a,i.stroke.endcap=this._translate(this._capMap,t.cap),"number"==typeof t.join?(i.stroke.joinstyle="miter",i.stroke.miterlimit=t.join):i.stroke.joinstyle=t.join,i.stroke.dashstyle="none"==t.style?"Solid":t.style),this},_capMap:{butt:"flat"},_capMapReversed:{flat:"butt"},_translate:function(n,t){return t in n?n[t]:t},_applyTransform:function(){var t=this._getRealMatrix(),n,r;if(t){if(n=this.rawNode.skew,"undefined"==typeof n)for(r=0;r<this.rawNode.childNodes.length;++r)if("skew"==this.rawNode.childNodes[r].tagName){n=this.rawNode.childNodes[r];break}if(n){n.on="f";var r=t.xx.toFixed(8)+" "+t.xy.toFixed(8)+" "+t.yx.toFixed(8)+" "+t.yy.toFixed(8)+" 0 0",t=Math.floor(t.dx).toFixed()+"px "+Math.floor(t.dy).toFixed()+"px",i=this.rawNode.style,u=parseFloat(i.left),e=parseFloat(i.top),f=parseFloat(i.width),i=parseFloat(i.height);isNaN(u)&&(u=0);isNaN(e)&&(e=0);(isNaN(f)||!f)&&(f=1);(isNaN(i)||!i)&&(i=1);u=(-u/f-.5).toFixed(8)+" "+(-e/i-.5).toFixed(8);n.matrix=r;n.origin=u;n.offset=t;n.on=!0}}return this.fillStyle&&"linear"==this.fillStyle.type&&this.setFill(this.fillStyle),this.clip&&this.setClip(this.clip),this},_setDimensions:function(){return this},setRawNode:function(n){n.stroked="f";n.filled="f";this.rawNode=n;this.rawNode.__gfxObject__=this},_moveToFront:function(){return this.rawNode.parentNode.appendChild(this.rawNode),this},_moveToBack:function(){var n=this.rawNode,i=n.parentNode,t=i.firstChild;return i.insertBefore(n,t),"rect"==t.tagName&&t.swapNode(n),this},_getRealMatrix:function(){return this.parentMatrix?new p.Matrix2D([this.parentMatrix,this.matrix]):this.matrix},setClip:function(n){var t,r,i;if(this.inherited(arguments),t=this.rawNode.style,n){if("width"in n){var i=this._getRealMatrix(),u=parseFloat(t.left),f=parseFloat(t.top);isNaN(u)&&(u=0);isNaN(f)&&(f=0);r=p.multiplyRectangle(i,n);i=p.multiplyPoint(i,{x:u,y:f});t.clip="rect("+Math.round(r.y-i.y)+"px "+Math.round(r.x-i.x+r.width)+"px "+Math.round(r.y-i.y+r.height)+"px "+Math.round(r.x-i.x)+"px)"}}else t.position="absolute",t.clip="rect(0px "+t.width+" "+t.height+" 0px)";return this}}),function(){var n=w.Shape,t=n.prototype.setStroke,i=n.prototype.setFill;n.prototype.setStroke=function(){var r=t.apply(this,arguments),n=this.rawNode,n=n&&n.stroke,i=this.getParent();return n&&i&&(n.opacity*=void 0!==i._esriIeOpacity&&null!==i._esriIeOpacity?i._esriIeOpacity:1),r};n.prototype.setFill=function(){var u=i.apply(this,arguments),t=this.rawNode,r=t&&t.fill,n=this.getParent();return r&&n&&(n=void 0!==n._esriIeOpacity&&null!==n._esriIeOpacity?n._esriIeOpacity:1,"tile"===r.type?s.set(t,"opacity",n):r.opacity*=n),u}}(),w.Group=t("dojox.gfx.vml.Group",w.Shape,{constructor:function(){l.Container._init.call(this)},_applyTransform:function(){for(var t=this._getRealMatrix(),n=0;n<this.children.length;++n)this.children[n]._updateParentMatrix(t);return this.clip&&this.setClip(this.clip),this},_setDimensions:function(n,t){var i=this.rawNode,r=i.style,u=this.bgNode.style;for(r.width=n,r.height=t,i.coordsize=n+" "+t,u.width=n,u.height=t,i=0;i<this.children.length;++i)this.children[i]._setDimensions(n,t);return this},setClip:function(n){var i,r;if(this.clip=n,i=this.rawNode.style,n){if("width"in n){r=this._getRealMatrix();n=p.multiplyRectangle(r,n);var t=this.getBoundingBox(),r=(t=t?p.multiplyRectangle(r,t):null)&&0>t.x?t.x:0,t=t&&0>t.y?t.y:0;i.position="absolute";i.clip="rect("+Math.round(n.y-t)+"px "+Math.round(n.x+n.width-r)+"px "+Math.round(n.y+n.height-t)+"px "+Math.round(n.x-r)+"px)"}}else i.position="absolute",i.clip="rect(0px "+i.width+" "+i.height+" 0px)";return this},destroy:function(){this.clear(!0);w.Shape.prototype.destroy.apply(this,arguments)}}),w.Group.nodeType="group",w.Rect=t("dojox.gfx.vml.Rect",[w.Shape,l.Rect],{setShape:function(n){var t;n=this.shape=c.makeParameters(this.shape,n);this.bbox=null;var r=Math.min(1,n.r/Math.min(parseFloat(n.width),parseFloat(n.height))).toFixed(8),i=this.rawNode.parentNode,f=null;if(i){if(i.lastChild!==this.rawNode)for(t=0;t<i.childNodes.length;++t)if(i.childNodes[t]===this.rawNode){f=i.childNodes[t+1];break}i.removeChild(this.rawNode)}return 7<u("ie")?(t=this.rawNode.ownerDocument.createElement("v:roundrect"),t.arcsize=r,t.style.display="inline-block",w._reparentEvents(t,this.rawNode),this.rawNode=t,this.rawNode.__gfxObject__=this):this.rawNode.arcsize=r,i&&(f?i.insertBefore(this.rawNode,f):i.appendChild(this.rawNode)),r=this.rawNode.style,r.left=n.x.toFixed(),r.top=n.y.toFixed(),r.width="string"==typeof n.width&&0<=n.width.indexOf("%")?n.width:Math.max(n.width.toFixed(),0),r.height="string"==typeof n.height&&0<=n.height.indexOf("%")?n.height:Math.max(n.height.toFixed(),0),this.setTransform(this.matrix).setFill(this.fillStyle).setStroke(this.strokeStyle)}}),w.Rect.nodeType="roundrect",w.Ellipse=t("dojox.gfx.vml.Ellipse",[w.Shape,l.Ellipse],{setShape:function(n){n=this.shape=c.makeParameters(this.shape,n);this.bbox=null;var t=this.rawNode.style;return t.left=(n.cx-n.rx).toFixed(),t.top=(n.cy-n.ry).toFixed(),t.width=(2*n.rx).toFixed(),t.height=(2*n.ry).toFixed(),this.setTransform(this.matrix)}}),w.Ellipse.nodeType="oval",w.Circle=t("dojox.gfx.vml.Circle",[w.Shape,l.Circle],{setShape:function(n){n=this.shape=c.makeParameters(this.shape,n);this.bbox=null;var t=this.rawNode.style;return t.left=(n.cx-n.r).toFixed(),t.top=(n.cy-n.r).toFixed(),t.width=(2*n.r).toFixed(),t.height=(2*n.r).toFixed(),this}}),w.Circle.nodeType="oval",w.Line=t("dojox.gfx.vml.Line",[w.Shape,l.Line],{constructor:function(n){n&&n.setAttribute("dojoGfxType","line")},setShape:function(n){return n=this.shape=c.makeParameters(this.shape,n),this.bbox=null,this.rawNode.path.v="m"+n.x1.toFixed()+" "+n.y1.toFixed()+"l"+n.x2.toFixed()+" "+n.y2.toFixed()+"e",this.setTransform(this.matrix)}}),w.Line.nodeType="shape",w.Polyline=t("dojox.gfx.vml.Polyline",[w.Shape,l.Polyline],{constructor:function(n){n&&n.setAttribute("dojoGfxType","polyline")},setShape:function(n,t){var r,i,u;if(n&&n instanceof Array?(this.shape=c.makeParameters(this.shape,{points:n}),t&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=c.makeParameters(this.shape,n),this.bbox=null,this._normalizePoints(),r=[],i=this.shape.points,0<i.length&&(r.push("m"),r.push(i[0].x.toFixed(),i[0].y.toFixed()),1<i.length))for(r.push("l"),u=1;u<i.length;++u)r.push(i[u].x.toFixed(),i[u].y.toFixed());return r.push("e"),this.rawNode.path.v=r.join(" "),this.setTransform(this.matrix)}}),w.Polyline.nodeType="shape",w.Image=t("dojox.gfx.vml.Image",[w.Shape,l.Image],{setShape:function(n){return n=this.shape=c.makeParameters(this.shape,n),this.bbox=null,this.rawNode.firstChild.src=n.src,this.setTransform(this.matrix)},_applyTransform:function(){var n=this._getRealMatrix(),i=this.rawNode,t=i.style,r=this.shape,n=n?p.multiply(n,{dx:r.x,dy:r.y}):p.normalize({dx:r.x,dy:r.y}),u;return 0==n.xy&&0==n.yx&&0<n.xx&&0<n.yy?(t.filter="",t.width=Math.floor(n.xx*r.width),t.height=Math.floor(n.yy*r.height),t.left=Math.floor(n.dx),t.top=Math.floor(n.dy)):(u=i.parentNode.style,t.left="0px",t.top="0px",t.width=u.width,t.height=u.height,n=p.multiply(n,{xx:r.width/parseInt(t.width),yy:r.height/parseInt(t.height)}),(i=i.filters["DXImageTransform.Microsoft.Matrix"])?(i.M11=n.xx,i.M12=n.xy,i.M21=n.yx,i.M22=n.yy,i.Dx=n.dx,i.Dy=n.dy):t.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+n.xx+", M12="+n.xy+", M21="+n.yx+", M22="+n.yy+", Dx="+n.dx+", Dy="+n.dy+")"),this},_setDimensions:function(n,t){var i=this.rawNode;return i.filters["DXImageTransform.Microsoft.Matrix"]?(i=i.style,i.width=n,i.height=t,this._applyTransform()):this}}),w.Image.nodeType="rect",w.Text=t("dojox.gfx.vml.Text",[w.Shape,l.Text],{constructor:function(n){n&&n.setAttribute("dojoGfxType","text");this.fontStyle=null},_alignment:{start:"left",middle:"center",end:"right"},setShape:function(n){var i,t,f,o;this.shape=c.makeParameters(this.shape,n);this.bbox=null;i=this.rawNode;n=this.shape;t=n.x;f=n.y.toFixed();switch(n.align){case"middle":t-=5;break;case"end":t-=10}for(var f="m"+t.toFixed()+","+f+"l"+(t+10).toFixed()+","+f+"e",r=null,t=null,e=i.childNodes,u=0;u<e.length;++u)if(o=e[u].tagName,"path"==o){if(r=e[u],t)break}else if("textpath"==o&&(t=e[u],r))break;return r||(r=i.ownerDocument.createElement("v:path"),i.appendChild(r)),t||(t=i.ownerDocument.createElement("v:textpath"),i.appendChild(t)),r.v=f,r.textPathOk=!0,t.on=!0,i=w.text_alignment[n.align],t.style["v-text-align"]=i?i:"left",t.style["text-decoration"]=n.decoration,t.style["v-rotate-letters"]=n.rotated,t.style["v-text-kern"]=n.kerning,t.string=n.text,this.setTransform(this.matrix)},_setFont:function(){for(var i=this.fontStyle,t=this.rawNode.childNodes,n=0;n<t.length;++n)if("textpath"==t[n].tagName){t[n].style.font=c.makeFontString(i);break}this.setTransform(this.matrix)},_getRealMatrix:function(){var n=this.inherited(arguments);return n&&(n=p.multiply(n,{dy:.35*-c.normalizedLength(this.fontStyle?this.fontStyle.size:"10pt")})),n},getTextWidth:function(){var n=this.rawNode,i=n.style.display,t;return n.style.display="inline",t=c.pt2px(parseFloat(n.currentStyle.width)),n.style.display=i,t}}),w.Text.nodeType="shape",w.Path=t("dojox.gfx.vml.Path",[w.Shape,a.Path],{constructor:function(n){n&&!n.getAttribute("dojoGfxType")&&n.setAttribute("dojoGfxType","path");this.vmlPath="";this.lastControl={}},_updateWithSegment:function(t){var i=n.clone(this.last);this.inherited(arguments);1<arguments.length||(i=this[this.renderers[t.action]](t,i),"string"==typeof this.vmlPath?(this.vmlPath+=i.join(""),this.rawNode.path.v=this.vmlPath+" r0,0 e"):Array.prototype.push.apply(this.vmlPath,i))},setShape:function(){return this.vmlPath=[],this.lastControl.type="",this.inherited(arguments),this.vmlPath=this.vmlPath.join(""),this.rawNode.path.v=this.vmlPath+" r0,0 e",this},_pathVmlToSvgMap:{m:"M",l:"L",t:"m",r:"l",c:"C",v:"c",qb:"Q",x:"z",e:""},renderers:{M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"},_addArgs:function(n,t,i,r){for(t=t instanceof Array?t:t.args;i<r;++i)n.push(" ",t[i].toFixed())},_adjustRelCrd:function(n,t,i){var f;t=t instanceof Array?t:t.args;var o=t.length,u=Array(o),r=0,e=n.x;if(n=n.y,"number"!=typeof e&&(u[0]=e=t[0],u[1]=n=t[1],r=2),"number"==typeof i&&2!=i)for(f=i;f<=o;){for(;r<f;r+=2)u[r]=e+t[r],u[r+1]=n+t[r+1];e=u[f-2];n=u[f-1];f+=i}else for(;r<o;r+=2)u[r]=e+=t[r],u[r+1]=n+=t[r+1];return u},_adjustRelPos:function(n,t){for(var r=t instanceof Array?t:t.args,u=r.length,f=Array(u),i=0;i<u;++i)f[i]=n+=r[i];return f},_moveToA:function(n){var t=[" m"],i;return n=n instanceof Array?n:n.args,i=n.length,this._addArgs(t,n,0,2),2<i&&(t.push(" l"),this._addArgs(t,n,2,i)),this.lastControl.type="",t},_moveToR:function(n,t){return this._moveToA(this._adjustRelCrd(t,n))},_lineToA:function(n){var t=[" l"];return n=n instanceof Array?n:n.args,this._addArgs(t,n,0,n.length),this.lastControl.type="",t},_lineToR:function(n,t){return this._lineToA(this._adjustRelCrd(t,n))},_hLineToA:function(n,t){for(var r=[" l"],f=" "+t.y.toFixed(),u=n instanceof Array?n:n.args,e=u.length,i=0;i<e;++i)r.push(" ",u[i].toFixed(),f);return this.lastControl.type="",r},_hLineToR:function(n,t){return this._hLineToA(this._adjustRelPos(t.x,n),t)},_vLineToA:function(n,t){for(var r=[" l"],f=" "+t.x.toFixed(),u=n instanceof Array?n:n.args,e=u.length,i=0;i<e;++i)r.push(f," ",u[i].toFixed());return this.lastControl.type="",r},_vLineToR:function(n,t){return this._vLineToA(this._adjustRelPos(t.y,n),t)},_curveToA:function(n){var i=[];n=n instanceof Array?n:n.args;for(var r=n.length,u=this.lastControl,t=0;t<r;t+=6)i.push(" c"),this._addArgs(i,n,t,t+6);return u.x=n[r-4],u.y=n[r-3],u.type="C",i},_curveToR:function(n,t){return this._curveToA(this._adjustRelCrd(t,n,6))},_smoothCurveToA:function(n,t){var r=[],u=n instanceof Array?n:n.args,e=u.length,i=this.lastControl,f=0;for("C"!=i.type&&(r.push(" c"),this._addArgs(r,[t.x,t.y],0,2),this._addArgs(r,u,0,4),i.x=u[0],i.y=u[1],i.type="C",f=4);f<e;f+=4)r.push(" c"),this._addArgs(r,[2*t.x-i.x,2*t.y-i.y],0,2),this._addArgs(r,u,f,f+4),i.x=u[f],i.y=u[f+1];return r},_smoothCurveToR:function(n,t){return this._smoothCurveToA(this._adjustRelCrd(t,n,4),t)},_qCurveToA:function(n){var i=[];n=n instanceof Array?n:n.args;for(var r=n.length,u=this.lastControl,t=0;t<r;t+=4)i.push(" qb"),this._addArgs(i,n,t,t+4);return u.x=n[r-4],u.y=n[r-3],u.type="Q",i},_qCurveToR:function(n,t){return this._qCurveToA(this._adjustRelCrd(t,n,4))},_qSmoothCurveToA:function(n,t){var r=[],f=n instanceof Array?n:n.args,e=f.length,i=this.lastControl,u=0;for("Q"!=i.type&&(r.push(" qb"),this._addArgs(r,[i.x=t.x,i.y=t.y],0,2),i.type="Q",this._addArgs(r,f,0,2),u=2);u<e;u+=2)r.push(" qb"),this._addArgs(r,[i.x=2*t.x-i.x,i.y=2*t.y-i.y],0,2),this._addArgs(r,f,u,u+2);return r},_qSmoothCurveToR:function(n,t){return this._qSmoothCurveToA(this._adjustRelCrd(t,n,2),t)},_arcTo:function(n,t){for(var f,e,h,o,r,s=[],u=n.args,c=u.length,l="a"==n.action,i=0;i<c;i+=7){for(f=u[i+5],e=u[i+6],l&&(f+=t.x,e+=t.y),h=v.arcAsBezier(t,u[i],u[i+1],u[i+2],u[i+3]?1:0,u[i+4]?1:0,f,e),o=0;o<h.length;++o)s.push(" c"),r=h[o],this._addArgs(s,r,0,r.length),this._updateBBox(r[0],r[1]),this._updateBBox(r[2],r[3]),this._updateBBox(r[4],r[5]);t.x=f;t.y=e}return this.lastControl.type="",s},_closePath:function(){return this.lastControl.type="",["x"]},_getRealBBox:function(){return(this._confirmSegmented(),this.tbbox)?this.tbbox:("string"==typeof this.shape.path&&(this.shape.path=""),this.inherited(arguments))}}),w.Path.nodeType="shape",w.EsriPath=t("dojox.gfx.vml.EsriPath",w.Path,{setShape:function(n){return this.rawNode.path.v=this.vmlPath=n,this}}),w.EsriPath.nodeType="shape",w.TextPath=t("dojox.gfx.vml.TextPath",[w.Path,a.TextPath],{constructor:function(t){t&&t.setAttribute("dojoGfxType","textpath");this.fontStyle=null;"text"in this||(this.text=n.clone(c.defaultTextPath));"fontStyle"in this||(this.fontStyle=n.clone(c.defaultFont))},setText:function(n){return this.text=c.makeParameters(this.text,"string"==typeof n?{text:n}:n),this._setText(),this},setFont:function(n){return this.fontStyle="string"==typeof n?c.splitFontString(n):c.makeParameters(c.defaultFont,n),this._setFont(),this},_setText:function(){var e;this.bbox=null;for(var t=this.rawNode,r=this.text,i=null,n=null,f=t.childNodes,u=0;u<f.length;++u)if(e=f[u].tagName,"path"==e){if(i=f[u],n)break}else if("textpath"==e&&(n=f[u],i))break;i||(i=this.rawNode.ownerDocument.createElement("v:path"),t.appendChild(i));n||(n=this.rawNode.ownerDocument.createElement("v:textpath"),t.appendChild(n));i.textPathOk=!0;n.on=!0;t=w.text_alignment[r.align];n.style["v-text-align"]=t?t:"left";n.style["text-decoration"]=r.decoration;n.style["v-rotate-letters"]=r.rotated;n.style["v-text-kern"]=r.kerning;n.string=r.text},_setFont:function(){for(var i=this.fontStyle,t=this.rawNode.childNodes,n=0;n<t.length;++n)if("textpath"==t[n].tagName){t[n].style.font=c.makeFontString(i);break}}}),w.TextPath.nodeType="shape",w.Surface=t("dojox.gfx.vml.Surface",l.Surface,{constructor:function(){l.Container._init.call(this)},destroy:function(){this.clear(!0);this.inherited(arguments)},setDimensions:function(n,t){if(this.width=c.normalizedLength(n),this.height=c.normalizedLength(t),!this.rawNode)return this;var i=this.clipNode.style,r=this.rawNode,u=r.style,f=this.bgNode.style,e=this._parent.style;for(e.width=n,e.height=t,i.width=n,i.height=t,i.clip="rect(0px "+n+"px "+t+"px 0px)",u.width=n,u.height=t,r.coordsize=n+" "+t,f.width=n,f.height=t,i=0;i<this.children.length;++i)this.children[i]._setDimensions(n,t);return this},getDimensions:function(){var n=this.rawNode?{width:c.normalizedLength(this.rawNode.style.width),height:c.normalizedLength(this.rawNode.style.height)}:null;return 0>=n.width&&(n.width=this.width),0>=n.height&&(n.height=this.height),n}}),w.createSurface=function(n,t,i){var r,f,l;t||i||(r=o.position(n),t=t||r.w,i=i||r.h);"number"==typeof t&&(t+="px");"number"==typeof i&&(i+="px");r=new w.Surface;n=e.byId(n);var a=r.clipNode=n.ownerDocument.createElement("div"),s=r.rawNode=n.ownerDocument.createElement("v:group"),f=a.style,h=s.style;return 7<u("ie")&&(h.display="inline-block"),r._parent=n,r._nodes.push(a),n.style.width=t,n.style.height=i,f.position="absolute",f.width=t,f.height=i,f.clip="rect(0px "+t+" "+i+" 0px)",h.position="absolute",h.width=t,h.height=i,s.coordsize=("100%"===t?t:parseFloat(t))+" "+("100%"===i?i:parseFloat(i)),s.coordorigin="0 0",f=r.bgNode=s.ownerDocument.createElement("v:rect"),l=f.style,l.left=l.top=0,l.width=h.width,l.height=h.height,f.filled=f.stroked="f",s.appendChild(f),a.appendChild(s),n.appendChild(a),r.width=c.normalizedLength(t),r.height=c.normalizedLength(i),r},t=function(n){if(this!=n.getParent()){var t=n.getParent();t&&t.remove(n);this.rawNode.appendChild(n.rawNode);b.add.apply(this,arguments);k(this,function(n){"function"==typeof n.getFont&&(n.setShape(n.getShape()),n.setFont(n.getFont()));"function"==typeof n.setFill&&(n.setFill(n.getFill()),n.setStroke(n.getStroke()))})}return this},a=function(n){return this!=n.getParent()&&(this.rawNode.appendChild(n.rawNode),n.getParent()||(n.setFill(n.getFill()),n.setStroke(n.getStroke())),b.add.apply(this,arguments)),this},b=l.Container,f={add:!0===f.fixVmlAdd?t:a,remove:function(n){return this==n.getParent()&&(this.rawNode==n.rawNode.parentNode&&this.rawNode.removeChild(n.rawNode),b.remove.apply(this,arguments)),this},clear:function(){for(var n=this.rawNode;n.firstChild!=n.lastChild;)n.firstChild!=this.bgNode&&n.removeChild(n.firstChild),n.lastChild!=this.bgNode&&n.removeChild(n.lastChild);return b.clear.apply(this,arguments)},getBoundingBox:b.getBoundingBox,_moveChildToFront:b._moveChildToFront,_moveChildToBack:b._moveChildToBack},t={createGroup:function(){var t=this.createObject(w.Group,null),n=t.rawNode.ownerDocument.createElement("v:rect");return n.style.left=n.style.top=0,n.style.width=t.rawNode.style.width,n.style.height=t.rawNode.style.height,n.filled=n.stroked="f",t.rawNode.appendChild(n),t.bgNode=n,t},createImage:function(n){if(!this.rawNode)return null;var i=new w.Image,r=this.rawNode.ownerDocument,t=r.createElement("v:rect");return t.stroked="f",t.style.width=this.rawNode.style.width,t.style.height=this.rawNode.style.height,r=r.createElement("v:imagedata"),t.appendChild(r),i.setRawNode(t),this.rawNode.appendChild(t),i.setShape(n),this.add(i),i},createRect:function(n){if(!this.rawNode)return null;var t=new w.Rect,i=this.rawNode.ownerDocument.createElement("v:roundrect");return 7<u("ie")&&(i.style.display="inline-block"),t.setRawNode(i),this.rawNode.appendChild(i),t.setShape(n),this.add(t),t},createObject:function(n,t){if(!this.rawNode)return null;var i=new n,r=this.rawNode.ownerDocument.createElement("v:"+n.nodeType);i.setRawNode(r);this.rawNode.appendChild(r);switch(n){case w.Group:case w.Line:case w.Polyline:case w.Image:case w.Text:case w.Path:case w.TextPath:this._overrideSize(r)}return i.setShape(t),this.add(i),i},_overrideSize:function(n){var t=this.rawNode.style,i=t.width,t=t.height;n.style.width=i;n.style.height=t;n.coordsize=parseInt(i)+" "+parseInt(t)}},n.extend(w.Group,f),n.extend(w.Group,l.Creator),n.extend(w.Group,t),n.extend(w.Surface,f),n.extend(w.Surface,l.Creator),n.extend(w.Surface,t),w.fixTarget=function(n){return n.gfxTarget||(n.gfxTarget=n.target.__gfxObject__),!0},w})},"dojox/gfx/filters":function(){define("dojox/gfx/filters",["dojo/_base/lang","dojo/_base/array"],function(n,t){var i={},s={x:"0%",y:"0%",width:"100%",height:"100%"},u={},e,r,c,f,h,o;i.createFilter=function(t,i){var r=n.mixin({},s,t);return r.primitives||(r.primitives=[]),i&&Array.prototype.push.apply(r.primitives,i),r};e=function(t,i,r){return i instanceof Array&&(r=i,i=null),i=n.mixin({},i),i.children=r,i.tag=t,i};t.forEach("feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feFlood feGaussianBlur feImage feMorphology feOffset feSpecularLighting feTile feTurbulence feDistantLight fePointLight feSpotLight feMergeNode feFuncA feFuncR feFuncG feFuncB".split(" "),function(n){i[n]=function(t,i){return e(n,t,i)}});i.feMerge=function(n,t){if("string"==typeof n){for(var u=[],r=0;r<arguments.length;++r)u.push(i.feMergeNode({"in":arguments[r]}));return e("feMerge",{},u)}return e("feMerge",n,t)};r=i.createFilter;u.convolutions=[r({_gfxName:"boxBlur3"},[i.feConvolveMatrix({"in":"SourceGraphic",order:3,divisor:9,kernelMatrix:"1,1,1,1,1,1,1,1,1"})]),r({_gfxName:"boxBlur5"},[i.feConvolveMatrix({"in":"SourceGraphic",order:5,divisor:25,kernelMatrix:"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1"})]),r({_gfxName:"verticalEdges",filterUnits:"objectBoundingBox"},[i.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:1,kernelMatrix:"-1 0 1 -1 0 1 -1 0 1"}),i.feComponentTransfer({"in":"kernel"},[i.feFuncA({type:"table",tableValues:"1,1"})])]),r({_gfxName:"horizontalEdges",filterUnits:"objectBoundingBox"},[i.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:1,kernelMatrix:"1 1 1 0 0 0 -1 -1 -1"}),i.feComponentTransfer({"in":"kernel"},[i.feFuncA({type:"table",tableValues:"1,1"})])]),r({_gfxName:"allEdges3",filterUnits:"objectBoundingBox"},[i.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:1,kernelMatrix:"-1 -1 -1 -1 8 -1 -1 -1 -1"}),i.feComponentTransfer({"in":"kernel"},[i.feFuncA({type:"table",tableValues:"1,1"})])]),r({_gfxName:"edgeEnhance",filterUnits:"objectBoundingBox"},[i.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:-1,kernelMatrix:"0 1 0 1 -5 1 0 1 0"}),i.feComponentTransfer({"in":"kernel"},[i.feFuncA({type:"table",tableValues:"1,1"})])])];t.forEach(u.convolutions,function(t){n.mixin(t,s)});u.shadows=[r({_gfxName:"fastSmallDropShadow"},[i.feColorMatrix({"in":"SourceAlpha",type:"matrix",result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0.7,0"}),i.feOffset({dx:3,dy:3,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")]),r({_gfxName:"fastDropShadow"},[i.feColorMatrix({"in":"SourceAlpha",type:"matrix",result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0.7,0"}),i.feOffset({dx:5,dy:5,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")]),r({_gfxName:"fastDropShadowLight"},[i.feColorMatrix({"in":"SourceAlpha",type:"matrix",result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0.4,0"}),i.feOffset({dx:5,dy:5,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")]),r({_gfxName:"dropShadow"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:4}),i.feOffset({dx:5,dy:5,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")]),r({_gfxName:"dropShadowLight"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:4,result:"blur"}),i.feComponentTransfer({"in":"blur",result:"lessblur"},[i.feFuncA({type:"linear",slope:.5})]),i.feOffset({"in":"lessblur",dx:5,dy:5,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")]),r({_gfxName:"smallDropShadow"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:3}),i.feOffset({dx:2,dy:2,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")]),r({_gfxName:"smallDropShadowLight"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:3,result:"blur"}),i.feComponentTransfer({"in":"blur",result:"lessblur"},[i.feFuncA({type:"linear",slope:.5})]),i.feOffset({"in":"lessblur",dx:2,dy:2,result:"offsetBlur"}),i.feMerge("offsetBlur","SourceGraphic")])];c={x:"-10%",y:"-10%",width:"125%",height:"125%"};t.forEach(u.shadows,function(t){n.mixin(t,c)});u.blurs=[r({_gfxName:"blur1",x:"-5%",y:"-5%",width:"110%",height:"110%"},[i.feGaussianBlur({"in":"SourceGraphic",stdDeviation:1})]),r({_gfxName:"blur2",x:"-15%",y:"-15%",width:"130%",height:"130%"},[i.feGaussianBlur({"in":"SourceGraphic",stdDeviation:2})]),r({_gfxName:"blur4",x:"-15%",y:"-15%",width:"130%",height:"130%"},[i.feGaussianBlur({"in":"SourceGraphic",stdDeviation:4})]),r({_gfxName:"blur8",x:"-20%",y:"-20%",width:"140%",height:"140%"},[i.feGaussianBlur({"in":"SourceGraphic",stdDeviation:8})]),r({_gfxName:"glow",x:"-10%",y:"-10%",width:"120%",height:"120%"},[i.feGaussianBlur({"in":"SourceGraphic",stdDeviation:2}),i.feComponentTransfer([i.feFuncA({type:"linear",slope:10})])])];u.colors=[r({_gfxName:"negate"},[i.feComponentTransfer([i.feFuncR({type:"table",tableValues:"1,0"}),i.feFuncG({type:"table",tableValues:"1,0"}),i.feFuncB({type:"table",tableValues:"1,0"})])]),r({_gfxName:"sepia"},[i.feColorMatrix({result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,1,0"}),i.feComponentTransfer({"in":"grey"},[i.feFuncR({type:"linear",slope:.5,intercept:.5}),i.feFuncB({type:"table",tableValues:"0,0"})])]),r({_gfxName:"grayscale"},[i.feColorMatrix({values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,1,0"})]),r({_gfxName:"showRed"},[i.feComponentTransfer([i.feFuncG({type:"table",tableValues:"0,0"}),i.feFuncB({type:"table",tableValues:"0,0"})])]),r({_gfxName:"showGreen"},[i.feComponentTransfer([i.feFuncR({type:"table",tableValues:"0,0"}),i.feFuncB({type:"table",tableValues:"0,0"})])]),r({_gfxName:"showBlue"},[i.feComponentTransfer([i.feFuncR({type:"table",tableValues:"0,0"}),i.feFuncG({type:"table",tableValues:"0,0"})])]),r({_gfxName:"hueRotate60"},[i.feColorMatrix({type:"hueRotate",values:60})]),r({_gfxName:"hueRotate120"},[i.feColorMatrix({type:"hueRotate",values:120})]),r({_gfxName:"hueRotate180"},[i.feColorMatrix({type:"hueRotate",values:180})]),r({_gfxName:"hueRotate270"},[i.feColorMatrix({type:"hueRotate",values:270})])];t.forEach(u.colors,function(t){n.mixin(t,s)});u.miscs=[r({_gfxName:"thinEmbossDropShadow",x:"-5%",y:"-5%",width:"120%",height:"120%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:1,result:"blur"}),i.feOffset({"in":"blur",dx:6,dy:6,result:"offsetBlur"}),i.feSpecularLighting({"in":"blur",surfaceScale:8,specularConstant:1,specularExponent:12,result:"specOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",result:"litPaint",k1:0,k2:1,k3:1,k4:0}),i.feMerge("offsetBlur","litPaint")]),r({_gfxName:"embossDropShadow",x:"-5%",y:"-5%",width:"120%",height:"120%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"4",result:"blur"}),i.feOffset({"in":"blur",dx:4,dy:4,result:"offsetBlur"}),i.feSpecularLighting({"in":"blur",surfaceScale:5,specularConstant:.75,specularExponent:20,"lighting-color":"#bbbbbb",result:"specOut"},[i.fePointLight({x:-5e3,y:-1e4,z:2e4})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0,result:"litPaint"}),i.feMerge("offsetBlur","litPaint")]),r({_gfxName:"largeEmbossDropShadow",x:"-20%",y:"-20%",width:"140%",height:"140%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:5,result:"blur"}),i.feOffset({"in":"blur",dx:6,dy:6,result:"offsetBlur"}),i.feSpecularLighting({"in":"blur",surfaceScale:8,specularConstant:1,specularExponent:12,result:"spec"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"spec",in2:"SourceGraphic",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",result:"litPaint",k1:0,k2:1,k3:1,k4:0}),i.feMerge("offsetBlur","litPaint")]),r({_gfxName:"thinEmbossDropShadowLight",x:"-5%",y:"-5%",width:"120%",height:"120%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:1,result:"blur"}),i.feComponentTransfer({"in":"blur",result:"lessblur"},[i.feFuncA({type:"linear",slope:"0.5"})]),i.feOffset({"in":"lessblur",dx:"6",dy:"6",result:"offsetBlur"}),i.feSpecularLighting({"in":"lessblur",surfaceScale:8,specularConstant:1,specularExponent:"12",result:"specOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",result:"litPaint",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0}),i.feMerge("offsetBlur","litPaint")]),r({_gfxName:"embossDropShadowLight",x:"-5%",y:"-5%",width:"120%",height:"120%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"3",result:"blur"}),i.feComponentTransfer({"in":"blur",result:"lessblur"},[i.feFuncA({type:"linear",slope:"0.5"})]),i.feOffset({"in":"lessblur",dx:"6",dy:"6",result:"offsetBlur"}),i.feSpecularLighting({"in":"lessblur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",result:"litPaint",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"}),i.feMerge("offsetBlur","litPaint")]),r({_gfxName:"largeEmbossDropShadowLight",x:"-20%",y:"-20%",width:"140%",height:"140%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"5",result:"blur"}),i.feComponentTransfer({"in":"blur",result:"lessblur"},[i.feFuncA({type:"linear",slope:"0.5"})]),i.feOffset({"in":"lessblur",dx:"6",dy:"6",result:"offsetBlur"}),i.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"spec"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"spec",in2:"SourceGraphic",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0",result:"litPaint"}),i.feMerge("offsetBlur","litPaint")]),r({_gfxName:"fuzzy",x:"-10%",y:"-10%",width:"120%",height:"120%"},[i.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"turb2"}),i.feDisplacementMap({"in":"SourceGraphic",in2:"turb2",result:"turb2",scale:"20",xChannelSelector:"R",yChannelSelector:"G"})]),r({_gfxName:"veryFuzzy",x:"-20%",y:"-20%",width:"140%",height:"140%"},[i.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"turb2"}),i.feDisplacementMap({"in":"SourceGraphic",in2:"turb2",result:"turb2",scale:"35",xChannelSelector:"R",yChannelSelector:"G"})]),r({_gfxName:"melting",x:"-10%",y:"-10%",width:"120%",height:"120%"},[i.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"2",result:"turb"}),i.feDisplacementMap({result:"bended","in":"SourceGraphic",in2:"turb",scale:"25",xChannelSelector:"R",yChannelSelector:"G"}),i.feGaussianBlur({"in":"bended",stdDeviation:"1",result:"bb"}),i.feComponentTransfer({"in":"bb",result:"BendedSource"},[i.feFuncA({type:"linear",slope:10,intercept:"-1"})]),i.feComponentTransfer({"in":"BendedSource",result:"BendedAlpha"},[i.feFuncR({type:"linear",slope:"0",intercept:"0"}),i.feFuncG({type:"linear",slope:"0",intercept:"0"}),i.feFuncB({type:"linear",slope:"0",intercept:"0"}),i.feFuncA({type:"linear",slope:"1",intercept:"0"})]),i.feGaussianBlur({"in":"BendedAlpha",stdDeviation:"1",result:"blur"}),i.feSpecularLighting({"in":"blur","lighting-color":"rgb(80%, 80%, 80%)",surfaceScale:"5",specularConstant:"1",specularExponent:"10",result:"specularOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"20000"})]),i.feComposite({"in":"specularOut",in2:"BendedAlpha",operator:"in",result:"specularOut"}),i.feComposite({"in":"BendedSource",in2:"specularOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0",result:"litPaint"})]),r({_gfxName:"impressionist",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feMorphology({"in":"SourceGraphic",operator:"dilate",radius:"2"})]),r({_gfxName:"holes",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"texture"}),i.feComponentTransfer({"in":"texture",result:"holes"},[i.feFuncA({type:"discrete",tableValues:"0,1"})]),i.feComposite({"in":"SourceGraphic",in2:"holes",operator:"out"})]),r({_gfxName:"holesComplement",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"texture"}),i.feComponentTransfer({"in":"texture",result:"holes"},[i.feFuncA({type:"discrete",tableValues:"1,0"})]),i.feComposite({"in":"SourceGraphic",in2:"holes",operator:"out"})])];u.reliefs=[r({_gfxName:"bumpIn",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feColorMatrix({"in":"SourceGraphic",type:"luminanceToAlpha",result:"lumalpha"}),i.feComponentTransfer({"in":"lumalpha",result:"invertedalpha"},[i.feFuncA({type:"table",tableValues:"1,0"})]),i.feDiffuseLighting({"in":"invertedalpha","lighting-color":"rgb(60%, 60%, 60%)",result:"diffuse",surfaceScale:"5"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feSpecularLighting({"in":"invertedalpha",result:"specular",surfaceScale:"5",specularExponent:"6"},[i.feDistantLight({azimuth:"135",elevation:"30"})]),i.feComposite({"in":"diffuse",in2:"specular",operator:"arithmetic",k2:"1.0",k3:"1.0"})]),r({_gfxName:"bumpOut",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feColorMatrix({"in":"SourceGraphic",type:"luminanceToAlpha",result:"lumalpha"}),i.feDiffuseLighting({"in":"lumalpha","lighting-color":"rgb(60%, 60%, 60%)",result:"diffuse",surfaceScale:"5"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feSpecularLighting({"in":"lumalpha",result:"specular",surfaceScale:"5",specularExponent:"6"},[i.feDistantLight({azimuth:"135",elevation:"30"})]),i.feComposite({"in":"diffuse",in2:"specular",operator:"arithmetic",k2:"1.0",k3:"1.0"})]),r({_gfxName:"thinEmboss",x:"-5%",y:"-5%",width:"110%",height:"110%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"1",result:"blur"}),i.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]),r({_gfxName:"emboss",x:"-5%",y:"-5%",width:"110%",height:"110%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"3",result:"blur"}),i.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]),r({_gfxName:"largeEmboss",x:"-5%",y:"-5%",width:"110%",height:"110%"},[i.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"5",result:"blur"}),i.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[i.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),i.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),i.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})])];u.textures=[r({_gfxName:"paper",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feTurbulence({type:"turbulence",baseFrequency:"0.01",numOctaves:"5",result:"texture"}),i.feDiffuseLighting({"in":"texture",result:"diffuse",surfaceScale:"-10"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feComposite({"in":"diffuse",in2:"SourceGraphic",operator:"arithmetic",k1:"1",k2:"0",k3:"0",k4:"0"})]),r({_gfxName:"swirl",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feTurbulence({type:"turbulence",baseFrequency:"0.05",numOctaves:"1",result:"texture"}),i.feDiffuseLighting({"in":"texture",result:"diffuse",surfaceScale:"-10"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feComposite({"in":"diffuse",in2:"SourceGraphic",operator:"arithmetic",k1:"1",k2:"0",k3:"0",k4:"0"})]),r({_gfxName:"swirl2",x:"0%",y:"0%",width:"100%",height:"100%"},[i.feTurbulence({type:"turbulence",baseFrequency:"0.15",numOctaves:"1",result:"texture"}),i.feDiffuseLighting({"in":"texture",result:"diffuse",surfaceScale:"-10"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feComposite({"in":"diffuse",in2:"SourceGraphic",operator:"arithmetic",k1:"1",k2:"0",k3:"0",k4:"0"})]),r({_gfxName:"gold",x:"-5%",y:"-5%",width:"115%",height:"110%"},[i.feTurbulence({baseFrequency:"0.2",numOctaves:"1",type:"turbulence",result:"turb"}),i.feComposite({"in":"SourceGraphic",in2:"turb",operator:"arithmetic",k2:"0.6",k3:"0.4",result:"turb"}),i.feComposite({"in":"turb",in2:"SourceGraphic",operator:"in",result:"bump"}),i.feDiffuseLighting({"in":"turb",surfaceScale:"6.0","lighting-color":"rgb(60%, 50%, 0%)",diffuseConstant:"1.0",result:"diffuse"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feSpecularLighting({"in":"bump",surfaceScale:"6.0",specularConstant:"1.0",specularExponent:"10.0",result:"specularOut"},[i.feDistantLight({azimuth:"135",elevation:"60"})]),i.feComposite({"in":"specularOut",in2:"SourceGraphic",operator:"in",result:"specularOut"}),i.feComposite({"in":"bump",in2:"diffuse",operator:"arithmetic",k1:"0.7",k2:"0.3",result:"litPaint"}),i.feComposite({"in":"litPaint",in2:"specularOut",operator:"arithmetic",k2:"1.0",k3:"0.7",result:"litPaint"})])];for(f in u)if(u.hasOwnProperty(f))for(i[f]={},h=u[f],o=0;o<h.length;++o)(function(){var t=h[o];i[f][t._gfxName]=function(i){return n.delegate(t,i)}})();return i})},"dojox/gfx/svgext":function(){define("dojox/gfx/svgext",["dojo/dom","dojo/_base/array","dojo/_base/window","./_base","./svg"],function(n,t,i,r,u){function f(n,i){var r=i.ownerDocument.createElementNS(u.xmlns.svg,n.tag),o;i.appendChild(r);for(o in n)o in e||r.setAttribute(o,n[o]);return n.children&&t.forEach(n.children,function(n){f(n,r)}),r}i=r.svgext={};var e={primitives:null,tag:null,children:null};return u.Shape.extend({addRenderingOption:function(n,t){return this.rawNode.setAttribute(n,t),this},setFilter:function(i){var o,s;if(!i)return this.rawNode.removeAttribute("filter"),this.filter=null,this;if(this.filter=i,i.id=i.id||r._base._getUniqueId(),o=n.byId(i.id),!o){o=this.rawNode.ownerDocument.createElementNS(u.xmlns.svg,"filter");o.setAttribute("filterUnits","userSpaceOnUse");for(s in i)s in e||o.setAttribute(s,i[s]);t.forEach(i.primitives,function(n){f(n,o)});(s=this._getParentSurface())&&s.defNode.appendChild(o)}return this.rawNode.setAttribute("filter","url(#"+i.id+")"),this},getFilter:function(){return this.filter}}),i})},"dojox/json/query":function(){define("dojox/json/query",["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(n,t,i){return t.getObject("json",!0,i),i.json._slice=function(n,t,i,r){var u=n.length,f=[];for(i=i||u,t=0>t?Math.max(0,t+u):Math.min(u,t),i=0>i?Math.max(0,i+u):Math.min(u,i);t<i;t+=r)f.push(n[t]);return f},i.json._find=function(n,t){function u(n){var f,r;t&&(!0!==t||n instanceof Array?n[t]&&i.push(n[t]):i.push(n));for(f in n)r=n[f],t?r&&"object"==typeof r&&u(r):i.push(r)}var i=[],r;if(t instanceof Array){if(1==t.length)return n[t[0]];for(r=0;r<t.length;r++)i.push(n[t[r]])}else u(n);return i},i.json._distinctFilter=function(n,t){for(var i,u=[],e={},r=0,f=n.length;r<f;++r)i=n[r],t(i,r,n)&&("object"==typeof i&&i?i.__included||(i.__included=!0,u.push(i)):e[i+typeof i]||(e[i+typeof i]=!0,u.push(i)));for(r=0,f=u.length;r<f;++r)u[r]&&delete u[r].__included;return u},i.json.query=function(n,t){function e(n,t,i,u,f,e,o,s){return r[s].match(/[\*\?]/)||"~"==o?"/^"+r[s].substring(1,r[s].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==o?"$/i":"$/")+".test("+t+")":n}var o=0,r=[],i,f,u;for(n=n.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(n){return o+="["==n?1:"]"==n?-1:0,"]"==n&&0<o?"`]":'"'==n.charAt(0)||"'"==n.charAt(0)?"`"+(r.push(n)-1):n}),i="",n.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");}),n=n.replace(/([^<>=]=)([^=])/g,"$1=$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(n){return"."==n.charAt(0)?n:"@"==n?"$obj":(n.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+n}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(n,t,r){return(t=n.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(r="",n.match(/^\./)&&(i="dojox.json._find("+i,r=",true)"),i=(t[1].match(/\=/)?"dojo.map":t[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+i,r+",function($obj){return "+t[2]+"})"):(t=n.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+t[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(n,t,i){return"var av= "+i.replace(/\$obj/,"a")+",bv= "+i.replace(/\$obj/,"b")+";if(av>bv||bv==null){return "+("/"==t?1:-1)+";}\nif(bv>av||av==null){return "+("/"==t?-1:1)+";}\n"})+"return 0;})":(t=n.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(i="dojox.json._slice("+i,","+(t[1]||0)+","+(t[2]||0)+","+(t[3]||1)+")"):n.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(i="dojox.json._find("+i,("."==n.charAt(1)?",'"+r+"'":n.match(/,/)?","+n:"")+")"):n}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,e).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(n,t,i,r,u,f,o,s){return e(n,r,u,f,o,s,i,t)}),n=i+("$"==n.charAt(0)?"":"$")+n.replace(/`([0-9]+|\])/g,function(n,t){return"]"==t?"]":r[t]}),f=eval("1&&function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj=$;return "+n+"}"),u=0;u<arguments.length-1;u++)arguments[u]=arguments[u+1];return t?f.apply(this,arguments):f}})},"dojox/main":function(){define("dojox/main",["dojo/_base/kernel"],function(n){return n.dojox})},"esri/Credential":function(){define("esri/Credential",["dojo/_base/declare","dojo/has","./kernel","./IdentityManagerBase"],function(n,t,i,r){return n=n(r.Credential,{}),t("extend-esri")&&(i.Credential=n),n})},"esri/IdentityManager":function(){define("esri/IdentityManager",["./IdentityManagerDialog","./kernel","./OAuthSignInHandler","dojo/_base/declare"],function(n,t,i,r){return n=new n,t.id=r.safeMixin(n,i),t.id})},"esri/IdentityManagerBase":function(){define("esri/IdentityManagerBase","dojo/_base/declare dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/sniff dojo/cookie dojo/io-query dojo/regexp ./kernel ./config ./lang ./ServerInfo ./urlUtils ./deferredUtils ./request ./Evented ./OAuthCredential ./arcgis/OAuthInfo".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){var tt={},it=function(n){var i=new e(n.owningSystemUrl).host,t;return n=new e(n.server).host,t=/.+\.arcgis\.com$/i,t.test(i)&&t.test(n)},rt=function(n,t){return!!(it(n)&&t&&r.some(t,function(t){return t.test(n.server)}))},nt,ut=n(k,{declaredClass:"esri.IdentityManagerBase",constructor:function(){this._portalConfig=i.getObject("esriGeowConfig");this.serverInfos=[];this.oAuthInfos=[];this.credentials=[];this._soReqs=[];this._xoReqs=[];this._portals=[];this._getOAuthHash()},defaultOAuthInfo:null,defaultTokenValidity:60,tokenValidity:null,signInPage:null,useSignInPage:!0,normalizeWebTierAuth:!1,_busy:null,_oAuthHash:null,_gwTokenUrl:"/sharing/generateToken",_agsRest:"/rest/services",_agsPortal:/\/sharing(\/|$)/i,_agsAdmin:/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i,_adminSvcs:/\/admin\/services(\/|$)/i,_agolSuffix:".arcgis.com",_gwDomains:[{regex:/https?:\/\/www\.arcgis\.com/i,tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/dev\.arcgis\.com/i,tokenServiceUrl:"https://dev.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*dev[^.]*\.arcgis\.com/i,tokenServiceUrl:"https://devext.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*qa[^.]*\.arcgis\.com/i,tokenServiceUrl:"https://qaext.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*.arcgis\.com/i,tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"}],_legacyFed:[],_regexSDirUrl:/http.+\/rest\/services\/?/ig,_regexServerType:/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|GeoenrichmentServer|VectorTileServer)).*/ig,_gwUser:/http.+\/users\/([^\/]+)\/?.*/i,_gwItem:/http.+\/items\/([^\/]+)\/?.*/i,_gwGroup:/http.+\/groups\/([^\/]+)\/?.*/i,_errorCodes:[499,498,403,401],_rePortalTokenSvc:/\/sharing(\/rest)?\/generatetoken/i,_publicUrls:[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],_createDefaultOAuthInfo:!0,_hasTestedIfAppIsOnPortal:!1,registerServers:function(n){var t=this.serverInfos;t?(n=r.filter(n,function(n){return!this.findServerInfo(n.server)},this),this.serverInfos=t.concat(n)):this.serverInfos=n;r.forEach(n,function(n){if(n.owningSystemUrl&&this._portals.push(n.owningSystemUrl),n.hasPortal){this._portals.push(n.server);var t=a.defaults.io.corsEnabledServers,i=this._getOrigin(n.tokenServiceUrl);p.canUseXhr(n.server)||t.push(n.server.replace(/^https?:\/\//i,""));p.canUseXhr(i)||t.push(i.replace(/^https?:\/\//i,""))}},this)},registerOAuthInfos:function(n){var t=this.oAuthInfos;t?(n=r.filter(n,function(n){return!this.findOAuthInfo(n.portalUrl)},this),this.oAuthInfos=t.concat(n)):this.oAuthInfos=n},registerToken:function(n){var u=this._sanitizeUrl(n.server),t=this.findServerInfo(u),f=!0,r;t||(t=new y,t.server=this._getServerInstanceRoot(u),t.tokenServiceUrl=this._getTokenSvcUrl(u),t.hasPortal=!0,this.registerServers([t]));(r=this.findCredential(u,n.userId))?(i.mixin(r,n),f=!1):(r=new nt({userId:n.userId,server:t.server,token:n.token,expires:n.expires,ssl:n.ssl,scope:this._isServerRsrc(u)?"server":"portal"}),r.resources=[u],this.credentials.push(r));r.onTokenChange(!1);f||r.refreshServerTokens()},toJson:function(){return v.fixJson({serverInfos:r.map(this.serverInfos,function(n){return n.toJson()}),oAuthInfos:r.map(this.oAuthInfos,function(n){return n.toJson()}),credentials:r.map(this.credentials,function(n){return n.toJson()})})},initialize:function(n){var e,o,t,u;n&&(i.isString(n)&&(n=f.fromJson(n)),e=n.serverInfos,o=n.oAuthInfos,n=n.credentials,e&&(t=[],r.forEach(e,function(n){n.server&&n.tokenServiceUrl&&t.push(n.declaredClass?n:new y(n))}),t.length&&this.registerServers(t)),o&&(u=[],r.forEach(o,function(n){n.appId&&u.push(n.declaredClass?n:new g(n))}),u.length&&this.registerOAuthInfos(u)),n&&r.forEach(n,function(n){n.userId&&n.server&&n.token&&n.expires&&n.expires>(new Date).getTime()&&(n=n.declaredClass?n:new nt(n),n.onTokenChange(),this.credentials.push(n))},this))},findServerInfo:function(n){var t;return n=this._sanitizeUrl(n),r.some(this.serverInfos,function(i){return this._hasSameServerInstance(i.server,n)&&(t=i),!!t},this),t},findOAuthInfo:function(n){var t;return n=this._sanitizeUrl(n),r.some(this.oAuthInfos,function(i){return this._hasSameServerInstance(i.portalUrl,n)&&(t=i),!!t},this),t},findCredential:function(n,t){var i,u;return n=this._sanitizeUrl(n),u=this._isServerRsrc(n)?"server":"portal",t?r.some(this.credentials,function(r){return this._hasSameServerInstance(r.server,n)&&t===r.userId&&r.scope===u&&(i=r),!!i},this):r.some(this.credentials,function(t){return this._hasSameServerInstance(t.server,n)&&-1!==this._getIdenticalSvcIdx(n,t)&&t.scope===u&&(i=t),!!i},this),i},getCredential:function(n,r){var h,f,e=!0;v.isDefined(r)&&(i.isObject(r)?(h=!!r.token,f=r.error,e=!1!==r.prompt):h=r);n=this._sanitizeUrl(n);var c=new u(w._dfdCanceller),l=this._isAdminResource(n),o=h&&this._doPortalSignIn(n)?this._getEsriAuthCookie():null;if((h=h?this.findCredential(n):null)&&f&&498===f.code)h.destroy(),o&&o.token===r.token&&s("esri_auth",null,{expires:-1,path:"/",domain:document.domain});else if(o||h)return e=Error("You are currently signed in as: '"+(o&&o.email||h&&h.userId)+"'. You do not have access to this resource: "+n),e.code="IdentityManagerBase.1",e.httpCode=f&&f.httpCode,e.messageCode=f?f.messageCode:null,e.subcode=f?f.subcode:null,e.details=f?f.details:null,e.log=!!t.isDebug,c.errback(e),c;if(f=this._findCredential(n,r))return c.callback(f),c;if(f=this.findServerInfo(n),f)!f.hasServer&&this._isServerRsrc(n)&&(f._restInfoDfd=this._getTokenSvcUrl(n,!0),f.hasServer=!0);else{if(o=this._getTokenSvcUrl(n),!o)return e=Error("Unknown resource - could not find token service endpoint."),e.code="IdentityManagerBase.2",e.log=!!t.isDebug,c.errback(e),c;f=new y;f.server=this._getServerInstanceRoot(n);i.isString(o)?(f.tokenServiceUrl=o,f.hasPortal=!0):(f._restInfoDfd=o,f.hasServer=!0);this.registerServers([f])}return e&&f.hasPortal&&void 0===f._selfReq&&!this._findOAuthInfo(n)&&(f._selfReq={owningTenant:r&&r.owningTenant,selfDfd:this._getPortalSelf(f.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),n)}),this._enqueue(n,f,r,c,l)},getResourceName:function(n){return this._isRESTService(n)?n.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(n)&&n.replace(this._gwUser,"$1")||this._gwItem.test(n)&&n.replace(this._gwItem,"$1")||this._gwGroup.test(n)&&n.replace(this._gwGroup,"$1")||""},generateToken:function(n,r,u){var o,w,k,f,c,d,s=this._rePortalTokenSvc.test(n.tokenServiceUrl),a=new e(window.location.href.toLowerCase()),g=this._getEsriAuthCookie(),v,y=!r,h;return f=n.shortLivedTokenValidity,r&&(h=l.id.tokenValidity||f||l.id.defaultTokenValidity,h>f&&(h=f)),u&&(o=u.isAdmin,w=u.serverUrl,k=u.token,d=u.ssl,n.customParameters=u.customParameters),o?f=n.adminTokenServiceUrl:(f=n.tokenServiceUrl,c=new e(f.toLowerCase()),g&&(v=(v=g.auth_tier)&&v.toLowerCase()),("web"===v||n.webTierAuth)&&u&&u.serverUrl&&!d&&"http"===a.scheme&&(p.hasSameOrigin(a.uri,f,!0)||"https"===c.scheme&&a.host===c.host&&"7080"===a.port&&"7443"===c.port)&&(f=f.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),y&&s&&(f=f.replace(/\/rest/i,""))),o=i.mixin({url:f,content:i.mixin({request:"getToken",username:r&&r.username,password:r&&r.password,serverUrl:w,token:k,expiration:h,referer:o||s?window.location.host:null,client:o?"referer":null,f:"json"},n.customParameters),handleAs:"json",callbackParamName:y?"callback":void 0},u&&u.ioArgs),u={usePost:!y,disableIdentityLookup:!0,useProxy:this._useProxy(n,u)},s||(o.withCredentials=!1),s=b(o,u),s.addCallback(function(i){if(!i||!i.token)return i=Error("Unable to generate token"),i.code="IdentityManagerBase.3",i.log=!!t.isDebug,i;var u=n.server;return tt[u]||(tt[u]={}),r&&(tt[u][r.username]=r.password),i.validity=h,i}),s.addErrback(function(){}),s},isBusy:function(){return!!this._busy},checkSignInStatus:function(n){var i=new u;return this.getCredential(n,{prompt:!1}).then(function(n){return n.token?b({url:n.server+("portal"===n.scope?"/sharing/rest":"/rest/services"),content:{f:"json",token:n.token},callbackParamName:"callback"},{disableIdentityLookup:!0}).then(function(){return n}).otherwise(function(i){if(498===i.code)throw n.destroy(),i=Error("User is not signed in."),i.code="IdentityManagerBase.6",i.log=!!t.isDebug,i;return n}):n}).then(function(n){i.resolve(n)}).otherwise(function(n){i.reject(n)}),i},setRedirectionHandler:function(n){this._redirectFunc=n},setProtocolErrorHandler:function(n){this._protocolFunc=n},signIn:function(){},oAuthSignIn:function(){},onCredentialCreate:function(){},onCredentialsDestroy:function(){},destroyCredentials:function(){if(this.credentials){var n=this.credentials.slice();r.forEach(n,function(n){n.destroy()})}this.onCredentialsDestroy()},_getOAuthHash:function(){var n=window.location.hash,t;n&&("#"===n.charAt(0)&&(n=n.substring(1)),n=h.queryToObject(n),t=!1,n.access_token&&n.expires_in&&n.state&&n.hasOwnProperty("username")?(n.state=f.fromJson(n.state),this._oAuthHash=n,t=!0):n.error&&n.error_description&&(console.log("IdentityManager OAuth Error: ",n.error," - ",n.error_description),"access_denied"===n.error&&(t=!0)),t&&(!o("ie")||8<o("ie"))&&(window.location.hash=""))},_findCredential:function(n,t){var f=-1,i,s,e,h,l=t&&t.token,a,o,u,c;if(i=t&&t.resource,a=this._isServerRsrc(n)?"server":"portal",o=r.filter(this.credentials,function(t){return this._hasSameServerInstance(t.server,n)&&t.scope===a},this),n=i||n,o.length)if(1===o.length)if(i=o[0],e=(s=(h=this.findServerInfo(i.server))&&h.owningSystemUrl)&&this.findCredential(s,i.userId),f=this._getIdenticalSvcIdx(n,i),l)-1!==f&&(i.resources.splice(f,1),this._removeResource(n,e));else return-1===f&&i.resources.push(n),this._addResource(n,e),i;else if(r.some(o,function(t){return c=this._getIdenticalSvcIdx(n,t),-1!==c?(u=t,e=(s=(h=this.findServerInfo(u.server))&&h.owningSystemUrl)&&this.findCredential(s,u.userId),f=c,!0):!1},this),l)u&&(u.resources.splice(f,1),this._removeResource(n,e));else if(u)return this._addResource(n,e),u},_findOAuthInfo:function(n){var t=this.findOAuthInfo(n);return t||r.some(this.oAuthInfos,function(i){return this._isIdProvider(i.portalUrl,n)&&(t=i),!!t},this),t},_addResource:function(n,t){t&&-1===this._getIdenticalSvcIdx(n,t)&&t.resources.push(n)},_removeResource:function(n,t){var i=-1;t&&(i=this._getIdenticalSvcIdx(n,t),-1<i&&t.resources.splice(i,1))},_useProxy:function(n,t){return t&&t.isAdmin&&!p.hasSameOrigin(n.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(n.tokenServiceUrl)&&10.1==n.currentVersion&&!p.hasSameOrigin(n.tokenServiceUrl,window.location.href)},_getOrigin:function(n){return n=new e(n),n.scheme+"://"+n.host+(v.isDefined(n.port)?":"+n.port:"")},_getServerInstanceRoot:function(n){var i=n.toLowerCase(),t=i.indexOf(this._agsRest);return-1===t&&this._isAdminResource(n)&&(t=i.indexOf("/admin")),-1===t&&(t=i.indexOf("/sharing")),-1===t&&"/"===i.substr(-1)&&(t=i.length-1),-1<t?n.substring(0,t):n},_hasSameServerInstance:function(n,t){return"/"===n.substr(-1)&&(n=n.slice(0,-1)),n=n.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),n=n.substr(n.indexOf(":")),t=t.substr(t.indexOf(":")),n===t},_sanitizeUrl:function(n){n=p.fixUrl(i.trim(n));var t=(a.defaults.io.proxyUrl||"").toLowerCase(),r=t?n.toLowerCase().indexOf(t+"?"):-1;return-1!==r&&(n=n.substring(r+t.length+1)),p.urlToObject(n).path},_isRESTService:function(n){return-1<n.indexOf(this._agsRest)},_isAdminResource:function(n){return this._agsAdmin.test(n)||this._adminSvcs.test(n)},_isServerRsrc:function(n){return this._isRESTService(n)||this._isAdminResource(n)},_isIdenticalService:function(n,t){var i,r,u;return this._isRESTService(n)&&this._isRESTService(t)?(r=this._getSuffix(n).toLowerCase(),u=this._getSuffix(t).toLowerCase(),i=r===u,i||(i=/(.*)\/(MapServer|FeatureServer).*/ig,i=r.replace(i,"$1")===u.replace(i,"$1"))):this._isAdminResource(n)&&this._isAdminResource(t)?i=!0:this._isServerRsrc(n)||this._isServerRsrc(t)||!this._isPortalDomain(n)||(i=!0),i},_isPortalDomain:function(n){n=n.toLowerCase();var f=new e(n).authority,u=this._portalConfig,t=-1!==f.indexOf(this._agolSuffix);return!t&&u&&(t=this._hasSameServerInstance(this._getServerInstanceRoot(u.restBaseUrl),n)),t||(!this._arcgisUrl&&(u=i.getObject("esri.arcgis.utils.arcgisUrl"))&&(this._arcgisUrl=new e(u).authority),this._arcgisUrl&&(t=this._arcgisUrl.toLowerCase()===f)),t||(t=r.some(this._portals,function(t){return this._hasSameServerInstance(t,n)},this)),t||this._agsPortal.test(n)},_isIdProvider:function(n,t){var u=-1,i=-1,f,e,o;return r.forEach(this._gwDomains,function(r,f){-1===u&&r.regex.test(n)&&(u=f);-1===i&&r.regex.test(t)&&(i=f)}),f=!1,-1<u&&-1<i&&(0===u||4===u?(0===i||4===i)&&(f=!0):1===u?(1===i||2===i)&&(f=!0):2===u?2===i&&(f=!0):3===u&&3===i&&(f=!0)),f||(e=this.findServerInfo(t),o=e&&e.owningSystemUrl,o&&it(e)&&this._isPortalDomain(o)&&this._isIdProvider(n,o)&&(f=!0)),f},_isPublic:function(n){return n=this._sanitizeUrl(n),r.some(this._publicUrls,function(t){return t.test(n)})},_getIdenticalSvcIdx:function(n,t){var i=-1;return r.some(t.resources,function(t,r){return this._isIdenticalService(n,t)?(i=r,!0):!1},this),i},_getSuffix:function(n){return n.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")},_getTokenSvcUrl:function(n){var u,i,t;return(u=this._isRESTService(n))||this._isAdminResource(n)?(i=n.toLowerCase().indexOf(u?this._agsRest:"/admin/"),u=n.substring(0,i)+"/admin/generateToken",n=n.substring(0,i)+"/rest/info",i=b({url:n,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),i.adminUrl_=u,i):this._isPortalDomain(n)?(t="",r.some(this._gwDomains,function(i){return i.regex.test(n)&&(t=i.tokenServiceUrl),!!t}),t||r.some(this._portals,function(i){return this._hasSameServerInstance(i,n)&&(t=i+this._gwTokenUrl),!!t},this),t||(i=n.toLowerCase().indexOf("/sharing"),-1!==i&&(t=n.substring(0,i)+this._gwTokenUrl)),t||(t=this._getOrigin(n)+this._gwTokenUrl),t&&(u=new e(n).port,/^http:\/\//i.test(n)&&"7080"===u&&(t=t.replace(/:7080/i,":7443")),t=t.replace(/http:/i,"https:")),t):-1!==n.toLowerCase().indexOf("premium.arcgisonline.com")?"https://premium.arcgisonline.com/server/tokens":void 0},_getPortalSelf:function(n,t){return"https:"===window.location.protocol?n=n.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(t)&&(n=n.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),b({url:n,content:{f:"json"},handleAs:"json",callbackParamName:"callback"},{crossOrigin:!1,disableIdentityLookup:!0})},_hasPortalSession:function(){return!!this._getEsriAuthCookie()},_getEsriAuthCookie:function(){var r,t,n,i;if(s.isSupported())for(t=this._getAllCookies("esri_auth"),n=0;n<t.length;n++)if(i=f.fromJson(t[n]),i.portalApp){r=i;break}return r},_getAllCookies:function(n){var u=[],i=document.cookie.match(new RegExp("(?:^|; )"+c.escapeString(n)+"=([^;]*)","g")),t,r;if(i)for(n=0;n<i.length;n++)t=i[n],r=t.indexOf("="),-1<r&&(t=t.substring(r+1),u.push(decodeURIComponent(t)));return u},_doPortalSignIn:function(n){if(s.isSupported()){var u=this._getEsriAuthCookie(),t=this._portalConfig,r=window.location.href,i=this.findServerInfo(n);if(this.useSignInPage&&(t||this._isPortalDomain(r)||u)&&(i?i.hasPortal||i.owningSystemUrl&&this._isPortalDomain(i.owningSystemUrl):this._isPortalDomain(n))&&(this._isIdProvider(r,n)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),n)||this._isIdProvider(t.restBaseUrl,n))||p.hasSameOrigin(r,n,!0)))return!0}return!1},_checkProtocol:function(n,r,u,f){var e=!0;return f=f?r.adminTokenServiceUrl:r.tokenServiceUrl,0!==i.trim(f).toLowerCase().indexOf("https:")||0===window.location.href.toLowerCase().indexOf("https:")||a.defaults.io.useCors&&(p.canUseXhr(f)||p.canUseXhr(p.getProxyUrl(!0).path))||(e=this._protocolFunc?!!this._protocolFunc({resourceUrl:n,serverInfo:r}):!1,e||(n=Error("Aborted the Sign-In process to avoid sending password over insecure connection."),n.code="IdentityManagerBase.4",n.log=!!t.isDebug,console.log(n.message),u(n))),e},_enqueue:function(n,t,i,r,f,e){return r||(r=new u(w._dfdCanceller)),r.resUrl_=n,r.sinfo_=t,r.options_=i,r.admin_=f,r.refresh_=e,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(n),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(r)):this._xoReqs.push(r):this._doSignIn(r),r},_doSignIn:function(n){this._busy=n;var u=this,e=function(t){var f=n.options_&&n.options_.resource,e=n.resUrl_,i=n.refresh_,s=!1,o;if(-1===r.indexOf(u.credentials,t)&&(i&&-1!==r.indexOf(u.credentials,i)?(i.userId=t.userId,i.token=t.token,i.expires=t.expires,i.validity=t.validity,i.ssl=t.ssl,i.creationTime=t.creationTime,s=!0,t=i):u.credentials.push(t)),t.resources||(t.resources=[]),t.resources.push(f||e),t.scope=u._isServerRsrc(e)?"server":"portal",t.onTokenChange(),f=u._soReqs,o={},u._soReqs=[],r.forEach(f,function(n){if(!this._isIdenticalService(e,n.resUrl_)){var i=this._getSuffix(n.resUrl_);o[i]||(o[i]=!0,t.resources.push(n.resUrl_))}},u),n.callback(t),r.forEach(f,function(n){this._hasSameServerInstance(this._getServerInstanceRoot(e),n.resUrl_)?n.callback(t):this._soReqs.push(n)},u),u._busy=n.resUrl_=n.sinfo_=n.refresh_=null,!s)u.onCredentialCreate({credential:t});u._soReqs.length?u._doSignIn(u._soReqs.shift()):u._xoReqs.length&&u._doSignIn(u._xoReqs.shift())},f=function(t){n.errback(t);u._busy=n.resUrl_=n.sinfo_=n.refresh_=null;u._soReqs.length?u._doSignIn(u._soReqs.shift()):u._xoReqs.length&&u._doSignIn(u._xoReqs.shift())},o=function(i,r,o,s){var h=n.sinfo_,c=!n.options_||!1!==n.options_.prompt,l=h.hasPortal&&u._findOAuthInfo(n.resUrl_);u._doPortalSignIn(n.resUrl_)?(i=u._getEsriAuthCookie(),l=u._portalConfig,i?e(new nt({userId:i.email,server:h.server,token:i.token,expires:null})):c?(c="",i=window.location.href,c=u.signInPage?u.signInPage:l?l.baseUrl+l.signin:u._isIdProvider(i,n.resUrl_)?u._getOrigin(i)+"/home/signin.html":h.tokenServiceUrl.replace(u._rePortalTokenSvc,"")+"/home/signin.html",c=c.replace(/http:/i,"https:"),l&&!1===l.useSSL&&(c=c.replace(/https:/i,"http:")),0===i.toLowerCase().replace("https","http").indexOf(c.toLowerCase().replace("https","http"))?(h=Error("Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: "+n.resUrl_),h.code="IdentityManagerBase.5",h.log=!!t.isDebug,f(h)):u._redirectFunc?u._redirectFunc({signInPage:c,returnUrlParamName:"returnUrl",returnUrl:i,resourceUrl:n.resUrl_,serverInfo:h}):window.location=c+"?returnUrl="+window.escape(i)):(h=Error("User is not signed in."),h.code="IdentityManagerBase.6",h.log=!!t.isDebug,f(h))):i?e(new nt({userId:i,server:h.server,token:o,expires:v.isDefined(s)?Number(s):null,ssl:!!r})):l?(i=l._oAuthCred,i||(r=new d(l,window.localStorage),o=new d(l,window.sessionStorage),r.isValid()&&o.isValid()?r.expires>o.expires?(i=r,o.destroy()):(i=o,r.destroy()):i=r.isValid()?r:o,l._oAuthCred=i),i.isValid()?e(new nt({userId:i.userId,server:h.server,token:i.token,expires:i.expires,ssl:i.ssl,_oAuthCred:i})):u._oAuthHash&&u._oAuthHash.state.portalUrl===l.portalUrl?(c=u._oAuthHash,h=new nt({userId:c.username,server:h.server,token:c.access_token,expires:(new Date).getTime()+1e3*Number(c.expires_in),ssl:"true"===c.ssl,oAuthState:c.state,_oAuthCred:i}),i.storage=c.persist?window.localStorage:window.sessionStorage,i.token=h.token,i.expires=h.expires,i.userId=h.userId,i.ssl=h.ssl,i.save(),u._oAuthHash=null,e(h)):c?n._pendingDfd=u.oAuthSignIn(n.resUrl_,h,l,n.options_).addCallbacks(e,f):(h=Error("User is not signed in."),h.code="IdentityManagerBase.6",h.log=!!t.isDebug,f(h))):c?u._checkProtocol(n.resUrl_,h,f,n.admin_)&&(c=n.options_,n.admin_&&(c=c||{},c.isAdmin=!0),n._pendingDfd=u.signIn(n.resUrl_,h,c).addCallbacks(e,f)):(h=Error("User is not signed in."),h.code="IdentityManagerBase.6",h.log=!!t.isDebug,f(h))},s=function(){var o=n.sinfo_,h=o.owningSystemUrl,i=n.options_,s,c,l,t;i&&(s=i.token,c=i.error,l=i.prompt);t=u._findCredential(h,{token:s,resource:n.resUrl_});!t&&it(o)&&r.some(u.credentials,function(n){return this._isIdProvider(h,n.server)&&(t=n),!!t},u);t?(i=u.findCredential(n.resUrl_,t.userId))?e(i):rt(o,u._legacyFed)?(i=t.toJson(),i.server=o.server,i.resources=null,e(new nt(i))):(n._pendingDfd=u.generateToken(u.findServerInfo(t.server),null,{serverUrl:n.resUrl_,token:t.token,ssl:t.ssl})).addCallbacks(function(i){e(new nt({userId:t.userId,server:o.server,token:i.token,expires:v.isDefined(i.expires)?Number(i.expires):null,ssl:!!i.ssl,isAdmin:n.admin_,validity:i.validity}))},f):(u._busy=null,s&&(n.options_.token=null),(n._pendingDfd=u.getCredential(h.replace(/\/?$/,"/sharing"),{resource:n.resUrl_,owningTenant:o.owningTenant,token:s,error:c,prompt:l})).addCallbacks(function(){u._enqueue(n.resUrl_,n.sinfo_,n.options_,n,n.admin_)},function(n){f(n)}))},l=n.sinfo_.owningSystemUrl,h=this._isServerRsrc(n.resUrl_),c=n.sinfo_._restInfoDfd;c?c.addCallbacks(function(t){var r=n.sinfo_;r.adminTokenServiceUrl=r._restInfoDfd.adminUrl_;r._restInfoDfd=null;r.tokenServiceUrl=i.getObject("authInfo.tokenServicesUrl",!1,t)||i.getObject("authInfo.tokenServiceUrl",!1,t)||i.getObject("tokenServiceUrl",!1,t);r.shortLivedTokenValidity=i.getObject("authInfo.shortLivedTokenValidity",!1,t);r.currentVersion=t.currentVersion;r.owningTenant=t.owningTenant;(t=r.owningSystemUrl=t.owningSystemUrl)&&u._portals.push(t);h&&t?s():o()},function(){n.sinfo_._restInfoDfd=null;var i=Error("Unknown resource - could not find token service endpoint.");i.code="IdentityManagerBase.2";i.log=!!t.isDebug;f(i)}):h&&l?s():n.sinfo_._selfReq?n.sinfo_._selfReq.selfDfd.then(function(t){var i={},r,f,e,o;return t&&(r=t.user&&t.user.username,i.username=r,i.allSSL=t.allSSL,f=t.supportsOAuth,e=t.currentVersion,"multitenant"===t.portalMode&&(o=t.customBaseUrl)),n.sinfo_.webTierAuth=!!r,r&&u.normalizeWebTierAuth?u.generateToken(n.sinfo_,null,{ssl:i.allSSL}).always(function(n){return i.portalToken=n&&n.token,i.tokenExpiration=n&&n.expires,i}):!r&&f&&4.4<=parseFloat(e)&&!u._doPortalSignIn(n.resUrl_)?u._generateOAuthInfo({portalUrl:n.sinfo_.server,customBaseUrl:o,owningTenant:n.sinfo_._selfReq.owningTenant}).always(function(){return i}):i}).always(function(t){n.sinfo_._selfReq=null;t?o(t.username,t.allSSL,t.portalToken,t.tokenExpiration):o()}):o()},_generateOAuthInfo:function(n){var i=this,t,f=n.portalUrl,e=n.customBaseUrl,o=n.owningTenant,r;return(n=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal)&&(t=window.location.href,r=t.indexOf("?"),-1<r&&(t=t.slice(0,r)),r=t.search(/\/(apps|home)\//),t=-1<r?t.slice(0,r):null),n&&t?(this._hasTestedIfAppIsOnPortal=!0,n=b({url:t+"/sharing/rest",content:{f:"json"},handleAs:"json"}).then(function(){i.defaultOAuthInfo=new g({appId:"arcgisonline",popup:!0,popupCallbackUrl:t+"/home/oauth-callback.html"})})):(n=new u,n.resolve(),n=n.promise),n.then(function(){if(i.defaultOAuthInfo)return f=f.replace(/^http:/i,"https:"),b({url:f+"/sharing/rest/oauth2/validateRedirectUri",content:{accountId:o,client_id:i.defaultOAuthInfo.appId,redirect_uri:p.getAbsoluteUrl(i.defaultOAuthInfo.popupCallbackUrl),f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(n){if(n.valid){var t=i.defaultOAuthInfo.clone();t.portalUrl=n.urlKey&&e?"https://"+n.urlKey+"."+e:f;i.oAuthInfos.push(t)}})})}});return nt=n(k,{declaredClass:"esri.Credential",tokenRefreshBuffer:2,constructor:function(n){i.mixin(this,n);this.resources=this.resources||[];v.isDefined(this.creationTime)||(this.creationTime=(new Date).getTime())},_oAuthCred:null,refreshToken:function(){var n=this,e=this.resources&&this.resources[0],u=l.id.findServerInfo(this.server),h=u&&u.owningSystemUrl,i=!!h&&"server"===this.scope,p=i&&rt(u,l.id._legacyFed),f=i&&l.id.findServerInfo(h),t,a=(t=u.webTierAuth)&&l.id.normalizeWebTierAuth,o=tt[this.server],o=o&&o[this.userId],y={username:this.userId,password:o},s,c;if((!t||a)&&(i&&!f&&r.some(l.id.serverInfos,function(n){return l.id._isIdProvider(h,n.server)&&(f=n),!!f}),t=f&&l.id.findCredential(f.server,this.userId),!i||t))if(p)t.refreshToken();else{if(i)s={serverUrl:e,token:t&&t.token,ssl:t&&t.ssl};else if(a)y=null,s={ssl:this.ssl};else if(o)this.isAdmin&&(s={isAdmin:!0});else return e&&(e=l.id._sanitizeUrl(e),this._enqueued=1,c=l.id._enqueue(e,u,null,null,this.isAdmin,this),c.addCallback(function(){n._enqueued=0;n.refreshServerTokens()}).addErrback(function(){n._enqueued=0})),c;return l.id.generateToken(i?f:u,i?null:y,s).addCallback(function(t){n.token=t.token;n.expires=v.isDefined(t.expires)?Number(t.expires):null;n.creationTime=(new Date).getTime();n.validity=t.validity;n.onTokenChange();n.refreshServerTokens()}).addErrback(function(){})}},refreshServerTokens:function(){"portal"===this.scope&&r.forEach(l.id.credentials,function(n){var t=l.id.findServerInfo(n.server),i=t&&t.owningSystemUrl;n!==this&&n.userId===this.userId&&i&&"server"===n.scope&&(l.id._hasSameServerInstance(this.server,i)||l.id._isIdProvider(i,this.server))&&(rt(t,l.id._legacyFed)?(n.token=this.token,n.expires=this.expires,n.creationTime=this.creationTime,n.validity=this.validity,n.onTokenChange()):n.refreshToken())},this)},onTokenChange:function(n){clearTimeout(this._refreshTimer);var t=this.server&&l.id.findServerInfo(this.server),i=(t=t&&t.owningSystemUrl)&&l.id.findServerInfo(t);!1!==n&&(!t||"portal"===this.scope||i&&i.webTierAuth&&!l.id.normalizeWebTierAuth)&&(v.isDefined(this.expires)||v.isDefined(this.validity))&&this._startRefreshTimer()},onDestroy:function(){},destroy:function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var n=r.indexOf(l.id.credentials,this);-1<n&&l.id.credentials.splice(n,1);this.onTokenChange();this.onDestroy()},toJson:function(){return this._toJson()},_toJson:function(){var t=v.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),n=this.resources;return n&&0<n.length&&(t.resources=n.slice()),t},_startRefreshTimer:function(){clearTimeout(this._refreshTimer);var t=6e4*this.tokenRefreshBuffer,n=(this.validity?this.creationTime+6e4*this.validity:this.expires)-(new Date).getTime();0>n&&(n=0);this._refreshTimer=setTimeout(i.hitch(this,this.refreshToken),n>t?n-t:n)}}),ut.Credential=nt,o("extend-esri")&&(l.IdentityManagerBase=ut),ut})},"esri/IdentityManagerDialog":function(){define("esri/IdentityManagerDialog","dojo/_base/kernel dojo/_base/declare dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/has dojo/dom-attr dojo/keys dijit/registry dijit/Dialog ./kernel ./lang ./domUtils ./Credential ./IdentityManagerBase dojo/i18n!./nls/jsapi dojo/query dijit/form/Button dijit/form/Form dijit/form/ValidationTextBox".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return t=t([y],{declaredClass:"esri.IdentityManager",_eventMap:{"dialog-cancel":["info"]},constructor:function(n){u.mixin(this,n);this.registerConnectEvents()},_dialogContent:"<div data-dojo-type='dijit.form.Form' data-dojo-props='\"class\":\"esriIdForm\"'><div class='dijitDialogPaneContentArea'><div style='padding-bottom: 5px; word-wrap: break-word;'>${info}<\/div><div style='margin: 0px; padding: 0px; height: 10px;'><\/div><div class='esriErrorMsg' style='display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'>${invalidUser}<\/div><div style='margin: 0px; padding: 0px; height: 10px;'><\/div><table style='width: 100%;'><tr><td><label>${lblUser}<\/label><br/><input data-dojo-type='dijit.form.ValidationTextBox' data-dojo-props='type:\"text\", \"class\":\"esriIdUser\", required:true, trim:true, style:\"width: 100%;\", autocapitalize:\"none\", autocorrect:\"off\", spellcheck:false' /><\/td><\/tr><tr><td><label>${lblPwd}<\/label><br/><input data-dojo-type='dijit.form.ValidationTextBox' data-dojo-props='type:\"password\", \"class\":\"esriIdPwd\", required:true, style:\"width: 100%;\"' /><\/td><\/tr><\/table><\/div><div class='dijitDialogPaneActionBar'><button data-dojo-type='dijit.form.Button' data-dojo-props='type:\"button\", \"class\":\"esriIdSubmit\"'>${lblOk}<\/button><button data-dojo-type='dijit.form.Button' data-dojo-props='type:\"button\", \"class\":\"esriIdCancel\"'>${lblCancel}<\/button><\/div><\/div>",onDialogCreate:function(){},onDialogCancel:function(){},signIn:function(n,t,u){this._nls||(this._nls=p.identity);this._loginDialog||(this._loginDialog=this.dialog=this._createLoginDialog(),this.onDialogCreate());var f=this._loginDialog,s=u&&u.error,h=u&&u.token,o=new r(function(){f.onCancel()});return f.open?(n=Error("BUSY"),n.code="IdentityManager.1",n.log=!!i.isDebug,o.errback(n),o):(a.hide(f.errMsg_),s&&403==s.code&&h&&(e.set(f.errMsg_,"innerHTML",this._nls.forbidden),a.show(f.errMsg_)),f.dfd_=o,f.serverInfo_=t,f.resUrl_=n,f.admin_=u&&u.isAdmin,e.set(f.resLink_,{title:n,innerHTML:"("+(this.getResourceName(n)||this._nls.lblItem)+")"}),e.set(f.serverLink_,{title:t.server,innerHTML:(-1!==t.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":t.server)+" "}),f.txtPwd_.set("value",""),f.show(),o)},_createLoginDialog:function(){var u=this._nls,r=l.substitute(u,this._dialogContent),r=l.substitute({resource:"<span class='resLink' style='word-wrap: break-word;'><\/span>",server:"<span class='serverLink' style='word-wrap: break-word;'><\/span>"},r),t=new h({title:u.title,content:r,"class":"esriSignInDialog",style:"width: 18em;",esriIdMgr_:this,keypressed_:function(n){n.charOrCode===o.ENTER&&this.execute_()},execute_:function(){var t=this.txtUser_.get("value"),f=this.txtPwd_.get("value"),o=this.dfd_,n=this,i,r;this.form_.validate()&&t&&f&&(this.btnSubmit_.set("label",u.lblSigning),i=c.id.findCredential(n.resUrl_,t),r=function(r){var y,e,s,f,c;n.btnSubmit_.set("label",u.lblOk);n.btnSubmit_.set("disabled",!1);a.hide(n.errMsg_);n.hide();h._DialogLevelManager.hide(n);y=n.serverInfo_;n.dfd_=n.serverInfo_=n.generateDfd_=n.resUrl_=null;f=i;r&&(e=r.token,s=l.isDefined(r.expires)?Number(r.expires):null,c=!!r.ssl,f?(f.userId=t,f.token=e,f.expires=s,f.validity=r.validity,f.ssl=c,f.creationTime=(new Date).getTime()):f=new v({userId:t,server:y.server,token:e,expires:s,ssl:c,isAdmin:n.admin_,validity:r.validity}));o.callback(f)},i&&!i._enqueued?r():(n.btnSubmit_.set("disabled",!0),n.generateDfd_=c.id.generateToken(this.serverInfo_,{username:t,password:f},{isAdmin:this.admin_}).addCallback(r).addErrback(function(t){n.btnSubmit_.set("disabled",!1);n.generateDfd_=null;n.btnSubmit_.set("label",u.lblOk);e.set(n.errMsg_,"innerHTML",t&&t.code?u.invalidUser:u.noAuthService);a.show(n.errMsg_)})))},cancel_:function(){t.generateDfd_&&t.generateDfd_.cancel();var r=t.dfd_,n=t.resUrl_,u=t.serverInfo_;t.btnSubmit_.set("disabled",!1);t.dfd_=t.serverInfo_=t.generateDfd_=t.resUrl_=null;a.hide(t.errMsg_);h._DialogLevelManager.hide(t);t.esriIdMgr_.onDialogCancel({resourceUrl:n,serverInfo:u});n=Error("ABORTED");n.code="IdentityManager.2";n.log=!!i.isDebug;r.errback(n)}}),r=t.domNode;return t.form_=s.byNode(n.query(".esriIdForm",r)[0]),t.txtUser_=s.byNode(n.query(".esriIdUser",r)[0]),t.txtPwd_=s.byNode(n.query(".esriIdPwd",r)[0]),t.btnSubmit_=s.byNode(n.query(".esriIdSubmit",r)[0]),t.btnCancel_=s.byNode(n.query(".esriIdCancel",r)[0]),t.resLink_=n.query(".resLink",r)[0],t.serverLink_=n.query(".serverLink",r)[0],t.errMsg_=n.query(".esriErrorMsg",r)[0],t.connect(t.txtUser_,"onKeyPress",t.keypressed_),t.connect(t.txtPwd_,"onKeyPress",t.keypressed_),t.connect(t.btnSubmit_,"onClick",t.execute_),t.connect(t.btnCancel_,"onClick",t.onCancel),t.connect(t,"onCancel",t.cancel_),t}}),f("extend-esri")&&(c.IdentityManagerDialog=c.IdentityManager=t),t})},"esri/OAuthCredential":function(){define("esri/OAuthCredential",["./kernel","dojo/_base/declare","dojo/has","dojo/json"],function(n,t,i,r){return t=t(null,{declaredClass:"esri.OAuthCredential",oAuthInfo:null,storage:null,expires:null,ssl:null,token:null,userId:null,constructor:function(n,t){this.oAuthInfo=n;this.storage=t;this._init()},isValid:function(){var t=!1,n;return this.oAuthInfo&&this.token&&this.userId&&(n=(new Date).getTime(),this.expires>n&&(this.expires-n)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)),t},save:function(){var t,n,i;if(this.storage&&(t=this._load(),n=this.oAuthInfo,n&&n.authNamespace&&n.portalUrl)){i=t[n.authNamespace];i||(i=t[n.authNamespace]={});i[n.portalUrl]={expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",r.stringify(t))}catch(u){console.log(u)}}},destroy:function(){var i=this._load(),n=this.oAuthInfo,t;if(n&&n.authNamespace&&n.portalUrl&&this.storage&&(t=i[n.authNamespace],t)){delete t[n.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",r.stringify(i))}catch(u){console.log(u)}}n&&(this.oAuthInfo=n._oAuthCred=null)},_init:function(){var n=this._load(),t=this.oAuthInfo;t&&t.authNamespace&&t.portalUrl&&(n=n[t.authNamespace])&&(n=n[t.portalUrl])&&(this.expires=n.expires,this.ssl=n.ssl,this.token=n.token,this.userId=n.userId)},_load:function(){var t={},n;if(this.storage&&(n=this.storage.getItem("esriJSAPIOAuth"),n))try{t=r.parse(n)}catch(i){console.log(i)}return t}}),i("extend-esri")&&(n.OAuthCredential=t),t})},"esri/OAuthSignInHandler":function(){define("esri/OAuthSignInHandler","./Credential ./domUtils ./lang ./urlUtils dijit/Dialog dijit/registry dojo/_base/config dojo/_base/Deferred dojo/_base/kernel dojo/dom-attr dojo/i18n!./nls/jsapi dojo/io-query dojo/sniff dojo/json dijit/form/Button dojo/query".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){return{_oAuthDfd:null,_oAuthIntervalId:0,_oAuthDialogContent:"<div class='dijitDialogPaneContentArea'><div style='padding-bottom: 5px; word-wrap: break-word;'>${oAuthInfo}<\/div><div style='margin: 0px; padding: 0px; height: 10px;'><\/div><div class='esriErrorMsg' style='display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'>${invalidUser}<\/div><div style='margin: 0px; padding: 0px; height: 10px;'><\/div><div class='dijitDialogPaneActionBar'><button data-dojo-type='dijit.form.Button' data-dojo-props='type:\"button\", \"class\":\"esriIdSubmit\"'>${lblOk}<\/button><button data-dojo-type='dijit.form.Button' data-dojo-props='type:\"button\", \"class\":\"esriIdCancel\"'>${lblCancel}<\/button><\/div>",setOAuthRedirectionHandler:function(n){this._oAuthRedirectFunc=n},oAuthSignIn:function(n,i,r,u){var f=this._oAuthDfd=new o,e;return(f.resUrl_=n,f.sinfo_=i,f.oinfo_=r,e=!u||!1!==u.oAuthPopupConfirmation,!r.popup||!e)?(this._doOAuthSignIn(n,i,r),f):(this._nls||(this._nls=c.identity),this.oAuthDialog||(this.oAuthDialog=this._createOAuthDialog()),n=this.oAuthDialog,i=u&&u.error,u=u&&u.token,t.hide(n.errMsg_),i&&403==i.code&&u&&(h.set(n.errMsg_,"innerHTML",this._nls.forbidden),t.show(n.errMsg_)),n.show(),f)},setOAuthResponseHash:function(t){var u=this._oAuthDfd,i,r;this._oAuthDfd=null;u&&t&&((clearInterval(this._oAuthIntervalId),"#"===t.charAt(0)&&(t=t.substring(1)),t=l.queryToObject(t),t.error)?(t=Error("access_denied"===t.error?"ABORTED":"OAuth: "+t.error+" - "+t.error_description),t.code="IdentityManagerBase.2",t.log=!!e.isDebug,u.errback(t)):(i=u.oinfo_._oAuthCred,r=new n({userId:t.username,server:u.sinfo_.server,token:t.access_token,expires:(new Date).getTime()+1e3*Number(t.expires_in),ssl:"true"===t.ssl,_oAuthCred:i}),i.storage=t.persist?window.localStorage:window.sessionStorage,i.token=r.token,i.expires=r.expires,i.userId=r.userId,i.ssl=r.ssl,i.save(),u.callback(r)))},_createOAuthDialog:function(){var r=this._nls,o=i.substitute(r,this._oAuthDialogContent),n=new u({title:r.title,content:o,"class":"esriOAuthSignInDialog",style:"min-width: 18em;",esriIdMgr_:this,execute_:function(){var t=n.esriIdMgr_._oAuthDfd;n.hide_();n.esriIdMgr_._doOAuthSignIn(t.resUrl_,t.sinfo_,t.oinfo_)},cancel_:function(){var i=n.esriIdMgr_._oAuthDfd,t;n.esriIdMgr_._oAuthDfd=null;n.hide_();t=Error("ABORTED");t.code="IdentityManager.2";t.log=!!e.isDebug;i.errback(t)},hide_:function(){t.hide(n.errMsg_);n.hide();u._DialogLevelManager.hide(n)}}),r=n.domNode;return n.btnSubmit_=f.byNode(s.query(".esriIdSubmit",r)[0]),n.btnCancel_=f.byNode(s.query(".esriIdCancel",r)[0]),n.errMsg_=s.query(".esriErrorMsg",r)[0],n.connect(n.btnSubmit_,"onClick",n.execute_),n.connect(n.btnCancel_,"onClick",n.onCancel),n.connect(n,"onCancel",n.cancel_),n},_doOAuthSignIn:function(n,t,i){var h=this,o={client_id:i.appId,response_type:"token",state:v.stringify({portalUrl:i.portalUrl}),expiration:i.expiration,locale:i.locale,redirect_uri:i.popup?r.getAbsoluteUrl(i.popupCallbackUrl):window.location.href.replace(/#.*$/,"")},s,f,u;i.forceLogin&&(o.force_login=!0);s=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize";f=s+"?"+l.objectToQuery(o);i.popup?(7===a("ie")?(u=window.open(i.popupCallbackUrl,"esriJSAPIOAuth",i.popupWindowFeatures),u.location=f):u=window.open(f,"esriJSAPIOAuth",i.popupWindowFeatures),u?(u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(function(){var t,n;u.closed&&(clearInterval(h._oAuthIntervalId),t=h._oAuthDfd,t&&(n=Error("ABORTED"),n.code="IdentityManager.2",n.log=!!e.isDebug,t.errback(n)))},500)):(n=Error("ABORTED"),n.code="IdentityManager.2",n.log=!!e.isDebug,this._oAuthDfd.errback(n))):this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:o,authorizeUrl:s,resourceUrl:n,serverInfo:t,oAuthInfo:i}):window.location=f}}})},"esri/ServerInfo":function(){define("esri/ServerInfo",["dojo/_base/declare","dojo/_base/lang","dojo/has","./kernel","./lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.ServerInfo",constructor:function(n){t.mixin(this,n)},toJson:function(){return u.fixJson({server:this.server,tokenServiceUrl:this.tokenServiceUrl,adminTokenServiceUrl:this.adminTokenServiceUrl,shortLivedTokenValidity:this.shortLivedTokenValidity,owningSystemUrl:this.owningSystemUrl,owningTenant:this.owningTenant,currentVersion:this.currentVersion,hasPortal:this.hasPortal,hasServer:this.hasServer,webTierAuth:this.webTierAuth})}}),i("extend-esri")&&(r.ServerInfo=n),n})},"esri/arcgis/OAuthInfo":function(){define("esri/arcgis/OAuthInfo",["../kernel","../lang","dojo/_base/declare","dojo/_base/lang","dojo/has"],function(n,t,i,r,u){var f=i(null,{declaredClass:"esri.arcgis.OAuthInfo",constructor:function(n){r.mixin(this,{expiration:20160,minTimeUntilExpiration:30,portalUrl:"https://www.arcgis.com",authNamespace:"/",forceLogin:!1,popup:!1,popupCallbackUrl:"oauth-callback.html",popupWindowFeatures:"height=480,width=800,location,resizable,scrollbars,status"},n)},_oAuthCred:null,toJson:function(){return t.fixJson({appId:this.appId,expiration:this.expiration,locale:this.locale,minTimeUntilExpiration:this.minTimeUntilExpiration,portalUrl:this.portalUrl,authNamespace:this.authNamespace,forceLogin:this.forceLogin,popup:this.popup,popupCallbackUrl:this.popupCallbackUrl,popupWindowFeatures:this.popupWindowFeatures})},clone:function(){return new f(this.toJson())}});return u("extend-esri")&&r.setObject("arcgis.OAuthInfo",f,n),f})},"esri/arcgis/Portal":function(){define("esri/arcgis/Portal","dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){var v={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},y=function(n){function i(t){n[t]||(n[t]=function(){var i=arguments;return r.when(n,function(n){return Array.prototype.unshift.call(i,n.results||n),y(u[t].apply(u,i))})})}return n?(n.then&&(n=t.delegate(n)),n.total||(n.total=r.when(n,function(n){return s.isDefined(n.total)?n.total:n.length||0})),i("forEach"),i("filter"),i("map"),i("some"),i("every"),n):n},a={useSSL:function(n,t){var i=v&&v.self||{},r,u;return i&&!i.isPortal?-1!==n.indexOf("https:")||i.allSSL?t.replace("http:","https:"):t:(r=a.getLocation(t),-1<i.portalHostname.toLowerCase().indexOf(r.hostname.toLowerCase())&&r.port&&"80"!==r.port&&"443"!==r.port)?(u=r.pathname,u=0===u.indexOf("/")?u:"/"+u,i.allSSL||-1<n.indexOf("https:")?"https://"+r.hostname+(i.httpsPort&&"443"!==i.httpsPort?":"+i.httpsPort:"")+u+r.search:"http://"+r.hostname+(i.httpPort&&"80"!==i.httpPort?":"+i.httpPort:"")+u+r.search):-1!==n.indexOf("https:")||i.allSSL?t.replace("http:","https:"):t},formatUrl:function(n){var t=v.currentToken;return-1!==n.indexOf("null")?null:a.useSSL(window.location.protocol,t?n+(-1!==n.indexOf("?")?"&":"?")+("token="+t):n)},getLocation:function(n){var t=document.createElement("a");return t.href=n,{protocol:t.protocol,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search,hash:t.hash,host:t.host}},resultsToTypedArray:function(n,i,r){return r=r?r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r:[],u.map(r,function(r){return r=t.mixin(r,i||{}),n?new n(r):r})},clearFieldsFromObject:function(n,i){var r,u=n.length;if(t.isArray(n))for(r=0;r<u;r++)delete i[n[r]];else for(r in n)delete i[r];return i},requestToTypedArray:function(n,i,r,u,f){return y(a.request(n,i,r).then(t.partial(a.resultsToTypedArray,u,f)))},request:function(n,i,r){var u;return i&&i.portal&&delete i.portal,i&&i.form&&(u=i.form,delete i.form),i=t.mixin(t.mixin({},i||{}),v.requestParams),r=t.mixin(r||{},v.options),h({url:a.useSSL(window.location.protocol,n.url||n),content:i,callbackParamName:"callback",timeout:r&&r.timeout||0,form:u},r)},formatQueryParams:function(n,i,r){return n=t.mixin(t.mixin({},n),t.isString(i)?{q:i}:i||{}),n.q=!r&&v.extraQuery?"("+n.q+")"+v.extraQuery:n.q,n}},w=n([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(n){t.mixin(this,n);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),b=n([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(n){t.mixin(this,n);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),p=n([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(n){t.mixin(this,n);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=a.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=a.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var n=this.type;return{source:-1<u.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===n?n:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(n){var i=t.isString(n)?{comment:n}:n;return a.request(this.itemUrl+"/addComment",i,{usePost:!0}).then(t.hitch(this,function(n){return new w(t.mixin(i,{id:n.commentId,item:this}))}))},updateComment:function(n){if(n&&n.url&&n.comment)return a.request(n.url+"/update",{comment:n.comment},{usePost:!0}).then(function(t){return n.id=t.commentId,n});throw Error();},getComments:function(){return a.requestToTypedArray(this.itemUrl+"/comments",null,null,w,{item:this})},deleteComment:function(n){if(n&&n.url)return a.request(n.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(n){var i=t.isObject(n)?n:{rating:parseFloat(n)};return a.request(this.itemUrl+"/addRating",i,{usePost:!0}).then(t.hitch(this,function(n){return new b(t.mixin(i,{id:n.ratingId,item:this}))}))},getRating:function(){return a.request(this.itemUrl+"/rating").then(t.hitch(this,function(n){return new b(t.mixin(n,{item:this}))}))},deleteRating:function(){return a.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var n=this.type,i=this.typeKeywords||[],t=n;return"Feature Service"===n||"Feature Collection"===n?t=-1<u.indexOf(i,"Table")?"Table":-1<u.indexOf(i,"Route Layer")?"Route Layer":-1<u.indexOf(i,"Markup")?"Markup":"Feature Layer":"Image Service"===n?t=-1<u.indexOf(i,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===n?t="Scene Layer":"Scene Package"===n?t="Scene Layer Package":"Stream Service"===n?t="Feature Layer":"Geoprocessing Service"===n&&this.portal&&this.portal.isPortal?t=-1<u.indexOf(i,"Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===n?t="Locator":"Microsoft Powerpoint"===n?t="Microsoft PowerPoint":"GeoJson"===n?this.type=t="GeoJSON":"Globe Service"===n?t="Globe Layer":"Vector Tile Service"===n?t="Tile Layer":"Map Service"===n?t=-1===u.indexOf(i,"Spatiotemporal")&&(-1<u.indexOf(i,"Hosted Service")||-1<u.indexOf(i,"Tiled"))?"Tile Layer":"Map Image Layer":n&&-1<n.toLowerCase().indexOf("add in")?t=n.replace(/(add in)/ig,"Add-In"):"datastore catalog service"===n&&(t="Big Data File Share"),t},_getIconUrl:function(){var n=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i=!1,r=!1,f=!1,o=!1;return 0<n.indexOf("service")||"feature collection"===n||"kml"===n||"wms"===n||"wmts"===n||"wfs"===n?(i=-1<u.indexOf(t,"Hosted Service"),"feature service"===n||"feature collection"===n||"kml"===n||"wfs"===n?(o=-1<u.indexOf(t,"Table"),r=-1<u.indexOf(t,"Route Layer"),f=-1<u.indexOf(t,"Markup"),n=o?"table":r?"routelayer":f?"markup":i?"featureshosted":"features"):n="map service"===n||"wms"===n||"wmts"===n?i||-1<u.indexOf(t,"Tiled")||"wmts"===n?"maptiles":"mapimages":"scene service"===n?-1<u.indexOf(t,"Line")?"sceneweblayerline":-1<u.indexOf(t,"3DObject")?"sceneweblayermultipatch":-1<u.indexOf(t,"Point")?"sceneweblayerpoint":-1<u.indexOf(t,"IntegratedMesh")?"sceneweblayermesh":-1<u.indexOf(t,"PointCloud")?"sceneweblayerpointcloud":-1<u.indexOf(t,"Polygon")?"sceneweblayerpolygon":"sceneweblayer":"image service"===n?-1<u.indexOf(t,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===n?"streamlayer":"vector tile service"===n?"vectortile":"datastore catalog service"===n?"datastorecollection":"geocoding service"===n?"geocodeservice":"layers"):n="web map"===n||"cityengine web scene"===n?"maps":"web scene"===n?-1<u.indexOf(t,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===n||"mobile application"===n||"application"===n||"operation view"===n||"desktop application"===n?"apps":"map document"===n||"map package"===n||"published map"===n||"scene document"===n||"globe document"===n||"basemap package"===n||"mobile basemap package"===n||"mobile map package"===n||"project package"===n||"project template"===n||"pro map"===n||"layout"===n||"layer"===n&&-1<u.indexOf(t,"ArcGIS Pro")||"explorer map"===n&&u.indexOf(t,"Explorer Document")?"mapsgray":"service definition"===n||"csv"===n||"shapefile"===n||"cad drawing"===n||"geojson"===n||"360 vr experience"===n?"datafiles":"explorer add in"===n||"desktop add in"===n||"windows viewer add in"===n||"windows viewer configuration"===n?"appsgray":"arcgis pro add in"===n||"arcgis pro configuration"===n?"addindesktop":"rule package"===n||"file geodatabase"===n||"csv collection"===n||"kml collection"===n||"windows mobile package"===n||"map template"===n||"desktop application template"===n||"arcpad package"===n||"code sample"===n||"form"===n||"document link"===n||"vector tile package"===n||"operations dashboard add in"===n||"rules package"===n||"image"===n||"workflow manager package"===n||"desktop style"===n||"explorer map"===n&&-1<u.indexOf(t,"Explorer Mapping Application")||-1<u.indexOf(t,"Document")?"datafilesgray":"network analysis service"===n||"geoprocessing service"===n||"geodata service"===n||"geometry service"===n||"geoprocessing package"===n||"locator package"===n||"geoprocessing sample"===n||"workflow manager service"===n||"raster function template"===n?"toolsgray":"layer"===n||"layer package"===n||"explorer layer"===n?"layersgray":"scene package"===n?"scenepackage":"tile package"===n?"tilepackage":"task file"===n?"taskfile":"report template"===n?"report-template":"statistical data collection"===n?"statisticaldatacollection":"insights workbook"===n?"workbook":"insights model"===n?"insightsmodel":"insights page"===n?"insightspage":"hub initiative"===n?"hubinitiative":"hub page"===n?"hubpage":"hub site application"===n?"hubsite":"relational database connection"===n?"relationaldatabaseconnection":"big data file share"===n?"datastorecollection":"image collection"===n?"imagecollection":"style"===n?"style":"dashboard"===n?"dashboard":"maps",n?e.toUrl("../css/images/item_type_icons/"+n+"16.png"):null},_getIsPremiumContent:function(){var n=this.typeKeywords,t=!1;return(-1<u.indexOf(n,"Requires Subscription")||-1<u.indexOf(n,"Requires Credits"))&&(t=!0),t},_getPremiumIconUrl:function(){var t=this.typeKeywords,n;return this.isPremiumContent&&(n=-1<u.indexOf(t,"Requires Credits")?"premiumcredits":"premiumitem"),n?e.toUrl("../css/images/item_type_icons/"+n+"16.png"):null},getThumbnailUrl:function(n){var t=this.thumbnailUrl;return t&&n&&(t+=(-1===t.indexOf("?")?"?":"&")+"w="+n),t}}),k=n([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(n){t.mixin(this,n);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?a.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?a.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?a.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var i in this.listingProperties)this[i]&&(this.listingProperties[i]=this[i]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=u.map(this.screenshots,t.hitch(this,function(n){return a.formatUrl(this.url+"/info/"+n)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?a.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):a.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return a.requestToTypedArray(this.commentsUrl,null,null,w,{item:this})},getVendor:function(){return this.vendor}}),d=n([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(n){t.mixin(this,n);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=n.listing?new k(t.mixin(n.listing,{portal:this.portal})):null}}),g=n([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(n){t.mixin(this,n);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=a.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return a.request(this.url+"/users")},queryItems:function(n,t){return n=a.formatQueryParams({},n,t),n.q="group:"+this.id+(n.q?" "+n.q:""),this.portal.queryItems(n)},getThumbnailUrl:function(n){var t=this.thumbnailUrl;return t&&n&&(t+=(-1===t.indexOf("?")?"?":"&")+"w="+n),t}}),tt=n([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(n){t.mixin(this,n);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return a.requestToTypedArray(this.url,null,null,p,{portal:this.portal,folderId:this.id})}}),nt=n([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(n){t.mixin(this,n);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?a.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return y(a.request(this.url).then(t.hitch(this,function(n){return a.resultsToTypedArray(g,{portal:this.portal},n.groups)})))},getNotifications:function(){return a.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return a.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return a.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return y(this.getContent(null,{num:1}).then(function(n){return n.folders}))},getItems:function(n){return y(this.getContent(n).then(function(n){return n.items}))},getItem:function(n){return a.request(this.portal.portalUrl+"content/items/"+n).then(t.hitch(this,function(n){return new p(t.mixin(n,{portal:this.portal}))}))},getContent:function(n,i){var r=this.url.replace("community","content")+(n?"/"+n:"");return a.request(r,i).then(t.hitch(this,function(t){return t.folders=a.resultsToTypedArray(tt,{portal:this.portal},t.folders),t.items=a.resultsToTypedArray(p,{portal:this.portal,folderId:n},t.items),t}))},getThumbnailUrl:function(n){var t=this.thumbnailUrl;return t&&n&&(t+=(-1===t.indexOf("?")?"?":"&")+"w="+n),t}});return n={Portal:n([l],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(n){n=t.isObject(n)?n:{url:n};this.registerConnectEvents();v={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};n.self?(v.self=n.self,t.mixin(this,{url:n.url||c.getProtocolForWebResource()+"//"+(n.self.urlKey?n.self.urlKey+"."+n.self.customBaseUrl:n.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",n=n.self.user?this.signIn():this.init(this.url)):(n.url&&t.mixin(this,{url:n.url}),n=this.init(this.url));n.then(t.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(n,i){return n=(n||this.portalUrl).replace(/\/+$/,""),this.portalUrl=-1!==n.indexOf("/sharing")?n+"/":n+"/sharing/rest/",this._getSelf(this.portalUrl).then(t.hitch(this,function(n){return v.self=t.mixin({},n),(n=n.user)&&i&&(v.currentToken=i&&i.token,v.loggedInUser=new nt(t.mixin(n,{portal:this,credential:i}))),v.self.id&&!1===v.self.canSearchPublic&&(v.extraQuery=" AND orgid:"+v.self.id),t.mixin(this,v.self),this.thumbnailUrl=a.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail),this.isOrganization=this.access&&this.access.length?!0:!1,this.created=this.created?new Date(this.created):null,this.modified=this.modified?new Date(this.modified):null,this}),t.hitch(this,function(n){this.onError(n);throw n;}))},signIn:function(){var n=new r,i=t.hitch(this,function(){this._onSignIn().then(t.hitch(this,function(){n.resolve(v.loggedInUser)}),t.hitch(this,function(t){n.reject(t)}))});if(v&&v.self)v&&v.loggedInUser?setTimeout(function(){n.resolve(v.loggedInUser)},0):i();else this.on("load",t.hitch(this,function(){i()}));return n},signOut:function(){return v.loggedInUser.credential&&v.loggedInUser.credential.destroy(),v.loggedInUser=null,v.options.disableIdentityLookup=!0,a.clearFieldsFromObject(v.self,this),v.self=null,this.init(this.url)},getPortalUser:function(){return v.loggedInUser},addResource:function(n,t){return a.request(this.portalUrl+"portals/self/addResource",{key:n,text:t},{usePost:!0})},update:function(n){return a.request(this.portalUrl+"portals/self/update",n,{usePost:!0})},queryGroups:function(n,t){return this._queryPortal(this.portalUrl+"community/groups",a.formatQueryParams({},n,t),g)},queryItems:function(n,t){return this._queryPortal(this.portalUrl+"search",a.formatQueryParams({},n,t),p)},queryListings:function(n){n=a.formatQueryParams({},n,!0);var t="";return n.q&&-1<n.q.toLowerCase().indexOf("mylistings:true")?(n.q=n.q.toLowerCase().replace("mylistings:true",""),t="?mylistings=true"):n.q||(n.q='""'),this._queryPortal(this.portalUrl+"content/listings"+t,n,k)},queryCustomerList:function(n){var t=a.formatQueryParams({},n,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",t)},getProvisions:function(){return this.getCustomers().then(t.hitch(this,function(n){return n.purchases}))},getInterests:function(){return this.getCustomers().then(t.hitch(this,function(n){return n.interests}))},getTrials:function(){return this.getCustomers().then(t.hitch(this,function(n){return n.trials}))},getCustomers:function(n){return a.request(this.portalUrl+"portals/self/customers",{status:n||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(n){return n.purchases})},getMyInterests:function(){return this.getPurchases().then(function(n){return n.interests})},getPurchases:function(){return a.request(this.portalUrl+"portals/self/purchases").then(t.hitch(this,function(n){return n.interests=u.map(n.interests,function(n){return t.mixin(n.provision,{listing:n.listing})}),n.purchases=u.map(n.purchases,function(n){return t.mixin(n.provision,{listing:n.listing})}),n.trials=u.map(n.trials,function(n){return t.mixin(n.provision,{listing:n.listing})}),n.interests=a.resultsToTypedArray(d,{portal:this},n.interests),n.trials=a.resultsToTypedArray(d,{portal:this},n.trials),n.purchases=a.resultsToTypedArray(d,{portal:this},n.purchases),n}))},queryUsers:function(n,t){return this._queryPortal(this.portalUrl+"community/users",a.formatQueryParams({sortField:"username"},n,t),nt)},_onSignIn:function(){return v.options.disableIdentityLookup=!1,v.self=null,o.id.getCredential(this.portalUrl).then(t.hitch(this,"init",this.url)).then(function(){return v.loggedInUser},t.hitch(this,function(n){v.options.disableIdentityLookup=!0;this.onError(n);throw n;}))},_getSelf:function(n){var t;return n+="portals/self",v.self?(t=new r,setTimeout(function(){t.resolve(v.self)},0)):t=a.request(n,{culture:i.locale}),t},_queryPortal:function(n,i,u){var f=t.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},i),e=["start","query","num","nextStart"];return n=a.request(n,f).then(t.hitch(this,function(n){return n.results=a.resultsToTypedArray(u,{portal:this},n),n.queryParams=t.mixin({},f),n.nextQueryParams=t.mixin(f,{start:n.nextStart}),a.clearFieldsFromObject(e,n)})),n=t.delegate(n),n.queryParams=t.mixin({},f),n.nextQueryParams=r.when(n,function(n){return n.nextQueryParams}),y(n)}}),PortalFolder:tt,PortalGroup:g,PortalItem:p,PortalUser:nt,PortalComment:w,PortalRating:b,PortalUtil:a,PortalResult:y,PortalListing:k},f("extend-esri")&&t.mixin(t.getObject("arcgis",!0,o),n),n})},"esri/arcgis/utils":function(){require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(n,t,i){return n.DeferredList=function(n,r,u,f){var s=[],e,o;t.call(this);e=this;0!==n.length||r||this.resolve([0,[]]);o=0;i.forEach(n,function(t,i){function h(t,r){s[i]=[t,r];o++;o===n.length&&e.resolve(s)}t.then(function(n){r?e.resolve([i,n]):h(!0,n)},function(n){if(u?e.reject(n):h(!1,n),f)return null;throw n;})})},n.DeferredList.prototype=new t,n.DeferredList.prototype.gatherResults=function(t){return t=new n.DeferredList(t,!1,!0,!1),t.addCallback(function(n){var t=[];return i.forEach(n,function(n){t.push(n[1])}),t}),t},n.DeferredList})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,t,i,r,u,f,e,o){return n=n([f,e],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(n,i){t.mixin(this,i);this.initialize(n,i)},getTitle:function(n){var t;return this.info&&(t=this.titleHasRelatedFields?"":this._getPopupValues(n,!0).title),t||""},getContent:function(n){return this.info?new o({template:this,graphic:n,chartTheme:this.chartTheme},r.create("div")).domNode:""}}),i("extend-esri")&&t.setObject("dijit.PopupTemplate",n,u),n})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){return n=n(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(n,r){if(n){t.mixin(this,r);this.info=n;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var u=this._fieldLabels={},f=this._fieldsMap={};this.info.fieldInfos&&i.forEach(this.info.fieldInfos,function(n){var t=n.fieldName.toLowerCase(),i=this._isExpressionField(t)?this.getExpressionInfo(t):null;u[t]=i?i.title:n.label;f[t]=n},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(n){var t;return i.some(this.info&&this.info.fieldInfos,function(i){return i.fieldName===n&&(t=i),!!t}),t},getExpressionInfo:function(n){if(this._isExpressionField(n)){n=n.replace(this._reExprField,"");n=n.toLowerCase();var t;return i.some(this.info.expressionInfos,function(i){return i.name.toLowerCase()===n&&(t=i),!!t}),t}},getComponents:function(n){var o=this.info,u=new e,f,r;return o.fieldInfos&&(r=i.filter(o.fieldInfos,function(n){return-1!==n.fieldName.indexOf(this._relatedFieldPrefix)},this)),r&&0<r.length&&(f=this._getRelatedRecords({graphic:n,fieldsInfo:r})),f?f.always(t.hitch(this,function(){u.resolve(this._getPopupValues(n))})):u.resolve(this._getPopupValues(n)),u.promise},getAttachments:function(n){var t=n.getSourceLayer();return n=n.attributes,this.info.showAttachments&&t&&t.hasAttachments&&t.objectIdField&&(n=n&&n[t.objectIdField])?t.queryAttachmentInfos(n):void 0},_isExpressionField:function(n){return this._reExprField.test(n)},_compileExpressions:function(n){var t={};return i.forEach(n,function(n){t[n.name]={compiledFunc:b.createFunction(n.expression)}}),t},_fetchAttributes:function(n){var r=t.clone(n.attributes)||{},u=this._exprPrefix,f=this._exprCache;return i.forEach(this.info.expressionInfos,function(t){var i=u+t.name;t=f[t.name];t=b.executeFunction(t&&t.compiledFunc,b.createExecContext(n,n._getViewInfo()));"string"==typeof t&&(t=h.encode(t));r[i]=t}),r},_getPopupValues:function(n,r){var h=this.info,f=n.getSourceLayer(),o=this._fetchAttributes(n),s=t.clone(o),g=h.fieldInfos,b="",nt="",k,e,u,y,l,p=f&&f._getDateOpts&&f._getDateOpts().properties,p=p&&p.slice(0),a={dateFormat:{properties:p,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}},v,tt,rt,w,d,it;if(this._relatedInfo)for(y in this._relatedInfo)this._relatedInfo.hasOwnProperty(y)&&(v=this._relatedInfo[y],tt=this._relatedLayersInfo[y],v&&(i.forEach(v.relatedFeatures,function(n){for(l in n.attributes)if(n.attributes.hasOwnProperty(l)&&"esriRelCardinalityOneToOne"===tt.relation.cardinality){var t=this._toRelatedFieldName([tt.relation.id,l]);o[t]=s[t]=n.attributes[l]}},this),i.forEach(v.relatedStatsFeatures,function(n){for(l in n.attributes)if(n.attributes.hasOwnProperty(l)){var t=this._toRelatedFieldName([tt.relation.id,l]);o[t]=s[t]=n.attributes[l]}},this)));if(g&&i.forEach(g,function(n){e=n.fieldName;var t=this._getLayerFieldInfo(f,e);t&&(e=n.fieldName=t.name);s[e]=this._formatValue(s[e],e,a);p&&n.format&&n.format.dateFormat&&(n=i.indexOf(p,e),-1<n&&p.splice(n,1))},this),f){y=f.types;rt=(v=f.typeIdField)&&o[v];for(e in o)o.hasOwnProperty(e)&&-1===e.indexOf(this._relatedFieldPrefix)&&(u=o[e],c.isDefined(u))&&(w=this._getDomainName(f,n,y,rt,e,u),c.isDefined(w)?s[e]=w:e===v&&(w=this._getTypeName(f,n,u),c.isDefined(w)&&(s[e]=w)))}return(h.title&&(b=this._processFieldsInLinks(this._fixTokens(h.title,f),o),b=t.trim(c.substitute(s,b,a)||"")),r)?{title:b}:(h.description&&(nt=this._processFieldsInLinks(this._fixTokens(h.description,f),o),nt=t.trim(c.substitute(s,nt,a)||"")),g&&(k=[],i.forEach(g,function(n){(e=n.fieldName)&&n.visible&&k.push([this._fieldLabels[e.toLowerCase()]||e,c.substitute(s,"${"+e+"}",a)||""])},this)),h.mediaInfos&&(d=[],i.forEach(h.mediaInfos,function(n){var e,r,v,h,l;it=0;u=n.value;switch(n.type){case"image":r=u.sourceURL;r=r&&t.trim(c.substitute(o,this._fixTokens(r,f)));it=!!r;break;case"piechart":case"linechart":case"columnchart":case"barchart":r=u.normalizeField;u.fields=i.map(u.fields,function(n){return(e=this._getLayerFieldInfo(f,n))?e.name:n},this);r&&(e=this._getLayerFieldInfo(f,r),u.normalizeField=e?e.name:r);it=i.some(u.fields,function(n){return c.isDefined(o[n])||-1!==n.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}it&&(n=t.clone(n),u=n.value,r=n.title?this._processFieldsInLinks(this._fixTokens(n.title,f),o):"",v=n.caption?this._processFieldsInLinks(this._fixTokens(n.caption,f),o):"",n.title=r?t.trim(c.substitute(s,r,a)||""):"",n.caption=v?t.trim(c.substitute(s,v,a)||""):"","image"===n.type?(u.sourceURL=c.substitute(o,this._fixTokens(u.sourceURL,f)),u.linkURL&&(u.linkURL=t.trim(c.substitute(o,this._fixTokens(u.linkURL,f))||""))):i.forEach(u.fields,function(n,t){if(-1!==n.indexOf(this._relatedFieldPrefix))l=this._getRelatedChartInfos(n,u,o,a),l instanceof Array?u.fields=l:u.fields[t]=l;else{var i=o[n],i=void 0===i?null:i;h=o[u.normalizeField]||0;i&&h&&(i/=h);u.fields[t]={y:i,tooltip:(this._fieldLabels[n.toLowerCase()]||n)+":<br/>"+this._formatValue(i,n,a,!!h)}}},this),d.push(n))},this)),{title:b,description:nt,hasDescription:!!h.description,fields:k&&k.length?k:null,mediaInfos:d&&d.length?d:null,formatted:s,editSummary:f&&f.getEditSummary?f.getEditSummary(n):""})},_getRelatedChartInfos:function(n,t,r,u){var s,h,o,f,e,l;return s=[],l=this._fromRelatedFieldName(n),e=l[0],h=this._relatedInfo[e],e=this._relatedLayersInfo[e],h&&i.forEach(h.relatedFeatures,function(i){var e,a,h,v;i=i.attributes;for(a in i)i.hasOwnProperty(a)&&a===l[1]&&(e={},f=i[a],t.normalizeField&&(o=-1!==t.normalizeField.indexOf(this._relatedFieldPrefix)?i[this._fromRelatedFieldName(t.normalizeField)[1]]:r[t.normalizeField]),f&&o&&(f/=o),t.tooltipField?-1!==t.tooltipField.indexOf(this._relatedFieldPrefix)?(h=this._fromRelatedFieldName(t.tooltipField)[1],v=c.isDefined(i[h])?i[h]:h,e.tooltip=v+":<br/>"+this._formatValue(f,h,u,!!o)):e.tooltip=(this._fieldLabels[n.toLowerCase()]||n)+":<br/>"+this._formatValue(f,t.tooltipField,u,!!o):e.tooltip=f,e.y=f,s.push(e))},this),"esriRelCardinalityOneToMany"===e.relation.cardinality||"esriRelCardinalityManyToMany"===e.relation.cardinality?s:s[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(n,t){var i=this;return n.replace(/(\{([^\{\r\n]+)\})/g,function(n,r,u){return n=i._getLayerFieldInfo(t,u),"$"+(n?"{"+n.name+"}":r)})},_encodeAttributes:function(n){n=t.clone(n)||{};var r,i;for(r in n)(i=n[r])&&"string"==typeof i&&(i=encodeURIComponent(i).replace(/\'/g,"&apos;"),n[r]=i);return n},_processFieldsInLinks:function(n,t){var i=this._encodeAttributes(t),r=this;return n&&(n=n.replace(this._reHref,function(n,u){return r._addValuesToHref(n,u,t,i)}).replace(this._reHrefApos,function(n,u){return r._addValuesToHref(n,u,t,i)})),n},_addValuesToHref:function(n,i,r,u){return i=i&&t.trim(i),c.substitute(i&&0===i.indexOf("${")?r:u,n)},_getLayerFieldInfo:function(n,t){return n&&n.getField?n.getField(t):null},_formatValue:function(n,r,u,f){var s=this._fieldsMap[r.toLowerCase()],e=s&&s.format,l,o;if(r=-1!==i.indexOf(u.dateFormat.properties,r),l="number"==typeof n&&!r&&(!e||!e.dateFormat),!c.isDefined(n)||!s||!c.isDefined(e))return l?this._forceLTR(n):n;var h="",s=[],a=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),v=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(a&&!r)h="NumberFormat",s.push("places: "+(c.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),s.length&&(h+="("+s.join(",")+")");else if(e.dateFormat)h="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return l?this._forceLTR(n):n;return o=this._applyFormatting(n,h,u),a&&-1<n.constructor.toString().indexOf("Array")&&(o="",i.forEach(n,t.hitch(this,function(n,t){t&&(o+=" ");o+=this._applyFormatting(n,h,u)}))),a&&!v&&k.group&&(o=o.replace(new RegExp("\\"+k.group,"g"),"")),r&&(o='<span class="esriDateValue">'+o+"<\/span>"),l?this._forceLTR(o):o},_applyFormatting:function(n,t,i){return c.substitute({myKey:n},"${myKey:"+t+"}",i)||""},_forceLTR:function(n){var t=o("ie");return t&&10>=t?n:"<span class='esriNumericValue'>"+n+"<\/span>"},_insertOffset:function(n){return n&&(n=c.isDefined(this.utcOffset)?n.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):n),n},_getDomainName:function(n,t,i,r,u,f){return(n=n.getDomain&&n.getDomain(u,{feature:t}))&&n.codedValues?n.getName(f):null},_getTypeName:function(n,t){return(n=n.getType&&n.getType(t))&&n.name},_getRelatedRecords:function(n){var u=n.graphic,i=new e,r;return this._relatedLayersInfo?this._queryRelatedLayers(u).then(t.hitch(this,function(n){this._setRelatedRecords(u,n);i.resolve(n)}),t.hitch(this,this._handlerErrorResponse,i)):this._getRelatedLayersInfo(n).then(t.hitch(this,function(n){for(r in n)n.hasOwnProperty(r)&&n[r]&&(this._relatedLayersInfo[r].relatedLayerInfo=n[r]);this._queryRelatedLayers(u).then(t.hitch(this,function(n){this._setRelatedRecords(u,n);i.resolve(n)}),t.hitch(this,this._handlerErrorResponse,i))}),t.hitch(this,this._handlerErrorResponse,i)),i.promise},_getRelatedLayersInfo:function(n){var f=n.fieldsInfo,r,t,u={};r=n.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});i.forEach(f,function(n){var u,t,f,e;u=this._fromRelatedFieldName(n.fieldName);t=u[0];u=u[1];t&&(this._relatedLayersInfo[t]||(i.some(r.relationships,function(n){if(n.id==t)return e=n,!0}),e&&(this._relatedLayersInfo[t]={relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[t]&&(this._relatedLayersInfo[t].relatedFields.push(u),n.statisticType&&(f=new w,f.statisticType=n.statisticType,f.onStatisticField=u,f.outStatisticFieldName=u,this._relatedLayersInfo[t].outStatistics.push(f))))},this);for(t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&this._relatedLayersInfo[t]&&(n=this._relatedLayersInfo[t].relation,n=r.url.replace(/[0-9]+$/,n.relatedTableId),this._relatedLayersInfo[t].relatedLayerUrl=n,u[t]=a({url:n,content:{f:"json"},callbackParamName:"callback"}));return s(u)},_queryRelatedLayers:function(n){var i={};for(var t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&(i[t]=this._queryRelatedLayer({graphic:n,relatedInfo:this._relatedLayersInfo[t]}));return s(i)},_queryRelatedLayer:function(n){var c,w,k,f,o,a,h,d,r,l,u,b,p;return c=n.graphic,w=c.getSourceLayer(),k=w.url.match(/[0-9]+$/g)[0],u=n.relatedInfo,l=u.relatedLayerInfo,b=u.relatedLayerUrl,n=u.relation,i.some(l.relationships,function(n){if(n.relatedTableId===parseInt(k,10))return f=n,!0},this),f&&(o=new v,i.some(l.fields,function(n){if(n.name===f.keyField)return d=-1!==i.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],n.type)?"number":"string",!0}),f.relationshipTableId&&f.keyFieldInRelationshipTable?(p=new e,this._queryRelatedRecords(c,f).then(t.hitch(this,function(n){var f;f=n[c.attributes[w.objectIdField]];n=i.map(f.features,function(n){return n.attributes[l.objectIdField]},this);u.outStatistics&&0<u.outStatistics.length&&l.supportsStatistics&&(r=new v,r.objectIds=n,r.outFields=o.outFields,r.outStatistics=u.outStatistics);r&&(a=new y(b),a.execute(r).then(t.hitch(this,function(n){var t=[];t.push(f);t.push(n);p.resolve(t)})))}))):(h="string"===d?f.keyField+"='"+c.attributes[n.keyField]+"'":f.keyField+"="+c.attributes[n.keyField],o.where=h,o.outFields=u.relatedFields,u.outStatistics&&0<u.outStatistics.length&&l.supportsStatistics&&(r=new v,r.where=o.where,r.outFields=o.outFields,r.outStatistics=u.outStatistics),a=new y(b),h=[],h.push(a.execute(o)),r&&h.push(a.execute(r)))),h?s(h):p?p.promise:void 0},_setRelatedRecords:function(n,t){var i,r;this._relatedInfo=[];for(i in t)t.hasOwnProperty(i)&&t[i]&&(r=t[i],this._relatedInfo[i]={},this._relatedInfo[i].relatedFeatures=r[0].features,c.isDefined(r[1])&&(this._relatedInfo[i].relatedStatsFeatures=r[1].features))},_handlerErrorResponse:function(n,t){n.reject(t)},_fromRelatedFieldName:function(n){var t=[];return-1!==n.indexOf(this._relatedFieldPrefix)&&(n=n.split("/"),t=n.slice(1)),t},_toRelatedFieldName:function(n){var t="";return n&&0<n.length&&(t=this._relatedFieldPrefix+n[0]+"/"+n[1]),t},_queryRelatedRecords:function(n,t){var r=n.getSourceLayer(),i=new p;return i.outFields=["*"],i.relationshipId=t.id,i.objectIds=[n.attributes[r.objectIdField]],r.queryRelatedFeatures(i)}}),f("extend-esri")&&(l.PopupInfo=l.PopupInfoTemplate=n),n})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var t=n.getObject("dojox.html.entities",!0),i=function(n,t){var u,i,r;if(t._encCache&&t._encCache.regexp&&t._encCache.mapper&&t.length==t._encCache.length)u=t._encCache.mapper,i=t._encCache.regexp;else{for(u={},i=["["],r=0;r<t.length;r++)u[t[r][0]]="&"+t[r][1]+";",i.push(t[r][0]);i.push("]");i=new RegExp(i.join(""),"g");t._encCache={mapper:u,regexp:i,length:t.length}}return n.replace(i,function(n){return u[n]})},r=function(n,t){var u,i,r,f;if(t._decCache&&t._decCache.regexp&&t._decCache.mapper&&t.length==t._decCache.length)u=t._decCache.mapper,i=t._decCache.regexp;else{for(u={},i=["("],r=0;r<t.length;r++)f="&"+t[r][1]+";",r&&i.push("|"),u[f]=t[r][0],i.push(f);i.push(")");i=new RegExp(i.join(""),"g");t._decCache={mapper:u,regexp:i,length:t.length}}return n.replace(i,function(n){return u[n]})};return t.html=[["&","amp"],['"',"quot"],["<","lt"],[">","gt"],["","nbsp"]],t.latin=[["","iexcl"],["","cent"],["","pound"],["","euro"],["","curren"],["","yen"],["","brvbar"],["","sect"],["","uml"],["","copy"],["","ordf"],["","laquo"],["","not"],["","shy"],["","reg"],["","macr"],["","deg"],["","plusmn"],["","sup2"],["","sup3"],["","acute"],["","micro"],["","para"],["","middot"],["","cedil"],["","sup1"],["","ordm"],["","raquo"],["","frac14"],["","frac12"],["","frac34"],["","iquest"],["","Agrave"],["","Aacute"],["","Acirc"],["","Atilde"],["","Auml"],["","Aring"],["","AElig"],["","Ccedil"],["","Egrave"],["","Eacute"],["","Ecirc"],["","Euml"],["","Igrave"],["","Iacute"],["","Icirc"],["","Iuml"],["","ETH"],["","Ntilde"],["","Ograve"],["","Oacute"],["","Ocirc"],["","Otilde"],["","Ouml"],["","times"],["","Oslash"],["","Ugrave"],["","Uacute"],["","Ucirc"],["","Uuml"],["","Yacute"],["","THORN"],["","szlig"],["","agrave"],["","aacute"],["","acirc"],["","atilde"],["","auml"],["","aring"],["","aelig"],["","ccedil"],["","egrave"],["","eacute"],["","ecirc"],["","euml"],["","igrave"],["","iacute"],["","icirc"],["","iuml"],["","eth"],["","ntilde"],["","ograve"],["","oacute"],["","ocirc"],["","otilde"],["","ouml"],["","divide"],["","oslash"],["","ugrave"],["","uacute"],["","ucirc"],["","uuml"],["","yacute"],["","thorn"],["","yuml"],["","fnof"],["","Alpha"],["","Beta"],["","Gamma"],["","Delta"],["","Epsilon"],["","Zeta"],["","Eta"],["","Theta"],["","Iota"],["","Kappa"],["","Lambda"],["","Mu"],["","Nu"],["","Xi"],["","Omicron"],["","Pi"],["","Rho"],["","Sigma"],["","Tau"],["","Upsilon"],["","Phi"],["","Chi"],["","Psi"],["","Omega"],["","alpha"],["","beta"],["","gamma"],["","delta"],["","epsilon"],["","zeta"],["","eta"],["","theta"],["","iota"],["","kappa"],["","lambda"],["","mu"],["","nu"],["","xi"],["","omicron"],["","pi"],["","rho"],["","sigmaf"],["","sigma"],["","tau"],["","upsilon"],["","phi"],["","chi"],["","psi"],["","omega"],["","thetasym"],["","upsih"],["","piv"],["","bull"],["","hellip"],["","prime"],["","Prime"],["","oline"],["","frasl"],["","weierp"],["","image"],["","real"],["","trade"],["","alefsym"],["","larr"],["","uarr"],["","rarr"],["","darr"],["","harr"],["","crarr"],["","lArr"],["","uArr"],["","rArr"],["","dArr"],["","hArr"],["","forall"],["","part"],["","exist"],["","empty"],["","nabla"],["","isin"],["","notin"],["","ni"],["","prod"],["","sum"],["","minus"],["","lowast"],["","radic"],["","prop"],["","infin"],["","ang"],["","and"],["","or"],["","cap"],["","cup"],["","int"],["","there4"],["","sim"],["","cong"],["","asymp"],["","ne"],["","equiv"],["","le"],["","ge"],["","sub"],["","sup"],["","nsub"],["","sube"],["","supe"],["","oplus"],["","otimes"],["","perp"],["","sdot"],["","lceil"],["","rceil"],["","lfloor"],["","rfloor"],["","lang"],["","rang"],["","loz"],["","spades"],["","clubs"],["","hearts"],["","diams"],["","OElig"],["","oelig"],["","Scaron"],["","scaron"],["","Yuml"],["","circ"],["","tilde"],["","ensp"],["","emsp"],["","thinsp"],["","zwnj"],["","zwj"],["","lrm"],["","rlm"],["","ndash"],["","mdash"],["","lsquo"],["","rsquo"],["","sbquo"],["","ldquo"],["","rdquo"],["","bdquo"],["","dagger"],["","Dagger"],["","permil"],["","lsaquo"],["","rsaquo"]],t.encode=function(n,r){return n&&(r?n=i(n,r):(n=i(n,t.html),n=i(n,t.latin))),n},t.decode=function(n,i){return n&&(i?n=r(n,i):(n=r(n,t.html),n=r(n,t.latin))),n},t})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(l,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(n,i){this._handler=t.hitch(this,this._handler);this._relationshipQueryHandler=t.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=t.hitch(this,this._executeForIdsHandler);this._countHandler=t.hitch(this,this._countHandler);this._extentHandler=t.hitch(this,this._extentHandler);this.source=i&&i.source;this.gdbVersion=i&&i.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(n,i,r,f,e){var s=e.assembly,h,c;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson(s&&s[0]))),h=this._handler,c=this._errorHandler,this.source&&(s={source:this.source.toJson()},n.layer=u.toJson(s)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){h(n,t,i,r,e.dfd)},error:function(n){c(n,r,e.dfd)},callbackSuffix:f},this.requestOptions)},executeRelationshipQuery:function(n,i,u){var e,h,f;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson())),e=this._relationshipQueryHandler,h=this._errorHandler,this.gdbVersion&&(n.gdbVersion=this.gdbVersion),f=new r(s._dfdCanceller),f._pendingDfd=o({url:this._url.path+"/queryRelatedRecords",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,u,f)},error:function(n){h(n,u,f)}},this.requestOptions),f},executeForIds:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},n.toJson(e&&e[0]))),s=this._executeForIdsHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForCount:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._countHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForExtent:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._extentHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},_handler:function(n,t,i,r,u){try{var f=new a(n);this._successHandler([f],"onComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},_relationshipQueryHandler:function(n,t,r,u,f){try{var o=n.geometryType,s=n.spatialReference,e={};i.forEach(n.relatedRecordGroups,function(n){var t={},i;if(t.geometryType=o,t.spatialReference=s,t.features=n.relatedRecords,t=new a(t),null!=n.objectId)e[n.objectId]=t;else for(i in n)n.hasOwnProperty(i)&&"relatedRecords"!==i&&(e[n[i]]=t)});this._successHandler([e],"onExecuteRelationshipQueryComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},_executeForIdsHandler:function(n,t,i,r,u){try{this._successHandler([n.objectIds],"onExecuteForIdsComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},_countHandler:function(n,t,i,r,u){try{var f,o=n.features,e=n.objectIds;if(e)f=e.length;else{if(o)throw Error("Unable to perform query. Please check your parameters.");f=n.count}this._successHandler([f],"onExecuteForCountComplete",i,u)}catch(s){this._errorHandler(s,r,u)}},_extentHandler:function(n,t,i,r,u){try{n.extent&&(n.extent=new h(n.extent));this._successHandler([n],"onExecuteForExtentComplete",i,u)}catch(f){this._errorHandler(f,r,u)}}}),c._createWrappers(n),f("extend-esri")&&t.setObject("tasks.QueryTask",n,e),n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,t,i,r,u,f,e,o){return n=n(o,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(n,i){n&&t.isString(n)&&(this._url=e.urlToObject(this.url=n));i&&i.requestOptions&&(this.requestOptions=i.requestOptions);this.normalization=!0;this._errorHandler=t.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var n=this._url,t=/^http:/i;this.url&&(this.url=this.url.replace(t,"https:"));n&&n.path&&(n.path=n.path.replace(t,"https:"))},_encode:function(n,r,u){var e,f,s={},o,h;for(o in n)if("declaredClass"!==o&&(e=n[o],f=typeof e,null!==e&&void 0!==e&&"function"!==f))if(t.isArray(e))for(s[o]=[],h=e.length,f=0;f<h;f++)s[o][f]=this._encode(e[f]);else"object"===f?e.toJson&&(f=e.toJson(u&&u[o]),"esri.tasks.FeatureSet"===e.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),s[o]=r?f:i.toJson(f)):s[o]=e;return s},_successHandler:function(n,t,i,r){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&f._resDfd(r,n)},_errorHandler:function(n,t,i){this.onError(n);t&&t(n);i&&i.errback(n)},setNormalization:function(n){this.normalization=n},onError:function(){}}),r("extend-esri")&&(u.Task=n),n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(n){if(n){t.mixin(this,n);var r=this.features,u=n.spatialReference,f=h.getGeometryType(n.geometryType),u=this.spatialReference=new o(u);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);i.forEach(r,function(n,t){var i=n.geometry&&n.geometry.spatialReference;r[t]=new e(f&&n.geometry?new f(n.geometry):null,n.symbol&&c.fromJson(n.symbol),n.attributes);r[t].geometry&&!i&&r[t].geometry.setSpatialReference(u)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var t={};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields),this.spatialReference?t.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJson()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=h.getJsonType(this.features[0].geometry)),t.features=s._encodeGraphics(this.features,n)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,f.fixJson(t)},_hydrate:function(){var n=this.transform,t=this.geometryType;if(n&&t)for(var i=this.features,r=n.translate[0],u=n.translate[1],f=n.scale[0],e=n.scale[1],o=function(n,t,i){return"esriGeometryPoint"===n?function(n){n.x=t(n.x);n.y=i(n.y)}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){n=n.rings||n.paths;for(var u,c,e,r,o,s,f=0,h=n.length;f<h;f++)for(e=n[f],u=0,c=e.length;u<c;u++)r=e[u],0<u?(o+=r[0],s+=r[1]):(o=r[0],s=r[1]),r[0]=t(o),r[1]=i(s)}:"esriGeometryEnvelope"===n?function(n){n.xmin=t(n.xmin);n.ymin=i(n.ymin);n.xmax=t(n.xmax);n.ymax=i(n.ymax)}:"esriGeometryMultipoint"===n?function(n){n=n.points;for(var r,f,e,u=0,o=n.length;u<o;u++)r=n[u],0<u?(f+=r[0],e+=r[1]):(f=r[0],e=r[1]),r[0]=t(f),r[1]=i(e)}:void 0}(t,function(n){return n*f+r},function(n){return u-n*e}),n=0,t=i.length;n<t;n++)i[n].geometry&&o(i[n].geometry);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;for(var f=n.translate[0],e=n.translate[1],o=n.scale[0],s=n.scale[1],i=this.features,r=function(n,t,i){for(var r,f,e,o,s=[],u=0,h=n.length;u<h;u++)(r=n[u],0<u)?(o=t(r[0]),r=i(r[1]),o!==f||r!==e)&&(s.push([o-f,r-e]),f=o,e=r):(f=t(r[0]),e=i(r[1]),s.push([f,e]));return 0<s.length?s:null},h=function(n,t,i){return"esriGeometryPoint"===n?function(n){return n.x=t(n.x),n.y=i(n.y),n}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){var f,s,o,e,u;for(o=n.rings||n.paths,u=[],f=0,s=o.length;f<s;f++)e=o[f],(e=r(e,t,i))&&u.push(e);return 0<u.length?(n.rings?n.rings=u:n.paths=u,n):null}:"esriGeometryMultipoint"===n?function(n){var u;return u=r(n.points,t,i),0<u.length?(n.points=u,n):null}:"esriGeometryEnvelope"===n?function(n){return n}:void 0}(this.geometryType,function(n){return Math.round((n-f)/o)},function(n){return Math.round((e-n)/s)}),t=0,u=i.length;t<u;t++)i[t].geometry&&(h(i[t].geometry)||i[t].setGeometry(null));return this.transform=n,this}}),r("extend-esri")&&t.setObject("tasks.FeatureSet",n,u),n})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var n={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},r=this.objectIds,u=this.outFields,t=this.outSpatialReference;return r&&(n.objectIds=r.join(",")),u&&(n.outFields=u.join(",")),t&&(n.outSR=t.wkid||i.toJson(t.toJson())),n._ts=this._ts,n}}),r("extend-esri")&&t.setObject("tasks.RelationshipQuery",n,u),n})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}}),i("extend-esri")&&t.setObject("tasks.StatisticDefinition",n,r),n})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=0;return t=t([k,y,p],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},d.widgets.popup)},templateString:"<div class='esriViewPopup'><div class='mainSection'><div class='header' dojoAttachPoint='_title'><\/div><div class='hzLine'><\/div><div dojoAttachPoint='_description'><\/div><div class='break'><\/div><\/div><div class='attachmentsSection hidden'><div>${_nls.NLS_attach}:<\/div><ul dojoAttachPoint='_attachmentsList'><\/ul><div class='break'><\/div><\/div><div class='mediaSection hidden'><div class='header' dojoAttachPoint='_mediaTitle'><\/div><div class='hzLine'><\/div><div class='caption' dojoAttachPoint='_mediaCaption'><\/div><div class='gallery' dojoAttachPoint='_gallery'><div class='mediaHandle prev' dojoAttachPoint='_prevMedia' dojoAttachEvent='onclick: _goToPrevMedia'><\/div><div class='mediaHandle next' dojoAttachPoint='_nextMedia' dojoAttachEvent='onclick: _goToNextMedia'><\/div><ul class='summary'><li class='image mediaCount hidden' dojoAttachPoint='_imageCount'>0<\/li><li class='image mediaIcon hidden'><\/li><li class='chart mediaCount hidden' dojoAttachPoint='_chartCount'>0<\/li><li class='chart mediaIcon hidden'><\/li><\/ul><div class='frame' dojoAttachPoint='_mediaFrame'><\/div><\/div><\/div><div class='editSummarySection hidden' dojoAttachPoint='_editSummarySection'><div class='break'><\/div><div class='break hidden' dojoAttachPoint='_mediaBreak'><\/div><div class='editSummary' dojoAttachPoint='_editSummary'><\/div><\/div><\/div>",showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess),r.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var n=this._mediaInfos,s=n.length,r=this.domNode,e=this._prevMedia,o=this._nextMedia,t,i;1<s?(t=0,i=0,u.forEach(n,function(n){"image"===n.type?t++:-1!==n.type.indexOf("chart")&&i++}),t&&(h.set(this._imageCount,"innerHTML",t),f.query(".summary .image",r).removeClass("hidden")),i&&(h.set(this._chartCount,"innerHTML",i),f.query(".summary .chart",r).removeClass("hidden"))):(f.query(".summary",r).addClass("hidden"),c.add(e,"hidden"),c.add(o,"hidden"));n=this._mediaPtr;0===n?c.add(e,"hidden"):c.remove(e,"hidden");n===s-1?c.add(o,"hidden"):c.remove(o,"hidden");this._destroyFrame()},_displayMedia:function(){var i=this._mediaInfos[this._mediaPtr],u=i.title,t=i.caption,s=f.query(".mediaSection .hzLine",this.domNode)[0],o;if(h.set(this._mediaTitle,"innerHTML",u),c[u?"remove":"add"](this._mediaTitle,"hidden"),h.set(this._mediaCaption,"innerHTML",t),c[t?"remove":"add"](this._mediaCaption,"hidden"),c[u&&t?"remove":"add"](s,"hidden"),this._rid=null,"image"===i.type)this._showImage(i.value);else{var e=this,u=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],t=i.value.theme||this.chartTheme;r.isString(t)&&(t=t.replace(/\./gi,"/"),-1===t.indexOf("/")&&(t="dojox/charting/themes/"+t));t||(t="./Rainbow");u.push(t);try{o=this._rid=g++;n(u,function(n,t,r){o===e._rid&&(e._rid=null,e._showChart(i.type,i.value,n,t,r))})}catch(l){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(n){return(n=n&&r.trim(n).toLowerCase())&&(0===n.indexOf("mailto:")||0===n.indexOf("tel:"))},_showImage:function(n){var u,e,t,o,r;c.add(this._mediaFrame,"image");u=a.get(this._gallery,"height");n.linkURL&&(e=l.create("a",{href:n.linkURL,target:this._preventNewTab(n.linkURL)?"":"_blank"},this._mediaFrame));l.create("img",{className:"esriPopupMediaImage",src:n.sourceURL},e||this._mediaFrame);t=f.query(".esriPopupMediaImage",this._mediaFrame)[0];o=this;r=i.connect(t,"onload",function(){i.disconnect(r);r=null;o._imageLoaded(t,u)})},_showChart:function(n,t,i,r,f){c.remove(this._mediaFrame,"image");i=this._chart=new i(l.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});f&&i.setTheme(f);switch(n){case"piechart":i.addPlot("default",{type:"Pie",labels:!1});i.addSeries("Series A",t.fields);break;case"linechart":i.addPlot("default",{type:"Markers"});i.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});i.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});u.forEach(t.fields,function(n,t){n.x=t+1});i.addSeries("Series A",t.fields);break;case"columnchart":i.addPlot("default",{type:"Columns",gap:3});i.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});i.addSeries("Series A",t.fields);break;case"barchart":i.addPlot("default",{type:"Bars",gap:3});i.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1});i.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});i.addSeries("Series A",t.fields)}this._action=new r(i);i.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);h.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(n,t){var i=n.height;i<t&&a.set(n,"marginTop",Math.round((t-i)/2)+"px")},_attListHandler:function(n,t){if(n===this._dfd){this._dfd=null;var i="";t instanceof Error||!t||!t.length||u.forEach(t,function(n){i+="<li>";i+="<a href='"+b.addProxy(n.url)+"' target='_blank'>"+(n.name||"[No name]")+"<\/a>";i+="<\/li>"});h.set(this._attachmentsList,"innerHTML",i||"<li>"+this._nls.NLS_noAttach+"<\/li>")}},_handleComponentsSuccess:function(n){if(n){var i=this.showTitle?n.title:"",t=n.description,a=n.fields,e=n.mediaInfos,o=this.domNode,l=this._nls,y=this,p=this.template,w=this.graphic;this._prevMedia.title=l.NLS_prevMedia;this._nextMedia.title=l.NLS_nextMedia;h.set(this._title,"innerHTML",i);i||c.add(this._title,"hidden");!n.hasDescription&&a&&(t="",u.forEach(a,function(n){t+="<tr valign='top'>";t+="<td class='attrName'>"+v.encode(n[0])+"<\/td>";t+="<td class='attrValue'>"+n[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"<a target='_blank' href='$1' title='$1'>"+l.NLS_moreInfo+"<\/a>")+"<\/td>";t+="<\/tr>"}),t&&(t="<table class='attrTable' cellpadding='0px' cellspacing='0px'>"+t+"<\/table>"));h.set(this._description,"innerHTML",t);t||c.add(this._description,"hidden");f.query("a",this._description).forEach(function(n){y._preventNewTab(n.href)?"_blank"===n.target&&h.remove(n,"target"):h.set(n,"target","_blank")});i&&t?f.query(".mainSection .hzLine",o).removeClass("hidden"):i||t?f.query(".mainSection .hzLine",o).addClass("hidden"):f.query(".mainSection",o).addClass("hidden");(i=this._dfd=p.getAttachments(w))&&(i.addBoth(r.hitch(this,this._attListHandler,i)),h.set(this._attachmentsList,"innerHTML","<li>"+l.NLS_searching+"...<\/li>"),f.query(".attachmentsSection",o).removeClass("hidden"));e&&e.length&&(f.query(".mediaSection",o).removeClass("hidden"),s.setSelectable(this._mediaFrame,!1),this._mediaInfos=e,this._mediaPtr=0,this._updateUI(),this._displayMedia());n.editSummary&&(h.set(this._editSummary,"innerHTML",n.editSummary),e&&e.length&&c.remove(this._mediaBreak,"hidden"),c.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(n){console.log("PopupRenderer: error loading template",n)}}),e("extend-esri")&&r.setObject("dijit._PopupRenderer",t,w),t})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){}function y(n){return function(t,r,u,f){return t&&"string"==typeof r&&t[r]==v?t.on(r.substring(2).toLowerCase(),e.hitch(u,f)):n.apply(i,arguments)}}return n.around(i,"connect",y),f.connect&&n.around(f,"connect",y),n=r("dijit._Widget",[c,l,a],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(n){this._toConnect={};for(var t in n)this[t]===v&&(this._toConnect[t.replace(/^on/,"").toLowerCase()]=n[t],delete n[t])},postCreate:function(){this.inherited(arguments);for(var n in this._toConnect)this.on(n,this._toConnect[n]);delete this._toConnect},on:function(n,t){return this[this._onMap(n)]===v?i.connect(this.domNode,n.toLowerCase(),this,t):this.inherited(arguments)},_setFocusedAttr:function(n){this._focused=n;this._set("focused",n)},setAttribute:function(n,t){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(n,t)},attr:function(n){return 2<=arguments.length||"object"==typeof n?this.set.apply(this,arguments):this.get(n)},getDescendants:function(){return f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0"),this.containerNode?o("[widgetId]",this.containerNode).map(h.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}}),u("dijit-legacy-requires")&&s(0,function(){require(["dijit/_base"])}),n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){function it(n){return function(t){o[t?"set":"remove"](this.domNode,n,t);this._set(n,t)}}a.add("dijit-legacy-requires",!v.isAsync);a.add("dojo-bidi",!1);a("dijit-legacy-requires")&&w(0,function(){n(["dijit/_base/manager"])});var rt={};return r=f("dijit._WidgetBase",[b,g],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:it("lang"),dir:"",_setDirAttr:it("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(n){this._set("ownerDocument",n)},attributeMap:{},_blankGif:r.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var t=this.constructor;if(!t._setterAttrs){var i=t.prototype,r=t._setterAttrs=[],t=t._onMap={};for(var n in i.attributeMap)r.push(n);for(n in i)/^on/.test(n)&&(t[n.substring(2).toLowerCase()]=n),/^_set[A-Z](.*)Attr$/.test(n)&&(n=n.charAt(4).toLowerCase()+n.substr(5,n.length-9),i.attributeMap&&n in i.attributeMap||r.push(n))}},postscript:function(n,t){this.create(n,t)},create:function(n,t){var r,i;this._introspect();this.srcNodeRef=e.byId(t);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);n&&(this.params=n,y.mixin(this,n));this.postMixInProperties();this.id||(this.id=tt.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=d.body(this.ownerDocument);tt.add(this);this.buildRendering();this.domNode&&(this._applyAttributes(),i=this.srcNodeRef,i&&i.parentNode&&this.domNode!==i&&(i.parentNode.replaceChild(this.domNode,i),r=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();r&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var i={};for(var n in this.params||{})i[n]=this._get(n);t.forEach(this.constructor._setterAttrs,function(n){if(!(n in i)){var t=this._get(n);t&&this.set(n,t)}},this);for(n in i)this.set(n,i[n])},postMixInProperties:function(){},buildRendering:function(){if(this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div")),this.baseClass){var n=this.baseClass.split(" ");this.isLeftToRight()||(n=n.concat(t.map(n,function(n){return n+"Rtl"})));s.add(this.domNode,n)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,t.forEach(this.getChildren(),function(n){n._started||n._destroyed||!y.isFunction(n.startup)||(n.startup(),n._started=!0)}))},destroyRecursive:function(n){this._beingDestroyed=!0;this.destroyDescendants(n);this.destroy(n)},destroy:function(n){function i(t){t.destroyRecursive?t.destroyRecursive(n):t.destroy&&t.destroy(n)}this._beingDestroyed=!0;this.uninitialize();t.forEach(this._connects,y.hitch(this,"disconnect"));t.forEach(this._supportingWidgets,i);this.domNode&&t.forEach(tt.findWidgets(this.domNode,this.containerNode),i);this.destroyRendering(n);tt.remove(this.id);this._destroyed=!0},destroyRendering:function(n){this.bgIframe&&(this.bgIframe.destroy(n),delete this.bgIframe);this.domNode&&(n?o.remove(this.domNode,"widgetId"):h.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(n||h.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(n){t.forEach(this.getChildren(),function(t){t.destroyRecursive&&t.destroyRecursive(n)})},uninitialize:function(){return!1},_setStyleAttr:function(n){var t=this.domNode;y.isObject(n)?l.set(t,n):t.style.cssText=t.style.cssText?t.style.cssText+("; "+n):n;this._set("style",n)},_attrToDom:function(n,i,r){r=3<=arguments.length?r:this.attributeMap[n];t.forEach(y.isArray(r)?r:[r],function(t){var r=this[t.node||t||"domNode"];switch(t.type||"attribute"){case"attribute":y.isFunction(i)&&(i=y.hitch(this,i));t=t.attribute?t.attribute:/^on[A-Z][a-zA-Z]*$/.test(n)?n.toLowerCase():n;r.tagName?o.set(r,t,i):r.set(t,i);break;case"innerText":r.innerHTML="";r.appendChild(this.ownerDocument.createTextNode(i));break;case"innerHTML":r.innerHTML=i;break;case"class":s.replace(r,i,this[n]);break;case"toggleClass":s.toggle(r,t.className||n,i)}},this)},get:function(n){var t=this._getAttrNames(n);return this[t.g]?this[t.g]():this._get(n)},set:function(n,t){var i,s,r,e,u,o,f;if("object"==typeof n){for(i in n)this.set(i,n[i]);return this}if(i=this._getAttrNames(n),r=this[i.s],y.isFunction(r))s=r.apply(this,Array.prototype.slice.call(arguments,1));else{if(r=this.focusNode&&!y.isFunction(this.focusNode)?"focusNode":"domNode",e=this[r]&&this[r].tagName,(u=e)&&!(u=rt[e])){u=this[r];o={};for(f in u)o[f.toLowerCase()]=!0;u=rt[e]=o}f=u;i=n in this.attributeMap?this.attributeMap[n]:i.s in this?this[i.s]:f&&i.l in f&&"function"!=typeof t||/^aria-|^data-|^role$/.test(n)?r:null;null!=i&&this._attrToDom(n,t,i);this._set(n,t)}return s||this},_attrPairNames:{},_getAttrNames:function(n){var i=this._attrPairNames,t;return i[n]?i[n]:(t=n.replace(/^[a-z]|-[a-zA-Z]/g,function(n){return n.charAt(n.length-1).toUpperCase()}),i[n]={n:n+"Node",s:"_set"+t+"Attr",g:"_get"+t+"Attr",l:t.toLowerCase()})},_set:function(n,t){var i=this[n];this[n]=t;this._created&&i!==t&&(i===i||t===t)&&(this._watchCallbacks&&this._watchCallbacks(n,i,t),this.emit("attrmodified-"+n,{detail:{prevValue:i,newValue:t}}))},_get:function(n){return this[n]},emit:function(n,t,i){t=t||{};void 0===t.bubbles&&(t.bubbles=!0);void 0===t.cancelable&&(t.cancelable=!0);t.detail||(t.detail={});t.detail.widget=this;var r,u=this["on"+n];return u&&(r=u.apply(this,i?i:[t])),this._started&&!this._beingDestroyed&&p.emit(this.domNode,n.toLowerCase(),t),r},on:function(n,t){var r=this._onMap(n);return r?i.after(this,r,t,!0):this.own(p(this.domNode,n,t))[0]},_onMap:function(n){var r=this.constructor,t=r._onMap,i;if(!t){t=r._onMap={};for(i in r.prototype)/^on/.test(i)&&(t[i.replace(/^on/,"").toLowerCase()]=i)}return t["string"==typeof n&&n.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?tt.findWidgets(this.containerNode):[]},getParent:function(){return tt.getEnclosingWidget(this.domNode.parentNode)},connect:function(n,t,i){return this.own(u.connect(n,t,this,i))[0]},disconnect:function(n){n.remove()},subscribe:function(n,t){return this.own(k.subscribe(n,y.hitch(this,t)))[0]},unsubscribe:function(n){n.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=l.get(this.domNode,"display")},placeAt:function(n,t){var i=!n.tagName&&tt.byId(n);return!i||!i.addChild||t&&"number"!=typeof t?(i=i&&"domNode"in i?i.containerNode&&!/after|before|replace/.test(t||"")?i.containerNode:i.domNode:e.byId(n,this.ownerDocument),h.place(this.domNode,i,t),!this._started&&(this.getParent()||{})._started&&this.startup()):i.addChild(this,t),this},defer:function(n,t){var i=setTimeout(y.hitch(this,function(){i&&(i=null,this._destroyed||y.hitch(this,n)())}),t||0);return{remove:function(){return i&&(clearTimeout(i),i=null),null}}}}),a("dojo-bidi")&&r.extend(nt),r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,t,i){return i("dijit.Destroyable",null,{destroy:function(){this._destroyed=!0},own:function(){var i=["destroyRecursive","destroy","remove"];return n.forEach(arguments,function(r){function f(){o.remove();n.forEach(e,function(n){n.remove()})}var u,o=t.before(this,"destroy",function(n){r[u](n)}),e=[];r.then?(u="cancel",r.then(f,f)):n.forEach(i,function(n){"function"==typeof r[n]&&(u||(u=n),e.push(t.after(r,n,f,!0)))})},this),arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,t,i,r,u,f){return n=r("dijit._OnDijitClickMixin",null,{connect:function(n,t,i){return this.inherited(arguments,[n,"ondijitclick"==t?f:t,i])}}),n.a11yclick=f,n})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(n,t,i,r){return r.extend(t,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}}),i("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,t,i,r){return i(function(){t("highcontrast")&&n.add(r.body(),"dijit_a11y")}),t})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(n,t,i,r,u,f,e){return u.add("highcontrast",function(){var i=e.doc.createElement("div"),f,o;try{return i.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(t.blankGif||n.toUrl("./resources/blank.gif"))+'");',e.body().appendChild(i),f=r.getComputedStyle(i),o=f.backgroundImage,f.borderTopColor==f.borderRightColor||o&&("none"==o||"url(invalid-url:)"==o)}catch(s){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+s.toString()),!1}finally{8>=u("ie")?i.outerHTML="":e.body().removeChild(i)}}),f(function(){u("highcontrast")&&i.add(e.body(),"dj_a11y")}),u})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(n,t,i,r,u,f,e){return f.extend(n,{waiRole:"",waiState:""}),u("dijit._Templated",[t,i],{constructor:function(){e.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(n,t){var u=this.inherited(arguments),i=t(n,"waiRole");return i&&n.setAttribute("role",i),(i=t(n,"waiState"))&&r.forEach(i.split(/\s*,\s*/),function(t){-1!=t.indexOf("-")&&(t=t.split("-"),n.setAttribute("aria-"+t[0],t[1]))}),u}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,t,i,r,u,f,e,o){var s=t("dijit._TemplatedMixin",o,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(n){var t=this.declaredClass,i=this;return e.substitute(n,this,function(n,u){if("!"==u.charAt(0)&&(n=r.getObject(u.substr(1),!1,i)),"undefined"==typeof n)throw Error(t+" template:"+u);return null==n?"":"!"==u.charAt(0)?n:this._escapeValue(""+n)},this)},_escapeValue:function(n){return n.replace(/["'<>&]/g,function(n){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}[n]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=n(this.templatePath,{sanitize:!0}));var t=s.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),u;if(r.isString(t)){if(u=i.toDom(this._stringRepl(t),this.ownerDocument),1!=u.nodeType)throw Error("Invalid template: "+t);}else u=t.cloneNode(!0);this.domNode=u}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(n){var t=this.containerNode;if(n&&t)for(;n.hasChildNodes();)t.appendChild(n.firstChild)}});return s._templateCache={},s.getCachedTemplate=function(n,t,r){var f=s._templateCache,o=n,u=f[o];if(u){try{if(!u.ownerDocument||u.ownerDocument==(r||document))return u}catch(h){}i.destroy(u)}if(n=e.trim(n),t||n.match(/\$\{([^\}]+)\}/g))return f[o]=n;if(t=i.toDom(n,r),1!=t.nodeType)throw Error("Invalid template: "+n);return f[o]=t},f("ie")&&u(window,"unload",function(){var n=s._templateCache,t,r;for(t in n)r=n[t],"object"==typeof r&&i.destroy(r),delete n[t]}),s})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(n){return n.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,t,i,r,u,f,e,o,s){var c=u.delegate(o,{mouseenter:f.enter,mouseleave:f.leave,keypress:i._keypress}),h;return i=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(n){for(var t=n;;)if(1==t.nodeType&&(this._processTemplateNode(t,function(n,t){return n.getAttribute(t)},this._attach)||this.searchContainerNode)&&t.firstChild)t=t.firstChild;else{if(t==n)break;for(;!t.nextSibling;)if(t=t.parentNode,t==n)return;t=t.nextSibling}},_processTemplateNode:function(n,t,i){var s=!0,o=this.attachScope||this,r=t(n,"dojoAttachPoint")||t(n,"data-dojo-attach-point"),e,f;if(r)for(e=r.split(/\s*,\s*/);r=e.shift();)u.isArray(o[r])?o[r].push(n):o[r]=n,s="containerNode"!=r,this._attachPoints.push(r);if(t=t(n,"dojoAttachEvent")||t(n,"data-dojo-attach-event"))for(r=t.split(/\s*,\s*/),e=u.trim;t=r.shift();)t&&(f=null,-1!=t.indexOf(":")?(f=t.split(":"),t=e(f[0]),f=e(f[1])):t=e(t),f||(f=t),this._attachEvents.push(i(n,t,u.hitch(o,f))));return s},_attach:function(t,i,r){return i=i.replace(/^on/,"").toLowerCase(),i="dijitclick"==i?h||(h=n("./a11yclick")):c[i]||i,e(t,i,r)},_detachTemplateNodes:function(){var n=this.attachScope||this;t.forEach(this._attachPoints,function(t){delete n[t]});this._attachPoints=[];t.forEach(this._attachEvents,function(n){n.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}}),u.extend(s,{dojoAttachEvent:"",dojoAttachPoint:""}),i})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,t,i,r,u){return i("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var n=this.domNode;if(this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0),u.parse(n,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(n){this._startupWidgets=n;for(var t=0;t<n.length;t++)this._processTemplateNode(n[t],function(n,t){return n[t]},function(n,t,i){return t in n?n.connect(n,t,i):n.on(t,i,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser})),!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(n,t){return t(n,"dojoType")||t(n,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,function(n){n&&!n._started&&n.startup&&n.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function k(n){return eval("("+n+")")}function g(n){var t=n._nameCaseMap,r=n.prototype,i;if(!t||t._extendCnt<w){t=n._nameCaseMap={};for(i in r)"_"!==i.charAt(0)&&(t[i.toLowerCase()]=i);t._extendCnt=w}return t}function d(t,r){var f,s,o;if(r||(r=n),f=r._dojoParserCtorMap||(r._dojoParserCtorMap={}),s=t.join(),!f[s]){for(var e=[],u=0,h=t.length;u<h;u++)o=t[u],e[e.length]=f[o]=f[o]||i.getObject(o)||~o.indexOf("/")&&r(o);u=e.shift();f[s]=e.length?u.createSubclass?u.createSubclass(e):u.extend.apply(u,e):u}return f[s]}var w,b;return new Date("X"),w=0,s.after(i,"extend",function(){w++},!0),b={_clearCache:function(){w++;_ctorMap={}},_functionFromScript:function(n,t){var u="",f="",e=n.getAttribute(t+"args")||n.getAttribute("args"),i=n.getAttribute("with"),e=(e||"").split(/\s*,\s*/);return i&&i.length&&r.forEach(i.split(/\s*,\s*/),function(n){u+="with("+n+"){";f+="}"}),new Function(e,u+n.innerHTML+f)},instantiate:function(n,i,u){i=i||{};u=u||{};var f=(u.scope||t._scopeName)+"Type",e="data-"+(u.scope||t._scopeName)+"-",s=e+"type",h=e+"mixins",o=[];return r.forEach(n,function(n){var t=f in i?i[f]:n.getAttribute(s)||n.getAttribute(f),r;t&&(r=n.getAttribute(h),t=r?[t].concat(r.split(/\s*,\s*/)):[t],o.push({node:n,types:t}))}),this._instantiate(o,i,u)},_instantiate:function(n,t,i,u){function f(n){return t._started||i.noStart||r.forEach(n,function(n){"function"!=typeof n.startup||n._started||n.startup()}),n}return n=r.map(n,function(n){var r=n.ctor||d(n.types,i.contextRequire);if(!r)throw Error("Unable to resolve constructor for: '"+n.types.join()+"'");return this.construct(r,n.node,t,i,n.scripts,n.inherited)},this),u?h(n).then(f):f(n)},construct:function(n,u,f,e,h,l){function lt(n){for(ht&&i.setObject(ht,n),w=0;w<et.length;w++)s[et[w].advice||"after"](n,et[w].method,i.hitch(n,et[w].func),!0);for(w=0;w<ct.length;w++)ct[w].call(n);for(w=0;w<ot.length;w++)n.watch(ot[w].prop,ot[w].func);for(w=0;w<st.length;w++)y(n,st[w].event,st[w].func);return n}var ft=n&&n.prototype,d,tt,p,w,b,it,ht,ut,nt,rt;for(e=e||{},d={},e.defaults&&i.mixin(d,e.defaults),l&&i.mixin(d,l),a("dom-attributes-explicit")?tt=u.attributes:a("dom-attributes-specified-flag")?tt=r.filter(u.attributes,function(n){return n.specified}):(l=(/^input$|^img$/i.test(u.nodeName)?u:u.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),tt=r.map(l.split(/\s+/),function(n){var t=n.toLowerCase();return{name:n,value:"LI"==u.nodeName&&"value"==n||"enctype"==t?u.getAttribute(t):u.getAttributeNode(t).value}})),it=e.scope||t._scopeName,l="data-"+it+"-",p={},"dojo"!==it&&(p[l+"props"]="data-dojo-props",p[l+"type"]="data-dojo-type",p[l+"mixins"]="data-dojo-mixins",p[it+"type"]="dojotype",p[l+"id"]="data-dojo-id"),w=0,it=[];b=tt[w++];){nt=b.name;rt=nt.toLowerCase();b=b.value;switch(p[rt]||rt){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":ut=b;break;case"data-dojo-id":case"jsid":ht=b;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=b;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=b;break;case"class":d["class"]=u.className;break;case"style":d.style=u.style&&u.style.cssText;break;default:if(nt in ft||(nt=g(n)[rt]||nt),nt in ft)switch(typeof ft[nt]){case"string":d[nt]=b;break;case"number":d[nt]=b.length?Number(b):NaN;break;case"boolean":d[nt]="false"!=b.toLowerCase();break;case"function":d[nt]=""===b||-1!=b.search(/[^\w\.]+/i)?new Function(b):i.getObject(b,!1)||new Function(b);it.push(nt);break;default:rt=ft[nt];d[nt]=rt&&"length"in rt?b?b.split(/\s*,\s*/):[]:rt instanceof Date?""==b?new Date(""):"now"==b?new Date:c.fromISOString(b):rt instanceof o?t.baseUrl+b:k(b)}else d[nt]=b}}for(tt=0;tt<it.length;tt++)p=it[tt].toLowerCase(),u.removeAttribute(p),u[p]=null;if(ut)try{ut=k.call(e.propsThis,"{"+ut+"}");i.mixin(d,ut)}catch(at){throw Error(at.toString()+" in data-dojo-props='"+ut+"'");}i.mixin(d,f);h||(h=n&&(n._noScript||ft._noScript)?[]:v("> script[type^='dojo/']",u));var et=[],ct=[],ot=[],st=[];if(h)for(w=0;w<h.length;w++)p=h[w],u.removeChild(p),f=p.getAttribute(l+"event")||p.getAttribute("event"),e=p.getAttribute(l+"prop"),ut=p.getAttribute(l+"method"),it=p.getAttribute(l+"advice"),tt=p.getAttribute("type"),p=this._functionFromScript(p,l),f?"dojo/connect"==tt?et.push({method:f,func:p}):"dojo/on"==tt?st.push({event:f,func:p}):d[f]=p:"dojo/aspect"==tt?et.push({method:ut,advice:it,func:p}):"dojo/watch"==tt?ot.push({prop:e,func:p}):ct.push(p);return n=(h=n.markupFactory||ft.markupFactory)?h(d,u,n):new n(d,u),n.then?n.then(lt):lt(n)},scan:function(i,u){function g(n){if(!n.inherited){n.inherited={};var t=n.node,i=g(n.parent),t={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(tt)||i.textDir};for(var r in t)t[r]&&(n.inherited[r]=t[r])}return n.inherited}var k=[],y=[],nt={},it=(u.scope||t._scopeName)+"Type",w="data-"+(u.scope||t._scopeName)+"-",rt=w+"type",tt=w+"textdir",w=w+"mixins",f=i.firstChild,e=u.inherited,p,h,s,o,c,v,b;if(!e){p=function(n,t){return n.getAttribute&&n.getAttribute(t)||n.parentNode&&p(n.parentNode,t)};e={dir:p(i,"dir"),lang:p(i,"lang"),textDir:p(i,tt)};for(h in e)e[h]||delete e[h]}for(e={inherited:e};;)if(f)if(1!=f.nodeType)f=f.nextSibling;else if(s&&"script"==f.nodeName.toLowerCase())(c=f.getAttribute("type"))&&/^dojo\/\w/i.test(c)&&s.push(f),f=f.nextSibling;else if(o)f=f.nextSibling;else if(c=f.getAttribute(rt)||f.getAttribute(it),h=f.firstChild,c||h&&(3!=h.nodeType||h.nextSibling)){if(o=null,c){v=f.getAttribute(w);s=v?[c].concat(v.split(/\s*,\s*/)):[c];try{o=d(s,u.contextRequire)}catch(ut){}o||r.forEach(s,function(n){~n.indexOf("/")&&!nt[n]&&(nt[n]=!0,y[y.length]=n)});v=o&&!o.prototype._noScript?[]:null;e={types:s,ctor:o,parent:e,node:f,scripts:v};e.inherited=g(e);k.push(e)}else e={node:f,scripts:s,parent:e};s=v;o=f.stopParser||o&&o.prototype.stopParser&&!u.template;f=h}else f=f.nextSibling;else{if(!e||!e.node)break;f=e.node.nextSibling;o=!1;e=e.parent;s=e.scripts}return b=new l,y.length?(a("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+y.join(", ")),(u.contextRequire||n)(y,function(){b.resolve(r.filter(k,function(n){var t,i;if(!n.ctor)try{n.ctor=d(n.types,u.contextRequire)}catch(r){}for(t=n.parent;t&&!t.types;)t=t.parent;return i=n.ctor&&n.ctor.prototype,n.instantiateChildren=!(i&&i.stopParser&&!u.template),n.instantiate=!t||t.instantiate&&t.instantiateChildren,n.instantiate}))})):b.resolve(k),b.promise},_require:function(t,r){var f=k("{"+t.innerHTML+"}"),u=[],e=[],o=new l,h=r&&r.contextRequire||n;for(var s in f)u.push(s),e.push(f[s]);return h(e,function(){for(var n=0;n<u.length;n++)i.setObject(u[n],arguments[n]);o.resolve(arguments)}),o.promise},_scanAmd:function(n,t){var r=new l,i=r.promise,u;return r.resolve(!0),u=this,v("script[type='dojo/require']",n).forEach(function(n){i=i.then(function(){return u._require(n,t)});n.parentNode.removeChild(n)}),i},parse:function(n,t){var u;!n||"string"==typeof n||"nodeType"in n||(t=n,n=t.rootNode);u=n?f.byId(n):e.body();t=t||{};var s=t.template?{template:!0}:{},r=[],o=this,h=this._scanAmd(u,t).then(function(){return o.scan(u,t)}).then(function(n){return o._instantiate(n,s,t,!0)}).then(function(n){return r=r.concat(n)}).otherwise(function(n){console.error("dojo/parser::parse() error",n);throw n;});return i.mixin(r,h),r}},t.parser=b,u.parseOnLoad&&p(100,b,"parse"),b})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,t){var i={};return n.setObject("dojo.date.stamp",i),i.fromISOString=function(n,r){var u,f,e,o;return i._isoRegExp||(i._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/),u=i._isoRegExp.exec(n),f=null,u&&(u.shift(),u[1]&&u[1]--,u[6]&&(u[6]*=1e3),r&&(r=new Date(r),t.forEach(t.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(n){return r["get"+n]()}),function(n,t){u[t]=u[t]||n})),f=new Date(u[0]||1970,u[1]||0,u[2]||1,u[3]||0,u[4]||0,u[5]||0,u[6]||0),100>u[0]&&f.setFullYear(u[0]||1970),e=0,o=u[7]&&u[7].charAt(0),"Z"!=o&&(e=60*(u[8]||0)+(Number(u[9])||0),"-"!=o&&(e*=-1)),o&&(e-=f.getTimezoneOffset()),e&&f.setTime(f.getTime()+6e4*e)),f},i.toISOString=function(n,t){var u=function(n){return 10>n?"0"+n:n};t=t||{};var f=[],i=t.zulu?"getUTC":"get",r="";if("time"!=t.selector&&(r=n[i+"FullYear"](),r=["0000".substr((r+"").length)+r,u(n[i+"Month"]()+1),u(n[i+"Date"]())].join("-")),f.push(r),"date"!=t.selector){if(r=[u(n[i+"Hours"]()),u(n[i+"Minutes"]()),u(n[i+"Seconds"]())].join(":"),i=n[i+"Milliseconds"](),t.milliseconds&&(r+="."+(100>i?"0":"")+u(i)),t.zulu)r+="Z";else if("time"!=t.selector)var i=n.getTimezoneOffset(),e=Math.abs(i),r=r+((0<i?"-":"+")+u(Math.floor(e/60))+":"+u(e%60));f.push(r)}return f.join("T")},i})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(n,t,i,r,u,f){return n([f,u],{_onMap:function(n){var t=this.constructor._onMap,i;return t&&t.FINAL||(delete this.constructor._onMap,t=this.registerConnectEvents(),t.FINAL=!0),n=n.toLowerCase(),t[n]?i=this[t[n].method]:(n=this._onCamelCase(n),this[n]&&(i=n)),i},on:function(n,t){var u=this._onMap(n),i=n.replace(/\-/g,""),f="on"+i in this.domNode;return u||!f?this.inherited(arguments):this.own(r(this.domNode,i,t))[0]},emit:function(n,i){var e,o,r,u=n.toLowerCase(),f=this.constructor._onMap||this.registerConnectEvents();return o=this[this._onMap(u)],i=i||{},i.target||(i.target=this),o&&f&&f[u]&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},f[u].argKeys)(i),r=t.mixin({},arguments),r[2]=e,r[0]=f[u].name.replace(/^on/,"")),this.inherited(r||arguments)}})})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){return n=n(h,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(n){n=t.hitch;this._projectHandler=n(this,this._projectHandler);this._simplifyHandler=n(this,this._simplifyHandler);this._bufferHandler=n(this,this._bufferHandler);this._areasAndLengthsHandler=n(this,this._areasAndLengthsHandler);this._lengthsHandler=n(this,this._lengthsHandler);this._labelPointsHandler=n(this,this._labelPointsHandler);this._relationHandler=n(this,this._relationHandler);this._convexHullHandler=n(this,this._convexHullHandler);this._unionHandler=n(this,this._unionHandler);this._autoCompleteHandler=n(this,this._autoCompleteHandler);this._reshapeHandler=n(this,this._reshapeHandler);this._cutHandler=n(this,this._cutHandler);this._intersectHandler=n(this,this._intersectHandler);this._differenceHandler=n(this,this._differenceHandler);this._trimExtendHandler=n(this,this._trimExtendHandler);this._densifyHandler=n(this,this._densifyHandler);this._generalizeHandler=n(this,this._densifyHandler);this._offsetHandler=n(this,this._offsetHandler);this._distanceHandler=n(this,this._distanceHandler);this._toGeoCoordinateHandler=n(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=n(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(n){for(var i=[],r=n.length,t=0;t<r;t++)i.push(n[t].toJson());return{geometryType:y.getJsonType(n[0]),geometries:i}},_decodeGeometries:function(n,r,u){var e=y.getGeometryType(r);n=n.geometries;var f=[],o={spatialReference:u.toJson()},s=t.mixin;return i.forEach(n,function(n,t){f[t]=new e(s(n,o))}),f},_toProjectGeometry:function(n){var t=n.spatialReference.toJson();return n instanceof c?new a({rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]],spatialReference:t}):new l({paths:[[].concat(n.points)],spatialReference:t})},_fromProjectedGeometry:function(n,t,i){return"esriGeometryEnvelope"===t?(n=n.rings[0],new c(n[0][0],n[0][1],n[2][0],n[2][1],i)):new v({points:n.paths[0],spatialReference:i.toJson()})},project:function(n,i,f,e){var h=t.mixin({},this._url.query,{f:"json"}),c;n.geometries?(e=f,f=i,i=n.outSR,c=n.geometries[0],h=t.mixin(h,n.toJson())):(c=n[0],h=t.mixin(h,{outSR:i.wkid||r.toJson(i.toJson()),inSR:c.spatialReference.wkid||r.toJson(c.spatialReference.toJson()),geometries:r.toJson(this._encodeGeometries(n))}));var a=y.getJsonType(c),v=this._projectHandler,p=this._errorHandler,l=new u(s._dfdCanceller);return l._pendingDfd=o({url:this._url.path+"/project",content:h,callbackParamName:"callback",load:function(n,t){v(n,t,a,i,f,e,l)},error:function(n){p(n,e,l)}}),l},_projectHandler:function(n,t,i,r,u,f,e){try{var o=this._decodeGeometries(n,i,r);this._successHandler([o],"onProjectComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onProjectComplete:function(){},simplify:function(n,i,f){var e=n[0].spatialReference,c=t.mixin({},this._url.query,{f:"json",sr:e.wkid?e.wkid:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(n))}),l=y.getJsonType(n[0]),a=this._simplifyHandler,v=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/simplify",content:c,callbackParamName:"callback",load:function(n,t){a(n,t,l,e,i,f,h)},error:function(n){v(n,f,h)}}),h},_simplifyHandler:function(n,t,i,r,u,f,e){try{var o=this._decodeGeometries(n,i,r);this._successHandler([o],"onSimplifyComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onSimplifyComplete:function(){},convexHull:function(n,i,f){var h=n[0].spatialReference;n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),geometries:r.toJson(this._encodeGeometries(n))});var c=this._convexHullHandler,l=this._errorHandler,e=new u(s._dfdCanceller);return e._pendingDfd=o({url:this._url.path+"/convexHull",content:n,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,f,e)},error:function(n){l(n,f,e)}}),e},_convexHullHandler:function(n,t,i,r,u,f){try{var e=y.fromJson(n.geometry).setSpatialReference(i);this._successHandler([e],"onConvexHullComplete",r,f)}catch(o){this._errorHandler(o,u,f)}},onConvexHullComplete:function(){},union:function(n,i,f){var h=n[0].spatialReference;n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),geometries:r.toJson(this._encodeGeometries(n))});var c=this._unionHandler,l=this._errorHandler,e=new u(s._dfdCanceller);return e._pendingDfd=o({url:this._url.path+"/union",content:n,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,f,e)},error:function(n){l(n,f,e)}}),e},_unionHandler:function(n,t,i,r,u,f){try{var e=y.fromJson(n.geometry).setSpatialReference(i);this._successHandler([e],"onUnionComplete",r,f)}catch(o){this._errorHandler(o,u,f)}},onUnionComplete:function(){},autoComplete:function(n,i,f,e){var c=n[0].spatialReference;n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),polygons:r.toJson(this._encodeGeometries(n).geometries),polylines:r.toJson(this._encodeGeometries(i).geometries)});var l=this._autoCompleteHandler,a=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/autoComplete",content:n,callbackParamName:"callback",load:function(n,t){l(n,t,c,f,e,h)},error:function(n){a(n,e,h)}}),h},_autoCompleteHandler:function(n,t,i,r,u,f){var o,e,s;try{for(o=n.geometries,n=[],s=o.length,e=0;e<s;e++)n[e]=new a({spatialReference:i,rings:o[e].rings});this._successHandler([n],"onAutoCompleteComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},onAutoCompleteComplete:function(){},reshape:function(n,i,f,e){var c=n.spatialReference;n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),target:r.toJson({geometryType:y.getJsonType(n),geometry:n.toJson()}),reshaper:r.toJson(i.toJson())});var l=this._reshapeHandler,a=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/reshape",content:n,callbackParamName:"callback",load:function(n,t){l(n,t,c,f,e,h)},error:function(n){a(n,e,h)}}),h},_reshapeHandler:function(n,t,i,r,u,f){try{var e=y.fromJson(n.geometry).setSpatialReference(i);this._successHandler([e],"onReshapeComplete",r,f)}catch(o){this._errorHandler(o,u,f)}},onReshapeComplete:function(){},cut:function(n,f,e,h){var l=n[0].spatialReference,a=i.map(n,function(n){return n.toJson()});n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(l.toJson()),target:r.toJson({geometryType:y.getJsonType(n[0]),geometries:a}),cutter:r.toJson(f.toJson())});var v=this._cutHandler,p=this._errorHandler,c=new u(s._dfdCanceller);return c._pendingDfd=o({url:this._url.path+"/cut",content:n,callbackParamName:"callback",load:function(n,t){v(n,t,l,e,h,c)},error:function(n){p(n,h,c)}}),c},_cutHandler:function(n,t,r,u,f,e){try{var s=n.geometries,o={};o.cutIndexes=n.cutIndexes;o.geometries=[];i.forEach(s,function(n){o.geometries.push(y.fromJson(n).setSpatialReference(r))});this._successHandler([o],"onCutComplete",u,e)}catch(h){this._errorHandler(h,f,e)}},onCutComplete:function(){},intersect:function(n,i,f,e){var c=n[0].spatialReference;n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),geometries:r.toJson(this._encodeGeometries(n)),geometry:r.toJson({geometryType:y.getJsonType(i),geometry:i.toJson()})});var l=this._intersectHandler,a=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/intersect",content:n,callbackParamName:"callback",load:function(n,t){l(n,t,c,f,e,h)},error:function(n){a(n,e,h)}}),h},_intersectHandler:function(n,t,r,u,f,e){try{var o=[];i.forEach(n.geometries,function(n){o.push(y.fromJson(n).setSpatialReference(r))});this._successHandler([o],"onIntersectComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onIntersectComplete:function(){},difference:function(n,i,f,e){var c=n[0].spatialReference;n=t.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),geometries:r.toJson(this._encodeGeometries(n)),geometry:r.toJson({geometryType:y.getJsonType(i),geometry:i.toJson()})});var l=this._differenceHandler,a=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/difference",content:n,callbackParamName:"callback",load:function(n,t){l(n,t,c,f,e,h)},error:function(n){a(n,e,h)}}),h},_differenceHandler:function(n,t,r,u,f,e){try{var o=[];i.forEach(n.geometries,function(n){o.push(y.fromJson(n).setSpatialReference(r))});this._successHandler([o],"onDifferenceComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onDifferenceComplete:function(){},buffer:function(n,i,r){var e=t.mixin({},this._url.query,{f:"json"},n.toJson()),h=n.outSpatialReference||n.geometries[0].spatialReference,c=this._bufferHandler,l=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/buffer",content:e,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,r,f)},error:function(n){l(n,r,f)}}),f},_bufferHandler:function(n,t,i,r,u,f){var o,e,s;try{for(o=n.geometries,n=[],s=o.length,e=0;e<s;e++)n[e]=new a({spatialReference:i,rings:o[e].rings});this._successHandler([n],"onBufferComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},onBufferComplete:function(){},areasAndLengths:function(n,i,r){n=t.mixin({},this._url.query,{f:"json"},n.toJson());var e=this._areasAndLengthsHandler,h=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/areasAndLengths",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,r,f)},error:function(n){h(n,r,f)}}),f},_areasAndLengthsHandler:function(n,t,i,r,u){try{this._successHandler([n],"onAreasAndLengthsComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},onAreasAndLengthsComplete:function(){},lengths:function(n,i,r){n=t.mixin({},this._url.query,{f:"json"},n.toJson());var e=this._lengthsHandler,h=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/lengths",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,r,f)},error:function(n){h(n,r,f)}}),f},_lengthsHandler:function(n,t,i,r,u){try{this._successHandler([n],"onLengthsComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},onLengthsComplete:function(){},labelPoints:function(n,f,e){var l=i.map(n,function(n){return n.toJson()}),h=n[0].spatialReference,l=t.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:r.toJson(h.toJson()),polygons:r.toJson(l)}),a=this._labelPointsHandler,v=this._errorHandler,c=new u(s._dfdCanceller);return c._pendingDfd=o({url:this._url.path+"/labelPoints",content:l,callbackParamName:"callback",load:function(t,i){a(t,i,n,h,f,e,c)},error:function(n){v(n,e,c)}}),c},_labelPointsHandler:function(n,t,r,u,f,e,o){try{var s=[];i.forEach(n.labelPoints,function(n){s.push(y.fromJson(n).setSpatialReference(u))});this._successHandler([s],"onLabelPointsComplete",f,o)}catch(h){this._errorHandler(h,e,o)}},onLabelPointsComplete:function(){},relation:function(n,i,r){n=t.mixin({},this._url.query,{f:"json"},n.toJson());var e=this._relationHandler,h=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/relation",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,r,f)},error:function(n){h(n,r,f)}}),f},_relationHandler:function(n,t,i,r,u){try{this._successHandler([n.relations],"onRelationComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},onRelationComplete:function(){},trimExtend:function(n,i,r){var e=t.mixin({},this._url.query,{f:"json"},n.toJson()),h=n.sr,c=this._trimExtendHandler,l=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/trimExtend",content:e,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,r,f)},error:function(n){l(n,r,f)}}),f},_trimExtendHandler:function(n,t,i,r,u,f){var o,e,s;try{for(o=n.geometries,n=[],s=o.length,e=0;e<s;e++)n[e]=new l({spatialReference:i,paths:o[e].paths});this._successHandler([n],"onTrimExtendComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},onTrimExtendComplete:function(){},densify:function(n,i,r){var e=t.mixin({},this._url.query,{f:"json"},n.toJson()),h=n.geometries[0].spatialReference,c=this._densifyHandler,l=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/densify",content:e,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,r,f)},error:function(n){l(n,r,f)}}),f},_densifyHandler:function(n,t,r,u,f,e){try{var o=[];i.forEach(n.geometries,function(n){o.push(y.fromJson(n).setSpatialReference(r))});this._successHandler([o],"onDensifyComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onDensifyComplete:function(){},generalize:function(n,i,r){var e=t.mixin({},this._url.query,{f:"json"},n.toJson()),h=n.geometries[0].spatialReference,c=this._generalizeHandler,l=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/generalize",content:e,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,r,f)},error:function(n){l(n,r,f)}}),f},_generalizeHandler:function(n,t,r,u,f,e){try{var o=[];i.forEach(n.geometries,function(n){o.push(y.fromJson(n).setSpatialReference(r))});this._successHandler([o],"onGeneralizeComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onGeneralizeComplete:function(){},offset:function(n,i,r){var e=t.mixin({},this._url.query,{f:"json"},n.toJson()),h=n.geometries[0].spatialReference,c=this._offsetHandler,l=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/offset",content:e,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,r,f)},error:function(n){l(n,r,f)}}),f},_offsetHandler:function(n,t,r,u,f,e){try{var o=[];i.forEach(n.geometries,function(n){o.push(y.fromJson(n).setSpatialReference(r))});this._successHandler([o],"onOffsetComplete",u,e)}catch(s){this._errorHandler(s,f,e)}},onOffsetComplete:function(){},distance:function(n,i,r){var e=t.mixin({},this._url.query,{f:"json"},n.toJson()),h=n.geometry1.spatialReference,c=this._distanceHandler,l=this._errorHandler,f=new u(s._dfdCanceller);return f._pendingDfd=o({url:this._url.path+"/distance",content:e,callbackParamName:"callback",load:function(n,t){c(n,t,h,i,r,f)},error:function(n){l(n,r,f)}}),f},_distanceHandler:function(n,t,i,r,u,f){try{n=n&&n.distance;this._successHandler([n],"onDistanceComplete",r,f)}catch(e){this._errorHandler(e,u,f)}},onDistanceComplete:function(){},toGeoCoordinateString:function(n,i,f){var e={};e.sr=t.isObject(n.sr)?n.sr.wkid||r.toJson(n.sr.toJson()):n.sr;e.coordinates=r.toJson(n.coordinates);e.conversionType=n.conversionType||"MGRS";e.conversionMode=n.conversionMode;e.numOfDigits=n.numOfDigits;e.rounding=n.rounding;e.addSpaces=n.addSpaces;n=t.mixin({},this._url.query,{f:"json"},e);var c=this._toGeoCoordinateHandler,l=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/toGeoCoordinateString",content:n,callbackParamName:"callback",load:function(n,t){c(n,t,i,f,h)},error:function(n){l(n,f,h)}}),h},_toGeoCoordinateHandler:function(n,t,i,r,u){try{this._successHandler([n.strings],"onToGeoCoordinateStringComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(n,i,f){var e={};e.sr=t.isObject(n.sr)?n.sr.wkid||r.toJson(n.sr.toJson()):n.sr;e.strings=r.toJson(n.strings);e.conversionType=n.conversionType||"MGRS";e.conversionMode=n.conversionMode;n=t.mixin({},this._url.query,{f:"json"},e);var c=this._fromGeoCoordinateHandler,l=this._errorHandler,h=new u(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/fromGeoCoordinateString",content:n,callbackParamName:"callback",load:function(n,t){c(n,t,i,f,h)},error:function(n){l(n,f,h)}}),h},_fromGeoCoordinateHandler:function(n,t,i,r,u){try{this._successHandler([n.coordinates],"onToGeoCoordinateStringComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},onFromGeoCoordinateStringComplete:function(){}}),t.mixin(n,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"}),f("extend-esri")&&t.setObject("tasks.GeometryService",n,e),n})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../renderers/arcadeUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi){var li=k.defaults,ci=i(wt,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4e3,maxRecordCountForAuto:2e3,maxVertexCountForAuto:25e4,generalizeForScale:4e3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(n,t){this._preventInit||this._initFeatureLayer(n,t)},_initFeatureLayer:function(n,t){var i,r;this.i18n=hi;t=t||{};this._aggregationInfo=t.aggregationInfo;this.showLabels=null!=t.showLabels?t.showLabels:!0;this._outFields=t.outFields;this._defnExpr=t.definitionExpression;this._loadCallback=t.loadCallback;r=t._usePatch;this._usePatch=null===r||void 0===r?!0:r;this._trackIdField=t.trackIdField;this.objectIdField=t.objectIdField;this._maxOffset=null!=t.maxAllowableOffset?t.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=t.quantize?t.quantize:!0;this._optEditable=t.editable;this._optAutoGen=t.autoGeneralize;this.editSummaryCallback=t.editSummaryCallback;this.userId=t.userId;this.userIsAdmin=t.userIsAdmin;this.useMapTime=t.hasOwnProperty("useMapTime")?!!t.useMapTime:!0;this.source=t.source;this.gdbVersion=t.gdbVersion;this.orderByFields=t.orderByFields;this.maxPointCountForAuto=null!=t.maxPointCountForAuto?t.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=t.maxRecordCountForAuto?t.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=t.maxVertexCountForAuto?t.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=null!=t.generalizeForScale?t.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=t.queryPagination?t.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=t.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();i=ci;r=this.mode=w.isDefined(t.mode)?t.mode:i.MODE_ONDEMAND;this._isStream&&(this.mode=r=i.MODE_STREAM);switch(r){case i.MODE_SNAPSHOT:this.currentMode=i.MODE_SNAPSHOT;this._mode=new ii(this);this._isSnapshot=!0;break;case i.MODE_ONDEMAND:case i.MODE_AUTO:this.currentMode=i.MODE_ONDEMAND;this._tileWidth=t.tileWidth||512;this._tileHeight=t.tileHeight||512;this._mode=new ri(this);this.latticeTiling=t.latticeTiling;break;case i.MODE_SELECTION:this.currentMode=i.MODE_SELECTION;this._mode=new ui(this);this._isSelOnly=!0;break;case i.MODE_STREAM:this.currentMode=i.MODE_STREAM;this._mode=new fi(this);this._isStream=!0}if(this._initLayer=u.hitch(this,this._initLayer),this._selectHandler=u.hitch(this,this._selectHandler),this._editable=!1,u.isObject(n)&&n.layerDefinition)return this._collection=!0,this.mode=this._isStream?i.MODE_STREAM:i.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(n),this;this._task=new st(this.url,{source:this.source,gdbVersion:this.gdbVersion});r=this._url.path;this._fserver=!1;-1!==r.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===i.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(i=t.resourceInfo)?this._initLayer(i):(this.source&&(i={source:this.source.toJson()},this._url.query=u.mixin(this._url.query,{layer:e.toJson(i)})),this.gdbVersion&&(this._url.query=u.mixin(this._url.query,{gdbVersion:this.gdbVersion})),b({url:r,content:u.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(n,t){var i,c,s,r,d;if(n||t){this._json=n;this._findCredential();(this.credential&&this.credential.ssl||n&&n._ssl)&&(this._useSSL(),this._task._useSSL());this.version=n.currentVersion;this.version||(this.version="capabilities"in n||"drawingInfo"in n||"hasAttachments"in n||"htmlPopupType"in n||"relationships"in n||"timeInfo"in n||"typeIdField"in n||"types"in n?10:9.3);this._collection&&(this._isStream||(this.currentMode=ci.MODE_SNAPSHOT,this._mode=new ii(this)),this._isSnapshot=!0,this._featureSet=n.featureSet,this._nextId=n.nextObjectId,n=n.layerDefinition);this.geometryType=n.geometryType;"string"!=typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");n.hasOwnProperty("capabilities")?(i=this.capabilities=n.capabilities,this._editable=i&&-1!==i.toLowerCase().indexOf("editing")?!0:!1):this._collection||(this._editable=this._fserver);w.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=e.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this.mode===ci.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||(this._autoGeneralize=w.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===ci.MODE_ONDEMAND||this.mode===ci.MODE_AUTO,delete this._optAutoGen);i=n.effectiveMinScale||n.minScale;r=n.effectiveMaxScale||n.maxScale;!this._hasMin&&i&&this.setMinScale(i);!this._hasMax&&r&&this.setMaxScale(r);this.layerId=n.id;this.name=n.name;this.description=n.description;this.copyright=n.copyrightText;this.type=n.type;this.displayField=n.displayField;this.defaultDefinitionExpression=n.definitionExpression||(n.isView?n.viewDefinitionQuery:n.definitionQuery);this.fullExtent=new at(n.extent);this.initialExtent=new at(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new g(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=n.defaultVisibility;("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)&&(this.latticeTiling=!1);this.hasM=n.hasM||!1;this.hasZ=n.hasZ||!1;this.indexedFields=n.indexedFields;this.maxRecordCount=n.maxRecordCount;this.canModifyLayer=n.canModifyLayer;this.supportsStatistics=n.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:n.supportsAdvancedQueries;this.supportsCalculate=n.supportsCalculate;this.supportsAttachmentsByUploadId=n.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=n.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=n.hasLabels;this.canScaleSymbols=n.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=n.supportsRollbackOnFailure;this.syncCanReturnChanges=n.syncCanReturnChanges;this.isDataVersioned=n.isDataVersioned;this.editFieldsInfo=n.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=n.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=n.relationships;this.allowGeometryUpdates=w.isDefined(n.allowGeometryUpdates)?n.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!n.allowUpdateWithoutMValues;this.advancedQueryCapabilities=n.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.useStandardizedQueries=n.useStandardizedQueries;this.tileMaxRecordCount=n.tileMaxRecordCount;this.standardMaxRecordCount=n.standardMaxRecordCount;this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;for(var o=this.fields=[],r=n.fields,i=0;i<r.length;i++)o.push(new bt(r[i]));if(!this.objectIdField){if(this.objectIdField=n.objectIdField,!this.objectIdField)for(r=n.fields,i=0;i<r.length;i++)if(o=r[i],"esriFieldTypeOID"===o.type){this.objectIdField=o.name;break}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+w.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!w.isDefined(this._nextId)){if(r=this.objectIdField,o=-1,this._collection&&r)for(var y=(i=this._featureSet)&&i.features,v=y?y.length:0,l,i=0;i<v;i++)l=(l=y[i].attributes)&&l[r],l>o&&(o=l);this._nextId=o+1}this.globalIdField=n.globalIdField;(i=this.typeIdField=n.typeIdField)&&(i=!this._getField(i)&&this._getField(i,!0))&&(this.typeIdField=i.name);this.visibilityField=n.visibilityField;(r=n.defaultSymbol)&&(this.defaultSymbol=rt.fromJson(r));var b=this.types=[],a=n.types,p,k,o=(i=this.editFieldsInfo)&&i.creatorField,y=i&&i.editorField;if(l=o||y,v=[],a)for(i=0;i<a.length;i++)p=new dt(a[i]),k=p.templates,l&&k&&k.length&&(v=v.concat(k)),b.push(p);if(a=n.templates,p=this.templates=[],a)for(i=0;i<a.length;i++)b=new gt(a[i]),l&&v.push(b),p.push(b);for(i=0;i<v.length;i++)(l=u.getObject("prototype.attributes",!1,v[i]))&&(o&&delete l[o],y&&delete l[y]);if((i=n.timeInfo)&&(this.timeInfo=new kt(i),this._startTimeField=i.startTimeField,this._endTimeField=i.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?i.trackIdField=this._trackIdField:this._trackIdField=i.trackIdField),this.hasAttachments=!this._collection&&n.hasAttachments?!0:!1,this.htmlPopupType=n.htmlPopupType,i=n.drawingInfo,(o=i&&i.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=f.map(o,function(n){return new ti(n)}),this._fixLabelExpr()),!this.renderer)if(i&&i.renderer){if(c=i.renderer,this.setRenderer(et.fromJson(c)),"classBreaks"===c.type&&this.renderer.setMaxInclusive(!0),!this._collection){s=c.type;r=[];c=this.renderer;switch(s){case"simple":r.push(c.symbol);break;case"uniqueValue":case"classBreaks":r.push(c.defaultSymbol);r=r.concat(f.map(c.infos,function(n){return n.symbol}))}var r=f.filter(r,w.isDefined),st=this._url.path+"/images/",ot=this._getToken();f.forEach(r,function(n){var t=n.url;t&&(-1===t.search(/https?\:/)&&-1===t.indexOf("data:")&&(n.url=st+t),ot&&-1!==n.url.search(/https?\:/)&&(n.url+="?token="+ot))})}}else if(r)a=this.types,0<a.length?(c=new ft(this.defaultSymbol,this.typeIdField),f.forEach(a,function(n){c.addValue(n.id,n.symbol)})):c=new ut(this.defaultSymbol),this.setRenderer(c);else if(!this._isTable){switch(this.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":s=new nt;break;case"esriGeometryPolyline":s=new tt;break;case"esriGeometryPolygon":s=new it;break;default:this.hasXYFootprint()&&(s=new it)}this.setRenderer(s?new ut(s):null)}s=i&&i.transparency||0;!this.hasOwnProperty("opacity")&&0<s&&(this.opacity=1-s/100);(h("ie")||7<=h("trident")||h("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=n.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();d=function(){this.currentMode!==ci.MODE_SNAPSHOT&&(this.queryPagination=!1);null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var n=this._loadCallback;n&&(delete this._loadCallback,n(this))};this._collection?(s=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new ct(s)),this._fcAdded=!0,d.call(this)):this._forceIdentity(this._limitPromise?function(){var n=this;this._limitPromise.then(function(t){n._checkMode(t)});this._limitPromise.always(function(){n._limitPromise=null;d.call(n)})}:d)}},setShowLabels:function(n){this.showLabels=n;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(n){var t;if(this.inherited(arguments),t=this._map,this._ager=!!(n&&n.observationAger&&n.observationRenderer),n&&"colors"in n&&"blurRadius"in n&&"maxPixelIntensity"in n?"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&t&&(this._heatmapManager=new oi(this),this._heatmapManager.initialize(t)):this.renderer&&this.renderer.getRendererInfo?f.some(this.renderer.rendererInfos,function(n){return n.renderer&&"colors"in n.renderer&&"blurRadius"in n.renderer})||(this._heatmapManager=null):this._heatmapManager=null,this.timeInfo&&t&&(n&&(n.latestObservationRenderer||n.trackRenderer)?this._trackManager||(this._trackManager=new ei(this),this._trackManager.initialize(t),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null)),n){var i=[],t=f.filter([n,n.observationRenderer,n.latestObservationRenderer,n.trackRenderer],w.isDefined),r=function(n){return null!=n&&"function"!=typeof n&&n};f.forEach(t,function(n){var t=r(n.attributeField),u=r(n.attributeField2);n=r(n.attributeField3);!1!==t&&i.push(t);!1!==u&&i.push(u);!1!==n&&i.push(n)});this._requiredFields=i}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},getAggregationInfo:function(){return this._aggregationInfo},setAggregationInfo:function(n){this._aggregationInfo=n;this.loaded&&this._map&&this._evalClusterManager();this.onAggregationInfoChange()},isAggregationEnabled:function(){return this._clusterManager&&this._clusterManager.isClusteringEnabled()},getAggregationRenderer:function(){return this.isAggregationEnabled()?this._clusterManager.getClusterRenderer():null},getAggregationLayer:function(){return this._clusterManager?this._clusterManager.container:null},_evalClusterManager:function(){var n=this.getAggregationInfo();n?this._canCluster(n)?this._clusterManager?this._updateClusterManager(n):this._clusterManager=this._createClusterManager(n):console.log("FeatureLayer: Clustering is supported only for non-editable point layers in snapshot mode when map spatial reference is WGS84 or WebMercator"):this._destroyClusterManager()},_canCluster:function(n){var t=this._map.spatialReference;return"cluster"===n.type&&(t.isWebMercator()||4326===t.wkid)&&"esriGeometryPoint"===this.geometryType&&!this.isEditable()&&(this.mode===ci.MODE_SNAPSHOT||this.currentMode===ci.MODE_SNAPSHOT||this.currentMode===ci.MODE_STREAM)},_createClusterManager:function(n){return n=new si({layer:this,aggregationInfo:n}),this._clusterHandles=[n.on("renderer-change,mode-change",u.hitch(this,function(){this.onAggregationRendererChange()}))],n.initialize(this._map),n},_updateClusterManager:function(n){var t=this._clusterManager;t&&t.setAggregationInfo(n)},_destroyClusterManager:function(){f.forEach(this._clusterHandles,function(n){n.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(),this._clusterManager=null)},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var n=this._getRenderer();this._ager=!!(n&&n.observationAger&&n.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(n&&n.trackRenderer)},_setMap:function(n){var r=this.inherited(arguments),t=this._mode,i=this;return t&&n.loaded&&t.initialize(n),this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase()),this._addHandle=this.on("graphic-node-add",function(n){n=n.graphic.attributes;(n=i._selectedFeatures[n&&n[i.objectIdField]])&&n.attr("data-selected","")}),r},_unsetMap:function(){var n=this._mode;n&&n.suspend();this._destroyClusterManager();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);r.disconnect(this._zoomConnect);r.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var n=this._mode;n&&n.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return f.filter(this._getOutFields(),function(n){return"*"===n||!!this._getField(n)},this)},getField:function(n){return this._getField(n,!0)},isOutField:function(n){if(n=this.getField(n),!n)return!1;var t=this.getOutFields();return-1<f.indexOf(t,"*")||-1<f.indexOf(t,n.name)},getFieldLabel:function(n){var t=this.infoTemplate,t=t&&t.getFieldInfo&&t.getFieldInfo(n),i,r;return n=u.isFunction(n)?null:this.getField(n),i=t||n,r="",i&&(r=t&&t.label||n&&n.alias||i.name||i.fieldName),r},getDomain:function(n,t){var i,u,r=t&&t.feature,e=r&&this.typeIdField&&r.attributes&&r.attributes[this.typeIdField];return null!=e&&f.some(this.types,function(t){return t.id==e?((i=t.domains&&t.domains[n])&&"inherited"===i.type&&(i=this._getLayerDomain(n),u=!0),!0):!1},this),u||i||(i=this._getLayerDomain(n)),i},_getLayerDomain:function(n){var t;return f.some(this.fields,function(i){return i.name===n&&(t=i.domain),!!t}),t},getType:function(n){var t,i=n&&this.typeIdField&&n.attributes&&n.attributes[this.typeIdField];return f.some(this.types,function(n){return n.id==i&&(t=n),!!t}),t},setEditable:function(n){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=n,this;var t=this._editable;return this._editable=n,this._updateCaps(),t!==n&&this.onCapabilitiesChange(),this},getEditCapabilities:function(n){var t={canCreate:!1,canUpdate:!1,canDelete:!1,canUpdateGeometry:!1},r;if(!this.loaded||!this.isEditable())return t;r=n&&n.feature;n=n&&n.userId||this.getUserId();var e=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],u.trim),c=(t=-1<f.indexOf(e,"editing"))&&-1<f.indexOf(e,"create"),l=t&&-1<f.indexOf(e,"update"),e=t&&-1<f.indexOf(e,"delete"),i=this.ownershipBasedAccessControlForFeatures,o=this.editFieldsInfo,h=o&&o.creatorField,o=o&&o.realm,r=(r=r&&r.attributes)&&h?r[h]:void 0,s=!!this.userIsAdmin,h=!i||s||!(!i.allowOthersToUpdate&&!i.allowUpdateToOthers),a=!i||s||!(!i.allowOthersToDelete&&!i.allowDeleteToOthers),v=!i||s||!i.hasOwnProperty("allowAnonymousToUpdate")||i.allowAnonymousToUpdate,i=!i||s||!i.hasOwnProperty("allowAnonymousToDelete")||i.allowAnonymousToDelete;return n&&o&&(n=n+"@"+o),!s&&(!t||c||l||e)||(c=l=e=!0),t={canCreate:c,canUpdate:l,canDelete:e,canUpdateGeometry:s||this.allowGeometryUpdates},n||(t.canUpdate=t.canUpdate&&v,t.canDelete=t.canDelete&&i),null===r?(t.canUpdate=t.canUpdate&&h,t.canDelete=t.canDelete&&a):""!==r&&r&&n.toLowerCase()!==r.toLowerCase()&&(t.canUpdate=t.canUpdate&&h,t.canDelete=t.canDelete&&a),t},getUserId:function(){var n;return this.loaded&&(n=this.credential&&this.credential.userId||this.userId||""),n},setUserIsAdmin:function(n){this.userIsAdmin=n},setEditSummaryCallback:function(n){this.editSummaryCallback=n},getEditSummary:function(n,t,i){var r,e,f;return i=w.isDefined(i)?i:(new Date).getTime(),r="",i=this.getEditInfo(n,t,i),(t=t&&t.callback||this.editSummaryCallback)&&(i=t(n,i)||""),u.isString(i)?r=i:(i&&(n=i.action,t=i.userId,e=i.timeValue,f=0,n&&f++,t&&f++,w.isDefined(e)&&f++,1<f&&(r=("edit"===n?"edit":"create")+(t?"User":"")+(w.isDefined(e)?i.displayPattern:""))),r=r&&w.substitute(i,this.i18n.layers.FeatureLayer[r])),r},getEditInfo:function(n,t,i){var u;if(this.loaded){i=w.isDefined(i)?i:(new Date).getTime();t=t&&t.action||"last";var r=this.editFieldsInfo,f=r&&r.creatorField,o=r&&r.creationDateField,e=r&&r.editorField,r=r&&r.editDateField,e=(n=n&&n.attributes)&&e?n[e]:void 0,r=n&&r?n[r]:null,f=this._getEditData(n&&f?n[f]:void 0,n&&o?n[o]:null,i);i=this._getEditData(e,r,i);switch(t){case"creation":u=f;break;case"edit":u=i;break;case"last":u=i||f}return u&&(u.action=u===i?"edit":"creation"),u}},_getEditData:function(n,t,i){var r,u,f;return w.isDefined(t)&&(u=i-t,f=0>u?"Full":6e4>u?"Seconds":12e4>u?"Minute":36e5>u?"Minutes":72e5>u?"Hour":864e5>u?"Hours":6048e5>u?"WeekDay":"Full"),(void 0!==n||f)&&(r=r||{},r.userId=n,f&&(n=s.format,i=new Date(t),r.minutes=Math.floor(u/6e4),r.hours=Math.floor(u/36e5),r.weekDay=n(i,{datePattern:"EEEE",selector:"date"}),r.formattedDate=n(i,{selector:"date"}),r.formattedTime=n(i,{selector:"time"}),r.displayPattern=f,r.timeValue=t)),r},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var n=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],u.trim);return this._isStream||this.userIsAdmin||this._collection||-1!==f.indexOf(n,"query")||-1!==f.indexOf(n,"catalog")},setMaxAllowableOffset:function(n){return this.isEditable()||this._setMaxOffset(n,!0),this},getMaxAllowableOffset:function(){var n=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:n},_setMaxOffset:function(n,t){return null==n?(delete this._maxOffset,delete this._quantizationParameters,this):(this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=n:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:n,extent:this.fullExtent}):(this._isFractionalOffsetAllowed()&&t||(n=Math.floor(n)),isNaN(n)||0===n?delete this._maxOffset:this._maxOffset=n,delete this._quantizationParameters),this)},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(n){return n=(n=n&&n.split("-"))&&n[0]&&n[0].toLowerCase(),-1!==f.indexOf(this._langsWithDot,n)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(n){return this.loaded?this.isEditable()||this.mode===ci.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||((this._autoGeneralize=n)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=n,this},setGDBVersion:function(n){return!this._collection&&n!==this.gdbVersion&&(n||this.gdbVersion)&&(this.gdbVersion=n,this._task.gdbVersion=n,this._url.query=u.mixin(this._url.query,{gdbVersion:n}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange()),this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},setDefinitionExpression:function(n){return this._defnExpr=n,(n=this._mode)&&n.propertyChangeHandler(1),this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(n){return this._isSnapshot?(this._timeDefn=n,(n=this._mode)&&n.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id = "+this.id+", Layer URL = "+this.url),this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(n,t){this._timeOffset=n;this._timeOffsetUnits=t;var i=this._mode;return i&&i.propertyChangeHandler(0),this},setUseMapTime:function(n){this.useMapTime=n;this._toggleTime(!this.suspended);(n=this._mode)&&n.propertyChangeHandler(0)},selectFeatures:function(n,t,i,r){var s;t=t||ci.SELECTION_NEW;this._hasPartialSelectedFeatures=!1;n=this._getShallowClone(n);var f=this._map,e,h=this,u=d._fixDfd(new o(d._dfdCanceller));if(n.outFields=this.getOutFields(),n.returnGeometry=!0,n.multipatchOption=this.multipatchOption,f&&(n.outSpatialReference=new g(f.spatialReference.toJson())),!this._applyQueryFilters(n,!0))return e={features:[]},this._selectHandler(e,t,i,r,u),u;if(f=this._canDoClientSideQuery(n))u._pendingDfd=v(this._doQuery(n,f)),u._pendingDfd.then(function(n){e={features:n};h._selectHandler(e,t,i,r,u)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,r,u,!0),u;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,r,u,!0),u;s=this;this._ts&&(n._ts=(new Date).getTime());(u._pendingDfd=this._task.execute(n)).addCallbacks(function(n){s._selectHandler(n,t,i,r,u)},function(n){s._hasPartialSelectedFeatures=!0;s._resolve([n],null,r,u,!0)})}return u},getSelectedFeatures:function(){var n=this._selectedFeatures,t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t},clearSelection:function(n){var r=this._selectedFeatures,t=this._mode;for(var i in r)r.hasOwnProperty(i)&&(this._unSelectFeatureIIf(i,t),t._removeFeatureIIf(i));return this._selectedFeatures={},this._isSelOnly&&t._applyTimeFilter(!0),n||this.onSelectionClear(),this},setSelectionSymbol:function(n){if(this._selectionSymbol=n){var t=this._selectedFeatures;for(var i in t)t.hasOwnProperty(i)&&t[i].setSymbol(n)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(n){n?(this.labelingInfo=n,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var t=/\[([^\[\]]+)\]/ig,n,i=this,r=function(n,t){var r=i._getField(t,!0);return"["+(r&&r.name||t)+"]"};f.forEach(this.labelingInfo,function(i){(n=i.labelExpression)&&(i.labelExpression=n.replace(t,r))})},_updateRequiredFieldsFromLabelingInfo:function(){var n=[];f.forEach(this.labelingInfo,function(t){var i=t.labelExpressionInfo,r,u;t.labelExpression&&(r=/[\[\]]/ig,t=t.labelExpression.match(/\[[^\[\]]+\]/ig),(t=f.map(t,function(n){return n.replace(r,"")}))&&(n=n.concat(t)));i&&(i.value&&(u=/[\{\}]/ig,t=i.value.match(/\{[^\{\}]+\}/ig),(t=f.map(t,function(n){return n.replace(u,"")}))&&(n=n.concat(t))),i.expression&&(n=n.concat(ot.extractFieldNames(i.expression))))});n=f.map(n,function(n){var t=this.getField(n);return t?t.name:n},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(n))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(n,t,i,r,e,o){var s=o.assembly,c=o.dfd,v,y;this._applyNormalized(n,s&&s[0]);this._applyNormalized(t,s&&s[1]);this.onBeforeApplyEdits(n,t,i);var l={},a=this.objectIdField,s={f:"json"},h=!1;if(this._collection)o={},o.addResults=n?f.map(n,function(){return h=!0,{objectId:this._nextId++,success:!0}},this):null,o.updateResults=t?f.map(t,function(n){h=!0;var t=n.attributes[a];return l[t]=n,{objectId:t,success:!0}},this):null,o.deleteResults=i?f.map(i,function(n){return h=!0,{objectId:n.attributes[a],success:!0}},this):null,h?this._editHandler(o,n,l,r,e,c):this._resolve([o.addResults,o.updateResults,o.deleteResults],null,r,c);else{if(n&&0<n.length&&(s.adds=this._convertFeaturesToJson(n,0,1),h=!0),t&&0<t.length){for(o=0;o<t.length;o++)v=t[o],l[v.attributes[a]]=v;s.updates=this._convertFeaturesToJson(t,0,0,1);h=!0}if(i&&0<i.length){for(t=[],o=0;o<i.length;o++)t.push(i[o].attributes[a]);s.deletes=t.join(",");h=!0}if(h)return y=this,b({url:this._url.path+"/applyEdits",content:u.mixin(s,this._url.query),callbackParamName:"callback",load:function(t){y._editHandler(t,n,l,r,e,c)},error:function(n){y._resolve([n],null,e,c,!0)}},{usePost:!0});this._resolve([],null,r,c)}},queryFeatures:function(n,t,i){return this._query("execute","onQueryFeaturesComplete",n,t,i)},queryRelatedFeatures:function(n,t,i){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",n,t,i)},queryIds:function(n,t,i){return this._query("executeForIds","onQueryIdsComplete",n,t,i)},queryCount:function(n,t,i){return this._query("executeForCount","onQueryCountComplete",n,t,i)},queryExtent:function(n,t,i){return this._query("executeForExtent","onQueryExtentComplete",n,t,i)},queryAttachmentInfos:function(n,t,i){var s=this._url.path+"/"+n+"/attachments",e=new o(d._dfdCanceller),r=this;return e._pendingDfd=b({url:s,content:u.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(i){i=i.attachmentInfos;var u;f.forEach(i,function(t){u=c.objectToQuery({gdbVersion:r._url.query&&r._url.query.gdbVersion,layer:r._url.query&&r._url.query.layer,token:r._getToken()});t.url=s+"/"+t.id+(u?"?"+u:"");t.objectId=n});r._resolve([i],"onQueryAttachmentInfosComplete",t,e)},error:function(n){r._resolve([n],null,i,e,!0)}}),e},addAttachment:function(n,t,i,r){return this._sendAttachment("add",n,t,i,r)},updateAttachment:function(n,t,i,r,u){return i.appendChild(l.create("input",{type:"hidden",name:"attachmentId",value:t})),this._sendAttachment("update",n,i,r,u)},deleteAttachments:function(n,t,i,r){var h=this._url.path+"/"+n+"/deleteAttachments",e=new o(d._dfdCanceller),s=this;return t={f:"json",attachmentIds:t.join(",")},e._pendingDfd=b({url:h,content:u.mixin(t,this._url.query),callbackParamName:"callback",load:u.hitch(this,function(t){t=t.deleteAttachmentResults;t=f.map(t,function(t){return t=new ni(t),t.attachmentId=t.objectId,t.objectId=n,t});s._resolve([t],"onDeleteAttachmentsComplete",i,e)}),error:function(n){s._resolve([n],null,r,e,!0)}},{usePost:!0}),e},addType:function(n){var t=this.types;if(t){if(f.some(t,function(t){return t.id==n.id?!0:!1}))return!1;t.push(n)}else this.types=[n];return this._typesDirty=!0},deleteType:function(n){var t,i;if(this._collection&&(t=this.types,t&&(i=-1,f.some(t,function(t,r){return t.id==n?(i=r,!0):!1}),-1<i)))return this._typesDirty=!0,t.splice(i,1)[0]},toJson:function(){var n=this._json;if(n=u.isString(n)?e.fromJson(n):u.clone(n)){var n=n.layerDefinition?n:{layerDefinition:n},i=n.layerDefinition,s=this._collection;if(s&&this._typesDirty){i.types=f.map(this.types||[],function(n){return n.toJson()});var t=this.renderer,r=this.labelingInfo,o=i.drawingInfo;(t||r)&&!o&&(o=i.drawingInfo={});o&&t&&-1===t.declaredClass.indexOf("TemporalRenderer")&&(o.renderer=t.toJson());r&&(o.labelingInfo=f.map(r,function(n){return n.toJson()}))}return t=null,(!s||this._fcAdded)&&(t={geometryType:i.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)}),n.featureSet=u.mixin({},n.featureSet||{},t),n.featureSet.transform&&(r=n.featureSet.transform,delete n.featureSet.transform,t=new ct(n.featureSet),t.quantize(r),n.featureSet=t.toJson()),s&&(n.nextObjectId=this._nextId,i.capabilities=this.capabilities),n}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onAggregationRendererChange:function(){},onAggregationInfoChange:function(){},_forceIdentity:function(n){var u=this,i,r=this._url&&this._url.path,t;i=r&&r.toLowerCase().indexOf("/rest/services");t=this.editFieldsInfo;t=t&&(t.creatorField||t.editorField);(this.userIsAdmin||t)&&!this._getToken()&&-1<i&&p.id?(i=r.substring(0,i)+"/rest/info",b({url:i,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(n){if(n.owningSystemUrl)return p.id.checkSignInStatus(n.owningSystemUrl+"/sharing")}).then(function(n){if(n)return p.id.getCredential(r)}).then(function(n){n&&u._findCredential()}).always(function(){n.call(u)})):n.call(this)},_checkMode:function(n){var t=this.geometryType,i=this.maxRecordCount;n=(n=n&&n.features&&n.features[0])&&n.attributes&&n.attributes.exceedslimit;this.mode===ci.MODE_AUTO&&!this.isEditable()&&0===n&&(this.queryPagination||("esriGeometryPolyline"===t||"esriGeometryPolygon"===t||"esriGeometryMultipoint"===t||this.hasXYFootprint())&&i>=this.maxRecordCountForAuto||"esriGeometryPoint"===t&&i>=this.maxPointCountForAuto)&&(this.currentMode=ci.MODE_SNAPSHOT,this._mode=new ii(this),this._isSnapshot=this._autoSnapshot=!0)},_queryLimit:function(){var n=this,t=new o;this._limitPromise=t.promise;setTimeout(function(){var r=new ht,i=new lt;i.statisticType="exceedslimit";i.maxPointCount=n.maxPointCountForAuto;i.maxRecordCount=n.maxRecordCountForAuto;i.maxVertexCount=n.maxVertexCountForAuto;i.outStatisticFieldName="exceedslimit";r.outStatistics=[i];n.queryFeatures(r).promise.then(function(n){t.resolve(n)},function(n){t.reject(n)})},0)},_updateCaps:function(){var n=this._editable,t=u.trim(this.capabilities||""),e=f.map(t?t.split(","):[],u.trim),i=f.map(t?t.toLowerCase().split(","):[],u.trim),t=f.indexOf(i,"editing"),r,i={Create:f.indexOf(i,"create"),Update:f.indexOf(i,"update"),Delete:f.indexOf(i,"delete")};if(n&&-1===t)e.push("Editing");else if(!n&&-1<t){n=[t];for(r in i)-1<i[r]&&n.push(i[r]);for(n.sort(),r=n.length-1;0<=r;r--)e.splice(n[r],1)}this.capabilities=e.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var n=this._mode;n&&n.suspend()},onResume:function(n){this.inherited(arguments);this._toggleTime(!0);var u=this._mode,i=this._map,t=this._getRenderer();n.firstOccurrence?(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalClusterManager(),this.timeInfo&&!this._trackManager&&(this._trackIdField||t&&(t.latestObservationRenderer||t.trackRenderer))&&(this._trackManager=new ei(this),this._trackManager.initialize(i),this._childLayer=this._trackManager.container),t&&"colors"in t&&"blurRadius"in t&&"maxPixelIntensity"in t&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new oi(this),this._heatmapManager.initialize(i)),this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset()&&(t=this.generalizeForScale,this._calculatedScale=t=this.maxScale?this.maxScale:this.minScale?Math.min(t,this.minScale):Math.min(t,pt.getScale(i,this.initialExtent)),this._calcMaxOffset=i.extent.getWidth()/i.width/i.getScale()*t),this._zoomConnect=r.connect(i,"onZoomEnd",this,this._zoomEndHandler),this._updateMaxOffset(),this._needsRefresh=!1,u&&(u._init||u.initialize(i),u.startup())):(this._zoomEndHandler(),u&&u.resume())},_zoomEndHandler:function(){var n=this._map;this._updateMaxOffset();this._prevScale=n.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var n=this._map;n&&n.loaded&&this._autoGeneralize&&(this._autoSnapshot?(n=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=n!=this.getMaxAllowableOffset())):this._setMaxOffset(n.extent.getWidth()/n.width,!n.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var i=this._map.getScale(),n=this._calculatedScale,r=this._calcMaxOffset,t=this._prevScale;return i>=n&&(null==t||t<n)?r:i<n&&(null==t||t>=n)?null:this.getMaxAllowableOffset()}},_toggleTime:function(n){var t=this._map;n&&this.timeInfo&&this.useMapTime&&t?(this._mapTimeExtent=t.timeExtent,this._timeConnect||(this._timeConnect=r.connect(t,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,r.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(n){this._mapTimeExtent=n;(n=this._mode)&&n.propertyChangeHandler(0)},_getOffsettedTE:function(n){var t=this._timeOffset,i=this._timeOffsetUnits;return n&&t&&i?n.offset(-1*t,i):n},_getTimeOverlap:function(n,t){return n&&t?n.intersection(t):n||t},_getTimeFilter:function(n){var i=this.getTimeDefinition(),t;if(i&&(t=this._getTimeOverlap(i,null),!t))return[!1];if(n){if(n=t?this._getTimeOverlap(n,t):n,!n)return[!1]}else n=t;return[!0,n]},_getAttributeFilter:function(n){var t=this.getDefinitionExpression();return n?t?"("+t+") AND ("+n+")":n:t},_applyQueryFilters:function(n,t){if(n.where=this._getAttributeFilter(n.where),!n.returnGeometry||n.maxAllowableOffset||n.quantizationParameters||(n.maxAllowableOffset=this._maxOffset,n.quantizationParameters=this._quantizationParameters),t&&this.supportsAdvancedQueries&&(n.orderByFields=n.orderByFields||this.getOrderByFields()),this.timeInfo){var i=this._getTimeFilter(n.timeExtent);if(i[0])n.timeExtent=i[1];else return!1}return!0},_add:function(n){var r=this._selectionSymbol,t=n.attributes,i=this.visibilityField;return r&&this._isSelOnly&&n.setSymbol(r),i&&t&&t.hasOwnProperty(i)&&n[t[i]?"show":"hide"](),this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(n){var t=[],i=this._map,r,o,u;if((this._collection||!this._isTable&&i)&&!(n.text||n.where&&n.where!==this.getDefinitionExpression()||n.orderByFields&&n.orderByFields.length&&(r=this.getOrderByFields()||[])&&n.orderByFields.join()!==r.join()||n.outStatistics||n.returnDistinctValues)){if(r=this._isSnapshot,o=this._isSelOnly,u=n.geometry,u){if(o||n.spatialRelationship!==ht.SPATIAL_REL_INTERSECTS||"extent"!==u.type||!r&&!i.extent.contains(u))return;t.push(1)}if(i=n.objectIds)if(r)t.push(2);else{for(var u=i.length,h=this._mode,s=0,e=0;e<u;e++)h._getFeature(i[e])&&s++;if(s===u)t.push(2);else return}if(this.timeInfo)if(n=n.timeExtent,i=this._mapTimeExtent,r)n&&t.push(3);else if(o){if(n)return}else if(i)if(-1!==f.indexOf(t,2))n&&t.push(3);else if(-1!==f.indexOf(t,1))n==i&&t.push(3);else return;else if(0<t.length)n&&t.push(3);else if(n)return;return 0<t.length?t:null}},_getAbsMid:function(i){return n.toAbsMid?n.toAbsMid(i):t.id.replace(/\/[^\/]*$/ig,"/")+i},_doQuery:function(n,t,i){var r=[],a=this.objectIdField,v=this,y=new o,e=new o,l=this.graphics,s,c,h;return-1!==f.indexOf(t,1)?(s=this.spatialIndex||this._map&&this._map.spatialIndex,h=n.geometry._normalize(null,!0),null==s&&li.autoSpatialIndexing?c=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(u.hitch(this,u.partial(this._getFromIndex,h,s)),function(){e.resolve(u.hitch(this,u.partial(this._filterByExtent,l,h)))}):s&&(c=this._getFromIndex(h,s)),c?c.then(function(n){for(var t=0;t<n.length;t++)n[t].results&&(r=r.concat(n[t].results));e.resolve(r)}).otherwise(function(n){e.reject(n)}):e.resolve(this._filterByExtent(l,h))):e.resolve(l),e.then(function(u){if(r=u,-1!==f.indexOf(t,2)){var e=n.objectIds;r=f.filter(r,function(n){return-1<f.indexOf(e,n.attributes[a])})}-1!==f.indexOf(t,3)&&v.timeInfo&&(u=n.timeExtent,r=v._filterByTime(r,u.startTime,u.endTime).match);i&&(r=f.map(r,function(n){return n.attributes[a]},this));y.resolve(r)}),y},_getFromIndex:function(n,t){t=t||this.spatialIndex||this._map.spatialIndex;n instanceof Array||(n=[n]);var i=this.id;return y(f.map(n,function(n){return t.intersects(n,i)}))},_filterByExtent:function(n,t){for(var r,i,u=[],f=0,e=n.length;f<e;f++)r=n[f],i=r.geometry,i&&(this.normalization&&t.length?(t[0].intersects(i)||t[1].intersects(i))&&u.push(r):t.intersects(i)&&u.push(r));return u},_filterByTime:function(n,t,i){var o=this._startTimeField,c=this._endTimeField,u;this._twoTimeFields||(u=o||c);var l=w.isDefined,s=[],h=[],f,a=n.length,e,r;if(t=t?t.getTime():-Infinity,i=i?i.getTime():Infinity,u)for(f=0;f<a;f++)e=n[f],r=e.attributes,o=r[u],o>=t&&o<=i?s.push(e):h.push(e);else for(f=0;f<a;f++)e=n[f],r=e.attributes,u=r[o],r=r[c],u=l(u)?u:-Infinity,r=l(r)?r:Infinity,u>=t&&u<=i||r>=t&&r<=i||t>=u&&i<=r?s.push(e):h.push(e);return{match:s,noMatch:h}},_getSizeVariables:function(n){return n&&f.filter(n.getVisualVariablesForType("sizeInfo",!1),function(n){return!(!n.field&&!n.valueExpression)})},_needClientSideSorting:function(n){return this._collection?!(!n||!n.length):f.some(n,function(n){return!!n.valueExpression})},_sortFeatures:function(n){var i=this.renderer,u=this._getSizeVariables(i),r,t;return n&&1<n.length&&this._needClientSideSorting(u)&&(r=u[0],t=this,n.sort(function(n,u){n._layer||(n._layer=t);u._layer||(u._layer=t);var f=i._getDataValue(n,r,"sizeInfo",null,t),e=i._getDataValue(u,r,"sizeInfo",null,t);return null==f?-1:null==e?1:e-f})),n},_resolve:function(n,t,i,r,u){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&d._resDfd(r,n,u)},_getShallowClone:function(n){var i=new ht;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},_query:function(n,t,i,r,u){var c=this,l=this._map,s=new o(d._dfdCanceller),e=i,y,p,w,a,h;if("executeRelationshipQuery"!==n){if(e=this._getShallowClone(i),a=this.getOutFields(),e.outFields||(e.outFields=a),e.outFields&&e.outFields.length&&(p=-1<f.indexOf(a,"*")?!1:!f.every(e.outFields,function(n){return-1<f.indexOf(a,n)})),e.returnGeometry=i.hasOwnProperty("returnGeometry")?i.returnGeometry:!i.outStatistics,e.returnGeometry&&(e.multipatchOption=this.multipatchOption,(e.maxAllowableOffset||e.quantizationParameters)&&(i=e.maxAllowableOffset||e.quantizationParameters.tolerance)&&i!==this.getMaxAllowableOffset()&&(w=!0)),l&&(l=l&&l.spatialReference,(i=e.outSpatialReference)?y=!i.equals(l):e.outSpatialReference=new g(l.toJson())),!this._applyQueryFilters(e,"execute"===n&&!e.outStatistics)){switch(n){case"execute":h=new ct({features:[]});break;case"executeForIds":h=[];break;case"executeForCount":h=0;break;case"executeForExtent":h={}}return this._resolve([h],t,r,s),s}if(l="executeForExtent"!==n&&!y&&!p&&!w&&this._canDoClientSideQuery(e))return s._pendingDfd=v(this._doQuery(e,l,"executeForIds"===n||"executeForCount"===n)),s._pendingDfd.then(function(i){switch(n){case"execute":h=new ct;h.features=i;break;case"executeForIds":h=i;break;case"executeForCount":h=i.length}c._resolve([h],t,r,s)}),s}return this._collection?(this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,u,s,!0),s):this.loaded&&!this.isQueryable()?(this._resolve([Error("Layer does not support query capability.")],null,u,s,!0),s):(this._ts&&(e._ts=(new Date).getTime()),(s._pendingDfd=this._task[n](e)).addCallbacks(function(i){var h=!!e.outStatistics||y||p||w,f,u,o;if("execute"===n||"executeRelationshipQuery"===n)if("execute"===n)for(f=i.features,u=f.length,--u;0<=u;u--)(f[u]._layer=c,h||c._isTable)||(o=c._mode._getFeature(f[u].attributes[c.objectIdField]),o&&f.splice(u,1,o));else for(o in i)if(i.hasOwnProperty(o))for(f=i[o].features,u=f.length,--u;0<=u;u--)f[u]._layer=c;c._resolve([i],t,r,s)},function(n){c._resolve([n],null,u,s,!0)}),s)},_convertFeaturesToJson:function(n,t,i,r){var l=[],p=this._selectionSymbol,v=this.visibilityField,h,w=this.objectIdField;for(this.loaded&&(i||r)&&(h=f.filter(this.fields,function(n){return!1===n.editable&&(!r||n.name!==w)})),i=0;i<n.length;i++){var c=n[i],o={},y=c.geometry,s=c.attributes,a=c.symbol;!y||r&&this.loaded&&!this.allowGeometryUpdates||(o.geometry=y.toJson());v?(o.attributes=s=u.mixin({},s),s[v]=c.visible?1:0):s&&(o.attributes=u.mixin({},s));o.attributes&&h&&h.length&&f.forEach(h,function(n){delete o.attributes[n.name]});a&&a!==p&&(o.symbol=a.toJson());l.push(o)}return t?l:e.toJson(l)},_selectHandler:function(n,t,i,r,u){var f;r=ci;switch(t){case r.SELECTION_NEW:this.clearSelection(!0);f=!0;break;case r.SELECTION_ADD:f=!0;break;case r.SELECTION_SUBTRACT:f=!1}r=n.features;var s=this._mode,h=[],c=this.objectIdField,e,o;if(f)for(f=0;f<r.length;f++)e=r[f],o=e.attributes[c],e=s._addFeatureIIf(o,e),h.push(e),this._selectFeatureIIf(o,e,s);else for(f=0;f<r.length;f++)e=r[f],o=e.attributes[c],this._unSelectFeatureIIf(o,s),o=s._removeFeatureIIf(o),h.push(o||e);this._isSelOnly&&s._applyTimeFilter(!0);this._hasPartialSelectedFeatures=!!n.exceededTransferLimit;this._resolve([h,t,n.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",i,u);n.exceededTransferLimit&&this.onQueryLimitExceeded()},_selectFeatureIIf:function(n,t,i){var r=this._selectedFeatures,u=r[n];return u||(i._incRefCount(n),r[n]=t,this._isTable||(this._setSelectSymbol(t),t.attr("data-selected",""))),u||t},_unSelectFeatureIIf:function(n,t){var i=this._selectedFeatures[n];return i&&(t._decRefCount(n),delete this._selectedFeatures[n],this._isTable||(this._setUnSelectSymbol(i),i.attr("data-selected"))),i},_isSelected:function(){},_setSelectSymbol:function(n){var t=this._selectionSymbol;t&&!this._isSelOnly&&n.setSymbol(t)},_setUnSelectSymbol:function(n){var t=this._selectionSymbol;t&&!this._isSelOnly&&t===n.symbol&&n.setSymbol(null,!0)},_getOutFields:function(){var t=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes),t=f.filter(t,function(n,t,i){return!!n&&f.indexOf(i,n)===t}),n=u.clone(this._outFields);return n?-1!==f.indexOf(n,"*")?n:(f.forEach(t,function(t){-1===f.indexOf(n,t)&&n.push(t)}),n):t},_checkFields:function(n){var t=n||this._getOutFields();f.forEach(t,function(n){"*"!==n&&(this._getField(n)||console.debug("esri.layers.FeatureLayer: "+w.substitute({url:this.url,field:n},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);n||this._isTable||this._fserver||this._collection||this._isStream||f.some(this.fields,function(n){return n&&"esriFieldTypeGeometry"===n.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+w.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},_fixFieldCase:function(n,t,i){var r=n&&n[t],f;return r&&!u.isFunction(r)&&((f=!this._getField(r)&&this._getField(r,!0))&&(r=n[t]=f.name),i&&i.push(r)),r},_fixRendererFields:function(){var t=this.renderer;if(this._orderBy=null,this._requiredFields=[],t&&0<this.fields.length){var n=[],i,t=f.filter([t,t.observationRenderer,t.latestObservationRenderer,t.trackRenderer],w.isDefined),r=[].concat(t);f.forEach(t,function(n){f.forEach(n.rendererInfos,function(n){n.renderer&&r.push(n.renderer)})});f.forEach(r,function(t){this._fixFieldCase(t,"attributeField",n);this._fixFieldCase(t,"attributeField2",n);this._fixFieldCase(t,"attributeField3",n);this._fixFieldCase(t.rotationInfo,"field",n);(i=this._fixFieldCase(t.sizeInfo,"field",n))&&!this._orderBy&&(this._orderBy=[i+" DESC"]);this._fixFieldCase(t.sizeInfo,"normalizationField",n);this._fixFieldCase(t.colorInfo,"field",n);this._fixFieldCase(t.colorInfo,"normalizationField",n);this._fixFieldCase(t.field,"field",n);this._fixFieldCase(t.opacityInfo,"field",n);this._fixFieldCase(t.opacityInfo,"normalizationField",n);f.forEach(t.visualVariables,function(t){i=this._fixFieldCase(t,"field",n);"sizeInfo"===t.type&&i&&!this._orderBy&&(this._orderBy=[i+" DESC"]);this._fixFieldCase(t,"normalizationField",n)},this);var r=f.map(t.getFieldsUsedInExpressions(),function(n){var t=this.getField(n);return t?t.name:n},this);n=n.concat(r);!this._orderBy&&t.addBreak&&!u.isFunction(t.attributeField)&&(t.backgroundFillSymbol||this._hasSizeDiff(t))&&(this._orderBy=[t.attributeField+" DESC"])},this);this._requiredFields=f.filter(n,w.isDefined)}},_hasSizeDiff:function(n){var r=Number.MAX_VALUE,u=-Number.MAX_VALUE,t,i;return f.forEach(n.infos,function(n){if(i=n.symbol){t=0;switch(i.type){case"simplemarkersymbol":t=i.size;break;case"picturemarkersymbol":t=(i.width+i.height)/2;break;case"simplelinesymbol":case"cartographiclinesymbol":t=i.width;break;case"simplefillsymbol":case"picturefillsymbol":t=i.outline&&i.outline.width}t&&(r=Math.min(r,t),u=Math.max(u,t))}}),r!==Number.MAX_VALUE&&u!==-Number.MAX_VALUE&&1<Math.abs(u-r)},getOrderByFields:function(){var n=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&n?f.filter(n,function(n){return n=n.split(" ")[0],!!this._getField(n,!0)},this):null},_getField:function(n,t){var i=this.fields,r;return!i||0===i.length?null:(t&&(n=n.toLowerCase()),f.some(i,function(i){var u=!1;return(u=t?i&&i.name.toLowerCase()===n?!0:!1:i&&i.name===n?!0:!1)&&(r=i),u}),r)},_getDateOpts:function(){return this._dtOpts||(this._dtOpts={properties:f.map(f.filter(this.fields,function(n){return!(!n||"esriFieldTypeDate"!==n.type)}),function(n){return n.name})}),this._dtOpts},_applyNormalized:function(n,t){n&&t&&f.forEach(n,function(n,i){n&&t[i]&&n.setGeometry(t[i])})},_editHandler:function(n,t,i,r,e,o){var p,g,w,tt;e=n.addResults;p=n.updateResults;n=n.deleteResults;var s,a,l,h,c,it=this.objectIdField,b=this._mode,nt=this._isTable;s=this.editFieldsInfo;h=this.getOutFields()||[];var k=s&&s.creatorField,d=s&&s.creationDateField,v=s&&s.editorField,y=s&&s.editDateField;if(s=s&&s.realm,-1===f.indexOf(h,"*")&&(k&&-1===f.indexOf(h,k)&&(k=null),d&&-1===f.indexOf(h,d)&&(d=null),v&&-1===f.indexOf(h,v)&&(v=null),y&&-1===f.indexOf(h,y)&&(y=null)),g=d||y?(new Date).getTime():null,w=k||v?this.getUserId():void 0,w&&s&&(w=w+"@"+s),e)for(tt=this.globalIdField,s=0;s<e.length;s++)e[s]=new ni(e[s]),nt||(a=e[s],a.success&&(l=a.objectId,h=t[s],(c=h._graphicsLayer)&&c!==this&&c.remove(h),c=h.attributes||{},c[it]=l,l=a.globalId,tt&&l&&(c[tt]=l),k&&(c[k]=w),v&&(c[v]=w),d&&(c[d]=g),y&&(c[y]=g),h.setAttributes(c),b._init&&b.drawFeature(h)));if(p)for(s=0;s<p.length;s++)(p[s]=new ni(p[s]),!nt&&(a=p[s],a.success))&&(l=a.objectId,h=i[l],(t=b._getFeature(l))&&(t.geometry!==h.geometry&&h.geometry&&t.setGeometry(vt.fromJson(h.geometry.toJson())),t.attributes!==h.attributes&&h.attributes&&t.setAttributes(u.mixin(t.attributes,h.attributes)),this._repaint(t,l)),h=t||h,c=h.attributes||{},v&&(c[v]=w),y&&(c[y]=g),h.setAttributes(c));if(n){for(i=[],s=0;s<n.length;s++)(n[s]=new ni(n[s]),!nt&&(a=n[s],a.success&&(l=a.objectId,h=b._getFeature(l))))&&(this._unSelectFeatureIIf(l,b)&&i.push(h),h._count=0,b._removeFeatureIIf(l));if(0<i.length)this.onSelectionComplete(i,ci.SELECTION_SUBTRACT)}this._resolve([e,p,n],"onEditsComplete",r,o)},_sendAttachment:function(n,t,i,r,f){var e=this;return b({url:this._url.path+"/"+t+"/"+("add"===n?"addAttachment":"updateAttachment"),form:i,content:u.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(i){var u="add"===n?"onAddAttachmentComplete":"onUpdateAttachmentComplete";return i=new ni(i["add"===n?"addAttachmentResult":"updateAttachmentResult"]),i.attachmentId=i.objectId,i.objectId=t,e._resolve([i],u,r),i}).addErrback(function(n){e._resolve([n],null,f,null,!0)})},_repaint:function(n,t,i){t=w.isDefined(t)?t:n.attributes[this.objectIdField];t in this._selectedFeatures&&this._selectionSymbol||n.setSymbol(n.symbol,i)},_getKind:function(n){var t=this._trackManager;return t?t.isLatestObservation(n)?1:0:0}});return u.mixin(ci,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"}),yt._createWrappers(ci),h("extend-esri")&&u.setObject("layers.FeatureLayer",ci,p),ci})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.layers.FeatureType",constructor:function(n){var i,r,f,u;if(n&&t.isObject(n)){this.id=n.id;this.name=n.name;i=n.symbol;i&&(this.symbol=e.fromJson(i));i=n.domains;f=this.domains={};for(r in i)if(i.hasOwnProperty(r)){u=i[r];switch(u.type){case"range":f[r]=new o(u);break;case"codedValue":f[r]=new s(u);break;case"inherited":f[r]=new h(u)}}if(r=n.templates)for(i=this.templates=[],n=0;n<r.length;n++)i.push(new c(r[n]))}},toJson:function(){var r={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},n,t=this.domains,e=this.templates,o=f.fixJson,u;if(t){u=r.domains={};for(n in t)t.hasOwnProperty(n)&&(u[n]=t[n]&&t[n].toJson());o(u)}return e&&(r.templates=i.map(e,function(n){return n.toJson()})),o(r)}}),r("extend-esri")&&t.setObject("layers.FeatureType",n,u),n})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(n){n&&t.isObject(n)&&(this.name=n.name,this.description=n.description,this.drawingTool=n.drawingTool,this.thumbnail=n.thumbnail,n=n.prototype,this.prototype=new f(n.geometry,null,n.attributes))},toJson:function(){return u.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:u.fixJson(t.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}}),t.mixin(n,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"}),i("extend-esri")&&t.setObject("layers.FeatureTemplate",n,r),n})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(n){n&&t.isObject(n)&&(this.objectId=n.objectId,this.globalId=n.globalId,this.success=n.success,n.success||(n=n.error,this.error=Error(),this.error.code=n.code,this.error.message=n.description))}}),i("extend-esri")&&t.setObject("layers.FeatureEditResult",n,r),n})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode ../srUtils".split(" "),function(n,t,i,r,u,f,e,o){return n=n([e],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5e4,constructor:function(n){this.featureLayer=n;this.pagination=n.queryPagination;this._featureMap={};this._hasPartialFeatures=!1;this._drawFeatures=t.hitch(this,this._drawFeatures);this._queryErrorHandler=t.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(n){this._init&&(n?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id = "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(n){var t=n.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(t,n);this._incRefCount(t)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var n=this.featureLayer;n._collection?(n._fireUpdateStart(),n._refresh(!0),n._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},_getRequestId:function(n){return("_"+n.name+n.layerId+n._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var n=this.featureLayer;n._collection||n.suspended||!n.isQueryable()||(n._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,this._sendRequest())},_sendRequest:function(n){var u=this.map,t=this.featureLayer,e=t.getDefinitionExpression(),i=new f,r;i.outFields=t.getOutFields();i.where=e||"1=1";i.returnGeometry=!0;i.outSpatialReference=o.createSpatialReference(u.spatialReference.toJson());i.timeExtent=t.getTimeDefinition();i.maxAllowableOffset=t._maxOffset;i.quantizationParameters=t._quantizationParameters;t._ts&&(i._ts=(new Date).getTime());i.orderByFields=t.supportsAdvancedQueries?t.getOrderByFields():null;i.multipatchOption=t.multipatchOption;this.pagination&&(this._start=i.start=null==n?0:n,i.num=t.maxRecordCount);t._usePatch&&(r=this._getRequestId(t),this._cancelPendingRequest(null,r));t._task.execute(i,this._drawFeatures,this._queryErrorHandler,r)},_drawFeatures:function(n){var i,e,f,o;this._purgeRequests();var u=n.features,t=this.featureLayer,h=t.objectIdField,r,c=u.length,s=n.exceededTransferLimit&&!t._collection,l=t._selectedFeatures,a=t.mode===t.constructor.MODE_AUTO;for(r=u?u.length:0,i=t.graphics.length+r,e=i>=this.maxFeatures,t._fireUpdateStart(),e&&(i-=this.maxFeatures)&&u.splice(r-i,i),t._sortFeatures(u),r=0;r<c;r++)f=u[r],o=f.attributes[h],i=this._addFeatureIIf(o,f),this._incRefCount(o),a&&i!==f&&l[o]&&(i.setGeometry(f.geometry),i.setAttributes(f.attributes));this._applyTimeFilter(!0);this.pagination&&s&&!e||(this._hasPartialFeatures=!!n.exceededTransferLimit,t._fireUpdateEnd(null,n.exceededTransferLimit?{queryLimitExceeded:!0}:null));s&&(this.pagination&&!e&&this._sendRequest(this._start+t.maxRecordCount),t.onQueryLimitExceeded())},_queryErrorHandler:function(n){this._purgeRequests();this._hasPartialFeatures=!0;var t=this.featureLayer;t._errorHandler(n);t._fireUpdateEnd(n)}}),i("extend-esri")&&t.setObject("layers._SnapshotMode",n,r),n})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),function(n,t,i,r,u,f,e){return t=t(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(n._scopeName||"dojo")+"IoScript"},initialize:function(n){this.map=n;this._init=!0},startup:function(){},propertyChangeHandler:function(){},destroy:function(){this._init=!1},drawFeature:function(){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},_incRefCount:function(n){(n=this._featureMap[n])&&n._count++},_decRefCount:function(n){(n=this._featureMap[n])&&n._count--},_getFeature:function(n){return this._featureMap[n]},_addFeatureIIf:function(n,t){var i=this._featureMap,r=i[n],u=this.featureLayer;return r||(i[n]=t,u._add(t),t._count=0),r||t},_removeFeatureIIf:function(n){var t=this._featureMap[n],i=this.featureLayer;if(t){if(t._count)return;delete this._featureMap[n];i._remove(t)}return t},_clearIIf:function(){var n,t,i;n=this.featureLayer;var r=n.graphics,u=n._selectedFeatures,t=n.getSelectedFeatures().length,f=n.objectIdField;if(t)for(n=r.length-1;0<=n;n--)t=r[n],i=t.attributes[f],i in u?t._count=1:(t._count=0,this._removeFeatureIIf(i));else n.clear(),this._featureMap={}},_isPending:function(n){return f[this._prefix+n]?!0:!1},_cancelPendingRequest:function(n,t){if(n=n||f[this._prefix+t])try{n.cancel();f._validCheck(n)}catch(i){}},_purgeRequests:function(){f._validCheck(null)},_toggleVisibility:function(n){var i=this.featureLayer,u=i.graphics,f=n?"show":"hide",t,e=u.length,r;for(n=n&&i._ager,t=0;t<e;t++)r=u[t],r[f](),n&&i._repaint(r)},_applyTimeFilter:function(n){var t=this.featureLayer,i,u,f;t.timeInfo&&!t.suspended&&(n||t._fireUpdateStart(),i=t._trackManager,i&&i.clearTracks(),u=t.getTimeDefinition(),f=t._getOffsettedTE(t._mapTimeExtent),f?(f=t._getTimeOverlap(u,f))?(u=t._filterByTime(t.graphics,f.startTime,f.endTime),i&&i.addFeatures(u.match),r.forEach(u.match,function(n){var i=n._shape;n.visible||(n.show(),(i=n._shape)&&i._moveToFront());t._ager&&i&&t._repaint(n)}),r.forEach(u.noMatch,function(n){n.visible&&n.hide()})):this._toggleVisibility(!1):(i&&i.addFeatures(t.graphics),this._toggleVisibility(!0)),i&&(i.moveLatestToFront(),i.drawTracks()),n||t._fireUpdateEnd())}}),u("extend-esri")&&i.setObject("layers._RenderMode",t,e),t})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n([s],{declaredClass:"esri.layers._OnDemandMode",constructor:function(n){this.featureLayer=n;this._featureMap={};this._hasPartialFeatures=!1;this._queryErrorHandler=i.hitch(this,this._queryErrorHandler)},initialize:function(n){this.inherited(arguments);var i=this.featureLayer,t=i._srInfo;this._gridLayer=new h(new e(t?t.valid[0]:n.extent.xmin,t?t.valid[1]:n.extent.ymax,n.spatialReference),{width:i._tileWidth,height:i._tileHeight},{width:n.width,height:n.height},t);this._cellMap={};this._gridLayer.setResolution(n.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(n){this._init&&(2>n?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id = "+this.featureLayer.id+", Layer URL = "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(n){var t=n.geometry,o=[];if(t)for(var o=this._gridLayer.getCellsInExtent("point"===t.type?{xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y}:t.getExtent(),!1).cells,t=this._cellMap,i,s=n.attributes[this.featureLayer.objectIdField],f,r,e,u=0;u<o.length;u++)i=o[u],f=i.latticeID,r=i.row,e=i.col,f?i=t[f]=t[f]||i:(t[r]=t[r]||{},i=t[r][e]=t[r][e]||i),i.features=i.features||[],i.features.push(n),this._addFeatureIIf(s,n),this._incRefCount(s)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){if(this._hasPartialFeatures)return!0;for(var t=!1,i=this._getCurrentCells(),n=0;n<i.length;n++)if(i[n].hasPartialFeatures){t=!0;break}return!t},_enableConnectors:function(){var n=this.map;this._zoomConnect=t.connect(n,"onZoomEnd",this,this._zoomHandler);this._panConnect=t.connect(n,"onPanEnd",this,this._panHandler);this._resizeConnect=t.connect(n,"onResize",this,this._panHandler)},_disableConnectors:function(){t.disconnect(this._zoomConnect);t.disconnect(this._panConnect);t.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var n=this.featureLayer,t=this.map;!n.suspended&&n.isQueryable()&&(n._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,(n=n._trackManager)&&n.clearTracks(),this._cellMap={},this._gridLayer.setResolution(t.extent),this._sendRequest())},_panHandler:function(n){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var t=this.featureLayer._resized;n=t?n:null;t&&this._gridLayer.setMapState(n,this.map.width,this.map.height);this._sendRequest(n)}},_getRequestId:function(n,t){return("_"+n.name+n.layerId+n._ulid+"_"+t.resolution+"_"+(t.latticeID||t.row+"_"+t.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(n){var t,s,u;this._exceeds=!1;t=this.featureLayer;u=this.map;n=n||u.extent;u=this._gridLayer.getCellsInExtent(n,t.latticeTiling).cells;t.isEditable()||(s=this._cellMap,u=r.filter(u,function(n){if(n.lattice){if(s[n.latticeID])return!1}else if(s[n.row]&&s[n.row][n.col])return!1;return!0}));var c=t.getOutFields(),l=t.getDefinitionExpression(),a=t._getOffsettedTE(t._mapTimeExtent),v=t.supportsAdvancedQueries?t.getOrderByFields():null,y=t._usePatch,p=this._ioQueue,h,w=this,b=this._drawFeatures,f,i,e;for(this._pending=this._pending||0,h=0;h<u.length;h++)(f=u[h],i=new o,i.geometry=f.extent||f.lattice,i.outFields=c,i.where=l,t.latticeTiling&&f.extent&&(i.spatialRelationship=o.SPATIAL_REL_CONTAINS),i.returnGeometry=!0,i.timeExtent=a,t._ts&&(i._ts=(new Date).getTime()),i.orderByFields=v,i.multipatchOption=t.multipatchOption,i.maxAllowableOffset=t._maxOffset,i.quantizationParameters=t._quantizationParameters,(e=t.advancedQueryCapabilities)&&e.supportsQueryWithResultType&&(i.resultType="tile"),e=null,y&&(e=this._getRequestId(t,f),this._isPending(e)))||(this._pending++,p.push(t._task.execute(i,function(){var n=f;return function(t){b.apply(w,[t,n])}}.call(this),this._queryErrorHandler,e)));this._removeOldCells(n);this._endCheck()},_drawFeatures:function(n,t){t.hasPartialFeatures=!!n.exceededTransferLimit;this._exceeds=this._exceeds||n.exceededTransferLimit;this._finalizeIO();var r=this.featureLayer,o=this.map.extent,s=t.extent,i=t.row,h=t.col,a=r.objectIdField,e=n.features,c=this._gridLayer,u=this._cellMap,f=t.latticeID,l=f?u[f]:u[i]&&u[i][h];if(t.resolution==c._resolution&&(f?f===c.getLatticeID(o):c.intersects(s,o)))if(l)r._sortFeatures(e),this._updateCell(l,e);else for(r._sortFeatures(e),t.features=e,f?u[f]=t:(u[i]=u[i]||{},u[i][h]=t),o=e.length,r=0;r<o;r++)s=e[r],i=s.attributes[a],this._addFeatureIIf(i,s),this._incRefCount(i);else l&&this._removeCell(i,h,f);this._endCheck()},_queryErrorHandler:function(n){this._finalizeIO();this._hasPartialFeatures=!0;this.featureLayer._errorHandler(n);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(n){if(0===this._pending){this._processIOQueue();var t=this.featureLayer,i=t._trackManager;i&&(i.clearTracks(),i.addFeatures(t.graphics),t._ager&&r.forEach(t.graphics,function(n){n._shape&&t._repaint(n)}),i.moveLatestToFront(),i.drawTracks());this.featureLayer._fireUpdateEnd(n&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);this._exceeds&&t.onQueryLimitExceeded()}},_processIOQueue:function(n){this._ioQueue=r.filter(this._ioQueue,function(n){return-1<n.fired?!1:!0});n&&r.forEach(this._ioQueue,this._cancelPendingRequest)},_getCurrentCells:function(n){var i=[],r,t;n=n||this._cellMap;for(r in n)n.hasOwnProperty(r)&&(t=n[r],t&&(t.hasOwnProperty("row")||t.hasOwnProperty("latticeID")?i.push(t):"object"==typeof t&&i.push.apply(i,this._getCurrentCells(t))));return i},_removeOldCells:function(n){var i=this._cellMap,s=this._gridLayer,t,r;for(t in i)if(i[t]){var u=i[t],f=u.latticeID,e=0,o=0;if(f)e++,f!==s.getLatticeID(n)&&(this._removeCell(null,null,f),o++);else for(r in u)u[r]&&(e++,s.intersects(u[r].extent,n)||(this._removeCell(t,r),o++));o===e&&delete i[t]}},_updateCell:function(n,t){var f=this.featureLayer,o=f.objectIdField,f=f._selectedFeatures,r,s=t.length;for(n.features=n.features||[],r=0;r<s;r++){var i=t[r],e=i.attributes[o],u=this._addFeatureIIf(e,i);u===i?(this._incRefCount(e),n.features.push(u)):e in f||(u.setGeometry(i.geometry),u.setAttributes(i.attributes))}},_removeCell:function(n,t,i){var r=this._cellMap,u=this.featureLayer,e=u.objectIdField,f=i?r[i]:r[n]&&r[n][t];if(f)for(i?delete r[i]:delete r[n][t],n=f.features,t=0;t<n.length;t++)i=n[t].attributes[e],this._decRefCount(i),i in u._selectedFeatures||this._removeFeatureIIf(i)}}),u("extend-esri")&&i.setObject("layers._OnDemandMode",n,f),n})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(null,{declaredClass:"esri.layers._GridLayout",constructor:function(n,t,i,r){this.origin=n;this.cellWidth=t.width;this.cellHeight=t.height;this.mapWidth=i.width;this.mapHeight=i.height;this.srInfo=r},setResolution:function(n){this._resolution=(n.xmax-n.xmin)/this.mapWidth;this.srInfo&&(n=Math.round(Math.round(2*this.srInfo.valid[1]/this._resolution)/this.cellWidth),this._frameStats=[n,0,n-1])},setMapState:function(n,t,i){this.mapWidth=t;this.mapHeight=i;this.setResolution(n)},getCellCoordinates:function(n){var t=this._resolution,i=this.origin;return{row:Math.floor((i.y-n.y)/(this.cellHeight*t)),col:Math.floor((n.x-i.x)/(this.cellWidth*t))}},normalize:function(n){var t=this._frameStats;if(t){var i=t[0],r=t[1],t=t[2];n<r?(n%=i,n=n<r?n+i:n):n>t&&(n%=i)}return n},intersects:function(n,t){var r=this.srInfo;return r?i.some(t._getParts(r),function(t){return n.intersects(t.extent)}):n.intersects(t)},getCellExtent:function(n,t){var r=this._resolution,i=this.origin,u=this.cellWidth,f=this.cellHeight;return new e(t*u*r+i.x,i.y-(n+1)*f*r,(t+1)*u*r+i.x,i.y-n*f*r,s.createSpatialReference(i.spatialReference.toJson()))},getLatticeID:function(n){var t=this.getCellCoordinates({x:n.xmin,y:n.ymax}),i=this.getCellCoordinates({x:n.xmax,y:n.ymin});n=t.row;var r=i.row,t=this.normalize(t.col),i=this.normalize(i.col);return n+"_"+r+"_"+t+"_"+i},sorter:function(n,t){return n<t?-1:1},getCellsInExtent:function(n,t){for(var s=this.getCellCoordinates({x:n.xmin,y:n.ymax}),h=this.getCellCoordinates({x:n.xmax,y:n.ymin}),a=s.row,v=h.row,s=s.col,h=h.col,c=[],f,l,u=[],e=[],p,w,b,k,y=[],r=a;r<=v;r++)for(f=s;f<=h;f++)l=this.normalize(f),n=this.getCellExtent(r,l),i.some(c,function(n){return n.row===r&&n.col===l})||c.push({row:r,col:l,extent:n,resolution:this._resolution}),t&&(u.push(n.xmin,n.xmax),e.push(n.ymin,n.ymax));for(s=this.normalize(s),h=this.normalize(h),u.sort(this.sorter),e.sort(this.sorter),f=u.length,r=f-1;0<=r;r--)r<f-1&&u[r]===u[r+1]&&u.splice(r,1);for(f=e.length,r=f-1;0<=r;r--)r<f-1&&e[r]===e[r+1]&&e.splice(r,1);if(u.length&&e.length){for(p=u[0],w=u[u.length-1],b=e[0],k=e[e.length-1],f=u.length,r=0;r<f;r++)y.push([[u[r],k],[u[r],b]]);for(f=e.length,r=0;r<f;r++)y.push([[p,e[r]],[w,e[r]]]);u=new o({paths:y,spatialReference:this.origin.spatialReference.toJson()});c.push({latticeID:a+"_"+v+"_"+s+"_"+h,lattice:u,resolution:this._resolution})}return{minRow:a,maxRow:v,minCol:s,maxCol:h,cells:c}}}),r("extend-esri")&&t.setObject("layers._GridLayout",n,u),n})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(n,t,i,r,u){return n=n([u],{declaredClass:"esri.layers._SelectionMode",constructor:function(n){this.featureLayer=n;this._featureMap={}},propertyChangeHandler:function(n){this._init&&0===n&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures}}),i("extend-esri")&&t.setObject("layers._SelectionMode",n,r),n})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n([h],{declaredClass:"esri.layers._StreamMode",constructor:function(n){this.featureLayer=n;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=t.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;n.purgeOptions&&n.purgeOptions.age&&"number"==typeof n.purgeOptions.age&&(this._maxFeatureAge=1e3*Math.ceil(60*n.purgeOptions.age));this._drawFeatures=t.hitch(this,this._drawFeatures);this._queryErrorHandler=t.hitch(this,this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(n){this._init&&(0===n?this._applyTimeFilter():3===n?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id = "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(n){var t=this.featureLayer,i=t.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));t._joinField&&this._getFeature(n.attributes[i])?this._drawBuffer.updates.push({oid:n.attributes[i],updates:n}):this._drawBuffer.adds.push(n)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var n=this.featureLayer;n&&(n._relatedUrl||n._keepLatestUrl?(n._fireUpdateStart(),n._refreshing=!0,n.disconnect(),n.clear(),n._relatedQueried=!1,n._keepLatestQueried=!1,n.connect()):(n._fireUpdateStart(),n.clear(),n._fireUpdateEnd()))},_drawFeatures:function(n,t){this._purgeRequests();var i=this.featureLayer;i._create(n.features||[]);i._fireUpdateEnd(null,t)},_applyTimeFilter:function(){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(n){var t=this.featureLayer,r=t.objectIdField;n&&i.forEach(n,function(n){n=n.attributes[r];t._unSelectFeatureIIf(n,this);this._decRefCount(n);this._removeFeatureIIf(n)},this)},_addFeatures:function(n){var u=this.featureLayer,s=u._endTimeField,o=u._startTimeField,r,h,t,c=[],f=[],e=[];if(r=u._trackManager,h=u.objectIdField,r)for(t in n=r.addFeatures(n),n)n.hasOwnProperty(t)&&(c.push(t),n[t].adds&&(f=f.concat(n[t].adds)),n[t].deletes&&(e=e.concat(n[t].deletes)));else f=n;i.forEach(f,function(n){var i=n.attributes[h],t;t=s&&n.attributes[s];!t&&this._maxFeatureAge&&(t=o&&n.attributes[o]?n.attributes[o]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);t&&(t=1e3*Math.ceil(t/1e3),this._featuresByTime[t]?this._featuresByTime[t].push(i):this._featuresByTime[t]=[i]);this._addFeatureIIf(i,n);this._incRefCount(i)},this);e.length&&this._removeFeatures(e);r&&r.refreshTracks(c)},_updateFeatures:function(n){var t=this.featureLayer,r,u,f=[];r=t._trackManager;u=t._trackIdField;i.forEach(n,function(n){var i=n.updates,e;if(n=this._getFeature(n.oid),n){i.geometry&&n.setGeometry(i.geometry);i=i.attributes||{};for(e in i)i.hasOwnProperty(e)&&(n.attributes[e]=i[e]);n.setAttributes(n.attributes);n.visible=this._checkFeatureTimeIntersects(n);r&&n.attributes[u]?f.push(n.attributes[u]):t._repaint(n,null,!0)}},this);f.length&&r.refreshTracks(f)},_redrawAllTracks:function(){var n=this.featureLayer._trackManager,t;n&&(t=n.trimTracks())&&0<t.length&&(this._removeFeatures(t),n.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var n=this._drawBuffer,t=n.adds.splice(0,n.adds.length),i=n.updates.splice(0,n.updates.length),n=this.featureLayer;if(!n)return!1;n.updating||n._fireUpdateStart();this._addFeatures(t);this._updateFeatures(i);(t=this._getExpiredFeatures())&&t.length&&(this._removeFeatures(t),n._trackManager&&n._trackManager.removeFeatures(t));n._purge();n._fireUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var t=this._timeoutId,n=this._drawBuffer,i=n.adds,n=n.updates;t&&clearTimeout(t);i.splice(0,i.length);n.splice(0,n.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1e3*Math.ceil(Date.now()/1e3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(n){n=n||0===n?n:200;0>n&&(n=200);this._refreshRate=n},_checkFeatureTimeIntersects:function(n){var t=this.featureLayer,i=t.getMap();return(i=i?i.timeExtent:null)&&t.timeInfo&&(t.timeInfo.startTimeField||t.timeInfo.endTimeField)?0<t._filterByTime([n],i.startTime,i.endTime).match.length:!0},_getRequestId:function(n){return("_"+n.name+n.layerId+n._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(n){function h(n){y++;l.execute(t).then(function(t){n(null,t)},function(t){n(t)})}function c(n,i){if(n)y>=w||!r._relatedUrl?u._queryErrorHandler(Error("Could not get features from related feature service")):(p={relatedFeatureWarning:"Querying related feature service using the current filter failed. All related features are displayed, and the filter is applied to the stream service only"},t.where="1=1",h(c));else{var f=u._fixFieldNameCasing(r,i);i.features=f;u._drawFeatures(i,p)}}var r=this.featureLayer,l,t,i,a,v;if(r._fireUpdateStart(),n&&this.map){l=new o(n);t=new e;n=this.map;i=r.getFilter()||{};a=i.where||"1=1";v=i.geometry?s.fromJson(i.geometry):null;i=i.outFields?i.outFields.split(","):["*"];t.geometry=v;t.where=a;t.outFields=i;t.returnGeometry=!0;t.outSpatialReference=new f(n.spatialReference.toJson());r._usePatch&&(n=this._getRequestId(r),this._cancelPendingRequest(null,n));var y=0,w=2,u=this,p=null;h(c)}else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),!1},_queryErrorHandler:function(n){this._purgeRequests();var t=this.featureLayer;t._errorHandler(n);t._fireUpdateEnd(n)},_fixFieldNameCasing:function(n,t){var i=t.features||[],r=t.fields;if(!r||!i.length)return i;for(var r=this._mapFieldNameDifferences(n.fields,r),e=[],u,o,f=0,s=t.features.length;f<s;f++)u=i[f],o=this._swizzleResponseAttributes(u.attributes,r),e.push({geometry:u.geometry,attributes:o});return e},_mapFieldNameDifferences:function(n,t){for(var e=[],o={},u,f,i=0,r=t.length;i<r;i++)e.push(t[i].name);for(i=0,r=n.length;i<r;i++)u=n[i].name,f=this._checkForStreamFieldName(u,e),f&&(o[f]=u);return o},_checkForStreamFieldName:function(n,t){for(var u=n.toLowerCase(),r,i=0,f=t.length;i<f;i++)if(t[i].toLowerCase()===u){r=t[i];break}return r},_swizzleResponseAttributes:function(n,t){var r={},i,u;for(i in n)n.hasOwnProperty(i)&&(u=n[i],t.hasOwnProperty(i)?r[t[i]]=u:r[i]=u);return r},_getExpiredFeatures:function(){var n,r,t,u=[],f=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return f;if(n=1e3*Math.floor(this._lastEndTimeCheck/1e3),this._lastEndTimeCheck=r=1e3*Math.ceil(Date.now()/1e3),n&&n!==r)for(t=this._featuresByTime;n<=r;n+=1e3)t[n]&&(u=u.concat(t[n]),delete t[n]);return i.forEach(u,function(n){(n=this._getFeature(n))&&f.push(n)},this),f}}),r("extend-esri")&&t.setObject("layers._StreamMode",n,u),n})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c=-1!==f.renderer.toLowerCase().indexOf("canvas");return n=n(null,{declaredClass:"esri.layers._TrackManager",constructor:function(n){this.layer=n;this.trackMap={};this.trackLineMap={}},initialize:function(n){var r,e;this.map=n;var i=this.layer,f=i._getRenderer(),f=f&&f.trackRenderer;if("esriGeometryPoint"===i.geometryType){r=this.container=new h._GraphicsLayer({id:i.id+"_tracks",_child:!0,visible:i.visible,minScale:i.minScale,maxScale:i.maxScale});r.loaded=!0;r.onLoad(r);r._setMap(n,i._div);c||(n=r._div.getNode(),e=i._div.getNode(),n&&e&&u.place(n,e,"first"));r.setRenderer(f);i.on("visibility-change",t.hitch(this,function(n){this.container.setVisibility(n.visible);this.container.evaluateSuspension()}));i.on("scale-range-change",t.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))}},addFeatures:function(n){var t=this.trackMap,r=this.layer,o=r._trackIdField,u=[];i.forEach(n,function(n){var r=n.attributes[o];(t[r]=t[r]||[]).push(n);-1===i.indexOf(u,r)&&u.push(r)});var f=r._startTimeField,e=r.objectIdField,s=function(n,t){var i=n.attributes[f],r=t.attributes[f];return i===r?n.attributes[e]<t.attributes[e]?-1:1:i<r?-1:1};i.forEach(u,function(n){t[n].sort(s)})},trimTracks:function(n){function f(n){for(n=t[n]||[];n.length>e;)r.push(n.shift())}var t=this.trackMap,e=this.layer.maximumTrackPoints||0,r=[],u;if(!e)return r;if(n)i.forEach(n,function(n){f(n)});else for(u in t)t.hasOwnProperty(u)&&f(u);return r},drawTracks:function(n){function e(n){var f=t[n],e,i,l;if(i=r.trackLineMap[n],u.remove(i),delete r.trackLineMap[n],i=null,!f||2>f.length)return!1;for(i=[],e=f.length-1;0<=e;e--)(l=f[e].geometry)&&i.push([l.x,l.y]);f={};f[c]=n;1<i.length&&(i=new o(new s({paths:[i],spatialReference:h}),null,f),u.add(i),r.trackLineMap[n]=i)}var r=this,u=this.container,t,h,c,f;if(u)if(t=this.trackMap,h=this.map.spatialReference,c=this.layer._trackIdField,n)i.forEach(n,function(n){e(n)});else for(f in t)t.hasOwnProperty(f)&&e(f)},refreshTracks:function(n){function u(n){var r,i;if(o.drawTracks([n]),e&&e.latestObservationRenderer)for(n=t[n]||[],r=n.length,i=0;i<r;i++)f._repaint(n[i],null,!0)}var o=this,t=this.trackMap,f=this.layer,e=f._getRenderer(),r;if(n)i.forEach(n,function(n){u(n)});else for(r in t)t.hasOwnProperty(r)&&u(r);this.moveLatestToFront()},moveLatestToFront:function(n){i.forEach(this.getLatestObservations(n),function(n){var t=n._shape;t&&t._moveToFront();this._repaint(n,null,!0)},this.layer)},getLatestObservations:function(n){function f(n){return n=r[n],n[n.length-1]}var t=[],e=this.layer._getRenderer(),r=this.trackMap,u;if(!e.latestObservationRenderer)return t;if(n)i.forEach(n,function(n){t.push(f(n))});else for(u in r)r.hasOwnProperty(u)&&t.push(f(u));return t},clearTracks:function(n){var u=this.getLatestObservations(n),t=this.container,r;n?i.forEach(n,function(n){delete this.trackMap[n];t&&(r=this.trackLineMap[n],t.remove(r),delete this.trackLineMap[n])},this):(this.trackMap={},this.trackLineMap={},t&&t.clear());i.forEach(u,function(n){this._repaint(n,null,!0)},this.layer)},isLatestObservation:function(n){var t=this.trackMap[n.attributes[this.layer._trackIdField]];return t?t[t.length-1]===n:!1},destroy:function(){var n=this.container;n&&(n.clear(),n._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}}),r("extend-esri")&&t.setObject("layers._TrackManager",n,e),n})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){}function y(n){var t=n.layer;return{geometry:n.geometry,attributes:n.attributes,getLayer:function(){return t}}}return n=n(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(n){this.sourceLayer=n;this._hndls=[]},initialize:function(n){var f,r,i;this.map=n;f=this.sourceLayer;r=f.renderer;f.setDrawMode(!1);this.imageLayer=n._getMapImageLyr();i=this;this.heatmapRenderer=r instanceof c?r:(r.getRendererInfoByZoom(n.getZoom())||r.getRendererInfoByScale(n.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);u(["../workers/heatmapCalculator"],function(n){i._calculator=new n(t.mixin({width:i.map.width,height:i.map.height},i._getOptions()));i._setupRenderer();i.heatmapRenderer.getStats=n.calculateStats;i.heatmapRenderer.getHistogramData=n.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(n){var t=n.renderer,i=t instanceof c;this.heatmapRenderer?i?this.heatmapRenderer=t:this._removeRenderer(n):i&&(this.heatmapRenderer=t,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(n){n=n.opacity;var t=this._getImageBySourceId(this.sourceLayer.id);t&&t.setOpacity(n)},_setupRenderer:function(){var u=this._hndls,n=this.sourceLayer,f=this.map,t=this;n._originalDraw=n._draw;n._draw=v;n._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),250);u.push(n.on("update-end",this._setupDraw));u.push(n.on("suspend",function(n){(n=t._getImageBySourceId(t.sourceLayer.id))&&n.hide()}));u.push(n.on("resume",function(n){(n=t._getImageBySourceId(t.sourceLayer.id))&&n.show()}));u.push(i.after(n,"redraw",this._setupDraw));u.push(f.on("layer-remove",function(i){i.layer==n&&((i=t._getImageBySourceId(t.sourceLayer.id))&&t.imageLayer.removeImage(i),t._removeRenderer({target:n}))}));n._collection&&u.push(n.on("graphic-add",function(n){t._reprojectFeature(n.graphic);t._setupDraw()}));1!==n.mode&&(u.push(f.on("resize, pan-end",this._setupDraw)),u.push(f.on("zoom-end",this._setupDraw)));u.push(n.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();n.graphics&&n.graphics.length&&(n.graphics[0].geometry&&!f.spatialReference.equals(n.graphics[0].geometry.spatialReference)&&r.forEach(n.graphics,function(n){this._reprojectFeature(n)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var n=this;this._drawTimer=setTimeout(function(){clearTimeout(n._drawTimer);n._drawTimer=null;n.sourceLayer._getRenderer().isInstanceOf(c)&&n.recalculateHeatmap()},16)}},_removeRenderer:function(n){var t=n.target,i;t._draw=t._originalDraw;delete t._originalDraw;t.setDrawMode(!0);this._removeHandlers();this._hndls=[];i=this._getImageBySourceId(this.sourceLayer.id);i&&this.imageLayer.removeImage(i);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;t.renderer!=n.renderer&&t.renderer.getRendererInfo?this.heatmapRenderer=null:(t.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(n){if(n&&n.geometry){var t=n.geometry,i=this.map.spatialReference;i.equals(t.spatialReference)||(t=s.project(t,i),null==t?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):n.geometry=t)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var n=this.sourceLayer,i=this.map,c=this.heatmapRenderer,r=this.map.extent,f=this.map.width,e=this.map.height,a=this._calculator,u=this,o=function(o){o=u._getScreenPoints(o.features,i,n);o=a.calculateImageData(t.mixin({screenPoints:o,mapinfo:{extent:[r.xmin,r.ymin,r.xmax,r.ymax],resolution:i.getResolution()},width:f,height:e},u._getOptions()));o=c.getSymbol(y({geometry:i.extent,attributes:{size:[f,e],imageData:o},layer:n}));o=new h({extent:i.extent,href:o.url,opacity:0,sourceId:n.id});u._swapMapImages(o,u._getImageBySourceId(n.id));n.suspended&&o.hide()},s={geometry:i.extent,timeExtent:n.useMapTime?i.timeExtent:void 0,spatialRelationship:l.SPATIAL_REL_INTERSECTS};null!=n._canDoClientSideQuery(s)?n.queryFeatures(s,o):o({features:n.graphics})},_getScreenPoints:function(n,t,i){var c=[],l=n.length,v=0,u=0,e,s=new o(t.extent.xmin,t.extent.ymax,t.spatialReference),h=t.toScreen(s),y=h.x,h=h.y,a=t.getResolution(),f;for((u=t.extent.getCacheValue("_parts"))&&(f=r.map(u,function(n){return i._intersects(t,n.extent)[0]}));l--;)u=n[l],u.geometry&&(e={x:Math.ceil((u.geometry.x-s.x)/a+y),y:Math.floor((s.y-u.geometry.y)/a-h),attributes:u.attributes},f&&(u=1<f.length&&e.x<-f[0]?f[1]:f[0],e.x+=u),c[v++]=e);return c},_getImageBySourceId:function(n){var t=this.imageLayer.getImages(),t=r.filter(t,function(t){return t.sourceId==n});if(t.length)return t[t.length-1]},_swapMapImages:function(n,t){function u(){i.removeImage(t)}var i=this.imageLayer,r=this.sourceLayer.opacity;i.addImage(n);a.anim(n._node,{opacity:r},null,null,function(){n.opacity=r});null!=t&&a.anim(t._node,{opacity:0},null,null,u)},_removeHandlers:function(){if(null!=this._hndls)for(var n=this._hndls.length;n--;)this._hndls[n].remove()},_getOptions:function(){var n=this.heatmapRenderer;return{blurRadius:n.blurRadius,gradient:n.gradient,maxPixelIntensity:n.maxPixelIntensity,minPixelIntensity:n.minPixelIntensity,field:n.field,fieldOffset:n.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);this._resetTimer=null;for(var t=this.sourceLayer.graphics,i=t.length,n;i--;)n=t[i],n._shape=n._offsets=void 0}}),e("extend-esri")&&t.setObject("layers.HeatmapManager",n,f),n})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/SimpleRenderer ../../symbols/SimpleMarkerSymbol ../GraphicsLayer ./GeohashAggregation".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(f,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterSize:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_map:null,_eventHandles:null,_clusterSize:null,_renderer:null,_statisticInfos:null,_infoTemplate:null,_clusterGenerator:null,constructor:function(n){this._eventHandles=[];this.layer=n.layer;this.setAggregationInfo(n.aggregationInfo)},initialize:function(n){this._map=n;this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners()},destroy:function(){this._destroyEventListeners();this._destroyClusterGenerator();this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(n){this.aggregationInfo=n;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return this._clusterGenerator&&this._clusterGenerator.clustersEnabled},_createContainer:function(){var n=this.layer,t=new l._GraphicsLayer({_child:!0,id:n.id+"_clusters",visible:n.visible,minScale:n.minScale,maxScale:n.maxScale,infoTemplate:this._infoTemplate});t.setRenderer(this._renderer);t.loaded=!0;t.onLoad(t);return t._setMap(this._map,n._div),n._childLayer=t},_destroyContainer:function(){var n=this.container;n&&(n.clear(),n._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new a({map:this._map,layer:this.layer,clusterSize:this._clusterSize,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var n=this._clusterGenerator;n.loaded?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(n.on("load",t.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})),n.on("load-error",t.hitch(this,function(n){console.log(n.error)})));this._eventHandles.push(n.on("mode-change",t.hitch(this,function(){this.emit("mode-change")})))},_destroyClusterGenerator:function(){this._clusterGenerator&&this._clusterGenerator.destroy();this._clusterGenerator=null},_applyAggregationInfo:function(){this._applyClusterSize();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&this.redraw()},_applyClusterSize:function(){var n=this.aggregationInfo;this._clusterSize=n&&n.clusterSize||this.defaults.clusterSize;this._clusterGenerator&&this._clusterGenerator.setClusterSize(this._clusterSize)},_applyRenderer:function(){this._renderer=this._getRenderer(this.aggregationInfo,"avg");this._statisticInfos=this._createStatisticInfos(this._renderer,"avg");this._clusterGenerator&&this._clusterGenerator.setStatisticInfos(this._statisticInfos);this.container&&(this.container.setRenderer(this._renderer),this.emit("renderer-change"),i.forEach(this.container.graphics,function(n){n.setAttributes(n._cluster.attributes)}));this._applyInfoTemplate()},_applyInfoTemplate:function(){this._infoTemplate=this._getInfoTemplate(this.aggregationInfo,this._statisticInfos);this.container&&this.container.setInfoTemplate(this._infoTemplate)},_getRenderer:function(n,t){var i=n&&n.renderer;return i||(i=(i=this.layer&&this.layer.renderer)?this._createClusterRenderer(i,t):this._getDefaultClusterRenderer()),i},_getDefaultClusterRenderer:function(){var n=new h(new c(this.defaults.markerSymbol));return this._addSizeByCountVariable(n),n},_createClusterRenderer:function(n,t){var i,r,u;return this._isSupportedRenderer(n)?(i=new n.constructor(n.toJson()),r=t+"_",i.attributeField=r+i.attributeField,i.normalizationField&&(i.normalizationField=r+i.normalizationField),i.setVisualVariables(null),r=this._getSupportedVariables(n),u=this._createClusterVariables(r.allVars,t),i.setVisualVariables(u),r.sizeVars.length||this._addSizeByCountVariable(i),i):this._getDefaultClusterRenderer()},_isSupportedRenderer:function(n){var t=n.declaredClass.toLowerCase();return-1<t.indexOf("simplerenderer")?!0:-1<t.indexOf("classbreaksrenderer")?n.valueExpression?!1:n.isContinuousRenderer():!1},_getSupportedVariables:function(n){var t=n.getVisualVariablesForType("colorInfo",!1)||[],r=n.getVisualVariablesForType("sizeInfo",!1)||[];return n=n.getVisualVariablesForType("opacityInfo",!1)||[],t=i.filter(t,this._variableFilter),r=i.filter(r,this._variableFilter),n=i.filter(n,this._variableFilter),{colorVars:t,sizeVars:r,opacityVars:n,allVars:t.concat(r).concat(n)}},_variableFilter:function(n){return"string"==typeof n.field},_createClusterVariables:function(n,t){return i.map(n,function(n){return this._createVarForAvg(n,t)},this)},_createVarForAvg:function(n,i){var r=t.clone(n),u=i+"_";return r.field=u+r.field,r.normalizationField&&(r.normalizationField=u+r.normalizationField),this._setVariableTitle(r,n),r},_setVariableTitle:function(n,t){n.legendOptions&&n.legendOptions.title||(n.legendOptions=n.legendOptions||{},n.legendOptions.title=s.getVisualVariableTitle(t,this.layer))},_createStatisticInfos:function(n,t){var r,u;if(-1!==n.declaredClass.toLowerCase().indexOf("classbreaksrenderer"))return r=[n.attributeField,n.normalizationField],i.forEach(n.visualVariables,function(n){"count"!==n.field&&(r.push(n.field),r.push(n.normalizationField))}),r=i.filter(r,function(n){return!!n}),r.sort(),r=i.filter(r,function(n,t){return 0===t||r[t-1]!==n}),u=t+"_",i.map(r,function(n){return{field:n.replace(u,""),type:t}})},_addSizeByCountVariable:function(n){var t=this._createSizeByCountVariable();t&&this._addVariable(n,t)},_getSizeByCountVariable:function(n){return n=n.getVisualVariablesForType("sizeInfo",!1)||[],i.filter(n,function(n){return"count"===n.field})[0]},_updateSizeByCountVariable:function(){var n=this._renderer,i=this._getSizeByCountVariable(n),t;i?(t=this._createSizeByCountVariable(),t&&this._replaceVariable(n,i,t)):this._addSizeByCountVariable(n)},_createSizeByCountVariable:function(){var n=this._clusterGenerator,t;return n&&(n=n.getCurrentLodStats(),t={type:"sizeInfo",field:"count",valueUnit:"unknown",minSize:8,maxSize:50,minDataValue:n.min,maxDataValue:n.max,legendOptions:{title:"Number of features"}}),t},_addVariable:function(n,t){var i=n.visualVariables||[];i.push(t);n.setVisualVariables(i)},_replaceVariable:function(n,t,r){var u=n.visualVariables;t=i.indexOf(u,t);-1<t&&u.splice(t,1);u.push(r);n.setVisualVariables(u)},_getInfoTemplate:function(n,t){var r=n&&n.infoTemplate;if(!r){var f=this.layer,e=[{fieldName:"count",visible:!0,label:"Number of features",format:{digitSeparator:!0,places:0}}],u=[];i.forEach(t,function(n){var t=n.type+"_"+n.field;e.push({fieldName:t,visible:!0,label:"Average "+f.getFieldLabel(n.field),format:{digitSeparator:!0,places:1}});u.push("Average <b>"+f.getFieldLabel(n.field)+"<\/b> within this cluster is <b>{"+t+"}<\/b>.<br>")});r=u.length?"<br>"+u.join(""):"";r=new o({fieldInfos:e,description:"This cluster represents <b>{count}<\/b> features.<br>"+r})}return r},_removeFromPopup:function(n){var u=this._map.infoWindow,t=u.features,r=[];i.forEach(t,function(t,i){t.getLayer()===n&&r.push(i)});r.length&&(r.sort(function(n,t){return t-n}),t=t.slice(0),i.forEach(r,function(n){t.splice(n,1)}),u.setFeatures(t),t.length||u.hide())},_initClusterUpdates:function(){this._updateClusters(!0,!1);this._eventHandles.push(this._clusterGenerator.on("update-end",t.hitch(this,function(n){this._updateClusters(n.levelChange,n.modeChange)})))},_updateClusters:function(n,t){this.isClusteringEnabled()&&t&&this._removeFromPopup(this.layer);var r=i.map(this._clusterGenerator.clusters,function(n){var t=new e(n.centroid,null,n.attributes);return t._cluster=n,t});this._addGraphics(r,n)},_addGraphics:function(n,t){var r=this.container,u;r.clear();u=this.aggregationInfo&&this.aggregationInfo.renderer;t&&this.isClusteringEnabled()&&this._renderer!==u&&(this._updateSizeByCountVariable(),this.emit("renderer-change"));i.forEach(n,function(n){r.add(n)})},_createLayerEventListeners:function(){var n=this.layer;this._eventHandles.push(n.on("visibility-change",t.hitch(this,function(n){this.container.setVisibility(n.visible);this.container.evaluateSuspension()})),n.on("scale-range-change",t.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),n.on("renderer-change",t.hitch(this,function(){this._applyRenderer()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",t.hitch(this,function(){this.isClusteringEnabled()&&this._removeFromPopup(this.container);this.container.clear()})))},_destroyEventListeners:function(){i.forEach(this._eventHandles,function(n){n.remove()})}}),r("extend-esri")&&t.setObject("layers.clustering.ClusterManager",n,u),n})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","esri/lang","dojo/i18n!../../nls/jsapi"],function(n,t,i){var r=i.widgets.legend;return{getVisualVariableTitle:function(i,u){var s,e=i.field,o=i.normalizationField,h=!1,a=!1,v=!1,c,e=n.isFunction(e)?null:e,o=n.isFunction(o)?null:o,l,f;if(i.legendOptions&&i.legendOptions.title)s=i.legendOptions.title;else if(i.valueExpressionTitle)s=i.valueExpressionTitle;else{if(u.renderer&&u.renderer.authoringInfo&&u.renderer.authoringInfo.visualVariables)for(l=u.renderer.authoringInfo.visualVariables,c=0;c<l.length;c++)if(f=l[c],"colorInfo"===f.type&&"ratio"===f.style){h=!0;break}else if("colorInfo"===f.type&&"percent"===f.style){a=!0;break}else if("colorInfo"===f.type&&"percentTotal"===f.style){v=!0;break}(h=v&&"showRatioPercentTotal"||a&&"showRatioPercent"||h&&"showRatio"||o&&"showNormField"||e&&"showField"||null)&&(s=t.substitute({field:e&&u.getFieldLabel(e),normField:o&&u.getFieldLabel(o)},r[h]))}return s},getRendererTitle:function(){}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/mathUtils ./geohashUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return t=t(f,{loaded:!1,map:null,layer:null,lod:null,tolerance:null,maxLod:null,clusterMode:null,clusterSize:null,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterSize:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_maxGeohashLength:12,_minClusterSize:15,_active:!1,_levelChange:!0,_modeChange:!1,constructor:function(n){this._update=i.hitch(this,this._update);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=n.map;this.layer=n.layer;this.setLod(n.lod);this.setTolerance(n.tolerance);this.setClusterMode(n.clusterMode);this.setClusterSize(n.clusterSize);this.setSortEnabled(n.sortEnabled);this.setFilterEnabled(n.filterEnabled);this.setBufferEnabled(n.bufferEnabled);this.setUpdateEnabled(n.updateEnabled);this.setStatisticInfos(n.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",i.hitch(this,this._startup)))},destroy:function(){this._displayFeatures(!0);r.forEach(this._eventHandles,function(n){n.remove()});clearTimeout(this._updateHandle);this._cellIndex=this._globalIndex=this._eventHandles=this._updateHandle=this.map=this.layer=this.clusters=null},setLod:function(n){var t=this.lod;this.lod=n||this.defaults.lod;t!==this.lod&&this.update()},setTolerance:function(n){var t=this.tolerance;this.tolerance=n||this.defaults.tolerance;t!==this.tolerance&&this.update()},setClusterMode:function(n){var t=this.clusterMode;this.clusterMode=n||this.defaults.clusterMode;this._evalClusterParams();t!==this.clusterMode&&this.update()},setClusterSize:function(n){var t=this.clusterSize;this.clusterSize=null!=n?n:this.defaults.clusterSize;this._evalClusterParams();t!==this.clusterSize&&this.update()},setSortEnabled:function(n){var t=this.sortEnabled;this.sortEnabled=null!=n?!!n:this.defaults.sortEnabled;t!==this.sortEnabled&&this.update()},setFilterEnabled:function(n){var t=this.filterEnabled;this.filterEnabled=null!=n?!!n:this.defaults.filterEnabled;t!==this.filterEnabled&&this.update()},setBufferEnabled:function(n){var t=this.bufferEnabled;this.bufferEnabled=null!=n?!!n:this.defaults.bufferEnabled;t!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(n){var t=this.updateEnabled;(this.updateEnabled=null!=n?!!n:this.defaults.updateEnabled)&&t!==this.updateEnabled&&this.update()},setStatisticInfos:function(n){this.statisticInfos=n||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&(this._updateHandle=setTimeout(this._update,0))},isUpdateScheduled:function(){return null!=this._updateHandle},getCell:function(n){return this._cellIndex[n.length][n]},getCluster:function(n){var t;return r.some(this.clusters,function(i){return-1<r.indexOf(i.geohashes,n)&&(t=i),!!t}),t},getCellsInCluster:function(n){var t=[];return r.forEach(n&&n.geohashes,function(n){(n=this.getCell(n))&&t.push(n)},this),t},getCurrentLodStats:function(){var n=this._globalIndex.lodStats;return n&&n[this.lod]},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",i.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",i.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){var n,t;this.map.loaded&&this.layer.loaded&&("esriGeometryPoint"!==this.layer.geometryType?n=Error("GeohashAggregation is supported only for points"):(t=this.map.spatialReference,t.isWebMercator()||4326===t.wkid||(n=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))),n?(this.loadError=n,this.emit("load-error",{error:n})):(this.loaded=!0,this.emit("load")))},_startup:function(){this._evalUpdateStatus();this._processFeatures();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",i.hitch(this,this._processFeatures)),this.layer.on("suspend",i.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",i.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",i.hitch(this,this._processExtentChange)))},_processFeatures:function(){this._indexFeatures();this.update()},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(){this._evalClusterParams();this.update()},_update:function(){var t,n,i;if(this._updateHandle=null,this.updateEnabled){if(this.emit("update-start"),this._evalClustersEnabled(),this.clustersEnabled){if(n=this.map.geographicExtent,n){t=this._getIntersectingCells(n);n=this._getClusters(t.cells,n);this.clusters=n.clusters;this._applyStatInfosToClusters(this._getStatFields(this.statisticInfos));var t=t.profile,n=n.profile,r=t.total+n.total;t.total=this._getElapsedTime(t.total);n.total=this._getElapsedTime(n.total);i=this._perfProfile.lastUpdate={};i.cells=t;i.clusters=n;i.total=this._getElapsedTime(r)}}else this.clusters=[],this._perfProfile.lastUpdate=null;this.emit("update-end",{levelChange:this._levelChange,modeChange:this._modeChange});this._modeChange&&this.emit("mode-change")}},_evalClustersEnabled:function(){var n=this.clustersEnabled;(this.clustersEnabled=!(null!=this.maxLod&&this.lod>this.maxLod))&&!this._active&&(this._active=!0);this._modeChange=!1;this._active&&(n!==this.clustersEnabled||this.layer._params.drawMode===this.clustersEnabled)&&(this._modeChange=!0,this._displayFeatures(!this.clustersEnabled))},_displayFeatures:function(n){var t=this.layer;t.setDrawMode(n);n?t.redraw():t.clearNodes()},_indexFeatures:function(){var f=this._getTime(),n,u,i,t;for(this._initializeIndexing(),n=0,u=this._globalIndex.fullExtent,r.forEach(this.layer.graphics,function(t){var i=this._getLngLat(t.geometry),r;i&&(r=s.pointToGeohash(i));r&&(this._addGeohashToIndex(r,t,i),n++,this._updateExtent(u,i))},this),this._applyStatInfosToIndex(this._getStatFields(this.statisticInfos)),this._globalIndex.numFeatures=n,i=this._globalIndex.lodStats,t=1;t<=this._maxGeohashLength;t++)i[t]=this._getLODStats(t,n);this.maxLod=n?this._findMaxLOD(i):null;this._perfProfile.lastIndex.total=this._getElapsedTime(f,this._getTime());this._perfProfile.lastIndex.numFeatures=n;this.emit("index-complete")},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};for(var t=this._cellIndex=[],n=1;n<=this._maxGeohashLength;n++)t[n]={}},_getLngLat:function(n){if(n){var t=n.getLongitude();n=n.getLatitude();n=null!=t&&null!=n?{x:t,y:n}:null}return n},_addGeohashToIndex:function(n,t,i){for(var o=this._cellIndex,r="",f=0;f<this._maxGeohashLength;f++){var r=r+n[f],e=o[r.length],u=e[r];u||(u=e[r]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:r,statistics:null});this._updateItem(u,1,i,!0);u.features.push(t)}},_getLODStats:function(n,t){var e=this._cellIndex[n],r=0,u=Infinity,f=-Infinity,o=null,s,i;for(s in e)i=e[s],r++,i.count<u&&(u=i.count),i.count>f&&(f=i.count);return 0<r&&(o=Number((t/r).toFixed(2))),{lod:n,count:r,min:Infinity===u?null:u,max:-Infinity===f?null:f,avg:o}},_findMaxLOD:function(n){for(var t=this._maxGeohashLength;1<t&&n[t].count===n[t-1].count;)t--;return t-1},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var n=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterSize,this._minClusterSize);this._levelChange=this.lod!==n.lod;this.lod=n.lod;this.tolerance=n.tolerance}},_getClusterParams:function(n,t,i){t<i&&(t=i);i=Math.ceil(n*t);n=this._getClosestLODRange(i).max;var r;do r=this._getCellSize(n),t=i-r,(r=t>r||1===r)||(n+=1);while(!r);return i=t/this._getCellSize(n),{lod:n,tolerance:t,multiplier:Number(i.toFixed(2))}},_getClosestLODRange:function(n){for(var t,i=this._maxGeohashLength;1<=i;i--)if(this._getCellSize(i)>=n){t=i;break}return null==t&&(t=1),n=t+1,n>this._maxGeohashLength&&(n=this._maxGeohashLength),{min:t,max:n}},_getCellSize:function(n){return n=s.getCellSizeInMeters(n),Math.ceil(Math.min(n.width,n.height))},_sorter:function(n,t){var i=n.centroid,r=t.centroid;return n.count>t.count?-1:n.count<t.count?1:i.x>r.x?-1:i.x<r.x?1:0},_getIntersectingCells:function(n){var u=this._getTime(),t=s.getIntersecting(n,this.lod,this.bufferEnabled?this.tolerance:0);n=this._getTime();var i=[],f=this.tolerance,e=this.sortEnabled;return r.forEach(t,function(n){(n=this.getCell(n))&&i.push(n)},this),f&&e&&i.sort(this._sorter),t=this._getTime(),{cells:i,profile:{findCells:this._getElapsedTime(u,n),scanAndSortCells:this._getElapsedTime(n,t),total:t-u}}},_getClusters:function(n,t){var e=this._getTime(),i=[],o={},u={findCells:0},f;return r.forEach(n,function(n){var t=this._createCluster(n,o,u);t&&i.push(t)},this),this._markIntersecting(i,t),this.filterEnabled&&(i=this._getIntersectingClusters(i)),f=this._getTime(),{clusters:i,profile:{findCellsInCluster:this._getElapsedTime(u.findCells),total:f-e}}},_markIntersecting:function(n,t){var i=t.normalize();r.forEach(n,function(n){var t=n.centroid.x,u=n.centroid.y;n.isIntersecting=r.some(i,function(n){return t>=n.xmin&&t<=n.xmax&&u>=n.ymin&&u<=n.ymax})})},_getIntersectingClusters:function(n){return r.filter(n,function(n){return n.isIntersecting})},_createCluster:function(n,t,i){var u,f,e;if(!t[n.geohash])return u=[{cell:n,distance:0}],this.tolerance&&(f=this._getTime(),e=s.getNeighborsWithinDistance(n.centroid,this.lod,this.tolerance),i.findCells+=this._getTime()-f,r.forEach(e,function(t){if(t!==n.geohash&&(t=this.getCell(t))){var i=this._calculateDistance(n.centroid,t.centroid);i<=this.tolerance&&u.push({cell:t,distance:i})}},this)),this._mergeCells(u,t)},_calculateDistance:function(n,t){return o.getLength(s.geographicToWebMercator(n),s.geographicToWebMercator(t))},_mergeCells:function(n,t){var i=this._initializeCluster({},n[0].cell.geohash);return r.forEach(n,function(n){var u=n.cell,r=u.geohash,f;if(n=n.distance,f=t[r],f)if(n<f.distance)this._removeCellFromCluster(r,t);else return;t[r]={cluster:i,distance:n};this._updateItem(i,u.count,u.centroid);i.geohashes.push(r)},this),i},_removeCellFromCluster:function(n,t){var i=t[n].cluster,u;delete t[n];u=r.indexOf(i.geohashes,n);-1<u&&i.geohashes.splice(u,1);this._reevaluateCluster(i)},_reevaluateCluster:function(n){var t=n.geohashes;n=this._initializeCluster(n,n.primary);r.forEach(t,function(t){var i=this.getCell(t);i&&(this._updateItem(n,i.count,i.centroid),n.geohashes.push(t))},this)},_initializeCluster:function(n,t){return n.count=0,n.centroid=new e(null,null),n.geohashes=[],n.primary=t,n.statistics=null,n},_applyStatInfos:function(n){n=this._getStatFields(n);this._applyStatInfosToIndex(n);this._applyStatInfosToClusters(n)},_getStatFields:function(n){n=this._getValidStatInfos(n);var t=[];return r.forEach(n,function(n){-1===r.indexOf(t,n.field)&&t.push(n.field)}),t},_getValidStatInfos:function(n){var t=this.layer;return r.filter(n,function(n){return t.loaded&&t.isOutField(n.field)&&("sum"===n.type||"avg"===n.type)})},_applyStatInfosToIndex:function(n){var r=this._cellIndex,t,i,u;if(r)for(t=1;t<=this._maxGeohashLength;t++){i=r[t];for(u in i)this._applyStatInfosToCell(i[u],n)}},_applyStatInfosToCell:function(n,t){var i=this._initializeStats(n,t);r.forEach(n.features,function(n){this._calcFeatureStats(n,t,i)},this);this._summarizeStats(n,i,t)},_calcFeatureStats:function(n,t,i){var u=n.attributes;u&&r.forEach(t,function(n){var t=u[n];n=i[n];this._isValidNumber(t)&&(n.count++,n.sum+=t)},this)},_applyStatInfosToClusters:function(n){r.forEach(this.clusters,function(t){var i=this._initializeStats(t,n);r.forEach(this.getCellsInCluster(t),function(t){this._calcCellStats(t,n,i)},this);this._summarizeStats(t,i,n);t.attributes.clusterId=t.primary},this)},_calcCellStats:function(n,t,i){var u=n.statistics;r.forEach(t,function(n){var t=u[n];n=i[n];t.count&&(n.count+=t.count,n.sum+=t.sum)})},_initializeStats:function(n,t){var i=n.statistics={};return r.forEach(t,function(n){i[n]={count:0,sum:null,avg:null}}),i},_summarizeStats:function(n,t,i){var u=n.attributes={count:n.count};r.forEach(i,function(n){var i=t[n];0<i.count&&(i.avg=i.sum/i.count);u["sum_"+n]=i.sum;u["avg_"+n]=i.avg})},_updateItem:function(n,t,i,r){var e=i.y,u=n.centroid,f=n.count;u.x=(f*u.x+t*i.x)/(f+t);u.y=(f*u.y+t*e)/(f+t);n.count+=t;r&&this._updateExtent(n.extent,i)},_updateExtent:function(n,t){var i=t.x,r=t.y;i<n.xmin&&(n.xmin=i);i>n.xmax&&(n.xmax=i);r<n.ymin&&(n.ymin=r);r>n.ymax&&(n.ymax=r)},_isValidNumber:function(n){return"number"==typeof n&&!isNaN(n)&&Infinity!==n&&-Infinity!==n},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(n,t){var r,i;return i=null!=n&&null!=t?t-n:n,null!=i&&(r="millisecond",1e3<=i&&(i/=1e3,r="second",60<=i&&(i/=60,r="minute")),r={value:Number(i.toFixed(2)),unit:r}),r}}),n("extend-esri")&&i.setObject("layers.clustering.GeohashAggregation",t,u),t})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(n,t,i,r,u,f,e,o,s){function v(n){var t=n.spatialReference,r,i;return t?(r=t.isWebMercator(),4326===t.wkid?i={x:n.x,y:n.y}:r&&(i={x:n.getLongitude(),y:n.getLatitude()}),i):{x:n.x,y:n.y}}function y(n){var t=n.spatialReference,r=!(!t||!t.isWebMercator()),i;return t&&4326===t.wkid?i=new e(n.toJson()):r&&(i=s.webMercatorToGeographic(n,!0)),i}function p(n,t){return t.x=f.prototype._normalizeX(n.x,o.prototype._info[4326]),t.y=n.y,t}function et(n){return n=h.decimals[n].toString(2),t.pad(n,h.bitsPerBase32Char,"0")}function g(n,t){var r;t=t.slice();t.splice(1,0,0);for(var u=t[0],f=t[2],i=0;i<n.length;i++)Number(n[i])?t[0]=t[1]:t[2]=t[1],r=t[1]=(t[0]+t[2])/2,u=t[0],f=t[2];return{value:r,min:u,max:f}}function nt(n,t,i){var u=[];t=t.slice();t.splice(1,0,0);for(var r=t[0],f=t[2],e=0;e<i;e++)n>=t[1]?(t[0]=t[1],r=1):(t[2]=t[1],r=0),t[1]=(t[0]+t[2])/2,u.push(r),r=t[0],f=t[2];return{value:u.join(""),min:r,max:f}}function tt(n){var t=n*h.bitsPerBase32Char;return 0==t%2?n=t/=2:(n=(t+1)/2,t-=n),{lon:n,lat:t}}function ot(n){var i=0,t;for(n=n.split("").reverse().join(""),t=0;t<n.length;t++)i+=Number(n[t])*Math.pow(2,t);return h.base32[i]}function w(n,t){var i={x:n.xmin,y:n.ymax},r={x:n.xmax,y:n.ymin},u={x:n.xmax,y:n.ymax};return{sw:c.pointToGeohash({x:n.xmin,y:n.ymin},t),nw:c.pointToGeohash(i,t),se:c.pointToGeohash(r,t),ne:c.pointToGeohash(u,t)}}function b(n,t,i,r,u){var f=n;do u[f]||(u[f]=!0,r.push(f)),(n=f===t)||(f=l(f,i));while(!n)}function it(n,t,i,r){var u=w(n,t);for(n=[],b(u.sw,u.nw,"n",n,{}),t=[],b(u.se,u.ne,"n",t,{}),u=0;u<n.length;u++)b(n[u],t[u],"e",i,r)}function rt(n){return r.filter(n,function(n){return 180===n.xmax?!0:!1})[0]}function ut(n){return r.filter(n,function(n){return-180===n.xmin?!0:!1})[0]}function a(n,t,i,r){var u=c.geographicToWebMercator(n);return n={x:u.x-t,y:u.y-t},t=c.webMercatorToGeographic({x:u.x+t,y:u.y+t},!0),n=c.webMercatorToGeographic(n,!0),new e(null!=i?i:n.x,n.y,null!=r?r:t.x,t.y)}function k(n,t,i,r){var u,f,o,s;return n=w(n,t),"min"===r?o=180:"max"===r&&(f=-180),s=f,r=o,u=c.geohashToCell(n.sw).extent,t=c.geohashToCell(n.ne).extent,n=null!=s?s:u.xmin,u=u.ymin,r=null!=r?r:t.xmax,t=t.ymax,n=a({x:n,y:u},i,f,o),i=a({x:r,y:t},i,f,o),new e(n.xmin,n.ymin,i.xmax,i.ymax)}function ft(n,t,i){var r=n,u=0;do u++,(n=r===t)||(r=l(r,i));while(!n);return u}function d(n,t){var i=w(n,t),r=ft(i.nw,i.ne,"e");return{rows:ft(i.nw,i.sw,"s"),cols:r}}function l(n,t){var r=n.length%2,u=n.slice(-1),f=h.decimals[u],i=n.slice(0,-1);return-1!=h.borders[t][r].indexOf(u)&&i&&(i=l(i,t)),i+h.neighbors[t][r][f]}var h={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var t={},n=0;32>n;n++)t["0123456789bcdefghjkmnpqrstuvwxyz"[n]]=n;return t}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]},c;return h.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb",h.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy",h.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp",h.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx",h.borders.n[0]="prxz",h.borders.s[0]="028b",h.borders.e[0]="bcfguvyz",h.borders.w[0]="0145hjnp",c={geographicToWebMercator:function(n){return n=f.lngLatToXY(n.x,n.y),{x:n[0],y:n[1]}},webMercatorToGeographic:function(n,t){var i=f.xyToLngLat(n.x,n.y,t);return{x:i[0],y:i[1]}},geohashToCell:function(n){for(var i=[],t=0;t<n.length;t++)i.push(et(n[t]));for(var i=i.join(""),t=[],u=[],r=0;r<i.length;r++)0==r%2?t.push(i[r]):u.push(i[r]);return t=t.join(""),u=u.join(""),t=[t,u],i=g(t[0],h.longitudeRange),t=g(t[1],h.latitudeRange),{point:{x:i.value,y:t.value},extent:{xmin:i.min,xmax:i.max,ymin:t.min,ymax:t.max},geohash:n}},pointToCell:function(n,t){var i,f,e,r,u,c;if(t=t||h.maxGeohashLength,r=v(n),r){r=p(r,r);i=tt(t);e=nt(r.x,h.longitudeRange,i.lon);u=nt(r.y,h.latitudeRange,i.lat);i=e.value;f=u.value;e={xmin:e.min,xmax:e.max,ymin:u.min,ymax:u.max};for(var u=[],s=Math.ceil((i.length+f.length)/h.bitsPerBase32Char),o=0,l=0,a=0;a<s*h.bitsPerBase32Char;a++)c=0==a%2?i[o++]:f[l++],null==c&&(c=0),u.push(c);for(i=u.join(""),f=h.bitsPerBase32Char,u=i.length/f,s=[],o=0;o<u;o++)l=i.substr(o*f,f),s.push(ot(l));return i=s.join(""),{point:r,extent:e,geohash:i}}},geohashToPoint:function(n){return c.geohashToCell(n).point},pointToGeohash:function(n,t){var i=c.pointToCell(n,t);return i&&i.geohash},getCells:function(n){return r.map(n,function(n){return c.geohashToCell(n)})},getCellSize:function(n){var t=h.longitudeRange,i=h.latitudeRange,t=Math.abs(t[1]-t[0]),i=Math.abs(i[1]-i[0]);return n=tt(n||1),{width:t/Math.pow(2,n.lon),height:i/Math.pow(2,n.lat)}},getCellSizeInMeters:function(n){n=c.getCellSize(n);var t=s.metersPerDegree;return n.width*=t,n.height*=t,n},getIntersecting:function(n,t,i){var f,u,e;return t=t||1,i=i||0,f=[],u=y(n),u&&(i&&(u=c.expandExtent(n,t,i)),n=u.normalize(),e={},r.forEach(n,function(n){it(n,t,f,e)})),f},countIntersecting:function(n,t,i){var r,u,f;return t=t||1,i=i||0,r=0,u=y(n),u&&(i&&(u=c.expandExtent(n,t,i)),n=u.normalize(),2===n.length?(r=rt(n),u=ut(n),i=d(r,t),f=d(u,t),n=i.rows,i=i.cols+f.cols,r={x:r.xmin,y:r.ymax},u={x:u.xmax,y:u.ymax},r=p(r,{}),u=p(u,{}),r=c.pointToGeohash(r,t),t=c.pointToGeohash(u,t),r===t&&i--,t={rows:n,cols:i}):t=d(n[0],t),r=t.cols*t.rows),r},getChildren:function(n){n=n||"";var t=[];for(var i in h.decimals)t.push(n+i);return t},getNeighbors:function(n){var t=l(n,"n"),i=l(n,"s");return[t,l(t,"e"),l(t,"w"),i,l(i,"e"),l(i,"w"),l(n,"e"),l(n,"w")]},getExtentFromDistance:function(n,t){t=t||1e3;var i,r=v(n);return r&&(i=a(r,t)),i},expandExtent:function(n,t,i){if(t=t||1,i=i||0,n=y(n)){if(i){if(n=n.normalize(),2===n.length){var r=i;return i=rt(n),n=ut(n),i=k(i,t,r,"min"),n=k(n,t,r,"max"),360<=i.getWidth()+n.getWidth()?(t=-180,n=180):(t=i.xmin,n=n.xmax),new e(t,i.ymin,n,i.ymax)}return k(n[0],t,i)}return n}},getNeighborsWithinDistance:function(n,t,i){var u,f;return i=i||1e3,t=t||1,u=[],(n=v(n))&&(i=a(n,i).normalize(),f={},r.forEach(i,function(n){it(n,t,u,f)})),u}},n("extend-esri")&&i.setObject("layers.clustering.geohashUtils",c,u),c})},"*noref":1}});define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff ../kernel ../config ../Color ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){function yt(n){return p({url:ct.arcgisUrl+"/"+n.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function ii(n,t){var i={f:"json"};return t&&(i.token=t),p({url:n,content:i,callbackParamName:"callback"},{disableIdentityLookup:!0})}function ri(n){!n.layerDefinition||n.layerDefinition.drawingInfo&&n.layerDefinition.drawingInfo.labelingInfo||(n.showLabels=!1);n.itemProperties.layerDefinition&&(n.layerDefinition?(n.layerDefinition.drawingInfo||(n.layerDefinition.drawingInfo=n.itemProperties.layerDefinition.drawingInfo),y.isDefined(n.layerDefinition.definitionExpression)||(n.layerDefinition.definitionExpression=n.itemProperties.layerDefinition.definitionExpression),y.isDefined(n.layerDefinition.minScale)||(n.layerDefinition.minScale=n.itemProperties.layerDefinition.minScale),y.isDefined(n.layerDefinition.maxScale)||(n.layerDefinition.maxScale=n.itemProperties.layerDefinition.maxScale)):n.layerDefinition=n.itemProperties.layerDefinition);!n.itemProperties.popupInfo||n.popupInfo||n.disablePopup||(n.popupInfo=n.itemProperties.popupInfo);y.isDefined(n.itemProperties.showLabels)&&!y.isDefined(n.showLabels)&&(n.showLabels=n.itemProperties.showLabels);y.isDefined(n.itemProperties.showLegend)&&!y.isDefined(n.showLegend)&&(n.showLegend=n.itemProperties.showLegend);y.isDefined(n.itemProperties.refreshInterval)&&!y.isDefined(n.refreshInterval)&&(n.refreshInterval=n.itemProperties.refreshInterval)}function yi(n){ri(n);n.itemProperties.layerDefinition&&n.layerDefinition&&(!y.isDefined(n.layerDefinition.maximumTrackPoints)&&y.isDefined(n.itemProperties.layerDefinition.maximumTrackPoints)&&(n.layerDefinition.maximumTrackPoints=n.itemProperties.layerDefinition.maximumTrackPoints),!n.layerDefinition.definitionGeometry&&n.itemProperties.layerDefinition.definitionGeometry&&(n.layerDefinition.definitionGeometry=n.itemProperties.layerDefinition.definitionGeometry));n.itemProperties.purgeOptions&&!n.purgeOptions&&(n.purgeOptions=n.itemProperties.purgeOptions)}function pt(n){var e=new u,f=n.itemData,t=[],r=[],o;return i.forEach(f.operationalLayers,function(n){if(n.itemId&&!n.type){var i=n.url.toLowerCase();-1<i.indexOf("/featureserver")||-1<i.indexOf("/mapserver/")?(r.push(n),t.push(yt(n))):-1<i.indexOf("/mapserver")&&-1===i.indexOf("/mapserver/")&&(!n.layers||!y.isDefined(n.minScale)&&!y.isDefined(n.maxScale))?(r.push(n),t.push(yt(n))):-1<i.indexOf("/imageserver")&&!y.isDefined(n.minScale)&&!y.isDefined(n.maxScale)?(r.push(n),t.push(yt(n))):-1<i.indexOf("/streamserver")&&(r.push(n),t.push(yt(n)))}}),f.baseMap&&f.baseMap.baseMapLayers&&i.forEach(f.baseMap.baseMapLayers,function(n){n.itemId&&"VectorTileLayer"!==n.layerType&&(r.push(n),t.push(yt(n)))}),0<t.length?(o={},new s(t).addCallback(function(t){i.forEach(r,function(n,r){var u=t[r][1],f;!u||u instanceof Error||(o[n.itemId]=u,n.type)||(f=n.url.toLowerCase(),(-1<f.indexOf("/featureserver")||-1<f.indexOf("/mapserver/"))&&u.layers?i.forEach(u.layers,function(t){var i="/featureserver/"+t.id;(i=f.match(i+"$")==i)||(i="/mapserver/"+t.id,i=f.match(i+"$")==i);i&&(n.itemProperties=t,ri(n))}):-1<f.indexOf("/streamserver")?(n.itemProperties=u,yi(n)):-1<f.indexOf("/mapserver")?(u.layers&&!n.layers&&(n.layers=u.layers),y.isDefined(u.minScale)&&!y.isDefined(n.minScale)&&(n.minScale=u.minScale),y.isDefined(u.maxScale)&&!y.isDefined(n.maxScale)&&(n.maxScale=u.maxScale),y.isDefined(u.refreshInterval)&&!y.isDefined(n.refreshInterval)&&(n.refreshInterval=u.refreshInterval),u.visibleLayers&&!n.visibleLayers&&(n.visibleLayers=u.visibleLayers)):-1<f.indexOf("/imageserver")&&(y.isDefined(u.minScale)&&!y.isDefined(n.minScale)&&(n.minScale=u.minScale),y.isDefined(u.maxScale)&&!y.isDefined(n.maxScale)&&(n.maxScale=u.maxScale),y.isDefined(u.refreshInterval)&&!y.isDefined(n.refreshInterval)&&(n.refreshInterval=u.refreshInterval),!u.popupInfo||n.popupInfo||n.disablePopup||(n.popupInfo=u.popupInfo),u.renderingRule&&!n.renderingRule&&(n.renderingRule=u.renderingRule,u.renderingRule.functionName&&(n.renderingRule.rasterFunction=u.renderingRule.functionName)),u.bandIds&&!n.bandIds&&(n.bandIds=u.bandIds),u.mosaicRule&&!n.mosaicRule&&(n.mosaicRule=u.mosaicRule),u.format&&!n.format&&(n.format=u.format),y.isDefined(u.compressionQuality)&&!y.isDefined(n.compressionQuality)&&(n.compressionQuality=u.compressionQuality),!u.layerDefinition||!u.layerDefinition.definitionExpression||y.isDefined(n.layerDefinition)&&y.isDefined(n.layerDefinition.definitionExpression)||(n.layerDefinition=n.layerDefinition||{},n.layerDefinition.definitionExpression=u.layerDefinition.definitionExpression)))});n.relatedItemsData=o;e.callback(n)})):e.callback(n),e}function au(n,i){var e=new u,o=n.itemData,f=o.baseMap.baseMapLayers[0],s;return"BingMapsAerial"===f.type||"BingMapsRoad"===f.type||"BingMapsHybrid"===f.type?f.portalUrl&&l.id?(delete i.bingMapsKey,l.id.checkSignInStatus(k.urlToObject(ct.arcgisUrl).path).then(t.hitch(null,function(n,i,r,u,e){ii(f.portalUrl,e.token).then(t.hitch(null,ui,n,i,r,u),t.hitch(null,wt,n,i,r,u))},n,i,o,e),t.hitch(null,function(n,i,r,u){ii(f.portalUrl).then(t.hitch(null,ui,n,i,r,u),t.hitch(null,wt,n,i,r,u))},n,i,o,e))):i.bingMapsKey?(s=new at({bingMapsKey:i.bingMapsKey,mapStyle:at.MAP_STYLE_AERIAL}),r.connect(s,"onLoad",t.hitch(this,function(){e.callback([n,i])})),r.connect(s,"onError",function(){delete i.bingMapsKey;n.itemData=bt(o);f=n.itemData.baseMap.baseMapLayers[0];f.errors=[];f.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});e.callback([n,i])})):(n.itemData=bt(o),f=n.itemData.baseMap.baseMapLayers[0],f.errors=[],f.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),e.callback([n,i])):e.callback([n,i]),e}function vu(n){var r=new u,f,e,i,t;if(n=n.itemData,i=n.baseMap&&n.baseMap.baseMapLayers,ti&&!ti.supported())for(n=0;n<i.length;n++)if(t=i[n],!t.isReference){"VectorTileLayer"===t.layerType&&(f=t.itemId,e=n);break}return f?vi(f,!1).addBoth(function(n){n&&n.item&&/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i.test(n.item.url)&&(i[e]={id:"FB_"+t.id,layerType:"ArcGISTiledMapServiceLayer",opacity:"opacity"in t?t.opacity:1,visibility:"visibility"in t?t.visibility:!0,url:"https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});r.resolve()}):r.resolve(),r}function ui(n,i,u,f,e){e.bingKey?(i.bingMapsKey=e.bingKey,e=new at({bingMapsKey:i.bingMapsKey,mapStyle:at.MAP_STYLE_AERIAL}),r.connect(e,"onLoad",t.hitch(this,function(){f.callback([n,i])})),r.connect(e,"onError",function(t){delete i.bingMapsKey;n.itemData=bt(u);t=n.itemData.baseMap.baseMapLayers[0];t.errors=[];t.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});f.callback([n,i])})):wt(n,i,u,f)}function wt(n,t,i,r){delete t.bingMapsKey;n.itemData=bt(i);i=n.itemData.baseMap.baseMapLayers[0];i.errors=[];i.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});r.callback([n,t])}function bt(n){return n.baseMap="BingMapsAerial"===n.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===n.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]},n}function fi(n,t,r,u){var o=n.dynamicLayerInfos||n.layerInfos,f=t.layers,e;if(f&&o)if(u.usePopupManager)i.forEach(o,function(n){var i=n.id,t;if(!n.subLayerIds)for(n=0;n<f.length;n++)if(t=f[n],t.id===i&&t.popupInfo){e||(e={});e[i]={infoTemplate:new r(t.popupInfo),layerUrl:t.layerUrl};break}}),e&&n.setInfoTemplates(e);else{var s=[],c=[],l=[],h=[],a=[],v=[];i.forEach(o,function(t){var u=t.id,r;if(!t.subLayerIds&&-1!==i.indexOf(n.visibleLayers,u))for(t=0;t<f.length;t++)if(r=f[t],r.id===u){c.push(u);s.push(r.popupInfo);l.push(r.layerUrl||"");r.layerDefinition&&r.layerDefinition.definitionExpression?h.push(r.layerDefinition.definitionExpression):h.push("");a.push(y.isDefined(r.minScale)?r.minScale:null);v.push(y.isDefined(r.maxScale)?r.maxScale:null);break}});s.length&&(n.__popups=s,n.__popupIds=c,n.__popupUrls=l,n.__popupWhereClauses=h,n.__popupMinScales=a,n.__popupMaxScales=v,n.__resourceInfo=t.resourceInfo)}}function pi(n){if(!n)return!1;var t=new e(ct.arcgisUrl).authority;return-1!==n.indexOf(".arcgis.com/")||-1!==n.indexOf(t)}function wi(n){return n?-1!==n.indexOf("/services.arcgisonline.com/")||-1!==n.indexOf("/server.arcgisonline.com/"):!1}function lt(n){return"https:"===location.protocol&&(pi(n)||wi(n))&&(n=n.replace("http:","https:")),n}function ei(n,r,u){var f=[],e;return n.displayLevels||(f=i.map(n.resourceInfo.tileInfo.lods,function(n){return n.level})),n.exclusionAreas&&(e=t.clone(n.exclusionAreas),e=i.map(e,function(n){return n.geometry=new g(n.geometry),n})),f=new ot(lt(n.url),{resourceInfo:n.resourceInfo,opacity:n.opacity,visible:n.visibility,displayLevels:n.displayLevels||f,id:n.id,minScale:n.minScale,maxScale:n.maxScale,refreshInterval:n.refreshInterval,exclusionAreas:e}),u.ignorePopups||fi(f,n,r,u),f}function oi(n,t){if(!n||!t||0===t.length)return[];for(var u=","+t+",",f=[],r=",",i=0;i<n.length;i++)null!==n[i].subLayerIds?(-1===u.indexOf(","+n[i].id+",")||-1<r.indexOf(","+n[i].id+","))&&(r+=n[i].subLayerIds.toString()+","):-1<u.indexOf(","+n[i].id+",")&&-1===r.indexOf(","+n[i].id+",")&&f.push(n[i].id);return f}function bi(n,r,u){var f=new dr,o,s;if(f.format="png24",n.resourceInfo&&n.resourceInfo.supportedImageFormatTypes&&-1<n.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")&&(f.format="png32"),f=new ar(lt(n.url),{resourceInfo:n.resourceInfo,opacity:n.opacity,visible:n.visibility,id:n.id,imageParameters:f,minScale:n.minScale,maxScale:n.maxScale,refreshInterval:n.refreshInterval}),o=n.visibleLayers,n.visibleLayers||(s="",i.forEach(f.layerInfos,function(n){n.defaultVisibility&&(s+=(0<s.length?",":"")+n.id)}),o=s),n.layers&&0<n.layers.length){var c=[],l=[],e,a=[],v,h;i.forEach(n.layers,function(r){if(r.layerDefinition&&r.layerDefinition.definitionExpression&&(c[r.id]=r.layerDefinition.definitionExpression),r.layerDefinition&&r.layerDefinition.source){if(e=null,h=r.layerDefinition.source,"mapLayer"===h.type){var u=i.filter(n.resourceInfo.layers,function(n){return n.id===h.mapLayerId});u.length&&(e=t.mixin(u[0],r))}else e=t.mixin({},r);e&&(e.source=h,delete e.popupInfo,e=new br(e),n.visibleLayers&&(u="string"==typeof n.visibleLayers?n.visibleLayers.split(","):n.visibleLayers,e.defaultVisibility=-1<i.indexOf(u,r.id)?!0:!1),l.push(e))}r.layerDefinition&&r.layerDefinition.source&&r.layerDefinition.drawingInfo&&(v=new iu(r.layerDefinition.drawingInfo),a[r.id]=v)},this);0<c.length&&f.setLayerDefinitions(c);0<l.length?(f.setDynamicLayerInfos(l,!0),0<a.length&&f.setLayerDrawingOptions(a,!0)):(o=oi(f.layerInfos,o),f.setVisibleLayers(o))}else o=oi(f.layerInfos,o),f.setVisibleLayers(o);return u.ignorePopups||fi(f,n,r,u),f}function yu(n,t,i){var r=new gr,u;return r.bandIds=n.bandIds,null!=n.format&&(r.format=n.format,null!=n.compressionQuality&&(r.compressionQuality=n.compressionQuality)),n.renderingRule&&n.renderingRule.rasterFunction&&(u=new fu(n.renderingRule),r.renderingRule=u),n.mosaicRule&&(u=new ru(n.mosaicRule),r.mosaicRule=u),y.isDefined(n.noData)&&(r.noData=n.noData),y.isDefined(n.noDataInterpretation)&&(r.noDataInterpretation=n.noDataInterpretation),y.isDefined(n.interpolation)&&(r.interpolation=n.interpolation),u=n.layerType?"ArcGISImageServiceVectorLayer"===n.layerType:!1,y.isDefined(n.layerType)||(u=n.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===n.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===n.resourceInfo.serviceDataType)),r={resourceInfo:n.resourceInfo,opacity:n.opacity,visible:n.visibility,id:n.id,imageServiceParameters:r,minScale:n.minScale,maxScale:n.maxScale,refreshInterval:n.refreshInterval},r=u?new yr(lt(n.url),r):new vr(lt(n.url),r),n.layerDefinition&&(n.layerDefinition.drawingInfo&&n.layerDefinition.drawingInfo.renderer&&(u=it.fromJson(n.layerDefinition.drawingInfo.renderer),r.setRenderer(u)),n.layerDefinition.definitionExpression&&r.setDefinitionExpression(n.layerDefinition.definitionExpression,!0)),!i.ignorePopups&&n.popupInfo&&r.setInfoTemplate(new t(n.popupInfo)),r}function si(n,t,r){var e=[102113,102100,3857],u=r||new w(t[0].layerObject.fullExtent.spatialReference),f=new w(n.resourceInfo.fullExtent.spatialReference);return u.wkt==f.wkt&&(u.wkid==f.wkid||y.isDefined(u.latestWkid)&&u.latestWkid==f.wkid||y.isDefined(f.latestWkid)&&u.wkid==f.latestWkid||y.isDefined(u.latestWkid)&&u.latestWkid==f.latestWkid)||u.wkid&&f.wkid&&i.some(e,function(n){return n===f.wkid})&&i.some(e,function(n){return n===u.wkid})?!0:!1}function hi(n,t,i){var s,r,o;if(!t[0].layerObject.tileInfo)return!1;n=n.resourceInfo.tileInfo;t=t[0].layerObject.tileInfo;i=i.width>i.height?i.width:i.height;for(var u=!1,f=!1,e=0;e<n.lods.length;e++){for(s=n.lods[e].scale/n.dpi,r=0;r<t.lods.length;r++)if(o=t.lods[r].scale/t.dpi,Math.abs(o-s)/o<1/i)if(u){f=!0;break}else u=!0;if(f)break}return f||u&&(1===n.lods.length||1===t.lods.length)?!0:!1}function ki(n,u,e,s,h,c){var a,v,p=e._clazz,d,nt,b,ut;return"OpenStreetMap"===n.type?a=new uu({id:n.id,opacity:n.opacity,visible:null!==n.visibility&&void 0!==n.visibility?n.visibility:!0}):"WFS"===n.type?(s={customParameters:n.wfsInfo.customParameters,geometryType:n.layerDefinition.geometryType,id:n.id,labelingInfo:n.layerDefinition.drawingInfo.labelingInfo,maxFeatures:n.wfsInfo.maxFeatures,mode:n.mode,name:n.wfsInfo.name,showLabels:!0,swapXY:n.wfsInfo.swapXY,title:n.title,url:n.url,version:n.wfsInfo.version,visible:n.visibility,wkid:n.layerDefinition.spatialReference.wkid},a=new hu,a.fromJson(s,function(){y.isDefined(n.opacity)&&a.setOpacity(n.opacity);y.isDefined(n.visibility)&&a.setVisibility(n.visibility);(n.minScale||n.maxScale)&&a.setScaleRange(n.minScale,n.maxScale);a.renderer=it.fromJson(n.layerDefinition.drawingInfo.renderer);!e.ignorePopups&&n.popupInfo&&a.setInfoTemplate(new p(n.popupInfo));a.emit("fromJsonComplete")})):"WMS"===n.type?(d=[],nt=[],i.forEach(n.layers,function(n){nt.push(new lu({name:n.name,title:n.title,legendURL:n.legendURL,queryable:n.queryable,showPopup:n.showPopup}));d.push(n.name)},this),n.visibleLayers&&(d=n.visibleLayers),s=new g(n.extent[0][0],n.extent[0][1],n.extent[1][0],n.extent[1][1],new w({wkid:4326})),s={customLayerParameters:n.customLayerParameters,customParameters:n.customParameters,extent:s,layerInfos:nt,version:n.version,maxWidth:n.maxWidth,maxHeight:n.maxHeight,featureInfoFormat:n.featureInfoFormat,getFeatureInfoURL:n.featureInfoUrl,getMapURL:n.mapUrl,spatialReferences:n.spatialReferences,title:n.title,copyright:n.copyright,minScale:n.minScale||0,maxScale:n.maxScale||0,format:n.format},a=new cu(n.url,{id:n.id,visibleLayers:d,format:"png",transparent:n.firstLayer?!1:!0,opacity:n.opacity,visible:null!==n.visibility?n.visibility:!0,resourceInfo:s,refreshInterval:n.refreshInterval}),a.spatialReference.wkid=s.spatialReferences[0]):"KML"===n.type?(v=n.url,l.id&&(b=l.id.findCredential(k.urlToObject(ct.arcgisUrl).path),b&&(u=ct.arcgisUrl.substring(ct.arcgisUrl.indexOf("//")+2,ct.arcgisUrl.indexOf("/",ct.arcgisUrl.indexOf("//")+3)),h=u.split("."),h=h[h.length-2]+"."+h[h.length-1],c=v.indexOf(h),-1<c&&(v="https://"+u+v.substring(c+h.length),v+="?token="+b.token))),a=new nu(v,{id:n.id,visible:null!==n.visibility?n.visibility:!0,outSR:s,refreshInterval:n.refreshInterval}),r.connect(a,"onLoad",function(){(n.opacity||0===n.opacity)&&a.setOpacity(n.opacity);y.isDefined(n.minScale)&&y.isDefined(n.maxScale)&&a.setScaleRange(n.minScale,n.maxScale);n.visibleFolders&&i.forEach(a.folders,function(t){-1<i.indexOf(n.visibleFolders,t.id)?a.setFolderVisibility(t,!0):a.setFolderVisibility(t,!1)},this)})):"WebTiledLayer"===n.type?(a=new su(n.templateUrl,{id:n.id,visible:null!==n.visibility?n.visibility:!0,opacity:n.opacity,copyright:n.copyright,fullExtent:n.fullExtent&&new g(n.fullExtent),initialExtent:n.fullExtent&&new g(n.fullExtent),subDomains:n.subDomains,tileInfo:n.tileInfo?new ou(n.tileInfo):null,refreshInterval:n.refreshInterval,wmtsInfo:n.wmtsInfo}),y.isDefined(n.minScale)||y.isDefined(n.maxScale))&&(a.loaded?a.setScaleRange(n.minScale,n.maxScale):r.connect(a,"onLoad",function(){a.setScaleRange(n.minScale,n.maxScale)})):"GeoRSS"===n.type?(a=new kr(n.url,{id:n.id,opacity:n.opacity,outSpatialReference:s,refreshInterval:n.refreshInterval}),r.connect(a,"onLoad",function(){!1===n.visibility&&a.hide();y.isDefined(n.minScale)&&y.isDefined(n.maxScale)&&a.setScaleRange(n.minScale,n.maxScale);var t=a.getFeatureLayers();i.forEach(t,function(i){n.pointSymbol&&"esriGeometryPoint"===i.geometryType?(i.renderer.symbol=tt.fromJson(n.pointSymbol),1===t.length&&(a.pointSymbol=tt.fromJson(n.pointSymbol))):n.lineSymbol&&"esriGeometryPolyline"===i.geometryType?(i.renderer.symbol=tt.fromJson(n.lineSymbol),1===t.length&&(a.polylineSymbol=tt.fromJson(n.lineSymbol))):n.polygonSymbol&&"esriGeometryPolygon"===i.geometryType&&(i.renderer.symbol=tt.fromJson(n.polygonSymbol),1===t.length&&(a.polygonSymbol=tt.fromJson(n.polygonSymbol)))})})):"CSV"==n.type&&n.url?(s={layerDefinition:n.layerDefinition,columnDelimiter:n.columnDelimiter,id:n.id?n.id:null,visible:null!==n.visibility?n.visibility:!0,opacity:n.opacity,refreshInterval:n.refreshInterval},n.locationInfo&&(s.latitudeFieldName=n.locationInfo.latitudeFieldName,s.longitudeFieldName=n.locationInfo.longitudeFieldName),e.ignorePopups||(s.infoTemplate=new rt(n.popupInfo?n.popupInfo:pr.generateDefaultPopupInfo(n))),a=new wr(n.url,s)):"VectorTileLayer"===n.layerType&&n.styleUrl?a=new ti(n.styleUrl,{id:n.id,minScale:n.minScale,maxScale:n.maxScale,opacity:n.opacity,visible:n.visibility}):n.layerDefinition&&!n.url?(s=f.fromJson(f.toJson(n)),delete s.id,delete s.opacity,delete s.visibility,a=new st(s,{id:n.id,opacity:n.opacity,visible:n.visibility,outFields:["*"],autoGeneralize:!0}),!e.ignorePopups&&s.popupInfo&&a.setInfoTemplate(new p(s.popupInfo)),gi(a)):"BingMapsAerial"===n.type||"BingMapsRoad"===n.type||"BingMapsHybrid"===n.type?e.bingMapsKey?(s=at.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===n.type?s=at.MAP_STYLE_AERIAL:"BingMapsRoad"===n.type&&(s=at.MAP_STYLE_ROAD),a=new at({bingMapsKey:e.bingMapsKey,mapStyle:s,opacity:n.opacity,id:n.id}),r.connect(a,"onError",t.hitch(this,function(n){n.errors=n.errors||[];n.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+n.type+"]"})},n))):(n.errors=n.errors||[],n.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+n.type+"]"})):n.resourceInfo&&n.resourceInfo.mapName?a=!0===n.resourceInfo.singleFusedMapCache&&(n.baseMapLayer||si(n,u,s)&&hi(n,h,c))?ei(n,p,e):bi(n,p,e):n.resourceInfo&&n.resourceInfo.pixelSizeX?a=!0===n.resourceInfo.singleFusedMapCache&&(n.baseMapLayer||si(n,u,s)&&hi(n,h,c))?ei(n,p,e):yu(n,p,e):n.resourceInfo&&"Feature Layer"===n.resourceInfo.type?(n.capabilities&&(n.resourceInfo.capabilities=n.capabilities),!1===e.editable?ut=!1:e.privileges&&-1===i.indexOf(e.privileges,"features:user:edit")&&l.id&&l.id.findCredential(n.url)&&(ut=!1),a=new st(lt(n.url),{resourceInfo:n.resourceInfo,opacity:n.opacity,visible:n.visibility,id:n.id,mode:n.mode===st.MODE_SELECTION?st.MODE_SELECTION:st.MODE_AUTO,editable:ut,outFields:["*"],autoGeneralize:!0,refreshInterval:n.refreshInterval}),!e.ignorePopups&&n.popupInfo&&a.setInfoTemplate(new p(n.popupInfo)),n.layerDefinition&&(n.layerDefinition.drawingInfo&&n.layerDefinition.drawingInfo.renderer&&(s=it.fromJson(n.layerDefinition.drawingInfo.renderer),s.isMaxInclusive=!0,a.setRenderer(s)),n.layerDefinition.drawingInfo&&n.layerDefinition.drawingInfo.labelingInfo&&(s=i.map(n.layerDefinition.drawingInfo.labelingInfo,function(n){return new tu(n)}),a.setLabelingInfo(s)),n.layerDefinition.definitionExpression&&a.setDefinitionExpression(n.layerDefinition.definitionExpression),y.isDefined(n.layerDefinition.minScale)&&a.setMinScale(n.layerDefinition.minScale),y.isDefined(n.layerDefinition.maxScale)&&a.setMaxScale(n.layerDefinition.maxScale)),gi(a)):n.resourceInfo&&n.resourceInfo.streamUrls&&(s={resourceInfo:n.resourceInfo,opacity:n.opacity,visible:n.visibility,id:n.id},n.layerDefinition&&(b=n.layerDefinition.drawingInfo,n.layerDefinition.definitionGeometry&&(v=v||{},v.geometry=n.layerDefinition.definitionGeometry),y.isDefined(n.layerDefinition.definitionExpression)&&(v=v||{},v.where=n.layerDefinition.definitionExpression),y.isDefined(n.layerDefinition.maximumTrackPoints)&&(s.maximumTrackPoints=n.layerDefinition.maximumTrackPoints)),v&&(s.filter=v),n.purgeOptions&&(s.purgeOptions=n.purgeOptions),a=new eu(lt(n.url),s),b&&b.renderer&&(s=b.renderer,a.setRenderer(it.fromJson(s))),!e.ignorePopups&&n.popupInfo&&a.setInfoTemplate(new p(n.popupInfo)),n.layerDefinition&&(y.isDefined(n.layerDefinition.minScale)&&a.setMinScale(n.layerDefinition.minScale),y.isDefined(n.layerDefinition.maxScale)&&a.setMaxScale(n.layerDefinition.maxScale)),o.once(a,"error",function(){n.errors.push({message:"Error loading stream layer. Check websocket url"})})),a&&(a.arcgisProps={title:n.title},n.baseMapLayer&&(n.isReference?(a.attr("data-reference",!0),a._basemapGalleryLayerType="reference"):a._basemapGalleryLayerType="basemap")),a}function ci(n,t,r,u,f){i.forEach(n,function(i){i.layerObject=ki(i,n,t,r,u,f)});var e=i.filter(n,function(n){return!n.isReference}),o=i.filter(n,function(n){return!!n.isReference});return n=e.concat(o)}function li(n){var t=null;return n=n[0],n.url&&!n.type?n.resourceInfo.spatialReference&&(t=new w,n.resourceInfo.spatialReference.wkid&&(t.wkid=n.resourceInfo.spatialReference.wkid),n.resourceInfo.spatialReference.wkt&&(t.wkt=n.resourceInfo.spatialReference.wkt)):n.type&&(-1<n.type.indexOf("BingMaps")||"OpenStreetMap"==n.type?t=new w({wkid:102100}):"WMS"==n.type&&(t=new w({wkid:n.spatialReferences[0]}))),t}function di(n,t,r,u,f,e,o,s){return i.forEach(t,function(t){t.url&&!t.type&&(t.resourceInfo=n[t.deferredsPos][1],delete t.deferredsPos)}),e=e||li(t),t=ci(t,r,e,o,s),f.callback(t),f}function gi(n){!window.CanvasRenderingContext2D&&n.renderer&&"esri.renderer.HeatmapRenderer"===n.renderer.declaredClass&&n.setRenderer(it.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}}))}function nr(n,t){var i=lt(n);return p({url:i,content:{f:"json"},callbackParamName:"callback",error:function(n,r){n.message=n.message?n.message+(" [url:"+i+"]"):"[url:"+i+"]";t.push(n);a.defaults.io.errorHandler(n,r)}})}function tr(n){var t=ct.arcgisUrl+"/"+n.itemId+"/data";return p({url:t,content:{f:"json"},callbackParamName:"callback",error:function(i,r){i.message=i.message?i.message+(" [url:"+t+"]"):"[url:"+t+"]";n.errors=n.errors||[];n.errors.push(i);a.defaults.io.errorHandler(i,r)}})}function ir(n,r,e){var o=new u;return(e.featureCollection&&e.featureCollection.layers||e.layers)?(e.layers&&(e.featureCollection={layers:e.layers},delete e.layers,y.isDefined(e.showLegend)&&(e.featureCollection.showLegend=e.showLegend,delete e.showLegend)),rr(n,e.featureCollection,r).then(function(r){e.featureCollection=r;n.featureCollection&&n.featureCollection.layers?i.forEach(e.featureCollection.layers,function(i,r){var u=n.featureCollection.layers[r];u.popupInfo||u.layerDefinition?u.layerDefinition?(y.isDefined(u.layerDefinition.minScale)&&y.isDefined(u.layerDefinition.maxScale)&&(u.layerDefinition.minScale!==i.layerDefinition.minScale||u.layerDefinition.maxScale!==i.layerDefinition.maxScale)&&(delete i.layerDefinition.minScale,delete i.layerDefinition.maxScale),u.layerDefinition.drawingInfo&&f.toJson(u.layerDefinition.drawingInfo)!==f.toJson(i.layerDefinition.drawingInfo)&&delete i.layerDefinition.drawingInfo,u.layerDefinition.showLegend!==i.layerDefinition.showLegend&&delete i.layerDefinition.showLegend,u.layerDefinition=t.mixin(u.layerDefinition,i.layerDefinition)):u.layerDefinition=i.layerDefinition:(u.popupInfo=i.popupInfo,u.layerDefinition=i.layerDefinition);u.featureSet=i.featureSet;u.nextObjectId=i.nextObjectId}):(n.featureCollection=n.featureCollection||{},n.featureCollection=t.mixin(n.featureCollection,e.featureCollection));o.callback(n)}),o):(console.log("Invalid Feature Collection item data [item id: "+n.itemId+"]: ",e),n.errors=n.errors||[],n.errors.push({message:"Invalid Feature Collection item data. [item id: "+n.itemId+"]"}),o.errback(),o)}function rr(t,r,f){var e=new u;return n(["./csv"],function(n){var u=[];i.forEach(r.layers,function(t){t.featureSet&&t.featureSet.features&&t.featureSet.features.length&&t.featureSet.features[0].geometry&&t.featureSet.features[0].geometry.spatialReference&&(t.deferredsPos=u.length,u.push(n.projectFeatureCollection(t,f,t.featureSet.features[0].geometry.spatialReference)))});new s(u).addCallback(function(){i.forEach(r.layers,function(n){y.isDefined(n.deferredsPos)&&(u[n.deferredsPos].results&&u[n.deferredsPos].results.length?n=u[n.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+t.title+" - "+n.layerDefinition.name+"]"),n.errors=n.errors||[],n.errors.push({message:"Errors projecting feature collection. ["+t.title+" - "+n.layerDefinition.name+"]"})),delete n.deferredsPos)});e.callback(r)})}),e}function kt(r,f,e,h,c){var v=new u,y=new u,l=[],a;return i.forEach(r.operationalLayers,function(n){n.itemId&&"Feature Collection"==n.type&&l.push(tr(n).then(t.hitch(null,ir,n,e)))}),0===l.length?ur(r,f,e,h,y,c):(a=new s(l),a.addCallback(function(){ur(r,f,e,h,y,c)})),y.then(function(n){if(l=[],i.forEach(n,function(n){var t;n=n.layerObject;n instanceof st&&!n.loaded&&!n.loadError?(t=new u,o.once(n,"load, error",function(){t.callback(n)}),l.push(t)):n&&"esri.layers.WFSLayer"===n.declaredClass&&!n.loadError&&(t=new u,o.once(n,"fromJsonComplete, error",function(){t.callback(n)}),l.push(t))}),l.length){var t=new u;return a=new s(l),a.addCallback(function(){t.callback(n)}),t.promise}return n}).then(function(t){var r=[];i.forEach(t,function(n){var t=n.layerObject;t instanceof st?t.loaded&&t.labelingInfo&&(n.showLabels||t._collection)&&r.push(t):t&&"esri.layers.WFSLayer"===t.declaredClass&&t.loaded&&t.labelingInfo&&r.push(t)});r.length?n(["../layers/LabelLayer"],function(n){var u=new n;i.forEach(r,function(n){u.addFeatureLayer(n)});t.push({layerObject:u});v.callback(t)}):v.callback(t)}),v}function ur(n,t,r,u,f,e){var o=[],h=[],c=[];return i.forEach(n.operationalLayers,function(n,t){if(n.featureCollection&&n.featureCollection.layers){var r=n.featureCollection.layers.length;i.forEach(n.featureCollection.layers,function(u,f){var e=!0;n.visibleLayers&&-1==i.indexOf(n.visibleLayers,f)&&(e=!1);u.visibility=n.visibility&&e;u.opacity=n.opacity;u.id=(n.id||"operational"+t)+"_"+f;n.title&&(u.title=1!==r&&u.layerDefinition.name&&n.title!==u.layerDefinition.name?n.title+" - "+u.layerDefinition.name:n.title);c.push(u)},this)}else c.push(n)}),i.forEach(n.baseMap.baseMapLayers,function(n,t){n.baseMapLayer=!0;n.id=n.id||"base"+t;o.push(n)}),i.forEach(c,function(n,t){n.id=n.id||"operational"+t;o.push(n)}),i.forEach(o,function(n){n.url&&!n.type&&(n.deferredsPos=h.length,n.errors=n.errors||[],h.push(nr(n.url,n.errors)))}),0===h.length?(r=r||li(o),o=ci(o,t,r,u,e),f.callback(o)):new s(h).addCallback(function(n){di(n,o,t,h,f,r,u,e)}),f}function dt(n,t,r,u){var f=n.minScale,e=n.maxScale;if(10.1>=r.version&&t){for(n=t.length-1;0<=n;n--)if(t[n].id==u)if(0==f&&0<t[n].minScale?f=t[n].minScale:0<f&&0==t[n].minScale?f=r.minScale:0<f&&0<t[n].minScale&&(f=Math.min(f,t[n].minScale)),e=Math.max(r.maxScale||0,t[n].maxScale||0),r.setScaleRange(f,e),-1<t[n].parentLayerId)u=t[n].parentLayerId;else break}else 10.1<r.version&&(i.forEach(n.layerInfos,function(n){n.id==u&&(0==f&&0<n.minScale?f=n.minScale:0<f&&0==n.minScale||0<f&&0<n.minScale&&(f=Math.min(f,n.minScale)),e=Math.max(e||0,n.maxScale||0))}),r.setScaleRange(f,e))}function gt(n,u,f,e){var v=n.url,o=n.__popupIds,p=n.__popupUrls,h=n.__popupWhereClauses,s=n.__popupMinScales,l=n.__popupMaxScales,a=n.__resourceInfo,c=[];return i.forEach(n.__popups,function(t,e){var w,k,b,d,g,nt;if(t){if(k=[],i.forEach(t.fieldInfos,function(n){"shape"!==n.fieldName.toLowerCase()&&k.push(n.fieldName)}),n.dynamicLayerInfos&&0<n.dynamicLayerInfos.length)b=i.filter(n.dynamicLayerInfos,function(n){return o[e]==n.id})[0].source,w=new st(v+"/dynamicLayer",{id:n.id+"_"+o[e],source:b,outFields:k,mode:st.MODE_SELECTION,infoTemplate:t&&new f(t),drawMode:!1,visible:n.visible,autoGeneralize:!0}),d=function(t,i){if(0<h[t].length&&i.setDefinitionExpression(h[t]),y.isDefined(s[t])||y.isDefined(l[t]))if(y.isDefined(n.minScale)||y.isDefined(n.maxScale)){var r=n.minScale,f=n.maxScale;0==r&&0<s[t]?r=s[t]:0<r&&0==s[t]||0<r&&0<s[t]&&(r=Math.min(r,s[t]));f=Math.max(f||0,l[t]||0);i.setScaleRange(r,f)}else i.setScaleRange(s[t],l[t]);else dt(n,u||a.layers,i,o[t])},w.loaded?d(e,w):r.connect(w,"onLoad",function(){d(e,w)});else{if(g=null,nt=v+"/"+o[e],p[e].length)nt=p[e];else if(u)for(b=0;b<u.length;b++)if(u[b].id===o[e]){g=u[b];break}w=new st(lt(nt),{id:n.id+"_"+o[e],outFields:k,mode:st.MODE_SELECTION,infoTemplate:t&&new f(t),drawMode:!1,visible:n.visible,resourceInfo:g,autoGeneralize:!0});w.loaded?(0<h[e].length&&w.setDefinitionExpression(h[e]),dt(n,u||a.layers,w,o[e])):r.connect(w,"onLoad",function(t){0<h[e].length&&w.setDefinitionExpression(h[e]);dt(n,u||a.layers,t,o[e])})}c.push(w)}}),0<c.length&&(r.connect(n,"onVisibilityChange",t.hitch(this,function(n,t){i.forEach(n,function(n){t?n.show():n.hide()})},c)),r.connect(e,"onLayerRemove",t.hitch(this,function(n,t,r){n.id===r.id&&i.forEach(t,function(n){e.removeLayer(n)})},n,c))),delete n.__popups,delete n.__popupIds,delete n.__popupUrls,delete n.__popupWhereClauses,delete n.__popupMinScales,delete n.__popupMaxScales,delete n.__resourceInfo,c}function fr(n){return p({url:lt(n.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function er(n,t,r){var f=[],u;i.forEach(n,function(n){var t=n.__popups;t&&1<t.length&&10<=n.version&&(n.__deferredsPos=f.length,f.push(fr(n)))});u=[];0<f.length?new s(f).addCallback(function(f){i.forEach(n,function(n){n.__popups&&0<n.__popups.length&&(n.__deferredsPos||0===n.__deferredsPos?(u=u.concat(gt(n,f[n.__deferredsPos][1].layers,r,t)),delete n.__deferredsPos):u=u.concat(gt(n,null,r,t)))});t.addLayers(u)}):(i.forEach(n,function(n){n.__popups&&0<n.__popups.length&&(u=u.concat(gt(n,null,r,t)))}),t.addLayers(u))}function or(n){i.forEach(n,function(n){var t=n.layer;t.toJson&&(n=t.toJson(),n.featureSet&&t.name&&-1<t.name.indexOf("Text")&&i.forEach(n.featureSet.features,function(n,i){if(n.attributes.TEXT){var r=t.graphics[i];r.symbol.setText(n.attributes.TEXT);n.symbol.horizontalAlignment&&(r.symbol.align=n.symbol.horizontalAlignment);r.setSymbol(r.symbol);r.setAttributes(n.attributes)}},this))})}function sr(n){var t=6;return i.forEach(n,function(n){(n=n.renderer)&&("esri.renderer.SimpleRenderer"===n.declaredClass?((n=n.symbol)&&n.xoffset&&(t=Math.max(t,Math.abs(n.xoffset))),n&&n.yoffset&&(t=Math.max(t,Math.abs(n.yoffset)))):"esri.renderer.UniqueValueRenderer"!==n.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==n.declaredClass||i.forEach(n.infos,function(n){(n=n.symbol)&&n.xoffset&&(t=Math.max(t,Math.abs(n.xoffset)));n&&n.yoffset&&(t=Math.max(t,Math.abs(n.yoffset)))}))}),t}function ai(n){var t=this,c=t.infoWindow,f=n.graphic,e,a,o,h;if(t.loaded&&(c.hide(),c.clearFeatures(),e=[],i.forEach(t.graphicsLayerIds,function(n){(n=t.getLayer(n))&&n instanceof st&&n.loaded&&n.visible&&(n.clearSelection(),n.infoTemplate&&!n.suspended&&e.push(n))}),i.forEach(t.layerIds,function(n){(n=t.getLayer(n))&&-1!==n.declaredClass.indexOf("ArcGISImageServiceLayer")&&n.loaded&&n.visible&&n.infoTemplate&&e.push(n)}),f=f&&f.getInfoTemplate()?f:null,e.length||f)){var r=sr(e),l=n.screenPoint,o=t.toMap(new d(l.x-r,l.y+r)),r=t.toMap(new d(l.x+r,l.y-r)),o=new g(o.x,o.y,r.x,r.y,t.spatialReference),s=new ft;if(s.geometry=o,s.timeExtent=t.timeExtent,a=!0,o=i.map(e,function(t){var i;return-1!==t.declaredClass.indexOf("ArcGISImageServiceLayer")?(s.geometry=n.mapPoint,a=!1,i=t.queryVisibleRasters(s,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),i.addCallback(function(){return t.getVisibleRasters()})):(i=t.selectFeatures(s),i.addCallback(function(){return t.getSelectedFeatures()})),i}),f&&(r=new u,r.callback([f]),o.splice(0,0,r)),!i.some(o,function(n){return-1===n.fired})&&(h=f?1:0,i.forEach(e,function(n){h=-1!==n.declaredClass.indexOf("ArcGISImageServiceLayer")?h+n.getVisibleRasters().length:h+n.getSelectedFeatures().length}),!h))return;c.setFeatures(o);c.show(n.mapPoint,{closestFirst:a})}}function pu(n,t){var i=t.mapOptions||{},u;return i.infoWindow||(u=new ut({visibleWhenEmpty:!1},h.create("div")),i.infoWindow=u),y.isDefined(i.showInfoWindowOnClick)||t.usePopupManager||(i.showInfoWindowOnClick=!1),i=new b(n,i),r.connect(i,"onLayersAddResult",or),i}function vt(n,t,u,f,e,o){var s,c,l,a,h;f.map?(s=f.map,c=f.clickEventHandle,l=f.clickEventListener,a=f.errors):(s=pu(f,e),e.ignorePopups||e.disableClickBehavior||e.usePopupManager||(c=r.connect(s,"onClick",ai),l=ai));s.addLayers(n);e.ignorePopups||e.usePopupManager||er(n,s,e._clazz);h=a||[];i.forEach(t,function(n){n.errors&&(h=h.concat(n.errors))},this);s.loaded?o.callback({map:s,itemInfo:u,errors:h,clickEventHandle:c,clickEventListener:l}):r.connect(s,"onLoad",function(){o.callback({map:s,itemInfo:u,errors:h,clickEventHandle:c,clickEventListener:l})})}function ni(n,r,u,f,e){var o=[],s,h;i.forEach(e,function(n){t.isArray(n.layerObject)?i.forEach(n.layerObject,function(n){o.push(n)}):o.push(n.layerObject)});"BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type?s=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(s),hr(n,r,u,f,e,o);else if(e[0].errors){clearInterval(s);var t="";e[0].errors&&e[0].errors.length&&(t=" ("+e[0].errors[0].message+")");f.errback(Error(ht.arcgis.utils.baseLayerError+t))}},10):!o[0]&&e[0].baseMapLayer?(h="",e[0].errors&&e[0].errors.length&&(h=" ("+e[0].errors[0].message+")"),f.errback(Error(ht.arcgis.utils.baseLayerError+h))):hr(n,r,u,f,e,o)}function hr(n,t,r,u,f,e){var s,h,l,o,c;try{s=r.mapOptions||{};r.mapOptions=s;h=n.item;l=n.itemData;!s.backgroundColor&&l.background&&l.background.color&&null!=l.background.color[0]&&(s.backgroundColor=v.toDojoColor(l.background.color));e=i.filter(e,y.isDefined);h?h.extent&&h.extent.length?s.extent?vt(e,f,n,t,r,u):(o=new g(h.extent[0][0],h.extent[0][1],h.extent[1][0],h.extent[1][1],new w({wkid:4326})),c=e[0].spatialReference,4326===c.wkid?(s.extent=o,vt(e,f,n,t,r,u)):102100===c.wkid||102113===c.wkid||3857===c.wkid?(o.xmin=Math.max(o.xmin,-180),o.xmax=Math.min(o.xmax,180),o.ymin=Math.max(o.ymin,-89.99),o.ymax=Math.min(o.ymax,89.99),s.extent=nt.geographicToWebMercator(o),vt(e,f,n,t,r,u)):r.geometryServiceURL||a.defaults.geometryService?(r.geometryServiceURL?new et(r.geometryServiceURL):a.defaults.geometryService).project([o],c,function(i){i=i[0];s.extent=s.extent||i;vt(e,f,n,t,r,u)},function(){vt(e,f,n,t,r,u)}):u.errback(Error(ht.arcgis.utils.geometryServiceError))):vt(e,f,n,t,r,u):vt(e,f,n,t,r,u)}catch(p){u.errback(p)}}function wu(n){var t=[];return i.forEach(n.operationalLayers,function(n){n.featureCollection?t.push({featureCollection:n.featureCollection,visibility:n.visibility,title:n.title}):n.layerObject&&t.push({layer:n.layerObject,visibility:n.visibility,title:n.title})}),t}function cr(n){var t=[],r=n.baseMap.baseMapLayers;return n.operationalLayers&&(r=r.concat(n.operationalLayers)),i.forEach(r,function(n){var r={};if(n.featureCollection&&"CSV"!==n.type)!0===n.featureCollection.showLegend&&i.forEach(n.featureCollection.layers,function(i){if(!1!==i.showLegend){var u=i.layerObject.renderer;r={layer:i.layerObject,title:n.title,defaultSymbol:u&&u.defaultSymbol&&u.defaultLabel?!0:!1};1<n.featureCollection.layers.length&&(r.title+=" - "+i.layerDefinition.name);t.push(r)}});else if(n.baseMapLayer&&!0===n.showLegend&&n.layerObject||!n.baseMapLayer&&!1!==n.showLegend&&n.layerObject&&!(n.layerObject instanceof st&&n.layerObject.mode===st.MODE_SELECTION)){var u=n.layerObject.renderer,f=n.layerObject.declaredClass,u=!u||u&&u.defaultSymbol&&u.defaultLabel?!0:!1;(10.1>n.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===f||"esri.layers.ArcGISTiledMapServiceLayer"===f)||"esri.layers.ArcGISImageServiceLayer"===f)&&(u=!0);r={layer:n.layerObject,title:n.title,defaultSymbol:u};n.layers&&(f=i.map(i.filter(n.layers,function(n){return!1===n.showLegend}),function(n){return n.id}),f.length&&(r.hideLayers=f));t.push(r)}}),t}function bu(t){function c(n,t){i.forEach(n,function(n,i){switch(n){case"../layers/ArcGISDynamicMapServiceLayer":ar=t[i];break;case"../layers/ArcGISImageServiceLayer":vr=t[i];break;case"../layers/ArcGISImageServiceVectorLayer":yr=t[i];break;case"./csv":pr=t[i];break;case"../layers/CSVLayer":wr=t[i];break;case"../layers/DynamicLayerInfo":br=t[i];break;case"../layers/GeoRSSLayer":kr=t[i];break;case"../layers/ImageParameters":dr=t[i];break;case"../layers/ImageServiceParameters":gr=t[i];break;case"../layers/KMLLayer":nu=t[i];break;case"../layers/LabelClass":tu=t[i];break;case"../layers/LayerDrawingOptions":iu=t[i];break;case"../layers/MosaicRule":ru=t[i];break;case"../layers/OpenStreetMapLayer":uu=t[i];break;case"../layers/RasterFunction":fu=t[i];break;case"../layers/StreamLayer":eu=t[i];break;case"../layers/TileInfo":ou=t[i];break;case"../layers/VectorTileLayer":ti=t[i];break;case"../virtualearth/VETiledLayer":at=t[i];break;case"../layers/WebTiledLayer":su=t[i];break;case"../layers/WFSLayer":hu=t[i];break;case"../layers/WMSLayer":cu=t[i];break;case"../layers/WMSLayerInfo":lu=t[i]}})}var s=new u,o=t.itemData,e=[];o.baseMap&&o.baseMap.baseMapLayers&&(e=e.concat(o.baseMap.baseMapLayers));o.operationalLayers&&(e=e.concat(o.operationalLayers));for(var o=i.map(e,function(n){return n&&n.layerType}),r=[],f=[],e=!1,h=0;h<o.length;h++){switch(o[h]){case"ArcGISFeatureLayer":-1===i.indexOf(r,"../layers/LabelClass")&&r.push("../layers/LabelClass");break;case"ArcGISImageServiceLayer":case"ArcGISTiledImageServiceLayer":-1===i.indexOf(r,"../layers/ArcGISImageServiceLayer")&&(r.push("../layers/ArcGISImageServiceLayer"),f.push("../layers/ImageServiceParameters"),f.push("../layers/MosaicRule"),f.push("../layers/RasterFunction"));break;case"ArcGISImageServiceVectorLayer":-1===i.indexOf(r,"../layers/ArcGISImageServiceVectorLayer")&&(r.push("../layers/ArcGISImageServiceVectorLayer"),f.push("../layers/ImageServiceParameters"),f.push("../layers/MosaicRule"),f.push("../layers/RasterFunction"));break;case"ArcGISMapServiceLayer":case"ArcGISTiledMapServiceLayer":-1===i.indexOf(r,"../layers/ArcGISDynamicMapServiceLayer")&&(r.push("../layers/ArcGISDynamicMapServiceLayer"),f.push("../layers/DynamicLayerInfo"),f.push("../layers/ImageParameters"),f.push("../layers/LayerDrawingOptions"));break;case"ArcGISStreamLayer":-1===i.indexOf(r,"../layers/StreamLayer")&&r.push("../layers/StreamLayer");break;case"BingMapsAerial":case"BingMapsHybrid":case"BingMapsRoad":-1===i.indexOf(r,"../virtualearth/VETiledLayer")&&r.push("../virtualearth/VETiledLayer");break;case"CSV":-1===i.indexOf(r,"../layers/CSVLayer")&&(r.push("../layers/CSVLayer"),f.push("./csv"));break;case"GeoRSS":-1===i.indexOf(r,"../layers/GeoRSSLayer")&&r.push("../layers/GeoRSSLayer");break;case"KML":-1===i.indexOf(r,"../layers/KMLLayer")&&r.push("../layers/KMLLayer");break;case"OpenStreetMap":-1===i.indexOf(r,"../layers/OpenStreetMapLayer")&&r.push("../layers/OpenStreetMapLayer");break;case"VectorTileLayer":-1===i.indexOf(r,"../layers/VectorTileLayer")&&r.push("../layers/VectorTileLayer");break;case"WebTiledLayer":-1===i.indexOf(r,"../layers/WebTiledLayer")&&(r.push("../layers/WebTiledLayer"),f.push("../layers/TileInfo"));break;case"WFS":-1===i.indexOf(r,"../layers/WFSLayer")&&r.push("../layers/WFSLayer");break;case"WMS":-1===i.indexOf(r,"../layers/WMSLayer")&&(r.push("../layers/WMSLayer"),f.push("../layers/WMSLayerInfo"));break;default:e=!0}if(e)break}return e&&(r=ku,f=du),r.length?n(r,function(){c(r,arguments);f.length?n(f,function(){c(f,arguments);s.resolve()}):s.resolve()}):s.resolve(),s}function lr(n,r,f,e){var o=e.itemData,s,h,c;o.baseMap&&o.baseMap.baseMapLayers&&o.baseMap.baseMapLayers.length&&(o.baseMap.baseMapLayers[0].firstLayer=!0);s=r.layerMixins;h=s&&s.length;h&&(c=function(n){for(var i,r=0;r<h;r++)if(i=s[r],i.mixin)if(i.hasOwnProperty("id")){if(n.id===i.id){t.mixin(n,i.mixin);break}}else if(n.url===i.url){t.mixin(n,i.mixin);break}},i.forEach(o.baseMap&&o.baseMap.baseMapLayers,c),i.forEach(o.operationalLayers,c));bu(e,r).then(function(){return vu(e,r)}).then(function(){return au(e,r)}).then(function(r){var e=r[0],o=r[1];if(e.itemData.operationalLayers&&0!==e.itemData.operationalLayers.length){var s=new u,c=e.itemData.baseMap.baseMapLayers.slice(),h=i.filter(e.itemData.baseMap.baseMapLayers,function(n){return!n.isReference});r={item:e.item,itemData:{baseMap:{baseMapLayers:h}}};e.itemData.baseMap.baseMapLayers=i.filter(e.itemData.baseMap.baseMapLayers,function(n){return n.isReference});pt(r,o).addCallback(function(i){kt(i.itemData,o).addCallback(t.hitch(null,ni,i,n,o,s))});s.then(function(n){pt(e,o).addCallback(function(t){kt(t.itemData,o,n.map.spatialReference,h,n.map).addCallback(function(i){t.itemData.baseMap.baseMapLayers=c;ni(t,n,o,f,i)})})},t.hitch(f,f.errback))}else pt(e,o).addCallback(function(i){kt(i.itemData,o).addCallback(t.hitch(null,ni,i,n,o,f))})})}function vi(n,t){"undefined"==typeof t&&(t=!0);ct._arcgisUrl&&0<ct._arcgisUrl.length&&(ct.arcgisUrl=ct._arcgisUrl);var f=ct.arcgisUrl+"/"+n,r={},i=new u;return p({url:f,content:{f:"json"},callbackParamName:"callback",load:function(n){r.item=n;t?p({url:f+"/data",content:{f:"json"},callbackParamName:"callback",load:function(n){r.itemData=n;i.callback(r)},error:function(n){i.errback(n)}}):i.callback(r)},error:function(n){i.errback(n)}}),i}var ct,ar,vr,yr,pr,wr,br,kr,dr,gr,nu,tu,iu,ru,uu,fu,eu,ou,ti,at,su,hu,cu,lu,ku="../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/ArcGISImageServiceVectorLayer ../layers/CSVLayer ../layers/GeoRSSLayer ../layers/KMLLayer ../layers/LabelClass ../layers/OpenStreetMapLayer ../layers/StreamLayer ../layers/VectorTileLayer ../virtualearth/VETiledLayer ../layers/WebTiledLayer ../layers/WFSLayer ../layers/WMSLayer".split(" "),du="./csv ../layers/DynamicLayerInfo ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/LayerDrawingOptions ../layers/MosaicRule ../layers/RasterFunction ../layers/TileInfo ../layers/WMSLayerInfo".split(" ");return ct={arcgisUrl:k.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:vi,createMap:function(n,i,r){var f=new u,e;return r=r||{},e=r.infoTemplateClass,r._clazz=e&&(t.isObject(e)?e:t.getObject(e))||rt,t.isString(n)?vi(n).addCallback(t.hitch(null,lr,i,r,f)).addErrback(t.hitch(f,f.errback)):lr(i,r,f,n),f},getLayerList:function(n){return n&&n.itemInfo&&n.itemInfo.itemData?wu(n.itemInfo.itemData):[]},getLegendLayers:function(n){return n&&n.itemInfo&&n.itemInfo.itemData?cr(n.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:pt,_getItemData:yt,_getBingKey:ii,_portalUrlResponse:ui,_portalUrlFailure:wt,_processFSItemProperties:ri,_processSSItemProperties:yi,_getLayers:kt,_preBuildLayerObjects:di,_buildLayerObjects:ci,_preCreateMap:ni,_getMapSR:li,_createMap:vt,_addSelectionLayers:er,_createSelectionFeatureLayers:gt,_getServiceInfo:nr,_getFeatureCollectionItem:tr,_mergeFeatureCollectionItem:ir,_projectFeatureCollection:rr,_getLayersInfo:fr,_initLayer:ki,_loadAsCached:ei,_loadAsDynamic:bi,_processPopups:fi,_onLayersAddResult:or,_sameSpatialReferenceAsBasemap:si,_sameTilingSchemeAsBasemap:hi,_showPopup:ai,_calculateClickTolerance:sr,_getVisibleFeatureLayers:oi,_updateLayerScaleInfo:dt,_checkUrl:lt,_isHostedService:pi,_isAgolService:wi,_getLegendLayers:cr},t.setObject("arcgis.utils",ct,l),ct})},"esri/dijit/Attribution":function(){define("esri/dijit/Attribution","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){return n=n(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(n,i){var c,l,e,a;try{t.mixin(this,n);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];var h=this.domNode=o.byId(i),f=this.map,v="<span class='"+this.listClass+"'><\/span>";if(h&&(s.set(h,"innerHTML",v),this.listNode=u.query(".esriAttributionList",h)[0],this.itemNodes={}),this._eventConnections=[r.connect(f,"onLayerAdd",this,this._onLayerAdd),r.connect(f,"onLayerRemove",this,this._onLayerRemove),r.connect(f,"onLayerSuspend",this,this._onLayerSuspend),r.connect(f,"onLayerResume",this,this._onLayerResume),r.connect(f,"onResize",this,this._adjustFocus),r.connect(f,"onExtentChange",this,this._onExtentChange)],f.loaded)for(c=f.layerIds.concat(f.graphicsLayerIds),a=c.length,e=0;e<a;e++)l=f.getLayer(c[e]),l.loaded&&this._onLayerAdd(l)}catch(y){}},startup:function(){},destroy:function(){i.forEach(this._eventConnections,r.disconnect);h.destroy(this.listNode);this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=null},_onLayerAdd:function(n){var r,i,u;try{r=this._attributions;i=n.id;!y.isDefined(r[i])&&n.showAttribution&&(n.hasAttributionData?(u=n.getAttributionData(),this._pendingDfds[i]=1,r[i]=u,u.addBoth(t.partial(this._onAttributionLoad,this,n))):(r[i]=n.copyright||n.copyrightText||"",r[i]?(n.suspended||this._activeLayers.push(i),this._createNode(i)):this._onLayerRemove(n)))}catch(f){}},_onAttributionLoad:function(n,t,i){var f=n._attributions,u=n._pendingDfds,r=t.id;u&&u[r]&&(delete u[r],(!i||i instanceof Error)&&(i=""),f[r]=i?n._createIndexByLevel(i,-1!==t.declaredClass.toLowerCase().indexOf("vetiledlayer")):t.copyright||t.copyrightText||"",f[r]?(t.suspended||n._activeLayers.push(r),n._createNode(r)):n._onLayerRemove(t))},_onLayerRemove:function(n){try{var t=n.id,f=this.itemNodes,r,u=-1;this._onLayerSuspend(n);delete this._attributions[t];delete this._pendingDfds[t];r=this._getGroupIndex(t);-1!==r&&(u=i.indexOf(this._sharedLayers[r],t),-1!==u&&(this._sharedLayers[r].splice(u,1),1>=this._sharedLayers[r].length&&this._sharedLayers.splice(r,1)));f[t]&&-1===u&&h.destroy(f[t]);delete f[t];this._updateLastItem()}catch(e){}},_onLayerSuspend:function(n){var t,r,u;try{t=n.id;this._attributions[t]&&(r=i.indexOf(this._activeLayers,t),u=this.itemNodes[t],-1!==r&&this._activeLayers.splice(r,1),u&&this._toggleItem(u,!1,this._getGroupIndex(t)))}catch(f){}},_adjustFocus:function(){var n=this.domNode.scrollWidth>this.domNode.clientWidth,t=l.contains(this.domNode,"esriAttributionOpen");s.set(this.domNode,"tabIndex",n||t?"0":"")},_onLayerResume:function(n){var f;try{var r=n.id,u=this._attributions[r],e=this.itemNodes[r];u&&(-1===i.indexOf(this._activeLayers,r)&&this._activeLayers.push(r),e)&&(f=t.isString(u)?u:this._getContributorsList(u,this.map.extent,this.map.getLevel()),t.isString(u)||s.set(e,"innerHTML",f?f+this._getDelimiter():""),f&&this._toggleItem(e,!0,this._getGroupIndex(r)))}catch(o){}},_onExtentChange:function(n,i,r,u){var e;try{for(var l=this._activeLayers,a=this._attributions,v=this.itemNodes,o,h,c,y=l.length||0,f=0;f<y;f++)(h=l[f],c=a[h],(o=v[h])&&!t.isString(c))&&(e=this._getContributorsList(c,n,u?u.level:-1),s.set(o,"innerHTML",e?e+this._getDelimiter():""),this._toggleItem(o,!!e,-1))}catch(p){}this._adjustCursorStyle()},_createNode:function(n){if(this.domNode){var f=this._checkShareInfo(n),u=f&&f.sharedWith,u=u&&this.itemNodes[u],i=this.map,r=this._attributions[n],r=t.isString(r)?r:this._getContributorsList(r,i.extent,i.getLevel()),i=!!r&&!i.getLayer(n).suspended;u?(this.itemNodes[n]=u,this._toggleItem(u,i,f.index)):(n=this.itemNodes[n]=h.create("span",{"class":this.itemClass,innerHTML:r?r+this._getDelimiter():"",style:{display:i?"inline":"none"}},this.listNode),i&&this._setLastItem(n));this._adjustCursorStyle()}},_checkShareInfo:function(n){var u=this._attributions,f,r,o=-1,e=u[n],s;if(e&&t.isString(e)){for(r in u)if(f=u[r],r!==n&&f&&t.isString(f)&&f.length===e.length&&f.toLowerCase()===e.toLowerCase()){s=r;break}if(u=this._sharedLayers,f=u.length,s){for(r=0;r<f;r++)if(e=u[r],-1!==i.indexOf(e,s)){o=r;e.push(n);break}-1===o&&(o=u.push([s,n])-1)}}return-1<o?{index:o,sharedWith:s}:null},_getGroupIndex:function(n){for(var r=this._sharedLayers,f=r.length,u=-1,t=0;t<f;t++)if(-1!==i.indexOf(r[t],n)){u=t;break}return u},_getDelimiter:function(){var n=this.itemDelimiter;return n?"<span class='"+this.delimiterClass+"'>"+n+"<\/span>":""},_toggleItem:function(n,t,r){if(-1<r&&!t){r=this._sharedLayers[r];for(var f=r.length,e=this._activeLayers,u=0;u<f;u++)if(-1!==i.indexOf(e,r[u]))return}c.set(n,"display",t?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var i=this.listNode.childNodes,n,t;if(n=i.length,n)for(--n;0<=n;n--)if(t=i[n],"none"!==c.get(t,"display")){this._setLastItem(t);break}this._adjustCursorStyle()},_setLastItem:function(n){var t=this.itemClass,i=this.lastItemClass;this._lastItem&&l.replace(this._lastItem,t,i);n&&(l.replace(n,i,t),this._lastItem=n)},_createIndexByLevel:function(n,t){for(var o=n.contributors,s,h,i,l=o?o.length:0,f,c,a=new p(4326),e={},r,u=0;u<l;u++)for(s=o[u],c=(h=s.coverageAreas)?h.length:0,f=0;f<c;f++)for(i=h[f],r=i.bbox,r={extent:w.geographicToWebMercator(new b(r[1],r[0],r[3],r[2],a)),attribution:s.attribution||"",zoomMin:i.zoomMin-(t&&i.zoomMin?1:0),zoomMax:i.zoomMax-(t&&i.zoomMax?1:0),score:y.isDefined(i.score)?i.score:100,objectId:u},i=r.zoomMin;i<=r.zoomMax;i++)e[i]=e[i]||[],e[i].push(r);return e},_getContributorsList:function(n,t,i){var r="";if(t&&y.isDefined(i)&&-1<i){n=n[i];i=t.getCenter().normalize();for(var f=n?n.length:0,u=[],e={},r=0;r<f;r++)t=n[r],!e[t.objectId]&&t.extent.contains(i)&&(e[t.objectId]=1,u.push(t));for(u.sort(function(n,t){return t.score-n.score||n.objectId-t.objectId}),f=u.length,r=0;r<f;r++)u[r]=u[r].attribution;r=u.join(", ")}return r},_adjustCursorStyle:function(){var n=a.position(this.listNode.parentNode,!0).h;l.contains(this.listNode.parentNode,"esriAttributionOpen")?(l.remove(this.listNode.parentNode,"esriAttributionOpen"),n>a.position(this.listNode.parentNode,!0).h?(c.set(this.listNode.parentNode,"cursor","pointer"),l.add(this.listNode.parentNode,"esriAttributionOpen")):c.set(this.listNode.parentNode,"cursor","default")):(l.add(this.listNode.parentNode,"esriAttributionOpen"),n<a.position(this.listNode.parentNode,!0).h?c.set(this.listNode.parentNode,"cursor","pointer"):c.set(this.listNode.parentNode,"cursor","default"),l.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}}),f("extend-esri")&&t.setObject("dijit.Attribution",n,v),n})},"esri/dijit/FontAlignment":function(){require({cache:{"url:esri/dijit/templates/FontAlignment.html":'<div class="esriFontAlignment">\r\n  <div class="top">\r\n    <button class="icon" value="baseline,right" data-dojo-attach-event="onClick:changeValue"><div class="bot-right"><\/button>\r\n    <button class="icon" value="baseline,center" data-dojo-attach-event="onClick:changeValue"><div class="bot-mid"><\/button>\r\n    <button class="icon" value="baseline,left" data-dojo-attach-event="onClick:changeValue"><div class="bot-left"><\/button>\r\n  <\/div>\r\n  <div class="mid">\r\n    <button class="icon" value="middle,right" data-dojo-attach-event="onClick:changeValue"><div class="mid-right"><\/button>\r\n    <button class="icon" value="middle,center" data-dojo-attach-event="onClick:changeValue"><div class="mid-mid"><\/button>\r\n    <button class="icon" value="middle,left" data-dojo-attach-event="onClick:changeValue"><div class="mid-left"><\/button>\r\n  <\/div>\r\n  <div class="bot">\r\n    <button class="icon" value="top,right" data-dojo-attach-event="onClick:changeValue"><div class="top-right"><\/button>\r\n    <button class="icon" value="top,center" data-dojo-attach-event="onClick:changeValue"><div class="top-mid"><\/button>\r\n    <button class="icon" value="top,left" data-dojo-attach-event="onClick:changeValue"><div class="top-left"><\/div><\/button>\r\n  <\/div>\r\n<\/div>'}});define("esri/dijit/FontAlignment","require dojo/_base/declare dojo/_base/lang dojo/has ../kernel dojo/_base/array dojo/query dojo/dom-class dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/FontAlignment.html".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){return n=t([s,h,c],{declaredClass:"esri.dijit.FontAlignment",templateString:l,widgetsInTemplate:!0,value:null,_imageUrl:n.toUrl("./images/positionSprite.png"),destroy:function(){this.inherited(arguments)},setValue:function(n){this.value=n;var t=e("button",this.domNode);f.forEach(t,function(t){t.value===n?o.add(t,"selectedFontAlignment"):o.remove(t,"selectedFontAlignment")})},getValue:function(){return this.value},changeValue:function(n){var t=e("button",this.domNode);f.forEach(t,function(n){o.remove(n,"selectedFontAlignment")});o.add(n.currentTarget,"selectedFontAlignment");this.value=n.currentTarget.value;this.emit("change",{value:this.value})}}),r("extend-esri")&&i.setObject("dijit.FontAlignment",n,u),n})},"esri/dijit/Form":function(){require({cache:{"url:esri/dijit/templates/Form.html":'<div class="esriForm">\r\n<\/div>'}});define("esri/dijit/Form","require dojo/_base/declare dojo/_base/lang dojo/has ../kernel dojo/_base/array dojo/dom-style dojo/dom-construct dojo/dom-class dojo/query dijit/_Widget dijit/_TemplatedMixin dojo/text!./templates/Form.html".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return t=t([c,l],{declaredClass:"esri.dijit.Form",widgetsInTemplate:!0,templateString:a,widgets:{},fieldTypes:{string:{widget:"dijit/form/TextBox"},date:{widget:"dijit/form/DateTextBox"},number:{widget:"dijit/form/NumberTextBox"},boolean:{widget:"dijit/form/Select",widgetParameters:{options:[{label:"True",value:"true"},{label:"False",value:"false"}]}}},fieldTemplate:"<div><div>{label}<\/div><div>{widget}<\/div><\/div>",constructor:function(n){this.fieldTypes=i.mixin(this.fieldTypes,n.fieldTypes)},postCreate:function(){this._fieldsLength=this.fields.length;f.forEach(this.fields,function(n){this.addField(n)},this)},destroy:function(){this.inherited(arguments);var n,t;for(n in this.widgets)this.widgets.hasOwnProperty(n)&&(t=this.widgets[n],t.destroy());this.widgets=null},addField:function(t){var c,f,l,a,u,r=this;c=(t.template||this.fieldTemplate).replace("{label}",'<span class="esriFormFieldLabel">'+(t.label||t.name)+"<\/span>");c=c.replace("{widget}",'<div class="esriFormFieldWidget"><\/div>');f=o.toDom(c);s.add(f,"esriFormField");l=h(".esriFormFieldWidget",f)[0];e.set(f,{display:!1===t.visible?"none":"block"});n([t.widget||this.fieldTypes[t.type].widget],function(n){a=t.widgetParameters||r.fieldTypes[t.type].widgetParameters||{};u=new n(a,l);u.startup();s.add(u.domNode,"esriFormFieldWidget");u.fieldNode=f;u.initialState={value:t.value||null,visible:t.visible||!0,disabled:t.disabled||!1};r.domNode.appendChild(f);r.widgets[t.name]=u;r.setField(t);u.on("change",i.hitch(r,function(n,t){var i;t&&(i=t.value||t,t.target&&t.target.value&&(i=t.target.value),i={fieldName:n,value:i},r.emit("value-change",i))},t.name));r._fieldsLength--;var e,c;if(0===r._fieldsLength)for(n=h(".esriFormField",r.domNode),e=0;e<n.length;e++)for(c=e;c<n.length;c++)(r.fields[e].label||r.fields[e].name)===h(".esriFormFieldLabel",n[c])[0].innerHTML&&o.place(n[c],r.domNode,e)})},removeField:function(n){i.isString(n)||(n=n.name);n=this.getWidget(n);n.fieldNode.parentNode.removeChild(n.fieldNode);n.destroy()},getWidget:function(n){return this.widgets[n]},reset:function(){var n,t;for(n in this.widgets)this.widgets.hasOwnProperty(n)&&(t=this.widgets[n].initialState,this.setField({name:n,value:t.value,visible:t.visible,disabled:t.disabled}))},getField:function(n){var t=this.getWidget(n);return{label:h(".esriFormFieldLabel",t.parentNode)[0].innerHTML,name:n,value:t.value||t.getValue(),visible:t.visible,disabled:t.disabled}},setValues:function(n){for(var t in n)n.hasOwnProperty(t)&&this.setValue(t,n[t])},setValue:function(n,t){var i=this.getWidget(n);i.setValue?i.setValue(t):i.set&&i.set("value",t)},setFields:function(n){f.forEach(n,function(n){this.setField(n)})},setField:function(n){var t=this.getWidget(n.name);h(".esriFormFieldLabel",t.fieldNode)[0].innerHTML=n.label||n.name;(!0===n.visible||!1===n.visible)&&(t.setVisibility?t.setVisibility(n.visible):t.set&&t.set("visible",n.visible));(!0===n.disabled||!1===n.disabled)&&(t.setDisabled?t.setDisabled(n.disabled):t.set&&t.set("disabled",n.disabled));(void 0!==n.value||null!==n.value)&&(t.setValue?t.setValue(n.value):t.set&&t.set("value",n.value))}}),r("extend-esri")&&i.setObject("dijit.Form",t,u),t})},"esri/dijit/OverviewMap":function(){require({cache:{"url:esri/dijit/templates/OverviewMap.html":'<div class="esriOverviewMap">\r\n  <div class="ovwContainer" dojoattachpoint="_body" style="width: ${width}px; height: ${height}px;">\r\n    <div id="${id}-map" style="width: 100%; height: 100%;">\r\n      <div class="ovwHighlight" dojoattachpoint="_focusDiv" title="${NLS_drag}" style="border: 1px solid ${color}; background-color: ${color};"><\/div>\r\n    <\/div>\r\n  <\/div>\r\n  <div class="ovwButton ovwController" title="${NLS_show}" dojoattachpoint="_controllerDiv" dojoattachevent="onclick: _visibilityHandler">\r\n  <\/div>\r\n  <div class="ovwButton ovwMaximizer" title="${NLS_maximize}" dojoattachpoint="_maximizerDiv" dojoattachevent="onclick: _maximizeHandler">\r\n  <\/div>\r\n<\/div>\r\n'}});define("esri/dijit/OverviewMap","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){return n=n([s,h],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:rt,constructor:function(n,u){var f,e;t.mixin(this,ut.widgets.overviewMap);n=n||{};n.map?(f={},u&&(this._detached=!0,f=r.coords(u,!0)),this.map=n.map,this.baseLayer=n.baseLayer,this.width=n.width||f.w||this.map.width/4,this.height=n.height||f.h||this.map.height/4,this.attachTo=n.attachTo||"top-right",this.expandFactor=n.expandFactor||2,this.color=n.color||"#000000",this.opacity=n.opacity||.5,this.maximizeButton=!!n.maximizeButton,this.visible=!!n.visible,this.map.loaded?this._initialSetup():e=i.connect(this.map,"onLoad",this,function(){i.disconnect(e);e=null;this._initialSetup()}),this._detached&&(this.visible=!0),this._maximized=!1):console.error("esri.dijit.OverviewMap: "+this.NLS_noMap)},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>u("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(e.set(this._body,"display","block"),e.set(this._controllerDiv,"display","none"),e.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():i.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||f.add(this._maximizerDiv,"ovwDisabledButton"),f.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),f.add(this._controllerDiv,"ovwShow"),f.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));e.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(n){!n||0>=n.w||0>=n.h||this._resize(n.w,n.h)},show:function(){if(!this.visible){var n=this._controllerDiv;n.title=this.NLS_hide;f.remove(n,"ovwShow");f.add(n,"ovwHide");it.show(this._body);it.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var n=this._controllerDiv;n.title=this.NLS_show;f.remove(n,"ovwHide");f.add(n,"ovwShow");this._maximized&&this._maximizeHandler();it.hide(this._body);it.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var n=this.baseLayer||this._mainMapLayer,t=this.map.spatialReference,r=n.spatialReference;if(r.wkid!==t.wkid&&r.wkt!==t.wkt)console.error("esri.dijit.OverviewMap: "+this.NLS_invalidSR);else{if(t=n.declaredClass,n instanceof v)if(-1!==t.indexOf("VETiledLayer"))this.baseLayer=new g({resourceInfo:n.getResourceInfo(),culture:n.culture,mapStyle:n.mapStyle,bingMapsKey:n.bingMapsKey});else if(-1!==t.indexOf("OpenStreetMapLayer"))this.baseLayer=new d({tileServers:n.tileServers});else if(-1!==t.indexOf("WebTiledLayer")){var t=n.initialExtent,r=n.fullExtent,u=n.tileInfo;this.baseLayer=new n.constructor(n.urlTemplate,{initialExtent:t&&new t.constructor(t.toJson()),fullExtent:r&&new r.constructor(r.toJson()),tileInfo:u&&new u.constructor(u.toJson()),tileServers:n.tileServers&&n.tileServers.slice(0)})}else this.baseLayer=new w(n.url,{resourceInfo:n.getResourceInfo()});else if(n instanceof y)-1!==t.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new k(n.url):(this.baseLayer=new b(n.url),this.baseLayer.setImageFormat("png24"));else if(n instanceof p)this.baseLayer=new w("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",{});else{console.error("esri.dijit.OverviewMap: "+this.NLS_invalidType);return}!this._detached&&this.visible&&this._controllerDiv&&(n=function(){this.visible=!1;this.show()},this.baseLayer.loaded?n.call(this):i.connect(this.baseLayer,"onLoad",this,n))}}else console.error("esri.dijit.OverviewMap: "+this.NLS_noLayer)},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var n=this._maximizerDiv;this._maximized?(n.title=this.NLS_maximize,f.remove(n,"ovwRestore"),f.add(n,"ovwMaximize"),this._resize(this.width,this.height)):(n.title=this.NLS_restore,f.remove(n,"ovwMaximize"),f.add(n,"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(n,t){e.set(this._body,{width:n+"px",height:t+"px"});var r=tt.defaults.map.panDuration,i=this.overviewMap;tt.defaults.map.panDuration=0;i&&(i.resize(!0),i.centerAt(this._focusExtent.getCenter()));tt.defaults.map.panDuration=r},_initialize:function(){if(this.overviewMap)this._activate();else{var n,r;r=9>u("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=n=new c(r,{slider:!1,showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});i.connect(n,"onLoad",this,function(){this._map_resize_override=t.hitch(n,this._map_resize_override);n.disableMapNavigation();this._activate()});n.addLayer(this.baseLayer)}},_activate:function(){var t=this.map,n=this.overviewMap;this._moveableHandle=new o(this._focusDiv);this._soeConnect=i.connect(t,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=i.connect(t,"onPan",this,this._updateFocus);this._oecConnect=i.connect(n,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=i.connect(n,"onPan",this,this._ovwPanHandler);this._ozsConnect=i.connect(n,"onZoomStart",this,function(){it.hide(this._focusDiv)});this._ozeConnect=i.connect(n,"onZoomEnd",this,function(){it.show(this._focusDiv)});this._omsConnect=i.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(t.extent,null,null,null)},_deactivate:function(){i.disconnect(this._soeConnect);i.disconnect(this._ufoConnect);i.disconnect(this._oecConnect);i.disconnect(this._opaConnect);i.disconnect(this._ozsConnect);i.disconnect(this._ozeConnect);i.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(n){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=n,this.overviewMap.setExtent(n.expand(this.expandFactor),!0))},_updateFocus:function(n){this._suspendPanHandling||(this._focusExtent=n,this._drawFocusDiv(n))},_drawFocusDiv:function(n,t){var i=this.overviewMap,r=i.toScreen(new l(n.xmin,n.ymax,i.spatialReference)),u=i.toScreen(new l(n.xmax,n.ymin,i.spatialReference)),i=u.x-r.x,u=u.y-r.y,f=!0;i>this.overviewMap.width&&u>this.overviewMap.height&&(f=!1);e.set(this._focusDiv,{left:r.x+(t?t.x:0)+"px",top:r.y+(t?t.y:0)+"px",width:i+"px",height:u+"px",display:f?"block":"none"})},_moveStopHandler:function(n){var t=this._moveableHandle.node.style;n=this._focusExtent;var i=this.overviewMap,t=i.toMap(new a(parseInt(t.left,10),parseInt(t.top,10))),r=new l(n.xmin,n.ymax,i.spatialReference);this._focusExtent=n.offset(t.x-r.x,t.y-r.y);this._maximized?this._maximizeHandler():i.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(n,t){this._drawFocusDiv(this._focusExtent,t)}}),u("extend-esri")&&t.setObject("dijit.OverviewMap",n,nt),n})},"esri/dijit/Scalebar":function(){define("esri/dijit/Scalebar","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/query ../kernel ../lang ../domUtils ../units ../SpatialReference ../WKIDUnitConversion ../geometry/Point ../geometry/ScreenPoint ../geometry/Polyline ../geometry/geodesicUtils ../geometry/webMercatorUtils ../geometry/screenUtils ../geometry/normalizeUtils dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){return n=n(null,{declaredClass:"esri.dijit.Scalebar",map:null,mapUnit:null,scalebarUnit:null,unitsDictionary:[],domNode:null,screenPt1:null,screenPt2:null,localStrings:it.widgets.scalebar,constructor:function(n,e){if(this.metricScalebar=f.create("div",{innerHTML:"<div class='esriScaleLabelDiv'><div class='esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'><\/div><\/div><div class='esriScalebarLine esriScalebarMetricLine'><\/div>"}),this.englishScalebar=f.create("div",{innerHTML:"<div class='esriScalebarLine esriScalebarEnglishLine'><\/div><div class='esriScaleLabelDiv'><div class='esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'><\/div><\/div>"}),this.domNode=f.create("div"),n=n||{},n.map){if(n.scalebarUnit){if("english"!==n.scalebarUnit&&"metric"!==n.scalebarUnit&&"dual"!==n.scalebarUnit){console.error("scalebar unit only accepts english or metric or dual");return}this.scalebarUnit=n.scalebarUnit}else this.scalebarUnit="english";if(n.scalebarStyle){if("ruler"!==n.scalebarStyle&&"line"!==n.scalebarStyle){console.error("scalebar style must be ruler or line");return}this.scalebarStyle=n.scalebarStyle}else this.scalebarStyle="ruler";this.background=n.background;switch(this.scalebarUnit){case"english":"ruler"===this.scalebarStyle&&(this.englishScalebar.innerHTML="<div class='esriScalebarRuler'><div class='esriScalebarRulerBlock upper_firstpiece'><\/div><div class='esriScalebarRulerBlock upper_secondpiece'><\/div><div class='esriScalebarRulerBlock lower_firstpiece'><\/div><div class='esriScalebarRulerBlock lower_secondpiece'><\/div><\/div><div class='scaleLabelDiv'><div class='esriScalebarLabel' style='left: -3%'>0<\/div><div class='esriScalebarLabel esriScalebarFirstNumber'><\/div><div class='esriScalebarLabel esriScalebarSecondNumber'><\/div><\/div>");this.domNode.appendChild(this.englishScalebar);break;case"metric":"ruler"===this.scalebarStyle&&(this.metricScalebar.innerHTML="<div class='esriScalebarRuler'><div class='esriScalebarRulerBlock upper_firstpiece'><\/div><div class='esriScalebarRulerBlock upper_secondpiece'><\/div><div class='esriScalebarRulerBlock lower_firstpiece'><\/div><div class='esriScalebarRulerBlock lower_secondpiece'><\/div><\/div><div class='scaleLabelDiv'><div class='esriScalebarLabel' style='left: -3%'>0<\/div><div class='esriScalebarLabel esriScalebarFirstNumber'><\/div><div class='esriScalebarLabel esriScalebarSecondNumber'><\/div><\/div>");this.domNode.appendChild(this.metricScalebar);break;case"dual":this.domNode.appendChild(this.metricScalebar);this.domNode.appendChild(this.englishScalebar)}if(this.map=n.map,e?e.appendChild(this.domNode):(this.map.container.appendChild(this.domNode),n.attachTo?u.add(this.domNode,"scalebar_"+n.attachTo):u.add(this.domNode,"scalebar_bottom-left")),u.add(this.domNode,"esriScalebar"),this.map.loaded)this._getDistance(this.map.extent),this._checkBingMaps();else var o=r.connect(this.map,"onLoad",this,function(){r.disconnect(o);o=null;this._getDistance(this.map.extent);this._checkBingMaps()});this._mapOnPan=r.connect(this.map,"onPan",this,this._getDistance);this._mapOnExtentChange=r.connect(this.map,"onExtentChange",this,this._getDistance);i.forEach(this.map.layerIds,function(n){"esri.virtualearth.VETiledLayer"===this.map.getLayer(n).declaredClass&&r.connect(this.map.getLayer(n),"onVisibilityChange",t.hitch(this,function(){this._checkBingMaps()}))},this);this._mapOnLayerAdd=r.connect(this.map,"onLayerAdd",t.hitch(this,function(n){"esri.virtualearth.VETiledLayer"===n.declaredClass&&r.connect(n,"onVisibilityChange",t.hitch(this,function(){this._checkBingMaps()}));this._checkBingMaps()}));this._mapOnLayerRemove=r.connect(this.map,"onLayerRemove",t.hitch(this,this._checkBingMaps))}else console.error("scalebar: unable to find the 'map' property in parameters")},hide:function(){this._hidden=!0;a.hide(this.domNode)},show:function(){this._hidden=!1;a.show(this.domNode)},destroy:function(){r.disconnect(this._mapOnPan);r.disconnect(this._mapOnExtentChange);r.disconnect(this._mapOnLayerAdd);r.disconnect(this._mapOnLayerRemove);this.hide();this.map=null;f.destroy(this.domNode)},_checkBingMaps:function(){u.contains(this.domNode,"scalebar_bottom-left")&&(o.set(this.domNode,"left","25px"),i.forEach(this.map.layerIds,function(n){if("esri.virtualearth.VETiledLayer"===this.map.getLayer(n).declaredClass&&this.map.getLayer(n).visible){var t="95px";this.map._mapParams.nav&&(t="115px");o.set(this.domNode,"left",t)}},this))},_getDistance:function(n){var i=e.position(this.domNode,!0).y-this.map.position.y,i=i>this.map.height?this.map.height:i,i=0>i?0:i,u=new b(0,i),i=new b(this.map.width,i),t,f,s;this.mapUnit="esriDecimalDegrees";var r=nt.toMapPoint(n,this.map.width,this.map.height,u),o=nt.toMapPoint(n,this.map.width,this.map.height,i),u=new w(n.xmin,(n.ymin+n.ymax)/2,this.map.spatialReference),i=new w(n.xmax,(n.ymin+n.ymax)/2,this.map.spatialReference);3857===this.map.spatialReference.wkid||102100===this.map.spatialReference.wkid||102113===this.map.spatialReference.wkid||this.map.spatialReference.wkt&&-1!=this.map.spatialReference.wkt.indexOf("WGS_1984_Web_Mercator")?(r=g.webMercatorToGeographic(r,!0),o=g.webMercatorToGeographic(o,!0),u=g.webMercatorToGeographic(u,!0),i=g.webMercatorToGeographic(i,!0)):(l.isDefined(p[this.map.spatialReference.wkid])||this.map.spatialReference.wkt&&0===this.map.spatialReference.wkt.indexOf("PROJCS"))&&(this.mapUnit="linearUnit",n=Math.abs(n.xmax-n.xmin),l.isDefined(p[this.map.spatialReference.wkid])?t=p.values[p[this.map.spatialReference.wkid]]:(t=this.map.spatialReference.wkt,f=t.lastIndexOf(",")+1,s=t.lastIndexOf("]]"),t=parseFloat(t.substring(f,s))),n*=t,f=n/1609,t=n/1e3,n/=1e3);"esriDecimalDegrees"===this.mapUnit&&(t=d.isSupported(this.map.spatialReference)?this.map.spatialReference.wkid:4326,n=new k(new y({wkid:t})),n.addPath([r,o]),r=tt._straightLineDensify(n,10),n=d.geodesicLengths([r],v.KILOMETERS)[0],r=new k(new y({wkid:t})),r.addPath([u,i]),u=tt._straightLineDensify(r,10),d.geodesicLengths([u],v.KILOMETERS),f=n/1.609,t=n);"english"===this.scalebarUnit?this._getScaleBarLength(f,"mi"):"metric"===this.scalebarUnit?this._getScaleBarLength(t,"km"):"dual"===this.scalebarUnit&&(this._getScaleBarLength(f,"mi"),this._getScaleBarLength(t,"km"))},_getScaleBarLength:function(n,t){var i=50*n/this.map.width,e=0,f=t,r,u;for(.1>i&&("mi"===t?(i*=5280,f="ft"):"km"===t&&(i*=1e3,f="m"));1<=i;)i/=10,e++;.5<i?(r=1,u=.5):.3<i?(r=.5,u=.3):.2<i?(r=.3,u=.2):.15<i?(r=.2,u=.15):.1<=i&&(r=.15,u=.1);r=r/i>=i/u?u:r;this._drawScaleBar(r/i*50,Math.pow(10,e)*r,f)},_drawScaleBar:function(n,t,r){var u=2*Math.round(n),f,e;"mi"===r||"ft"===r?(this.englishScalebar.style.width=u+"px",n=h(".esriScalebarFirstNumber",this.englishScalebar),f=h(".esriScalebarSecondNumber",this.englishScalebar),e=h(".esriScalebarMetricLineBackground",this.englishScalebar)):(this.metricScalebar.style.width=u+"px",n=h(".esriScalebarFirstNumber",this.metricScalebar),f=h(".esriScalebarSecondNumber",this.metricScalebar),e=h(".esriScalebarMetricLineBackground",this.metricScalebar));i.forEach(e,function(n){n.style.width=u-2+"px"},this);i.forEach(n,function(n){n.innerHTML=t},this);i.forEach(f,function(n){n.innerHTML="esriUnknown"!==this.mapUnit?2*t+this.localStrings[r]:2*t+"Unknown Unit"},this)}}),s("extend-esri")&&t.setObject("dijit.Scalebar",n,c),n})},"esri/dijit/SymbolEditor":function(){require({cache:{"url:esri/dijit/templates/SymbolEditor.html":'<div class="esriSymbolEditor">\r\n<\/div>'}});define("esri/dijit/SymbolEditor","dojo/_base/declare dojo/_base/lang dojo/has ../kernel dojo/_base/array dojo/_base/Color dojo/dom-construct dojo/query dijit/_Widget dijit/_TemplatedMixin ../domUtils ./Form dojo/text!./templates/SymbolEditor.html dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){return n=n([s,h],{declaredClass:"esri.dijit.SymbolEditor",widgetsInTemplate:!0,templateString:a,symbolConfigLabel:v.widgets.textSymbolEditor.symbolConfiguration,alignmentLabel:v.widgets.textSymbolEditor.alignment,colorLabel:v.widgets.textSymbolEditor.color,haloLabel:v.widgets.textSymbolEditor.halo,_showHaloStyler:!0,constructor:function(){this.set("_showHaloStyler",10>i("ie")?!1:!0)},destroy:function(){this.inherited(arguments);this.form.destroy();this.form=null},createForm:function(n){var i,r,u,f;if(n=n||this.graphic){if(i=n.symbol||n.getLayer().renderer&&n.getLayer().renderer.getSymbol(n),r={},!this.form||this._symbolType&&this._symbolType!==i.type){this.form&&this.destroy();this._symbolType=i.type;r=e.create("div",null,this.domNode);switch(i.type){case"textsymbol":this.form=this._createTextEditorForm(i,r)}this.form.startup()}else r.color=i.color.toHex(),r.alignment=(i.verticalAlignment||"baseline")+","+i.horizontalAlignment,this._showHaloStyler&&(u=i.haloSize||null,f=i.haloColor?i.haloColor.toHex():null,r.halo={haloSize:u,haloColor:f}),this._symbolChangeHandler&&this._symbolChangeHandler.remove(),this.form.setValues(r);this._symbolChangeHandler=this.form.on("value-change",t.hitch(this,"_valueChangeCallback",n,i))}},hide:function(){c.hide(this.domNode)},show:function(){c.show(this.domNode)},_createTextEditorForm:function(n,t){var i=(n.verticalAlignment||"baseline")+","+n.horizontalAlignment,f=n.color.toHex(),u=n.haloColor||null,r=n.haloSize||0,i=[{name:"alignment",label:this.alignmentLabel,type:"string",value:i,widget:"./FontAlignment",widgetParameters:{value:i}},{name:"color",label:this.colorLabel,type:"string",value:f,widget:"dijit/ColorPalette",widgetParameters:{palette:"7x10"}}];return this._showHaloStyler&&i.push({name:"halo",label:this.haloLabel,type:"object",value:{haloColor:u,haloSize:r},widget:"./HaloStyler",widgetParameters:{haloColor:u,haloEnabled:!!r,haloSize:r}}),new l({fields:i},t)},_valueChangeCallback:function(n,t,i){var r,u;"color"===i.fieldName?t.setColor(new f(i.value)):"alignment"===i.fieldName?(r=i.value.split(",")[0],i=i.value.split(",")[1],t.setHorizontalAlignment(i),t.setVerticalAlignment(r)):"halo"===i.fieldName&&this._showHaloStyler&&(r=i.value.color,u=i.value.size,i.value.enabled?(t.setHaloSize(u),t.setHaloColor(new f(r))):(t.setHaloSize(0),t.setHaloColor(null)));n.setSymbol(t);this.emit("symbol-change",{symbol:t})}}),i("extend-esri")&&t.setObject("dijit.SymbolEditor",n,r),n})},"esri/dijit/HaloStyler":function(){require({cache:{"url:esri/dijit/HaloStyler/templates/HaloStyler.html":'<div class="${_css.container}">\r\n  <div class="${_css.topContainer}">\r\n    <label>${i18n.common.apply}<\/label>\r\n    <input data-dojo-attach-point="_haloCheckBox" data-dojo-type="dijit/form/CheckBox" checked=false type="checkbox">\r\n    <select class="${_css.haloSelect}" data-dojo-attach-point="_haloSizeSelect" data-dojo-type="dijit/form/Select">\r\n      <option value="0">0<\/option>\r\n      <option value="1" selected="selected">1<\/option>\r\n      <option value="2">2<\/option>\r\n      <option value="3">3<\/option>\r\n      <option value="4">4<\/option>\r\n      <option value="5">5<\/option>\r\n      <option value="6">6<\/option>\r\n      <option value="7">7<\/option>\r\n      <option value="8">8<\/option>\r\n      <option value="9">9<\/option>\r\n      <option value="10">10<\/option>\r\n    <\/select>\r\n  <\/div>\r\n  <div data-dojo-attach-point="_haloColorPaletteNode"><\/div>\r\n<\/div>'}});define("esri/dijit/HaloStyler","require dojo/_base/declare dojo/_base/lang dojo/has dojo/on ../kernel dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/ColorPalette dijit/form/Select dijit/form/CheckBox dojo/text!./HaloStyler/templates/HaloStyler.html dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){return n=t([e,o,s],{declaredClass:"esri.dijit.HaloStyler",templateString:a,widgetsInTemplate:!0,i18n:v,haloColor:null,haloEnabled:!1,haloSize:0,value:{},_defaultPaletteSize:"7x10",_defaultHaloColor:"#ffffff",_css:{container:"esri-halo-styler",topContainer:"esri-halo-styler-top-container",haloSelect:"esri-halo-styler-select"},postCreate:function(){this.inherited(arguments);this._setupDijits()},_setValueAttr:function(n){this._haloColorPalette&&(this.set("haloSize",n.haloSize||1),this._haloSizeSelect.set("value",this.get("haloSize")),this.set("haloColor",n.haloColor),this._haloColorPalette.set("value",this.get("haloColor")),this.set("haloEnabled",0<n.haloSize?!0:!1),this._haloCheckBox.set("checked",this.get("haloEnabled")))},_setupDijits:function(){this._haloCheckBox.set("checked",this.get("haloEnabled"));this._haloSizeSelect.set("value",this.get("haloSize"));this._createHaloColorPicker();this.own(u(this._haloCheckBox,"change",i.hitch(this,this._onHaloCheckboxChange)),u(this._haloSizeSelect,"change",i.hitch(this,this._onHaloSizeChange)))},_createHaloColorPicker:function(){this._haloColorPalette=new h({palette:this._defaultPaletteSize,value:this.get("haloColor")},this._haloColorPaletteNode);this._haloColorPalette.startup();this.own(u(this._haloColorPalette,"change",i.hitch(this,this._onHaloColorChange)))},_onHaloCheckboxChange:function(){this.set("haloEnabled",this._haloCheckBox.checked);this._haloCheckBox.checked&&0<this.get("haloSize")&&null===this.get("haloColor")&&(this._haloColorPalette.set("value",this._defaultHaloColor),this.set("haloColor",this._defaultHaloColor));this._onChange()},_onHaloSizeChange:function(){this.set("haloSize",this._haloSizeSelect.value);this._onChange()},_onHaloColorChange:function(n){n=this._haloColorPalette?this._haloColorPalette.value:n;n!==this.get("haloColor")&&(this.set("haloColor",n),this._onChange())},_onChange:function(){this.emit("change",{enabled:this.get("haloEnabled"),size:this.get("haloSize"),color:this.get("haloColor")})}}),r("extend-esri")&&i.setObject("dijit.HaloStyler",n,f),n})},"esri/layers/ArcGISImageServiceLayer":function(){require({cache:{"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){return n=n(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasHistograms minValues maxValues meanValues stdvValues".split(" "),_rasterFunctionTemplateInfos:{},_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},constructor:function(n,t){this.useMapTime=t&&t.hasOwnProperty("useMapTime")?!!t.useMapTime:!0},_initialize:function(n,i){this._url=p.urlToObject(n);this.raster=new tt(this._url.path);this.infoTemplate=i&&i.infoTemplate;var r=i&&i.imageServiceParameters;this.format=r&&r.format;this.compressionTolerance=r&&r.compressionTolerance?r.compressionTolerance:.01;this.interpolation=r?r.interpolation:null;this.compressionQuality=r?r.compressionQuality:null;this.bandIds=r?r.bandIds:null;this.mosaicRule=r?r.mosaicRule:null;this.renderingRule=r?r.renderingRule:null;this.renderer=r?r.renderer:null;this.useMapDimensionValue=i&&i.hasOwnProperty("useMapDimensionValue")?!!i.useMapDimensionValue:!0;this.activeMapDimensions=i&&i.activeMapDimensions;this._params=t.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},r?r.toJson():{});this.pixelFilter=i&&i.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=t.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=t.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=t.hitch(this,this._initLayer);this._queryVisibleRastersHandler=t.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=i&&i.loadCallback;(r=i&&i.resourceInfo)?this._initLayer(r):v({url:this._url.path,content:t.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(n){var i,r;if(null!==n&&void 0!==n){this._findCredential();(this.credential&&this.credential.ssl||n&&n._ssl)&&this._useSSL();i=this.minScale;r=this.maxScale;t.mixin(this,n);this.minScale=i;this.maxScale=r;this.initialExtent=this.fullExtent=this.extent=new w(n.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var u=this.minValues,f=this.maxValues,e=this.meanValues,o=this.stdvValues,s=this.bands=[],i=0,r=this.bandCount;i<r;i++)s[i]={min:u[i],max:f[i],mean:e[i],stddev:o[i]};if(this.timeInfo=(i=this.timeInfo)&&i.timeExtent?new ft(i):null,r=this.fields=[],u=n.fields)for(i=0;i<u.length;i++)r.push(new et(u[i]));this.version=n.currentVersion;this.version||(this.version="fields"in n||"objectIdField"in n||"timeInfo"in n?10:9.3);a.isDefined(n.minScale)&&!this._hasMin&&this.setMinScale(n.minScale);a.isDefined(n.maxScale)&&!this._hasMax&&this.setMaxScale(n.maxScale);i={};n.defaultMosaicMethod?(i.method=n.defaultMosaicMethod,i.operation=n.mosaicOperator,i.sortField=n.sortField,i.sortValue=n.sortValue):i.method=d.METHOD_NONE;this.defaultMosaicRule=new d(i);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(t.hitch(this,function(n){n&&(n.features&&n.fields&&(this.rasterAttributeTable=t.clone(n)),n.features&&0<n.features.length&&(this._rasterAttributeTableFeatures=t.clone(n.features)),n.fields&&0<n.fields.length&&(this._rasterAttributeTableFields=t.clone(n.fields)),!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._isVectorData()&&!a.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new rt,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(t.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);(i=this._loadCallback)&&(delete this._loadCallback,i(this))}},getKeyProperties:function(){var t=this._url.path+"/keyProperties",n=new i(y._dfdCanceller);return 10<this.version?(n._pendingDfd=v({url:t,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),n._pendingDfd.then(function(t){n.callback(t)},function(t){n.errback(t)})):(t=Error("Layer does not have key properties"),t.log=!!f.isDebug,n.errback(t)),n},getRasterAttributeTable:function(n){var o=this._url.path+"/rasterAttributeTable",t=new i(y._dfdCanceller),r={f:"json"},e=this.hasRasterAttributeTable;return n&&n.renderingRule&&(r.renderingRule=u.toJson(n.renderingRule.toJson()),e=!0),10<this.version&&e?(t._pendingDfd=v({url:o,content:r,handleAs:"json",callbackParamName:"callback"}),t._pendingDfd.then(function(n){t.callback(n)},function(n){t.errback(n)})):(n=Error("Layer does not support raster attribute table"),n.log=!!f.isDebug,t.errback(n)),t},getRenderingRuleAttributeTable:function(n){var u=new i(y._dfdCanceller),r;return!n||!n.renderingRule?(u.errback(Error("Rendering rule is not specified")),u):(n=n.renderingRule,r=n.functionName,this._renderingRuleAttributeTable&&r&&this._renderingRuleAttributeTable.hasOwnProperty(r)?u.resolve(this._renderingRuleAttributeTable[r]):u=this.getRasterAttributeTable({renderingRule:n}).then(t.hitch(this,function(n){var i;return n&&n.features&&n.features.length&&n.fields&&n.fields.length&&(i={features:t.clone(n.features),fields:t.clone(n.fields)},r&&(this._renderingRuleAttributeTable[r]=i)),i})),u)},_getRasterAttributeTableFeatures:function(){var n=new i;return this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length?(n.resolve(this._rasterAttributeTableFeatures),n):10<this.version&&this.hasRasterAttributeTable?(n=this.getRasterAttributeTable(),n.then(t.hitch(this,function(n){n&&n.features&&0<n.features.length&&(this._rasterAttributeTableFeatures=t.clone(n.features))})),n):(n.resolve(this._rasterAttributeTableFeatures),n)},_getRenderingRuleAttributeTableFeatures:function(n){return n=n&&n.renderingRule,n?this.getRenderingRuleAttributeTable({renderingRule:n}).then(function(n){return n&&n.features}):(n=new i,n.errback(Error("Rendering rule is not specified")),n)},getCustomRasterFields:function(n){var o=n?n.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,e;n=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var u={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:n},f={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:n},s={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},i=this.fields?t.clone(this.fields):[];return n=i.length,i[n]=f,10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none"))&&(n++,i[n]=s),(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)&&(n++,i[n]=u),a.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)&&(u={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},f={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},n++,i[n]=u,n++,i[n]=f),n=this._rasterAttributeTableFields,(u=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(u)&&(n=this._renderingRuleAttributeTable[u].fields),n&&0<n.length&&(n=r.filter(n,function(n){return"esriFieldTypeOID"!==n.type&&"value"!==n.name.toLowerCase()}),n=r.map(n,function(n){var i=t.clone(n);return i.name=o+n.name,i}),i=i.concat(n)),e=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix,10.4<=this.version&&this.rasterFunctionInfos&&r.forEach(this.rasterFunctionInfos,function(n){n&&n.name&&"none"!==n.name.toLowerCase()&&(n={name:e+n.name.replace(/ /gi,"_"),alias:n.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},i.push(n))}),i},_prepareGetImageParameters:function(n,i,r,f){if(f=a.isDefined(f)?f:this._params,this.renderer){var e=this.getExportImageRenderingRule();f.renderingRule=e?u.toJson(e.toJson()):null}e=n.spatialReference.wkid||u.toJson(n.spatialReference.toJson(!1));delete f._ts;t.mixin(f,{bbox:n.xmin+","+n.ymin+","+n.xmax+","+n.ymax,imageSR:e,bboxSR:e,size:i+","+r},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete f.compressionTolerance;f.format&&"LERC"===f.format.toUpperCase()&&(f.compressionTolerance=this.compressionTolerance);f.token=this._getToken()},getImageUrl:function(n,i,r,u,f){f=a.isDefined(f)?f:this._params;this._prepareGetImageParameters(n,i,r,f);n=t.clone(f);this._cleanupRequestParams(n);i=this._url.path+"/exportImage?";r=p.addProxy(i+s.objectToQuery(t.mixin(n,{f:"image"})));var e=n.token;r.length>l.defaults.io.postLength||this.useMapImage?this._jsonRequest=v({url:i,content:t.mixin(n,{f:"json"}),callbackParamName:"callback",load:function(n){var t=n.href;e&&(t+=-1===t.indexOf("?")?"?token="+e:"&token="+e);u(p.addProxy(t))},error:this._errorHandler}):u(r)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(n,t){this.interpolation=this._params.interpolation=n;t||this.refresh(!0)},setCompressionQuality:function(n,t){this.compressionQuality=this._params.compressionQuality=n;t||this.refresh(!0)},setCompressionTolerance:function(n,t){this.compressionTolerance=n;t||this.refresh(!0)},setBandIds:function(n,t){var i=!1;this.bandIds!==n&&(i=!0);this.bandIds=n;this._params.bandIds=n.join(",");i&&!t&&this.onRenderingChange();t||this.refresh(!0)},setDefaultBandIds:function(n){this.bandIds=this._params.bandIds=null;n||this.refresh(!0)},setDisableClientCaching:function(n){this.disableClientCaching=n},setMosaicRule:function(n,t){var i=!1;this.mosaicRule!==n&&(i=!0);this.mosaicRule=n;this._params.mosaicRule=u.toJson(n.toJson());i&&!t&&this.onMosaicRuleChange();t||this.refresh(!0)},setRenderingRule:function(n,t){var i=!1;this.renderingRule!==n&&(i=!0);this.renderingRule=n;this._params.renderingRule=n?u.toJson(n.toJson()):null;this._useRenderingRuleAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:n});i&&this.onRenderingChange();this._setDefaultFilter();t||this.refresh(!0)},setImageFormat:function(n,t){this.format=this._params.format=n;this._setDefaultFilter();t||this.refresh(!0)},setInfoTemplate:function(n){this.infoTemplate=n},setDefinitionExpression:function(n,t){var i=this.mosaicRule?this.mosaicRule.toJson():{};return this.mosaicRule||(this.defaultMosaicRule?i=this.defaultMosaicRule.toJson():i.method=d.METHOD_NONE),i.where=n,i=new d(i),this.setMosaicRule(i,t),this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(n){this.pixelFilter=n;this._isDefaultPixelFilter=!1},getPixelData:function(n){return n?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),this.renderingRule)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(){var n=new i(y._dfdCanceller),t;return this.hasHistograms?(n._pendingDfd=v({url:this._url.path+"/histograms",content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),n._pendingDfd.then(function(t){n.callback(t)},function(t){n.errback(t)})):(t=Error("Layer does not have histograms."),t.log=!!f.isDebug,n.errback(t)),n},computeHistograms:function(n){var r=new i(y._dfdCanceller);if(10.1<=this.currentVersion){n=n||{};var s=n.geometry||this.fullExtent,u=(n.geometry||this.fullExtent).toJson(),s="extent"===s.type?"esriGeometryEnvelope":"esriGeometryPolygon",e=n.renderingRule||this.renderingRule||this.defaultRenderingRule,e=e?e.toJson():null,o=n.mosaicRule||this.mosaicRule||this.defaultMosaicRule,o=o?o.toJson():null;n=n.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};r._pendingDfd=v({url:this._url.path+"/computeHistograms",content:t.mixin({f:"json",geometry:JSON.stringify(u),geometryType:s,renderingRule:JSON.stringify(e),mosaicRule:JSON.stringify(o),pixelSize:JSON.stringify(n),callbackParamName:"callback"}),handleAs:"json"});r._pendingDfd.then(function(n){r.callback(n)},function(n){r.errback(n)})}else u=Error("Layer doesn't support computeHistograms."),u.log=!!f.isDebug,r.errback(u);return r},getRenderingRuleServiceInfo:function(n){var f=new y._fixDfd(new i(y._dfdCanceller)),u;return n?(u=n&&n.functionName&&!n.functionArguments?n.functionName:null,u&&this._rasterFunctionTemplateInfos[u]?(f.resolve(this._rasterFunctionTemplateInfos[u]),f):v({url:this._url.path,content:t.mixin(t.mixin({f:"json",renderingRule:JSON.stringify(n.toJson())},this._url.query)),callbackParamName:"callback",load:t.hitch(this,function(n){var t={};return r.forEach(this._rasterFunctionServiceInfoProps,function(i){t[i]=n[i]}),this._rasterFunctionTemplateInfos[u]=t}),error:this._errorHandler})):(f.errback(Error("Rendering rule is not specified")),f)},queryVisibleRasters:function(n,u,f,e){var s=this._map,a=y._fixDfd(new i(y._dfdCanceller)),l,d,p,w,tt,nt;this._visibleRasters=[];var o,h,k=!0,v=this.infoTemplate?this.infoTemplate.info:null,c=v?t.clone(this.infoTemplate.info.fieldInfos):null;if(u=u||{},v&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length&&(l=[],r.forEach(this.infoTemplate.info.mediaInfos,function(n){l=l.concat(n&&n.value&&n.value.fields||[])}),l.length&&r.forEach(c,function(n){n&&-1<l.indexOf(n.fieldName)&&(n.visible=!0)})),c&&0<c.length)for(k=!1,o=0;o<c.length;o++)if((h=c[o])&&h.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(h.visible||v.title&&-1<v.title.toLowerCase().indexOf(h.fieldName.toLowerCase()))){k=!0;break}return d=(h=this._removeVisualizationStretchFunction(this.renderingRule))&&h.functionName,p=[],10.4<=this.version&&(w=!1,this.rasterFunctionInfos&&c&&(tt=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix,r.forEach(this.rasterFunctionInfos,function(n){var t=tt+n.name.replace(/ /gi,"_");r.some(c,function(n){return n.visible&&n.fieldName===t})&&(w=w||d&&d===n.name,p.push(new g({rasterFunction:n.name})))})),h&&!w&&p.push(h)),o=new ht,o.geometry=n.geometry,o.returnGeometry=this._map.spatialReference.equals(this.spatialReference),o.returnCatalogItems=k,o.timeExtent=n.timeExtent,this._params.time&&this.mosaicRule?(n=t.clone(this.mosaicRule),n=this._filterOutTimeDimension(n),o.mosaicRule=n):o.mosaicRule=this.mosaicRule||null,o.renderingRule=10.4>this.version&&h||null,o.renderingRules=p||null,s&&(s=new b((s.extent.xmax-s.extent.xmin)/s.width,(s.extent.ymax-s.extent.ymin)/s.height,s.extent.spatialReference),o.pixelSize=s),u.requestParams=o,nt=this,s=new st(this.url),(a._pendingDfd=s.execute(o)).addCallbacks(function(n){nt._queryVisibleRastersHandler(n,u,f,e,a)},function(n){nt._resolve([n],null,e,a,!0)}),a},_queryVisibleRastersHandler:function(n,i,f,e,o){function st(){var e=this.getCustomRasterFields(i),p=this._getDomainFields(e),ft=i?i.returnDomainValues:!1,nt=i&&i.rasterAttributeTableFieldPrefix,n,b,c,k,u,v,rt,d,g,ut;this._useRenderingRuleAttributeTable&&this.renderingRule?(e=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),ut=y):e=this._getRasterAttributeTableFeatures();e.then(t.hitch(this,function(i){var e,et;for(n=0;n<h.length;n++){if(s=h[n],s.setInfoTemplate(this.infoTemplate),s._layer=this,y&&(g=y.replace(/ /gi,"").split(","),b=y,c=g,l&&l.length>=n&&(b=l[n].replace(/ /gi,", "),c=l[n].split(" ")),s.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=c,s.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=g,ht&&(s.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=ht.replace(/ /gi,"").split(",")),this.pixelFilter&&(e=new it({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]}),r.forEach(c,function(n){e.addData({pixels:[n],statistics:{minValue:n,maxValue:n,noDataValue:null}})}),this.pixelFilter({pixelBlock:e,extent:new w(0,0,0,0,this._map.spatialReference)}),("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)&&(s.attributes[this._rasterFieldPrefix+"Magnitude"]=e.pixels[0][0],s.attributes[this._rasterFieldPrefix+"Direction"]=e.pixels[1][0])),r.forEach(ct,function(n){s.attributes[n.name]=n.value}),et=ut||b,i&&0<i.length&&(k=r.filter(i,function(n){if(n&&n.attributes)return n.attributes.hasOwnProperty("Value")?n.attributes.Value==et:n.attributes.VALUE==et}),0<k.length&&(u=t.clone(k[0]),nt&&u)))){d={};for(v in u.attributes)u.attributes.hasOwnProperty(v)&&(rt=nt+v,d[rt]=u.attributes[v]);u.attributes=d;s.attributes=t.mixin(s.attributes,u.attributes)}ft&&p&&0<p.length&&r.forEach(p,function(n){if(n){var t=s.attributes[n.name];a.isDefined(t)&&(t=this._getDomainValue(n.domain,t),a.isDefined(t)&&(s.attributes[n.name]=t))}},this);tt.push(s);this._visibleRasters.push(s)}this._resolve([tt,null,!0],null,f,o)}))}var y=n.value,ht=n.value,l,h,c=0,d=0,rt=this,ut=this.objectIdField,p,g,ct=[],ft,et,lt,at,vt,nt,b,s,tt;if(e=i.requestParams.renderingRules,ft=n.processedValues,et=this.renderingRule&&u.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson()),e&&ft&&e.length===ft.length&&(lt=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix,r.forEach(e,function(n,t){if(n.functionName){var i={name:lt+n.functionName.replace(/ /gi,"_"),value:ft[t].replace(/ /gi,"").split(",")};ct.push(i);et&&et===u.toJson(n.toJson())&&(y=ft[t])}})),e=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0,n.catalogItems){for(at=0,b=n.catalogItems.features.length,g=0,h=Array(b),l=Array(b),p=Array(b),c=0;c<b;c++)-1<n.properties.Values[c].toLowerCase().indexOf("nodata")&&g++;for(vt=b-g,c=0;c<b;c++)g=!0,-1<n.properties.Values[c].toLowerCase().indexOf("nodata")?(nt=vt++,e||(g=!1,h.length--,l.length--,p.length--)):nt=at++,g&&(h[nt]=n.catalogItems.features[c],l[nt]=n.properties.Values[c],p[nt]=h[nt].attributes[ut])}this._visibleRasters=[];(n=-1<y.toLowerCase().indexOf("nodata"))&&!e&&(h=[],l=[],p=[]);!y||h||n||(ut="ObjectId",h=[],s=new ot(new w(this.fullExtent),null,{ObjectId:0}),h.push(s));tt=[];h?!this._map.spatialReference.equals(this.spatialReference)&&p&&0<p.length?v({url:this._url.path+"/query",content:{f:"json",objectIds:p.join(","),returnGeometry:!0,outSR:u.toJson(rt._map.spatialReference.toJson()),outFields:ut},handleAs:"json",callbackParamName:"callback",load:function(n){if(0===n.features.length)rt._resolve([tt,null,null],null,f,o);else{for(c=0;c<n.features.length;c++)for(d=0;d<h.length;d++)h[d].attributes[ut]==n.features[c].attributes[ut]&&(h[d].geometry=new k(n.features[c].geometry),h[d].geometry.setSpatialReference(rt._map.spatialReference));st.call(rt)}},error:function(){rt._resolve([tt,null,null],null,f,o)}}):st.call(this):this._resolve([tt,null,null],null,f,o)},getVisibleRasters:function(){var n=this._visibleRasters,t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t},_getDomainFields:function(n){if(n){var t=[];return r.forEach(n,function(n){if(n.domain){var i={};i.name=n.name;i.domain=n.domain;t.push(i)}}),t}},_getDomainValue:function(n,t){if(n&&n.codedValues){var i;return r.some(n.codedValues,function(n){return n.code===t?(i=n.name,!0):!1}),i}},_requestData:function(n,i,r){this._rasterReadPromise&&this._rasterReadPromise.cancel();n=t.clone(n);var u=n._normalize(!0);this._prepareGetImageParameters(u,i,r);i=t.clone(this._params);this._cleanupRequestParams(i);i.extent=n;i.format=i.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===i.format.toLowerCase()&&!i.lercVersion&&10.5<=this.version&&(i.lercVersion=2);r=null;this._useBrowserDecoding()&&(r=new ut({ctx:this._context}));i={imageServiceParameters:i,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:r?t.hitch(r,"decode"):null};this._rasterReadPromise=this.raster.read(i,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(n){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=n,this.hasDataChanged=!0,this._setPixelData(n))},_setPixelData:function(n){n=this._clonePixelData(n);this.pixelFilter&&this.pixelFilter(n);this.pixelData=n;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(n){if(null===n||void 0===n)return n;var i={};return(n.extent&&(i.extent=t.clone(n.extent)),n=n.pixelBlock,null===n||void 0===n)?i:(i.pixelBlock=n.clone(),i)},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(n,t,i){n=n.getImageData(0,0,t,i).data;for(var o=t*i,r=0,s=0,p=new Uint8Array(o),w=new Uint8Array(o),b=new Uint8Array(o),k=new Uint8Array(o),h=Infinity,c=Infinity,l=Infinity,a=-Infinity,v=-Infinity,y=-Infinity,u,f,e,r=0;r<o;r++)u=n[s++],f=n[s++],e=n[s++],h=h<u?h:u,a=a>u?a:u,c=c<f?c:f,v=v>f?v:f,l=l<e?l:e,y=y>e?y:e,p[r]=u,w[r]=f,b[r]=e,k[r]=n[s++]&1;return new it({width:t,height:i,pixels:[p,w,b],pixelType:"U8",mask:k,statistics:[{minValue:h,maxValue:a},{minValue:c,maxValue:v},{minValue:l,maxValue:y}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var r=this._url.path+"/multiDimensionalInfo",n=new i(y._dfdCanceller);return this._multidimensionalInfo?(n.resolve(this._multidimensionalInfo),n):(10.3<=this.version&&this.hasMultidimensions?(n._pendingDfd=v({url:r,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),n._pendingDfd.then(t.hitch(this,function(t){this._multidimensionalInfo=t.multidimensionalInfo;n.callback(t.multidimensionalInfo)}),function(t){n.errback(t)})):(r=Error("Layer does not support multidimensional info"),r.log=!!f.isDebug,n.errback(r)),n)},getDefaultMultidimensionalDefinition:function(){var o,r,u,e=[],n=new i(y._dfdCanceller),f;return this._defaultMultidimensionalDefinition?(n.resolve(this._defaultMultidimensionalDefinition),n):(n._pendingDfd=this.getMultidimensionalInfo(),n._pendingDfd.then(t.hitch(this,function(t){o=t;r=o.variables[0].dimensions;for(u in r)r.hasOwnProperty(u)&&"StdTime"!==r[u].name&&(f=r[u],e.push(new nt({variableName:"",dimensionName:f.name,isSlice:!f.hasRanges,values:[this._getDefaultDimensionValue(f)]})));this._defaultMultidimensionalDefinition=e;n.callback(e)}),function(t){n.errback(t)}),n)},_getDefaultDimensionValue:function(n){if(n&&n.values&&n.values.length){var u,t,f=Infinity,r,i;if(n.hasRanges)return n.values[0];if(n.name&&"stdz"===n.name.toLowerCase()){for(i=0;i<n.values.length&&(r=n.values[i],t=Math.abs(+r),t<f&&(f=t,u=r),0!==t);i++);return u}return n.extent[0]}},_setDefaultMultidimensionalDefinition:function(n){var r,i={};this.getDefaultMultidimensionalDefinition().then(t.hitch(this,function(u){r=u;0<r.length&&(this.mosaicRule?(i=t.clone(this.mosaicRule),i.multidimensionalDefinition=r):this.defaultMosaicRule?(i=t.clone(this.defaultMosaicRule),i.multidimensionalDefinition=r):i=new d({multidimensionalDefinition:r}),this.setMosaicRule(i,n))}))},_setDefaultRenderingRule:function(n){var t={},i;!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase()?t.rasterFunction=this.rasterFunctionInfos[0].name:!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(i="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10,t.rasterFunction="Resample",t.rasterFunctionArguments={ResamplingType:i,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}});t.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new g(t),this.setRenderingRule(this.defaultRenderingRule,n))},_cleanupRequestParams:function(n){var t,i;if(!n)return n;n.time&&n.mosaicRule&&(t=new d(u.fromJson(n.mosaicRule)),t=this._filterOutTimeDimension(t),n.mosaicRule=u.toJson(t.toJson()));t="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(i in t)n.hasOwnProperty(t[i])&&delete n[t[i]];return n},_filterOutTimeDimension:function(n){if(n&&n.multidimensionalDefinition&&0<n.multidimensionalDefinition.length){var t=r.filter(n.multidimensionalDefinition,function(n){return"StdTime"!==n.dimensionName});n.multidimensionalDefinition=t}return n},_removeVisualizationStretchFunction:function(n){var i=n&&n.functionName,t;return!i||"stretch"!==i.toLowerCase()?n:(t=n.functionArguments.Raster,t&&t.functionName&&r.some(this.rasterFunctionInfos,function(n){return t.functionName===n.name})?t:n)},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(n){return r.some(n&&(this.rasterFunctionInfos||[]),function(t){return t&&t.name&&t.name.toLowerCase()===n.toLowerCase()})},_createPixelData:function(n){n=new it({width:2,height:2,pixels:n,pixelType:this.pixelType,statistics:n});var t=this.fullExtent.getCenter(),t=new w(t.x,t.y,t.x+this.pixelSizeX,t.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:n,extent:t}},_convertRendererToRenderingRule:function(n){var t=n&&n.declaredClass,i;return!t||"esri.renderer.UniqueValueRenderer"!==t&&"esri.renderer.ClassBreaksRenderer"!==t&&"esri.renderer.StretchRenderer"!==t?null:(i=null,"esri.renderer.StretchRenderer"===t?i=n.toRenderingRule():"esri.renderer.ClassBreaksRenderer"===t?i=this._convertClassifyRenderer(n):"esri.renderer.UniqueValueRenderer"===t&&(i=this._convertUniqueValueRenderer(n)),i)},_getValueField:function(n){if(n&&n.length){var i,t;return r.some(n,function(n){if((t=n.name)&&"value"===t.toLowerCase())return i=t,!0}),i}},_convertClassifyRenderer:function(n){var t,e=[],h=[],f=[],u,o,i,s,c;return t=this.renderingRule&&this.renderingRule.functionName,s=this.hasRasterAttributeTable,t&&(s=this._rasterFunctionTemplateInfos[t]?this._rasterFunctionTemplateInfos[t].hasRasterAttributeTable:this.hasRasterAttributeTable,i=this._renderingRuleAttributeTable[t]),o=i&&i.features?i.features:this._rasterAttributeTableFeatures,c=this._getValueField(i&&i.fields?i.fields:this._rasterAttributeTableFields),s&&o?(r.forEach(n.infos,function(t,i){var u,e=t.symbol.color;e.a&&r.forEach(o,function(r){u=r.attributes[n.attributeField];(u>=t.minValue&&u<t.maxValue||i===n.infos.length-1&&u>=t.minValue)&&f.push([r.attributes[c],e.r,e.g,e.b])},this)},this),t=new g,t.functionName="Colormap",t.functionArguments={},t.functionArguments.Colormap=f,t.variableName="Raster"):(r.forEach(n.infos,function(n,t){u=n.symbol&&n.symbol.color;u.a&&(e.push.call(e,n.minValue,n.maxValue),h.push(t),f.push([t,u.r,u.g,u.b]))}),t=new g,t.functionName="Remap",t.functionArguments={InputRanges:e,OutputValues:h},t.variableName="Raster",i=new g,i.functionName="Colormap",i.functionArguments={Colormap:f,Raster:t},t=i),t},_convertUniqueValueRenderer:function(n){var u=[],t=this.renderingRule&&this.renderingRule.functionName,f,i,e;return t&&(i=this._renderingRuleAttributeTable[t]),f=i&&i.features?i.features:this._rasterAttributeTableFeatures,e=this._getValueField(i&&i.fields?i.fields:this._rasterAttributeTableFields),r.forEach(n.infos,function(t){var i=t.symbol.color;i.a&&(n.attributeField!==e&&f?r.forEach(f,function(r){r.attributes[n.attributeField]==t.value&&u.push([r.attributes[e],i.r,i.g,i.b])},this):u.push([t.value,i.r,i.g,i.b]))},this),t=new g,t.functionName="Colormap",t.functionArguments={},t.functionArguments.Colormap=u,t.variableName="Raster",t},_combineRenderingRule:function(n,i){if(!n||!i)return n||i;var r=function(n){var t=n.Raster;return t&&"esri.layers.RasterFunction"===t.declaredClass?r(t.functionArguments):n},u=t.clone(n);return r(u.functionArguments).Raster=i,u},_resolve:function(n,t,i,r,u){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&y._resDfd(r,n,u)},_toggleTime:function(){var n=this._map;this.timeInfo&&this.useMapTime&&n&&!this.suspended?(this._timeConnect||(this._timeConnect=e.connect(n,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(n.timeExtent)):(e.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(n,t){this.useMapTime=n;this._toggleTime();!t&&this._map&&this.refresh(!0)},_setTime:function(n){this._params&&(this._params.time=n?n.toJson().join(","):null)},_onTimeExtentChangeHandler:function(n){this.suspended||(this._setTime(n),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}}),o("extend-esri")&&t.setObject("layers.ImageServiceLayerMixin",n,c),n})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(n,t,i){return n.DeferredList=function(n,r,u,f){var s=[],e,o;t.call(this);e=this;0!==n.length||r||this.resolve([0,[]]);o=0;i.forEach(n,function(t,i){function h(t,r){s[i]=[t,r];o++;o===n.length&&e.resolve(s)}t.then(function(n){r?e.resolve([i,n]):h(!0,n)},function(n){if(u?e.reject(n):h(!1,n),f)return null;throw n;})})},n.DeferredList.prototype=new t,n.DeferredList.prototype.gatherResults=function(t){return t=new n.DeferredList(t,!1,!0,!1),t.addCallback(function(n){var t=[];return i.forEach(n,function(n){t.push(n[1])}),t}),t},n.DeferredList})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(n,t,i,r,u,f){var e=n(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(n){t.isObject(n)&&(t.mixin(this,n),n.mosaicMethod&&(this.method=n.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),n.mosaicOperation&&(this.operation=n.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),n.fids&&(this.objectIds=n.fids),n.viewpoint&&(this.viewpoint=new f(n.viewpoint)),this.multidimensionalDefinition=n.multidimensionalDefinition||[])},toJson:function(){var t=null,i=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0,n;if(i)for(t=[],n=0;n<i;n++)t.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[n].declaredClass?this.multidimensionalDefinition[n].toJson():this.multidimensionalDefinition[n]);return t={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:t},u.filter(t,function(n){if(null!==n)return!0})},_getMethodEnum:function(n){if(n){var t=e.METHOD_NONE;switch(n.toLowerCase()){case"byattribute":t=e.METHOD_ATTRIBUTE;break;case"center":t=e.METHOD_CENTER;break;case"lockraster":t=e.METHOD_LOCKRASTER;break;case"nadir":t=e.METHOD_NADIR;break;case"northwest":t=e.METHOD_NORTHWEST;break;case"seamline":t=e.METHOD_SEAMLINE;break;case"viewpoint":t=e.METHOD_VIEWPOINT}return t}},_getOperatorEnum:function(n){if(n)switch(n.toLowerCase()){case"first":return e.OPERATION_FIRST;case"last":return e.OPERATION_LAST;case"max":return e.OPERATION_MAX;case"min":return e.OPERATION_MIN;case"blend":return e.OPERATION_BLEND;case"mean":return e.OPERATION_MEAN;case"sum":return e.OPERATION_SUM}}});return t.mixin(e,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"}),i("extend-esri")&&t.setObject("layers.MosaicRule",e,r),e})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(n){t.isObject(n)&&t.mixin(this,n)},toJson:function(){return u.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(n){return null!==n})}}),i("extend-esri")&&t.setObject("layers.DimensionalDefinition",n,r),n})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var tt,it,nt,ft,rt,d;t=t(h,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(n){this.imageServiceUrl=n;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(n,t,f){var h=this,s=new r(v._dfdCanceller),e,l,a,y;if(10>o("ie"))throw"This browser is not supported.";if(!n.imageServiceParameters)throw"Insufficient parameters to read data";e=i.clone(n.imageServiceParameters);l=n.pixelType;u.some(this.validPixelTypes,function(n){return n===l})||(e.pixelType="F32");u.some(this.validFormats,function(n){return n.toLowerCase()===e.format.toLowerCase()})||(e.format="lerc");a=n.decodeFunc;this._prepareGetImageParameters(e);var p=e.width,w=e.height,b=e.extent;return delete e.width,delete e.height,delete e.extent,s._pendingDfd=c({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:i.mixin(e,{f:"image"}),load:function(n){h.decode(n,{width:p,height:w,planes:null,pixelType:l,noDataValue:e.noData,format:e.format,decodeFunc:a}).then(function(n){y={pixelBlock:n,extent:b};h._resolve([y,e],"onRasterReadComplete",t,s)},function(n){h._resolve([n],null,f,s,!0)})},error:function(n){h._resolve([n],null,f,s,!0)}}),s.promise},decode:function(n,t){if(void 0===t||null===t)throw"missing decode options";var i,r;return t.format&&(i=t.format.toUpperCase()),"BSQ"!==i&&"BIP"!==i&&(i=this._getFormat(n)),r=t.decodeFunc,(void 0===r||null===r)&&(r=this._getFormatDecoderDfd(i)),r(n,t)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(n){var t,r;if(n.size&&n.bbox)t=n.size.split(","),n.width=parseFloat(t[0]),n.height=parseFloat(t[1]),n.extent||(t=n.bbox.split(","),n.extent=new l(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),new a(n.bboxSR)));else{if(!n.width||Math.floor(n.width)!==n.width||!n.height||Math.floor(n.height)!==n.height)throw"Incorrect Image Dimensions";if(!n.extent||"esri.geometry.Extent"!==n.extent.declaredClass)throw"Incorrect extent";t=n.extent;r=t.spatialReference.wkid||e.toJson(t.spatialReference.toJson());delete n._ts;i.mixin(n,{bbox:t.xmin+","+t.ymin+","+t.xmax+","+t.ymax,imageSR:r,bboxSR:r,size:n.width+","+n.height},n.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(n,t,i){var r=n.ymax-n.ymin,u=n.xmax-n.xmin;return i>=t?n.ymax=n.ymin+u*t/i:n.xmax=n.xmin+r*i/t,n},_resolve:function(n,t,i,r,u){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&v._resDfd(r,n,u)},_getFormatDecoderDfd:function(n){var t=null;switch(n){case"LERC":t=this._decodeLerc;break;case"LERC2":t=this._decodeLerc2;break;case"JPEG":t=this._decodeJpeg;break;case"PNG":t=this._decodePng;break;case"BSQ":t=this._decodeBsq;break;case"BIP":t=this._decodeBip;break;case"TIFF":t=this._decodeTiff;break;default:t=function(){throw"The raster format is not supported";}}return t=i.hitch(this,t),function(i,u){var f=new r,e;try{"LERC"===n||!0===rt?(e=t(i,u),f.resolve(e)):d.then(function(){e=t(i,u);f.resolve(e)})}catch(o){f.reject(o)}return f}},_getFormat:function(n){n=new Uint8Array(n,0,10);var t="";return 255===n[0]&&216===n[1]?t="JPEG":137===n[0]&&80===n[1]&&78===n[2]&&71===n[3]?t="PNG":67===n[0]&&110===n[1]&&116===n[2]&&90===n[3]&&73===n[4]&&109===n[5]&&97===n[6]&&103===n[7]&&101===n[8]&&32===n[9]?t="LERC":76===n[0]&&101===n[1]&&114===n[2]&&99===n[3]&&50===n[4]&&32===n[5]?t="LERC2":-1<String.fromCharCode.apply(null,n).toLowerCase().indexOf("error")?t="ERROR":(73===n[0]&&73===n[1]&&42===n[2]&&0===n[3]||77===n[0]&&77===n[1]&&0===n[2]&&42===n[3])&&(t="TIFF"),t},_validateDecodeParams:function(n){if(!n.height||Math.floor(n.height)!==n.height)throw"Height not provided.";if(!n.width||Math.floor(n.width)!==n.width)throw"Width not provided.";},_decodeJpeg:function(n,t){var i,u,r,f;if(!tt)throw"The jpeg decoder module is not loaded.";if(this._validateDecodeParams(t),i=(new tt).decode(n),!ut(i,t))throw"The decoded image dimensions are incorrect.";for(u=[],r=0;r<i.pixels.length;r++)f=i.pixels[r],u.push(this._calculateBandStatistics(f));return new y({width:i.width,height:i.height,pixels:i.pixels,pixelType:"U8",mask:i.mask,statistics:u})},_decodePng:function(n,t){var e,i;if(!it)throw"The png decoder module is not loaded.";this._validateDecodeParams(t);var u=new Uint8Array(n),i=new it(u),u=new Uint8Array(t.width*t.height*4);i.copyToImageData(u,i.decodePixels());for(var r=i=0,f,r=new Uint8Array(t.width*t.height),i=0;i<t.width*t.height;i++)r[i]=u[4*i+3];for(e=new y({width:t.width,height:t.height,pixels:[],pixelType:"U8",mask:r,statistics:[]}),i=0;3>i;i++){for(f=new Uint8Array(t.width*t.height),r=0;r<t.width*t.height;r++)f[r]=u[4*r+i];e.addData({pixels:f,statistics:this._calculateBandStatistics(f)})}return e},_decodeBsq:function(n,t){if(!nt)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(t);b=t.noDataValue;t.pixelType=g(t.pixelType);for(var i=nt.decodeBSQ(n,{bandCount:t.planes,width:t.width,height:t.height,pixelType:k,noDataValue:b}),u=[],f=null,r=0;r<i.pixels.length;r++)f=i.pixels[r],u.push(this._calculateBandStatistics(f));return new y({width:t.width,height:t.height,pixels:i.pixels,pixelType:t.pixelType,mask:i.maskData,statistics:u})},_decodeBip:function(n,t){this._validateDecodeParams(t);b=t.noDataValue;t.pixelType=g(t.pixelType);for(var i=nt.decodeBIP(n,{bandCount:t.planes,width:t.width,height:t.height,pixelType:k,noDataValue:b}),u=[],f=null,r=0;r<i.pixels.length;r++)f=i.pixels[r],u.push(this._calculateBandStatistics(f));return new y({width:t.width,height:t.height,pixels:i.pixels,pixelType:t.pixelType,mask:i.maskData,statistics:u})},_decodeTiff:function(n,t){this._validateDecodeParams(t);b=t.noDataValue;t.pixelType=g(t.pixelType);for(var i=ft.decode(n),u=[],f=null,r=0;r<i.pixels.length;r++)f=i.pixels[r],u.push(this._calculateBandStatistics(f,i.maskData));return new y({width:i.width,height:i.height,pixels:i.pixels,pixelType:i.pixelType,mask:i.maskData,statistics:u})},_decodeLerc:function(n,t){var i,u;this._validateDecodeParams(t);b=t.noDataValue;t.pixelType=g(t.pixelType);for(var r=0,e,u=0,f,o=n.byteLength-10;u<o;){if(i=p.decode(n,{inputOffset:u,encodedMaskData:e,returnMask:0===r?!0:!1,returnEncodedMask:0===r?!0:!1,returnFileInfo:!0,pixelType:k,noDataValue:b}),u=i.fileInfo.eofOffset,0===r&&(e=i.encodedMaskData,f=new y({width:t.width,height:t.height,pixels:[],pixelType:t.pixelType,mask:i.maskData,statistics:[]})),r++,!ut(i,t))throw"The decoded image dimensions are incorrect";f.addData({pixels:i.pixelData,statistics:{minValue:i.minValue,maxValue:i.maxValue,noDataValue:i.noDataValue}})}return f},_decodeLerc2:function(n,t){this._validateDecodeParams(t);b=t.noDataValue;t.pixelType=g(t.pixelType);for(var f=0,e,i,r=0,u,o=n.byteLength-10;r<o;){if(i=w.decode(n,{inputOffset:r,maskData:e,returnFileInfo:!0}),r=i.fileInfo.eofOffset,0===f&&(e=i.maskData,u=new y({width:t.width,height:t.height,pixels:[],pixelType:i.fileInfo.pixelType,mask:i.maskData,statistics:[]})),f++,!ut(i,t))throw"The decoded image dimensions are incorrect";u.addData({pixels:i.pixelData,statistics:{minValue:i.minValue,maxValue:i.maxValue,noDataValue:i.noDataValue}})}return u},_calculateBandStatistics:function(n,t){var u=Infinity,f=-Infinity,e=n.length,r,i=0;if(t)for(r=0;r<e;r++)t[r]&&(i=n[r],u=i<u?i:u,f=i>f?i:f);else for(r=0;r<e;r++)i=n[r],u=i<u?i:u,f=i>f?i:f;return{minValue:u,maxValue:f}},_loadRasterFormatModules:function(){rt||(d||(d=new r),10>o("ie")?d.isRejected()||d.reject("unsupported browser version"):n(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(n,t,i,r){tt=n;it=t;nt=i;ft=r;rt=!0;d.isResolved()||d.resolve(!0)}))}});var k=null,b=null,g=function(n){return"U1"===n||"U2"===n||"U4"===n||"U8"===n?(b=Math.pow(2,8)-1,k=Uint8Array,"U8"):("U16"===n?(b=b||Math.pow(2,16)-1,k=Uint16Array):"U32"===n?(b=b||Math.pow(2,32)-1,k=Uint32Array):"S8"===n?(b=b||0-Math.pow(2,7),k=Int8Array):"S16"===n?(b=b||0-Math.pow(2,15),k=Int16Array):"S32"===n?(b=b||0-Math.pow(2,31),k=Int32Array):k=Float32Array,n)},ut=function(n,t){return n.height!==t.height||n.width!==t.width?!1:!0};return o("extend-esri")&&i.setObject("layers.Raster",t,s),t})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(n){if(n){if(!n.width||Math.floor(n.width)!==n.width)throw"PixelBlock: incorrect width";if(!n.height||Math.floor(n.height)!==n.height)throw"PixelBlock: incorrect height";if(!n.pixels||!n.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=n.width;this.height=n.height;this.pixels=n.pixels;this.pixelType=n.pixelType||null;this.statistics=n.statistics;this.mask=n.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(n){if(!n.pixels||!n.statistics)throw"Pixel data or statistics are not present";if(n.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(n.statistics);this.pixels.push(n.pixels)},getAsRGBA:function(){var n=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"S8":case"S16":case"U16":case"S32":case"U32":case"F32":case"F64":this._fillFromNon8Bit(n);break;default:this._fillFrom8Bit(n)}return new Uint8ClampedArray(n)},getAsRGBAFloat:function(){var n=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(n),n},clone:function(){var i=new this.constructor,n,r;if(i.width=this.width,i.height=this.height,i.pixelType=this.pixelType,this.mask&&(i.mask=new Uint8Array(this.mask)),this.pixels)for(i.pixels=[],r=this.pixels.length,n=0;n<r;n++)i.pixels[n]=new Float32Array(this.pixels[n]);if(this.statistics)for(i.statistics=[],r=this.statistics.length,n=0;n<r;n++)i.statistics[n]=t.clone(this.statistics[n]);return i},_fillFrom8Bit:function(n){var t=this.pixels,e=this.mask,r,u,f,i;if(!n||!t||!t.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");if(r=u=f=t[0],3<=t.length&&(u=t[1],f=t[2]),t=new Uint32Array(n),i=this.width*this.height,r.length!==i)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(e&&e.length===i)for(n=0;n<i;n++)e[n]&&(t[n]=-16777216|f[n]<<16|u[n]<<8|r[n]);else for(n=0;n<i;n++)t[n]=-16777216|f[n]<<16|u[n]<<8|r[n]},_fillFromNon8Bit:function(n){var t=this.pixels,e=this.mask,u=this.statistics,i,r,o,f,s;if(!n||!t||!t.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");if(i=1,r=0,u&&0<u.length?(r=u[0].minValue,i=255/(u[0].maxValue-u[0].minValue)):(i=255,"S8"===this.pixelType?(r=-128,i=127):"U16"===this.pixelType?i=65535:"S16"===this.pixelType?(r=-32768,i=32767):"U32"===this.pixelType?i=4294967295:"S32"===this.pixelType?(r=-2147483648,i=2147483647):"F32"===this.pixelType?(r=-3.4*1e39,i=3.4*1e39):"F64"===this.pixelType&&(r=-Number.MAX_VALUE,i=Number.MAX_VALUE),i=255/(i-r)),n=new Uint32Array(n),u=this.width*this.height,o=t[0],o.length!==u)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=t.length)if(f=t[1],s=t[2],e&&e.length===u)for(t=0;t<u;t++)e[t]&&(n[t]=-16777216|(s[t]-r)*i<<16|(f[t]-r)*i<<8|(o[t]-r)*i);else for(t=0;t<u;t++)n[t]=-16777216|(s[t]-r)*i<<16|(f[t]-r)*i<<8|(o[t]-r)*i;else if(e&&e.length===u)for(t=0;t<u;t++)f=(o[t]-r)*i,e[t]&&(n[t]=-16777216|f<<16|f<<8|f);else for(t=0;t<u;t++)f=(o[t]-r)*i,n[t]=-16777216|f<<16|f<<8|f},_fillFrom32Bit:function(n){var t=this.pixels,o=this.mask,u,f,e,r,i;if(!n||!t||!t.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");if(u=f=e=t[0],3<=t.length&&(f=t[1],e=t[2]),r=this.width*this.height,u.length!==r)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(i=0,o&&o.length===r)for(t=0;t<r;t++)n[i++]=u[t],n[i++]=f[t],n[i++]=e[t],n[i++]=o[t];else for(t=0;t<r;t++)n[i++]=u[t],n[i++]=f[t],n[i++]=e[t],n[i++]=255}}),i("extend-esri")&&t.setObject("layers.PixelBlock",n,r),n})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var n={defaultNoDataValue:-34027999387901484e22,decode:function(i,r){var nt,rt,l,e,lt,b,k,et,ot,st,ft,ut;r=r||{};var o=r.inputOffset||0,c=r.encodedMaskData||null===r.encodedMaskData,u={},f=new Uint8Array(i,o,10);if(u.fileIdentifierString=String.fromCharCode.apply(null,f),"CntZImage"!=u.fileIdentifierString.trim())throw"Unexpected file identifier string: "+u.fileIdentifierString;if(o+=10,f=new DataView(i,o,24),u.fileVersion=f.getInt32(0,!0),u.imageType=f.getInt32(4,!0),u.height=f.getUint32(8,!0),u.width=f.getUint32(12,!0),u.maxZError=f.getFloat64(16,!0),o+=24,!c)if(f=new DataView(i,o,16),u.mask={},u.mask.numBlocksY=f.getUint32(0,!0),u.mask.numBlocksX=f.getUint32(4,!0),u.mask.numBytes=f.getUint32(8,!0),u.mask.maxValue=f.getFloat32(12,!0),o+=16,0<u.mask.numBytes){var c=new Uint8Array(Math.ceil(u.width*u.height/8)),f=new DataView(i,o,u.mask.numBytes),l=f.getInt16(0,!0),it=2,tt=0;do{if(0<l)for(;l--;)c[tt++]=f.getUint8(it++);else for(rt=f.getUint8(it++),l=-l;l--;)c[tt++]=rt;l=f.getInt16(it,!0);it+=2}while(it<u.mask.numBytes);if(-32768!==l||tt<c.length)throw"Unexpected end of mask RLE encoding";u.mask.bitset=c;o+=u.mask.numBytes}else 0==(u.mask.numBytes|u.mask.numBlocksY|u.mask.maxValue)&&(c=new Uint8Array(Math.ceil(u.width*u.height/8)),u.mask.bitset=c);for(f=new DataView(i,o,16),u.pixels={},u.pixels.numBlocksY=f.getUint32(0,!0),u.pixels.numBlocksX=f.getUint32(4,!0),u.pixels.numBytes=f.getUint32(8,!0),u.pixels.maxValue=f.getFloat32(12,!0),o+=16,c=u.pixels.numBlocksX,f=u.pixels.numBlocksY,c+=0<u.width%c?1:0,l=f+(0<u.height%f?1:0),u.pixels.blocks=Array(c*l),tt=it=0;tt<l;tt++)for(rt=0;rt<c;rt++){var h=0,f=new DataView(i,o,Math.min(10,i.byteLength-o)),s={};if(u.pixels.blocks[it++]=s,e=f.getUint8(0),h++,s.encoding=e&63,3<s.encoding)throw"Invalid block encoding ("+s.encoding+")";if(2===s.encoding)o++;else{if(0!==e&&2!==e){if(e>>=6,s.offsetType=e,2===e)s.offset=f.getInt8(1),h++;else if(1===e)s.offset=f.getInt16(1,!0),h+=2;else if(0===e)s.offset=f.getFloat32(1,!0),h+=4;else throw"Invalid block offset type";if(1===s.encoding)if(e=f.getUint8(h),h++,s.bitsPerPixel=e&63,e>>=6,s.numValidPixelsType=e,2===e)s.numValidPixels=f.getUint8(h),h++;else if(1===e)s.numValidPixels=f.getUint16(h,!0),h+=2;else if(0===e)s.numValidPixels=f.getUint32(h,!0),h+=4;else throw"Invalid valid pixel count type";}if(o+=h,3!=s.encoding)if(0===s.encoding){if(e=(u.pixels.numBytes-1)/4,e!==Math.floor(e))throw"uncompressed block has invalid length";f=new ArrayBuffer(4*e);h=new Uint8Array(f);h.set(new Uint8Array(i,o,4*e));f=new Float32Array(f);s.rawData=f;o+=4*e}else 1===s.encoding&&(e=Math.ceil(s.numValidPixels*s.bitsPerPixel/8),f=new ArrayBuffer(4*Math.ceil(e/4)),h=new Uint8Array(f),h.set(new Uint8Array(i,o,e)),s.stuffedData=new Uint32Array(f),o+=e)}}u.eofOffset=o;var o=null!=r.noDataValue?r.noDataValue:n.defaultNoDataValue,l=r.encodedMaskData,lt=r.returnMask,it=0,tt=u.pixels.numBlocksX,rt=u.pixels.numBlocksY,s=Math.floor(u.width/tt),h=Math.floor(u.height/rt),e=2*u.maxZError,f=Number.MAX_VALUE,d,l=l||(u.mask?u.mask.bitset:null),w,c=new(r.pixelType||Float32Array)(u.width*u.height);for(lt&&l&&(w=new Uint8Array(u.width*u.height)),lt=new Float32Array(s*h),et=0;et<=rt;et++)if(ot=et!==rt?h:u.height%rt,0!==ot)for(st=0;st<=tt;st++)if(ft=st!==tt?s:u.width%tt,0!==ft){var y=et*u.width*h+st*s,vt=u.width-ft,p=u.pixels.blocks[it],a,v;if(2>p.encoding){if(0===p.encoding)a=p.rawData;else{a=p.stuffedData;v=p.bitsPerPixel;d=p.numValidPixels;b=p.offset;k=e;var bt=lt,pt=u.pixels.maxValue,yt=(1<<v)-1,wt=0,at=void 0,g=0,ht=void 0,ct=void 0,kt=Math.ceil((pt-b)/k);for(a[a.length-1]<<=8*(4*a.length-Math.ceil(v*d/8)),at=0;at<d;at++)0===g&&(ct=a[wt++],g=32),g>=v?(ht=ct>>>g-v&yt,g-=v):(g=v-g,ht=(ct&yt)<<g&yt,ct=a[wt++],g=32-g,ht+=ct>>>g),bt[at]=ht<kt?b+ht*k:pt;a=lt}v=0}else nt=2===p.encoding?0:p.offset;if(l)for(k=0;k<ot;k++){for(y&7&&(ut=l[y>>3],ut<<=y&7),b=0;b<ft;b++)y&7||(ut=l[y>>3]),ut&128?(w&&(w[y]=1),d=2>p.encoding?a[v++]:nt,f=f>d?d:f,c[y++]=d):(w&&(w[y]=0),c[y++]=o),ut<<=1;y+=vt}else if(2>p.encoding)for(k=0;k<ot;k++){for(b=0;b<ft;b++)d=a[v++],f=f>d?d:f,c[y++]=d;y+=vt}else for(f=f>nt?nt:f,k=0;k<ot;k++){for(b=0;b<ft;b++)c[y++]=nt;y+=vt}if(1===p.encoding&&v!==p.numValidPixels)throw"Block and Mask do not match";it++}if(nt=w,w={width:u.width,height:u.height,pixelData:c,minValue:f,maxValue:u.pixels.maxValue,noDataValue:o},nt&&(w.maskData=nt),r.returnEncodedMask&&u.mask&&(w.encodedMaskData=u.mask.bitset?u.mask.bitset:null),r.returnFileInfo&&(w.fileInfo=t(u),r.computeUsedBitDepths)){for(nt=w.fileInfo,ut=u.pixels.numBlocksX*u.pixels.numBlocksY,a={},v=0;v<ut;v++)o=u.pixels.blocks[v],0===o.encoding?a.float32=!0:1===o.encoding?a[o.bitsPerPixel]=!0:a[0]=!0;u=Object.keys(a);nt.bitDepths=u}return w}},t=function(n){return{fileIdentifierString:n.fileIdentifierString,fileVersion:n.fileVersion,imageType:n.imageType,height:n.height,width:n.width,maxZError:n.maxZError,eofOffset:n.eofOffset,mask:n.mask?{numBlocksX:n.mask.numBlocksX,numBlocksY:n.mask.numBlocksY,numBytes:n.mask.numBytes,maxValue:n.mask.maxValue}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,numBytes:n.pixels.numBytes,maxValue:n.pixels.maxValue,noDataValue:this.noDataValue}}};return n})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var t={unstuff:function(n,t,i,r,u,f,e,o){var a=(1<<i)-1,v=0,l,s=0,c,h;if(n[n.length-1]<<=8*(4*n.length-Math.ceil(i*r/8)),u)for(l=0;l<r;l++)0===s&&(h=n[v++],s=32),s>=i?(c=h>>>s-i&a,s-=i):(s=i-s,c=(h&a)<<s&a,h=n[v++],s=32-s,c+=h>>>s),t[l]=u[c];else for(u=Math.ceil((o-f)/e),l=0;l<r;l++)0===s&&(h=n[v++],s=32),s>=i?(c=h>>>s-i&a,s-=i):(s=i-s,c=(h&a)<<s&a,h=n[v++],s=32-s,c+=h>>>s),t[l]=c<u?f+c*e:o},unstuffLUT:function(n,t,i,r,u,f){var c=(1<<t)-1,a=0,h=0,e=0,o=e=0,s,l=[],v;for(n[n.length-1]<<=8*(4*n.length-Math.ceil(t*i/8)),v=Math.ceil((f-r)/u),h=0;h<i;h++)0===e&&(s=n[a++],e=32),e>=t?(o=s>>>e-t&c,e-=t):(e=t-e,o=(s&c)<<e&c,s=n[a++],e=32-e,o+=s>>>e),l[h]=o<v?r+o*u:f;return l.unshift(r),l},unstuff2:function(n,t,i,r,u,f,e,o){var y=(1<<i)-1,p=0,v,s=0,h=0,a,c,l;if(u)for(v=0;v<r;v++)0===s&&(c=n[p++],s=32,h=0),s>=i?(a=c>>>h&y,s-=i,h+=i):(l=i-s,a=c>>>h&y,c=n[p++],s=32-l,a|=(c&(1<<l)-1)<<i-l,h=l),t[v]=u[a];else for(u=Math.ceil((o-f)/e),v=0;v<r;v++)0===s&&(c=n[p++],s=32,h=0),s>=i?(a=c>>>h&y,s-=i,h+=i):(l=i-s,a=c>>>h&y,c=n[p++],s=32-l,a|=(c&(1<<l)-1)<<i-l,h=l),t[v]=a<u?f+a*e:o;return t},unstuffLUT2:function(n,t,i,r,u,f){for(var v=(1<<t)-1,y=0,l=0,o=0,e=0,s=0,h=0,c,a=[],p=Math.ceil((f-r)/u),l=0;l<i;l++)0===e&&(c=n[y++],e=32,h=0),e>=t?(s=c>>>h&v,e-=t,h+=t):(o=t-e,s=c>>>h&v,c=n[y++],e=32-o,s|=(c&(1<<o)-1)<<t-o,h=o),a[l]=s<p?r+s*u:f;return a.unshift(r),a},originalUnstuff:function(n,t,i,r){var s=(1<<i)-1,h=0,e,u=0,o,f;for(n[n.length-1]<<=8*(4*n.length-Math.ceil(i*r/8)),e=0;e<r;e++)0===u&&(f=n[h++],u=32),u>=i?(o=f>>>u-i&s,u-=i):(u=i-u,o=(f&s)<<u&s,f=n[h++],u=32-u,o+=f>>>u),t[e]=o;return t},originalUnstuff2:function(n,t,i,r){for(var c=(1<<i)-1,l=0,u=0,f=0,h,e,o,s=0;s<r;s++)0===u&&(e=n[l++],u=32,f=0),u>=i?(h=e>>>f&c,u-=i,f+=i):(o=i-u,h=e>>>f&c,e=n[l++],u=32-o,h|=(e&(1<<o)-1)<<i-o,f=o),t[s]=h;return t}},n={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(n){for(var f,t=65535,i=65535,e=n.length,r=Math.floor(e/2),u=0;r;){f=359<=r?359:r;r=r-f;do t+=n[u++]<<8,i+=t+=n[u++];while(--f);t=(t&65535)+(t>>>16);i=(i&65535)+(i>>>16)}return e&1&&(i+=t+=n[u]<<8),((i&65535)+(i>>>16)<<16|(t&65535)+(t>>>16))>>>0},readHeaderInfo:function(n,t){var u=t.ptr,r=new Uint8Array(n,u,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,r),0!==i.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;if(u+=6,r=new DataView(n,u,52),i.fileVersion=r.getInt32(0,!0),u+=4,3<=i.fileVersion&&(i.checksum=r.getUint32(4,!0),u+=4),r=new DataView(n,u,48),i.height=r.getUint32(0,!0),i.width=r.getUint32(4,!0),i.numValidPixel=r.getUint32(8,!0),i.microBlockSize=r.getInt32(12,!0),i.blobSize=r.getInt32(16,!0),i.imageType=r.getInt32(20,!0),i.maxZError=r.getFloat64(24,!0),i.zMin=r.getFloat64(32,!0),i.zMax=r.getFloat64(40,!0),u+=48,t.headerInfo=i,t.ptr=u,3<=i.fileVersion&&(u=this.computeChecksumFletcher32(new Uint8Array(n,u-48,i.blobSize-14)),u!==i.checksum))throw"Checksum failed.";return!0},readMask:function(n,t){var o=t.ptr,r=t.headerInfo,s=r.width*r.height,f=r.numValidPixel,e=new DataView(n,o,4),r={};if(r.numBytes=e.getUint32(0,!0),o+=4,(0===f||s===f)&&0!==r.numBytes)throw"invalid mask";if(0===f)f=new Uint8Array(Math.ceil(s/8)),r.bitset=f,e=new Uint8Array(s),t.pixels.resultMask=e,o+=r.numBytes;else if(0<r.numBytes){var f=new Uint8Array(Math.ceil(s/8)),e=new DataView(n,o,r.numBytes),u=e.getInt16(0,!0),i=2,h=0,c=0;do{if(0<u)for(;u--;)f[h++]=e.getUint8(i++);else for(c=e.getUint8(i++),u=-u;u--;)f[h++]=c;u=e.getInt16(i,!0);i+=2}while(i<r.numBytes);if(-32768!==u||h<f.length)throw"Unexpected end of mask RLE encoding";for(e=new Uint8Array(s),i=i=u=0;i<s;i++)i&7?(u=f[i>>3],u<<=i&7):u=f[i>>3],u&128&&(e[i]=1);t.pixels.resultMask=e;r.bitset=f;o+=r.numBytes}return t.ptr=o,t.mask=r,!0},readDataOneSweep:function(t,i,r){var e=i.ptr,f=i.headerInfo,o=f.width*f.height,f=f.numValidPixel*n.getDateTypeSize(f.imageType),u;if(r===Uint8Array?t=new Uint8Array(t,e,f):(u=new ArrayBuffer(f),new Uint8Array(u).set(new Uint8Array(t,e,f)),t=new r(u)),t.length===o)i.pixels.resultPixels=t;else for(i.pixels.resultPixels=new r(o),u=u=r=0;u<o;u++)i.pixels.resultMask[u]&&(i.pixels.resultPixels[u]=t[r++]);return i.ptr=e+f,!0},readHuffman:function(t,r,u){var e=r.headerInfo,l=e.width*e.height,b=this.HUFFMAN_LUT_BITS_MAX,e=new DataView(t,r.ptr,16),c,a,f,p,v,s,k,g,o;if(r.ptr+=16,2>e.getInt32(0,!0))throw"unsupported Huffman version";var k=e.getInt32(4,!0),h=e.getInt32(8,!0),w=e.getInt32(12,!0);if(h>=w)return!1;for(f=new Uint32Array(w-h),n.decodeBits(t,r,f),o=[],e=h;e<w;e++)c=e-(e<k?0:k),o[c]={first:f[e-h],second:null};for(e=t.byteLength-r.ptr,f=new ArrayBuffer(4*Math.ceil(e/4)),new Uint8Array(f).set(new Uint8Array(t,r.ptr,e)),t=new Uint32Array(f),f=0,v=0,p=t[0],e=h;e<w;e++)c=e-(e<k?0:k),a=o[c].first,0<a&&(o[c].second=p<<f>>>32-a,32-f>=a?(f+=a,32===f&&(f=0,v++,p=t[v])):(f+=a-32,v++,p=t[v],o[c].second|=p>>>32-f));for(var rt=0===r.headerInfo.imageType?128:0,tt=r.headerInfo.height,nt=r.headerInfo.width,y=0,d=0,it=new i,e=0;e<o.length;e++)void 0!==o[e]&&(y=Math.max(y,o[e].first));for(d=y>=b?b:y,30<=y&&console.log("WARning, large NUM LUT BITS IS "+y),b=[],e=h;e<w;e++)if(c=e-(e<k?0:k),a=o[c].first,0<a)if(p=[a,c],a<=d)for(c=o[c].second<<d-a,s=1<<d-a,h=0;h<s;h++)b[c|h]=p;else for(c=o[c].second,s=it,h=a-1;0<=h;h--)(a=c>>>h&1)?(s.right||(s.right=new i),s=s.right):(s.left||(s.left=new i),s=s.left),0!==h||s.val||(s.val=p[1]);if(k=r.pixels.resultMask,o=w=0,0<f&&(v++,f=0),p=t[v],u=new u(l),r.headerInfo.numValidPixel===nt*tt)for(e=h=0;e<tt;e++)for(c=0;c<nt;c++,h++){if(l=0,o=g=p<<f>>>32-d,32-f<d&&(o=g|=t[v+1]>>>64-f-d),b[o])l=b[o][1],f+=b[o][0];else for(o=g=p<<f>>>32-y,32-f<y&&(o=g|=t[v+1]>>>64-f-y),s=it,o=0;o<y;o++)if(s=(a=g>>>y-o-1&1)?s.right:s.left,!s.left&&!s.right){l=s.val;f=f+o+1;break}32<=f&&(f-=32,v++,p=t[v]);l-=rt;l=0<c?l+w:0<e?l+u[h-nt]:l+w;l&=255;w=u[h]=l}else for(e=h=0;e<tt;e++)for(c=0;c<nt;c++,h++)if(k[h]){if(l=0,o=g=p<<f>>>32-d,32-f<d&&(o=g|=t[v+1]>>>64-f-d),b[o])l=b[o][1],f+=b[o][0];else for(o=g=p<<f>>>32-y,32-f<y&&(o=g|=t[v+1]>>>64-f-y),s=it,o=0;o<y;o++)if(s=(a=g>>>y-o-1&1)?s.right:s.left,!s.left&&!s.right){l=s.val;f=f+o+1;break}32<=f&&(f-=32,v++,p=t[v]);l-=rt;l=0<c&&k[h-1]?l+w:0<e&&k[h-nt]?l+u[h-nt]:l+w;l&=255;w=u[h]=l}r.pixels.resultPixels=u;r.ptr=r.ptr+4*(v+1)+(0<f?4:0)},decodeBits:function(n,i,r,u){var y=i.headerInfo.fileVersion,o=0,f=new DataView(n,i.ptr,5),s=f.getUint8(0),c,e,a,v;o++;var l=s>>6,c=0===l?4:3-l,h=0<(s&32)?!0:!1,l=s&31,s=0;if(1===c)s=f.getUint8(o),o++;else if(2===c)s=f.getUint16(o,!0),o+=2;else if(4===c)s=f.getUint32(o,!0),o+=4;else throw"Invalid valid pixel count type";if(c=2*i.headerInfo.maxZError,h){for(i.counter.lut++,v=f.getUint8(o),o++,h=Math.ceil((v-1)*l/8),e=Math.ceil(h/4),e=new ArrayBuffer(4*e),a=new Uint8Array(e),i.ptr+=o,a.set(new Uint8Array(n,i.ptr,h)),o=new Uint32Array(e),i.ptr+=h,f=0;v-1>>>f;)f++;h=Math.ceil(s*f/8);e=Math.ceil(h/4);e=new ArrayBuffer(4*e);a=new Uint8Array(e);a.set(new Uint8Array(n,i.ptr,h));n=new Uint32Array(e);i.ptr+=h;i=3<=y?t.unstuffLUT2(o,l,v-1,u,c,i.headerInfo.zMax):t.unstuffLUT(o,l,v-1,u,c,i.headerInfo.zMax);3<=y?t.unstuff2(n,r,f,s,i):t.unstuff(n,r,f,s,i)}else i.counter.bitstuffer++,f=l,i.ptr+=o,0<f&&(h=Math.ceil(s*f/8),e=Math.ceil(h/4),e=new ArrayBuffer(4*e),a=new Uint8Array(e),a.set(new Uint8Array(n,i.ptr,h)),n=new Uint32Array(e),i.ptr+=h,3<=y?null==u?t.originalUnstuff2(n,r,f,s):t.unstuff2(n,r,f,s,!1,u,c,i.headerInfo.zMax):null==u?t.originalUnstuff(n,r,f,s):t.unstuff(n,r,f,s,!1,u,c,i.headerInfo.zMax))},readTiles:function(t,i,r){var v=i.headerInfo,w=v.width,k=v.height,s=v.microBlockSize,v=v.imageType,d=Math.ceil(w/s),g=Math.ceil(k/s);i.pixels.numBlocksY=g;i.pixels.numBlocksX=d;for(var u=i.pixels.ptr=0,e=0,b=0,p=0,a=0,h=0,f=0,c=0,tt=u=0,o=0,y=0,f=f=u=f=0,l,nt=new r(s*s),k=k%s||s,it=w%s||s,b=0;b<g;b++)for(a=b!==g-1?s:k,p=0;p<d;p++){if(h=p!==d-1?s:it,o=b*w*s+p*s,y=w-h,f=t.byteLength-i.ptr,e=new DataView(t,i.ptr,Math.min(10,f)),l={},f=0,c=e.getUint8(0),f++,u=c>>6&255,tt=c>>2&15,tt!==(p*s>>3&15))throw"integrity issue";if(c&=3,3<c)throw i.ptr+=f,"Invalid block encoding ("+c+")";if(2===c)i.counter.constant++,i.ptr+=f;else if(0===c){if(i.counter.uncompressed++,i.ptr+=f,f=a*h*n.getDateTypeSize(v),u=t.byteLength-i.ptr,f=f<u?f:u,u=new ArrayBuffer(f),e=new Uint8Array(u),e.set(new Uint8Array(t,i.ptr,f)),l=new r(u),f=0,i.pixels.resultMask)for(u=0;u<a;u++){for(e=0;e<h;e++)i.pixels.resultMask[o]&&(i.pixels.resultPixels[o]=l[f++]),o++;o+=y}else for(u=0;u<a;u++){for(e=0;e<h;e++)i.pixels.resultPixels[o++]=l[f++];o+=y}i.ptr+=f*n.getDateTypeSize(v)}else if(u=n.getDataTypeUsed(v,u),l=n.getOnePixel(l,f,u,e),f+=n.getDateTypeSize(u),3===c)if(i.ptr+=f,i.counter.constantoffset++,i.pixels.resultMask)for(u=0;u<a;u++){for(e=0;e<h;e++)i.pixels.resultMask[o]&&(i.pixels.resultPixels[o]=l),o++;o+=y}else for(u=0;u<a;u++){for(e=0;e<h;e++)i.pixels.resultPixels[o++]=l;o+=y}else if(i.ptr+=f,n.decodeBits(t,i,nt,l),f=0,i.pixels.resultMask)for(u=0;u<a;u++){for(e=0;e<h;e++)i.pixels.resultMask[o]&&(i.pixels.resultPixels[o]=nt[f++]),o++;o+=y}else for(u=0;u<a;u++){for(e=0;e<h;e++)i.pixels.resultPixels[o++]=nt[f++];o+=y}}},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:n.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(n){var i=n.headerInfo.zMax,r=n.headerInfo.height*n.headerInfo.width,t=0;if(n.pixels.resultMask)for(t=0;t<r;t++)n.pixels.resultMask[t]&&(n.pixels.resultPixels[t]=i);else for(t=0;t<r;t++)n.pixels.resultPixels[t]=i},getDataTypeArray:function(n){switch(n){case 0:n=Int8Array;break;case 1:n=Uint8Array;break;case 2:n=Int16Array;break;case 3:n=Uint16Array;break;case 4:n=Int32Array;break;case 5:n=Uint32Array;break;case 6:n=Float32Array;break;case 7:n=Float64Array;break;default:n=Float32Array}return n},getPixelType:function(n){switch(n){case 0:n="S8";break;case 1:n="U8";break;case 2:n="S16";break;case 3:n="U16";break;case 4:n="S32";break;case 5:n="U32";break;case 6:n="F32";break;case 7:n="F64";break;default:n="F32"}return n},isValidPixelValue:function(n,t){if(null===t||void 0===t)return!1;var i;switch(n){case 0:i=-128<=t&&127>=t;break;case 1:i=0<=t&&255>=t;break;case 2:i=-32768<=t&&32767>=t;break;case 3:i=0<=t&&65536>=t;break;case 4:i=-2147483648<=t&&2147483647>=t;break;case 5:i=0<=t&&4294967296>=t;break;case 6:i=-34027999387901484e22<=t&&34027999387901484e22>=t;break;case 7:i=494065645841247e-338<=t&&17976931348623157e292>=t;break;default:i=!1}return i},getDateTypeSize:function(n){var t=0;switch(n){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=n}return t},getDataTypeUsed:function(n,t){var i=n;switch(n){case 2:case 4:i=n-t;break;case 3:case 5:i=n-2*t;break;case 6:i=0===t?n:1===t?2:1;break;case 7:i=0===t?n:n-2*t+1;break;default:i=n}return i},getOnePixel:function(n,t,i,r){n=0;switch(i){case 0:n=r.getInt8(t);break;case 1:n=r.getUint8(t);break;case 2:n=r.getInt16(t,!0);break;case 3:n=r.getUint16(t,!0);break;case 4:n=r.getInt32(t,!0);break;case 5:n=r.getUInt32(t,!0);break;case 6:n=r.getFloat32(t,!0);break;case 7:n=r.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type";}return n}},i=function(n,t,i){this.val=n;this.left=t;this.right=i};return{decode:function(t,i){var u,f,e,h;i=i||{};var o=i.maskData||null===i.maskData,s=i.noDataValue,u=0,r={};if(r.ptr=i.inputOffset||0,r.pixels={},n.readHeaderInfo(t,r)){if(u=r.headerInfo,f=n.getDataTypeArray(u.imageType),o)r.pixels.resultMask=i.maskData,r.ptr+=4;else if(!n.readMask(t,r))return;if(o=u.width*u.height,r.pixels.resultPixels=new f(o),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==u.numValidPixel&&(u.zMax===u.zMin?n.constructConstantSurface(r):(e=new DataView(t,r.ptr,2),h=e.getUint8(0,!0),r.ptr++,h?n.readDataOneSweep(t,r,f):1<u.fileVersion&&1>=u.imageType&&1e-5>Math.abs(u.maxZError-.5)?(e=e.getUint8(1,!0),r.ptr++,e?n.readHuffman(t,r,f):n.readTiles(t,r,f)):n.readTiles(t,r,f))),r.eofOffset=r.ptr,i.inputOffset?(f=r.headerInfo.blobSize+i.inputOffset-r.ptr,1<=Math.abs(f)&&(r.eofOffset=i.inputOffset+r.headerInfo.blobSize)):(f=r.headerInfo.blobSize-r.ptr,1<=Math.abs(f)&&(r.eofOffset=r.headerInfo.blobSize)),f={width:u.width,height:u.height,pixelData:r.pixels.resultPixels,minValue:u.zMin,maxValue:u.zMax,maskData:r.pixels.resultMask},r.pixels.resultMask&&n.isValidPixelValue(u.imageType,s)){for(e=r.pixels.resultMask,u=0;u<o;u++)e[u]||(f.pixelData[u]=s);f.noDataValue=s}return r.noDataValue=s,i.returnFileInfo&&(f.fileInfo=n.formatFileInfo(r)),f}},getBandCount:function(t){for(var u=0,i=0,r={ptr:0,pixels:{}};i<t.byteLength-58;)n.readHeaderInfo(t,r),i+=r.headerInfo.blobSize,u++,r.ptr=i;return u}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(n){t.mixin(this,n);this.isDataUV=n&&n.isDataUV?n.isDataUV:!1;this.computeMagnitudeAndDirection=t.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(n,t){this.inputUnit=n;this.outputUnit=t;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var t=f.indexOf(this.speedUnits,this.inputUnit),i=f.indexOf(this.speedUnits,this.outputUnit),n;this.inputUnit&&this.outputUnit&&0<=t&&0<=i&&(n=[1,.277778,.514444,.3048,.44704,0],this.unitConversionFactor=n[t]/n[i])},computeMagnitudeAndDirection:function(n){var t;if(!u.isDefined(n))throw"Could not compute magnitude and direction. No pixel data is available.";if(t=n.pixelBlock,!u.isDefined(t)||2!==t.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var i=n.extent,p=(i.xmax-i.xmin)/t.width,w=(i.ymax-i.ymin)/t.height,k=i.xmin+p/2,i=i.ymax-w/2;t.statistics[0].minValue=0;t.statistics[0].maxValue=0;var d=180/Math.PI,b=[],o=0,s=0,e=0,g=!u.isDefined(t.mask),h,c,r,f,l,a,v,y;for(l=v=Infinity,a=y=-Infinity,o=0;o<t.height;o++)for(s=0;s<t.width;s++,e++)(b.push([k+p*s,i-w*o]),g||t.mask[e])&&(r=h=t.pixels[0][e]*this.unitConversionFactor,f=c=t.pixels[1][e],this.isDataUV&&(r=Math.sqrt(h*h+c*c),f=90-d*Math.atan2(c,h),t.pixels[0][e]=r*this.unitConversionFactor,t.pixels[1][e]=f),r>a&&(a=r),r<l&&(l=r),f>y&&(y=f),f<v&&(v=f));return t.statistics[0].maxValue=a,t.statistics[0].minValue=l,t.statistics[1].maxValue=y,t.statistics[1].minValue=v,n.locations=b,n}}),i("extend-esri")&&t.setObject("layers.pixelFilters.VectorFieldPixelFilter",n,r),n})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(n,t,i,r){var u;return t(null,{constructor:function(n){this.ctx=n.ctx;this._loadRasterFormatModule()},decode:function(n,t){var c,r,l,u,f,a,e;if(!t.width||!t.height)throw"Native decoding requires the image format, width and height";var s=new i,o,u=new Uint8Array(n),h=this._getFormat(n);if("error"===h)throw"invalid format";for("jpeg"===h&&(o=this._getMask(u,t)),c="",r=0;r<u.length;r+=65535)l=u.subarray(r,r+65535>u.length-1?u.length-1:r+65535),c+=String.fromCharCode.apply(null,l);return u="data:image/"+h+";base64,"+window.btoa(c),f=new Image,f.src=u,e=this,f.onload=function(){e.ctx.clearRect(0,0,t.width,t.height);e.ctx.drawImage(f,0,0);var n=e.ctx.getImageData(0,0,f.width,f.height);if(a=n.data,o)for(r=0;r<o.length;r++)a[4*r+3]=o[r]?255:0;e.ctx.putImageData(n,0,0);s.resolve(null)},f.onerror=function(){s.reject("cannot load image")},s},_getFormat:function(n){n=new Uint8Array(n,0,10);var t="error";return 255===n[0]&&216===n[1]?t="jpeg":137===n[0]&&80===n[1]&&78===n[2]&&71===n[3]&&(t="png"),t},_getMask:function(n,t){var e,s,i,o;try{if(!u)throw"The zlib decoder module is not loaded.";var i=0,f=0,r=Math.round(n.length/2);for(1==r%2&&(r+=1),s=n.length-2,i=r;i<s&&(255!==n[i]||217!==n[i+1]);i++);if(r=i+=2,r<n.length-1)for(o=new u(n.subarray(r)).getBytes(),e=new Uint8Array(t.width*t.height),i=r=0;i<o.length;i++)for(f=7;0<=f;f--)e[r++]=o[i]>>f&1}catch(h){}return e},_loadRasterFormatModule:function(){10>r("ie")||n(["./Zlib"],function(n){u=n})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(n,t,i,r,u,f,e,o){return n=n(e,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(){this._url.path+="/identify";this._handler=t.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(n,t,i,r,u){try{var f=new o(n);this._successHandler([f],"onComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},execute:function(n,i,r,f){var e=f.assembly,o,s;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson(e&&e[0]))),o=this._handler,s=this._errorHandler,u({url:this._url.path,content:n,callbackParamName:"callback",load:function(n,t){o(n,t,i,r,f.dfd)},error:function(n){s(n,r,f.dfd)}})},onComplete:function(){}}),f._createWrappers(n),i("extend-esri")&&t.setObject("tasks.ImageServiceIdentifyTask",n,r),n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,t,i,r,u,f,e,o){return n=n(o,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(n,i){n&&t.isString(n)&&(this._url=e.urlToObject(this.url=n));i&&i.requestOptions&&(this.requestOptions=i.requestOptions);this.normalization=!0;this._errorHandler=t.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var n=this._url,t=/^http:/i;this.url&&(this.url=this.url.replace(t,"https:"));n&&n.path&&(n.path=n.path.replace(t,"https:"))},_encode:function(n,r,u){var e,f,s={},o,h;for(o in n)if("declaredClass"!==o&&(e=n[o],f=typeof e,null!==e&&void 0!==e&&"function"!==f))if(t.isArray(e))for(s[o]=[],h=e.length,f=0;f<h;f++)s[o][f]=this._encode(e[f]);else"object"===f?e.toJson&&(f=e.toJson(u&&u[o]),"esri.tasks.FeatureSet"===e.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),s[o]=r?f:i.toJson(f)):s[o]=e;return s},_successHandler:function(n,t,i,r){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&f._resDfd(r,n)},_errorHandler:function(n,t,i){this.onError(n);t&&t(n);i&&i.errback(n)},setNormalization:function(n){this.normalization=n},onError:function(){}}),r("extend-esri")&&(u.Task=n),n})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(n){n.catalogItems&&(this.catalogItems=new f(n.catalogItems));n.location&&(this.location=u.fromJson(n.location));this.catalogItemVisibilities=n.catalogItemVisibilities;this.name=n.name;this.objectId=n.objectId;this.value=n.value;this.processedValues=n.processedValues;this.properties=n.properties}}),i("extend-esri")&&t.setObject("tasks.ImageServiceIdentifyResult",n,r),n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(n){if(n){t.mixin(this,n);var r=this.features,u=n.spatialReference,f=h.getGeometryType(n.geometryType),u=this.spatialReference=new o(u);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);i.forEach(r,function(n,t){var i=n.geometry&&n.geometry.spatialReference;r[t]=new e(f&&n.geometry?new f(n.geometry):null,n.symbol&&c.fromJson(n.symbol),n.attributes);r[t].geometry&&!i&&r[t].geometry.setSpatialReference(u)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var t={};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields),this.spatialReference?t.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJson()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=h.getJsonType(this.features[0].geometry)),t.features=s._encodeGraphics(this.features,n)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,f.fixJson(t)},_hydrate:function(){var n=this.transform,t=this.geometryType;if(n&&t)for(var i=this.features,r=n.translate[0],u=n.translate[1],f=n.scale[0],e=n.scale[1],o=function(n,t,i){return"esriGeometryPoint"===n?function(n){n.x=t(n.x);n.y=i(n.y)}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){n=n.rings||n.paths;for(var u,c,e,r,o,s,f=0,h=n.length;f<h;f++)for(e=n[f],u=0,c=e.length;u<c;u++)r=e[u],0<u?(o+=r[0],s+=r[1]):(o=r[0],s=r[1]),r[0]=t(o),r[1]=i(s)}:"esriGeometryEnvelope"===n?function(n){n.xmin=t(n.xmin);n.ymin=i(n.ymin);n.xmax=t(n.xmax);n.ymax=i(n.ymax)}:"esriGeometryMultipoint"===n?function(n){n=n.points;for(var r,f,e,u=0,o=n.length;u<o;u++)r=n[u],0<u?(f+=r[0],e+=r[1]):(f=r[0],e=r[1]),r[0]=t(f),r[1]=i(e)}:void 0}(t,function(n){return n*f+r},function(n){return u-n*e}),n=0,t=i.length;n<t;n++)i[n].geometry&&o(i[n].geometry);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;for(var f=n.translate[0],e=n.translate[1],o=n.scale[0],s=n.scale[1],i=this.features,r=function(n,t,i){for(var r,f,e,o,s=[],u=0,h=n.length;u<h;u++)(r=n[u],0<u)?(o=t(r[0]),r=i(r[1]),o!==f||r!==e)&&(s.push([o-f,r-e]),f=o,e=r):(f=t(r[0]),e=i(r[1]),s.push([f,e]));return 0<s.length?s:null},h=function(n,t,i){return"esriGeometryPoint"===n?function(n){return n.x=t(n.x),n.y=i(n.y),n}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){var f,s,o,e,u;for(o=n.rings||n.paths,u=[],f=0,s=o.length;f<s;f++)e=o[f],(e=r(e,t,i))&&u.push(e);return 0<u.length?(n.rings?n.rings=u:n.paths=u,n):null}:"esriGeometryMultipoint"===n?function(n){var u;return u=r(n.points,t,i),0<u.length?(n.points=u,n):null}:"esriGeometryEnvelope"===n?function(n){return n}:void 0}(this.geometryType,function(n){return Math.round((n-f)/o)},function(n){return Math.round((e-n)/s)}),t=0,u=i.length;t<u;t++)i[t].geometry&&(h(i[t].geometry)||i[t].setGeometry(null));return this.transform=n,this}}),r("extend-esri")&&t.setObject("tasks.FeatureSet",n,u),n})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o){return n=n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(n){var t=n&&n.geometry||this.geometry;return n={geometry:t,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?i.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?i.toJson(this.renderingRule.toJson()):null},t&&(n.geometryType=o.getJsonType(t)),t=this.timeExtent,n.time=t?t.toJson().join(","):null,e.isDefined(this.pixelSizeX)&&e.isDefined(this.pixelSizeY)?n.pixelSize=i.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(n.pixelSize=this.pixelSize?i.toJson(this.pixelSize.toJson()):null),this.renderingRules&&(n.renderingRules=i.toJson(r.map(this.renderingRules,function(n){return n.toJson()}))),n}}),u("extend-esri")&&t.setObject("tasks.ImageServiceIdentifyParameters",n,f),n})},"*noref":1}});define("esri/layers/ArcGISImageServiceLayer","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(n,t,i,r,u,f,e){return n=n([f,e],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(n,t){this._initialize(n,t);this.useMapImage=t&&t.useMapImage||!1},refresh:function(n){if(n)this.inherited(arguments);else{var t=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=t}},setRenderer:function(n,t){this.renderer=n;this.onRendererChange();t||this.refresh(!0)},exportMapImage:function(n,i){var r=u.defaults.map,r=t.mixin({size:r.width+","+r.height},this._params,n?n.toJson(this.normalization):{},{f:"json"});delete r._ts;this._exportMapImage(this._url.path+"/exportImage",r,i)}}),i("extend-esri")&&t.setObject("layers.ArcGISImageServiceLayer",n,r),n})},"esri/layers/CSVLayer":function(){require({cache:{"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore ../kernel ../config ../request ../SpatialReference ../geometry/jsonUtils ../geometry/webMercatorUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){function v(n){var i=0,r="";return t.forEach([","," ",";","|","\t"],function(t){var u=n.split(t).length;u>i&&(i=u,r=t)}),r}function y(n,t){var i,u;if(!n||"[object Date]"!==Object.prototype.toString.call(n)||isNaN(n.getTime()))return!1;if(i=!0,r("chrome")&&/\d+\W*$/.test(t)){if(t.match(/[^0-9a-zA-Z\s]/))return!1;if(u=t.match(/[a-zA-Z]{2,}/),u){for(var i=!1,f=0,e=u.length;!i&&f<=e&&!(i=!/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i.test(u[f]));)f++;i=!i}}return i}function p(i,r,e){var h=i.indexOf("\n"),h=n.trim(i.substr(0,h)),s=r.columnDelimiter,o;return s||(s=v(h)),o=new f({data:i,separator:s}),o.fetch({onComplete:function(i){var tt=0,p={layerDefinition:r.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},g=p.layerDefinition.objectIdField,a=p.layerDefinition.fields,l,c,rt,b,nt;g||t.some(a,function(n){return"esriFieldTypeOID"===n.type?(g=n.name,!0):!1})||(a.push({name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1}),g="__OBJECTID");var f,s,c=o._attributes,it=[],v=[];if(t.forEach(a,function(n){"esriFieldTypeDate"===n.type?it.push(n.name):"esriFieldTypeDouble"!==n.type&&"esriFieldTypeInteger"!==n.type||v.push(n.name)}),r.locationInfo&&"coordinates"===r.locationInfo.locationType?(f=r.locationInfo.latitudeFieldName,s=r.locationInfo.longitudeFieldName):t.forEach(c,function(n){var i;i=t.indexOf(k,n.toLowerCase());-1!==i&&(f=n);i=t.indexOf(d,n.toLowerCase());-1!==i&&(s=n)}),f&&s){for(-1===t.indexOf(v,f)&&v.push(f),-1===t.indexOf(v,s)&&v.push(s),n.isArray(r.outFields)&&-1===t.indexOf(r.outFields,"*")&&(l=r.outFields),t.forEach(c,function(n){t.some(a,function(t){return n===t.name})||a.push({name:n,alias:n,type:n===f||n===s?"esriFieldTypeDouble":"esriFieldTypeString"})}),c=0,rt=i.length,c;c<rt;c++){var w=i[c],b=o.getAttributes(w),h={};t.forEach(b,function(n){var r,i;n&&(n===f||n===s||!l||-1<t.indexOf(l,n))&&(r=n,0===n.length&&t.forEach(a,function(t,i){t.name==="attribute_"+(i-1)&&(n="attribute_"+(i-1))}),-1<t.indexOf(it,n)?(r=o.getValue(w,r),i=new Date(r),h[n]=y(i,r)?i.getTime():null):-1<t.indexOf(v,n)?(i=u.parse(o.getValue(w,r)),n!==f&&n!==s||!(isNaN(i)||181<Math.abs(i))||(i=parseFloat(o.getValue(w,r))),h[n]=isNaN(i)?null:i):h[n]=o.getValue(w,r))});h[g]=tt;tt++;b=h[f];nt=h[s];null==nt||null==b||isNaN(b)||isNaN(nt)||(l&&-1===t.indexOf(l,f)&&delete h[f],l&&-1===t.indexOf(l,s)&&delete h[s],p.featureSet.features.push({geometry:{x:nt,y:b,spatialReference:{wkid:4326}},attributes:h}))}p.layerDefinition.name="csv";e&&e(p)}else setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},1),e&&e(null,Error("File does not seem to contain fields with point coordinates."))},onError:function(n){console.error("Error fetching items from CSV store: ",n);e&&e(null,n)}}),!0}function a(i,r,u,f,e,s){0===i.length&&e(null);var a=c.getGeometryType(r),h=[];t.forEach(i,function(n){n=new a(n);n.spatialReference=u;h.push(n)},this);r=[102113,102100,3857];u.wkid&&4326===u.wkid&&f.wkid&&-1<t.indexOf(r,f.wkid)?(t.forEach(h,function(n){n.xmin?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,89.99)):n.rings?t.forEach(n.rings,function(n){t.forEach(n,function(n){n[0]=Math.min(Math.max(n[0],-180),180);n[1]=Math.min(Math.max(n[1],-89.99),89.99)},this)},this):n.paths?t.forEach(n.paths,function(n){t.forEach(n,function(n){n[0]=Math.min(Math.max(n[0],-180),180);n[1]=Math.min(Math.max(n[1],-89.99),89.99)},this)},this):n.x&&(n.x=Math.min(Math.max(n.x,-180),180),n.y=Math.min(Math.max(n.y,-89.99),89.99))},this),i=[],t.forEach(h,function(n){n=l.geographicToWebMercator(n);102100!==f.wkid&&(n.spatialReference=f);i.push(n.toJson())},this),e(i)):null!==u.wkid&&-1<t.indexOf(r,u.wkid)&&null!==f.wkid&&4326===f.wkid?(i=[],t.forEach(h,function(n){i.push(l.webMercatorToGeographic(n).toJson())},this),e(i)):(r=function(n,r){n&&n.length===i.length?(i=[],t.forEach(n,function(n){n&&(n.rings&&0<n.rings.length&&0<n.rings[0].length&&0<n.rings[0][0].length&&!isNaN(n.rings[0][0][0])&&!isNaN(n.rings[0][0][1])||n.paths&&0<n.paths.length&&0<n.paths[0].length&&0<n.paths[0][0].length&&!isNaN(n.paths[0][0][0])&&!isNaN(n.paths[0][0][1])||n.xmin&&!isNaN(n.xmin)&&n.ymin&&!isNaN(n.ymin)||n.x&&!isNaN(n.x)&&n.y&&!isNaN(n.y))?i.push(n.toJson()):i.push(null)},this),e(i)):s(n,r)},o.defaults.geometryService?o.defaults.geometryService.project(h,f,n.hitch(this,r),s):e(null))}function w(n,i){var r=[102113,102100,3857];return n&&i&&n.wkid===i.wkid&&n.wkt===i.wkt||n&&i&&n.wkid&&i.wkid&&-1<t.indexOf(r,n.wkid)&&-1<t.indexOf(r,i.wkid)?!0:!1}function b(i,r,u,f){if(i.featureSet&&0!==i.featureSet.features.length)if(w(u,r))f(i);else{var e,o=function(n){var r=[];t.forEach(i.featureSet.features,function(t,i){n[i]&&(t.geometry=n[i],r.push(t))},this);f(i)},s=function(){console.error("error projecting featureSet ("+i.layerDefinition.name+"). Final try.");f(i)},l=function(){console.error("error projecting featureSet ("+i.layerDefinition.name+"). Try one more time.");a(e,i.featureSet.geometryType,r,u,n.hitch(this,o),n.hitch(this,s))};i.featureSet.features&&0<i.featureSet.features.length?(e=[],t.forEach(i.featureSet.features,function(n){if(n.geometry.toJson)e.push(n.geometry);else{var t=c.getGeometryType(i.featureSet.geometryType);e.push(new t(n.geometry))}}),r.toJson||(r=new h(r)),u.toJson||(u=new h(u)),a(e,i.featureSet.geometryType,r,u,n.hitch(this,o),n.hitch(this,l))):f(i)}}var k="lat latitude y ycenter latitude83 latdecdeg point-y lat_dd".split(" "),d="lon lng long longitude x xcenter longitude83 longdecdeg point-x long_dd".split(" "),g={latFieldStrings:k,longFieldStrings:d,buildCSVFeatureCollection:function(t){var r=new i,f=function(n,t){t?r.errback(t):r.callback(n)},u={url:t.url,handleAs:"text",load:function(i){p(i,t,n.hitch(this,f))},error:function(n){r.errback(n);console.error("error: "+n)}};return-1<t.url.indexOf("arcgis.com")&&-1<t.url.indexOf("/content/items")&&-1<t.url.indexOf("/data")&&(u.headers={"Content-Type":""}),s(u,{usePost:!1}),r},projectFeatureCollection:function(t,r,u){var f=new i;return u||(u=new h({wkid:4326})),b(t,u,r,n.hitch(this,function(n){f.callback(n)})),f},generateDefaultPopupInfo:function(i){var u={esriFieldTypeDouble:1,esriFieldTypeSingle:1},f={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},r=null;return i=t.map(i.layerDefinition.fields,n.hitch(this,function(t){var s,o,i;return"NAME"===t.name.toUpperCase()&&(r=t.name),s="esriFieldTypeOID"!==t.type&&"esriFieldTypeGlobalID"!==t.type&&"esriFieldTypeGeometry"!==t.type,o=null,s&&(i=t.name.toLowerCase(),(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+i+",")||-1<i.indexOf("area")||-1<i.indexOf("length")||-1<i.indexOf("shape")||-1<i.indexOf("perimeter")||-1<i.indexOf("objectid")||i.indexOf("_")===i.length-1||i.indexOf("_i")===i.length-2&&1<i.length)&&(s=!1),t.type in f?o={places:0,digitSeparator:!0}:t.type in u?o={places:2,digitSeparator:!0}:t.type in e&&(o={dateFormat:"shortDateShortTime"})),n.mixin({},{fieldName:t.name,label:t.alias,isEditable:!0,tooltip:"",visible:s,format:o,stringFieldOption:"textbox"})})),{title:r?"{"+r+"}":"",fieldInfos:i,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:v,_isValidDate:y,_processCsvData:p,_projectGeometries:a,_sameSpatialReference:w,_projectFeatureSet:b};return r("extend-esri")&&n.setObject("arcgis.csv",g,e),g})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(n,t,i,r,u,f){return t=t("dojox.data.CsvStore",null,{constructor:function(n){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;n.url&&(this.url=n.url);this._csvData=n.data;n.label?this.label=n.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=n.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in n&&(this.separator=n.separator);"urlPreventCache"in n&&(this.urlPreventCache=n.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(n){if(!this.isItem(n))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(n){return n=this.getIdentity(n),this.identifier&&(n=this._idMap[n]),n},getValue:function(n,t,i){this._assertIsItem(n);var r=i;if("string"==typeof t)t=this._attributeIndexes[t],null!=t&&(r=this._dataArray[this._getIndex(n)][t]||i);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return r},getValues:function(n,t){var i=this.getValue(n,t);return i?[i]:[]},getAttributes:function(n){var i,t;for(this._assertIsItem(n),i=[],n=this._dataArray[this._getIndex(n)],t=0;t<n.length;t++)""!==n[t]&&i.push(this._attributes[t]);return i},hasAttribute:function(n,t){if(this._assertIsItem(n),"string"==typeof t){var i=this._attributeIndexes[t],r=this._dataArray[this._getIndex(n)];return"undefined"!=typeof i&&i<r.length&&""!==r[i]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(n,t,i){var r=void 0;return"string"==typeof i&&(r=u.patternToRegExp(i,!1)),this._containsValue(n,t,i,r)},_containsValue:function(n,t,i,r){for(n=this.getValues(n,t),t=0;t<n.length;++t){var u=n[t];if("string"==typeof u&&r)return null!==u.match(r);if(i===u)return!0}return!1},isItem:function(n){if(n&&n[this._storeProp]===this)if(n=n[this._idProp],this.identifier){if(this._dataArray[this._idMap[n]])return!0}else if(0<=n&&n<this._dataArray.length)return!0;return!1},isItemLoaded:function(n){return this.isItem(n)},loadItem:function(){},getFeatures:function(){return this._features},getLabel:function(n){if(this.label&&this.isItem(n))return this.getValue(n,this.label)},getLabelAttributes:function(){return this.label?[this.label]:null},_fetchItems:function(n,t,r){var f=this,e=function(n,i){var s=null,h,c;if(n.query){var r,e,s=[],o=n.queryOptions?n.queryOptions.ignoreCase:!1,l={};for(r in n.query)e=n.query[r],"string"==typeof e&&(l[r]=u.patternToRegExp(e,o));for(o=0;o<i.length;++o){h=!0;c=i[o];for(r in n.query)e=n.query[r],f._containsValue(c,r,e,l[r])||(h=!1);h&&s.push(c)}}else s=i.slice(0,i.length);t(s,n)},o,s,h;if(this._loadFinished)e(n,this._arrayOfAllItems);else if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:n,filter:e}):(this._loadInProgress=!0,o=i.get({url:f.url,handleAs:"text",preventCache:f.urlPreventCache}),o.addCallback(function(t){try{f._processData(t);e(n,f._arrayOfAllItems);f._handleQueuedFetches()}catch(i){r(i,n)}}),o.addErrback(function(t){if(f._loadInProgress=!1,r)r(t,n);else throw t;}),s=null,n.abort&&(s=n.abort),n.abort=function(){var t=o;t&&-1===t.fired&&(t.cancel(),t=null);s&&s.call(n)});else if(this._csvData)try{this._processData(this._csvData);this._csvData=null;e(n,this._arrayOfAllItems)}catch(c){r(c,n)}else if(h=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input."),r)r(h,n);else throw h;},close:function(){},_getArrayOfArraysFromCsvFileContents:function(t){var r,u;if(n.isString(t)){var c=RegExp("^\\s+","g"),l=RegExp("\\s+$","g"),a=RegExp('""',"g"),f=[],o=this._splitLines(t);for(t=0;t<o.length;++t)if(r=o[t],0<r.length){for(r=r.split(this.separator),u=0;u<r.length;){var s=r[u].replace(c,""),i=s.replace(l,""),h=i.charAt(0),e=i.charAt(i.length-1),v=i.charAt(i.length-2),y=i.charAt(i.length-3);if(2===i.length&&'""'==i)r[u]="";else if('"'==h&&('"'!=e||'"'==e&&'"'==v&&'"'!=y)){if(u+1===r.length)return;r[u]=s+this.separator+r[u+1];r.splice(u+1,1)}else'"'==h&&'"'==e&&(i=i.slice(1,i.length-1),i=i.replace(a,'"')),r[u]=i,u+=1}f.push(r)}for(this._attributes=f.shift(),t=0;t<this._attributes.length;t++)this._attributeIndexes[this._attributes[t]]=t;this._dataArray=f}},_splitLines:function(n){for(var u=[],t="",f=!1,r,i=0;i<n.length;i++){r=n.charAt(i);switch(r){case'"':f=!f;t+=r;break;case"\r":f?t+=r:(u.push(t),t="",i<n.length-1&&"\n"==n.charAt(i+1)&&i++);break;case"\n":f?t+=r:(u.push(t),t="");break;default:t+=r}}return""!==t&&u.push(t),u},_processData:function(n){if(this._getArrayOfArraysFromCsvFileContents(n),this._arrayOfAllItems=[],this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(n=0;n<this._dataArray.length;n++){var t=n;this.identifier&&(t=this._dataArray[n][this._attributeIndexes[this.identifier]],this._idMap[t]=n);this._arrayOfAllItems.push(this._createItemFromIdentity(t))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(n){var t={};return t[this._storeProp]=this,t[this._idProp]=n,t},getIdentity:function(n){return this.isItem(n)?n[this._idProp]:null},fetchItemByIdentity:function(n){var t,f=n.scope?n.scope:r.global,u;if(this._loadFinished)t=this._createItemFromIdentity(n.identity),this.isItem(t)||(t=null),n.onItem&&n.onItem.call(f,t);else if(u=this,""!==this.url)this._loadInProgress?this._queuedFetches.push({args:n}):(this._loadInProgress=!0,t=i.get({url:u.url,handleAs:"text"}),t.addCallback(function(t){try{u._processData(t);var i=u._createItemFromIdentity(n.identity);u.isItem(i)||(i=null);n.onItem&&n.onItem.call(f,i);u._handleQueuedFetches()}catch(r){n.onError&&n.onError.call(f,r)}}),t.addErrback(function(t){this._loadInProgress=!1;n.onError&&n.onError.call(f,t)}));else if(this._csvData)try{u._processData(u._csvData);u._csvData=null;t=u._createItemFromIdentity(n.identity);u.isItem(t)||(t=null);n.onItem&&n.onItem.call(f,t)}catch(e){n.onError&&n.onError.call(f,e)}},getIdentityAttributes:function(){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){var n;if(0<this._queuedFetches.length){for(n=0;n<this._queuedFetches.length;n++){var t=this._queuedFetches[n],i=t.filter,r=t.args;i?i(r,this._arrayOfAllItems):this.fetchItemByIdentity(t.args)}this._queuedFetches=[]}}}),n.extend(t,f),t})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(n){var t={};return n.setObject("dojo.data.util.filter",t),t.patternToRegExp=function(n,t){for(var i="^",u=null,r=0;r<n.length;r++)switch(u=n.charAt(r),u){case"\\":i+=u;r++;i+=n.charAt(r);break;case"*":i+=".*";break;case"?":i+=".";break;case"$":case"^":case"/":case"+":case".":case"|":case"(":case")":case"{":case"}":case"[":case"]":i+="\\";default:i+=u}return i+="$",t?new RegExp(i,"mi"):new RegExp(i,"m")},t})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(n,t,i){var r={};return n.setObject("dojo.data.util.simpleFetch",r),r.errorHandler=function(n,i){i.onError&&i.onError.call(i.scope||t.global,n,i)},r.fetchHandler=function(n,r){var s=r.abort||null,e=!1,o=r.start?r.start:0,h=r.count&&Infinity!==r.count?o+r.count:n.length,f,u,c;if(r.abort=function(){e=!0;s&&s.call(r)},f=r.scope||t.global,r.store||(r.store=this),r.onBegin&&r.onBegin.call(f,n.length,r),r.sort&&n.sort(i.createSortFunction(r.sort,this)),r.onItem)for(u=o;u<n.length&&u<h;++u)c=n[u],e||r.onItem.call(f,c,r);r.onComplete&&!e&&(u=null,r.onItem||(u=n.slice(o,h)),r.onComplete.call(f,u,r))},r.fetch=function(t){return t=t||{},t.store||(t.store=this),this._fetchItems(t,n.hitch(this,"fetchHandler"),n.hitch(this,"errorHandler")),t},r})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(n){var t={};return n.setObject("dojo.data.util.sorter",t),t.basicComparator=function(n,t){var i=-1;return null===n&&(n=void 0),null===t&&(t=void 0),n==t?i=0:(n>t||null==n)&&(i=1),i},t.createSortFunction=function(n,i){function c(n,t,i,r){return function(u,f){var e=r.getValue(u,n),o=r.getValue(f,n);return t*i(e,o)}}for(var r,o,f=[],u,s=i.comparatorMap,h=t.basicComparator,e=0;e<n.length;e++)u=n[e],r=u.attribute,r&&(u=u.descending?-1:1,o=h,s&&("string"!=typeof r&&"toString"in r&&(r=r.toString()),o=s[r]||h),f.push(c(r,u,o,i)));return function(n,t){for(var r,i=0;i<f.length;)if(r=f[i++](n,t),0!==r)return r;return 0}},t})},"*noref":1}});define("esri/layers/CSVLayer","dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../arcgis/csv ./FeatureLayer ../geometry/Extent ../tasks/FeatureSet".split(" "),function(n,t,i,r,u,f,e,o,s){return t=t(e,{declaredClass:"esri.layers.CSVLayer",_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",String:"esriFieldTypeString"},constructor:function(t,r){this.url=t;r=i.mixin({},r);this.columnDelimiter=r.columnDelimiter;this.latitudeFieldName=r.latitudeFieldName;this.longitudeFieldName=r.longitudeFieldName;var u=r.layerDefinition;u||(u={fields:r.fields||[],geometryType:"esriGeometryPoint",copyrightText:r.copyright},r.fields&&n.forEach(r.fields,function(n){n.type=this._fieldTypeMap[n.type||"String"];n.alias||(n.alias=n.name)},this));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,layerDefinition:u,outFields:r.outFields};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,longitudeFieldName:this.longitudeFieldName});this._projectFeatures=i.hitch(this,this._projectFeatures);this._addFeatures=i.hitch(this,this._addFeatures);this._initCSVLayer(r)},refresh:function(){this._fireUpdateStart();this.applyEdits(null,null,this.graphics);this._loadFeatures()},_setMap:function(){var n=this.inherited(arguments);return this._fireUpdateStart(),this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler),this._csvFC=null,n},_initCSVLayer:function(n){var t=this;f.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(i){t._csvFC=i;var r=i.layerDefinition;r.extent=t._getFCExtent(i);n.outFields||(n.outFields=["*"]);n.timeInfo&&(r.timeInfo=n.timeInfo);t._initFeatureLayer({layerDefinition:r},n)}).otherwise(this._errorHandler)},_loadFeatures:function(){f.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},_projectFeatures:function(n){return f.projectFeatureCollection(n,this._map.spatialReference)},_addFeatures:function(n){n=new s(n.featureSet);this.applyEdits(n.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(n){var t,r,i;if(n&&n.featureSet&&n.featureSet.features&&(n=n.featureSet.features,r=n.length,1<r)){for(i=n[0].geometry,t=new o(i.x,i.y,i.x,i.y),--r;0<r;r--)i=n[r].geometry,t.xmin=Math.min(t.xmin,i.x),t.ymin=Math.min(t.ymin,i.y),t.xmax=Math.max(t.xmax,i.x),t.ymax=Math.max(t.ymax,i.y);0>=t.getWidth()&&0>=t.getHeight()&&(t=null)}return t}}),r("extend-esri")&&i.setObject("layers.CSVLayer",t,u),t})},"esri/layers/FeatureLayer":function(){require({cache:{"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(l,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(n,i){this._handler=t.hitch(this,this._handler);this._relationshipQueryHandler=t.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=t.hitch(this,this._executeForIdsHandler);this._countHandler=t.hitch(this,this._countHandler);this._extentHandler=t.hitch(this,this._extentHandler);this.source=i&&i.source;this.gdbVersion=i&&i.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(n,i,r,f,e){var s=e.assembly,h,c;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson(s&&s[0]))),h=this._handler,c=this._errorHandler,this.source&&(s={source:this.source.toJson()},n.layer=u.toJson(s)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){h(n,t,i,r,e.dfd)},error:function(n){c(n,r,e.dfd)},callbackSuffix:f},this.requestOptions)},executeRelationshipQuery:function(n,i,u){var e,h,f;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson())),e=this._relationshipQueryHandler,h=this._errorHandler,this.gdbVersion&&(n.gdbVersion=this.gdbVersion),f=new r(s._dfdCanceller),f._pendingDfd=o({url:this._url.path+"/queryRelatedRecords",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,u,f)},error:function(n){h(n,u,f)}},this.requestOptions),f},executeForIds:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},n.toJson(e&&e[0]))),s=this._executeForIdsHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForCount:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._countHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForExtent:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._extentHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},_handler:function(n,t,i,r,u){try{var f=new a(n);this._successHandler([f],"onComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},_relationshipQueryHandler:function(n,t,r,u,f){try{var o=n.geometryType,s=n.spatialReference,e={};i.forEach(n.relatedRecordGroups,function(n){var t={},i;if(t.geometryType=o,t.spatialReference=s,t.features=n.relatedRecords,t=new a(t),null!=n.objectId)e[n.objectId]=t;else for(i in n)n.hasOwnProperty(i)&&"relatedRecords"!==i&&(e[n[i]]=t)});this._successHandler([e],"onExecuteRelationshipQueryComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},_executeForIdsHandler:function(n,t,i,r,u){try{this._successHandler([n.objectIds],"onExecuteForIdsComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},_countHandler:function(n,t,i,r,u){try{var f,o=n.features,e=n.objectIds;if(e)f=e.length;else{if(o)throw Error("Unable to perform query. Please check your parameters.");f=n.count}this._successHandler([f],"onExecuteForCountComplete",i,u)}catch(s){this._errorHandler(s,r,u)}},_extentHandler:function(n,t,i,r,u){try{n.extent&&(n.extent=new h(n.extent));this._successHandler([n],"onExecuteForExtentComplete",i,u)}catch(f){this._errorHandler(f,r,u)}}}),c._createWrappers(n),f("extend-esri")&&t.setObject("tasks.QueryTask",n,e),n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,t,i,r,u,f,e,o){return n=n(o,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(n,i){n&&t.isString(n)&&(this._url=e.urlToObject(this.url=n));i&&i.requestOptions&&(this.requestOptions=i.requestOptions);this.normalization=!0;this._errorHandler=t.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var n=this._url,t=/^http:/i;this.url&&(this.url=this.url.replace(t,"https:"));n&&n.path&&(n.path=n.path.replace(t,"https:"))},_encode:function(n,r,u){var e,f,s={},o,h;for(o in n)if("declaredClass"!==o&&(e=n[o],f=typeof e,null!==e&&void 0!==e&&"function"!==f))if(t.isArray(e))for(s[o]=[],h=e.length,f=0;f<h;f++)s[o][f]=this._encode(e[f]);else"object"===f?e.toJson&&(f=e.toJson(u&&u[o]),"esri.tasks.FeatureSet"===e.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),s[o]=r?f:i.toJson(f)):s[o]=e;return s},_successHandler:function(n,t,i,r){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&f._resDfd(r,n)},_errorHandler:function(n,t,i){this.onError(n);t&&t(n);i&&i.errback(n)},setNormalization:function(n){this.normalization=n},onError:function(){}}),r("extend-esri")&&(u.Task=n),n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(n){if(n){t.mixin(this,n);var r=this.features,u=n.spatialReference,f=h.getGeometryType(n.geometryType),u=this.spatialReference=new o(u);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);i.forEach(r,function(n,t){var i=n.geometry&&n.geometry.spatialReference;r[t]=new e(f&&n.geometry?new f(n.geometry):null,n.symbol&&c.fromJson(n.symbol),n.attributes);r[t].geometry&&!i&&r[t].geometry.setSpatialReference(u)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var t={};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields),this.spatialReference?t.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJson()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=h.getJsonType(this.features[0].geometry)),t.features=s._encodeGraphics(this.features,n)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,f.fixJson(t)},_hydrate:function(){var n=this.transform,t=this.geometryType;if(n&&t)for(var i=this.features,r=n.translate[0],u=n.translate[1],f=n.scale[0],e=n.scale[1],o=function(n,t,i){return"esriGeometryPoint"===n?function(n){n.x=t(n.x);n.y=i(n.y)}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){n=n.rings||n.paths;for(var u,c,e,r,o,s,f=0,h=n.length;f<h;f++)for(e=n[f],u=0,c=e.length;u<c;u++)r=e[u],0<u?(o+=r[0],s+=r[1]):(o=r[0],s=r[1]),r[0]=t(o),r[1]=i(s)}:"esriGeometryEnvelope"===n?function(n){n.xmin=t(n.xmin);n.ymin=i(n.ymin);n.xmax=t(n.xmax);n.ymax=i(n.ymax)}:"esriGeometryMultipoint"===n?function(n){n=n.points;for(var r,f,e,u=0,o=n.length;u<o;u++)r=n[u],0<u?(f+=r[0],e+=r[1]):(f=r[0],e=r[1]),r[0]=t(f),r[1]=i(e)}:void 0}(t,function(n){return n*f+r},function(n){return u-n*e}),n=0,t=i.length;n<t;n++)i[n].geometry&&o(i[n].geometry);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;for(var f=n.translate[0],e=n.translate[1],o=n.scale[0],s=n.scale[1],i=this.features,r=function(n,t,i){for(var r,f,e,o,s=[],u=0,h=n.length;u<h;u++)(r=n[u],0<u)?(o=t(r[0]),r=i(r[1]),o!==f||r!==e)&&(s.push([o-f,r-e]),f=o,e=r):(f=t(r[0]),e=i(r[1]),s.push([f,e]));return 0<s.length?s:null},h=function(n,t,i){return"esriGeometryPoint"===n?function(n){return n.x=t(n.x),n.y=i(n.y),n}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){var f,s,o,e,u;for(o=n.rings||n.paths,u=[],f=0,s=o.length;f<s;f++)e=o[f],(e=r(e,t,i))&&u.push(e);return 0<u.length?(n.rings?n.rings=u:n.paths=u,n):null}:"esriGeometryMultipoint"===n?function(n){var u;return u=r(n.points,t,i),0<u.length?(n.points=u,n):null}:"esriGeometryEnvelope"===n?function(n){return n}:void 0}(this.geometryType,function(n){return Math.round((n-f)/o)},function(n){return Math.round((e-n)/s)}),t=0,u=i.length;t<u;t++)i[t].geometry&&(h(i[t].geometry)||i[t].setGeometry(null));return this.transform=n,this}}),r("extend-esri")&&t.setObject("tasks.FeatureSet",n,u),n})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}}),i("extend-esri")&&t.setObject("tasks.StatisticDefinition",n,r),n})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.layers.FeatureType",constructor:function(n){var i,r,f,u;if(n&&t.isObject(n)){this.id=n.id;this.name=n.name;i=n.symbol;i&&(this.symbol=e.fromJson(i));i=n.domains;f=this.domains={};for(r in i)if(i.hasOwnProperty(r)){u=i[r];switch(u.type){case"range":f[r]=new o(u);break;case"codedValue":f[r]=new s(u);break;case"inherited":f[r]=new h(u)}}if(r=n.templates)for(i=this.templates=[],n=0;n<r.length;n++)i.push(new c(r[n]))}},toJson:function(){var r={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},n,t=this.domains,e=this.templates,o=f.fixJson,u;if(t){u=r.domains={};for(n in t)t.hasOwnProperty(n)&&(u[n]=t[n]&&t[n].toJson());o(u)}return e&&(r.templates=i.map(e,function(n){return n.toJson()})),o(r)}}),r("extend-esri")&&t.setObject("layers.FeatureType",n,u),n})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(n){n&&t.isObject(n)&&(this.name=n.name,this.description=n.description,this.drawingTool=n.drawingTool,this.thumbnail=n.thumbnail,n=n.prototype,this.prototype=new f(n.geometry,null,n.attributes))},toJson:function(){return u.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:u.fixJson(t.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}}),t.mixin(n,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"}),i("extend-esri")&&t.setObject("layers.FeatureTemplate",n,r),n})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(n){n&&t.isObject(n)&&(this.objectId=n.objectId,this.globalId=n.globalId,this.success=n.success,n.success||(n=n.error,this.error=Error(),this.error.code=n.code,this.error.message=n.description))}}),i("extend-esri")&&t.setObject("layers.FeatureEditResult",n,r),n})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode ../srUtils".split(" "),function(n,t,i,r,u,f,e,o){return n=n([e],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5e4,constructor:function(n){this.featureLayer=n;this.pagination=n.queryPagination;this._featureMap={};this._hasPartialFeatures=!1;this._drawFeatures=t.hitch(this,this._drawFeatures);this._queryErrorHandler=t.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(n){this._init&&(n?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id = "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(n){var t=n.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(t,n);this._incRefCount(t)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var n=this.featureLayer;n._collection?(n._fireUpdateStart(),n._refresh(!0),n._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},_getRequestId:function(n){return("_"+n.name+n.layerId+n._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var n=this.featureLayer;n._collection||n.suspended||!n.isQueryable()||(n._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,this._sendRequest())},_sendRequest:function(n){var u=this.map,t=this.featureLayer,e=t.getDefinitionExpression(),i=new f,r;i.outFields=t.getOutFields();i.where=e||"1=1";i.returnGeometry=!0;i.outSpatialReference=o.createSpatialReference(u.spatialReference.toJson());i.timeExtent=t.getTimeDefinition();i.maxAllowableOffset=t._maxOffset;i.quantizationParameters=t._quantizationParameters;t._ts&&(i._ts=(new Date).getTime());i.orderByFields=t.supportsAdvancedQueries?t.getOrderByFields():null;i.multipatchOption=t.multipatchOption;this.pagination&&(this._start=i.start=null==n?0:n,i.num=t.maxRecordCount);t._usePatch&&(r=this._getRequestId(t),this._cancelPendingRequest(null,r));t._task.execute(i,this._drawFeatures,this._queryErrorHandler,r)},_drawFeatures:function(n){var i,e,f,o;this._purgeRequests();var u=n.features,t=this.featureLayer,h=t.objectIdField,r,c=u.length,s=n.exceededTransferLimit&&!t._collection,l=t._selectedFeatures,a=t.mode===t.constructor.MODE_AUTO;for(r=u?u.length:0,i=t.graphics.length+r,e=i>=this.maxFeatures,t._fireUpdateStart(),e&&(i-=this.maxFeatures)&&u.splice(r-i,i),t._sortFeatures(u),r=0;r<c;r++)f=u[r],o=f.attributes[h],i=this._addFeatureIIf(o,f),this._incRefCount(o),a&&i!==f&&l[o]&&(i.setGeometry(f.geometry),i.setAttributes(f.attributes));this._applyTimeFilter(!0);this.pagination&&s&&!e||(this._hasPartialFeatures=!!n.exceededTransferLimit,t._fireUpdateEnd(null,n.exceededTransferLimit?{queryLimitExceeded:!0}:null));s&&(this.pagination&&!e&&this._sendRequest(this._start+t.maxRecordCount),t.onQueryLimitExceeded())},_queryErrorHandler:function(n){this._purgeRequests();this._hasPartialFeatures=!0;var t=this.featureLayer;t._errorHandler(n);t._fireUpdateEnd(n)}}),i("extend-esri")&&t.setObject("layers._SnapshotMode",n,r),n})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),function(n,t,i,r,u,f,e){return t=t(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(n._scopeName||"dojo")+"IoScript"},initialize:function(n){this.map=n;this._init=!0},startup:function(){},propertyChangeHandler:function(){},destroy:function(){this._init=!1},drawFeature:function(){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},_incRefCount:function(n){(n=this._featureMap[n])&&n._count++},_decRefCount:function(n){(n=this._featureMap[n])&&n._count--},_getFeature:function(n){return this._featureMap[n]},_addFeatureIIf:function(n,t){var i=this._featureMap,r=i[n],u=this.featureLayer;return r||(i[n]=t,u._add(t),t._count=0),r||t},_removeFeatureIIf:function(n){var t=this._featureMap[n],i=this.featureLayer;if(t){if(t._count)return;delete this._featureMap[n];i._remove(t)}return t},_clearIIf:function(){var n,t,i;n=this.featureLayer;var r=n.graphics,u=n._selectedFeatures,t=n.getSelectedFeatures().length,f=n.objectIdField;if(t)for(n=r.length-1;0<=n;n--)t=r[n],i=t.attributes[f],i in u?t._count=1:(t._count=0,this._removeFeatureIIf(i));else n.clear(),this._featureMap={}},_isPending:function(n){return f[this._prefix+n]?!0:!1},_cancelPendingRequest:function(n,t){if(n=n||f[this._prefix+t])try{n.cancel();f._validCheck(n)}catch(i){}},_purgeRequests:function(){f._validCheck(null)},_toggleVisibility:function(n){var i=this.featureLayer,u=i.graphics,f=n?"show":"hide",t,e=u.length,r;for(n=n&&i._ager,t=0;t<e;t++)r=u[t],r[f](),n&&i._repaint(r)},_applyTimeFilter:function(n){var t=this.featureLayer,i,u,f;t.timeInfo&&!t.suspended&&(n||t._fireUpdateStart(),i=t._trackManager,i&&i.clearTracks(),u=t.getTimeDefinition(),f=t._getOffsettedTE(t._mapTimeExtent),f?(f=t._getTimeOverlap(u,f))?(u=t._filterByTime(t.graphics,f.startTime,f.endTime),i&&i.addFeatures(u.match),r.forEach(u.match,function(n){var i=n._shape;n.visible||(n.show(),(i=n._shape)&&i._moveToFront());t._ager&&i&&t._repaint(n)}),r.forEach(u.noMatch,function(n){n.visible&&n.hide()})):this._toggleVisibility(!1):(i&&i.addFeatures(t.graphics),this._toggleVisibility(!0)),i&&(i.moveLatestToFront(),i.drawTracks()),n||t._fireUpdateEnd())}}),u("extend-esri")&&i.setObject("layers._RenderMode",t,e),t})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n([s],{declaredClass:"esri.layers._OnDemandMode",constructor:function(n){this.featureLayer=n;this._featureMap={};this._hasPartialFeatures=!1;this._queryErrorHandler=i.hitch(this,this._queryErrorHandler)},initialize:function(n){this.inherited(arguments);var i=this.featureLayer,t=i._srInfo;this._gridLayer=new h(new e(t?t.valid[0]:n.extent.xmin,t?t.valid[1]:n.extent.ymax,n.spatialReference),{width:i._tileWidth,height:i._tileHeight},{width:n.width,height:n.height},t);this._cellMap={};this._gridLayer.setResolution(n.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(n){this._init&&(2>n?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id = "+this.featureLayer.id+", Layer URL = "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(n){var t=n.geometry,o=[];if(t)for(var o=this._gridLayer.getCellsInExtent("point"===t.type?{xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y}:t.getExtent(),!1).cells,t=this._cellMap,i,s=n.attributes[this.featureLayer.objectIdField],f,r,e,u=0;u<o.length;u++)i=o[u],f=i.latticeID,r=i.row,e=i.col,f?i=t[f]=t[f]||i:(t[r]=t[r]||{},i=t[r][e]=t[r][e]||i),i.features=i.features||[],i.features.push(n),this._addFeatureIIf(s,n),this._incRefCount(s)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},hasAllFeatures:function(){if(this._hasPartialFeatures)return!0;for(var t=!1,i=this._getCurrentCells(),n=0;n<i.length;n++)if(i[n].hasPartialFeatures){t=!0;break}return!t},_enableConnectors:function(){var n=this.map;this._zoomConnect=t.connect(n,"onZoomEnd",this,this._zoomHandler);this._panConnect=t.connect(n,"onPanEnd",this,this._panHandler);this._resizeConnect=t.connect(n,"onResize",this,this._panHandler)},_disableConnectors:function(){t.disconnect(this._zoomConnect);t.disconnect(this._panConnect);t.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var n=this.featureLayer,t=this.map;!n.suspended&&n.isQueryable()&&(n._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,(n=n._trackManager)&&n.clearTracks(),this._cellMap={},this._gridLayer.setResolution(t.extent),this._sendRequest())},_panHandler:function(n){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var t=this.featureLayer._resized;n=t?n:null;t&&this._gridLayer.setMapState(n,this.map.width,this.map.height);this._sendRequest(n)}},_getRequestId:function(n,t){return("_"+n.name+n.layerId+n._ulid+"_"+t.resolution+"_"+(t.latticeID||t.row+"_"+t.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(n){var t,s,u;this._exceeds=!1;t=this.featureLayer;u=this.map;n=n||u.extent;u=this._gridLayer.getCellsInExtent(n,t.latticeTiling).cells;t.isEditable()||(s=this._cellMap,u=r.filter(u,function(n){if(n.lattice){if(s[n.latticeID])return!1}else if(s[n.row]&&s[n.row][n.col])return!1;return!0}));var c=t.getOutFields(),l=t.getDefinitionExpression(),a=t._getOffsettedTE(t._mapTimeExtent),v=t.supportsAdvancedQueries?t.getOrderByFields():null,y=t._usePatch,p=this._ioQueue,h,w=this,b=this._drawFeatures,f,i,e;for(this._pending=this._pending||0,h=0;h<u.length;h++)(f=u[h],i=new o,i.geometry=f.extent||f.lattice,i.outFields=c,i.where=l,t.latticeTiling&&f.extent&&(i.spatialRelationship=o.SPATIAL_REL_CONTAINS),i.returnGeometry=!0,i.timeExtent=a,t._ts&&(i._ts=(new Date).getTime()),i.orderByFields=v,i.multipatchOption=t.multipatchOption,i.maxAllowableOffset=t._maxOffset,i.quantizationParameters=t._quantizationParameters,(e=t.advancedQueryCapabilities)&&e.supportsQueryWithResultType&&(i.resultType="tile"),e=null,y&&(e=this._getRequestId(t,f),this._isPending(e)))||(this._pending++,p.push(t._task.execute(i,function(){var n=f;return function(t){b.apply(w,[t,n])}}.call(this),this._queryErrorHandler,e)));this._removeOldCells(n);this._endCheck()},_drawFeatures:function(n,t){t.hasPartialFeatures=!!n.exceededTransferLimit;this._exceeds=this._exceeds||n.exceededTransferLimit;this._finalizeIO();var r=this.featureLayer,o=this.map.extent,s=t.extent,i=t.row,h=t.col,a=r.objectIdField,e=n.features,c=this._gridLayer,u=this._cellMap,f=t.latticeID,l=f?u[f]:u[i]&&u[i][h];if(t.resolution==c._resolution&&(f?f===c.getLatticeID(o):c.intersects(s,o)))if(l)r._sortFeatures(e),this._updateCell(l,e);else for(r._sortFeatures(e),t.features=e,f?u[f]=t:(u[i]=u[i]||{},u[i][h]=t),o=e.length,r=0;r<o;r++)s=e[r],i=s.attributes[a],this._addFeatureIIf(i,s),this._incRefCount(i);else l&&this._removeCell(i,h,f);this._endCheck()},_queryErrorHandler:function(n){this._finalizeIO();this._hasPartialFeatures=!0;this.featureLayer._errorHandler(n);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(n){if(0===this._pending){this._processIOQueue();var t=this.featureLayer,i=t._trackManager;i&&(i.clearTracks(),i.addFeatures(t.graphics),t._ager&&r.forEach(t.graphics,function(n){n._shape&&t._repaint(n)}),i.moveLatestToFront(),i.drawTracks());this.featureLayer._fireUpdateEnd(n&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);this._exceeds&&t.onQueryLimitExceeded()}},_processIOQueue:function(n){this._ioQueue=r.filter(this._ioQueue,function(n){return-1<n.fired?!1:!0});n&&r.forEach(this._ioQueue,this._cancelPendingRequest)},_getCurrentCells:function(n){var i=[],r,t;n=n||this._cellMap;for(r in n)n.hasOwnProperty(r)&&(t=n[r],t&&(t.hasOwnProperty("row")||t.hasOwnProperty("latticeID")?i.push(t):"object"==typeof t&&i.push.apply(i,this._getCurrentCells(t))));return i},_removeOldCells:function(n){var i=this._cellMap,s=this._gridLayer,t,r;for(t in i)if(i[t]){var u=i[t],f=u.latticeID,e=0,o=0;if(f)e++,f!==s.getLatticeID(n)&&(this._removeCell(null,null,f),o++);else for(r in u)u[r]&&(e++,s.intersects(u[r].extent,n)||(this._removeCell(t,r),o++));o===e&&delete i[t]}},_updateCell:function(n,t){var f=this.featureLayer,o=f.objectIdField,f=f._selectedFeatures,r,s=t.length;for(n.features=n.features||[],r=0;r<s;r++){var i=t[r],e=i.attributes[o],u=this._addFeatureIIf(e,i);u===i?(this._incRefCount(e),n.features.push(u)):e in f||(u.setGeometry(i.geometry),u.setAttributes(i.attributes))}},_removeCell:function(n,t,i){var r=this._cellMap,u=this.featureLayer,e=u.objectIdField,f=i?r[i]:r[n]&&r[n][t];if(f)for(i?delete r[i]:delete r[n][t],n=f.features,t=0;t<n.length;t++)i=n[t].attributes[e],this._decRefCount(i),i in u._selectedFeatures||this._removeFeatureIIf(i)}}),u("extend-esri")&&i.setObject("layers._OnDemandMode",n,f),n})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline ../srUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(null,{declaredClass:"esri.layers._GridLayout",constructor:function(n,t,i,r){this.origin=n;this.cellWidth=t.width;this.cellHeight=t.height;this.mapWidth=i.width;this.mapHeight=i.height;this.srInfo=r},setResolution:function(n){this._resolution=(n.xmax-n.xmin)/this.mapWidth;this.srInfo&&(n=Math.round(Math.round(2*this.srInfo.valid[1]/this._resolution)/this.cellWidth),this._frameStats=[n,0,n-1])},setMapState:function(n,t,i){this.mapWidth=t;this.mapHeight=i;this.setResolution(n)},getCellCoordinates:function(n){var t=this._resolution,i=this.origin;return{row:Math.floor((i.y-n.y)/(this.cellHeight*t)),col:Math.floor((n.x-i.x)/(this.cellWidth*t))}},normalize:function(n){var t=this._frameStats;if(t){var i=t[0],r=t[1],t=t[2];n<r?(n%=i,n=n<r?n+i:n):n>t&&(n%=i)}return n},intersects:function(n,t){var r=this.srInfo;return r?i.some(t._getParts(r),function(t){return n.intersects(t.extent)}):n.intersects(t)},getCellExtent:function(n,t){var r=this._resolution,i=this.origin,u=this.cellWidth,f=this.cellHeight;return new e(t*u*r+i.x,i.y-(n+1)*f*r,(t+1)*u*r+i.x,i.y-n*f*r,s.createSpatialReference(i.spatialReference.toJson()))},getLatticeID:function(n){var t=this.getCellCoordinates({x:n.xmin,y:n.ymax}),i=this.getCellCoordinates({x:n.xmax,y:n.ymin});n=t.row;var r=i.row,t=this.normalize(t.col),i=this.normalize(i.col);return n+"_"+r+"_"+t+"_"+i},sorter:function(n,t){return n<t?-1:1},getCellsInExtent:function(n,t){for(var s=this.getCellCoordinates({x:n.xmin,y:n.ymax}),h=this.getCellCoordinates({x:n.xmax,y:n.ymin}),a=s.row,v=h.row,s=s.col,h=h.col,c=[],f,l,u=[],e=[],p,w,b,k,y=[],r=a;r<=v;r++)for(f=s;f<=h;f++)l=this.normalize(f),n=this.getCellExtent(r,l),i.some(c,function(n){return n.row===r&&n.col===l})||c.push({row:r,col:l,extent:n,resolution:this._resolution}),t&&(u.push(n.xmin,n.xmax),e.push(n.ymin,n.ymax));for(s=this.normalize(s),h=this.normalize(h),u.sort(this.sorter),e.sort(this.sorter),f=u.length,r=f-1;0<=r;r--)r<f-1&&u[r]===u[r+1]&&u.splice(r,1);for(f=e.length,r=f-1;0<=r;r--)r<f-1&&e[r]===e[r+1]&&e.splice(r,1);if(u.length&&e.length){for(p=u[0],w=u[u.length-1],b=e[0],k=e[e.length-1],f=u.length,r=0;r<f;r++)y.push([[u[r],k],[u[r],b]]);for(f=e.length,r=0;r<f;r++)y.push([[p,e[r]],[w,e[r]]]);u=new o({paths:y,spatialReference:this.origin.spatialReference.toJson()});c.push({latticeID:a+"_"+v+"_"+s+"_"+h,lattice:u,resolution:this._resolution})}return{minRow:a,maxRow:v,minCol:s,maxCol:h,cells:c}}}),r("extend-esri")&&t.setObject("layers._GridLayout",n,u),n})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(n,t,i,r,u){return n=n([u],{declaredClass:"esri.layers._SelectionMode",constructor:function(n){this.featureLayer=n;this._featureMap={}},propertyChangeHandler:function(n){this._init&&0===n&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures}}),i("extend-esri")&&t.setObject("layers._SelectionMode",n,r),n})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n([h],{declaredClass:"esri.layers._StreamMode",constructor:function(n){this.featureLayer=n;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=t.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;n.purgeOptions&&n.purgeOptions.age&&"number"==typeof n.purgeOptions.age&&(this._maxFeatureAge=1e3*Math.ceil(60*n.purgeOptions.age));this._drawFeatures=t.hitch(this,this._drawFeatures);this._queryErrorHandler=t.hitch(this,this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(n){this._init&&(0===n?this._applyTimeFilter():3===n?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id = "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(n){var t=this.featureLayer,i=t.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));t._joinField&&this._getFeature(n.attributes[i])?this._drawBuffer.updates.push({oid:n.attributes[i],updates:n}):this._drawBuffer.adds.push(n)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var n=this.featureLayer;n&&(n._relatedUrl||n._keepLatestUrl?(n._fireUpdateStart(),n._refreshing=!0,n.disconnect(),n.clear(),n._relatedQueried=!1,n._keepLatestQueried=!1,n.connect()):(n._fireUpdateStart(),n.clear(),n._fireUpdateEnd()))},_drawFeatures:function(n,t){this._purgeRequests();var i=this.featureLayer;i._create(n.features||[]);i._fireUpdateEnd(null,t)},_applyTimeFilter:function(){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(n){var t=this.featureLayer,r=t.objectIdField;n&&i.forEach(n,function(n){n=n.attributes[r];t._unSelectFeatureIIf(n,this);this._decRefCount(n);this._removeFeatureIIf(n)},this)},_addFeatures:function(n){var u=this.featureLayer,s=u._endTimeField,o=u._startTimeField,r,h,t,c=[],f=[],e=[];if(r=u._trackManager,h=u.objectIdField,r)for(t in n=r.addFeatures(n),n)n.hasOwnProperty(t)&&(c.push(t),n[t].adds&&(f=f.concat(n[t].adds)),n[t].deletes&&(e=e.concat(n[t].deletes)));else f=n;i.forEach(f,function(n){var i=n.attributes[h],t;t=s&&n.attributes[s];!t&&this._maxFeatureAge&&(t=o&&n.attributes[o]?n.attributes[o]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);t&&(t=1e3*Math.ceil(t/1e3),this._featuresByTime[t]?this._featuresByTime[t].push(i):this._featuresByTime[t]=[i]);this._addFeatureIIf(i,n);this._incRefCount(i)},this);e.length&&this._removeFeatures(e);r&&r.refreshTracks(c)},_updateFeatures:function(n){var t=this.featureLayer,r,u,f=[];r=t._trackManager;u=t._trackIdField;i.forEach(n,function(n){var i=n.updates,e;if(n=this._getFeature(n.oid),n){i.geometry&&n.setGeometry(i.geometry);i=i.attributes||{};for(e in i)i.hasOwnProperty(e)&&(n.attributes[e]=i[e]);n.setAttributes(n.attributes);n.visible=this._checkFeatureTimeIntersects(n);r&&n.attributes[u]?f.push(n.attributes[u]):t._repaint(n,null,!0)}},this);f.length&&r.refreshTracks(f)},_redrawAllTracks:function(){var n=this.featureLayer._trackManager,t;n&&(t=n.trimTracks())&&0<t.length&&(this._removeFeatures(t),n.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var n=this._drawBuffer,t=n.adds.splice(0,n.adds.length),i=n.updates.splice(0,n.updates.length),n=this.featureLayer;if(!n)return!1;n.updating||n._fireUpdateStart();this._addFeatures(t);this._updateFeatures(i);(t=this._getExpiredFeatures())&&t.length&&(this._removeFeatures(t),n._trackManager&&n._trackManager.removeFeatures(t));n._purge();n._fireUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var t=this._timeoutId,n=this._drawBuffer,i=n.adds,n=n.updates;t&&clearTimeout(t);i.splice(0,i.length);n.splice(0,n.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1e3*Math.ceil(Date.now()/1e3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(n){n=n||0===n?n:200;0>n&&(n=200);this._refreshRate=n},_checkFeatureTimeIntersects:function(n){var t=this.featureLayer,i=t.getMap();return(i=i?i.timeExtent:null)&&t.timeInfo&&(t.timeInfo.startTimeField||t.timeInfo.endTimeField)?0<t._filterByTime([n],i.startTime,i.endTime).match.length:!0},_getRequestId:function(n){return("_"+n.name+n.layerId+n._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(n){function h(n){y++;l.execute(t).then(function(t){n(null,t)},function(t){n(t)})}function c(n,i){if(n)y>=w||!r._relatedUrl?u._queryErrorHandler(Error("Could not get features from related feature service")):(p={relatedFeatureWarning:"Querying related feature service using the current filter failed. All related features are displayed, and the filter is applied to the stream service only"},t.where="1=1",h(c));else{var f=u._fixFieldNameCasing(r,i);i.features=f;u._drawFeatures(i,p)}}var r=this.featureLayer,l,t,i,a,v;if(r._fireUpdateStart(),n&&this.map){l=new o(n);t=new e;n=this.map;i=r.getFilter()||{};a=i.where||"1=1";v=i.geometry?s.fromJson(i.geometry):null;i=i.outFields?i.outFields.split(","):["*"];t.geometry=v;t.where=a;t.outFields=i;t.returnGeometry=!0;t.outSpatialReference=new f(n.spatialReference.toJson());r._usePatch&&(n=this._getRequestId(r),this._cancelPendingRequest(null,n));var y=0,w=2,u=this,p=null;h(c)}else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),!1},_queryErrorHandler:function(n){this._purgeRequests();var t=this.featureLayer;t._errorHandler(n);t._fireUpdateEnd(n)},_fixFieldNameCasing:function(n,t){var i=t.features||[],r=t.fields;if(!r||!i.length)return i;for(var r=this._mapFieldNameDifferences(n.fields,r),e=[],u,o,f=0,s=t.features.length;f<s;f++)u=i[f],o=this._swizzleResponseAttributes(u.attributes,r),e.push({geometry:u.geometry,attributes:o});return e},_mapFieldNameDifferences:function(n,t){for(var e=[],o={},u,f,i=0,r=t.length;i<r;i++)e.push(t[i].name);for(i=0,r=n.length;i<r;i++)u=n[i].name,f=this._checkForStreamFieldName(u,e),f&&(o[f]=u);return o},_checkForStreamFieldName:function(n,t){for(var u=n.toLowerCase(),r,i=0,f=t.length;i<f;i++)if(t[i].toLowerCase()===u){r=t[i];break}return r},_swizzleResponseAttributes:function(n,t){var r={},i,u;for(i in n)n.hasOwnProperty(i)&&(u=n[i],t.hasOwnProperty(i)?r[t[i]]=u:r[i]=u);return r},_getExpiredFeatures:function(){var n,r,t,u=[],f=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return f;if(n=1e3*Math.floor(this._lastEndTimeCheck/1e3),this._lastEndTimeCheck=r=1e3*Math.ceil(Date.now()/1e3),n&&n!==r)for(t=this._featuresByTime;n<=r;n+=1e3)t[n]&&(u=u.concat(t[n]),delete t[n]);return i.forEach(u,function(n){(n=this._getFeature(n))&&f.push(n)},this),f}}),r("extend-esri")&&t.setObject("layers._StreamMode",n,u),n})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(n,t,i,r,u,f,e,o,s,h){var c=-1!==f.renderer.toLowerCase().indexOf("canvas");return n=n(null,{declaredClass:"esri.layers._TrackManager",constructor:function(n){this.layer=n;this.trackMap={};this.trackLineMap={}},initialize:function(n){var r,e;this.map=n;var i=this.layer,f=i._getRenderer(),f=f&&f.trackRenderer;if("esriGeometryPoint"===i.geometryType){r=this.container=new h._GraphicsLayer({id:i.id+"_tracks",_child:!0,visible:i.visible,minScale:i.minScale,maxScale:i.maxScale});r.loaded=!0;r.onLoad(r);r._setMap(n,i._div);c||(n=r._div.getNode(),e=i._div.getNode(),n&&e&&u.place(n,e,"first"));r.setRenderer(f);i.on("visibility-change",t.hitch(this,function(n){this.container.setVisibility(n.visible);this.container.evaluateSuspension()}));i.on("scale-range-change",t.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))}},addFeatures:function(n){var t=this.trackMap,r=this.layer,o=r._trackIdField,u=[];i.forEach(n,function(n){var r=n.attributes[o];(t[r]=t[r]||[]).push(n);-1===i.indexOf(u,r)&&u.push(r)});var f=r._startTimeField,e=r.objectIdField,s=function(n,t){var i=n.attributes[f],r=t.attributes[f];return i===r?n.attributes[e]<t.attributes[e]?-1:1:i<r?-1:1};i.forEach(u,function(n){t[n].sort(s)})},trimTracks:function(n){function f(n){for(n=t[n]||[];n.length>e;)r.push(n.shift())}var t=this.trackMap,e=this.layer.maximumTrackPoints||0,r=[],u;if(!e)return r;if(n)i.forEach(n,function(n){f(n)});else for(u in t)t.hasOwnProperty(u)&&f(u);return r},drawTracks:function(n){function e(n){var f=t[n],e,i,l;if(i=r.trackLineMap[n],u.remove(i),delete r.trackLineMap[n],i=null,!f||2>f.length)return!1;for(i=[],e=f.length-1;0<=e;e--)(l=f[e].geometry)&&i.push([l.x,l.y]);f={};f[c]=n;1<i.length&&(i=new o(new s({paths:[i],spatialReference:h}),null,f),u.add(i),r.trackLineMap[n]=i)}var r=this,u=this.container,t,h,c,f;if(u)if(t=this.trackMap,h=this.map.spatialReference,c=this.layer._trackIdField,n)i.forEach(n,function(n){e(n)});else for(f in t)t.hasOwnProperty(f)&&e(f)},refreshTracks:function(n){function u(n){var r,i;if(o.drawTracks([n]),e&&e.latestObservationRenderer)for(n=t[n]||[],r=n.length,i=0;i<r;i++)f._repaint(n[i],null,!0)}var o=this,t=this.trackMap,f=this.layer,e=f._getRenderer(),r;if(n)i.forEach(n,function(n){u(n)});else for(r in t)t.hasOwnProperty(r)&&u(r);this.moveLatestToFront()},moveLatestToFront:function(n){i.forEach(this.getLatestObservations(n),function(n){var t=n._shape;t&&t._moveToFront();this._repaint(n,null,!0)},this.layer)},getLatestObservations:function(n){function f(n){return n=r[n],n[n.length-1]}var t=[],e=this.layer._getRenderer(),r=this.trackMap,u;if(!e.latestObservationRenderer)return t;if(n)i.forEach(n,function(n){t.push(f(n))});else for(u in r)r.hasOwnProperty(u)&&t.push(f(u));return t},clearTracks:function(n){var u=this.getLatestObservations(n),t=this.container,r;n?i.forEach(n,function(n){delete this.trackMap[n];t&&(r=this.trackLineMap[n],t.remove(r),delete this.trackLineMap[n])},this):(this.trackMap={},this.trackLineMap={},t&&t.clear());i.forEach(u,function(n){this._repaint(n,null,!0)},this.layer)},isLatestObservation:function(n){var t=this.trackMap[n.attributes[this.layer._trackIdField]];return t?t[t.length-1]===n:!1},destroy:function(){var n=this.container;n&&(n.clear(),n._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}}),r("extend-esri")&&t.setObject("layers._TrackManager",n,e),n})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){}function y(n){var t=n.layer;return{geometry:n.geometry,attributes:n.attributes,getLayer:function(){return t}}}return n=n(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(n){this.sourceLayer=n;this._hndls=[]},initialize:function(n){var f,r,i;this.map=n;f=this.sourceLayer;r=f.renderer;f.setDrawMode(!1);this.imageLayer=n._getMapImageLyr();i=this;this.heatmapRenderer=r instanceof c?r:(r.getRendererInfoByZoom(n.getZoom())||r.getRendererInfoByScale(n.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);u(["../workers/heatmapCalculator"],function(n){i._calculator=new n(t.mixin({width:i.map.width,height:i.map.height},i._getOptions()));i._setupRenderer();i.heatmapRenderer.getStats=n.calculateStats;i.heatmapRenderer.getHistogramData=n.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(n){var t=n.renderer,i=t instanceof c;this.heatmapRenderer?i?this.heatmapRenderer=t:this._removeRenderer(n):i&&(this.heatmapRenderer=t,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(n){n=n.opacity;var t=this._getImageBySourceId(this.sourceLayer.id);t&&t.setOpacity(n)},_setupRenderer:function(){var u=this._hndls,n=this.sourceLayer,f=this.map,t=this;n._originalDraw=n._draw;n._draw=v;n._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),250);u.push(n.on("update-end",this._setupDraw));u.push(n.on("suspend",function(n){(n=t._getImageBySourceId(t.sourceLayer.id))&&n.hide()}));u.push(n.on("resume",function(n){(n=t._getImageBySourceId(t.sourceLayer.id))&&n.show()}));u.push(i.after(n,"redraw",this._setupDraw));u.push(f.on("layer-remove",function(i){i.layer==n&&((i=t._getImageBySourceId(t.sourceLayer.id))&&t.imageLayer.removeImage(i),t._removeRenderer({target:n}))}));n._collection&&u.push(n.on("graphic-add",function(n){t._reprojectFeature(n.graphic);t._setupDraw()}));1!==n.mode&&(u.push(f.on("resize, pan-end",this._setupDraw)),u.push(f.on("zoom-end",this._setupDraw)));u.push(n.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();n.graphics&&n.graphics.length&&(n.graphics[0].geometry&&!f.spatialReference.equals(n.graphics[0].geometry.spatialReference)&&r.forEach(n.graphics,function(n){this._reprojectFeature(n)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var n=this;this._drawTimer=setTimeout(function(){clearTimeout(n._drawTimer);n._drawTimer=null;n.sourceLayer._getRenderer().isInstanceOf(c)&&n.recalculateHeatmap()},16)}},_removeRenderer:function(n){var t=n.target,i;t._draw=t._originalDraw;delete t._originalDraw;t.setDrawMode(!0);this._removeHandlers();this._hndls=[];i=this._getImageBySourceId(this.sourceLayer.id);i&&this.imageLayer.removeImage(i);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;t.renderer!=n.renderer&&t.renderer.getRendererInfo?this.heatmapRenderer=null:(t.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(n){if(n&&n.geometry){var t=n.geometry,i=this.map.spatialReference;i.equals(t.spatialReference)||(t=s.project(t,i),null==t?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):n.geometry=t)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var n=this.sourceLayer,i=this.map,c=this.heatmapRenderer,r=this.map.extent,f=this.map.width,e=this.map.height,a=this._calculator,u=this,o=function(o){o=u._getScreenPoints(o.features,i,n);o=a.calculateImageData(t.mixin({screenPoints:o,mapinfo:{extent:[r.xmin,r.ymin,r.xmax,r.ymax],resolution:i.getResolution()},width:f,height:e},u._getOptions()));o=c.getSymbol(y({geometry:i.extent,attributes:{size:[f,e],imageData:o},layer:n}));o=new h({extent:i.extent,href:o.url,opacity:0,sourceId:n.id});u._swapMapImages(o,u._getImageBySourceId(n.id));n.suspended&&o.hide()},s={geometry:i.extent,timeExtent:n.useMapTime?i.timeExtent:void 0,spatialRelationship:l.SPATIAL_REL_INTERSECTS};null!=n._canDoClientSideQuery(s)?n.queryFeatures(s,o):o({features:n.graphics})},_getScreenPoints:function(n,t,i){var c=[],l=n.length,v=0,u=0,e,s=new o(t.extent.xmin,t.extent.ymax,t.spatialReference),h=t.toScreen(s),y=h.x,h=h.y,a=t.getResolution(),f;for((u=t.extent.getCacheValue("_parts"))&&(f=r.map(u,function(n){return i._intersects(t,n.extent)[0]}));l--;)u=n[l],u.geometry&&(e={x:Math.ceil((u.geometry.x-s.x)/a+y),y:Math.floor((s.y-u.geometry.y)/a-h),attributes:u.attributes},f&&(u=1<f.length&&e.x<-f[0]?f[1]:f[0],e.x+=u),c[v++]=e);return c},_getImageBySourceId:function(n){var t=this.imageLayer.getImages(),t=r.filter(t,function(t){return t.sourceId==n});if(t.length)return t[t.length-1]},_swapMapImages:function(n,t){function u(){i.removeImage(t)}var i=this.imageLayer,r=this.sourceLayer.opacity;i.addImage(n);a.anim(n._node,{opacity:r},null,null,function(){n.opacity=r});null!=t&&a.anim(t._node,{opacity:0},null,null,u)},_removeHandlers:function(){if(null!=this._hndls)for(var n=this._hndls.length;n--;)this._hndls[n].remove()},_getOptions:function(){var n=this.heatmapRenderer;return{blurRadius:n.blurRadius,gradient:n.gradient,maxPixelIntensity:n.maxPixelIntensity,minPixelIntensity:n.minPixelIntensity,field:n.field,fieldOffset:n.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);this._resetTimer=null;for(var t=this.sourceLayer.graphics,i=t.length,n;i--;)n=t[i],n._shape=n._offsets=void 0}}),e("extend-esri")&&t.setObject("layers.HeatmapManager",n,f),n})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/SimpleRenderer ../../symbols/SimpleMarkerSymbol ../GraphicsLayer ./GeohashAggregation".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(f,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterSize:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_map:null,_eventHandles:null,_clusterSize:null,_renderer:null,_statisticInfos:null,_infoTemplate:null,_clusterGenerator:null,constructor:function(n){this._eventHandles=[];this.layer=n.layer;this.setAggregationInfo(n.aggregationInfo)},initialize:function(n){this._map=n;this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners()},destroy:function(){this._destroyEventListeners();this._destroyClusterGenerator();this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(n){this.aggregationInfo=n;this._applyAggregationInfo()},getClusterRenderer:function(){return this._renderer},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return this._clusterGenerator&&this._clusterGenerator.clustersEnabled},_createContainer:function(){var n=this.layer,t=new l._GraphicsLayer({_child:!0,id:n.id+"_clusters",visible:n.visible,minScale:n.minScale,maxScale:n.maxScale,infoTemplate:this._infoTemplate});t.setRenderer(this._renderer);t.loaded=!0;t.onLoad(t);return t._setMap(this._map,n._div),n._childLayer=t},_destroyContainer:function(){var n=this.container;n&&(n.clear(),n._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new a({map:this._map,layer:this.layer,clusterSize:this._clusterSize,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var n=this._clusterGenerator;n.loaded?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(n.on("load",t.hitch(this,function(){this._applyRenderer();this._initClusterUpdates()})),n.on("load-error",t.hitch(this,function(n){console.log(n.error)})));this._eventHandles.push(n.on("mode-change",t.hitch(this,function(){this.emit("mode-change")})))},_destroyClusterGenerator:function(){this._clusterGenerator&&this._clusterGenerator.destroy();this._clusterGenerator=null},_applyAggregationInfo:function(){this._applyClusterSize();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&this.redraw()},_applyClusterSize:function(){var n=this.aggregationInfo;this._clusterSize=n&&n.clusterSize||this.defaults.clusterSize;this._clusterGenerator&&this._clusterGenerator.setClusterSize(this._clusterSize)},_applyRenderer:function(){this._renderer=this._getRenderer(this.aggregationInfo,"avg");this._statisticInfos=this._createStatisticInfos(this._renderer,"avg");this._clusterGenerator&&this._clusterGenerator.setStatisticInfos(this._statisticInfos);this.container&&(this.container.setRenderer(this._renderer),this.emit("renderer-change"),i.forEach(this.container.graphics,function(n){n.setAttributes(n._cluster.attributes)}));this._applyInfoTemplate()},_applyInfoTemplate:function(){this._infoTemplate=this._getInfoTemplate(this.aggregationInfo,this._statisticInfos);this.container&&this.container.setInfoTemplate(this._infoTemplate)},_getRenderer:function(n,t){var i=n&&n.renderer;return i||(i=(i=this.layer&&this.layer.renderer)?this._createClusterRenderer(i,t):this._getDefaultClusterRenderer()),i},_getDefaultClusterRenderer:function(){var n=new h(new c(this.defaults.markerSymbol));return this._addSizeByCountVariable(n),n},_createClusterRenderer:function(n,t){var i,r,u;return this._isSupportedRenderer(n)?(i=new n.constructor(n.toJson()),r=t+"_",i.attributeField=r+i.attributeField,i.normalizationField&&(i.normalizationField=r+i.normalizationField),i.setVisualVariables(null),r=this._getSupportedVariables(n),u=this._createClusterVariables(r.allVars,t),i.setVisualVariables(u),r.sizeVars.length||this._addSizeByCountVariable(i),i):this._getDefaultClusterRenderer()},_isSupportedRenderer:function(n){var t=n.declaredClass.toLowerCase();return-1<t.indexOf("simplerenderer")?!0:-1<t.indexOf("classbreaksrenderer")?n.valueExpression?!1:n.isContinuousRenderer():!1},_getSupportedVariables:function(n){var t=n.getVisualVariablesForType("colorInfo",!1)||[],r=n.getVisualVariablesForType("sizeInfo",!1)||[];return n=n.getVisualVariablesForType("opacityInfo",!1)||[],t=i.filter(t,this._variableFilter),r=i.filter(r,this._variableFilter),n=i.filter(n,this._variableFilter),{colorVars:t,sizeVars:r,opacityVars:n,allVars:t.concat(r).concat(n)}},_variableFilter:function(n){return"string"==typeof n.field},_createClusterVariables:function(n,t){return i.map(n,function(n){return this._createVarForAvg(n,t)},this)},_createVarForAvg:function(n,i){var r=t.clone(n),u=i+"_";return r.field=u+r.field,r.normalizationField&&(r.normalizationField=u+r.normalizationField),this._setVariableTitle(r,n),r},_setVariableTitle:function(n,t){n.legendOptions&&n.legendOptions.title||(n.legendOptions=n.legendOptions||{},n.legendOptions.title=s.getVisualVariableTitle(t,this.layer))},_createStatisticInfos:function(n,t){var r,u;if(-1!==n.declaredClass.toLowerCase().indexOf("classbreaksrenderer"))return r=[n.attributeField,n.normalizationField],i.forEach(n.visualVariables,function(n){"count"!==n.field&&(r.push(n.field),r.push(n.normalizationField))}),r=i.filter(r,function(n){return!!n}),r.sort(),r=i.filter(r,function(n,t){return 0===t||r[t-1]!==n}),u=t+"_",i.map(r,function(n){return{field:n.replace(u,""),type:t}})},_addSizeByCountVariable:function(n){var t=this._createSizeByCountVariable();t&&this._addVariable(n,t)},_getSizeByCountVariable:function(n){return n=n.getVisualVariablesForType("sizeInfo",!1)||[],i.filter(n,function(n){return"count"===n.field})[0]},_updateSizeByCountVariable:function(){var n=this._renderer,i=this._getSizeByCountVariable(n),t;i?(t=this._createSizeByCountVariable(),t&&this._replaceVariable(n,i,t)):this._addSizeByCountVariable(n)},_createSizeByCountVariable:function(){var n=this._clusterGenerator,t;return n&&(n=n.getCurrentLodStats(),t={type:"sizeInfo",field:"count",valueUnit:"unknown",minSize:8,maxSize:50,minDataValue:n.min,maxDataValue:n.max,legendOptions:{title:"Number of features"}}),t},_addVariable:function(n,t){var i=n.visualVariables||[];i.push(t);n.setVisualVariables(i)},_replaceVariable:function(n,t,r){var u=n.visualVariables;t=i.indexOf(u,t);-1<t&&u.splice(t,1);u.push(r);n.setVisualVariables(u)},_getInfoTemplate:function(n,t){var r=n&&n.infoTemplate;if(!r){var f=this.layer,e=[{fieldName:"count",visible:!0,label:"Number of features",format:{digitSeparator:!0,places:0}}],u=[];i.forEach(t,function(n){var t=n.type+"_"+n.field;e.push({fieldName:t,visible:!0,label:"Average "+f.getFieldLabel(n.field),format:{digitSeparator:!0,places:1}});u.push("Average <b>"+f.getFieldLabel(n.field)+"<\/b> within this cluster is <b>{"+t+"}<\/b>.<br>")});r=u.length?"<br>"+u.join(""):"";r=new o({fieldInfos:e,description:"This cluster represents <b>{count}<\/b> features.<br>"+r})}return r},_removeFromPopup:function(n){var u=this._map.infoWindow,t=u.features,r=[];i.forEach(t,function(t,i){t.getLayer()===n&&r.push(i)});r.length&&(r.sort(function(n,t){return t-n}),t=t.slice(0),i.forEach(r,function(n){t.splice(n,1)}),u.setFeatures(t),t.length||u.hide())},_initClusterUpdates:function(){this._updateClusters(!0,!1);this._eventHandles.push(this._clusterGenerator.on("update-end",t.hitch(this,function(n){this._updateClusters(n.levelChange,n.modeChange)})))},_updateClusters:function(n,t){this.isClusteringEnabled()&&t&&this._removeFromPopup(this.layer);var r=i.map(this._clusterGenerator.clusters,function(n){var t=new e(n.centroid,null,n.attributes);return t._cluster=n,t});this._addGraphics(r,n)},_addGraphics:function(n,t){var r=this.container,u;r.clear();u=this.aggregationInfo&&this.aggregationInfo.renderer;t&&this.isClusteringEnabled()&&this._renderer!==u&&(this._updateSizeByCountVariable(),this.emit("renderer-change"));i.forEach(n,function(n){r.add(n)})},_createLayerEventListeners:function(){var n=this.layer;this._eventHandles.push(n.on("visibility-change",t.hitch(this,function(n){this.container.setVisibility(n.visible);this.container.evaluateSuspension()})),n.on("scale-range-change",t.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),n.on("renderer-change",t.hitch(this,function(){this._applyRenderer()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",t.hitch(this,function(){this.isClusteringEnabled()&&this._removeFromPopup(this.container);this.container.clear()})))},_destroyEventListeners:function(){i.forEach(this._eventHandles,function(n){n.remove()})}}),r("extend-esri")&&t.setObject("layers.clustering.ClusterManager",n,u),n})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,t,i,r,u,f,e,o){return n=n([f,e],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(n,i){t.mixin(this,i);this.initialize(n,i)},getTitle:function(n){var t;return this.info&&(t=this.titleHasRelatedFields?"":this._getPopupValues(n,!0).title),t||""},getContent:function(n){return this.info?new o({template:this,graphic:n,chartTheme:this.chartTheme},r.create("div")).domNode:""}}),i("extend-esri")&&t.setObject("dijit.PopupTemplate",n,u),n})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){return n=n(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(n,r){if(n){t.mixin(this,r);this.info=n;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var u=this._fieldLabels={},f=this._fieldsMap={};this.info.fieldInfos&&i.forEach(this.info.fieldInfos,function(n){var t=n.fieldName.toLowerCase(),i=this._isExpressionField(t)?this.getExpressionInfo(t):null;u[t]=i?i.title:n.label;f[t]=n},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(n){var t;return i.some(this.info&&this.info.fieldInfos,function(i){return i.fieldName===n&&(t=i),!!t}),t},getExpressionInfo:function(n){if(this._isExpressionField(n)){n=n.replace(this._reExprField,"");n=n.toLowerCase();var t;return i.some(this.info.expressionInfos,function(i){return i.name.toLowerCase()===n&&(t=i),!!t}),t}},getComponents:function(n){var o=this.info,u=new e,f,r;return o.fieldInfos&&(r=i.filter(o.fieldInfos,function(n){return-1!==n.fieldName.indexOf(this._relatedFieldPrefix)},this)),r&&0<r.length&&(f=this._getRelatedRecords({graphic:n,fieldsInfo:r})),f?f.always(t.hitch(this,function(){u.resolve(this._getPopupValues(n))})):u.resolve(this._getPopupValues(n)),u.promise},getAttachments:function(n){var t=n.getSourceLayer();return n=n.attributes,this.info.showAttachments&&t&&t.hasAttachments&&t.objectIdField&&(n=n&&n[t.objectIdField])?t.queryAttachmentInfos(n):void 0},_isExpressionField:function(n){return this._reExprField.test(n)},_compileExpressions:function(n){var t={};return i.forEach(n,function(n){t[n.name]={compiledFunc:b.createFunction(n.expression)}}),t},_fetchAttributes:function(n){var r=t.clone(n.attributes)||{},u=this._exprPrefix,f=this._exprCache;return i.forEach(this.info.expressionInfos,function(t){var i=u+t.name;t=f[t.name];t=b.executeFunction(t&&t.compiledFunc,b.createExecContext(n,n._getViewInfo()));"string"==typeof t&&(t=h.encode(t));r[i]=t}),r},_getPopupValues:function(n,r){var h=this.info,f=n.getSourceLayer(),o=this._fetchAttributes(n),s=t.clone(o),g=h.fieldInfos,b="",nt="",k,e,u,y,l,p=f&&f._getDateOpts&&f._getDateOpts().properties,p=p&&p.slice(0),a={dateFormat:{properties:p,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}},v,tt,rt,w,d,it;if(this._relatedInfo)for(y in this._relatedInfo)this._relatedInfo.hasOwnProperty(y)&&(v=this._relatedInfo[y],tt=this._relatedLayersInfo[y],v&&(i.forEach(v.relatedFeatures,function(n){for(l in n.attributes)if(n.attributes.hasOwnProperty(l)&&"esriRelCardinalityOneToOne"===tt.relation.cardinality){var t=this._toRelatedFieldName([tt.relation.id,l]);o[t]=s[t]=n.attributes[l]}},this),i.forEach(v.relatedStatsFeatures,function(n){for(l in n.attributes)if(n.attributes.hasOwnProperty(l)){var t=this._toRelatedFieldName([tt.relation.id,l]);o[t]=s[t]=n.attributes[l]}},this)));if(g&&i.forEach(g,function(n){e=n.fieldName;var t=this._getLayerFieldInfo(f,e);t&&(e=n.fieldName=t.name);s[e]=this._formatValue(s[e],e,a);p&&n.format&&n.format.dateFormat&&(n=i.indexOf(p,e),-1<n&&p.splice(n,1))},this),f){y=f.types;rt=(v=f.typeIdField)&&o[v];for(e in o)o.hasOwnProperty(e)&&-1===e.indexOf(this._relatedFieldPrefix)&&(u=o[e],c.isDefined(u))&&(w=this._getDomainName(f,n,y,rt,e,u),c.isDefined(w)?s[e]=w:e===v&&(w=this._getTypeName(f,n,u),c.isDefined(w)&&(s[e]=w)))}return(h.title&&(b=this._processFieldsInLinks(this._fixTokens(h.title,f),o),b=t.trim(c.substitute(s,b,a)||"")),r)?{title:b}:(h.description&&(nt=this._processFieldsInLinks(this._fixTokens(h.description,f),o),nt=t.trim(c.substitute(s,nt,a)||"")),g&&(k=[],i.forEach(g,function(n){(e=n.fieldName)&&n.visible&&k.push([this._fieldLabels[e.toLowerCase()]||e,c.substitute(s,"${"+e+"}",a)||""])},this)),h.mediaInfos&&(d=[],i.forEach(h.mediaInfos,function(n){var e,r,v,h,l;it=0;u=n.value;switch(n.type){case"image":r=u.sourceURL;r=r&&t.trim(c.substitute(o,this._fixTokens(r,f)));it=!!r;break;case"piechart":case"linechart":case"columnchart":case"barchart":r=u.normalizeField;u.fields=i.map(u.fields,function(n){return(e=this._getLayerFieldInfo(f,n))?e.name:n},this);r&&(e=this._getLayerFieldInfo(f,r),u.normalizeField=e?e.name:r);it=i.some(u.fields,function(n){return c.isDefined(o[n])||-1!==n.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}it&&(n=t.clone(n),u=n.value,r=n.title?this._processFieldsInLinks(this._fixTokens(n.title,f),o):"",v=n.caption?this._processFieldsInLinks(this._fixTokens(n.caption,f),o):"",n.title=r?t.trim(c.substitute(s,r,a)||""):"",n.caption=v?t.trim(c.substitute(s,v,a)||""):"","image"===n.type?(u.sourceURL=c.substitute(o,this._fixTokens(u.sourceURL,f)),u.linkURL&&(u.linkURL=t.trim(c.substitute(o,this._fixTokens(u.linkURL,f))||""))):i.forEach(u.fields,function(n,t){if(-1!==n.indexOf(this._relatedFieldPrefix))l=this._getRelatedChartInfos(n,u,o,a),l instanceof Array?u.fields=l:u.fields[t]=l;else{var i=o[n],i=void 0===i?null:i;h=o[u.normalizeField]||0;i&&h&&(i/=h);u.fields[t]={y:i,tooltip:(this._fieldLabels[n.toLowerCase()]||n)+":<br/>"+this._formatValue(i,n,a,!!h)}}},this),d.push(n))},this)),{title:b,description:nt,hasDescription:!!h.description,fields:k&&k.length?k:null,mediaInfos:d&&d.length?d:null,formatted:s,editSummary:f&&f.getEditSummary?f.getEditSummary(n):""})},_getRelatedChartInfos:function(n,t,r,u){var s,h,o,f,e,l;return s=[],l=this._fromRelatedFieldName(n),e=l[0],h=this._relatedInfo[e],e=this._relatedLayersInfo[e],h&&i.forEach(h.relatedFeatures,function(i){var e,a,h,v;i=i.attributes;for(a in i)i.hasOwnProperty(a)&&a===l[1]&&(e={},f=i[a],t.normalizeField&&(o=-1!==t.normalizeField.indexOf(this._relatedFieldPrefix)?i[this._fromRelatedFieldName(t.normalizeField)[1]]:r[t.normalizeField]),f&&o&&(f/=o),t.tooltipField?-1!==t.tooltipField.indexOf(this._relatedFieldPrefix)?(h=this._fromRelatedFieldName(t.tooltipField)[1],v=c.isDefined(i[h])?i[h]:h,e.tooltip=v+":<br/>"+this._formatValue(f,h,u,!!o)):e.tooltip=(this._fieldLabels[n.toLowerCase()]||n)+":<br/>"+this._formatValue(f,t.tooltipField,u,!!o):e.tooltip=f,e.y=f,s.push(e))},this),"esriRelCardinalityOneToMany"===e.relation.cardinality||"esriRelCardinalityManyToMany"===e.relation.cardinality?s:s[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(n,t){var i=this;return n.replace(/(\{([^\{\r\n]+)\})/g,function(n,r,u){return n=i._getLayerFieldInfo(t,u),"$"+(n?"{"+n.name+"}":r)})},_encodeAttributes:function(n){n=t.clone(n)||{};var r,i;for(r in n)(i=n[r])&&"string"==typeof i&&(i=encodeURIComponent(i).replace(/\'/g,"&apos;"),n[r]=i);return n},_processFieldsInLinks:function(n,t){var i=this._encodeAttributes(t),r=this;return n&&(n=n.replace(this._reHref,function(n,u){return r._addValuesToHref(n,u,t,i)}).replace(this._reHrefApos,function(n,u){return r._addValuesToHref(n,u,t,i)})),n},_addValuesToHref:function(n,i,r,u){return i=i&&t.trim(i),c.substitute(i&&0===i.indexOf("${")?r:u,n)},_getLayerFieldInfo:function(n,t){return n&&n.getField?n.getField(t):null},_formatValue:function(n,r,u,f){var s=this._fieldsMap[r.toLowerCase()],e=s&&s.format,l,o;if(r=-1!==i.indexOf(u.dateFormat.properties,r),l="number"==typeof n&&!r&&(!e||!e.dateFormat),!c.isDefined(n)||!s||!c.isDefined(e))return l?this._forceLTR(n):n;var h="",s=[],a=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),v=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(a&&!r)h="NumberFormat",s.push("places: "+(c.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),s.length&&(h+="("+s.join(",")+")");else if(e.dateFormat)h="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return l?this._forceLTR(n):n;return o=this._applyFormatting(n,h,u),a&&-1<n.constructor.toString().indexOf("Array")&&(o="",i.forEach(n,t.hitch(this,function(n,t){t&&(o+=" ");o+=this._applyFormatting(n,h,u)}))),a&&!v&&k.group&&(o=o.replace(new RegExp("\\"+k.group,"g"),"")),r&&(o='<span class="esriDateValue">'+o+"<\/span>"),l?this._forceLTR(o):o},_applyFormatting:function(n,t,i){return c.substitute({myKey:n},"${myKey:"+t+"}",i)||""},_forceLTR:function(n){var t=o("ie");return t&&10>=t?n:"<span class='esriNumericValue'>"+n+"<\/span>"},_insertOffset:function(n){return n&&(n=c.isDefined(this.utcOffset)?n.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):n),n},_getDomainName:function(n,t,i,r,u,f){return(n=n.getDomain&&n.getDomain(u,{feature:t}))&&n.codedValues?n.getName(f):null},_getTypeName:function(n,t){return(n=n.getType&&n.getType(t))&&n.name},_getRelatedRecords:function(n){var u=n.graphic,i=new e,r;return this._relatedLayersInfo?this._queryRelatedLayers(u).then(t.hitch(this,function(n){this._setRelatedRecords(u,n);i.resolve(n)}),t.hitch(this,this._handlerErrorResponse,i)):this._getRelatedLayersInfo(n).then(t.hitch(this,function(n){for(r in n)n.hasOwnProperty(r)&&n[r]&&(this._relatedLayersInfo[r].relatedLayerInfo=n[r]);this._queryRelatedLayers(u).then(t.hitch(this,function(n){this._setRelatedRecords(u,n);i.resolve(n)}),t.hitch(this,this._handlerErrorResponse,i))}),t.hitch(this,this._handlerErrorResponse,i)),i.promise},_getRelatedLayersInfo:function(n){var f=n.fieldsInfo,r,t,u={};r=n.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});i.forEach(f,function(n){var u,t,f,e;u=this._fromRelatedFieldName(n.fieldName);t=u[0];u=u[1];t&&(this._relatedLayersInfo[t]||(i.some(r.relationships,function(n){if(n.id==t)return e=n,!0}),e&&(this._relatedLayersInfo[t]={relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[t]&&(this._relatedLayersInfo[t].relatedFields.push(u),n.statisticType&&(f=new w,f.statisticType=n.statisticType,f.onStatisticField=u,f.outStatisticFieldName=u,this._relatedLayersInfo[t].outStatistics.push(f))))},this);for(t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&this._relatedLayersInfo[t]&&(n=this._relatedLayersInfo[t].relation,n=r.url.replace(/[0-9]+$/,n.relatedTableId),this._relatedLayersInfo[t].relatedLayerUrl=n,u[t]=a({url:n,content:{f:"json"},callbackParamName:"callback"}));return s(u)},_queryRelatedLayers:function(n){var i={};for(var t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&(i[t]=this._queryRelatedLayer({graphic:n,relatedInfo:this._relatedLayersInfo[t]}));return s(i)},_queryRelatedLayer:function(n){var c,w,k,f,o,a,h,d,r,l,u,b,p;return c=n.graphic,w=c.getSourceLayer(),k=w.url.match(/[0-9]+$/g)[0],u=n.relatedInfo,l=u.relatedLayerInfo,b=u.relatedLayerUrl,n=u.relation,i.some(l.relationships,function(n){if(n.relatedTableId===parseInt(k,10))return f=n,!0},this),f&&(o=new v,i.some(l.fields,function(n){if(n.name===f.keyField)return d=-1!==i.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],n.type)?"number":"string",!0}),f.relationshipTableId&&f.keyFieldInRelationshipTable?(p=new e,this._queryRelatedRecords(c,f).then(t.hitch(this,function(n){var f;f=n[c.attributes[w.objectIdField]];n=i.map(f.features,function(n){return n.attributes[l.objectIdField]},this);u.outStatistics&&0<u.outStatistics.length&&l.supportsStatistics&&(r=new v,r.objectIds=n,r.outFields=o.outFields,r.outStatistics=u.outStatistics);r&&(a=new y(b),a.execute(r).then(t.hitch(this,function(n){var t=[];t.push(f);t.push(n);p.resolve(t)})))}))):(h="string"===d?f.keyField+"='"+c.attributes[n.keyField]+"'":f.keyField+"="+c.attributes[n.keyField],o.where=h,o.outFields=u.relatedFields,u.outStatistics&&0<u.outStatistics.length&&l.supportsStatistics&&(r=new v,r.where=o.where,r.outFields=o.outFields,r.outStatistics=u.outStatistics),a=new y(b),h=[],h.push(a.execute(o)),r&&h.push(a.execute(r)))),h?s(h):p?p.promise:void 0},_setRelatedRecords:function(n,t){var i,r;this._relatedInfo=[];for(i in t)t.hasOwnProperty(i)&&t[i]&&(r=t[i],this._relatedInfo[i]={},this._relatedInfo[i].relatedFeatures=r[0].features,c.isDefined(r[1])&&(this._relatedInfo[i].relatedStatsFeatures=r[1].features))},_handlerErrorResponse:function(n,t){n.reject(t)},_fromRelatedFieldName:function(n){var t=[];return-1!==n.indexOf(this._relatedFieldPrefix)&&(n=n.split("/"),t=n.slice(1)),t},_toRelatedFieldName:function(n){var t="";return n&&0<n.length&&(t=this._relatedFieldPrefix+n[0]+"/"+n[1]),t},_queryRelatedRecords:function(n,t){var r=n.getSourceLayer(),i=new p;return i.outFields=["*"],i.relationshipId=t.id,i.objectIds=[n.attributes[r.objectIdField]],r.queryRelatedFeatures(i)}}),f("extend-esri")&&(l.PopupInfo=l.PopupInfoTemplate=n),n})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var t=n.getObject("dojox.html.entities",!0),i=function(n,t){var u,i,r;if(t._encCache&&t._encCache.regexp&&t._encCache.mapper&&t.length==t._encCache.length)u=t._encCache.mapper,i=t._encCache.regexp;else{for(u={},i=["["],r=0;r<t.length;r++)u[t[r][0]]="&"+t[r][1]+";",i.push(t[r][0]);i.push("]");i=new RegExp(i.join(""),"g");t._encCache={mapper:u,regexp:i,length:t.length}}return n.replace(i,function(n){return u[n]})},r=function(n,t){var u,i,r,f;if(t._decCache&&t._decCache.regexp&&t._decCache.mapper&&t.length==t._decCache.length)u=t._decCache.mapper,i=t._decCache.regexp;else{for(u={},i=["("],r=0;r<t.length;r++)f="&"+t[r][1]+";",r&&i.push("|"),u[f]=t[r][0],i.push(f);i.push(")");i=new RegExp(i.join(""),"g");t._decCache={mapper:u,regexp:i,length:t.length}}return n.replace(i,function(n){return u[n]})};return t.html=[["&","amp"],['"',"quot"],["<","lt"],[">","gt"],["","nbsp"]],t.latin=[["","iexcl"],["","cent"],["","pound"],["","euro"],["","curren"],["","yen"],["","brvbar"],["","sect"],["","uml"],["","copy"],["","ordf"],["","laquo"],["","not"],["","shy"],["","reg"],["","macr"],["","deg"],["","plusmn"],["","sup2"],["","sup3"],["","acute"],["","micro"],["","para"],["","middot"],["","cedil"],["","sup1"],["","ordm"],["","raquo"],["","frac14"],["","frac12"],["","frac34"],["","iquest"],["","Agrave"],["","Aacute"],["","Acirc"],["","Atilde"],["","Auml"],["","Aring"],["","AElig"],["","Ccedil"],["","Egrave"],["","Eacute"],["","Ecirc"],["","Euml"],["","Igrave"],["","Iacute"],["","Icirc"],["","Iuml"],["","ETH"],["","Ntilde"],["","Ograve"],["","Oacute"],["","Ocirc"],["","Otilde"],["","Ouml"],["","times"],["","Oslash"],["","Ugrave"],["","Uacute"],["","Ucirc"],["","Uuml"],["","Yacute"],["","THORN"],["","szlig"],["","agrave"],["","aacute"],["","acirc"],["","atilde"],["","auml"],["","aring"],["","aelig"],["","ccedil"],["","egrave"],["","eacute"],["","ecirc"],["","euml"],["","igrave"],["","iacute"],["","icirc"],["","iuml"],["","eth"],["","ntilde"],["","ograve"],["","oacute"],["","ocirc"],["","otilde"],["","ouml"],["","divide"],["","oslash"],["","ugrave"],["","uacute"],["","ucirc"],["","uuml"],["","yacute"],["","thorn"],["","yuml"],["","fnof"],["","Alpha"],["","Beta"],["","Gamma"],["","Delta"],["","Epsilon"],["","Zeta"],["","Eta"],["","Theta"],["","Iota"],["","Kappa"],["","Lambda"],["","Mu"],["","Nu"],["","Xi"],["","Omicron"],["","Pi"],["","Rho"],["","Sigma"],["","Tau"],["","Upsilon"],["","Phi"],["","Chi"],["","Psi"],["","Omega"],["","alpha"],["","beta"],["","gamma"],["","delta"],["","epsilon"],["","zeta"],["","eta"],["","theta"],["","iota"],["","kappa"],["","lambda"],["","mu"],["","nu"],["","xi"],["","omicron"],["","pi"],["","rho"],["","sigmaf"],["","sigma"],["","tau"],["","upsilon"],["","phi"],["","chi"],["","psi"],["","omega"],["","thetasym"],["","upsih"],["","piv"],["","bull"],["","hellip"],["","prime"],["","Prime"],["","oline"],["","frasl"],["","weierp"],["","image"],["","real"],["","trade"],["","alefsym"],["","larr"],["","uarr"],["","rarr"],["","darr"],["","harr"],["","crarr"],["","lArr"],["","uArr"],["","rArr"],["","dArr"],["","hArr"],["","forall"],["","part"],["","exist"],["","empty"],["","nabla"],["","isin"],["","notin"],["","ni"],["","prod"],["","sum"],["","minus"],["","lowast"],["","radic"],["","prop"],["","infin"],["","ang"],["","and"],["","or"],["","cap"],["","cup"],["","int"],["","there4"],["","sim"],["","cong"],["","asymp"],["","ne"],["","equiv"],["","le"],["","ge"],["","sub"],["","sup"],["","nsub"],["","sube"],["","supe"],["","oplus"],["","otimes"],["","perp"],["","sdot"],["","lceil"],["","rceil"],["","lfloor"],["","rfloor"],["","lang"],["","rang"],["","loz"],["","spades"],["","clubs"],["","hearts"],["","diams"],["","OElig"],["","oelig"],["","Scaron"],["","scaron"],["","Yuml"],["","circ"],["","tilde"],["","ensp"],["","emsp"],["","thinsp"],["","zwnj"],["","zwj"],["","lrm"],["","rlm"],["","ndash"],["","mdash"],["","lsquo"],["","rsquo"],["","sbquo"],["","ldquo"],["","rdquo"],["","bdquo"],["","dagger"],["","Dagger"],["","permil"],["","lsaquo"],["","rsaquo"]],t.encode=function(n,r){return n&&(r?n=i(n,r):(n=i(n,t.html),n=i(n,t.latin))),n},t.decode=function(n,i){return n&&(i?n=r(n,i):(n=r(n,t.html),n=r(n,t.latin))),n},t})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var n={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},r=this.objectIds,u=this.outFields,t=this.outSpatialReference;return r&&(n.objectIds=r.join(",")),u&&(n.outFields=u.join(",")),t&&(n.outSR=t.wkid||i.toJson(t.toJson())),n._ts=this._ts,n}}),r("extend-esri")&&t.setObject("tasks.RelationshipQuery",n,u),n})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=0;return t=t([k,y,p],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},d.widgets.popup)},templateString:"<div class='esriViewPopup'><div class='mainSection'><div class='header' dojoAttachPoint='_title'><\/div><div class='hzLine'><\/div><div dojoAttachPoint='_description'><\/div><div class='break'><\/div><\/div><div class='attachmentsSection hidden'><div>${_nls.NLS_attach}:<\/div><ul dojoAttachPoint='_attachmentsList'><\/ul><div class='break'><\/div><\/div><div class='mediaSection hidden'><div class='header' dojoAttachPoint='_mediaTitle'><\/div><div class='hzLine'><\/div><div class='caption' dojoAttachPoint='_mediaCaption'><\/div><div class='gallery' dojoAttachPoint='_gallery'><div class='mediaHandle prev' dojoAttachPoint='_prevMedia' dojoAttachEvent='onclick: _goToPrevMedia'><\/div><div class='mediaHandle next' dojoAttachPoint='_nextMedia' dojoAttachEvent='onclick: _goToNextMedia'><\/div><ul class='summary'><li class='image mediaCount hidden' dojoAttachPoint='_imageCount'>0<\/li><li class='image mediaIcon hidden'><\/li><li class='chart mediaCount hidden' dojoAttachPoint='_chartCount'>0<\/li><li class='chart mediaIcon hidden'><\/li><\/ul><div class='frame' dojoAttachPoint='_mediaFrame'><\/div><\/div><\/div><div class='editSummarySection hidden' dojoAttachPoint='_editSummarySection'><div class='break'><\/div><div class='break hidden' dojoAttachPoint='_mediaBreak'><\/div><div class='editSummary' dojoAttachPoint='_editSummary'><\/div><\/div><\/div>",showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess),r.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var n=this._mediaInfos,s=n.length,r=this.domNode,e=this._prevMedia,o=this._nextMedia,t,i;1<s?(t=0,i=0,u.forEach(n,function(n){"image"===n.type?t++:-1!==n.type.indexOf("chart")&&i++}),t&&(h.set(this._imageCount,"innerHTML",t),f.query(".summary .image",r).removeClass("hidden")),i&&(h.set(this._chartCount,"innerHTML",i),f.query(".summary .chart",r).removeClass("hidden"))):(f.query(".summary",r).addClass("hidden"),c.add(e,"hidden"),c.add(o,"hidden"));n=this._mediaPtr;0===n?c.add(e,"hidden"):c.remove(e,"hidden");n===s-1?c.add(o,"hidden"):c.remove(o,"hidden");this._destroyFrame()},_displayMedia:function(){var i=this._mediaInfos[this._mediaPtr],u=i.title,t=i.caption,s=f.query(".mediaSection .hzLine",this.domNode)[0],o;if(h.set(this._mediaTitle,"innerHTML",u),c[u?"remove":"add"](this._mediaTitle,"hidden"),h.set(this._mediaCaption,"innerHTML",t),c[t?"remove":"add"](this._mediaCaption,"hidden"),c[u&&t?"remove":"add"](s,"hidden"),this._rid=null,"image"===i.type)this._showImage(i.value);else{var e=this,u=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],t=i.value.theme||this.chartTheme;r.isString(t)&&(t=t.replace(/\./gi,"/"),-1===t.indexOf("/")&&(t="dojox/charting/themes/"+t));t||(t="./Rainbow");u.push(t);try{o=this._rid=g++;n(u,function(n,t,r){o===e._rid&&(e._rid=null,e._showChart(i.type,i.value,n,t,r))})}catch(l){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(n){return(n=n&&r.trim(n).toLowerCase())&&(0===n.indexOf("mailto:")||0===n.indexOf("tel:"))},_showImage:function(n){var u,e,t,o,r;c.add(this._mediaFrame,"image");u=a.get(this._gallery,"height");n.linkURL&&(e=l.create("a",{href:n.linkURL,target:this._preventNewTab(n.linkURL)?"":"_blank"},this._mediaFrame));l.create("img",{className:"esriPopupMediaImage",src:n.sourceURL},e||this._mediaFrame);t=f.query(".esriPopupMediaImage",this._mediaFrame)[0];o=this;r=i.connect(t,"onload",function(){i.disconnect(r);r=null;o._imageLoaded(t,u)})},_showChart:function(n,t,i,r,f){c.remove(this._mediaFrame,"image");i=this._chart=new i(l.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});f&&i.setTheme(f);switch(n){case"piechart":i.addPlot("default",{type:"Pie",labels:!1});i.addSeries("Series A",t.fields);break;case"linechart":i.addPlot("default",{type:"Markers"});i.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});i.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});u.forEach(t.fields,function(n,t){n.x=t+1});i.addSeries("Series A",t.fields);break;case"columnchart":i.addPlot("default",{type:"Columns",gap:3});i.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});i.addSeries("Series A",t.fields);break;case"barchart":i.addPlot("default",{type:"Bars",gap:3});i.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1});i.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});i.addSeries("Series A",t.fields)}this._action=new r(i);i.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);h.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(n,t){var i=n.height;i<t&&a.set(n,"marginTop",Math.round((t-i)/2)+"px")},_attListHandler:function(n,t){if(n===this._dfd){this._dfd=null;var i="";t instanceof Error||!t||!t.length||u.forEach(t,function(n){i+="<li>";i+="<a href='"+b.addProxy(n.url)+"' target='_blank'>"+(n.name||"[No name]")+"<\/a>";i+="<\/li>"});h.set(this._attachmentsList,"innerHTML",i||"<li>"+this._nls.NLS_noAttach+"<\/li>")}},_handleComponentsSuccess:function(n){if(n){var i=this.showTitle?n.title:"",t=n.description,a=n.fields,e=n.mediaInfos,o=this.domNode,l=this._nls,y=this,p=this.template,w=this.graphic;this._prevMedia.title=l.NLS_prevMedia;this._nextMedia.title=l.NLS_nextMedia;h.set(this._title,"innerHTML",i);i||c.add(this._title,"hidden");!n.hasDescription&&a&&(t="",u.forEach(a,function(n){t+="<tr valign='top'>";t+="<td class='attrName'>"+v.encode(n[0])+"<\/td>";t+="<td class='attrValue'>"+n[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"<a target='_blank' href='$1' title='$1'>"+l.NLS_moreInfo+"<\/a>")+"<\/td>";t+="<\/tr>"}),t&&(t="<table class='attrTable' cellpadding='0px' cellspacing='0px'>"+t+"<\/table>"));h.set(this._description,"innerHTML",t);t||c.add(this._description,"hidden");f.query("a",this._description).forEach(function(n){y._preventNewTab(n.href)?"_blank"===n.target&&h.remove(n,"target"):h.set(n,"target","_blank")});i&&t?f.query(".mainSection .hzLine",o).removeClass("hidden"):i||t?f.query(".mainSection .hzLine",o).addClass("hidden"):f.query(".mainSection",o).addClass("hidden");(i=this._dfd=p.getAttachments(w))&&(i.addBoth(r.hitch(this,this._attListHandler,i)),h.set(this._attachmentsList,"innerHTML","<li>"+l.NLS_searching+"...<\/li>"),f.query(".attachmentsSection",o).removeClass("hidden"));e&&e.length&&(f.query(".mediaSection",o).removeClass("hidden"),s.setSelectable(this._mediaFrame,!1),this._mediaInfos=e,this._mediaPtr=0,this._updateUI(),this._displayMedia());n.editSummary&&(h.set(this._editSummary,"innerHTML",n.editSummary),e&&e.length&&c.remove(this._mediaBreak,"hidden"),c.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(n){console.log("PopupRenderer: error loading template",n)}}),e("extend-esri")&&r.setObject("dijit._PopupRenderer",t,w),t})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){}function y(n){return function(t,r,u,f){return t&&"string"==typeof r&&t[r]==v?t.on(r.substring(2).toLowerCase(),e.hitch(u,f)):n.apply(i,arguments)}}return n.around(i,"connect",y),f.connect&&n.around(f,"connect",y),n=r("dijit._Widget",[c,l,a],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(n){this._toConnect={};for(var t in n)this[t]===v&&(this._toConnect[t.replace(/^on/,"").toLowerCase()]=n[t],delete n[t])},postCreate:function(){this.inherited(arguments);for(var n in this._toConnect)this.on(n,this._toConnect[n]);delete this._toConnect},on:function(n,t){return this[this._onMap(n)]===v?i.connect(this.domNode,n.toLowerCase(),this,t):this.inherited(arguments)},_setFocusedAttr:function(n){this._focused=n;this._set("focused",n)},setAttribute:function(n,t){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(n,t)},attr:function(n){return 2<=arguments.length||"object"==typeof n?this.set.apply(this,arguments):this.get(n)},getDescendants:function(){return f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0"),this.containerNode?o("[widgetId]",this.containerNode).map(h.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}}),u("dijit-legacy-requires")&&s(0,function(){require(["dijit/_base"])}),n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){function it(n){return function(t){o[t?"set":"remove"](this.domNode,n,t);this._set(n,t)}}a.add("dijit-legacy-requires",!v.isAsync);a.add("dojo-bidi",!1);a("dijit-legacy-requires")&&w(0,function(){n(["dijit/_base/manager"])});var rt={};return r=f("dijit._WidgetBase",[b,g],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:it("lang"),dir:"",_setDirAttr:it("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(n){this._set("ownerDocument",n)},attributeMap:{},_blankGif:r.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var t=this.constructor;if(!t._setterAttrs){var i=t.prototype,r=t._setterAttrs=[],t=t._onMap={};for(var n in i.attributeMap)r.push(n);for(n in i)/^on/.test(n)&&(t[n.substring(2).toLowerCase()]=n),/^_set[A-Z](.*)Attr$/.test(n)&&(n=n.charAt(4).toLowerCase()+n.substr(5,n.length-9),i.attributeMap&&n in i.attributeMap||r.push(n))}},postscript:function(n,t){this.create(n,t)},create:function(n,t){var r,i;this._introspect();this.srcNodeRef=e.byId(t);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);n&&(this.params=n,y.mixin(this,n));this.postMixInProperties();this.id||(this.id=tt.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=d.body(this.ownerDocument);tt.add(this);this.buildRendering();this.domNode&&(this._applyAttributes(),i=this.srcNodeRef,i&&i.parentNode&&this.domNode!==i&&(i.parentNode.replaceChild(this.domNode,i),r=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();r&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var i={};for(var n in this.params||{})i[n]=this._get(n);t.forEach(this.constructor._setterAttrs,function(n){if(!(n in i)){var t=this._get(n);t&&this.set(n,t)}},this);for(n in i)this.set(n,i[n])},postMixInProperties:function(){},buildRendering:function(){if(this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div")),this.baseClass){var n=this.baseClass.split(" ");this.isLeftToRight()||(n=n.concat(t.map(n,function(n){return n+"Rtl"})));s.add(this.domNode,n)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,t.forEach(this.getChildren(),function(n){n._started||n._destroyed||!y.isFunction(n.startup)||(n.startup(),n._started=!0)}))},destroyRecursive:function(n){this._beingDestroyed=!0;this.destroyDescendants(n);this.destroy(n)},destroy:function(n){function i(t){t.destroyRecursive?t.destroyRecursive(n):t.destroy&&t.destroy(n)}this._beingDestroyed=!0;this.uninitialize();t.forEach(this._connects,y.hitch(this,"disconnect"));t.forEach(this._supportingWidgets,i);this.domNode&&t.forEach(tt.findWidgets(this.domNode,this.containerNode),i);this.destroyRendering(n);tt.remove(this.id);this._destroyed=!0},destroyRendering:function(n){this.bgIframe&&(this.bgIframe.destroy(n),delete this.bgIframe);this.domNode&&(n?o.remove(this.domNode,"widgetId"):h.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(n||h.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(n){t.forEach(this.getChildren(),function(t){t.destroyRecursive&&t.destroyRecursive(n)})},uninitialize:function(){return!1},_setStyleAttr:function(n){var t=this.domNode;y.isObject(n)?l.set(t,n):t.style.cssText=t.style.cssText?t.style.cssText+("; "+n):n;this._set("style",n)},_attrToDom:function(n,i,r){r=3<=arguments.length?r:this.attributeMap[n];t.forEach(y.isArray(r)?r:[r],function(t){var r=this[t.node||t||"domNode"];switch(t.type||"attribute"){case"attribute":y.isFunction(i)&&(i=y.hitch(this,i));t=t.attribute?t.attribute:/^on[A-Z][a-zA-Z]*$/.test(n)?n.toLowerCase():n;r.tagName?o.set(r,t,i):r.set(t,i);break;case"innerText":r.innerHTML="";r.appendChild(this.ownerDocument.createTextNode(i));break;case"innerHTML":r.innerHTML=i;break;case"class":s.replace(r,i,this[n]);break;case"toggleClass":s.toggle(r,t.className||n,i)}},this)},get:function(n){var t=this._getAttrNames(n);return this[t.g]?this[t.g]():this._get(n)},set:function(n,t){var i,s,r,e,u,o,f;if("object"==typeof n){for(i in n)this.set(i,n[i]);return this}if(i=this._getAttrNames(n),r=this[i.s],y.isFunction(r))s=r.apply(this,Array.prototype.slice.call(arguments,1));else{if(r=this.focusNode&&!y.isFunction(this.focusNode)?"focusNode":"domNode",e=this[r]&&this[r].tagName,(u=e)&&!(u=rt[e])){u=this[r];o={};for(f in u)o[f.toLowerCase()]=!0;u=rt[e]=o}f=u;i=n in this.attributeMap?this.attributeMap[n]:i.s in this?this[i.s]:f&&i.l in f&&"function"!=typeof t||/^aria-|^data-|^role$/.test(n)?r:null;null!=i&&this._attrToDom(n,t,i);this._set(n,t)}return s||this},_attrPairNames:{},_getAttrNames:function(n){var i=this._attrPairNames,t;return i[n]?i[n]:(t=n.replace(/^[a-z]|-[a-zA-Z]/g,function(n){return n.charAt(n.length-1).toUpperCase()}),i[n]={n:n+"Node",s:"_set"+t+"Attr",g:"_get"+t+"Attr",l:t.toLowerCase()})},_set:function(n,t){var i=this[n];this[n]=t;this._created&&i!==t&&(i===i||t===t)&&(this._watchCallbacks&&this._watchCallbacks(n,i,t),this.emit("attrmodified-"+n,{detail:{prevValue:i,newValue:t}}))},_get:function(n){return this[n]},emit:function(n,t,i){t=t||{};void 0===t.bubbles&&(t.bubbles=!0);void 0===t.cancelable&&(t.cancelable=!0);t.detail||(t.detail={});t.detail.widget=this;var r,u=this["on"+n];return u&&(r=u.apply(this,i?i:[t])),this._started&&!this._beingDestroyed&&p.emit(this.domNode,n.toLowerCase(),t),r},on:function(n,t){var r=this._onMap(n);return r?i.after(this,r,t,!0):this.own(p(this.domNode,n,t))[0]},_onMap:function(n){var r=this.constructor,t=r._onMap,i;if(!t){t=r._onMap={};for(i in r.prototype)/^on/.test(i)&&(t[i.replace(/^on/,"").toLowerCase()]=i)}return t["string"==typeof n&&n.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?tt.findWidgets(this.containerNode):[]},getParent:function(){return tt.getEnclosingWidget(this.domNode.parentNode)},connect:function(n,t,i){return this.own(u.connect(n,t,this,i))[0]},disconnect:function(n){n.remove()},subscribe:function(n,t){return this.own(k.subscribe(n,y.hitch(this,t)))[0]},unsubscribe:function(n){n.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=l.get(this.domNode,"display")},placeAt:function(n,t){var i=!n.tagName&&tt.byId(n);return!i||!i.addChild||t&&"number"!=typeof t?(i=i&&"domNode"in i?i.containerNode&&!/after|before|replace/.test(t||"")?i.containerNode:i.domNode:e.byId(n,this.ownerDocument),h.place(this.domNode,i,t),!this._started&&(this.getParent()||{})._started&&this.startup()):i.addChild(this,t),this},defer:function(n,t){var i=setTimeout(y.hitch(this,function(){i&&(i=null,this._destroyed||y.hitch(this,n)())}),t||0);return{remove:function(){return i&&(clearTimeout(i),i=null),null}}}}),a("dojo-bidi")&&r.extend(nt),r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,t,i){return i("dijit.Destroyable",null,{destroy:function(){this._destroyed=!0},own:function(){var i=["destroyRecursive","destroy","remove"];return n.forEach(arguments,function(r){function f(){o.remove();n.forEach(e,function(n){n.remove()})}var u,o=t.before(this,"destroy",function(n){r[u](n)}),e=[];r.then?(u="cancel",r.then(f,f)):n.forEach(i,function(n){"function"==typeof r[n]&&(u||(u=n),e.push(t.after(r,n,f,!0)))})},this),arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,t,i,r,u,f){return n=r("dijit._OnDijitClickMixin",null,{connect:function(n,t,i){return this.inherited(arguments,[n,"ondijitclick"==t?f:t,i])}}),n.a11yclick=f,n})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(n,t,i,r){return r.extend(t,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}}),i("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,t,i,r){return i(function(){t("highcontrast")&&n.add(r.body(),"dijit_a11y")}),t})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(n,t,i,r,u,f,e){return u.add("highcontrast",function(){var i=e.doc.createElement("div"),f,o;try{return i.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(t.blankGif||n.toUrl("./resources/blank.gif"))+'");',e.body().appendChild(i),f=r.getComputedStyle(i),o=f.backgroundImage,f.borderTopColor==f.borderRightColor||o&&("none"==o||"url(invalid-url:)"==o)}catch(s){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+s.toString()),!1}finally{8>=u("ie")?i.outerHTML="":e.body().removeChild(i)}}),f(function(){u("highcontrast")&&i.add(e.body(),"dj_a11y")}),u})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(n,t,i,r,u,f,e){return f.extend(n,{waiRole:"",waiState:""}),u("dijit._Templated",[t,i],{constructor:function(){e.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(n,t){var u=this.inherited(arguments),i=t(n,"waiRole");return i&&n.setAttribute("role",i),(i=t(n,"waiState"))&&r.forEach(i.split(/\s*,\s*/),function(t){-1!=t.indexOf("-")&&(t=t.split("-"),n.setAttribute("aria-"+t[0],t[1]))}),u}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,t,i,r,u,f,e,o){var s=t("dijit._TemplatedMixin",o,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(n){var t=this.declaredClass,i=this;return e.substitute(n,this,function(n,u){if("!"==u.charAt(0)&&(n=r.getObject(u.substr(1),!1,i)),"undefined"==typeof n)throw Error(t+" template:"+u);return null==n?"":"!"==u.charAt(0)?n:this._escapeValue(""+n)},this)},_escapeValue:function(n){return n.replace(/["'<>&]/g,function(n){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}[n]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=n(this.templatePath,{sanitize:!0}));var t=s.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),u;if(r.isString(t)){if(u=i.toDom(this._stringRepl(t),this.ownerDocument),1!=u.nodeType)throw Error("Invalid template: "+t);}else u=t.cloneNode(!0);this.domNode=u}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(n){var t=this.containerNode;if(n&&t)for(;n.hasChildNodes();)t.appendChild(n.firstChild)}});return s._templateCache={},s.getCachedTemplate=function(n,t,r){var f=s._templateCache,o=n,u=f[o];if(u){try{if(!u.ownerDocument||u.ownerDocument==(r||document))return u}catch(h){}i.destroy(u)}if(n=e.trim(n),t||n.match(/\$\{([^\}]+)\}/g))return f[o]=n;if(t=i.toDom(n,r),1!=t.nodeType)throw Error("Invalid template: "+n);return f[o]=t},f("ie")&&u(window,"unload",function(){var n=s._templateCache,t,r;for(t in n)r=n[t],"object"==typeof r&&i.destroy(r),delete n[t]}),s})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(n){return n.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,t,i,r,u,f,e,o,s){var c=u.delegate(o,{mouseenter:f.enter,mouseleave:f.leave,keypress:i._keypress}),h;return i=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(n){for(var t=n;;)if(1==t.nodeType&&(this._processTemplateNode(t,function(n,t){return n.getAttribute(t)},this._attach)||this.searchContainerNode)&&t.firstChild)t=t.firstChild;else{if(t==n)break;for(;!t.nextSibling;)if(t=t.parentNode,t==n)return;t=t.nextSibling}},_processTemplateNode:function(n,t,i){var s=!0,o=this.attachScope||this,r=t(n,"dojoAttachPoint")||t(n,"data-dojo-attach-point"),e,f;if(r)for(e=r.split(/\s*,\s*/);r=e.shift();)u.isArray(o[r])?o[r].push(n):o[r]=n,s="containerNode"!=r,this._attachPoints.push(r);if(t=t(n,"dojoAttachEvent")||t(n,"data-dojo-attach-event"))for(r=t.split(/\s*,\s*/),e=u.trim;t=r.shift();)t&&(f=null,-1!=t.indexOf(":")?(f=t.split(":"),t=e(f[0]),f=e(f[1])):t=e(t),f||(f=t),this._attachEvents.push(i(n,t,u.hitch(o,f))));return s},_attach:function(t,i,r){return i=i.replace(/^on/,"").toLowerCase(),i="dijitclick"==i?h||(h=n("./a11yclick")):c[i]||i,e(t,i,r)},_detachTemplateNodes:function(){var n=this.attachScope||this;t.forEach(this._attachPoints,function(t){delete n[t]});this._attachPoints=[];t.forEach(this._attachEvents,function(n){n.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}}),u.extend(s,{dojoAttachEvent:"",dojoAttachPoint:""}),i})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,t,i,r,u){return i("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var n=this.domNode;if(this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0),u.parse(n,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(n){this._startupWidgets=n;for(var t=0;t<n.length;t++)this._processTemplateNode(n[t],function(n,t){return n[t]},function(n,t,i){return t in n?n.connect(n,t,i):n.on(t,i,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser})),!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(n,t){return t(n,"dojoType")||t(n,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,function(n){n&&!n._started&&n.startup&&n.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function k(n){return eval("("+n+")")}function g(n){var t=n._nameCaseMap,r=n.prototype,i;if(!t||t._extendCnt<w){t=n._nameCaseMap={};for(i in r)"_"!==i.charAt(0)&&(t[i.toLowerCase()]=i);t._extendCnt=w}return t}function d(t,r){var f,s,o;if(r||(r=n),f=r._dojoParserCtorMap||(r._dojoParserCtorMap={}),s=t.join(),!f[s]){for(var e=[],u=0,h=t.length;u<h;u++)o=t[u],e[e.length]=f[o]=f[o]||i.getObject(o)||~o.indexOf("/")&&r(o);u=e.shift();f[s]=e.length?u.createSubclass?u.createSubclass(e):u.extend.apply(u,e):u}return f[s]}var w,b;return new Date("X"),w=0,s.after(i,"extend",function(){w++},!0),b={_clearCache:function(){w++;_ctorMap={}},_functionFromScript:function(n,t){var u="",f="",e=n.getAttribute(t+"args")||n.getAttribute("args"),i=n.getAttribute("with"),e=(e||"").split(/\s*,\s*/);return i&&i.length&&r.forEach(i.split(/\s*,\s*/),function(n){u+="with("+n+"){";f+="}"}),new Function(e,u+n.innerHTML+f)},instantiate:function(n,i,u){i=i||{};u=u||{};var f=(u.scope||t._scopeName)+"Type",e="data-"+(u.scope||t._scopeName)+"-",s=e+"type",h=e+"mixins",o=[];return r.forEach(n,function(n){var t=f in i?i[f]:n.getAttribute(s)||n.getAttribute(f),r;t&&(r=n.getAttribute(h),t=r?[t].concat(r.split(/\s*,\s*/)):[t],o.push({node:n,types:t}))}),this._instantiate(o,i,u)},_instantiate:function(n,t,i,u){function f(n){return t._started||i.noStart||r.forEach(n,function(n){"function"!=typeof n.startup||n._started||n.startup()}),n}return n=r.map(n,function(n){var r=n.ctor||d(n.types,i.contextRequire);if(!r)throw Error("Unable to resolve constructor for: '"+n.types.join()+"'");return this.construct(r,n.node,t,i,n.scripts,n.inherited)},this),u?h(n).then(f):f(n)},construct:function(n,u,f,e,h,l){function lt(n){for(ht&&i.setObject(ht,n),w=0;w<et.length;w++)s[et[w].advice||"after"](n,et[w].method,i.hitch(n,et[w].func),!0);for(w=0;w<ct.length;w++)ct[w].call(n);for(w=0;w<ot.length;w++)n.watch(ot[w].prop,ot[w].func);for(w=0;w<st.length;w++)y(n,st[w].event,st[w].func);return n}var ft=n&&n.prototype,d,tt,p,w,b,it,ht,ut,nt,rt;for(e=e||{},d={},e.defaults&&i.mixin(d,e.defaults),l&&i.mixin(d,l),a("dom-attributes-explicit")?tt=u.attributes:a("dom-attributes-specified-flag")?tt=r.filter(u.attributes,function(n){return n.specified}):(l=(/^input$|^img$/i.test(u.nodeName)?u:u.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),tt=r.map(l.split(/\s+/),function(n){var t=n.toLowerCase();return{name:n,value:"LI"==u.nodeName&&"value"==n||"enctype"==t?u.getAttribute(t):u.getAttributeNode(t).value}})),it=e.scope||t._scopeName,l="data-"+it+"-",p={},"dojo"!==it&&(p[l+"props"]="data-dojo-props",p[l+"type"]="data-dojo-type",p[l+"mixins"]="data-dojo-mixins",p[it+"type"]="dojotype",p[l+"id"]="data-dojo-id"),w=0,it=[];b=tt[w++];){nt=b.name;rt=nt.toLowerCase();b=b.value;switch(p[rt]||rt){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":ut=b;break;case"data-dojo-id":case"jsid":ht=b;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=b;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=b;break;case"class":d["class"]=u.className;break;case"style":d.style=u.style&&u.style.cssText;break;default:if(nt in ft||(nt=g(n)[rt]||nt),nt in ft)switch(typeof ft[nt]){case"string":d[nt]=b;break;case"number":d[nt]=b.length?Number(b):NaN;break;case"boolean":d[nt]="false"!=b.toLowerCase();break;case"function":d[nt]=""===b||-1!=b.search(/[^\w\.]+/i)?new Function(b):i.getObject(b,!1)||new Function(b);it.push(nt);break;default:rt=ft[nt];d[nt]=rt&&"length"in rt?b?b.split(/\s*,\s*/):[]:rt instanceof Date?""==b?new Date(""):"now"==b?new Date:c.fromISOString(b):rt instanceof o?t.baseUrl+b:k(b)}else d[nt]=b}}for(tt=0;tt<it.length;tt++)p=it[tt].toLowerCase(),u.removeAttribute(p),u[p]=null;if(ut)try{ut=k.call(e.propsThis,"{"+ut+"}");i.mixin(d,ut)}catch(at){throw Error(at.toString()+" in data-dojo-props='"+ut+"'");}i.mixin(d,f);h||(h=n&&(n._noScript||ft._noScript)?[]:v("> script[type^='dojo/']",u));var et=[],ct=[],ot=[],st=[];if(h)for(w=0;w<h.length;w++)p=h[w],u.removeChild(p),f=p.getAttribute(l+"event")||p.getAttribute("event"),e=p.getAttribute(l+"prop"),ut=p.getAttribute(l+"method"),it=p.getAttribute(l+"advice"),tt=p.getAttribute("type"),p=this._functionFromScript(p,l),f?"dojo/connect"==tt?et.push({method:f,func:p}):"dojo/on"==tt?st.push({event:f,func:p}):d[f]=p:"dojo/aspect"==tt?et.push({method:ut,advice:it,func:p}):"dojo/watch"==tt?ot.push({prop:e,func:p}):ct.push(p);return n=(h=n.markupFactory||ft.markupFactory)?h(d,u,n):new n(d,u),n.then?n.then(lt):lt(n)},scan:function(i,u){function g(n){if(!n.inherited){n.inherited={};var t=n.node,i=g(n.parent),t={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(tt)||i.textDir};for(var r in t)t[r]&&(n.inherited[r]=t[r])}return n.inherited}var k=[],y=[],nt={},it=(u.scope||t._scopeName)+"Type",w="data-"+(u.scope||t._scopeName)+"-",rt=w+"type",tt=w+"textdir",w=w+"mixins",f=i.firstChild,e=u.inherited,p,h,s,o,c,v,b;if(!e){p=function(n,t){return n.getAttribute&&n.getAttribute(t)||n.parentNode&&p(n.parentNode,t)};e={dir:p(i,"dir"),lang:p(i,"lang"),textDir:p(i,tt)};for(h in e)e[h]||delete e[h]}for(e={inherited:e};;)if(f)if(1!=f.nodeType)f=f.nextSibling;else if(s&&"script"==f.nodeName.toLowerCase())(c=f.getAttribute("type"))&&/^dojo\/\w/i.test(c)&&s.push(f),f=f.nextSibling;else if(o)f=f.nextSibling;else if(c=f.getAttribute(rt)||f.getAttribute(it),h=f.firstChild,c||h&&(3!=h.nodeType||h.nextSibling)){if(o=null,c){v=f.getAttribute(w);s=v?[c].concat(v.split(/\s*,\s*/)):[c];try{o=d(s,u.contextRequire)}catch(ut){}o||r.forEach(s,function(n){~n.indexOf("/")&&!nt[n]&&(nt[n]=!0,y[y.length]=n)});v=o&&!o.prototype._noScript?[]:null;e={types:s,ctor:o,parent:e,node:f,scripts:v};e.inherited=g(e);k.push(e)}else e={node:f,scripts:s,parent:e};s=v;o=f.stopParser||o&&o.prototype.stopParser&&!u.template;f=h}else f=f.nextSibling;else{if(!e||!e.node)break;f=e.node.nextSibling;o=!1;e=e.parent;s=e.scripts}return b=new l,y.length?(a("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+y.join(", ")),(u.contextRequire||n)(y,function(){b.resolve(r.filter(k,function(n){var t,i;if(!n.ctor)try{n.ctor=d(n.types,u.contextRequire)}catch(r){}for(t=n.parent;t&&!t.types;)t=t.parent;return i=n.ctor&&n.ctor.prototype,n.instantiateChildren=!(i&&i.stopParser&&!u.template),n.instantiate=!t||t.instantiate&&t.instantiateChildren,n.instantiate}))})):b.resolve(k),b.promise},_require:function(t,r){var f=k("{"+t.innerHTML+"}"),u=[],e=[],o=new l,h=r&&r.contextRequire||n;for(var s in f)u.push(s),e.push(f[s]);return h(e,function(){for(var n=0;n<u.length;n++)i.setObject(u[n],arguments[n]);o.resolve(arguments)}),o.promise},_scanAmd:function(n,t){var r=new l,i=r.promise,u;return r.resolve(!0),u=this,v("script[type='dojo/require']",n).forEach(function(n){i=i.then(function(){return u._require(n,t)});n.parentNode.removeChild(n)}),i},parse:function(n,t){var u;!n||"string"==typeof n||"nodeType"in n||(t=n,n=t.rootNode);u=n?f.byId(n):e.body();t=t||{};var s=t.template?{template:!0}:{},r=[],o=this,h=this._scanAmd(u,t).then(function(){return o.scan(u,t)}).then(function(n){return o._instantiate(n,s,t,!0)}).then(function(n){return r=r.concat(n)}).otherwise(function(n){console.error("dojo/parser::parse() error",n);throw n;});return i.mixin(r,h),r}},t.parser=b,u.parseOnLoad&&p(100,b,"parse"),b})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,t){var i={};return n.setObject("dojo.date.stamp",i),i.fromISOString=function(n,r){var u,f,e,o;return i._isoRegExp||(i._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/),u=i._isoRegExp.exec(n),f=null,u&&(u.shift(),u[1]&&u[1]--,u[6]&&(u[6]*=1e3),r&&(r=new Date(r),t.forEach(t.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(n){return r["get"+n]()}),function(n,t){u[t]=u[t]||n})),f=new Date(u[0]||1970,u[1]||0,u[2]||1,u[3]||0,u[4]||0,u[5]||0,u[6]||0),100>u[0]&&f.setFullYear(u[0]||1970),e=0,o=u[7]&&u[7].charAt(0),"Z"!=o&&(e=60*(u[8]||0)+(Number(u[9])||0),"-"!=o&&(e*=-1)),o&&(e-=f.getTimezoneOffset()),e&&f.setTime(f.getTime()+6e4*e)),f},i.toISOString=function(n,t){var u=function(n){return 10>n?"0"+n:n};t=t||{};var f=[],i=t.zulu?"getUTC":"get",r="";if("time"!=t.selector&&(r=n[i+"FullYear"](),r=["0000".substr((r+"").length)+r,u(n[i+"Month"]()+1),u(n[i+"Date"]())].join("-")),f.push(r),"date"!=t.selector){if(r=[u(n[i+"Hours"]()),u(n[i+"Minutes"]()),u(n[i+"Seconds"]())].join(":"),i=n[i+"Milliseconds"](),t.milliseconds&&(r+="."+(100>i?"0":"")+u(i)),t.zulu)r+="Z";else if("time"!=t.selector)var i=n.getTimezoneOffset(),e=Math.abs(i),r=r+((0<i?"-":"+")+u(Math.floor(e/60))+":"+u(e%60));f.push(r)}return f.join("T")},i})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(n,t,i,r,u,f){return n([f,u],{_onMap:function(n){var t=this.constructor._onMap,i;return t&&t.FINAL||(delete this.constructor._onMap,t=this.registerConnectEvents(),t.FINAL=!0),n=n.toLowerCase(),t[n]?i=this[t[n].method]:(n=this._onCamelCase(n),this[n]&&(i=n)),i},on:function(n,t){var u=this._onMap(n),i=n.replace(/\-/g,""),f="on"+i in this.domNode;return u||!f?this.inherited(arguments):this.own(r(this.domNode,i,t))[0]},emit:function(n,i){var e,o,r,u=n.toLowerCase(),f=this.constructor._onMap||this.registerConnectEvents();return o=this[this._onMap(u)],i=i||{},i.target||(i.target=this),o&&f&&f[u]&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},f[u].argKeys)(i),r=t.mixin({},arguments),r[2]=e,r[0]=f[u].name.replace(/^on/,"")),this.inherited(r||arguments)}})})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","esri/lang","dojo/i18n!../../nls/jsapi"],function(n,t,i){var r=i.widgets.legend;return{getVisualVariableTitle:function(i,u){var s,e=i.field,o=i.normalizationField,h=!1,a=!1,v=!1,c,e=n.isFunction(e)?null:e,o=n.isFunction(o)?null:o,l,f;if(i.legendOptions&&i.legendOptions.title)s=i.legendOptions.title;else if(i.valueExpressionTitle)s=i.valueExpressionTitle;else{if(u.renderer&&u.renderer.authoringInfo&&u.renderer.authoringInfo.visualVariables)for(l=u.renderer.authoringInfo.visualVariables,c=0;c<l.length;c++)if(f=l[c],"colorInfo"===f.type&&"ratio"===f.style){h=!0;break}else if("colorInfo"===f.type&&"percent"===f.style){a=!0;break}else if("colorInfo"===f.type&&"percentTotal"===f.style){v=!0;break}(h=v&&"showRatioPercentTotal"||a&&"showRatioPercent"||h&&"showRatio"||o&&"showNormField"||e&&"showField"||null)&&(s=t.substitute({field:e&&u.getFieldLabel(e),normField:o&&u.getFieldLabel(o)},r[h]))}return s},getRendererTitle:function(){}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/mathUtils ./geohashUtils".split(" "),function(n,t,i,r,u,f,e,o,s){return t=t(f,{loaded:!1,map:null,layer:null,lod:null,tolerance:null,maxLod:null,clusterMode:null,clusterSize:null,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterSize:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_maxGeohashLength:12,_minClusterSize:15,_active:!1,_levelChange:!0,_modeChange:!1,constructor:function(n){this._update=i.hitch(this,this._update);this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=n.map;this.layer=n.layer;this.setLod(n.lod);this.setTolerance(n.tolerance);this.setClusterMode(n.clusterMode);this.setClusterSize(n.clusterSize);this.setSortEnabled(n.sortEnabled);this.setFilterEnabled(n.filterEnabled);this.setBufferEnabled(n.bufferEnabled);this.setUpdateEnabled(n.updateEnabled);this.setStatisticInfos(n.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",i.hitch(this,this._startup)))},destroy:function(){this._displayFeatures(!0);r.forEach(this._eventHandles,function(n){n.remove()});clearTimeout(this._updateHandle);this._cellIndex=this._globalIndex=this._eventHandles=this._updateHandle=this.map=this.layer=this.clusters=null},setLod:function(n){var t=this.lod;this.lod=n||this.defaults.lod;t!==this.lod&&this.update()},setTolerance:function(n){var t=this.tolerance;this.tolerance=n||this.defaults.tolerance;t!==this.tolerance&&this.update()},setClusterMode:function(n){var t=this.clusterMode;this.clusterMode=n||this.defaults.clusterMode;this._evalClusterParams();t!==this.clusterMode&&this.update()},setClusterSize:function(n){var t=this.clusterSize;this.clusterSize=null!=n?n:this.defaults.clusterSize;this._evalClusterParams();t!==this.clusterSize&&this.update()},setSortEnabled:function(n){var t=this.sortEnabled;this.sortEnabled=null!=n?!!n:this.defaults.sortEnabled;t!==this.sortEnabled&&this.update()},setFilterEnabled:function(n){var t=this.filterEnabled;this.filterEnabled=null!=n?!!n:this.defaults.filterEnabled;t!==this.filterEnabled&&this.update()},setBufferEnabled:function(n){var t=this.bufferEnabled;this.bufferEnabled=null!=n?!!n:this.defaults.bufferEnabled;t!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(n){var t=this.updateEnabled;(this.updateEnabled=null!=n?!!n:this.defaults.updateEnabled)&&t!==this.updateEnabled&&this.update()},setStatisticInfos:function(n){this.statisticInfos=n||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&(this._updateHandle=setTimeout(this._update,0))},isUpdateScheduled:function(){return null!=this._updateHandle},getCell:function(n){return this._cellIndex[n.length][n]},getCluster:function(n){var t;return r.some(this.clusters,function(i){return-1<r.indexOf(i.geohashes,n)&&(t=i),!!t}),t},getCellsInCluster:function(n){var t=[];return r.forEach(n&&n.geohashes,function(n){(n=this.getCell(n))&&t.push(n)},this),t},getCurrentLodStats:function(){var n=this._globalIndex.lodStats;return n&&n[this.lod]},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",i.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",i.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){var n,t;this.map.loaded&&this.layer.loaded&&("esriGeometryPoint"!==this.layer.geometryType?n=Error("GeohashAggregation is supported only for points"):(t=this.map.spatialReference,t.isWebMercator()||4326===t.wkid||(n=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))),n?(this.loadError=n,this.emit("load-error",{error:n})):(this.loaded=!0,this.emit("load")))},_startup:function(){this._evalUpdateStatus();this._processFeatures();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",i.hitch(this,this._processFeatures)),this.layer.on("suspend",i.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",i.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",i.hitch(this,this._processExtentChange)))},_processFeatures:function(){this._indexFeatures();this.update()},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(){this._evalClusterParams();this.update()},_update:function(){var t,n,i;if(this._updateHandle=null,this.updateEnabled){if(this.emit("update-start"),this._evalClustersEnabled(),this.clustersEnabled){if(n=this.map.geographicExtent,n){t=this._getIntersectingCells(n);n=this._getClusters(t.cells,n);this.clusters=n.clusters;this._applyStatInfosToClusters(this._getStatFields(this.statisticInfos));var t=t.profile,n=n.profile,r=t.total+n.total;t.total=this._getElapsedTime(t.total);n.total=this._getElapsedTime(n.total);i=this._perfProfile.lastUpdate={};i.cells=t;i.clusters=n;i.total=this._getElapsedTime(r)}}else this.clusters=[],this._perfProfile.lastUpdate=null;this.emit("update-end",{levelChange:this._levelChange,modeChange:this._modeChange});this._modeChange&&this.emit("mode-change")}},_evalClustersEnabled:function(){var n=this.clustersEnabled;(this.clustersEnabled=!(null!=this.maxLod&&this.lod>this.maxLod))&&!this._active&&(this._active=!0);this._modeChange=!1;this._active&&(n!==this.clustersEnabled||this.layer._params.drawMode===this.clustersEnabled)&&(this._modeChange=!0,this._displayFeatures(!this.clustersEnabled))},_displayFeatures:function(n){var t=this.layer;t.setDrawMode(n);n?t.redraw():t.clearNodes()},_indexFeatures:function(){var f=this._getTime(),n,u,i,t;for(this._initializeIndexing(),n=0,u=this._globalIndex.fullExtent,r.forEach(this.layer.graphics,function(t){var i=this._getLngLat(t.geometry),r;i&&(r=s.pointToGeohash(i));r&&(this._addGeohashToIndex(r,t,i),n++,this._updateExtent(u,i))},this),this._applyStatInfosToIndex(this._getStatFields(this.statisticInfos)),this._globalIndex.numFeatures=n,i=this._globalIndex.lodStats,t=1;t<=this._maxGeohashLength;t++)i[t]=this._getLODStats(t,n);this.maxLod=n?this._findMaxLOD(i):null;this._perfProfile.lastIndex.total=this._getElapsedTime(f,this._getTime());this._perfProfile.lastIndex.numFeatures=n;this.emit("index-complete")},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};for(var t=this._cellIndex=[],n=1;n<=this._maxGeohashLength;n++)t[n]={}},_getLngLat:function(n){if(n){var t=n.getLongitude();n=n.getLatitude();n=null!=t&&null!=n?{x:t,y:n}:null}return n},_addGeohashToIndex:function(n,t,i){for(var o=this._cellIndex,r="",f=0;f<this._maxGeohashLength;f++){var r=r+n[f],e=o[r.length],u=e[r];u||(u=e[r]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:r,statistics:null});this._updateItem(u,1,i,!0);u.features.push(t)}},_getLODStats:function(n,t){var e=this._cellIndex[n],r=0,u=Infinity,f=-Infinity,o=null,s,i;for(s in e)i=e[s],r++,i.count<u&&(u=i.count),i.count>f&&(f=i.count);return 0<r&&(o=Number((t/r).toFixed(2))),{lod:n,count:r,min:Infinity===u?null:u,max:-Infinity===f?null:f,avg:o}},_findMaxLOD:function(n){for(var t=this._maxGeohashLength;1<t&&n[t].count===n[t-1].count;)t--;return t-1},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var n=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterSize,this._minClusterSize);this._levelChange=this.lod!==n.lod;this.lod=n.lod;this.tolerance=n.tolerance}},_getClusterParams:function(n,t,i){t<i&&(t=i);i=Math.ceil(n*t);n=this._getClosestLODRange(i).max;var r;do r=this._getCellSize(n),t=i-r,(r=t>r||1===r)||(n+=1);while(!r);return i=t/this._getCellSize(n),{lod:n,tolerance:t,multiplier:Number(i.toFixed(2))}},_getClosestLODRange:function(n){for(var t,i=this._maxGeohashLength;1<=i;i--)if(this._getCellSize(i)>=n){t=i;break}return null==t&&(t=1),n=t+1,n>this._maxGeohashLength&&(n=this._maxGeohashLength),{min:t,max:n}},_getCellSize:function(n){return n=s.getCellSizeInMeters(n),Math.ceil(Math.min(n.width,n.height))},_sorter:function(n,t){var i=n.centroid,r=t.centroid;return n.count>t.count?-1:n.count<t.count?1:i.x>r.x?-1:i.x<r.x?1:0},_getIntersectingCells:function(n){var u=this._getTime(),t=s.getIntersecting(n,this.lod,this.bufferEnabled?this.tolerance:0);n=this._getTime();var i=[],f=this.tolerance,e=this.sortEnabled;return r.forEach(t,function(n){(n=this.getCell(n))&&i.push(n)},this),f&&e&&i.sort(this._sorter),t=this._getTime(),{cells:i,profile:{findCells:this._getElapsedTime(u,n),scanAndSortCells:this._getElapsedTime(n,t),total:t-u}}},_getClusters:function(n,t){var e=this._getTime(),i=[],o={},u={findCells:0},f;return r.forEach(n,function(n){var t=this._createCluster(n,o,u);t&&i.push(t)},this),this._markIntersecting(i,t),this.filterEnabled&&(i=this._getIntersectingClusters(i)),f=this._getTime(),{clusters:i,profile:{findCellsInCluster:this._getElapsedTime(u.findCells),total:f-e}}},_markIntersecting:function(n,t){var i=t.normalize();r.forEach(n,function(n){var t=n.centroid.x,u=n.centroid.y;n.isIntersecting=r.some(i,function(n){return t>=n.xmin&&t<=n.xmax&&u>=n.ymin&&u<=n.ymax})})},_getIntersectingClusters:function(n){return r.filter(n,function(n){return n.isIntersecting})},_createCluster:function(n,t,i){var u,f,e;if(!t[n.geohash])return u=[{cell:n,distance:0}],this.tolerance&&(f=this._getTime(),e=s.getNeighborsWithinDistance(n.centroid,this.lod,this.tolerance),i.findCells+=this._getTime()-f,r.forEach(e,function(t){if(t!==n.geohash&&(t=this.getCell(t))){var i=this._calculateDistance(n.centroid,t.centroid);i<=this.tolerance&&u.push({cell:t,distance:i})}},this)),this._mergeCells(u,t)},_calculateDistance:function(n,t){return o.getLength(s.geographicToWebMercator(n),s.geographicToWebMercator(t))},_mergeCells:function(n,t){var i=this._initializeCluster({},n[0].cell.geohash);return r.forEach(n,function(n){var u=n.cell,r=u.geohash,f;if(n=n.distance,f=t[r],f)if(n<f.distance)this._removeCellFromCluster(r,t);else return;t[r]={cluster:i,distance:n};this._updateItem(i,u.count,u.centroid);i.geohashes.push(r)},this),i},_removeCellFromCluster:function(n,t){var i=t[n].cluster,u;delete t[n];u=r.indexOf(i.geohashes,n);-1<u&&i.geohashes.splice(u,1);this._reevaluateCluster(i)},_reevaluateCluster:function(n){var t=n.geohashes;n=this._initializeCluster(n,n.primary);r.forEach(t,function(t){var i=this.getCell(t);i&&(this._updateItem(n,i.count,i.centroid),n.geohashes.push(t))},this)},_initializeCluster:function(n,t){return n.count=0,n.centroid=new e(null,null),n.geohashes=[],n.primary=t,n.statistics=null,n},_applyStatInfos:function(n){n=this._getStatFields(n);this._applyStatInfosToIndex(n);this._applyStatInfosToClusters(n)},_getStatFields:function(n){n=this._getValidStatInfos(n);var t=[];return r.forEach(n,function(n){-1===r.indexOf(t,n.field)&&t.push(n.field)}),t},_getValidStatInfos:function(n){var t=this.layer;return r.filter(n,function(n){return t.loaded&&t.isOutField(n.field)&&("sum"===n.type||"avg"===n.type)})},_applyStatInfosToIndex:function(n){var r=this._cellIndex,t,i,u;if(r)for(t=1;t<=this._maxGeohashLength;t++){i=r[t];for(u in i)this._applyStatInfosToCell(i[u],n)}},_applyStatInfosToCell:function(n,t){var i=this._initializeStats(n,t);r.forEach(n.features,function(n){this._calcFeatureStats(n,t,i)},this);this._summarizeStats(n,i,t)},_calcFeatureStats:function(n,t,i){var u=n.attributes;u&&r.forEach(t,function(n){var t=u[n];n=i[n];this._isValidNumber(t)&&(n.count++,n.sum+=t)},this)},_applyStatInfosToClusters:function(n){r.forEach(this.clusters,function(t){var i=this._initializeStats(t,n);r.forEach(this.getCellsInCluster(t),function(t){this._calcCellStats(t,n,i)},this);this._summarizeStats(t,i,n);t.attributes.clusterId=t.primary},this)},_calcCellStats:function(n,t,i){var u=n.statistics;r.forEach(t,function(n){var t=u[n];n=i[n];t.count&&(n.count+=t.count,n.sum+=t.sum)})},_initializeStats:function(n,t){var i=n.statistics={};return r.forEach(t,function(n){i[n]={count:0,sum:null,avg:null}}),i},_summarizeStats:function(n,t,i){var u=n.attributes={count:n.count};r.forEach(i,function(n){var i=t[n];0<i.count&&(i.avg=i.sum/i.count);u["sum_"+n]=i.sum;u["avg_"+n]=i.avg})},_updateItem:function(n,t,i,r){var e=i.y,u=n.centroid,f=n.count;u.x=(f*u.x+t*i.x)/(f+t);u.y=(f*u.y+t*e)/(f+t);n.count+=t;r&&this._updateExtent(n.extent,i)},_updateExtent:function(n,t){var i=t.x,r=t.y;i<n.xmin&&(n.xmin=i);i>n.xmax&&(n.xmax=i);r<n.ymin&&(n.ymin=r);r>n.ymax&&(n.ymax=r)},_isValidNumber:function(n){return"number"==typeof n&&!isNaN(n)&&Infinity!==n&&-Infinity!==n},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(n,t){var r,i;return i=null!=n&&null!=t?t-n:n,null!=i&&(r="millisecond",1e3<=i&&(i/=1e3,r="second",60<=i&&(i/=60,r="minute")),r={value:Number(i.toFixed(2)),unit:r}),r}}),n("extend-esri")&&i.setObject("layers.clustering.GeohashAggregation",t,u),t})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(n,t,i,r,u,f,e,o,s){function v(n){var t=n.spatialReference,r,i;return t?(r=t.isWebMercator(),4326===t.wkid?i={x:n.x,y:n.y}:r&&(i={x:n.getLongitude(),y:n.getLatitude()}),i):{x:n.x,y:n.y}}function y(n){var t=n.spatialReference,r=!(!t||!t.isWebMercator()),i;return t&&4326===t.wkid?i=new e(n.toJson()):r&&(i=s.webMercatorToGeographic(n,!0)),i}function p(n,t){return t.x=f.prototype._normalizeX(n.x,o.prototype._info[4326]),t.y=n.y,t}function et(n){return n=h.decimals[n].toString(2),t.pad(n,h.bitsPerBase32Char,"0")}function g(n,t){var r;t=t.slice();t.splice(1,0,0);for(var u=t[0],f=t[2],i=0;i<n.length;i++)Number(n[i])?t[0]=t[1]:t[2]=t[1],r=t[1]=(t[0]+t[2])/2,u=t[0],f=t[2];return{value:r,min:u,max:f}}function nt(n,t,i){var u=[];t=t.slice();t.splice(1,0,0);for(var r=t[0],f=t[2],e=0;e<i;e++)n>=t[1]?(t[0]=t[1],r=1):(t[2]=t[1],r=0),t[1]=(t[0]+t[2])/2,u.push(r),r=t[0],f=t[2];return{value:u.join(""),min:r,max:f}}function tt(n){var t=n*h.bitsPerBase32Char;return 0==t%2?n=t/=2:(n=(t+1)/2,t-=n),{lon:n,lat:t}}function ot(n){var i=0,t;for(n=n.split("").reverse().join(""),t=0;t<n.length;t++)i+=Number(n[t])*Math.pow(2,t);return h.base32[i]}function w(n,t){var i={x:n.xmin,y:n.ymax},r={x:n.xmax,y:n.ymin},u={x:n.xmax,y:n.ymax};return{sw:c.pointToGeohash({x:n.xmin,y:n.ymin},t),nw:c.pointToGeohash(i,t),se:c.pointToGeohash(r,t),ne:c.pointToGeohash(u,t)}}function b(n,t,i,r,u){var f=n;do u[f]||(u[f]=!0,r.push(f)),(n=f===t)||(f=l(f,i));while(!n)}function it(n,t,i,r){var u=w(n,t);for(n=[],b(u.sw,u.nw,"n",n,{}),t=[],b(u.se,u.ne,"n",t,{}),u=0;u<n.length;u++)b(n[u],t[u],"e",i,r)}function rt(n){return r.filter(n,function(n){return 180===n.xmax?!0:!1})[0]}function ut(n){return r.filter(n,function(n){return-180===n.xmin?!0:!1})[0]}function a(n,t,i,r){var u=c.geographicToWebMercator(n);return n={x:u.x-t,y:u.y-t},t=c.webMercatorToGeographic({x:u.x+t,y:u.y+t},!0),n=c.webMercatorToGeographic(n,!0),new e(null!=i?i:n.x,n.y,null!=r?r:t.x,t.y)}function k(n,t,i,r){var u,f,o,s;return n=w(n,t),"min"===r?o=180:"max"===r&&(f=-180),s=f,r=o,u=c.geohashToCell(n.sw).extent,t=c.geohashToCell(n.ne).extent,n=null!=s?s:u.xmin,u=u.ymin,r=null!=r?r:t.xmax,t=t.ymax,n=a({x:n,y:u},i,f,o),i=a({x:r,y:t},i,f,o),new e(n.xmin,n.ymin,i.xmax,i.ymax)}function ft(n,t,i){var r=n,u=0;do u++,(n=r===t)||(r=l(r,i));while(!n);return u}function d(n,t){var i=w(n,t),r=ft(i.nw,i.ne,"e");return{rows:ft(i.nw,i.sw,"s"),cols:r}}function l(n,t){var r=n.length%2,u=n.slice(-1),f=h.decimals[u],i=n.slice(0,-1);return-1!=h.borders[t][r].indexOf(u)&&i&&(i=l(i,t)),i+h.neighbors[t][r][f]}var h={base32:"0123456789bcdefghjkmnpqrstuvwxyz",decimals:function(){for(var t={},n=0;32>n;n++)t["0123456789bcdefghjkmnpqrstuvwxyz"[n]]=n;return t}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]},c;return h.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb",h.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy",h.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp",h.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx",h.borders.n[0]="prxz",h.borders.s[0]="028b",h.borders.e[0]="bcfguvyz",h.borders.w[0]="0145hjnp",c={geographicToWebMercator:function(n){return n=f.lngLatToXY(n.x,n.y),{x:n[0],y:n[1]}},webMercatorToGeographic:function(n,t){var i=f.xyToLngLat(n.x,n.y,t);return{x:i[0],y:i[1]}},geohashToCell:function(n){for(var i=[],t=0;t<n.length;t++)i.push(et(n[t]));for(var i=i.join(""),t=[],u=[],r=0;r<i.length;r++)0==r%2?t.push(i[r]):u.push(i[r]);return t=t.join(""),u=u.join(""),t=[t,u],i=g(t[0],h.longitudeRange),t=g(t[1],h.latitudeRange),{point:{x:i.value,y:t.value},extent:{xmin:i.min,xmax:i.max,ymin:t.min,ymax:t.max},geohash:n}},pointToCell:function(n,t){var i,f,e,r,u,c;if(t=t||h.maxGeohashLength,r=v(n),r){r=p(r,r);i=tt(t);e=nt(r.x,h.longitudeRange,i.lon);u=nt(r.y,h.latitudeRange,i.lat);i=e.value;f=u.value;e={xmin:e.min,xmax:e.max,ymin:u.min,ymax:u.max};for(var u=[],s=Math.ceil((i.length+f.length)/h.bitsPerBase32Char),o=0,l=0,a=0;a<s*h.bitsPerBase32Char;a++)c=0==a%2?i[o++]:f[l++],null==c&&(c=0),u.push(c);for(i=u.join(""),f=h.bitsPerBase32Char,u=i.length/f,s=[],o=0;o<u;o++)l=i.substr(o*f,f),s.push(ot(l));return i=s.join(""),{point:r,extent:e,geohash:i}}},geohashToPoint:function(n){return c.geohashToCell(n).point},pointToGeohash:function(n,t){var i=c.pointToCell(n,t);return i&&i.geohash},getCells:function(n){return r.map(n,function(n){return c.geohashToCell(n)})},getCellSize:function(n){var t=h.longitudeRange,i=h.latitudeRange,t=Math.abs(t[1]-t[0]),i=Math.abs(i[1]-i[0]);return n=tt(n||1),{width:t/Math.pow(2,n.lon),height:i/Math.pow(2,n.lat)}},getCellSizeInMeters:function(n){n=c.getCellSize(n);var t=s.metersPerDegree;return n.width*=t,n.height*=t,n},getIntersecting:function(n,t,i){var f,u,e;return t=t||1,i=i||0,f=[],u=y(n),u&&(i&&(u=c.expandExtent(n,t,i)),n=u.normalize(),e={},r.forEach(n,function(n){it(n,t,f,e)})),f},countIntersecting:function(n,t,i){var r,u,f;return t=t||1,i=i||0,r=0,u=y(n),u&&(i&&(u=c.expandExtent(n,t,i)),n=u.normalize(),2===n.length?(r=rt(n),u=ut(n),i=d(r,t),f=d(u,t),n=i.rows,i=i.cols+f.cols,r={x:r.xmin,y:r.ymax},u={x:u.xmax,y:u.ymax},r=p(r,{}),u=p(u,{}),r=c.pointToGeohash(r,t),t=c.pointToGeohash(u,t),r===t&&i--,t={rows:n,cols:i}):t=d(n[0],t),r=t.cols*t.rows),r},getChildren:function(n){n=n||"";var t=[];for(var i in h.decimals)t.push(n+i);return t},getNeighbors:function(n){var t=l(n,"n"),i=l(n,"s");return[t,l(t,"e"),l(t,"w"),i,l(i,"e"),l(i,"w"),l(n,"e"),l(n,"w")]},getExtentFromDistance:function(n,t){t=t||1e3;var i,r=v(n);return r&&(i=a(r,t)),i},expandExtent:function(n,t,i){if(t=t||1,i=i||0,n=y(n)){if(i){if(n=n.normalize(),2===n.length){var r=i;return i=rt(n),n=ut(n),i=k(i,t,r,"min"),n=k(n,t,r,"max"),360<=i.getWidth()+n.getWidth()?(t=-180,n=180):(t=i.xmin,n=n.xmax),new e(t,i.ymin,n,i.ymax)}return k(n[0],t,i)}return n}},getNeighborsWithinDistance:function(n,t,i){var u,f;return i=i||1e3,t=t||1,u=[],(n=v(n))&&(i=a(n,i).normalize(),f={},r.forEach(i,function(n){it(n,t,u,f)})),u}},n("extend-esri")&&i.setObject("layers.clustering.geohashUtils",c,u),c})},"*noref":1}});define("esri/layers/FeatureLayer","require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../renderers/arcadeUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi){var li=k.defaults,ci=i(wt,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4e3,maxRecordCountForAuto:2e3,maxVertexCountForAuto:25e4,generalizeForScale:4e3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(n,t){this._preventInit||this._initFeatureLayer(n,t)},_initFeatureLayer:function(n,t){var i,r;this.i18n=hi;t=t||{};this._aggregationInfo=t.aggregationInfo;this.showLabels=null!=t.showLabels?t.showLabels:!0;this._outFields=t.outFields;this._defnExpr=t.definitionExpression;this._loadCallback=t.loadCallback;r=t._usePatch;this._usePatch=null===r||void 0===r?!0:r;this._trackIdField=t.trackIdField;this.objectIdField=t.objectIdField;this._maxOffset=null!=t.maxAllowableOffset?t.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=t.quantize?t.quantize:!0;this._optEditable=t.editable;this._optAutoGen=t.autoGeneralize;this.editSummaryCallback=t.editSummaryCallback;this.userId=t.userId;this.userIsAdmin=t.userIsAdmin;this.useMapTime=t.hasOwnProperty("useMapTime")?!!t.useMapTime:!0;this.source=t.source;this.gdbVersion=t.gdbVersion;this.orderByFields=t.orderByFields;this.maxPointCountForAuto=null!=t.maxPointCountForAuto?t.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=t.maxRecordCountForAuto?t.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=t.maxVertexCountForAuto?t.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=null!=t.generalizeForScale?t.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=t.queryPagination?t.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=t.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();i=ci;r=this.mode=w.isDefined(t.mode)?t.mode:i.MODE_ONDEMAND;this._isStream&&(this.mode=r=i.MODE_STREAM);switch(r){case i.MODE_SNAPSHOT:this.currentMode=i.MODE_SNAPSHOT;this._mode=new ii(this);this._isSnapshot=!0;break;case i.MODE_ONDEMAND:case i.MODE_AUTO:this.currentMode=i.MODE_ONDEMAND;this._tileWidth=t.tileWidth||512;this._tileHeight=t.tileHeight||512;this._mode=new ri(this);this.latticeTiling=t.latticeTiling;break;case i.MODE_SELECTION:this.currentMode=i.MODE_SELECTION;this._mode=new ui(this);this._isSelOnly=!0;break;case i.MODE_STREAM:this.currentMode=i.MODE_STREAM;this._mode=new fi(this);this._isStream=!0}if(this._initLayer=u.hitch(this,this._initLayer),this._selectHandler=u.hitch(this,this._selectHandler),this._editable=!1,u.isObject(n)&&n.layerDefinition)return this._collection=!0,this.mode=this._isStream?i.MODE_STREAM:i.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(n),this;this._task=new st(this.url,{source:this.source,gdbVersion:this.gdbVersion});r=this._url.path;this._fserver=!1;-1!==r.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===i.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(i=t.resourceInfo)?this._initLayer(i):(this.source&&(i={source:this.source.toJson()},this._url.query=u.mixin(this._url.query,{layer:e.toJson(i)})),this.gdbVersion&&(this._url.query=u.mixin(this._url.query,{gdbVersion:this.gdbVersion})),b({url:r,content:u.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(n,t){var i,c,s,r,d;if(n||t){this._json=n;this._findCredential();(this.credential&&this.credential.ssl||n&&n._ssl)&&(this._useSSL(),this._task._useSSL());this.version=n.currentVersion;this.version||(this.version="capabilities"in n||"drawingInfo"in n||"hasAttachments"in n||"htmlPopupType"in n||"relationships"in n||"timeInfo"in n||"typeIdField"in n||"types"in n?10:9.3);this._collection&&(this._isStream||(this.currentMode=ci.MODE_SNAPSHOT,this._mode=new ii(this)),this._isSnapshot=!0,this._featureSet=n.featureSet,this._nextId=n.nextObjectId,n=n.layerDefinition);this.geometryType=n.geometryType;"string"!=typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");n.hasOwnProperty("capabilities")?(i=this.capabilities=n.capabilities,this._editable=i&&-1!==i.toLowerCase().indexOf("editing")?!0:!1):this._collection||(this._editable=this._fserver);w.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=e.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this.mode===ci.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||(this._autoGeneralize=w.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===ci.MODE_ONDEMAND||this.mode===ci.MODE_AUTO,delete this._optAutoGen);i=n.effectiveMinScale||n.minScale;r=n.effectiveMaxScale||n.maxScale;!this._hasMin&&i&&this.setMinScale(i);!this._hasMax&&r&&this.setMaxScale(r);this.layerId=n.id;this.name=n.name;this.description=n.description;this.copyright=n.copyrightText;this.type=n.type;this.displayField=n.displayField;this.defaultDefinitionExpression=n.definitionExpression||(n.isView?n.viewDefinitionQuery:n.definitionQuery);this.fullExtent=new at(n.extent);this.initialExtent=new at(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new g(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=n.defaultVisibility;("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)&&(this.latticeTiling=!1);this.hasM=n.hasM||!1;this.hasZ=n.hasZ||!1;this.indexedFields=n.indexedFields;this.maxRecordCount=n.maxRecordCount;this.canModifyLayer=n.canModifyLayer;this.supportsStatistics=n.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:n.supportsAdvancedQueries;this.supportsCalculate=n.supportsCalculate;this.supportsAttachmentsByUploadId=n.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=n.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=n.hasLabels;this.canScaleSymbols=n.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=n.supportsRollbackOnFailure;this.syncCanReturnChanges=n.syncCanReturnChanges;this.isDataVersioned=n.isDataVersioned;this.editFieldsInfo=n.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=n.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=n.relationships;this.allowGeometryUpdates=w.isDefined(n.allowGeometryUpdates)?n.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!n.allowUpdateWithoutMValues;this.advancedQueryCapabilities=n.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.useStandardizedQueries=n.useStandardizedQueries;this.tileMaxRecordCount=n.tileMaxRecordCount;this.standardMaxRecordCount=n.standardMaxRecordCount;this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;for(var o=this.fields=[],r=n.fields,i=0;i<r.length;i++)o.push(new bt(r[i]));if(!this.objectIdField){if(this.objectIdField=n.objectIdField,!this.objectIdField)for(r=n.fields,i=0;i<r.length;i++)if(o=r[i],"esriFieldTypeOID"===o.type){this.objectIdField=o.name;break}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+w.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!w.isDefined(this._nextId)){if(r=this.objectIdField,o=-1,this._collection&&r)for(var y=(i=this._featureSet)&&i.features,v=y?y.length:0,l,i=0;i<v;i++)l=(l=y[i].attributes)&&l[r],l>o&&(o=l);this._nextId=o+1}this.globalIdField=n.globalIdField;(i=this.typeIdField=n.typeIdField)&&(i=!this._getField(i)&&this._getField(i,!0))&&(this.typeIdField=i.name);this.visibilityField=n.visibilityField;(r=n.defaultSymbol)&&(this.defaultSymbol=rt.fromJson(r));var b=this.types=[],a=n.types,p,k,o=(i=this.editFieldsInfo)&&i.creatorField,y=i&&i.editorField;if(l=o||y,v=[],a)for(i=0;i<a.length;i++)p=new dt(a[i]),k=p.templates,l&&k&&k.length&&(v=v.concat(k)),b.push(p);if(a=n.templates,p=this.templates=[],a)for(i=0;i<a.length;i++)b=new gt(a[i]),l&&v.push(b),p.push(b);for(i=0;i<v.length;i++)(l=u.getObject("prototype.attributes",!1,v[i]))&&(o&&delete l[o],y&&delete l[y]);if((i=n.timeInfo)&&(this.timeInfo=new kt(i),this._startTimeField=i.startTimeField,this._endTimeField=i.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?i.trackIdField=this._trackIdField:this._trackIdField=i.trackIdField),this.hasAttachments=!this._collection&&n.hasAttachments?!0:!1,this.htmlPopupType=n.htmlPopupType,i=n.drawingInfo,(o=i&&i.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=f.map(o,function(n){return new ti(n)}),this._fixLabelExpr()),!this.renderer)if(i&&i.renderer){if(c=i.renderer,this.setRenderer(et.fromJson(c)),"classBreaks"===c.type&&this.renderer.setMaxInclusive(!0),!this._collection){s=c.type;r=[];c=this.renderer;switch(s){case"simple":r.push(c.symbol);break;case"uniqueValue":case"classBreaks":r.push(c.defaultSymbol);r=r.concat(f.map(c.infos,function(n){return n.symbol}))}var r=f.filter(r,w.isDefined),st=this._url.path+"/images/",ot=this._getToken();f.forEach(r,function(n){var t=n.url;t&&(-1===t.search(/https?\:/)&&-1===t.indexOf("data:")&&(n.url=st+t),ot&&-1!==n.url.search(/https?\:/)&&(n.url+="?token="+ot))})}}else if(r)a=this.types,0<a.length?(c=new ft(this.defaultSymbol,this.typeIdField),f.forEach(a,function(n){c.addValue(n.id,n.symbol)})):c=new ut(this.defaultSymbol),this.setRenderer(c);else if(!this._isTable){switch(this.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":s=new nt;break;case"esriGeometryPolyline":s=new tt;break;case"esriGeometryPolygon":s=new it;break;default:this.hasXYFootprint()&&(s=new it)}this.setRenderer(s?new ut(s):null)}s=i&&i.transparency||0;!this.hasOwnProperty("opacity")&&0<s&&(this.opacity=1-s/100);(h("ie")||7<=h("trident")||h("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=n.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();d=function(){this.currentMode!==ci.MODE_SNAPSHOT&&(this.queryPagination=!1);null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var n=this._loadCallback;n&&(delete this._loadCallback,n(this))};this._collection?(s=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new ct(s)),this._fcAdded=!0,d.call(this)):this._forceIdentity(this._limitPromise?function(){var n=this;this._limitPromise.then(function(t){n._checkMode(t)});this._limitPromise.always(function(){n._limitPromise=null;d.call(n)})}:d)}},setShowLabels:function(n){this.showLabels=n;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(n){var t;if(this.inherited(arguments),t=this._map,this._ager=!!(n&&n.observationAger&&n.observationRenderer),n&&"colors"in n&&"blurRadius"in n&&"maxPixelIntensity"in n?"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&t&&(this._heatmapManager=new oi(this),this._heatmapManager.initialize(t)):this.renderer&&this.renderer.getRendererInfo?f.some(this.renderer.rendererInfos,function(n){return n.renderer&&"colors"in n.renderer&&"blurRadius"in n.renderer})||(this._heatmapManager=null):this._heatmapManager=null,this.timeInfo&&t&&(n&&(n.latestObservationRenderer||n.trackRenderer)?this._trackManager||(this._trackManager=new ei(this),this._trackManager.initialize(t),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null)),n){var i=[],t=f.filter([n,n.observationRenderer,n.latestObservationRenderer,n.trackRenderer],w.isDefined),r=function(n){return null!=n&&"function"!=typeof n&&n};f.forEach(t,function(n){var t=r(n.attributeField),u=r(n.attributeField2);n=r(n.attributeField3);!1!==t&&i.push(t);!1!==u&&i.push(u);!1!==n&&i.push(n)});this._requiredFields=i}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},getAggregationInfo:function(){return this._aggregationInfo},setAggregationInfo:function(n){this._aggregationInfo=n;this.loaded&&this._map&&this._evalClusterManager();this.onAggregationInfoChange()},isAggregationEnabled:function(){return this._clusterManager&&this._clusterManager.isClusteringEnabled()},getAggregationRenderer:function(){return this.isAggregationEnabled()?this._clusterManager.getClusterRenderer():null},getAggregationLayer:function(){return this._clusterManager?this._clusterManager.container:null},_evalClusterManager:function(){var n=this.getAggregationInfo();n?this._canCluster(n)?this._clusterManager?this._updateClusterManager(n):this._clusterManager=this._createClusterManager(n):console.log("FeatureLayer: Clustering is supported only for non-editable point layers in snapshot mode when map spatial reference is WGS84 or WebMercator"):this._destroyClusterManager()},_canCluster:function(n){var t=this._map.spatialReference;return"cluster"===n.type&&(t.isWebMercator()||4326===t.wkid)&&"esriGeometryPoint"===this.geometryType&&!this.isEditable()&&(this.mode===ci.MODE_SNAPSHOT||this.currentMode===ci.MODE_SNAPSHOT||this.currentMode===ci.MODE_STREAM)},_createClusterManager:function(n){return n=new si({layer:this,aggregationInfo:n}),this._clusterHandles=[n.on("renderer-change,mode-change",u.hitch(this,function(){this.onAggregationRendererChange()}))],n.initialize(this._map),n},_updateClusterManager:function(n){var t=this._clusterManager;t&&t.setAggregationInfo(n)},_destroyClusterManager:function(){f.forEach(this._clusterHandles,function(n){n.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(),this._clusterManager=null)},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var n=this._getRenderer();this._ager=!!(n&&n.observationAger&&n.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(n&&n.trackRenderer)},_setMap:function(n){var r=this.inherited(arguments),t=this._mode,i=this;return t&&n.loaded&&t.initialize(n),this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase()),this._addHandle=this.on("graphic-node-add",function(n){n=n.graphic.attributes;(n=i._selectedFeatures[n&&n[i.objectIdField]])&&n.attr("data-selected","")}),r},_unsetMap:function(){var n=this._mode;n&&n.suspend();this._destroyClusterManager();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);r.disconnect(this._zoomConnect);r.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var n=this._mode;n&&n.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return f.filter(this._getOutFields(),function(n){return"*"===n||!!this._getField(n)},this)},getField:function(n){return this._getField(n,!0)},isOutField:function(n){if(n=this.getField(n),!n)return!1;var t=this.getOutFields();return-1<f.indexOf(t,"*")||-1<f.indexOf(t,n.name)},getFieldLabel:function(n){var t=this.infoTemplate,t=t&&t.getFieldInfo&&t.getFieldInfo(n),i,r;return n=u.isFunction(n)?null:this.getField(n),i=t||n,r="",i&&(r=t&&t.label||n&&n.alias||i.name||i.fieldName),r},getDomain:function(n,t){var i,u,r=t&&t.feature,e=r&&this.typeIdField&&r.attributes&&r.attributes[this.typeIdField];return null!=e&&f.some(this.types,function(t){return t.id==e?((i=t.domains&&t.domains[n])&&"inherited"===i.type&&(i=this._getLayerDomain(n),u=!0),!0):!1},this),u||i||(i=this._getLayerDomain(n)),i},_getLayerDomain:function(n){var t;return f.some(this.fields,function(i){return i.name===n&&(t=i.domain),!!t}),t},getType:function(n){var t,i=n&&this.typeIdField&&n.attributes&&n.attributes[this.typeIdField];return f.some(this.types,function(n){return n.id==i&&(t=n),!!t}),t},setEditable:function(n){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=n,this;var t=this._editable;return this._editable=n,this._updateCaps(),t!==n&&this.onCapabilitiesChange(),this},getEditCapabilities:function(n){var t={canCreate:!1,canUpdate:!1,canDelete:!1,canUpdateGeometry:!1},r;if(!this.loaded||!this.isEditable())return t;r=n&&n.feature;n=n&&n.userId||this.getUserId();var e=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],u.trim),c=(t=-1<f.indexOf(e,"editing"))&&-1<f.indexOf(e,"create"),l=t&&-1<f.indexOf(e,"update"),e=t&&-1<f.indexOf(e,"delete"),i=this.ownershipBasedAccessControlForFeatures,o=this.editFieldsInfo,h=o&&o.creatorField,o=o&&o.realm,r=(r=r&&r.attributes)&&h?r[h]:void 0,s=!!this.userIsAdmin,h=!i||s||!(!i.allowOthersToUpdate&&!i.allowUpdateToOthers),a=!i||s||!(!i.allowOthersToDelete&&!i.allowDeleteToOthers),v=!i||s||!i.hasOwnProperty("allowAnonymousToUpdate")||i.allowAnonymousToUpdate,i=!i||s||!i.hasOwnProperty("allowAnonymousToDelete")||i.allowAnonymousToDelete;return n&&o&&(n=n+"@"+o),!s&&(!t||c||l||e)||(c=l=e=!0),t={canCreate:c,canUpdate:l,canDelete:e,canUpdateGeometry:s||this.allowGeometryUpdates},n||(t.canUpdate=t.canUpdate&&v,t.canDelete=t.canDelete&&i),null===r?(t.canUpdate=t.canUpdate&&h,t.canDelete=t.canDelete&&a):""!==r&&r&&n.toLowerCase()!==r.toLowerCase()&&(t.canUpdate=t.canUpdate&&h,t.canDelete=t.canDelete&&a),t},getUserId:function(){var n;return this.loaded&&(n=this.credential&&this.credential.userId||this.userId||""),n},setUserIsAdmin:function(n){this.userIsAdmin=n},setEditSummaryCallback:function(n){this.editSummaryCallback=n},getEditSummary:function(n,t,i){var r,e,f;return i=w.isDefined(i)?i:(new Date).getTime(),r="",i=this.getEditInfo(n,t,i),(t=t&&t.callback||this.editSummaryCallback)&&(i=t(n,i)||""),u.isString(i)?r=i:(i&&(n=i.action,t=i.userId,e=i.timeValue,f=0,n&&f++,t&&f++,w.isDefined(e)&&f++,1<f&&(r=("edit"===n?"edit":"create")+(t?"User":"")+(w.isDefined(e)?i.displayPattern:""))),r=r&&w.substitute(i,this.i18n.layers.FeatureLayer[r])),r},getEditInfo:function(n,t,i){var u;if(this.loaded){i=w.isDefined(i)?i:(new Date).getTime();t=t&&t.action||"last";var r=this.editFieldsInfo,f=r&&r.creatorField,o=r&&r.creationDateField,e=r&&r.editorField,r=r&&r.editDateField,e=(n=n&&n.attributes)&&e?n[e]:void 0,r=n&&r?n[r]:null,f=this._getEditData(n&&f?n[f]:void 0,n&&o?n[o]:null,i);i=this._getEditData(e,r,i);switch(t){case"creation":u=f;break;case"edit":u=i;break;case"last":u=i||f}return u&&(u.action=u===i?"edit":"creation"),u}},_getEditData:function(n,t,i){var r,u,f;return w.isDefined(t)&&(u=i-t,f=0>u?"Full":6e4>u?"Seconds":12e4>u?"Minute":36e5>u?"Minutes":72e5>u?"Hour":864e5>u?"Hours":6048e5>u?"WeekDay":"Full"),(void 0!==n||f)&&(r=r||{},r.userId=n,f&&(n=s.format,i=new Date(t),r.minutes=Math.floor(u/6e4),r.hours=Math.floor(u/36e5),r.weekDay=n(i,{datePattern:"EEEE",selector:"date"}),r.formattedDate=n(i,{selector:"date"}),r.formattedTime=n(i,{selector:"time"}),r.displayPattern=f,r.timeValue=t)),r},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var n=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],u.trim);return this._isStream||this.userIsAdmin||this._collection||-1!==f.indexOf(n,"query")||-1!==f.indexOf(n,"catalog")},setMaxAllowableOffset:function(n){return this.isEditable()||this._setMaxOffset(n,!0),this},getMaxAllowableOffset:function(){var n=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:n},_setMaxOffset:function(n,t){return null==n?(delete this._maxOffset,delete this._quantizationParameters,this):(this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===this.geometryType?this._maxOffset=n:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:n,extent:this.fullExtent}):(this._isFractionalOffsetAllowed()&&t||(n=Math.floor(n)),isNaN(n)||0===n?delete this._maxOffset:this._maxOffset=n,delete this._quantizationParameters),this)},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(n){return n=(n=n&&n.split("-"))&&n[0]&&n[0].toLowerCase(),-1!==f.indexOf(this._langsWithDot,n)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(n){return this.loaded?this.isEditable()||this.mode===ci.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||((this._autoGeneralize=n)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=n,this},setGDBVersion:function(n){return!this._collection&&n!==this.gdbVersion&&(n||this.gdbVersion)&&(this.gdbVersion=n,this._task.gdbVersion=n,this._url.query=u.mixin(this._url.query,{gdbVersion:n}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange()),this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},setDefinitionExpression:function(n){return this._defnExpr=n,(n=this._mode)&&n.propertyChangeHandler(1),this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(n){return this._isSnapshot?(this._timeDefn=n,(n=this._mode)&&n.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id = "+this.id+", Layer URL = "+this.url),this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(n,t){this._timeOffset=n;this._timeOffsetUnits=t;var i=this._mode;return i&&i.propertyChangeHandler(0),this},setUseMapTime:function(n){this.useMapTime=n;this._toggleTime(!this.suspended);(n=this._mode)&&n.propertyChangeHandler(0)},selectFeatures:function(n,t,i,r){var s;t=t||ci.SELECTION_NEW;this._hasPartialSelectedFeatures=!1;n=this._getShallowClone(n);var f=this._map,e,h=this,u=d._fixDfd(new o(d._dfdCanceller));if(n.outFields=this.getOutFields(),n.returnGeometry=!0,n.multipatchOption=this.multipatchOption,f&&(n.outSpatialReference=new g(f.spatialReference.toJson())),!this._applyQueryFilters(n,!0))return e={features:[]},this._selectHandler(e,t,i,r,u),u;if(f=this._canDoClientSideQuery(n))u._pendingDfd=v(this._doQuery(n,f)),u._pendingDfd.then(function(n){e={features:n};h._selectHandler(e,t,i,r,u)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,r,u,!0),u;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,r,u,!0),u;s=this;this._ts&&(n._ts=(new Date).getTime());(u._pendingDfd=this._task.execute(n)).addCallbacks(function(n){s._selectHandler(n,t,i,r,u)},function(n){s._hasPartialSelectedFeatures=!0;s._resolve([n],null,r,u,!0)})}return u},getSelectedFeatures:function(){var n=this._selectedFeatures,t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t},clearSelection:function(n){var r=this._selectedFeatures,t=this._mode;for(var i in r)r.hasOwnProperty(i)&&(this._unSelectFeatureIIf(i,t),t._removeFeatureIIf(i));return this._selectedFeatures={},this._isSelOnly&&t._applyTimeFilter(!0),n||this.onSelectionClear(),this},setSelectionSymbol:function(n){if(this._selectionSymbol=n){var t=this._selectedFeatures;for(var i in t)t.hasOwnProperty(i)&&t[i].setSymbol(n)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(n){n?(this.labelingInfo=n,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var t=/\[([^\[\]]+)\]/ig,n,i=this,r=function(n,t){var r=i._getField(t,!0);return"["+(r&&r.name||t)+"]"};f.forEach(this.labelingInfo,function(i){(n=i.labelExpression)&&(i.labelExpression=n.replace(t,r))})},_updateRequiredFieldsFromLabelingInfo:function(){var n=[];f.forEach(this.labelingInfo,function(t){var i=t.labelExpressionInfo,r,u;t.labelExpression&&(r=/[\[\]]/ig,t=t.labelExpression.match(/\[[^\[\]]+\]/ig),(t=f.map(t,function(n){return n.replace(r,"")}))&&(n=n.concat(t)));i&&(i.value&&(u=/[\{\}]/ig,t=i.value.match(/\{[^\{\}]+\}/ig),(t=f.map(t,function(n){return n.replace(u,"")}))&&(n=n.concat(t))),i.expression&&(n=n.concat(ot.extractFieldNames(i.expression))))});n=f.map(n,function(n){var t=this.getField(n);return t?t.name:n},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(n))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(n,t,i,r,e,o){var s=o.assembly,c=o.dfd,v,y;this._applyNormalized(n,s&&s[0]);this._applyNormalized(t,s&&s[1]);this.onBeforeApplyEdits(n,t,i);var l={},a=this.objectIdField,s={f:"json"},h=!1;if(this._collection)o={},o.addResults=n?f.map(n,function(){return h=!0,{objectId:this._nextId++,success:!0}},this):null,o.updateResults=t?f.map(t,function(n){h=!0;var t=n.attributes[a];return l[t]=n,{objectId:t,success:!0}},this):null,o.deleteResults=i?f.map(i,function(n){return h=!0,{objectId:n.attributes[a],success:!0}},this):null,h?this._editHandler(o,n,l,r,e,c):this._resolve([o.addResults,o.updateResults,o.deleteResults],null,r,c);else{if(n&&0<n.length&&(s.adds=this._convertFeaturesToJson(n,0,1),h=!0),t&&0<t.length){for(o=0;o<t.length;o++)v=t[o],l[v.attributes[a]]=v;s.updates=this._convertFeaturesToJson(t,0,0,1);h=!0}if(i&&0<i.length){for(t=[],o=0;o<i.length;o++)t.push(i[o].attributes[a]);s.deletes=t.join(",");h=!0}if(h)return y=this,b({url:this._url.path+"/applyEdits",content:u.mixin(s,this._url.query),callbackParamName:"callback",load:function(t){y._editHandler(t,n,l,r,e,c)},error:function(n){y._resolve([n],null,e,c,!0)}},{usePost:!0});this._resolve([],null,r,c)}},queryFeatures:function(n,t,i){return this._query("execute","onQueryFeaturesComplete",n,t,i)},queryRelatedFeatures:function(n,t,i){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",n,t,i)},queryIds:function(n,t,i){return this._query("executeForIds","onQueryIdsComplete",n,t,i)},queryCount:function(n,t,i){return this._query("executeForCount","onQueryCountComplete",n,t,i)},queryExtent:function(n,t,i){return this._query("executeForExtent","onQueryExtentComplete",n,t,i)},queryAttachmentInfos:function(n,t,i){var s=this._url.path+"/"+n+"/attachments",e=new o(d._dfdCanceller),r=this;return e._pendingDfd=b({url:s,content:u.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(i){i=i.attachmentInfos;var u;f.forEach(i,function(t){u=c.objectToQuery({gdbVersion:r._url.query&&r._url.query.gdbVersion,layer:r._url.query&&r._url.query.layer,token:r._getToken()});t.url=s+"/"+t.id+(u?"?"+u:"");t.objectId=n});r._resolve([i],"onQueryAttachmentInfosComplete",t,e)},error:function(n){r._resolve([n],null,i,e,!0)}}),e},addAttachment:function(n,t,i,r){return this._sendAttachment("add",n,t,i,r)},updateAttachment:function(n,t,i,r,u){return i.appendChild(l.create("input",{type:"hidden",name:"attachmentId",value:t})),this._sendAttachment("update",n,i,r,u)},deleteAttachments:function(n,t,i,r){var h=this._url.path+"/"+n+"/deleteAttachments",e=new o(d._dfdCanceller),s=this;return t={f:"json",attachmentIds:t.join(",")},e._pendingDfd=b({url:h,content:u.mixin(t,this._url.query),callbackParamName:"callback",load:u.hitch(this,function(t){t=t.deleteAttachmentResults;t=f.map(t,function(t){return t=new ni(t),t.attachmentId=t.objectId,t.objectId=n,t});s._resolve([t],"onDeleteAttachmentsComplete",i,e)}),error:function(n){s._resolve([n],null,r,e,!0)}},{usePost:!0}),e},addType:function(n){var t=this.types;if(t){if(f.some(t,function(t){return t.id==n.id?!0:!1}))return!1;t.push(n)}else this.types=[n];return this._typesDirty=!0},deleteType:function(n){var t,i;if(this._collection&&(t=this.types,t&&(i=-1,f.some(t,function(t,r){return t.id==n?(i=r,!0):!1}),-1<i)))return this._typesDirty=!0,t.splice(i,1)[0]},toJson:function(){var n=this._json;if(n=u.isString(n)?e.fromJson(n):u.clone(n)){var n=n.layerDefinition?n:{layerDefinition:n},i=n.layerDefinition,s=this._collection;if(s&&this._typesDirty){i.types=f.map(this.types||[],function(n){return n.toJson()});var t=this.renderer,r=this.labelingInfo,o=i.drawingInfo;(t||r)&&!o&&(o=i.drawingInfo={});o&&t&&-1===t.declaredClass.indexOf("TemporalRenderer")&&(o.renderer=t.toJson());r&&(o.labelingInfo=f.map(r,function(n){return n.toJson()}))}return t=null,(!s||this._fcAdded)&&(t={geometryType:i.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)}),n.featureSet=u.mixin({},n.featureSet||{},t),n.featureSet.transform&&(r=n.featureSet.transform,delete n.featureSet.transform,t=new ct(n.featureSet),t.quantize(r),n.featureSet=t.toJson()),s&&(n.nextObjectId=this._nextId,i.capabilities=this.capabilities),n}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onAggregationRendererChange:function(){},onAggregationInfoChange:function(){},_forceIdentity:function(n){var u=this,i,r=this._url&&this._url.path,t;i=r&&r.toLowerCase().indexOf("/rest/services");t=this.editFieldsInfo;t=t&&(t.creatorField||t.editorField);(this.userIsAdmin||t)&&!this._getToken()&&-1<i&&p.id?(i=r.substring(0,i)+"/rest/info",b({url:i,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(n){if(n.owningSystemUrl)return p.id.checkSignInStatus(n.owningSystemUrl+"/sharing")}).then(function(n){if(n)return p.id.getCredential(r)}).then(function(n){n&&u._findCredential()}).always(function(){n.call(u)})):n.call(this)},_checkMode:function(n){var t=this.geometryType,i=this.maxRecordCount;n=(n=n&&n.features&&n.features[0])&&n.attributes&&n.attributes.exceedslimit;this.mode===ci.MODE_AUTO&&!this.isEditable()&&0===n&&(this.queryPagination||("esriGeometryPolyline"===t||"esriGeometryPolygon"===t||"esriGeometryMultipoint"===t||this.hasXYFootprint())&&i>=this.maxRecordCountForAuto||"esriGeometryPoint"===t&&i>=this.maxPointCountForAuto)&&(this.currentMode=ci.MODE_SNAPSHOT,this._mode=new ii(this),this._isSnapshot=this._autoSnapshot=!0)},_queryLimit:function(){var n=this,t=new o;this._limitPromise=t.promise;setTimeout(function(){var r=new ht,i=new lt;i.statisticType="exceedslimit";i.maxPointCount=n.maxPointCountForAuto;i.maxRecordCount=n.maxRecordCountForAuto;i.maxVertexCount=n.maxVertexCountForAuto;i.outStatisticFieldName="exceedslimit";r.outStatistics=[i];n.queryFeatures(r).promise.then(function(n){t.resolve(n)},function(n){t.reject(n)})},0)},_updateCaps:function(){var n=this._editable,t=u.trim(this.capabilities||""),e=f.map(t?t.split(","):[],u.trim),i=f.map(t?t.toLowerCase().split(","):[],u.trim),t=f.indexOf(i,"editing"),r,i={Create:f.indexOf(i,"create"),Update:f.indexOf(i,"update"),Delete:f.indexOf(i,"delete")};if(n&&-1===t)e.push("Editing");else if(!n&&-1<t){n=[t];for(r in i)-1<i[r]&&n.push(i[r]);for(n.sort(),r=n.length-1;0<=r;r--)e.splice(n[r],1)}this.capabilities=e.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var n=this._mode;n&&n.suspend()},onResume:function(n){this.inherited(arguments);this._toggleTime(!0);var u=this._mode,i=this._map,t=this._getRenderer();n.firstOccurrence?(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalClusterManager(),this.timeInfo&&!this._trackManager&&(this._trackIdField||t&&(t.latestObservationRenderer||t.trackRenderer))&&(this._trackManager=new ei(this),this._trackManager.initialize(i),this._childLayer=this._trackManager.container),t&&"colors"in t&&"blurRadius"in t&&"maxPixelIntensity"in t&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new oi(this),this._heatmapManager.initialize(i)),this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset()&&(t=this.generalizeForScale,this._calculatedScale=t=this.maxScale?this.maxScale:this.minScale?Math.min(t,this.minScale):Math.min(t,pt.getScale(i,this.initialExtent)),this._calcMaxOffset=i.extent.getWidth()/i.width/i.getScale()*t),this._zoomConnect=r.connect(i,"onZoomEnd",this,this._zoomEndHandler),this._updateMaxOffset(),this._needsRefresh=!1,u&&(u._init||u.initialize(i),u.startup())):(this._zoomEndHandler(),u&&u.resume())},_zoomEndHandler:function(){var n=this._map;this._updateMaxOffset();this._prevScale=n.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var n=this._map;n&&n.loaded&&this._autoGeneralize&&(this._autoSnapshot?(n=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=n!=this.getMaxAllowableOffset())):this._setMaxOffset(n.extent.getWidth()/n.width,!n.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var i=this._map.getScale(),n=this._calculatedScale,r=this._calcMaxOffset,t=this._prevScale;return i>=n&&(null==t||t<n)?r:i<n&&(null==t||t>=n)?null:this.getMaxAllowableOffset()}},_toggleTime:function(n){var t=this._map;n&&this.timeInfo&&this.useMapTime&&t?(this._mapTimeExtent=t.timeExtent,this._timeConnect||(this._timeConnect=r.connect(t,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,r.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(n){this._mapTimeExtent=n;(n=this._mode)&&n.propertyChangeHandler(0)},_getOffsettedTE:function(n){var t=this._timeOffset,i=this._timeOffsetUnits;return n&&t&&i?n.offset(-1*t,i):n},_getTimeOverlap:function(n,t){return n&&t?n.intersection(t):n||t},_getTimeFilter:function(n){var i=this.getTimeDefinition(),t;if(i&&(t=this._getTimeOverlap(i,null),!t))return[!1];if(n){if(n=t?this._getTimeOverlap(n,t):n,!n)return[!1]}else n=t;return[!0,n]},_getAttributeFilter:function(n){var t=this.getDefinitionExpression();return n?t?"("+t+") AND ("+n+")":n:t},_applyQueryFilters:function(n,t){if(n.where=this._getAttributeFilter(n.where),!n.returnGeometry||n.maxAllowableOffset||n.quantizationParameters||(n.maxAllowableOffset=this._maxOffset,n.quantizationParameters=this._quantizationParameters),t&&this.supportsAdvancedQueries&&(n.orderByFields=n.orderByFields||this.getOrderByFields()),this.timeInfo){var i=this._getTimeFilter(n.timeExtent);if(i[0])n.timeExtent=i[1];else return!1}return!0},_add:function(n){var r=this._selectionSymbol,t=n.attributes,i=this.visibilityField;return r&&this._isSelOnly&&n.setSymbol(r),i&&t&&t.hasOwnProperty(i)&&n[t[i]?"show":"hide"](),this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(n){var t=[],i=this._map,r,o,u;if((this._collection||!this._isTable&&i)&&!(n.text||n.where&&n.where!==this.getDefinitionExpression()||n.orderByFields&&n.orderByFields.length&&(r=this.getOrderByFields()||[])&&n.orderByFields.join()!==r.join()||n.outStatistics||n.returnDistinctValues)){if(r=this._isSnapshot,o=this._isSelOnly,u=n.geometry,u){if(o||n.spatialRelationship!==ht.SPATIAL_REL_INTERSECTS||"extent"!==u.type||!r&&!i.extent.contains(u))return;t.push(1)}if(i=n.objectIds)if(r)t.push(2);else{for(var u=i.length,h=this._mode,s=0,e=0;e<u;e++)h._getFeature(i[e])&&s++;if(s===u)t.push(2);else return}if(this.timeInfo)if(n=n.timeExtent,i=this._mapTimeExtent,r)n&&t.push(3);else if(o){if(n)return}else if(i)if(-1!==f.indexOf(t,2))n&&t.push(3);else if(-1!==f.indexOf(t,1))n==i&&t.push(3);else return;else if(0<t.length)n&&t.push(3);else if(n)return;return 0<t.length?t:null}},_getAbsMid:function(i){return n.toAbsMid?n.toAbsMid(i):t.id.replace(/\/[^\/]*$/ig,"/")+i},_doQuery:function(n,t,i){var r=[],a=this.objectIdField,v=this,y=new o,e=new o,l=this.graphics,s,c,h;return-1!==f.indexOf(t,1)?(s=this.spatialIndex||this._map&&this._map.spatialIndex,h=n.geometry._normalize(null,!0),null==s&&li.autoSpatialIndexing?c=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(u.hitch(this,u.partial(this._getFromIndex,h,s)),function(){e.resolve(u.hitch(this,u.partial(this._filterByExtent,l,h)))}):s&&(c=this._getFromIndex(h,s)),c?c.then(function(n){for(var t=0;t<n.length;t++)n[t].results&&(r=r.concat(n[t].results));e.resolve(r)}).otherwise(function(n){e.reject(n)}):e.resolve(this._filterByExtent(l,h))):e.resolve(l),e.then(function(u){if(r=u,-1!==f.indexOf(t,2)){var e=n.objectIds;r=f.filter(r,function(n){return-1<f.indexOf(e,n.attributes[a])})}-1!==f.indexOf(t,3)&&v.timeInfo&&(u=n.timeExtent,r=v._filterByTime(r,u.startTime,u.endTime).match);i&&(r=f.map(r,function(n){return n.attributes[a]},this));y.resolve(r)}),y},_getFromIndex:function(n,t){t=t||this.spatialIndex||this._map.spatialIndex;n instanceof Array||(n=[n]);var i=this.id;return y(f.map(n,function(n){return t.intersects(n,i)}))},_filterByExtent:function(n,t){for(var r,i,u=[],f=0,e=n.length;f<e;f++)r=n[f],i=r.geometry,i&&(this.normalization&&t.length?(t[0].intersects(i)||t[1].intersects(i))&&u.push(r):t.intersects(i)&&u.push(r));return u},_filterByTime:function(n,t,i){var o=this._startTimeField,c=this._endTimeField,u;this._twoTimeFields||(u=o||c);var l=w.isDefined,s=[],h=[],f,a=n.length,e,r;if(t=t?t.getTime():-Infinity,i=i?i.getTime():Infinity,u)for(f=0;f<a;f++)e=n[f],r=e.attributes,o=r[u],o>=t&&o<=i?s.push(e):h.push(e);else for(f=0;f<a;f++)e=n[f],r=e.attributes,u=r[o],r=r[c],u=l(u)?u:-Infinity,r=l(r)?r:Infinity,u>=t&&u<=i||r>=t&&r<=i||t>=u&&i<=r?s.push(e):h.push(e);return{match:s,noMatch:h}},_getSizeVariables:function(n){return n&&f.filter(n.getVisualVariablesForType("sizeInfo",!1),function(n){return!(!n.field&&!n.valueExpression)})},_needClientSideSorting:function(n){return this._collection?!(!n||!n.length):f.some(n,function(n){return!!n.valueExpression})},_sortFeatures:function(n){var i=this.renderer,u=this._getSizeVariables(i),r,t;return n&&1<n.length&&this._needClientSideSorting(u)&&(r=u[0],t=this,n.sort(function(n,u){n._layer||(n._layer=t);u._layer||(u._layer=t);var f=i._getDataValue(n,r,"sizeInfo",null,t),e=i._getDataValue(u,r,"sizeInfo",null,t);return null==f?-1:null==e?1:e-f})),n},_resolve:function(n,t,i,r,u){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&d._resDfd(r,n,u)},_getShallowClone:function(n){var i=new ht;for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},_query:function(n,t,i,r,u){var c=this,l=this._map,s=new o(d._dfdCanceller),e=i,y,p,w,a,h;if("executeRelationshipQuery"!==n){if(e=this._getShallowClone(i),a=this.getOutFields(),e.outFields||(e.outFields=a),e.outFields&&e.outFields.length&&(p=-1<f.indexOf(a,"*")?!1:!f.every(e.outFields,function(n){return-1<f.indexOf(a,n)})),e.returnGeometry=i.hasOwnProperty("returnGeometry")?i.returnGeometry:!i.outStatistics,e.returnGeometry&&(e.multipatchOption=this.multipatchOption,(e.maxAllowableOffset||e.quantizationParameters)&&(i=e.maxAllowableOffset||e.quantizationParameters.tolerance)&&i!==this.getMaxAllowableOffset()&&(w=!0)),l&&(l=l&&l.spatialReference,(i=e.outSpatialReference)?y=!i.equals(l):e.outSpatialReference=new g(l.toJson())),!this._applyQueryFilters(e,"execute"===n&&!e.outStatistics)){switch(n){case"execute":h=new ct({features:[]});break;case"executeForIds":h=[];break;case"executeForCount":h=0;break;case"executeForExtent":h={}}return this._resolve([h],t,r,s),s}if(l="executeForExtent"!==n&&!y&&!p&&!w&&this._canDoClientSideQuery(e))return s._pendingDfd=v(this._doQuery(e,l,"executeForIds"===n||"executeForCount"===n)),s._pendingDfd.then(function(i){switch(n){case"execute":h=new ct;h.features=i;break;case"executeForIds":h=i;break;case"executeForCount":h=i.length}c._resolve([h],t,r,s)}),s}return this._collection?(this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,u,s,!0),s):this.loaded&&!this.isQueryable()?(this._resolve([Error("Layer does not support query capability.")],null,u,s,!0),s):(this._ts&&(e._ts=(new Date).getTime()),(s._pendingDfd=this._task[n](e)).addCallbacks(function(i){var h=!!e.outStatistics||y||p||w,f,u,o;if("execute"===n||"executeRelationshipQuery"===n)if("execute"===n)for(f=i.features,u=f.length,--u;0<=u;u--)(f[u]._layer=c,h||c._isTable)||(o=c._mode._getFeature(f[u].attributes[c.objectIdField]),o&&f.splice(u,1,o));else for(o in i)if(i.hasOwnProperty(o))for(f=i[o].features,u=f.length,--u;0<=u;u--)f[u]._layer=c;c._resolve([i],t,r,s)},function(n){c._resolve([n],null,u,s,!0)}),s)},_convertFeaturesToJson:function(n,t,i,r){var l=[],p=this._selectionSymbol,v=this.visibilityField,h,w=this.objectIdField;for(this.loaded&&(i||r)&&(h=f.filter(this.fields,function(n){return!1===n.editable&&(!r||n.name!==w)})),i=0;i<n.length;i++){var c=n[i],o={},y=c.geometry,s=c.attributes,a=c.symbol;!y||r&&this.loaded&&!this.allowGeometryUpdates||(o.geometry=y.toJson());v?(o.attributes=s=u.mixin({},s),s[v]=c.visible?1:0):s&&(o.attributes=u.mixin({},s));o.attributes&&h&&h.length&&f.forEach(h,function(n){delete o.attributes[n.name]});a&&a!==p&&(o.symbol=a.toJson());l.push(o)}return t?l:e.toJson(l)},_selectHandler:function(n,t,i,r,u){var f;r=ci;switch(t){case r.SELECTION_NEW:this.clearSelection(!0);f=!0;break;case r.SELECTION_ADD:f=!0;break;case r.SELECTION_SUBTRACT:f=!1}r=n.features;var s=this._mode,h=[],c=this.objectIdField,e,o;if(f)for(f=0;f<r.length;f++)e=r[f],o=e.attributes[c],e=s._addFeatureIIf(o,e),h.push(e),this._selectFeatureIIf(o,e,s);else for(f=0;f<r.length;f++)e=r[f],o=e.attributes[c],this._unSelectFeatureIIf(o,s),o=s._removeFeatureIIf(o),h.push(o||e);this._isSelOnly&&s._applyTimeFilter(!0);this._hasPartialSelectedFeatures=!!n.exceededTransferLimit;this._resolve([h,t,n.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",i,u);n.exceededTransferLimit&&this.onQueryLimitExceeded()},_selectFeatureIIf:function(n,t,i){var r=this._selectedFeatures,u=r[n];return u||(i._incRefCount(n),r[n]=t,this._isTable||(this._setSelectSymbol(t),t.attr("data-selected",""))),u||t},_unSelectFeatureIIf:function(n,t){var i=this._selectedFeatures[n];return i&&(t._decRefCount(n),delete this._selectedFeatures[n],this._isTable||(this._setUnSelectSymbol(i),i.attr("data-selected"))),i},_isSelected:function(){},_setSelectSymbol:function(n){var t=this._selectionSymbol;t&&!this._isSelOnly&&n.setSymbol(t)},_setUnSelectSymbol:function(n){var t=this._selectionSymbol;t&&!this._isSelOnly&&t===n.symbol&&n.setSymbol(null,!0)},_getOutFields:function(){var t=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes),t=f.filter(t,function(n,t,i){return!!n&&f.indexOf(i,n)===t}),n=u.clone(this._outFields);return n?-1!==f.indexOf(n,"*")?n:(f.forEach(t,function(t){-1===f.indexOf(n,t)&&n.push(t)}),n):t},_checkFields:function(n){var t=n||this._getOutFields();f.forEach(t,function(n){"*"!==n&&(this._getField(n)||console.debug("esri.layers.FeatureLayer: "+w.substitute({url:this.url,field:n},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);n||this._isTable||this._fserver||this._collection||this._isStream||f.some(this.fields,function(n){return n&&"esriFieldTypeGeometry"===n.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+w.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},_fixFieldCase:function(n,t,i){var r=n&&n[t],f;return r&&!u.isFunction(r)&&((f=!this._getField(r)&&this._getField(r,!0))&&(r=n[t]=f.name),i&&i.push(r)),r},_fixRendererFields:function(){var t=this.renderer;if(this._orderBy=null,this._requiredFields=[],t&&0<this.fields.length){var n=[],i,t=f.filter([t,t.observationRenderer,t.latestObservationRenderer,t.trackRenderer],w.isDefined),r=[].concat(t);f.forEach(t,function(n){f.forEach(n.rendererInfos,function(n){n.renderer&&r.push(n.renderer)})});f.forEach(r,function(t){this._fixFieldCase(t,"attributeField",n);this._fixFieldCase(t,"attributeField2",n);this._fixFieldCase(t,"attributeField3",n);this._fixFieldCase(t.rotationInfo,"field",n);(i=this._fixFieldCase(t.sizeInfo,"field",n))&&!this._orderBy&&(this._orderBy=[i+" DESC"]);this._fixFieldCase(t.sizeInfo,"normalizationField",n);this._fixFieldCase(t.colorInfo,"field",n);this._fixFieldCase(t.colorInfo,"normalizationField",n);this._fixFieldCase(t.field,"field",n);this._fixFieldCase(t.opacityInfo,"field",n);this._fixFieldCase(t.opacityInfo,"normalizationField",n);f.forEach(t.visualVariables,function(t){i=this._fixFieldCase(t,"field",n);"sizeInfo"===t.type&&i&&!this._orderBy&&(this._orderBy=[i+" DESC"]);this._fixFieldCase(t,"normalizationField",n)},this);var r=f.map(t.getFieldsUsedInExpressions(),function(n){var t=this.getField(n);return t?t.name:n},this);n=n.concat(r);!this._orderBy&&t.addBreak&&!u.isFunction(t.attributeField)&&(t.backgroundFillSymbol||this._hasSizeDiff(t))&&(this._orderBy=[t.attributeField+" DESC"])},this);this._requiredFields=f.filter(n,w.isDefined)}},_hasSizeDiff:function(n){var r=Number.MAX_VALUE,u=-Number.MAX_VALUE,t,i;return f.forEach(n.infos,function(n){if(i=n.symbol){t=0;switch(i.type){case"simplemarkersymbol":t=i.size;break;case"picturemarkersymbol":t=(i.width+i.height)/2;break;case"simplelinesymbol":case"cartographiclinesymbol":t=i.width;break;case"simplefillsymbol":case"picturefillsymbol":t=i.outline&&i.outline.width}t&&(r=Math.min(r,t),u=Math.max(u,t))}}),r!==Number.MAX_VALUE&&u!==-Number.MAX_VALUE&&1<Math.abs(u-r)},getOrderByFields:function(){var n=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&n?f.filter(n,function(n){return n=n.split(" ")[0],!!this._getField(n,!0)},this):null},_getField:function(n,t){var i=this.fields,r;return!i||0===i.length?null:(t&&(n=n.toLowerCase()),f.some(i,function(i){var u=!1;return(u=t?i&&i.name.toLowerCase()===n?!0:!1:i&&i.name===n?!0:!1)&&(r=i),u}),r)},_getDateOpts:function(){return this._dtOpts||(this._dtOpts={properties:f.map(f.filter(this.fields,function(n){return!(!n||"esriFieldTypeDate"!==n.type)}),function(n){return n.name})}),this._dtOpts},_applyNormalized:function(n,t){n&&t&&f.forEach(n,function(n,i){n&&t[i]&&n.setGeometry(t[i])})},_editHandler:function(n,t,i,r,e,o){var p,g,w,tt;e=n.addResults;p=n.updateResults;n=n.deleteResults;var s,a,l,h,c,it=this.objectIdField,b=this._mode,nt=this._isTable;s=this.editFieldsInfo;h=this.getOutFields()||[];var k=s&&s.creatorField,d=s&&s.creationDateField,v=s&&s.editorField,y=s&&s.editDateField;if(s=s&&s.realm,-1===f.indexOf(h,"*")&&(k&&-1===f.indexOf(h,k)&&(k=null),d&&-1===f.indexOf(h,d)&&(d=null),v&&-1===f.indexOf(h,v)&&(v=null),y&&-1===f.indexOf(h,y)&&(y=null)),g=d||y?(new Date).getTime():null,w=k||v?this.getUserId():void 0,w&&s&&(w=w+"@"+s),e)for(tt=this.globalIdField,s=0;s<e.length;s++)e[s]=new ni(e[s]),nt||(a=e[s],a.success&&(l=a.objectId,h=t[s],(c=h._graphicsLayer)&&c!==this&&c.remove(h),c=h.attributes||{},c[it]=l,l=a.globalId,tt&&l&&(c[tt]=l),k&&(c[k]=w),v&&(c[v]=w),d&&(c[d]=g),y&&(c[y]=g),h.setAttributes(c),b._init&&b.drawFeature(h)));if(p)for(s=0;s<p.length;s++)(p[s]=new ni(p[s]),!nt&&(a=p[s],a.success))&&(l=a.objectId,h=i[l],(t=b._getFeature(l))&&(t.geometry!==h.geometry&&h.geometry&&t.setGeometry(vt.fromJson(h.geometry.toJson())),t.attributes!==h.attributes&&h.attributes&&t.setAttributes(u.mixin(t.attributes,h.attributes)),this._repaint(t,l)),h=t||h,c=h.attributes||{},v&&(c[v]=w),y&&(c[y]=g),h.setAttributes(c));if(n){for(i=[],s=0;s<n.length;s++)(n[s]=new ni(n[s]),!nt&&(a=n[s],a.success&&(l=a.objectId,h=b._getFeature(l))))&&(this._unSelectFeatureIIf(l,b)&&i.push(h),h._count=0,b._removeFeatureIIf(l));if(0<i.length)this.onSelectionComplete(i,ci.SELECTION_SUBTRACT)}this._resolve([e,p,n],"onEditsComplete",r,o)},_sendAttachment:function(n,t,i,r,f){var e=this;return b({url:this._url.path+"/"+t+"/"+("add"===n?"addAttachment":"updateAttachment"),form:i,content:u.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(i){var u="add"===n?"onAddAttachmentComplete":"onUpdateAttachmentComplete";return i=new ni(i["add"===n?"addAttachmentResult":"updateAttachmentResult"]),i.attachmentId=i.objectId,i.objectId=t,e._resolve([i],u,r),i}).addErrback(function(n){e._resolve([n],null,f,null,!0)})},_repaint:function(n,t,i){t=w.isDefined(t)?t:n.attributes[this.objectIdField];t in this._selectedFeatures&&this._selectionSymbol||n.setSymbol(n.symbol,i)},_getKind:function(n){var t=this._trackManager;return t?t.isLatestObservation(n)?1:0:0}});return u.mixin(ci,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"}),yt._createWrappers(ci),h("extend-esri")&&u.setObject("layers.FeatureLayer",ci,p),ci})},"esri/layers/GeoRSSLayer":function(){require({cache:{"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){return n=n([a],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(n,t){this.pointSymbol=t&&t.pointSymbol;this.polylineSymbol=t&&t.polylineSymbol;this.polygonSymbol=t&&t.polygonSymbol;this._outSR=t&&(t.outSpatialReference||t.outSR)||new s({wkid:4326});this._options=i.mixin({},t)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var n=[];return this._fLayers&&(n=n.concat(this._fLayers)),n},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._createLayer()},_createLayer:function(n){var t=this;this._fireUpdateStart();n=this.parse(n);n.addCallback(function(n){t._io=null;t._initLayer(n)});n.addErrback(function(n){t._io=null;n=i.mixin(Error(),n);n.message="Unable to load resource: "+t.url+" "+(n.message||"");t._fireUpdateEnd(n);t.onError(n)})},_initLayer:function(n){this.loaded&&this._removeInternalLayers();this.name=n.name;this.description=n.description;this.snippet=n.snippet;this.featureInfos=n.featureInfos;this.fullExtent=this.initialExtent=new h(n.lookAtExtent);this.copyright=n.author||n.copyright;var t;(n=i.getObject("featureCollection.layers",!1,n))&&0<n.length&&(this._fLayers=[],r.forEach(n,function(n,r){var u=i.getObject("featureSet.features",!1,n);u&&0<u.length&&(t=i.mixin({outFields:["*"],infoTemplate:n.popupInfo?new y(n.popupInfo):null,editable:!1},this._options),t.id&&(t.id=t.id+"_"+r),n.layerDefinition.capabilities="Query,Data",u=new v(n,t),u.geometryType&&(this["_"+u.geometryType]=u),this._fLayers.push(u))},this),0===this._fLayers.length&&delete this._fLayers);this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(n=new l(this.pointSymbol),this._esriGeometryPoint.setRenderer(n)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(n=new l(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(n)));this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(n=new l(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(n)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var u=this._map,n,t,i;if(this._fireUpdateStart(),n=u.spatialReference,t=this._outSR,n.wkid)i=n._isWebMercator()&&t._isWebMercator()||n.wkid===t.wkid;else if(n.wkt)i=n.wkt===t.wkt;else{console.log("_setMap - map has invalid spatial reference");return}if(!i)if(n._isWebMercator()&&4326===t.wkid)this._converter=c.geographicToWebMercator;else if(t._isWebMercator()&&4326===n.wkid)this._converter=c.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(n=this._fLayers)&&0<n.length&&r.forEach(n,function(n){if(this._converter)for(var i=n.graphics,r,f=i?i.length:0,t=0;t<f;t++)(r=i[t].geometry)&&i[t].setGeometry(this._converter(r));u.addLayer(n)},this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var n=this._map;n&&r.forEach(this.getFeatureLayers(),n.removeLayer,n)},setScaleRange:function(n,t){this.inherited(arguments);r.forEach(this.getFeatureLayers(),function(i){i.setScaleRange(n,t)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(n){this.opacity!=n&&(r.forEach(this.getFeatureLayers(),function(t){t.setOpacity(n)}),this.opacity=this._options.opacity=n,this.onOpacityChange(n))},onVisibilityChange:function(n){this._fireUpdateStart();r.forEach(this.getFeatureLayers(),function(t){t.setVisibility(n)});this._fireUpdateEnd()},_setMap:function(n,t){this.inherited(arguments);this._map=n;var i=this._div=u.create("div",null,t);return f.set(i,"position","absolute"),this._addInternalLayers(),this.evaluateSuspension(),i},_unsetMap:function(n,i){this._io&&this._io.cancel();t.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var r=this._div;r&&(i.removeChild(r),u.destroy(r));this._div=null;this.inherited(arguments)}}),e("extend-esri")&&i.setObject("layers._ServiceGeneratedFeatureCollection",n,o),n})},"*noref":1}});define("esri/layers/GeoRSSLayer","dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ../urlUtils ./ServiceGeneratedFeatureCollection".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n([s],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:o.getProtocolForWebResource()+"//utility.arcgis.com/sharing/rss",constructor:function(){f.defaults.geoRSSService&&(this.serviceUrl=f.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=e({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?i.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(){this.inherited(arguments);this.loaded||(this.loaded=!0,this.onLoad(this))}}),r("extend-esri")&&t.setObject("layers.GeoRSSLayer",n,u),n})},"esri/layers/KMLLayer":function(){require({cache:{"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(n){t.mixin(this,n);u.isDefined(this.visibility)&&(this.visible=!!this.visibility)}}),i("extend-esri")&&t.setObject("layers.KMLFolder",n,r),n})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),function(n,t,i,r,u,f){return n=n([f],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(){u.isDefined(this.visibility)&&(this.visible=!!this.visibility)}}),i("extend-esri")&&t.setObject("layers.KMLGroundOverlay",n,r),n})},"*noref":1}});define("esri/layers/KMLLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){var it=t([k],{declaredClass:"esri.layers.KMLLayer",serviceUrl:y.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(n,t){n||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=t&&t.outSR||new p({wkid:4326});this._options=r.mixin({},t);l.defaults.kmlService&&(this.serviceUrl=l.defaults.kmlService);var i=this.linkInfo=t&&t.linkInfo;i&&(this.visible=!!i.visibility,this._waitingForMap=!!i.viewFormat);(!i||i&&i.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=r.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(n){var f,e,t,i;if(n){i=n.type;f=n.id;switch(i){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":(n=this["_"+i])&&(e=r.getObject("_mode._featureMap."+f,!1,n));break;case"GroundOverlay":if(n=this._groundLyr)for(t=n.getImages(),i=t.length,n=0;n<i;n++)if(t[n].id===f){e=t[n];break}break;case"ScreenOverlay":break;case"NetworkLink":u.some(this._links,function(n){return n.linkInfo&&n.linkInfo.id===f?(e=n,!0):!1});break;case"Folder":for(i=(t=this.folders)?t.length:0,n=0;n<i;n++)if(t[n].id===f){e=t[n];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return e}},getLayers:function(){var n=[];return this._groundLyr&&n.push(this._groundLyr),this._fLayers&&(n=n.concat(this._fLayers)),this._links&&u.forEach(this._links,function(t){t.declaredClass&&n.push(t)}),n},setFolderVisibility:function(n,t){n&&(this._fireUpdateStart(),(n.visible=t)&&(t=this._areLocalAncestorsVisible(n)),this._setState(n,t),this._fireUpdateEnd())},onRefresh:function(){},onOpacityChange:function(){},_parseKml:function(n){var t=this;this._fireUpdateStart();this._io=v({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(n),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:f.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(n){t._io=null;t._initLayer(n)},error:function(n){t._io=null;n=r.mixin(Error(),n);n.message="Unable to load KML: "+(n.message||"");t._fireUpdateEnd(n);t.onError(n)}})},_initLayer:function(n){var h,t,e,s,o,i,f;if(this.loaded&&(h=[],u.forEach(this.folders,function(n){n.visible&&h.push(n.id)}),this._options.minScale=this.minScale,this._options.maxScale=this.maxScale,this._options.opacity=this.opacity,this._removeInternalLayers()),this.name=n.name,this.description=n.description,this.snippet=n.snippet,this.visibility=n.visibility,this.featureInfos=n.featureInfos,i=this.folders=n.folders,s=[],i)for(e=i.length,t=0;t<e;t++)o=i[t]=new d(i[t]),-1===o.parentFolderId&&s.push(o);for(i=this._links=n.networkLinks,e=i?i.length:0,t=0;t<e;t++)i[t].viewRefreshMode&&-1!==i[t].viewRefreshMode.toLowerCase().indexOf("onregion")||(f=r.mixin({},this._options),f.linkInfo=i[t],f.id&&(f.id=f.id+"_"+t),i[t]=new it(i[t].href,f),i[t]._parentLayer=this,i[t]._parentFolderId=this._getLinkParentId(i[t].linkInfo.id));if((i=n.groundOverlays)&&0<i.length)for(f=r.mixin({},this._options),f.id&&(f.id+="_mapImage"),o=this._groundLyr=new nt(f),e=i.length,t=0;t<e;t++)o.addImage(new g(i[t]));if((n=r.getObject("featureCollection.layers",!1,n))&&0<n.length&&(this._fLayers=[],u.forEach(n,function(n,t){var i=r.getObject("featureSet.features",!1,n);i&&0<i.length&&(f=r.mixin({outFields:["*"],infoTemplate:n.popupInfo?new b(n.popupInfo):null,editable:!1},this._options),f.id&&(f.id=f.id+"_"+t),n.layerDefinition.capabilities="Query,Data",i=new tt(n,f),i.geometryType&&(this["_"+i.geometryType]=i),this._fLayers.push(i))},this),0===this._fLayers.length&&delete this._fLayers),!this.loaded)for(e=s.length,t=0;t<e;t++)o=s[t],this._setState(o,o.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),u.forEach(this.folders,function(n){-1<u.indexOf(h,n.id)?this.setFolderVisibility(n,!0):this.setFolderVisibility(n,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var t=this._map,n,r,i;if(this._fireUpdateStart(),this._links&&u.forEach(this._links,function(n){n.declaredClass&&(t.addLayer(n),n._waitingForMap&&(n._waitingForMap=null,n.visible?n._parseKml(t):n._wMap=t))}),n=t.spatialReference,r=this._outSR,!n.equals(r))if(n.isWebMercator()&&4326===r.wkid)i=w.geographicToWebMercator;else if(r.isWebMercator()&&4326===n.wkid)i=w.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return}this._groundLyr&&(i&&u.forEach(this._groundLyr.getImages(),function(n){n.extent=i(n.extent)}),t.addLayer(this._groundLyr));(n=this._fLayers)&&0<n.length&&u.forEach(n,function(n){if(i)for(var u=n.graphics,f,e=u?u.length:0,r=0;r<e;r++)(f=u[r].geometry)&&u[r].setGeometry(i(f));t.addLayer(n)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var n=this._map;this._links&&u.forEach(this._links,function(n){n.declaredClass&&n._io&&n._io.cancel()});n&&u.forEach(this.getLayers(),n.removeLayer,n)},_setState:function(n,t){for(var f=n.featureInfos,r,i,e=f?f.length:0,o=t?"show":"hide",u=0;u<e;u++)(r=f[u],i=this.getFeature(r))&&("Folder"===r.type?this._setState(i,t&&i.visible):"NetworkLink"===r.type?this._setInternalVisibility(i,t):i[o]())},_areLocalAncestorsVisible:function(n){var t=n.parentFolderId;for(n=n.visible;n&&-1!==t;)t=this.getFeature({type:"Folder",id:t}),n=n&&t.visible,t=t.parentFolderId;return n},_setInternalVisibility:function(n,t){var i=n._parentLayer,r=n._parentFolderId;for(t=t&&n.visible;t&&i;)t=t&&i.visible,-1<r&&(t=t&&i._areLocalAncestorsVisible(i.getFeature({type:"Folder",id:r}))),r=i._parentFolderId,i=i._parentLayer;this._setIntState(n,t)},_setIntState:function(n,t){n&&u.forEach(n.getLayers(),function(i){i.linkInfo?n._setIntState(i,t&&i.visible&&n._areLocalAncestorsVisible(n.getFeature({type:"Folder",id:i._parentFolderId}))):i.setVisibility(t)})},_getLinkParentId:function(n){var t=-1;return this.folders&&u.some(this.folders,function(i){return i.networkLinkIds&&-1!==u.indexOf(i.networkLinkIds,n)?(t=i.id,!0):!1}),t},_checkAutoRefresh:function(){var n=this.linkInfo;if(n)if(this.visible){if(this.loaded&&this._map){var t=n.refreshMode,r=n.refreshInterval,u=n.viewRefreshMode,n=n.viewRefreshTime;t&&-1!==t.toLowerCase().indexOf("oninterval")&&0<r&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1e3*r));u&&-1!==u.toLowerCase().indexOf("onstop")&&0<n&&!this._extChgHandle&&(this._extChgHandle=i.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),i.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(t){var l,s,v;t=t||this._map;var e={},s=this.linkInfo,i=t&&t.extent,u;if(this._url.query&&(r.mixin(e,this._url.query),u=!!this._url.query.token),c.id&&!u&&(u=c.id.findCredential(this._url.path))&&(e.token=u.token),s){if(u=s.viewFormat,l=s.httpQuery,s=s.viewBoundScale,i&&u){var f=i,h=i,y=i.spatialReference;y&&(y.isWebMercator()?f=w.webMercatorToGeographic(i):4326===y.wkid&&(h=w.geographicToWebMercator(i)));i=f.getCenter();h=Math.max(h.getWidth(),h.getHeight());s&&(f=f.expand(s));u=u.replace(/\[bboxWest\]/ig,f.xmin).replace(/\[bboxEast\]/ig,f.xmax).replace(/\[bboxSouth\]/ig,f.ymin).replace(/\[bboxNorth\]/ig,f.ymax).replace(/\[lookatLon\]/ig,i.x).replace(/\[lookatLat\]/ig,i.y).replace(/\[lookatRange\]/ig,h).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,i.x).replace(/\[lookatTerrainLat\]/ig,i.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,i.x).replace(/\[cameraLat\]/ig,i.y).replace(/\[cameraAlt\]/ig,h).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,t.width).replace(/\[vertPixels\]/ig,t.height).replace(/\[terrainEnabled\]/ig,0);r.mixin(e,o.queryToObject(u))}l&&(l=l.replace(/\[clientVersion\]/ig,c.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,n.locale),r.mixin(e,o.queryToObject(l)))}t=[];for(v in e)a.isDefined(e[v])&&t.push(v+"="+e[v]);return(t=t.join("&"))?"?"+t:""},setScaleRange:function(n,t){this.inherited(arguments);u.forEach(this.getLayers(),function(i){i.setScaleRange(n,t)})},setOpacity:function(n){this.opacity!=n&&(u.forEach(this.getLayers(),function(t){t.setOpacity(n)}),this.opacity=n,this.onOpacityChange(n))},_setMap:function(n,t){this.inherited(arguments);this._map=n;var i=this._div=s.create("div",null,t);return h.set(i,"position","absolute"),this._addInternalLayers(),this.evaluateSuspension(),i},_unsetMap:function(n,t){this._io&&this._io.cancel();this._stopAutoRefresh();i.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var r=this._div;r&&(t.removeChild(r),s.destroy(r));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(n){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,n),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&n&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(n){var t,i=[];return(n=this.getFeature({type:"Folder",id:n}))&&(t=u.map(n.featureInfos,function(n){if("esriGeometryPoint"===n.type||"esriGeometryPolyline"===n.type||"esriGeometryPolygon"===n.type)return n.id},this))&&0<t.length&&u.forEach(this._fLayers,function(n){var r,f;r=n.toJson();r.featureSet.features&&0<r.featureSet.features.length&&(f=u.filter(r.featureSet.features,function(i){if(-1!==u.indexOf(t,i.attributes[n.objectIdField]))return i},this));f&&0<f.length&&(r.featureSet.features=f,i.push(r))},this),i},getFeatureCount:function(n){n=this.getFeature({type:"Folder",id:n});var t={points:0,polylines:0,polygons:0};return n&&u.forEach(n.featureInfos,function(n){"esriGeometryPoint"===n.type&&(t.points+=1);"esriGeometryPolyline"===n.type&&(t.polylines+=1);"esriGeometryPolygon"===n.type&&(t.polygons+=1)}),t},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1e3*this.linkInfo.viewRefreshTime)}});return e("extend-esri")&&r.setObject("layers.KMLLayer",it,c),it})},"esri/layers/WMSLayer":function(){require({cache:{"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,t,i,r,u,f,e,o){return n=n([f,e],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(n,i){t.mixin(this,i);this.initialize(n,i)},getTitle:function(n){var t;return this.info&&(t=this.titleHasRelatedFields?"":this._getPopupValues(n,!0).title),t||""},getContent:function(n){return this.info?new o({template:this,graphic:n,chartTheme:this.chartTheme},r.create("div")).domNode:""}}),i("extend-esri")&&t.setObject("dijit.PopupTemplate",n,u),n})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){return n=n(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(n,r){if(n){t.mixin(this,r);this.info=n;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var u=this._fieldLabels={},f=this._fieldsMap={};this.info.fieldInfos&&i.forEach(this.info.fieldInfos,function(n){var t=n.fieldName.toLowerCase(),i=this._isExpressionField(t)?this.getExpressionInfo(t):null;u[t]=i?i.title:n.label;f[t]=n},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(n){var t;return i.some(this.info&&this.info.fieldInfos,function(i){return i.fieldName===n&&(t=i),!!t}),t},getExpressionInfo:function(n){if(this._isExpressionField(n)){n=n.replace(this._reExprField,"");n=n.toLowerCase();var t;return i.some(this.info.expressionInfos,function(i){return i.name.toLowerCase()===n&&(t=i),!!t}),t}},getComponents:function(n){var o=this.info,u=new e,f,r;return o.fieldInfos&&(r=i.filter(o.fieldInfos,function(n){return-1!==n.fieldName.indexOf(this._relatedFieldPrefix)},this)),r&&0<r.length&&(f=this._getRelatedRecords({graphic:n,fieldsInfo:r})),f?f.always(t.hitch(this,function(){u.resolve(this._getPopupValues(n))})):u.resolve(this._getPopupValues(n)),u.promise},getAttachments:function(n){var t=n.getSourceLayer();return n=n.attributes,this.info.showAttachments&&t&&t.hasAttachments&&t.objectIdField&&(n=n&&n[t.objectIdField])?t.queryAttachmentInfos(n):void 0},_isExpressionField:function(n){return this._reExprField.test(n)},_compileExpressions:function(n){var t={};return i.forEach(n,function(n){t[n.name]={compiledFunc:b.createFunction(n.expression)}}),t},_fetchAttributes:function(n){var r=t.clone(n.attributes)||{},u=this._exprPrefix,f=this._exprCache;return i.forEach(this.info.expressionInfos,function(t){var i=u+t.name;t=f[t.name];t=b.executeFunction(t&&t.compiledFunc,b.createExecContext(n,n._getViewInfo()));"string"==typeof t&&(t=h.encode(t));r[i]=t}),r},_getPopupValues:function(n,r){var h=this.info,f=n.getSourceLayer(),o=this._fetchAttributes(n),s=t.clone(o),g=h.fieldInfos,b="",nt="",k,e,u,y,l,p=f&&f._getDateOpts&&f._getDateOpts().properties,p=p&&p.slice(0),a={dateFormat:{properties:p,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}},v,tt,rt,w,d,it;if(this._relatedInfo)for(y in this._relatedInfo)this._relatedInfo.hasOwnProperty(y)&&(v=this._relatedInfo[y],tt=this._relatedLayersInfo[y],v&&(i.forEach(v.relatedFeatures,function(n){for(l in n.attributes)if(n.attributes.hasOwnProperty(l)&&"esriRelCardinalityOneToOne"===tt.relation.cardinality){var t=this._toRelatedFieldName([tt.relation.id,l]);o[t]=s[t]=n.attributes[l]}},this),i.forEach(v.relatedStatsFeatures,function(n){for(l in n.attributes)if(n.attributes.hasOwnProperty(l)){var t=this._toRelatedFieldName([tt.relation.id,l]);o[t]=s[t]=n.attributes[l]}},this)));if(g&&i.forEach(g,function(n){e=n.fieldName;var t=this._getLayerFieldInfo(f,e);t&&(e=n.fieldName=t.name);s[e]=this._formatValue(s[e],e,a);p&&n.format&&n.format.dateFormat&&(n=i.indexOf(p,e),-1<n&&p.splice(n,1))},this),f){y=f.types;rt=(v=f.typeIdField)&&o[v];for(e in o)o.hasOwnProperty(e)&&-1===e.indexOf(this._relatedFieldPrefix)&&(u=o[e],c.isDefined(u))&&(w=this._getDomainName(f,n,y,rt,e,u),c.isDefined(w)?s[e]=w:e===v&&(w=this._getTypeName(f,n,u),c.isDefined(w)&&(s[e]=w)))}return(h.title&&(b=this._processFieldsInLinks(this._fixTokens(h.title,f),o),b=t.trim(c.substitute(s,b,a)||"")),r)?{title:b}:(h.description&&(nt=this._processFieldsInLinks(this._fixTokens(h.description,f),o),nt=t.trim(c.substitute(s,nt,a)||"")),g&&(k=[],i.forEach(g,function(n){(e=n.fieldName)&&n.visible&&k.push([this._fieldLabels[e.toLowerCase()]||e,c.substitute(s,"${"+e+"}",a)||""])},this)),h.mediaInfos&&(d=[],i.forEach(h.mediaInfos,function(n){var e,r,v,h,l;it=0;u=n.value;switch(n.type){case"image":r=u.sourceURL;r=r&&t.trim(c.substitute(o,this._fixTokens(r,f)));it=!!r;break;case"piechart":case"linechart":case"columnchart":case"barchart":r=u.normalizeField;u.fields=i.map(u.fields,function(n){return(e=this._getLayerFieldInfo(f,n))?e.name:n},this);r&&(e=this._getLayerFieldInfo(f,r),u.normalizeField=e?e.name:r);it=i.some(u.fields,function(n){return c.isDefined(o[n])||-1!==n.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}it&&(n=t.clone(n),u=n.value,r=n.title?this._processFieldsInLinks(this._fixTokens(n.title,f),o):"",v=n.caption?this._processFieldsInLinks(this._fixTokens(n.caption,f),o):"",n.title=r?t.trim(c.substitute(s,r,a)||""):"",n.caption=v?t.trim(c.substitute(s,v,a)||""):"","image"===n.type?(u.sourceURL=c.substitute(o,this._fixTokens(u.sourceURL,f)),u.linkURL&&(u.linkURL=t.trim(c.substitute(o,this._fixTokens(u.linkURL,f))||""))):i.forEach(u.fields,function(n,t){if(-1!==n.indexOf(this._relatedFieldPrefix))l=this._getRelatedChartInfos(n,u,o,a),l instanceof Array?u.fields=l:u.fields[t]=l;else{var i=o[n],i=void 0===i?null:i;h=o[u.normalizeField]||0;i&&h&&(i/=h);u.fields[t]={y:i,tooltip:(this._fieldLabels[n.toLowerCase()]||n)+":<br/>"+this._formatValue(i,n,a,!!h)}}},this),d.push(n))},this)),{title:b,description:nt,hasDescription:!!h.description,fields:k&&k.length?k:null,mediaInfos:d&&d.length?d:null,formatted:s,editSummary:f&&f.getEditSummary?f.getEditSummary(n):""})},_getRelatedChartInfos:function(n,t,r,u){var s,h,o,f,e,l;return s=[],l=this._fromRelatedFieldName(n),e=l[0],h=this._relatedInfo[e],e=this._relatedLayersInfo[e],h&&i.forEach(h.relatedFeatures,function(i){var e,a,h,v;i=i.attributes;for(a in i)i.hasOwnProperty(a)&&a===l[1]&&(e={},f=i[a],t.normalizeField&&(o=-1!==t.normalizeField.indexOf(this._relatedFieldPrefix)?i[this._fromRelatedFieldName(t.normalizeField)[1]]:r[t.normalizeField]),f&&o&&(f/=o),t.tooltipField?-1!==t.tooltipField.indexOf(this._relatedFieldPrefix)?(h=this._fromRelatedFieldName(t.tooltipField)[1],v=c.isDefined(i[h])?i[h]:h,e.tooltip=v+":<br/>"+this._formatValue(f,h,u,!!o)):e.tooltip=(this._fieldLabels[n.toLowerCase()]||n)+":<br/>"+this._formatValue(f,t.tooltipField,u,!!o):e.tooltip=f,e.y=f,s.push(e))},this),"esriRelCardinalityOneToMany"===e.relation.cardinality||"esriRelCardinalityManyToMany"===e.relation.cardinality?s:s[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(n,t){var i=this;return n.replace(/(\{([^\{\r\n]+)\})/g,function(n,r,u){return n=i._getLayerFieldInfo(t,u),"$"+(n?"{"+n.name+"}":r)})},_encodeAttributes:function(n){n=t.clone(n)||{};var r,i;for(r in n)(i=n[r])&&"string"==typeof i&&(i=encodeURIComponent(i).replace(/\'/g,"&apos;"),n[r]=i);return n},_processFieldsInLinks:function(n,t){var i=this._encodeAttributes(t),r=this;return n&&(n=n.replace(this._reHref,function(n,u){return r._addValuesToHref(n,u,t,i)}).replace(this._reHrefApos,function(n,u){return r._addValuesToHref(n,u,t,i)})),n},_addValuesToHref:function(n,i,r,u){return i=i&&t.trim(i),c.substitute(i&&0===i.indexOf("${")?r:u,n)},_getLayerFieldInfo:function(n,t){return n&&n.getField?n.getField(t):null},_formatValue:function(n,r,u,f){var s=this._fieldsMap[r.toLowerCase()],e=s&&s.format,l,o;if(r=-1!==i.indexOf(u.dateFormat.properties,r),l="number"==typeof n&&!r&&(!e||!e.dateFormat),!c.isDefined(n)||!s||!c.isDefined(e))return l?this._forceLTR(n):n;var h="",s=[],a=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),v=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(a&&!r)h="NumberFormat",s.push("places: "+(c.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),s.length&&(h+="("+s.join(",")+")");else if(e.dateFormat)h="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return l?this._forceLTR(n):n;return o=this._applyFormatting(n,h,u),a&&-1<n.constructor.toString().indexOf("Array")&&(o="",i.forEach(n,t.hitch(this,function(n,t){t&&(o+=" ");o+=this._applyFormatting(n,h,u)}))),a&&!v&&k.group&&(o=o.replace(new RegExp("\\"+k.group,"g"),"")),r&&(o='<span class="esriDateValue">'+o+"<\/span>"),l?this._forceLTR(o):o},_applyFormatting:function(n,t,i){return c.substitute({myKey:n},"${myKey:"+t+"}",i)||""},_forceLTR:function(n){var t=o("ie");return t&&10>=t?n:"<span class='esriNumericValue'>"+n+"<\/span>"},_insertOffset:function(n){return n&&(n=c.isDefined(this.utcOffset)?n.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):n),n},_getDomainName:function(n,t,i,r,u,f){return(n=n.getDomain&&n.getDomain(u,{feature:t}))&&n.codedValues?n.getName(f):null},_getTypeName:function(n,t){return(n=n.getType&&n.getType(t))&&n.name},_getRelatedRecords:function(n){var u=n.graphic,i=new e,r;return this._relatedLayersInfo?this._queryRelatedLayers(u).then(t.hitch(this,function(n){this._setRelatedRecords(u,n);i.resolve(n)}),t.hitch(this,this._handlerErrorResponse,i)):this._getRelatedLayersInfo(n).then(t.hitch(this,function(n){for(r in n)n.hasOwnProperty(r)&&n[r]&&(this._relatedLayersInfo[r].relatedLayerInfo=n[r]);this._queryRelatedLayers(u).then(t.hitch(this,function(n){this._setRelatedRecords(u,n);i.resolve(n)}),t.hitch(this,this._handlerErrorResponse,i))}),t.hitch(this,this._handlerErrorResponse,i)),i.promise},_getRelatedLayersInfo:function(n){var f=n.fieldsInfo,r,t,u={};r=n.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});i.forEach(f,function(n){var u,t,f,e;u=this._fromRelatedFieldName(n.fieldName);t=u[0];u=u[1];t&&(this._relatedLayersInfo[t]||(i.some(r.relationships,function(n){if(n.id==t)return e=n,!0}),e&&(this._relatedLayersInfo[t]={relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[t]&&(this._relatedLayersInfo[t].relatedFields.push(u),n.statisticType&&(f=new w,f.statisticType=n.statisticType,f.onStatisticField=u,f.outStatisticFieldName=u,this._relatedLayersInfo[t].outStatistics.push(f))))},this);for(t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&this._relatedLayersInfo[t]&&(n=this._relatedLayersInfo[t].relation,n=r.url.replace(/[0-9]+$/,n.relatedTableId),this._relatedLayersInfo[t].relatedLayerUrl=n,u[t]=a({url:n,content:{f:"json"},callbackParamName:"callback"}));return s(u)},_queryRelatedLayers:function(n){var i={};for(var t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&(i[t]=this._queryRelatedLayer({graphic:n,relatedInfo:this._relatedLayersInfo[t]}));return s(i)},_queryRelatedLayer:function(n){var c,w,k,f,o,a,h,d,r,l,u,b,p;return c=n.graphic,w=c.getSourceLayer(),k=w.url.match(/[0-9]+$/g)[0],u=n.relatedInfo,l=u.relatedLayerInfo,b=u.relatedLayerUrl,n=u.relation,i.some(l.relationships,function(n){if(n.relatedTableId===parseInt(k,10))return f=n,!0},this),f&&(o=new v,i.some(l.fields,function(n){if(n.name===f.keyField)return d=-1!==i.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],n.type)?"number":"string",!0}),f.relationshipTableId&&f.keyFieldInRelationshipTable?(p=new e,this._queryRelatedRecords(c,f).then(t.hitch(this,function(n){var f;f=n[c.attributes[w.objectIdField]];n=i.map(f.features,function(n){return n.attributes[l.objectIdField]},this);u.outStatistics&&0<u.outStatistics.length&&l.supportsStatistics&&(r=new v,r.objectIds=n,r.outFields=o.outFields,r.outStatistics=u.outStatistics);r&&(a=new y(b),a.execute(r).then(t.hitch(this,function(n){var t=[];t.push(f);t.push(n);p.resolve(t)})))}))):(h="string"===d?f.keyField+"='"+c.attributes[n.keyField]+"'":f.keyField+"="+c.attributes[n.keyField],o.where=h,o.outFields=u.relatedFields,u.outStatistics&&0<u.outStatistics.length&&l.supportsStatistics&&(r=new v,r.where=o.where,r.outFields=o.outFields,r.outStatistics=u.outStatistics),a=new y(b),h=[],h.push(a.execute(o)),r&&h.push(a.execute(r)))),h?s(h):p?p.promise:void 0},_setRelatedRecords:function(n,t){var i,r;this._relatedInfo=[];for(i in t)t.hasOwnProperty(i)&&t[i]&&(r=t[i],this._relatedInfo[i]={},this._relatedInfo[i].relatedFeatures=r[0].features,c.isDefined(r[1])&&(this._relatedInfo[i].relatedStatsFeatures=r[1].features))},_handlerErrorResponse:function(n,t){n.reject(t)},_fromRelatedFieldName:function(n){var t=[];return-1!==n.indexOf(this._relatedFieldPrefix)&&(n=n.split("/"),t=n.slice(1)),t},_toRelatedFieldName:function(n){var t="";return n&&0<n.length&&(t=this._relatedFieldPrefix+n[0]+"/"+n[1]),t},_queryRelatedRecords:function(n,t){var r=n.getSourceLayer(),i=new p;return i.outFields=["*"],i.relationshipId=t.id,i.objectIds=[n.attributes[r.objectIdField]],r.queryRelatedFeatures(i)}}),f("extend-esri")&&(l.PopupInfo=l.PopupInfoTemplate=n),n})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var t=n.getObject("dojox.html.entities",!0),i=function(n,t){var u,i,r;if(t._encCache&&t._encCache.regexp&&t._encCache.mapper&&t.length==t._encCache.length)u=t._encCache.mapper,i=t._encCache.regexp;else{for(u={},i=["["],r=0;r<t.length;r++)u[t[r][0]]="&"+t[r][1]+";",i.push(t[r][0]);i.push("]");i=new RegExp(i.join(""),"g");t._encCache={mapper:u,regexp:i,length:t.length}}return n.replace(i,function(n){return u[n]})},r=function(n,t){var u,i,r,f;if(t._decCache&&t._decCache.regexp&&t._decCache.mapper&&t.length==t._decCache.length)u=t._decCache.mapper,i=t._decCache.regexp;else{for(u={},i=["("],r=0;r<t.length;r++)f="&"+t[r][1]+";",r&&i.push("|"),u[f]=t[r][0],i.push(f);i.push(")");i=new RegExp(i.join(""),"g");t._decCache={mapper:u,regexp:i,length:t.length}}return n.replace(i,function(n){return u[n]})};return t.html=[["&","amp"],['"',"quot"],["<","lt"],[">","gt"],["","nbsp"]],t.latin=[["","iexcl"],["","cent"],["","pound"],["","euro"],["","curren"],["","yen"],["","brvbar"],["","sect"],["","uml"],["","copy"],["","ordf"],["","laquo"],["","not"],["","shy"],["","reg"],["","macr"],["","deg"],["","plusmn"],["","sup2"],["","sup3"],["","acute"],["","micro"],["","para"],["","middot"],["","cedil"],["","sup1"],["","ordm"],["","raquo"],["","frac14"],["","frac12"],["","frac34"],["","iquest"],["","Agrave"],["","Aacute"],["","Acirc"],["","Atilde"],["","Auml"],["","Aring"],["","AElig"],["","Ccedil"],["","Egrave"],["","Eacute"],["","Ecirc"],["","Euml"],["","Igrave"],["","Iacute"],["","Icirc"],["","Iuml"],["","ETH"],["","Ntilde"],["","Ograve"],["","Oacute"],["","Ocirc"],["","Otilde"],["","Ouml"],["","times"],["","Oslash"],["","Ugrave"],["","Uacute"],["","Ucirc"],["","Uuml"],["","Yacute"],["","THORN"],["","szlig"],["","agrave"],["","aacute"],["","acirc"],["","atilde"],["","auml"],["","aring"],["","aelig"],["","ccedil"],["","egrave"],["","eacute"],["","ecirc"],["","euml"],["","igrave"],["","iacute"],["","icirc"],["","iuml"],["","eth"],["","ntilde"],["","ograve"],["","oacute"],["","ocirc"],["","otilde"],["","ouml"],["","divide"],["","oslash"],["","ugrave"],["","uacute"],["","ucirc"],["","uuml"],["","yacute"],["","thorn"],["","yuml"],["","fnof"],["","Alpha"],["","Beta"],["","Gamma"],["","Delta"],["","Epsilon"],["","Zeta"],["","Eta"],["","Theta"],["","Iota"],["","Kappa"],["","Lambda"],["","Mu"],["","Nu"],["","Xi"],["","Omicron"],["","Pi"],["","Rho"],["","Sigma"],["","Tau"],["","Upsilon"],["","Phi"],["","Chi"],["","Psi"],["","Omega"],["","alpha"],["","beta"],["","gamma"],["","delta"],["","epsilon"],["","zeta"],["","eta"],["","theta"],["","iota"],["","kappa"],["","lambda"],["","mu"],["","nu"],["","xi"],["","omicron"],["","pi"],["","rho"],["","sigmaf"],["","sigma"],["","tau"],["","upsilon"],["","phi"],["","chi"],["","psi"],["","omega"],["","thetasym"],["","upsih"],["","piv"],["","bull"],["","hellip"],["","prime"],["","Prime"],["","oline"],["","frasl"],["","weierp"],["","image"],["","real"],["","trade"],["","alefsym"],["","larr"],["","uarr"],["","rarr"],["","darr"],["","harr"],["","crarr"],["","lArr"],["","uArr"],["","rArr"],["","dArr"],["","hArr"],["","forall"],["","part"],["","exist"],["","empty"],["","nabla"],["","isin"],["","notin"],["","ni"],["","prod"],["","sum"],["","minus"],["","lowast"],["","radic"],["","prop"],["","infin"],["","ang"],["","and"],["","or"],["","cap"],["","cup"],["","int"],["","there4"],["","sim"],["","cong"],["","asymp"],["","ne"],["","equiv"],["","le"],["","ge"],["","sub"],["","sup"],["","nsub"],["","sube"],["","supe"],["","oplus"],["","otimes"],["","perp"],["","sdot"],["","lceil"],["","rceil"],["","lfloor"],["","rfloor"],["","lang"],["","rang"],["","loz"],["","spades"],["","clubs"],["","hearts"],["","diams"],["","OElig"],["","oelig"],["","Scaron"],["","scaron"],["","Yuml"],["","circ"],["","tilde"],["","ensp"],["","emsp"],["","thinsp"],["","zwnj"],["","zwj"],["","lrm"],["","rlm"],["","ndash"],["","mdash"],["","lsquo"],["","rsquo"],["","sbquo"],["","ldquo"],["","rdquo"],["","bdquo"],["","dagger"],["","Dagger"],["","permil"],["","lsaquo"],["","rsaquo"]],t.encode=function(n,r){return n&&(r?n=i(n,r):(n=i(n,t.html),n=i(n,t.latin))),n},t.decode=function(n,i){return n&&(i?n=r(n,i):(n=r(n,t.html),n=r(n,t.latin))),n},t})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(l,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(n,i){this._handler=t.hitch(this,this._handler);this._relationshipQueryHandler=t.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=t.hitch(this,this._executeForIdsHandler);this._countHandler=t.hitch(this,this._countHandler);this._extentHandler=t.hitch(this,this._extentHandler);this.source=i&&i.source;this.gdbVersion=i&&i.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(n,i,r,f,e){var s=e.assembly,h,c;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson(s&&s[0]))),h=this._handler,c=this._errorHandler,this.source&&(s={source:this.source.toJson()},n.layer=u.toJson(s)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){h(n,t,i,r,e.dfd)},error:function(n){c(n,r,e.dfd)},callbackSuffix:f},this.requestOptions)},executeRelationshipQuery:function(n,i,u){var e,h,f;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson())),e=this._relationshipQueryHandler,h=this._errorHandler,this.gdbVersion&&(n.gdbVersion=this.gdbVersion),f=new r(s._dfdCanceller),f._pendingDfd=o({url:this._url.path+"/queryRelatedRecords",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,u,f)},error:function(n){h(n,u,f)}},this.requestOptions),f},executeForIds:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},n.toJson(e&&e[0]))),s=this._executeForIdsHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForCount:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._countHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForExtent:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._extentHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},_handler:function(n,t,i,r,u){try{var f=new a(n);this._successHandler([f],"onComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},_relationshipQueryHandler:function(n,t,r,u,f){try{var o=n.geometryType,s=n.spatialReference,e={};i.forEach(n.relatedRecordGroups,function(n){var t={},i;if(t.geometryType=o,t.spatialReference=s,t.features=n.relatedRecords,t=new a(t),null!=n.objectId)e[n.objectId]=t;else for(i in n)n.hasOwnProperty(i)&&"relatedRecords"!==i&&(e[n[i]]=t)});this._successHandler([e],"onExecuteRelationshipQueryComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},_executeForIdsHandler:function(n,t,i,r,u){try{this._successHandler([n.objectIds],"onExecuteForIdsComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},_countHandler:function(n,t,i,r,u){try{var f,o=n.features,e=n.objectIds;if(e)f=e.length;else{if(o)throw Error("Unable to perform query. Please check your parameters.");f=n.count}this._successHandler([f],"onExecuteForCountComplete",i,u)}catch(s){this._errorHandler(s,r,u)}},_extentHandler:function(n,t,i,r,u){try{n.extent&&(n.extent=new h(n.extent));this._successHandler([n],"onExecuteForExtentComplete",i,u)}catch(f){this._errorHandler(f,r,u)}}}),c._createWrappers(n),f("extend-esri")&&t.setObject("tasks.QueryTask",n,e),n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,t,i,r,u,f,e,o){return n=n(o,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(n,i){n&&t.isString(n)&&(this._url=e.urlToObject(this.url=n));i&&i.requestOptions&&(this.requestOptions=i.requestOptions);this.normalization=!0;this._errorHandler=t.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var n=this._url,t=/^http:/i;this.url&&(this.url=this.url.replace(t,"https:"));n&&n.path&&(n.path=n.path.replace(t,"https:"))},_encode:function(n,r,u){var e,f,s={},o,h;for(o in n)if("declaredClass"!==o&&(e=n[o],f=typeof e,null!==e&&void 0!==e&&"function"!==f))if(t.isArray(e))for(s[o]=[],h=e.length,f=0;f<h;f++)s[o][f]=this._encode(e[f]);else"object"===f?e.toJson&&(f=e.toJson(u&&u[o]),"esri.tasks.FeatureSet"===e.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),s[o]=r?f:i.toJson(f)):s[o]=e;return s},_successHandler:function(n,t,i,r){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&f._resDfd(r,n)},_errorHandler:function(n,t,i){this.onError(n);t&&t(n);i&&i.errback(n)},setNormalization:function(n){this.normalization=n},onError:function(){}}),r("extend-esri")&&(u.Task=n),n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(n){if(n){t.mixin(this,n);var r=this.features,u=n.spatialReference,f=h.getGeometryType(n.geometryType),u=this.spatialReference=new o(u);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);i.forEach(r,function(n,t){var i=n.geometry&&n.geometry.spatialReference;r[t]=new e(f&&n.geometry?new f(n.geometry):null,n.symbol&&c.fromJson(n.symbol),n.attributes);r[t].geometry&&!i&&r[t].geometry.setSpatialReference(u)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var t={};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields),this.spatialReference?t.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJson()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=h.getJsonType(this.features[0].geometry)),t.features=s._encodeGraphics(this.features,n)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,f.fixJson(t)},_hydrate:function(){var n=this.transform,t=this.geometryType;if(n&&t)for(var i=this.features,r=n.translate[0],u=n.translate[1],f=n.scale[0],e=n.scale[1],o=function(n,t,i){return"esriGeometryPoint"===n?function(n){n.x=t(n.x);n.y=i(n.y)}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){n=n.rings||n.paths;for(var u,c,e,r,o,s,f=0,h=n.length;f<h;f++)for(e=n[f],u=0,c=e.length;u<c;u++)r=e[u],0<u?(o+=r[0],s+=r[1]):(o=r[0],s=r[1]),r[0]=t(o),r[1]=i(s)}:"esriGeometryEnvelope"===n?function(n){n.xmin=t(n.xmin);n.ymin=i(n.ymin);n.xmax=t(n.xmax);n.ymax=i(n.ymax)}:"esriGeometryMultipoint"===n?function(n){n=n.points;for(var r,f,e,u=0,o=n.length;u<o;u++)r=n[u],0<u?(f+=r[0],e+=r[1]):(f=r[0],e=r[1]),r[0]=t(f),r[1]=i(e)}:void 0}(t,function(n){return n*f+r},function(n){return u-n*e}),n=0,t=i.length;n<t;n++)i[n].geometry&&o(i[n].geometry);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;for(var f=n.translate[0],e=n.translate[1],o=n.scale[0],s=n.scale[1],i=this.features,r=function(n,t,i){for(var r,f,e,o,s=[],u=0,h=n.length;u<h;u++)(r=n[u],0<u)?(o=t(r[0]),r=i(r[1]),o!==f||r!==e)&&(s.push([o-f,r-e]),f=o,e=r):(f=t(r[0]),e=i(r[1]),s.push([f,e]));return 0<s.length?s:null},h=function(n,t,i){return"esriGeometryPoint"===n?function(n){return n.x=t(n.x),n.y=i(n.y),n}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){var f,s,o,e,u;for(o=n.rings||n.paths,u=[],f=0,s=o.length;f<s;f++)e=o[f],(e=r(e,t,i))&&u.push(e);return 0<u.length?(n.rings?n.rings=u:n.paths=u,n):null}:"esriGeometryMultipoint"===n?function(n){var u;return u=r(n.points,t,i),0<u.length?(n.points=u,n):null}:"esriGeometryEnvelope"===n?function(n){return n}:void 0}(this.geometryType,function(n){return Math.round((n-f)/o)},function(n){return Math.round((e-n)/s)}),t=0,u=i.length;t<u;t++)i[t].geometry&&(h(i[t].geometry)||i[t].setGeometry(null));return this.transform=n,this}}),r("extend-esri")&&t.setObject("tasks.FeatureSet",n,u),n})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var n={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},r=this.objectIds,u=this.outFields,t=this.outSpatialReference;return r&&(n.objectIds=r.join(",")),u&&(n.outFields=u.join(",")),t&&(n.outSR=t.wkid||i.toJson(t.toJson())),n._ts=this._ts,n}}),r("extend-esri")&&t.setObject("tasks.RelationshipQuery",n,u),n})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}}),i("extend-esri")&&t.setObject("tasks.StatisticDefinition",n,r),n})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=0;return t=t([k,y,p],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},d.widgets.popup)},templateString:"<div class='esriViewPopup'><div class='mainSection'><div class='header' dojoAttachPoint='_title'><\/div><div class='hzLine'><\/div><div dojoAttachPoint='_description'><\/div><div class='break'><\/div><\/div><div class='attachmentsSection hidden'><div>${_nls.NLS_attach}:<\/div><ul dojoAttachPoint='_attachmentsList'><\/ul><div class='break'><\/div><\/div><div class='mediaSection hidden'><div class='header' dojoAttachPoint='_mediaTitle'><\/div><div class='hzLine'><\/div><div class='caption' dojoAttachPoint='_mediaCaption'><\/div><div class='gallery' dojoAttachPoint='_gallery'><div class='mediaHandle prev' dojoAttachPoint='_prevMedia' dojoAttachEvent='onclick: _goToPrevMedia'><\/div><div class='mediaHandle next' dojoAttachPoint='_nextMedia' dojoAttachEvent='onclick: _goToNextMedia'><\/div><ul class='summary'><li class='image mediaCount hidden' dojoAttachPoint='_imageCount'>0<\/li><li class='image mediaIcon hidden'><\/li><li class='chart mediaCount hidden' dojoAttachPoint='_chartCount'>0<\/li><li class='chart mediaIcon hidden'><\/li><\/ul><div class='frame' dojoAttachPoint='_mediaFrame'><\/div><\/div><\/div><div class='editSummarySection hidden' dojoAttachPoint='_editSummarySection'><div class='break'><\/div><div class='break hidden' dojoAttachPoint='_mediaBreak'><\/div><div class='editSummary' dojoAttachPoint='_editSummary'><\/div><\/div><\/div>",showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess),r.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var n=this._mediaInfos,s=n.length,r=this.domNode,e=this._prevMedia,o=this._nextMedia,t,i;1<s?(t=0,i=0,u.forEach(n,function(n){"image"===n.type?t++:-1!==n.type.indexOf("chart")&&i++}),t&&(h.set(this._imageCount,"innerHTML",t),f.query(".summary .image",r).removeClass("hidden")),i&&(h.set(this._chartCount,"innerHTML",i),f.query(".summary .chart",r).removeClass("hidden"))):(f.query(".summary",r).addClass("hidden"),c.add(e,"hidden"),c.add(o,"hidden"));n=this._mediaPtr;0===n?c.add(e,"hidden"):c.remove(e,"hidden");n===s-1?c.add(o,"hidden"):c.remove(o,"hidden");this._destroyFrame()},_displayMedia:function(){var i=this._mediaInfos[this._mediaPtr],u=i.title,t=i.caption,s=f.query(".mediaSection .hzLine",this.domNode)[0],o;if(h.set(this._mediaTitle,"innerHTML",u),c[u?"remove":"add"](this._mediaTitle,"hidden"),h.set(this._mediaCaption,"innerHTML",t),c[t?"remove":"add"](this._mediaCaption,"hidden"),c[u&&t?"remove":"add"](s,"hidden"),this._rid=null,"image"===i.type)this._showImage(i.value);else{var e=this,u=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],t=i.value.theme||this.chartTheme;r.isString(t)&&(t=t.replace(/\./gi,"/"),-1===t.indexOf("/")&&(t="dojox/charting/themes/"+t));t||(t="./Rainbow");u.push(t);try{o=this._rid=g++;n(u,function(n,t,r){o===e._rid&&(e._rid=null,e._showChart(i.type,i.value,n,t,r))})}catch(l){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(n){return(n=n&&r.trim(n).toLowerCase())&&(0===n.indexOf("mailto:")||0===n.indexOf("tel:"))},_showImage:function(n){var u,e,t,o,r;c.add(this._mediaFrame,"image");u=a.get(this._gallery,"height");n.linkURL&&(e=l.create("a",{href:n.linkURL,target:this._preventNewTab(n.linkURL)?"":"_blank"},this._mediaFrame));l.create("img",{className:"esriPopupMediaImage",src:n.sourceURL},e||this._mediaFrame);t=f.query(".esriPopupMediaImage",this._mediaFrame)[0];o=this;r=i.connect(t,"onload",function(){i.disconnect(r);r=null;o._imageLoaded(t,u)})},_showChart:function(n,t,i,r,f){c.remove(this._mediaFrame,"image");i=this._chart=new i(l.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});f&&i.setTheme(f);switch(n){case"piechart":i.addPlot("default",{type:"Pie",labels:!1});i.addSeries("Series A",t.fields);break;case"linechart":i.addPlot("default",{type:"Markers"});i.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});i.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});u.forEach(t.fields,function(n,t){n.x=t+1});i.addSeries("Series A",t.fields);break;case"columnchart":i.addPlot("default",{type:"Columns",gap:3});i.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});i.addSeries("Series A",t.fields);break;case"barchart":i.addPlot("default",{type:"Bars",gap:3});i.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1});i.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});i.addSeries("Series A",t.fields)}this._action=new r(i);i.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);h.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(n,t){var i=n.height;i<t&&a.set(n,"marginTop",Math.round((t-i)/2)+"px")},_attListHandler:function(n,t){if(n===this._dfd){this._dfd=null;var i="";t instanceof Error||!t||!t.length||u.forEach(t,function(n){i+="<li>";i+="<a href='"+b.addProxy(n.url)+"' target='_blank'>"+(n.name||"[No name]")+"<\/a>";i+="<\/li>"});h.set(this._attachmentsList,"innerHTML",i||"<li>"+this._nls.NLS_noAttach+"<\/li>")}},_handleComponentsSuccess:function(n){if(n){var i=this.showTitle?n.title:"",t=n.description,a=n.fields,e=n.mediaInfos,o=this.domNode,l=this._nls,y=this,p=this.template,w=this.graphic;this._prevMedia.title=l.NLS_prevMedia;this._nextMedia.title=l.NLS_nextMedia;h.set(this._title,"innerHTML",i);i||c.add(this._title,"hidden");!n.hasDescription&&a&&(t="",u.forEach(a,function(n){t+="<tr valign='top'>";t+="<td class='attrName'>"+v.encode(n[0])+"<\/td>";t+="<td class='attrValue'>"+n[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"<a target='_blank' href='$1' title='$1'>"+l.NLS_moreInfo+"<\/a>")+"<\/td>";t+="<\/tr>"}),t&&(t="<table class='attrTable' cellpadding='0px' cellspacing='0px'>"+t+"<\/table>"));h.set(this._description,"innerHTML",t);t||c.add(this._description,"hidden");f.query("a",this._description).forEach(function(n){y._preventNewTab(n.href)?"_blank"===n.target&&h.remove(n,"target"):h.set(n,"target","_blank")});i&&t?f.query(".mainSection .hzLine",o).removeClass("hidden"):i||t?f.query(".mainSection .hzLine",o).addClass("hidden"):f.query(".mainSection",o).addClass("hidden");(i=this._dfd=p.getAttachments(w))&&(i.addBoth(r.hitch(this,this._attListHandler,i)),h.set(this._attachmentsList,"innerHTML","<li>"+l.NLS_searching+"...<\/li>"),f.query(".attachmentsSection",o).removeClass("hidden"));e&&e.length&&(f.query(".mediaSection",o).removeClass("hidden"),s.setSelectable(this._mediaFrame,!1),this._mediaInfos=e,this._mediaPtr=0,this._updateUI(),this._displayMedia());n.editSummary&&(h.set(this._editSummary,"innerHTML",n.editSummary),e&&e.length&&c.remove(this._mediaBreak,"hidden"),c.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(n){console.log("PopupRenderer: error loading template",n)}}),e("extend-esri")&&r.setObject("dijit._PopupRenderer",t,w),t})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){}function y(n){return function(t,r,u,f){return t&&"string"==typeof r&&t[r]==v?t.on(r.substring(2).toLowerCase(),e.hitch(u,f)):n.apply(i,arguments)}}return n.around(i,"connect",y),f.connect&&n.around(f,"connect",y),n=r("dijit._Widget",[c,l,a],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(n){this._toConnect={};for(var t in n)this[t]===v&&(this._toConnect[t.replace(/^on/,"").toLowerCase()]=n[t],delete n[t])},postCreate:function(){this.inherited(arguments);for(var n in this._toConnect)this.on(n,this._toConnect[n]);delete this._toConnect},on:function(n,t){return this[this._onMap(n)]===v?i.connect(this.domNode,n.toLowerCase(),this,t):this.inherited(arguments)},_setFocusedAttr:function(n){this._focused=n;this._set("focused",n)},setAttribute:function(n,t){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(n,t)},attr:function(n){return 2<=arguments.length||"object"==typeof n?this.set.apply(this,arguments):this.get(n)},getDescendants:function(){return f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0"),this.containerNode?o("[widgetId]",this.containerNode).map(h.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}}),u("dijit-legacy-requires")&&s(0,function(){require(["dijit/_base"])}),n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){function it(n){return function(t){o[t?"set":"remove"](this.domNode,n,t);this._set(n,t)}}a.add("dijit-legacy-requires",!v.isAsync);a.add("dojo-bidi",!1);a("dijit-legacy-requires")&&w(0,function(){n(["dijit/_base/manager"])});var rt={};return r=f("dijit._WidgetBase",[b,g],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:it("lang"),dir:"",_setDirAttr:it("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(n){this._set("ownerDocument",n)},attributeMap:{},_blankGif:r.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var t=this.constructor;if(!t._setterAttrs){var i=t.prototype,r=t._setterAttrs=[],t=t._onMap={};for(var n in i.attributeMap)r.push(n);for(n in i)/^on/.test(n)&&(t[n.substring(2).toLowerCase()]=n),/^_set[A-Z](.*)Attr$/.test(n)&&(n=n.charAt(4).toLowerCase()+n.substr(5,n.length-9),i.attributeMap&&n in i.attributeMap||r.push(n))}},postscript:function(n,t){this.create(n,t)},create:function(n,t){var r,i;this._introspect();this.srcNodeRef=e.byId(t);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);n&&(this.params=n,y.mixin(this,n));this.postMixInProperties();this.id||(this.id=tt.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=d.body(this.ownerDocument);tt.add(this);this.buildRendering();this.domNode&&(this._applyAttributes(),i=this.srcNodeRef,i&&i.parentNode&&this.domNode!==i&&(i.parentNode.replaceChild(this.domNode,i),r=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();r&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var i={};for(var n in this.params||{})i[n]=this._get(n);t.forEach(this.constructor._setterAttrs,function(n){if(!(n in i)){var t=this._get(n);t&&this.set(n,t)}},this);for(n in i)this.set(n,i[n])},postMixInProperties:function(){},buildRendering:function(){if(this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div")),this.baseClass){var n=this.baseClass.split(" ");this.isLeftToRight()||(n=n.concat(t.map(n,function(n){return n+"Rtl"})));s.add(this.domNode,n)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,t.forEach(this.getChildren(),function(n){n._started||n._destroyed||!y.isFunction(n.startup)||(n.startup(),n._started=!0)}))},destroyRecursive:function(n){this._beingDestroyed=!0;this.destroyDescendants(n);this.destroy(n)},destroy:function(n){function i(t){t.destroyRecursive?t.destroyRecursive(n):t.destroy&&t.destroy(n)}this._beingDestroyed=!0;this.uninitialize();t.forEach(this._connects,y.hitch(this,"disconnect"));t.forEach(this._supportingWidgets,i);this.domNode&&t.forEach(tt.findWidgets(this.domNode,this.containerNode),i);this.destroyRendering(n);tt.remove(this.id);this._destroyed=!0},destroyRendering:function(n){this.bgIframe&&(this.bgIframe.destroy(n),delete this.bgIframe);this.domNode&&(n?o.remove(this.domNode,"widgetId"):h.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(n||h.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(n){t.forEach(this.getChildren(),function(t){t.destroyRecursive&&t.destroyRecursive(n)})},uninitialize:function(){return!1},_setStyleAttr:function(n){var t=this.domNode;y.isObject(n)?l.set(t,n):t.style.cssText=t.style.cssText?t.style.cssText+("; "+n):n;this._set("style",n)},_attrToDom:function(n,i,r){r=3<=arguments.length?r:this.attributeMap[n];t.forEach(y.isArray(r)?r:[r],function(t){var r=this[t.node||t||"domNode"];switch(t.type||"attribute"){case"attribute":y.isFunction(i)&&(i=y.hitch(this,i));t=t.attribute?t.attribute:/^on[A-Z][a-zA-Z]*$/.test(n)?n.toLowerCase():n;r.tagName?o.set(r,t,i):r.set(t,i);break;case"innerText":r.innerHTML="";r.appendChild(this.ownerDocument.createTextNode(i));break;case"innerHTML":r.innerHTML=i;break;case"class":s.replace(r,i,this[n]);break;case"toggleClass":s.toggle(r,t.className||n,i)}},this)},get:function(n){var t=this._getAttrNames(n);return this[t.g]?this[t.g]():this._get(n)},set:function(n,t){var i,s,r,e,u,o,f;if("object"==typeof n){for(i in n)this.set(i,n[i]);return this}if(i=this._getAttrNames(n),r=this[i.s],y.isFunction(r))s=r.apply(this,Array.prototype.slice.call(arguments,1));else{if(r=this.focusNode&&!y.isFunction(this.focusNode)?"focusNode":"domNode",e=this[r]&&this[r].tagName,(u=e)&&!(u=rt[e])){u=this[r];o={};for(f in u)o[f.toLowerCase()]=!0;u=rt[e]=o}f=u;i=n in this.attributeMap?this.attributeMap[n]:i.s in this?this[i.s]:f&&i.l in f&&"function"!=typeof t||/^aria-|^data-|^role$/.test(n)?r:null;null!=i&&this._attrToDom(n,t,i);this._set(n,t)}return s||this},_attrPairNames:{},_getAttrNames:function(n){var i=this._attrPairNames,t;return i[n]?i[n]:(t=n.replace(/^[a-z]|-[a-zA-Z]/g,function(n){return n.charAt(n.length-1).toUpperCase()}),i[n]={n:n+"Node",s:"_set"+t+"Attr",g:"_get"+t+"Attr",l:t.toLowerCase()})},_set:function(n,t){var i=this[n];this[n]=t;this._created&&i!==t&&(i===i||t===t)&&(this._watchCallbacks&&this._watchCallbacks(n,i,t),this.emit("attrmodified-"+n,{detail:{prevValue:i,newValue:t}}))},_get:function(n){return this[n]},emit:function(n,t,i){t=t||{};void 0===t.bubbles&&(t.bubbles=!0);void 0===t.cancelable&&(t.cancelable=!0);t.detail||(t.detail={});t.detail.widget=this;var r,u=this["on"+n];return u&&(r=u.apply(this,i?i:[t])),this._started&&!this._beingDestroyed&&p.emit(this.domNode,n.toLowerCase(),t),r},on:function(n,t){var r=this._onMap(n);return r?i.after(this,r,t,!0):this.own(p(this.domNode,n,t))[0]},_onMap:function(n){var r=this.constructor,t=r._onMap,i;if(!t){t=r._onMap={};for(i in r.prototype)/^on/.test(i)&&(t[i.replace(/^on/,"").toLowerCase()]=i)}return t["string"==typeof n&&n.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?tt.findWidgets(this.containerNode):[]},getParent:function(){return tt.getEnclosingWidget(this.domNode.parentNode)},connect:function(n,t,i){return this.own(u.connect(n,t,this,i))[0]},disconnect:function(n){n.remove()},subscribe:function(n,t){return this.own(k.subscribe(n,y.hitch(this,t)))[0]},unsubscribe:function(n){n.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=l.get(this.domNode,"display")},placeAt:function(n,t){var i=!n.tagName&&tt.byId(n);return!i||!i.addChild||t&&"number"!=typeof t?(i=i&&"domNode"in i?i.containerNode&&!/after|before|replace/.test(t||"")?i.containerNode:i.domNode:e.byId(n,this.ownerDocument),h.place(this.domNode,i,t),!this._started&&(this.getParent()||{})._started&&this.startup()):i.addChild(this,t),this},defer:function(n,t){var i=setTimeout(y.hitch(this,function(){i&&(i=null,this._destroyed||y.hitch(this,n)())}),t||0);return{remove:function(){return i&&(clearTimeout(i),i=null),null}}}}),a("dojo-bidi")&&r.extend(nt),r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,t,i){return i("dijit.Destroyable",null,{destroy:function(){this._destroyed=!0},own:function(){var i=["destroyRecursive","destroy","remove"];return n.forEach(arguments,function(r){function f(){o.remove();n.forEach(e,function(n){n.remove()})}var u,o=t.before(this,"destroy",function(n){r[u](n)}),e=[];r.then?(u="cancel",r.then(f,f)):n.forEach(i,function(n){"function"==typeof r[n]&&(u||(u=n),e.push(t.after(r,n,f,!0)))})},this),arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,t,i,r,u,f){return n=r("dijit._OnDijitClickMixin",null,{connect:function(n,t,i){return this.inherited(arguments,[n,"ondijitclick"==t?f:t,i])}}),n.a11yclick=f,n})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(n,t,i,r){return r.extend(t,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}}),i("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,t,i,r){return i(function(){t("highcontrast")&&n.add(r.body(),"dijit_a11y")}),t})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(n,t,i,r,u,f,e){return u.add("highcontrast",function(){var i=e.doc.createElement("div"),f,o;try{return i.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(t.blankGif||n.toUrl("./resources/blank.gif"))+'");',e.body().appendChild(i),f=r.getComputedStyle(i),o=f.backgroundImage,f.borderTopColor==f.borderRightColor||o&&("none"==o||"url(invalid-url:)"==o)}catch(s){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+s.toString()),!1}finally{8>=u("ie")?i.outerHTML="":e.body().removeChild(i)}}),f(function(){u("highcontrast")&&i.add(e.body(),"dj_a11y")}),u})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(n,t,i,r,u,f,e){return f.extend(n,{waiRole:"",waiState:""}),u("dijit._Templated",[t,i],{constructor:function(){e.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(n,t){var u=this.inherited(arguments),i=t(n,"waiRole");return i&&n.setAttribute("role",i),(i=t(n,"waiState"))&&r.forEach(i.split(/\s*,\s*/),function(t){-1!=t.indexOf("-")&&(t=t.split("-"),n.setAttribute("aria-"+t[0],t[1]))}),u}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,t,i,r,u,f,e,o){var s=t("dijit._TemplatedMixin",o,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(n){var t=this.declaredClass,i=this;return e.substitute(n,this,function(n,u){if("!"==u.charAt(0)&&(n=r.getObject(u.substr(1),!1,i)),"undefined"==typeof n)throw Error(t+" template:"+u);return null==n?"":"!"==u.charAt(0)?n:this._escapeValue(""+n)},this)},_escapeValue:function(n){return n.replace(/["'<>&]/g,function(n){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}[n]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=n(this.templatePath,{sanitize:!0}));var t=s.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),u;if(r.isString(t)){if(u=i.toDom(this._stringRepl(t),this.ownerDocument),1!=u.nodeType)throw Error("Invalid template: "+t);}else u=t.cloneNode(!0);this.domNode=u}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(n){var t=this.containerNode;if(n&&t)for(;n.hasChildNodes();)t.appendChild(n.firstChild)}});return s._templateCache={},s.getCachedTemplate=function(n,t,r){var f=s._templateCache,o=n,u=f[o];if(u){try{if(!u.ownerDocument||u.ownerDocument==(r||document))return u}catch(h){}i.destroy(u)}if(n=e.trim(n),t||n.match(/\$\{([^\}]+)\}/g))return f[o]=n;if(t=i.toDom(n,r),1!=t.nodeType)throw Error("Invalid template: "+n);return f[o]=t},f("ie")&&u(window,"unload",function(){var n=s._templateCache,t,r;for(t in n)r=n[t],"object"==typeof r&&i.destroy(r),delete n[t]}),s})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(n){return n.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,t,i,r,u,f,e,o,s){var c=u.delegate(o,{mouseenter:f.enter,mouseleave:f.leave,keypress:i._keypress}),h;return i=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(n){for(var t=n;;)if(1==t.nodeType&&(this._processTemplateNode(t,function(n,t){return n.getAttribute(t)},this._attach)||this.searchContainerNode)&&t.firstChild)t=t.firstChild;else{if(t==n)break;for(;!t.nextSibling;)if(t=t.parentNode,t==n)return;t=t.nextSibling}},_processTemplateNode:function(n,t,i){var s=!0,o=this.attachScope||this,r=t(n,"dojoAttachPoint")||t(n,"data-dojo-attach-point"),e,f;if(r)for(e=r.split(/\s*,\s*/);r=e.shift();)u.isArray(o[r])?o[r].push(n):o[r]=n,s="containerNode"!=r,this._attachPoints.push(r);if(t=t(n,"dojoAttachEvent")||t(n,"data-dojo-attach-event"))for(r=t.split(/\s*,\s*/),e=u.trim;t=r.shift();)t&&(f=null,-1!=t.indexOf(":")?(f=t.split(":"),t=e(f[0]),f=e(f[1])):t=e(t),f||(f=t),this._attachEvents.push(i(n,t,u.hitch(o,f))));return s},_attach:function(t,i,r){return i=i.replace(/^on/,"").toLowerCase(),i="dijitclick"==i?h||(h=n("./a11yclick")):c[i]||i,e(t,i,r)},_detachTemplateNodes:function(){var n=this.attachScope||this;t.forEach(this._attachPoints,function(t){delete n[t]});this._attachPoints=[];t.forEach(this._attachEvents,function(n){n.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}}),u.extend(s,{dojoAttachEvent:"",dojoAttachPoint:""}),i})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,t,i,r,u){return i("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var n=this.domNode;if(this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0),u.parse(n,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(n){this._startupWidgets=n;for(var t=0;t<n.length;t++)this._processTemplateNode(n[t],function(n,t){return n[t]},function(n,t,i){return t in n?n.connect(n,t,i):n.on(t,i,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser})),!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(n,t){return t(n,"dojoType")||t(n,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,function(n){n&&!n._started&&n.startup&&n.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function k(n){return eval("("+n+")")}function g(n){var t=n._nameCaseMap,r=n.prototype,i;if(!t||t._extendCnt<w){t=n._nameCaseMap={};for(i in r)"_"!==i.charAt(0)&&(t[i.toLowerCase()]=i);t._extendCnt=w}return t}function d(t,r){var f,s,o;if(r||(r=n),f=r._dojoParserCtorMap||(r._dojoParserCtorMap={}),s=t.join(),!f[s]){for(var e=[],u=0,h=t.length;u<h;u++)o=t[u],e[e.length]=f[o]=f[o]||i.getObject(o)||~o.indexOf("/")&&r(o);u=e.shift();f[s]=e.length?u.createSubclass?u.createSubclass(e):u.extend.apply(u,e):u}return f[s]}var w,b;return new Date("X"),w=0,s.after(i,"extend",function(){w++},!0),b={_clearCache:function(){w++;_ctorMap={}},_functionFromScript:function(n,t){var u="",f="",e=n.getAttribute(t+"args")||n.getAttribute("args"),i=n.getAttribute("with"),e=(e||"").split(/\s*,\s*/);return i&&i.length&&r.forEach(i.split(/\s*,\s*/),function(n){u+="with("+n+"){";f+="}"}),new Function(e,u+n.innerHTML+f)},instantiate:function(n,i,u){i=i||{};u=u||{};var f=(u.scope||t._scopeName)+"Type",e="data-"+(u.scope||t._scopeName)+"-",s=e+"type",h=e+"mixins",o=[];return r.forEach(n,function(n){var t=f in i?i[f]:n.getAttribute(s)||n.getAttribute(f),r;t&&(r=n.getAttribute(h),t=r?[t].concat(r.split(/\s*,\s*/)):[t],o.push({node:n,types:t}))}),this._instantiate(o,i,u)},_instantiate:function(n,t,i,u){function f(n){return t._started||i.noStart||r.forEach(n,function(n){"function"!=typeof n.startup||n._started||n.startup()}),n}return n=r.map(n,function(n){var r=n.ctor||d(n.types,i.contextRequire);if(!r)throw Error("Unable to resolve constructor for: '"+n.types.join()+"'");return this.construct(r,n.node,t,i,n.scripts,n.inherited)},this),u?h(n).then(f):f(n)},construct:function(n,u,f,e,h,l){function lt(n){for(ht&&i.setObject(ht,n),w=0;w<et.length;w++)s[et[w].advice||"after"](n,et[w].method,i.hitch(n,et[w].func),!0);for(w=0;w<ct.length;w++)ct[w].call(n);for(w=0;w<ot.length;w++)n.watch(ot[w].prop,ot[w].func);for(w=0;w<st.length;w++)y(n,st[w].event,st[w].func);return n}var ft=n&&n.prototype,d,tt,p,w,b,it,ht,ut,nt,rt;for(e=e||{},d={},e.defaults&&i.mixin(d,e.defaults),l&&i.mixin(d,l),a("dom-attributes-explicit")?tt=u.attributes:a("dom-attributes-specified-flag")?tt=r.filter(u.attributes,function(n){return n.specified}):(l=(/^input$|^img$/i.test(u.nodeName)?u:u.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),tt=r.map(l.split(/\s+/),function(n){var t=n.toLowerCase();return{name:n,value:"LI"==u.nodeName&&"value"==n||"enctype"==t?u.getAttribute(t):u.getAttributeNode(t).value}})),it=e.scope||t._scopeName,l="data-"+it+"-",p={},"dojo"!==it&&(p[l+"props"]="data-dojo-props",p[l+"type"]="data-dojo-type",p[l+"mixins"]="data-dojo-mixins",p[it+"type"]="dojotype",p[l+"id"]="data-dojo-id"),w=0,it=[];b=tt[w++];){nt=b.name;rt=nt.toLowerCase();b=b.value;switch(p[rt]||rt){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":ut=b;break;case"data-dojo-id":case"jsid":ht=b;break;case"data-dojo-attach-point":case"dojoattachpoint":d.dojoAttachPoint=b;break;case"data-dojo-attach-event":case"dojoattachevent":d.dojoAttachEvent=b;break;case"class":d["class"]=u.className;break;case"style":d.style=u.style&&u.style.cssText;break;default:if(nt in ft||(nt=g(n)[rt]||nt),nt in ft)switch(typeof ft[nt]){case"string":d[nt]=b;break;case"number":d[nt]=b.length?Number(b):NaN;break;case"boolean":d[nt]="false"!=b.toLowerCase();break;case"function":d[nt]=""===b||-1!=b.search(/[^\w\.]+/i)?new Function(b):i.getObject(b,!1)||new Function(b);it.push(nt);break;default:rt=ft[nt];d[nt]=rt&&"length"in rt?b?b.split(/\s*,\s*/):[]:rt instanceof Date?""==b?new Date(""):"now"==b?new Date:c.fromISOString(b):rt instanceof o?t.baseUrl+b:k(b)}else d[nt]=b}}for(tt=0;tt<it.length;tt++)p=it[tt].toLowerCase(),u.removeAttribute(p),u[p]=null;if(ut)try{ut=k.call(e.propsThis,"{"+ut+"}");i.mixin(d,ut)}catch(at){throw Error(at.toString()+" in data-dojo-props='"+ut+"'");}i.mixin(d,f);h||(h=n&&(n._noScript||ft._noScript)?[]:v("> script[type^='dojo/']",u));var et=[],ct=[],ot=[],st=[];if(h)for(w=0;w<h.length;w++)p=h[w],u.removeChild(p),f=p.getAttribute(l+"event")||p.getAttribute("event"),e=p.getAttribute(l+"prop"),ut=p.getAttribute(l+"method"),it=p.getAttribute(l+"advice"),tt=p.getAttribute("type"),p=this._functionFromScript(p,l),f?"dojo/connect"==tt?et.push({method:f,func:p}):"dojo/on"==tt?st.push({event:f,func:p}):d[f]=p:"dojo/aspect"==tt?et.push({method:ut,advice:it,func:p}):"dojo/watch"==tt?ot.push({prop:e,func:p}):ct.push(p);return n=(h=n.markupFactory||ft.markupFactory)?h(d,u,n):new n(d,u),n.then?n.then(lt):lt(n)},scan:function(i,u){function g(n){if(!n.inherited){n.inherited={};var t=n.node,i=g(n.parent),t={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(tt)||i.textDir};for(var r in t)t[r]&&(n.inherited[r]=t[r])}return n.inherited}var k=[],y=[],nt={},it=(u.scope||t._scopeName)+"Type",w="data-"+(u.scope||t._scopeName)+"-",rt=w+"type",tt=w+"textdir",w=w+"mixins",f=i.firstChild,e=u.inherited,p,h,s,o,c,v,b;if(!e){p=function(n,t){return n.getAttribute&&n.getAttribute(t)||n.parentNode&&p(n.parentNode,t)};e={dir:p(i,"dir"),lang:p(i,"lang"),textDir:p(i,tt)};for(h in e)e[h]||delete e[h]}for(e={inherited:e};;)if(f)if(1!=f.nodeType)f=f.nextSibling;else if(s&&"script"==f.nodeName.toLowerCase())(c=f.getAttribute("type"))&&/^dojo\/\w/i.test(c)&&s.push(f),f=f.nextSibling;else if(o)f=f.nextSibling;else if(c=f.getAttribute(rt)||f.getAttribute(it),h=f.firstChild,c||h&&(3!=h.nodeType||h.nextSibling)){if(o=null,c){v=f.getAttribute(w);s=v?[c].concat(v.split(/\s*,\s*/)):[c];try{o=d(s,u.contextRequire)}catch(ut){}o||r.forEach(s,function(n){~n.indexOf("/")&&!nt[n]&&(nt[n]=!0,y[y.length]=n)});v=o&&!o.prototype._noScript?[]:null;e={types:s,ctor:o,parent:e,node:f,scripts:v};e.inherited=g(e);k.push(e)}else e={node:f,scripts:s,parent:e};s=v;o=f.stopParser||o&&o.prototype.stopParser&&!u.template;f=h}else f=f.nextSibling;else{if(!e||!e.node)break;f=e.node.nextSibling;o=!1;e=e.parent;s=e.scripts}return b=new l,y.length?(a("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+y.join(", ")),(u.contextRequire||n)(y,function(){b.resolve(r.filter(k,function(n){var t,i;if(!n.ctor)try{n.ctor=d(n.types,u.contextRequire)}catch(r){}for(t=n.parent;t&&!t.types;)t=t.parent;return i=n.ctor&&n.ctor.prototype,n.instantiateChildren=!(i&&i.stopParser&&!u.template),n.instantiate=!t||t.instantiate&&t.instantiateChildren,n.instantiate}))})):b.resolve(k),b.promise},_require:function(t,r){var f=k("{"+t.innerHTML+"}"),u=[],e=[],o=new l,h=r&&r.contextRequire||n;for(var s in f)u.push(s),e.push(f[s]);return h(e,function(){for(var n=0;n<u.length;n++)i.setObject(u[n],arguments[n]);o.resolve(arguments)}),o.promise},_scanAmd:function(n,t){var r=new l,i=r.promise,u;return r.resolve(!0),u=this,v("script[type='dojo/require']",n).forEach(function(n){i=i.then(function(){return u._require(n,t)});n.parentNode.removeChild(n)}),i},parse:function(n,t){var u;!n||"string"==typeof n||"nodeType"in n||(t=n,n=t.rootNode);u=n?f.byId(n):e.body();t=t||{};var s=t.template?{template:!0}:{},r=[],o=this,h=this._scanAmd(u,t).then(function(){return o.scan(u,t)}).then(function(n){return o._instantiate(n,s,t,!0)}).then(function(n){return r=r.concat(n)}).otherwise(function(n){console.error("dojo/parser::parse() error",n);throw n;});return i.mixin(r,h),r}},t.parser=b,u.parseOnLoad&&p(100,b,"parse"),b})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,t){var i={};return n.setObject("dojo.date.stamp",i),i.fromISOString=function(n,r){var u,f,e,o;return i._isoRegExp||(i._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/),u=i._isoRegExp.exec(n),f=null,u&&(u.shift(),u[1]&&u[1]--,u[6]&&(u[6]*=1e3),r&&(r=new Date(r),t.forEach(t.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(n){return r["get"+n]()}),function(n,t){u[t]=u[t]||n})),f=new Date(u[0]||1970,u[1]||0,u[2]||1,u[3]||0,u[4]||0,u[5]||0,u[6]||0),100>u[0]&&f.setFullYear(u[0]||1970),e=0,o=u[7]&&u[7].charAt(0),"Z"!=o&&(e=60*(u[8]||0)+(Number(u[9])||0),"-"!=o&&(e*=-1)),o&&(e-=f.getTimezoneOffset()),e&&f.setTime(f.getTime()+6e4*e)),f},i.toISOString=function(n,t){var u=function(n){return 10>n?"0"+n:n};t=t||{};var f=[],i=t.zulu?"getUTC":"get",r="";if("time"!=t.selector&&(r=n[i+"FullYear"](),r=["0000".substr((r+"").length)+r,u(n[i+"Month"]()+1),u(n[i+"Date"]())].join("-")),f.push(r),"date"!=t.selector){if(r=[u(n[i+"Hours"]()),u(n[i+"Minutes"]()),u(n[i+"Seconds"]())].join(":"),i=n[i+"Milliseconds"](),t.milliseconds&&(r+="."+(100>i?"0":"")+u(i)),t.zulu)r+="Z";else if("time"!=t.selector)var i=n.getTimezoneOffset(),e=Math.abs(i),r=r+((0<i?"-":"+")+u(Math.floor(e/60))+":"+u(e%60));f.push(r)}return f.join("T")},i})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(n,t,i,r,u,f){return n([f,u],{_onMap:function(n){var t=this.constructor._onMap,i;return t&&t.FINAL||(delete this.constructor._onMap,t=this.registerConnectEvents(),t.FINAL=!0),n=n.toLowerCase(),t[n]?i=this[t[n].method]:(n=this._onCamelCase(n),this[n]&&(i=n)),i},on:function(n,t){var u=this._onMap(n),i=n.replace(/\-/g,""),f="on"+i in this.domNode;return u||!f?this.inherited(arguments):this.own(r(this.domNode,i,t))[0]},emit:function(n,i){var e,o,r,u=n.toLowerCase(),f=this.constructor._onMap||this.registerConnectEvents();return o=this[this._onMap(u)],i=i||{},i.target||(i.target=this),o&&f&&f[u]&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},f[u].argKeys)(i),r=t.mixin({},arguments),r[2]=e,r[0]=f[u].name.replace(/^on/,"")),this.inherited(r||arguments)}})})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(n){n&&(this.name=n.name,this.title=n.title,this.description=n.description,this.extent=n.extent,this.legendURL=n.legendURL,this.subLayers=n.subLayers?n.subLayers:[],this.allExtents=n.allExtents?n.allExtents:[],this.spatialReferences=n.spatialReferences?n.spatialReferences:[],this.queryable=!!n.queryable,this.showPopup=!!n.showPopup)},clone:function(){var n={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},t;this.extent&&(n.extent=this.extent.getExtent());n.subLayers=[];i.forEach(this.subLayers,function(t){n.subLayers.push(t.clone())});n.allExtents=[];for(t in this.allExtents)t=parseInt(t,10),isNaN(t)||(n.allExtents[t]=this.allExtents[t].getExtent());return n.spatialReferences=[],i.forEach(this.spatialReferences,function(t){n.spatialReferences.push(t)}),n.queryable=this.queryable,n.showPopup=this.showPopup,n}}),r("extend-esri")&&t.setObject("layers.WMSLayerInfo",n,u),n})},"*noref":1}});define("esri/layers/WMSLayer","require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){return i=i([p],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(t,i){var u=c.urlToObject(t);u.query&&(u.query.version||u.query.Version||u.query.VERSION)&&(this.version=u.query.version||u.query.Version||u.query.VERSION);this.url=t=this._stripParameters(t,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));this._url=c.urlToObject(t);this._getCapabilitiesURL=t;this._initLayer=r.hitch(this,this._initLayer);this._parseCapabilities=r.hitch(this,this._parseCapabilities);this._getCapabilitiesError=r.hitch(this,this._getCapabilitiesError);i?(this.customParameters=i.customParameters,this.customLayerParameters=i.customLayerParameters,this.imageFormat=this._getImageFormat(i.format),this.imageTransparency=!1!==i.transparent,this.visibleLayers=i.visibleLayers?i.visibleLayers:[],this.version=i.version||this.version,i.resourceInfo?this._readResourceInfo(i.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=n.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);this._createChildLayer()},setVisibleLayers:function(n){this.visibleLayers=(n=this._checkVisibleLayersList(n))?n:[];this.refresh(!0)},setImageFormat:function(n){this.imageFormat=this._getImageFormat(n);this.refresh(!0)},setImageTransparency:function(n){this.imageTransparency=n;this.refresh(!0)},setCustomParameters:function(n,t){this.customParameters=n;this.customLayerParameters=t;this.refresh(!0)},refresh:function(){this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,arguments)},getImageUrl:function(n,t,i,r){if(this.visibleLayers&&0!==this.visibleLayers.length){n=this._getImageParams(n,t,i);n=this._mixinCustomLayerParameters(n);t=this.getMapURL;var u;t+=-1===t.indexOf("?")?"?":"";for(u in n)n.hasOwnProperty(u)&&(t+="?"===t.substring(t.length-1,t.length)?"":"&",t+=u+"="+n[u]);r(c.addProxy(t))}else r(this._blankImageURL)},_setMap:function(n){var t=this.inherited(arguments);return n.wrapAround180?this._childLayer&&(this.suspended&&this._childLayer.suspend(),this._childLayer._setMap(n,t)):this._childLayer=this.extentProcessor=null,t},_unsetMap:function(n){this._childLayer&&this._childLayer._unsetMap(n,this._div);this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new p(null,{extentProcessor:this._createExtentProcessor(1)});this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=r.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(n){return r.hitch(this,this._extentProcessor,n)},_extentProcessor:function(n,t){var i=t.extent,r=t.width,u=0;if(i){var f=i.getWidth()/r,o=i.bisect(),i=o.extents,e=i[n];e&&(r=o.marginLeft/f,u=0===n?r:r+i[0].getWidth()/f,r=Math.ceil(e.getWidth()/f),u=Math.ceil(u));i=e}return{extent:i,width:r,marginLeft:u}},_getImageParams:function(n,t,i){var f=n.spatialReference.wkid,e,r;-1===u.indexOf(this.spatialReferences,f)&&n.spatialReference.latestWkid&&(f=n.spatialReference.latestWkid);u.some(this._WEB_MERCATOR,function(n){return n==f})&&(e=u.filter(this.spatialReferences,function(n){return u.some(this._WEB_MERCATOR,function(t){return t==n})},this),0===e.length&&(e=u.filter(this.spatialReferences,function(n){return u.some(this._WORLD_MERCATOR,function(t){return t==n})},this)),f=0<e.length?e[0]:this._WEB_MERCATOR[0]);this.spatialReferences=u.filter(this.spatialReferences,function(n){return n!==f});this.spatialReferences.unshift(f);var e=n.xmin,o=n.xmax,s=n.ymin;return n=n.ymax,r={SERVICE:"WMS",REQUEST:"GetMap"},r.FORMAT=this.imageFormat,r.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE",r.STYLES="",r.VERSION=this.version,r.LAYERS=this.visibleLayers?this.visibleLayers.toString():null,r.WIDTH=t,r.HEIGHT=i,this.maxWidth<t&&(r.WIDTH=this.maxWidth),this.maxHeight<i&&(r.HEIGHT=this.maxHeight),t=f?f:NaN,isNaN(t)||("1.3.0"==this.version?r.CRS="EPSG:"+t:r.SRS="EPSG:"+t),r.BBOX="1.3.0"==this.version&&this._useLatLong(t)?s+","+e+","+n+","+o:e+","+s+","+o+","+n,r},_initLayer:function(){var t,n,i;this.spatialReference=new a(this.extent.spatialReference);this.initialExtent=new v(this.extent);this.fullExtent=new v(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);t=r.hitch(this,function(){this.loaded=!0;this.onLoad(this);var n=this._loadCallback;n&&(delete this._loadCallback,n(this))});f("chrome")?(n=e.defaults.io,i="with-credentials"===n.useCors?c.canUseXhr(this.getMapURL,!0):-1,(n=-1<i?n.corsEnabledServers[i]:null)&&n.withCredentials?h({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){t()}):t()):t()},_readResourceInfo:function(n){n.extent?n.layerInfos?(this.extent=n.extent,this.allExtents[0]=n.extent,this.layerInfos=n.layerInfos,this.description=n.description?n.description:"",this.copyright=n.copyright?n.copyright:"",this.title=n.title?n.title:"",this.getMapURL=n.getMapURL?n.getMapURL:this._getCapabilitiesURL,this.getFeatureInfoURL=n.getFeatureInfoURL,this.featureInfoFormat=n.featureInfoFormat,this.version=n.version?n.version:"1.3.0",this.maxWidth=n.maxWidth?n.maxWidth:5e3,this.maxHeight=n.maxHeight?n.maxHeight:5e3,this.spatialReferences=n.spatialReferences?n.spatialReferences:[],this.imageFormat=this._getImageFormat(n.format),this.setScaleRange(n.minScale,n.maxScale),this.customLayerParameters=n.customLayerParameters||this.customLayerParameters,this.customParameters=n.customParameters||this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},_getCapabilities:function(){var n=this._url.query?this._url.query:{},t,i;n.SERVICE="WMS";n.REQUEST="GetCapabilities";this.version&&(n.VERSION=this.version);n=this._mixinCustomParameters(n);t=this._url.path+"?";for(i in n)n.hasOwnProperty(i)&&(t+="?"==t.substring(t.length-1,t.length)?"":"&",t+=i+"="+n[i]);h({url:t,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(n){var e,s,i,f,h;if(n)if(e=this,this.version=this._getAttributeValue("WMS_Capabilities","version",n,null),this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",n,"1.3.0")),i=this._getTag("Service",n),this.title=this._getTagValue("Title",i,""),this.title||(this.title=this._getTagValue("Name",i,"")),this.copyright=this._getTagValue("AccessConstraints",i,""),this.description=this._getTagValue("Abstract",i,""),this.maxWidth=parseInt(this._getTagValue("MaxWidth",i,5e3),10),this.maxHeight=parseInt(this._getTagValue("MaxHeight",i,5e3),10),i=this._getTag("Layer",n)){var r=this._getLayerInfo(i),o=0,c=null,i=this._getTag("Capability",n);if(u.forEach(i.childNodes,function(n){"Layer"==n.nodeName&&(0===o?c=n:(1===o&&r.name&&(r.name="",r.subLayers=[],r.subLayers.push(this._getLayerInfo(c))),r.subLayers.push(this._getLayerInfo(n))),o++)},this),r&&(this.layerInfos=r.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[r]),this.extent=r.extent,this.extent||(r.extent=new v(this.layerInfos[0].extent.toJson()),this.extent=r.extent),this.allExtents=r.allExtents,this.allExtents&&this.allExtents.length||(r.allExtents=[],u.forEach(this.layerInfos[0].allExtents,function(n,t){n&&(r.allExtents[t]=new v(n.toJson()))}),this.allExtents=r.allExtents),this.spatialReferences=r.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length))for(s=function(n){for(var t,i,r=0;r<n.subLayers.length;r++)if(t=n.subLayers[r],i=t.spatialReferences,!i.length&&t.subLayers&&0<t.subLayers.length&&(i=s(t)),i.length)return i;return[]},i=0;i<this.layerInfos.length;i++)if(f=this.layerInfos[i],this.spatialReferences=this.layerInfos[0].spatialReferences,!this.spatialReferences.length&&f.subLayers&&0<f.subLayers.length&&(this.spatialReferences=s(f)),this.spatialReferences.length)break;i=function(i){return(i=t.query("DCPType",e._getTag(i,n)))&&0<i.length&&(i=t.query("HTTP",i[0]))&&0<i.length&&(i=t.query("Get",i[0]))&&0<i.length&&(i=e._getAttributeValue("OnlineResource","xlink:href",i[0],null))?(i.indexOf("&")===i.length-1&&(i=i.substring(0,i.length-1)),e._stripParameters(i,["service","request"])):null};f=function(i){var r=[];return 0===t.query("Operation",n).length?u.forEach(t.query("Format",e._getTag(i,n)),function(n){r.push(n.text?n.text:n.textContent)}):u.forEach(t.query("Operation",n),function(n){n.getAttribute("name")===i&&u.forEach(t.query("Format",n),function(n){r.push(n.text?n.text:n.textContent)})}),r};this.getMapURL=i("GetMap")||this._getCapabilitiesURL;this.getMapFormats=f("GetMap");u.some(this.getMapFormats,function(n){return-1<n.indexOf(this.imageFormat)},this)||(this.imageFormat=this.getMapFormats[0]);(this.getFeatureInfoURL=i("GetFeatureInfo"))&&(this.getFeatureInfoFormats=f("GetFeatureInfo"),-1<u.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<u.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain"));this.featureInfoFormat||(h=function(n){if(n&&(n.queryable=!1,n.subLayers))for(var t=0;t<n.subLayers.length;t++)h(n.subLayers[t])},h(r));this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."));else this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(n){n&&n.message&&(n.message="GetCapabilities request for "+this._getCapabilitiesURL+" failed. ("+n.message+")");this._errorHandler(n)},_getLayerInfo:function(n){var t,f,r,i,e;return n?(t=new w,t.name="",t.title="",t.description="",t.allExtents=[],t.spatialReferences=[],t.queryable="1"===n.getAttribute("queryable"),t.subLayers=[],f=this._getTag("LatLonBoundingBox",n),f&&(t.allExtents[0]=this._getExtent(f,4326)),r=this._getTag("EX_GeographicBoundingBox",n),r&&(i=new v(0,0,0,0,new a({wkid:4326})),i.xmin=parseFloat(this._getTagValue("westBoundLongitude",r,0)),i.ymin=parseFloat(this._getTagValue("southBoundLatitude",r,0)),i.xmax=parseFloat(this._getTagValue("eastBoundLongitude",r,0)),i.ymax=parseFloat(this._getTagValue("northBoundLatitude",r,0)),t.allExtents[0]=i),f||r||(i=new v(-180,-90,180,90,new a({wkid:4326})),t.allExtents[0]=i),t.extent=t.allExtents[0],e=-1<u.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS",u.forEach(n.childNodes,function(n){if("Name"==n.nodeName)t.name=(n.text?n.text:n.textContent)||"";else if("Title"==n.nodeName)t.title=(n.text?n.text:n.textContent)||"";else if("Abstract"==n.nodeName)t.description=(n.text?n.text:n.textContent)||"";else if("BoundingBox"==n.nodeName){var i=n.getAttribute(e);i&&0===i.indexOf("EPSG:")?(i=parseInt(i.substring(5),10),0===i||isNaN(i)||(n="1.3.0"==this.version?this._getExtent(n,i,this._useLatLong(i)):this._getExtent(n,i),t.allExtents[i]=n,t.extent||(t.extent=n))):i&&0===i.indexOf("CRS:")?(i=parseInt(i.substring(4),10),0===i||isNaN(i)||(this._CRS_TO_EPSG[i]&&(i=this._CRS_TO_EPSG[i]),t.allExtents[i]=this._getExtent(n,i))):(i=parseInt(i,10),0===i||isNaN(i)||(t.allExtents[i]=this._getExtent(n,i)))}else n.nodeName==e?(n=(n.text?n.text:n.textContent).split(" "),u.forEach(n,function(n){n=-1<n.indexOf(":")?parseInt(n.split(":")[1],10):parseInt(n,10);0===n||isNaN(n)||(this._CRS_TO_EPSG[n]&&(n=this._CRS_TO_EPSG[n]),-1==u.indexOf(t.spatialReferences,n)&&t.spatialReferences.push(n))},this)):"Style"!=n.nodeName||t.legendURL?"Layer"===n.nodeName&&t.subLayers.push(this._getLayerInfo(n)):(n=this._getTag("LegendURL",n))&&(n=this._getTag("OnlineResource",n))&&(t.legendURL=n.getAttribute("xlink:href"))},this),t.title=t.title||t.name,t):null},_getImageFormat:function(n){switch(n?n.toLowerCase():""){case"jpg":return"image/jpeg";case"bmp":return"image/bmp";case"gif":return"image/gif";case"svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case"image/jpeg":return"jpg";case"image/bmp":return"bmp";case"image/gif":return"gif";case"image/svg+xml":return"svg";default:return"png"}},_getExtent:function(n,t,i){var r;if(n){r=new v;var u=parseFloat(n.getAttribute("minx")),f=parseFloat(n.getAttribute("miny")),e=parseFloat(n.getAttribute("maxx"));n=parseFloat(n.getAttribute("maxy"));i?(r.xmin=isNaN(f)?-1*Number.MAX_VALUE:f,r.ymin=isNaN(u)?-1*Number.MAX_VALUE:u,r.xmax=isNaN(n)?Number.MAX_VALUE:n,r.ymax=isNaN(e)?Number.MAX_VALUE:e):(r.xmin=isNaN(u)?-1*Number.MAX_VALUE:u,r.ymin=isNaN(f)?-1*Number.MAX_VALUE:f,r.xmax=isNaN(e)?Number.MAX_VALUE:e,r.ymax=isNaN(n)?Number.MAX_VALUE:n);r.spatialReference=new a({wkid:t})}return r},_useLatLong:function(n){for(var r,i,t=0;t<this._REVERSED_LAT_LONG_RANGES.length;t++)if(i=this._REVERSED_LAT_LONG_RANGES[t],n>=i[0]&&n<=i[1]){r=!0;break}return r},_getTag:function(n,i){var r=t.query(n,i);return r&&0<r.length?r[0]:null},_getTagValue:function(n,i,r){return(n=t.query(n,i))&&0<n.length?n[0].text?n[0].text:n[0].textContent:r},_getAttributeValue:function(n,i,r,u){return(n=t.query(n,r))&&0<n.length?n[0].getAttribute(i):u},_checkVisibleLayersList:function(n){if(n&&0<n.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof n[0]){var t=[];u.forEach(n,function(n){n<this.layerInfos.length&&t.push(this.layerInfos[n].name)},this);n=t}return n},_stripParameters:function(n,t){var r=c.urlToObject(n),i,f=[];for(i in r.query)r.query.hasOwnProperty(i)&&-1===u.indexOf(t,i.toLowerCase())&&f.push(i+"="+r.query[i]);return r.path+(f.length?"?"+f.join("&"):"")},_getPopupGraphic:function(t,i){var h=this.visibleLayers,e,f,s;if(!h||0===h.length)return null;e=this._popupGraphic;e||(e=new l({title:this.title||"",description:'<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;"><iframe src="{QUERY_URL}" width="250" height="147" frameborder="0" marginwidth="0" marginheight="0" style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+n.toUrl("../dijit/images/loading-throb.gif")+"') transparent center no-repeat;\" onload=\"(event.target || event.srcElement).style.background = 'none';\"><\/iframe><\/div>"}),e=this._popupGraphic=new o(null,null,{},e),e._layer=this);var a=function(n){var t=[],i,r;if(n&&(n.queryable&&n.showPopup&&n.name&&t.push(n.name),n.subLayers))for(i=0;i<n.subLayers.length;i++)r=a(n.subLayers[i]),r.length&&(t=t.concat(r));return t},c=a({subLayers:this.layerInfos}),c=u.filter(c,function(n){return-1<u.indexOf(h,n)});if(c.length){var f=this.getFeatureInfoURL,r=this._getImageParams(t.extent,t.width,t.height),r=this._mixinCustomLayerParameters(r);r.REQUEST="GetFeatureInfo";r.INFO_FORMAT=this.featureInfoFormat;r.QUERY_LAYERS=c.join();r.FEATURE_COUNT=25;"1.3.0"===this.version?(r.I=Math.round(i.x),r.J=Math.round(i.y)):(r.X=Math.round(i.x),r.Y=Math.round(i.y));f=f+(-1===f.indexOf("?")?"?":"");for(s in r)r.hasOwnProperty(s)&&(f+="?"===f.substring(f.length-1,f.length)?"":"&",f+=s+"="+r[s]);return e.attributes.QUERY_URL=f,e}return null},_mixinCustomParameters:function(n){if(this.customParameters)for(var t in this.customParameters)n[t]=encodeURIComponent(this.customParameters[t]);return n},_mixinCustomLayerParameters:function(n){var t,i;if(this.customLayerParameters||this.customParameters){t=r.clone(this.customParameters||{});r.mixin(t,this.customLayerParameters||{});for(i in t)"styles"===i.toLowerCase()&&delete n.STYLES,n[i]=encodeURIComponent(t[i])}return n}}),f("extend-esri")&&r.setObject("layers.WMSLayer",i,s),i})},"esri/layers/WMTSLayer":function(){define("esri/layers/WMTSLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){return t=t([y],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(n,t){if(this.version="1.0.0",this.tileUr=this._url=n,this.serviceMode="RESTful",this._parseCapabilities=i.hitch(this,this._parseCapabilities),this._getCapabilitiesError=i.hitch(this,this._getCapabilitiesError),t||(t={}),t.serviceMode)if("KVP"===t.serviceMode||"RESTful"===t.serviceMode)this.serviceMode=t.serviceMode;else{console.error("WMTS mode could only be 'KVP' or 'RESTful'");return}this.customParameters=t.customParameters;this.customLayerParameters=t.customLayerParameters;this.layerInfo=new w;t.layerInfo&&(this.layerInfo=t.layerInfo,this._identifier=t.layerInfo.identifier,this._tileMatrixSetId=t.layerInfo.tileMatrixSet,t.layerInfo.format&&(this.format="image/"+t.layerInfo.format),this._style=t.layerInfo.style,this.title=t.layerInfo.title,this._dimension=t.layerInfo.dimension,this._dimension2=t.layerInfo.dimension2);t.resourceInfo?(this.version=t.resourceInfo.version,t.resourceInfo.getTileUrl&&(this._url=this.tileUrl=t.resourceInfo.getTileUrl),this.copyright=t.resourceInfo.copyright,this.layerInfos=t.resourceInfo.layerInfos,this.customParameters=t.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=t.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities();this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""}},setActiveLayer:function(n){this.setVisibleLayer(n)},setVisibleLayer:function(n){this._setActiveLayer(n);this.refresh(!0)},setCustomParameters:function(n,t){this.customParameters=n;this.customLayerParameters=t;this.refresh(!0)},getTileUrl:function(n,t,i){return n=this._levelToLevelValue[n],n=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[t%this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,n).replace(/\{TileRow\}/gi,t).replace(/\{TileCol\}/gi,i).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,n).replace(/\{row\}/gi,t).replace(/\{col\}/gi,i),n=this._appendCustomLayerParameters(n),this.addTimestampToURL(n)},getTileUrlTemplate:function(n){var i=n.identifier,u=n.tileMatrixSet,t=n.format,f=n.style,e=n.dimension,o=n.dimension2,s;if(i?n=r.filter(this.layers,function(n){return n.identifier===i})[0]:(n=this.layers[0],i=this.layers[0].identifier),n){if(t){if(!(-1===t.indexOf("image/")&&-1<r.indexOf(n.formats,t))&&(-1===t.indexOf("image/")&&(t="image/"+t),-1===r.indexOf(n.formats,t))){console.error("The layer doesn't support the format of "+t);this.onError(Error("The layer doesn't support the format of "+t));return}}else t=n.formats[0];if(f){if(-1===r.indexOf(n.styles,f)){console.error("The layer doesn't support the style of "+f);this.onError(Error("The layer doesn't support the style of "+f));return}}else f=n.styles[0];if(!e&&n.dimensions)e=n.dimensions[0];else if(-1===r.indexOf(n.dimensions,e)){console.error("The layer doesn't support the dimension of "+e);this.onError(Error("The layer doesn't support the dimension of "+e));return}if(!o&&n.dimensions2)o=n.dimensions2[0];else if(-1===r.indexOf(n.dimensions2,o)){console.error("The layer doesn't support the dimension of "+o);this.onError(Error("The layer doesn't support the dimension of "+o));return}if(u){if(s=r.filter(n.tileMatrixSetInfos,function(n){return n.tileMatrixSet===u})[0],!s){console.error("The tileMatrixSetId "+u+" is not supported by the layer of "+i);this.onError(Error("The tileMatrixSetId "+u+" is not supported by the layer of "+i));return}}else(s=r.filter(n.tileMatrixSetInfos,function(n){return"GoogleMapsCompatible"===n.tileMatrixSet})[0])||(s=n.tileMatrixSetInfos[0]),u=s.tileMatrixSet;return this._getTileUrlTemplate(i,u,t,f,e,o)}console.error("couldn't find the layer "+i);this.onError(Error("couldn't find the layer "+i))},_getTileUrlTemplate:function(n,t,i,r,u,f){var e;return(n||(n=this._identifier),t||(t=this._tileMatrixSetId),i||(i=this.format),r||""===r||(r=this._style),this.resourceUrls&&0<this.resourceUrls.length)?(e=this.resourceUrls[0].template,e.indexOf(".xxx")===e.length-4&&(e=e.slice(0,e.length-4)),e=e.replace(/\{Style\}/gi,r),e=e.replace(/\{TileMatrixSet\}/gi,t),e=e.replace(/\{TileMatrix\}/gi,"{level}"),e=e.replace(/\{TileRow\}/gi,"{row}"),e=e.replace(/\{TileCol\}/gi,"{col}"),e=e.replace(/\{dimensionValue\}/gi,u),e=e.replace(/\{dimensionValue2\}/gi,f)):("KVP"===this.serviceMode?e=this._url+"SERVICE=WMTS&VERSION="+this.version+"&REQUEST=GetTile&LAYER="+n+"&STYLE="+r+"&FORMAT="+i+"&TILEMATRIXSET="+t+"&TILEMATRIX={level}&TILEROW={row}&TILECOL={col}":"RESTful"===this.serviceMode&&(u="",this._formatDictionary[i.toLowerCase()]&&(u=this._formatDictionary[i.toLowerCase()]),e=this._url+n+"/"+r+"/"+t+"/{level}/{row}/{col}"+u),e)},_parseResourceInfo:function(){var t=this.layerInfos,u,n;for("KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?"),n=0;n<t.length;n++)if(!(this._identifier&&t[n].identifier!==this._identifier||this.title&&t[n].title!==this.title||this._tileMatrixSetId&&t[n].tileMatrixSet!==this._tileMatrixSetId||this.format&&"image/"+t[n].format!==this.format||this._style&&t[n].style!==this._style)){i.mixin(this,{description:t[n].description,tileInfo:t[n].tileInfo,spatialReference:t[n].tileInfo.spatialReference,fullExtent:t[n].fullExtent,initialExtent:t[n].initialExtent,_identifier:t[n].identifier,_tileMatrixSetId:t[n].tileMatrixSet,format:"image/"+t[n].format,_style:t[n].style});break}for(n=0;n<t.length;n++)u=t[n].tileInfo,96!==u.dpi&&(r.forEach(u.lods,function(n){n.scale=96*n.scale/u.dpi}),u.dpi=96),r.forEach(u.lods,function(i){i.resolution=this._getResolution(u.spatialReference.wkid,90.714285714285708*i.scale/96,t[n].tileMatrixSet)},this);this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];r.forEach(this.tileInfo.lods,function(n){this._levelToLevelValue[n.level]=n.levelValue?n.levelValue:n.level},this)},_getCapabilities:function(){var n;"KVP"===this.serviceMode?n=-1<this._url.indexOf("?")?this._url+"&request=GetCapabilities&service=WMTS&version="+this.version:this._url+"?request=GetCapabilities&service=WMTS&version="+this.version:"RESTful"===this.serviceMode&&(n=this._url+"/"+this.version+"/WMTSCapabilities.xml");n=this._appendCustomParameters(n);s({url:n,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(t){var h,e,l,v;if(t=t.replace(/ows:/gi,""),t=f.parse(t),h=n.query("Contents",t)[0],h){for(var i=n.query("OperationsMetadata",t)[0],o=n.query("[name='GetTile']",i)[0],i=this._url,o=n.query("Get",o),a=!1,s,c,u=0;u<o.length;u++)if(e=n.query("Constraint",o[u])[0],!e||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,e)){i=o[u].attributes[0].nodeValue;a=!0;break}else!e||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",e)?s=o[u].attributes[0].nodeValue:(!e||this._getTagWithChildTagValue("AllowedValues","Value","KVP",e))&&(c=o[u].attributes[0].nodeValue);a||("KVP"===this.serviceMode&&s?(i=s,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&c&&(i=c,this.serviceMode="KVP"));-1===i.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(i+="/");"KVP"===this.serviceMode&&(i+=-1<i.indexOf("?")?"":"?");this._url=i;this.copyright=this._getTagValues("Capabilities>ServiceIdentification>AccessConstraints",t)[0];s=n.query("Layer",h);v=[];this.layers=[];r.forEach(s,function(n){l=this._getTagValues("Identifier",n)[0];v.push(l);this.layers.push(this._getWMTSLayerInfo(l,n,h))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else console.error("The WMTS capabilities XML is not valid"),this.onError(Error("The WMTS capabilities XML is not valid"))},_setActiveLayer:function(n){if(n||(n={}),n.identifier&&(this._identifier=n.identifier),n.tileMatrixSet&&(this._tileMatrixSetId=n.tileMatrixSet),n.format&&(this.format=n.format),n.style&&(this._style=n.style),n.dimension&&(this._dimension=n.dimension),n.dimension2&&(this._dimension2=n.dimension2),this.layers)if(this._identifier?n=r.filter(this.layers,function(n){return n.identifier===this._identifier},this)[0]:(n=this.layers[0],this._identifier=this.layers[0].identifier),n){if(this.format){if(-1===this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===r.indexOf(n.formats,this.format)){console.error("The layer doesn't support the format of "+this.format);this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=n.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(this._style){if(-1===r.indexOf(n.styles,this._style)){console.error("The layer doesn't support the style of "+this._style);this.onError(Error("The layer doesn't support the style of "+this._style));return}}else this._style=n.styles[0];if(!this._dimension&&n.dimensions)this._dimension=n.dimensions[0];else if(-1===r.indexOf(n.dimensions,this._dimension)){console.error("The layer doesn't support the dimension of "+this._dimension);this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&n.dimensions2)this._dimension2=n.dimensions2[0];else if(-1===r.indexOf(n.dimensions2,this._dimension2)){console.error("The layer doesn't support the dimension of "+this._dimension2);this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}var t;if(this._tileMatrixSetId){if(t=r.filter(n.tileMatrixSetInfos,function(n){return n.tileMatrixSet===this._tileMatrixSetId},this)[0],!t){console.error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier);this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(t=r.filter(n.tileMatrixSetInfos,function(n){return"GoogleMapsCompatible"===n.tileMatrixSet})[0])||(t=n.tileMatrixSetInfos[0]),this._tileMatrixSetId=t.tileMatrixSet;this.description=n.description;this.title=n.title;this.spatialReference=t.tileInfo.spatialReference;this.tileInfo=t.tileInfo;this._levelToLevelValue=[];r.forEach(this.tileInfo.lods,function(n){this._levelToLevelValue[n.level]=n.levelValue?n.levelValue:n.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=v.geographicToWebMercator(n.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=n.gcsExtent:(this.fullExtent=t.fullExtent,this.initialExtent=t.initialExtent);this.resourceUrls=n.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else console.error("couldn't find the layer "+this._identifier),this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(t,i,u){var w=this._getTagValues("Abstract",i)[0],b=this._getTagValues("Title",i)[0],e=n.query("WGS84BoundingBox",i)[0],l=e?this._getTagValues("LowerCorner",e)[0].split(" "):["-180","-90"],v=e?this._getTagValues("UpperCorner",e)[0].split(" "):["180","90"],e=parseFloat(l[0]),l=parseFloat(l[1]),k=parseFloat(v[0]),v=parseFloat(v[1]),e=new a(e,l,k,v,new c({wkid:4326})),v=this._getTagValues("Identifier",n.query("Style",i)[0]),o=this._getTagValues("Identifier",n.query("Dimension",i)[0]),y=this._getTagValues("Default",n.query("Dimension",i)[0])||this._getTagValues("Value",n.query("Dimension",i)[0]),s=1<n.query("Dimension",i).length?this._getTagValues("Identifier",n.query("Dimension",i)[1]):[],p=1<n.query("Dimension",i).length?this._getTagValues("Default",n.query("Dimension",i)[1])||this._getTagValues("Value",n.query("Dimension",i)[1]):[],l=this._getTagValues("Format",i),h,f;return u=this._getLayerMatrixInfos(i,u),t={identifier:t,tileMatrixSetInfos:u,formats:l,styles:v,title:b,description:w,gcsExtent:e,dimensions:y,dimensions2:p},i=n.query("ResourceURL",i),h=[],r.forEach(i,function(n){if(f=n.getAttribute("template"),o&&y&&o[0]&&y[0])if(-1<f.indexOf("{"+o+"}"))f=f.replace("{"+o+"}","{dimensionValue}");else{var t=f.toLowerCase().indexOf("{"+o[0].toLowerCase()+"}");-1<t&&(f=f.substring(0,t)+"{dimensionValue}"+f.substring(t+o[0].length+2))}s&&p&&s[0]&&p[0]&&(-1<f.indexOf("{"+s+"}")?f=f.replace("{"+s+"}","{dimensionValue2}"):(t=f.toLowerCase().indexOf("{"+s[0].toLowerCase()+"}"),-1<t&&(f=f.substring(0,t)+"{dimensionValue2}"+f.substring(t+s[0].length+2))));h.push({template:f,format:n.getAttribute("format"),resourceType:n.getAttribute("resourceType")})}),h&&0<h.length&&(t.resourceUrls=h),t},_getLayerMatrixInfos:function(n,t){var i,f=[],u;return this._allMatrixInfos||(this._allMatrixInfos=[]),u=this._getTagValues("TileMatrixSet",n),u&&0!==u.length?(r.forEach(u,function(r){var u;if(0<this._allMatrixInfos.length)for(i=0;i<this._allMatrixInfos.length;i++)if(this._allMatrixInfos[i].tileMatrixSet==r){u=this._allMatrixInfos[i];break}u||(u=this._getLayerMatrixInfo(r,n,t),this._allMatrixInfos.push(u));f.push(u)},this),f):void 0},_getLayerMatrixInfo:function(t,i,r){var f,u,b,o,d=[],nt,h,v,w,e,s;i=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",t,i);var k=this._getTagValues("TileMatrix",i),g=this._getTagWithChildTagValue("TileMatrixSet","Identifier",t,r),y=this._getTagValues("SupportedCRS",g)[0];f=parseInt(y.split(":").pop(),10);(900913==f||3857==f)&&(f=102100);-1<y.toLowerCase().indexOf("crs84")||-1<y.toLowerCase().indexOf("crs:84")?(f=4326,o=!0):-1<y.toLowerCase().indexOf("crs83")||-1<y.toLowerCase().indexOf("crs:83")?(f=4269,o=!0):(-1<y.toLowerCase().indexOf("crs27")||-1<y.toLowerCase().indexOf("crs:27"))&&(f=4267,o=!0);nt=new c({wkid:f});h=n.query("TileMatrix",g)[0];r=parseInt(this._getTagValues("TileWidth",h)[0],10);i=parseInt(this._getTagValues("TileHeight",h)[0],10);u=this._getTagValues("TopLeftCorner",h)[0].split(" ");v=u[0];w=u[1];1<v.split("E").length&&(u=v.split("E"),v=u[0]*Math.pow(10,u[1]));1<w.split("E").length&&(u=w.split("E"),w=u[0]*Math.pow(10,u[1]));var v=parseFloat(v),w=parseFloat(w),tt=o&&4326===f&&90===v&&-180===w;for(u=0;u<this._flippingAxisForWkids.length;u++)if(y.split(":").pop()>=this._flippingAxisForWkids[u][0]&&y.split(":").pop()<=this._flippingAxisForWkids[u][1]||4326===f&&(!o||tt)){4326===f&&90<v&&(v="90");b=new l(w,v,nt);break}if(u===this._flippingAxisForWkids.length&&(b=new l(v,w,nt)),0===k.length)for(k=n.query("TileMatrix",g),u=0;u<k.length;u++)o=this._getLodFromTileMatrix(k[u],f,u,t),d.push(o);else for(u=0;u<k.length;u++)o=this._getTagWithChildTagValue("TileMatrix","Identifier",k[u],g),o=this._getLodFromTileMatrix(o,f,u,t),d.push(o);return f=n.query("BoundingBox",g)[0],f&&(e=this._getTagValues("LowerCorner",f)[0].split(" "),s=this._getTagValues("UpperCorner",f)[0].split(" ")),e&&1<e.length&&s&&1<s.length?(h=parseFloat(e[0]),f=parseFloat(e[1]),e=parseFloat(s[0]),s=parseFloat(s[1])):(e=this._getTagValues("MatrixWidth",h)[0],f=this._getTagValues("MatrixHeight",h)[0],h=b.x,s=b.y,e=h+e*i*d[0].resolution,f=s-f*r*d[0].resolution),s=e=new a(h,f,e,s,nt),b=new p({dpi:96,spatialReference:nt,format:this.format,rows:r,cols:i,origin:b,lods:d}),{tileMatrixSet:t,fullExtent:s,initialExtent:e,tileInfo:b}},_getCapabilitiesError:function(n){console.error("Failed to get capabilities xml");this.onError(n)},_getLodFromTileMatrix:function(n,t,i,r){var u=this._getTagValues("Identifier",n)[0];return n=this._getTagValues("ScaleDenominator",n)[0],1<n.split("E").length?(n=n.split("E"),n=n[0]*Math.pow(10,n[1])):n=parseFloat(n),t=this._getResolution(t,n,r),{level:i,levelValue:u,scale:1.0582677165354331*n,resolution:t}},_getResolution:function(n,t,i){return n=o.isDefined(h[n])?h.values[h[n]]:"default028mm"===i?6370997*Math.PI/180:6378137*Math.PI/180,7*t/25e3/n},_getTag:function(t,i){var r=n.query(t,i);return r&&0<r.length?r[0]:null},_getTagValues:function(t,i){var s=[],f=t.split(">"),e,o;if(e=n.query(f[0],i)[0],1<f.length){for(o=1;o<f.length-1;o++)e=n.query(f[o],e)[0];f=n.query(f[f.length-1],e)}else f=n.query(f[0],i);return f&&0<f.length&&r.forEach(f,function(n){9>u("ie")?s.push(n.childNodes.length?n.childNodes[0].nodeValue:""):s.push(n.textContent)}),s},_getAttributeValues:function(t,i,u){t=n.query(t,u);var f=[];return t&&0<t.length&&r.forEach(t,function(n){f.push(n.getAttribute(i))}),f},_getTagWithChildTagValue:function(t,i,r,f){f=f.childNodes;for(var s,e=0;e<f.length;e++)if(-1<f[e].nodeName.indexOf(t)&&(9>u("ie")?o.isDefined(n.query(i,f[e])[0])&&(s=n.query(i,f[e])[0].childNodes[0].nodeValue):o.isDefined(n.query(i,f[e])[0])&&(s=n.query(i,f[e])[0].textContent),s===r||r.split(":")&&s===r.split(":")[1]))return f[e]},_appendCustomParameters:function(n){var t;if(this.customParameters)for(t in this.customParameters)n+=(-1===n.indexOf("?")?"?":"&")+t+"="+encodeURIComponent(this.customParameters[t]);return n},_appendCustomLayerParameters:function(n){var r,t;if(this.customLayerParameters||this.customParameters)for(r in t=i.clone(this.customParameters||{}),i.mixin(t,this.customLayerParameters||{}),t)n+=(-1===n.indexOf("?")?"?":"&")+r+"="+encodeURIComponent(t[r]);return n},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]}),u("extend-esri")&&i.setObject("layers.WMTSLayer",t,e),t})},"esri/layers/WMTSLayerInfo":function(){define("esri/layers/WMTSLayerInfo",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(n){n&&(this.title=n.title,this.tileMatrixSet=n.tileMatrixSet,this.format=n.format,this.style=n.style,this.tileInfo=n.tileInfo,this.fullExtent=n.fullExtent,this.initialExtent=n.initialExtent,this.identifier=n.identifier,this.description=n.description,this.dimension=n.dimension)}}),i("extend-esri")&&t.setObject("layers.WMTSLayerInfo",n,r),n})},"esri/layers/WebTiledLayer":function(){define("esri/layers/WebTiledLayer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function y(n,i){var f=[],e,r,u;if(n&&i&&(i.customLayerParameters||i.customParameters)){e=t.clone(i.customParameters||{});t.mixin(e,i.customLayerParameters||{});r=h.urlToObject(n);for(u in r.query)e.hasOwnProperty(u)||f.push(u+"="+r.query[u]);n=r.path+(f.length?"?"+f.join("&"):"")}return n}return n=n(a,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(n,o){var w,a,p,k,b;if(o||(o={}),this.urlTemplate=n=y(n,o.wmtsInfo),p=new l(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new c({wkid:102100})),w=new l(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new c({wkid:102100})),this.initialExtent=o.initialExtent||p,this.fullExtent=o.fullExtent||w,this.tileInfo=o.tileInfo?o.tileInfo:new v({dpi:96,rows:256,cols:256,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:591657527.591555},{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.074645535411904163,scale:282.124294},{level:22,resolution:.037322767705952081,scale:141.062147},{level:23,resolution:.018661383852976041,scale:70.5310735}]}),this.spatialReference=new c(this.tileInfo.spatialReference.toJson()),this.copyright=o.copyright||"",a=new r(n),p=a.scheme+"://"+a.authority+"/",this.urlPath=n.substring(p.length),this.tileServers=o.tileServers||[],-1===a.authority.indexOf("{subDomain}")&&this.tileServers.push(p),o.subDomains&&0<o.subDomains.length&&1<a.authority.split(".").length&&(this.subDomains=o.subDomains,i.forEach(o.subDomains,function(n){-1<a.authority.indexOf("${subDomain}")?k=a.scheme+"://"+f.substitute(a.authority,{subDomain:n})+"/":-1<a.authority.indexOf("{subDomain}")&&(k=a.scheme+"://"+a.authority.replace(/\{subDomain\}/gi,n)+"/");this.tileServers.push(k)},this)),this.tileServers=i.map(this.tileServers,function(n){return"/"!==n.charAt(n.length-1)&&(n+="/"),n}),this._levelToLevelValue=[],i.forEach(this.tileInfo.lods,function(n){this._levelToLevelValue[n.level]=n.levelValue||n.level},this),this._wmtsInfo=o.wmtsInfo,b=t.hitch(this,function(){this.loaded=!0;this.onLoad(this)}),u("chrome")){var p=this.getTileUrl(0,0,0),w=e.defaults.io,d="with-credentials"===w.useCors?h.canUseXhr(p,!0):-1;(w=-1<d?w.corsEnabledServers[d]:null)&&w.withCredentials?s({url:p,handleAs:"arraybuffer"}).addBoth(function(){b()}):b()}else b()},getTileUrl:function(n,t,i){n=this._levelToLevelValue[n];var r=this.tileServers[t%this.tileServers.length]+f.substitute(this.urlPath,{level:n,col:i,row:t}),r=r.replace(/\{level\}/gi,n).replace(/\{row\}/gi,t).replace(/\{col\}/gi,i),r=this._appendCustomLayerParameters(r),r=this.addTimestampToURL(r);return h.addProxy(r)},_appendCustomLayerParameters:function(n){var r,i;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters))for(r in i=t.clone(this._wmtsInfo.customParameters||{}),t.mixin(i,this._wmtsInfo.customLayerParameters||{}),i)n+=(-1===n.indexOf("?")?"?":"&")+r+"="+encodeURIComponent(i[r]);return n}}),u("extend-esri")&&t.setObject("layers.WebTiledLayer",n,o),n})},"esri/layers/dynamic":function(){define("esri/layers/dynamic",["../geometry","./DynamicMapServiceLayer"],function(){return{}})},"esri/layers/tiled":function(){define("esri/layers/tiled",["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/wms":function(){define("esri/layers/wms",["./agscommon","./dynamic","./WMSLayer"],function(){return{}})},"esri/layers/wmts":function(){define("esri/layers/wmts",["./agscommon","./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/VectorTileLayer":function(){(function(){var n=function(){var n,t;try{n=window.WebGLRenderingContext}catch(e){n=!1}try{for(var f=document.createElement("canvas"),u=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,r=0;r<u.length;++r){try{i=f.getContext(u[r])}catch(e){}if(i)break}t=i}catch(e){t=!1}return n&&t?!0:!1}(),t=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];n&&t.push("./VectorTileLayerImpl");define("esri/layers/VectorTileLayer",t,function(t,i,r,u,f,e){return f=e?e:f.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var n=new r;n.reject(Error("esri.layers.VectorTileLayer is not supported"));n.promise.otherwise(t.hitch(this,function(n){this._errorHandler(n)}))}}),f.ACCESS_TOKEN=null,f.supported=function(){return n},i("extend-esri")&&t.setObject("layers.VectorTileLayer",f,u),f})})()},"esri/layers/unitBezier":function(){define("esri/layers/unitBezier",[],function(){var n=function(n,t,i,r){function h(n,t){var r,o,i,s;for(t=null==t?1e-6:t,i=n,o=0;8>o;o++){if(s=((e*i+f)*i+u)*i-n,Math.abs(s)<t)return i;if(r=(3*e*i+2*f)*i+u,1e-6>Math.abs(r))break;i-=s/r}if(r=0,o=1,i=n,i<r)return r;if(i>o)return o;for(;r<o;){if(s=((e*i+f)*i+u)*i,Math.abs(s-n)<t)break;n>s?r=i:o=i;i=.5*(o-r)+r}return i}var u=3*n,f=3*(i-n)-u,e=1-u-f,o=3*t,s=3*(r-t)-o,c=1-o-s;return function(n,t){var i=h(n,t);return((c*i+s)*i+o)*i}},t=/^cubic-bezier\((.*)\)/;return n.parse=function(i){var r=n[i]||null;return!r&&(i=t.exec(i))&&(i=i[1].split(",").map(function(n){return parseFloat(n.trim())}),4!==i.length||i.some(function(n){return isNaN(n)})||(r=n.apply(n,i))),r},n.ease=n(.25,.1,.25,1),n.linear=n(0,0,1,1),n.easeIn=n["ease-in"]=n(.42,0,1,1),n.easeOut=n["ease-out"]=n(0,0,.58,1),n.easeInOut=n["ease-in-out"]=n(.42,0,.58,1),n})},"esri/tasks/AddressCandidate":function(){define("esri/tasks/AddressCandidate",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(n){t.mixin(this,n);this.location=new u(this.location)}}),i("extend-esri")&&t.setObject("tasks.AddressCandidate",n,r),n})},"esri/tasks/AreasAndLengthsParameters":function(){define("esri/tasks/AreasAndLengthsParameters","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.tasks.AreasAndLengthsParameters",polygons:null,lengthUnit:null,areaUnit:null,calculationType:null,toJson:function(){var u=i.map(this.polygons,function(n){return n.toJson()}),n={};return n.polygons=r.toJson(u),u=this.polygons[0].spatialReference,n.sr=u.wkid?u.wkid:r.toJson(u.toJson()),this.lengthUnit&&(n.lengthUnit=this.lengthUnit),this.areaUnit&&(n.areaUnit=t.isString(this.areaUnit)?r.toJson({areaUnit:this.areaUnit}):this.areaUnit),this.calculationType&&(n.calculationType=this.calculationType),n}}),u("extend-esri")&&t.setObject("tasks.AreasAndLengthsParameters",n,f),n})},"esri/tasks/BufferParameters":function(){define("esri/tasks/BufferParameters","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o){return n=n(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var t={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},s=this.distances,u=this.outSpatialReference,f=this.bufferSpatialReference,c=i.map(this.geometries,function(n){return n="extent"===n.type?e.fromExtent(n):n,n.toJson()},this),n=this.geometries,h;return n&&0<n.length&&(h="extent"===n[0].type?"esriGeometryPolygon":o.getJsonType(n[0]),t.geometries=r.toJson({geometryType:h,geometries:c}),t.inSR=n[0].spatialReference.wkid?n[0].spatialReference.wkid:r.toJson(n[0].spatialReference.toJson())),s&&(t.distances=s.join(",")),u&&(t.outSR=u.wkid?u.wkid:r.toJson(u.toJson())),f&&(t.bufferSR=f.wkid?f.wkid:r.toJson(f.toJson())),t}}),u("extend-esri")&&t.setObject("tasks.BufferParameters",n,f),n})},"esri/tasks/DataFile":function(){define("esri/tasks/DataFile",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.DataFile",constructor:function(n){n&&t.mixin(this,n)},url:null,itemID:null,toJson:function(){var n={};return this.url&&(n.url=this.url),this.itemID&&(n.itemID=this.itemID),n}}),i("extend-esri")&&t.setObject("tasks.DataFile",n,r),n})},"esri/tasks/Date":function(){define("esri/tasks/Date",["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.Date",constructor:function(n){n&&(n.format&&(this.format=n.format),this.date=i.parse(n.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:i.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}}),r("extend-esri")&&t.setObject("tasks.Date",n,u),n})},"esri/tasks/FeatureSet":function(){define("esri/tasks/FeatureSet","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(n){if(n){t.mixin(this,n);var r=this.features,u=n.spatialReference,f=h.getGeometryType(n.geometryType),u=this.spatialReference=new o(u);this.geometryType=n.geometryType;n.fields&&(this.fields=n.fields);i.forEach(r,function(n,t){var i=n.geometry&&n.geometry.spatialReference;r[t]=new e(f&&n.geometry?new f(n.geometry):null,n.symbol&&c.fromJson(n.symbol),n.attributes);r[t].geometry&&!i&&r[t].geometry.setSpatialReference(u)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(n){var t={};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields),this.spatialReference?t.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJson()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=h.getJsonType(this.features[0].geometry)),t.features=s._encodeGraphics(this.features,n)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,f.fixJson(t)},_hydrate:function(){var n=this.transform,t=this.geometryType;if(n&&t)for(var i=this.features,r=n.translate[0],u=n.translate[1],f=n.scale[0],e=n.scale[1],o=function(n,t,i){return"esriGeometryPoint"===n?function(n){n.x=t(n.x);n.y=i(n.y)}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){n=n.rings||n.paths;for(var u,c,e,r,o,s,f=0,h=n.length;f<h;f++)for(e=n[f],u=0,c=e.length;u<c;u++)r=e[u],0<u?(o+=r[0],s+=r[1]):(o=r[0],s=r[1]),r[0]=t(o),r[1]=i(s)}:"esriGeometryEnvelope"===n?function(n){n.xmin=t(n.xmin);n.ymin=i(n.ymin);n.xmax=t(n.xmax);n.ymax=i(n.ymax)}:"esriGeometryMultipoint"===n?function(n){n=n.points;for(var r,f,e,u=0,o=n.length;u<o;u++)r=n[u],0<u?(f+=r[0],e+=r[1]):(f=r[0],e=r[1]),r[0]=t(f),r[1]=i(e)}:void 0}(t,function(n){return n*f+r},function(n){return u-n*e}),n=0,t=i.length;n<t;n++)i[n].geometry&&o(i[n].geometry);this.transform=null},quantize:function(n){if(!this.geometryType)return this.transform=null,this;for(var f=n.translate[0],e=n.translate[1],o=n.scale[0],s=n.scale[1],i=this.features,r=function(n,t,i){for(var r,f,e,o,s=[],u=0,h=n.length;u<h;u++)(r=n[u],0<u)?(o=t(r[0]),r=i(r[1]),o!==f||r!==e)&&(s.push([o-f,r-e]),f=o,e=r):(f=t(r[0]),e=i(r[1]),s.push([f,e]));return 0<s.length?s:null},h=function(n,t,i){return"esriGeometryPoint"===n?function(n){return n.x=t(n.x),n.y=i(n.y),n}:"esriGeometryPolyline"===n||"esriGeometryPolygon"===n?function(n){var f,s,o,e,u;for(o=n.rings||n.paths,u=[],f=0,s=o.length;f<s;f++)e=o[f],(e=r(e,t,i))&&u.push(e);return 0<u.length?(n.rings?n.rings=u:n.paths=u,n):null}:"esriGeometryMultipoint"===n?function(n){var u;return u=r(n.points,t,i),0<u.length?(n.points=u,n):null}:"esriGeometryEnvelope"===n?function(n){return n}:void 0}(this.geometryType,function(n){return Math.round((n-f)/o)},function(n){return Math.round((e-n)/s)}),t=0,u=i.length;t<u;t++)i[t].geometry&&(h(i[t].geometry)||i[t].setGeometry(null));return this.transform=n,this}}),r("extend-esri")&&t.setObject("tasks.FeatureSet",n,u),n})},"esri/tasks/GPMessage":function(){define("esri/tasks/GPMessage",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(n){t.mixin(this,n)}}),t.mixin(n,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"}),i("extend-esri")&&t.setObject("tasks.GPMessage",n,r),n})},"esri/tasks/GPResultImageLayer":function(){define("esri/tasks/GPResultImageLayer","dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(n,t,i,r,u,f,e){return n=n(e,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(n,i){i&&i.imageParameters&&i.imageParameters.extent&&(this.initialExtent=this.fullExtent=i.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=t.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(n,r,f,e){var o=n.spatialReference.wkid;e(this._url.path+"?"+u.objectToQuery(t.mixin(this._params,{f:"image",bbox:i.toJson(n.toJson()),bboxSR:o,imageSR:o,size:r+","+f})))}}),r("extend-esri")&&t.setObject("tasks._GPResultImageLayer",n,f),n})},"esri/tasks/Geoprocessor":function(){define("esri/tasks/Geoprocessor","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){return n=n(l,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(){this._jobUpdateHandler=t.hitch(this,this._jobUpdateHandler);this._getJobStatus=t.hitch(this,this._getJobStatus);this._getResultDataHandler=t.hitch(this,this._getResultDataHandler);this._getResultImageHandler=t.hitch(this,this._getResultImageHandler);this._executeHandler=t.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1e3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(n){this.updateDelay=n},setProcessSpatialReference:function(n){this.processSpatialReference=n},setOutputSpatialReference:function(n){this._setOutSR(n)},setOutSpatialReference:function(n){this._setOutSR(n)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(n){this.outSpatialReference=this.outputSpatialReference=n},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(n,r,f){var o,e;for(o in n)e=n[o],t.isArray(e)?n[o]=u.toJson(i.map(e,function(n){return this._gpEncode({item:n},!0).item},this)):e instanceof Date&&(n[o]=e.getTime());return this._encode(n,r,f)},_decode:function(n){var u=n.dataType,r=new d(n),f;return-1!==i.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],u)?r:("GPLinearUnit"===u?r.value=new p(r.value):"GPFeatureRecordSetLayer"===u||"GPRecordSet"===u?r.value=new a(r.value):"GPDataFile"===u?r.value=new w(r.value):"GPDate"===u?(n=r.value,r.value=t.isString(n)?new k({date:n}):new Date(n)):"GPRasterData"===u||"GPRasterDataLayer"===u?(n=n.value.mapImage,r.value=n?new tt(n):new b(r.value)):-1!==u.indexOf("GPMultiValue:")?(f=u.split(":")[1],n=r.value,r.value=i.map(n,function(n){return this._decode({paramName:"_name",dataType:f,value:n}).value},this)):(console.log(this.declaredClass+" : GP Data type not handled. : "+r.dataType),r=null),r)},submitJob:function(n,i,r,f,e){var o=this._getOutSR(),h=e.assembly,c,l;return n=this._gpEncode(t.mixin({},this._url.query,{f:"json","env:outSR":o?o.wkid||u.toJson(o.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||u.toJson(this.processSpatialReference.toJson()):null},n),null,h&&h[0]),c=this._jobUpdateHandler,l=this._errorHandler,s({url:this._url.path+"/submitJob",content:n,callbackParamName:"callback",load:function(n,t){c(n,t,!1,i,r,e.dfd)},error:function(n){l(n,f,e.dfd)}})},_jobUpdateHandler:function(n,t,i,r,u,f){var e=n.jobId,o;if(t=new v(n),this._successHandler([t],"onStatusUpdate",u,i&&f),!i)switch(clearTimeout(this._updateTimers[e]),this._updateTimers[e]=null,f&&f.progress(t),n.jobStatus){case v.STATUS_SUBMITTED:case v.STATUS_EXECUTING:case v.STATUS_WAITING:case v.STATUS_NEW:o=this._getJobStatus;this._updateTimers[e]=setTimeout(function(){o(e,i,r,u,f)},this.updateDelay);break;default:this._successHandler([t],"onJobComplete",r,f)}},_getJobStatus:function(n,i,r,u,f){var e=this._jobUpdateHandler;s({url:this._url.path+"/jobs/"+n,content:t.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(n,t){e(n,t,i,r,u,f)},error:this._errorHandler})},_getResultDataHandler:function(n,t,i,r,u){try{var f=this._decode(n);this._successHandler([f],"onGetResultDataComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},getResultData:function(n,i,u,f){var o=this._getResultDataHandler,c=this._errorHandler,e=new r(h._dfdCanceller);return e._pendingDfd=s({url:this._url.path+"/jobs/"+n+"/results/"+i,content:t.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(n,t){o(n,t,u,f,e)},error:function(n){c(n,f,e)}}),e},checkJobStatus:function(n,i,u){var e=this._jobUpdateHandler,o=this._errorHandler,f=new r(h._dfdCanceller);return f._pendingDfd=s({url:this._url.path+"/jobs/"+n,content:t.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(n,t){e(n,t,!0,null,i,f)},error:function(n){o(n,u,f)}}),f},cancelJob:function(n,i,u){var e=this._errorHandler,f=new r(h._dfdCanceller);return f._pendingDfd=s({url:this._url.path+"/jobs/"+n+"/cancel",content:t.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:t.hitch(this,function(n){this._successHandler([n],"onJobCancel",i,f)}),error:function(n){e(n,u,f)}}),f},execute:function(n,i,r,f){var e=this._getOutSR(),o=f.assembly,h,c;return n=this._gpEncode(t.mixin({},this._url.query,{f:"json","env:outSR":e?e.wkid||u.toJson(e.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||u.toJson(this.processSpatialReference.toJson()):null},n),null,o&&o[0]),h=this._executeHandler,c=this._errorHandler,s({url:this._url.path+"/execute",content:n,callbackParamName:"callback",load:function(n,t){h(n,t,i,r,f.dfd)},error:function(n){c(n,r,f.dfd)}})},_executeHandler:function(n,t,i,r,u){try{for(var e=n.results,s=n.messages,f=0,o=e.length;f<o;f++)e[f]=this._decode(e[f]);for(f=0,o=s.length;f<o;f++)s[f]=new y(s[f]);this._successHandler([e,s],"onExecuteComplete",i,u)}catch(h){this._errorHandler(h,r,u)}},_getResultImageHandler:function(n,t,i,r,u){try{var f=this._decode(n);this._successHandler([f],"onGetResultImageComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},getResultImage:function(n,i,u,f,e){var c=this._getResultImageHandler,l=this._errorHandler,o;return u=this._gpEncode(t.mixin({},this._url.query,{f:"json"},u.toJson())),o=new r(h._dfdCanceller),o._pendingDfd=s({url:this._url.path+"/jobs/"+n+"/results/"+i,content:u,callbackParamName:"callback",load:function(n,t){c(n,t,f,e,o)},error:function(n){l(n,e,o)}}),o},cancelJobStatusUpdates:function(n){clearTimeout(this._updateTimers[n]);this._updateTimers[n]=null},getResultImageLayer:function(n,t,i,r){if(null==t){var u=this._url.path.indexOf("/GPServer/");n=this._url.path.substring(0,u)+"/MapServer/jobs/"+n}else n=this._url.path+"/jobs/"+n+"/results/"+t;this._url.query&&(n+="?"+e.objectToQuery(this._url.query));t=null==t?new nt(n,{imageParameters:i}):new g(n,{imageParameters:i},!0);this.onGetResultImageLayerComplete(t);return r&&r(t),t},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}}),c._createWrappers(n),f("extend-esri")&&t.setObject("tasks.Geoprocessor",n,o),n})},"esri/tasks/IdentifyParameters":function(){define("esri/tasks/IdentifyParameters","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),function(n,t,i,r,u,f,e,o,s){var h=n(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=h.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(n){var u=n&&n.geometry||this.geometry,t=this.mapExtent,f=this.spatialReference,c=this.layerIds,h;if(n={tolerance:this.tolerance,returnGeometry:this.returnGeometry,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},u&&(h=u.toJson(),delete h.spatialReference,n.geometry=r.toJson(h),n.geometryType=o.getJsonType(u)),f?n.sr=f.wkid||r.toJson(f.toJson()):u&&u.spatialReference?n.sr=u.spatialReference.wkid||r.toJson(u.spatialReference.toJson()):t&&t.spatialReference&&(n.sr=t.spatialReference.wkid||r.toJson(t.spatialReference.toJson())),t&&(n.mapExtent=t.xmin+","+t.ymin+","+t.xmax+","+t.ymax),n.layers=this.layerOption,c&&(n.layers+=":"+c.join(",")),n.layerDefs=e._serializeLayerDefinitions(this.layerDefinitions,!0),u=this.timeExtent,n.time=u?u.toJson().join(","):null,n.layerTimeOptions=e._serializeTimeOptions(this.layerTimeOptions),this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){var t=s.getScale({extent:t,width:this.width,spatialReference:t.spatialReference}),a=e._getLayersForScale(t,this.dynamicLayerInfos),l=[];i.forEach(this.dynamicLayerInfos,function(n){var t,r,u,f;n.subLayerIds||(t=n.id,(!this.layerIds||this.layerIds&&-1!==i.indexOf(this.layerIds,t))&&-1!==i.indexOf(a,t)&&(r={id:t},r.source=n.source&&n.source.toJson(),this.layerDefinitions&&this.layerDefinitions[t]&&(u=this.layerDefinitions[t]),u&&(r.definitionExpression=u),this.layerTimeOptions&&this.layerTimeOptions[t]&&(f=this.layerTimeOptions[t]),f&&(r.layerTimeOptions=f.toJson()),l.push(r)))},this);t=r.toJson(l);"[]"===t&&(t="[{}]");n.dynamicLayers=t}return n}});return t.mixin(h,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"}),u("extend-esri")&&t.setObject("tasks.IdentifyParameters",h,f),h})},"esri/tasks/IdentifyResult":function(){define("esri/tasks/IdentifyResult","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(n){t.mixin(this,n);this.feature=new u(n.geometry?f.fromJson(n.geometry):null,null,n.attributes);delete this.geometry;delete this.attributes}}),i("extend-esri")&&t.setObject("tasks.IdentifyResult",n,r),n})},"esri/tasks/IdentifyTask":function(){define("esri/tasks/IdentifyTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),function(n,t,i,r,u,f,e,o,s){return n=n(o,{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(n,i){this._url.path+="/identify";this._handler=t.hitch(this,this._handler);this.gdbVersion=i&&i.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(n,t,r,u,f){try{var e=[];i.forEach(n.results,function(n,t){e[t]=new s(n)});this._successHandler([e],"onComplete",r,f)}catch(o){this._errorHandler(o,u,f)}},execute:function(n,i,r,u){var e=u.assembly,o,s;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson(e&&e[0]))),o=this._handler,s=this._errorHandler,this.gdbVersion&&(n.gdbVersion=this.gdbVersion),f({url:this._url.path,content:n,callbackParamName:"callback",load:function(n,t){o(n,t,i,r,u.dfd)},error:function(n){s(n,r,u.dfd)}})},onComplete:function(){}}),e._createWrappers(n),r("extend-esri")&&t.setObject("tasks.IdentifyTask",n,u),n})},"esri/tasks/JobInfo":function(){define("esri/tasks/JobInfo",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(n){this.messages=[];t.mixin(this,n);n=this.messages;for(var r=n.length,i=0;i<r;i++)n[i]=new u(n[i])},jobId:"",jobStatus:""}),t.mixin(n,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"}),i("extend-esri")&&t.setObject("tasks.JobInfo",n,r),n})},"esri/tasks/LegendLayer":function(){define("esri/tasks/LegendLayer",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.LegendLayer",layerId:null,subLayerIds:null}),i("extend-esri")&&t.setObject("tasks.LegendLayer",n,r),n})},"esri/tasks/LengthsParameters":function(){define("esri/tasks/LengthsParameters","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(n,t,i,r,u,f){return n=n(null,{declaredClass:"esri.tasks.LengthsParameters",polylines:null,lengthUnit:null,geodesic:null,calculationType:null,toJson:function(){var t=i.map(this.polylines,function(n){return n.toJson()}),n={};return n.polylines=r.toJson(t),t=this.polylines[0].spatialReference,n.sr=t.wkid?t.wkid:r.toJson(t.toJson()),this.lengthUnit&&(n.lengthUnit=this.lengthUnit),this.geodesic&&(n.geodesic=this.geodesic),this.calculationType&&(n.calculationType=this.calculationType),n}}),u("extend-esri")&&t.setObject("tasks.LengthsParameters",n,f),n})},"esri/tasks/LinearUnit":function(){define("esri/tasks/LinearUnit",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(n){n&&t.mixin(this,n)},distance:0,units:null,toJson:function(){var n={};return this.distance&&(n.distance=this.distance),this.units&&(n.units=this.units),n}}),i("extend-esri")&&t.setObject("tasks.LinearUnit",n,r),n})},"esri/tasks/ParameterValue":function(){define("esri/tasks/ParameterValue",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(n){t.mixin(this,n)}}),i("extend-esri")&&t.setObject("tasks.ParameterValue",n,r),n})},"esri/tasks/PrintParameters":function(){define("esri/tasks/PrintParameters",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null}),i("extend-esri")&&t.setObject("tasks.PrintParameters",n,r),n})},"esri/tasks/PrintTask":function(){define("esri/tasks/PrintTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../urlUtils ./Task ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){return n=n(a,{declaredClass:"esri.tasks.PrintTask",constructor:function(n,i){this.url=n;this.printGp=new w(this.url);this._handler=t.hitch(this,this._handler);i&&i.async&&(this.async=i.async);this._colorEvaluator=tt("$..color")},_vtlExtent:null,_handler:function(n,i,r,u,f){try{var e;this.async?"esriJobSucceeded"===n.jobStatus&&this.printGp.getResultData(n.jobId,"Output_File",t.hitch(this,function(n){e=n.value;this._successHandler([e],"onComplete",r,f)})):(e=n[0].value,this._successHandler([e],"onComplete",r,f))}catch(o){this._errorHandler(o,u,f)}},execute:function(n,f,e){var nt=this._handler,tt=this._errorHandler,a=n.template||new b,p,s,v,g,l,w,c,k,y,d;if(a.hasOwnProperty("showLabels")||(a.showLabels=!0),s=a.exportOptions,s&&(p={outputSize:[s.width,s.height],dpi:s.dpi}),s=a.layoutOptions,g=[],s&&(this.legendAll=!1,s.legendLayers?i.forEach(s.legendLayers,function(n){var t={};t.id=n.layerId;n.subLayerIds&&(t.subLayerIds=n.subLayerIds);g.push(t)}):this.legendAll=!0,"Miles"===s.scalebarUnit||"Kilometers"===s.scalebarUnit?(l="esriKilometers",w="esriMiles"):("Meters"===s.scalebarUnit||"Feet"===s.scalebarUnit)&&(l="esriMeters",w="esriFeet"),v={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"},v={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,scaleBarOptions:{metricUnit:l,metricLabel:v[l],nonMetricUnit:w,nonMetricLabel:v[w]},legendOptions:{operationalLayers:g}}),l=this._getPrintDefinition(n.map,a),n.outSpatialReference&&(l.mapOptions.spatialReference=n.outSpatialReference.toJson()),n.template&&o.isDefined(n.template.showAttribution)&&(l.mapOptions.showAttribution=n.template.showAttribution),t.mixin(l,{exportOptions:p,layoutOptions:v}),this.allLayerslegend&&t.mixin(l.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}}),l.operationalLayers)for(p=l.operationalLayers,k=function(n){return o.fixJson(t.mixin(n,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},v=0;v<p.length;v++)if(p[v].featureCollection&&p[v].featureCollection.layers)for(w=0;w<p[v].featureCollection.layers.length;w++)if(y=p[v].featureCollection.layers[w],y.layerDefinition&&y.layerDefinition.drawingInfo&&y.layerDefinition.drawingInfo.renderer&&y.layerDefinition.drawingInfo.renderer.symbol&&(c=y.layerDefinition.drawingInfo.renderer,"esriCLS"===c.symbol.type?c.symbol=k(c.symbol):c.symbol.outline&&"esriCLS"===c.symbol.outline.type&&(c.symbol.outline=k(c.symbol.outline))),y.featureSet&&y.featureSet.features)for(s=0;s<y.featureSet.features.length;s++)c=y.featureSet.features[s],c.symbol&&("esriCLS"===c.symbol.type?c.symbol=k(c.symbol):c.symbol.outline&&"esriCLS"===c.symbol.outline.type&&(c.symbol.outline=k(c.symbol.outline)));return a={Web_Map_as_JSON:r.toJson(o.fixJson(l)),Format:a.format,Layout_Template:a.layout},n.extraParameters&&(a=t.mixin(a,n.extraParameters)),d=new u(h._dfdCanceller),n=function(n,t){nt(n,t,f,e,d)},l=function(n){tt(n,e,d)},d._pendingDfd=this.async?this.printGp.submitJob(a,n,null,l):this.printGp.execute(a,n,l),d},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(n){var i,r;if(!(8>=f("ie")||!n.path&&"image/svg+xml"!==n.contentType)){r=nt.createSurface(d.create("div"),1024,1024);i="image/svg+xml"===n.contentType?r.createObject(nt.Image,{src:"data:image/svg+xml;base64,"+n.imageData,width:g.pt2px(n.width),height:g.pt2px(n.height),x:0,y:0}):r.createObject(nt.Path,n.path).setFill(n.color).setStroke(n.outline);"pendingRender"in r&&r._render(!0);var t=r.rawNode.getContext("2d"),u=Math.ceil(i.getBoundingBox().width),e=Math.ceil(i.getBoundingBox().height);return i=t.getImageData(i.getBoundingBox().x,i.getBoundingBox().y,u,e),t.canvas.width=u,t.canvas.height=e,t.putImageData(i,0,0),t=t.canvas.toDataURL("image/png"),n={type:"esriPMS",imageData:t.substr(22,t.length),angle:n.angle,contentType:"image/png",height:n.size?n.size:g.px2pt(e),width:n.size?u/e*n.size:g.px2pt(u),xoffset:n.xoffset,yoffset:n.yoffset},r.destroy(),n}},_convertSvgRenderer:function(n){"simple"===n.type&&n.symbol&&(n.symbol.path||"image/svg+xml"===n.symbol.contentType)?n.symbol=this._convertSvgSymbol(n.symbol):"uniqueValue"===n.type?(n.defaultSymbol&&(n.defaultSymbol.path||"image/svg+xml"===n.defaultSymbol.contentType)&&(n.defaultSymbol=this._convertSvgSymbol(n.defaultSymbol)),n.uniqueValueInfos&&i.forEach(n.uniqueValueInfos,function(n){(n.symbol.path||"image/svg+xml"===n.symbol.contentType)&&(n.symbol=this._convertSvgSymbol(n.symbol))},this)):"classBreaks"===n.type&&(n.defaultSymbol&&(n.defaultSymbol.path||"image/svg+xml"===n.defaultSymbol.contentType)&&(n.defaultSymbol=this._convertSvgSymbol(n.defaultSymbol)),n.classBreakInfos&&i.forEach(n.classBreakInfos,function(n){(n.symbol.path||"image/svg+xml"===n.symbol.contentType)&&(n.symbol=this._convertSvgSymbol(n.symbol))},this))},_createFeatureCollection:function(n,r,u){var o=this._createPolygonLayer(),s=this._createPolylineLayer(),h=this._createPointLayer(),c=this._createMultipointLayer(),a=this._createPointLayer(),w,f,e,p,l,y;for(a.layerDefinition.name="textLayer",delete a.layerDefinition.drawingInfo,("esri.layers.FeatureLayer"===n.declaredClass||"esri.layers.StreamLayer"===n.declaredClass)&&(o.layerDefinition.name=s.layerDefinition.name=h.layerDefinition.name=c.layerDefinition.name=t.getObject("arcgisProps.title",!1,n)||n.name||n.id),w=n.renderer&&"esri.renderer.SimpleRenderer"===n.renderer.declaredClass,!n.renderer||n.renderer._compiledFunc||t.isFunction(n.renderer.attributeField)?(delete o.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete h.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo):(e=n.renderer.toJson({useLegacyRotationProperties:!0}),"temporal"===e.type?(e={latestObservationRenderer:e.latestObservationRenderer,trackLinesRenderer:e.trackRenderer,observationAger:e.observationAger,renderer:e.observationRenderer},f={},n._trackIdField&&(f.trackIdField=n._trackIdField),n._startTimeField&&(f.startTimeField=n._startTimeField),n._endTimeField&&(f.endTimeField=n._endTimeField),o.layerDefinition.drawingInfo=e,o.layerDefinition.timeInfo=f,s.layerDefinition.drawingInfo=e,s.layerDefinition.timeInfo=f,h.layerDefinition.drawingInfo=e,h.layerDefinition.timeInfo=f,c.layerDefinition.drawingInfo=e,c.layerDefinition.timeInfo=f):(o.layerDefinition.drawingInfo.renderer=e,s.layerDefinition.drawingInfo.renderer=e,h.layerDefinition.drawingInfo.renderer=e,c.layerDefinition.drawingInfo.renderer=e)),e=n.fields,e||!n.renderer||n.renderer._compiledFunc||t.isFunction(n.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===n.renderer.declaredClass?(e=[{name:n.renderer.attributeField,type:"esriFieldTypeDouble"}],n.renderer.normalizationField&&e.push({name:n.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===n.renderer.declaredClass&&(e=[{name:n.renderer.attributeField,type:"esriFieldTypeString"}],n.renderer.attributeField2&&e.push({name:n.renderer.attributeField2,type:"esriFieldTypeString"}),n.renderer.attributeField3&&e.push({name:n.renderer.attributeField3,type:"esriFieldTypeString"}))),e&&(o.layerDefinition.fields=e,s.layerDefinition.fields=e,h.layerDefinition.fields=e,c.layerDefinition.fields=e),e=n.graphics.length,p=0;p<e;p++)if(l=n.graphics[p],!1!==l.visible&&l.geometry){if(f=l.toJson(),f.symbol&&f.symbol.outline&&f.symbol.outline.color&&f.symbol.outline.color[3]&&(f.symbol.outline.color[3]=255),n.renderer&&!f.symbol&&(t.isFunction(n.renderer.attributeField)||n.renderer._compiledFunc||this._isFeatureCollectionRequired(n.renderer)||"esri.renderer.DotDensityRenderer"===n.renderer.declaredClass||u)){u=u||n.renderer;y=null;try{y=u.getSymbol(l)}catch(b){}if(!y)continue;f.symbol=y.toJson();this._isFeatureCollectionRequired(u)&&this._applyVisualVariables(f.symbol,{renderer:u,graphic:l,symbol:y,mapResolution:r&&r.getResolutionInMeters(),mapScale:r&&r.getScale()})}f.symbol&&(f.symbol.path||"image/svg+xml"===f.symbol.contentType?f.symbol=this._convertSvgSymbol(f.symbol):f.symbol.text&&delete f.attributes);switch(l.geometry.type){case"polygon":o.featureSet.features.push(f);break;case"polyline":s.featureSet.features.push(f);break;case"point":f.symbol&&f.symbol.text?a.featureSet.features.push(f):h.featureSet.features.push(f);break;case"multipoint":c.featureSet.features.push(f);break;case"extent":f.geometry=v.fromExtent(l.geometry).toJson();o.featureSet.features.push(f)}}return(r=[],0<o.featureSet.features.length&&r.push(o),0<s.featureSet.features.length&&r.push(s),0<c.featureSet.features.length&&r.push(c),0<h.featureSet.features.length&&r.push(h),0<a.featureSet.features.length&&r.push(a),!r.length)?null:(i.forEach(r,function(n){var t=i.every(n.featureSet.features,function(n){return n.symbol});(w||t)&&(i.forEach(n.featureSet.features,function(n){delete n.attributes}),delete n.layerDefinition.fields);t&&delete n.layerDefinition.drawingInfo}),i.forEach(r,function(n){n.layerDefinition.drawingInfo&&n.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(n.layerDefinition.drawingInfo.renderer)},this),{id:n.id,opacity:n.opacity,minScale:n.minScale||0,maxScale:n.maxScale||0,featureCollection:{layers:r}})},_getPrintDefinition:function(n,i){var f={operationalLayers:this._createOperationalLayers(n,i)},r=this._vtlExtent||n.extent,u=n.spatialReference;return this._vtlExtent=null,n.spatialReference._isWrappable()&&(r=r._normalize(!0),u=r.spatialReference),r={mapOptions:{showAttribution:n.showAttribution,extent:r.toJson(),spatialReference:u.toJson()}},i.preserveScale&&t.mixin(r.mapOptions,{scale:i.outScale||n.getScale()}),n.timeExtent&&t.mixin(r.mapOptions,{time:[n.timeExtent.startTime.getTime(),n.timeExtent.endTime.getTime()]}),u={},t.mixin(u,r,f),u},_createOperationalLayers:function(n,u){var v,f,o,e,c=[],h,p,b,d,w,a;for(this.allLayerslegend=this.legendAll?[]:null,this._vtlExtent=null,h=i.map(n.layerIds,n.getLayer,n),n._mapImageLyr&&h.push(n._mapImageLyr),v=0;v<h.length;v++)if(f=h[v],f.loaded&&f.visible)switch(o=f.declaredClass,e={id:f.id,title:t.getObject("arcgisProps.title",!1,f)||f.id,opacity:f.opacity,minScale:f.minScale||0,maxScale:f.maxScale||0},e=t.mixin(e,this._getUrlAndToken(f)),f.getNode()&&k.get(f.getNode(),"data-reference")&&(e._isRefLayer=!0),o){case"esri.layers.ArcGISDynamicMapServiceLayer":p=[];o=!!f._params.layers;f._params.dynamicLayers?(o=r.fromJson(f._params.dynamicLayers),i.forEach(o,function(n){p.push({id:n.id,name:n.name,layerDefinition:n});delete n.id;delete n.name;delete n.maxScale;delete n.minScale}),0===p.length&&(e.visibleLayers=[-1])):f.supportsDynamicLayers?(o||f.layerDefinitions||f.layerTimeOptions)&&(a=f.createDynamicLayerInfosFromLayerInfos(),b=null,o&&(b=f.visibleLayers),b=s._getVisibleLayers(a,b),d=s._getLayersForScale(u.outScale||n.getScale(),a),i.forEach(a,function(n){if(!n.subLayerIds){var t=n.id;-1<i.indexOf(b,t)&&-1<i.indexOf(d,t)&&(n={source:n.source.toJson()},f.layerDefinitions&&f.layerDefinitions[t]&&(n.definitionExpression=f.layerDefinitions[t]),f.layerTimeOptions&&f.layerTimeOptions[t]&&(n.layerTimeOptions=f.layerTimeOptions[t].toJson()),p.push({id:t,layerDefinition:n}))}}),0===p.length&&(e.visibleLayers=[-1])):(i.forEach(f.layerInfos,function(n){var t={id:n.id,layerDefinition:{}};f.layerDefinitions&&f.layerDefinitions[n.id]&&(t.layerDefinition.definitionExpression=f.layerDefinitions[n.id]);f.layerTimeOptions&&f.layerTimeOptions[n.id]&&(t.layerDefinition.layerTimeOptions=f.layerTimeOptions[n.id].toJson());(t.layerDefinition.definitionExpression||t.layerDefinition.layerTimeOptions)&&p.push(t)}),o&&(e.visibleLayers=f.visibleLayers));p.length&&(e.layers=p);c.push(e);this.allLayerslegend&&this.allLayerslegend.push({id:f.id,subLayerIds:f.visibleLayers});break;case"esri.layers.ArcGISImageServiceLayer":e=t.mixin(e,{url:f.url,bandIds:f.bandIds,compressionQuality:f.compressionQuality,format:f.format,interpolation:f.interpolation});f.mosaicRule&&t.mixin(e,{mosaicRule:f.mosaicRule.toJson()});(f.renderingRule||f.renderer)&&(o=f.getExportImageRenderingRule())&&t.mixin(e,{renderingRule:o.toJson()});c.push(e);this.allLayerslegend&&this.allLayerslegend.push({id:f.id});break;case"esri.layers.WMSLayer":e=t.mixin(e,{url:f.url,title:f.title,type:"wms",version:f.version,transparentBackground:f.imageTransparency,visibleLayers:f.visibleLayers});c.push(e);this.allLayerslegend&&this.allLayerslegend.push({id:f.id,subLayerIds:f.visibleLayers});break;case"esri.virtualearth.VETiledLayer":o=f.mapStyle;"roadOnDemand"===o?o="Road":"aerialWithLabels"===o&&(o="Hybrid");e=t.mixin(e,{visibility:f.visible,type:"BingMaps"+o,culture:f.culture,key:f.bingMapsKey});c.push(e);break;case"esri.layers.OpenStreetMapLayer":e=t.mixin(e,{credits:f.copyright,type:"OpenStreetMap",url:l.getAbsoluteUrl(f.tileServers[0])});c.push(e);break;case"esri.layers.WMTSLayer":e=t.mixin(e,{url:f.url,type:"wmts",layer:f._identifier,style:f._style,format:f.format,tileMatrixSet:f._tileMatrixSetId});c.push(e);break;case"esri.layers.MapImageLayer":o=f.getImages();i.forEach(o,function(n,t){n.href&&(e={id:f.id+"_image"+t,type:"image",title:f.id,minScale:f.minScale||0,maxScale:f.maxScale||0,opacity:f.opacity*n.opacity,extent:n.extent.toJson()},"data:image/png;base64,"===n.href.substr(0,22)?e.imageData=n.href.substr(22):e.url=n.href,c.push(e))});break;case"esri.layers.VectorTileLayer":e.type="image";e.url&&delete e.url;o=this._vtlExtent||n.extent.offset(0,0);w=u.exportOptions&&u.exportOptions.dpi||96;a={format:"png",pixelRatio:w/96};"MAP_ONLY"===u.layout&&u.preserveScale&&(!u.outScale||u.outScale===n.getScale())&&96===w&&u.exportOptions&&(u.exportOptions.width%2!=n.width%2||u.exportOptions.height%2!=n.height%2)&&(a.area={x:0,y:0,width:n.width,height:n.height},u.exportOptions.width%2!=n.width%2&&--a.area.width,u.exportOptions.height%2!=n.height%2&&--a.area.height,this._vtlExtent||(w=n.toMap({x:a.area.width,y:a.area.height}),o.update(o.xmin,w.y,w.x,o.ymax,o.spatialReference),this._vtlExtent=o));e.extent=o._normalize(!0).toJson();o=f.takeScreenshot(a);o.isResolved()?o.then(function(n){"data:image/png;base64,"===n.dataURL.substr(0,22)&&(e.imageData=n.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");e.imageData&&c.push(e);break;case"esri.layers.WebTiledLayer":o=f.url.replace(/\$\{/g,"{");e=t.mixin(e,{type:"WebTiledLayer",urlTemplate:o,credits:f.copyright});f.subDomains&&0<f.subDomains.length&&(e.subDomains=f.subDomains);f._wmtsInfo&&(e.wmtsInfo=f._wmtsInfo);delete e.url;c.push(e);break;default:(f.getTileUrl||f.getImageUrl)&&(e=t.mixin(e,{url:f.url}),c.push(e))}for(v=0;v<n.graphicsLayerIds.length;v++)if(f=n.getLayer(n.graphicsLayerIds[v]),f.loaded&&f.visible)switch(o=f.declaredClass,o){case"esri.layers.FeatureLayer":case"esri.layers.LabelLayer":case"esri.layers.CSVLayer":case"esri.layers.StreamLayer":if("esri.layers.LabelLayer"===o&&!u.showLabels||f.renderer&&"esri.renderer.HeatmapRenderer"===f.renderer.declaredClass)continue;if(h=null,f.url&&f.renderer&&("esri.renderer.ScaleDependentRenderer"===f.renderer.declaredClass?"scale"===f.renderer.rangeType?h=f.renderer.getRendererInfoByScale(n.getScale())&&f.renderer.getRendererInfoByScale(n.getScale()).renderer:"zoom"===f.renderer.rangeType&&(h=f.renderer.getRendererInfoByZoom(n.getZoom())&&f.renderer.getRendererInfoByZoom(n.getZoom()).renderer):h=f.renderer),h&&("esri.renderer.SimpleRenderer"===h.declaredClass||"esri.renderer.TemporalRenderer"===h.declaredClass||t.isString(h.attributeField)&&f._getField(h.attributeField,!0))&&!h._compiledFunc&&!this._isFeatureCollectionRequired(h)&&"esri.renderer.DotDensityRenderer"!==h.declaredClass&&"esri.layers.CSVLayer"!==f.declaredClass&&"esri.layers.StreamLayer"!==f.declaredClass)if(e={id:f.id,title:t.getObject("arcgisProps.title",!1,f)||f.id,opacity:f.opacity,minScale:f.minScale||0,maxScale:f.maxScale||0,layerDefinition:{drawingInfo:{renderer:h.toJson({useLegacyRotationProperties:!0})}}},e=t.mixin(e,this._getUrlAndToken(f)),"esri.renderer.TemporalRenderer"===h.declaredClass&&(o=e.layerDefinition.drawingInfo,o.latestObservationRenderer=o.renderer.latestObservationRenderer,o.trackLinesRenderer=o.renderer.trackRenderer,o.observationAger=o.renderer.observationAger,o.renderer=o.renderer.observationRenderer,f._trackIdField&&(e.layerDefinition.timeInfo={trackIdField:f._trackIdField})),this._convertSvgRenderer(e.layerDefinition.drawingInfo.renderer),1>f.opacity||"esri.renderer.TemporalRenderer"===h.declaredClass||this._updateLayerOpacity(e))if(f._params.source&&(h=f._params.source.toJson(),t.mixin(e.layerDefinition,{source:h})),f.getDefinitionExpression()&&t.mixin(e.layerDefinition,{definitionExpression:f.getDefinitionExpression()}),2!==f.mode)0<f.getSelectedFeatures().length&&(h=i.map(f.getSelectedFeatures(),function(n){return n.attributes[f.objectIdField]}),0<h.length&&f.getSelectionSymbol()&&t.mixin(e,{selectionObjectIds:h,selectionSymbol:f.getSelectionSymbol().toJson()}));else{if(h=i.map(f.getSelectedFeatures(),function(n){return n.attributes[f.objectIdField]}),0===h.length||!f._params.drawMode)break;t.mixin(e.layerDefinition,{objectIds:h});h=null;f.getSelectionSymbol()&&(h=new y(f.getSelectionSymbol()));t.mixin(e.layerDefinition.drawingInfo,{renderer:h&&h.toJson()})}else e=this._createFeatureCollection(f,n);else e=h&&(h._compiledFunc||this._isFeatureCollectionRequired(h)||"esri.renderer.DotDensityRenderer"===h.declaredClass)?this._createFeatureCollection(f,n,h):this._createFeatureCollection(f,n);if(!e)continue;c.push(e);this.allLayerslegend&&this.allLayerslegend.push({id:f.id});break;case"esri.layers.GraphicsLayer":case"esri.layers.WFSLayer":(e=this._createFeatureCollection(f,n))&&(c.push(e),this.allLayerslegend&&this.allLayerslegend.push({id:f.id}))}return n.graphics&&0<n.graphics.graphics.length&&(e=this._createFeatureCollection(n.graphics,n))&&c.push(e),n._labels&&u.showLabels&&(e=this._createFeatureCollection(n._labels,n))&&c.push(e),i.forEach(c,function(n,t,i){n._isRefLayer&&(delete n._isRefLayer,i.splice(t,1),i.push(n))}),c},_getUrlAndToken:function(n){return{token:n._getToken(),url:n._url?n._url.path:null}},_updateLayerOpacity:function(n){var u=this._colorEvaluator(n),u=i.filter(u,function(n){return t.isArray(n)&&4===n.length}),f=!0,e,r;if(u.length){for(e=u[0][3],r=1;r<u.length;r++)if(e!==u[r][3]){f=!1;break}if(f)for(n.opacity=e/255,r=0;r<u.length;r++)u[r][3]=255}return f},_isFeatureCollectionRequired:function(n){var i=!1,r=this._getVariable(n,"rotationInfo",!1);return r&&(i=(i=r.field)&&t.isFunction(i)||r.valueExpression),n.hasVisualVariables("sizeInfo")||n.hasVisualVariables("colorInfo")||n.hasVisualVariables("opacityInfo")||i},_getVariable:function(n,t,i){var r;return n&&(r=(n=n.getVisualVariablesForType(t,i))&&n[0]),r},_applyVisualVariables:function(n,t){var r=t.renderer,f=t.graphic,u=t.symbol,l=t.mapResolution,a=t.mapScale,i=u.type;if("textsymbol"!==i&&"shieldlabelsymbol"!==i){var e=this._getVariable(r,"sizeInfo",!1),o=this._getVariable(r,"colorInfo",!1),s=this._getVariable(r,"opacityInfo",!1),h=this._getVariable(r,"rotationInfo",!1);u instanceof p&&(e=this._getVariable(r,"sizeInfo","outline")||e);e&&(u=r.getSize(f,{sizeInfo:e,shape:"simplemarkersymbol"===i?u.style:null,resolution:l,scale:a}),null!=u&&("simplemarkersymbol"===i?n.size=g.px2pt(u):"picturemarkersymbol"===i?(n.width=g.px2pt(u),n.height=g.px2pt(u)):"simplelinesymbol"===i?n.width=g.px2pt(u):n.outline&&(n.outline.width=g.px2pt(u))));o&&(!(o=r.getColor(f,{colorInfo:o}))||"simplemarkersymbol"!==i&&"simplelinesymbol"!==i&&"simplefillsymbol"!==i||(n.color=c.toJsonColor(o)));s&&(i=r.getOpacity(f,{opacityInfo:s}),null!=i&&n.color&&(n.color[3]=Math.round(255*i)));h&&(r=r.getRotationAngle(f,{rotationInfo:h}))&&(n.angle=-r)}}}),f("extend-esri")&&t.setObject("tasks.PrintTask",n,e),n})},"esri/tasks/PrintTemplate":function(){define("esri/tasks/PrintTemplate",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,showAttribution:null,showLabels:!0}),i("extend-esri")&&t.setObject("tasks.PrintTemplate",n,r),n})},"esri/tasks/ProjectParameters":function(){define("esri/tasks/ProjectParameters","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,t,i,r,u,f,e,o){return n=n(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var t=i.map(this.geometries,function(n){return n.toJson()}),n={};return n.outSR=this.outSR.wkid||r.toJson(this.outSR.toJson()),n.inSR=this.geometries[0].spatialReference.wkid||r.toJson(this.geometries[0].spatialReference.toJson()),n.geometries=r.toJson({geometryType:o.getJsonType(this.geometries[0]),geometries:t}),this.transformation&&(n.transformation=this.transformation.wkid||r.toJson(this.transformation)),e.isDefined(this.transformForward)&&(n.transformForward=this.transformForward),n}}),u("extend-esri")&&t.setObject("tasks.ProjectParameters",n,f),n})},"esri/tasks/QueryTask":function(){define("esri/tasks/QueryTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a){return n=n(l,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(n,i){this._handler=t.hitch(this,this._handler);this._relationshipQueryHandler=t.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=t.hitch(this,this._executeForIdsHandler);this._countHandler=t.hitch(this,this._countHandler);this._extentHandler=t.hitch(this,this._extentHandler);this.source=i&&i.source;this.gdbVersion=i&&i.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(n,i,r,f,e){var s=e.assembly,h,c;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson(s&&s[0]))),h=this._handler,c=this._errorHandler,this.source&&(s={source:this.source.toJson()},n.layer=u.toJson(s)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){h(n,t,i,r,e.dfd)},error:function(n){c(n,r,e.dfd)},callbackSuffix:f},this.requestOptions)},executeRelationshipQuery:function(n,i,u){var e,h,f;return n=this._encode(t.mixin({},this._url.query,{f:"json"},n.toJson())),e=this._relationshipQueryHandler,h=this._errorHandler,this.gdbVersion&&(n.gdbVersion=this.gdbVersion),f=new r(s._dfdCanceller),f._pendingDfd=o({url:this._url.path+"/queryRelatedRecords",content:n,callbackParamName:"callback",load:function(n,t){e(n,t,i,u,f)},error:function(n){h(n,u,f)}},this.requestOptions),f},executeForIds:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},n.toJson(e&&e[0]))),s=this._executeForIdsHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForCount:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._countHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},executeForExtent:function(n,i,r,f){var e=f.assembly,s,h;return n=this._encode(t.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},n.toJson(e&&e[0]))),s=this._extentHandler,h=this._errorHandler,this.source&&(e={source:this.source.toJson()},n.layer=u.toJson(e)),this.gdbVersion&&(n.gdbVersion=this.gdbVersion),o({url:this._url.path+"/query",content:n,callbackParamName:"callback",load:function(n,t){s(n,t,i,r,f.dfd)},error:function(n){h(n,r,f.dfd)}},this.requestOptions)},_handler:function(n,t,i,r,u){try{var f=new a(n);this._successHandler([f],"onComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},_relationshipQueryHandler:function(n,t,r,u,f){try{var o=n.geometryType,s=n.spatialReference,e={};i.forEach(n.relatedRecordGroups,function(n){var t={},i;if(t.geometryType=o,t.spatialReference=s,t.features=n.relatedRecords,t=new a(t),null!=n.objectId)e[n.objectId]=t;else for(i in n)n.hasOwnProperty(i)&&"relatedRecords"!==i&&(e[n[i]]=t)});this._successHandler([e],"onExecuteRelationshipQueryComplete",r,f)}catch(h){this._errorHandler(h,u,f)}},_executeForIdsHandler:function(n,t,i,r,u){try{this._successHandler([n.objectIds],"onExecuteForIdsComplete",i,u)}catch(f){this._errorHandler(f,r,u)}},_countHandler:function(n,t,i,r,u){try{var f,o=n.features,e=n.objectIds;if(e)f=e.length;else{if(o)throw Error("Unable to perform query. Please check your parameters.");f=n.count}this._successHandler([f],"onExecuteForCountComplete",i,u)}catch(s){this._errorHandler(s,r,u)}},_extentHandler:function(n,t,i,r,u){try{n.extent&&(n.extent=new h(n.extent));this._successHandler([n],"onExecuteForExtentComplete",i,u)}catch(f){this._errorHandler(f,r,u)}}}),c._createWrappers(n),f("extend-esri")&&t.setObject("tasks.QueryTask",n,e),n})},"esri/tasks/RasterData":function(){define("esri/tasks/RasterData",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.RasterData",constructor:function(n){n&&t.mixin(this,n)},url:null,format:null,itemID:null,toJson:function(){var n={};return this.url&&(n.url=this.url),this.format&&(n.format=this.format),this.itemID&&(n.itemID=this.itemID),n}}),i("extend-esri")&&t.setObject("tasks.RasterData",n,r),n})},"esri/tasks/RelationshipQuery":function(){define("esri/tasks/RelationshipQuery",["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,t,i,r,u){return n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var n={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},r=this.objectIds,u=this.outFields,t=this.outSpatialReference;return r&&(n.objectIds=r.join(",")),u&&(n.outFields=u.join(",")),t&&(n.outSR=t.wkid||i.toJson(t.toJson())),n._ts=this._ts,n}}),r("extend-esri")&&t.setObject("tasks.RelationshipQuery",n,u),n})},"esri/tasks/StatisticDefinition":function(){define("esri/tasks/StatisticDefinition",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}}),i("extend-esri")&&t.setObject("tasks.StatisticDefinition",n,r),n})},"esri/tasks/Task":function(){define("esri/tasks/Task","dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,t,i,r,u,f,e,o){return n=n(o,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(n,i){n&&t.isString(n)&&(this._url=e.urlToObject(this.url=n));i&&i.requestOptions&&(this.requestOptions=i.requestOptions);this.normalization=!0;this._errorHandler=t.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var n=this._url,t=/^http:/i;this.url&&(this.url=this.url.replace(t,"https:"));n&&n.path&&(n.path=n.path.replace(t,"https:"))},_encode:function(n,r,u){var e,f,s={},o,h;for(o in n)if("declaredClass"!==o&&(e=n[o],f=typeof e,null!==e&&void 0!==e&&"function"!==f))if(t.isArray(e))for(s[o]=[],h=e.length,f=0;f<h;f++)s[o][f]=this._encode(e[f]);else"object"===f?e.toJson&&(f=e.toJson(u&&u[o]),"esri.tasks.FeatureSet"===e.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),s[o]=r?f:i.toJson(f)):s[o]=e;return s},_successHandler:function(n,t,i,r){t&&this[t].apply(this,n);i&&i.apply(null,n);r&&f._resDfd(r,n)},_errorHandler:function(n,t,i){this.onError(n);t&&t(n);i&&i.errback(n)},setNormalization:function(n){this.normalization=n},onError:function(){}}),r("extend-esri")&&(u.Task=n),n})},"esri/tasks/locator":function(){define("esri/tasks/locator","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(h,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(){this._geocodeHandler=t.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=t.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=t.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(n){this.outSpatialReference=n},_geocodeHandler:function(n,t,i,r,u){var e,o,f,s,h,l;try{for(e=n.candidates,t=[],s=e.length,h=n.spatialReference,f=0;f<s;f++)o=e[f],(l=o.location)&&(l.spatialReference=h),t[f]=new c(o);this._successHandler([t],"onAddressToLocationsComplete",i,u)}catch(a){this._errorHandler(a,r,u)}},_geocodeAddressesHandler:function(n,t,i,r,u){var e,f,o,s,h;try{for(e=n.locations,t=[],o=e.length,s=n.spatialReference,f=0;f<o;f++)(h=e[f].location)&&(h.spatialReference=s),t[f]=new c(e[f]);this._successHandler([t],"onAddressesToLocationsComplete",i,u)}catch(l){this._errorHandler(l,r,u)}},addressToLocations:function(n,i,f,e,h){var v,y,p,w,b,l,k,a;n.address&&(e=f,f=i,i=n.outFields,h=n.searchExtent,k=n.countryCode,v=n.magicKey,y=n.distance,l=n.categories,n.location&&this.normalization&&(p=n.location.normalize()),w=n.maxLocations,b=n.forStorage,n=n.address);h&&(h=h.shiftCentralMeridian());a=this.outSpatialReference;n=this._encode(t.mixin({},this._url.query,n,{f:"json",outSR:a&&u.toJson(a.toJson()),outFields:i&&i.join(",")||null,searchExtent:h&&u.toJson(h.toJson()),category:l&&l.join(",")||null,countryCode:k||null,magicKey:v||null,distance:y||null,location:p||null,maxLocations:w||null,forStorage:b||null}));var d=this._geocodeHandler,g=this._errorHandler,c=new r(s._dfdCanceller);return c._pendingDfd=o({url:this._url.path+"/findAddressCandidates",content:n,callbackParamName:"callback",load:function(n,t){d(n,t,f,e,c)},error:function(n){g(n,e,c)}}),c},suggestLocations:function(n){var i;return i=new r(s._dfdCanceller),n.hasOwnProperty("location")&&this.normalization&&(n.location=n.location.normalize()),n.searchExtent&&(n.searchExtent=n.searchExtent.shiftCentralMeridian()),n=this._encode(t.mixin({},this._url.query,{f:"json",text:n.text,maxSuggestions:n.maxSuggestions,searchExtent:n.searchExtent&&u.toJson(n.searchExtent.toJson()),category:n.categories&&n.categories.join(",")||null,countryCode:n.countryCode||null,location:n.location||null,distance:n.distance||null},{f:"json"})),n=o({url:this._url.path+"/suggest",content:n,callbackParamName:"callback"}),i._pendingDfd=n,n.then(t.hitch(this,function(n){n=n.suggestions||[];this.onSuggestLocationsComplete(n);i.resolve(n)}),t.hitch(this,function(n){this._errorHandler(n);i.reject(n)})),i},addressesToLocations:function(n,f,e){var c=this.outSpatialReference,l=[],a=n.categories,v=n.countryCode;i.forEach(n.addresses,function(n){l.push({attributes:n})});n=this._encode(t.mixin({},this._url.query,{category:a&&a.join(",")||null,sourceCountry:v||null},{addresses:u.toJson({records:l})},{f:"json",outSR:c&&u.toJson(c.toJson())}));var y=this._geocodeAddressesHandler,p=this._errorHandler,h=new r(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/geocodeAddresses",content:n,callbackParamName:"callback",load:function(n,t){y(n,t,f,e,h)},error:function(n){p(n,e,h)}}),h},_reverseGeocodeHandler:function(n,t,i,r,u){try{var f=new c({address:n.address,location:n.location,score:100});this._successHandler([f],"onLocationToAddressComplete",i,u)}catch(e){this._errorHandler(e,r,u)}},locationToAddress:function(n,i,f,e){var c;n&&this.normalization&&(n=n.normalize());c=this.outSpatialReference;n=this._encode(t.mixin({},this._url.query,{outSR:c&&u.toJson(c.toJson()),location:n&&u.toJson(n.toJson()),distance:i,f:"json"}));var l=this._reverseGeocodeHandler,a=this._errorHandler,h=new r(s._dfdCanceller);return h._pendingDfd=o({url:this._url.path+"/reverseGeocode",content:n,callbackParamName:"callback",load:function(n,t){l(n,t,f,e,h)},error:function(n){a(n,e,h)}}),h},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}}),f("extend-esri")&&t.setObject("tasks.Locator",n,e),n})},"esri/toolbars/TextEditor":function(){define("esri/toolbars/TextEditor","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(n,t,i,r,u,f,e,o,s,h){return n=n(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(n,t,i){this._graphic=n;this._map=t;this._toolbar=i;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(n){this._editBox?(i.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=i.connect(n.getLayer(),"onDblClick",this,function(t){this._map.navigationManager.setImmediateClick(!1);t.graphic==n&&(r.stop(t),i.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(n))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(i.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(n,r){var u,c,h;if(!this._editBox){n.symbol.text||(n.symbol.text="Tempt text",n.setSymbol(n.symbol),u="");c=this._createInputTextStyle(n,this._map);""!==u&&(u=r||n.symbol.text);this._editBox=f.create("input",{type:"text",value:u});o.set(this._editBox,c);e.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=i.connect(this._editBox,"onkeyup",t.hitch(this,function(n){n.keyCode!=s.ENTER&&n.keyCode!==s.TAB||this._disable()}));this._editBoxBlurHandler=i.connect(this._editBox,"onblur",t.hitch(this,function(){this._disable()}));n.symbol.text="";n.setSymbol(n.symbol);n.hide();h=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",t.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(n){o.set(h,{left:this._editBoxLeft+n.delta.x+"px",top:this._editBoxTop+n.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(o.get(h,"left"));this._editBoxTop=parseFloat(o.get(h,"top"))});this.onEditStart(n,this._editBox);this._toolbar.onTextEditStart(n,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(i.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(i.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(n){var i=n.getDojoShape().getTransformedBoundingBox(),t=n.symbol.font;return{"font-family":t.family,"font-size":t.size+"px","font-style":t.style,"font-variant":t.variant,"font-weight":t.weight,left:i[0].x+"px",top:i[0].y+"px",width:Math.abs(i[0].x-i[1].x)/Math.cos(n.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var n=this._graphic.symbol;n.text=this._editBox.value;this._graphic.setSymbol(n)}else this._graphic.getLayer().remove(this._graphic)}}),u("extend-esri")&&t.setObject("toolbars.TextEditor",n,h),n})},"esri/toolbars/_Box":function(){define("esri/toolbars/_Box","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){return n=n(null,{declaredClass:"esri.toolbars._Box",constructor:function(n,i,r,u,f,e,o){this._graphic=n;this._map=i;this._toolbar=r;this._scale=u;this._rotate=f;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=e;n=r._options;this._markerSymbol=n.boxHandleSymbol;this._lineSymbol=n.boxLineSymbol;this._moveStartHandler=t.hitch(this,this._moveStartHandler);this._firstMoveHandler=t.hitch(this,this._firstMoveHandler);this._moveStopHandler=t.hitch(this,this._moveStopHandler);this._moveHandler=t.hitch(this,this._moveHandler);this._isTextPoint=o;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){i.forEach(this._getAllGraphics(),function(n){n.hide()})},resume:function(){i.forEach(this._getAllGraphics(),function(n){n.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&i.forEach(this._connects,r.disconnect);var n=this._toolbar._scratchGL;this._anchors&&i.forEach(this._anchors,function(t){n.remove(t.graphic);(t=t.moveable)&&t.destroy()});this._box&&n.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var f=this._map,e=this._toolbar._scratchGL,n=this._getBoxCoords(),u=new a(f.spatialReference),r=t.clone(i.filter(n,function(n,t){return 8!==t&&0==t%2}));r[0]&&r.push([r[0][0],r[0][1]]);u.addPath(r);this._rotate&&u.addPath([n[1],n[8]]);this._box?this._box.setGeometry(u):(this._box=new w(u,this._lineSymbol),e.add(this._box));this._anchors?i.forEach(this._anchors,function(t,i){var r,u;this._scale||(i=8);r=new l(n[i],f.spatialReference);t.graphic.setGeometry(r);r=t.moveable;u=t.graphic.getDojoShape();u&&(r?u!==r.shape&&(r.destroy(),t.moveable=this._getMoveable(t.graphic,i)):t.moveable=this._getMoveable(t.graphic,i))},this):(this._anchors=[],this._connects=[],i.forEach(n,function(n,t){if(this._scale||!(8>t)){n=new l(n,f.spatialReference);var i=new w(n,this._markerSymbol);this._isTextPoint&&1==t%2&&i.hide();e.add(i);this._anchors.push({graphic:i,moveable:this._getMoveable(i,t)})}},this))}else this._cleanUp()},_getBoxCoords:function(n){var e=this._map,r,o=[],f,h,s,u;return this._isTextPoint?(r=this._graphic.getNode().getBoundingClientRect(),u=e.__container.getBoundingClientRect(),r=[{x:r.left-u.left,y:r.top-u.top},{x:r.right-u.left,y:r.top-u.top},{x:r.right-u.left,y:r.bottom-u.top},{x:r.left-u.left,y:r.bottom-u.top}]):r=this._getTransformedBoundingBox(this._graphic),i.forEach(r,function(t,i,r){f=t;(h=r[i+1])||(h=r[0]);s={x:(f.x+h.x)/2,y:(f.y+h.y)/2};n||(f=e.toMap(f),s=e.toMap(s));o.push([f.x,f.y]);o.push([s.x,s.y])}),this._rotate&&(r=t.clone(o[1]),r=n?{x:r[0],y:r[1]}:e.toScreen({x:r[0],y:r[1],spatialReference:e.spatialReference}),r.y-=this._toolbar._options.rotateHandleOffset,n||(r=e.toMap(r)),o.push([r.x,r.y])),o},_getTransformedBoundingBox:function(n){var i=this._map,t=n.geometry.getExtent(),r=n.geometry.spatialReference;return n=new l(t.xmin,t.ymax,r),t=new l(t.xmax,t.ymin,r),n=i.toScreen(n),t=i.toScreen(t),[{x:n.x,y:n.y},{x:t.x,y:n.y},{x:t.x,y:t.y},{x:n.x,y:t.y}]},_getAllGraphics:function(){var n=[this._box];return this._anchors&&i.forEach(this._anchors,function(t){n.push(t.graphic)}),n=i.filter(n,c.isDefined)},_getMoveable:function(n,t){var u=n.getDojoShape(),i;if(u)return i=new o(u),i._index=t,this._connects.push(r.connect(i,"onMoveStart",this._moveStartHandler)),this._connects.push(r.connect(i,"onFirstMove",this._firstMoveHandler)),this._connects.push(r.connect(i,"onMoveStop",this._moveStopHandler)),i.onMove=this._moveHandler,(u=u.getEventSource())&&e.set(u,"cursor",this._toolbar._cursors["box"+t]),i},_moveStartHandler:function(n){this._toolbar["on"+(8===n.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(n){this._toolbar._deactivateScrollWheel();var u=n.host._index,e=this._wrapOffset=n.host.shape._wrapOffsets[0]||0,f=this._graphic.getLayer()._getTransform(),r;n=i.map(this._getBoxCoords(!0),function(n){return{x:n[0]+e,y:n[1]}});r=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:n[1].x,y:n[3].y};this._centerCoord=s.multiplyPoint(s.invert(f),r);8===u?(r=s.multiplyPoint(s.invert(f),n[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,r)),this._startLine=[this._centerCoord,r],this._moveLine=t.clone(this._startLine)):(r=s.multiplyPoint(s.invert(f),n[u]),f=s.multiplyPoint(s.invert(f),n[(u+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,r)),this._firstMoverToAnchor=Math.sqrt((r.x-this._centerCoord.x)*(r.x-this._centerCoord.x)+(r.y-this._centerCoord.y)*(r.y-this._centerCoord.y)),this._startBox=f,this._startBox.width=n[4].x-n[0].x,this._startBox.height=n[4].y-n[0].y,this._moveBox=t.clone(this._startBox),this._xfactor=r.x>f.x?1:-1,this._yfactor=r.y>f.y?1:-1,1===u||5===u)?this._xfactor=0:(3===u||7===u)&&(this._yfactor=0);this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===u?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(n,t){var o=n.host._index,f=this._defaultEventArgs,r,i,u,e,h;f.angle=0;f.scaleX=1;f.scaleY=1;8===o?(r=this._startLine,i=this._moveLine,u=i[1],u.x+=t.dx,u.y+=t.dy,u=this._getAngle(r,i),this._isTextPoint&&(u+=this._graphic.symbol.angle),i=s.rotategAt(u,r[0]),this._graphic.getDojoShape().setTransform(i),f.transform=i,f.angle=u,f.around=r[0]):(r=this._startBox,i=this._moveBox,i.width+=t.dx*this._xfactor,i.height+=t.dy*this._yfactor,this._uniformScaling||this._isTextPoint?(r=i.x+this._xfactor*i.width,i=i.y+this._yfactor*i.height,r=Math.sqrt((r-this._centerCoord.x)*(r-this._centerCoord.x)+(i-this._centerCoord.y)*(i-this._centerCoord.y)),this._scaleRatio=u=e=r/this._firstMoverToAnchor,r=this._centerCoord):(u=i.width/r.width,e=i.height/r.height,r={x:r.x,y:r.y}),(isNaN(u)||Infinity===u||-Infinity===u)&&(u=1),(isNaN(e)||Infinity===e||-Infinity===e)&&(e=1),i=s.scaleAt(u,e,r),this._isTextPoint?(h=s.rotategAt(this._graphic.symbol.angle,r),this._graphic.getDojoShape().setTransform([h,i])):this._graphic.getDojoShape().setTransform(i),f.transform=i,f.scaleX=u,f.scaleY=e,f.around=r);this._toolbar["on"+(8===o?this._rotateEvent:this._scaleEvent)](this._graphic,f)},_moveStopHandler:function(n){this._toolbar._activateScrollWheel();var t=this._graphic,r=this._toolbar,i=r._geo?y.geographicToWebMercator(t.geometry):t.geometry,e=i.spatialReference,u=t.getDojoShape(),f=u.getTransform(),o=t.getLayer()._getTransform();this._isTextPoint?(t=this._graphic.symbol,8===n.host._index?t.angle+=this._getAngle(this._startLine,this._moveLine):t.font.setSize(Math.round(t.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(t)):(i=i.toJson(),this._updateSegments(i.paths||i.rings,f,o,e),u.setTransform(null),i=p.fromJson(i),t.setGeometry(r._geo?y.webMercatorToGeographic(i,!0):i));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;r._endOperation("BOX");this._defaultEventArgs.transform=f;r["on"+(8===n.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(n,t,r,u){var f=this._map,e=this._wrapOffset||0;i.forEach(n,function(n){i.forEach(n,function(n){this._updatePoint(n,u,e,s,f,r,t)},this)},this)},_updatePoint:function(n,t,i,r,u,f,e){t=u.toScreen({x:n[0],y:n[1],spatialReference:t},!0);t.x+=i;t=r.multiplyPoint([f,e,r.invert(f)],t);t.x-=i;i=u.toMap(t);n[0]=i.x;n[1]=i.y},_getAngle:function(n,t){return 180*Math.atan2(t[0].y-t[1].y,t[0].x-t[1].x)/Math.PI-180*Math.atan2(n[0].y-n[1].y,n[0].x-n[1].x)/Math.PI},_deNormalizePoint:function(n,t){var r=this._map._getFrameWidth(),i,u;if(-1===r)return n;for(i={x:n.x,y:n.y};Math.abs(i.x-t.x)>=r;)i.x=i.x<t.x?i.x+r:i.x-r;return u=Math.abs(i.x-t.x),Math.abs(i.x-t.x+r)<u?i.x+=r:Math.abs(i.x-t.x-r)<u&&(i.x-=r),i}}),f("extend-esri")&&t.setObject("toolbars._Box",n,h),n})},"esri/toolbars/_GraphicMover":function(){define("esri/toolbars/_GraphicMover","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y=n(null,{declaredClass:"esri.toolbars._GraphicMover",constructor:function(n,t,i,r){this.graphic=n;this.map=t;this.toolbar=i;this.tempPt=r;this._enableGraphicMover();this._moved=!1},refresh:function(n){var t=this.graphic.getDojoShape();t&&(n||!t._hostGraphic)&&(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var n=this.graphic,t=n.getDojoShape();t&&(t._hostGraphic=n,this._moveable=new f(t,{mover:y.Mover}),this._moveStartHandle=i.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=i.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=i.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=i.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(n=t.getEventSource())&&u.set(n,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var t=this._moveable,n;t&&(i.disconnect(this._moveStartHandle),i.disconnect(this._firstMoveHandle),i.disconnect(this._movingHandle),i.disconnect(this._moveStopHandle),n=t.shape,n&&(n._hostGraphic=null,(n=n.getEventSource())&&u.set(n,"cursor","inherit")),t.destroy());this._moveable=null},_moveStartHandler:function(){var n=this.graphic,t=this.map;this._startTx=n.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&t.snappingManager&&t.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(n)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},_movingHandler:function(n,t,i){n=n.shape.getTransform();t=this.map;var r;c("esri-pointer")?r=t.navigationManager.pointerEvents._processTouchEvent(i,i):i&&"pointermove"===i.type&&(r=h.prototype._processTouchEvent.call({map:t},i,i));r&&t.snappingManager&&t.snappingManager._onSnappingMouseMoveHandler(r);this.tempPt&&this.tempPt.getDojoShape().setTransform(n);this.toolbar.onGraphicMove(this.graphic,n)},_moveStopHandler:function(n){var u=this.graphic,f=this.toolbar,i=this.map,t=f._geo?l.geographicToWebMercator(u.geometry):u.geometry,s=t.type,h=u.getDojoShape(),e=h.getTransform(),c;if(r.toJson(e)!==r.toJson(this._startTx)){this._moved=!0;switch(s){case"point":s=[e,o.invert(this._startTx)];i.snappingManager&&(c=i.snappingManager._snappingPoint);t=c||i.toMap(o.multiplyPoint(s,i.toScreen(t,!0)));i.snappingManager&&i.snappingManager._killOffSnapping();break;case"polyline":t=this._updatePolyGeometry(t,t.paths,e);break;case"polygon":t=this._updatePolyGeometry(t,t.rings,e)}h.setTransform(null);u.setGeometry(f._geo?l.webMercatorToGeographic(t,!0):t);this.tempPt&&this.tempPt.setGeometry(new v(u.geometry.toJson()))}else this._moved=!1;f._endOperation("MOVE");f.onGraphicMoveStop(u,e);this._moved||(n=n.__e,i=this.map.position,n=new a(n.pageX-i.x,n.pageY-i.y),f.onGraphicClick(u,{screenPoint:n,mapPoint:this.map.toMap(n)}))},_updatePolyGeometry:function(n,t,i){var r=this.map,u=n.getPoint(0,0),r=r.toMap(r.toScreen(u).offset(i.dx,i.dy)),f,e,o;for(i=r.x-u.x,u=r.y-u.y,r=0;r<t.length;r++)for(e=t[r],f=0;f<e.length;f++)o=n.getPoint(r,f),n.setPoint(r,f,o.offset(i,u));return n}});return y.Mover=n(e,{declaredClass:"esri.toolbars._Mover",constructor:function(n,t){this.__e=t}}),c("extend-esri")&&(t.setObject("toolbars._GraphicMover",y,s),t.setObject("toolbars._Mover",y.Mover,s)),y})},"esri/toolbars/_VertexEditor":function(){define("esri/toolbars/_VertexEditor","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){var a=n(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(n,t,i){this.graphic=n;this.map=t;this.toolbar=i;n=i._options;this._symbol1=n.vertexSymbol;this._symbol2=n.ghostVertexSymbol;t=n.ghostLineSymbol;this._lineStroke={style:t.style,width:t.width,color:t.color};this._canDel=n.allowDeleteVertices;this._canAdd=n.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(n){n?(this._removeControllers(),this._addControllers()):(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=i.connect(s,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=i.connect(s,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var n=this._getGraphicsLayer();this._mouseOverHandle=i.connect(n,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=i.connect(n,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new f({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),n=this._ctxDelete=new e({label:l.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=i.connect(n,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(n),this._ctxMenu.startup())},_removeControllers:function(){i.disconnect(this._firstMoveHandle);i.disconnect(this._moveStopHandle);i.disconnect(this._mouseOverHandle);i.disconnect(this._mouseOutHandle);i.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=null},_add:function(n,t,i){for(var u,h=this.graphic,o=[],f,e,r=0;r<n.length;r++){for(f=n[r],e=[],u=0;u<f.length;u++)e.push(new s(f[u],t,h,r,u,f.length,this,i));o.push(e)}return o},_remove:function(n){n&&r.forEach(n,function(n){r.forEach(n,function(n){n.destroy()})})},_refresh:function(n){n&&r.forEach(n,function(n){r.forEach(n,function(n){n.refresh()})})},_isNew:function(n){return-1===r.indexOf(this._vertexMovers[n.segIndex],n)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},_deleteHandler:function(n){n=this._selectedMover;this._updateRelatedGraphic(n,n.relatedGraphic,n.graphic.geometry,n.segIndex,n.ptIndex,n.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(n);this._deleteVertex(n);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(n){n=n.graphic;var t=this._findMover(n);t&&(this.toolbar.onVertexMouseOver(this.graphic,t._getInfo()),t._placeholder||(this._selectedMover=t,this._canDel&&this._bindCtxNode(n.getDojoShape().getNode())))},_mouseOutHandler:function(n){if(n=this._findMover(n.graphic))this.toolbar.onVertexMouseOut(this.graphic,n._getInfo())},_bindCtxNode:function(n){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(n);this._bindNode=n},_unbindCtxNode:function(){var n=this._bindNode;n&&this._ctxMenu.unBindDomNode(n)},_findMover:function(n){var t,i=[],u;for(t=this._mpVertexMovers,r.forEach(this._vertexMovers,function(n){i=i.concat(n)}),t&&r.forEach(t,function(n){i=i.concat(n)}),t=0;t<i.length;t++)if(u=i[t],u.graphic===n)return u},_firstMoveHandler:function(n){!this._isNew(n)&&this._canAdd&&this._hideRelatedMidpoints(n);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(n,t){var i=this._isNew(n);t&&(t.dx||t.dy)?(this._updateRelatedGraphic(n,n.relatedGraphic,n.graphic.geometry,n.segIndex,n.ptIndex,n.segLength,i),this._canAdd&&(i?this._addMidpoints(n):(this._repositionRelatedMidpoints(n),this._showRelatedMidpoints(n))),this.toolbar._endOperation("VERTICES")):!i&&this._canAdd&&this._showRelatedMidpoints(n)},_showRelatedMidpoints:function(n){var i=this._getAdjacentMidpoints(n.ptIndex,n.segLength),r=this._mpVertexMovers[n.segIndex],t;for(n=0;n<i.length;n++)t=r[i[n]],t.graphic.show(),t.refresh()},_hideRelatedMidpoints:function(n){var t=this._getAdjacentMidpoints(n.ptIndex,n.segLength),i=this._mpVertexMovers[n.segIndex];for(n=0;n<t.length;n++)i[t[n]].graphic.hide()},_repositionRelatedMidpoints:function(n){for(var u=this._getAdjacentMidpoints(n.ptIndex,n.segLength),f=this._mpVertexMovers[n.segIndex],t=0;t<u.length;t++){var i=this._getAdjacentVertices(u[t],n.segLength),r=n.relatedGraphic.geometry.getPoint(n.segIndex,i[0]),i=n.relatedGraphic.geometry.getPoint(n.segIndex,i[1]),r=new h({x:(r.x+i.x)/2,y:(r.y+i.y)/2,spatialReference:r.spatialReference.toJson()});f[u[t]].graphic.setGeometry(r)}},_addMidpoints:function(n){var e=n.segIndex,u=n.ptIndex,i=n.segLength,f=u+1,t,o=i+1,r;for(this._mpVertexMovers[e].splice(u,1),r=this._vertexMovers[e],t=0;t<f;t++)r[t].segLength+=1;for(t=f;t<r.length;t++)r[t].ptIndex+=1,r[t].segLength+=1;for(n.ptIndex=f,n.segLength=r.length+1,r.splice(f,0,n),n.graphic.setSymbol(this._symbol1),r=this._mpVertexMovers[e],t=0;t<u;t++)r[t].segLength+=1;for(t=u;t<i-1;t++)r[t].ptIndex+=1,r[t].segLength+=1;f=this._getAdjacentVertices(u,o);e=this._getAdjacentVertices(u+1,o);i=n.relatedGraphic.geometry.getPoint(n.segIndex,f[0]);t=n.relatedGraphic.geometry.getPoint(n.segIndex,f[1]);f=new h({x:(i.x+t.x)/2,y:(i.y+t.y)/2,spatialReference:i.spatialReference.toJson()});i=n.relatedGraphic.geometry.getPoint(n.segIndex,e[0]);t=n.relatedGraphic.geometry.getPoint(n.segIndex,e[1]);e=new h({x:(i.x+t.x)/2,y:(i.y+t.y)/2,spatialReference:i.spatialReference.toJson()});i=new s(f,this._symbol2,this.graphic,n.segIndex,u,o,this,!0);n=new s(e,this._symbol2,this.graphic,n.segIndex,u+1,o,this,!0);r.splice(u,0,i,n)},_deleteVertex:function(n){for(var r=n.ptIndex,i=this._vertexMovers[n.segIndex],u,t=0;t<r;t++)--i[t].segLength;for(t=r+1;t<i.length;t++)u=i[t],--u.ptIndex,--u.segLength;i.splice(r,1);t=n._getInfo();n.destroy();this.toolbar.onVertexDelete(this.graphic,t)}});return t.mixin(a,{create:function(n,t,i){switch(n.geometry.type){case"multipoint":return new a.MultipointVertexEditor(n,t,i);case"polyline":return new a.PolylineVertexEditor(n,t,i);case"polygon":return new a.PolygonVertexEditor(n,t,i)}}}),a.MultipointVertexEditor=n(a,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=i.connect(s,"onMoveStart",this,this._moveStartHandler);i.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);i.disconnect(this._moveStartHandle)},_getSegments:function(n){var i=n.points,r=[],u=n.spatialReference,t;for(n=0;n<i.length;n++)t=i[n],r.push(new h({x:t[0],y:t[1],spatialReference:u.toJson()}));return[r]},_getMidpointSegments:function(){return[]},_getControlPoints:function(){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(n){var t=n.graphic;(n=this._findMover(n))&&(this.toolbar.onVertexMouseOver(t,n._getInfo()),this._selectedMover=n,this._canDel&&this._bindCtxNode(n.graphic.getDojoShape().getNode()))},_mouseOutHandler:function(n){var t=n.graphic;if(n=this._findMover(n))this.toolbar.onVertexMouseOut(t,n._getInfo())},_findMover:function(n){var i=[].concat(this._vertexMovers[0]),r=n.target,t;for(n=0;n<i.length;n++)if(t=i[n],t.graphic.getDojoShape().getNode()===r)return t},_moveStartHandler:function(n){var i=n.ptIndex,r=n.segLength-1,t=n.relatedGraphic.geometry.points;for(n=t.splice(i,1),t.push(n[0]),t=this._vertexMovers[0],n=r;n>i;n--)--t[n].ptIndex;n=t.splice(i,1);t.push(n[0]);n[0].ptIndex=r},_moveStopHandler:function(n){this._updateRelatedGraphic(n,n.relatedGraphic,n.graphic.geometry,n.segIndex,n.ptIndex,n.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(n,t,i,r,u,f,e,o){n=t.geometry;o?n.removePoint(u):n.setPoint(u,i);t.setGeometry(n)},_deleteMidpoints:function(){}}),a.PolylineVertexEditor=n(a,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,_getSegments:function(n){for(var i,u=n.paths,f=[],e,r,t=0;t<u.length;t++){for(e=u[t],r=[],i=0;i<e.length;i++)r.push(n.getPoint(t,i));f.push(r)}return f},_getMidpointSegments:function(n){for(var i,f=n.paths,e=[],c=n.spatialReference,o,r,t=0;t<f.length;t++){for(o=f[t],r=[],i=0;i<o.length-1;i++){var u=n.getPoint(t,i),s=n.getPoint(t,i+1),u=new h({x:(u.x+s.x)/2,y:(u.y+s.y)/2,spatialReference:c.toJson()});r.push(u)}e.push(r)}return e},_getControlPoints:function(n,t,i,r,u){var f=this.map,e,o;return this._isNew(n)?(n=r,r+=1,0<=n&&(e=f.toScreen(t.getPoint(i,n))),r<=u&&(o=f.toScreen(t.getPoint(i,r)))):(n=r-1,r+=1,0<=n&&(e=f.toScreen(t.getPoint(i,n))),r<u&&(o=f.toScreen(t.getPoint(i,r)))),[e,o]},_getAdjacentMidpoints:function(n,t){var i=[],r=n-1;return 0<=r&&i.push(r),n<t-1&&i.push(n),i},_getAdjacentVertices:function(n){return[n,n+1]},_deleteMidpoints:function(n){for(var i=this._mpVertexMovers[n.segIndex],e=i.length-1,f=this._getAdjacentMidpoints(n.ptIndex,n.segLength).sort(),u=f[0],r,t=0;t<u;t++)--i[t].segLength;for(t=u+1;t<i.length;t++)r=i[t],--r.ptIndex,--r.segLength;if(1===f.length)i.splice(u,1)[0].destroy();else for(r=this._getAdjacentVertices(u,e),t=n.relatedGraphic.geometry.getPoint(n.segIndex,r[0]),r=n.relatedGraphic.geometry.getPoint(n.segIndex,r[1]),t=new h({x:(t.x+r.x)/2,y:(t.y+r.y)/2,spatialReference:t.spatialReference.toJson()}),n=new s(t,this._symbol2,this.graphic,n.segIndex,u,e,this,!0),i=i.splice(u,f.length,n),t=0;t<i.length;t++)i[t].destroy()},_updateRelatedGraphic:function(n,t,i,r,u,f,e,o){n=t.geometry;e?n.insertPoint(r,u+1,c.fromJson(i.toJson())):o?n.removePoint(r,u):n.setPoint(r,u,c.fromJson(i.toJson()));t.setGeometry(n)}}),a.PolygonVertexEditor=n(a,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(n){for(var i,u=n.rings,f=[],e,r,t=0;t<u.length;t++){for(e=u[t],r=[],i=0;i<e.length-1;i++)r.push(n.getPoint(t,i));f.push(r)}return f},_getMidpointSegments:function(n){for(var i,f=n.rings,e=[],c=n.spatialReference,o,r,t=0;t<f.length;t++){for(o=f[t],r=[],i=0;i<o.length-1;i++){var u=n.getPoint(t,i),s=n.getPoint(t,i+1),u=new h({x:(u.x+s.x)/2,y:(u.y+s.y)/2,spatialReference:c.toJson()});r.push(u)}e.push(r)}return e},_getControlPoints:function(n,t,i,r,u){var f=this.map;return this._isNew(n)?n=r:(n=r-1,n=0>n?(u+n)%u:n),r=(r+1)%u,u=f.toScreen(t.getPoint(i,n)),t=f.toScreen(t.getPoint(i,r)),[u,t]},_getAdjacentMidpoints:function(n,t){var i=n-1;return[0>i?(t+i)%t:i,n]},_getAdjacentVertices:function(n,t){return[n,(n+1)%t]},_deleteMidpoints:function(n){var i=n.ptIndex,f=this._mpVertexMovers[n.segIndex],e=f.length-1,t=this._getAdjacentMidpoints(i,n.segLength).sort(),u,r,o;if(r=t[0],o=t[t.length-1],0===i)for(u=this._getAdjacentVertices(e-1,e),i=n.relatedGraphic.geometry.getPoint(n.segIndex,u[0]),u=n.relatedGraphic.geometry.getPoint(n.segIndex,u[1]),i=new h({x:(i.x+u.x)/2,y:(i.y+u.y)/2,spatialReference:i.spatialReference.toJson()}),n=new s(i,this._symbol2,this.graphic,n.segIndex,e-1,e,this,!0),f.splice(o,1,n)[0].destroy(),f.splice(r,1)[0].destroy(),t=0;t<f.length-1;t++)r=f[t],--r.ptIndex,--r.segLength;else{for(u=this._getAdjacentVertices(r,e),i=n.relatedGraphic.geometry.getPoint(n.segIndex,u[0]),u=n.relatedGraphic.geometry.getPoint(n.segIndex,u[1]),i=new h({x:(i.x+u.x)/2,y:(i.y+u.y)/2,spatialReference:i.spatialReference.toJson()}),n=new s(i,this._symbol2,this.graphic,n.segIndex,r,e,this,!0),o=f.splice(r,t.length,n),t=0;t<o.length;t++)o[t].destroy();for(t=0;t<r;t++)--f[t].segLength;for(t=r+1;t<f.length;t++)r=f[t],--r.ptIndex,--r.segLength}},_updateRelatedGraphic:function(n,t,i,r,u,f,e,o){n=t.geometry;e?n.insertPoint(r,u+1,c.fromJson(i.toJson())):o?(n.removePoint(r,u),0===u&&n.setPoint(r,f-1,c.fromJson(n.getPoint(r,0).toJson()))):(n.setPoint(r,u,c.fromJson(i.toJson())),0===u&&n.setPoint(r,f,c.fromJson(i.toJson())));t.setGeometry(n)}}),u("extend-esri")&&(t.setObject("toolbars._GraphicVertexEditor",a,o),t.setObject("toolbars._MultipointVertexEditor",a.MultipointVertexEditor,o),t.setObject("toolbars._PolylineVertexEditor",a.PolylineVertexEditor,o),t.setObject("toolbars._PolygonVertexEditor",a.PolygonVertexEditor,o)),a})},"esri/toolbars/_VertexMover":function(){define("esri/toolbars/_VertexMover","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l){return n=n(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(n,t,i,r,u,f,e,o){this.point=n;this.symbol=t;this.relatedGraphic=i;this.segIndex=r;this.ptIndex=u;this.segLength=f;this.editor=e;this.map=e.map;this._scratchGL=e.toolbar._scratchGL;this._placeholder=o||!1;this._type=i.geometry.type;this._init();this._enable()},refresh:function(n){(n||this._needRefresh())&&(this._disable(),this._enable())},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var n=new h(this.point.toJson()),n=new c(n,this.symbol);switch(this._type){case"multipoint":n._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case"polyline":case"polygon":this._scratchGL.add(n)}this.graphic=n},_enable:function(){var n=this.graphic.getDojoShape();n&&(n._hasMover=!0,this._moveable=this._getMoveable(n),(n=n.getEventSource())&&u.set(n,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var t=this._moveable,n;t&&(i.disconnect(this._startHandle),i.disconnect(this._firstHandle),i.disconnect(this._movingHandle),i.disconnect(this._stopHandle),n=t.shape,n&&(n=n.getEventSource())&&u.set(n,"cursor","inherit"),t.destroy(),this._moveable=null)},_needRefresh:function(){var t=this.graphic.getDojoShape(),i=!1,n;if(t)switch(this._type){case"multipoint":n=this.relatedGraphic.getDojoShape();n&&(n=n.children[this.ptIndex],t!==n&&(this.graphic._shape=n,i=!0));break;case"polyline":case"polygon":i=!t._hasMover}return i},_getMoveable:function(n){return n=new f(n,r("mac")&&r("ff")&&!s("esri-touch")&&{leftButtonOnly:!0}),this._startHandle=i.connect(n,"onMoveStart",this,this._moveStartHandler),this._firstHandle=i.connect(n,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=i.connect(n,"onMoving",this,this._movingHandler),this._stopHandle=i.connect(n,"onMoveStop",this,this._moveStopHandler),n},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(n){var t=this.map;t.snappingManager&&t.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();n.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(n){for(var e=n.shape,r=this._getControlEdges(),o=this._scratchGL._div,u=[],f=n.host.shape._wrapOffsets[0]||0,t,i=0;i<r.length;i++)t=r[i],t.x1+=f,t.x2+=f,u.push([o.createLine({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}).setStroke(this.editor._lineStroke),t.x1,t.y1,t.x2,t.y2]);e._lines=u;n.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(n,t,i){t=this.map;var r;for(s("esri-pointer")?r=t.navigationManager.pointerEvents._processTouchEvent(i,i):i&&"pointermove"===i.type&&(r=o.prototype._processTouchEvent.call({map:t},i,i)),r&&t.snappingManager&&t.snappingManager._onSnappingMouseMoveHandler(r),i=n.shape,n=i.getTransform(),i=i._lines,r=0;r<i.length;r++)t=i[r],t[0].setShape({x1:t[1]+n.dx,y1:t[2]+n.dy,x2:t[3],y2:t[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),n)},_moveStopHandler:function(n){var i,r,s,e;n=n.shape;var u=this.editor.toolbar,t=n.getTransform(),f=this.map,o=this.graphic,h=u._geo?l.geographicToWebMercator(o.geometry):o.geometry;if(u._activateScrollWheel(),r=n._lines,r){for(i=0;i<r.length;i++)r[i][0].removeShape();n._lines=null}i=!1;r=!0;s=this._getInfo();t&&(t.dx||t.dy)?this._placeholder&&(this._placeholder=!1,i=!0):r=!1;f.snappingManager&&(e=f.snappingManager._snappingPoint);e=e||f.toMap(f.toScreen(h).offset(t.dx,t.dy));f.snappingManager&&f.snappingManager._killOffSnapping();n.setTransform(null);o.setGeometry(u._geo?l.webMercatorToGeographic(e,!0):e);this.constructor.onMoveStop(this,t);u.onVertexMoveStop(this.relatedGraphic,s,t);if(!r)u.onVertexClick(this.relatedGraphic,s);if(i)u.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var r=this.map,n=this.relatedGraphic.geometry,e=this.segIndex,o=this.ptIndex,s=this.segLength,t=this._scratchGL._getTransform(),u=t.dx,t=t.dy,i=r.toScreen(this.graphic.geometry),r=i.x-u,i=i.y-t,f=[],n=this.editor._getControlPoints(this,n,e,o,s);return n[0]&&f.push({x1:r,y1:i,x2:n[0].x-u,y2:n[0].y-t}),n[1]&&f.push({x1:r,y1:i,x2:n[1].x-u,y2:n[1].y-t}),f}}),s("extend-esri")&&t.setObject("toolbars.VertexMover",n,e),t.mixin(n,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}}),n})},"esri/toolbars/_toolbar":function(){define("esri/toolbars/_toolbar",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(n,t,i,r,u){return n=n([u],{declaredClass:"esri.toolbars._Toolbar",constructor:function(n){this.map=n},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(n,t,i,r){var u=this.map;n&&(this._mapNavState={isDoubleClickZoom:u.isDoubleClickZoom,isClickRecenter:u.isClickRecenter,isPan:u.isPan,isRubberBandZoom:u.isRubberBandZoom,isKeyboardNavigation:u.isKeyboardNavigation,isScrollWheelZoom:u.isScrollWheelZoom},u.disableDoubleClickZoom(),u.disableClickRecenter(),u.disablePan(),u.disableRubberBandZoom(),u.disableKeyboardNavigation());t&&u.hideZoomSlider();i&&u.hidePanArrows();r&&u.graphics.disableMouseEvents()},_activateMapTools:function(n,t,i,r){var u=this.map,f=this._mapNavState;n&&f&&(f.isDoubleClickZoom&&u.enableDoubleClickZoom(),f.isClickRecenter&&u.enableClickRecenter(),f.isPan&&u.enablePan(),f.isRubberBandZoom&&u.enableRubberBandZoom(),f.isKeyboardNavigation&&u.enableKeyboardNavigation(),f.isScrollWheelZoom&&u.enableScrollWheelZoom());t&&u.showZoomSlider();i&&u.showPanArrows();r&&u.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var n=this.map;this._scrollWheelState={isScrollWheelZoom:n.isScrollWheelZoom,isScrollWheelPan:n.isScrollWheelPan};n.disableScrollWheelZoom();n.disableScrollWheelPan()},_activateScrollWheel:function(){var t=this.map,n=this._scrollWheelState;n&&(n.isScrollWheelZoom&&t.enableScrollWheelZoom(),n.isScrollWheelPan&&t.enableScrollWheelPan())}}),i("extend-esri")&&t.setObject("toolbars._Toolbar",n,r),n})},"esri/toolbars/draw":function(){define("esri/toolbars/draw","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){var ft=n(y,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(n,i){this.markerSymbol=new p(p.STYLE_SOLID,10,new w(w.STYLE_SOLID,new u([255,0,0]),2),new u([0,0,0,.25]));this.lineSymbol=new w(w.STYLE_SOLID,new u([255,0,0]),2);this.fillSymbol=new b(b.STYLE_SOLID,new w(w.STYLE_SOLID,new u([255,0,0]),2),new u([0,0,0,.25]));this._points=[];this._mouse=!e("esri-touch")&&!e("esri-pointer");this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=t.mixin(t.mixin({},this._defaultOptions),i||{});(o("ios")||o("android"))&&(this._options.showTooltips=!1);this._onKeyDownHandler=t.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=t.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=t.hitch(this,this._onMouseUpHandler);this._onClickHandler=t.hitch(this,this._onClickHandler);this._onMouseMoveHandler=t.hitch(this,this._onMouseMoveHandler);this._onMouseDragHandler=t.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=t.hitch(this,this._onDblClickHandler);this._updateTooltip=t.hitch(this,this._updateTooltip);this._hideTooltip=t.hitch(this,this._hideTooltip);this._redrawGraphic=t.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(n){this.respectDrawingVertexOrder=n},setMarkerSymbol:function(n){this.markerSymbol=n},setLineSymbol:function(n){this.lineSymbol=n},setFillSymbol:function(n){this.fillSymbol=n},activate:function(n,i){this._geometryType&&this.deactivate();var u=this.map,f=r.connect,o=ft;this._options=t.mixin(t.mixin({},this._options),i||{});u.navigationManager.setImmediateClick(!1);switch(n){case o.ARROW:case o.LEFT_ARROW:case o.RIGHT_ARROW:case o.UP_ARROW:case o.DOWN_ARROW:case o.TRIANGLE:case o.CIRCLE:case o.ELLIPSE:case o.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=f(u,"onClick",this._onClickHandler);this._mouse?(this._onMouseDownHandler_connect=f(u,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=f(u,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=f(u,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=f(u,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=f(u,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=f(u,"onMouseDragEnd",this._onMouseUpHandler));e("esri-touch")&&!e("esri-pointer")&&(this._onMouseDownHandler2_connect=f(u,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=f(u,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=f(u,"onSwipeEnd",this._onMouseUpHandler));break;case o.POINT:this._onClickHandler_connect=f(u,"onClick",this._onClickHandler);break;case o.LINE:case o.EXTENT:case o.FREEHAND_POLYLINE:case o.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=f(u,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=f(u,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=f(u,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=f(u,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=f(u,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=f(u,"onMouseDragEnd",this._onMouseUpHandler));e("esri-touch")&&!e("esri-pointer")&&(this._onMouseDownHandler2_connect=f(u,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=f(u,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=f(u,"onSwipeEnd",this._onMouseUpHandler));break;case o.POLYLINE:case o.POLYGON:case o.MULTI_POINT:u.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=f(u,"onClick",this._onClickHandler);this._onDblClickHandler_connect=f(u,"onDblClick",this._onDblClickHandler);this._dblClickZoom=u.isDoubleClickZoom;u.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+n);return}this._onKeyDown_connect=f(u,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=f(u,"onExtentChange",this._redrawGraphic);this._geometryType=n;this._toggleTooltip(!0);u.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(u.snappingManager._startSelectionLayerQuery(),u.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var t=this.map,n;this._clear();n=r.disconnect;n(this._onMouseMoveHandler_connect);n(this._onMouseDownHandler_connect);n(this._onMouseDragHandler_connect);n(this._onMouseUpHandler_connect);n(this._onMouseDownHandler2_connect);n(this._onMouseDragHandler2_connect);n(this._onMouseUpHandler2_connect);n(this._onClickHandler_connect);n(this._onDblClickHandler_connect);n(this._onKeyDown_connect);n(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;t.snappingManager&&(t.snappingManager._stopSelectionLayerQuery(),t.snappingManager._killOffSnapping());switch(this._geometryType){case ft.CIRCLE:case ft.ELLIPSE:case ft.TRIANGLE:case ft.ARROW:case ft.LEFT_ARROW:case ft.RIGHT_ARROW:case ft.UP_ARROW:case ft.DOWN_ARROW:case ft.RECTANGLE:case ft.LINE:case ft.EXTENT:case ft.FREEHAND_POLYLINE:case ft.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case ft.POLYLINE:case ft.POLYGON:case ft.MULTI_POINT:this._dblClickZoom&&t.enableDoubleClickZoom()}n=this._geometryType;this._geometryType=null;t.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(n)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var t,n=this._points,u=this.map.spatialReference,f=ft,n=n.slice(0,n.length);switch(this._geometryType){case f.POLYLINE:if(!this._graphic||2>n.length)return;t=new nt(u);t.addPath([].concat(n));break;case f.POLYGON:if(!this._graphic||3>n.length)return;t=new tt(u);n=[].concat(n,[n[0].offset(0,0)]);tt.prototype.isClockwise(n)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),n.reverse());t.addRing(n);break;case f.MULTI_POINT:t=new it(u);i.forEach(n,function(n){t.addPoint(n)})}r.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(t)},_drawEnd:function(n){if(n){var t=this.map.spatialReference,i;this.onDrawEnd(n);t&&(t.isWebMercator()?i=g.webMercatorToGeographic(n,!0):4326===t.wkid&&(i=d.fromJson(n.toJson())));this.onDrawComplete({geometry:n,geographicGeometry:i})}},_normalizeRect:function(n,t,i){var u=n.x,r;return n=n.y,r=t.x,t=t.y,{x:Math.min(u,r),y:Math.max(n,t),width:Math.abs(u-r),height:Math.abs(n-t),spatialReference:i}},_onMouseDownHandler:function(n){var t,r,i,u;this._dragged=!1;this.map.snappingManager&&(t=this.map.snappingManager._snappingPoint);r=t||n.mapPoint;i=ft;t=this.map;u=t.spatialReference;this._points.push(r.offset(0,0));switch(this._geometryType){case i.LINE:this._graphic=t.graphics.add(new k(new nt({paths:[[[r.x,r.y],[r.x,r.y]]],spatialReference:u}),this.lineSymbol),!0);t.snappingManager&&t.snappingManager._setGraphic(this._graphic);break;case i.FREEHAND_POLYLINE:this._oldPoint=n.screenPoint;r=new nt(u);r.addPath(this._points);this._graphic=t.graphics.add(new k(r,this.lineSymbol),!0);t.snappingManager&&t.snappingManager._setGraphic(this._graphic);break;case i.CIRCLE:case i.ELLIPSE:case i.TRIANGLE:case i.ARROW:case i.LEFT_ARROW:case i.RIGHT_ARROW:case i.UP_ARROW:case i.DOWN_ARROW:case i.RECTANGLE:case i.FREEHAND_POLYGON:this._oldPoint=n.screenPoint;r=new tt(u);r.addRing(this._points);this._graphic=t.graphics.add(new k(r,this.fillSymbol),!0);t.snappingManager&&t.snappingManager._setGraphic(this._graphic)}e("esri-touch")&&n.preventDefault()},_onMouseMoveHandler:function(n){var t,r,i;this.map.snappingManager&&(t=this.map.snappingManager._snappingPoint);r=this._points[this._points.length-1];n=t||n.mapPoint;t=this._tGraphic;i=t.geometry;switch(this._geometryType){case ft.POLYLINE:case ft.POLYGON:i.setPoint(0,0,{x:r.x,y:r.y});i.setPoint(0,1,{x:n.x,y:n.y});t.setGeometry(i)}},_onMouseDragHandler:function(n){var u;if(this._graphic||this._points.length)if(e("esri-touch")&&!this._points.length)n.preventDefault();else{this._dragged=!0;this.map.snappingManager&&(u=this.map.snappingManager._snappingPoint);var l=this._points[0],c=u||n.mapPoint,o=this.map,a=o.spatialReference;u=this._graphic;var h=ft,f=o.toScreen(l),r=o.toScreen(c),i=[],i=r.x-f.x,r=r.y-f.y,s=Math.sqrt(i*i+r*r);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();u.geometry=tt.createCircle({center:f,r:s,numberOfPoints:60,map:o});u.setGeometry(u.geometry);break;case h.ELLIPSE:this._hideTooltip();u.geometry=tt.createEllipse({center:f,longAxis:i,shortAxis:r,numberOfPoints:60,map:o});u.setGeometry(u.geometry);break;case h.TRIANGLE:this._hideTooltip();i=[[0,-s],[.8660254037844386*s,.5*s],[-.8660254037844386*s,.5*s],[0,-s]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.ARROW:this._hideTooltip();l=r/s;o=i/s;c=.25*o*s;a=.25*s/(r/i);s*=.25*l;i=[[i,r],[i-c*(1+24/a),r+24*o-s],[i-c*(1+12/a),r+12*o-s],[-12*l,12*o],[12*l,-12*o],[i-c*(1-12/a),r-12*o-s],[i-c*(1-24/a),r-24*o-s],[i,r]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.LEFT_ARROW:this._hideTooltip();i=0>=i?[[i,0],[.75*i,r],[.75*i,.5*r],[0,.5*r],[0,-.5*r],[.75*i,-.5*r],[.75*i,-r],[i,0]]:[[0,0],[.25*i,r],[.25*i,.5*r],[i,.5*r],[i,-.5*r],[.25*i,-.5*r],[.25*i,-r],[0,0]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();i=0<=i?[[i,0],[.75*i,r],[.75*i,.5*r],[0,.5*r],[0,-.5*r],[.75*i,-.5*r],[.75*i,-r],[i,0]]:[[0,0],[.25*i,r],[.25*i,.5*r],[i,.5*r],[i,-.5*r],[.25*i,-.5*r],[.25*i,-r],[0,0]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.UP_ARROW:this._hideTooltip();i=0>=r?[[0,r],[-i,.75*r],[-.5*i,.75*r],[-.5*i,0],[.5*i,0],[.5*i,.75*r],[i,.75*r],[0,r]]:[[0,0],[-i,.25*r],[-.5*i,.25*r],[-.5*i,r],[.5*i,r],[.5*i,.25*r],[i,.25*r],[0,0]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.DOWN_ARROW:this._hideTooltip();i=0<=r?[[0,r],[-i,.75*r],[-.5*i,.75*r],[-.5*i,0],[.5*i,0],[.5*i,.75*r],[i,.75*r],[0,r]]:[[0,0],[-i,.25*r],[-.5*i,.25*r],[-.5*i,r],[.5*i,r],[.5*i,.25*r],[i,.25*r],[0,0]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.RECTANGLE:this._hideTooltip();i=[[0,0],[i,0],[i,r],[0,r],[0,0]];u.geometry=this._toPolygon(i,f.x,f.y);u.setGeometry(u.geometry);break;case h.LINE:u.setGeometry(t.mixin(u.geometry,{paths:[[[l.x,l.y],[c.x,c.y]]]}));break;case h.EXTENT:u&&o.graphics.remove(u,!0);u=new rt(this._normalizeRect(l,c,a));u._originOnly=!0;this._graphic=o.graphics.add(new k(u,this.fillSymbol),!0);o.snappingManager&&o.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:if(this._hideTooltip(),!1===this._canDrawFreehandPoint(n)){e("esri-touch")&&n.preventDefault();return}this._points.push(n.mapPoint.offset(0,0));u.geometry._insertPoints([c.offset(0,0)],0);u.setGeometry(u.geometry);break;case h.FREEHAND_POLYGON:if(this._hideTooltip(),!1===this._canDrawFreehandPoint(n)){e("esri-touch")&&n.preventDefault();return}this._points.push(n.mapPoint.offset(0,0));u.geometry._insertPoints([c.offset(0,0)],0);u.setGeometry(u.geometry)}e("esri-touch")&&n.preventDefault()}},_canDrawFreehandPoint:function(n){if(!this._oldPoint)return!1;var t=this._oldPoint.x-n.screenPoint.x,i=this._oldPoint.y-n.screenPoint.y,r=this._options.tolerance;return(0>t?-1*t:t)<r&&(0>i?-1*i:i)<r?!1:(t=new Date,t-this._startTime<this._options.drawTime)?!1:(this._startTime=t,this._oldPoint=n.screenPoint,!0)},_onMouseUpHandler:function(n){var i,r,f,t,u;if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(n.mapPoint.offset(0,0));this.map.snappingManager&&(i=this.map.snappingManager._snappingPoint);r=this._points[0];i=i||n.mapPoint;f=this.map.spatialReference;t=ft;switch(this._geometryType){case t.CIRCLE:case t.ELLIPSE:case t.TRIANGLE:case t.ARROW:case t.LEFT_ARROW:case t.RIGHT_ARROW:case t.UP_ARROW:case t.DOWN_ARROW:case t.RECTANGLE:u=this._graphic.geometry;break;case t.LINE:u=new nt({paths:[[[r.x,r.y],[i.x,i.y]]],spatialReference:f});break;case t.EXTENT:u=new rt(this._normalizeRect(r,i,f)).getExtent();break;case t.FREEHAND_POLYLINE:u=new nt(f);u.addPath([].concat(this._points,[i.offset(0,0)]));break;case t.FREEHAND_POLYGON:u=new tt(f);r=[].concat(this._points,[i.offset(0,0),this._points[0].offset(0,0)]);tt.prototype.isClockwise(r)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),r.reverse());u.addRing(r)}e("esri-touch")&&n.preventDefault();this._clear();this._drawEnd(u)}else this._clear()},_onClickHandler:function(n){var i,t,u;this.map.snappingManager&&(i=this.map.snappingManager._snappingPoint);n=i||n.mapPoint;i=this.map;t=i.toScreen(n);u=ft;this._points.push(n.offset(0,0));switch(this._geometryType){case u.POINT:this._drawEnd(n.offset(0,0));this._setTooltipMessage(0);break;case u.POLYLINE:1===this._points.length?(t=new nt(i.spatialReference),t.addPath(this._points),this._graphic=i.graphics.add(new k(t,this.lineSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=r.connect(i,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=i.graphics.add(new k(new nt({paths:[[[n.x,n.y],[n.x,n.y]]],spatialReference:i.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([n.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),i=this._tGraphic,t=i.geometry,t.setPoint(0,0,n.offset(0,0)),t.setPoint(0,1,n.offset(0,0)),i.setGeometry(t));break;case u.POLYGON:1===this._points.length?(t=new tt(i.spatialReference),t.addRing(this._points),this._graphic=i.graphics.add(new k(t,this.fillSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=r.connect(i,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=i.graphics.add(new k(new nt({paths:[[[n.x,n.y],[n.x,n.y]]],spatialReference:i.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([n.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),i=this._tGraphic,t=i.geometry,t.setPoint(0,0,n.offset(0,0)),t.setPoint(0,1,n.offset(0,0)),i.setGeometry(t));break;case u.MULTI_POINT:n=this._points;1===n.length?(t=new it(i.spatialReference),t.addPoint(n[n.length-1]),this._graphic=i.graphics.add(new k(t,this.markerSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(n[n.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case u.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],t.x,t.y);break;case u.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],t.x,t.y);break;case u.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],t.x,t.y);break;case u.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],t.x,t.y);break;case u.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],t.x,t.y);break;case u.TRIANGLE:this._addShape([[0,-48],[41.569219381653063,24],[-41.569219381653063,24],[0,-48]],t.x,t.y);break;case u.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],t.x-48,t.y+48);break;case u.CIRCLE:this._clear();this._drawEnd(tt.createCircle({center:t,r:48,numberOfPoints:60,map:i}));break;case u.ELLIPSE:this._clear();this._drawEnd(tt.createEllipse({center:t,longAxis:48,shortAxis:24,numberOfPoints:60,map:i}))}this._setTooltipMessage(this._points.length)},_addShape:function(n,t,i){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(n,t,i))},_toPolygon:function(n,t,r){var u=this.map,f=new tt(u.spatialReference);return f.addRing(i.map(n,function(n){return u.toMap({x:n[0]+t,y:n[1]+r})})),f},_onDblClickHandler:function(n){var u,t=this._points,f=this.map.spatialReference,o=ft;e("esri-touch")&&t.push(n.mapPoint);var s=t[t.length-1],h=t[t.length-2],t=s&&h&&s.x===h.x&&s.y===h.y?t.slice(0,t.length-1):t.slice(0,t.length);switch(this._geometryType){case o.POLYLINE:if(!this._graphic||2>t.length){r.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(n);return}u=new nt(f);u.addPath([].concat(t));break;case o.POLYGON:if(!this._graphic||2>t.length){r.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(n);return}u=new tt(f);n=[].concat(t,[t[0].offset(0,0)]);tt.prototype.isClockwise(n)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),n.reverse());u.addRing(n);break;case o.MULTI_POINT:u=new it(f);i.forEach(t,function(n){u.addPoint(n)})}r.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(u)},_onKeyDownHandler:function(n){n.keyCode===s.ESCAPE&&(r.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(n){this._options.showTooltips&&(n?this._tooltip||(this._tooltip=h.create("div",{"class":"esriMapTooltip"},this.map.container),l.isBodyLtr()||c.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=r.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=r.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=r.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(r.disconnect(this._onTooltipMouseEnterHandler_connect),r.disconnect(this._onTooltipMouseLeaveHandler_connect),r.disconnect(this._onTooltipMouseMoveHandler_connect),h.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var n=this._tooltip;n&&(n.style.display="none")},_setTooltipMessage:function(n){var i=this._tooltip,t;if(i){t="";switch(this._geometryType){case ft.POINT:t=ut.toolbars.draw.addPoint;break;case ft.ARROW:case ft.LEFT_ARROW:case ft.RIGHT_ARROW:case ft.UP_ARROW:case ft.DOWN_ARROW:case ft.TRIANGLE:case ft.RECTANGLE:case ft.CIRCLE:case ft.ELLIPSE:t=ut.toolbars.draw.addShape;break;case ft.LINE:case ft.EXTENT:case ft.FREEHAND_POLYLINE:case ft.FREEHAND_POLYGON:t=ut.toolbars.draw.freehand;break;case ft.POLYLINE:case ft.POLYGON:t=ut.toolbars.draw.start;1===n?t=ut.toolbars.draw.resume:2<=n&&(t=ut.toolbars.draw.complete);break;case ft.MULTI_POINT:t=ut.toolbars.draw.addMultipoint;1<=n&&(t=ut.toolbars.draw.finish)}i.innerHTML=t}},_updateTooltip:function(n){var t=this._tooltip,i;t&&(n.clientX||n.pageY?(i=n.clientX,n=n.clientY):(i=n.clientX+f.body().scrollLeft-f.body().clientLeft,n=n.clientY+f.body().scrollTop-f.body().clientTop),t.style.display="none",c.set(t,{left:i+this._options.tooltipOffset+"px",top:n+"px"}),t.style.display="")},_redrawGraphic:function(n,t,i){(i||this.map.wrapAround180)&&((n=this._graphic)&&n.setGeometry(n.geometry),(n=this._tGraphic)&&n.setGeometry(n.geometry))},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});return t.mixin(ft,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"}),e("extend-esri")&&t.setObject("toolbars.Draw",ft,a),ft})},"esri/toolbars/edit":function(){define("esri/toolbars/edit","require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){var nt=t(a,{declaredClass:"esri.toolbars.Edit",constructor:function(n,t){var o,u;this._map=n;this._tool=0;this._map.loaded?this._scratchGL=n.graphics:o=r.connect(this._map,"onLoad",this,function(){r.disconnect(o);o=null;this._scratchGL=this._map.graphics});u=e("esri-mobile");this._defaultOptions=i.mixin({vertexSymbol:new b(b.STYLE_CIRCLE,u?20:12,new k(k.STYLE_SOLID,new f([0,0,0,.5]),1),new f([128,128,128])),ghostVertexSymbol:new b(b.STYLE_CIRCLE,u?18:10,new k(k.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),ghostLineSymbol:new k(k.STYLE_DOT,new f([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:u?24:16,boxLineSymbol:new k(k.STYLE_DASH,new f([64,64,64]),1),boxHandleSymbol:new b(b.STYLE_SQUARE,u?16:9,new k(k.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),textAnchorSymbol:new b(b.STYLE_CIRCLE,10,null,new f([255,0,0]))},t||{})},activate:function(n,t,u){var f;this.deactivate();this._graphic=t;this._options=i.mixin(i.mixin({},this._defaultOptions),u||{});f=nt.MOVE;u=nt.EDIT_VERTICES;var a=nt.SCALE,e=nt.ROTATE,v=nt.EDIT_TEXT,s=!1,h=!1,y=!1,o=this._map,c=o.spatialReference,l=t.geometry.spatialReference;if(this._geo=!(!c||!l||c.equals(l)||!c.isWebMercator()||4326!==l.wkid),this._isTextPoint=this._prepareTextSymbolEditing(t,n),(n&f)===f&&(s=this._enableMove(t)),f=(n&a)===a,e=(n&e)===e,(f||e)&&(y=this._enableBoxEditing(t,f,e)),(n&u)===u&&(h=this._enableVertexEditing(t)),(n&v)===v&&this._enableTextEditing(t),!(s||h||y))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");(this._tool=n)&&(this._mapPanEndHandle=r.connect(o,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=r.connect(o,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,t));o.snappingManager&&(s||h)&&o.snappingManager._startSelectionLayerQuery()},deactivate:function(){var n,t,i;if(this._isTextPoint=null,n=this._tool,t=this._graphic,n){i=!!this._modified;this._clear();r.disconnect(this._mapPanEndHandle);r.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(n,t,{isModified:i});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(){},onDeactivate:function(){},onGraphicMoveStart:function(){},onGraphicFirstMove:function(){this._modified=!0},onGraphicMove:function(){},onGraphicMoveStop:function(){},onGraphicClick:function(){},onVertexMoveStart:function(){},onVertexFirstMove:function(){this._modified=!0},onVertexMove:function(){},onVertexMoveStop:function(){},onVertexAdd:function(){this._modified=!0},onVertexClick:function(){},onVertexMouseOver:function(){},onVertexMouseOut:function(){},onVertexDelete:function(){this._modified=!0},onTextEditStart:function(){},onTextEditEnd:function(){},onScaleStart:function(){},onScaleFirstMove:function(){this._modified=!0},onScale:function(){},onScaleStop:function(){},onRotateStart:function(){},onRotateFirstMove:function(){this._modified=!0},onRotate:function(){},onRotateStop:function(){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(t,i){var r;if("point"===t.geometry.type||"multipoint"===t.geometry.type){var f=t.getLayer(),u=f.renderer,f=t.symbol||f._getSymbol(t);if(!f&&(u.hasVisualVariables("sizeInfo",!1)||u.hasVisualVariables("colorInfo",!1)||u.hasVisualVariables("opacityInfo",!1))&&u.addBreak&&u.infos&&1===u.infos.length&&(f=u.infos[0].symbol||u.defaultSymbol),f&&"textsymbol"===f.type)return((i&nt.SCALE)===nt.SCALE||(i&nt.ROTATE)===nt.ROTATE||(i&nt.EDIT_TEXT)===nt.EDIT_TEXT)&&(t.setSymbol(new d(f.toJson())),r=this,this._textSymbolEditor?(this._textSymbolEditor.createForm(t),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){r._boxEditor&&r._boxEditor.refresh()})):n(["../dijit/SymbolEditor"],function(n){if(!r._textSymbolEditor){var i;i=r._options.textSymbolEditorHolder?o.create("div",null,r._options.textSymbolEditorHolder):o.create("div",null,r._map.root);r._textSymbolEditor=new n({graphic:t},i);n=r._textSymbolEditor.domNode.parentNode.id;s.set(r._textSymbolEditor.domNode,{position:"map_root"===n?"absolute":"relative",left:"map_root"===n?r._map.width/2-100+"px":"5px",top:"20px","z-index":50});r._textSymbolEditor.startup();r._textSymbolEditor.createForm(t);r._textSymbolEditor.show();r._textSymbolEditor.on("symbol-change",function(){r._boxEditor&&r._boxEditor.refresh()})}})),((i&nt.MOVE)===nt.MOVE||(i&nt.ROTATE)===nt.ROTATE||(i&nt.SCALE)===nt.SCALE)&&(this._textAnchor=new g(t.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor)),!0}return!1},_enableMove:function(n){var t=this._map;switch(n.geometry.type){case"point":case"polyline":case"polygon":return this._graphicMover=new y(n,t,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(n){var t=this._map;switch(n.geometry.type){case"multipoint":case"polyline":case"polygon":return this._vertexEditor=p.create(n,t,this),!0}return!1},_enableBoxEditing:function(n,t,i){var u=this._map,r=n.geometry.type;return"polyline"===r||"polygon"===r||this._isTextPoint?(this._boxEditor=new v(n,u,this,t,i,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(n){return this._isTextPoint?(this._textEditor=new w(n,this._map,this),r.connect(this._textEditor,"onEditStart",i.hitch(this,function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var n=this._graphicMover;n&&(n.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var n=this._vertexEditor;n&&(n.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var n=this._boxEditor;n&&(n.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},_mapExtentChangeHandler:function(n,t,i){i&&this._refreshMoveables()},_refreshMoveables:function(n){var t=u.filter([this._graphicMover,this._vertexEditor,this._boxEditor],c.isDefined);u.forEach(t,function(t){t.refresh(n)})},_beginOperation:function(n){u.forEach(this._getAffectedTools(n),function(n){n.suspend()})},_endOperation:function(n){u.forEach(this._getAffectedTools(n),function(n){n.resume()})},_getAffectedTools:function(n){var t=[];switch(n){case"MOVE":t=[this._vertexEditor,this._boxEditor];break;case"VERTICES":t=[this._boxEditor];break;case"BOX":t=[this._vertexEditor]}return u.filter(t,c.isDefined)}});return i.mixin(nt,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16}),e("extend-esri")&&i.setObject("toolbars.Edit",nt,h),nt})},"esri/virtualearth/VEAddress":function(){define("esri/virtualearth/VEAddress",["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,t,i,r){return n=n(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(n){t.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},n)}}),i("extend-esri")&&t.setObject("virtualearth.VEAddress",n,r),n})},"esri/virtualearth/VEGeocodeResult":function(){define("esri/virtualearth/VEGeocodeResult","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),function(n,t,i,r,u,f,e){return n=n(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",constructor:function(n){t.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},n);this.address&&(this.address=new e(this.address));this.bestView&&(this.bestView=new f(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new u(this.locationArray[0]))}}),i("extend-esri")&&t.setObject("virtualearth.VEGeocodeResult",n,r),n})},"esri/virtualearth/VEGeocoder":function(){define("esri/virtualearth/VEGeocoder","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),function(n,t,i,r,u,f,e,o,s,h,c){return n=n(o,{declaredClass:"esri.virtualearth.VEGeocoder",constructor:function(n){try{if(n=t.mixin({bingMapsKey:null},n||{}),this.url=e.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=e.urlToObject(this.url),this._queue=[],this.bingMapsKey=n.bingMapsKey,this.culture=n.culture||"en-US",this._errorHandler=t.hitch(this,this._errorHandler),this._addressToLocationsHandler=t.hitch(this,this._addressToLocationsHandler),!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(i){throw this.onError(i),i;}},addressToLocations:function(n,i,u){if(this.bingMapsKey){var e=t.mixin({},this._url.query,{query:n,token:this.bingMapsKey,culture:this.culture}),o=this._addressToLocationsHandler,s=this._errorHandler,f=new r(h._dfdCanceller);return f._pendingDfd=c({url:this._url.path,content:e,callbackParamName:"callback",load:function(n,t){o(n,t,i,u,f)},error:function(n){s(n,u,f)}}),f}console.debug("Server token not retrieved. Queing request to be executed after server token retrieved.");this._queue.push(arguments)},_addressToLocationsHandler:function(n,t,r,u,f){try{i.forEach(n,function(t,i){n[i]=new s(t)});this._successHandler([n],"onAddressToLocationsComplete",r,f)}catch(e){this._errorHandler(e,u,f)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(n){this.bingMapsKey=n},setCulture:function(n){this.culture=n}}),u("extend-esri")&&t.setObject("virtualearth.VEGeocoder",n,f),n})},"esri/virtualearth/VETiledLayer":function(){define("esri/virtualearth/VETiledLayer","dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){return n=n(a,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(n){try{if(n=t.mixin({bingMapsKey:null,culture:"en-US"},n||{}),this.url=h.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=h.urlToObject(this.url),this.spatialReference=new c({wkid:102100}),this.tileInfo=new l({rows:256,cols:256,dpi:96,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.14929107082380849,scale:564.248588}]}),this.initialExtent=this.fullExtent=new v(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new c({wkid:102100})),t.mixin(this,n),this.hasAttributionData=this.showAttribution,this._initLayer=t.hitch(this,this._initLayer),this._errorHandler=t.hitch(this,this._errorHandler),this._getTileInfo=t.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");}catch(i){throw this.onError(i),i;}},_unsetMap:function(){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){var i,r,n;this.mapStyle&&(i=this._url.path+"/Imagery/Metadata/"+this.mapStyle,r=window.location.protocol,this.bingMapsKey&&(n=this.resourceInfo,!this.loaded&&n?this._initLayer(n):y({url:i,content:t.mixin({},{uriScheme:"https:"===r?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})))},_initLayer:function(n){var t,f,u;if(200!==n.statusCode){t=Error();t.code=n.statusCode;t.message=n.statusDescription;t.details=n.errorDetails;t.authenticationResultCode=n.authenticationResultCode;this.onError(t)}else try{if(this.resourceInfo=i.toJson(n),t=n.resourceSets[0].resources[0],f=t.imageUrl.replace("{","${"),this.tileServers=r.map(t.imageUrlSubdomains,function(n){var t=h.getProtocolForWebResource();return e.substitute(f,{subdomain:n}).replace("http:",t)}),this._tsLength=this.tileServers.length,this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"&copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);u=this.loadCallback;u&&(delete this.loadCallback,u(this))}}catch(o){this.onError(o)}},getAttributionData:function(){var r=new o,n=i.fromJson(this.resourceInfo),f;return this.hasAttributionData&&n&&(f=t.getObject("resourceSets.0.resources.0.imageryProviders",!1,n)),f?r.callback({contributors:f}):(n=Error("Layer does not have attribution data"),n.log=u.isDebug,r.errback(n)),r},getTileUrl:function(n,t,i){return e.substitute(this.tileServers[t%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(n,t,i),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(n,t,i){for(var f="",u,r=n;0<r;r--)n="0",u=1<<r-1,0!=(i&u)&&n++,0!=(t&u)&&(n++,n++),f+=n;return f},setMapStyle:function(n){this.mapStyle=n;this._getTileInfo()},setCulture:function(n){this.culture=n;this._getTileInfo()},setBingMapsKey:function(n){this.bingMapsKey=n},onMapStyleChange:function(){}}),t.mixin(n,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"roadOnDemand"}),f("extend-esri")&&t.setObject("virtualearth.VETiledLayer",n,s),n})}}});define("esri/jsapi","dojo/fx/Toggler dojo/_base/html dijit/_base/manager ./main ./map ./geometry ./symbol ./renderer ./utils ./layers/graphics ./layers/agstiled ./layers/agsdynamic".split(" "),function(){return{}});