// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.20/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(A,q,x,D,E,F,n,f,a,c,g,e,d,b,k,h,p){A=A(null,{declaredClass:"esri.PopupInfo",initialize:function(l,a){if(l){q.mixin(this,a);this.info=l;this.title=this.getTitle;
this.content=this.getContent;var b=this._fieldLabels={},m=this._fieldsMap={};l.fieldInfos&&x.forEach(l.fieldInfos,function(a){var l=a.fieldName.toLowerCase();b[l]=a.label;m[l]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!(!l.title||-1===l.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return D.fromJson(D.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var l;x.some(this.info&&this.info.fieldInfos,function(b){b.fieldName===
a&&(l=b);return!!l});return l},getComponents:function(a){var l=this.info,b=new n,c,d;l.fieldInfos&&(d=x.filter(l.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));d&&0<d.length&&(c=this._getRelatedRecords({graphic:a,fieldsInfo:d}));c?c.always(q.hitch(this,function(){b.resolve(this._getPopupValues(a))})):b.resolve(this._getPopupValues(a));return b.promise},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&b&&b.hasAttachments&&
b.objectIdField&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_getPopupValues:function(a,b){var l=this.info,m=a.getLayer(),d=q.clone(a.attributes)||{},e=q.clone(d),f=l.fieldInfos,k="",t="",v,y,h,g,p,n=m&&m._getDateOpts&&m._getDateOpts().properties,n=n&&n.slice(0),G={dateFormat:{properties:n,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(g in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(g)){var I=this._relatedInfo[g],
A=this._relatedLayersInfo[g];I&&(x.forEach(I.relatedFeatures,function(a){for(p in a.attributes)if(a.attributes.hasOwnProperty(p)&&"esriRelCardinalityOneToOne"===A.relation.cardinality){var b=this._toRelatedFieldName([A.relation.id,p]);d[b]=e[b]=a.attributes[p]}},this),x.forEach(I.relatedStatsFeatures,function(a){for(p in a.attributes)if(a.attributes.hasOwnProperty(p)){var b=this._toRelatedFieldName([A.relation.id,p]);d[b]=e[b]=a.attributes[p]}},this))}f&&x.forEach(f,function(a){y=a.fieldName;var b=
this._getLayerFieldInfo(m,y);b&&(y=a.fieldName=b.name);e[y]=this._formatValue(e[y],y,G);n&&a.format&&a.format.dateFormat&&(a=x.indexOf(n,y),-1<a&&n.splice(a,1))},this);if(m){g=m.types;var E=(I=m.typeIdField)&&d[I];for(y in d)if(d.hasOwnProperty(y)&&-1===y.indexOf(this._relatedFieldPrefix)&&(h=d[y],c.isDefined(h))){var F=this._getDomainName(m,a,g,E,y,h);c.isDefined(F)?e[y]=F:y===I&&(F=this._getTypeName(m,a,h),c.isDefined(F)&&(e[y]=F))}}l.title&&(k=this._processFieldsInLinks(this._fixTokens(l.title,
m),d),k=q.trim(c.substitute(e,k,G)||""));if(b)return{title:k};l.description&&(t=this._processFieldsInLinks(this._fixTokens(l.description,m),d),t=q.trim(c.substitute(e,t,G)||""));f&&(v=[],x.forEach(f,function(a){(y=a.fieldName)&&a.visible&&v.push([a.label||y,c.substitute(e,"${"+y+"}",G)||""])}));var D,L;l.mediaInfos&&(D=[],x.forEach(l.mediaInfos,function(a){L=0;h=a.value;switch(a.type){case "image":var b=h.sourceURL,b=b&&q.trim(c.substitute(d,this._fixTokens(b,m)));L=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":var l,
b=h.normalizeField;h.fields=x.map(h.fields,function(a){return(l=this._getLayerFieldInfo(m,a))?l.name:a},this);b&&(l=this._getLayerFieldInfo(m,b),h.normalizeField=l?l.name:b);L=x.some(h.fields,function(a){return c.isDefined(d[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(L){a=q.clone(a);h=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title,m),d):"",t=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,m),d):"";a.title=
b?q.trim(c.substitute(e,b,G)||""):"";a.caption=t?q.trim(c.substitute(e,t,G)||""):"";if("image"===a.type)h.sourceURL=c.substitute(d,this._fixTokens(h.sourceURL,m)),h.linkURL&&(h.linkURL=q.trim(c.substitute(d,this._fixTokens(h.linkURL,m))||""));else{var f,k;x.forEach(h.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))k=this._getRelatedChartInfos(a,h,d,G),k instanceof Array?h.fields=k:h.fields[b]=k;else{var l=d[a],l=void 0===l?null:l;f=d[h.normalizeField]||0;l&&f&&(l/=f);h.fields[b]=
{y:l,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(l,a,G,!!f)}}},this)}D.push(a)}},this));return{title:k,description:t,hasDescription:!!l.description,fields:v&&v.length?v:null,mediaInfos:D&&D.length?D:null,formatted:e,editSummary:m&&m.getEditSummary?m.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,d,e){var l,m,f,k,t,h;l=[];h=this._fromRelatedFieldName(a);t=h[0];m=this._relatedInfo[t];t=this._relatedLayersInfo[t];m&&x.forEach(m.relatedFeatures,function(t){t=
t.attributes;var m,g;for(g in t)if(t.hasOwnProperty(g)&&g===h[1]){m={};k=t[g];b.normalizeField&&(f=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?t[this._fromRelatedFieldName(b.normalizeField)[1]]:d[b.normalizeField]);k&&f&&(k/=f);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var v=this._fromRelatedFieldName(b.tooltipField)[1],y=c.isDefined(t[v])?t[v]:v;m.tooltip=y+":\x3cbr/\x3e"+this._formatValue(k,v,e,!!f)}else m.tooltip=(this._fieldLabels[a.toLowerCase()]||
a)+":\x3cbr/\x3e"+this._formatValue(k,b.tooltipField,e,!!f);else m.tooltip=k;m.y=k;l.push(m)}},this);return"esriRelCardinalityOneToMany"===t.relation.cardinality||"esriRelCardinalityManyToMany"===t.relation.cardinality?l:l[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",
shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(a,b){var l=this;return a.replace(/(\{([^\{\r\n]+)\})/g,
function(a,m,d){a=l._getLayerFieldInfo(b,d);return"$"+(a?"{"+a.name+"}":m)})},_encodeAttributes:function(a){a=q.clone(a)||{};var b,l;for(b in a)(l=a[b])&&"string"===typeof l&&(l=encodeURIComponent(l).replace(/\'/g,"\x26apos;"),a[b]=l);return a},_processFieldsInLinks:function(a,b){var l=this._encodeAttributes(b),d=this;a&&(a=a.replace(this._reHref,function(a,c){return d._addValuesToHref(a,c,b,l)}).replace(this._reHrefApos,function(a,c){return d._addValuesToHref(a,c,b,l)}));return a},_addValuesToHref:function(a,
b,d,e){b=b&&q.trim(b);return c.substitute(b&&0===b.indexOf("${")?d:e,a)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(a,b,d,e){var l=this._fieldsMap[b.toLowerCase()],f=l&&l.format;b=-1!==x.indexOf(d.dateFormat.properties,b);var m="number"===typeof a&&!b&&(!f||!f.dateFormat);if(!c.isDefined(a)||!l||!c.isDefined(f))return m?this._forceLTR(a):a;var k="",l=[],t=f.hasOwnProperty("places")||f.hasOwnProperty("digitSeparator"),h=f.hasOwnProperty("digitSeparator")?
f.digitSeparator:!0;if(t&&!b)k="NumberFormat",l.push("places: "+(c.isDefined(f.places)&&(!e||0<f.places)?Number(f.places):"Infinity")),l.length&&(k+="("+l.join(",")+")");else if(f.dateFormat)k="DateFormat"+this._insertOffset(this._dateFormats[f.dateFormat]||this._dateFormats.shortDateShortTime);else return m?this._forceLTR(a):a;var g=this._applyFormatting(a,k,d);t&&-1<a.constructor.toString().indexOf("Array")&&(g="",x.forEach(a,q.hitch(this,function(a,b){b&&(g+=" ");g+=this._applyFormatting(a,k,d)})));
t&&!h&&p.group&&(g=g.replace(new RegExp("\\"+p.group,"g"),""));b&&(g='\x3cspan class\x3d"esriDateValue"\x3e'+g+"\x3c/span\x3e");return m?this._forceLTR(g):g},_applyFormatting:function(a,b,d){return c.substitute({myKey:a},"${myKey:"+b+"}",d)||""},_forceLTR:function(a){var b=f("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=c.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,
b,d,c,f,e){return(a=a.getDomain&&a.getDomain(f,{feature:b}))&&a.codedValues?a.getName(e):null},_getTypeName:function(a,b,d){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,d=new n,c;this._relatedLayersInfo?this._queryRelatedLayers(b).then(q.hitch(this,function(a){this._setRelatedRecords(b,a);d.resolve(a)}),q.hitch(this,this._handlerErrorResponse,d)):this._getRelatedLayersInfo(a).then(q.hitch(this,function(a){for(c in a)a.hasOwnProperty(c)&&a[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=
a[c]);this._queryRelatedLayers(b).then(q.hitch(this,function(a){this._setRelatedRecords(b,a);d.resolve(a)}),q.hitch(this,this._handlerErrorResponse,d))}),q.hitch(this,this._handlerErrorResponse,d));return d.promise},_getRelatedLayersInfo:function(b){var d=b.fieldsInfo,c,f,l={};c=b.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});x.forEach(d,function(a){var b,d,t,f;b=this._fromRelatedFieldName(a.fieldName);d=b[0];b=b[1];d&&(this._relatedLayersInfo[d]||(x.some(c.relationships,
function(a){if(a.id==d)return f=a,!0}),f&&(this._relatedLayersInfo[d]={relation:f,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[d]&&(this._relatedLayersInfo[d].relatedFields.push(b),a.statisticType&&(t=new h,t.statisticType=a.statisticType,t.onStatisticField=b,t.outStatisticFieldName=b,this._relatedLayersInfo[d].outStatistics.push(t))))},this);for(f in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(f)&&this._relatedLayersInfo[f]&&(b=this._relatedLayersInfo[f].relation,
b=c.url.replace(/[0-9]+$/,b.relatedTableId),this._relatedLayersInfo[f].relatedLayerUrl=b,l[f]=e({url:b,content:{f:"json"},callbackParamName:"callback"}));return a(l)},_queryRelatedLayers:function(b){var d={},c;for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&(d[c]=this._queryRelatedLayer({graphic:b,relatedInfo:this._relatedLayersInfo[c]}));return a(d)},_queryRelatedLayer:function(c){var f,e,l,k,h,g,p,t,v,y,C,M,H;f=c.graphic;e=f.getLayer();l=e.url.match(/[0-9]+$/g)[0];C=
c.relatedInfo;y=C.relatedLayerInfo;M=C.relatedLayerUrl;c=C.relation;x.some(y.relationships,function(a){if(a.relatedTableId===parseInt(l,10))return k=a,!0},this);k&&(h=new d,x.some(y.fields,function(a){if(a.name===k.keyField)return t=-1!==x.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),k.relationshipTableId&&k.keyFieldInRelationshipTable?(H=new n,this._queryRelatedRecords(f,k).then(q.hitch(this,function(a){var c;
c=a[f.attributes[e.objectIdField]];a=x.map(c.features,function(a){return a.attributes[y.objectIdField]},this);C.outStatistics&&0<C.outStatistics.length&&y.supportsStatistics&&(v=new d,v.objectIds=a,v.outFields=h.outFields,v.outStatistics=C.outStatistics);v&&(g=new b(M),g.execute(v).then(q.hitch(this,function(a){var b=[];b.push(c);b.push(a);H.resolve(b)})))}))):(p="string"===t?k.keyField+"\x3d'"+f.attributes[c.keyField]+"'":k.keyField+"\x3d"+f.attributes[c.keyField],h.where=p,h.outFields=C.relatedFields,
C.outStatistics&&0<C.outStatistics.length&&y.supportsStatistics&&(v=new d,v.where=h.where,v.outFields=h.outFields,v.outStatistics=C.outStatistics),g=new b(M),p=[],p.push(g.execute(h)),v&&p.push(g.execute(v))));return p?a(p):H?H.promise:void 0},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var d in b)if(b.hasOwnProperty(d)&&b[d]){var f=b[d];this._relatedInfo[d]={};this._relatedInfo[d].relatedFeatures=f[0].features;c.isDefined(f[1])&&(this._relatedInfo[d].relatedStatsFeatures=f[1].features)}},
_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b},_queryRelatedRecords:function(a,b){var d=a.getLayer(),c=new k;c.outFields=["*"];c.relationshipId=b.id;c.objectIds=[a.attributes[d.objectIdField]];return d.queryRelatedFeatures(c)}});F("extend-esri")&&(g.PopupInfo=g.PopupInfoTemplate=
A);return A})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(A,q,x,D,E,F,n,f,a,c,g,e,d){A=A(e,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},
constructor:function(a,d){this._handler=q.hitch(this,this._handler);this._relationshipQueryHandler=q.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=q.hitch(this,this._executeForIdsHandler);this._countHandler=q.hitch(this,this._countHandler);this._extentHandler=q.hitch(this,this._extentHandler);this.source=d&&d.source;this.gdbVersion=d&&d.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(a,d,c,e,l){var b=l.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json"},a.toJson(b&&b[0])));var k=this._handler,h=this._errorHandler;this.source&&(b={source:this.source.toJson()},
a.layer=E.toJson(b));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return f({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,b){k(a,b,d,c,l.dfd)},error:function(a){h(a,c,l.dfd)},callbackSuffix:e},this.requestOptions)},executeRelationshipQuery:function(b,d,c){b=this._encode(q.mixin({},this._url.query,{f:"json"},b.toJson()));var e=this._relationshipQueryHandler,k=this._errorHandler;this.gdbVersion&&(b.gdbVersion=this.gdbVersion);var h=new D(a._dfdCanceller);h._pendingDfd=
f({url:this._url.path+"/queryRelatedRecords",content:b,callbackParamName:"callback",load:function(a,b){e(a,b,d,c,h)},error:function(a){k(a,c,h)}},this.requestOptions);return h},executeForIds:function(a,d,c,e){var b=e.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(b&&b[0])));var k=this._executeForIdsHandler,h=this._errorHandler;this.source&&(b={source:this.source.toJson()},a.layer=E.toJson(b));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return f({url:this._url.path+
"/query",content:a,callbackParamName:"callback",load:function(a,b){k(a,b,d,c,e.dfd)},error:function(a){h(a,c,e.dfd)}},this.requestOptions)},executeForCount:function(a,d,c,e){var b=e.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(b&&b[0])));var k=this._countHandler,h=this._errorHandler;this.source&&(b={source:this.source.toJson()},a.layer=E.toJson(b));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return f({url:this._url.path+"/query",content:a,
callbackParamName:"callback",load:function(a,b){k(a,b,d,c,e.dfd)},error:function(a){h(a,c,e.dfd)}},this.requestOptions)},executeForExtent:function(a,d,c,e){var b=e.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(b&&b[0])));var k=this._extentHandler,h=this._errorHandler;this.source&&(b={source:this.source.toJson()},a.layer=E.toJson(b));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return f({url:this._url.path+"/query",content:a,callbackParamName:"callback",
load:function(a,b){k(a,b,d,c,e.dfd)},error:function(a){h(a,c,e.dfd)}},this.requestOptions)},_handler:function(a,c,f,e,l){try{var b=new d(a);this._successHandler([b],"onComplete",f,l)}catch(B){this._errorHandler(B,e,l)}},_relationshipQueryHandler:function(a,c,f,e,l){try{var b=a.geometryType,k=a.spatialReference,h={};x.forEach(a.relatedRecordGroups,function(a){var c={};c.geometryType=b;c.spatialReference=k;c.features=a.relatedRecords;c=new d(c);if(null!=a.objectId)h[a.objectId]=c;else for(var f in a)a.hasOwnProperty(f)&&
"relatedRecords"!==f&&(h[a[f]]=c)});this._successHandler([h],"onExecuteRelationshipQueryComplete",f,l)}catch(r){this._errorHandler(r,e,l)}},_executeForIdsHandler:function(a,d,c,f,e){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",c,e)}catch(m){this._errorHandler(m,f,e)}},_countHandler:function(a,d,c,f,e){try{var b,k=a.features,h=a.objectIds;if(h)b=h.length;else{if(k)throw Error("Unable to perform query. Please check your parameters.");b=a.count}this._successHandler([b],"onExecuteForCountComplete",
c,e)}catch(r){this._errorHandler(r,f,e)}},_extentHandler:function(a,d,f,e,g){try{a.extent&&(a.extent=new c(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",f,g)}catch(m){this._errorHandler(m,e,g)}}});g._createWrappers(A);F("extend-esri")&&q.setObject("tasks.QueryTask",A,n);return A})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(A,q,x,D,E,F,n,f){A=A(f,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(a,c){a&&q.isString(a)&&(this._url=n.urlToObject(this.url=a));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;this._errorHandler=q.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));a&&a.path&&(a.path=a.path.replace(c,"https:"))},_encode:function(a,c,f){var e,d,b={},k,h;for(k in a)if("declaredClass"!==
k&&(e=a[k],d=typeof e,null!==e&&void 0!==e&&"function"!==d))if(q.isArray(e))for(b[k]=[],h=e.length,d=0;d<h;d++)b[k][d]=this._encode(e[d]);else"object"===d?e.toJson&&(d=e.toJson(f&&f[k]),"esri.tasks.FeatureSet"===e.declaredClass&&d.spatialReference&&(d.sr=d.spatialReference,delete d.spatialReference),b[k]=c?d:x.toJson(d)):b[k]=e;return b},_successHandler:function(a,c,f,e){c&&this[c].apply(this,a);f&&f.apply(null,a);e&&F._resDfd(e,a)},_errorHandler:function(a,c,f){this.onError(a);c&&c(a);f&&f.errback(a)},
setNormalization:function(a){this.normalization=a},onError:function(){}});D("extend-esri")&&(E.Task=A);return A})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(A,q,x,D,E,F,n,f,a,c,g){A=A(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){q.mixin(this,a);var d=this.features,b=a.spatialReference,
e=c.getGeometryType(a.geometryType),b=this.spatialReference=new f(b);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);x.forEach(d,function(a,c){var f=a.geometry&&a.geometry.spatialReference;d[c]=new n(e&&a.geometry?new e(a.geometry):null,a.symbol&&g.fromJson(a.symbol),a.attributes);d[c].geometry&&!f&&d[c].geometry.setSpatialReference(b)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(f){var d=
{};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=c.getJsonType(this.features[0].geometry)),d.features=a._encodeGraphics(this.features,f));d.exceededTransferLimit=this.exceededTransferLimit;d.transform=
this.transform;return F.fixJson(d)},_hydrate:function(){var a=this.transform,c=this.geometryType;if(a&&c)for(var b=this.features,f=a.translate[0],h=a.translate[1],g=a.scale[0],l=a.scale[1],m=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,f,e,k,h,g,l,m;d=0;for(f=a.length;d<f;d++)for(h=a[d],e=0,k=h.length;e<k;e++)g=h[e],0<e?(l+=g[0],m+=g[1]):(l=g[0],m=g[1]),g[0]=
b(l),g[1]=c(m)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,f,e,k,h;d=0;for(f=a.length;d<f;d++)e=a[d],0<d?(k+=e[0],h+=e[1]):(k=e[0],h=e[1]),e[0]=b(k),e[1]=c(h)}}(c,function(a){return a*g+f},function(a){return h-a*l}),a=0,c=b.length;a<c;a++)b[a].geometry&&m(b[a].geometry);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,
this;var c=a.translate[0],b=a.translate[1],f=a.scale[0],e=a.scale[1],g=this.features,l=function(a,b,c){var d,f,e,k,h,g,l=[];d=0;for(f=a.length;d<f;d++)if(e=a[d],0<d){if(g=b(e[0]),e=c(e[1]),g!==k||e!==h)l.push([g-k,e-h]),k=g,h=e}else k=b(e[0]),h=c(e[1]),l.push([k,h]);return 0<l.length?l:null},m=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,f,e,k,h;e=a.rings||a.paths;h=[];
d=0;for(f=e.length;d<f;d++)k=e[d],(k=l(k,b,c))&&h.push(k);return 0<h.length?(a.rings?a.rings=h:a.paths=h,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=l(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-c)/f)},function(a){return Math.round((b-a)/e)}),n,u;n=0;for(u=g.length;n<u;n++)g[n].geometry&&(m(g[n].geometry)||g[n].setGeometry(null));this.transform=a;return this}});
D("extend-esri")&&q.setObject("tasks.FeatureSet",A,E);return A})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(A,q,x,D,E){A=A(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var q={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,
maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},n=this.objectIds,f=this.outFields,a=this.outSpatialReference;n&&(q.objectIds=n.join(","));f&&(q.outFields=f.join(","));a&&(q.outSR=a.wkid||x.toJson(a.toJson()));q._ts=this._ts;return q}});D("extend-esri")&&q.setObject("tasks.RelationshipQuery",A,E);return A})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(A,q,x,D){A=A(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});x("extend-esri")&&q.setObject("tasks.StatisticDefinition",A,D);return A})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),
function(A,q,x,D,E,F){A=A(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(n,f){this._labelLayer=f;this._xmin=n.extent.xmin;this._xmax=n.extent.xmax;this._ymin=n.extent.ymin;this._ymax=n.extent.ymax;this._scale=(this._xmax-this._xmin)/n.width},_process:function(n){this._preparedLabels=
n;this._placedLabels=[];var f;for(n=this._preparedLabels.length-1;0<=n;n--){var a=this._preparedLabels[n],c=Math.min(a.labelWidth,a.labelHeight),g=a.labelWidth+0*c,c=a.labelHeight+0*c,e=(f=a.options)&&void 0!==f.lineLabelPlacement?f.lineLabelPlacement:"PlaceAtCenter",d=f&&void 0!==f.lineLabelPosition?f.lineLabelPosition:"Above",b=f&&void 0!==f.pointPriorities?f.pointPriorities:"AboveRight",k=[2,2,1,3,0,2,3,3,2];"AboveLeft"==b?k=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==b?k=[2,1,2,2,0,2,3,3,3]:"AboveRight"==
b?k=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==b?k=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==b?k=[0,0,0,0,1,0,0,0,0]:"CenterRight"==b?k=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==b?k=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==b?k=[3,3,3,2,0,2,2,1,2]:"BelowRight"==b&&(k=[3,3,2,3,0,2,2,2,1]);var h=f&&void 0!==f.labelRotation?f.labelRotation:!0,b=Math.PI/180*a.angle;f=f&&void 0!==f.howManyLabels?f.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,b,g,c,a.symbolWidth,
a.symbolHeight,k);else if("multipoint"==a.geometry.type)for(e=a.geometry,d=0;d<e.points.length;d++)this._generatePointPositions(a,e.points[d][0],e.points[d][1],a.text,b,g,c,a.symbolWidth,a.symbolHeight,k);else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,g,c,2*a.symbolHeight+c,e,d,h):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,f,a.geometry,a.text,b,g,c)}return this._placedLabels},_generatePointPositions:function(n,f,a,c,g,e,d,b,k,h){b=(b+e)*this._scale;
k=(k+d)*this._scale;var p,l;for(p=1;3>=p;p++)for(l=1;9>=l;l++)if(h[l-1]==p)switch(l){case 1:if(this._findPlace(n,c,f-b,a+k,g,e,d))return;break;case 2:if(this._findPlace(n,c,f,a+k,g,e,d))return;break;case 3:if(this._findPlace(n,c,f+b,a+k,g,e,d))return;break;case 4:if(this._findPlace(n,c,f-b,a,g,e,d))return;break;case 5:if(this._findPlace(n,c,f,a,g,e,d))return;break;case 6:if(this._findPlace(n,c,f+b,a,g,e,d))return;break;case 7:if(this._findPlace(n,c,f-b,a-k,g,e,d))return;break;case 8:if(this._findPlace(n,
c,f,a-k,g,e,d))return;break;case 9:if(this._findPlace(n,c,f+b,a-k,g,e,d))return}},_generateLinePositions:function(n,f,a,c,g,e,d,b,k){var h=c*this._scale*c*this._scale,p,l,m;for(p=0;p<f.paths.length;p++){var B=f.paths[p],u=B.length,r=Math.floor((u-1)/2),J=0!==(u-1)%2?1:-1;"PlaceAtStart"==d&&(r=0,J=1);"PlaceAtEnd"==d&&(r=u-2,J=-1);for(;0<=r&&r<u-1;){for(l=r;l<u;l++){var z=B[r][0],w=B[r][1],t=B[l][0]-z,v=B[l][1]-w;if(t*t+v*v>h){for(var y=Math.atan2(v,t);y>Math.PI/2;)y-=Math.PI;for(;y<-(Math.PI/2);)y+=
Math.PI;var C=Math.sin(y),q=Math.cos(y),H=0,K=0;"Above"==b&&(H=e*C*this._scale,K=e*q*this._scale);"Below"==b&&(H=-e*C*this._scale,K=-e*q*this._scale);if(1==l-r){if(this._clipLine(z,w,B[l][0],B[l][1])&&(z=this._x1-this._x0,m=this._y1-this._y0,z*z+m*m>h&&(l=Math.atan2(m,z),t=c/2+2*g,w=t*this._scale*Math.cos(l),t=t*this._scale*Math.sin(l),"PlaceAtStart"==d?(z=this._x0+w,m=this._y0+t):"PlaceAtEnd"==d?(z=this._x1-w,m=this._y1-t):(z=this._x0+z/2,m=this._y0+m/2),this._findPlace(n,a,z-H,m+K,k?-l:0,c,g))))return}else{var G=
0;for(m=r;m<=l;m++)G=Math.max(G,Math.abs((B[m][1]-w)*q-(B[m][0]-z)*C));if(G<g&&this._findPlace(n,a,z+t/2-H,w+v/2+K,k?-y:0,c,g))return}break}}r+=J}}},_generatePolygonPositions:function(n,f,a,c,g,e,d){var b;if("ManyLabels"==f)for(f=0;f<a.rings.length;f++)b=a.rings[f],F.prototype.isClockwise(b)&&(b=this._findCentroid(b,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(n,c,b[0],b[1],g,e,d));else{b=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var k=b[1],h=0;for(f=
0;10>f;f++){h+=d/4;b=this._findCentroidForFeature(a,this._xmin,k+(h-d/4),this._xmax,k+(h+d/4));if(this._findPlace(n,c,b[0],b[1],g,e,d))break;b=this._findCentroidForFeature(a,this._xmin,k-(h+d/4),this._xmax,k-(h-d/4));if(this._findPlace(n,c,b[0],b[1],g,e,d))break}}},_findCentroid:function(n,f,a,c,g){var e=n.length,d=[0,0],b=0,k=n[0][0],h=n[0][1];k>c&&(k=c);k<f&&(k=f);h>g&&(h=g);h<a&&(h=a);for(var p=1;p<e-1;p++){var l=n[p][0],m=n[p][1],B=n[p+1][0],u=n[p+1][1];l>c&&(l=c);l<f&&(l=f);m>g&&(m=g);m<a&&(m=
a);B>c&&(B=c);B<f&&(B=f);u>g&&(u=g);u<a&&(u=a);var r=(l-k)*(u-h)-(B-k)*(m-h);d[0]+=r*(k+l+B);d[1]+=r*(h+m+u);b+=r}d[0]/=3*b;d[1]/=3*b;if(isNaN(d[0])||isNaN(d[1]))return d;a=[];this._fillBuffer(n,a,d);d[0]=this._sortBuffer(a,d[0],f,c);return d},_findCentroidForFeature:function(n,f,a,c,g){for(var e,d=0,b=[0,0],k=0;k<n.rings.length;k++){var h=n.rings[k],p=h.length,l=h[0][0],m=h[0][1];l>c&&(l=c);l<f&&(l=f);m>g&&(m=g);m<a&&(m=a);for(e=1;e<p-1;e++){var B=h[e][0],u=h[e][1],r=h[e+1][0],q=h[e+1][1];B>c&&(B=
c);B<f&&(B=f);u>g&&(u=g);u<a&&(u=a);r>c&&(r=c);r<f&&(r=f);q>g&&(q=g);q<a&&(q=a);var z=(B-l)*(q-m)-(r-l)*(u-m);b[0]+=z*(l+B+r);b[1]+=z*(m+u+q);d+=z}}b[0]/=3*d;b[1]/=3*d;if(isNaN(b[0])||isNaN(b[1]))return b;a=[];for(e=0;e<n.rings.length;e++)this._fillBuffer(n.rings[e],a,b);b[0]=this._sortBuffer(a,b[0],f,c);return b},_fillBuffer:function(n,f,a){for(var c=n.length-1,g=n[0][1]>=n[c][1]?1:-1,e=0;e<=c;e++){var d=e,b=e+1;e==c&&(b=0);var k=n[d][0],d=n[d][1],h=n[b][0],b=n[b][1],p=b>=d?1:-1;if(d<=a[1]&&a[1]<=
b||b<=a[1]&&a[1]<=d)a[1]!=d&&a[1]!=b?(f.push((a[1]-d)*(h-k)/(b-d)+k),g=p):a[1]==d&&a[1]!=b?(g!=p&&f.push(k),g=p):a[1]!=d&&a[1]==b?(f.push(h),g=p):a[1]==d&&a[1]==b&&(1==g&&f.push(k),f.push(h),g=p)}},_sortBuffer:function(n,f,a,c){var g=n.length;n.sort();if(0<g){for(var e=0,d=f=0;d<g-1;d+=2){var b=Math.abs(n[d+1]-n[d]);!(n[d]<=a&&n[d+1]<=a||n[d]>=c&&n[d+1]>=c)&&b>e&&(e=b,f=d)}g=n[f];n=n[f+1];g>c&&(g=c);g<a&&(g=a);n>c&&(n=c);n<a&&(n=a);f=(g+n)/2}return f},_findPlace:function(n,f,a,c,g,e,d){if(isNaN(a)||
isNaN(c))return!1;for(var b=0;b<this._placedLabels.length;b++){var k=this._placedLabels[b].angle,h=this._placedLabels[b].width*this._scale,p=this._placedLabels[b].height*this._scale,l=this._placedLabels[b].x-a,m=this._placedLabels[b].y-c;if(0===g&&0===k){if(this._findPlace2(-e*this._scale,-d*this._scale,e*this._scale,d*this._scale,l-h,m-p,l+h,m+p))return!1}else{var B=new E(-e*this._scale,-d*this._scale,e*this._scale,d*this._scale,null),u=0,r=1;0!==g&&(u=Math.sin(g),r=Math.cos(g));var q=l*r-m*u,l=
l*u+m*r,k=k-g,u=Math.sin(k),r=Math.cos(k),z=-h*r- -p*u,m=-h*u+-p*r,k=+h*r- -p*u,w=+h*u+-p*r,h=q+z,p=l-m,u=q+k,r=l-w,z=q-z,m=l+m,q=q-k,l=l+w,k=new F;k.addRing([[h,p],[u,r],[z,m],[q,l],[h,p]]);if(B.intersects(k))return!1}}for(;g>Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;b={};b.layer=n;b.text=f;b.angle=g;b.x=a;b.y=c;b.width=e;b.height=d;this._placedLabels.push(b);return!0},_findPlace2:function(n,f,a,c,g,e,d,b){return(n>=g&&n<=d||a>=g&&a<=d||n<=g&&a>=d)&&(f>=e&&f<=b||c>=e&&c<=b||f<=e&&c>=
b)?!0:!1},_clipLine:function(n,f,a,c){for(var g=this._code(n,f),e=this._code(a,c);0!==g||0!==e;){if(0!==(g&e))return!1;var d=a-n,b=c-f;0!==g?(n<this._xmin?(f+=b*(this._xmin-n)/d,n=this._xmin):n>this._xmax?(f+=b*(this._xmax-n)/d,n=this._xmax):f<this._ymin?(n+=d*(this._ymin-f)/b,f=this._ymin):f>this._ymax&&(n+=d*(this._ymax-f)/b,f=this._ymax),g=this._code(n,f)):(a<this._xmin?(c+=b*(this._xmin-a)/d,a=this._xmin):a>this._xmax?(c+=b*(this._xmax-a)/d,a=this._xmax):c<this._ymin?(a+=d*(this._ymin-c)/b,c=
this._ymin):c>this._ymax&&(a+=d*(this._ymax-c)/b,c=this._ymax),e=this._code(a,c))}this._x0=n;this._y0=f;this._x1=a;this._y1=c;return!0},_code:function(n,f){var a=0;n<this._xmin&&(a+=8);n>this._xmax&&(a+=4);f<this._ymin&&(a+=2);f>this._ymax&&(a+=1);return a}});x("extend-esri")&&q.setObject("layers.labelLayerUtils.DynamicLabelClass",A,D);return A})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),
function(A,q,x,D,E,F,n){return A(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(f,a){this._labelLayer=a;this._map=f;this._xmin=f.extent.xmin;this._xmax=f.extent.xmax;this._ymin=f.extent.ymin;this._ymax=f.extent.ymax;this._scale=
(this._xmax-this._xmin)/f.width},_process:function(f){var a,c,g,e,d,b,k,h,p;this._preparedLabels=f;this._placedLabels=[];for(f=this._preparedLabels.length-1;0<=f;f--){a=this._preparedLabels[f];d=a.labelWidth;b=a.labelHeight;h=(k=a.options)&&k.lineLabelPlacement?k.lineLabelPlacement:"PlaceAtCenter";p=k&&k.lineLabelPosition?k.lineLabelPosition:"Above";c=k&&k.labelRotation?k.labelRotation:!0;g=Math.PI/180*a.angle;e=k&&k.howManyLabels?k.howManyLabels:"OneLabel";var l=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,
a.geometry.y,a.text,g,d,b,a.symbolWidth,a.symbolHeight,k,l);else if("multipoint"===a.geometry.type)for(c=0;c<a.geometry.points.length;c++)this._generatePointPositions(a.geometry.points[c][0],a.geometry.points[c][1],a.text,g,d,b,a.symbolWidth,a.symbolHeight,k,l);else if("polyline"===a.geometry.type)if("PlaceAtStart"===h)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,d,b,2*a.symbolHeight+b,h,p,c,l);else if("PlaceAtEnd"===h)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,d,b,
2*a.symbolHeight+b,h,p,c,l);else{k=[];var m=a.geometry.getExtent(),B=this._map.extent;if(m.getWidth()<d*this._scale/this._OVERRUN&&m.getHeight()<d*this._scale/this._OVERRUN)continue;else.5*m.getWidth()<B.getWidth()&&.5*m.getHeight()<B.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,d,b,2*a.symbolHeight+b,h,p,c,k):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,
a.text,d,b,2*a.symbolHeight+b,h,p,c,k);this._postSorting(B,k,l)}else if("polygon"===a.geometry.type){h=[];for(c=0;c<a.geometry.rings.length;c++)p=a.geometry.rings[c],1<a.geometry.rings.length&&!n.prototype.isClockwise(p)||(k=this._calcRingExtent(p),k.xmax-k.xmin<4*d*this._scale/this._OVERRUN&&k.ymax-k.ymin<4*b*this._scale/this._OVERRUN||h.push(p));h.sort(function(a,b){return b.length-a.length});for(c=0;c<h.length;c++)this._generatePolygonPositionsForManyLabels(h[c],a.geometry.spatialReference,a.text,
g,d,b,l)}for(c=0;c<l.length&&(h=l[c].x,p=l[c].y,void 0!==l[c].angle&&(g=l[c].angle),k=this._findPlace(a,a.text,h,p,g,d,b),"OneLabel"!==e||!k||!this._labelLayer._isWithinScreenArea(new F(h,p,a.geometry.spatialReference)));c++);}return this._placedLabels},_generatePointPositions:function(f,a,c,g,e,d,b,k,h,n){c=h&&h.pointPriorities?h.pointPriorities:"AboveRight";e=(b+e)*this._scale;d=(k+d)*this._scale;switch(c.toLowerCase()){case "aboveleft":f-=e;a+=d;break;case "abovecenter":a+=d;break;case "aboveright":f+=
e;a+=d;break;case "centerleft":f-=e;break;case "centercenter":break;case "centerright":f+=e;break;case "belowleft":f-=e;a-=d;break;case "belowcenter":a-=d;break;case "belowright":f+=e;a-=d;break;default:return}n.push({x:f,y:a})},_generateLinePositionsPlaceAtStart:function(f,a,c,g,e,d,b,k,h,n){b=g*this._scale;var l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,m,p,u,r,q,z,w,t;for(m=0;m<f.paths.length;m++){var v=f.paths[m],y=b,C=0;for(p=0;p<v.length-1;p++)u=v[p][0],r=
v[p][1],q=v[p+1][0],z=v[p+1][1],w=q-u,t=z-r,w=Math.sqrt(w*w+t*t),C+w>y?(C=this._generatePositionsOnLine(f.spatialReference,a,y,l,C,u,r,q,z,c,g,e,d,k,h,n),y=l):C+=w}},_generateLinePositionsPlaceAtEnd:function(f,a,c,g,e,d,b,k,h,n){b=g*this._scale;var l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,m,p,u,r,q,z,w,t;for(m=0;m<f.paths.length;m++){var v=f.paths[m],y=b,C=0;for(p=v.length-2;0<=p;p--)u=v[p+1][0],r=v[p+1][1],q=v[p][0],z=v[p][1],w=q-u,t=z-r,w=Math.sqrt(w*w+t*t),
C+w>y?(C=this._generatePositionsOnLine(f.spatialReference,a,y,l,C,u,r,q,z,c,g,e,d,k,h,n),y=l):C+=w}},_generateLinePositionsPlaceAtCenter:function(f,a,c,g,e,d,b,k,h,n,l){var m,p,u,r,q,z,w,t;for(k=0;k<f.paths.length;k++){var v=f.paths[k];if(!(2>v.length)){if(2==v.length){r=v[0];m=v[1];u=r[0];r=r[1];v=m[0];z=m[1];q=(v-u)*(v-u)+(z-r)*(z-r);w=Math.atan2(z-r,v-u);z=Math.cos(w);w=Math.sin(w);v=[];t=u;for(var y=r;(t-u)*(t-u)+(y-r)*(y-r)<q;)v.push([t,y]),t+=c/2*z,y+=c/2*w;v.push(m)}var C=0;for(m=0;m<v.length-
1;m++)u=v[m][0],r=v[m][1],q=v[m+1][0],z=v[m+1][1],w=q-u,t=z-r,C+=Math.sqrt(w*w+t*t);for(m=y=0;m<v.length-1;m++){u=v[m][0];r=v[m][1];q=v[m+1][0];z=v[m+1][1];w=q-u;t=z-r;w=Math.sqrt(w*w+t*t);if(y+w>C/2)break;y+=w}m==v.length-1&&m--;u=v[m][0];r=v[m][1];q=v[m+1][0];z=v[m+1][1];w=q-u;t=z-r;y=C/2-y;w=Math.atan2(t,w);t=u+y*Math.cos(w);w=r+y*Math.sin(w);u=this._angleAndShifts(u,r,q,z,b,h,n);l.push({x:t+u.shiftX,y:w+u.shiftY,angle:u.angle});var C=t,x=w,y=0;for(p=m;p<v.length-1;p++)p==m?(u=C,r=x):(u=v[p][0],
r=v[p][1]),q=v[p+1][0],z=v[p+1][1],w=q-u,t=z-r,w=Math.sqrt(w*w+t*t),y=y+w>c?this._generatePositionsOnLine(f.spatialReference,a,c,c,y,u,r,q,z,g,e,d,b,h,n,l):y+w;y=0;for(p=m;0<=p;p--)p==m?(u=C,r=x):(u=v[p+1][0],r=v[p+1][1]),q=v[p][0],z=v[p][1],w=q-u,t=z-r,w=Math.sqrt(w*w+t*t),y=y+w>c?this._generatePositionsOnLine(f.spatialReference,a,c,c,y,u,r,q,z,g,e,d,b,h,n,l):y+w}}},_generatePositionsOnLine:function(f,a,c,g,e,d,b,k,h,p,l,m,n,q,r,x){p=Math.atan2(h-b,k-d);l=d;m=b;var u=l,w=m;do if(e=c-e,l+=e*Math.cos(p),
m+=e*Math.sin(p),this._belongs(l,m,d,b,k,h))e=this._angleAndShifts(d,b,k,h,n,q,r),c=l+e.shiftX,w=m+e.shiftY,a?this._labelLayer._isWithinScreenArea(new E(c,w,c,w,f))&&x.push({x:c,y:w,angle:e.angle}):x.push({x:c,y:w,angle:e.angle}),u=l,w=m,e=0,c=g;else return f=k-u,h-=w,Math.sqrt(f*f+h*h);while(1)},_postSorting:function(f,a,c){if(f&&0<a.length){var g=.5*(f.xmin+f.xmax);f=.5*(f.ymin+f.ymax);for(var e=a[0].x,d=a[0].y,b=Math.sqrt((e-g)*(e-g)+(d-f)*(d-f)),k=a[0].angle,h=0;h<a.length;h++){var p=a[h].x,l=
a[h].y,m=Math.sqrt((p-g)*(p-g)+(l-f)*(l-f));m<b&&(e=p,d=l,b=m,k=a[h].angle)}c.push({x:e,y:d,angle:k})}},_belongs:function(f,a,c,g,e,d){if(e==c&&d==g)return!1;if(e>c){if(f>e||f<c)return!1}else if(f<e||f>c)return!1;if(d>g){if(a>d||a<g)return!1}else if(a<d||a>g)return!1;return!0},_angleAndShifts:function(f,a,c,g,e,d,b){for(f=Math.atan2(g-a,c-f);f>Math.PI/2;)f-=Math.PI;for(;f<-(Math.PI/2);)f+=Math.PI;g=Math.sin(f);var k=Math.cos(f);c=a=0;"Above"==d&&(a=e*g*this._scale,c=e*k*this._scale);"Below"==d&&(a=
-e*g*this._scale,c=-e*k*this._scale);e=[];e.angle=b?-f:0;e.shiftX=-a;e.shiftY=c;return e},_generatePolygonPositionsForManyLabels:function(f,a,c,g,e,d,b){e=this._findCentroidForRing(f);g=e[0];var k=e[1],h=this._calcRingExtent(f);e=h.xmin;d=h.ymin;var p=h.xmax,h=h.ymax,l=(h-d)/(this._map.height*this._scale);if(!(10<(p-e)/(this._map.width*this._scale)&&10<l)){var m=!0;if(p-e>this._map.width*this._scale||h-d>this._map.height*this._scale)m=!1;var l=this._map.width*this._scale*(m?.1875:.5),m=this._map.height*
this._scale*(m?.1875:.5),n=!0,q=!0,r=0;do{k+=(r%2?-1:1)*r*m;if(this._scanRingByX(c,a,f,g,k,e,p,l,b))break;k<d&&(n=!1);k>h&&(q=!1);r++}while(n||q)}},_scanRingByX:function(f,a,c,g,e,d,b,k,h){var p=!0,l=!0,m=0,n=1E3;do{g+=(m%2?-1:1)*m*k;var q=this._movePointInsideRing(c,g,e),r=this._labelLayer._isWithinScreenArea(new E(q,e,q,e,a)),x=this._isPointWithinRing(f,c,q,e);if(r&&x)return h.push({x:q,y:e}),!0;g<d&&(p=!1);g>b&&(l=!1);m++;n--;if(0>=n)return!0}while(p||l);return!1},_movePointInsideRing:function(f,
a,c){for(var g=[],e=f.length-1,d=f[0][1]>=f[e][1]?1:-1,b=0;b<=e;b++){var k=b,h=b+1;b==e&&(h=0);var n=f[k][0],k=f[k][1],l=f[h][0],h=f[h][1],m=h>=k?1:-1;if(k<=c&&c<=h||h<=c&&c<=k)c!=k&&c!=h?(g.push((c-k)*(l-n)/(h-k)+n),d=m):c==k&&c!=h?(d!=m&&g.push(n),d=m):c!=k&&c==h?(g.push(l),d=m):c==k&&c==h&&(1==d&&g.push(n),g.push(l),d=m)}g.sort(function(a,b){return a-b});f=g.length;if(0<f){for(b=c=a=0;b<f-1;b+=2)e=Math.abs(g[b+1]-g[b]),e>a&&(a=e,c=b);a=(g[c]+g[c+1])/2}return a},_calcRingExtent:function(f){var a,
c;c=new E;for(a=0;a<f.length-1;a++){var g=f[a][0],e=f[a][1];if(void 0===c.xmin||g<c.xmin)c.xmin=g;if(void 0===c.ymin||e<c.ymin)c.ymin=e;if(void 0===c.xmax||g>c.xmax)c.xmax=g;if(void 0===c.ymax||e>c.ymax)c.ymax=e}return c},_isPointWithinPolygon:function(f,a,c,g){var e;for(e=0;e<a.rings.length;e++)if(this._isPointWithinRing(f,a.rings[e],c,g))return!0;return!1},_isPointWithinRing:function(f,a,c,g){var e,d,b,k,h=[],n=a.length;for(f=0;f<n-1;f++)if(e=a[f][0],d=a[f][1],b=a[f+1][0],k=a[f+1][1],e!=b||d!=k){if(d==
k)if(g==d)h.push(e);else continue;e==b?(d<k&&g>=d&&g<k&&h.push(e),d>k&&g<=d&&g>k&&h.push(e)):(d=(b-e)/(k-d)*(g-d)+e,e<b&&d>=e&&d<b&&h.push(d),e>b&&d<=e&&d>b&&h.push(d))}h.sort(function(a,b){return a-b});for(f=0;f<h.length-1;f++)if(e=h[f],b=h[f+1],c>=e&&c<b)if(f%2)break;else return!0;return!1},_findCentroidForRing:function(f){for(var a=f.length,c=[0,0],g=0,e=f[0][0],d=f[0][1],b=1;b<a-1;b++){var k=f[b][0],h=f[b][1],n=f[b+1][0],l=f[b+1][1],m=(k-e)*(l-d)-(n-e)*(h-d);c[0]+=m*(e+k+n);c[1]+=m*(d+h+l);g+=
m}c[0]/=3*g;c[1]/=3*g;return c},_findCentroidForFeature:function(f){for(var a=0,c=[0,0],g=0;g<f.rings.length;g++)for(var e=f.rings[g],d=e.length,b=e[0][0],k=e[0][1],h=1;h<d-1;h++){var n=e[h][0],l=e[h][1],m=e[h+1][0],q=e[h+1][1],u=(n-b)*(q-k)-(m-b)*(l-k);c[0]+=u*(b+n+m);c[1]+=u*(k+l+q);a+=u}c[0]/=3*a;c[1]/=3*a;return c},_findPlace:function(f,a,c,g,e,d,b){if(isNaN(c)||isNaN(g))return!1;for(var k=0;k<this._placedLabels.length;k++){var h=this._placedLabels[k].angle,p=this._placedLabels[k].width*this._scale,
l=this._placedLabels[k].height*this._scale,m=this._placedLabels[k].x-c,q=this._placedLabels[k].y-g;if(0===e&&0===h){if(this._findPlace2(-d*this._scale,-b*this._scale,d*this._scale,b*this._scale,m-p,q-l,m+p,q+l))return!1}else{var u=new E(-d*this._scale,-b*this._scale,d*this._scale,b*this._scale,null),r=0,x=1;0!==e&&(r=Math.sin(e),x=Math.cos(e));var z=m*x-q*r,m=m*r+q*x,h=h-e,r=Math.sin(h),x=Math.cos(h),w=-p*x- -l*r,q=-p*r+-l*x,h=+p*x- -l*r,t=+p*r+-l*x,p=z+w,l=m-q,r=z+h,x=m-t,w=z-w,q=m+q,z=z-h,m=m+t,
h=new n;h.addRing([[p,l],[r,x],[w,q],[z,m],[p,l]]);if(u.intersects(h))return!1}}for(;e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;k={};k.layer=f;k.text=a;k.angle=e;k.x=c;k.y=g;k.width=d;k.height=b;this._placedLabels.push(k);return!0},_findPlace2:function(f,a,c,g,e,d,b,k){return(f>=e&&f<=b||c>=e&&c<=b||f<=e&&c>=b)&&(a>=d&&a<=k||g>=d&&g<=k||a<=d&&g>=k)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../renderers/arcadeUtils".split(" "),function(A,
q,x,D,E,F,n,f,a,c,g,e,d,b,k,h,p,l,m,B,u,r,J,z){function w(a){return"sizeInfo"===a.type}A=q(u,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=x.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
x.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)n.disconnect(this._mapEventHandlers[a]);this.refresh();clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var f=[];f.push(a.on("update-end",
x.hitch(this,"refresh")));f.push(a.on("suspend",x.hitch(this,"refresh")));f.push(a.on("resume",x.hitch(this,"refresh")));f.push(a.on("edits-complete",x.hitch(this,"refresh")));f.push(a.on("labeling-info-change",x.hitch(this,"refresh")));f.push(a.on("time-extent-change",x.hitch(this,"refresh")));f.push(a.on("show-labels-change",x.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,LabelRenderer:b,EventHandlers:f});this.featureLayers.push(a);
this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=F.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)n.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,1);this.refresh()}},removeAllFeatureLayers:function(){var a;
for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)n.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];return null},refresh:function(){null==this._refreshHandle&&
(this._refreshHandle=setTimeout(this._refreshLabels,0))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var c,d,f,e,h,g=[],l,t="DYNAMIC"===this._engineType?new b:new k;if(this._map){t.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(d=this.featureLayers[a],d.visible&&d.showLabels&&d.visibleAtMapScale&&!d._suspended)if(c=this._featureLayerInfos[a],h=this._convertOptions(null),c.LabelRenderer){if(g=
d.labelingInfo)if(l=g[0])e=this._getLabelExpression(l),h=this._convertOptions(l);f=c.LabelRenderer;c.LabelExpressionInfo&&(e=c.LabelExpressionInfo);c.LabelingOptions&&(h=this._convertOptions(null),void 0!==c.LabelingOptions.pointPriorities&&(g=c.LabelingOptions.pointPriorities,h.pointPriorities="above-center"==g||"AboveCenter"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"AboveLeft"==g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"AboveRight"==
g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"BelowCenter"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"BelowLeft"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"BelowRight"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"CenterCenter"==g||"esriServerPointLabelPlacementCenterCenter"==g?"CenterCenter":"center-left"==g||"CenterLeft"==g||"esriServerPointLabelPlacementCenterLeft"==
g?"CenterLeft":"center-right"==g||"CenterRight"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight"),void 0!==c.LabelingOptions.lineLabelPlacement&&(h.lineLabelPlacement=c.LabelingOptions.lineLabelPlacement),void 0!==c.LabelingOptions.lineLabelPosition&&(h.lineLabelPosition=c.LabelingOptions.lineLabelPosition),void 0!==c.LabelingOptions.labelRotation&&(h.labelRotation=c.LabelingOptions.labelRotation),void 0!==c.LabelingOptions.howManyLabels&&(h.howManyLabels=c.LabelingOptions.howManyLabels));
f instanceof r&&(e=this._getLabelExpression(f),f=new J(f.symbol),h=this._convertOptions(f));this._addLabels(d,f,e,h)}else if(g=d.labelingInfo)for(c=g.length-1;0<=c;c--)if(l=g[c])f=new r(l instanceof r?l.toJson():l),e=this._getLabelExpression(l),h=this._convertOptions(l),this._addLabels(d,f,e,h);e=t._process(this._preparedLabels);this.clear();this.drawLabels(this._map,e)}},drawLabels:function(a,b){this._scale=(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var d=b[c],f=d.x,g=d.y,
k=d.text,l=d.angle,t=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation&&t.setAngle(180/Math.PI*l);t.setText(k);d=f;t instanceof h&&(f=t.getHeight(),d-=.25*f*this._scale*Math.sin(l),g-=.33*f*this._scale);l=new e(new m(d,g,a.extent.spatialReference));l.setSymbol(t);this.add(l)}},_addLabels:function(a,b,c,d){var f,e,g,k;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==c){var h=this._map,l=!a.url&&!h.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(e=
a.graphics[f],!1!==e.visible){g=e.geometry;if(l){if(!B.canProject(g,h))continue;g=B.project(g,h)}g&&this._isWhere(b.where,e.attributes)&&this._isWithinScreenArea(g)&&(k=this._buildLabelText(c,e,a.fields,d),this._addLabel(k,b,a.renderer,e,d,g,h))}}},_isWithinScreenArea:function(a){a="point"===a.type?new l(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();
return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),f=c[3],e=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));switch(f){case "AND":return d&&e;case "OR":return d||e}}}return!1}catch(K){console.log("Error.: can't parse \x3d "+
a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||F.filter(a.visualVariables,
w)[0]:null},_addLabel:function(b,c,d,f,e,g,k){var l,m,n,t;if(b&&""!==x.trim(b)&&c){b=b.replace(/\s+/g," ");l=c.getSymbol(f);l instanceof h?(l=new h(l.toJson()),l.setVerticalAlignment("baseline"),l.setHorizontalAlignment("center")):l=l instanceof p?new p(l.toJson()):new h;l.setText(b);c.symbol=l;if(n=this._getProportionalSize(c.sizeInfo,f.attributes))l instanceof h?l.setSize(n):l instanceof p&&(l.setWidth(n),l.setHeight(n));t=n=0;if(d){m=d.getSymbol(f);var q=this._getSizeInfo(d),r;q&&(r=d.getSize(f,
{sizeInfo:q,resolution:k.getResolutionInMeters()}));if(r&&null!==r)n=t=r;else if(m)if("simplemarkersymbol"==m.type)t=n=m.size;else if("picturemarkersymbol"==m.type)n=m.width,t=m.height;else if("simplelinesymbol"==m.type||"cartographiclinesymbol"==m.type)n=m.width}d={};d.graphic=f;d.options=e;d.geometry=g;d.labelRenderer=c;d.labelSymbol=l;d.labelWidth=l.getWidth()/2;d.labelHeight=l.getHeight()/2;d.symbolWidth=a.normalizedLength(n)/2;d.symbolHeight=a.normalizedLength(t)/2;d.text=b;d.angle=l.angle;this._preparedLabels.push(d)}},
_buildLabelText:function(a,b,c,f){if(f.hasExpression)return a=z.executeFunction(f.compiledFunc,z.createExecContext(b,b._getView())),g.isDefined(a)?""+a:"";var e=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,k=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var k=e[c[b].name],h=c[b].domain;if(h&&x.isObject(h)){if("codedValue"==h.type&&f.useCodedValues)for(b=k,a=0;a<h.codedValues.length;a++){if(h.codedValues[a].code==b){k=h.codedValues[a].name;break}}else"range"==h.type&&h.minValue<=
k&&k<=h.maxValue&&(k=h.name);break}h=c[b].type;if(f.fieldInfos){var l=f.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==h?(a="DateFormat"+d.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(k=g.substitute({myKey:k},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=h&&"esriFieldTypeSingle"!=h&&"esriFieldTypeSmallInteger"!=h&&"esriFieldTypeLong"!=h&&"esriFieldTypeDouble"!=h||!a||(k=D.format(k,{places:a.places}),a.digitSeparator||E.group&&(k=
k.replace(new RegExp("\\"+E.group,"g"),"")));break}}break}else k="";return null==k?"":k})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[","g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,
b){if(!a)return null;var c=g.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",d=null,f=null,e="",g=!0,h,k;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),f=a.fieldInfos,e=a.labelPlacement,null!=a.useCodedValues&&
(b=a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(k=!0,h=z.createFunction(l))}if("always-horizontal"==e||"esriServerPolygonPlacementAlwaysHorizontal"==e)g=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:f,pointPriorities:"above-center"==e||"esriServerPointLabelPlacementAboveCenter"==e?"AboveCenter":"above-left"==e||"esriServerPointLabelPlacementAboveLeft"==e?"AboveLeft":"above-right"==e||"esriServerPointLabelPlacementAboveRight"==e?"AboveRight":"below-center"==
e||"esriServerPointLabelPlacementBelowCenter"==e?"BelowCenter":"below-left"==e||"esriServerPointLabelPlacementBelowLeft"==e?"BelowLeft":"below-right"==e||"esriServerPointLabelPlacementBelowRight"==e?"BelowRight":"center-center"==e||"esriServerPointLabelPlacementCenterCenter"==e?"CenterCenter":"center-left"==e||"esriServerPointLabelPlacementCenterLeft"==e?"CenterLeft":"center-right"==e||"esriServerPointLabelPlacementCenterRight"==e?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==e||"below-start"==
e||"center-start"==e?"PlaceAtStart":"above-end"==e||"below-end"==e||"center-end"==e?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==e||"esriServerLinePlacementAboveAfter"==e||"above-along"==e||"esriServerLinePlacementAboveAlong"==e||"above-before"==e||"esriServerLinePlacementAboveBefore"==e||"above-start"==e||"esriServerLinePlacementAboveStart"==e||"above-end"==e||"esriServerLinePlacementAboveEnd"==e?"Above":"below-after"==e||"esriServerLinePlacementBelowAfter"==e||"below-along"==e||
"esriServerLinePlacementBelowAlong"==e||"below-before"==e||"esriServerLinePlacementBelowBefore"==e||"below-start"==e||"esriServerLinePlacementBelowStart"==e||"below-end"==e||"esriServerLinePlacementBelowEnd"==e?"Below":"center-after"==e||"esriServerLinePlacementCenterAfter"==e||"center-along"==e||"esriServerLinePlacementCenterAlong"==e||"center-before"==e||"esriServerLinePlacementCenterBefore"==e||"center-start"==e||"esriServerLinePlacementCenterStart"==e||"center-end"==e||"esriServerLinePlacementCenterEnd"==
e?"OnLine":"Above",labelRotation:g,howManyLabels:"OneLabel",hasExpression:k,compiledFunc:h}}});f("extend-esri")&&x.setObject("layers.LabelLayer",A,c);return A});