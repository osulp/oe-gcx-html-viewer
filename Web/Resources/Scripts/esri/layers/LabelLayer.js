// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./ArcadeExpression ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./arcadeProfiles/popupProfile ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(r,m,q,C,E,u,k,c,a,b,l,g,f,d,e,t,B,v,n,w,y,
x){r=r(null,{declaredClass:"esri.PopupInfo",_reNewline:/(\n)/ig,_reExprField:/^\s*expression\//i,_reExprFieldPattern:/\{expression\/([^\}]+)\}/ig,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(h,a){if(h){m.mixin(this,a);this.info=h;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var b=this._fieldLabels={},c=this._fieldsMap={};this.info.fieldInfos&&q.forEach(this.info.fieldInfos,function(h){var a=
h.fieldName.toLowerCase(),p=this._isExpressionField(a)?this.getExpressionInfo(a):null;b[a]=p?p.title:h.label;c[a]=h},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix));this.titleHasAsyncExpressions=this._titleHasAsyncExpressions();this.contentHasAsyncExpressions=this._contentHasAyncExpressions()}},toJson:function(){return C.fromJson(C.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(h){var a;q.some(this.info&&
this.info.fieldInfos,function(b){b.fieldName===h&&(a=b);return!!a});return a},getExpressionInfo:function(h){if(h=this._getExprField(h)){h=h.toLowerCase();var a;q.some(this.info.expressionInfos,function(b){b.name.toLowerCase()===h&&(a=b);return!!a});return a}},getExpressionFieldsInTitle:function(){return this._getExprFieldsFromTemplatedString(this.info.title)},getExpressionFieldsInContent:function(){var h=this._collectExprFieldsFromTemplatedString(this.info.description,[]);this.info.description||q.forEach(this.info.fieldInfos,
function(a){a.visible&&this._collectExprField(a.fieldName,h)},this);q.forEach(this.info.mediaInfos,function(a){this._collectExprFieldsFromTemplatedString(a.title,h);this._collectExprFieldsFromTemplatedString(a.caption,h);if(a=a.value)this._collectExprFieldsFromTemplatedString(a.linkURL,h),this._collectExprFieldsFromTemplatedString(a.sourceURL,h),q.forEach(a.fields,function(a){this._collectExprField(a,h)},this),this._collectExprField(a.normalizeField,h),this._collectExprField(a.tooltipField,h)},this);
return h},getRequiredExpressionFields:function(){return this.getExpressionFieldsInTitle().concat(this.getExpressionFieldsInContent())},hasGeometryOperations:function(){return q.some(this._getArcadeExpressions(),function(a){return a.hasGeometryOperations()})},hasAsyncExpressions:function(){return q.some(this._getArcadeExpressions(),function(a){return a.async})},initializeArcadeEngine:function(){return w.initialize(this._getArcadeExpressions())},getComponents:function(a,b){var h=this.info,c={initArcadeEngine:this.initializeArcadeEngine()};
h.fieldInfos&&(h=q.filter(h.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<h.length&&(c.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:h}));this._needFullResolutionFeature(a)&&(c.fullResolutionFeature=this._getFullResolutionFeature(a));return d(c).then(m.hitch(this,function(h){h=h.fullResolutionFeature;var p=b&&b.evaluateAllExpressions,c=p?null:this.getRequiredExpressionFields();h=(p?this.hasAsyncExpressions():this._hasAsyncExpressions(c))?this._fetchAttributesAsync(a,
h,c):this._fetchAttributes(a,h,c);return d([h]).then(m.hitch(this,function(h){return this._getPopupValues(a,h[0])}))}))},getAttachments:function(a){var h=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&h&&h.hasAttachments&&h.objectIdField&&(a=a&&a[h.objectIdField]))return h.queryAttachmentInfos(a)},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"function"===typeof a.getMaxAllowableOffset&&0<a.getMaxAllowableOffset()&&this.hasGeometryOperations():!1},_getFullResolutionFeature:function(a){var h=
a.getSourceLayer(),b=h.objectIdField;a=(a=a.attributes)&&b&&a[b];if(null==a)return null;var c=new t;c.where=b+"\x3d"+a;c.maxAllowableOffset=0;c.outFields=[b];h._enableCacheHint(c);return h.queryFeatures(c).then(function(a){return a.features&&a.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_getExprField:function(a){return this._isExpressionField(a)?a.replace(this._reExprField,""):null},_collectExprField:function(a,b){(a=this._getExprField(a))&&b.push(a);return b},
_collectExprFieldsFromTemplatedString:function(a,b){a=this._getExprFieldsFromTemplatedString(a);a.length&&Array.prototype.push.apply(b,a);return b},_getExprFieldsFromTemplatedString:function(a){a=a?a.match(this._reExprFieldPattern):null;return q.map(a,function(a){return a.replace(this._reExprFieldPattern,"$1")},this)},_titleHasAsyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInTitle())},_contentHasAyncExpressions:function(){return this._hasAsyncExpressions(this.getExpressionFieldsInContent())},
_hasAsyncExpressions:function(a){return q.some(a,function(a){a=this._exprCache[a];return!(!a||!a.async)},this)},_compileExpressions:function(a){var h={};q.forEach(a,function(a){var b=a.returnType&&a.returnType.toLowerCase();h[a.name]=new e({expression:a.expression,returnType:"number"===b?"number":"string",profile:w})});return h},_getArcadeExpressions:function(){var a=[],b;for(b in this._exprCache)a.push(this._exprCache[b]);return a},_fetchAttributesAsync:function(a,b,c){var h=this._fetchAttributes(a,
b,c);a={};for(var p in h)(b=h[p])&&b.then&&(a[p]=b);return d(a).then(m.hitch(this,function(a){for(var p in a){var b=a[p];h[p]=b instanceof Error?null:this._processArcadeResult(b)}return h}))},_processArcadeResult:function(a){"string"===typeof a&&(a=b.encode(a));return a},_fetchAttributes:function(a,b,c){var h=m.clone(a.attributes)||{},p=b&&b.geometry,n=this._exprPrefix,f=this._exprCache;c=c||q.map(this.info.expressionInfos,function(a){return a.name});q.forEach(c,function(b){var c=n+b;b=(b=f[b])?a.evaluateExpression(b,
this._getEvalOptions(b,a,p)):null;h[c]=this._processArcadeResult(b)},this);return h},_getEvalOptions:function(a,b,c){var h=a.hasGeometryOperations(),p=b.getSourceLayer(),n=p&&(p.getMap()||p.parentLayer&&p.parentLayer.getMap());a=w.getEvalOptions({expression:a,feature:b,layer:p,map:n,spatialReference:n&&n.spatialReference});b=a.context.vars.$feature;h=!(!h||!c);b&&h&&(b._geometry=c);a.skipCache=h;return a},_getPopupValues:function(a,b,c){b=b||this._fetchAttributes(a);var h=this.info,p=a.getSourceLayer(),
n=m.clone(b),f="",d="",g,e,A,t,k,z=p&&p._getDateOpts&&p._getDateOpts().properties,z=z&&z.slice(0),y={dateFormat:{properties:z,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)},format:null};if(this._relatedInfo)for(t in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(t)){var w=this._relatedInfo[t],v=this._relatedLayersInfo[t];w&&(q.forEach(w.relatedFeatures,function(a){for(k in a.attributes)if(a.attributes.hasOwnProperty(k)&&"esriRelCardinalityOneToOne"===v.relation.cardinality){var p=
this._toRelatedFieldName([v.relation.id,k]);b[p]=n[p]=a.attributes[k]}},this),q.forEach(w.relatedStatsFeatures,function(a){for(k in a.attributes)if(a.attributes.hasOwnProperty(k)){var p=this._toRelatedFieldName([v.relation.id,k]);b[p]=n[p]=a.attributes[k]}},this))}for(e in n)t=this._fieldsMap[e.toLowerCase()],w=this._getLayerFieldInfo(p,e),t&&w&&(t.fieldName=w.name),n[e]=this._formatValue(n[e],e,y),z&&t&&t.format&&t.format.dateFormat&&(t=q.indexOf(z,e),-1<t&&z.splice(t,1));if(p)for(e in z=p.typeIdField,
b)b.hasOwnProperty(e)&&-1===e.indexOf(this._relatedFieldPrefix)&&(A=b[e],l.isDefined(A)&&(t=this._getDomainName(p,a,e,A),l.isDefined(t)?n[e]=t:e===z&&(t=this._getTypeName(p,a,A),l.isDefined(t)&&(n[e]=t))));h.title&&(f=this._processFieldsInLinks(this._fixTokens(h.title,p),b),f=m.trim(this._removeEmptyHref(l.substitute(n,f,y)||"")));if(c)return{title:f};h.description&&(d=this._processFieldsInLinks(this._fixTokens(h.description,p),b),d=m.trim(this._removeEmptyHref(l.substitute(n,d,y)||"")));h.fieldInfos&&
(g=[],q.forEach(h.fieldInfos,function(a){(e=a.fieldName)&&a.visible&&g.push([this._fieldLabels[e.toLowerCase()]||e,l.substitute(n,"${"+e+"}",y)||""])},this));var x,B;h.mediaInfos&&(x=[],q.forEach(h.mediaInfos,function(a){B=0;A=a.value;switch(a.type){case "image":var h=A.sourceURL,h=h&&m.trim(this._removeEmptyHref(l.substitute(b,this._fixTokens(h,p))));B=!!h;break;case "piechart":case "linechart":case "columnchart":case "barchart":var c,h=A.normalizeField;A.fields=q.map(A.fields,function(a){return(c=
this._getLayerFieldInfo(p,a))?c.name:a},this);h&&(c=this._getLayerFieldInfo(p,h),A.normalizeField=c?c.name:h);B=q.some(A.fields,function(a){return l.isDefined(b[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(B){a=m.clone(a);A=a.value;var h=a.title?this._processFieldsInLinks(this._fixTokens(a.title,p),b):"",f=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,p),b):"";a.title=h?m.trim(this._removeEmptyHref(l.substitute(n,h,y)||"")):"";a.caption=
f?m.trim(this._removeEmptyHref(l.substitute(n,f,y)||"")):"";if("image"===a.type)A.sourceURL=l.substitute(b,this._fixTokens(A.sourceURL,p)),A.linkURL&&(A.linkURL=m.trim(l.substitute(b,this._fixTokens(A.linkURL,p))||""));else{var d,e;q.forEach(A.fields,function(a,p){if(-1!==a.indexOf(this._relatedFieldPrefix))e=this._getRelatedChartInfos(a,A,b,y),e instanceof Array?A.fields=e:A.fields[p]=e;else{var h=b[a],h=void 0===h?null:h;d=b[A.normalizeField]||0;h&&d&&(h/=d);A.fields[p]={y:h,tooltip:(this._fieldLabels[a.toLowerCase()]||
a)+":\x3cbr/\x3e"+this._formatValue(h,a,y,!!d)}}},this)}x.push(a)}},this));return{title:f,description:d,hasDescription:!!h.description,fields:g&&g.length?g:null,mediaInfos:x&&x.length?x:null,formatted:n,editSummary:!1!==h.showLastEditInfo&&p&&p.getEditSummary?p.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,c,n){var p,h,f,d,e,g;p=[];g=this._fromRelatedFieldName(a);e=g[0];h=this._relatedInfo[e];e=this._relatedLayersInfo[e];h&&q.forEach(h.relatedFeatures,function(h){h=h.attributes;var e,
A;for(A in h)if(h.hasOwnProperty(A)&&A===g[1]){e={};d=h[A];b.normalizeField&&(f=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?h[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);d&&f&&(d/=f);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var t=this._fromRelatedFieldName(b.tooltipField)[1],D=l.isDefined(h[t])?this._formatValue(h[t],b.tooltipField,n,!!f):t;e.tooltip=D+":\x3cbr/\x3e"+this._formatValue(d,t,n,!!f)}else e.tooltip=(this._fieldLabels[a.toLowerCase()]||
a)+":\x3cbr/\x3e"+this._formatValue(d,b.tooltipField,n,!!f);else e.tooltip=d;e.y=d;p.push(e)}},this);return"esriRelCardinalityOneToMany"===e.relation.cardinality||"esriRelCardinalityManyToMany"===e.relation.cardinality?p:p[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",
longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",longMonthDayYearShortTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",longMonthDayYearShortTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longMonthDayYearLongTime:"(datePattern: 'MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longMonthDayYearLongTime24:"(datePattern: 'MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
dayShortMonthYearShortTime:"(datePattern: 'd MMM y', timePattern: 'h:mm a', selector: 'date and time')",dayShortMonthYearShortTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm', selector: 'date and time')",dayShortMonthYearLongTime:"(datePattern: 'd MMM y', timePattern: 'h:mm:ss a', selector: 'date and time')",dayShortMonthYearLongTime24:"(datePattern: 'd MMM y', timePattern: 'H:mm:ss', selector: 'date and time')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",longDateShortTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm a', selector: 'date and time')",
longDateShortTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm', selector: 'date and time')",longDateLongTime:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'h:mm:ss a', selector: 'date and time')",longDateLongTime24:"(datePattern: 'EEEE, MMMM d, y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_dateFormatsJson:{shortDate:{datePattern:"M/d/y",
selector:"date"},shortDateShortTime:{datePattern:"M/d/y",timePattern:"h:mm a",selector:"date and time"},shortDateShortTime24:{datePattern:"M/d/y",timePattern:"H:mm",selector:"date and time"},shortDateLongTime:{datePattern:"M/d/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLongTime24:{datePattern:"M/d/y",timePattern:"H:mm:ss",selector:"date and time"},shortDateLE:{datePattern:"d/M/y",selector:"date"},shortDateLEShortTime:{datePattern:"d/M/y",timePattern:"h:mm a",selector:"date and time"},
shortDateLEShortTime24:{datePattern:"d/M/y",timePattern:"H:mm",selector:"date and time"},shortDateLELongTime:{datePattern:"d/M/y",timePattern:"h:mm:ss a",selector:"date and time"},shortDateLELongTime24:{datePattern:"d/M/y",timePattern:"H:mm:ss",selector:"date and time"},longMonthDayYear:{datePattern:"MMMM d, y",selector:"date"},longMonthDayYearShortTime:{datePattern:"MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longMonthDayYearShortTime24:{datePattern:"MMMM d, y",timePattern:"H:mm",selector:"date and time"},
longMonthDayYearLongTime:{datePattern:"MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longMonthDayYearLongTime24:{datePattern:"MMMM d, y",timePattern:"H:mm:ss",selector:"date and time"},dayShortMonthYear:{datePattern:"d MMM y",selector:"date"},dayShortMonthYearShortTime:{datePattern:"d MMM y",timePattern:"h:mm a",selector:"date and time"},dayShortMonthYearShortTime24:{datePattern:"d MMM y",timePattern:"H:mm",selector:"date and time"},dayShortMonthYearLongTime:{datePattern:"d MMM y",
timePattern:"h:mm:ss a",selector:"date and time"},dayShortMonthYearLongTime24:{datePattern:"d MMM y",timePattern:"H:mm:ss",selector:"date and time"},longDate:{datePattern:"EEEE, MMMM d, y",selector:"date"},longDateShortTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm a",selector:"date and time"},longDateShortTime24:{datePattern:"EEEE, MMMM d, y",timePattern:"H:mm",selector:"date and time"},longDateLongTime:{datePattern:"EEEE, MMMM d, y",timePattern:"h:mm:ss a",selector:"date and time"},longDateLongTime24:{datePattern:"EEEE, MMMM d, y",
timePattern:"H:mm:ss",selector:"date and time"},longMonthYear:{datePattern:"MMMM y",selector:"date"},shortMonthYear:{datePattern:"MMM y",selector:"date"},year:{datePattern:"y",selector:"date"}},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(a,b){var h=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,p,c){a=h._getLayerFieldInfo(b,c);return"$"+(a?"{"+a.name+"}":p)})},_encodeAttributes:function(a){a=m.clone(a)||{};var b,h;for(b in a)(h=a[b])&&"string"===
typeof h&&(h=encodeURIComponent(h).replace(/\'/g,"\x26apos;"),a[b]=h);return a},_processFieldsInLinks:function(a,b){var h=this._encodeAttributes(b);b=m.hitch(this,this._addValuesToHref,b,h);a&&(a=a.replace(this._reHref,b).replace(this._reHrefApos,b));return a},_addValuesToHref:function(a,b,c,n){n=n&&m.trim(n);return c=l.substitute(n&&0===n.indexOf("${")?a:b,c)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(a,b,c,n){var p=this._fieldsMap[b.toLowerCase()],
h=p&&p.format;b=-1!==q.indexOf(c.dateFormat.properties,b);var f="number"===typeof a&&!b&&(!h||!h.dateFormat);if(!l.isDefined(a)||!p||!l.isDefined(h))return this._applyFormatting(a,f);var d,p=h.hasOwnProperty("places")||h.hasOwnProperty("digitSeparator"),e=h.hasOwnProperty("digitSeparator")?h.digitSeparator:!0;if(p&&!b)d={formatType:"NumberFormat",places:l.isDefined(h.places)&&(!n||0<h.places)?Number(h.places):Infinity};else if(h.dateFormat)d=m.mixin({formatType:"DateFormat",utcOffset:this.utcOffset},
this._dateFormatsJson[h.dateFormat]||this._dateFormatsJson.shortDateShortTime);else return this._applyFormatting(a,f);var g=this._applyFormatFunctions(a,d,c);p&&-1<a.constructor.toString().indexOf("Array")&&(g="",q.forEach(a,m.hitch(this,function(a,b){b&&(g+=" ");g+=this._applyFormatFunctions(a,d,c)})));p&&!e&&x.group&&(g=g.replace(new RegExp("\\"+x.group,"g"),""));b&&(g='\x3cspan class\x3d"esriDateValue"\x3e'+g+"\x3c/span\x3e");return this._applyFormatting(g,f)},_applyFormatFunctions:function(a,
b,c){b&&c&&(c.format={myKey:b});a=l.substitute({myKey:a},"${myKey}",c)||"";b&&c&&(c.format=null);return a},_applyFormatting:function(a,b){return b?this._forceLTR(a):this._applyPreWrap(a)},_forceLTR:function(a){var b=c("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_applyPreWrap:function(a){return"string"===typeof a?a.replace(this._reNewline,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"):a},_insertOffset:function(a){a&&(a=l.isDefined(this.utcOffset)?a.replace(/\)\s*$/,
", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,c,n){return(a=a.getDomain&&a.getDomain(c,{feature:b}))&&a.codedValues?a.getName(n):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=this._getRelatedLayersInfo(a).then(m.hitch(this,function(a){for(c in a)a.hasOwnProperty(c)&&a[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=a[c])})));
return this._relatedLayersInfoPromise.then(m.hitch(this,function(){return this._queryRelatedLayers(b)})).then(m.hitch(this,function(a){this._setRelatedRecords(b,a);return a}))},_getRelatedLayersInfo:function(b){var c=b.fieldsInfo,h,d,p={};h=b.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});q.forEach(c,function(a){var b,c,p,d;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(!this._relatedLayersInfo[c]&&h&&h.relationships&&(q.some(h.relationships,function(a){if(a.id==
c)return d=a,!0}),d&&(this._relatedLayersInfo[c]={relation:d,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(p=new n,p.statisticType=a.statisticType,p.onStatisticField=b,p.outStatisticFieldName=b,this._relatedLayersInfo[c].outStatistics.push(p))))},this);for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&this._relatedLayersInfo[d]&&(b=this._relatedLayersInfo[d].relation,b=h.url.replace(/[0-9]+$/,
b.relatedTableId),this._relatedLayersInfo[d].relatedLayerUrl=b,p[d]=f({url:b,content:{f:"json"},callbackParamName:"callback"}));return a(p)},_queryRelatedLayers:function(b){var c={},h;for(h in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(h)&&(c[h]=this._queryRelatedLayer({graphic:b,relatedInfo:this._relatedLayersInfo[h]}));return a(c)},_queryRelatedLayer:function(b){var c,h,n,p,d,f,e,g,l,y,w,x,v;c=b.graphic;h=c.getSourceLayer();n=h.url.match(/[0-9]+$/g)[0];w=b.relatedInfo;y=w.relatedLayerInfo;
x=w.relatedLayerUrl;b=w.relation;q.some(y.relationships,function(a){if(a.relatedTableId===parseInt(n,10))return p=a,!0},this);p&&(d=new t,q.some(y.fields,function(a){if(a.name===p.keyField)return g=-1!==q.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),p.relationshipTableId&&p.keyFieldInRelationshipTable?(v=new k,this._queryRelatedRecords(c,p).then(m.hitch(this,function(a){var b;(b=a[c.attributes[h.objectIdField]])?
(a=q.map(b.features,function(a){return a.attributes[y.objectIdField]},this),w.outStatistics&&0<w.outStatistics.length&&y.supportsStatistics&&(l=new t,l.where=this._chunkWhereInClause(y.objectIdField,a,1E3),l.outFields=d.outFields,l.outStatistics=w.outStatistics),l&&(f=new B(x),f.execute(l).then(m.hitch(this,function(a){var c=[];c.push(b);c.push(a);v.resolve(c)})))):v.resolve()}))):(e="string"===g?p.keyField+"\x3d'"+c.attributes[b.keyField]+"'":p.keyField+"\x3d"+c.attributes[b.keyField],d.where=e,
d.outFields=w.relatedFields,w.outStatistics&&0<w.outStatistics.length&&y.supportsStatistics&&(l=new t,l.where=d.where,l.outFields=d.outFields,l.outStatistics=w.outStatistics),f=new B(x),e=[],e.push(f.execute(d)),l&&e.push(f.execute(l))));return e?a(e):v?v.promise:void 0},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var c in b)b.hasOwnProperty(c)&&b[c]&&(a=b[c],this._relatedInfo[c]={},this._relatedInfo[c].relatedFeatures=a[0].features,l.isDefined(a[1])&&(this._relatedInfo[c].relatedStatsFeatures=
a[1].features))},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b},_queryRelatedRecords:function(a,b){var c=a.getSourceLayer(),n=new v;n.outFields=["*"];n.relationshipId=b.id;n.objectIds=[a.attributes[c.objectIdField]];return c.queryRelatedFeatures(n)},_removeEmptyHref:function(a){return a.replace(/href=(""|'')/gi,
"")},_chunkWhereInClause:function(a,b,c){for(var n=0,p=[];n<b.length;)p.push(a+" IN ("+b.slice(n,c+n)+")"),n+=c;return p.join(" OR ")}});u("extend-esri")&&(g.PopupInfo=g.PopupInfoTemplate=r);return r})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(r){var m=r.getObject("dojox.html.entities",!0),q=function(m,u){var k,c;if(u._encCache&&u._encCache.regexp&&u._encCache.mapper&&u.length==u._encCache.length)k=u._encCache.mapper,c=u._encCache.regexp;else{k={};c=["["];var a;for(a=0;a<
u.length;a++)k[u[a][0]]="\x26"+u[a][1]+";",c.push(u[a][0]);c.push("]");c=new RegExp(c.join(""),"g");u._encCache={mapper:k,regexp:c,length:u.length}}return m=m.replace(c,function(a){return k[a]})},C=function(m,u){var k,c;if(u._decCache&&u._decCache.regexp&&u._decCache.mapper&&u.length==u._decCache.length)k=u._decCache.mapper,c=u._decCache.regexp;else{k={};c=["("];var a;for(a=0;a<u.length;a++){var b="\x26"+u[a][1]+";";a&&c.push("|");k[b]=u[a][0];c.push(b)}c.push(")");c=new RegExp(c.join(""),"g");u._decCache=
{mapper:k,regexp:c,length:u.length}}return m=m.replace(c,function(a){return k[a]})};m.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],
["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc",
"Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6",
"aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192",
"fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4",
"delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],
["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],
["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5",
"perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013",
"ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];m.encode=function(r,u){r&&(u?r=q(r,u):(r=q(r,m.html),r=q(r,m.latin)));return r};m.decode=function(q,u){q&&(u?q=C(q,u):(q=C(q,m.html),q=C(q,m.latin)));return q};return m})},"esri/ArcadeExpression":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./layers/support/attributeUtils ./support/expressionUtils".split(" "),
function(r,m,q,C,E,u){r=r(null,{declaredClass:"esri.ArcadeExpression",expression:null,profile:null,returnType:null,async:null,id:null,syntaxTree:null,_traits:null,_attributeDef:null,_attributeCache:null,_compiled:!1,constructor:function(k){m.mixin(this,k);this.returnType=this.returnType||"string";this.id=E.getAttributeId(this.expression);this._setSyntaxTree(this.profile.parse(this));this.async=this.async||this.profile.isAsync(this)},hasGeometryOperations:function(){var k=this._traits.geometryOperations;
void 0===k&&(k=this._traits.geometryOperations=u.hasGeometryOperations(this.syntaxTree));return k},hasFeatureSetOperations:function(){var k=this._traits.featureSetOperations;void 0===k&&(k=this._traits.featureSetOperations=u.hasFeatureSetOperations(this.syntaxTree));return k},hasVariable:function(k){var c=this._traits.variables;void 0===c[k]&&(c[k]=u.hasVariable(this.syntaxTree,k));return c[k]},hasFunction:function(k){var c=this._traits.functions;void 0===c[k]&&(c[k]=u.hasFunction(this.syntaxTree,
k));return c[k]},evaluate:function(k){this._compile();var c=this._attributeCache.compiledFunc;return this.async?u.executeAsyncFunction(c,k):u.executeFunction(c,k)},_setSyntaxTree:function(k){this.syntaxTree=k;this._compiled=!1;this._traits={variables:{},functions:{}};this._createLegacyValueObjects()},_createLegacyValueObjects:function(){this._attributeDef={valueExpression:this.expression};this._attributeCache={attributeInfo:this._attributeDef,isNumeric:"number"===this.returnType,idSource:this.expression,
id:this.id,hasExpr:!0,compiledFunc:null,syntaxTree:this.syntaxTree,isScaleDriven:!1,dependsOnView:this.hasVariable("$view"),dependsOnGeometry:this.hasGeometryOperations(),isJSFunc:!1}},_compile:function(){this._compiled||(this._attributeCache.compiledFunc=this.profile.compile(this),this._compiled=!0)}});q("extend-esri")&&(C.ArcadeExpression=r);return r})},"esri/tasks/QueryTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/DeferredList ../kernel ../sniff ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(r,m,q,C,E,u,k,c,a,b,l,g,f,d,e){var t=a("esri-pbf"),B=m(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(a){this._handleSuccess=q.hitch(this,this._handleSuccess);this._handleError=q.hitch(this,this._handleError);q.mixin(this,a);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var a=new E(this._canceler);this._fetchDfd=a;this._result=null;this._sendRequest();
return a.promise},_canceler:function(a){var b=a._pendingRequest,c;a.isFulfilled()||!b||b.isFulfilled()||(b.cancel(),c=b.results&&b.results[1]);a._pendingRequest=null;return c},_sendRequest:function(a){var c=this.query;this.pagination&&(this._startPage=c.resultOffset=null==a?0:a,c.resultRecordCount=this.pageSize);a=this.requestOptions;this._fetchDfd._pendingRequest=b({url:this.url,content:c,handleAs:"pbf"===c.f?"arraybuffer":"json",callbackParamName:"callback",timeout:a&&a.timeout},a);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},
_handleSuccess:function(a){this.pagination?(a.exceededTransferLimit&&this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(a.features):this._result=a,this._fetchDfd.progress(a),a.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(a),this._fetchDfd.resolve(a))},_handleError:function(a){this._fetchDfd.reject(a)}}),v=m(d,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],
"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,b){this._handler=q.hitch(this,this._handler);this._relationshipQueryHandler=q.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=q.hitch(this,this._executeForIdsHandler);this._countHandler=q.hitch(this,this._countHandler);this._extentHandler=q.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",
c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(a,c,d,f,h){var e=
h.assembly;a=this._encode(q.mixin({},this._url.query,{f:f&&f.format||"json"},a.toJson(e&&e[0])));var n=this._handler,g=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=u.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);var p="pbf"===a.f;if(p){var l;t||(l="QueryTask.execute: 'pbf' format is not supported in your browser.");if(l)return a=new E,a.addErrback(function(a){g(a,d,h.dfd)}),a.reject(Error(l)),a}l=this.requestOptions;l=b({url:this._url.path+"/query",content:a,
callbackParamName:"callback",handleAs:p?"arraybuffer":"json",timeout:l&&l.timeout},l);a=[l];p&&a.push(v.loadPBFReader());(new k(a)).then(function(a){h.dfd.isFulfilled()||(a=a[0],a[0]?n(a[1],p,c,d,h.dfd):g(a[1],d,h.dfd))});return l},rawExecute:function(a,b,c){b=b||{};a=this._encode(q.mixin({},this._url.query,{f:b.format||"json"},a.toJson(c.assembly&&c.assembly[0])));this.source&&(a.layer=u.toJson({source:this.source.toJson()}));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return(new B({url:this._url.path+
"/query",query:a,requestOptions:this.requestOptions,pagination:b.pagination,pageSize:b.pageSize})).execute().then(null,null,function(a){c.dfd.progress(a)}).then(q.hitch(this,function(a){this._successHandler([a],"onRawExecuteComplete",null,c.dfd)})).otherwise(q.hitch(this,function(a){this._errorHandler(a,null,c.dfd)}))},executeRelationshipQuery:function(a,c,d){a=this._encode(q.mixin({},this._url.query,{f:"json"},a.toJson()));var f=this._relationshipQueryHandler,h=this._errorHandler;this.gdbVersion&&
(a.gdbVersion=this.gdbVersion);var e=new E(l._dfdCanceller),g=this.requestOptions,n=this._url.path;this.source&&void 0!==this.source.mapLayerId&&null!==this.source.mapLayerId&&n.endsWith("/dynamicLayer")&&(n=n.slice(0,-13),n=n+"/"+this.source.mapLayerId);e._pendingDfd=b({url:n+"/queryRelatedRecords",content:a,callbackParamName:"callback",timeout:g&&g.timeout,load:function(a,b){f(a,b,c,d,e)},error:function(a){h(a,d,e)}},g);return e},executeForIds:function(a,c,d,f){var h=f.assembly;a=this._encode(q.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(h&&h[0])));var e=this._executeForIdsHandler,g=this._errorHandler;this.source&&(h={source:this.source.toJson()},a.layer=u.toJson(h));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);h=this.requestOptions;return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:h&&h.timeout,load:function(a,b){e(a,b,c,d,f.dfd)},error:function(a){g(a,d,f.dfd)}},h)},executeForCount:function(a,c,d,f){var h=f.assembly;a=this._encode(q.mixin({},
this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(h&&h[0])));var e=this._countHandler,g=this._errorHandler;this.source&&(h={source:this.source.toJson()},a.layer=u.toJson(h));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);h=this.requestOptions;return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:h&&h.timeout,load:function(a,b){e(a,b,c,d,f.dfd)},error:function(a){g(a,d,f.dfd)}},h)},executeForExtent:function(a,c,d,f){var h=f.assembly;a=this._encode(q.mixin({},
this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(h&&h[0])));var e=this._extentHandler,g=this._errorHandler;this.source&&(h={source:this.source.toJson()},a.layer=u.toJson(h));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);h=this.requestOptions;return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",timeout:h&&h.timeout,load:function(a,b){e(a,b,c,d,f.dfd)},error:function(a){g(a,d,f.dfd)}},h)},_handler:function(a,b,c,d,f){try{a&&b&&(a=v.pbfDeps.optimizedFeatures.convertToFeatureSet(v.pbfDeps.pbfQueryUtils.parsePBFFeatureQuery(a)));
var h=new e(a);this._successHandler([h],"onComplete",c,f)}catch(z){this._errorHandler(z,d,f)}},_relationshipQueryHandler:function(a,b,c,d,f){try{var h=a.geometryType,g=a.spatialReference,l={};C.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=h;b.spatialReference=g;b.features=a.relatedRecords;b=new e(b);if(null!=a.objectId)l[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(l[a[c]]=b)});this._successHandler([l],"onExecuteRelationshipQueryComplete",c,f)}catch(p){this._errorHandler(p,
d,f)}},_executeForIdsHandler:function(a,b,c,d,f){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",c,f)}catch(A){this._errorHandler(A,d,f)}},_countHandler:function(a,b,c,d,f){try{var e,h=a.features,g=a.objectIds;if(g)e=g.length;else{if(h)throw Error("Unable to perform query. Please check your parameters.");e=a.count}this._successHandler([e],"onExecuteForCountComplete",c,f)}catch(p){this._errorHandler(p,d,f)}},_extentHandler:function(a,b,c,d,f){try{a.extent&&(a.extent=new g(a.extent)),
this._successHandler([a],"onExecuteForExtentComplete",c,f)}catch(A){this._errorHandler(A,d,f)}}});v.loadPBFReader=function(){var a=new E;v.pbfDeps?a.resolve():r(["./support/pbfDeps"],function(b){v.pbfDeps=b;a.isFulfilled()||a.resolve()});return a.promise};f._createWrappers(v);a("extend-esri")&&q.setObject("tasks.QueryTask",v,c);return v})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(r,m,q){r.DeferredList=function(r,E,u,k,c){var a=[];m.call(this);
var b=this;0!==r.length||E||this.resolve([0,[]]);var l=0;q.forEach(r,function(c,f){function d(c,d){a[f]=[c,d];l++;l===r.length&&b.resolve(a)}c.then(function(a){E?b.resolve([f,a]):d(!0,a)},function(a){u?b.reject(a):d(!1,a);if(k)return null;throw a;})})};r.DeferredList.prototype=new m;r.DeferredList.prototype.gatherResults=function(m){m=new r.DeferredList(m,!1,!0,!1);m.addCallback(function(m){var u=[];q.forEach(m,function(k){u.push(k[1])});return u});return m};return r.DeferredList})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(r,m,q,C,E,u,k,c){r=r(c,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,b){a&&m.isString(a)&&(this._url=k.urlToObject(this.url=a));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;this._errorHandler=m.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},
_encode:function(a,b,c){var g,f,d={},e,l;for(e in a)if("declaredClass"!==e&&(g=a[e],f=typeof g,null!==g&&void 0!==g&&"function"!==f))if(m.isArray(g))for(d[e]=[],l=g.length,f=0;f<l;f++)d[e][f]=this._encode(g[f]);else"object"===f?g.toJson&&(f=g.toJson(c&&c[e]),"esri.tasks.FeatureSet"===g.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),d[e]=b?f:q.toJson(f)):d[e]=g;return d},_successHandler:function(a,b,c,g){b&&this[b].apply(this,a);c&&c.apply(null,a);g&&u._resDfd(g,
a)},_errorHandler:function(a,b,c){this.onError(a);b&&b(a);c&&c.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});C("extend-esri")&&(E.Task=r);return r})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(r,m,q,C,E,u,k,c,a,b,l,g){r=r(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(a,b){if(a){m.mixin(this,a);var d=this.features=this.features||[],f=a.spatialReference,f=this.spatialReference=l.createInstance(c.simpleConstructor,f),B=l.getGeometryType(a.geometryType);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);a=l.supportsLazyUnquantization(this.geometryType);var v=l.unquantizeFunction(this.geometryType,this.transform),n=!!(b&&a&&v),w=B&&(n?B.accessorConstructor:B.simpleConstructor);q.forEach(d,function(a,b){var h=l.createInstance(k.simpleConstructor),
e=a.geometry;if(B&&e){var t=h.geometry=l.createInstance(w,n?null:e);t.setSpatialReference(e.spatialReference?l.createInstance(c.simpleConstructor,e.spatialReference):f);n&&t.setupLazyUnquantization(v,e)}h.symbol=a.symbol?g.fromJson(a.symbol):null;h.attributes=a.attributes;d[b]=h});n||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var c={};this.displayFieldName&&(c.displayFieldName=this.displayFieldName);this.fields&&
(c.fields=this.fields);this.spatialReference?c.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(c.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(c.geometryType=l.getJsonType(this.features[0].geometry)),c.features=a._encodeGraphics(this.features,b));c.geometryType=c.geometryType||this.geometryType;c.exceededTransferLimit=this.exceededTransferLimit;c.transform=this.transform;return u.fixJson(c)},
_hydrate:function(){l.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],c=a.translate[1],f=a.scale[0],g=a.scale[1],l=this.features,n=function(a,b,c){var d,p,f,e,h,g,l=[];d=0;for(p=a.length;d<p;d++)if(f=a[d],0<d){if(g=b(f[0]),f=c(f[1]),g!==e||f!==h)l.push([g-e,f-h]),e=g,h=f}else e=b(f[0]),h=c(f[1]),l.push([e,h]);return 0<l.length?l:null},k=function(a,b,c){if("esriGeometryPoint"===
a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var p,f,d,e,g;d=a.rings||a.paths;g=[];p=0;for(f=d.length;p<f;p++)e=d[p],(e=n(e,b,c))&&g.push(e);return 0<g.length?(a.rings?a.rings=g:a.paths=g,a):null};if("esriGeometryMultipoint"===a)return function(a){var p;p=n(a.points,b,c);return 0<p.length?(a.points=p,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-
b)/f)},function(a){return Math.round((c-a)/g)}),y,x;y=0;for(x=l.length;y<x;y++)l[y].geometry&&(k(l[y].geometry)||l[y].setGeometry(null));this.transform=a;return this}});r.createGraphics=function(a){var b=a.geometryType,f=l.createInstance(c.simpleConstructor,a.spatialReference),g=l.getGeometryType(b).accessorConstructor,B=l.unquantizeFunction(b,a.transform);return q.map(a.features,function(a,b){b=l.createInstance(k.simpleConstructor);var c=a.geometry;if(c){var d=b.geometry=l.createInstance(g);d.setSpatialReference(f);
d.setupLazyUnquantization(B,c)}b.attributes=a.attributes;return b})};r.createPolygon=function(a,c,e){var f;a&&(f=l.createInstance(b.accessorConstructor),f.setSpatialReference(c),c=l.unquantizeFunction("esriGeometryPolygon",e),f.setupLazyUnquantization(c,a));return f};C("extend-esri")&&m.setObject("tasks.FeatureSet",r,E);return r})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(r,m,q,C,E){r=r(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var m={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},k=this.objectIds,c=this.outFields,a=this.outSpatialReference,b=this.orderByFields;k&&(m.objectIds=k.join(","));c&&(m.outFields=c.join(","));
a&&(m.outSR=a.wkid||q.toJson(a.toJson()));b&&(m.orderByFields=b.join(","));m._ts=this._ts;return m}});C("extend-esri")&&m.setObject("tasks.RelationshipQuery",r,E);return r})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(r,m,q,C){r=r(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});q("extend-esri")&&m.setObject("tasks.StatisticDefinition",r,C);return r})},"esri/arcadeProfiles/popupProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(r,m,q,C,E,u,k,c){r=new (r(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore",
"$map"],async:["$layer","$datastore","$map"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any"}}},initialize:function(a){var b=[];c.hasGeometryOperations(a)&&b.push(k.enableGeometryOperations());(c.hasFeatureSetOperations(a)||c.hasVariables(a,this.defaults.globals.featureSet))&&b.push(k.enableFeatureSetOperations());c.isAsync(a)&&b.push(k.enableAsyncOperations());return E(b)},isAsync:function(a){a=[a];return c.hasFeatureSetOperations(a)||c.hasVariables(a,this.defaults.globals.async)},
parse:function(a){return k.createSyntaxTree(a.expression)},compile:function(a){var b=m.clone(this.defaults.context);b.useAsync=a.async;return a.syntaxTree?k.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=a.expression,l=a.feature,g=a.layer,f=a.map;a=a.spatialReference;var l=l&&b.hasVariable("$feature")?u.createFromGraphicLikeObject(l.geometry,l.attributes,g):null,d,e;if(g){var t={spatialReference:a};b.hasVariable("$layer")&&(d=g.getMap()?k.createFeatureSetFromLayer(g,t):k.createFeatureSetFromLayerUrl(g.url,
t));b.hasVariable("$datastore")&&(e=(e=c.getServiceUrl(g.url))?k.createFeatureSetCollectionFromServiceUrl(e,t):null)}b=f&&b.hasVariable("$map")?k.createFeatureSetCollectionFromMap(f):null;return{context:{vars:{$feature:l,$layer:d,$datastore:e,$map:b},spatialReference:a}}}}));q("extend-esri")&&m.setObject("arcadeProfiles.popupProfile",r,C);return r})},"esri/core/timerUtils":function(){define([],function(){function r(m){var k,c=m.length;for(k=0;k<c;k++)m[k]()}var m={LOW:1,HIGH:2},q,C={};C[m.LOW]=[];
C[m.HIGH]=[];var E=function(){clearTimeout(q);q=null;var u=C[m.HIGH];C[m.HIGH]=[];r(u);u=C[m.LOW];C[m.LOW]=[];r(u)};return{priority:m,callbackQueue:C,setTimeout:function(m,k){m=[k,C[k].push(m)-1];q||(q=setTimeout(E,0));return m},clearTimeout:function(m){m&&C[m[0]].splice(m[1],1)}}})},"esri/arcadeProfiles/labelingProfile":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(r,m,q,C,E,u,k,c){r=
new (r(null,{declaredClass:"esri.arcadeProfiles.LabelingProfile",defaults:{context:{vars:{$feature:"any"}}},initialize:function(a){var b=[];c.hasGeometryOperations(a)&&b.push(k.enableGeometryOperations());return E(b)},isAsync:function(a){return!1},parse:function(a){return k.createSyntaxTree(a.expression)},compile:function(a){var b=m.clone(this.defaults.context);return a.syntaxTree?k.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=a.feature;return{context:{vars:{$feature:b&&a.expression.hasVariable("$feature")?
u.createFromGraphicLikeObject(b.geometry,b.attributes,a.layer):null},spatialReference:a.spatialReference}}}}));q("extend-esri")&&m.setObject("arcadeProfiles.labelingProfile",r,C);return r})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(r,m,q,C,E,u){r=r(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=
[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(k,c){this._labelLayer=c;this._xmin=k.extent.xmin;this._xmax=k.extent.xmax;this._ymin=k.extent.ymin;this._ymax=k.extent.ymax;this._scale=(this._xmax-this._xmin)/k.width},_process:function(k){this._preparedLabels=k;this._placedLabels=[];var c;for(k=this._preparedLabels.length-1;0<=k;k--){var a=this._preparedLabels[k],b=Math.min(a.labelWidth,a.labelHeight),
l=a.labelWidth+0*b,b=a.labelHeight+0*b,g=(c=a.options)&&void 0!==c.lineLabelPlacement?c.lineLabelPlacement:"PlaceAtCenter",f=c&&void 0!==c.lineLabelPosition?c.lineLabelPosition:"Above",d=c&&void 0!==c.pointPriorities?c.pointPriorities:"AboveRight",e=[2,2,1,3,0,2,3,3,2];"AboveLeft"==d?e=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==d?e=[2,1,2,2,0,2,3,3,3]:"AboveRight"==d?e=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==d?e=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==d?e=[0,0,0,0,1,0,0,0,0]:"CenterRight"==d?e=[3,2,2,3,0,1,3,2,2]:
"BelowLeft"==d?e=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==d?e=[3,3,3,2,0,2,2,1,2]:"BelowRight"==d&&(e=[3,3,2,3,0,2,2,2,1]);var t=c&&void 0!==c.labelRotation?c.labelRotation:!0,d=Math.PI/180*a.angle;c=c&&void 0!==c.howManyLabels?c.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,d,l,b,a.symbolWidth,a.symbolHeight,e);else if("multipoint"==a.geometry.type)for(g=a.geometry,f=0;f<g.points.length;f++)this._generatePointPositions(a,g.points[f][0],
g.points[f][1],a.text,d,l,b,a.symbolWidth,a.symbolHeight,e);else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,l,b,2*a.symbolHeight+b,g,f,t):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,c,a.geometry,a.text,d,l,b)}return this._placedLabels},_generatePointPositions:function(k,c,a,b,l,g,f,d,e,t){d=(d+g)*this._scale;e=(e+f)*this._scale;var m,v;for(m=1;3>=m;m++)for(v=1;9>=v;v++)if(t[v-1]==m)switch(v){case 1:if(this._findPlace(k,b,c-d,a+e,l,g,f))return;break;
case 2:if(this._findPlace(k,b,c,a+e,l,g,f))return;break;case 3:if(this._findPlace(k,b,c+d,a+e,l,g,f))return;break;case 4:if(this._findPlace(k,b,c-d,a,l,g,f))return;break;case 5:if(this._findPlace(k,b,c,a,l,g,f))return;break;case 6:if(this._findPlace(k,b,c+d,a,l,g,f))return;break;case 7:if(this._findPlace(k,b,c-d,a-e,l,g,f))return;break;case 8:if(this._findPlace(k,b,c,a-e,l,g,f))return;break;case 9:if(this._findPlace(k,b,c+d,a-e,l,g,f))return}},_generateLinePositions:function(k,c,a,b,l,g,f,d,e){var t=
b*this._scale*b*this._scale,m,v,n;for(m=0;m<c.paths.length;m++){var w=c.paths[m],y=w.length,x=Math.floor((y-1)/2),h=0!==(y-1)%2?1:-1;"PlaceAtStart"==f&&(x=0,h=1);"PlaceAtEnd"==f&&(x=y-2,h=-1);for(;0<=x&&x<y-1;){for(v=x;v<y;v++){var A=w[x][0],q=w[x][1],r=w[v][0]-A,p=w[v][1]-q;if(r*r+p*p>t){for(var D=Math.atan2(p,r);D>Math.PI/2;)D-=Math.PI;for(;D<-(Math.PI/2);)D+=Math.PI;var F=Math.sin(D),u=Math.cos(D),G=0,H=0;"Above"==d&&(G=g*F*this._scale,H=g*u*this._scale);"Below"==d&&(G=-g*F*this._scale,H=-g*u*
this._scale);if(1==v-x){if(this._clipLine(A,q,w[v][0],w[v][1])&&(A=this._x1-this._x0,n=this._y1-this._y0,A*A+n*n>t&&(v=Math.atan2(n,A),r=b/2+2*l,q=r*this._scale*Math.cos(v),r=r*this._scale*Math.sin(v),"PlaceAtStart"==f?(A=this._x0+q,n=this._y0+r):"PlaceAtEnd"==f?(A=this._x1-q,n=this._y1-r):(A=this._x0+A/2,n=this._y0+n/2),this._findPlace(k,a,A-G,n+H,e?-v:0,b,l))))return}else{var I=0;for(n=x;n<=v;n++)I=Math.max(I,Math.abs((w[n][1]-q)*u-(w[n][0]-A)*F));if(I<l&&this._findPlace(k,a,A+r/2-G,q+p/2+H,e?-D:
0,b,l))return}break}}x+=h}}},_generatePolygonPositions:function(k,c,a,b,l,g,f){var d;if("ManyLabels"==c)for(c=0;c<a.rings.length;c++)d=a.rings[c],u.prototype.isClockwise(d)&&(d=this._findCentroid(d,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(k,b,d[0],d[1],l,g,f));else{d=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var e=d[1],t=0;for(c=0;10>c;c++){t+=f/4;d=this._findCentroidForFeature(a,this._xmin,e+(t-f/4),this._xmax,e+(t+f/4));if(this._findPlace(k,
b,d[0],d[1],l,g,f))break;d=this._findCentroidForFeature(a,this._xmin,e-(t+f/4),this._xmax,e-(t-f/4));if(this._findPlace(k,b,d[0],d[1],l,g,f))break}}},_findCentroid:function(k,c,a,b,l){var g=k.length,f=[0,0],d=0,e=k[0][0],t=k[0][1];e>b&&(e=b);e<c&&(e=c);t>l&&(t=l);t<a&&(t=a);for(var m=1;m<g-1;m++){var v=k[m][0],n=k[m][1],w=k[m+1][0],y=k[m+1][1];v>b&&(v=b);v<c&&(v=c);n>l&&(n=l);n<a&&(n=a);w>b&&(w=b);w<c&&(w=c);y>l&&(y=l);y<a&&(y=a);var x=(v-e)*(y-t)-(w-e)*(n-t);f[0]+=x*(e+v+w);f[1]+=x*(t+n+y);d+=x}f[0]/=
3*d;f[1]/=3*d;if(isNaN(f[0])||isNaN(f[1]))return f;a=[];this._fillBuffer(k,a,f);f[0]=this._sortBuffer(a,f[0],c,b);return f},_findCentroidForFeature:function(k,c,a,b,l){for(var g,f=0,d=[0,0],e=0;e<k.rings.length;e++){var t=k.rings[e],m=t.length,v=t[0][0],n=t[0][1];v>b&&(v=b);v<c&&(v=c);n>l&&(n=l);n<a&&(n=a);for(g=1;g<m-1;g++){var w=t[g][0],y=t[g][1],x=t[g+1][0],h=t[g+1][1];w>b&&(w=b);w<c&&(w=c);y>l&&(y=l);y<a&&(y=a);x>b&&(x=b);x<c&&(x=c);h>l&&(h=l);h<a&&(h=a);var q=(w-v)*(h-n)-(x-v)*(y-n);d[0]+=q*
(v+w+x);d[1]+=q*(n+y+h);f+=q}}d[0]/=3*f;d[1]/=3*f;if(isNaN(d[0])||isNaN(d[1]))return d;a=[];for(g=0;g<k.rings.length;g++)this._fillBuffer(k.rings[g],a,d);d[0]=this._sortBuffer(a,d[0],c,b);return d},_fillBuffer:function(k,c,a){for(var b=k.length-1,l=k[0][1]>=k[b][1]?1:-1,g=0;g<=b;g++){var f=g,d=g+1;g==b&&(d=0);var e=k[f][0],f=k[f][1],t=k[d][0],d=k[d][1],m=d>=f?1:-1;if(f<=a[1]&&a[1]<=d||d<=a[1]&&a[1]<=f)a[1]!=f&&a[1]!=d?(c.push((a[1]-f)*(t-e)/(d-f)+e),l=m):a[1]==f&&a[1]!=d?(l!=m&&c.push(e),l=m):a[1]!=
f&&a[1]==d?(c.push(t),l=m):a[1]==f&&a[1]==d&&(1==l&&c.push(e),c.push(t),l=m)}},_sortBuffer:function(k,c,a,b){var l=k.length;k.sort();if(0<l){for(var g=0,f=c=0;f<l-1;f+=2){var d=Math.abs(k[f+1]-k[f]);!(k[f]<=a&&k[f+1]<=a||k[f]>=b&&k[f+1]>=b)&&d>g&&(g=d,c=f)}l=k[c];k=k[c+1];l>b&&(l=b);l<a&&(l=a);k>b&&(k=b);k<a&&(k=a);c=(l+k)/2}return c},_findPlace:function(k,c,a,b,l,g,f){if(isNaN(a)||isNaN(b))return!1;for(var d=0;d<this._placedLabels.length;d++){var e=this._placedLabels[d].angle,t=this._placedLabels[d].width*
this._scale,m=this._placedLabels[d].height*this._scale,v=this._placedLabels[d].x-a,n=this._placedLabels[d].y-b;if(0===l&&0===e){if(this._findPlace2(-g*this._scale,-f*this._scale,g*this._scale,f*this._scale,v-t,n-m,v+t,n+m))return!1}else{var w=new E(-g*this._scale,-f*this._scale,g*this._scale,f*this._scale,null),y=0,x=1;0!==l&&(y=Math.sin(l),x=Math.cos(l));var h=v*x-n*y,v=v*y+n*x,e=e-l,y=Math.sin(e),x=Math.cos(e),q=-t*x- -m*y,n=-t*y+-m*x,e=+t*x- -m*y,r=+t*y+-m*x,t=h+q,m=v-n,y=h+e,x=v-r,q=h-q,n=v+n,
h=h-e,v=v+r,e=new u;e.addRing([[t,m],[y,x],[q,n],[h,v],[t,m]]);if(w.intersects(e))return!1}}for(;l>Math.PI/2;)l-=Math.PI;for(;l<-(Math.PI/2);)l+=Math.PI;d={};d.layer=k;d.text=c;d.angle=l;d.x=a;d.y=b;d.width=g;d.height=f;this._placedLabels.push(d);return!0},_findPlace2:function(k,c,a,b,l,g,f,d){return(k>=l&&k<=f||a>=l&&a<=f||k<=l&&a>=f)&&(c>=g&&c<=d||b>=g&&b<=d||c<=g&&b>=d)?!0:!1},_clipLine:function(k,c,a,b){for(var l=this._code(k,c),g=this._code(a,b);0!==l||0!==g;){if(0!==(l&g))return!1;var f=a-k,
d=b-c;0!==l?(k<this._xmin?(c+=d*(this._xmin-k)/f,k=this._xmin):k>this._xmax?(c+=d*(this._xmax-k)/f,k=this._xmax):c<this._ymin?(k+=f*(this._ymin-c)/d,c=this._ymin):c>this._ymax&&(k+=f*(this._ymax-c)/d,c=this._ymax),l=this._code(k,c)):(a<this._xmin?(b+=d*(this._xmin-a)/f,a=this._xmin):a>this._xmax?(b+=d*(this._xmax-a)/f,a=this._xmax):b<this._ymin?(a+=f*(this._ymin-b)/d,b=this._ymin):b>this._ymax&&(a+=f*(this._ymax-b)/d,b=this._ymax),g=this._code(a,b))}this._x0=k;this._y0=c;this._x1=a;this._y1=b;return!0},
_code:function(k,c){var a=0;k<this._xmin&&(a+=8);k>this._xmax&&(a+=4);c<this._ymin&&(a+=2);c>this._ymax&&(a+=1);return a}});q("extend-esri")&&m.setObject("layers.labelLayerUtils.DynamicLabelClass",r,C);return r})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(r,m,q,C,E,u,k){return r(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",
constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(c,a){this._labelLayer=a;this._map=c;this._xmin=c.extent.xmin;this._xmax=c.extent.xmax;this._ymin=c.extent.ymin;this._ymax=c.extent.ymax;this._scale=(this._xmax-this._xmin)/c.width},_process:function(c){var a,b,l,g,f,d,e,t,m;this._preparedLabels=
c;this._placedLabels=[];for(c=this._preparedLabels.length-1;0<=c;c--){a=this._preparedLabels[c];f=a.labelWidth;d=a.labelHeight;t=(e=a.options)&&e.lineLabelPlacement?e.lineLabelPlacement:"PlaceAtCenter";m=e&&e.lineLabelPosition?e.lineLabelPosition:"Above";b=e&&e.labelRotation?e.labelRotation:!0;l=Math.PI/180*a.angle;g=e&&e.howManyLabels?e.howManyLabels:"OneLabel";var v=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,l,f,d,a.symbolWidth,a.symbolHeight,e,
v);else if("multipoint"===a.geometry.type)for(b=0;b<a.geometry.points.length;b++)this._generatePointPositions(a.geometry.points[b][0],a.geometry.points[b][1],a.text,l,f,d,a.symbolWidth,a.symbolHeight,e,v);else if("polyline"===a.geometry.type)if("PlaceAtStart"===t)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,f,d,2*a.symbolHeight+d,t,m,b,v);else if("PlaceAtEnd"===t)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,f,d,2*a.symbolHeight+d,t,m,b,v);else{e=[];var n=a.geometry.getExtent(),
w=this._map.extent;if(n.getWidth()<f*this._scale/this._OVERRUN&&n.getHeight()<f*this._scale/this._OVERRUN)continue;else.5*n.getWidth()<w.getWidth()&&.5*n.getHeight()<w.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,d,2*a.symbolHeight+d,t,m,b,e):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,d,2*a.symbolHeight+d,t,m,b,e);this._postSorting(w,
e,v)}else if("polygon"===a.geometry.type){t=[];for(b=0;b<a.geometry.rings.length;b++)m=a.geometry.rings[b],1<a.geometry.rings.length&&!k.prototype.isClockwise(m)||(e=this._calcRingExtent(m),e.xmax-e.xmin<4*f*this._scale/this._OVERRUN&&e.ymax-e.ymin<4*d*this._scale/this._OVERRUN||t.push(m));t.sort(function(a,b){return b.length-a.length});for(b=0;b<t.length;b++)this._generatePolygonPositionsForManyLabels(t[b],a.geometry.spatialReference,a.text,l,f,d,v)}for(b=0;b<v.length&&(t=v[b].x,m=v[b].y,void 0!==
v[b].angle&&(l=v[b].angle),e=this._findPlace(a,a.text,t,m,l,f,d),"OneLabel"!==g||!e||!this._labelLayer._isWithinScreenArea(new u(t,m,a.geometry.spatialReference)));b++);}return this._placedLabels},_generatePointPositions:function(c,a,b,l,g,f,d,e,t,k){b=t&&t.pointPriorities?t.pointPriorities:"AboveRight";g=(d+g)*this._scale;f=(e+f)*this._scale;switch(b.toLowerCase()){case "aboveleft":c-=g;a+=f;break;case "abovecenter":a+=f;break;case "aboveright":c+=g;a+=f;break;case "centerleft":c-=g;break;case "centercenter":break;
case "centerright":c+=g;break;case "belowleft":c-=g;a-=f;break;case "belowcenter":a-=f;break;case "belowright":c+=g;a-=f;break;default:return}k.push({x:c,y:a})},_generateLinePositionsPlaceAtStart:function(c,a,b,l,g,f,d,e,k,m){d=l*this._scale;var t=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,n,w,y,q,h,r,z,u;for(n=0;n<c.paths.length;n++){var p=c.paths[n],D=d,F=0;for(w=0;w<p.length-1;w++)y=p[w][0],q=p[w][1],h=p[w+1][0],r=p[w+1][1],z=h-y,u=r-q,z=Math.sqrt(z*z+u*u),F+z>
D?(F=this._generatePositionsOnLine(c.spatialReference,a,D,t,F,y,q,h,r,b,l,g,f,e,k,m),D=t):F+=z}},_generateLinePositionsPlaceAtEnd:function(c,a,b,l,g,f,d,e,k,m){d=l*this._scale;var t=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,n,q,y,x,h,r,u,B;for(n=0;n<c.paths.length;n++){var p=c.paths[n],D=d,F=0;for(q=p.length-2;0<=q;q--)y=p[q+1][0],x=p[q+1][1],h=p[q][0],r=p[q][1],u=h-y,B=r-x,u=Math.sqrt(u*u+B*B),F+u>D?(F=this._generatePositionsOnLine(c.spatialReference,a,D,t,F,y,
x,h,r,b,l,g,f,e,k,m),D=t):F+=u}},_generateLinePositionsPlaceAtCenter:function(c,a,b,l,g,f,d,e,k,m,v){var n,t,q,r,h,u,z,B;for(e=0;e<c.paths.length;e++){var p=c.paths[e];if(!(2>p.length)){if(2==p.length){r=p[0];n=p[1];q=r[0];r=r[1];p=n[0];u=n[1];h=(p-q)*(p-q)+(u-r)*(u-r);z=Math.atan2(u-r,p-q);u=Math.cos(z);z=Math.sin(z);p=[];B=q;for(var D=r;(B-q)*(B-q)+(D-r)*(D-r)<h;)p.push([B,D]),B+=b/2*u,D+=b/2*z;p.push(n)}var F=0;for(n=0;n<p.length-1;n++)q=p[n][0],r=p[n][1],h=p[n+1][0],u=p[n+1][1],z=h-q,B=u-r,F+=
Math.sqrt(z*z+B*B);for(n=D=0;n<p.length-1;n++){q=p[n][0];r=p[n][1];h=p[n+1][0];u=p[n+1][1];z=h-q;B=u-r;z=Math.sqrt(z*z+B*B);if(D+z>F/2)break;D+=z}n==p.length-1&&n--;q=p[n][0];r=p[n][1];h=p[n+1][0];u=p[n+1][1];z=h-q;B=u-r;D=F/2-D;z=Math.atan2(B,z);B=q+D*Math.cos(z);z=r+D*Math.sin(z);q=this._angleAndShifts(q,r,h,u,d,k,m);v.push({x:B+q.shiftX,y:z+q.shiftY,angle:q.angle});var F=B,J=z,D=0;for(t=n;t<p.length-1;t++)t==n?(q=F,r=J):(q=p[t][0],r=p[t][1]),h=p[t+1][0],u=p[t+1][1],z=h-q,B=u-r,z=Math.sqrt(z*z+
B*B),D=D+z>b?this._generatePositionsOnLine(c.spatialReference,a,b,b,D,q,r,h,u,l,g,f,d,k,m,v):D+z;D=0;for(t=n;0<=t;t--)t==n?(q=F,r=J):(q=p[t+1][0],r=p[t+1][1]),h=p[t][0],u=p[t][1],z=h-q,B=u-r,z=Math.sqrt(z*z+B*B),D=D+z>b?this._generatePositionsOnLine(c.spatialReference,a,b,b,D,q,r,h,u,l,g,f,d,k,m,v):D+z}}},_generatePositionsOnLine:function(c,a,b,l,g,f,d,e,t,k,m,n,q,r,u,h){k=Math.atan2(t-d,e-f);m=f;n=d;var v=m,w=n;do if(g=b-g,m+=g*Math.cos(k),n+=g*Math.sin(k),this._belongs(m,n,f,d,e,t))g=this._angleAndShifts(f,
d,e,t,q,r,u),b=m+g.shiftX,w=n+g.shiftY,a?this._labelLayer._isWithinScreenArea(new E(b,w,b,w,c))&&h.push({x:b,y:w,angle:g.angle}):h.push({x:b,y:w,angle:g.angle}),v=m,w=n,g=0,b=l;else return c=e-v,t-=w,Math.sqrt(c*c+t*t);while(1)},_postSorting:function(c,a,b){if(c&&0<a.length){var l=.5*(c.xmin+c.xmax);c=.5*(c.ymin+c.ymax);for(var g=a[0].x,f=a[0].y,d=Math.sqrt((g-l)*(g-l)+(f-c)*(f-c)),e=a[0].angle,t=0;t<a.length;t++){var k=a[t].x,m=a[t].y,n=Math.sqrt((k-l)*(k-l)+(m-c)*(m-c));n<d&&(g=k,f=m,d=n,e=a[t].angle)}b.push({x:g,
y:f,angle:e})}},_belongs:function(c,a,b,l,g,f){if(g==b&&f==l)return!1;if(g>b){if(c>g||c<b)return!1}else if(c<g||c>b)return!1;if(f>l){if(a>f||a<l)return!1}else if(a<f||a>l)return!1;return!0},_angleAndShifts:function(c,a,b,l,g,f,d){for(c=Math.atan2(l-a,b-c);c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;l=Math.sin(c);var e=Math.cos(c);b=a=0;"Above"==f&&(a=g*l*this._scale,b=g*e*this._scale);"Below"==f&&(a=-g*l*this._scale,b=-g*e*this._scale);g=[];g.angle=d?-c:0;g.shiftX=-a;g.shiftY=b;return g},
_generatePolygonPositionsForManyLabels:function(c,a,b,l,g,f,d){g=this._findCentroidForRing(c);l=g[0];var e=g[1],k=this._calcRingExtent(c);g=k.xmin;f=k.ymin;var m=k.xmax,k=k.ymax,q=(k-f)/(this._map.height*this._scale);if(!(10<(m-g)/(this._map.width*this._scale)&&10<q)){var n=!0;if(m-g>this._map.width*this._scale||k-f>this._map.height*this._scale)n=!1;var q=this._map.width*this._scale*(n?.1875:.5),n=this._map.height*this._scale*(n?.1875:.5),r=!0,u=!0,x=0;do{e+=(x%2?-1:1)*x*n;if(this._scanRingByX(b,
a,c,l,e,g,m,q,d))break;e<f&&(r=!1);e>k&&(u=!1);x++}while(r||u)}},_scanRingByX:function(c,a,b,l,g,f,d,e,k){var m=!0,t=!0,n=0,q=1E3;do{l+=(n%2?-1:1)*n*e;var r=this._movePointInsideRing(b,l,g),u=this._labelLayer._isWithinScreenArea(new E(r,g,r,g,a)),h=this._isPointWithinRing(c,b,r,g);if(u&&h)return k.push({x:r,y:g}),!0;l<f&&(m=!1);l>d&&(t=!1);n++;q--;if(0>=q)return!0}while(m||t);return!1},_movePointInsideRing:function(c,a,b){for(var l=[],g=c.length-1,f=c[0][1]>=c[g][1]?1:-1,d=0;d<=g;d++){var e=d,k=d+
1;d==g&&(k=0);var m=c[e][0],e=c[e][1],q=c[k][0],k=c[k][1],n=k>=e?1:-1;if(e<=b&&b<=k||k<=b&&b<=e)b!=e&&b!=k?(l.push((b-e)*(q-m)/(k-e)+m),f=n):b==e&&b!=k?(f!=n&&l.push(m),f=n):b!=e&&b==k?(l.push(q),f=n):b==e&&b==k&&(1==f&&l.push(m),l.push(q),f=n)}l.sort(function(a,b){return a-b});c=l.length;if(0<c){for(d=b=a=0;d<c-1;d+=2)g=Math.abs(l[d+1]-l[d]),g>a&&(a=g,b=d);a=(l[b]+l[b+1])/2}return a},_calcRingExtent:function(c){var a,b;b=new E;for(a=0;a<c.length-1;a++){var l=c[a][0],g=c[a][1];if(void 0===b.xmin||
l<b.xmin)b.xmin=l;if(void 0===b.ymin||g<b.ymin)b.ymin=g;if(void 0===b.xmax||l>b.xmax)b.xmax=l;if(void 0===b.ymax||g>b.ymax)b.ymax=g}return b},_isPointWithinPolygon:function(c,a,b,l){var g;for(g=0;g<a.rings.length;g++)if(this._isPointWithinRing(c,a.rings[g],b,l))return!0;return!1},_isPointWithinRing:function(c,a,b,l){var g,f,d,e,k=[],m=a.length;for(c=0;c<m-1;c++)if(g=a[c][0],f=a[c][1],d=a[c+1][0],e=a[c+1][1],g!=d||f!=e){if(f==e)if(l==f)k.push(g);else continue;g==d?(f<e&&l>=f&&l<e&&k.push(g),f>e&&l<=
f&&l>e&&k.push(g)):(f=(d-g)/(e-f)*(l-f)+g,g<d&&f>=g&&f<d&&k.push(f),g>d&&f<=g&&f>d&&k.push(f))}k.sort(function(a,b){return a-b});for(c=0;c<k.length-1;c++)if(g=k[c],d=k[c+1],b>=g&&b<d)if(c%2)break;else return!0;return!1},_findCentroidForRing:function(c){for(var a=c.length,b=[0,0],l=0,g=c[0][0],f=c[0][1],d=1;d<a-1;d++){var e=c[d][0],k=c[d][1],m=c[d+1][0],q=c[d+1][1],n=(e-g)*(q-f)-(m-g)*(k-f);b[0]+=n*(g+e+m);b[1]+=n*(f+k+q);l+=n}b[0]/=3*l;b[1]/=3*l;return b},_findCentroidForFeature:function(c){for(var a=
0,b=[0,0],l=0;l<c.rings.length;l++)for(var g=c.rings[l],f=g.length,d=g[0][0],e=g[0][1],k=1;k<f-1;k++){var m=g[k][0],q=g[k][1],n=g[k+1][0],r=g[k+1][1],u=(m-d)*(r-e)-(n-d)*(q-e);b[0]+=u*(d+m+n);b[1]+=u*(e+q+r);a+=u}b[0]/=3*a;b[1]/=3*a;return b},_findPlace:function(c,a,b,l,g,f,d){if(isNaN(b)||isNaN(l))return!1;for(var e=0;e<this._placedLabels.length;e++){var m=this._placedLabels[e].angle,q=this._placedLabels[e].width*this._scale,r=this._placedLabels[e].height*this._scale,n=this._placedLabels[e].x-b,
u=this._placedLabels[e].y-l;if(0===g&&0===m){if(this._findPlace2(-f*this._scale,-d*this._scale,f*this._scale,d*this._scale,n-q,u-r,n+q,u+r))return!1}else{var y=new E(-f*this._scale,-d*this._scale,f*this._scale,d*this._scale,null),x=0,h=1;0!==g&&(x=Math.sin(g),h=Math.cos(g));var A=n*h-u*x,n=n*x+u*h,m=m-g,x=Math.sin(m),h=Math.cos(m),z=-q*h- -r*x,u=-q*x+-r*h,m=+q*h- -r*x,C=+q*x+-r*h,q=A+z,r=n-u,x=A+m,h=n-C,z=A-z,u=n+u,A=A-m,n=n+C,m=new k;m.addRing([[q,r],[x,h],[z,u],[A,n],[q,r]]);if(y.intersects(m))return!1}}for(;g>
Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;e={};e.layer=c;e.text=a;e.angle=g;e.x=b;e.y=l;e.width=f;e.height=d;this._placedLabels.push(e);return!0},_findPlace2:function(c,a,b,l,g,f,d,e){return(c>=g&&c<=d||b>=g&&b<=d||c<=g&&b>=d)&&(a>=f&&a<=e||l>=f&&l<=e||a<=f&&l>=e)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/i18n!dojo/cldr/nls/number dojo/number dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../ArcadeExpression ../core/timerUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ../renderers/SimpleRenderer ../arcadeProfiles/labelingProfile ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./GraphicsLayer ./LabelClass".split(" "),function(r,
m,q,C,E,u,k,c,a,b,l,g,f,d,e,t,B,v,n,w,y,x,h,A,z){function K(a){return"sizeInfo"===a.type}r=r(A,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=m.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
m.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)C.disconnect(this._mapEventHandlers[a]);this.refresh();d.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,f){if(!this.getFeatureLayer(a.layerId)){var d=[];d.push(a.on("update-end",
m.hitch(this,"refresh")));d.push(a.on("suspend",m.hitch(this,"refresh")));d.push(a.on("resume",m.hitch(this,"refresh")));d.push(a.on("edits-complete",m.hitch(this,"refresh")));d.push(a.on("labeling-info-change",m.hitch(this,"refresh")));d.push(a.on("time-extent-change",m.hitch(this,"refresh")));d.push(a.on("show-labels-change",m.hitch(this,"refresh")));d.push(a.on("feature-reduction-change",m.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:f,
LabelRenderer:b,EventHandlers:d});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=q.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)C.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)C.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=d.setTimeout(this._refreshLabels,d.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,c,d,f,e,g=[],p,l="DYNAMIC"===this._engineType?new x:new h;if(this._map){l.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(c=this.featureLayers[a],c.visible&&c.showLabels&&c.visibleAtMapScale&&!c._suspended)if(b=
this._featureLayerInfos[a],e=this._convertOptions(null),b.LabelRenderer){if(g=c.labelingInfo)if(p=g[0])f=this._getLabelExpression(p),e=this._convertOptions(p);d=b.LabelRenderer;b.LabelExpressionInfo&&(f=b.LabelExpressionInfo);b.LabelingOptions&&(e=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(g=b.LabelingOptions.pointPriorities,e.pointPriorities="above-center"==g||"AboveCenter"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"AboveLeft"==
g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"AboveRight"==g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"BelowCenter"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"BelowLeft"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"BelowRight"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"CenterCenter"==g||"esriServerPointLabelPlacementCenterCenter"==
g?"CenterCenter":"center-left"==g||"CenterLeft"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"CenterRight"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(e.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(e.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(e.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(e.howManyLabels=b.LabelingOptions.howManyLabels));d instanceof z&&(f=this._getLabelExpression(d),d=new w(d.symbol),e=this._convertOptions(d));this._addLabels(c,d,f,e)}else if(g=c.labelingInfo)for(b=g.length-1;0<=b;b--)if(p=g[b])d=new z(p instanceof z?p.toJson():p),f=this._getLabelExpression(p),e=this._convertOptions(p),this._addLabels(c,d,f,e);f=l._process(this._preparedLabels);this.clear();this.drawLabels(this._map,f)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var d=b[c],f=d.x,g=d.y,p=d.text,h=d.angle,k=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation&&k.setAngle(180/Math.PI*h);k.setText(p);k instanceof e&&(p=k.getHeight(),f-=.25*p*this._scale*Math.sin(h),g-=.33*p*this._scale);h=new l(new v(f,g,a.extent.spatialReference));h.setParentGraphic(d.layer.graphic);h.setSymbol(k);this.add(h)}},_addLabels:function(a,b,c,d){var f,g,e,p;if(this._isWithinScaleRange(b.minScale,
b.maxScale)&&c&&""!==c){var h=this._map,l=!a.url&&!h.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(g=a.graphics[f],!1!==g.visible&&!g._suspended){e=g.geometry;if(l){if(!n.canProject(e,h))continue;e=n.project(e,h)}e&&this._isWhere(b.where,g.attributes)&&this._isWithinScreenArea(e)&&(p=this._buildLabelText(c,g,a.fields,d),this._addLabel(p,b,a.renderer,g,d,e,h))}}},_isWithinScreenArea:function(a){a="point"===a.type?new B(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();
if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),f=c[3],g=this._sqlEquation(b[this._removeQuotes(c[4])],
c[5],this._removeQuotes(c[6]));switch(f){case "AND":return d&&g;case "OR":return d||g}}}return!1}catch(I){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-
2);b=a.indexOf("'");c=a.lastIndexOf("'");return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||q.filter(a.visualVariables,K)[0]:null},_addLabel:function(a,b,d,f,g,h,l){var k,p,n,q;if(a&&""!==m.trim(a)&&b){a=a.replace(/[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g," ");k=b.getSymbol(f);k instanceof e?(k=new e(k.toJson()),k.setVerticalAlignment("baseline"),k.setHorizontalAlignment("center")):k=k instanceof t?new t(k.toJson()):new e;
k.setText(a);b.symbol=k;if(n=this._getProportionalSize(b.sizeInfo,f.attributes))k instanceof e?k.setSize(n):k instanceof t&&(k.setWidth(n),k.setHeight(n));q=n=0;if(d){p=d.getSymbol(f);var r=this._getSizeInfo(d);if((d=r?d.getSize(f,{sizeInfo:r,resolution:l.getResolutionInMeters()}):f.size)&&null!==d)n=q=d;else if(p)if("simplemarkersymbol"==p.type)q=n=p.size;else if("picturemarkersymbol"==p.type)n=p.width,q=p.height;else if("simplelinesymbol"==p.type||"cartographiclinesymbol"==p.type)n=p.width}d={};
d.graphic=f;d.options=g;d.geometry=h;d.labelRenderer=b;d.labelSymbol=k;d.labelWidth=k.getWidth()/2;d.labelHeight=k.getHeight()/2;d.symbolWidth=c.normalizedLength(n)/2;d.symbolHeight=c.normalizedLength(q)/2;d.text=a;d.angle=k.angle;this._preparedLabels.push(d)}},_buildLabelText:function(a,c,d,f){if(f.hasExpression)return a=y.getEvalOptions({expression:f.arcadeExpr,feature:c,layer:c.getLayer(),spatialReference:this._map.spatialReference}),c=c.evaluateExpression(f.arcadeExpr,a),b.isDefined(c)?""+c:"";
var e=c.attributes;return a.replace(/{[^}]*}/g,function(a){var c,h=a;for(c=0;c<d.length;c++)if("{"+d[c].name+"}"==a){var h=e[d[c].name],k=d[c].domain;if(k&&m.isObject(k)){if("codedValue"==k.type&&f.useCodedValues)for(c=h,a=0;a<k.codedValues.length;a++)if(k.codedValues[a].code==c){h=k.codedValues[a].name;break}break}k=d[c].type;if(f.fieldInfos){var l=f.fieldInfos;for(c=0;c<l.length;c++)if("{"+l[c].fieldName+"}"==a){a=l[c].format;"esriFieldTypeDate"==k?h=b.substitute({myKey:h},"${myKey}",{format:{myKey:m.mixin({formatType:"DateFormat"},
g.prototype._dateFormatsJson[a&&a.dateFormat||"shortDate"])}}):"esriFieldTypeInteger"!=k&&"esriFieldTypeSingle"!=k&&"esriFieldTypeSmallInteger"!=k&&"esriFieldTypeLong"!=k&&"esriFieldTypeDouble"!=k||!a||(h=u.format(h,{places:a.places}),a.digitSeparator||E.group&&(h=h.replace(new RegExp("\\"+E.group,"g"),"")));break}}break}else h="";return null==h?"":h})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&
(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(a,c){if(!a)return null;c=b.substitute(c,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=
!0,c="shortDate",d=null,g=null,e="",h=!0,k,l;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),g=a.fieldInfos,e=a.labelPlacement,null!=a.useCodedValues&&(b=a.useCodedValues),a=a.labelExpressionInfo)){var m=a.expression;m&&!a.value&&(l=!0,k=new f({expression:m,returnType:"string",profile:y}))}if("always-horizontal"==e||"esriServerPolygonPlacementAlwaysHorizontal"==e)h=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:g,pointPriorities:"above-center"==
e||"esriServerPointLabelPlacementAboveCenter"==e?"AboveCenter":"above-left"==e||"esriServerPointLabelPlacementAboveLeft"==e?"AboveLeft":"above-right"==e||"esriServerPointLabelPlacementAboveRight"==e?"AboveRight":"below-center"==e||"esriServerPointLabelPlacementBelowCenter"==e?"BelowCenter":"below-left"==e||"esriServerPointLabelPlacementBelowLeft"==e?"BelowLeft":"below-right"==e||"esriServerPointLabelPlacementBelowRight"==e?"BelowRight":"center-center"==e||"esriServerPointLabelPlacementCenterCenter"==
e?"CenterCenter":"center-left"==e||"esriServerPointLabelPlacementCenterLeft"==e?"CenterLeft":"center-right"==e||"esriServerPointLabelPlacementCenterRight"==e?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==e||"below-start"==e||"center-start"==e?"PlaceAtStart":"above-end"==e||"below-end"==e||"center-end"==e?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==e||"esriServerLinePlacementAboveAfter"==e||"above-along"==e||"esriServerLinePlacementAboveAlong"==e||"above-before"==e||
"esriServerLinePlacementAboveBefore"==e||"above-start"==e||"esriServerLinePlacementAboveStart"==e||"above-end"==e||"esriServerLinePlacementAboveEnd"==e?"Above":"below-after"==e||"esriServerLinePlacementBelowAfter"==e||"below-along"==e||"esriServerLinePlacementBelowAlong"==e||"below-before"==e||"esriServerLinePlacementBelowBefore"==e||"below-start"==e||"esriServerLinePlacementBelowStart"==e||"below-end"==e||"esriServerLinePlacementBelowEnd"==e?"Below":"center-after"==e||"esriServerLinePlacementCenterAfter"==
e||"center-along"==e||"esriServerLinePlacementCenterAlong"==e||"center-before"==e||"esriServerLinePlacementCenterBefore"==e||"center-start"==e||"esriServerLinePlacementCenterStart"==e||"center-end"==e||"esriServerLinePlacementCenterEnd"==e?"OnLine":"Above",labelRotation:h,howManyLabels:"OneLabel",hasExpression:l,arcadeExpr:k}}});k("extend-esri")&&m.setObject("layers.LabelLayer",r,a);return r});