// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.21/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(n,q,w,C,D,u,m,b,a,d,k,e,f,c,h,g,r,p,l){n=n(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,
_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,c){if(a){q.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var t=this._fieldLabels={},b=this._fieldsMap={};this.info.fieldInfos&&w.forEach(this.info.fieldInfos,function(a){var c=a.fieldName.toLowerCase(),v=this._isExpressionField(c)?this.getExpressionInfo(c):null;t[c]=v?v.title:a.label;b[c]=a},this);this.titleHasRelatedFields=
!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return C.fromJson(C.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var c;w.some(this.info&&this.info.fieldInfos,function(b){b.fieldName===a&&(c=b);return!!c});return c},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,"");a=a.toLowerCase();var c;w.some(this.info.expressionInfos,function(b){b.name.toLowerCase()===a&&
(c=b);return!!c});return c}},getComponents:function(a){var c=this.info,b=new m,d,t;c.fieldInfos&&(t=w.filter(c.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));t&&0<t.length&&(d=this._getRelatedRecords({graphic:a,fieldsInfo:t}));d?d.always(q.hitch(this,function(){b.resolve(this._getPopupValues(a))})):b.resolve(this._getPopupValues(a));return b.promise},getAttachments:function(a){var c=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&c&&c.hasAttachments&&
c.objectIdField&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var c={};w.forEach(a,function(a){c[a.name]={compiledFunc:p.createFunction(a.expression)}});return c},_fetchAttributes:function(a){var c=q.clone(a.attributes)||{},b=this._exprPrefix,e=this._exprCache;w.forEach(this.info.expressionInfos,function(f){var t=b+f.name;f=e[f.name];f=p.executeFunction(f&&f.compiledFunc,p.createExecContext(a,
a._getViewInfo()));"string"===typeof f&&(f=d.encode(f));c[t]=f});return c},_getPopupValues:function(a,c){var b=this.info,f=a.getSourceLayer(),d=this._fetchAttributes(a),e=q.clone(d),v=b.fieldInfos,t="",h="",y,g,l,p,r,m=f&&f._getDateOpts&&f._getDateOpts().properties,m=m&&m.slice(0),u={dateFormat:{properties:m,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(p in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(p)){var D=this._relatedInfo[p],
n=this._relatedLayersInfo[p];D&&(w.forEach(D.relatedFeatures,function(a){for(r in a.attributes)if(a.attributes.hasOwnProperty(r)&&"esriRelCardinalityOneToOne"===n.relation.cardinality){var c=this._toRelatedFieldName([n.relation.id,r]);d[c]=e[c]=a.attributes[r]}},this),w.forEach(D.relatedStatsFeatures,function(a){for(r in a.attributes)if(a.attributes.hasOwnProperty(r)){var c=this._toRelatedFieldName([n.relation.id,r]);d[c]=e[c]=a.attributes[r]}},this))}v&&w.forEach(v,function(a){g=a.fieldName;var c=
this._getLayerFieldInfo(f,g);c&&(g=a.fieldName=c.name);e[g]=this._formatValue(e[g],g,u);m&&a.format&&a.format.dateFormat&&(a=w.indexOf(m,g),-1<a&&m.splice(a,1))},this);if(f){p=f.types;var C=(D=f.typeIdField)&&d[D];for(g in d)if(d.hasOwnProperty(g)&&-1===g.indexOf(this._relatedFieldPrefix)&&(l=d[g],k.isDefined(l))){var J=this._getDomainName(f,a,p,C,g,l);k.isDefined(J)?e[g]=J:g===D&&(J=this._getTypeName(f,a,l),k.isDefined(J)&&(e[g]=J))}}b.title&&(t=this._processFieldsInLinks(this._fixTokens(b.title,
f),d),t=q.trim(k.substitute(e,t,u)||""));if(c)return{title:t};b.description&&(h=this._processFieldsInLinks(this._fixTokens(b.description,f),d),h=q.trim(k.substitute(e,h,u)||""));v&&(y=[],w.forEach(v,function(a){(g=a.fieldName)&&a.visible&&y.push([this._fieldLabels[g.toLowerCase()]||g,k.substitute(e,"${"+g+"}",u)||""])},this));var K,L;b.mediaInfos&&(K=[],w.forEach(b.mediaInfos,function(a){L=0;l=a.value;switch(a.type){case "image":var c=l.sourceURL,c=c&&q.trim(k.substitute(d,this._fixTokens(c,f)));
L=!!c;break;case "piechart":case "linechart":case "columnchart":case "barchart":var b,c=l.normalizeField;l.fields=w.map(l.fields,function(a){return(b=this._getLayerFieldInfo(f,a))?b.name:a},this);c&&(b=this._getLayerFieldInfo(f,c),l.normalizeField=b?b.name:c);L=w.some(l.fields,function(a){return k.isDefined(d[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(L){a=q.clone(a);l=a.value;var c=a.title?this._processFieldsInLinks(this._fixTokens(a.title,f),
d):"",v=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,f),d):"";a.title=c?q.trim(k.substitute(e,c,u)||""):"";a.caption=v?q.trim(k.substitute(e,v,u)||""):"";if("image"===a.type)l.sourceURL=k.substitute(d,this._fixTokens(l.sourceURL,f)),l.linkURL&&(l.linkURL=q.trim(k.substitute(d,this._fixTokens(l.linkURL,f))||""));else{var t,h;w.forEach(l.fields,function(a,c){if(-1!==a.indexOf(this._relatedFieldPrefix))h=this._getRelatedChartInfos(a,l,d,u),h instanceof Array?l.fields=h:l.fields[c]=
h;else{var b=d[a],b=void 0===b?null:b;t=d[l.normalizeField]||0;b&&t&&(b/=t);l.fields[c]={y:b,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(b,a,u,!!t)}}},this)}K.push(a)}},this));return{title:t,description:h,hasDescription:!!b.description,fields:y&&y.length?y:null,mediaInfos:K&&K.length?K:null,formatted:e,editSummary:f&&f.getEditSummary?f.getEditSummary(a):""}},_getRelatedChartInfos:function(a,c,b,f){var d,e,v,t,h,g;d=[];g=this._fromRelatedFieldName(a);h=g[0];e=this._relatedInfo[h];
h=this._relatedLayersInfo[h];e&&w.forEach(e.relatedFeatures,function(e){e=e.attributes;var h,y;for(y in e)if(e.hasOwnProperty(y)&&y===g[1]){h={};t=e[y];c.normalizeField&&(v=-1!==c.normalizeField.indexOf(this._relatedFieldPrefix)?e[this._fromRelatedFieldName(c.normalizeField)[1]]:b[c.normalizeField]);t&&v&&(t/=v);if(c.tooltipField)if(-1!==c.tooltipField.indexOf(this._relatedFieldPrefix)){var l=this._fromRelatedFieldName(c.tooltipField)[1],A=k.isDefined(e[l])?e[l]:l;h.tooltip=A+":\x3cbr/\x3e"+this._formatValue(t,
l,f,!!v)}else h.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(t,c.tooltipField,f,!!v);else h.tooltip=t;h.y=t;d.push(h)}},this);return"esriRelCardinalityOneToMany"===h.relation.cardinality||"esriRelCardinalityManyToMany"===h.relation.cardinality?d:d[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,
_fixTokens:function(a,c){var b=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,f,d){a=b._getLayerFieldInfo(c,d);return"$"+(a?"{"+a.name+"}":f)})},_encodeAttributes:function(a){a=q.clone(a)||{};var c,b;for(c in a)(b=a[c])&&"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),a[c]=b);return a},_processFieldsInLinks:function(a,c){var b=this._encodeAttributes(c),f=this;a&&(a=a.replace(this._reHref,function(a,d){return f._addValuesToHref(a,d,c,b)}).replace(this._reHrefApos,function(a,
d){return f._addValuesToHref(a,d,c,b)}));return a},_addValuesToHref:function(a,c,b,f){c=c&&q.trim(c);return k.substitute(c&&0===c.indexOf("${")?b:f,a)},_getLayerFieldInfo:function(a,c){return a&&a.getField?a.getField(c):null},_formatValue:function(a,c,b,f){var d=this._fieldsMap[c.toLowerCase()],e=d&&d.format;c=-1!==w.indexOf(b.dateFormat.properties,c);var v="number"===typeof a&&!c&&(!e||!e.dateFormat);if(!k.isDefined(a)||!d||!k.isDefined(e))return v?this._forceLTR(a):a;var h="",d=[],g=e.hasOwnProperty("places")||
e.hasOwnProperty("digitSeparator"),t=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(g&&!c)h="NumberFormat",d.push("places: "+(k.isDefined(e.places)&&(!f||0<e.places)?Number(e.places):"Infinity")),d.length&&(h+="("+d.join(",")+")");else if(e.dateFormat)h="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return v?this._forceLTR(a):a;var y=this._applyFormatting(a,h,b);g&&-1<a.constructor.toString().indexOf("Array")&&(y="",w.forEach(a,
q.hitch(this,function(a,c){c&&(y+=" ");y+=this._applyFormatting(a,h,b)})));g&&!t&&l.group&&(y=y.replace(new RegExp("\\"+l.group,"g"),""));c&&(y='\x3cspan class\x3d"esriDateValue"\x3e'+y+"\x3c/span\x3e");return v?this._forceLTR(y):y},_applyFormatting:function(a,c,b){return k.substitute({myKey:a},"${myKey:"+c+"}",b)||""},_forceLTR:function(a){var c=b("ie");return c&&10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=k.isDefined(this.utcOffset)?a.replace(/\)\s*$/,
", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,c,b,d,f,e){return(a=a.getDomain&&a.getDomain(f,{feature:c}))&&a.codedValues?a.getName(e):null},_getTypeName:function(a,c,b){return(a=a.getType&&a.getType(c))&&a.name},_getRelatedRecords:function(a){var c=a.graphic,b=new m,d;this._relatedLayersInfo?this._queryRelatedLayers(c).then(q.hitch(this,function(a){this._setRelatedRecords(c,a);b.resolve(a)}),q.hitch(this,this._handlerErrorResponse,b)):this._getRelatedLayersInfo(a).then(q.hitch(this,
function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=a[d]);this._queryRelatedLayers(c).then(q.hitch(this,function(a){this._setRelatedRecords(c,a);b.resolve(a)}),q.hitch(this,this._handlerErrorResponse,b))}),q.hitch(this,this._handlerErrorResponse,b));return b.promise},_getRelatedLayersInfo:function(c){var b=c.fieldsInfo,d,e,h={};d=c.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});w.forEach(b,function(a){var c,b,e,f;c=this._fromRelatedFieldName(a.fieldName);
b=c[0];c=c[1];b&&(this._relatedLayersInfo[b]||(w.some(d.relationships,function(a){if(a.id==b)return f=a,!0}),f&&(this._relatedLayersInfo[b]={relation:f,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[b]&&(this._relatedLayersInfo[b].relatedFields.push(c),a.statisticType&&(e=new r,e.statisticType=a.statisticType,e.onStatisticField=c,e.outStatisticFieldName=c,this._relatedLayersInfo[b].outStatistics.push(e))))},this);for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&
this._relatedLayersInfo[e]&&(c=this._relatedLayersInfo[e].relation,c=d.url.replace(/[0-9]+$/,c.relatedTableId),this._relatedLayersInfo[e].relatedLayerUrl=c,h[e]=f({url:c,content:{f:"json"},callbackParamName:"callback"}));return a(h)},_queryRelatedLayers:function(c){var b={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(b[d]=this._queryRelatedLayer({graphic:c,relatedInfo:this._relatedLayersInfo[d]}));return a(b)},_queryRelatedLayer:function(b){var d,e,f,g,k,v,l,t,p,
r,F,H,I;d=b.graphic;e=d.getSourceLayer();f=e.url.match(/[0-9]+$/g)[0];F=b.relatedInfo;r=F.relatedLayerInfo;H=F.relatedLayerUrl;b=F.relation;w.some(r.relationships,function(a){if(a.relatedTableId===parseInt(f,10))return g=a,!0},this);g&&(k=new c,w.some(r.fields,function(a){if(a.name===g.keyField)return t=-1!==w.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),g.relationshipTableId&&g.keyFieldInRelationshipTable?
(I=new m,this._queryRelatedRecords(d,g).then(q.hitch(this,function(a){var b;b=a[d.attributes[e.objectIdField]];a=w.map(b.features,function(a){return a.attributes[r.objectIdField]},this);F.outStatistics&&0<F.outStatistics.length&&r.supportsStatistics&&(p=new c,p.objectIds=a,p.outFields=k.outFields,p.outStatistics=F.outStatistics);p&&(v=new h(H),v.execute(p).then(q.hitch(this,function(a){var c=[];c.push(b);c.push(a);I.resolve(c)})))}))):(l="string"===t?g.keyField+"\x3d'"+d.attributes[b.keyField]+"'":
g.keyField+"\x3d"+d.attributes[b.keyField],k.where=l,k.outFields=F.relatedFields,F.outStatistics&&0<F.outStatistics.length&&r.supportsStatistics&&(p=new c,p.where=k.where,p.outFields=k.outFields,p.outStatistics=F.outStatistics),v=new h(H),l=[],l.push(v.execute(k)),p&&l.push(v.execute(p))));return l?a(l):I?I.promise:void 0},_setRelatedRecords:function(a,c){this._relatedInfo=[];for(var b in c)if(c.hasOwnProperty(b)&&c[b]){var d=c[b];this._relatedInfo[b]={};this._relatedInfo[b].relatedFeatures=d[0].features;
k.isDefined(d[1])&&(this._relatedInfo[b].relatedStatsFeatures=d[1].features)}},_handlerErrorResponse:function(a,c){a.reject(c)},_fromRelatedFieldName:function(a){var c=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),c=a.slice(1));return c},_toRelatedFieldName:function(a){var c="";a&&0<a.length&&(c=this._relatedFieldPrefix+a[0]+"/"+a[1]);return c},_queryRelatedRecords:function(a,c){var b=a.getSourceLayer(),d=new g;d.outFields=["*"];d.relationshipId=c.id;d.objectIds=[a.attributes[b.objectIdField]];
return b.queryRelatedFeatures(d)}});u("extend-esri")&&(e.PopupInfo=e.PopupInfoTemplate=n);return n})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var q=n.getObject("dojox.html.entities",!0),w=function(q,u){var m,b;if(u._encCache&&u._encCache.regexp&&u._encCache.mapper&&u.length==u._encCache.length)m=u._encCache.mapper,b=u._encCache.regexp;else{m={};b=["["];var a;for(a=0;a<u.length;a++)m[u[a][0]]="\x26"+u[a][1]+";",b.push(u[a][0]);b.push("]");b=new RegExp(b.join(""),"g");
u._encCache={mapper:m,regexp:b,length:u.length}}return q=q.replace(b,function(a){return m[a]})},C=function(q,u){var m,b;if(u._decCache&&u._decCache.regexp&&u._decCache.mapper&&u.length==u._decCache.length)m=u._decCache.mapper,b=u._decCache.regexp;else{m={};b=["("];var a;for(a=0;a<u.length;a++){var d="\x26"+u[a][1]+";";a&&b.push("|");m[d]=u[a][0];b.push(d)}b.push(")");b=new RegExp(b.join(""),"g");u._decCache={mapper:m,regexp:b,length:u.length}}return q=q.replace(b,function(a){return m[a]})};q.html=
[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];q.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],
["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1",
"Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb",
"euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],
["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],
["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c",
"real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],
["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],
["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],
["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];q.encode=function(n,u){n&&(u?n=w(n,u):(n=w(n,q.html),n=w(n,q.latin)));return n};q.decode=function(n,u){n&&(u?n=C(n,u):(n=C(n,q.html),n=C(n,q.latin)));return n};return q})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(n,q,w,C,D,u,m,b,a,d,k,e,f){n=n(e,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,b){this._handler=q.hitch(this,this._handler);this._relationshipQueryHandler=q.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=q.hitch(this,this._executeForIdsHandler);this._countHandler=q.hitch(this,this._countHandler);
this._extentHandler=q.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(a,d,e,f,k){var c=k.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json"},a.toJson(c&&c[0])));var h=this._handler,g=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=D.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){h(a,c,d,e,k.dfd)},error:function(a){g(a,e,k.dfd)},callbackSuffix:f},this.requestOptions)},executeRelationshipQuery:function(c,
d,e){c=this._encode(q.mixin({},this._url.query,{f:"json"},c.toJson()));var f=this._relationshipQueryHandler,h=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var g=new C(a._dfdCanceller);g._pendingDfd=b({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(a,c){f(a,c,d,e,g)},error:function(a){h(a,e,g)}},this.requestOptions);return g},executeForIds:function(a,d,e,f){var c=f.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
a.toJson(c&&c[0])));var h=this._executeForIdsHandler,g=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=D.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){h(a,c,d,e,f.dfd)},error:function(a){g(a,e,f.dfd)}},this.requestOptions)},executeForCount:function(a,d,e,f){var c=f.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(c&&
c[0])));var h=this._countHandler,g=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=D.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){h(a,c,d,e,f.dfd)},error:function(a){g(a,e,f.dfd)}},this.requestOptions)},executeForExtent:function(a,d,e,f){var c=f.assembly;a=this._encode(q.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(c&&c[0])));
var h=this._extentHandler,g=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=D.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){h(a,c,d,e,f.dfd)},error:function(a){g(a,e,f.dfd)}},this.requestOptions)},_handler:function(a,b,d,e,k){try{var c=new f(a);this._successHandler([c],"onComplete",d,k)}catch(t){this._errorHandler(t,e,k)}},_relationshipQueryHandler:function(a,b,d,e,
k){try{var c=a.geometryType,h=a.spatialReference,g={};w.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=c;b.spatialReference=h;b.features=a.relatedRecords;b=new f(b);if(null!=a.objectId)g[a.objectId]=b;else for(var d in a)a.hasOwnProperty(d)&&"relatedRecords"!==d&&(g[a[d]]=b)});this._successHandler([g],"onExecuteRelationshipQueryComplete",d,k)}catch(A){this._errorHandler(A,e,k)}},_executeForIdsHandler:function(a,b,d,e,f){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
d,f)}catch(l){this._errorHandler(l,e,f)}},_countHandler:function(a,b,d,e,f){try{var c,h=a.features,g=a.objectIds;if(g)c=g.length;else{if(h)throw Error("Unable to perform query. Please check your parameters.");c=a.count}this._successHandler([c],"onExecuteForCountComplete",d,f)}catch(A){this._errorHandler(A,e,f)}},_extentHandler:function(a,b,e,f,k){try{a.extent&&(a.extent=new d(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",e,k)}catch(l){this._errorHandler(l,f,k)}}});k._createWrappers(n);
u("extend-esri")&&q.setObject("tasks.QueryTask",n,m);return n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,q,w,C,D,u,m,b){n=n(b,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,b){a&&q.isString(a)&&(this._url=m.urlToObject(this.url=a));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;
this._errorHandler=q.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},_encode:function(a,b,k){var d,f,c={},h,g;for(h in a)if("declaredClass"!==h&&(d=a[h],f=typeof d,null!==d&&void 0!==d&&"function"!==f))if(q.isArray(d))for(c[h]=[],g=d.length,f=0;f<g;f++)c[h][f]=this._encode(d[f]);else"object"===f?d.toJson&&(f=d.toJson(k&&k[h]),"esri.tasks.FeatureSet"===
d.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),c[h]=b?f:w.toJson(f)):c[h]=d;return c},_successHandler:function(a,b,k,e){b&&this[b].apply(this,a);k&&k.apply(null,a);e&&u._resDfd(e,a)},_errorHandler:function(a,b,k){this.onError(a);b&&b(a);k&&k.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});C("extend-esri")&&(D.Task=n);return n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(n,q,w,C,D,u,m,b,a,d,k){n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){q.mixin(this,a);var f=this.features,c=a.spatialReference,e=d.getGeometryType(a.geometryType),c=this.spatialReference=new b(c);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);w.forEach(f,function(a,b){var d=a.geometry&&a.geometry.spatialReference;f[b]=new m(e&&a.geometry?new e(a.geometry):null,a.symbol&&k.fromJson(a.symbol),a.attributes);f[b].geometry&&!d&&f[b].geometry.setSpatialReference(c)});
this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var f={};this.displayFieldName&&(f.displayFieldName=this.displayFieldName);this.fields&&(f.fields=this.fields);this.spatialReference?f.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(f.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(f.geometryType=
d.getJsonType(this.features[0].geometry)),f.features=a._encodeGraphics(this.features,b));f.exceededTransferLimit=this.exceededTransferLimit;f.transform=this.transform;return u.fixJson(f)},_hydrate:function(){var a=this.transform,b=this.geometryType;if(a&&b)for(var c=this.features,d=a.translate[0],k=a.translate[1],m=a.scale[0],p=a.scale[1],l=function(a,c,b){if("esriGeometryPoint"===a)return function(a){a.x=c(a.x);a.y=b(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=
a.rings||a.paths;var d,f,e,h,k,g,l,p;d=0;for(f=a.length;d<f;d++)for(k=a[d],e=0,h=k.length;e<h;e++)g=k[e],0<e?(l+=g[0],p+=g[1]):(l=g[0],p=g[1]),g[0]=c(l),g[1]=b(p)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=c(a.xmin);a.ymin=b(a.ymin);a.xmax=c(a.xmax);a.ymax=b(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,f,e,h,k;d=0;for(f=a.length;d<f;d++)e=a[d],0<d?(h+=e[0],k+=e[1]):(h=e[0],k=e[1]),e[0]=c(h),e[1]=b(k)}}(b,function(a){return a*m+d},function(a){return k-
a*p}),a=0,b=c.length;a<b;a++)c[a].geometry&&l(c[a].geometry);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],c=a.translate[1],d=a.scale[0],e=a.scale[1],k=this.features,p=function(a,c,b){var d,f,e,k,h,g,l=[];d=0;for(f=a.length;d<f;d++)if(e=a[d],0<d){if(g=c(e[0]),e=b(e[1]),g!==k||e!==h)l.push([g-k,e-h]),k=g,h=e}else k=c(e[0]),h=b(e[1]),l.push([k,h]);return 0<l.length?l:null},l=function(a,c,b){if("esriGeometryPoint"===a)return function(a){a.x=
c(a.x);a.y=b(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,f,e,k,h;e=a.rings||a.paths;h=[];d=0;for(f=e.length;d<f;d++)k=e[d],(k=p(k,c,b))&&h.push(k);return 0<h.length?(a.rings?a.rings=h:a.paths=h,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=p(a.points,c,b);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-b)/d)},function(a){return Math.round((c-
a)/e)}),m,y;m=0;for(y=k.length;m<y;m++)k[m].geometry&&(l(k[m].geometry)||k[m].setGeometry(null));this.transform=a;return this}});C("extend-esri")&&q.setObject("tasks.FeatureSet",n,D);return n})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,q,w,C,D){n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,
outFields:null,toJson:function(){var q={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},m=this.objectIds,b=this.outFields,a=this.outSpatialReference;m&&(q.objectIds=m.join(","));b&&(q.outFields=b.join(","));a&&(q.outSR=a.wkid||w.toJson(a.toJson()));q._ts=this._ts;return q}});C("extend-esri")&&q.setObject("tasks.RelationshipQuery",n,D);return n})},
"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,q,w,C){n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});w("extend-esri")&&q.setObject("tasks.StatisticDefinition",
n,C);return n})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(n,q,w,C,D,u){n=n(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(m,b){this._labelLayer=
b;this._xmin=m.extent.xmin;this._xmax=m.extent.xmax;this._ymin=m.extent.ymin;this._ymax=m.extent.ymax;this._scale=(this._xmax-this._xmin)/m.width},_process:function(m){this._preparedLabels=m;this._placedLabels=[];var b;for(m=this._preparedLabels.length-1;0<=m;m--){var a=this._preparedLabels[m],d=Math.min(a.labelWidth,a.labelHeight),k=a.labelWidth+0*d,d=a.labelHeight+0*d,e=(b=a.options)&&void 0!==b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",f=b&&void 0!==b.lineLabelPosition?b.lineLabelPosition:
"Above",c=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",h=[2,2,1,3,0,2,3,3,2];"AboveLeft"==c?h=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==c?h=[2,1,2,2,0,2,3,3,3]:"AboveRight"==c?h=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==c?h=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==c?h=[0,0,0,0,1,0,0,0,0]:"CenterRight"==c?h=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==c?h=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==c?h=[3,3,3,2,0,2,2,1,2]:"BelowRight"==c&&(h=[3,3,2,3,0,2,2,2,1]);var g=b&&void 0!==b.labelRotation?b.labelRotation:!0,c=Math.PI/
180*a.angle;b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,c,k,d,a.symbolWidth,a.symbolHeight,h);else if("multipoint"==a.geometry.type)for(e=a.geometry,f=0;f<e.points.length;f++)this._generatePointPositions(a,e.points[f][0],e.points[f][1],a.text,c,k,d,a.symbolWidth,a.symbolHeight,h);else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,k,d,2*a.symbolHeight+d,e,f,g):"polygon"==
a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,c,k,d)}return this._placedLabels},_generatePointPositions:function(m,b,a,d,k,e,f,c,h,g){c=(c+e)*this._scale;h=(h+f)*this._scale;var r,p;for(r=1;3>=r;r++)for(p=1;9>=p;p++)if(g[p-1]==r)switch(p){case 1:if(this._findPlace(m,d,b-c,a+h,k,e,f))return;break;case 2:if(this._findPlace(m,d,b,a+h,k,e,f))return;break;case 3:if(this._findPlace(m,d,b+c,a+h,k,e,f))return;break;case 4:if(this._findPlace(m,d,b-c,a,k,e,f))return;break;case 5:if(this._findPlace(m,
d,b,a,k,e,f))return;break;case 6:if(this._findPlace(m,d,b+c,a,k,e,f))return;break;case 7:if(this._findPlace(m,d,b-c,a-h,k,e,f))return;break;case 8:if(this._findPlace(m,d,b,a-h,k,e,f))return;break;case 9:if(this._findPlace(m,d,b+c,a-h,k,e,f))return}},_generateLinePositions:function(m,b,a,d,k,e,f,c,h){var g=d*this._scale*d*this._scale,r,p,l;for(r=0;r<b.paths.length;r++){var t=b.paths[r],y=t.length,A=Math.floor((y-1)/2),q=0!==(y-1)%2?1:-1;"PlaceAtStart"==f&&(A=0,q=1);"PlaceAtEnd"==f&&(A=y-2,q=-1);for(;0<=
A&&A<y-1;){for(p=A;p<y;p++){var n=t[A][0],x=t[A][1],v=t[p][0]-n,z=t[p][1]-x;if(v*v+z*z>g){for(var B=Math.atan2(z,v);B>Math.PI/2;)B-=Math.PI;for(;B<-(Math.PI/2);)B+=Math.PI;var E=Math.sin(B),u=Math.cos(B),F=0,H=0;"Above"==c&&(F=e*E*this._scale,H=e*u*this._scale);"Below"==c&&(F=-e*E*this._scale,H=-e*u*this._scale);if(1==p-A){if(this._clipLine(n,x,t[p][0],t[p][1])&&(n=this._x1-this._x0,l=this._y1-this._y0,n*n+l*l>g&&(p=Math.atan2(l,n),v=d/2+2*k,x=v*this._scale*Math.cos(p),v=v*this._scale*Math.sin(p),
"PlaceAtStart"==f?(n=this._x0+x,l=this._y0+v):"PlaceAtEnd"==f?(n=this._x1-x,l=this._y1-v):(n=this._x0+n/2,l=this._y0+l/2),this._findPlace(m,a,n-F,l+H,h?-p:0,d,k))))return}else{var I=0;for(l=A;l<=p;l++)I=Math.max(I,Math.abs((t[l][1]-x)*u-(t[l][0]-n)*E));if(I<k&&this._findPlace(m,a,n+v/2-F,x+z/2+H,h?-B:0,d,k))return}break}}A+=q}}},_generatePolygonPositions:function(m,b,a,d,k,e,f){var c;if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)c=a.rings[b],u.prototype.isClockwise(c)&&(c=this._findCentroid(c,this._xmin,
this._ymin,this._xmax,this._ymax),this._findPlace(m,d,c[0],c[1],k,e,f));else{c=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var h=c[1],g=0;for(b=0;10>b;b++){g+=f/4;c=this._findCentroidForFeature(a,this._xmin,h+(g-f/4),this._xmax,h+(g+f/4));if(this._findPlace(m,d,c[0],c[1],k,e,f))break;c=this._findCentroidForFeature(a,this._xmin,h-(g+f/4),this._xmax,h-(g-f/4));if(this._findPlace(m,d,c[0],c[1],k,e,f))break}}},_findCentroid:function(m,b,a,d,k){var e=m.length,f=[0,0],c=
0,h=m[0][0],g=m[0][1];h>d&&(h=d);h<b&&(h=b);g>k&&(g=k);g<a&&(g=a);for(var r=1;r<e-1;r++){var p=m[r][0],l=m[r][1],t=m[r+1][0],y=m[r+1][1];p>d&&(p=d);p<b&&(p=b);l>k&&(l=k);l<a&&(l=a);t>d&&(t=d);t<b&&(t=b);y>k&&(y=k);y<a&&(y=a);var A=(p-h)*(y-g)-(t-h)*(l-g);f[0]+=A*(h+p+t);f[1]+=A*(g+l+y);c+=A}f[0]/=3*c;f[1]/=3*c;if(isNaN(f[0])||isNaN(f[1]))return f;a=[];this._fillBuffer(m,a,f);f[0]=this._sortBuffer(a,f[0],b,d);return f},_findCentroidForFeature:function(m,b,a,d,k){for(var e,f=0,c=[0,0],h=0;h<m.rings.length;h++){var g=
m.rings[h],r=g.length,p=g[0][0],l=g[0][1];p>d&&(p=d);p<b&&(p=b);l>k&&(l=k);l<a&&(l=a);for(e=1;e<r-1;e++){var t=g[e][0],y=g[e][1],A=g[e+1][0],n=g[e+1][1];t>d&&(t=d);t<b&&(t=b);y>k&&(y=k);y<a&&(y=a);A>d&&(A=d);A<b&&(A=b);n>k&&(n=k);n<a&&(n=a);var q=(t-p)*(n-l)-(A-p)*(y-l);c[0]+=q*(p+t+A);c[1]+=q*(l+y+n);f+=q}}c[0]/=3*f;c[1]/=3*f;if(isNaN(c[0])||isNaN(c[1]))return c;a=[];for(e=0;e<m.rings.length;e++)this._fillBuffer(m.rings[e],a,c);c[0]=this._sortBuffer(a,c[0],b,d);return c},_fillBuffer:function(m,b,
a){for(var d=m.length-1,k=m[0][1]>=m[d][1]?1:-1,e=0;e<=d;e++){var f=e,c=e+1;e==d&&(c=0);var h=m[f][0],f=m[f][1],g=m[c][0],c=m[c][1],r=c>=f?1:-1;if(f<=a[1]&&a[1]<=c||c<=a[1]&&a[1]<=f)a[1]!=f&&a[1]!=c?(b.push((a[1]-f)*(g-h)/(c-f)+h),k=r):a[1]==f&&a[1]!=c?(k!=r&&b.push(h),k=r):a[1]!=f&&a[1]==c?(b.push(g),k=r):a[1]==f&&a[1]==c&&(1==k&&b.push(h),b.push(g),k=r)}},_sortBuffer:function(m,b,a,d){var k=m.length;m.sort();if(0<k){for(var e=0,f=b=0;f<k-1;f+=2){var c=Math.abs(m[f+1]-m[f]);!(m[f]<=a&&m[f+1]<=a||
m[f]>=d&&m[f+1]>=d)&&c>e&&(e=c,b=f)}k=m[b];m=m[b+1];k>d&&(k=d);k<a&&(k=a);m>d&&(m=d);m<a&&(m=a);b=(k+m)/2}return b},_findPlace:function(m,b,a,d,k,e,f){if(isNaN(a)||isNaN(d))return!1;for(var c=0;c<this._placedLabels.length;c++){var h=this._placedLabels[c].angle,g=this._placedLabels[c].width*this._scale,r=this._placedLabels[c].height*this._scale,p=this._placedLabels[c].x-a,l=this._placedLabels[c].y-d;if(0===k&&0===h){if(this._findPlace2(-e*this._scale,-f*this._scale,e*this._scale,f*this._scale,p-g,
l-r,p+g,l+r))return!1}else{var t=new D(-e*this._scale,-f*this._scale,e*this._scale,f*this._scale,null),y=0,A=1;0!==k&&(y=Math.sin(k),A=Math.cos(k));var n=p*A-l*y,p=p*y+l*A,h=h-k,y=Math.sin(h),A=Math.cos(h),q=-g*A- -r*y,l=-g*y+-r*A,h=+g*A- -r*y,x=+g*y+-r*A,g=n+q,r=p-l,y=n+h,A=p-x,q=n-q,l=p+l,n=n-h,p=p+x,h=new u;h.addRing([[g,r],[y,A],[q,l],[n,p],[g,r]]);if(t.intersects(h))return!1}}for(;k>Math.PI/2;)k-=Math.PI;for(;k<-(Math.PI/2);)k+=Math.PI;c={};c.layer=m;c.text=b;c.angle=k;c.x=a;c.y=d;c.width=e;
c.height=f;this._placedLabels.push(c);return!0},_findPlace2:function(m,b,a,d,k,e,f,c){return(m>=k&&m<=f||a>=k&&a<=f||m<=k&&a>=f)&&(b>=e&&b<=c||d>=e&&d<=c||b<=e&&d>=c)?!0:!1},_clipLine:function(m,b,a,d){for(var k=this._code(m,b),e=this._code(a,d);0!==k||0!==e;){if(0!==(k&e))return!1;var f=a-m,c=d-b;0!==k?(m<this._xmin?(b+=c*(this._xmin-m)/f,m=this._xmin):m>this._xmax?(b+=c*(this._xmax-m)/f,m=this._xmax):b<this._ymin?(m+=f*(this._ymin-b)/c,b=this._ymin):b>this._ymax&&(m+=f*(this._ymax-b)/c,b=this._ymax),
k=this._code(m,b)):(a<this._xmin?(d+=c*(this._xmin-a)/f,a=this._xmin):a>this._xmax?(d+=c*(this._xmax-a)/f,a=this._xmax):d<this._ymin?(a+=f*(this._ymin-d)/c,d=this._ymin):d>this._ymax&&(a+=f*(this._ymax-d)/c,d=this._ymax),e=this._code(a,d))}this._x0=m;this._y0=b;this._x1=a;this._y1=d;return!0},_code:function(m,b){var a=0;m<this._xmin&&(a+=8);m>this._xmax&&(a+=4);b<this._ymin&&(a+=2);b>this._ymax&&(a+=1);return a}});w("extend-esri")&&q.setObject("layers.labelLayerUtils.DynamicLabelClass",n,C);return n})},
"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(n,q,w,C,D,u,m){return n(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=
.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=(this._xmax-this._xmin)/b.width},_process:function(b){var a,d,k,e,f,c,h,g,r;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];f=a.labelWidth;c=a.labelHeight;g=(h=a.options)&&h.lineLabelPlacement?h.lineLabelPlacement:"PlaceAtCenter";r=h&&h.lineLabelPosition?
h.lineLabelPosition:"Above";d=h&&h.labelRotation?h.labelRotation:!0;k=Math.PI/180*a.angle;e=h&&h.howManyLabels?h.howManyLabels:"OneLabel";var p=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,k,f,c,a.symbolWidth,a.symbolHeight,h,p);else if("multipoint"===a.geometry.type)for(d=0;d<a.geometry.points.length;d++)this._generatePointPositions(a.geometry.points[d][0],a.geometry.points[d][1],a.text,k,f,c,a.symbolWidth,a.symbolHeight,h,p);else if("polyline"===
a.geometry.type)if("PlaceAtStart"===g)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,f,c,2*a.symbolHeight+c,g,r,d,p);else if("PlaceAtEnd"===g)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,f,c,2*a.symbolHeight+c,g,r,d,p);else{h=[];var l=a.geometry.getExtent(),t=this._map.extent;if(l.getWidth()<f*this._scale/this._OVERRUN&&l.getHeight()<f*this._scale/this._OVERRUN)continue;else.5*l.getWidth()<t.getWidth()&&.5*l.getHeight()<t.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,
!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,c,2*a.symbolHeight+c,g,r,d,h):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,a.text,f,c,2*a.symbolHeight+c,g,r,d,h);this._postSorting(t,h,p)}else if("polygon"===a.geometry.type){g=[];for(d=0;d<a.geometry.rings.length;d++)r=a.geometry.rings[d],1<a.geometry.rings.length&&!m.prototype.isClockwise(r)||(h=this._calcRingExtent(r),h.xmax-h.xmin<4*f*this._scale/this._OVERRUN&&
h.ymax-h.ymin<4*c*this._scale/this._OVERRUN||g.push(r));g.sort(function(a,c){return c.length-a.length});for(d=0;d<g.length;d++)this._generatePolygonPositionsForManyLabels(g[d],a.geometry.spatialReference,a.text,k,f,c,p)}for(d=0;d<p.length&&(g=p[d].x,r=p[d].y,void 0!==p[d].angle&&(k=p[d].angle),h=this._findPlace(a,a.text,g,r,k,f,c),"OneLabel"!==e||!h||!this._labelLayer._isWithinScreenArea(new u(g,r,a.geometry.spatialReference)));d++);}return this._placedLabels},_generatePointPositions:function(b,a,
d,k,e,f,c,h,g,m){d=g&&g.pointPriorities?g.pointPriorities:"AboveRight";e=(c+e)*this._scale;f=(h+f)*this._scale;switch(d.toLowerCase()){case "aboveleft":b-=e;a+=f;break;case "abovecenter":a+=f;break;case "aboveright":b+=e;a+=f;break;case "centerleft":b-=e;break;case "centercenter":break;case "centerright":b+=e;break;case "belowleft":b-=e;a-=f;break;case "belowcenter":a-=f;break;case "belowright":b+=e;a-=f;break;default:return}m.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,d,k,e,
f,c,h,g,m){c=k*this._scale;var p=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,t,r,A,n,q,x,v;for(l=0;l<b.paths.length;l++){var z=b.paths[l],B=c,E=0;for(t=0;t<z.length-1;t++)r=z[t][0],A=z[t][1],n=z[t+1][0],q=z[t+1][1],x=n-r,v=q-A,x=Math.sqrt(x*x+v*v),E+x>B?(E=this._generatePositionsOnLine(b.spatialReference,a,B,p,E,r,A,n,q,d,k,e,f,h,g,m),B=p):E+=x}},_generateLinePositionsPlaceAtEnd:function(b,a,d,k,e,f,c,h,g,m){c=k*this._scale;var p=this._LINE_STEP_CONST*Math.min(this._map.width,
this._map.height)*this._scale,l,t,r,n,q,u,x,v;for(l=0;l<b.paths.length;l++){var z=b.paths[l],B=c,E=0;for(t=z.length-2;0<=t;t--)r=z[t+1][0],n=z[t+1][1],q=z[t][0],u=z[t][1],x=q-r,v=u-n,x=Math.sqrt(x*x+v*v),E+x>B?(E=this._generatePositionsOnLine(b.spatialReference,a,B,p,E,r,n,q,u,d,k,e,f,h,g,m),B=p):E+=x}},_generateLinePositionsPlaceAtCenter:function(b,a,d,k,e,f,c,h,g,m,p){var l,t,r,n,q,u,x,v;for(h=0;h<b.paths.length;h++){var z=b.paths[h];if(!(2>z.length)){if(2==z.length){n=z[0];l=z[1];r=n[0];n=n[1];
z=l[0];u=l[1];q=(z-r)*(z-r)+(u-n)*(u-n);x=Math.atan2(u-n,z-r);u=Math.cos(x);x=Math.sin(x);z=[];v=r;for(var B=n;(v-r)*(v-r)+(B-n)*(B-n)<q;)z.push([v,B]),v+=d/2*u,B+=d/2*x;z.push(l)}var E=0;for(l=0;l<z.length-1;l++)r=z[l][0],n=z[l][1],q=z[l+1][0],u=z[l+1][1],x=q-r,v=u-n,E+=Math.sqrt(x*x+v*v);for(l=B=0;l<z.length-1;l++){r=z[l][0];n=z[l][1];q=z[l+1][0];u=z[l+1][1];x=q-r;v=u-n;x=Math.sqrt(x*x+v*v);if(B+x>E/2)break;B+=x}l==z.length-1&&l--;r=z[l][0];n=z[l][1];q=z[l+1][0];u=z[l+1][1];x=q-r;v=u-n;B=E/2-B;
x=Math.atan2(v,x);v=r+B*Math.cos(x);x=n+B*Math.sin(x);r=this._angleAndShifts(r,n,q,u,c,g,m);p.push({x:v+r.shiftX,y:x+r.shiftY,angle:r.angle});var E=v,w=x,B=0;for(t=l;t<z.length-1;t++)t==l?(r=E,n=w):(r=z[t][0],n=z[t][1]),q=z[t+1][0],u=z[t+1][1],x=q-r,v=u-n,x=Math.sqrt(x*x+v*v),B=B+x>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,B,r,n,q,u,k,e,f,c,g,m,p):B+x;B=0;for(t=l;0<=t;t--)t==l?(r=E,n=w):(r=z[t+1][0],n=z[t+1][1]),q=z[t][0],u=z[t][1],x=q-r,v=u-n,x=Math.sqrt(x*x+v*v),B=B+x>d?this._generatePositionsOnLine(b.spatialReference,
a,d,d,B,r,n,q,u,k,e,f,c,g,m,p):B+x}}},_generatePositionsOnLine:function(b,a,d,k,e,f,c,h,g,m,p,l,n,q,u,w){m=Math.atan2(g-c,h-f);p=f;l=c;var r=p,t=l;do if(e=d-e,p+=e*Math.cos(m),l+=e*Math.sin(m),this._belongs(p,l,f,c,h,g))e=this._angleAndShifts(f,c,h,g,n,q,u),d=p+e.shiftX,t=l+e.shiftY,a?this._labelLayer._isWithinScreenArea(new D(d,t,d,t,b))&&w.push({x:d,y:t,angle:e.angle}):w.push({x:d,y:t,angle:e.angle}),r=p,t=l,e=0,d=k;else return b=h-r,g-=t,Math.sqrt(b*b+g*g);while(1)},_postSorting:function(b,a,d){if(b&&
0<a.length){var k=.5*(b.xmin+b.xmax);b=.5*(b.ymin+b.ymax);for(var e=a[0].x,f=a[0].y,c=Math.sqrt((e-k)*(e-k)+(f-b)*(f-b)),h=a[0].angle,g=0;g<a.length;g++){var m=a[g].x,p=a[g].y,l=Math.sqrt((m-k)*(m-k)+(p-b)*(p-b));l<c&&(e=m,f=p,c=l,h=a[g].angle)}d.push({x:e,y:f,angle:h})}},_belongs:function(b,a,d,k,e,f){if(e==d&&f==k)return!1;if(e>d){if(b>e||b<d)return!1}else if(b<e||b>d)return!1;if(f>k){if(a>f||a<k)return!1}else if(a<f||a>k)return!1;return!0},_angleAndShifts:function(b,a,d,k,e,f,c){for(b=Math.atan2(k-
a,d-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;k=Math.sin(b);var h=Math.cos(b);d=a=0;"Above"==f&&(a=e*k*this._scale,d=e*h*this._scale);"Below"==f&&(a=-e*k*this._scale,d=-e*h*this._scale);e=[];e.angle=c?-b:0;e.shiftX=-a;e.shiftY=d;return e},_generatePolygonPositionsForManyLabels:function(b,a,d,k,e,f,c){e=this._findCentroidForRing(b);k=e[0];var h=e[1],g=this._calcRingExtent(b);e=g.xmin;f=g.ymin;var m=g.xmax,g=g.ymax,p=(g-f)/(this._map.height*this._scale);if(!(10<(m-e)/(this._map.width*
this._scale)&&10<p)){var l=!0;if(m-e>this._map.width*this._scale||g-f>this._map.height*this._scale)l=!1;var p=this._map.width*this._scale*(l?.1875:.5),l=this._map.height*this._scale*(l?.1875:.5),n=!0,q=!0,u=0;do{h+=(u%2?-1:1)*u*l;if(this._scanRingByX(d,a,b,k,h,e,m,p,c))break;h<f&&(n=!1);h>g&&(q=!1);u++}while(n||q)}},_scanRingByX:function(b,a,d,k,e,f,c,h,g){var m=!0,p=!0,l=0,n=1E3;do{k+=(l%2?-1:1)*l*h;var q=this._movePointInsideRing(d,k,e),u=this._labelLayer._isWithinScreenArea(new D(q,e,q,e,a)),w=
this._isPointWithinRing(b,d,q,e);if(u&&w)return g.push({x:q,y:e}),!0;k<f&&(m=!1);k>c&&(p=!1);l++;n--;if(0>=n)return!0}while(m||p);return!1},_movePointInsideRing:function(b,a,d){for(var k=[],e=b.length-1,f=b[0][1]>=b[e][1]?1:-1,c=0;c<=e;c++){var h=c,g=c+1;c==e&&(g=0);var m=b[h][0],h=b[h][1],p=b[g][0],g=b[g][1],l=g>=h?1:-1;if(h<=d&&d<=g||g<=d&&d<=h)d!=h&&d!=g?(k.push((d-h)*(p-m)/(g-h)+m),f=l):d==h&&d!=g?(f!=l&&k.push(m),f=l):d!=h&&d==g?(k.push(p),f=l):d==h&&d==g&&(1==f&&k.push(m),k.push(p),f=l)}k.sort(function(a,
c){return a-c});b=k.length;if(0<b){for(c=d=a=0;c<b-1;c+=2)e=Math.abs(k[c+1]-k[c]),e>a&&(a=e,d=c);a=(k[d]+k[d+1])/2}return a},_calcRingExtent:function(b){var a,d;d=new D;for(a=0;a<b.length-1;a++){var k=b[a][0],e=b[a][1];if(void 0===d.xmin||k<d.xmin)d.xmin=k;if(void 0===d.ymin||e<d.ymin)d.ymin=e;if(void 0===d.xmax||k>d.xmax)d.xmax=k;if(void 0===d.ymax||e>d.ymax)d.ymax=e}return d},_isPointWithinPolygon:function(b,a,d,k){var e;for(e=0;e<a.rings.length;e++)if(this._isPointWithinRing(b,a.rings[e],d,k))return!0;
return!1},_isPointWithinRing:function(b,a,d,k){var e,f,c,h,g=[],m=a.length;for(b=0;b<m-1;b++)if(e=a[b][0],f=a[b][1],c=a[b+1][0],h=a[b+1][1],e!=c||f!=h){if(f==h)if(k==f)g.push(e);else continue;e==c?(f<h&&k>=f&&k<h&&g.push(e),f>h&&k<=f&&k>h&&g.push(e)):(f=(c-e)/(h-f)*(k-f)+e,e<c&&f>=e&&f<c&&g.push(f),e>c&&f<=e&&f>c&&g.push(f))}g.sort(function(a,c){return a-c});for(b=0;b<g.length-1;b++)if(e=g[b],c=g[b+1],d>=e&&d<c)if(b%2)break;else return!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,
d=[0,0],k=0,e=b[0][0],f=b[0][1],c=1;c<a-1;c++){var h=b[c][0],g=b[c][1],m=b[c+1][0],p=b[c+1][1],l=(h-e)*(p-f)-(m-e)*(g-f);d[0]+=l*(e+h+m);d[1]+=l*(f+g+p);k+=l}d[0]/=3*k;d[1]/=3*k;return d},_findCentroidForFeature:function(b){for(var a=0,d=[0,0],k=0;k<b.rings.length;k++)for(var e=b.rings[k],f=e.length,c=e[0][0],h=e[0][1],g=1;g<f-1;g++){var m=e[g][0],p=e[g][1],l=e[g+1][0],n=e[g+1][1],q=(m-c)*(n-h)-(l-c)*(p-h);d[0]+=q*(c+m+l);d[1]+=q*(h+p+n);a+=q}d[0]/=3*a;d[1]/=3*a;return d},_findPlace:function(b,a,
d,k,e,f,c){if(isNaN(d)||isNaN(k))return!1;for(var h=0;h<this._placedLabels.length;h++){var g=this._placedLabels[h].angle,n=this._placedLabels[h].width*this._scale,p=this._placedLabels[h].height*this._scale,l=this._placedLabels[h].x-d,q=this._placedLabels[h].y-k;if(0===e&&0===g){if(this._findPlace2(-f*this._scale,-c*this._scale,f*this._scale,c*this._scale,l-n,q-p,l+n,q+p))return!1}else{var u=new D(-f*this._scale,-c*this._scale,f*this._scale,c*this._scale,null),w=0,C=1;0!==e&&(w=Math.sin(e),C=Math.cos(e));
var G=l*C-q*w,l=l*w+q*C,g=g-e,w=Math.sin(g),C=Math.cos(g),x=-n*C- -p*w,q=-n*w+-p*C,g=+n*C- -p*w,v=+n*w+-p*C,n=G+x,p=l-q,w=G+g,C=l-v,x=G-x,q=l+q,G=G-g,l=l+v,g=new m;g.addRing([[n,p],[w,C],[x,q],[G,l],[n,p]]);if(u.intersects(g))return!1}}for(;e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;h={};h.layer=b;h.text=a;h.angle=e;h.x=d;h.y=k;h.width=f;h.height=c;this._placedLabels.push(h);return!0},_findPlace2:function(b,a,d,k,e,f,c,h){return(b>=e&&b<=c||d>=e&&d<=c||b<=e&&d>=c)&&(a>=f&&a<=h||k>=f&&
k<=h||a<=f&&k>=h)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../renderers/arcadeUtils".split(" "),function(n,
q,w,C,D,u,m,b,a,d,k,e,f,c,h,g,r,p,l,t,y,A,M,G){function x(a){return"sizeInfo"===a.type}n=q(y,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=w.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
w.hitch(this,"_handleLevelChange")));var c=this.inherited(arguments);this.refresh();return c},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)m.disconnect(this._mapEventHandlers[a]);this.refresh();clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,c,b,d){if(!this.getFeatureLayer(a.layerId)){var f=[];f.push(a.on("update-end",
w.hitch(this,"refresh")));f.push(a.on("suspend",w.hitch(this,"refresh")));f.push(a.on("resume",w.hitch(this,"refresh")));f.push(a.on("edits-complete",w.hitch(this,"refresh")));f.push(a.on("labeling-info-change",w.hitch(this,"refresh")));f.push(a.on("time-extent-change",w.hitch(this,"refresh")));f.push(a.on("show-labels-change",w.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:b,LabelingOptions:d,LabelRenderer:c,EventHandlers:f});this.featureLayers.push(a);
this.refresh()}},getFeatureLayer:function(a){var c,b;for(c=0;c<this.featureLayers.length;c++)if(b=this.featureLayers[c],void 0!==b&&b.id==a)return b;return null},removeFeatureLayer:function(a){var c;a=this.getFeatureLayer(a);if(void 0!==a&&(c=u.indexOf(this.featureLayers,a),-1<c)){this.featureLayers.splice(c,1);for(a=0;a<this._featureLayerInfos[c].EventHandlers.length;a++)m.disconnect(this._featureLayerInfos[c].EventHandlers[a]);this._featureLayerInfos.splice(c,1);this.refresh()}},removeAllFeatureLayers:function(){var a;
for(a=0;a<this.featureLayers.length;a++){for(var c=0;c<this._featureLayerInfos[a].EventHandlers.length;c++)m.disconnect(this._featureLayerInfos[a].EventHandlers[c]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var c,b;for(c=0;c<this.featureLayers.length;c++)if(b=this.featureLayers[c],void 0!==b&&b.id==a)return this._featureLayerInfos[c];return null},refresh:function(){null==this._refreshHandle&&
(this._refreshHandle=setTimeout(this._refreshLabels,0))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,d,f,e,k,g=[],l,v="DYNAMIC"===this._engineType?new c:new h;if(this._map){v.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(d=this.featureLayers[a],d.visible&&d.showLabels&&d.visibleAtMapScale&&!d._suspended)if(b=this._featureLayerInfos[a],k=this._convertOptions(null),b.LabelRenderer){if(g=
d.labelingInfo)if(l=g[0])e=this._getLabelExpression(l),k=this._convertOptions(l);f=b.LabelRenderer;b.LabelExpressionInfo&&(e=b.LabelExpressionInfo);b.LabelingOptions&&(k=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(g=b.LabelingOptions.pointPriorities,k.pointPriorities="above-center"==g||"AboveCenter"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"AboveLeft"==g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"AboveRight"==
g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"BelowCenter"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"BelowLeft"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"BelowRight"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"CenterCenter"==g||"esriServerPointLabelPlacementCenterCenter"==g?"CenterCenter":"center-left"==g||"CenterLeft"==g||"esriServerPointLabelPlacementCenterLeft"==
g?"CenterLeft":"center-right"==g||"CenterRight"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(k.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(k.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(k.labelRotation=b.LabelingOptions.labelRotation),void 0!==b.LabelingOptions.howManyLabels&&(k.howManyLabels=b.LabelingOptions.howManyLabels));
f instanceof A&&(e=this._getLabelExpression(f),f=new M(f.symbol),k=this._convertOptions(f));this._addLabels(d,f,e,k)}else if(g=d.labelingInfo)for(b=g.length-1;0<=b;b--)if(l=g[b])f=new A(l instanceof A?l.toJson():l),e=this._getLabelExpression(l),k=this._convertOptions(l),this._addLabels(d,f,e,k);e=v._process(this._preparedLabels);this.clear();this.drawLabels(this._map,e)}},drawLabels:function(a,c){this._scale=(a.extent.xmax-a.extent.xmin)/a.width;var b;for(b=0;b<c.length;b++){var d=c[b],f=d.x,k=d.y,
h=d.text,m=d.angle,v=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation&&v.setAngle(180/Math.PI*m);v.setText(h);d=f;v instanceof g&&(f=v.getHeight(),d-=.25*f*this._scale*Math.sin(m),k-=.33*f*this._scale);m=new e(new l(d,k,a.extent.spatialReference));m.setSymbol(v);this.add(m)}},_addLabels:function(a,c,b,d){var f,e,k,g;if(this._isWithinScaleRange(c.minScale,c.maxScale)&&b&&""!==b){var h=this._map,l=!a.url&&!h.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(e=
a.graphics[f],!1!==e.visible){k=e.geometry;if(l){if(!t.canProject(k,h))continue;k=t.project(k,h)}k&&this._isWhere(c.where,e.attributes)&&this._isWithinScreenArea(k)&&(g=this._buildLabelText(b,e,a.fields,d),this._addLabel(g,c,a.renderer,e,d,k,h))}}},_isWithinScreenArea:function(a){a="point"===a.type?new p(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,c){var b=this._map.getScale();
return 0<a&&b>=a||0<c&&b<=c?!1:!0},_isWhere:function(a,c){try{if(!a)return!0;if(a){var b=a.split(" ");if(3===b.length)return this._sqlEquation(c[this._removeQuotes(b[0])],b[1],this._removeQuotes(b[2]));if(7===b.length){var d=this._sqlEquation(c[this._removeQuotes(b[0])],b[1],this._removeQuotes(b[2])),f=b[3],e=this._sqlEquation(c[this._removeQuotes(b[4])],b[5],this._removeQuotes(b[6]));switch(f){case "AND":return d&&e;case "OR":return d||e}}}return!1}catch(H){console.log("Error.: can't parse \x3d "+
a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||u.filter(a.visualVariables,
x)[0]:null},_addLabel:function(b,c,d,f,e,k,h){var l,m,n,p;if(b&&""!==w.trim(b)&&c){b=b.replace(/\s+/g," ");l=c.getSymbol(f);l instanceof g?(l=new g(l.toJson()),l.setVerticalAlignment("baseline"),l.setHorizontalAlignment("center")):l=l instanceof r?new r(l.toJson()):new g;l.setText(b);c.symbol=l;if(n=this._getProportionalSize(c.sizeInfo,f.attributes))l instanceof g?l.setSize(n):l instanceof r&&(l.setWidth(n),l.setHeight(n));p=n=0;if(d){m=d.getSymbol(f);var q=this._getSizeInfo(d),v;q&&(v=d.getSize(f,
{sizeInfo:q,resolution:h.getResolutionInMeters()}));if(v&&null!==v)n=p=v;else if(m)if("simplemarkersymbol"==m.type)p=n=m.size;else if("picturemarkersymbol"==m.type)n=m.width,p=m.height;else if("simplelinesymbol"==m.type||"cartographiclinesymbol"==m.type)n=m.width}d={};d.graphic=f;d.options=e;d.geometry=k;d.labelRenderer=c;d.labelSymbol=l;d.labelWidth=l.getWidth()/2;d.labelHeight=l.getHeight()/2;d.symbolWidth=a.normalizedLength(n)/2;d.symbolHeight=a.normalizedLength(p)/2;d.text=b;d.angle=l.angle;this._preparedLabels.push(d)}},
_buildLabelText:function(a,b,c,d){if(d.hasExpression)return a=G.executeFunction(d.compiledFunc,G.createExecContext(b,b._getViewInfo())),k.isDefined(a)?""+a:"";var e=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,g=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var g=e[c[b].name],h=c[b].domain;if(h&&w.isObject(h)){if("codedValue"==h.type&&d.useCodedValues)for(b=g,a=0;a<h.codedValues.length;a++){if(h.codedValues[a].code==b){g=h.codedValues[a].name;break}}else"range"==h.type&&h.minValue<=
g&&g<=h.maxValue&&(g=h.name);break}h=c[b].type;if(d.fieldInfos){var l=d.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==h?(a="DateFormat"+f.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(g=k.substitute({myKey:g},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=h&&"esriFieldTypeSingle"!=h&&"esriFieldTypeSmallInteger"!=h&&"esriFieldTypeLong"!=h&&"esriFieldTypeDouble"!=h||!a||(g=C.format(g,{places:a.places}),a.digitSeparator||D.group&&(g=
g.replace(new RegExp("\\"+D.group,"g"),"")));break}}break}else g="";return null==g?"":g})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[","g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,
b){if(!a)return null;var c=k.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",d=null,f=null,e="",g=!0,h,k;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),f=a.fieldInfos,e=a.labelPlacement,null!=a.useCodedValues&&
(b=a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(k=!0,h=G.createFunction(l))}if("always-horizontal"==e||"esriServerPolygonPlacementAlwaysHorizontal"==e)g=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:f,pointPriorities:"above-center"==e||"esriServerPointLabelPlacementAboveCenter"==e?"AboveCenter":"above-left"==e||"esriServerPointLabelPlacementAboveLeft"==e?"AboveLeft":"above-right"==e||"esriServerPointLabelPlacementAboveRight"==e?"AboveRight":"below-center"==
e||"esriServerPointLabelPlacementBelowCenter"==e?"BelowCenter":"below-left"==e||"esriServerPointLabelPlacementBelowLeft"==e?"BelowLeft":"below-right"==e||"esriServerPointLabelPlacementBelowRight"==e?"BelowRight":"center-center"==e||"esriServerPointLabelPlacementCenterCenter"==e?"CenterCenter":"center-left"==e||"esriServerPointLabelPlacementCenterLeft"==e?"CenterLeft":"center-right"==e||"esriServerPointLabelPlacementCenterRight"==e?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==e||"below-start"==
e||"center-start"==e?"PlaceAtStart":"above-end"==e||"below-end"==e||"center-end"==e?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==e||"esriServerLinePlacementAboveAfter"==e||"above-along"==e||"esriServerLinePlacementAboveAlong"==e||"above-before"==e||"esriServerLinePlacementAboveBefore"==e||"above-start"==e||"esriServerLinePlacementAboveStart"==e||"above-end"==e||"esriServerLinePlacementAboveEnd"==e?"Above":"below-after"==e||"esriServerLinePlacementBelowAfter"==e||"below-along"==e||
"esriServerLinePlacementBelowAlong"==e||"below-before"==e||"esriServerLinePlacementBelowBefore"==e||"below-start"==e||"esriServerLinePlacementBelowStart"==e||"below-end"==e||"esriServerLinePlacementBelowEnd"==e?"Below":"center-after"==e||"esriServerLinePlacementCenterAfter"==e||"center-along"==e||"esriServerLinePlacementCenterAlong"==e||"center-before"==e||"esriServerLinePlacementCenterBefore"==e||"center-start"==e||"esriServerLinePlacementCenterStart"==e||"center-end"==e||"esriServerLinePlacementCenterEnd"==
e?"OnLine":"Above",labelRotation:g,howManyLabels:"OneLabel",hasExpression:k,compiledFunc:h}}});b("extend-esri")&&w.setObject("layers.LabelLayer",n,d);return n});