// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.20/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterFormats/Jpg",[],function(){return function(){function H(){}function N(b,e){for(var n=0,k=[],a,w,x=16;0<x&&!b[x-1];)x--;k.push({children:[],index:0});var c=k[0],l;for(a=0;a<x;a++){for(w=0;w<b[a];w++){c=k.pop();for(c.children[c.index]=e[n];0<c.index;)c=k.pop();c.index++;for(k.push(c);k.length<=a;)k.push(l={children:[],index:0}),c.children[c.index]=l.children,c=l;n++}a+1<x&&(k.push(l={children:[],index:0}),c.children[c.index]=l.children,c=l)}return k[0].children}function O(b,
e,n,k,a,w,x,c,l){function h(){if(0<A)return A--,B>>A&1;B=b[e++];if(255===B){var a=b[e++];if(a)throw"unexpected marker: "+(B<<8|a).toString(16);}A=7;return B>>>7}function t(a){for(;;){a=a[h()];if("number"===typeof a)return a;if("object"!==typeof a)throw"invalid huffman sequence";}}function y(a){for(var b=0;0<a;)b=b<<1|h(),a--;return b}function f(a){if(1===a)return 1===h()?1:-1;var b=y(a);return b>=1<<a-1?b:b+(-1<<a)+1}function d(a,b){var c=t(a.huffmanTableDC),c=0===c?0:f(c);a.blockData[b]=a.pred+=
c;for(c=1;64>c;){var d=t(a.huffmanTableAC),e=d&15,d=d>>4;if(0===e){if(15>d)break;c+=16}else c+=d,a.blockData[b+I[c]]=f(e),c++}}function u(a,b){var c=t(a.huffmanTableDC),c=0===c?0:f(c)<<l;a.blockData[b]=a.pred+=c}function v(a,b){a.blockData[b]|=h()<<l}function m(a,b){if(0<z)z--;else for(var c=w;c<=x;){var d=t(a.huffmanTableAC),e=d&15,d=d>>4;if(0===e){if(15>d){z=y(d)+(1<<d)-1;break}c+=16}else c+=d,a.blockData[b+I[c]]=f(e)*(1<<l),c++}}function r(a,b){for(var c=w,d=0,e;c<=x;){e=I[c];switch(q){case 0:d=
t(a.huffmanTableAC);e=d&15;d>>=4;if(0===e)15>d?(z=y(d)+(1<<d),q=4):(d=16,q=1);else{if(1!==e)throw"invalid ACn encoding";D=f(e);q=d?2:3}continue;case 1:case 2:a.blockData[b+e]?a.blockData[b+e]+=h()<<l:(d--,0===d&&(q=2===q?3:0));break;case 3:a.blockData[b+e]?a.blockData[b+e]+=h()<<l:(a.blockData[b+e]=D<<l,q=0);break;case 4:a.blockData[b+e]&&(a.blockData[b+e]+=h()<<l)}c++}4===q&&(z--,0===z&&(q=0))}var p=n.mcusPerLine,g=e,B=0,A=0,z=0,q=0,D,J=k.length,C,E,K,L,G;c=n.progressive?0===w?0===c?u:v:0===c?m:
r:d;var F=0;n=1===J?k[0].blocksPerLine*k[0].blocksPerColumn:p*n.mcusPerColumn;a||(a=n);for(var H,M;F<n;){for(E=0;E<J;E++)k[E].pred=0;z=0;if(1===J)for(C=k[0],G=0;G<a;G++)c(C,64*((C.blocksPerLine+1)*(F/C.blocksPerLine|0)+F%C.blocksPerLine)),F++;else for(G=0;G<a;G++){for(E=0;E<J;E++)for(C=k[E],H=C.h,M=C.v,K=0;K<M;K++)for(L=0;L<H;L++)c(C,64*((C.blocksPerLine+1)*((F/p|0)*C.v+K)+(F%p*C.h+L)));F++}A=0;C=b[e]<<8|b[e+1];if(65280>=C)throw"marker was not found";if(65488<=C&&65495>=C)e+=2;else break}return e-
g}function P(b,e){for(var n=e.blocksPerLine,k=e.blocksPerColumn,a=new Int16Array(64),w=0;w<k;w++)for(var x=0;x<n;x++){for(var c=64*((e.blocksPerLine+1)*w+x),l=a,h=e.quantizationTable,t=e.blockData,y=void 0,f=void 0,d=void 0,u=void 0,v=void 0,m=void 0,r=void 0,p=void 0,g=void 0,B=p=void 0,A=r=f=m=void 0,z=void 0,g=void 0,q=0;64>q;q+=8)g=t[c+q],p=t[c+q+1],B=t[c+q+2],m=t[c+q+3],f=t[c+q+4],r=t[c+q+5],A=t[c+q+6],z=t[c+q+7],g*=h[q],0===(p|B|m|f|r|A|z)?(g=5793*g+512>>10,l[q]=g,l[q+1]=g,l[q+2]=g,l[q+3]=g,
l[q+4]=g,l[q+5]=g,l[q+6]=g,l[q+7]=g):(p*=h[q+1],B*=h[q+2],m*=h[q+3],f*=h[q+4],r*=h[q+5],A*=h[q+6],z*=h[q+7],y=5793*g+128>>8,f=5793*f+128>>8,d=B,u=A,v=2896*(p-z)+128>>8,p=2896*(p+z)+128>>8,m<<=4,r<<=4,y=y+f+1>>1,f=y-f,g=3784*d+1567*u+128>>8,d=1567*d-3784*u+128>>8,u=g,v=v+r+1>>1,r=v-r,p=p+m+1>>1,m=p-m,y=y+u+1>>1,u=y-u,f=f+d+1>>1,d=f-d,g=2276*v+3406*p+2048>>12,v=3406*v-2276*p+2048>>12,p=g,g=799*m+4017*r+2048>>12,m=4017*m-799*r+2048>>12,r=g,l[q]=y+p,l[q+7]=y-p,l[q+1]=f+r,l[q+6]=f-r,l[q+2]=d+m,l[q+5]=
d-m,l[q+3]=u+v,l[q+4]=u-v);for(h=0;8>h;++h)g=l[h],p=l[h+8],B=l[h+16],m=l[h+24],f=l[h+32],r=l[h+40],A=l[h+48],z=l[h+56],0===(p|B|m|f|r|A|z)?(g=5793*g+8192>>14,g=-2040>g?0:2024<=g?255:g+2056>>4,t[c+h]=g,t[c+h+8]=g,t[c+h+16]=g,t[c+h+24]=g,t[c+h+32]=g,t[c+h+40]=g,t[c+h+48]=g,t[c+h+56]=g):(y=5793*g+2048>>12,f=5793*f+2048>>12,d=B,u=A,v=2896*(p-z)+2048>>12,p=2896*(p+z)+2048>>12,y=(y+f+1>>1)+4112,f=y-f,g=3784*d+1567*u+2048>>12,d=1567*d-3784*u+2048>>12,u=g,v=v+r+1>>1,r=v-r,p=p+m+1>>1,m=p-m,y=y+u+1>>1,u=y-
u,f=f+d+1>>1,d=f-d,g=2276*v+3406*p+2048>>12,v=3406*v-2276*p+2048>>12,p=g,g=799*m+4017*r+2048>>12,m=4017*m-799*r+2048>>12,r=g,g=y+p,z=y-p,p=f+r,A=f-r,B=d+m,r=d-m,m=u+v,f=u-v,g=16>g?0:4080<=g?255:g>>4,p=16>p?0:4080<=p?255:p>>4,B=16>B?0:4080<=B?255:B>>4,m=16>m?0:4080<=m?255:m>>4,f=16>f?0:4080<=f?255:f>>4,r=16>r?0:4080<=r?255:r>>4,A=16>A?0:4080<=A?255:A>>4,z=16>z?0:4080<=z?255:z>>4,t[c+h]=g,t[c+h+8]=p,t[c+h+16]=B,t[c+h+24]=m,t[c+h+32]=f,t[c+h+40]=r,t[c+h+48]=A,t[c+h+56]=z)}return e.blockData}function D(b){return 0>=
b?0:255<=b?255:b}var I=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);H.prototype={parse:function(b){function e(){var c=b[a]<<8|b[a+1];a+=2;return c}function n(){var c=e(),c=b.subarray(a,a+c-2);a+=c.length;return c}function k(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){g=a.components[d];
var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*g.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/8)*g.v/a.maxV);g.blockData=new Int16Array(64*c*g.v*(b*g.h+1));g.blocksPerLine=e;g.blocksPerColumn=f}a.mcusPerLine=b;a.mcusPerColumn=c}var a=0,w=null,x=null,c,l,h=[],t=[],y=[],f=e();if(65496!==f)throw"SOI not found";for(f=e();65497!==f;){var d,u;switch(f){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:d=
n();65504===f&&74===d[0]&&70===d[1]&&73===d[2]&&70===d[3]&&0===d[4]&&(w={version:{major:d[5],minor:d[6]},densityUnits:d[7],xDensity:d[8]<<8|d[9],yDensity:d[10]<<8|d[11],thumbWidth:d[12],thumbHeight:d[13],thumbData:d.subarray(14,14+3*d[12]*d[13])});65518===f&&65===d[0]&&100===d[1]&&111===d[2]&&98===d[3]&&101===d[4]&&(x={version:d[5]<<8|d[6],flags0:d[7]<<8|d[8],flags1:d[9]<<8|d[10],transformCode:d[11]});break;case 65499:for(var f=e()+a-2,v;a<f;){var m=b[a++],r=new Uint16Array(64);if(0===m>>4)for(d=
0;64>d;d++)v=I[d],r[v]=b[a++];else if(1===m>>4)for(d=0;64>d;d++)v=I[d],r[v]=e();else throw"DQT: invalid table spec";h[m&15]=r}break;case 65472:case 65473:case 65474:if(c)throw"Only single frame JPEGs supported";e();c={};c.extended=65473===f;c.progressive=65474===f;c.precision=b[a++];c.scanLines=e();c.samplesPerLine=e();c.components=[];c.componentIds={};d=b[a++];for(f=r=m=0;f<d;f++){v=b[a];u=b[a+1]>>4;var p=b[a+1]&15;m<u&&(m=u);r<p&&(r=p);u=c.components.push({h:u,v:p,quantizationTable:h[b[a+2]]});
c.componentIds[v]=u-1;a+=3}c.maxH=m;c.maxV=r;k(c);break;case 65476:v=e();for(f=2;f<v;){m=b[a++];r=new Uint8Array(16);for(d=u=0;16>d;d++,a++)u+=r[d]=b[a];p=new Uint8Array(u);for(d=0;d<u;d++,a++)p[d]=b[a];f+=17+u;(0===m>>4?y:t)[m&15]=N(r,p)}break;case 65501:e();l=e();break;case 65498:e();v=b[a++];d=[];for(var g,f=0;f<v;f++)m=c.componentIds[b[a++]],g=c.components[m],m=b[a++],g.huffmanTableDC=y[m>>4],g.huffmanTableAC=t[m&15],d.push(g);f=b[a++];v=b[a++];m=b[a++];f=O(b,a,c,d,l,f,v,m>>4,m&15);a+=f;break;
case 65535:255!==b[a]&&a--;break;default:if(255===b[a-3]&&192<=b[a-2]&&254>=b[a-2])a-=3;else throw"unknown JPEG marker "+f.toString(16);}f=e()}this.width=c.samplesPerLine;this.height=c.scanLines;this.jfif=w;this.eof=a;this.adobe=x;this.components=[];for(f=0;f<c.components.length;f++)g=c.components[f],this.components.push({output:P(c,g),scaleX:g.h/c.maxH,scaleY:g.v/c.maxV,blocksPerLine:g.blocksPerLine,blocksPerColumn:g.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(b,
e){var n=this.width/b,k=this.height/e,a,w,x,c,l,h,t=0,y,f=this.components.length,d=b*e*f,u=new Uint8Array(d),v=new Uint32Array(b);for(h=0;h<f;h++){a=this.components[h];w=a.scaleX*n;x=a.scaleY*k;t=h;y=a.output;c=a.blocksPerLine+1<<3;for(l=0;l<b;l++)a=0|l*w,v[l]=(a&4294967288)<<3|a&7;for(w=0;w<e;w++)for(a=0|w*x,a=c*(a&4294967288)|(a&7)<<3,l=0;l<b;l++)u[t]=y[a+v[l]],t+=f}if(k=this.decodeTransform)for(h=0;h<d;)for(n=a=0;a<f;a++,h++,n+=2)u[h]=(u[h]*k[n]>>8)+k[n+1];return u},_isColorConversionNeeded:function(){return this.adobe&&
this.adobe.transformCode?!0:3===this.numComponents?!0:!1},_convertYccToRgb:function(b){for(var e,n,k,a=0,w=b.length;a<w;a+=3)e=b[a],n=b[a+1],k=b[a+2],b[a]=D(e-179.456+1.402*k),b[a+1]=D(e+135.459-.344*n-.714*k),b[a+2]=D(e-226.816+1.772*n);return b},_convertYcckToRgb:function(b){for(var e,n,k,a,w=0,x=0,c=b.length;x<c;x+=4){e=b[x];n=b[x+1];k=b[x+2];a=b[x+3];var l=-122.67195406894+n*(-6.60635669420364E-5*n+4.37130475926232E-4*k-5.4080610064599E-5*e+4.8449797120281E-4*a-.154362151871126)+k*(-9.57964378445773E-4*
k+8.17076911346625E-4*e-.00477271405408747*a+1.53380253221734)+e*(9.61250184130688E-4*e-.00266257332283933*a+.48357088451265)+a*(-3.36197177618394E-4*a+.484791561490776),h=107.268039397724+n*(2.19927104525741E-5*n-6.40992018297945E-4*k+6.59397001245577E-4*e+4.26105652938837E-4*a-.176491792462875)+k*(-7.78269941513683E-4*k+.00130872261408275*e+7.70482631801132E-4*a-.151051492775562)+e*(.00126935368114843*e-.00265090189010898*a+.25802910206845)+a*(-3.18913117588328E-4*a-.213742400323665);e=-20.810012546947+
n*(-5.70115196973677E-4*n-2.63409051004589E-5*k+.0020741088115012*e-.00288260236853442*a+.814272968359295)+k*(-1.53496057440975E-5*k-1.32689043961446E-4*e+5.60833691242812E-4*a-.195152027534049)+e*(.00174418132927582*e-.00255243321439347*a+.116935020465145)+a*(-3.43531996510555E-4*a+.24165260232407);b[w++]=D(l);b[w++]=D(h);b[w++]=D(e)}return b},_convertYcckToCmyk:function(b){for(var e,n,k,a=0,w=b.length;a<w;a+=4)e=b[a],n=b[a+1],k=b[a+2],b[a]=D(434.456-e-1.402*k),b[a+1]=D(119.541-e+.344*n+.714*k),
b[a+2]=D(481.816-e-1.772*n);return b},_convertCmykToRgb:function(b){for(var e,n,k,a,w=0,x=1/255/255,c=0,l=b.length;c<l;c+=4){e=b[c];n=b[c+1];k=b[c+2];a=b[c+3];var h=e*(-4.387332384609988*e+54.48615194189176*n+18.82290502165302*k+212.25662451639585*a-72734.4411664936)+n*(1.7149763477362134*n-5.6096736904047315*k-17.873870861415444*a-1401.7366389350734)+k*(-2.5217340131683033*k-21.248923337353073*a+4465.541406466231)-a*(21.86122147463605*a+48317.86113160301),t=e*(8.841041422036149*e+60.118027045597366*
n+6.871425592049007*k+31.159100130055922*a-20220.756542821975)+n*(-15.310361306967817*n+17.575251261109482*k+131.35250912493976*a-48691.05921601825)+k*(4.444339102852739*k+9.8632861493405*a-6341.191035517494)-a*(20.737325471181034*a+47890.15695978492);e=e*(.8842522430003296*e+8.078677503112928*n+30.89978309703729*k-.23883238689178934*a-3616.812083916688)+n*(10.49593273432072*n+63.02378494754052*k+50.606957656360734*a-28620.90484698408)+k*(.03296041114873217*k+115.60384449646641*a-49363.43385999684)-
a*(22.33816807309886*a+45932.16563550634);b[w++]=0<=h?255:-16581375>=h?0:255+h*x|0;b[w++]=0<=t?255:-16581375>=t?0:255+t*x|0;b[w++]=0<=e?255:-16581375>=e?0:255+e*x|0}return b},getData:function(b,e,n){if(4<this.numComponents)throw"Unsupported color mode";b=this._getLinearizedBlockData(b,e);if(3===this.numComponents)return this._convertYccToRgb(b);if(4===this.numComponents){if(this._isColorConversionNeeded())return n?this._convertYcckToRgb(b):this._convertYcckToCmyk(b);if(n)return this._convertCmykToRgb(b)}return b}};
return H}()});