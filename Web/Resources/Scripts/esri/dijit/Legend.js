// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/debounce":function(){define([],function(){return function(g,p){var e;return function(){e&&clearTimeout(e);var b=this,r=arguments;e=setTimeout(function(){g.apply(b,r)},p)}}})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(g,p,e){g.DeferredList=function(b,r,t,f,m){var q=[];p.call(this);var g=this;0!==b.length||r||this.resolve([0,[]]);var x=0;e.forEach(b,function(m,e){function p(c,m){q[e]=[c,m];x++;x===b.length&&g.resolve(q)}
m.then(function(c){r?g.resolve([e,c]):p(!0,c)},function(c){t?g.reject(c):p(!1,c);if(f)return null;throw c;})})};g.DeferredList.prototype=new p;g.DeferredList.prototype.gatherResults=function(b){b=new g.DeferredList(b,!1,!0,!1);b.addCallback(function(b){var t=[];e.forEach(b,function(b){t.push(b[1])});return t});return b};return g.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(g,p,e,b,r,t,f,m,q,F,x,G,z){function v(){}function c(c){return function(b,h,m,q){return b&&"string"==typeof h&&b[h]==v?b.on(h.substring(2).toLowerCase(),f.hitch(m,q)):c.apply(e,arguments)}}g.around(e,"connect",c);t.connect&&g.around(t,"connect",c);g=b("dijit._Widget",[x,G,z],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(c){this._toConnect={};for(var b in c)this[b]===
v&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=c[b],delete c[b])},postCreate:function(){this.inherited(arguments);for(var c in this._toConnect)this.on(c,this._toConnect[c]);delete this._toConnect},on:function(c,b){return this[this._onMap(c)]===v?e.connect(this.domNode,c.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(c){this._focused=c;this._set("focused",c)},setAttribute:function(c,b){t.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(c,b)},attr:function(c,b){return 2<=arguments.length||"object"===typeof c?this.set.apply(this,arguments):this.get(c)},getDescendants:function(){t.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?m("[widgetId]",this.containerNode).map(F.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});r("dijit-legacy-requires")&&q(0,function(){require(["dijit/_base"])});
return g})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(g,p,e,b,r,t,f,m,q,F,x,G,z,v,c,y,w,h,H,D,B,R,E){function M(c){return function(A){m[A?
"set":"remove"](this.domNode,c,A);this._set(c,A)}}z.add("dijit-legacy-requires",!v.isAsync);z.add("dojo-bidi",!1);z("dijit-legacy-requires")&&w(0,function(){g(["dijit/_base/manager"])});var I={};b=t("dijit._WidgetBase",[h,B],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:M("lang"),dir:"",_setDirAttr:M("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(c){this._set("ownerDocument",
c)},attributeMap:{},_blankGif:b.blankGif||g.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var c=this.constructor;if(!c._setterAttrs){var b=c.prototype,m=c._setterAttrs=[],c=c._onMap={},h;for(h in b.attributeMap)m.push(h);for(h in b)/^on/.test(h)&&(c[h.substring(2).toLowerCase()]=h),/^_set[A-Z](.*)Attr$/.test(h)&&(h=h.charAt(4).toLowerCase()+h.substr(5,h.length-9),b.attributeMap&&h in b.attributeMap||m.push(h))}},postscript:function(c,b){this.create(c,b)},create:function(b,h){this._introspect();
this.srcNodeRef=f.byId(h);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);b&&(this.params=b,c.mixin(this,b));this.postMixInProperties();this.id||(this.id=E.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=D.body(this.ownerDocument);E.add(this);
this.buildRendering();var A;this.domNode&&(this._applyAttributes(),(b=this.srcNodeRef)&&b.parentNode&&this.domNode!==b&&(b.parentNode.replaceChild(this.domNode,b),A=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();A&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var c={},b;for(b in this.params||{})c[b]=this._get(b);p.forEach(this.constructor._setterAttrs,function(b){if(!(b in c)){var h=this._get(b);h&&this.set(b,h)}},this);for(b in c)this.set(b,c[b])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var c=this.baseClass.split(" ");this.isLeftToRight()||(c=c.concat(p.map(c,function(c){return c+"Rtl"})));q.add(this.domNode,c)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,p.forEach(this.getChildren(),function(b){b._started||b._destroyed||!c.isFunction(b.startup)||(b.startup(),b._started=!0)}))},destroyRecursive:function(c){this._beingDestroyed=
!0;this.destroyDescendants(c);this.destroy(c)},destroy:function(b){function h(c){c.destroyRecursive?c.destroyRecursive(b):c.destroy&&c.destroy(b)}this._beingDestroyed=!0;this.uninitialize();p.forEach(this._connects,c.hitch(this,"disconnect"));p.forEach(this._supportingWidgets,h);this.domNode&&p.forEach(E.findWidgets(this.domNode,this.containerNode),h);this.destroyRendering(b);E.remove(this.id);this._destroyed=!0},destroyRendering:function(c){this.bgIframe&&(this.bgIframe.destroy(c),delete this.bgIframe);
this.domNode&&(c?m.remove(this.domNode,"widgetId"):F.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(c||F.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(c){p.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(c)})},uninitialize:function(){return!1},_setStyleAttr:function(b){var h=this.domNode;c.isObject(b)?G.set(h,b):h.style.cssText=h.style.cssText?h.style.cssText+("; "+b):b;this._set("style",b)},_attrToDom:function(b,h,f){f=3<=
arguments.length?f:this.attributeMap[b];p.forEach(c.isArray(f)?f:[f],function(f){var w=this[f.node||f||"domNode"];switch(f.type||"attribute"){case "attribute":c.isFunction(h)&&(h=c.hitch(this,h));f=f.attribute?f.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;w.tagName?m.set(w,f,h):w.set(f,h);break;case "innerText":w.innerHTML="";w.appendChild(this.ownerDocument.createTextNode(h));break;case "textContent":w.textContent=h;break;case "innerHTML":w.innerHTML=h;break;case "class":q.replace(w,
h,this[b]);break;case "toggleClass":q.toggle(w,f.className||b,h)}},this)},get:function(c){var b=this._getAttrNames(c);return this[b.g]?this[b.g]():this._get(c)},set:function(b,h){if("object"===typeof b){for(var f in b)this.set(f,b[f]);return this}f=this._getAttrNames(b);var m=this[f.s];if(c.isFunction(m))var w=m.apply(this,Array.prototype.slice.call(arguments,1));else{var m=this.focusNode&&!c.isFunction(this.focusNode)?"focusNode":"domNode",q=this[m]&&this[m].tagName,t;if((t=q)&&!(t=I[q])){t=this[m];
var r={},e;for(e in t)r[e.toLowerCase()]=!0;t=I[q]=r}e=t;f=b in this.attributeMap?this.attributeMap[b]:f.s in this?this[f.s]:e&&f.l in e&&"function"!=typeof h||/^aria-|^data-|^role$/.test(b)?m:null;null!=f&&this._attrToDom(b,h,f);this._set(b,h)}return w||this},_attrPairNames:{},_getAttrNames:function(c){var b=this._attrPairNames;if(b[c])return b[c];var h=c.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase()});return b[c]={n:c+"Node",s:"_set"+h+"Attr",g:"_get"+h+"Attr",
l:h.toLowerCase()}},_set:function(c,b){var h=this[c];this[c]=b;!this._created||h===b||h!==h&&b!==b||(this._watchCallbacks&&this._watchCallbacks(c,h,b),this.emit("attrmodified-"+c,{detail:{prevValue:h,newValue:b}}))},_get:function(c){return this[c]},emit:function(c,b,h){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var f,m=this["on"+c];m&&(f=m.apply(this,h?h:[b]));this._started&&!this._beingDestroyed&&y.emit(this.domNode,
c.toLowerCase(),b);return f},on:function(c,b){var h=this._onMap(c);return h?e.after(this,h,b,!0):this.own(y(this.domNode,c,b))[0]},_onMap:function(c){var b=this.constructor,h=b._onMap;if(!h){var h=b._onMap={},f;for(f in b.prototype)/^on/.test(f)&&(h[f.replace(/^on/,"").toLowerCase()]=f)}return h["string"==typeof c&&c.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?E.findWidgets(this.containerNode):
[]},getParent:function(){return E.getEnclosingWidget(this.domNode.parentNode)},connect:function(c,b,h){return this.own(r.connect(c,b,this,h))[0]},disconnect:function(c){c.remove()},subscribe:function(b,h){return this.own(H.subscribe(b,c.hitch(this,h)))[0]},unsubscribe:function(c){c.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():x.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=G.get(this.domNode,"display")},placeAt:function(c,b){var h=
!c.tagName&&E.byId(c);!h||!h.addChild||b&&"number"!==typeof b?(c=h&&"domNode"in h?h.containerNode&&!/after|before|replace/.test(b||"")?h.containerNode:h.domNode:f.byId(c,this.ownerDocument),F.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup()):h.addChild(this,b);return this},defer:function(b,h){var f=setTimeout(c.hitch(this,function(){f&&(f=null,this._destroyed||c.hitch(this,b)())}),h||0);return{remove:function(){f&&(clearTimeout(f),f=null);return null}}}});z("dojo-bidi")&&
b.extend(R);return b})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(g,p,e){return e("dijit.Destroyable",null,{destroy:function(b){this._destroyed=!0},own:function(){var b=["destroyRecursive","destroy","remove"];g.forEach(arguments,function(e){function t(){m.remove();g.forEach(q,function(b){b.remove()})}var f,m=p.before(this,"destroy",function(b){e[f](b)}),q=[];e.then?(f="cancel",e.then(t,t)):g.forEach(b,function(b){"function"===typeof e[b]&&
(f||(f=b),q.push(p.after(e,b,t,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(g,p,e,b,r,t){g=b("dijit._OnDijitClickMixin",null,{connect:function(b,m,q){return this.inherited(arguments,[b,"ondijitclick"==m?t:m,q])}});g.a11yclick=t;return g})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(g,p,e,b){b.extend(p,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return e("dijit._FocusMixin",null,{_focusManager:g})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(g,p,e,b){e(function(){p("highcontrast")&&g.add(b.body(),"dijit_a11y")});return p})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(g,
p,e,b,r,t,f){r.add("highcontrast",function(){var m=f.doc.createElement("div");try{m.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(p.blankGif||g.toUrl("./resources/blank.gif"))+'");';f.body().appendChild(m);var q=b.getComputedStyle(m),e=q.backgroundImage;return q.borderTopColor==q.borderRightColor||e&&("none"==e||"url(invalid-url:)"==e)}catch(x){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
x.toString()),!1}finally{8>=r("ie")?m.outerHTML="":f.body().removeChild(m)}});t(function(){r("highcontrast")&&e.add(f.body(),"dj_a11y")});return r})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(g){var p=g.getObject("dojox.html.entities",!0),e=function(b,e){var f,m;if(e._encCache&&e._encCache.regexp&&e._encCache.mapper&&e.length==e._encCache.length)f=e._encCache.mapper,m=e._encCache.regexp;else{f={};m=["["];var q;for(q=0;q<e.length;q++)f[e[q][0]]="\x26"+e[q][1]+";",m.push(e[q][0]);
m.push("]");m=new RegExp(m.join(""),"g");e._encCache={mapper:f,regexp:m,length:e.length}}return b=b.replace(m,function(b){return f[b]})},b=function(b,e){var f,m;if(e._decCache&&e._decCache.regexp&&e._decCache.mapper&&e.length==e._decCache.length)f=e._decCache.mapper,m=e._decCache.regexp;else{f={};m=["("];var q;for(q=0;q<e.length;q++){var r="\x26"+e[q][1]+";";q&&m.push("|");f[r]=e[q][0];m.push(r)}m.push(")");m=new RegExp(m.join(""),"g");e._decCache={mapper:f,regexp:m,length:e.length}}return b=b.replace(m,
function(b){return f[b]})};p.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];p.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],
["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],
["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],
["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393",
"Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],
["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044",
"frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],
["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309",
"rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019",
"rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];p.encode=function(b,g){b&&(g?b=e(b,g):(b=e(b,p.html),b=e(b,p.latin)));return b};p.decode=function(e,g){e&&(g?e=b(e,g):(e=b(e,p.html),e=b(e,p.latin)));return e};return p})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(g,p,e,b){var r=function(b,
m){return b-m},t={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(b){var f=String(b),e=f.match(t._reNumber);b={integer:0,fractional:0};e&&e[1]?(b.integer=e[1].split("").length,b.fractional=e[3]?e[3].split("").length:0):-1<f.toLowerCase().indexOf("e")&&(e=f.split("e"),f=e[0],e=e[1],f&&e&&(f=Number(f),e=Number(e),(b=0<e)||(e=Math.abs(e)),f=t.getDigits(f),b?(f.integer+=e,f.fractional=e>f.fractional?0:f.fractional-e):(f.fractional+=e,f.integer=e>f.integer?1:f.integer-e),b=f));return b},getFixedNumbers:function(b,
e){var f;f=Number(b.toFixed(e));f<b?b=f+1/Math.pow(10,e):(b=f,f-=1/Math.pow(10,e));f=Number(f.toFixed(e));b=Number(b.toFixed(e));return[f,b]},getPctChange:function(b,e,q,g){var f={prev:null,next:null},m;null!=q&&(m=b-q,f.prev=Math.floor(Math.abs(100*(e-q-m)/m)));null!=g&&(m=g-b,f.next=Math.floor(Math.abs(100*(g-e-m)/m)));return f},round:function(b,e){b=b.slice(0);var f,m,g,p,z,v,c,y,w=e&&null!=e.tolerance?e.tolerance:2,h=e&&e.indexes,H=e&&null!=e.strictBounds?e.strictBounds:!1;if(h)h.sort(r);else for(h=
[],z=0;z<b.length;z++)h.push(z);for(z=0;z<h.length;z++)if(y=h[z],e=b[y],f=0===y?null:b[y-1],m=y===b.length-1?null:b[y+1],g=t.getDigits(e),g=g.fractional){v=0;for(c=!1;v<=g&&!c;)p=t.getFixedNumbers(e,v),p=H&&0===z?p[1]:p[0],c=t.hasMinimalChange(e,p,f,m,w),v++;c&&(b[y]=p)}return b},hasMinimalChange:function(b,e,g,p,r){b=t.getPctChange(b,e,g,p);e=null==b.prev||b.prev<=r;g=null==b.next||b.next<=r;return e&&g||b.prev+b.next<=2*r},_reAllZeros:new RegExp("\\"+e.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,
format:function(b,e){e=e||{places:20,round:-1};(b=p.format(b,e))&&(b=b.replace(t._reSomeZeros,"$1").replace(t._reAllZeros,""));return b}};g("extend-esri")&&(b.numberUtils=t);return t})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(g,p,e,b,r,t,f,m){function q(b){return b&&p.map(b,function(b){return new f(b)})}function F(b,c,e){var h="";0===c?h=G.lt+" ":c===
e&&(h=G.gt+" ");return h+b}var x={},G={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},z={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},v={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",
dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},c={formatLength:"short",fullYear:!0},y={formatLength:"short"};g.mixin(x,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(e,h){var f=[];null==e||e instanceof Date||(e=new Date(e));h=h||{};h=g.mixin({},h);var w=h.selector?h.selector.toLowerCase():null,q=!w||-1<w.indexOf("time"),w=!w||-1<w.indexOf("date");
q&&(h.timeOptions=h.timeOptions||y,h.timeOptions&&(h.timeOptions=g.mixin({},h.timeOptions),h.timeOptions.selector=h.timeOptions.selector||"time",f.push(h.timeOptions)));w&&(h.dateOptions=h.dateOptions||c,h.dateOptions&&(h.dateOptions=g.mixin({},h.dateOptions),h.dateOptions.selector=h.dateOptions.selector||"date",f.push(h.dateOptions)));f&&f.length?(f=p.map(f,function(c){return b.format(e,c)}),h=1==f.length?f[0]:m["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(b,c){return f[c]})):
h=b.format(e);return h},createColorStops:function(b){var c=b.values,e=b.colors,f=b.labelIndexes,w=b.isDate,m=b.dateFormatOptions;b=[];return b=p.map(c,function(b,h){var g=null;if(!f||-1<p.indexOf(f,h)){var q;(q=w?x.formatDate(b,m):t.format(b))&&(g=F(q,h,c.length-1))}return{value:b,color:e[h],label:g}})},updateColorStops:function(b){var c=b.stops,e=b.changes,f=b.isDate,w=b.dateFormatOptions,m=[],g,q=p.map(c,function(b){return b.value});p.forEach(e,function(b){m.push(b.index);q[b.index]=b.value});g=
t.round(q,{indexes:m});p.forEach(c,function(b,e){b.value=q[e];if(null!=b.label){var h,m=null;(h=f?x.formatDate(g[e],w):t.format(g[e]))&&(m=F(h,e,c.length-1));b.label=m}})},createClassBreakLabel:function(b){var c=b.minValue,e=b.maxValue,f=b.isFirstBreak?"":G.gt+" ";b="percent-of-total"===b.normalizationType?G.pct:"";c=null==c?"":t.format(c);e=null==e?"":t.format(e);return f+c+b+" \u2013 "+e+b},setLabelsForClassBreaks:function(b){var c=b.classBreaks,e=b.classificationMethod,f=b.normalizationType,m=
[];c&&c.length&&("standard-deviation"===e?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):b.round?(m.push(c[0].minValue),p.forEach(c,function(b){m.push(b.maxValue)}),m=t.round(m),p.forEach(c,function(b,c){b.label=x.createClassBreakLabel({minValue:0===c?m[0]:m[c],maxValue:m[c+1],isFirstBreak:0===c,normalizationType:f})})):p.forEach(c,function(b,c){b.label=x.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===
c,normalizationType:f})}))},updateClassBreak:function(b){var c=b.classBreaks,e=b.normalizationType,f=b.change,m=f.index,f=f.value,g=-1,q=-1,p=c.length;"standard-deviation"===b.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===m?g=m:m===p?q=m-1:(q=m-1,g=m),-1<g&&g<p&&(b=c[g],b.minValue=f,b.label=x.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===g,normalizationType:e})),-1<q&&
q<p&&(b=c[q],b.maxValue=f,b.label=x.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===q,normalizationType:e})))},calculateDateFormatInterval:function(b){var c,e,f=b.length,m,g,q,w,r,t,v=Infinity,y;b=p.map(b,function(b){return new Date(b)});for(c=0;c<f-1;c++){m=b[c];q=[];r=Infinity;t="";for(e=c+1;e<f;e++)g=b[e],g=m.getFullYear()!==g.getFullYear()&&"year"||m.getMonth()!==g.getMonth()&&"month"||m.getDate()!==g.getDate()&&"day"||m.getHours()!==g.getHours()&&"hour"||m.getMinutes()!==
g.getMinutes()&&"minute"||m.getSeconds()!==g.getSeconds()&&"second"||"millisecond",w=z[g],w<r&&(r=w,t=g),q.push(g);r<v&&(v=r,y=t)}return y},createUniqueValueLabel:function(b){var c=b.value,e=b.fieldInfo,f=b.domain;b=b.dateFormatInterval;var m=String(c);(f=f&&f.codedValues?f.getName(c):null)?m=f:"number"===typeof c&&(m=e&&"esriFieldTypeDate"===e.type?x.formatDate(c,b&&v[b]):t.format(c));return m},cloneColorInfo:function(b){var c;b&&(c=g.mixin({},b),c.colors=q(c.colors),c.stops=c.stops&&p.map(c.stops,
function(b){b=g.mixin({},b);b.color&&(b.color=new f(b.color));return b}),c.legendOptions&&(c.legendOptions=g.mixin({},c.legendOptions)));return c},cloneOpacityInfo:function(b){var c;if(b){c=g.mixin({},b);if(b=c.opacityValues)c.opacityValues=b.slice(0);if(b=c.stops)c.stops=p.map(b,function(b){return g.mixin({},b)});if(b=c.legendOptions)c.legendOptions=g.mixin({},b)}return c},cloneSizeInfo:function(b){var c;b&&(c=g.mixin({},b),c.stops&&(c.stops=p.map(c.stops,function(b){return g.mixin({},b)})),(b=c.minSize)&&
"object"===typeof b&&(c.minSize=x.cloneSizeInfo(b)),(b=c.maxSize)&&"object"===typeof b&&(c.maxSize=x.cloneSizeInfo(b)),b=c.legendOptions)&&(c.legendOptions=g.mixin({},b),b=b.customValues)&&(c.legendOptions.customValues=b.slice(0));return c},getClassCodesForRelationship:function(){return g.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return g.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1",
"HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});e("extend-esri")&&g.setObject("renderer.utils",x,r);return x})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(g,p,e,b,r,t){return g([t,r],{_onMap:function(b){var e=this.constructor._onMap,f;e&&e.FINAL||(delete this.constructor._onMap,e=this.registerConnectEvents(),e.FINAL=!0);b=b.toLowerCase();e[b]?
f=this[e[b].method]:(b=this._onCamelCase(b),this[b]&&(f=b));return f},on:function(e,m){var f=this._onMap(e),g=e.replace(/\-/g,""),p="on"+g in this.domNode;return f||!p?this.inherited(arguments):this.own(b(this.domNode,g,m))[0]},emit:function(b,e,g){var f,m,q,r=b.toLowerCase(),t=this.constructor._onMap||this.registerConnectEvents();m=this[this._onMap(r)];e=e||{};e.target||(e.target=this);m&&t&&t[r]&&(this._onObj2Arr(function(){f=Array.prototype.slice.call(arguments)},t[r].argKeys)(e),q=p.mixin({},
arguments),q[2]=f,q[0]=t[r].name.replace(/^on/,""));return this.inherited(q||arguments)}})})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(g,
p,e,b,r,t,f,m,q,F,x,G,z,v,c,y,w,h,H,D,B,R,E,M,I,A,N,da,ea,fa,ga,ha,ia,S,ja,W,T,X,Y,O,Z,aa,U){var ba=N.getClassValuesForRelationship(),ca={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},V={HH:315,HL:45,LL:135,LH:225},L=p([aa,h],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new f([64,64,64]),defaultText:"Aa",sizeRampLightColor:new f([255,
255,255]),sizeRampDarkColor:new f([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(a,d){e.mixin(this,U.widgets.legend);this._i18n=U.widgets.legend;a=a||{};a.map?d?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===a.respectVisibility?
!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===L.ALIGN_RIGHT?L.ALIGN_RIGHT:L.ALIGN_LEFT,this.arrangement===L.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=m(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);
var a=["ar","he"],d,b;for(d=0;d<a.length;d+=1)b=a[d],g.locale&&-1!==g.locale.indexOf(b)&&(-1!==g.locale.indexOf("-")?-1!==g.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();
9>q("ie")&&(this._repaintItems=e.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||b.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],b.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)c.destroy(this.domNode.children[a]);
this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],b.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),
a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],d=[];b.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var l;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(l=c.getLayers(),b.forEach(l,function(d){a.push(d.id)},this));"esri.layers.GeoRSSLayer"==
c.declaredClass&&(l=c.getFeatureLayers(),b.forEach(l,function(a){d.push(a.id)},this))},this);b.forEach(this.map.graphicsLayerIds,function(c){var l=this.map.getLayer(c);-1==b.indexOf(a,c)&&-1==b.indexOf(d,c)&&this._isSupportedLayerType(l)&&this._isLayerDrawingEnabled(l)&&(l.arcgisProps&&l.arcgisProps.title&&(l._titleForLegend=l.arcgisProps.title),this.layers.push(l))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&(a._params&&a._params.drawMode||a.isFeatureReductionActive&&
a.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var a=this._mapConnects;this._respectCurrentMapScale&&a.push(r.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(a.push(r.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),a.push(r.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers")),a.push(r.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")));b.forEach(this.layers,
function(a){var b=[r.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers"),r.connect(a,"onFeatureReductionChange",this,"_refreshLayers"),r.connect(a,"onVisibilityChange",this,"_refreshLayers"),r.connect(a,"onOpacityChange",this,"_refreshLayers"),r.connect(a,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&b.push(r.connect(a,"_onDynamicLayersChange",e.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&(b.push(r.connect(a,"onRenderingChange",e.partial(this._updateImageServiceLayers,this,a))),b.push(r.connect(a,"onRendererChange",e.partial(this._updateImageServiceLayers,this,a))));("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||a.setWebGLEnabled)&&b.push(r.connect(a,"onRendererChange",e.hitch(this,"_refreshLayers")));this._layerConnects[a.id]=b},this)}},_deactivate:function(){b.forEach(this._mapConnects,function(a){r.disconnect(a)});b.forEach(this.layers,function(a){var d=
this._layerConnects;d&&b.forEach(d[a.id],function(a){r.disconnect(a)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];b.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);b.forEach(this.map.graphicsLayerIds,
function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,d=!1;y.set(this.domNode,"position","relative");c.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var l=[];b.forEach(this.layers,function(k){if("esri.layers.KMLLayer"==k.declaredClass||"esri.layers.GeoRSSLayer"==k.declaredClass){var n;k.loaded?("esri.layers.KMLLayer"==
k.declaredClass?n=k.getLayers():"esri.layers.GeoRSSLayer"==k.declaredClass&&(n=k.getFeatureLayers(),this.hideLayersInLegend[k.id]&&(n=b.filter(n,function(a){return-1==b.indexOf(this.hideLayersInLegend[k.id],a.id)},this))),b.forEach(n,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&k._titleForLegend&&(a._titleForLegend=k._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==
a.geometryType&&(a._titleForLegend+=this.NLS_areas),l.push(a))},this)):r.connect(k,"onLoad",e.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===k.declaredClass)if(!k.loaded)r.connect(k,"onLoad",e.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&k.visible)&&0<k.layerInfos.length&&b.some(k.layerInfos,function(a){return a.legendURL})){var f=!1;b.forEach(k.layerInfos,function(d){if(d.legendURL&&-1<
b.indexOf(k.visibleLayers,d.name)){f||(c.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(k._titleForLegend||k.name||k.id)+"\x3c/span\x3e"},this.domNode),f=!0);var l;d=d.legendURL;if(k.customParameters||k.customLayerParameters){var n=e.clone(k.customParameters||{});e.mixin(n,k.customLayerParameters||{});for(l in n)d+=(-1===d.indexOf("?")?"?":"\x26")+l+"\x3d"+n[l]}c.create("div",{innerHTML:"\x3cimg src\x3d'"+d+"'/\x3e"},this.domNode);a=!0}},this)}}else"esri.layers.WFSLayer"!==
k.declaredClass||k.renderer?l.push(k):(n=c.create("div",{id:this.id+"_"+k.id,"class":"esriLegendService"}),c.create("span",{innerHTML:this._getServiceTitle(k),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},n))))),c.place(n,this.id,"first"),n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n),n=c.create("tbody",{},n),"esriGeometryComplex"===k.geometryType?(this._buildRow_Renderer(k,
k._pointSymbol,null,this.NLS_points,null,n),this._buildRow_Renderer(k,k._lineSymbol,null,this.NLS_lines,null,n),this._buildRow_Renderer(k,k._polygonSymbol,null,this.NLS_areas,null,n)):"esriGeometryPoint"===k.geometryType?this._buildRow_Renderer(k,k._pointSymbol,null,"",null,n):"esriGeometryPolyline"===k.geometryType?this._buildRow_Renderer(k,k._lineSymbol,null,"",null,n):"esriGeometryPolygon"===k.geometryType&&this._buildRow_Renderer(k,k._polygonSymbol,null,"",null,n),d=!0)},this);var n=[];b.forEach(l,
function(a){if(!a.loaded)var b=r.connect(a,"onLoad",this,function(a){r.disconnect(b);b=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var d=c.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});c.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",
{},c.create("table",{width:"95%"},d)))));c.place(d,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass||a.renderer&&"esri.renderer.StretchRenderer"===a.renderer.declaredClass&&1===a.bandCount?this._createLegendForLayer(a):this.isHostedTileService(a)?this._getLayerInfos(a).then(e.hitch(this,function(a){this._createLegendForLayer(a)}),e.hitch(this,function(a){n.push(this._legendRequest(a))})):n.push(this._legendRequest(a))}},this);0!==n.length||
a||d?(new G(n)).addCallback(e.hitch(this,function(b){a||d?v.byId(this.id+"_msg").innerHTML="":v.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(v.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer||this.isHostedTileService(a)){var d=!1;if(a.legendResponse||this.isHostedTileService(a)){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?b.forEach(c,function(c,l){this.hideLayersInLegend[a.id]&&-1!==
b.indexOf(this.hideLayersInLegend[a.id],c.id)||(c=this._buildLegendItems(a,c,l),d=d||c)},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(d=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,d=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));d&&(y.set(v.byId(this.id+"_"+a.id),"display","block"),y.set(v.byId(this.id+"_msg"),
"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);r.connect(a,"onLoad",e.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var d=a.url,c=d.indexOf("?"),d=-1<c?d.substring(0,c)+"/legend"+d.substring(c):d+"/legend";(c=a._getToken())&&(d+="?token\x3d"+c);var n=e.hitch(this,"_processLegendResponse"),k={f:"json"};a._params.dynamicLayers&&(k.dynamicLayers=z.stringify(this._createDynamicLayers(a)),"[{}]"===
k.dynamicLayers&&(k.dynamicLayers="[]"));a._params.bandIds&&(k.bandIds=a._params.bandIds);a._params.renderingRule?k.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&b.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(k.renderingRule=z.stringify({rasterFunction:a.name}))});return M({url:d,content:k,callbackParamName:"callback",load:function(b,d){n(a,b,d)},error:E.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=
a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!q("ie")||8<q("ie"))b+="\x26returnbytes\x3dtrue";var c=e.hitch(this,"_processLegendResponse");return M({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,d){c(a,b,d)},error:E.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,v.byId(this.id+"_"+a.id)&&c.empty(v.byId(this.id+"_"+a.id)),c.create("span",
{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},v.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+t.toJson(b))},_buildLegendItems:function(a,d,l){var n=!1,k=v.byId(this.id+"_"+a.id),e=d.parentLayerId;if(d.subLayerIds)a=c.create("div",{id:this.id+"_"+a.id+"_"+d.id+"_group",style:{display:"none"},"class":-1==
e?0<l?"esriLegendGroupLayer":"":this._legendAlign},-1==e?k:v.byId(this.id+"_"+a.id+"_"+e+"_group")),c.create("td",{innerHTML:B.encode(d.name),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers)if(l=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===b.indexOf(a.visibleLayers,d.id))return n}else{if(l=this._getReallyVisibleLayers(l,a.visibleLayers),-1===b.indexOf(l,
d.id))return n}else if(-1===b.indexOf(a.visibleLayers,d.id))return n;k=c.create("div",{id:this.id+"_"+a.id+"_"+d.id,style:{display:"none"},"class":-1<e?this._legendAlign:""},-1==e?k:v.byId(this.id+"_"+a.id+"_"+e+"_group"));c.create("td",{innerHTML:B.encode(d.name)||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},k))));l=a.dynamicLayerInfos||a.layerInfos;e=!1;l&&l.length&&(e=b.some(l,function(a){return!!a.drawingInfo}));if(a.legendResponse)n=
n||this._buildLegendItems_Tools(a,d,k);else if(a.renderer||e)n=n||this._buildLegendItems_Renderer(a,d,k)}return n},_getReallyVisibleLayers:function(a,d){if(!a||!d||!d.length)return[];var c=[],n=[],k;for(k=0;k<a.length;k++)if(a[k].subLayerIds){if(-1===b.indexOf(d,a[k].id)||-1<b.indexOf(n,a[k].id))n=n.concat(a[k].subLayerIds)}else-1<b.indexOf(d,a[k].id)&&-1===b.indexOf(n,a[k].id)&&c.push(a[k].id);return c},_buildLegendItems_Tools:function(a,d,l){var n=d.parentLayerId,k=this.map.getScale(),e=!1,f=function(a,
b){var d,c;for(d=0;d<a.length;d++)if(b.dynamicLayerInfos)for(c=0;c<b.dynamicLayerInfos[c].length;c++){if(b.dynamicLayerInfos[c].mapLayerId==a[d].layerId)return a[d]}else if(b.id==a[d].layerId)return a[d];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,d,k)){var h=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var m=this._getEffectiveScale(a,d);
if(m.minScale&&m.minScale<k||m.maxScale&&m.maxScale>k)h=!1}if(h){var k=f(a.legendResponse.layers,d),u=k.legendType,g=k.layerType,q=k.legend;if(q){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,k,d);l=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l);var p=c.create("tbody",{},l);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(l,a,d);var r=[];b.forEach(q,function(c){if(!(10.1<=a.version&&!c.values&&1<q.length)||
!a._hideDefaultSymbol&&"\x3call other values\x3e"!==c.label&&(c.label||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||"Raster Layer"===g)){var l=c.label;if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)e=!0,l&&-1!==b.indexOf(r,l)||(r.push(l),this._buildRow_Tools(c,p,a,d.id,u))}},this)}}}e&&(y.set(v.byId(this.id+"_"+a.id+"_"+d.id),"display","block"),-1<n&&(y.set(v.byId(this.id+"_"+a.id+"_"+n+"_group"),"display","block"),this._findParentGroup(a.id,a,
n)));return e},_getLayerInfos:function(a){var d=new x,c=a.dynamicLayerInfos||a.layerInfos;if(c&&c.length)if(b.some(c,function(a){return!!a.drawingInfo}))d.resolve(a);else{var n=a.url,k=n.indexOf("?"),n=-1==k?n+"/layers":n.substring(0,k)+"/layers"+n.substring(k,n.length);M({url:n,content:{f:"json"},callbackParamName:"callback",load:function(l,k){l.layers?(b.forEach(c,function(a){var d=b.filter(l.layers,function(b){return a.source?b.id===a.source.mapLayerId:b.id===a.id});d&&d[0]&&d[0].drawingInfo&&
(a.drawingInfo=d[0].drawingInfo,a.fields=d[0].fields)}),d.resolve(a)):d.reject(a)},error:function(b){d.reject(a)}})}return d},_sanitizeLegendResponse:function(a,d,c){var l=d.legend;if(10.1<=a.version&&1<l.length&&!d._sanitized){a=e.getObject("layerDefinition.drawingInfo.renderer",!1,c);var k,f;a||(a=e.getObject("drawingInfo.renderer",!1,c));b.some(l,function(a){if(a.values)return!0})&&b.some(l,function(a,b){a.values||(f=b,k=a);return!!k});a?"uniqueValue"===a.type?k&&(l.splice(f,1),l.push(k)):"classBreaks"===
a.type&&(k&&l.splice(f,1),l.reverse(),k&&l.push(k)):k&&(l.splice(f,1),l.push(k));d._sanitized=!0}},_buildRow_Tools:function(a,b,l,n,k){var d=c.create("tr",{},b),e;this.alignRight?(b=c.create("td",{align:this._isRightToLeft?"left":"right"},d),e=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},d)):(e=c.create("td",{width:35,align:"center"},d),b=c.create("td",{},d));d=a.url;(!q("ie")||9<=q("ie")||9>q("ie")&&"esri.layers.ArcGISImageServiceLayer"===l.declaredClass)&&a.imageData&&0<a.imageData.length?
d="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(d=l.url+"/"+n+"/images/"+a.url,(n=l._getToken())&&(d+="?token\x3d"+n));n=c.create("img",{src:d,border:0,style:"opacity:"+l.opacity},e);a=c.create("td",{innerHTML:B.encode(a.label),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%",dir:"ltr"},b))));k&&"Stretched"===k&&10.3<=l.version&&"esri.layers.ArcGISImageServiceLayer"===l.declaredClass&&(a.style.verticalAlign="top",a.style.lineHeight="1",n.style.marginBottom=
"-1px",n.style.display="block",b.style.verticalAlign="top");9>q("ie")&&(n.style.filter="alpha(opacity\x3d"+100*l.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,d,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return d?b.filter(a,function(a){return!(!a||a.field!==d||a.normalizationField!=c)}):a},_getFieldAlias:function(a,b,c){var d=b.infoTemplate||
(b.infoTemplates&&c&&b.infoTemplates[c.id]?b.infoTemplates[c.id].infoTemplate:null),d=d&&d.getFieldInfo&&d.getFieldInfo(a);a=e.isFunction(a)?null:this.getField(b,a,c);b=d||a;c="";b&&(c=d&&d.label||a&&a.alias||b.name||b.fieldName);return c},_getDomainName:function(a,b,c,n){var d;a&&!e.isFunction(a)&&(d=(c=(a=this.getField(c,a,n))&&c.getDomain?c.getDomain(a.name):null)&&c.codedValues?c.getName(b):null);return d},_getRampTitle:function(a,b,c){var d,k=a.field,l=a.normalizationField,f=!1,h=!1,m=!1,k=e.isFunction(k)?
null:k,l=e.isFunction(l)?null:l;if(a.legendOptions&&a.legendOptions.title)d=a.legendOptions.title;else if(a.valueExpressionTitle)d=a.valueExpressionTitle;else{if(b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var u=b.renderer.authoringInfo.visualVariables;for(a=0;a<u.length;a++){var g=u[a];if("colorInfo"===g.type&&"ratio"===g.style){f=!0;break}else if("colorInfo"===g.type&&"percent"===g.style){h=!0;break}else if("colorInfo"===g.type&&"percentTotal"===g.style){m=!0;
break}}}(f=m&&"showRatioPercentTotal"||h&&"showRatioPercent"||f&&"showRatio"||l&&"showNormField"||k&&"showField"||null)&&(d=I.substitute({field:k&&this._getFieldAlias(k,b,c),normField:l&&this._getFieldAlias(l,b,c)},"showField"===f?"${field}":this._i18n[f]))}return d},_getRendererTitle:function(a,b,c){var d;if(a){var l,f,h;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(l=a.attributeField,f=a.normalizationField,h="percent-of-total"===a.normalizationType);l=e.isFunction(l)?null:l;f=e.isFunction(f)?
null:f;a.legendOptions&&a.legendOptions.title?d=a.legendOptions.title:a.valueExpressionTitle?d=a.valueExpressionTitle:(a=f&&"showNormField"||(h?"showNormPct":null)||l&&"showField"||null)&&(d=I.substitute({field:l&&this._getFieldAlias(l,b,c),normField:f&&this._getFieldAlias(f,b,c)},"showField"===a?"${field}":this._i18n[a]))}return d},_buildLegendItems_Renderer:function(a,d,l){var n=d.parentLayerId,k=this.map,f=k.getScale(),h,m=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,d,f)){var g,
u,q,p,r,t,Q;u="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:d&&d.drawingInfo?Z.fromJson(e.clone(d.drawingInfo.renderer)):a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionRenderer():a.renderer;if("esri.renderer.ScaleDependentRenderer"===u.declaredClass&&(u=(k="zoom"===u.rangeType?u.getRendererInfoByZoom(k.getZoom()):u.getRendererInfoByScale(f))&&k.renderer,!u))return!1;k=u&&u.authoringInfo&&"relationship"===u.authoringInfo.type;if("esri.renderer.StretchRenderer"!==
u.declaredClass){var C=this._getVariables(u),w=b.filter(C,function(a){return!!a}).length,x=C[0],z=C[1],C=C[2],A,G,E,F,D;x&&(q=this._getMedianColor(u,x),x.field&&(r=e.isFunction(x.field)?null:this.getField(a,x.field,d)),A=!(x.legendOptions&&!1===x.legendOptions.showLegend));z&&(z.field&&(Q=e.isFunction(z.field)?null:this.getField(a,z.field,d)),G=!(z.legendOptions&&!1===z.legendOptions.showLegend));C&&(C.field&&(t=e.isFunction(C.field)?null:this.getField(a,C.field,d)),E=!(C.legendOptions&&!1===C.legendOptions.showLegend))}if("esri.renderer.HeatmapRenderer"===
u.declaredClass)h=m=!0,this._showHeatRamp(a,d,u,l);else if("esri.renderer.DotDensityRenderer"===u.declaredClass)h=m=!0,this._showDotDensityLegend(a,d,u,l);else if("esri.renderer.TemporalRenderer"===u.declaredClass)h=m=!0,f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l),g=c.create("tbody",{},f),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,a,d),u.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===u.latestObservationRenderer.declaredClass&&
this._buildRow_Renderer(a,u.latestObservationRenderer.symbol,q,B.encode(u.latestObservationRenderer.label)||this.NLS_currentObservations,null,g),u.observationRenderer&&"esri.renderer.SimpleRenderer"===u.observationRenderer.declaredClass&&this._buildRow_Renderer(a,u.observationRenderer.symbol,q,B.encode(u.observationRenderer.label)||this.NLS_previousObservations,null,g);else if("esri.renderer.UniqueValueRenderer"===u.declaredClass){if(u.infos&&0<u.infos.length){h=m=!0;if(u.legendOptions&&u.legendOptions.title||
u.valueExpressionTitle)f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l),g=c.create("tbody",{},f),w=u.legendOptions&&u.legendOptions.title?u.legendOptions.title:u.valueExpressionTitle,this._buildRow_Renderer(a,null,q,B.encode(w),null,g);f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l);g=c.create("tbody",{},f);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,a,d);u.attributeField&&C&&this._addSubHeader(g,this._getFieldAlias(u.attributeField,
a,d));if(k){var K=u.authoringInfo;D=K.focus;var w=K.numClasses,H=K.field1.field,f=K.field2.field;if(w&&H&&f){var P=K.field1.normalizationField,K=K.field2.normalizationField,L=P&&this._i18n.showNormField||H&&"${field}",M=K&&this._i18n.showNormField||f&&"${field}",H=I.substitute({field:this._getFieldAlias(H,a,d),normField:P&&this._getFieldAlias(P,a,d)},L),f=I.substitute({field:this._getFieldAlias(f,a,d),normField:K&&this._getFieldAlias(K,a,d)},M),P={shapeDescriptor:ca,rotation:this._getRotationAngleForFocus(D)||
0};this._buildRow_Renderer(a,null,null,B.encode(H),null,g,null,P);P.rotation+=90;this._buildRow_Renderer(a,null,null,B.encode(f),null,g,null,P);this._drawRelationshipLegend(l,{numClasses:w,focus:D,uvInfos:u.infos})}}else{var N=[];b.forEach(u.infos,function(c){var l=null;this._isLayerEditable(a)&&a.types&&(l=this._getTemplateFromTypes(a.types,c.value));var k=c.label;null==k&&(k=this._getDomainName(u.attributeField,c.value,a,d)||c.value);-1===b.indexOf(N,k)&&(N.push(k),this._buildRow_Renderer(a,c.symbol,
q,B.encode(k),l,g))},this)}}D=!k&&this._displayDefaultSymbol(a,u,l)}else if("esri.renderer.ClassBreaksRenderer"===u.declaredClass){if(u.infos&&0<u.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass)h=m=!0,F=this._isUnclassedRenderer(u),x||1!==u.infos.length||(p=(p=u.infos[0])&&p.symbol),F||(f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l),g=c.create("tbody",{},f),w=this._getRendererTitle(u,a,d),this._buildRow_Renderer(a,null,q,B.encode(w),
null,g)),f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l),g=c.create("tbody",{},f),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,a,d),F&&C&&E||(k=u.infos.slice(0).reverse(),b.forEach(k,function(b){var d=b.label;null!=d||F||(d=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,q,B.encode(d),null,g)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==a.declaredClass||a.renderer.style!==S.STYLE_SCALAR&&a.renderer.style!==S.STYLE_SINGLE_ARROW||
(this._buildRow_Renderer(a,u.defaultSymbol,null,"",null,g),a._hideDefaultSymbol=!0);F||(D=this._displayDefaultSymbol(a,u,l))}else if("esri.renderer.StretchRenderer"===u.declaredClass){h=m=!0;f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},l);g=c.create("tbody",{},f);var O=this;a.renderingRule?a.getRenderingRuleServiceInfo(a.renderingRule).then(function(b){var d=b&&b.minValues&&0<b.minValues.length&&b.maxValues&&0<b.maxValues.length;b&&1<b.bandCount||!d?O._legendRequest(a).then(function(b){O._processLegendResponse(a,
b)}):O._createStretchLegend(g,u,b.minValues[0],b.maxValues[0])}):this.createStretchLegend(g,u,a.serviceInfo.minValues[0],a.serviceInfo.maxValues[0])}else"esri.renderer.SimpleRenderer"===u.declaredClass&&(h=m=!0,f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l),g=c.create("tbody",{},f),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,a,d),p=null,this._isLayerEditable(a)&&a.templates&&0<a.templates.length&&(p=a.templates[0]),k=1<w?null:r&&A||Q&&G||t&&
E,this._buildRow_Renderer(a,u.symbol,q,B.encode(k?this._getRampTitle(1<w?null:x||z||C,a,d):u.label),p,g),p=x?null:u.symbol,k&&(r=Q=t=null));h&&(x&&A&&(x.field||x.valueExpression)&&this._showGradientRamp(a,d,u,null,l,x,r,null,C&&E?!0:!1),C&&E&&(C.field||C.valueExpression)&&(h=x&&A||"esri.renderer.UniqueValueRenderer"===u.declaredClass?!1:!0,this._showSizeLegend(a,d,u,C,q,l,t,null,h)),z&&G&&(z.field||z.valueExpression)&&this._showGradientRamp(a,d,u,p&&!p.url&&p.color?p.color:this.transparencyRampColor,
l,z,Q,null,!1));D||F&&!A&&!E&&!G||(D=this._displayDefaultSymbol(a,u,l));m=m||D}m&&(y.set(v.byId(this.id+"_"+a.id+"_"+d.id),"display","block"),-1<n&&(y.set(v.byId(this.id+"_"+a.id+"_"+n+"_group"),"display","block"),this._findParentGroup(a.id,n)));return m},_createStretchLegend:function(a,b,l,n){var d=c.create("tr",{},a),e;e=c.create("td",{rowspan:2,"class":"esriStretchLegend"},d);b=c.toDom(this._addColorRamp(b.colorRamp));c.place(b,e);c.create("td",{},d).innerHTML=this._i18n.high+": "+Math.round(n*
Math.pow(10,3))/Math.pow(10,3);a=c.create("tr",{},a);c.create("td",{},a).innerHTML=this._i18n.low+": "+Math.round(l*Math.pow(10,3))/Math.pow(10,3)},_addColorRamp:function(a){a||(a={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var b=this._generateColorRampDivs(a);a.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+b+"\x3c/div\x3e";return a.label},_generateColorRampDivs:function(a){if(a){var d,c="";"multipart"===a.type?(d=100/a.colorRamps.length,b.forEach(a.colorRamps.reverse(),
function(a){c+=this._generateSingleGradientDiv(a.fromColor,a.toColor,d)},this)):c=this._generateSingleGradientDiv(a.fromColor,a.toColor,100);return c}},_generateSingleGradientDiv:function(a,d,c){if(a&&d){var l,k="";a=a.toRgb?a.toRgb():a;d=d.toRgb?d.toRgb():d;l="(0deg, rgb("+a.slice(0,3).join()+"), rgb("+d.slice(0,3).join()+"));";b.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],function(a){k+="background: "+a+l});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+
c+"%;"+k+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(a){return"function"===typeof a.isEditable&&a.isEditable()},_isUnclassedRenderer:function(a,b){var d;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){d=a.attributeField;var c=a.normalizationField;d=b?d===b:!!this._getVariables(a,d,c).length}return d},_displayDefaultSymbol:function(a,b,l){var d;!a._hideDefaultSymbol&&b.defaultSymbol&&(d=!0,l=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
l),l=c.create("tbody",{},l),this._buildRow_Renderer(a,b.defaultSymbol,null,B.encode(b.defaultLabel)||"others",null,l));return d},_showGradientRamp:function(a,b,l,n,k,f,h,g,m){m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(m?"":" esriLegendSubFragment")},k);k=c.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(m,a,b,g);(h||f.valueExpression||f.legendOptions&&f.legendOptions.title)&&this._addSubHeader(k,this._getRampTitle(f,a,b));
h=f.field;var d;h&&(d=e.isFunction(h)?null:this.getField(a,h,b));(b=this._getRampStops(l,f,n,d&&"esriFieldTypeDate"===d.type))&&b.length&&this._drawGradientRamp(k,b,!0,a,this._getRampBorderColor(l),!!n)},_getMedianColor:function(a,b){var d,c;b.colors?(d=b.minDataValue,c=b.maxDataValue):b.stops&&(d=b.stops[0].value,c=b.stops[b.stops.length-1].value);return a.getColor(d+(c-d)/2,{colorInfo:b})},_getRampStops:function(a,d,c,n){var l,e,h,g,m=!1;d.colors||d.opacityValues?(e=d.maxDataValue-d.minDataValue,
l=b.map([0,.25,.5,.75,1],function(a){h=d.minDataValue+a*e;return Number(h.toFixed(6))}),this._checkPrecision(0,4,l)):d.stops&&(l=b.map(d.stops,function(a){return a.value}),(m=b.some(d.stops,function(a){return!!a.label}))&&(g=b.map(d.stops,function(a){return a.label})));var u=l[0],q,p;e=l[l.length-1]-u;return b.map(l,function(b,k){c?(q=new f(c.toRgba()),p=a.getOpacity(b,{opacityInfo:d}),null!=p&&(q.a=p)):q=a.getColor(b,{colorInfo:d});var h="";if(m)h=g[k];else{var h=n?N.formatDate(b,N.timelineDateFormatOptions):
A.format(b),J="";0===k?J=this._specialChars.lt+" ":k===l.length-1&&(J=this._specialChars.gt+" ");h=J+h}return{value:b,color:q,offset:1-(b-u)/e,label:h}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,l=c[a],e=c[d],f=c[b],h=Math.floor(l),g=Math.floor(e),u=Math.floor(f);h===l&&u===f&&g!==e&&h!==g&&u!==g&&(c[d]=g);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;
else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,d,l,e,k,h){var n=c.create("tr",{},a),g,m,u,p,J,r=d.length-1,t;p=0;this.alignRight?(a=c.create("td",{align:this._isRightToLeft?"left":"right"},n),g=c.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},n)):(g=c.create("td",{width:this.gradientWidth,
align:"center"},n),a=c.create("td",{},n));n=k&&0<k.a&&!(240<=k.r&&240<=k.g&&240<=k.b);m=c.create("div",{"class":n?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},g);g=c.create("div",{"class":"esriLegendColorRamp"+(h?" esriLegendTransparencyRamp":"")},m);h=y.get(g,"width");n&&(k=9>q("ie")?k.toHex():"rgba("+k.toRgba().join(",")+")",y.set(g,"border",this.colorRampBorder+" "+k));l?(k=this.gradientHeight*r,y.set(g,"height",k+"px")):k=y.get(g,"height");y.set(m,
"height",k+"px");n=H.createSurface(g,h,k);9>q("ie")&&(p=n.getEventSource(),y.set(p,"position","relative"),y.set(p.parentNode,"position","relative"),p=1);try{l&&b.forEach(d,function(a,b){a.offset=b/r}),J=n.createRect({x:-p,y:-p,width:h+p,height:k+p}),J.setFill({type:"linear",x1:0,y1:0,x2:0,y2:k,colors:d}).setStroke(null),n.createRect({width:h,height:k}).setFill(new f([255,255,255,1-e.opacity])).setStroke(null),this._surfaceItems.push(n)}catch(Q){n.clear(),n.destroy()}b.forEach(d,function(a,b){a.label&&
(t="top:"+100*a.offset+"%;",a="",0===b&&(a+=" esriLegendColorRampTickFirst"),b===d.length-1&&(a+=" esriLegendColorRampTickLast"),c.create("div",{"class":"esriLegendColorRampTick"+a,innerHTML:"\x26nbsp;",style:t},m))});u=c.create("div",{"class":"esriLegendColorRampLabels",style:{height:k+this.gradientHeight+"px"}},a);l?b.forEach(d,function(a){c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:B.encode(a.label)||"\x26nbsp;"},u)}):(c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},
u),c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(k+this.gradientHeight-2*this.gradientHeight)+"px;"},u))},_showHeatRamp:function(a,b,l,e,k){var d,n=l.field;d=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=c.create("tbody",{},d);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(d,a,b,k);(n=n&&this.getField(a,n,b))&&this._addSubHeader(e,this._getFieldAlias(n.name,a,b));b=this._getHeatmapStops(l);b.length&&
this._drawGradientRamp(e,b,!1,a)},_getHeatmapStops:function(a){var c=a.colorStops;a=a.colors;var l,e,k,f;c&&c[0]?(l=c.length-1,(a=c[0]&&null!=c[0].ratio)?(a=c[l])&&1!==a.ratio&&(c=c.slice(0),c.push({ratio:1,color:a.color}),l++):(e=c[0].value,k=c[l].value-e,c=b.map(c,function(a){return{color:a.color,ratio:(a.value-e)/k}}))):a&&a[0]&&(l=a.length-1,f=1/(a.length-1),c=b.map(a,function(a,b){return{color:a,ratio:b*f}}));c=b.map(c,function(a,b){var c="";0===b?c="Low":b===l&&(c="High");return{color:a.color,
label:c,offset:1-a.ratio}});return c.reverse()},_showDotDensityLegend:function(a,d,l,n){var k=l.legendOptions,f,h,g,m,u,p,q,r=this.dotDensitySwatchSize,t=Math.round(r/2);k&&(h=k.backgroundColor,g=k.outline,m=k.valueUnit,u=k.dotCoverage);u=(u||this.dotCoverage)/100;q=Math.round(r*r/Math.pow(l.dotSize,2)*u);n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n);p=c.create("tbody",{},n);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(n,a,d);this._addSubHeader(p,
I.substitute({value:l.dotValue,unit:m||""},this.NLS_dotValue));b.forEach(l.fields,function(b){b=e.mixin({},b);b.numPoints=q;f=new W(l._generateImageSrc(r,r,[b],{x:0,y:0},{x:r,y:r},h),g||l.outline,r,r);b=this.getField(a,b.name,d)||b;this._buildRow_Renderer(a,f,null,B.encode(this._getFieldAlias(b.name,a,d)),null,p,{type:"path",path:"M "+-t+","+-t+" L "+t+","+-t+" L "+t+","+t+" L "+-t+","+t+" L "+-t+","+-t+" E"})},this)},_showSizeLegend:function(a,b,l,n,k,f,h,g,m){var d=n.legendOptions,d=d&&d.customValues;
k=this._getSizeSymbol(l,k);if((!n.valueUnit||"unknown"===n.valueUnit)&&k&&(d||null!=n.minSize&&null!=n.maxSize&&null!=n.minDataValue&&null!=n.maxDataValue||n.stops&&!(1>=n.stops.length))){m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(m?"":" esriLegendSubFragment")},f);f=c.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(m,a,b,g);(h||n.valueExpression||n.legendOptions&&n.legendOptions.title)&&this._addSubHeader(f,this._getRampTitle(n,
a,b));h=(m=(g=n.field)&&!e.isFunction(g))&&"cluster_count"===g.toLowerCase();b=(b=m?a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(g):this.getField(a,g,b):null)&&"esriFieldTypeDate"===b.type;var d=d||this._getDataValues(l,k,n,b,h),p,q=d.length-1;for(g=q;0<=g;g--)m=d[g],k=O.fromJson(k.toJson()),this._applySize(k,l,n,m),m=b?N.formatDate(m,N.timelineDateFormatOptions):A.format(m),p="",g===q?p=this._specialChars.gt+" ":0===g&&(p=h&&1===d[g]?"":this._specialChars.lt+
" "),p="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+B.encode(p+m)+"\x3c/span\x3e",this._buildRow_Renderer(a,k,null,p,null,f)}},_getSizeSymbol:function(a,b){var c,d;if("esri.renderer.SimpleRenderer"===a.declaredClass)c=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)c=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?
null:c)if(c=O.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new f(this.sizeRampDarkColor)):(c.setColor(new f(this.sizeRampLightColor)),c.setOutline&&(a=new X,a.setColor(new f(this.sizeRampDarkColor)),a.setWidth(1.5),c.setOutline(a)));return c},_getDataValues:function(a,c,l,e,k){if(k){var d;b.some([5,3,2],function(b){b=this._getDataValuesByCount(a,c,l,e,b);this._hasFractionalValues(b)||(d=b);return!!d},this);return d}return this._getDataValuesByCount(a,c,l,e,5)},_getDataValuesByCount:function(a,
c,l,e,k,f){k=null==k?5:k;f=null==f?20:f;var d=a.getSizeRangeAtScale(l,this.map.getScale());k=this._interpolateSizeRange(d,k);var n=this._getDataRange(l),h=b.map(k,function(a){return this._getDataValueFromSize(a,n,d)},this);if(!e){var g,h=A.round(h);for(e=1;e<h.length-1;e++)if(g=this._roundDataValue(a,c,l,h[e],h[e-1],f))h[e]=g[0],k[e]=g[1]}return h},_hasFractionalValues:function(a){return b.some(a,function(a){return a!==Math.floor(a)})},_getDataRange:function(a){var b=a.stops;return b?{min:b[0].value,
max:b[b.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,b){var c=a.minSize;a=(a.maxSize-c)/(b-1);var d,k=[];for(d=0;d<b;d++)k.push(c+a*d);return k},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var k=b.min;b=b.max;return a<=d?k:a>=c?b:(a-d)/(c-d)*(b-k)+k},_roundDataValue:function(a,b,c,e,k,f){var d=this._getSize(b,a,c,e);k=this._getSize(b,a,c,k);var l,n=A.getDigits(e),h=n.integer,n=n.fractional,g,m,p,q,r,t,J,v,w,x,y;0<e&&1>e&&(l=Math.pow(10,
n),e*=l,h=A.getDigits(e).integer);for(--h;0<=h&&(g=Math.pow(10,h),n=Math.floor(e/g)*g,g*=Math.ceil(e/g),null!=l&&(n/=l,g/=l),m=(n+g)/2,m=A.round([n,m,g],{indexes:[1]})[1],p=this._getSize(b,a,c,n),q=this._getSize(b,a,c,g),r=this._getSize(b,a,c,m),t=A.getPctChange(d,p,k,null),J=A.getPctChange(d,q,k,null),v=A.getPctChange(d,r,k,null),w=t.prev<=f,x=J.prev<=f,w&&x&&(t.prev<=J.prev?(w=!0,x=!1):(x=!0,w=!1)),w?y=[n,p]:x?y=[g,q]:v.prev<=f&&(y=[m,r]),!y);h--);return y},_applySize:function(a,b,c,e){var d=a.type;
b=this._getSize(a,b,c,e);switch(d){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":d=a.width;c=a.height;a.setHeight(b);a.setWidth(d/c*b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,e){return b.getSize(e,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,e,f,k,g,h,m){var d=!!m,l=c.create("tr",{},
g),n;if(this.alignRight){if(g=c.create("td",{align:this._isRightToLeft?"left":"right"},l),b||d)n=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},l)}else{if(b||d)n=c.create("td",{width:35,align:"center"},l);g=c.create("td",{},l)}var p=l=30,q;if(b)if("simplemarkersymbol"==b.type)l=Math.min(Math.max(l,b.size+12),125),p=Math.min(Math.max(p,b.size+12),125);else if("picturemarkersymbol"==b.type)l=Math.min(Math.max(l,b.width),125),p=Math.min(b.height||p,125);else if("textsymbol"==b.type){var r,
t;b.text||(r=b.text,t=!0,b.setText(this.defaultText));l=Math.min(Math.max(l,b.getWidth()+12),125);p=Math.min(Math.max(p,b.getHeight()+12),125);t&&b.setText(r)}if(b||d)q=c.create("div",{style:"width:"+l+"px;height:"+p+"px;"},n);I.isDefined(f)&&"number"===typeof f&&(f=""+f);c.create("td",{innerHTML:f||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},g))));if(b||d)a=this._drawSymbol(q,b,e,l,p,k,a,h,m),this._surfaceItems.push(a)},_addSubHeader:function(a,b){a=
c.create("tr",{},a);a=c.create("td",{align:this._align,colspan:2},a);c.create("td",{innerHTML:B.encode(b)||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},a))))},_drawSymbol:function(a,b,c,n,k,g,h,m,p){var d=b&&O.fromJson(b.toJson()),l=h.opacity;b=!!p;if(d)if(c&&d.setColor(new f(c.toRgba())),"simplelinesymbol"===d.type||"cartographiclinesymbol"===d.type||"textsymbol"===d.type){if(!d.color)return;c=d.color.toRgba();c[3]*=l;d.color.setColor(c)}else"simplemarkersymbol"===
d.type||"simplefillsymbol"===d.type?(d.color&&(c=d.color.toRgba(),c[3]*=l,d.color.setColor(c)),d.outline&&d.outline.color&&(c=d.outline.color.toRgba(),c[3]*=l,d.outline.color.setColor(c))):"picturemarkersymbol"===d.type&&(a.style.opacity=l,a.style.filter="alpha(opacity\x3d("+100*l+"))");a=H.createSurface(a,n,k);9>q("ie")&&(c=a.getEventSource(),y.set(c,"position","relative"),y.set(c.parentNode,"position","relative"));g=b?p.shapeDescriptor:this._getDrawingToolShape(d,g)||O.getShapeDescriptors(d);var r,
l=(c=g.defaultShape)&&"text"===c.type;try{l&&!c.text&&(c.text=this.defaultText),r=a.createShape(m||c).setFill(g.fill).setStroke(g.stroke),l&&r.setFont(g.font)}catch(Q){a.clear();a.destroy();return}var t=r.getBoundingBox();m=t.width;g=t.height;var l=-(t.x+m/2),v=-(t.y+g/2);c=a.getDimensions();l={dx:l+c.width/2,dy:v+c.height/2};if(d&&"simplemarkersymbol"===d.type&&"path"===d.style)n=h._getScaleMatrix(t,d.size),r.applyTransform(D.scaleAt(n.xx,n.yy,{x:c.width/2,y:c.height/2}));else if(m>n||g>k)h=m/n>
g/k,n=((h?n:k)-5)/(h?m:g),e.mixin(l,{xx:n,yy:n});r.applyTransform(l);b&&r.applyTransform(D.rotategAt(p.rotation,m/2,g/2));return a},_getDrawingToolShape:function(a,b){switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_drawRelationshipLegend:function(a,b){var c=b.focus,d=b.numClasses,e=ba[d],f=!!c,g=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),h={};b.uvInfos.forEach(function(a){h[a.value]={label:a.label,fill:this._getSymbolColor(a.symbol)}},this);b=[];for(var m=0;m<d;m++){for(var p=
[],q=0;q<d;q++)p.push(h[e[m][q]].fill);b.push(p)}e=this._getRelationshipCornerLabels(c,h);a=this._drawRampLayout(a,e,g,f);a=H.createSurface(a,g,g);f||(a.rawNode.style.margin="-15px -15px -18px -15px");b=Y.create2DColorRamp({surface:a,colors:b,numClasses:d,size:75});d=(g-75)/2;g=(g-75)/2;b.applyTransform(D.translate(d,g));f&&b.applyTransform(D.rotategAt(this._getRotationAngleForFocus(c),37.5,37.5));b=a.createGroup();e={width:1,color:"#555555"};m=a.defNode;this._createArrowMarker(m,"start");this._createArrowMarker(m,
"end");m=b.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(e);e=b.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(e);this._setLineArrow(m.rawNode,"left",c);this._setLineArrow(e.rawNode,"right",c);b.applyTransform(D.translate(d,g));f&&b.applyTransform(D.rotategAt(-45,37.5,37.5));this._surfaceItems.push(a)},_drawRampLayout:function(a,b,e,f){var d=c.create("div",{style:{padding:"10px"}},a);a=e+"px";e+="px";f?(f=c.create("div",{style:{display:"flex"}},d),c.create("div",{class:"esriLegendRelationshipLabel",
style:{alignSelf:"center",maxWidth:a,textAlign:"right"},innerHTML:b.left},f),d=c.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},f),c.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.right},f),f=c.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:b.top},d),f=c.create("div",{style:{height:e,width:e}},d),d=c.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",
maxWidth:a},innerHTML:b.bottom},d)):(d=c.create("div",{style:{display:"table",color:"#555555"}},d),f=c.create("div",{style:{display:"table-row"}},d),e=c.create("div",{style:{display:"table-row"}},d),d=c.create("div",{style:{display:"table-row"}},d),c.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"bottom"},innerHTML:b.left},f),c.create("div",{style:{display:"table-cell"}},f),c.create("div",{class:"esriLegendRelationshipLabel",
style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"bottom"},innerHTML:b.top},f),c.create("div",{style:{display:"table-cell"}},e),f=c.create("div",{style:{display:"table-cell"}},e),c.create("div",{style:{display:"table-cell"}},e),c.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"top"},innerHTML:b.bottom},d),c.create("div",{style:{display:"table-cell"}},d),c.create("div",{class:"esriLegendRelationshipLabel",
style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"top"},innerHTML:b.right},d));return f},_getSymbolColor:function(a){if(a)return"simplelinesymbol"===a.type||"simplemarkersymbol"===a.type&&(a.style===T.STYLE_X||a.style===T.STYLE_CROSS)?(a=a.getStroke())&&a.color:a.getFill()},_getRotationAngleForFocus:function(a){var b=V[a];a&&null==b&&(b=V.HH);return b},_setLineArrow:function(a,b,c){var d=this.id+"_arrowStart",e=this.id+"_arrowEnd";b="left"===b;switch(c){case "HL":a.setAttribute(b?
"marker-start":"marker-end","url(#"+(b?e:d)+")");break;case "LL":a.setAttribute("marker-start","url(#"+e+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?d:e)+")");break;default:a.setAttribute("marker-end","url(#"+d+")")}},_createArrowMarker:function(a,b){var c="start"===b,d=this.id+(c?"_arrowStart":"_arrowEnd");b=c?"0,0 5,5 0,10":"5,0 0,5 5,10";var e=c?5:0,c=document.createElementNS("http://www.w3.org/2000/svg","marker");c.setAttribute("id",d);c.setAttribute("markerWidth",
"10");c.setAttribute("markerHeight","10");c.setAttribute("refX",e);c.setAttribute("refY","5");c.setAttribute("markerUnits","strokeWidth");c.setAttribute("orient","auto");d=document.createElementNS("http://www.w3.org/2000/svg","polyline");d.setAttribute("points",b);d.setAttribute("fill","none");d.setAttribute("stroke","#555555");d.setAttribute("stroke-width","1");c.appendChild(d);a.appendChild(c)},_getRelationshipCornerLabels:function(a,b){var c=b.HH.label,d=b.LL.label,e=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:c,
bottom:d,left:e,right:b};case "HL":return{top:e,bottom:b,left:d,right:c};case "LL":return{top:d,bottom:c,left:b,right:e};case "LH":return{top:b,bottom:e,left:c,right:d};default:return{top:c,bottom:d,left:e,right:b}}},_repaintItems:function(){b.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(d){}a.children&&e.isArray(a.children)&&b.forEach(a.children,
this._repaint,this)}},_createHoverAction:function(a,b,f,g){if(g=b._hoverLabel||b._hoverLabels&&b._hoverLabels[f.id]||g)g=B.encode(g),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[f.id]=r.connect(a,"onmousemove",e.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,y.set(v.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(e.hitch(this,function(a,b,d){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,v.byId(this.id+"_hoverLabel")){var e=v.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";y.set(e,"top",b+"px");y.set(e,"left",a+15+"px");y.set(e,"display","")}else c.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},g)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[f.id]=r.connect(a,"onmouseout",e.hitch(this,function(a){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,y.set(v.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;b.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)r.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)r.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var c=[],e;b.forEach(a.dynamicLayerInfos||a.layerInfos,function(b){e={id:b.id};e.source=b.source&&b.source.toJson();
var d;a.layerDefinitions&&a.layerDefinitions[b.id]&&(d=a.layerDefinitions[b.id]);d&&(e.definitionExpression=d);var f;a.layerDrawingOptions&&a.layerDrawingOptions[b.id]&&(f=a.layerDrawingOptions[b.id]);f&&(e.drawingInfo=f.toJson());e.minScale=b.minScale||0;e.maxScale=b.maxScale||0;c.push(e)});return c},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=
b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(y.set(v.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function c(d,e){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,l;for(g=0;g<f.length;g++)if(f[g].id===d&&f[g].subLayerIds)for(l=0;l<f[g].subLayerIds.length;l++){var h=f[g].subLayerIds[l];-1===b.indexOf(e,h)&&(e.push(h),c(h,e))}}a.layer.layerInfos&&
b.forEach(this.hideLayersInLegend[a.layer.id],function(b){c(b,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,
f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],I.isDefined(a)&&(b+=" ("+a+")"));return B.encode(b)},_getEffectiveScale:function(a,
b){var c=b.minScale,d=b.maxScale;if(I.isDefined(b.parentLayerId)){a=a.layerInfos;b=b.parentLayerId;var e;for(e=a.length-1;0<=e;e--)if(a[e].id==b)if(0==c&&0<a[e].minScale?c=a[e].minScale:0<c&&0==a[e].minScale||0<c&&0<a[e].minScale&&(c=Math.min(c,a[e].minScale)),d=Math.max(d||0,a[e].maxScale||0),-1<a[e].parentLayerId)b=a[e].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return!(!a||!("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass))},isHostedTileService:function(a){var b=
/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==a.declaredClass||!b.test(a.url))},getField:function(a,c,e){if(a.getField)return a.getField(c);if(e&&e.fields){var d;b.forEach(e.fields,function(a){a.name===c&&(d=a)});return d}return null}});e.mixin(L,{ALIGN_LEFT:0,ALIGN_RIGHT:1});q("extend-esri")&&e.setObject("dijit.Legend",L,R);return L});