// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.27/esri/copyright.txt for details.
//>>built
define("esri/geometry/Polygon","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./Extent ./mathUtils ../srUtils".split(" "),function(D,p,t,E,q,y,z,F,r,A,u,G){function B(){}function v(){}z={type:"polygon",rings:null};var k=D(F,{declaredClass:"esri.geometry.Polygon",type:"polygon",rings:null,constructor:function(a){this.rings=[];this._ring=0;a&&(t.isArray(a)?this.rings=t.isArray(a[0][0])?a:[a]:a.rings?y.mixin(this,a):this.spatialReference=
a,this.spatialReference&&(this.spatialReference=G.createSpatialReference(this.spatialReference)));this.verifySR()},addRing:function(a){this.clearCache();this._ring=this.rings.length;this.rings[this._ring]=[];t.isArray(a[0])?p.forEach(a,this._addPointArr,this):p.forEach(a,this._addPoint,this);return this},_addPointArr:function(a){this.rings[this._ring].push(a)},_addPoint:function(a){this.rings[this._ring].push([a.x,a.y])},_insertPoints:function(a,b){this.clearCache();this._ring=b;this.rings[this._ring]||
(this.rings[this._ring]=[]);p.forEach(a,this._addPoint,this)},_validateInputs:function(a,b){return null!==a&&void 0!==a&&(0>a||a>=this.rings.length)||null!==b&&void 0!==a&&(0>b||b>=this.rings[a].length)?!1:!0},getPoint:function(a,b){if(this._validateInputs(a,b))return new r(this.rings[a][b],this.spatialReference)},setPoint:function(a,b,c){if(this._validateInputs(a,b))return this.clearCache(),this.rings[a][b]=[c.x,c.y],this},insertPoint:function(a,b,c){if(this._validateInputs(a)&&null!=b&&0<=b&&b<=
this.rings[a].length)return this.clearCache(),this.rings[a].splice(b,0,[c.x,c.y]),this},removeRing:function(a){if(this._validateInputs(a,null)){this.clearCache();a=this.rings.splice(a,1)[0];var b,c=a.length,e=this.spatialReference;for(b=0;b<c;b++)a[b]=new r(a[b],e);return a}},removePoint:function(a,b){if(this._validateInputs(a,b))return this.clearCache(),new r(this.rings[a].splice(b,1)[0],this.spatialReference)},getExtent:function(){var a;a=this.getCacheValue("_extent");var b=this.getCacheValue("_partwise");
if(a)return a=new A(a),a._partwise=b,a;a=this.rings;var c=a.length;if(c&&a[0].length){var e,f,d,h,g,m,l,k,n=h=a[0][0][0],C=g=a[0][0][1],w=Math.min,x=Math.max,p=this.spatialReference,b=[],q,r,t,u;for(m=0;m<c;m++){e=a[m];q=r=e[0]&&e[0][0];t=u=e[0]&&e[0][1];k=e.length;for(l=0;l<k;l++)f=e[l],d=f[0],f=f[1],n=w(n,d),C=w(C,f),h=x(h,d),g=x(g,f),q=w(q,d),t=w(t,f),r=x(r,d),u=x(u,f);b.push(new A({xmin:q,ymin:t,xmax:r,ymax:u,spatialReference:p?p.toJson():null}))}a={xmin:n,ymin:C,xmax:h,ymax:g,spatialReference:p?
p.toJson():null};b=1<b.length?b:null;this.setCacheValue("_extent",a);this.setCacheValue("_partwise",b);a=new A(a);a._partwise=b;return a}},contains:function(a){var b=this.rings,c,e=!1,f,d,h,g,m,l,k=b.length;c=this.spatialReference;f=a.spatialReference;var n=a.x;a=a.y;c&&f&&!c.equals(f)&&c._canProject(f)&&(a=c.isWebMercator()?r.lngLatToXY(n,a):r.xyToLngLat(n,a,!0),n=a[0],a=a[1]);for(l=0;l<k;l++)for(c=b[l],h=c.length,m=g=0;m<h;m++)g++,g===h&&(g=0),f=c[m],d=c[g],(f[1]<a&&d[1]>=a||d[1]<a&&f[1]>=a)&&f[0]+
(a-f[1])/(d[1]-f[1])*(d[0]-f[0])<n&&(e=!e);return e},getCentroid:function(){var a=this.getCacheValue("_centroid");if(void 0!==a)return a;var a=this.rings,b,c,e,f,d=[],h,g,m=Infinity,l=-Infinity,k=Infinity,n=-Infinity;p.forEach(a,function(a){b=c=e=0;p.forEach(a,function(d,f){f<a.length-1&&(h=a[f+1],g=d[0]*h[1]-h[0]*d[1],b+=(d[0]+h[0])*g,c+=(d[1]+h[1])*g,e+=g,d[0]<m&&(m=d[0]),d[0]>l&&(l=d[0]),d[1]<k&&(k=d[1]),d[1]>n&&(n=d[1]))});0<e&&(e*=-1);e&&d.push([b,c,e/2])});d.sort(function(a,b){return a[2]-b[2]});
b=c=void 0;d[0]&&(f=6*d[0][2],b=d[0][0]/f,c=d[0][1]/f,b<m||b>l||c<k||c>n)&&(b=c=void 0);if(void 0===b||void 0===c)if(a=a[0]&&a[0].length?this._getLineCentroid(a[0]):null)b=a.x,c=a.y;a=isNaN(b)||isNaN(c)?null:new r(b,c,this.spatialReference);this.setCacheValue("_centroid",a);return a},_getLineCentroid:function(a){var b,c=0,e=0,f=0,d,h,g={x:0,y:0},m={x:0,y:0},l,k=a.length,n;for(l=0;l<k-1;l++)d=a[l],h=a[l+1],d&&h&&(g.x=d[0],g.y=d[1],m.x=h[0],m.y=h[1],b=u.getLength(g,m),0<b&&(c+=b,d=u.getMidpoint(d,h),
e+=b*d[0],f+=b*d[1]));0<c?n={x:e/c,y:f/c}:a[0]&&(n={x:a[0][0],y:a[0][1]});return n},isClockwise:function(a){var b=0,c,e=a.length,f=t.isArray(a[0])?function(a,b){return a[0]*b[1]-b[0]*a[1]}:function(a,b){return a.x*b.y-b.x*a.y};for(c=0;c<e;c++)b+=f(a[c],a[(c+1)%e]);return 0>=b/2},isSelfIntersecting:function(a){a=a||this;var b,c,e,f,d,h,g,k=a.rings.length,l;for(e=0;e<k;e++){for(b=0;b<a.rings[e].length-1;b++)for(d=[[a.rings[e][b][0],a.rings[e][b][1]],[a.rings[e][b+1][0],a.rings[e][b+1][1]]],c=e+1;c<
k;c++)for(f=0;f<a.rings[c].length-1;f++)if(h=[[a.rings[c][f][0],a.rings[c][f][1]],[a.rings[c][f+1][0],a.rings[c][f+1][1]]],(g=u._getLineIntersection2(d,h))&&!(g[0]===d[0][0]&&g[1]===d[0][1]||g[0]===h[0][0]&&g[1]===h[0][1]||g[0]===d[1][0]&&g[1]===d[1][1]||g[0]===h[1][0]&&g[1]===h[1][1]))return!0;f=a.rings[e].length;if(!(4>=f))for(b=0;b<f-3;b++)for(l=f-1,0===b&&(l=f-2),d=[[a.rings[e][b][0],a.rings[e][b][1]],[a.rings[e][b+1][0],a.rings[e][b+1][1]]],c=b+2;c<l;c++)if(h=[[a.rings[e][c][0],a.rings[e][c][1]],
[a.rings[e][c+1][0],a.rings[e][c+1][1]]],(g=u._getLineIntersection2(d,h))&&!(g[0]===d[0][0]&&g[1]===d[0][1]||g[0]===h[0][0]&&g[1]===h[0][1]||g[0]===d[1][0]&&g[1]===d[1][1]||g[0]===h[1][0]&&g[1]===h[1][1]))return!0}return!1},toJson:function(){var a={rings:y.clone3DArray(this.rings)},b=this.spatialReference;b&&(a.spatialReference=b.toJson());return a}});B.prototype=k.prototype;v.prototype=new B;Object.defineProperty(v.prototype,"rings",{get:function(){this._unquantizeFn&&(this._ringsVal=this._unquantizeFn({rings:y.clone3DArray(this._ringsVal)}).rings,
this._unquantizeFn=null);return this._ringsVal},set:function(a){this._ringsVal=a}});v.prototype.setupLazyUnquantization=function(a,b){this._unquantizeFn=a;this._ringsVal=b.rings};k.simpleConstructor=B;k.accessorConstructor=v;k.defaultProps=z;k.createEllipse=function(a){var b=a.center.x,c=a.center.y,e=a.longAxis,f=a.shortAxis,d=a.numberOfPoints,h=a.map,g,m,l;a=[];var p=2*Math.PI/d;for(m=0;m<d;m++)g=Math.cos(m*p),l=Math.sin(m*p),g=h.toMap({x:e*g+b,y:f*l+c}),a.push(g);a.push(a[0]);b=new k(h.spatialReference);
b.addRing(a);return b};k.createCircle=function(a){return k.createEllipse({center:a.center,longAxis:a.r,shortAxis:a.r,numberOfPoints:a.numberOfPoints,map:a.map})};k.fromExtent=function(a){var b=a.normalize();a=a.spatialReference;return new k({rings:p.map(b,function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]}),spatialReference:a?a.toJson():null})};E("extend-esri")&&(t.setObject("geometry.Polygon",k,q),q.geometry.defaultPolygon=z,q.geometry.createEllipse=
k.createEllipse,q.geometry.createCircle=k.createCircle,q.geometry.isClockwise=k.prototype.isClockwise,q.geometry.polygonSelfIntersecting=k.prototype.isSelfIntersecting);return k});