define(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorBase=function(e){var t=new Error(e);return this.message=t.message,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=t.stack,this},t.ErrorBase.prototype=Error.prototype}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,o;n=[r,t,r(2)],void 0===(o=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrintManager=r.PrintManager}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o,i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,c)}u((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};n=[r,t,r(3),r(4),r(5),r(6),r(7),r(8),r(9)],void 0===(o=function(e,t,r,n,o,c,u,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=/(^.*)\/home\/item\.html\?id=([a-z0-9]{32}$)/i;!function(e){function t(e){if(!e)throw new u.PrintError("A URL to a print template is required.");if(!e.match(p))throw new u.PrintError("The print template url is invalid.")}function f(e){var t=e.match(/^(https?:\/\/.*?)\/home\/item.html.*?id=([a-f0-9]+)/i);if(t&&t.length>2)return{portalUrl:t[1],printId:t[2]}}function h(e,t,r){return i(this,void 0,void 0,function(){var n,i,c;return s(this,function(s){switch(s.label){case 0:n=t+"/sharing/content/items/"+e+"?f=json&token="+(r||""),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(n)];case 2:return i=s.sent(),[3,4];case 3:throw s.sent(),new o.NetworkError("A network error occurred. Unable to complete the print operation.");case 4:return i.ok||_(i.statusText,i.status),[4,i.json()];case 5:return(c=s.sent()).error&&_(c.error.message,c.error.code),[2,c]}})})}function d(e){if(!e.typeKeywords||!Array.from(e.typeKeywords).includes("Geocortex Printing"))throw new u.PrintError("The configured URL does not reference a Geocortex print template.");if(!e.url)throw new u.PrintError("The print template does not contain a service URL.")}function v(e,t,r){return i(this,void 0,void 0,function(){var n,i,c,u;return s(this,function(s){switch(s.label){case 0:if(null==r)return[2,""];n={accessToken:r,portalUrl:t},i={method:"POST",responseType:"json",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(e+"/auth/token/run",i)];case 2:return c=s.sent(),[3,4];case 3:throw s.sent(),new o.NetworkError("A network error occurred. Unable to complete the print operation.");case 4:return c.ok||_(c.statusText,c.status),[4,c.json()];case 5:return u=s.sent(),[2,"Bearer "+(u.response&&u.response.token?u.response.token:"")]}})})}function y(e){var t=e.results,r=e.error;if(r)_(r.message,r.status);else{var n=t.find(function(e){return"JobResult"===e.$type});if(n)return n.tag;if(t.find(function(e){return"JobQuit"===e.$type})){var o=t.find(function(e){return e.$type&&e.$type.endsWith("error")});_(o.message?o.message:"Job quit without result",o.code)}}}function _(e,t){var o=t?"Error code: "+t+'. Response error: "'+e+'"':'Response error: "'+e+'"';throw 400===t?new n.InvalidOperationError(o):403===t?new r.AccessDeniedError(o):404===t?new c.NotFoundError(o):new u.PrintError(o)}e.runPrint=function(e,r,n){return i(this,void 0,void 0,function(){var c,u,l,p,b,w,m,O;return s(this,function(P){switch(P.label){case 0:return t(e),c=f(e),u=c.portalUrl,[4,h(l=c.printId,u,n)];case 1:return d(p=P.sent()),[4,v(b=p.url+"service",u,n)];case 2:return w=P.sent(),[4,function(e,t,r,n,c){return i(this,void 0,void 0,function(){var i,u,a,l,p;return s(this,function(s){switch(s.label){case 0:i={template:{itemId:t,portalUrl:e},parameters:c.parameters,dpi:c&&c.dpi?c.dpi:96},u={method:"POST",responseType:"json",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:n}},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(r+"/job/run",u)];case 2:return a=s.sent(),[3,4];case 3:throw s.sent(),new o.NetworkError("A network error occurred. Unable to complete the print operation.");case 4:return a.ok||_(a.statusText,a.status),[4,a.json()];case 5:return l=s.sent(),(p=l.response)&&p.ticket||_("The print service did not provide a ticket."),[2,p.ticket]}})})}(u,l,b,w,r)];case 3:return m=P.sent(),[4,function(e,t,r){return i(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return"WebSocket"in window||"MozWebSocket"in window?[4,function(e,t,r){return i(this,void 0,void 0,function(){var e=this;return s(this,function(n){return t=t.replace(/^http/,"ws"),[2,new Promise(function(n,o){var c=new WebSocket(t+"/job/artifacts?ticket="+r);c.onmessage=function(t){return i(e,void 0,void 0,function(){var e,r;return s(this,function(o){return(e="string"==typeof t.data?JSON.parse(t.data):t.data).final&&(c.close(),n()),(r=y(e))&&(c.close(),n(r)),n(),[2]})})},c.onerror=function(){c.close(),n()}})]})})}(0,t,r)]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return e?[3,4]:[4,function(e,t,r){return i(this,void 0,void 0,function(){var e,n,i,c,u;return s(this,function(s){switch(s.label){case 0:e=new a.PollSchedule,n={method:"GET",responseType:"json",headers:{"Content-Type":"application/json"}},s.label=1;case 1:return i?[3,8]:[4,(l=e.interval(),void 0===l&&(l=0),new Promise(function(e){setTimeout(e,l)}))];case 2:s.sent(),c=void 0,s.label=3;case 3:return s.trys.push([3,5,,6]),[4,fetch(t+"/job/artifacts?ticket="+r,n)];case 4:return c=s.sent(),[3,6];case 5:throw s.sent(),new o.NetworkError("A network error occurred. Unable to complete the print operation.");case 6:return c.ok||_(c.statusText,c.status),[4,c.json()];case 7:return u=s.sent(),i=y(u),[3,1];case 8:return[2,i]}var l})})}(0,t,r)];case 3:e=n.sent(),n.label=4;case 4:return e||_("The print service did not provide a tag."),[2,e]}})})}(0,b,m)];case 4:return O=P.sent(),[2,b+"/job/result?ticket="+m+"&tag="+O]}})})},e.describeTemplate=function(e,r){return i(this,void 0,void 0,function(){var n,c,u,a,p,y;return s(this,function(b){switch(b.label){case 0:return t(e),n=f(e),c=n.portalUrl,[4,h(u=n.printId,c,r)];case 1:return d(a=b.sent()),[4,v(p=a.url+"service",c,r)];case 2:return y=b.sent(),[4,function(e,t,r,n){return i(this,void 0,void 0,function(){var i,c,u,a,p,f;return s(this,function(s){switch(s.label){case 0:i={template:{itemId:t,portalUrl:e}},c={method:"POST",responseType:"json",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:n}},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,fetch(r+"/job/metadata",c)];case 2:return u=s.sent(),[3,4];case 3:throw s.sent(),new o.NetworkError("A network error occurred. Unable to get print template metadata.");case 4:return u.ok||_(u.statusText,u.status),[4,u.json()];case 5:return a=s.sent(),(p=a.response)&&p.parameters||_("The print service did not provide any metadata."),f=l.MarshalControlProperties(p.controls),[2,{parameters:p.parameters,controls:f}]}})})}(c,u,p,y)];case 3:return[2,b.sent()]}})})}}(t.PrintManager||(t.PrintManager={}))}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o,i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(0)],void 0===(o=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t||"Access denied.",r.name="AccessDeniedError",r}return s(t,e),t}(r.ErrorBase);t.AccessDeniedError=n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o,i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(0)],void 0===(o=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t||"Invalid operation.",r.name="InvalidOperationError",r}return s(t,e),t}(r.ErrorBase);t.InvalidOperationError=n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o,i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(0)],void 0===(o=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t||"Network error encountered.",r.name="NetworkError",r}return s(t,e),t}(r.ErrorBase);t.NetworkError=n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o,i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(0)],void 0===(o=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t||"Resource not found.",r.name="NotFoundError",r}return s(t,e),t}(r.ErrorBase);t.NotFoundError=n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o,i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});n=[r,t,r(0)],void 0===(o=function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t||"An error occurred while printing.",r.name="PrintError",r}return s(t,e),t}(r.ErrorBase);t.PrintError=n}.apply(t,n))||(e.exports=o)},function(e,t,r){var n,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._defaultSchedule=[{interval:250,cycles:12},{interval:1e3,cycles:57},{interval:3e3}],this._schedule=e?this._buildSchedule(e):this._defaultSchedule,this._cycles=0,this._scheduleSlot=0}return e.prototype.interval=function(){return this._scheduleSlot<this._schedule.length-1&&(this._cycles>=this._schedule[this._scheduleSlot].cycles&&this._scheduleSlot++,this._cycles++),this._schedule[this._scheduleSlot].interval},e.prototype._buildSchedule=function(e){var t,r,n=[];try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var c=s.value,u=c.interval,a=c.cycles?c.cycles:1;n.push({interval:u,cycles:a})}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e}();t.PollSchedule=r}.apply(t,[r,t]))||(e.exports=n)},function(e,t,r){var n,o=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};void 0===(n=function(e,t){"use strict";function r(e,t){return"HundredsOfAnInch"===t?e/100*25.4:"TenthsOfAMillimeter"===t?e/10:e}Object.defineProperty(t,"__esModule",{value:!0}),t.MarshalControlProperties=function(e){var t,n,i=[];if(!e||0===e.length)return i;try{for(var s=o(e),c=s.next();!c.done;c=s.next()){var u=c.value,a={controlType:u.controlType,purpose:u.purpose,height:r(u.height,u.units),width:r(u.width,u.units)};i.push(a)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i}}.apply(t,[r,t]))||(e.exports=n)}])});